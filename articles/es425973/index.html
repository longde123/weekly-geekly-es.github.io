<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äçüî¨ üò± ‚öúÔ∏è C√≥mo creamos el almacenamiento S3 DataLine. Experimentos, pruebas y un poco sobre hipop√≥tamos üè£ üë©üèΩ‚Äçü§ù‚Äçüë©üèº üóª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola de nuevo, Alexey Pristavko est√° en contacto, y esta es la segunda parte de mi historia sobre la l√≠nea de datos de almacenamiento de objetos S3 ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo creamos el almacenamiento S3 DataLine. Experimentos, pruebas y un poco sobre hipop√≥tamos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/425973/"><img src="https://habrastorage.org/webt/0k/od/i7/0kodi796iwhoi16frktb7mytx_4.png"><br><br>  Hola de nuevo, Alexey Pristavko est√° en contacto, y esta es la segunda parte de mi historia sobre la l√≠nea de datos de almacenamiento de objetos S3 basada en Cloudian HyperStore. <br><br>  Hoy hablar√© en detalle sobre c√≥mo est√° organizado nuestro almacenamiento S3 y qu√© dificultades encontramos en el proceso de creaci√≥n.  Aseg√∫rese de tocar el tema "hierro" y analizar el equipo en el que terminamos qued√°ndonos. <br><br>  Vamos! <br><a name="habracut"></a><br>  Si durante la lectura desea familiarizarse con la arquitectura de la aplicaci√≥n de la soluci√≥n Cloudian, encontrar√° su an√°lisis detallado en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo anterior</a> .  All√≠ discutimos en detalle el dispositivo interno de Cloudian, la tolerancia a fallas y la l√≥gica del SDS incorporado. <br><br><h2>  El esquema final del equipo f√≠sico. </h2><br>  Como m√°s adelante hablaremos de nuestro "tormento de elecci√≥n", dar√© inmediatamente la lista final de hierro a la que hemos llegado.  Peque√±o descargo de responsabilidad: la elecci√≥n del equipo de red se debi√≥ en gran medida a su presencia en nuestro (por cierto, muy s√≥lido) almac√©n. <br><br>  Entonces, a nivel f√≠sico del almacenamiento, tenemos el siguiente equipo: <br><table><tbody><tr><td>  <b>Nombre</b> <br></td><td>  <b>Funci√≥n</b> <br></td><td>  <b>Configuracion</b> <br></td><td>  <b>Cantidad</b> <br></td></tr><tr><td>  Servidor Lenovo System x3650 M5 <br></td><td>  Nodo de trabajo <br></td><td>  1x Xeon E5-2630v4 2.2GHz, <br>  4x 16GB DDR4, <br>  14x 10TB 7.2K 6Gbps SATA 3.5 ", <br>  2x SSD de 480 GB, <br>  Intel x520 Dual Port 10GbE SFP +, <br>  Fuente de alimentaci√≥n HS 2x750W <br></td><td>  4 4 <br></td></tr><tr><td>  Servidor HP ProLiant DL360 G9 <br></td><td>  Nodo equilibrador de carga <br></td><td>  2 E5-2620 v3, <br>  128G de RAM, <br>  2 SSD de 600 GB, <br>  4 discos duros SAS, <br>  Intel x520 Dual Port 10GbE SFP + <br></td><td>  2 <br></td></tr><tr><td>  Conmutador Cisco C4500 <br></td><td>  Puerta de enlace fronterizo <br></td><td>  Catalyst WS-C4500X-16SFP + <br></td><td>  2 <br></td></tr><tr><td>  Conmutador Cisco C3750 <br></td><td>  Extensor de puerto <br></td><td>  Catalizador WS-C3750X-24T con C3KX-NM-10G <br></td><td>  2 <br></td></tr><tr><td>  Conmutador Cisco C2960 <br></td><td>  plano de control <br></td><td>  Catalizador WS-C2960 + 48PST-L <br></td><td>  1 <br></td></tr></tbody></table><br>  Para una mejor comprensi√≥n de la arquitectura, analizaremos todos los elementos y hablaremos sobre sus caracter√≠sticas y tareas. <br><br>  Comencemos con los servidores.  Los servidores de Lenovo tienen una configuraci√≥n especial que se implementa de manera conjunta y en total conformidad con las recomendaciones y especificaciones de Cloudian.  Por ejemplo, usan un controlador con acceso directo al disco.  Como en nuestro caso RAID est√° organizado a nivel de software de aplicaci√≥n, este modo aumenta la confiabilidad y acelera el subsistema de disco.  Se pueden comprar exactamente los mismos servidores como un dispositivo Cloudian junto con todas las licencias. <br><br>  Los servidores de equilibrio de carga con Nginx para CentOS garantizan una distribuci√≥n uniforme de la carga en los nodos de trabajo y abstraen al usuario de la organizaci√≥n del tr√°fico interno.  Y como un bono agradable, si es necesario, puede organizar un cach√© en ellos. <br><br>  El par Cisco 4500X diecis√©is 10GB SFP + sirve como n√∫cleo y borde de nuestra peque√±a pero orgullosa red de almacenamiento.  Por supuesto, el hierro est√° un poco pasado de moda, pero no es inferior al "nuevo" en confiabilidad, tiene redundancia interna y su funcionalidad cumple con todos nuestros requisitos.  C3750 desempe√±a el papel de extensor de f√°brica, no hay necesidad de meter transceptores 1G en ranuras 10G.  Y cambiar completamente a enlaces de 10 GB tampoco tiene mucho sentido todav√≠a.  Como han demostrado las pruebas, nos encontramos con el procesador y los discos antes. <br><br>  El siguiente diagrama ilustra con suficiente detalle la organizaci√≥n f√≠sica descrita por m√≠: <br><br><img src="https://habrastorage.org/webt/jj/cs/mr/jjcsmrwqvzkqrder_z9zv3pr4ca.jpeg">  <i>1. Esquema de la organizaci√≥n de almacenamiento f√≠sico.</i> <br><br>  Veamos el esquema.  Como puede ver, la tolerancia a fallas a nivel f√≠sico se realiza duplicando y conectando cada uno de los dispositivos con al menos dos enlaces √≥pticos, uno para cada dispositivo en un par.  Esto nos da la garant√≠a de mantener la conectividad f√≠sica en el circuito durante un accidente de cualquier dispositivo de red o dos dispositivos de diferentes pares al mismo tiempo. <br><br>  Vamos debajo del esquema.  Ambos pares de Cisco (4500/4500, 3750/3750) se combinan en un solo dispositivo l√≥gico utilizando la pila y VSS.  La pila se ensambla con dos cables de pila, VSS a trav√©s de tres enlaces √≥pticos de 10G.  Esto le permite asegurarse de que ambos dispositivos en cada par interact√∫en como un todo.  Tal agrupaci√≥n nos permite trabajar dentro del marco de un segmento L2 transparente a trav√©s de ambos dispositivos de un par y hacer una agregaci√≥n general de enlaces usando LACP, ya que esta tecnolog√≠a es soportada de forma nativa tanto por el sistema operativo del servidor como por Cisco IOS.  Desde el lado del servidor, parece que funciona con un conmutador en lugar de dos, y encima de la aplicaci√≥n hay un canal agregado de doble capacidad. <br><br>  Todos los equipos de red cambian entre s√≠ y a los canales entrantes se realizan mediante enlaces √≥pticos de 10G, el equipo del servidor se conecta mediante cables Cisco 10G Twinax y 1G de cobre. <br><br>  BGP se usa para la tolerancia a fallas en el canal entrante, y Round Robin DNS se usa para equilibrar las direcciones IP externas.  Las direcciones externas en s√≠ est√°n estacionadas en servidores de equilibrio de carga y, si es necesario, migran entre nodos utilizando el paquete Pacemaker / Corosync. <br><br>  El monitoreo y control a trav√©s de IPMI se realiza a trav√©s de un enlace interno directo.  Todas las interfaces de administraci√≥n (tanto servidores como Cisco) est√°n conectadas a trav√©s de conmutadores de plano de control separados.  Ellos, a su vez, est√°n incluidos en la red de control del centro de datos.  Esto nos garantiza la imposibilidad de perder la comunicaci√≥n con el equipo durante el trabajo o como resultado de un accidente en una red externa.  Para el caso m√°s extremo, hay asistentes con KVM. <br><br><h2>  Red l√≥gica </h2><br>  Para comprender c√≥mo funciona la red l√≥gica S3 del almacenamiento DataLine, pasemos a otro esquema: <br><br><img src="https://habrastorage.org/webt/lp/zn/ub/lpznubpzqosgkhzts8tm7sp0ssi.png"><br>  <i>2. Diagrama de red l√≥gica de almacenamiento</i> <br><br>  Como puede ver, la l√≥gica de red consta de varios segmentos. <br><br>  Una red externa (Q) con una capacidad total de 20G est√° conectada directamente a Provider Edge.  Esto es seguido por el Cisco 4500 y los balanceadores. <br><br>  El siguiente bloque l√≥gico (X) es la VLAN entre los equilibradores y los nodos de trabajo.  Los equilibradores usan la misma conexi√≥n que para el tr√°fico entrante.  Los nodos de trabajo est√°n conectados a trav√©s de la pila 3750 con 4 enlaces 1G (dos por cada 3750).  Todos los enlaces f√≠sicos se ensamblan en uno solo l√≥gico usando LACP tambi√©n.  Esta red se usa solo para procesar el tr√°fico del cliente. <br><br>  Todas las conexiones dentro del cl√∫ster Cloudian (Y) pasan por un tercer segmento l√≥gico construido sobre 10G.  Dicha organizaci√≥n ayuda a evitar problemas en el canal externo debido al tr√°fico interno y viceversa.  Este es un segmento extremadamente cargado e importante para el funcionamiento del cl√∫ster.  Es a trav√©s de √©l que los datos y metadatos se replican, se utilizan en cualquier procedimiento de reequilibrio, etc., por lo tanto, distinguimos su "insumergibilidad" como una tarea separada. <br><br><h2>  Un poco de belleza </h2><br>  As√≠ es como se ve todo: <br><br><img src="https://habrastorage.org/webt/_m/_1/sd/_m_1sd2pvc2h5nbt2wco5bdkl4s.png"><br>  <i>3. Equipos de red y equilibradores integrales</i> <br><br><img src="https://habrastorage.org/webt/xo/q0/e4/xoq0e4outgmbcgswdzb4uzs4bsg.png"><br>  <i>4. Lo mismo, vista trasera</i> <br><br>  Presta atenci√≥n al cambio.  En art√≠culos anteriores, mis colegas escribieron sobre la importancia de los cables de marcado de color, pero no estar√° fuera de lugar tocar este tema aqu√≠. <br><br>  Utilizamos el cambio de color no solo para la red, sino tambi√©n para la alimentaci√≥n.  Esto permite a nuestros ingenieros navegar r√°pidamente en el rack y reduce la influencia del factor humano durante la conmutaci√≥n. <br><br><img src="https://habrastorage.org/webt/uu/8x/tw/uu8xtwvqpdcvw45xlugyfysq5is.png"><br>  <i>5. Nodos de trabajo</i> <br><br><img src="https://habrastorage.org/webt/wl/gn/5g/wlgn5gc7cttpbkra7cpmnza_pdo.png"><br>  <i>6. Vista trasera</i> <br><br>  En esta foto, puede ver claramente qu√© tan apretados est√°n los servidores de trabajo llenos de discos: pr√°cticamente no hay ranuras vac√≠as incluso en la parte posterior.  Por cierto, dicha organizaci√≥n de cables en paquetes compactos realiza no solo una funci√≥n est√©tica, sino que tambi√©n evita la superposici√≥n de los ventiladores de las fuentes de alimentaci√≥n, evitando que el hierro se sobrecaliente. <br><br><h3>  Lista blanca </h3><br>  En los comentarios sobre el √∫ltimo art√≠culo, promet√≠ hablar m√°s sobre el dispositivo de la lista blanca. <br><br>  Si por alg√∫n motivo acordamos con el cliente excluir de las cuentas todo el trabajo con el almacenamiento desde el interior del centro de datos o por canales directos a su equipo, entonces debemos organizar una conexi√≥n privada al almacenamiento. <br><br>  ¬øRecuerdas que en el primer diagrama hab√≠a una rama en DIST y Cloud?  Adem√°s del canal principal de Internet de 20 Gb, utilizamos un canal agregado para los conmutadores, al que conectamos a todos los clientes en el nivel del centro de datos.  Si el cliente quiere un enlace directo al almacenamiento, podemos configurar la VLAN desde el cliente a nuestro 4500X con la construcci√≥n de una ruta separada (o sin ella) e iniciar L3.  Despu√©s de eso, el enlace al plan de tarifas se configura en las direcciones del cliente que ya est√°n en Cloudian.  Entonces, para todos los que est√©n conectados a este plan de tarifas, no se considerar√° el uso de S3 de las direcciones de la lista blanca. <br><br><img src="https://habrastorage.org/webt/mr/nc/yd/mrncyda-0oquwo4kpos3snsyp2e.png"><br>  <i>7. Y aqu√≠ hay una interfaz especial en Cloudian.</i> <br><br>  Ahora no tenemos esa tarifa en la red, pero si realmente lo desea, podemos proporcionarla. <br><br><h2>  Historia de la construccion </h2><br>  Poco a poco nos acercamos a la parte m√°s interesante de la historia: la construcci√≥n de una instalaci√≥n de almacenamiento.  Habr√° muchas fotos, hasta tres intentos de organizar el equilibrio del tr√°fico y algunos malos consejos.  Espero que el an√°lisis de los problemas que encontramos en el camino sea √∫til para aquellos que se est√°n preparando para trabajar con velocidades de 10 Gb + en la web. <br><br><h3>  Experimentando con 10G </h3><br>  Antes de ir directamente a la esencia de esta secci√≥n, me permito hacer otro peque√±o descargo de responsabilidad. <br><br>  Seg√∫n una tradici√≥n establecida, antes de comprar nuevos equipos auxiliares, vamos al almac√©n y seleccionamos componentes m√°s o menos adecuados.  Esto le permite realizar pruebas r√°pidamente y decidir sobre una futura lista de compras.  Por supuesto, aunque no estamos logrando un resultado 100% confiable, no se gasta nada en lo productivo. <br><br>  As√≠ fue esta vez.  Y si Cisco no arroj√≥ ninguna sorpresa, entonces con la "avaricia" de los equilibradores de carga casi nos arruina. <br><br><h4>  La primera experiencia  Servidores Supermicro </h4><br>  Aqu√≠ nos decepcion√≥ el deseo de realizar una prueba r√°pida con un costo m√≠nimo.  En el almac√©n, encontramos servidores Supermicro que ten√≠an todo bien, excepto la falta de interfaces SFP.  Decidimos instalar nuestro querido Intel 520DA2 en ellos e inmediatamente enfrentamos el primer problema: las m√°quinas son de una sola unidad, pero no hay elevadores.  Al mismo tiempo, por alguna raz√≥n, nuestro cuerpo no estaba en listas de compatibilidad, pero hab√≠a muchos nativos. <br><br>  Siguiendo el consejo de la directora de desarrollo innovador, Misha Solovyov, conectamos todo con elevadores flexibles para granjas mineras.  El resultado fue tal "cad√°ver": <br><br><img src="https://habrastorage.org/webt/lf/wx/t6/lfwxt6csco5ndrm--6qzy4kqfhi.png"><br>  <i>8. Prototipo No. 1</i> <br><br>  Tuve que usar la famosa cinta el√©ctrica azul en algunos lugares, para que, Dios no lo quiera, haga algo corto.  S√≠, la granja colectiva.  S√≠, avergonzado  Pero tal "configuraci√≥n" es bastante aceptable para el per√≠odo del experimento. <br><br><img src="https://habrastorage.org/webt/sp/to/af/sptoaf-lv4w_imfhvnro9i12f1y.png"><br>  <i>9. Vista posterior</i> <br><br>  Lo que result√≥ de esto es claramente visible en la captura de pantalla del iperf: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/494/311/900/494311900ac9a09852f260ebbfb4e4b8.png"><br>  <i>10. En realidad esta no es una captura de pantalla :)</i> <br><br>  Las m√©tricas son muy interesantes, ¬øverdad?  Entonces est√°bamos tristes.  Al principio pensamos en chips esp√≠as, desarmamos y enderezamos todo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/082/bb2/6ac/082bb26ac22d6de01f22f464b778314b.png"><br>  <i>11. A primera vista, no hay chips esp√≠as aqu√≠</i> <br><br>  Recordaron el curso de la f√≠sica: interferencia electromagn√©tica, se√±ales de alta frecuencia, etc. ... Por supuesto, continuar el experimento con tal cantidad y calidad de la "granja colectiva" no ten√≠a sentido.  As√≠ que finalmente desarmamos el sistema y volvimos a colocar los servidores en su lugar. <br><br><h4>  La segunda experiencia.  Citrix Netscaler MPX8005 </h4><br>  En el proceso de devolver los servidores al lugar, encontramos nuevos h√©roes: Citrix Netscaler MPX8005.  Este es un hierro de marca maravilloso, adem√°s, casi nunca se usa.  Se ven as√≠: <br><br><img src="https://habrastorage.org/webt/dq/v1/va/dqv1vawcvfgpmmijwrie29ewkgy.png"><br>  <i>12. El portaobjetos en el estante no encajaba en longitud, pero decidimos posponerlo hasta m√°s tarde.</i> <br><br>  Equipo colocado en un rack, conmutado y configurado.  Estas son piezas de hierro realmente "excelentes" para adultos, 2 ranuras SFP para 10GB cada una, HA, algoritmos avanzados, incluso hay L7.  Es cierto, hasta 5 gigabits bajo licencia, pero a√∫n utilizamos L3, pero no existen tales l√≠mites. <br><br>  Dedos cruzados, prueba.  No hay velocidad  En las interfaces: errores s√≥lidos sobre transceptores inadecuados, velocidad de aproximadamente 5 gigabits, ca√≠das constantes.  Recordaron los risers flexibles, volvieron a estar tristes.  Incluso all√≠, la velocidad era m√°s alta y menos errores.  Comenzamos a entender: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">show</span></span> channel LA/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface LA/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">802.3</span></span>ad Link <span class="hljs-keyword"><span class="hljs-keyword">Aggregate</span></span>) #<span class="hljs-number"><span class="hljs-number">10</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x4100c020</span></span> &lt;ENABLED, UP, <span class="hljs-keyword"><span class="hljs-keyword">AGGREGATE</span></span>, UP, HAMON, HEARTBEAT, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, native vlan=<span class="hljs-number"><span class="hljs-number">1</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h03m23s  Requested: media <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, speed AUTO, duplex <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">160000</span></span>  Link Redundancy Throughput <span class="hljs-number"><span class="hljs-number">80000</span></span>  Actual: throughput <span class="hljs-number"><span class="hljs-number">20000</span></span>  LLDP Mode: <span class="hljs-keyword"><span class="hljs-keyword">NONE</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">9388</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">557582</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">1225</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10514</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">574232</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  bandwidthHigh: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec, bandwidthNormal: <span class="hljs-number"><span class="hljs-number">160000</span></span> Mbits/sec.  LA mode: AUTO &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">1</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m44s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8921</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">517626</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">585</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">9884</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">545408</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>. &gt; <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>)  Interface <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">10</span></span>G Ethernet, unsupported fiber SFP+, <span class="hljs-number"><span class="hljs-number">10</span></span> Gbit) #<span class="hljs-number"><span class="hljs-number">0</span></span>  flags=<span class="hljs-number"><span class="hljs-number">0x400c020</span></span> &lt;ENABLED, UP, BOUND <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> LA/<span class="hljs-number"><span class="hljs-number">1</span></span>, UP, autoneg, <span class="hljs-number"><span class="hljs-number">802.1</span></span>q&gt;  LACP &lt;Active, Long timeout, key <span class="hljs-number"><span class="hljs-number">1</span></span>, priority <span class="hljs-number"><span class="hljs-number">32768</span></span>&gt;  MTU=<span class="hljs-number"><span class="hljs-number">9000</span></span>, MAC=XXX, uptime <span class="hljs-number"><span class="hljs-number">0</span></span>h05m58s  Requested: media AUTO, speed AUTO, duplex AUTO, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>,        throughput <span class="hljs-number"><span class="hljs-number">0</span></span>  Actual: media FIBER, speed <span class="hljs-number"><span class="hljs-number">10000</span></span>, duplex <span class="hljs-keyword"><span class="hljs-keyword">FULL</span></span>, fctl <span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>, throughput <span class="hljs-number"><span class="hljs-number">10000</span></span>  LLDP Mode: TRANSCEIVER,    LR Priority: <span class="hljs-number"><span class="hljs-number">1024</span></span>  RX: Pkts(<span class="hljs-number"><span class="hljs-number">8944</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">530975</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">911</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  TX: Pkts(<span class="hljs-number"><span class="hljs-number">10819</span></span>) Bytes(<span class="hljs-number"><span class="hljs-number">785347</span></span>) Errs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Drops(<span class="hljs-number"><span class="hljs-number">3</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>)  NIC: InDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) OutDisc(<span class="hljs-number"><span class="hljs-number">0</span></span>) Fctls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Stalls(<span class="hljs-number"><span class="hljs-number">0</span></span>) Hangs(<span class="hljs-number"><span class="hljs-number">0</span></span>) Muted(<span class="hljs-number"><span class="hljs-number">0</span></span>)  Bandwidth thresholds are <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>.</code> </pre> <br><br>  Utilizamos transceptores Cisco nativos, con los cuales, en teor√≠a, no deber√≠an surgir problemas.  Incluso revisaron la √≥ptica y, por si acaso, cambiaron los transceptores, la misma imagen.  Nuestro coche no funciona, ¬°y eso es todo!  Lo miramos m√°s de cerca. <br><br>  Transceptores Cisco "hermosos": <br><br><pre> <code class="hljs vhdl">ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI-Express Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>xe000-<span class="hljs-number"><span class="hljs-number">0</span></span>xe01f mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf781ffff,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000-<span class="hljs-number"><span class="hljs-number">0</span></span>xf7843fff irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> pci1 ix1: ixgbe <span class="hljs-keyword"><span class="hljs-keyword">bus</span></span> speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> PCIe lane <span class="hljs-literal"><span class="hljs-literal">width</span></span> = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CISCO-AVAGO , part number XXX , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x00 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 *** Unsupported SFP+/SFP <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>!</code> </pre> <br><br>  ¬°Los transceptores no se detectan normalmente, sin soporte! <br><br>  Ten√≠a que encontrar la mayor√≠a de los "parientes": <br><br><img src="https://habrastorage.org/webt/wi/-i/sw/wi-iswj9672s8q0skvpw4s3s2xw.png"><br>  <i>13. Los transceptores m√°s nativos del salvaje oeste</i> <br><br><pre> <code class="hljs powershell">ix0: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe020<span class="hljs-literal"><span class="hljs-literal">-0xe03f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7820000<span class="hljs-literal"><span class="hljs-literal">-0xf783ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7844000<span class="hljs-literal"><span class="hljs-literal">-0xf7847fff</span></span> irq <span class="hljs-number"><span class="hljs-number">16</span></span> at device <span class="hljs-number"><span class="hljs-number">0.0</span></span> on pci1 platform: Manufacturer Citrix Inc. platform: NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> <span class="hljs-number"><span class="hljs-number">675320</span></span> (<span class="hljs-number"><span class="hljs-number">28</span></span>), manufactured at <span class="hljs-number"><span class="hljs-number">8</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2015</span></span> platform: serial <span class="hljs-number"><span class="hljs-number">4</span></span>NP602H7H0 platform: sysid <span class="hljs-number"><span class="hljs-number">675320</span></span> - NSMPX<span class="hljs-literal"><span class="hljs-literal">-8000</span></span><span class="hljs-literal"><span class="hljs-literal">-10G</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>*CPU+<span class="hljs-number"><span class="hljs-number">6</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">2</span></span>*IX+<span class="hljs-number"><span class="hljs-number">1</span></span>*E1K+<span class="hljs-number"><span class="hljs-number">4</span></span>*CVM <span class="hljs-number"><span class="hljs-number">1620</span></span> ix0: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX   , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00 ix0: [<span class="hljs-type"><span class="hljs-type">ITHREAD</span></span>] <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">2</span></span>: Ethernet address: <span class="hljs-number"><span class="hljs-number">00</span></span>:e0:ed:<span class="hljs-number"><span class="hljs-number">45</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:f8 ix1: &lt;Intel(R) PRO/<span class="hljs-number"><span class="hljs-number">10</span></span>GbE PCI<span class="hljs-literal"><span class="hljs-literal">-Express</span></span> Network Driver, Version - <span class="hljs-number"><span class="hljs-number">2.7</span></span>.<span class="hljs-number"><span class="hljs-number">4</span></span>&gt; port <span class="hljs-number"><span class="hljs-number">0</span></span>xe000<span class="hljs-literal"><span class="hljs-literal">-0xe01f</span></span> mem <span class="hljs-number"><span class="hljs-number">0</span></span>xf7800000<span class="hljs-literal"><span class="hljs-literal">-0xf781ffff</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>xf7840000<span class="hljs-literal"><span class="hljs-literal">-0xf7843fff</span></span> irq <span class="hljs-number"><span class="hljs-number">17</span></span> at device <span class="hljs-number"><span class="hljs-number">0.1</span></span> on pci1 ix1: ixgbe bus speed = <span class="hljs-number"><span class="hljs-number">5.0</span></span>Gbps and PCIe lane width = <span class="hljs-number"><span class="hljs-number">8</span></span> SFP+/SFP, vendor CITRIX           , part number XXX  , <span class="hljs-number"><span class="hljs-number">10</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x10 <span class="hljs-number"><span class="hljs-number">1</span></span>G <span class="hljs-number"><span class="hljs-number">0</span></span>x01 CT <span class="hljs-number"><span class="hljs-number">0</span></span>x00</code> </pre> <br><br>  Estos transceptores se determinaron sin ning√∫n problema, pero esto no salv√≥ la situaci√≥n.  Firmware actualizado: lo mismo.  El soporte de Citrix decidi√≥ guardar silencio con tacto (no, no por el pedigr√≠ del transceptor). <br><br>  Respiramos profundamente y nos enterramos en las especificaciones de hardware.  Result√≥ que la respuesta todo este tiempo estuvo ante nuestros ojos: <i><b>velocidad del bus ixgbe = 5.0Gbps y ancho de carril PCIe = 8.</b></i> Este es un problema con la tarjeta.  Ella misma carece de velocidad PCIe.  Nuestro Citrix tiene el m√°ximo rendimiento de la ranura PCI-e para una tarjeta con transceptores de <i><b>5.0 Gbps,</b></i> que nos grit√≥ todo este tiempo.  Al igual que Citrix en MPX8015 (¬°es exactamente lo mismo en hardware!) Quer√≠an entregar 15 gigabits, no est√° claro.  Pero entendimos por qu√© esos equilibradores "geniales" todo este tiempo yac√≠an en un almac√©n.  No pueden funcionar correctamente con enlaces 10G en principio. <br><br><h4>  La ultima experiencia.  Usamos el hierro correcto y lo hacemos hermoso </h4><br>  Aqu√≠, nuestra paciencia termin√≥ con nuestra fe en la humanidad, y tuvimos que usar la tecnolog√≠a "de repuesto" para obtener el hardware normal en forma de HP ProLiant DL360 G9 de las fotos de arriba.  No comenzaron a organizar sorpresas para nosotros, descargan 10G y no se quejan.  :) <br><br><h2>  Prueba de carga </h2><br>  Como no aceptamos el enfoque de hujak-hujak-y-producci√≥n, y sabemos por experiencia que un sistema no probado despu√©s del ensamblaje con una garant√≠a de casi el 100% ser√° inoperable, decidimos realizar pruebas de carga.  Adem√°s, con su ayuda, puede hacer algunos ajustes para el futuro. <br><br>  Para generar la carga, se eligi√≥ la herramienta habitual: Apache Jmetr.  Solo es bastante bueno, ya que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escrib√≠ un</a> par de art√≠culos, y esta es una de las soluciones m√°s flexibles del mercado, a pesar de que a Java le encanta comer.  Para trabajar con S3, utilizamos un m√≥dulo autoescrito con AWS SDK, tambi√©n en Java.  En las pruebas, pudimos alcanzar una velocidad de 12.5 Gbps para la escritura de archivos de m√°s de 250 megabytes con carga paralela por fragmentos de 5 megabytes, y para archivos de menos de 5 megabytes, procesando alrededor de 3000 solicitudes HTTP por segundo.  Al ejecutar ambas pruebas en paralelo, result√≥ aproximadamente 11 Gigabits y 2200 solicitudes por segundo.  Al mismo tiempo, existe la posibilidad de mejorar el trabajo con una carga mixta y con objetos peque√±os.  Nos "enterramos" en la CPU, y el segundo z√≥calo est√° libre.  En el generador de carga, se tomaron archivos de prueba de la RAM para excluir la influencia en los resultados del subsistema de disco del generador mismo.  Para las pruebas, recordando el amor de Java por la RAM y la necesidad de trabajar con una gran cantidad de subprocesos durante la carga paralela, utilizamos el servidor HP DL980 g7 como generador.  Este es un servidor de ocho unidades con 8 procesadores Intel E7-4870 y 512 Gb de RAM a bordo. <br><br>  Dentro del equipo, el apodo cari√±oso Behemoth se le peg√≥. <br><br><img src="https://habrastorage.org/webt/yl/ef/wb/ylefwbgvc4ypecxwot1jtcr7yrc.png"><br>  <i>14. Nuestro hipop√≥tamo.</i>  <i>Es cierto, algo similar?</i> <br><br><img src="https://habrastorage.org/webt/b8/ql/an/b8qlan70ud31dkucw7dt252sbxi.png"><br>  <i>15. Vista trasera.</i>  <i>Los cables de miedo en el centro inferior son una conexi√≥n cruzada del bus de puente interno</i> <br><br><img src="https://habrastorage.org/webt/6c/xe/ni/6cxeniwbbzfcuh7e06brn-ko7pe.png"><br>  <i>16. Este es uno de los dos objetivos del servidor.</i>  <i>Cada uno tiene 4 procesadores y 16 ranuras de 16 gigabytes de RAM</i> <br><br><img src="https://habrastorage.org/webt/wx/vt/p9/wxvtp91ap3cdeu0y0kmn9komqwo.png"><br>  <i>17. Para usar Htop c√≥modamente en la consola de dicho servidor, necesitas un monitor grande :)</i> <br><br>  En la pr√°ctica, una prueba mixta ha cargado notablemente incluso un servidor tan poderoso. <br>  Para llegar a los resultados de rendimiento obtenidos, tuvimos que transferir la red interna del cl√∫ster a marcos jumbo de 9k y ajustar ligeramente la pila de red de equilibradores y nodos de trabajo (usamos CentOS Linux), as√≠ como optimizar una serie de otros par√°metros del n√∫cleo en los nodos de trabajo: <br><br><pre> <code class="hljs dos">cat /etc/sysctl.conf ‚Ä¶ kernel.printk = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> read_ahead_kb = <span class="hljs-number"><span class="hljs-number">1024</span></span> write_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> read_expire = <span class="hljs-number"><span class="hljs-number">250</span></span> fifo_batch = <span class="hljs-number"><span class="hljs-number">128</span></span> front_merges = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max = <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.somaxconn = <span class="hljs-number"><span class="hljs-number">5120</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.netdev_max_backlog = <span class="hljs-number"><span class="hljs-number">50000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_tw_reuse = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_rmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">87380</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_wmem = <span class="hljs-number"><span class="hljs-number">4096</span></span> <span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_slow_start_after_idle = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_syn_backlog = <span class="hljs-number"><span class="hljs-number">30000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_max_tw_buckets = <span class="hljs-number"><span class="hljs-number">2000000</span></span> <span class="hljs-built_in"><span class="hljs-built_in">fs</span></span>.file-max = <span class="hljs-number"><span class="hljs-number">196608</span></span> vm.overcommit_memory = <span class="hljs-number"><span class="hljs-number">1</span></span> vm.overcommit_ratio = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.max_map_count = <span class="hljs-number"><span class="hljs-number">65536</span></span> vm.dirty_ratio = <span class="hljs-number"><span class="hljs-number">40</span></span> vm.dirty_background_ratio = <span class="hljs-number"><span class="hljs-number">5</span></span> vm.dirty_expire_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> vm.dirty_writeback_centisecs = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_fin_timeout=<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.tcp_congestion_control=htcp <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.netfilter.ip_conntrack_max=<span class="hljs-number"><span class="hljs-number">1048576</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_default=<span class="hljs-number"><span class="hljs-number">65536</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.rmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.core.wmem_max=<span class="hljs-number"><span class="hljs-number">16777216</span></span> <span class="hljs-built_in"><span class="hljs-built_in">net</span></span>.ipv4.ip_local_port_range=<span class="hljs-number"><span class="hljs-number">1024</span></span> <span class="hljs-number"><span class="hljs-number">65535</span></span></code> </pre> <br><br>  Las configuraciones principales que se sometieron a ajustes son el tama√±o de los b√∫feres, el n√∫mero de conexiones de red, el n√∫mero de conexiones al puerto y las conexiones monitoreadas por firewalls, as√≠ como los tiempos de espera. <br><br>  <b>Cisco C3750 + LACP = dolor</b> <br>  Otro escollo en el rendimiento de la red es el equilibrio de carga cuando se usa LACP / LAGp.  Desafortunadamente, el Cisco 3750s no puede equilibrar la carga a trav√©s de los puertos, solo en las direcciones de origen y destino.  Para lograr el equilibrio de tr√°fico correcto, tuve que colgar 12 direcciones IP en las interfaces de enlace de los nodos de trabajo, "mirando" hacia los clientes.  Condicionalmente, 3 por cada enlace f√≠sico.  Con esta configuraci√≥n, fue posible prescindir de LACP en las interfaces "externas" de los nodos de trabajo, ya que todas las direcciones se especifican en la configuraci√≥n de Nginx, pero si el enlace se perdiera, reducir√≠amos autom√°ticamente el peso del nodo en el equilibrio.  Con el "volcado", el enlace LACP le permite mantener la accesibilidad total a todas las direcciones. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2390824140</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">frame</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packets</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:947068357</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">errors</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">dropped</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">overruns</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">carrier</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">collisions</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">txqueuelen</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">RX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:18794424755066</span></span> (17<span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">TiB</span></span>)  <span class="hljs-selector-tag"><span class="hljs-selector-tag">TX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bytes</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:246433289523</span></span> (229<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">GiB</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XXMask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bond0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:10</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Link</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">encap</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Ethernet</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">HWaddr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">XXX</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">inet</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">addr</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">Bcast</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:192.168.XX</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Mask</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:255.255.255.0</span></span>       <span class="hljs-selector-tag"><span class="hljs-selector-tag">UP</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">BROADCAST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">RUNNING</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MULTICAST</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">MTU</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:9000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Metric</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1</span></span></code> </pre> <br><br><br><h2>  Prueba funcional </h2><br>  Despu√©s de terminar el trabajo en el repositorio, nos reunimos con el servicio flexify.io.  Ayudan a facilitar la migraci√≥n entre diferentes almacenes de objetos.  Pero para convertirse en un socio de Flexify, debe pasar pruebas serias.  "¬øPor qu√© no?"  - pensamos  Las pruebas de terceros siempre son una experiencia gratificante. <br><br>  La tarea principal de las pruebas es verificar el funcionamiento de los m√©todos del protocolo S3 a trav√©s de sus servidores proxy en relaci√≥n con varias configuraciones, entre las cuales puede haber cualquier conjunto de cubos compatibles con S3 admitidos por el proveedor de servicios. <br><br>  En primer lugar, se verifican los m√©todos que funcionan con objetos en el dep√≥sito.  Nuestro almacenamiento se prob√≥ utilizando una amplia gama de datos de prueba, el comportamiento de los m√©todos se prob√≥ para objetos de varios tama√±os y contenidos, para claves que contienen todo tipo de combinaciones de caracteres Unicode. <br><br>  En pruebas negativas, intentaron transferir datos no v√°lidos siempre que fue posible.  Se prest√≥ especial atenci√≥n a la seguridad de los datos en el proceso. <br><br>  Los m√©todos que trabajan con cubos tambi√©n se han probado, pero principalmente en escenarios positivos.  El objetivo de estas pruebas fue verificar que el uso de m√©todos a trav√©s de un proxy no conlleve ning√∫n problema grave, por ejemplo, corrupci√≥n de datos o fallas. <br><br>  La amplitud de la cobertura se puede juzgar por las pruebas que se utilizaron tanto a trav√©s de proxies como directamente.  La mayor√≠a de las pruebas, especialmente aquellas que trabajan con objetos, est√°n parametrizadas y prueban una gran cantidad de diferentes objetos, rangos, etc. <br><br><div class="spoiler">  <b class="spoiler_title">Pruebas implementadas para objetos</b> <div class="spoiler_text">  <i>OBTENER solicitud de objeto sin par√°metros opcionales</i> <i><br></i>  <i>OBTENER solicitud de objeto multiproceso</i> <i><br></i>  <i>GET Solicitud de objeto a un objeto cifrado con los par√°metros sse proporcionados</i> <i><br></i>  <i>GET Solicitud de objeto a un objeto cifrado sin par√°metros sse proporcionados</i> <i><br></i>  <i>GET Solicitud de objeto con rango que intersecta el rango de bytes del archivo</i> <i><br></i>  <i>GET Solicitud de objeto con rango fuera del rango del rango de bytes del archivo</i> <i><br></i>  <i>GET Solicitud de objeto con un par√°metro de rango de sufijo</i> <i><br></i>  <i>GET Solicitud de objeto con un par√°metro de rango de sufijo fuera del rango del rango de bytes del archivo</i> <i><br></i>  <i>Solicitud de objeto GET con par√°metro de rango no v√°lido</i> <i><br></i>  <i>Solicitud de objeto principal a un objeto existente</i> <i><br></i>  <i>Solicitud de objeto principal a un objeto eliminado recientemente</i> <i><br></i>  <i>Solicitud de objeto principal con una clave que nunca existi√≥ en un cubo</i> <i><br></i>  <i>Solicitud de objeto principal a un objeto cifrado con par√°metros sse proporcionados</i> <i><br></i>  <i>Solicitud de objeto principal a un objeto cifrado sin par√°metros sse proporcionados</i> <i><br></i>  <i>Solicitud de lista de objetos</i> <i><br></i>  <i>Solicitud de lista de objetos v2</i> <i><br></i>  <i>Solicitud de lista de objetos con el par√°metro marcador proporcionado</i> <i><br></i>  <i>Solicitud de lista de objetos con el par√°metro de prefijo proporcionado</i> <i><br></i>  <i>Solicitud de lista de objetos con los par√°metros de marcador y prefijo proporcionados</i> <i><br></i>  <i>Reciba todos los objetos en el punto final con List Objects con los par√°metros Marker y Prefix proporcionados</i> <i><br></i>  <i>Solicitud de lista de objetos con par√°metro delimitador omitido</i> <i><br></i>  <i>Solicitud de lista de objetos con el par√°metro Marker pasado, pero con el par√°metro Delimitador omitido</i> <i><br></i>  <i>Solicitud de lista de objetos con prefijo no existente pasado</i> <i><br></i>  <i>Solicitud de lista de objetos con marcador no existente pasado</i> <i><br></i>  <i>Carga multiparte con m√©todo nativo upload_file ()</i> <i><br></i>  <i>Carga multiparte con m√©todo nativo upload_fileobj ()</i> <i><br></i>  <i>Carga multiparte con m√©todo personalizado</i> <i><br></i>  <i>Detener la carga multiparte con el m√©todo abort_multipart_upload ()</i> <i><br></i>  <i>Realizar el m√©todo abort_multipart_upload () con uploadId incorrecto</i> <i><br></i>  <i>Realizar el m√©todo abort_multipart_upload () con una clave incorrecta y uploadId</i> <i><br></i>  <i>Carga multiparte de 2 archivos con una misma clave simult√°neamente.</i>  <i>2do archivo cargado antes del 1er</i> <i><br></i>  <i>Carga multiparte de 2 archivos con una misma clave simult√°neamente.</i>  <i>1er archivo cargado antes del 2do</i> <i><br></i>  <i>Carga multiparte de 2 archivos con diferentes claves simult√°neamente.</i>  <i>1er archivo cargado antes del 2do</i> <i><br></i>  <i>Carga multiparte con un tama√±o de parte de 512kb</i> <i><br></i>  <i>Carga multiparte con un tama√±o de pieza mayor que el tama√±o m√°ximo permitido</i> <i><br></i>  <i>Carga multiparte de un archivo con partes de diferente tama√±o</i> <i><br></i>  <i>Lista de solicitud de carga de varias partes</i> <i><br></i>  <i>PONER la solicitud de ACL de objeto a un objeto con el ID del concesionario proporcionado</i> <i><br></i>  <i>GET Object ACL request a un objeto con permisos de acceso adicionales otorgados</i> <i><br></i>  <i>M√©todo de etiquetado de objetos PUT</i> <i><br></i>  <i>OBTENER m√©todo de etiquetado de objetos</i> <i><br></i>  <i>M√©todo DELETE Object Tagging</i> <i><br></i>  <i>PUT Solicitud de objeto sin par√°metros opcionales</i> <i><br></i>  <i>PUT Object solicita multithread</i> <i><br></i>  <i>PUT Solicitudes de objetos con par√°metros de cifrado opcionales pasados</i> <i><br></i>  <i>PUT Solicitudes de objetos con el par√°metro Body vac√≠o pasado</i> <i><br></i>  <i>OBTENER objetos con el m√©todo nativo download_file ()</i> <i><br></i>  <i>OBTENER objetos con el m√©todo nativo download_fileobj ()</i> <i><br></i>  <i>OBTENER objetos con m√©todo personalizado usando rangos</i> <i><br></i>  <i>OBTENER objeto con prefijo con m√©todo nativo download_file ()</i> <i><br></i>  <i>OBTENER objetos con prefijo con m√©todo nativo download_fileobj ()</i> <i><br></i>  <i>OBTENER objetos con prefijo con m√©todo personalizado usando rangos</i> <i><br></i>  <i>DELETE Solicitud de objeto a un objeto existente</i> <i><br></i>  <i>DELETE Solicitud de objeto a un objeto no existente</i> <i><br></i>  <i>SUPRIMIR Solicitud de objetos a un grupo con objetos existentes</i> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Pruebas realizadas para cubo</b> <div class="spoiler_text">  <i>Poner cifrado de cubeta</i> <i><br></i>  <i>OBTENER Cifrado de cubeta</i> <i><br></i>  <i>BORRAR Cifrado de cubeta</i> <i><br></i>  <i>Solicitud de pol√≠tica de dep√≥sito PUT</i> <i><br></i>  <i>OBTENER la solicitud de la pol√≠tica de dep√≥sito a un dep√≥sito con la pol√≠tica</i> <i><br></i>  <i>ELIMINAR la solicitud de la Pol√≠tica de dep√≥sito a un dep√≥sito con Pol√≠tica</i> <i><br></i>  <i>OBTENER la solicitud de la pol√≠tica de dep√≥sito a un dep√≥sito sin pol√≠tica</i> <i><br></i>  <i>ELIMINAR la solicitud de la pol√≠tica de dep√≥sito a un dep√≥sito sin pol√≠tica</i> <i><br></i>  <i>Poner etiquetado de cubeta</i> <i><br></i>  <i>Obtener etiquetado de cubeta</i> <i><br></i>  <i>BORRAR etiquetado de cubeta</i> <i><br></i>  <i>Crear solicitud de dep√≥sito con el nombre del dep√≥sito existente</i> <i><br></i>  <i>Crear solicitud de dep√≥sito con un nombre de dep√≥sito √∫nico</i> <i><br></i>  <i>Eliminar solicitud de dep√≥sito con nombre de dep√≥sito existente</i> <i><br></i>  <i>Eliminar solicitud de dep√≥sito con un nombre de dep√≥sito √∫nico</i> <i><br></i>  <i>PONER la solicitud de ACL del dep√≥sito a un dep√≥sito con el ID del concesionario proporcionado</i> <i><br></i>  <i>GET Object ACL request a un objeto con permisos de acceso adicionales otorgados</i> <br></div></div><br><br>  Como puede suponer, esta es una prueba bastante dif√≠cil, pero generalmente la pasamos positivamente.  Surgieron algunos problemas debido a la falta de soporte para SSE y peque√±as escuelas con soporte Unicode en ese momento: <br><br>  Error al cargar con claves que contienen: <br><br><ul><li>  U + 0000-U + 001F: los primeros 32 caracteres de control ilegibles.  En Amazon, por ejemplo, solo el primer U + 0000 no se vierte directamente. <br></li></ul><br><ul><li>  Y tambi√©n U + 18D7C, U + 18DA8, U + 18DB4, U + 18DBA, U + 18DC4, U + 18DCE.  Estos tambi√©n son caracteres ilegibles, pero Amazon los acepta como claves.  No hubo problemas con todos los dem√°s personajes. <br></li></ul><br>  Al leer el contenido del dep√≥sito, hay un problema en la tecla 66,675, que contiene el s√≠mbolo U + FFFE.  No es posible obtener una lista completa de claves en un dep√≥sito que contiene un objeto con dicha clave. <br><br>  De lo contrario, las pruebas fueron exitosas, y a fines de septiembre aparecimos en la lista de proveedores disponibles. <br><br><h2>  Un breve ep√≠logo y bonificaci√≥n para los lectores. </h2><br>  Anteriormente, escrib√≠ que Cloudian HyperStore, a pesar de sus muchas ventajas, pr√°cticamente no est√° cubierto en el segmento de Internet de habla rusa. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El primer art√≠culo</a> fue sobre los conceptos b√°sicos de trabajar con Cloudian.  Desmontamos su estructura interna, matices arquitect√≥nicos y leemos la traducci√≥n de la documentaci√≥n oficial. <br><br>  Hoy les cont√© c√≥mo construimos nuestro propio almacenamiento y qu√© matices y dificultades encontramos. <br><br>  Aquellos de ustedes que quieran sentir con bol√≠grafos de lo que estamos hablando 2 art√≠culos seguidos pueden usar el formulario de comentarios <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en esta p√°gina</a> y descubrir personalmente qu√© es la sal.  Como est√°ndar, le damos 15Gb durante 2 semanas gratis, por supuesto, con acceso de usuario.  Si desea compartir sus impresiones de trabajar con el repositorio, escr√≠bame en PM.  :) <br><br>  Y para aquellos que no son suficientes 15 Gb durante 2 semanas, ¬°tenemos una <b>peque√±a b√∫squeda!</b>  En las fotograf√≠as del art√≠culo, colocamos tres hipop√≥tamos.  Las primeras 50 personas que las encuentren recibir√°n 30 Gb durante 4 semanas.  Para obtener una prueba ampliada, escriba en los comentarios los n√∫meros de las im√°genes donde se escondieron los hipop√≥tamos y solicite el enlace de arriba.  No olvide incluir un enlace a su comentario en la aplicaci√≥n. <br><br>  Por tradici√≥n, si tiene alguna pregunta, h√°gala en los comentarios. <br>  Estar√© encantado de responderlas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es425973/">https://habr.com/ru/post/es425973/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es425963/index.html">Estaci√≥n meteorol√≥gica en Arduino de la A a la Z. Parte 4</a></li>
<li><a href="../es425965/index.html">SAP Data Management Suite como un complejo para trabajar con Big Data en empresas</a></li>
<li><a href="../es425967/index.html">Motosierra Masacre de silicio</a></li>
<li><a href="../es425969/index.html">¬øC√≥mo me convertir√© en desarrollador web ... y lo har√©?</a></li>
<li><a href="../es425971/index.html">Hay evidencia de la presencia de chips esp√≠as en servidores Supermicro</a></li>
<li><a href="../es425975/index.html">Convierte palabras y frases a anagramas</a></li>
<li><a href="../es425977/index.html">Flexbox: ¬øqu√© tama√±o tiene esta caja flexible?</a></li>
<li><a href="../es425981/index.html">Newbie‚Äôs Career at LK: pasos agigantados para avanzar lentamente</a></li>
<li><a href="../es425983/index.html">Seguridad de vuelo</a></li>
<li><a href="../es425985/index.html">Ejecuci√≥n de c√≥digo personalizado en GO</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>