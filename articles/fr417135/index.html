<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüéì üö† üßïüèæ Unity3D: comment conna√Ætre le degr√© d'√©clairage d'un point dans une sc√®ne? üåå ü§∑üèº ü§µüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Salutations! 

 Je sais, et au fond, vous savez ce qui manque √† vos jeux de cartes ou aux jeux trois en un. Syst√®mes furtifs! 

 Et bien s√ªr, tout sys...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Unity3D: comment conna√Ætre le degr√© d'√©clairage d'un point dans une sc√®ne?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417135/">  Salutations! <br><br>  Je sais, et au fond, vous savez ce qui manque √† vos jeux de cartes ou aux jeux trois en un.  Syst√®mes furtifs! <br><br>  Et bien s√ªr, tout syst√®me de furtivit√© qui se respecte devrait pouvoir prendre en compte l'illumination de l'environnement autour du joueur.  J'ai √©t√© √©tonn√© de d√©couvrir le sujet et de trouver une quantit√© anormalement petite d'informations.  Par cons√©quent, je m'empresse de partager les fruits. <br><br>  Aujourd'hui, nous ne d√©velopperons pas un syst√®me de furtivit√© √† part enti√®re pour le joueur, nous consid√©rerons uniquement des interactions avec l'√©clairage. <br><a name="habracut"></a><br><h3>  M√©thode 1: collisionneurs </h3><br>  Un moyen simple et peu gourmand en ressources. <br><br>  Nous ajoutons un collisionneur sph√©rique √† chaque source de lumi√®re.  Nous en faisons un d√©clencheur.  Nous fixons les dimensions approximativement √©gales au rayon de lumi√®re. <br><br>  Le reste est aussi clair qu'une ombre.  Nous √©crivons un script simple, o√π dans OnTriggerEnter () nous pla√ßons l'activation du calcul de la lumi√®re (pour que les sources de lumi√®re ne fonctionnent pas "inactives" lorsque le joueur n'est pas √† proximit√©). <br><br>  Le calcul d'√©clairage lui-m√™me sera situ√© dans Update ().  En substance, c'est la physique habituelle.Raycast ().  S'il frappe le joueur, le joueur est dans la zone claire.  S'il ne tombe pas, cela signifie que le joueur est derri√®re des obstacles et donc √† l'ombre. <br><br>  Vous pouvez √©galement ajouter ici le calcul de la distance entre le lecteur et la source lumineuse.  Ainsi, pour d√©terminer l'illumination, nous utiliserons un flotteur simple, qui variera en fonction de la distance aux sources lumineuses.  Et vous pouvez l'utiliser partout o√π votre c≈ìur le d√©sire. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/c9/nu/43/c9nu43wv6trcy2hg28eijiq4j_o.png"><br>  <i>Au point 1, l'√©clairage est proche du maximum.</i>  <i>Au point 2, l'√©clairage est minimal - il y a un obstacle entre la lumi√®re et le point.</i>  <i>Au point 3, l'√©clairage est moyen.</i> <br></div></div><br>  Et ce n‚Äôest pas tout!  Vous pouvez ajouter des collisionneurs d√©clencheurs √† diverses ¬´zones d'ombre¬ª o√π le joueur doit se cacher.  Dans les meilleures traditions de Manhunt.  De m√™me, vous pouvez marquer les zones lumineuses avec le collisionneur, simulant, par exemple, la lumi√®re d'un projecteur. <br><br><h4>  Avantages: </h4><br><ul><li>  Lumi√®res ponctuelles faciles √† personnaliser. </li><li>  Assez √©conomique en termes de ressources, si vous ne spammez pas les sources de lumi√®re. </li></ul><br><h4>  Inconv√©nients: </h4><br><ul><li>  La lumi√®re Spot et la lumi√®re directionnelle sont fortement accord√©es.  Si pour le premier il suffit de positionner le collisionneur dans le champ de lumi√®re (pour augmenter la visibilit√© du joueur √† l'entr√©e), alors le second est une v√©ritable horreur.  Vous devez soit placer des collisionneurs √† chaque ombre (pour r√©duire la visibilit√© du joueur √† l'entr√©e), soit v√©rifier constamment avec Physics.Raycast () entre le joueur et le ¬´soleil¬ª - il est situ√© sous les rayons ou dans l'ombre. </li><li>  Un grand nombre de collisionneurs encombrent la sc√®ne, compliquant la physique. </li><li>  Des pr√©cautions doivent √™tre prises avec les sources de lumi√®re qui se croisent. </li><li>  La lumi√®re dynamique (en mouvement ou en variation d'intensit√©) doit √™tre ajout√©e s√©par√©ment via des scripts. </li></ul><br><h3>  M√©thode 2: RenderTexture </h3><br>  Que faisons-nous ici?  En fait, nous obtenons une ¬´capture d'√©cran¬ª de la cam√©ra, et pas n√©cessairement de la cam√©ra principale.  Et puis nous analysons la couleur de la capture d'√©cran pour savoir comment la lumi√®re brillante tombe sur le sujet. <br><br>  Pour commencer, nous avons besoin d'un objet √† partir duquel nous "lirons" la lumi√®re.  Cr√©ez une sph√®re ou un plan r√©gulier, faites-le petit (√©chelle de 0,1), placez-le pr√®s du sol, rendez-le blanc, retirez le collisionneur: <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/hb/ri/7o/hbri7op9p5lyq091ia1ozgeiasc.png"><br></div></div><br>  Ajoutez une cam√©ra (assurez-vous de supprimer l'√©couteur audio et v√©rifiez que la balise MainCamera n'en vaut pas la peine).  Liez-le √† notre objet.  On le met un peu plus haut, on le dirige vers le bas.  Nous exposons dans les param√®tres pas l'affichage principal.  Le faire orthographique est √† votre go√ªt. <br><br>  Au final, nous le positionnons pour qu'il regarde notre objet et seulement lui. <br><br><div class="spoiler">  <b class="spoiler_title">Texte masqu√©</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/uv/de/3y/uvde3ygsuysuvuysojxbsvmbml8.png"><br></div></div><br>  Au final, configurez le masque Culling des cam√©ras primaire et secondaire pour que le primaire n'affiche pas nos objets ¬´l√©gers¬ª, tandis que les secondaires ne les voient que, sans encombrer autre chose. <br><br>  Et ici, le plaisir commence.  Nous attachons le script √† la cam√©ra: <br><br><pre><code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Camera</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">cam</span></span>; //   <span class="hljs-selector-tag"><span class="hljs-selector-tag">RenderTexture</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">Texture2D</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">tex</span></span>; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Start</span></span> () { //    "". // ,       -   . // Depth   0   -   . tex = new RenderTexture (1, 1, 8); // RenderTexture "" , //   ,    . _tex = new Texture2D (1, 1, TextureFormat.RGB24, false); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Update</span></span> () { //   ""  cam.targetTexture = tex; cam.Render (); //     RenderTexture.active = tex; //   Texture2D _tex.ReadPixels (new Rect (0, 0, 1, 1), 0, 0); _tex.Apply (); Color col = _tex.GetPixel (0, 0); float vis = (col.r + col.g + col.b) / 3; }</code> </pre> <br>  En sortie, nous obtenons un flotteur vis, qui, par essence, est une repr√©sentation num√©rique du niveau d'√©clairage incident sur notre objet.  Si la source est proche - l'objet est blanc - vis est 1. S'il est sombre - l'objet est noir - vis est ~ 0. <br><br>  Nous n'avons pas besoin d'effectuer l'op√©ration ci-dessus √† chaque image, nous incorporons donc une petite seconde minuterie: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">float</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">interval</span></span> = 0; <span class="hljs-selector-tag"><span class="hljs-selector-tag">void</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Update</span></span> () { interval += Time.deltaTime; if (interval &lt; 1) return; interval = 0; //   }</code> </pre> <br>  Ensuite, nous lions l'ensemble de notre syst√®me au joueur afin qu'il bouge avec lui.  Et notre variable vis renvoie automatiquement la lumi√®re autour du lecteur! <br><br>  Ce syst√®me peut √™tre utilis√© non seulement conjointement avec le lecteur.  Vous pouvez le placer n'importe o√π et comme vous le souhaitez, cr√©ant une sorte de capteurs de lumi√®re.  En r√®gle g√©n√©rale, il existe des moyens plus efficaces de les mettre en ≈ìuvre, mais est-il toujours agr√©able d'avoir des alternatives? <br><br>  Les avantages sont √©vidents, parlons des inconv√©nients. <br><br><h4>  Inconv√©nients </h4><br><ul><li>  Chaque ¬´d√©tecteur de lumi√®re¬ª (s'il y en a plusieurs) n√©cessite une cam√©ra distincte. </li><li>  Texture2D.ReadPixels () - enfin, extr√™mement lent.  M√™me si vous le faites une fois par seconde, et pas √† chaque image, m√™me si vous divisez les fonctions d'√©criture et de lecture des textures en diff√©rentes images, il existe toujours des dispositions √† 40-110 ms. </li><li>  Ce syst√®me ne prend pas en compte de rares cas.  Par exemple, une lampe de poche brille sur un personnage.  Le personnage est bien √©clair√©, mais la lumi√®re tombe sur lui et derri√®re lui, et non vers le bas, respectivement, notre d√©tecteur de lumi√®re montre un faible niveau d'√©clairage.  Vous pouvez r√©soudre le probl√®me, par exemple, en pla√ßant le d√©tecteur non pas sur le sol, mais au niveau de la poitrine du personnage.  Ensuite, vous devez placer deux cam√©ras sur les c√¥t√©s oppos√©s pour lire la lumi√®re de chaque c√¥t√©.  Ce qui va ralentir le syst√®me de moiti√©. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417135/">https://habr.com/ru/post/fr417135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417123/index.html">Int√©gration de Spark Streaming et Kafka</a></li>
<li><a href="../fr417125/index.html">RTC Meetup .Net: invitez √† la premi√®re r√©union</a></li>
<li><a href="../fr417127/index.html">Tesla signe un accord pour construire Gigafactory 3 en Chine</a></li>
<li><a href="../fr417129/index.html">Univers de l'esprit</a></li>
<li><a href="../fr417131/index.html">Comment ressentir les transactions dans MongoDB maintenant</a></li>
<li><a href="../fr417137/index.html">Angulaire: cr√©er un composant √† cases √† cocher multiples pouvant √™tre r√©utilis√©</a></li>
<li><a href="../fr417139/index.html">Des preuves qui ont tromp√© les scientifiques pendant des d√©cennies</a></li>
<li><a href="../fr417141/index.html">Il n'est jamais trop t√¥t pour penser √† la 6G</a></li>
<li><a href="../fr417143/index.html">Des preuves scientifiques? Ils ne sont pas</a></li>
<li><a href="../fr417145/index.html">Application Burger King: taquinez votre vie priv√©e. Sommes-nous en train de corriger?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>