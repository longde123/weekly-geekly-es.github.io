<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title> 锔  驴C贸mo usar PHP para implementar microservicios?   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="驴Por qu茅 deber铆a hablar de gobernanza de servicios? 


 Con la creciente popularidad de Internet, la arquitectura tradicional de MVC se ha vuelto cada...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>驴C贸mo usar PHP para implementar microservicios?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460855/"><p><img src="https://habrastorage.org/getpro/habr/post_images/287/fa2/ee0/287fa2ee0642f5411410b78c86702e82.jpg" alt="Swoft"></p><br><h3 id="why-should-talk-service-governance">  驴Por qu茅 deber铆a hablar de gobernanza de servicios? </h3><br><p>  Con la creciente popularidad de Internet, la arquitectura tradicional de MVC se ha vuelto cada vez m谩s hinchada y muy dif铆cil de mantener a medida que la escala de aplicaciones contin煤a expandi茅ndose. </p><br><p>  Necesitamos tomar medidas para dividir un sistema grande en m煤ltiples aplicaciones de acuerdo con las caracter铆sticas del negocio.  Por ejemplo, un gran sistema de comercio electr贸nico puede incluir un sistema de usuario, un sistema de productos, un sistema de pedidos, un sistema de evaluaci贸n, etc., y podemos separarlos en m煤ltiples aplicaciones individuales.  Las caracter铆sticas de la arquitectura de aplicaciones m煤ltiples son aplicaciones que se ejecutan de forma independiente y no pueden llamarse entre s铆. </p><a name="habracut"></a><br><p>  Aunque varias aplicaciones resuelven el problema de la aplicaci贸n hinchada, las aplicaciones son independientes entre s铆 y los servicios o c贸digos comunes no se pueden reutilizar. </p><br><h3 id="official-link">  Enlace oficial </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/swoft-cloud/swoft</a> <br><br><h2 id="single-application-solution">  Soluci贸n de aplicaci贸n 煤nica </h2></li></ul><br><p>  Para un sistema de Internet grande, generalmente contiene m煤ltiples aplicaciones con servicios comunes, y cada aplicaci贸n tiene una relaci贸n de llamada entre s铆.  Adem谩s, existen otros desaf铆os para el sistema de Internet a gran escala, tales como c贸mo tratar con usuarios en r谩pido crecimiento, c贸mo administrar equipos de I + D para iterar r谩pidamente el desarrollo del sistema, c贸mo mantener la actualizaci贸n del sistema de manera estable, etc. </p><br><p>  Por lo tanto, para reutilizar bien los servicios y mantener los m贸dulos para expandirse f谩cilmente.  Queremos que los servicios se separen de la aplicaci贸n.  Un servicio ya no est谩 en una aplicaci贸n, sino que se mantiene como un servicio separado.  La aplicaci贸n en s铆 ya no es una pila de m贸dulos hinchada, sino un componente de servicio modular. </p><br><h2 id="servitization">  Servitization </h2><br><h3 id="features">  Caracteristicas </h3><br><p>  Entonces, 驴cu谩l es la caracter铆stica de usar "Servitizaci贸n"? </p><br><ul><li>  Una aplicaci贸n se divide en servicios por empresas </li><li>  El servicio individual se puede implementar de forma independiente </li><li>  El servicio puede ser compartido por m煤ltiples aplicaciones </li><li>  Los servicios pueden tener comunicaci贸n entre ellos. </li><li>  La arquitectura del sistema es m谩s clara. </li><li>  Los m贸dulos principales son estables y la actualizaci贸n de componentes de servicio en unidades puede evitar el riesgo de nuevos lanzamientos frecuentes </li><li>  F谩cil para el desarrollo y la gesti贸n. </li><li>  El mantenimiento puede realizarlo un equipo individual con un flujo de trabajo claro y responsabilidades </li><li>  Reutilizaci贸n de servicios, reutilizaci贸n de c贸digos </li><li>  Muy f谩cil de expandir <cut></cut></li></ul><br><h3 id="the-challenge-of-servitization">  El desaf铆o de la servitizaci贸n. </h3><cut></cut><br><p> Despu茅s de la servitizaci贸n del sistema, la dependencia del sistema es complicada y aumenta el n煤mero de interacciones entre los servicios.  En el modo de desarrollo de <code>fpm</code> , debido a que no se puede proporcionar la memoria residente, cada solicitud debe comenzar desde cero al comenzar a cargar un proceso para salir del proceso, agregando una sobrecarga in煤til.  Adem谩s, la conexi贸n de la base de datos no se puede reutilizar y no se puede proteger porque <code>fpm</code> se basa en el proceso y el n煤mero de procesos <code>fpm</code> tambi茅n determina el n煤mero de concurrentes.  Estos son los problemas que nos da el simple desarrollo de <code>fpm</code> .  Entonces, estas son las razones por las cuales <code>Java</code> es m谩s popular ahora en la plataforma de Internet en comparaci贸n con <code>.NET</code> y <code>PHP</code> .  Adem谩s de <code>PHP non-memory resident</code> , hay muchos otros problemas que deben abordarse. </p><br><ul><li>  M谩s servicios, m谩s complejidad en la gesti贸n de la configuraci贸n. </li><li>  Dependencias de servicio complejas </li><li>  Balanceo de carga entre servicios </li><li>  Servicio de expansi贸n </li><li>  Servicio de monitoreo </li><li>  Servicio de degradaci贸n </li><li>  Autenticaci贸n de servicio </li><li>  Servicio en l铆nea y fuera de l铆nea </li><li>  Documentaci贸n de servicio <br>  ...... </li></ul><cut></cut><br><p>  Puedes imaginar los beneficios que nos brinda la memoria residente. </p><br><ul><li><p>  <strong>Solo inicie la inicializaci贸n del marco una vez</strong> que podamos concentrarnos en el procesamiento de solicitudes, ya que el marco solo se puede inicializar en la memoria al inicio de una vez para la memoria residente </p><br></li><li><p>  <strong>Multiplexaci贸n de conexi贸n</strong> , algunos ingenieros no pueden entender si no se usa el grupo de conexiones, 驴cu谩l es la consecuencia de hacer conexiones para cada solicitud?  Causa demasiados recursos de back-end en las conexiones.  Para algunos servicios b谩sicos, como Redis, bases de datos, las conexiones son un drenaje costoso. </p><br></li></ul><br><p>  Entonces, 驴hay una buena soluci贸n?  La respuesta es s铆, y muchas personas est谩n usando el marco llamado <code>Swoft</code> .  <code>Swoft</code> es un marco <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RPC</a> con la funci贸n de <code>Service Governance</code> .  <code>Swoft</code> es el primer framework de pila completa de rutina residente en PHP, basado en el concepto central del <code>Spring Boot</code> , la convenci贸n es mayor que la configuraci贸n. </p><br><p>  <code>Swoft</code> proporciona una forma m谩s elegante de usar servicios <code>RPC</code> como <code>Dubbo</code> y <code>Swoft</code> tiene un gran rendimiento similar al rendimiento de <code>Golang</code> .  Aqu铆 est谩 el resultado de la prueba de estr茅s del rendimiento de <code>Swoft</code> en mi <code>PC</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a4/aa7/97e/3a4aa797eb0e94c2e5adfa3207308076.png" alt="Swoft"></p><br><p>  La velocidad de procesamiento es muy sorprendente en la prueba de esfuerzo abdominal.  Con la CPU <code>i7 generation 8</code> y la memoria de <code>16GB</code> , <code>100000</code> solicitudes solo usan <code>5s</code> .  El tiempo es b谩sicamente imposible de alcanzar en el modo de desarrollo <code>fpm</code> .  La prueba tambi茅n es suficiente para demostrar el alto rendimiento y la estabilidad de <code>Swoft</code> . </p><br><h2 id="elegant-service-governance">  Gobierno de servicio elegante </h2><cut></cut><br><h3 id="service-registration-and-discoveryhttpsenswoftorgdocs2xenmsgovernregister-discoveryhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Registro de servicio y descubrimiento</a> </h3><br><p>  En el proceso de gobernanza de microservicios, el registro de servicios iniciados a grupos de terceros, como c贸nsul / etcd, a menudo est谩 involucrado.  Este cap铆tulo utiliza el componente swoft-consul en el marco de Swoft para implementar el registro y descubrimiento de servicios. <br><img src="https://habrastorage.org/getpro/habr/post_images/16a/482/683/16a482683d8376d8f179f6158135384a.png" alt="Swoft"><br>  L贸gica de implementaci贸n </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">ReflectionException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ContainerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Agent</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ClientException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Consul</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ServerException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Rpc</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>\<span class="hljs-title"><span class="hljs-title">Contract</span></span>\<span class="hljs-title"><span class="hljs-title">ProviderInterface</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class RpcProvider * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RpcProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProviderInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Agent */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $agent; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Client $client * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ReflectionException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ContainerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ClientException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ServerException * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@example</span></span></span><span class="hljs-comment"> * [ * 'host:port', * 'host:port', * 'host:port', * ] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Client $client)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Get health service from consul $services = $this-&gt;agent-&gt;services(); $services = [ ]; return $services; } }</span></span></code> </pre> <br><h3 id="service-circuit-breakerhttpsenswoftorgdocs2xenmsgovernbreakerhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Servicio de disyuntor</a> </h3><cut></cut><br><p>  En un entorno distribuido, especialmente un sistema distribuido de arquitectura de microservicios, es muy com煤n que un sistema de software llame a otro sistema remoto.  El destinatario de dicha llamada remota puede ser otro proceso u otro host en la red.  La mayor diferencia entre esta llamada remota y la llamada interna del proceso es que la llamada remota puede fallar o bloquearse.  No hay respuesta hasta el tiempo de espera.  Peor a煤n, si hay varias personas que llaman que llaman al mismo servicio suspendido, es muy probable que el tiempo de espera de un servicio se extienda r谩pidamente a todo el sistema distribuido, causando una reacci贸n en cadena que consume una gran cantidad de recursos en sistemas distribuidos.  Eventualmente, puede conducir a la par谩lisis del sistema. </p><cut></cut><br><p>  El modo de disyuntor est谩 dise帽ado para prevenir desastres causados por tales reacciones en cadena similares a una cascada en sistemas distribuidos. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0f7/357/6f0/0f73576f06e519937755982867922c34.png"></p><br><p>  En el modo b谩sico del interruptor autom谩tico, para garantizar que no se llame al proveedor cuando el interruptor autom谩tico est谩 en estado abierto, pero tambi茅n necesitamos un m茅todo adicional para restablecer el interruptor autom谩tico despu茅s de que el proveedor reanude el servicio.  Una posible soluci贸n es que el interruptor autom谩tico detecta peri贸dicamente si se reanuda el servicio del proveedor.  Una vez reanudado, el estado se establece en cerrar.  El estado es un estado medio abierto cuando el disyuntor vuelve a intentarlo. </p><cut></cut><br><p>  El uso del fusible es simple y poderoso.  Se puede anotar con un <code>@Breaker</code> .  El fusible del <code>Swoft</code> se puede usar en cualquier escenario, como se llama a un servicio.  Se puede degradar o no llamar cuando se solicita un servicio de terceros. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Exception</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Breaker</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class BreakerLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BreakerLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Breaker</span></span></span><span class="hljs-comment">(fallback="loopFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> Exception */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Do something throw new Exception('Breaker exception'); } /** * @return string * @throws Exception */ public function loopFallback(): string { // Do something } }</span></span></code> </pre> <cut></cut><br><h3 id="service-restrictionhttpsenswoftorgdocs2xenmsgovernlimiterhtml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Restricci贸n de servicio</a> </h3><br><p>  <strong>Restricci贸n de flujo, disyuntor, reducci贸n de servicio</strong> Estos pueden enfatizarse repetidamente porque son realmente importantes.  Cuando el servicio no funciona, debe estar roto.  La restricci贸n de flujo es una herramienta para protegerse.  Si no hay un mecanismo de autoprotecci贸n y las conexiones se reciben sin importar cu谩ntas sean, el front-end definitivamente se bloquear谩 cuando el tr谩fico sea muy grande, mientras que el back-end no puede manejar todas las conexiones. </p><br><p>  La restricci贸n de flujo es limitar el n煤mero de solicitudes simult谩neas y el n煤mero de solicitudes al acceder a recursos escasos, como los productos de venta flash, para reducir efectivamente el pico y suavizar la curva de flujo.  El prop贸sito de la restricci贸n de flujo es limitar la velocidad de acceso concurrente y solicitudes concurrentes, o limitar la velocidad de solicitud dentro de un per铆odo de tiempo para proteger el sistema.  Una vez que se alcanza o se supera el l铆mite de velocidad, las solicitudes se pueden denegar o poner en cola. </p><br><p>  La capa inferior de la restricci贸n de flujo de <code>Swoft</code> utiliza el algoritmo de dep贸sito de tokens, y la capa subyacente depende de <code>Redis</code> para implementar la restricci贸n de flujo distribuido. </p><br><p>  La restricci贸n de flujo de Swoft no solo limita los controladores, tambi茅n limita los m茅todos en cualquier bean y controla la velocidad de acceso de los m茅todos.  El siguiente ejemplo es la explicaci贸n en detalle. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Limiter</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">RateLimiter</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class LimiterLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LimiterLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RequestMapping</span></span></span><span class="hljs-comment">() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@RateLimiter</span></span></span><span class="hljs-comment">(rate=20, fallback="limiterFallback") * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">requestLimiter2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'requestLimiter2'</span></span>, $uri]; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Request $request * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">limiterFallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ $uri = $request-&gt;getUriPath(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-string"><span class="hljs-string">'limiterFallback'</span></span>, $uri]; } }</code> </pre> <br><p>  Esto admite la <code>symfony/expression-language</code> .  Si la velocidad es limitada, se <code>limiterFallback</code> m茅todo <code>limiterFallback</code> definido en <code>limiterFallback</code> . </p><cut></cut><br><h3 id="configuration-centerhttpsenswoftorgdocs2xenmsgovernconfightml">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Centro de configuraci贸n</a> </h3><br><p>  Antes de hablar sobre el centro de configuraci贸n, hablemos sobre el archivo de configuraci贸n.  No somos ajenos a eso.  Nos proporciona la capacidad de modificar din谩micamente el programa.  Una cita de alguien es: </p><br><blockquote>  隆Ajuste din谩mico de la actitud de vuelo del tiempo de ejecuci贸n del sistema! </blockquote><p>  Puedo llamar a nuestro trabajo para reparar piezas en aviones de vuelo r谩pido.  Los humanos siempre somos incapaces de controlar y predecir todo.  Para nuestro sistema, siempre necesitamos reservar algunas l铆neas de control para hacer ajustes cuando los necesitemos, para controlar la direcci贸n del sistema (como control gris, ajuste de restricci贸n de flujo), lo cual es especialmente importante para la industria de Internet que acepta los cambios. </p><br><p>  Para la versi贸n independiente, la llamamos configuraci贸n (archivo);  para el sistema de cl煤ster distribuido, lo llamamos el centro de configuraci贸n (sistema); </p><br><h4 id="what-exactly-is-a-distributed-configuration-center">  驴Qu茅 es exactamente un centro de configuraci贸n distribuido? </h4><cut></cut><br><p>  Con el desarrollo del negocio y la actualizaci贸n de la arquitectura de microservicios, el n煤mero de servicios y la configuraci贸n de programas est谩n aumentando (varios microservicios, varias direcciones de servidores, diversos par谩metros), y el m茅todo tradicional de archivo de configuraci贸n y m茅todo de base de datos no puede satisfacer las necesidades de los desarrolladores en la gesti贸n de la configuraci贸n: </p><br><ul><li>  Seguridad: la configuraci贸n sigue el c贸digo fuente almacenado en la base del c贸digo, que es f谩cil de causar fugas de configuraci贸n; </li><li>  Puntualidad: modifique la configuraci贸n y reinicie el servicio para que surta efecto. </li><li>  Limitaciones: No se admiten ajustes din谩micos: por ejemplo, interruptores de registro, interruptores de funci贸n; </li></ul><br><p>  隆Por lo tanto, necesitamos configurar el centro para gestionar la configuraci贸n!  Al liberar a los desarrolladores de negocios de configuraciones complejas y engorrosas, solo necesitan enfocarse en el c贸digo de negocios en s铆 mismo, lo que puede mejorar significativamente el desarrollo y la eficiencia operativa.  Al mismo tiempo, la configuraci贸n y el lanzamiento del paquete mejorar谩n a煤n m谩s la tasa de 茅xito del lanzamiento y proporcionar谩n un fuerte soporte para el control de ajuste fino y el manejo de emergencia de la operaci贸n y mantenimiento. </p><br><p>  Sobre los centros de configuraci贸n distribuidos, hay muchas soluciones de c贸digo abierto en la web, como: </p><br><p>  Apollo es un centro de configuraci贸n distribuido desarrollado por el departamento de framework de Ctrip.  Puede gestionar centralmente la configuraci贸n de diferentes entornos y diferentes grupos de aplicaciones.  Se puede enviar al final de la aplicaci贸n en tiempo real despu茅s de la modificaci贸n de la configuraci贸n.  Tiene las caracter铆sticas de autoridad estandarizada y gesti贸n de procesos, y es adecuado para los escenarios de configuraci贸n y gesti贸n de microservicios. </p><cut></cut><br><p>  Este cap铆tulo utiliza <code>Apollo</code> como ejemplo para extraer la configuraci贸n y asegurar los servicios de reinicio desde el centro de configuraci贸n remoto.  Si no est谩 familiarizado con <code>Apollo</code> , primero puede mirar el componente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>Apollo</code></a> extensi贸n <code>Swoft</code> y leer la documentaci贸n oficial de <code>Apollo</code> . </p><br><p>  Este cap铆tulo utiliza <code>Apollo</code> en <code>Swoft</code> como ejemplo.  Cuando cambie la configuraci贸n de <code>Apollo</code> , reinicie el servicio (http-server / rpc-server / ws-server).  El siguiente es un ejemplo de un agente: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>\<span class="hljs-title"><span class="hljs-title">Logic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Config</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Apollo</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">ApolloException</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Swoft</span></span>\<span class="hljs-title"><span class="hljs-title">Bean</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">Inject</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class ApolloLogic * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@since</span></span></span><span class="hljs-comment"> 2.0 * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Bean</span></span></span><span class="hljs-comment">() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApolloLogic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Inject</span></span></span><span class="hljs-comment">() * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Config */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $config; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> ApolloException */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ $data = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;config-&gt;pull(<span class="hljs-string"><span class="hljs-string">'application'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Print data var_dump($data); } }</span></span></code> </pre> <br><p>  Lo anterior es un simple tir贸n de configuraci贸n de Apollo, adem谩s de este m茅todo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>Swoft-Apollo</code></a> proporciona m谩s formas de uso. </p><cut></cut><br><h2 id="official-link-1">  Enlace oficial </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/swoft-cloud/swoft</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460855/">https://habr.com/ru/post/460855/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460843/index.html">Presentamos el nuevo 3CX Call Flow Designer y el generador de plantillas 3CX CRM</a></li>
<li><a href="../460845/index.html">Fernando Corbato, el padre de su computadora (y contrase帽a), muri贸 a los 93 a帽os</a></li>
<li><a href="../460847/index.html">12,3 millones de WebSockets concurrentes</a></li>
<li><a href="../460849/index.html">Parte 4. Un modelo gr谩fico para calcular funciones l贸gicas para procesos paralelos asincr贸nicos</a></li>
<li><a href="../460851/index.html">SamsPcbGuide, Parte 10: Tecnolog铆a - Soldadura de componentes sin plomo</a></li>
<li><a href="../460857/index.html">C贸mo Namecoin Blockchain Research predijo ataques cibern茅ticos RTM</a></li>
<li><a href="../460859/index.html">IThink # 3 conferencia en Jarkov - basada en WWDC 2019</a></li>
<li><a href="../460861/index.html">Alcance y cierre l茅xico de JavaScript</a></li>
<li><a href="../460863/index.html">Detalles del accidente de Cloudflare 2 de julio de 2019</a></li>
<li><a href="../460865/index.html">La gente en la luna. Fuentes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>