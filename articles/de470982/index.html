<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìÇ üò´ üìµ Analyse von Commits und Pull-Anfragen in Travis CI, Buddy und AppVeyor mit PVS-Studio üßëüèº‚Äçü§ù‚Äçüßëüèº üéöÔ∏è ‚öóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ab Version 7.04 bietet der PVS-Studio Analyzer f√ºr C- und C ++ - Sprachen unter Linux und MacOS die Testfunktion zum √úberpr√ºfen der Liste der angegebe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Analyse von Commits und Pull-Anfragen in Travis CI, Buddy und AppVeyor mit PVS-Studio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/470982/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac4/d08/0e7/ac4d080e7661626569ef514abe190662.png" alt="Bild 11"></div><br>  Ab Version 7.04 bietet der PVS-Studio Analyzer f√ºr C- und C ++ - Sprachen unter Linux und MacOS die Testfunktion zum √úberpr√ºfen der Liste der angegebenen Dateien.  Im neuen Modus k√∂nnen Sie den Analysator so konfigurieren, dass Commits √ºberpr√ºft und Anforderungen abgerufen werden.  Dieser Artikel behandelt das Einrichten der √úberpr√ºfung bestimmter ge√§nderter Dateien aus einem GitHub-Projekt in so beliebten CI-Systemen (Continuous Integration) wie Travis CI, Buddy und AppVeyor. <br><a name="habracut"></a><br><h2>  Modus zum √úberpr√ºfen der Liste der Dateien </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio</a> ist ein Tool zum Erkennen von Fehlern und potenziellen Schwachstellen im Quellcode von Programmen, die in C, C ++, C # und Java geschrieben wurden.  Funktioniert in 64-Bit-Systemen unter Windows, Linux und MacOS. <br><br>  In der PVS-Studio 7.04-Version f√ºr Linux und MacOS gibt es jetzt die M√∂glichkeit, die Liste der Dateien zu √ºberpr√ºfen.  Es funktioniert f√ºr Projekte, deren Build-System das Generieren der Datei <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">compile_commands.json erm√∂glicht</a> .  Es wird ben√∂tigt, damit der Analysator Informationen √ºber die Kompilierung bestimmter Dateien erh√§lt.  Wenn Ihr Build-System die Generierung der Datei compile_commands.json nicht unterst√ºtzt, k√∂nnen Sie versuchen, eine solche Datei mit dem Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bear zu</a> generieren. <br><br>  Diese Art der √úberpr√ºfung der Dateiliste kann auch mit dem von strace generierten Compiler-Ablaufverfolgungsprotokoll (pvs-studio-analyzer trace) verwendet werden.  Dazu m√ºssen Sie zun√§chst einen vollst√§ndigen Projektaufbau abschlie√üen und verfolgen, damit der Analysator vollst√§ndige Informationen zu den Kompilierungsparametern aller √ºberpr√ºften Dateien sammelt. <br><br>  Diese Option hat jedoch einen erheblichen Nachteil: Sie m√ºssen entweder bei jedem Lauf eine vollst√§ndige Build-Ablaufverfolgung des gesamten Projekts durchf√ºhren, was der Idee einer schnellen Commit-√úberpr√ºfung widerspricht.  Wenn Sie das Ablaufverfolgungsergebnis selbst zwischenspeichern, sind nachfolgende Analysatorl√§ufe m√∂glicherweise unvollst√§ndig, wenn sich nach dem Verfolgen der Struktur der Quelldateien die Abh√§ngigkeiten √§ndern (z. B. wird in einer der Quelldateien ein neues #include hinzugef√ºgt). <br><br>  Daher empfehlen wir nicht, den Modus zum √úberpr√ºfen der Dateiliste mit einem Ablaufverfolgungsprotokoll zu verwenden, um Commits oder Pull-Anforderungen zu √ºberpr√ºfen.  Wenn Sie beim √úberpr√ºfen eines Commits einen inkrementellen Build ausf√ºhren k√∂nnen, sollten Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">inkrementellen Analysemodus verwenden</a> . <br><br>  Die Liste der Quelldateien f√ºr die Analyse wird in der Textdatei gespeichert und mit dem Parameter <i>-S</i> an den Analysator √ºbergeben: <br><br><pre><code class="bash hljs">pvs-studio-analyzer analyze ... -f build/compile_commands.json -S check-list.txt</code> </pre> <br>  Diese Datei enth√§lt relative und absolute Pfade zu Dateien, in denen jede neue Datei in einer neuen Zeile steht.  Sie k√∂nnen sowohl Dateinamen f√ºr die Analyse als auch unterschiedlichen Text angeben.  Der Analysator erkennt, dass es sich nicht um einen Dateinamen handelt, und ignoriert die Zeile.  Dies kann zum Kommentieren hilfreich sein, wenn Dateien manuell angegeben werden.  H√§ufig wird die Liste der Dateien jedoch w√§hrend der CI-Analyse generiert. Dies k√∂nnen beispielsweise Dateien aus einem Commit oder einer Pull-Anforderung sein. <br><br>  In diesem Modus k√∂nnen Sie jetzt schnell neuen Code √ºberpr√ºfen, bevor er in den Hauptentwicklungszweig gelangt.  Das <i>Flag --indicate-warnings</i> wurde im Dienstprogramm <i>plog-converter</i> hinzugef√ºgt, damit das <i>Pr√ºfsystem</i> auf das Vorhandensein von Warnungen des Analysators reagiert. <br><br><pre> <code class="bash hljs">plog-converter ... --indicate-warnings ... -o /path/to/report.tasks ...</code> </pre> <br>  Mit diesem Flag gibt der Konverter einen Code ungleich Null zur√ºck, wenn der Analysatorbericht Warnungen enth√§lt.  Sie k√∂nnen den Pre-Commit-Hook, die Commit- oder Pull-Anforderung blockieren und den generierten Analysatorbericht anzeigen, freigeben oder per E-Mail senden. <br><br>  <i>Hinweis</i>  <i>W√§hrend der ersten Analyse der Dateiliste wird das gesamte Projekt √ºberpr√ºft, da der Analysator die Datei mit Abh√§ngigkeiten von Projektquelldateien aus Headerdateien generieren muss.</i>  <i>Dies ist eine Besonderheit der Analyse von C- und C ++ - Dateien.</i>  <i>In Zukunft kann diese Abh√§ngigkeitsdatei zwischengespeichert werden und wird vom Analysator automatisch aktualisiert.</i>  <i>Der Vorteil der √úberpr√ºfung von Commits im Modus zum √úberpr√ºfen der Dateiliste gegen√ºber dem inkrementellen Analysemodus besteht darin, dass Sie nur diese Datei und nicht die Objektdateien zwischenspeichern m√ºssen.</i> <br><br><h2>  Allgemeine Prinzipien der Pull-Request-Analyse </h2><br>  Die gesamte Projektanalyse nimmt viel Zeit in Anspruch, daher ist es sinnvoll, nur einen Teil davon zu √ºberpr√ºfen.  Das Problem ist, dass Sie neue Dateien von den √ºbrigen Projektdateien trennen m√ºssen. <br><br>  Schauen wir uns das Beispiel eines Commit-Baums mit zwei Zweigen an: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/722/646/68c/72264668c4a90b96ccb63f363a46c683.png" alt="Bild 5"></div><br><br>  Stellen Sie sich vor, das <i>A1-</i> Commit enth√§lt ziemlich viel Code, der bereits √ºberpr√ºft wurde.  Zuvor haben wir einen Zweig aus dem <i>A1-</i> Commit erstellt und einige Dateien ge√§ndert. <br><br>  Nat√ºrlich haben Sie bemerkt, dass nach <i>A1</i> zwei weitere Commits stattgefunden haben und zwei weitere Zweige zusammengef√ºhrt wurden, da wir im <i>Master</i> keine Commits durchf√ºhren.  Hier kommt der Moment, in dem der <i>Hotfix</i> bereit ist.  Aus diesem Grund haben wir eine Pull-Anfrage f√ºr die Zusammenf√ºhrung von <i>B3</i> und <i>A3 erhalten</i> . <br><br>  Wir k√∂nnten das Ergebnis ihrer Zusammenf√ºhrung √ºberpr√ºfen, aber es w√§re zu lang und unvern√ºnftig, da nur wenige Dateien ge√§ndert wurden.  Daher ist es effizienter, nur die ge√§nderten zu analysieren. <br><br>  Dazu erhalten wir den Unterschied zwischen Zweigen, die sich im KOPF des Zweigs befinden, von dem wir in den Master √ºbergehen m√∂chten: <br><br><pre> <code class="bash hljs">git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list</code> </pre> <br>  Wir werden <i>$ MERGE_BASE</i> sp√§ter im Detail betrachten.  Tatsache ist, dass nicht jeder CI-Service die erforderlichen Informationen auf der Zusammenf√ºhrungsbasis bereitstellt. Daher m√ºssen wir jedes Mal √ºber neue Wege nachdenken, um diese Daten abzurufen.  Dies wird nachstehend f√ºr jeden der beschriebenen Webdienste im Detail betrachtet. <br><br>  Wir haben also einen Unterschied zwischen Zweigen, dh der Liste der ge√§nderten Dateinamen.  Jetzt m√ºssen wir diese <i>.pvs-pr.list-</i> Datei dem Analysator <i>zuf√ºhren</i> .  Wir haben die Ausgabe fr√ºher darauf umgeleitet. <br><br><pre> <code class="bash hljs">pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list</code> </pre> <br>  Nach der Analyse m√ºssen wir die Protokolldatei (PVS-Studio.log) in ein benutzerfreundliches Format konvertieren: <br><br><pre> <code class="bash hljs">plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Dieser Befehl gibt die Fehlerliste in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">stderr</a> (Standardfehlerstrom) aus. <br><br>  Der Haken ist, dass wir nicht nur die Fehler ausgeben m√ºssen, sondern auch unseren Build- und Test-Service √ºber die Probleme informieren m√ºssen.  Zu diesem <i>Zweck</i> wurde im Konverter das Flag <i>-W</i> ( <i>--indicate-warnings</i> ) hinzugef√ºgt.  Wenn mindestens eine Analysatorwarnung <i>vorliegt</i> , √§ndert sich der R√ºckkehrcode des <i>Plog-Converter-</i> Dienstprogramms in 2, wodurch der CI-Dienst √ºber m√∂gliche Fehler in den Dateien der Pull-Anforderung <i>informiert</i> wird. <br><br><h2>  Travis ci </h2><br>  Die Konfiguration erfolgt in Form der Datei <i>.travis.yml</i> .  Der <i>Einfachheit</i> <i>halber</i> empfehle ich Ihnen, alle Befehle, die sich auf PVS-Studio beziehen, in einem separaten Bash-Skript mit Funktionen zu isolieren, die aus der Datei <i>.travis.yml</i> ( <i>Bash-Skriptname.sh Funktionsname</i> ) <i>aufgerufen werden</i> . <br><br>  Durch Erweitern des Skripts erhalten Sie mehr Funktionen.  Schreiben Sie im <i>Installationsabschnitt</i> Folgendes: <br><br><pre> <code class="xml hljs">install: - bash .travis.sh travis_install</code> </pre> <br>  Wenn Sie einige Anweisungen hatten, k√∂nnen Sie diese im Skript verschieben, nachdem Sie Bindestriche entfernt haben. <br><br>  √ñffnen Sie die Datei <i>.travis.sh</i> und f√ºgen Sie die Analyzer-Installation in die Funktion <i>travis_install () ein</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_install</span></span></span></span>() { wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update -qq sudo apt-get install -qq pvs-studio }</code> </pre> <br>  F√ºgen wir nun den im Skriptabschnitt ausgef√ºhrten Analysator hinzu: <br><br><pre> <code class="xml hljs">script: - bash .travis.sh travis_script</code> </pre> <br>  Und im Bash-Skript: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TRAVIS_PULL_REQUEST</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"false"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> git diff --name-only origin/HEAD &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w }</code> </pre> <br>  Sie m√ºssen diesen Code nach dem Erstellen des Projekts ausf√ºhren, wenn Sie beispielsweise CMake erstellt haben: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { CMAKE_ARGS=<span class="hljs-string"><span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CMAKE_ARGS}</span></span></span><span class="hljs-string">"</span></span> cmake <span class="hljs-variable"><span class="hljs-variable">$CMAKE_ARGS</span></span> CMakeLists.txt make -j8 }</code> </pre> <br>  Sie erhalten Folgendes: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">travis_script</span></span></span></span>() { CMAKE_ARGS=<span class="hljs-string"><span class="hljs-string">"-DCMAKE_EXPORT_COMPILE_COMMANDS=On </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CMAKE_ARGS}</span></span></span><span class="hljs-string">"</span></span> cmake <span class="hljs-variable"><span class="hljs-variable">$CMAKE_ARGS</span></span> CMakeLists.txt make -j8 pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$TRAVIS_PULL_REQUEST</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">"false"</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> git diff --name-only origin/HEAD &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ -S .pvs-pr.list \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w }</code> </pre> <br>  H√∂chstwahrscheinlich haben Sie die Umgebungsvariablen <i>$ TRAVIS_PULL_REQUEST</i> und <i>$ TRAVIS_BRANCH</i> bereits bemerkt.  Travis CI erkl√§rt sie selbst: <br><br><ul><li>  <i>$ TRAVIS_PULL_REQUEST</i> speichert die Pull-Anforderungsnummer oder <i>false,</i> wenn es sich um eine regul√§re Verzweigung handelt. </li><li>  <i>$ TRAVIS_REPO_SLUG</i> speichert den Namen des Projekt-Repositorys. </li></ul><br>  Hier ist der Betriebsalgorithmus dieser Funktion: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ebe/643/58b/ebe64358b6f4cc73db5d4b0094919faa.png" alt="Bild 13"></div><br>  Travis CI reagiert auf R√ºckkehrcodes, sodass das Vorhandensein von Warnungen den Dienst meldet, um das Commit als fehlerhaft zu markieren. <br><br>  Schauen wir uns nun diese Codezeile genauer an: <br><pre> <code class="bash hljs">git diff --name-only origin/HEAD &gt; .pvs-pr.list</code> </pre> <br>  Tatsache ist, dass Travis CI bei der Analyse einer Pull-Anforderung automatisch Zweige zusammenf√ºhrt: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/443/986/1f4/4439861f46637d41119e83f83e2e440b.png" alt="Bild 8"></div><br>  Deshalb analysieren wir <i>A4</i> , nicht <i>B3-&gt; A3</i> .  Aufgrund dieser Besonderheit m√ºssen wir den Unterschied zu <i>A3</i> bewerten, dem Kopf des Zweigs vom <i>Ursprung</i> . <br><br>  Ein wichtiges Detail bleibt - das Zwischenspeichern der Abh√§ngigkeiten von Header-Dateien von kompilierten √úbersetzungseinheiten (* .c, * .cc, * .cpp und andere).  Der Analysator wertet diese Abh√§ngigkeiten w√§hrend des ersten Durchlaufs aus, indem er die Liste der Dateien √ºberpr√ºft und sie dann im Verzeichnis .PVS-Studio speichert.  Travis CI erm√∂glicht das Zwischenspeichern von Repositorys, daher speichern wir Daten im <i>Verzeichnis .PVS-Studio /</i> : <br><br><pre> <code class="xml hljs">cache: directories: - .PVS-Studio/</code> </pre> <br>  Dieser Code muss in die Datei <i>.travis.yml eingef√ºgt</i> werden: In diesem Verzeichnis werden verschiedene Daten gespeichert, die nach der Analyse erfasst wurden.  Diese Daten beschleunigen nachfolgende Durchl√§ufe der Dateilistenanalyse oder der inkrementellen Analyse erheblich.  Wenn Sie dies nicht tun, analysiert der Analysator jedes Mal alle Dateien. <br><br><h2>  Kumpel </h2><br>  Mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Buddy</a> k√∂nnen Sie wie mit Travis CI automatisch Projekte aus GitHub erstellen und testen.  Im Gegensatz zu Travis CI wird es √ºber die Weboberfl√§che konfiguriert (Bash-Unterst√ºtzung ist verf√ºgbar), sodass keine Konfigurationsdateien im Projekt gespeichert werden m√ºssen. <br><br>  Zuerst m√ºssen wir der Pipeline einen neuen Schritt hinzuf√ºgen: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/75e/2fd/36e/75e2fd36e9a4420ff74256429ff73e0c.gif" alt="Bild 1"></div><br>  Geben Sie den Compiler an, der zum Erstellen des Projekts verwendet wird.  Achten Sie auf den Docker-Container, der in diesem Schritt installiert wurde.  Zum Beispiel gibt es einen speziellen Container f√ºr GCC: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95b/837/7ad/95b8377adbac7e50e55d97c5b318f56c.png" alt="Bild 6"></div><br>  Installieren wir nun PVS-Studio und die erforderlichen Dienstprogramme: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/88e/fba/02b/88efba02b5a4c34f55c4344744812cc7.gif" alt="Bild 2"></div><br>  F√ºgen Sie dem Editor die folgenden Zeilen hinzu: <br><br><pre> <code class="bash hljs">apt-get update &amp;&amp; apt-get -y install wget gnupg jq wget -q -O - https://files.viva64.com/etc/pubkey.txt | apt-key add - wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list apt-get update &amp;&amp; apt-get -y install pvs-studio</code> </pre> <br>  Fahren wir mit der Registerkarte Ausf√ºhren (erstes Symbol) fort und f√ºgen dem folgenden Editorfeld den folgenden Code hinzu: <br><pre> <code class="bash hljs">pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${BUDDY_REPO_SLUG}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Wenn Sie den Abschnitt √ºber Travs-CI lesen, ist Ihnen dieser Code bekannt.  Aber hier gibt es einen neuen Schritt: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a7a/c65/3e3/a7ac653e3e89c4fc2a2b425b1ccefec8.png" alt="Bild 14"></div><br>  Tatsache ist, dass wir jetzt nicht das Ergebnis der Zusammenf√ºhrung analysieren, sondern den HEAD des Zweigs mit der aktivierten Pull-Anforderung: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/722/646/68c/72264668c4a90b96ccb63f363a46c683.png" alt="Bild 10"></div><br>  Wir sind also in einem <i>B3-</i> Commit und m√ºssen den Unterschied zu <i>A3 herausfinden</i> : <br><br><pre> <code class="bash hljs">PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$BUDDY_EXECUTION_PULL_REQUEST_NO</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${BUDDY_REPO_SLUG}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list</code> </pre> <br>  Um <i>A3</i> zu definieren, verwenden wir die GitHub-API: <br><br><pre> <code class="bash hljs">https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${USERNAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${REPO}</span></span>/pulls/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span></code> </pre> <br>  Wir haben die folgenden Variablen verwendet, die Buddy uns zur Verf√ºgung stellt: <br><br><ul><li>  <i>$ BUDDY_EXECUTION_PULL_REQEUST_NO</i> - Nummer einer Pull-Anfrage; </li><li>  <i>$ BUDDY_REPO_SLUG</i> - Kombination aus Benutzername und Repository (z. B. max / test). </li></ul><br>  Speichern Sie nun die √Ñnderungen mithilfe der folgenden Schaltfl√§che und aktivieren Sie die Pull-Anforderungsanalyse: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74c/5d6/876/74c5d6876c07c0b2e0c10cdabb8b0f78.gif" alt="Bild 3"></div><br>  Im Gegensatz zu Travis CI m√ºssen wir f√ºr das Caching nicht <i>.pvs-studio</i> angeben, da Buddy automatisch alle Dateien f√ºr nachfolgende L√§ufe zwischenspeichert.  Als letztes m√ºssen Sie also den Login und das Passwort f√ºr PVS-Studio in Buddy speichern.  Nach dem Speichern der √Ñnderungen kehren wir in die Pipeline zur√ºck.  Wir m√ºssen mit dem Einrichten der Variablen fortfahren und den Login und den Schl√ºssel f√ºr PVS-Studio einf√ºgen: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb1/816/e3e/eb1816e3e4aff72ad55b187ec1ebf0a2.gif" alt="Bild 4"></div><br>  Danach beginnt eine √úberpr√ºfung mit jeder neuen Pull-Anforderung oder jedem neuen Commit.  Wenn ein Commit Fehler enth√§lt, weist Buddy auf der Pull-Anforderungsseite darauf hin. <br><br><h2>  F√∂rderer </h2><br>  Die AppVeyor-Einstellung ist √§hnlich wie bei Buddy, da dies alles in der Weboberfl√§che geschieht und die Datei * .yml nicht im Projekt-Repository hinzugef√ºgt werden muss. <br><br>  Gehen wir in der Projekt√ºbersicht zur Registerkarte Einstellungen: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f11/2fc/576/f112fc576fc1f8bf7552625578093292.png" alt="Bild 12"></div><br>  Scrollen Sie auf dieser Seite nach unten und aktivieren Sie das Speichern des Cache f√ºr die Erstellung von Pull-Anforderungen: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/8f3/f34/be88f3f34708075a49bdd13c65f5bc26.png" alt="Bild 18"></div><br><br>  Fahren wir nun mit der Registerkarte Umgebung fort, auf der wir das Image f√ºr den Build und die ben√∂tigten Umgebungsvariablen angeben: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/453/26a/80c/45326a80c62211c6b29bd16fad1ef0d1.png" alt="Bild 19"></div><br>  Wenn Sie die vorherigen Abschnitte gelesen haben, sind Sie bereits mit diesen beiden Variablen vertraut - <i>PVS_KEY</i> und <i>PVS_USERNAME</i> .  Wenn nicht, m√∂chte ich Sie daran erinnern, dass sie zur √úberpr√ºfung der PVS-Studio Analyzer-Lizenz ben√∂tigt werden.  In Zukunft werden wir sie in Bash-Skripten wieder sehen. <br><br>  Geben Sie auf derselben Seite unten den Cache-Ordner an: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4e2/967/dbf/4e2967dbfb796e2d0104d5b6539be65a.png" alt="Bild 15"></div><br>  Wenn wir dies nicht tun, analysieren wir das gesamte Projekt anstelle einiger Dateien, erhalten jedoch die Ausgabe f√ºr die angegebenen Dateien.  Daher ist es wichtig, den richtigen Namen des Repositorys einzugeben. <br><br>  Jetzt ist die Zeit f√ºr das √úberpr√ºfungsskript gekommen.  √ñffnen Sie die Registerkarte Tests und w√§hlen Sie Skript: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5f/dbd/0d6/b5fdbd0d6d448174bc05222fe1965c1c.png" alt="Bild 20"></div><br>  Der folgende Code sollte in dieses Formular eingef√ºgt werden: <br><br><pre> <code class="bash hljs">sudo apt-get update &amp;&amp; sudo apt-get -y install jq wget -q -O - https://files.viva64.com/etc/pubkey.txt \ | sudo apt-key add - sudo wget -O /etc/apt/sources.list.d/viva64.list \ https://files.viva64.com/etc/viva64.list sudo apt-get update &amp;&amp; sudo apt-get -y install pvs-studio pvs-studio-analyzer credentials <span class="hljs-variable"><span class="hljs-variable">$PVS_USERNAME</span></span> <span class="hljs-variable"><span class="hljs-variable">$PVS_KEY</span></span> PWD=$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> -L) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ --dump-files --dump-log pvs-dump.log \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> plog-converter -t errorfile PVS-Studio.log --cerr -w</code> </pre> <br>  Beachten wir den folgenden Teil des Codes: <br><br><pre> <code class="bash hljs">PWD=$(<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span> -L) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>` git diff --name-only HEAD origin/<span class="hljs-variable"><span class="hljs-variable">$MERGE_BASE</span></span> &gt; .pvs-pr.list pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck \ --dump-files --dump-log pvs-dump.log \ -S .pvs-pr.list <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> pvs-studio-analyzer analyze -j8 \ -o PVS-Studio.log \ --disableLicenseExpirationCheck <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  Es ist eine ganz bestimmte Zuordnung des Ausgabewerts des Befehls pwd zur Variablen, die diesen Wert standardm√§√üig speichern muss.  Zun√§chst scheint es seltsam, aber lassen Sie mich alles erkl√§ren. <br><br>  Beim Einrichten des Analysators in AppVeyor bin ich auf ein sehr seltsames Verhalten des Analysators gesto√üen.  Einerseits hat alles richtig funktioniert, aber die Analyse hat nicht begonnen.  Es hat viel Zeit gekostet zu bemerken, dass wir uns im Verzeichnis / home / appveyor / projects / testcalc / befanden, w√§hrend der Analysator sicher war, dass wir uns in / opt / appveyor / build-agent / befanden.  In diesem Moment wurde mir klar, dass die Variable $ PWD tr√ºgerisch ist.  Aus diesem Grund habe ich den Wert vor dem Ausf√ºhren der Analyse manuell erneuert. <br><br>  Die weitere Reihenfolge der Aktionen war dieselbe wie zuvor: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a99/1be/5b1/a991be5b13dd4e17ccb9cb47e4f48cf2.png" alt="Bild 16"></div><br>  Schauen Sie sich nun dieses Fragment an: <br><br><pre> <code class="bash hljs">PULL_REQUEST_ID=<span class="hljs-string"><span class="hljs-string">"pulls/</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$APPVEYOR_PULL_REQUEST_NUMBER</span></span></span><span class="hljs-string">"</span></span> MERGE_BASE=`wget -qO - \ https://api.github.com/repos/<span class="hljs-variable"><span class="hljs-variable">${APPVEYOR_REPO_NAME}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${PULL_REQUEST_ID}</span></span> \ | jq -r <span class="hljs-string"><span class="hljs-string">".base.ref"</span></span>`</code> </pre> <br>  Darin erhalten wir den Unterschied zwischen Zweigen, bezogen auf die √ºberpr√ºfte Pull-Anforderung.  Dazu ben√∂tigen wir folgende Umgebungsvariablen: <br><br><ul><li>  $ APPVEYOR_PULL_REQUEST_NUMBER - Anforderungsnummer ziehen; </li><li>  $ APPVEYOR_REPO_NAME - Benutzername und Projekt-Repository. </li></ul><br><h2>  Fazit </h2><br>  Nun, wir haben nicht alle m√∂glichen kontinuierlichen Integrationsdienste in Betracht gezogen, sie haben jedoch alle √§hnliche betriebliche Besonderheiten.  Beim Caching erfindet jeder Dienst sein eigenes Rad neu, sodass es immer anders ist. <br><br>  In einigen F√§llen (wie in Travis-CI) sind einige Codezeilen erforderlich - und das Caching funktioniert einwandfrei.  In anderen F√§llen (wie in AppVeyor) m√ºssen Sie nur das Verzeichnis in den Einstellungen angeben.  Es gibt jedoch einige Dienste, bei denen Sie spezielle Schl√ºssel erstellen und versuchen m√ºssen, das System davon zu √ºberzeugen, dass Sie die M√∂glichkeit haben, ein zwischengespeichertes Fragment neu zu schreiben.  Wenn Sie die Pull-Anforderungsanalyse f√ºr einen kontinuierlichen Integrationsdienst konfigurieren m√∂chten, der oben nicht ber√ºcksichtigt wurde, stellen Sie zun√§chst sicher, dass Sie keine Probleme mit dem Caching haben. <br><br>  Vielen Dank f√ºr Ihre Aufmerksamkeit.  Wenn etwas nicht funktioniert, k√∂nnen Sie sicher an unseren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Support</a> schreiben.  Wir geben Ihnen einen Hinweis und helfen Ihnen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de470982/">https://habr.com/ru/post/de470982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de470966/index.html">Ken Thompsons Unix-Passwort</a></li>
<li><a href="../de470974/index.html">Passives DNS in den H√§nden des Analysten</a></li>
<li><a href="../de470976/index.html">Song of Ice (Bloody Enterprise) und Flames (DevOps und IaC)</a></li>
<li><a href="../de470978/index.html">Analysten-Marktforschung: Wo studieren sie, welche Tools verwenden sie und wie viel verdienen sie?</a></li>
<li><a href="../de470980/index.html">Die Aufgaben, die Softwareroboter (RPAs) im Bankensektor l√∂sen</a></li>
<li><a href="../de470984/index.html">Analyse von Commits und Pull-Anfragen in Travis CI, Buddy und AppVeyor mit PVS-Studio</a></li>
<li><a href="../de470988/index.html">Die Registrierung f√ºr Slerm DevOps in Moskau ist offen</a></li>
<li><a href="../de470990/index.html">Online-Marketing-Toolkit: 3 Apps zur Verbesserung der visuellen Kommunikation</a></li>
<li><a href="../de470994/index.html">JavaScript-Vererbung aus der Sicht eines gelangweilten Nerds: Constructors Factory</a></li>
<li><a href="../de470996/index.html">Wie kann ein einfaches <img> -Tag ein hohes Risiko f√ºr ein Unternehmen darstellen?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>