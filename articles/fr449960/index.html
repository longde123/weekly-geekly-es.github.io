<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüåæ ‚èèÔ∏è üìø Sources d'inspiration lors du d√©veloppement pour UDB üë®üèæ‚Äçüöí üë∂üèº üë©üèΩ‚ÄçüöÄ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eh bien, nous savons d√©j√† tout ce dont vous avez besoin pour programmer UDB. Mais c'est une chose √† savoir et une autre √† savoir. Par cons√©quent, nous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sources d'inspiration lors du d√©veloppement pour UDB</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/449960/">  Eh bien, nous savons d√©j√† tout ce dont vous avez besoin pour programmer UDB.  Mais c'est une chose √† savoir et une autre √† savoir.  Par cons√©quent, nous discuterons aujourd'hui o√π et comment s'inspirer pour am√©liorer nos propres comp√©tences, o√π acqu√©rir de l'exp√©rience.  Comme le montre la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">traduction de la documentation</a> , il existe des connaissances s√®ches qui ne sont pas toujours li√©es √† la pratique r√©elle (j'y ai attir√© l'attention dans une note assez longue, √† la derni√®re traduction √† ce jour).  En fait, les statistiques des vues d'articles montrent que de moins en moins de personnes lisent les traductions.  Il a m√™me √©t√© propos√© d'interrompre ce cycle, comme inint√©ressant, mais il ne restait que deux parties, par cons√©quent, il a finalement √©t√© d√©cid√© de r√©duire le rythme de leur pr√©paration.  En g√©n√©ral, la documentation du contr√¥leur est une chose n√©cessaire, mais pas autosuffisante.  O√π trouver l'inspiration? <br><br><img src="https://habrastorage.org/webt/9n/wy/nb/9nwynby6myz8p5ecl1k5f8l8gwq.jpeg"><br><br>  Tout d'abord, je peux recommander l'excellent document <b>AN82156 Designing PSoC Creator Components with UDB Datapaths</b> .  Vous y trouverez des solutions typiques, ainsi que plusieurs projets standard.  De plus, au d√©but du document, le d√©veloppement est effectu√© √† l'aide de l'√©diteur UDB, et vers la fin, √† l'aide de Datapath Config Tool, c'est-√†-dire que le document couvre tous les aspects du d√©veloppement.  Mais malheureusement, en regardant le prix d'une seule puce PSoC, je dirais que si cela ne peut r√©soudre que les probl√®mes d√©crits dans ce document, le contr√¥leur est largement sur√©valu√©.  Les PWM et les ports s√©rie standard peuvent √™tre r√©alis√©s sans PSoC.  Heureusement, l'√©ventail des t√¢ches PSoC est beaucoup plus large.  Par cons√©quent, apr√®s avoir termin√© la lecture de l'AN82156, nous commen√ßons √† chercher d'autres sources d'inspiration. <br><a name="habracut"></a><br>  La prochaine source utile est les exemples fournis avec PSoC Creator.  Je les ai d√©j√† mentionn√©s dans une note √† l'une des parties de la traduction de la documentation de l'entreprise (vous pouvez voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> ).  Ils sont stock√©s approximativement ici (le disque peut diff√©rer): <br><br>  E: \ Program Files (x86) \ Cypress \ PSoC Creator \ 4.2 \ PSoC Creator \ psoc \ content \ CyComponentLibrary. <br><br>  Vous devez rechercher les fichiers * .v, c'est-√†-dire les textes verilog ou * .vhd, car la syntaxe du langage VHDL n√©cessite un peu plus d'√™tre d√©crite, et dans ce langage, vous pouvez parfois trouver des nuances int√©ressantes cach√©es aux yeux du programmeur chez Verilog.  Le probl√®me est que ce ne sont pas des exemples, mais des solutions toutes faites.  C'est merveilleux, ils sont parfaitement d√©bogu√©s, mais nous, simples programmeurs, avons des objectifs diff√©rents avec les programmeurs Cypress.  Notre t√¢che est de faire quelque chose d'auxiliaire en peu de temps, apr√®s quoi nous commen√ßons √† l'utiliser dans nos projets, qui seront consacr√©s la plupart de notre temps.  Il devrait id√©alement r√©soudre les t√¢ches qui nous sont assign√©es aujourd'hui, et si demain nous voulons ins√©rer le m√™me code dans un autre projet, o√π tout sera l√©g√®rement diff√©rent, alors demain nous le terminerons dans cette situation.  Pour les d√©veloppeurs Cypress, le composant est le produit final, ils peuvent donc y passer la plupart du temps.  Et ils doivent pr√©voir tout-tout-tout.  Alors quand j'ai regard√© ces textes, je me suis sentie triste.  Ils sont trop complexes pour quelqu'un qui vient de commencer √† chercher o√π puiser l'inspiration pour ses premiers d√©veloppements.  Mais comme r√©f√©rences, ces textes sont tout √† fait appropri√©s.  De nombreux designs pr√©cieux sont n√©cessaires pour cr√©er vos propres objets. <br><br>  Il y a aussi des coins tr√®s int√©ressants.  Par exemple, il y a, maintenant je dirai dans le style de "l'huile de beurre", des mod√®les pour la mod√©lisation (il y a longtemps, un professeur s√©v√®re m'a d√©courag√© de traduire la simulation d'une autre mani√®re que la "mod√©lisation").  Ils se trouvent dans le catalogue. <br>  E: \ Program Files (x86) \ Cypress \ PSoC Creator \ 4.2 \ PSoC Creator \ warp \ lib \ sim. <br><br>  Le r√©pertoire le plus int√©ressant pour le programmeur sur Verilogue est: <br><br>  E: \ Program Files (x86) \ Cypress \ PSoC Creator \ 4.2 \ PSoC Creator \ warp \ lib \ sim \ presynth \ vlg. <br><br>  La description des composants dans la documentation est bonne.  Mais les mod√®les de comportement pour tous les composants standard sont d√©crits ici.  Parfois, c'est mieux que la documentation (qui est √©crite dans un langage lourd, et certains d√©tails essentiels sont omis).  Lorsque le comportement de tel ou tel composant n'est pas clair, il vaut la peine de commencer √† essayer de le comprendre pr√©cis√©ment en affichant les fichiers de ce r√©pertoire.  Au d√©but, j'ai essay√© de rechercher sur Google, mais tr√®s souvent, je ne rencontrais sur les forums trouv√©s que des raisonnements et pas de d√©tails.  Voici pr√©cis√©ment les d√©tails. <br><br>  N√©anmoins, le livre de r√©f√©rence est merveilleux, mais o√π chercher un manuel, de quoi apprendre?  Honn√™tement, il n'y a rien de sp√©cial.  Il n'y a pas beaucoup de bons exemples pr√™ts √† l'emploi pour l'√©diteur UDB.  J'ai eu beaucoup de chance que lorsque j'ai soudainement d√©cid√© de jouer aux LED RGB, je suis tomb√© sur un bel exemple sous l'√©diteur UDB (j'ai √©crit √† ce sujet dans l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> qui a commenc√© tout le cycle).  Mais si vous travaillez beaucoup avec un moteur de recherche, il y aura toujours des exemples pour l'outil de configuration de Datapath, c'est pourquoi j'ai fait l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article pr√©c√©dent</a> pour que tout le monde comprenne comment utiliser cet outil.  Et une merveilleuse page sur laquelle de nombreux exemples sont collect√©s se trouve <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . <br><br>  Sur cette page sont des d√©veloppements r√©alis√©s par des d√©veloppeurs tiers, mais v√©rifi√©s par Cypress.  C'est exactement ce dont nous avons besoin: nous sommes √©galement des d√©veloppeurs tiers, mais nous voulons apprendre de quelque chose qui est v√©rifi√© avec pr√©cision.  Regardons un exemple o√π j'ai trouv√© cette page - une calculatrice mat√©rielle √† racine carr√©e.  Les utilisateurs finaux l'incluent dans le chemin de traitement du signal, jetant un composant sur le circuit.  Dans cet exemple, nous nous entra√Ænerons √† analyser un code similaire, puis tout le monde pourra commencer la natation ind√©pendante.  Ainsi, l'exemple n√©cessaire peut √™tre t√©l√©charg√© √† partir du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lien</a> . <br><br>  Nous l'examinons.  Il existe des exemples (que tout le monde consid√©rera ind√©pendamment) et il y a des biblioth√®ques situ√©es dans le r√©pertoire \ CJCU_SquareRoot \ Library \ CJCU_SquareRoot.cylib. <br><br>  Pour chaque type (entier ou virgule fixe) et pour chaque bit, il existe une solution.  Cela doit √™tre not√©.  La polyvalence est bonne lors du d√©veloppement dans l'√©diteur UDB, mais lors du d√©veloppement √† l'aide de l'outil d'√©dition de Datapath, comme vous pouvez le voir, les gens sont tourment√©s comme √ßa.  N'ayez pas peur si vous ne pouvez pas le faire universellement (mais si cela fonctionne mieux). <br><br>  Au niveau sup√©rieur (circuits), je ne m'arr√™terai pas, nous √©tudions non pas avec PSoC, mais avec UDB.  Examinons une option de complexit√© moyenne - 16 bits, mais entier.  Il se trouve dans le r√©pertoire CJCU_B_Isqrt16_v1_0. <br><br>  La premi√®re chose √† faire est d'√©tendre le graphique de transition du firmware.  Sans cela, nous ne devinerons m√™me pas quel type d'algorithme de racine carr√©e a √©t√© appliqu√©, car Google propose un choix de plusieurs algorithmes fondamentalement diff√©rents. <br><br><img src="https://habrastorage.org/webt/ms/xz/la/msxzlahct34myy-jo6ynzdbyph0.png"><br><br>  Jusqu'√† pr√©sent, rien n'est clair, mais c'est pr√©visible.  Besoin d'ajouter plus d'informations.  Nous examinons le codage d'√©tat.  Il est frappant de constater qu'ils ne sont pas cod√©s dans le code binaire incr√©mentiel habituel. <br><br><img src="https://habrastorage.org/webt/le/ef/ni/leefnikfyhpm0bskxxmyhigc_rk.png"><br><br>  J'ai d√©j√† mentionn√© cette approche dans mes articles, mais je n'ai jamais pu l'utiliser dans des exemples sp√©cifiques.  Permettez-moi de vous rappeler que la configuration dynamique RAM ALU n'a que trois entr√©es d'adresse.  Autrement dit, ALU peut effectuer l'une des huit op√©rations.  Si l'automate a plus d'√©tats, alors la r√®gle ¬´chaque √©tat a son propre fonctionnement¬ª devient impossible.  Par cons√©quent, des √©tats sont s√©lectionn√©s dans lesquels les op√©rations pour l'ALU sont identiques, ils ont trois bits fournis √† l'adresse RAM de la configuration dynamique (g√©n√©ralement de faible ordre), ils sont cod√©s de la m√™me mani√®re et le reste de diff√©rentes mani√®res.  Comment ajouter un tel solitaire est d√©j√† un probl√®me de d√©veloppeur.  Les d√©veloppeurs du code √©tudi√© se sont pli√©s exactement comme indiqu√© ci-dessus. <br><br>  Ajoutez ces informations au graphique et coloriez les √©tats qui ex√©cutent la m√™me fonction dans ALU dans des couleurs similaires. <br><br><img src="https://habrastorage.org/webt/bs/ur/an/bsuran7bbednztvwwhqllpvsxkq.png"><br><br>  Aucun mod√®le ne s'est encore manifest√©, mais nous continuons d'ouvrir le graphique.  Nous ouvrons Datapath Edit Tool et nous y √©tudions d√©j√† la logique. <br><br>  Veuillez noter que nous avons deux blocs Datapath connect√©s en cha√Æne.  Lorsque nous faisons quelque chose de nous-m√™mes, nous pouvons √©galement en avoir besoin (cependant, l'outil d'√©dition de Datapath peut cr√©er des blocs d√©j√† li√©s dans une cha√Æne, donc ce n'est pas effrayant): <br><br><img src="https://habrastorage.org/webt/ww/zy/kp/wwzykp0zjtuvioq7edfl3wgy28w.png"><br><br>  Lors de la lecture (et du remplissage) du graphique correspondant √† ALU, nous ouvrons toujours un document avec la figure suivante: <br><br><img src="https://habrastorage.org/webt/kr/nm/5p/krnm5p5sov_is3aijsvjepxgyz4.png"><br><br>  Certes, les d√©veloppeurs de cet exemple ont pris soin de nous et ont rempli les champs de commentaires.  Nous pouvons maintenant les utiliser pour comprendre ce qui est configur√©.  Dans le m√™me temps, nous constatons pour nous-m√™mes que la r√©daction de commentaires est toujours utile √† la fois pour ceux qui accompagneront le code, et pour nous, quand dans six mois nous oublierons tout. <br><br>  Nous regardons le code X000 correspondant aux √©tats 0 et 12: <br><br><img src="https://habrastorage.org/webt/-f/r3/5_/-fr35_p9nmenndof7gn_k1-iv2a.png"><br><br>  D'apr√®s le commentaire, il est d√©j√† clair ce qui se passe l√†-bas (le contenu du registre D0 est copi√© dans le registre A0, et le contenu de D1 est copi√© dans le registre A1. Sachant cela, nous formons notre intuition pour l'avenir et trouvons une entr√©e similaire dans les champs de param√®tres: <br><br><img src="https://habrastorage.org/webt/6t/nw/jf/6tnwjfjm-ngl_oavbq6gpw29zwy.png"><br><br>  L√†, nous voyons que l'ALU fonctionne en mode <b>PASS</b> , le registre √† d√©calage est √©galement <b>PASS</b> , de sorte qu'aucune autre action n'est r√©ellement effectu√©e. <br><br>  En chemin, nous regardons le texte dans Verilog et voyons o√π la valeur des registres D0 et D1 est √©gale: <br><br><img src="https://habrastorage.org/webt/gv/md/9i/gvmd9i8bc7xc738wf8ozl0fypag.png"><br><br>  Si vous le souhaitez, la m√™me chose peut √™tre vue dans Datapath Config Tool, en choisissant View-&gt; Initial Register Values: <br><br><img src="https://habrastorage.org/webt/hf/2r/i4/hf2ri4nlc3s_npqmpgn0z_l0sbe.png"><br><br><img src="https://habrastorage.org/webt/dl/aw/xi/dlawxi9bjazna2eofwjtslnbriq.png"><br><br>  Pour la visualisation, il est plus pratique d'analyser directement le code Verilog, de cr√©er votre propre version - travaillez via l'√©diteur afin de ne pas garder la syntaxe √† l'esprit. <br><br>  De m√™me, nous analysons (d'abord, en lisant dans les commentaires) toutes les autres fonctions d'ALU: <br><br><img src="https://habrastorage.org/webt/d6/_5/wz/d6_5wzhqokkcgmeiaxskrmeklfc.png"><br><br>  Nous refaisons le graphe de transition de l'automate en tenant compte des nouvelles connaissances: <br><br><img src="https://habrastorage.org/webt/a9/oc/6b/a9oc6b90oehe5lrmrmb1rhpzcv8.png"><br><br>  Quelque chose se profile d√©j√†, mais jusqu'√† pr√©sent, je ne peux mettre en confiance aucun des algorithmes trouv√©s par Google sur ce graphique.  Au contraire, √† propos de certains, vous pouvez dire avec certitude que ce n'est pas eux, mais m√™me pour le cr√©dible, je ne peux toujours pas r√©pondre avec certitude que ce sont eux.  Confond l'utilisation active des registres FIFO F0 et F1.  G√©n√©ralement dans le dossier <br><br>  \ CJCU_SquareRoot \ Library \ CJCU_SquareRoot.cylib \ CJCU_Isqrt_v1_0 \ API \ CJCU_Isqrt.c <br><br>  on peut voir que F1 est utilis√© pour passer l'argument et retourner le r√©sultat: <br><br><img src="https://habrastorage.org/webt/p3/1_/qj/p31_qjeah1fw3va8adkfc3t7zqk.png"><br><br><div class="spoiler">  <b class="spoiler_title">M√™me texte:</b> <div class="spoiler_text"><pre><code class="plaintext hljs">void `$INSTANCE_NAME`_ComputeIsqrtAsync(uint`$regWidth` square) { /* Set up FIFOs, start the computation. */ CY_SET_REG`$dpWidth`(`$INSTANCE_NAME`_F1, square); CY_SET_REG8(`$INSTANCE_NAME`_CTL, 0x01); } ‚Ä¶ uint`$resultWidth` `$INSTANCE_NAME`_ReadIsqrtAsync() { /* Read back result. */ return CY_GET_REG`$dpWidth`(`$INSTANCE_NAME`_F1); }</code> </pre> <br></div></div><br>  Mais un argument et un r√©sultat.  Et pourquoi y a-t-il tant d'appels au FIFO en cours de travail?  Et qu'est-ce que FIFO0 a √† voir avec √ßa?  Coupez-moi en morceaux, mais il semble que les auteurs aient profit√© du mode que l'on rencontrait dans les traductions de la documentation, alors qu'au lieu d'un FIFO √† part enti√®re, ce bloc faisait office de registre unique.  Supposons que les auteurs aient d√©cid√© d'√©largir l'ensemble de registres.  Si oui, alors leur m√©thodologie nous sera utile dans nos travaux pratiques, √©tudions les d√©tails.  En fait, la documentation parle de diff√©rentes approches pour travailler avec FIFO.  Vous pouvez - ainsi, vous pouvez - ainsi, mais vous pouvez - en quelque sorte.  Et pas de d√©tails.  Encore une fois, nous avons la chance de d√©couvrir les meilleures pratiques internationales.  Que font les auteurs avec FIFO? <br><br>  Tout d'abord, ce sont les affectations de signaux: <br><br><pre> <code class="plaintext hljs"> wire f0_load = (state == B_SQRT_STATE_1 || state == B_SQRT_STATE_4); wire f1_load = (state == B_SQRT_STATE_1 || state == B_SQRT_STATE_3 || state == B_SQRT_STATE_9 || state == B_SQRT_STATE_11); wire fifo_dyn = (state == B_SQRT_STATE_0 || state == B_SQRT_STATE_12);</code> </pre><br>  Deuxi√®mement, voici une connexion √† Datapath: <br><br><pre> <code class="plaintext hljs"> /* input */ .f0_load(f0_load), /* input */ .f1_load(f1_load), /* input */ .d0_load(1'b0), /* input */ .d1_load(fifo_dyn),</code> </pre><br>  D'apr√®s la description du contr√¥leur, il n'est pas particuli√®rement clair ce que tout cela signifie.  Mais √† partir de la note d'application, j'ai d√©couvert que ce param√®tre est √† bl√¢mer pour tout: <br><br><img src="https://habrastorage.org/webt/uo/gz/re/uogzrechxp9befe1esnivuooth8.png"><br><br>  Soit dit en passant, pr√©cis√©ment en raison de ce param√®tre, ce bloc ne peut pas √™tre d√©crit √† l'aide de l'√©diteur UDB.  Lorsque ces bits de contr√¥le sont √† l'√©tat <b>ON</b> , FIFO peut fonctionner sur diff√©rentes sources et r√©cepteurs.  Si <b>Dx_LOAD</b> est √©gal √† un, alors <b>Fx</b> √©change avec le bus syst√®me, s'il est nul, alors avec le registre s√©lectionn√© ici: <br><br><img src="https://habrastorage.org/webt/jj/dx/aq/jjdxaqvh9gr1jdfpbv_axilhfac.png"><br><br>  Il s'av√®re que F0 √©change toujours avec le registre A0, et F1 dans les √©tats 12 et 0 - avec le bus syst√®me (pour t√©l√©charger le r√©sultat et charger l'argument), dans les autres √©tats - avec A1. <br>  De plus, √† partir du code Verilog, nous avons d√©couvert que dans F0 les donn√©es seront charg√©es dans les √©tats 1 et 4, et dans F1 - dans les √©tats 1, 3, 9, 11. <br><br>  Ajoutez les connaissances acquises au graphique.  Afin d'√©viter toute confusion lors de la s√©quence des op√©rations, il √©tait √©galement temps de remplacer la marque d'affectation ¬´a la UDB Editor¬ª par des fl√®ches Verilog, pour souligner que la source est la valeur du signal qu'il avait avant d'entrer dans le bloc. <br><br><img src="https://habrastorage.org/webt/ct/xx/hl/ctxxhlmqgxywkwpnvhcneksxnyc.png"><br><br>  Du point de vue de l'analyse de l'algorithme, tout est d√©j√† clair.  Nous avons devant nous une modification d'un tel algorithme: <br><br><pre> <code class="plaintext hljs">uint32_t SquareRoot(uint32_t a_nInput) { uint32_t op = a_nInput; uint32_t res = 0; uint32_t one = 1uL &lt;&lt; 30; // The second-to-top bit is set: use 1u &lt;&lt; 14 for uint16_t type; use 1uL&lt;&lt;30 for uint32_t type // "one" starts at the highest power of four &lt;= than the argument. while (one &gt; op) { one &gt;&gt;= 2; } while (one != 0) { if (op &gt;= res + one) { op -= res + one; res += one &lt;&lt; 1; } res &gt;&gt;= 1; one &gt;&gt;= 2; } return res; }</code> </pre><br>  Ce n'est que par rapport √† notre syst√®me qu'il ressemblera davantage √† ceci: <br><br><pre> <code class="plaintext hljs">uint32_t SquareRoot(uint32_t a_nInput) { uint32_t op = a_nInput; uint32_t res = 0; uint32_t one = 1uL &lt;&lt; 14; // The second-to-top bit is set while (one != 0) { if (op &gt;= res + one) { op -= res + one; res += one &lt;&lt; 1; } res &gt;&gt;= 1; one &gt;&gt;= 2; } return res; }</code> </pre><br>  Les √©tats 4 et 10 codent explicitement la cha√Æne: <br><br><pre> <code class="plaintext hljs"> res &gt;&gt;= 1;</code> </pre><br>  pour diff√©rentes branches. <br><br>  La ligne est: <br><br><pre> <code class="plaintext hljs"> one &gt;&gt;= 2;</code> </pre><br>  il est explicitement cod√© soit par une paire d'√©tats 6 et 7, soit par une paire d'√©tats 9 et 7. Pour l'instant, je veux m'exclamer: "Eh bien, les inventeurs sont les m√™mes auteurs!", mais tr√®s bient√¥t, il deviendra clair pourquoi il y a une telle difficult√© avec deux branches (dans le code C il y a une branche et solution de contournement). <br><br>  L'√©tat 2 code une branche conditionnelle.  L'√©tat 7 code une instruction de boucle.  L'op√©ration de comparaison √† l'√©tape 2 est tr√®s co√ªteuse.  En g√©n√©ral, dans la plupart des √©tapes, le registre A0 contient la variable un.  Mais √† l'√©tape 1, la variable one est d√©charg√©e dans F0, et √† la place la valeur de <b>res + one est</b> charg√©e, puis √† l'√©tape 2 la soustraction est effectu√©e √† des fins de comparaison, et aux √©tapes 3 et 8, la valeur de <b>one</b> est restaur√©e.  Pourquoi, √† l'√©tape 4, A0 est √† nouveau copi√© dans F0, je n'ai pas compris.  C'est peut-√™tre une sorte de rudiment. <br><br>  Reste √† savoir qui est <b>res</b> et qui est <b>op</b> .  Nous savons que la condition compare op et res + one.  Dans l'√©tat 1, A0 ( <b>un</b> ) et A1 sont ajout√©s.  Donc, A1 est <b>res</b> .  Il s'av√®re que dans l'√©tat 11 A1 est √©galement <b>res</b> , et c'est lui qui entre en F1, qui est aliment√© en sortie de la fonction.  F1 dans l'√©tat 1 est clairement <b>op</b> .  Je propose d'introduire la diff√©renciation des couleurs du <s>pantalon des</s> variables.  Nous d√©signons <b>res</b> comme rouge, <b>op</b> comme vert et <b>un</b> comme marron (pas tout √† fait contrast√©, mais les autres couleurs sont encore moins contrast√©es). <br><br><img src="https://habrastorage.org/webt/xl/hs/ns/xlhsnsgsbuqn2s5kdqtv7xh4tac.png"><br><br>  En fait, toute la v√©rit√© est r√©v√©l√©e.  Nous voyons comment A1 change temporairement de F1 pour effectuer des comparaisons et des calculs, comment la m√™me diff√©rence est utilis√©e √† la fois pour la comparaison (en fait, g√©n√©rer le bit C) et pour participer √† la formule.  On voit m√™me pourquoi l'espace vide (bypass) dans l'algorithme C est encod√© par une longue branche du graphe de transition de l'automate (dans cette branche, les registres sont √©chang√©s identiques √† l'√©change intervenant dans la branche principale du code).  Nous voyons tout. <br><br>  La seule question qui ne cesse de me tourmenter est de savoir comment les auteurs ont fait passer FIFO en mode mono-octet?  La documentation indique que pour cela, vous devez augmenter les bits CLR dans le registre de contr√¥le auxiliaire en une unit√©, mais je ne vois pas que l'API a de tels enregistrements.  Peut-√™tre que quelqu'un va comprendre cela et √©crire dans les commentaires. <br><br>  Eh bien, et de d√©velopper quelque chose qui leur est propre - dans l'ordre inverse, en utilisant les comp√©tences acquises. <br><br><h3>  Conclusion </h3><br>  Pour d√©velopper les comp√©tences de d√©veloppement de ¬´firmware¬ª bas√©s sur UDB, il est utile non seulement de lire la documentation, mais aussi de s'inspirer des conceptions d'autres personnes.  Le code fourni avec PSoC Creator peut √™tre utile comme r√©f√©rence, et les mod√®les de comportement inclus avec le compilateur vous aideront √† mieux comprendre ce que signifiait la documentation.  L'article fournit √©galement un lien vers un ensemble d'exemples de fabricants tiers et montre le processus d'analyse d'un de ces exemples. <br><br>  Sur ce point, le cycle des articles prot√©g√©s par le droit d'auteur sur l'utilisation de l'UDB peut √™tre consid√©r√© comme achev√©.  Je serais heureux s'il aidait quelqu'un √† acqu√©rir des connaissances utiles dans la pratique.  Il y a quelques traductions de documentation √† venir, mais les statistiques montrent que presque personne ne les lit.  Ils sont planifi√©s proprement afin de ne pas laisser tomber le sujet en bref. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr449960/">https://habr.com/ru/post/fr449960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr449946/index.html">1C Developer Tales: admin</a></li>
<li><a href="../fr449948/index.html">JavaScript: 7 petites choses utiles</a></li>
<li><a href="../fr449952/index.html">Configuration de la livraison continue sur gitlab.com</a></li>
<li><a href="../fr449954/index.html">Installer Zimbra Open-Source Edition sur CentOS 7</a></li>
<li><a href="../fr449956/index.html">AI @ MIPT: Big data pour les mod√®les math√©matiques du g√©nome humain</a></li>
<li><a href="../fr449962/index.html">Routeurs industriels 4G SmartMotion</a></li>
<li><a href="../fr449964/index.html">Essai routier nanoCAD SPDS Chantier de construction 8. Partie 2</a></li>
<li><a href="../fr449966/index.html">Tableaux dans Figma. Conception d'une grille de donn√©es par un composant</a></li>
<li><a href="../fr449968/index.html">Redmadrobot discute d'AppsConf 2019: vid√©o</a></li>
<li><a href="../fr449970/index.html">Publier sous le drapeau noir, ou comme je n'ai pas mis votre cours vid√©o sur le tracker</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>