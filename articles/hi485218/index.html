<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЪая╕П ЁЯдЩЁЯП╝ ЁЯФЮ рд╕реА # рдореЗрдВ рд╕реНрдерд┐рд░рд╛рдВрдХ рдФрд░ рдЧрд┐рдЯ рд╣реБрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг ЁЯН┤ ЁЯХЙя╕П ЁЯСйЁЯП╗тАНЁЯТ╝</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдЖрдкрдХреЛ рдПрдХ рдХрд╣рд╛рдиреА рд╕реБрдирд╛рддрд╛ рд╣реВрдВред рдПрдХ рдмрд╛рд░ рджреЛ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдереЗ: рд╕реИрдо рдФрд░ рдмреЙрдмред рдЙрдиреНрд╣реЛрдВрдиреЗ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдПрдХ рд╕рд╛рде рдХрд╛рдо рдХрд┐рдпрд╛ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдерд╛ред рдЬрдм рдбреЗрд╡рд▓рдкрд░ рдЗрд╕рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░рдирд╛ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╕реА # рдореЗрдВ рд╕реНрдерд┐рд░рд╛рдВрдХ рдФрд░ рдЧрд┐рдЯ рд╣реБрдХ рдХрд╛ рдирд┐рд░реНрдорд╛рдг</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485218/"><p> рдЖрдкрдХреЛ рдПрдХ рдХрд╣рд╛рдиреА рд╕реБрдирд╛рддрд╛ рд╣реВрдВред  рдПрдХ рдмрд╛рд░ рджреЛ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдереЗ: рд╕реИрдо рдФрд░ рдмреЙрдмред  рдЙрдиреНрд╣реЛрдВрдиреЗ рдПрдХ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдкрд░ рдПрдХ рд╕рд╛рде рдХрд╛рдо рдХрд┐рдпрд╛ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдбреЗрдЯрд╛рдмреЗрд╕ рдерд╛ред  рдЬрдм рдбреЗрд╡рд▓рдкрд░ рдЗрд╕рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛, рддреЛ рдЙрд╕реЗ рдПрдХ рдлрд╛рдЗрд▓ <code>stepNNN.sql</code> , рдЬрд╣рд╛рдБ NNN рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдВрдЦреНрдпрд╛ рд╣реИред  рд╡рд┐рднрд┐рдиреНрди рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рдмреАрдЪ рдЗрди рдирдВрдмрд░реЛрдВ рдХреЗ рдЯрдХрд░рд╛рд╡ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрдиреНрд╣реЛрдВрдиреЗ рдПрдХ рд╕рд╛рдзрд╛рд░рдг рд╡реЗрдм рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдкреНрд░рддреНрдпреЗрдХ рдбреЗрд╡рд▓рдкрд░, SQL рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦрдирд╛ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдЗрд╕ рд╕реЗрд╡рд╛ рдореЗрдВ рдЬрд╛рддрд╛ рдерд╛ рдФрд░ рдЪрд░рдг рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдпрд╛ рдирдВрдмрд░ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рддрд╛ рдерд╛ред </p><br><p>  рдЗрд╕ рдмрд╛рд░, рд╕реИрдо рдФрд░ рдмреЙрдм рджреЛрдиреЛрдВ рдХреЛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред  рд╕реИрдо рдЖрдЬреНрдЮрд╛рдХрд╛рд░реА рд░реВрдк рд╕реЗ рд╕реЗрд╡рд╛ рдореЗрдВ рдЪрд▓рд╛ рдЧрдпрд╛ рдФрд░ 333 рдирдВрдмрд░ рдХреЛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░ рджрд┐рдпрд╛ред рдФрд░ рдмреЙрдм рдЗрд╕реЗ рдХрд░рдирд╛ рднреВрд▓ рдЧрдпрд╛ред  рдЙрдиреНрд╣реЛрдВрдиреЗ рдЕрдкрдиреА рд╕реНрдЯреЗрдк рдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рд╕рд┐рд░реНрдл 333 рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ред  рдРрд╕рд╛ рд╣реБрдЖ рдХрд┐ рдЗрд╕ рдмрд╛рд░ рдмреЙрдм рдиреЗ рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рдЕрдкрдиреЗ рдкрд░рд┐рд╡рд░реНрддрди рдЕрдкрд▓реЛрдб рдХрд┐рдПред  рдЬрдм рд╕реИрдо рдмрд╛рдврд╝ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдерд╛, рддреЛ рдЙрд╕рдиреЗ рдкрд╛рдпрд╛ рдХрд┐ <code>step333.sql</code> рдлрд╝рд╛рдЗрд▓ рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИред  рдЙрдиреНрд╣реЛрдВрдиреЗ рдмреЙрдм рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд┐рдпрд╛, рдЙрдиреНрд╣реЗрдВ рд╕рдордЭрд╛рдпрд╛ рдХрд┐ рд╕рдВрдЦреНрдпрд╛ 333 рдЙрдирдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рдереА рдФрд░ рдЙрдиреНрд╣реЛрдВрдиреЗ рд╕рдВрдШрд░реНрд╖ рдХреЛ рдареАрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╣рд╛ред  рд▓реЗрдХрд┐рди рдмреЙрдм рдиреЗ рдЬрд╡рд╛рдм рджрд┐рдпрд╛: </p><br><p>  - рдпрд╛рд░, рдореЗрд░рд╛ рдХреЛрдб рдкрд╣рд▓реЗ рд╕реЗ рд╣реА 'рдорд╛рд╕реНрдЯрд░' рдореЗрдВ рд╣реИ, рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХрд╛ рдПрдХ рд╕рдореВрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЙрддреНрдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдкрдВрдк рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП рдЖрдк рдЕрдкрдиреА рдЬрд░реВрд░рдд рдХреА рд╣рд░ рдЪреАрдЬ рдХреЛ рдареАрдХ рдХрд░реЗрдВред </p><br><p>  рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдЖрдкрдиреЗ рджреЗрдЦрд╛ рдХрд┐ рдХреНрдпрд╛ рд╣реБрдЖред  рд╕рднреА рдирд┐рдпрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рджрдВрдбрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ред  рд╕реИрдо рдХреЛ рдЕрдкрдиреА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдмрджрд▓рдирд╛ рдкрдбрд╝рд╛, рдЕрдкрдиреЗ рд╕реНрдерд╛рдиреАрдп рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдирд╛ рдкрдбрд╝рд╛, рдЖрджрд┐ред  рдирд┐рдЬреА рддреМрд░ рдкрд░, рдореБрдЭреЗ рдРрд╕реА рд╕реНрдерд┐рддрд┐рдпреЛрдВ рд╕реЗ рдирдлрд░рдд рд╣реИред  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рд╣рдо рдЗрд╕рд╕реЗ рдХреИрд╕реЗ рдмрдЪ рд╕рдХрддреЗ рд╣реИрдВред </p><a name="habracut"></a><br><h2 id="osnovnaya-ideya">  рдореБрдЦреНрдп рд╡рд┐рдЪрд╛рд░ </h2><br><p>  рд╣рдо рдРрд╕реА рдЪреАрдЬреЛрдВ рд╕реЗ рдХреИрд╕реЗ рдмрдЪреЗрдВ?  рдпрджрд┐ рд╡рд╣ рд╡реЗрдм рд╕реЗрд╡рд╛ рдкрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрдЦреНрдпрд╛ рдЖрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рддреЛ рдмреЙрдм рдЕрдкрдиреЗ рдХреЛрдб рдореЗрдВ рдХреНрдпрд╛ рдирд╣реАрдВ рднрд░ рд╕рдХрддрд╛ рд╣реИ? </p><br><p>  рдФрд░ рд╣рдо рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЗрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдкреНрд░рддреНрдпреЗрдХ рдХрдорд┐рдЯ рд╕реЗ рдкрд╣рд▓реЗ рдХрд╕реНрдЯрдо рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Git рд╣реБрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрд╣ рдХреЛрдб рд╕рднреА рдкреБрд╢ рдХрд┐рдП рдЧрдП рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдЧрд╛ред  рдпрджрд┐ рдЙрдирдХреЗ рдкрд╛рд╕ рдПрдХ рдирдИ рдЪрд░рдг рдлрд╝рд╛рдЗрд▓ рд╣реИ, рддреЛ рдХреЛрдб рд╡реЗрдм рд╕реЗрд╡рд╛ рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдЧрд╛ рдФрд░ рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдЪрд░рдг рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рдВрдЦреНрдпрд╛ рд╡рд░реНрддрдорд╛рди рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рд╣реИред  рдФрд░ рдпрджрд┐ рд╕рдВрдЦреНрдпрд╛ рдЖрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИ, рддреЛ рдХреЛрдб рднрд░рдиреЗ рдкрд░ рд░реЛрдХ рд▓рдЧрд╛рдПрдЧрд╛ред </p><br><p>  рдпрд╣реА рдореБрдЦреНрдп рд╡рд┐рдЪрд╛рд░ рд╣реИред  рдЪрд▓рд┐рдП рдбрд┐рдЯреЗрд▓реНрд╕ рдкрд░ рдЪрд▓рддреЗ рд╣реИрдВред </p><br><h2 id="git-hooki-na-c35">  C # рдореЗрдВ рдЧрд┐рдЯ рд╣реБрдХ </h2><br><p>  Git рдЖрдкрдХреЛ рд╕реАрдорд┐рдд рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХрд┐рди рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рд╣реБрдХ рд▓рд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред  C # рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд░реВрдк рдореЗрдВ, рдореИрдВ рдЗрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдЪрд┐рдд C # рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ред  рдХреНрдпрд╛ рдореИрдВ рдРрд╕рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ? </p><br><p>  рд╣рд╛рдБ, рдореИрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБред  рдореИрдХреНрд╕ рд╣реИрдореНрдпреБрд▓рдХ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдЦреЗ рдЧрдП <a href="https://medium.com/%40max.hamulyak/using-c-code-in-your-git-hooks-66e507c01a0f" rel="nofollow">рдЗрд╕ рд▓реЗрдЦ</a> рд╕реЗ рдореВрд▓ рд╡рд┐рдЪрд╛рд░ рдореЗрд░реЗ рджреНрд╡рд╛рд░рд╛ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рд╡реИрд╢реНрд╡рд┐рдХ <a href="https://github.com/filipw/dotnet-script" rel="nofollow">рдбреЙрдЯрдиреЗрдЯ-рд╕реНрдХреНрд░рд┐рдкреНрдЯ</a> рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕ рдЙрдкрдХрд░рдг рдХреЛ рдбреЗрд╡рд▓рдкрд░ рдХреА рдорд╢реАрди рдкрд░ .NET Core 2.1 + SDK рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдореЗрд░рд╛ рдорд╛рдирдирд╛ тАЛтАЛрд╣реИ рдХрд┐ рдпрд╣ .NET рд╡рд┐рдХрд╛рд╕ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдЪрд┐рдд рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  <code>dotnet-script</code> рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИ: </p><br><pre> <code class="bash hljs">&gt; dotnet tool install -g dotnet-script</code> </pre> <br><p>  рдЕрдм рд╣рдо C # рдореЗрдВ Git рд╣реБрдХ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрдкрдиреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ <code>.git\hooks</code> рдлрд╝реЛрд▓реНрдбрд░ рдкрд░ рдЬрд╛рдПрдВ рдФрд░ рдПрдХ <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ (рдмрд┐рдирд╛ рдХрд┐рд╕реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ) рдмрдирд╛рдПрдВ: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script Console.WriteLine("Git hook");</span></span></code> </pre> <br><p>  рдЕрдм рд╕реЗ, рдЬрдм рднреА рдЖрдк рдХреЛрдИ <code>git commit</code> , рддреЛ рдЖрдк рдЕрдкрдиреЗ рдХрдВрд╕реЛрд▓ рдореЗрдВ <code>Git hook</code> рдЯреЗрдХреНрд╕реНрдЯ рджреЗрдЦреЗрдВрдЧреЗред </p><br><h2 id="neskolko-obrabotchikov-na-odin-hook">  рдкреНрд░рддрд┐ рд╣реБрдХ рдПрдХрд╛рдзрд┐рдХ рд╣реИрдВрдбрд▓рд░ </h2><br><p>  рдЦреИрд░, рдПрдХ рд╢реБрд░реБрдЖрдд рдХреА рдЧрдИ рд╣реИред  рдЕрдм рд╣рдо <code>pre-commit</code> рдлрд╛рдЗрд▓ рдореЗрдВ рдХреБрдЫ рднреА рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдореБрдЭреЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдпрд╣ рд╡рд┐рдЪрд╛рд░ рдкрд╕рдВрдж рдирд╣реАрдВ рд╣реИред </p><br><p>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдмрд╣реБрдд рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдирд╣реАрдВ рд╣реИред  рдореИрдВ рдЗрд╕рдХреА рд╕рднреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЕрдкрдиреА рдкрд╕рдВрджреАрджрд╛ рдЖрдИрдбреАрдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реВрдВрдЧрд╛ред  рдФрд░ рдореИрдВ рдЗрд╕рдХреЗ рдмрдЬрд╛рдп рдХрдИ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдЬрдЯрд┐рд▓ рдХреЛрдб рдХреЛ рддреЛрдбрд╝рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рд▓реЗрдХрд┐рди рдПрдХ рдФрд░ рдЪреАрдЬ рд╣реИ рдЬреЛ рдореБрдЭреЗ рдкрд╕рдВрдж рдирд╣реАрдВ рд╣реИ  рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдерд┐рддрд┐ рдХреА рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВред  рдЖрдкрдиреЗ рдХреБрдЫ рддрд░рд╣ рдХреЗ рдЪреЗрдХ рдХреЗ рд╕рд╛рде <code>pre-commit</code> рдмрдирд╛рдпрд╛ред  рд▓реЗрдХрд┐рди рдмрд╛рдж рдореЗрдВ рдЖрдкрдХреЛ рдФрд░ рдЪреЗрдХ рдЬреЛрдбрд╝рдиреЗ рдХреА рдЬрд░реВрд░рдд рдкрдбрд╝реАред  рдЖрдкрдХреЛ рдлрд╝рд╛рдЗрд▓ рдЦреЛрд▓рдиреА рд╣реЛрдЧреА, рдпрд╣ рддрдп рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЕрдкрдирд╛ рдХреЛрдб рдХрд╣рд╛рдБ рдкреЗрд╕реНрдЯ рдХрд░рдирд╛ рд╣реИ, рдпрд╣ рдкреБрд░рд╛рдиреЗ рдХреЛрдб рдХреЗ рд╕рд╛рде рдХреИрд╕реЗ рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░реЗрдЧрд╛, рдЖрджрд┐ред  рдирд┐рдЬреА рддреМрд░ рдкрд░, рдореИрдВ рдирдпрд╛ рдХреЛрдб рд▓рд┐рдЦрдирд╛ рдкрд╕рдВрдж рдХрд░рддрд╛ рд╣реВрдВ, рдФрд░ рдкреБрд░рд╛рдиреЗ рдореЗрдВ рдЦреБрджрд╛рдИ рдирд╣реАрдВ рдХрд░рддрд╛ред </p><br><p>  рдЖрдЗрдП рдПрдХ рдмрд╛рд░ рдореЗрдВ рдЗрди рд╕рдорд╕реНрдпрд╛рдУрдВ рд╕реЗ рдирд┐рдкрдЯреЗрдВред </p><br><h2 id="vyzov-vneshnego-koda">  рдмрд╛рд╣рд░реА рдХреЛрдб рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ </h2><br><p>  рдпрд╣реА рд╣рдо рдХрд░реЗрдВрдЧреЗред  рдЖрдЗрдП рдПрдХ рдЕрд▓рдЧ рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛рдПрдВ (рдЬреИрд╕реЗ <code>gitHookAssemblies</code> )ред  рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ, рдореИрдВ .NET рдХреЛрд░ рдЕрд╕реЗрдВрдмрд▓реА (рдЬреИрд╕реЗ <code>GitHooks</code> ) <code>GitHooks</code> ред  <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдореЗрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрд╕ рд╡рд┐рдзрд╛рдирд╕рднрд╛ рд╕реЗ рдХреБрдЫ рд╡рд┐рдзрд┐ рдХрд╣реЗрдЧреАред </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RunHooks</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunPreCommitHook</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Git hook from assembly"</span></span>); } }</code> </pre> <br><p>  рдореИрдВ рдЕрдкрдиреА рдкрд╕рдВрджреАрджрд╛ рдЖрдИрдбреАрдИ рдореЗрдВ рдпрд╣ рдЕрд╕реЗрдВрдмрд▓реА рдмрдирд╛ рд╕рдХрддрд╛ рд╣реВрдВ рдФрд░ рдХрд┐рд╕реА рднреА рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред </p><br><p>  рдЕрдм <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдореИрдВ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реВрдБ: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "../../gitHookAssemblies/GitHooks.dll" GitHooks.RunHooks.RunPreCommitHook();</span></span></code> </pre> <br><p>  рдорд╣рд╛рди, рдпрд╣ рдирд╣реАрдВ рд╣реИ!  рдЕрдм рдореИрдВ рдХреЗрд╡рд▓ рдЕрдкрдиреЗ <code>GitHooks</code> рдмрд┐рд▓реНрдб рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВред  <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдХреЛрдб рдХрднреА рдирд╣реАрдВ рдмрджрд▓реЗрдЧрд╛ред  рдЬрдм рдореБрдЭреЗ рдХреБрдЫ рд╕рддреНрдпрд╛рдкрди рдЬреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рддреЛ рдореИрдВ <code>RunPreCommitHook</code> рд╡рд┐рдзрд┐ рдХреЗ рдХреЛрдб рдХреЛ рдмрджрд▓ <code>RunPreCommitHook</code> , рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛ рдлрд┐рд░ рд╕реЗ <code>RunPreCommitHook</code> рдФрд░ рдЗрд╕реЗ <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдбрд╛рд▓ <code>gitHookAssemblies</code> ред  рдФрд░ рдпрд╣ рдмрд╛рдд рд╣реИ! </p><br><p>  рдЦреИрд░, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдирд╣реАрдВред </p><br><h2 id="borba-s-keshem">  рдХреИрд╢ рд╕реЗ рд▓рдбрд╝ рд░рд╣реЗ рд╣реИрдВ </h2><br><p>  рдЖрдЗрдП рд╣рдорд╛рд░реА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред  рд╕рдВрджреЗрд╢ рдХреЛ <code>Console.WriteLine</code> рдореЗрдВ рдХреБрдЫ рдФрд░ рдмрджрд▓реЗрдВ, рдЕрд╕реЗрдВрдмрд▓реА рдХрд╛ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХрд░реЗрдВ рдФрд░ рдкрд░рд┐рдгрд╛рдо рдХреЛ <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <code>gitHookAssemblies</code> ред  рдЙрд╕рдХреЗ рдмрд╛рдж, рдлрд┐рд░ рд╕реЗ рдХреЙрд▓ <code>git commit</code> рдХрд░реЗрдВред  рд╣рдо рдХреНрдпрд╛ рджреЗрдЦреЗрдВрдЧреЗ?  рдкреБрд░рд╛рдиреА рдкреЛрд╕реНрдЯред  рд╣рдорд╛рд░реЗ рдмрджрд▓рд╛рд╡ рдирд╣реАрдВ рдкрдХрдбрд╝реЗред  рдХреНрдпреЛрдВ? </p><br><p>  рдЪрд▓реЛ, рдирд┐рд╢реНрдЪрд┐рддрддрд╛ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреА рдкрд░рд┐рдпреЛрдЬрдирд╛ <code>c:\project</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реЛрдЧреАред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ Git рд╣реБрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ <code>c:\project\.git\hooks</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕реНрдерд┐рдд рд╣реИрдВред  рдЕрдм, рдпрджрд┐ рдЖрдк рд╡рд┐рдВрдбреЛрдЬ 10 рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рддреЛ <code>c:\Users\&lt;UserName&gt;\AppData\Local\Temp\scripts\c\project\.git\hooks\</code> рдлрд╝реЛрд▓реНрдбрд░ рдкрд░ рдЬрд╛рдПрдВред  рдпрд╣рд╛рдВ <code>&lt;UserName&gt;</code> рдЖрдкрдХреЗ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ рдирд╛рдо рд╣реИред  рд╣рдо рдпрд╣рд╛рдВ рдХреНрдпрд╛ рджреЗрдЦреЗрдВрдЧреЗ?  рдЬрдм рд╣рдо <code>pre-commit</code> рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдПрдХ рд╕рдВрдХрд▓рд┐рдд рд╕рдВрд╕реНрдХрд░рдг рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдмрдирд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдпрд╣рд╛рдВ рдЖрдк рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рд╕рдВрджрд░реНрднрд┐рдд рд╕рднреА рдЕрд╕реЗрдВрдмрд▓реА (рд╣рдорд╛рд░реЗ <code>GitHooks.dll</code> рд╕рд╣рд┐рдд) рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдФрд░ <code>execution-cache</code> рд╕рдмрдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдЖрдк SHA256 рдлрд╝рд╛рдЗрд▓ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред  рдореИрдВ рдпрд╣ рдорд╛рди рд╕рдХрддрд╛ рд╣реВрдВ рдХрд┐ рдЗрд╕рдореЗрдВ рд╣рдорд╛рд░реА <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдХрд╛ SHA256 рд╣реИрд╢ рд╢рд╛рдорд┐рд▓ рд╣реИред  рдЬрд┐рд╕ рдХреНрд╖рдг рд╣рдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓рд╛рддреЗ рд╣реИрдВ, рд░рдирдЯрд╛рдЗрдо рдлрд╝рд╛рдЗрд▓ рдХреА рд╡рд░реНрддрдорд╛рди рд╣реИрд╢ рдХреА рддреБрд▓рдирд╛ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реИрд╢ рд╕реЗ рдХрд░рддрд╛ рд╣реИред  рдпрджрд┐ рд╡реЗ рд╕рдорд╛рди рд╣реИрдВ, рддреЛ рд╕рдВрдХрд▓рд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╣реЗрдЬреЗ рдЧрдП рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реИ рдХрд┐ рдЪреВрдВрдХрд┐ рд╣рдо <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХрднреА рдирд╣реАрдВ рдмрджрд▓рддреЗ рд╣реИрдВ, <code>GitHooks.dll</code> рдкрд░рд┐рд╡рд░реНрддрди рдХрднреА рднреА рдХреИрд╢ рддрдХ рдирд╣реАрдВ рдкрд╣реБрдВрдЪреЗрдВрдЧреЗ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрднреА рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣рдо рдХреНрдпрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ?  рдЦреИрд░, рдкреНрд░рддрд┐рдмрд┐рдВрдм рд╣рдорд╛рд░реА рдорджрдж рдХрд░реЗрдЧрд╛ред  рдореИрдВ рдЕрдкрдиреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд┐рд░ рд╕реЗ <code>GitHooks</code> рд╡рд╣ <code>GitHooks</code> рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛ рд╕реАрдзреЗ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдкреНрд░рддрд┐рдмрд┐рдВрдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗред  рдЗрд╕рдХреЗ рдмрд╛рдж рд╣рдорд╛рд░реА <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "nuget: System.Runtime.Loader, 4.3.0" using System.IO; using System.Runtime.Loader; var hooksDirectory = Path.Combine(Environment.CurrentDirectory, "gitHookAssemblies"); var assemblyPath = Path.Combine(hooksDirectory, "GitHooks.dll"); var assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(assembly == null) { Console.WriteLine($"Can't load assembly from '{assemblyPath}'."); } var collectorsType = assembly.GetType("GitHooks.RunHooks"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(collectorsType == null) { Console.WriteLine("Can't find entry type."); } var method = collectorsType.GetMethod("RunPreCommitHook", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(method == null) { Console.WriteLine("Can't find method for pre-commit hooks."); } method.Invoke(null, new object[0]);</span></span></code> </pre> <br><p>  рдЕрдм рд╣рдо рдХрд┐рд╕реА рднреА рд╕рдордп рдЕрдкрдиреЗ <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <code>GitHook.dll</code> рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рд╕рднреА рдкрд░рд┐рд╡рд░реНрддрди рдПрдХ рд╣реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рдЙрдард╛рдП рдЬрд╛рдПрдВрдЧреЗред  рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдЕрдм рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИред </p><br><p>  рдпрд╣ рд╕рдм рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХ рдФрд░ рд╕рдорд╕реНрдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╣рд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдореИрдВ рд╣рдорд╛рд░реЗ рдХреЛрдб рджреНрд╡рд╛рд░рд╛ рд╕рдВрджрд░реНрднрд┐рдд рдЕрд╕реЗрдВрдмрд▓рд┐рдпреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░ рд░рд╣рд╛ рд╣реВрдВред </p><br><h2 id="ispolzuemye-sborki">  рд╡рд┐рдзрд╛рдирд╕рднрд╛рдУрдВ рдХрд╛ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ </h2><br><p>  рд╕рдм рдХреБрдЫ рдареАрдХ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдЬрдм рддрдХ рдХрд┐ рдХреЗрд╡рд▓ рдПрдХ рдЪреАрдЬ <code>RunHooks.RunPreCommitHook</code> рд╡рд┐рдзрд┐ <code>RunHooks.RunPreCommitHook</code> рд╣реИ рдЖрдЙрдЯрдкреБрдЯ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЛ рдХрдВрд╕реЛрд▓ рдкрд░ рдЖрдЙрдЯрдкреБрдЯ <code>RunHooks.RunPreCommitHook</code> рд╣реИред  рд▓реЗрдХрд┐рди, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ, рдЖрдорддреМрд░ рдкрд░ рд╕реНрдХреНрд░реАрди рдкрд░ рдкрд╛рда рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдирд╛ рдХреЛрдИ рджрд┐рд▓рдЪрд╕реНрдкреА рдирд╣реАрдВ рд╣реИред  рд╣рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдЪреАрдЬреЗрдВ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИред  рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдЕрдиреНрдп рд╡рд┐рдзрд╛рдирд╕рднрд╛рдУрдВ рдФрд░ NuGet рдкреИрдХреЗрдЬреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЖрдЗрдП рджреЗрдЦреЗрдВ рдХрд┐ рдпрд╣ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИред </p><br><p>  рдореИрдВ <code>RunHooks.RunPreCommitHook</code> рдХреЛ <code>RunHooks.RunPreCommitHook</code> рддрд╛рдХрд┐ рдпрд╣ <code>LibGit2Sharp</code> рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗ: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunPreCommitHook</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Repository(Environment.CurrentDirectory); Console.WriteLine(repo.Info.WorkingDirectory); }</code> </pre> <br><p>  рдЕрдм, рдпрджрд┐ рдореИрдВ <code>git commit</code> рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реВрдВ, рддреЛ рдореБрдЭреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдорд┐рд▓реЗрдЧрд╛: </p><br><pre> <code class="plaintext hljs">System.Reflection.TargetInvocationException: Exception has been thrown by the target of an invocation. ---&gt; System.IO.FileLoadException: Could not load file or assembly 'LibGit2Sharp, Version=0.26.0.0, Culture=neutral, PublicKeyToken=7cbde695407f0333'. General Exception (0x80131500)</code> </pre> <br><p>  рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ, рд╣рдореЗрдВ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рддрд░рд╣ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЬрд┐рди рд╡рд┐рдзрд╛рдирд╕рднрд╛рдУрдВ рдХреЛ рд╣рдо рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рднрд░реА рд╣реБрдИ рд╣реИрдВред  рдореВрд▓ рд╡рд┐рдЪрд╛рд░ рдпрд╣рд╛рдБ рд╣реИред  рдореИрдВ рдЕрдкрдиреЗ <code>GitHooks.dll</code> рдХреЗ рд╕рд╛рде рд╕рдорд╛рди <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╕рднреА рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдХреЛрдб <code>GitHooks.dll</code> ред  рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рд╡рд┐рдзрд╛рдирд╕рднрд╛рдУрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк <code>dotnet publish</code> рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдЗрд╕ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <code>LibGit2Sharp.dll</code> рдФрд░ <code>git2-7ce88e6.dll</code> рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред </p><br><p>  рд╣рдореЗрдВ <code>pre-commit</code> рдХреЛ рднреА рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред  рд╣рдо рдЗрд╕рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдЬреЛрдбрд╝реЗрдВрдЧреЗ: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "nuget: System.Runtime.Loader, 4.3.0" using System.IO; using System.Runtime.Loader; var hooksDirectory = Path.Combine(Environment.CurrentDirectory, "gitHookAssemblies"); var assemblyPath = Path.Combine(hooksDirectory, "GitHooks.dll"); AssemblyLoadContext.Default.Resolving += (context, assemblyName) =&gt; { var assemblyPath = Path.Combine(hooksDirectory, $"{assemblyName.Name}.dll"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(File.Exists(assemblyPath)) { return AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); } return null; }; ...</span></span></code> </pre> <br><p>  рдпрд╣ рдХреЛрдб рдЙрди рд╕рднреА рдЕрд╕реЗрдВрдмрд▓реА рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ рдЬреЛ рд░рдирдЯрд╛рдЗрдо <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рд╕реЗ рдЕрдкрдиреЗ рдЖрдк рдирд╣реАрдВ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред </p><br><p>  рдЕрдм рдЖрдк <code>git commit</code> рдЪрд▓рд╛ рд╕рдХрддреЗ <code>git commit</code> рдФрд░ рдпрд╣ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдЪрд▓реЗрдЧрд╛ред </p><br><h2 id="uluchshenie-rasshiryaemosti">  рд╡реНрдпрд╛рдкрдХрддрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ </h2><br><p>  рд╣рдорд╛рд░реА <code>pre-commit</code> рдлрд╝рд╛рдЗрд▓ рдкреВрд░реНрдг рд╣реЛ рдЧрдИ рд╣реИред  рд╣рдореЗрдВ рдЕрдм рдЗрд╕реЗ рдмрджрд▓рдиреЗ рдХреА рдЬрд░реВрд░рдд рдирд╣реАрдВ рд╣реИред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдЖрдкрдХреЛ рдмрджрд▓рд╛рд╡ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ <code>RunHooks.RunPreCommitHook</code> рд╡рд┐рдзрд┐ рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП рд╣рдордиреЗ рд╕рдорд╕реНрдпрд╛ рдХреЛ рджреВрд╕рд░реЗ рд╕реНрддрд░ рдкрд░ рд▓реЗ рдЬрд╛рдпрд╛ред  рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ, рдореИрдВ рдХрд┐рд╕реА рддрд░рд╣ рдХрд╛ рдкреНрд▓рдЧрдЗрди рд╕рд┐рд╕реНрдЯрдо рд░рдЦрдирд╛ рдкрд╕рдВрдж рдХрд░реВрдВрдЧрд╛ред  рд╣рд░ рдмрд╛рд░ рдХреЛрдб рдореЗрдВ рднрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдореБрдЭреЗ рдХреБрдЫ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдореИрдВ рд╕рд┐рд░реНрдл рдПрдХ рдирдпрд╛ рдкреНрд▓рдЧрдЗрди рд▓рд┐рдЦреВрдВрдЧрд╛ рдФрд░ рдХреБрдЫ рднреА рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрдЧреАред  рдЗрд╕реЗ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдирд╛ рдХрд┐рддрдирд╛ рдХрдард┐рди рд╣реИ? </p><br><p>  рдореБрд╢реНрдХрд┐рд▓ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВред  рдЖрдЗрдП <a href="https://docs.microsoft.com/en-us/dotnet/framework/mef/" rel="nofollow">MEF</a> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред  рдпрд╣ рдЗрд╕реА рддрд░рд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред </p><br><p>  рдкрд╣рд▓реЗ рд╣рдореЗрдВ рдЕрдкрдиреЗ рд╣реБрдХ рд╣реИрдВрдбрд▓рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  рдкреНрд░рддреНрдпреЗрдХ рд╣реИрдВрдбрд▓рд░ рдЧрд┐рдЯ рд╕реЗ рдХреБрдЫ рд╕реНрдЯреНрд░рд┐рдВрдЧ рддрд░реНрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред  рдЗрди рддрд░реНрдХреЛрдВ рдХреЛ <code>args</code> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдпрджрд┐ рдпрд╣ рдкрд░рд┐рд╡рд░реНрддрди рдбрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ <code>true</code> рддреЛ <code>Process</code> рд╡рд┐рдзрд┐ <code>true</code> рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдЧреАред  рдЕрдиреНрдпрдерд╛ <code>false</code> рд╡рд╛рдкрд╕ рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред </p><br><p>  рд╕рднреА рд╣реБрдХ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рди рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рд╣рдо рдХреЗрд╡рд▓ рдкреВрд░реНрд╡-рдкреНрд░рддрд┐рдмрджреНрдз рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рдХрд░реЗрдВрдЧреЗред </p><br><p>  рдЕрдм рдЖрдкрдХреЛ рдЗрд╕ рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд▓рд┐рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Export(typeof(IPreCommitHook))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MessageHook</span></span> : <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Message hook..."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(args != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"Arguments are:"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> args) { Console.WriteLine(arg); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p>  рдпрджрд┐ рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдЗрд╕ рддрд░рд╣ рдХреА рдХрдХреНрд╖рд╛рдПрдВ рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдзрд╛рдирд╕рднрд╛рдУрдВ рдореЗрдВ рдмрдирд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред  рд╕рдЪрдореБрдЪ рдХреЛрдИ рдкреНрд░рддрд┐рдмрдВрдз рдирд╣реАрдВ рд╣реИрдВред  <code>Export</code> рд╡рд┐рд╢реЗрд╖рддрд╛ <code>System.ComponentModel.Composition</code> NuGet рдкреИрдХреЗрдЬ рд╕реЗ рд▓реА рдЧрдИ рд╣реИред </p><br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдЗрдП рдПрдХ рд╕рд╣рд╛рдпрдХ рд╡рд┐рдзрд┐ рдмрдирд╛рдПрдВ рдЬреЛ <code>Export</code> рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рд╕рд╛рде рдЪрд┐рд╣реНрдирд┐рдд рд╕рднреА <code>IPreCommitHook</code> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░реЗрдЧрд╛, рдЙрди рд╕рднреА рдХреЛ рдЪрд▓рд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд▓реМрдЯрд╛рдПрдЧрд╛ рдХрд┐ рдХреНрдпрд╛ рдЙрдиреНрд╣реЛрдВрдиреЗ рд╕рднреА рдХреЛ рднрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдереАред  рдореИрдВрдиреЗ рдЕрдкрдирд╛ рд╣реИрдВрдбрд▓рд░ рдПрдХ рдЕрд▓рдЧ <code>GitHooksCollector</code> рдЕрд╕реЗрдВрдмрд▓реА рдореЗрдВ <code>GitHooksCollector</code> , рд▓реЗрдХрд┐рди рдпрд╣ рдЗрддрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Collectors</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PreCommitHooks</span></span> { [ImportMany(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(IPreCommitHook))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IPreCommitHook[] Hooks { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RunPreCommitHooks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> directory</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> catalog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DirectoryCatalog(directory, <span class="hljs-string"><span class="hljs-string">"*Hooks.dll"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CompositionContainer(catalog); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PreCommitHooks(); container.ComposeParts(obj); <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> success = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hook <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> obj.Hooks) { success &amp;= hook.Process(args); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> success ? <span class="hljs-number"><span class="hljs-number">0</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br><p>  рдпрд╣ рдХреЛрдб <code>System.ComponentModel.Composition</code> NuGet рдкреИрдХреЗрдЬ рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рдХрд╣рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдо рдЙрди рд╕рднреА рдЕрд╕реЗрдВрдмрд▓реА рдХреЛ <code>*Hooks.dll</code> рдЬрд┐рдирдХреЗ рдирд╛рдо <code>directory</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <code>*Hooks.dll</code> рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕реЗ рдореЗрд▓ рдЦрд╛рддреЗ рд╣реИрдВред  рдЖрдк рдпрд╣рд╛рдБ рдХрд┐рд╕реА рднреА рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдлрд┐рд░ рд╣рдо рдПрдХ <code>PreCommitHooks</code> рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ <code>IPreCommitHook</code> рдЗрдВрдЯрд░рдлрд╝реЗрд╕ рдХреЗ рд╕рднреА рдирд┐рд░реНрдпрд╛рддрд┐рдд рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдПрдХрддреНрд░ рдХрд░рддреЗ рд╣реИрдВред  рдФрд░ рдЕрдВрдд рдореЗрдВ, рд╣рдо рд╕рднреА рд╣реБрдХ рд╣реИрдВрдбрд▓рд░ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдирдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХрд╛ рдкрд░рд┐рдгрд╛рдо рдПрдХрддреНрд░ рдХрд░рддреЗ рд╣реИрдВред </p><br><p>  рдЖрдЦрд┐рд░реА рдЪреАрдЬ рдЬреЛ рд╣рдореЗрдВ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рд╡рд╣ рд╣реИ <code>pre-commit</code> рдлрд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рд╕рд╛ рдмрджрд▓рд╛рд╡: </p><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#!/usr/bin/env dotnet-script #r "nuget: System.Runtime.Loader, 4.3.0" using System.IO; using System.Runtime.Loader; var hooksDirectory = Path.Combine(Environment.CurrentDirectory, "gitHookAssemblies"); var assemblyPath = Path.Combine(hooksDirectory, "GitHooksCollector.dll"); AssemblyLoadContext.Default.Resolving += (context, assemblyName) =&gt; { var assemblyPath = Path.Combine(hooksDirectory, $"{assemblyName.Name}.dll"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(File.Exists(assemblyPath)) { return AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); } return null; }; var assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(assemblyPath); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(assembly == null) { Console.WriteLine($"Can't load assembly from '{assemblyPath}'."); } var collectorsType = assembly.GetType("GitHooksCollector.Collectors"); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(collectorsType == null) { Console.WriteLine("Can't find collector's type."); } var method = collectorsType.GetMethod("RunPreCommitHooks", System.Reflection.BindingFlags.Public | System.Reflection.BindingFlags.Static); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta">(method == null) { Console.WriteLine("Can't find collector's method for pre-commit hooks."); } int exitCode = (int) method.Invoke(null, new object[] { Args, hooksDirectory }); Environment.Exit(exitCode);</span></span></code> </pre> <br><p>  рдФрд░ <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рднреА рд╢рд╛рдорд┐рд▓ рдЕрд╕реЗрдВрдмрд▓рд┐рдпреЛрдВ рдХреЛ рд░рдЦрдирд╛ рди рднреВрд▓реЗрдВред </p><br><p>  рд╣рд╛рдБ, рдпрд╣ рдПрдХ рд▓рдВрдмрд╛ рдкрд░рд┐рдЪрдп рдерд╛ред  рд▓реЗрдХрд┐рди рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ C # рдореЗрдВ Git рд╣реБрдХ рд╣реИрдВрдбрд▓рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╕рдорд╛рдзрд╛рди рд╣реИред  рд╣рдо рд╕рднреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрджрд▓рдирд╛ рд╣реИред  рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рд╕рдВрд╕реНрдХрд░рдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рдгрд╛рд▓реА рдореЗрдВ рд░рдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╕рднреА рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЗ рдмреАрдЪ рд╡рд┐рддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдХрд┐рд╕реА рднреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдореЗрдВ рдЕрдкрдиреА рдореВрд▓ рд╕рдорд╕реНрдпрд╛ рдкрд░ рд▓реМрдЯрдиреЗ рдХрд╛ рд╕рдордп рд╣реИред </p><br><h2 id="web-servis-dlya-rezervirovaniya-konstant">  рдирд┐рд░рдВрддрд░ рдЖрд░рдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рд╡реЗрдм рд╕реЗрд╡рд╛ </h2><br><p>  рд╣рдо рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рдереЗ рдХрд┐ рдЕрдЧрд░ рд╡реЗ рд╡реЗрдм рд╕реЗрд╡рд╛ рдкрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЛ рдЖрд░рдХреНрд╖рд┐рдд рдХрд░рдирд╛ рднреВрд▓ рдЧрдП, рддреЛ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреБрдЫ рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рдирд╣реАрдВ рднрд░ рдкрд╛рдПрдВрдЧреЗред  рдЖрдЗрдП рдПрдХ рд╕рд░рд▓ рд╡реЗрдм рд╕реЗрд╡рд╛ рдмрдирд╛рдПрдВ рддрд╛рдХрд┐ рдЖрдк рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХреЗрдВред  рдореИрдВ Windows рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд╕рд╛рде ASP.NET рдХреЛрд░ рд╡реЗрдм рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реВрдВред  рд▓реЗрдХрд┐рди рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╡рд┐рднрд┐рдиреНрди рд╡рд┐рдХрд▓реНрдк рд╣реИрдВред </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Authorization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Mvc; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ListsService.Controllers</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListItem</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ListItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> owner</span></span></span><span class="hljs-function">)</span></span> { Value = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; Owner = owner; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Owner { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Lists</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt; SqlVersions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">@"DOMAIN\Iakimov"</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt;&gt; AllLists = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, List&lt;ListItem&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;&gt;&gt; { {<span class="hljs-number"><span class="hljs-number">1</span></span>, SqlVersions} }; } [Authorize] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListsController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { [Route(<span class="hljs-string"><span class="hljs-string">"/api/lists/{listId}/ownerOf/{itemId}"</span></span>)] [HttpGet] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOwner</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Lists.AllLists.ContainsKey(listId)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NotFound(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item = Lists.AllLists[listId].FirstOrDefault(li =&gt; li.Value == itemId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(item == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NotFound(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Json(item.Owner); } } }</code> </pre> <br><p>  рдпрд╣рд╛рдБ, рдкрд░реАрдХреНрд╖рдг рдХреЗ рдкреНрд░рдпреЛрдЬрдиреЛрдВ рдХреЗ рд▓рд┐рдП, рдореИрдВрдиреЗ рд╕реНрдЯреИрдЯрд┐рдХ <code>Lists</code> рд╡рд░реНрдЧ рдХреЛ рд╕реВрдЪреА рд╕рдВрдЧреНрд░рд╣ рдХреЗ рд▓рд┐рдП рдПрдХ рддрдВрддреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ред  рдкреНрд░рддреНрдпреЗрдХ рд╕реВрдЪреА рдореЗрдВ рдПрдХ рдкреВрд░реНрдгрд╛рдВрдХ рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рд╣реЛрдЧрд╛ред  рдкреНрд░рддреНрдпреЗрдХ рд╕реВрдЪреА рдореЗрдВ рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рди рдФрд░ рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд╣реЛрдЧреА рдЬрд┐рдирдХреЗ рд▓рд┐рдП рдпреЗ рдореВрд▓реНрдп рдЖрд░рдХреНрд╖рд┐рдд рд╣реИрдВред  <code>GetOwner</code> рд╡рд░реНрдЧ рдХреА <code>GetOwner</code> рд╡рд┐рдзрд┐ рдЖрдкрдХреЛ рдЙрд╕ рд╡реНрдпрдХреНрддрд┐ рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬрд┐рд╕рдХреЗ рд▓рд┐рдП рдпрд╣ рд╕реВрдЪреА рдЖрдЗрдЯрдо рдЖрд░рдХреНрд╖рд┐рдд рд╣реИред </p><br><h2 id="proverka-sql-step-faylov">  SQL рдЪрд░рдг рдлрд╝рд╛рдЗрд▓реЗрдВ рдорд╛рдиреНрдп рдХрд░рдирд╛ </h2><br><p>  рдЕрдм рд╣рдо рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╣рдо рдПрдХ рдирдИ рдЪрд░рдг-рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдирд╣реАрдВред  рдирд┐рд╢реНрдЪрд┐рддрддрд╛ рдХреЗ рд▓рд┐рдП, рдорд╛рди рд▓реЗрдВ рдХрд┐ рд╣рдо рдЪрд░рдг рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВред  рд╣рдорд╛рд░реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЗ рд░реВрдЯ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рдПрдХ <code>sql</code> рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╣реИред  рдЗрд╕рдореЗрдВ, рдкреНрд░рддреНрдпреЗрдХ рдбреЗрд╡рд▓рдкрд░ рдПрдХ <code>verXXX</code> рдлрд╝реЛрд▓реНрдбрд░ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ <code>XXX</code> рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕рдВрдЦреНрдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдкрд╣рд▓реЗ рд╡реЗрдм рд╕реЗрд╡рд╛ рдкрд░ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  <code>verXXX</code> рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░, рдбреЗрдЯрд╛рдмреЗрд╕ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдиреЗ рдХреЗ рдирд┐рд░реНрджреЗрд╢ рд╡рд╛рд▓реА рдПрдХ рдпрд╛ рдЕрдзрд┐рдХ <code>.sql</code> рдлрд╛рдЗрд▓реЗрдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред  рд╣рдо рдЗрди <code>.sql</code> рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреНрд░рдо рдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреА рд╕рдорд╕реНрдпрд╛ рдкрд░ рдпрд╣рд╛рдБ рдЪрд░реНрдЪрд╛ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  рдпрд╣ рд╣рдорд╛рд░реА рдЪрд░реНрдЪрд╛ рдХреЗ рд▓рд┐рдП рдорд╣рддреНрд╡рдкреВрд░реНрдг рдирд╣реАрдВ рд╣реИред  рд╣рдо рдмрд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдпрджрд┐ рдХреЛрдИ рдбреЗрд╡рд▓рдкрд░ <code>sql/verXXX</code> рдирд┐рд╣рд┐рдд рдПрдХ рдирдИ рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдпрд╣ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдирд┐рд░рдВрддрд░ <code>XXX</code> рдЗрд╕ рдбреЗрд╡рд▓рдкрд░ рдХреЗ рд▓рд┐рдП рдЖрд░рдХреНрд╖рд┐рдд рд╣реИ рдпрд╛ рдирд╣реАрдВред </p><br><p>  рдпрд╣рд╛рдБ Git рд╣реБрдХ рд╣реИрдВрдбрд▓рд░ рдХреЗ рд▓рд┐рдП рдХреЛрдб рдЗрд╕ рддрд░рд╣ рджрд┐рдЦрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Export(typeof(IPreCommitHook))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SqlStepsHook</span></span> : <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Regex _expr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Regex(<span class="hljs-string"><span class="hljs-string">"\\bver(\\d+)\\b"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Repository(Environment.CurrentDirectory); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = repo.RetrieveStatus() .Where(i =&gt; !i.State.HasFlag(FileStatus.Ignored)) .Where(i =&gt; i.State.HasFlag(FileStatus.NewInIndex)) .Where(i =&gt; i.FilePath.StartsWith(<span class="hljs-string"><span class="hljs-string">@"sql"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> versions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;( items .Select(i =&gt; _expr.Match(i.FilePath)) .Where(m =&gt; m.Success) .Select(m =&gt; m.Groups[<span class="hljs-number"><span class="hljs-number">1</span></span>].Value) .Select(d =&gt; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.Parse(d)) ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> version <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> versions) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ListItemOwnerChecker.DoesCurrentUserOwnListItem(<span class="hljs-number"><span class="hljs-number">1</span></span>, version)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p>  рдпрд╣рд╛рдБ рд╣рдо NuGet рдкреИрдХреЗрдЬ <code>LibGit2Sharp</code> рд╕реЗ <code>Repository</code> рд╡рд░реНрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред  <code>items</code> рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ Git рдЗрдВрдбреЗрдХреНрд╕ рдореЗрдВ рд╕рднреА рдирдИ рдлрд╛рдЗрд▓реЗрдВ рд╣реЛрдВрдЧреА рдЬреЛ <code>sql</code> рдлреЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░ рд╕реНрдерд┐рдд рд╣реИрдВред  рдЖрдк рдЪрд╛рд╣реЗрдВ рддреЛ рдРрд╕реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  <code>versions</code> рд╡реЗрд░рд┐рдПрдмрд▓ рдореЗрдВ рд╣рдо <code>verXXX</code> рдлреЛрд▓реНрдбрд░ рд╕реЗ рд╡рд┐рднрд┐рдиреНрди <code>verXXX</code> <code>XXX</code> рдПрдХрддреНрд░ рдХрд░рддреЗ рд╣реИрдВред  рдЕрдВрдд рдореЗрдВ, <code>ListItemOwnerChecker.DoesCurrentUserOwnListItem</code> рд╡рд┐рдзрд┐ рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪ рдХрд░рддреА рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдпреЗ рд╕рдВрд╕реНрдХрд░рдг рд╕реВрдЪреА 1 рдореЗрдВ рд╡реЗрдм рд╕реЗрд╡рд╛ рдореЗрдВ рд╡рд░реНрддрдорд╛рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╕рд╛рде рдкрдВрдЬреАрдХреГрдд рд╣реИрдВред </p><br><p>  <code>ListItemOwnerChecker.DoesCurrentUserOwnListItem</code> рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ListItemOwnerChecker</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetListItemOwner</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> handler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClientHandler { UseDefaultCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(handler); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> response = client.GetAsync(<span class="hljs-string"><span class="hljs-string">$"https://localhost:44389/api/lists/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{listId}</span></span></span><span class="hljs-string">/ownerOf/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{itemId}</span></span></span><span class="hljs-string">"</span></span>) .ConfigureAwait(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) .GetAwaiter() .GetResult(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.StatusCode == System.Net.HttpStatusCode.NotFound) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner = response.Content .ReadAsStringAsync() .ConfigureAwait(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) .GetAwaiter() .GetResult(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> JsonConvert.DeserializeObject&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(owner); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoesCurrentUserOwnListItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> listId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> itemId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> owner = GetListItemOwner(listId, itemId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (owner == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"There is no item '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{itemId}</span></span></span><span class="hljs-string">' in the list '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{listId}</span></span></span><span class="hljs-string">' registered on the lists service."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (owner != WindowsIdentity.GetCurrent().Name) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"Item '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{itemId}</span></span></span><span class="hljs-string">' in the list '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{listId}</span></span></span><span class="hljs-string">' registered by '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{owner}</span></span></span><span class="hljs-string">' and you are '</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{WindowsIdentity.GetCurrent().Name}</span></span></span><span class="hljs-string">'."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre> <br><p>  рдпрд╣рд╛рдВ рд╣рдо рдЙрд╕ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рд╡реЗрдм рд╕реЗрд╡рд╛ рд╕реЗ рдкреВрдЫрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдиреЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реНрдерд┐рд░рд╛рдВрдХ ( <code>GetListItemOwner</code> рд╡рд┐рдзрд┐) рдХреЛ рдкрдВрдЬреАрдХреГрдд рдХрд┐рдпрд╛ рд╣реИред  рдлрд┐рд░ рдкрд░рд┐рдгрд╛рдо рдХреА рд╡рд░реНрддрдорд╛рди рд╡рд┐рдВрдбреЛрдЬ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд╛рдо рдХреЗ рд╕рд╛рде рддреБрд▓рдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред  рдпрд╣ рдЗрд╕ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рдХрдИ рд╕рдВрднрд╛рд╡рд┐рдд рддрд░реАрдХреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк Git рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдпрд╛ рдИрдореЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред </p><br><p>  рд╡рд╣ рд╕рдм рд╣реИред  рдмрд╕ рдЙрдкрдпреБрдХреНрдд рд╡рд┐рдзрд╛рдирд╕рднрд╛ рд╕рдВрдХрд▓рд┐рдд рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреЗ рд╕рднреА рдирд┐рд░реНрднрд░рддрд╛ рдХреЗ рд╕рд╛рде <code>gitHookAssemblies</code> рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ <code>gitHookAssemblies</code> ред  рдФрд░ рд╕рдм рдХреБрдЫ рдЕрдкрдиреЗ рдЖрдк рдХрд╛рдо рдХрд░реЗрдЧрд╛ред </p><br><h2 id="proverka-znacheniy-enum">  Enum рдорд╛рди рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ </h2><br><p>  рдпрд╣ рдорд╣рд╛рди рд╣реИ!  рдЕрдм рдХреЛрдИ рднреА рд╡реЗрдм рд╕реЗрд╡рд╛ рдкрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЖрд░рдХреНрд╖рд┐рдд рдХрд┐рдП рдмрд┐рдирд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рд▓реЗрдХрд┐рди рдПрдХ рд╕рдорд╛рди рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЕрдиреНрдп рд╕реНрдерд╛рдиреЛрдВ рдкрд░ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдирд┐рд░рдВрддрд░ рдЖрд░рдХреНрд╖рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред </p><br><p>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХрд╣реАрдВ рди рдХрд╣реАрдВ рдЖрдкрдХреЗ рдкрд╛рд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛрдб рд╣реИред  рдкреНрд░рддреНрдпреЗрдХ рдбреЗрд╡рд▓рдкрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдкреВрд░реНрдгрд╛рдВрдХ рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде рдЗрд╕рдореЗрдВ рдирдП рд╕рджрд╕реНрдп рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Constants { Val1 = <span class="hljs-number"><span class="hljs-number">1</span></span>, Val2 = <span class="hljs-number"><span class="hljs-number">2</span></span>, Val3 = <span class="hljs-number"><span class="hljs-number">3</span></span> }</code> </pre> <br><p>  рд╣рдо рдЗрд╕ рдЧрдгрдирд╛ рдХреЗ рд╕рджрд╕реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдореВрд▓реНрдпреЛрдВ рдХреА рдЯрдХреНрдХрд░ рд╕реЗ рдмрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдЗрд╕рд▓рд┐рдП, рд╣рдореЗрдВ рд╡реЗрдм рд╕реЗрд╡рд╛ рдкрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕реНрдерд┐рд░рд╛рдВрдХ рдХреЗ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЖрд░рдХреНрд╖рдг рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдРрд╕реЗ рдЖрд░рдХреНрд╖рдг рдХреЗ рд╕рддреНрдпрд╛рдкрди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ рдХрд┐рддрдирд╛ рдХрдард┐рди рд╣реИ? </p><br><p>  рдпрд╣рд╛рдБ рдирдП рдЧрд┐рдЯ рд╣реБрдХ рд╣реИрдВрдбрд▓рд░ рдХреЗ рд▓рд┐рдП рдХреЛрдб рд╣реИ: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Export(typeof(IPreCommitHook))</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ConstantValuesHook</span></span> : <span class="hljs-title"><span class="hljs-title">IPreCommitHook</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Process</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IList&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> repo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Repository(Environment.CurrentDirectory); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constantsItem = repo.RetrieveStatus() .Staged .FirstOrDefault(i =&gt; i.FilePath == <span class="hljs-string"><span class="hljs-string">@"src/GitInteraction/Constants.cs"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (constantsItem == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!constantsItem.State.HasFlag(FileStatus.NewInIndex) &amp;&amp; !constantsItem.State.HasFlag(FileStatus.ModifiedInIndex)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialContent = GetInitialContent(repo, constantsItem); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indexContent = GetIndexContent(repo, constantsItem); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> initialConstantValues = GetConstantValues(initialContent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> indexConstantValues = GetConstantValues(indexContent); indexConstantValues.ExceptWith(initialConstantValues); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (indexConstantValues.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> version <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> indexConstantValues) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ListItemOwnerChecker.DoesCurrentUserOwnListItem(<span class="hljs-number"><span class="hljs-number">2</span></span>, version)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } ... }</code> </pre> <br><p>  рдкрд╣рд▓реЗ рд╣рдо рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ рд╣рдорд╛рд░реЗ рдПрдиреНрдпреВрдорд░реЗрд╢рди рд╡рд╛рд▓реА рдлрд╛рдЗрд▓ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред  рдлрд┐рд░ рд╣рдо рдЗрд╕ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдирд╡реАрдирддрдо рдЕрдкрд▓реЛрдб рдХрд┐рдП рдЧрдП рд╕рдВрд╕реНрдХрд░рдг рд╕реЗ рдФрд░ рдЧреЗрдЯ рдЗрдВрдбреЗрдХреНрд╕ рд╕реЗ <code>GetInitialContent</code> рдФрд░ <code>GetIndexContent</code> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <code>GetInitialContent</code> ред  рдпрд╣рд╛рдБ рдЙрдирдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИ: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetInitialContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Repository repo, StatusEntry item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> blob = repo.Head.Tip[item.FilePath]?.Target <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Blob; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (blob == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(blob.GetContentStream(), Encoding.UTF8); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> content.ReadToEnd(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIndexContent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Repository repo, StatusEntry item</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = repo.Index[item.FilePath]?.Id; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (id == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemBlob = repo.Lookup&lt;Blob&gt;(id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemBlob == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamReader(itemBlob.GetContentStream(), Encoding.UTF8); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> content.ReadToEnd(); }</code> </pre> <br><p>            .     <code>GetConstantValues</code> .   <a href="https://github.com/dotnet/roslyn" rel="nofollow"><code>Roslyn</code></a>    .      NuGet- <code>Microsoft.CodeAnalysis.CSharp</code> . </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ISet&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConstantValues</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fileContent</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrWhiteSpace(fileContent)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tree = CSharpSyntaxTree.ParseText(fileContent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> root = tree.GetCompilationUnitRoot(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> enumDeclaration = root .DescendantNodes() .OfType&lt;EnumDeclarationSyntax&gt;() .FirstOrDefault(e =&gt; e.Identifier.Text == <span class="hljs-string"><span class="hljs-string">"Constants"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(enumDeclaration == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashSet&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> member <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumDeclaration.Members) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(member.EqualsValue.Value.ToString(), <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>)) { result.Add(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>   <code>Roslyn</code>     .   ,     ,    <code>Microsoft.CodeAnalysis.CSharp</code>  <code>3.4.0</code> .       <code>gitHookAssemblies</code> ,    ,        .      .  , <code>dotnet-script</code>    <code>Roslyn</code>   .  ,  -   <code>Microsoft.CodeAnalysis.CSharp</code>     .       <code>3.3.1</code> .           NuGet-,  . </p><br><p> , ,   <code>Process</code>   hook`,           Web-. </p><br><h2 id="napravleniya-dalneyshego-razvitiya">    </h2><br><p>   .      .         ,     . </p><br><ol><li><p>    <code>pre-commit</code> ,      ,      <code>.git\hooks</code>    .     <code>--template</code>  <code>git init</code> .   - : </p><br><pre> <code class="bash hljs">git config init.templatedir git_template_dir git init</code> </pre> <br><p>     <code>core.hooksPath</code>  Git,     Git 2.9   : </p><br><pre> <code class="bash hljs">git config core.hooksPath git_template_dir</code> </pre> <br><p>           . </p><br></li><li><p>        <code>dotnet-script</code> .              .NET Core,         . </p><br></li><li><p>       ,    .  ,       <code>gitHookAssemblies</code> ,    ,      . ,  <code>LibGit2Sharp</code>         .    <code>git2-7ce88e6.dll</code> ,   Win-x64.        ,     . </p><br></li><li><p>        Web-.    Windows-,      .   Web-    UI        . </p><br></li><li><p>   ,        Git hook'  .  ,      . </p><br></li></ol><br><h2 id="zaklyuchenie">  рдирд┐рд╖реНрдХрд░реНрд╖ </h2><br><p>            Git hook`   .NET.        ,            . </p><br><p>  ,      .  рд╕реМрднрд╛рдЧреНрдп рд╣реИ </p><br><p> PS         <a href="https://github.com/yakimovim/csharp-git-hooks" rel="nofollow">GitHub</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi485218/">https://habr.com/ru/post/hi485218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi485204/index.html">рд╢реАрд░реНрд╖ рдкрд░ рд╡рд╛рдкрд╕ рд▓реМрдЯреЗрдВ: рдХреНрдпреЛрдВ рдЕрдореЗрдЬрд╝реЕрди рдХрд╛ рдкреВрдВрдЬреАрдХрд░рдг рдЬрд▓реНрдж рд╣реА рдлрд┐рд░ рд╕реЗ $ 1 рдЯреНрд░рд┐рд▓рд┐рдпрди рд╕реЗ рдЕрдзрд┐рдХ рд╣реЛрдЧрд╛</a></li>
<li><a href="../hi485206/index.html">рдЯрд╛рдЗрдкрд╕реНрдХреНрд░рд┐рдкреНрдЯ рдиреЗ рдореБрдЭреЗ рдХреИрд╕реЗ рдирд┐рд░рд╛рд╢ рдХрд┐рдпрд╛ рдФрд░ рдХреНрдпрд╛ рдпрд╣ рдЗрд╕рдХреЗ рд▓рд╛рдпрдХ рд╣реИ?</a></li>
<li><a href="../hi485208/index.html">рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ рдЖрдИрдЯреА рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдирд┐рд░реНрдорд╛рдгред рднрд╛рдЧ 2. OVirt 4.3 рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛</a></li>
<li><a href="../hi485210/index.html">рдПрдХрддрд╛ рдкрд░ рд╕рд░рд▓ рдЬрд╝реЛрдВрдмреА рд╢реВрдЯрд░</a></li>
<li><a href="../hi485214/index.html">CLRium # 7: рдкреНрд░реИрдХреНрдЯрд┐рдХрд▓ред рд╕рдВрдЧреЛрд╖реНрдареА, рд╕рддреНрдпрд╛рдкрди рдХреЗ рд╕рд╛рде рд╣реЛрдорд╡рд░реНрдХ, рд╕рд▓рд╛рд╣</a></li>
<li><a href="../hi485220/index.html">рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рдХрд╛ рд╡рд┐рдХрд╛рд╕: рдлрд╝рд╛рдпрд░рд╡реЙрд▓ рд╕реЗ рд▓реЗрдХрд░ рдорд╢реАрди-рд▓рд░реНрдирд┐рдВрдЧ рдХреНрд▓рд╛рдЙрдб-рдЖрдзрд╛рд░рд┐рдд рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдгрд╛рд▓реА</a></li>
<li><a href="../hi485222/index.html">рдХреИрд╕реЗ рдЪреАрди рдореЗрдВ рд░рд╛рдп рдиреЗрддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП? рдкрд╛рдБрдЪ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╕реБрдЭрд╛рд╡</a></li>
<li><a href="../hi485224/index.html">1 рдЬрдирд╡рд░реА, 2020 рд╕реЗ рд╕реАрдорд╛ рд╢реБрд▓реНрдХ рдХреЗ рддрд╣рдд рдЖрдиреЗ рд╡рд╛рд▓реЗ рдорд╛рд▓ рдХреА рдбрд┐рд▓реАрд╡рд░реА рдХреИрд╕реЗ рд╣реЛ рд░рд╣реА рд╣реИ</a></li>
<li><a href="../hi485226/index.html">рдпреВрдЖрдИ рд╡рд┐рдХрд╛рд╕: рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕рд╕реЗ - рдЦреБрдж рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛?</a></li>
<li><a href="../hi485228/index.html">рд╕рдХреНрд░рд┐рдп рдЕрдзрд┐рдЧрдо рдХреНрдпрд╛ рд╣реИ?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>