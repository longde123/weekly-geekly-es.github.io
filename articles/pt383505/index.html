<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòß üî¢ üèÇüèø EJTAG: atra√ß√£o para hackers-2 üç£ üëáüèø üòÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nas minhas publica√ß√µes anteriores do EJTAG: uma atra√ß√£o para hackers e Black Swift: usando o EJTAG , foi considerada a maneira mais f√°cil de usar o EJ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>EJTAG: atra√ß√£o para hackers-2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/383505/"><img src="https://habrastorage.org/files/ac4/ecc/125/ac4ecc125c314e7682edb1a9e0fb99ed.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nas minhas publica√ß√µes anteriores do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EJTAG: uma atra√ß√£o para hackers</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Black Swift: usando o EJTAG</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , foi considerada a maneira mais f√°cil de usar o EJTAG - carregar na RAM e iniciar um programa do usu√°rio. </font><font style="vertical-align: inherit;">No entanto, os recursos do EJTAG n√£o se limitam a isso. </font><font style="vertical-align: inherit;">A publica√ß√£o descreve como organizar a depura√ß√£o simples de c√≥digo usando EJTAG, usando ferramentas openocd e freeware GDB.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fui solicitado a escrever esta publica√ß√£o por uma carta de um leitor que me pediu para permanecer an√¥nimo e me pediu ajuda - um dispositivo baseado no AR9344 n√£o inicializa (fica travado no est√°gio de inicializa√ß√£o do U-boot) - como posso descobrir qual √© o problema do EJTAG? </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu n√£o tinha um dispositivo baseado no AR9344 em m√£os, mas a placa Black Swift Pro baseada no chip AR9331 relacionado acabou sendo a narrativa de olho nele. Eu acho que as mudan√ßas que precisam ser feitas para o AR9344 n√£o s√£o significativas. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos para a declara√ß√£o do problema: Existe </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
uma placa Black Swift Pro, √† qual nos conectamos usando o openocd via EJTAG e colocamos o processador no modo de parada.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â NECESS√ÅRIO executar v√°rias dezenas de instru√ß√µes do processador sequencialmente, parando ap√≥s cada instru√ß√£o ser executada e, se necess√°rio, verificando o conte√∫do da RAM, ROM de inicializa√ß√£o, registros do controlador perif√©rico ou registros do processador. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para resolver o problema, vejo pelo menos duas abordagens:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">simples - apenas usando o openocd - a funcionalidade b√°sica para executar as a√ß√µes necess√°rias j√° est√° no openocd. </font><font style="vertical-align: inherit;">S√≥ √© necess√°rio poder us√°-lo;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">complexo - usando o pacote openocd + GDB - o usu√°rio controlar√° o processo de execu√ß√£o das instru√ß√µes do processador via GDB, e o openocd converter√° solicita√ß√µes GDB em comandos EJTAG.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora considere as duas solu√ß√µes em mais detalhes.</font></font><br>
<blockquote>    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Black Swift:  EJTAG</a>.<br>
</blockquote><br>
<br>
<h3> 1:   openocd</h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quem l√™ minhas publica√ß√µes anteriores sobre o EJTAG deve se lembrar que o openocd aparece neles como um executor de script burro (arquivos de configura√ß√£o), que parece funcionar no modo em lote e n√£o fornece intera√ß√£o com o usu√°rio. No entanto, n√£o √©. De fato, enquanto o software openocd est√° em execu√ß√£o, √© poss√≠vel "solicitar" que ele execute um comando usando a interface da linha de comandos. Para acessar a interface da linha de comandos, o openocd inicia um servidor telnet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padr√£o, a porta TCP 4444 ser√° usada para o servidor de telnet.Se necess√°rio, o n√∫mero da porta TCP pode ser alterado usando a op√ß√£o </font></font><code>telnet_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(veja o exemplo abaixo). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar rastrear o gerenciador de inicializa√ß√£o da placa Black Swift com o openocd. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Exemplo de arquivo de configura√ß√£o</font></font><code>black-swift-trace.cfg</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para o openocd, que for√ßa o openocd para o servidor de telnet usar a porta 4455:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fonte [encontre interface / ftdi / tumpa.cfg]</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 adapter_khz 6000</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 fonte [encontre black-swift.cfg]</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 telnet_port 4455</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 iniciar</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 parar</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A execu√ß√£o do openocd 0.9.0 como raiz se parece com isso:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f black-swift-trace.cfg</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Open On-Chip Debugger 0.9.0 (28-05-2015: 17)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Licenciado sob GNU GPL v2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para relat√≥rios de erros, leia</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         http://openocd.org/doc/doxygen/bugs.html</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 nenhum separado</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 velocidade do adaptador: 6000 kHz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Info: sele√ß√£o autom√°tica do primeiro transporte de sess√£o dispon√≠vel "jtag". </font><font style="vertical-align: inherit;">Para substituir, use 'transport selecione &lt;transport&gt;'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Erro: nenhum dispositivo encontrado</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Erro: imposs√≠vel abrir o dispositivo ftdi com vid 0403, pid 8a98, descri√ß√£o '*' e serial '*'</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Info: velocidade do rel√≥gio 6000 kHz</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Informa√ß√µes: tap JTAG: tap / dispositivo ar9331.cpu encontrado: 0x00000001 (mfg: 0x000, parte: 0x0000, ver: 0x0)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado de destino: interrompido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 destino interrompido no modo MIPS32 devido a solicita√ß√£o de depura√ß√£o, pc: 0xbfc00000</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado de destino: interrompido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 destino interrompido no modo MIPS32 devido a uma etapa, pc: 0xbfc00404</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora podemos abrir outra janela do terminal e conectar-se ao servidor openocd telnet usando o programa </font></font><code>telnet</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ telnet localhost 4455</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tentando :: 1 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tentando 127.0.0.1 ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Conectado ao localhost.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 O caractere de escape √© '^]'.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Depurador aberto no chip</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt;</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma lista de todos os comandos OpenOCD √© f√°cil de obter com o comando </font></font><code>help</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para execu√ß√£o passo a passo das instru√ß√µes do processador, o </font></font><code>step</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguinte </font><font style="vertical-align: inherit;">comando √© √∫til para n√≥s </font><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> passo [endere√ßo]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       executar uma instru√ß√£o no endere√ßo especificado pelo registro</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       contador de comandos (PC). </font><font style="vertical-align: inherit;">Se o par√¢metro address for especificado, ent√£o</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       A instru√ß√£o ser√° executada come√ßando com o endere√ßo do endere√ßo.</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A execu√ß√£o passo a passo das instru√ß√µes do processador no console √© semelhante a esta:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; etapa 0xbfc00400</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado de destino: interrompido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 destino interrompido no modo MIPS32 devido a uma etapa, pc: 0xbfc00404</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; passo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado de destino: interrompido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 destino interrompido no modo MIPS32 devido a uma etapa, pc: 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; passo</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 estado de destino: interrompido</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 destino interrompido no modo MIPS32 devido a uma etapa, pc: 0xbfc0040c</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os seguintes comandos openocd tamb√©m podem ser √∫teis:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reg [(n√∫mero_de_registro | nome_de_registro) [(valor | 'for√ßa')]]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       ler ou gravar o valor do registro do processador.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Chamar reg sem par√¢metros resulta na sa√≠da de todos os registradores.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       Se o par√¢metro 'force' for usado, for√ßar</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       subtraindo o registro do processador (em vez de emitir um cache</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       valores).</font></font><font></font>
 <font></font>
 mwb ['phys'] address value [count]<font></font>
          address ,     value.<font></font>
          phys,   address ‚Äî  ,<font></font>
          ‚Äî .<font></font>
          count    address  <font></font>
           count,    <font></font>
         value.<font></font>
 <font></font>
 mwh ['phys'] address value [count]<font></font>
         mwb,     16- .<font></font>
 <font></font>
 mww ['phys'] address value [count]<font></font>
         mwb,     32- .<font></font>
 <font></font>
 mdb ['phys'] address [count]<font></font>
               address.<font></font>
          phys,   address ‚Äî  ,<font></font>
          ‚Äî .<font></font>
          count        <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       matriz no comprimento do endere√ßo do endere√ßo conta bytes.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mdh ['phys'] endere√ßo [contagem]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       o comando √© semelhante ao mdb, mas uma palavra de 16 bits √© lida em vez de um byte.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 mdw ['phys'] endere√ßo [contagem]</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       o comando √© semelhante ao mdb, mas uma palavra de 32 bits √© lida em vez de um byte.</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, infelizmente, a vers√£o mais recente (no momento da reda√ß√£o deste documento) do openocd 0.9.0 n√£o √© capaz de desmontar as instru√ß√µes dos processadores com arquitetura MIPS, embora </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exista um desmontador para processadores com arquitetura ARM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A falta de um desmontador torna a execu√ß√£o passo a passo das instru√ß√µes do processador diretamente com o openocd n√£o muito confort√°vel. </font><font style="vertical-align: inherit;">Voc√™ pode aumentar o n√≠vel de conforto se usar o GDB.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solu√ß√£o 2: use o pacote openocd + GDB</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No pacote openocd + GDB, as fun√ß√µes s√£o distribu√≠das da seguinte forma: o usu√°rio se comunica com o GDB, que fornece uma interface conveniente para depura√ß√£o, abstraindo do mecanismo pelo qual a execu√ß√£o das instru√ß√µes √© executada, e o openocd assume a tarefa de controlar diretamente o processador de acordo com as instru√ß√µes do GDB. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O uso do GDB para controlar a execu√ß√£o de instru√ß√µes em um processador MIPS atrav√©s do EJTAG tem v√°rias vantagens sobre o openocd:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como mencionado acima, um desmontador para a arquitetura MIPS √© incorporado ao GDB;</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© poss√≠vel usar informa√ß√µes de depura√ß√£o da fonte; </font><font style="vertical-align: inherit;">por exemplo, se voc√™ estiver depurando seu pr√≥prio programa C, o GDB poder√° mostrar qual linha de c√≥digo C est√° sendo executada no momento e detalhar o estado precisamente das vari√°veis ‚Äã‚Äãdo programa, e n√£o as c√©lulas de mem√≥ria com endere√ßos misteriosos;</font></font></li>
<li>   openocd  GDB   GDB Remote Serial Protocol;  qemu    ,                ,              ‚Äî GDB;</li>
<li>,    GDB      TAB.</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deve-se ter em mente que o GDB opera com conceitos de alto n√≠vel, e o openocd √© for√ßado a trabalhar com o equipamento que √©, e nem sempre, o Wishlist do GDB pode ser efetivamente implementado usando o EJTAG. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por exemplo, o usu√°rio instrui o GDB a definir um ponto de interrup√ß√£o no endere√ßo especificado, esta instru√ß√£o vai para o openocd, mas para os processadores MIPS, o openocd tem pelo menos duas maneiras de definir um ponto de interrup√ß√£o:</font></font><br>
<ul>
<li>        sdbbp,        , openocd  sdbbp   ,    sdbbp     ,   .    software breakpoint.  ,          .</li>
<li>         .          .     , hardware breakpoint, .</li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Embora no GDB Remote Serial Protocol haja uma distin√ß√£o entre o ponto de interrup√ß√£o de hardware e o ponto de interrup√ß√£o do software (consulte os pacotes z e z0 na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">descri√ß√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">protocolo</font></a><font style="vertical-align: inherit;"> ), e o GDB fornece op√ß√µes apropriadas para escolher o tipo de pontos de interrup√ß√£o, pode haver restri√ß√µes no uso de pontos em um processador espec√≠fico discrimina√ß√£o de um tipo ou de outro. Assim, o openocd tem uma op√ß√£o </font></font><code>gdb_breakpoint_override</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que permite for√ßar um dos dois m√©todos descritos para organizar pontos de interrup√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para conectar o depurador GDB, implementos openocd um servidor GDB, que por padr√£o utiliza a porta TCP 3333. Se necess√°rio, o n√∫mero da porta TCP pode ser alterado usando a op√ß√£o </font></font><code>gdb_port</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para se conectar ao servidor openocd GDB que controla o processador MIPS, precisamos de uma vers√£o especial do GDB com suporte a MIPS. </font><font style="vertical-align: inherit;">Suponho que o leitor use computadores baseados em x86 / amd64 executando o Debian Linux para executar o openocd e o GDB, usando mips-linux-gnu-gdb do pacote Sourcery CodeBench. </font><font style="vertical-align: inherit;">Sobre como instalar este pacote est√° escrito </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , voc√™ s√≥ precisa apresentar a altera√ß√£o. No momento em que escrevo essas linhas, a √∫ltima √© a vers√£o do Sourcery CodeBench mips-2015.05-18, lan√ßada em maio de 2015, √© poss√≠vel fazer o download do arquivo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui usando este link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos tentar usar o pacote openocd + GDB na pr√°tica. </font><font style="vertical-align: inherit;">Execute o openocd:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f execute-u-boot_mod-trace.cfg \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; -c "gdb_breakpoint_override hard" -c "etapa 0xbfc00400"</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os dois √∫ltimos comandos do openocd fornecer√£o o seguinte:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√£o utilizados pontos de interrup√ß√£o de hardware, independentemente do que o GDB imaginar l√° (os endere√ßos 0xbfc0xxxx correspondem √† ROM, portanto os pontos de interrup√ß√£o do software n√£o funcionar√£o);</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uma instru√ß√£o ser√° executada a partir do endere√ßo 0xbfc00400, ap√≥s o que o processador ir√° parar novamente.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Abra outra janela do terminal e inicie o GDB:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ /opt/mips-2015.05/bin/mips-linux-gnu-gdb</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 GNU gdb (Sourcery CodeBench Lite 2015.05-18) 7.7.50.20140217-cvs</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Direitos autorais (C) 2014 Free Software Foundation, Inc.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Licen√ßa GPLv3 +: GNU GPL vers√£o 3 ou posterior &lt;http://gnu.org/licenses/gpl.html&gt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Este √© um software livre: voc√™ pode alter√°-lo e redistribu√≠-lo.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 N√ÉO H√Å GARANTIA, na extens√£o permitida por lei. </font><font style="vertical-align: inherit;">Digite "mostrar c√≥pia"</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 e "mostrar garantia" para detalhes.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Este GDB foi configurado como "--host = i686-pc-linux-gnu --target = mips-linux-gnu".</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Digite "show configuration" para obter detalhes da configura√ß√£o.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para obter instru√ß√µes sobre relat√≥rios de erros, consulte:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;https://sourcery.mentor.com/GNUToolchain/&gt;.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Encontre o manual do GDB e outros recursos de documenta√ß√£o on-line em:</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Para obter ajuda, digite "ajuda".</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Digite "palavra apropriada" para procurar comandos relacionados √† "palavra".</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, explicamos ao GDB o tipo de processador com o qual trabalharemos, pedimos para desmontar a pr√≥xima instru√ß√£o execut√°vel do processador e, finalmente, conectamos ao servidor openocd GDB:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) definir arquitetura mips: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 A arquitetura de destino √© assumida como mips: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) definir endian grande</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Presume-se que o alvo seja big endian</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) defina desmontar a pr√≥xima linha em</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) destino remoto: 3333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Depura√ß√£o remota usando: 3333</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00404 in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00404: 40 80 08 00 mtc0 zero, c0_random</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para executar uma instru√ß√£o de processador no GDB, um comando √© usado </font></font><code>stepi</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vamos tentar seguir algumas instru√ß√µes do processador e n√£o deixar o GDB avis√°-lo sobre a falta de informa√ß√µes de depura√ß√£o (n√£o √© poss√≠vel encontrar o in√≠cio da fun√ß√£o); leve essas informa√ß√µes do nada.</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 aviso: o GDB n√£o consegue encontrar o in√≠cio da fun√ß√£o em 0xbfc00408.</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     O GDB n√£o consegue encontrar o in√≠cio da fun√ß√£o em 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 e, portanto, n√£o √© poss√≠vel determinar o tamanho do quadro de pilha dessa fun√ß√£o.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Isso significa que o GDB pode n√£o conseguir acessar esse quadro de pilha ou</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 os quadros abaixo dele.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     Esse problema provavelmente √© causado por um contador de programa inv√°lido ou</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ponteiro de pilha.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
     No entanto, se voc√™ acha que o GDB deve procurar mais longe</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 de 0xbfc00408 para c√≥digo que se parece com o in√≠cio de um</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 , voc√™ pode aumentar o alcance da pesquisa usando o `set</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 comando heuristic-fence-post '.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00408 in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00408: 40 80 10 00 mtc0 zero, c0_entrylo0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 aviso: o GDB n√£o consegue encontrar o in√≠cio da fun√ß√£o em 0xbfc0040c.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc0040c em ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc0040c: 40 80 18 00 mtc0 zero, c0_entrylo1</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb) stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 aviso: o GDB n√£o consegue encontrar o in√≠cio da fun√ß√£o em 0xbfc00410.</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 0xbfc00410 in ?? </font><font style="vertical-align: inherit;">()</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 =&gt; 0xbfc00410: 40 80 20 00 mtc0 zero, c0_context</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 (gdb)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora leia a palavra de 32 bits em 0xbfc00408:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) p / x * 0xbfc00408</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 $ 1 = 0x40801000</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para imprimir o estado dos registros do processador, use o comando </font></font><code>info registers</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (gdb) registros de informa√ß√µes</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           zero na v0 v1 a0 a1 a2 a3</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R0 00000000 37c688e2 22b15a00 28252198 0c12d319 4193c014 84e49102 06193640</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             t0 t1 t2 t3 t4 t5 t6 t7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R8 00000002 9f003bc0 92061301 1201c163 31d004a0 92944911 ac031248 b806001c</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             s0 s1 s2 s3 s4 s5 s6 s7</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R16 8bc81985 402da011 c94d2454 88d5a554 81808e0d cc445151 4401a826 50020402</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
             t8 t9 k0 k1 gp sp s8 ra</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  R24 01c06b30 01000000 10000004 fffffffe 9f003bc0 54854eab 329d626b bfc004b4</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         status lo oi badvaddr causar pc</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       00400004 00244309 b9ca872c ed6a1f00 60808350 bfc00410</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
           fcsr fir</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       00000000 00000000</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O GDB √© uma ferramenta avan√ßada com um grande n√∫mero de comandos e op√ß√µes; </font><font style="vertical-align: inherit;">para conhecer melhor o GDB, remeto o leitor para a </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">documenta√ß√£o oficial do GDB</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicializando o controlador de RAM AR9331</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos ver como o GDB pode resolver um problema espec√≠fico: rastreando a execu√ß√£o do U-boot na placa Black Swift, identificaremos uma sequ√™ncia de entradas nos registros do controlador RAM, o que leva √† sua inicializa√ß√£o. </font><font style="vertical-align: inherit;">Detectar essa sequ√™ncia √© extremamente √∫til se queremos executar programas no Black Swift usando o openocd ignorando o U-boot. </font><font style="vertical-align: inherit;">Al√©m disso, essa sequ√™ncia de inicializa√ß√£o √© √∫til ao criar um carregador de inicializa√ß√£o alternativo para o Black Swift. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Execute o openocd (como na se√ß√£o anterior):</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> # openocd -f execute-u-boot_mod-trace.cfg \</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 &gt; -c "gdb_breakpoint_override hard" -c "etapa 0xbfc00400"</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para executar o GDB, componha um script </font></font><code>bs-u-boot-trace-gdb.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> definir arquitetura mips: isa32r2</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 definir endian grande</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 defina desmontar a pr√≥xima linha</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 alvo remoto: 3333</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 desativar a pagina√ß√£o</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 definir arquivo de log bs_gdb.log</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 definir logon</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 while $ pc! = (void (*) ()) 0x9f002ab0</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         stepi</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
         registros de informa√ß√µes</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 fim</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 destacar</font></font><font></font>
 <font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Sair</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comparado ao exemplo da se√ß√£o anterior, esse script faz com que o GDB duplique a sa√≠da em um arquivo </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e desativa a pagina√ß√£o (confirma√ß√£o de virada de p√°gina pelo usu√°rio) e come√ßa a executar ciclicamente as instru√ß√µes do processador e a exibir o estado dos registros do processador ap√≥s cada instru√ß√£o. </font><font style="vertical-align: inherit;">Quando o registro do PC (endere√ßo da instru√ß√£o a seguir) atinge 0x9f002ab0, o GDB se desconecta do openocd e para de funcionar. </font><font style="vertical-align: inherit;">Assim, no final do GDB, um arquivo </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um rastreamento completo da execu√ß√£o das instru√ß√µes do processador </font><font style="vertical-align: inherit;">ser√° criado </font><font style="vertical-align: inherit;">. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O lan√ßamento do GDB ser√° o seguinte:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> $ /opt/mips-2015.05/bin/mips-linux-gnu-gdb -x bs-u-boot-trace-gdb.conf</font></font></pre></blockquote><br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nota: o script </font></font><code>bs-u-boot-trace-gdb.conf</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">provavelmente n√£o funcionar√° imediatamente ap√≥s a energia ser aplicada √† placa, pois o u-boot_mod tamb√©m redefinir√° os erros anti-mist√©rio AR9331, o que far√° com que o script pare de executar. </font><font style="vertical-align: inherit;">Nesse caso, pare o openocd e o GDB e execute o openocd e o GDB novamente.</font></font><br>
</blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora, tudo √© pequeno - voc√™ precisa selecionar </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">todas as instru√ß√µes de grava√ß√£o </font><font style="vertical-align: inherit;">do arquivo </font></font><code>sw</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(armazenar palavra, ou seja, escrever um valor de 32 bits). </font><font style="vertical-align: inherit;">Os registros do controlador de mem√≥ria AR9331 s√£o de 32 bits, para que outras instru√ß√µes da fam√≠lia de lojas possam ser ignoradas com seguran√ßa. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como o desmontador produz apenas os nomes dos registros de argumentos da instru√ß√£o</font></font><code>sw</code><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> =&gt; 0xbfc004ec: an√∫ncio f9 00 00 sw t9,0 (t7)</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
mas n√£o seus valores, n√£o basta </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">selecionar todas as linhas que cont√™m a instru√ß√£o sw </font><font style="vertical-align: inherit;">do arquivo </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Para determinar qual valor foi gravado em qual endere√ßo usando sw, o arquivo deve ser submetido a </font></font><code>bs_gdb.log</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">processamento adicional. </font><font style="vertical-align: inherit;">O processamento pode ser feito usando o script parse_gdb_output.pl:</font></font><br>
<pre><code class="perl hljs"> <span class="hljs-comment">#!/usr/bin/perl -w</span><font></font>
 <font></font>
 <span class="hljs-keyword">my</span> %r;<font></font>
 <font></font>
 <span class="hljs-keyword">foreach</span> $i (<span class="hljs-string">qw(zero at v0 v1 a0 a1 a2 a3 t0 t1 t2 t3 t4 t5 t6 t7
        s0 s1 s2 s3 s4 s5 s6 s7 t8 t9 k0 k1 gp sp s8 ra)</span>) {<font></font>
    $r{$i} = <span class="hljs-string">"none"</span>;<font></font>
 }<font></font>
 <font></font>
 <span class="hljs-function"><span class="hljs-keyword">sub</span> <span class="hljs-title">parse_reg</span>($)
 </span>{<font></font>
    $_ = $_[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R/</span>) {
        <span class="hljs-keyword">my</span> @fields = <span class="hljs-keyword">split</span> <span class="hljs-keyword">m</span><span class="hljs-string">'\s+'</span>;
        <span class="hljs-keyword">my</span> $f = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">my</span> @rgs;<font></font>
 <font></font>
        @rgs = <span class="hljs-string">qw(zero at v0 v1 a0 a1 a2 a3)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R0/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(t0 t1 t2 t3 t4 t5 t6 t7)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R8/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(s0 s1 s2 s3 s4 s5 s6 s7)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R1/</span>);<font></font>
        @rgs = <span class="hljs-string">qw(t8 t9 k0 k1 gp sp s8 ra)</span> <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^ R2/</span>);<font></font>
 <font></font>
        <span class="hljs-keyword">foreach</span> $i (@rgs) {<font></font>
            $r{$i} = $fields[$f];<font></font>
            $f = $f + <span class="hljs-number">1</span>;<font></font>
        }<font></font>
    }<font></font>
 }<font></font>
 <font></font>
 <span class="hljs-keyword">while</span> (&lt;&gt;) {
    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/^=&gt;([^s]*)\tsw\t([^,]*),(\d+)\(([^)]*)\)/</span>) {
        <span class="hljs-keyword">my</span> $rs = $2;
        <span class="hljs-keyword">my</span> $offset = $3;
        <span class="hljs-keyword">my</span> $rd = $4;<font></font>
 <font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
        parse_reg(&lt;&gt;);<font></font>
 <font></font>
        <span class="hljs-keyword">print</span>(<span class="hljs-string">"$1    sw $rs={0x$r{$rs}}, $offset($rd={0x$r{$rd}})\n"</span>);<font></font>
    }<font></font>
 }</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O lan√ßamento </font></font><code>parse_gdb_output.pl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√© o seguinte:</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ grep "^ = \ | ^ R" bs_gdb.log | </font><font style="vertical-align: inherit;">./parse_gdb_output.pl</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aqui est√° um trecho de sa√≠da </font></font><code>parse_gdb_output.pl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(as marcas ' </font></font><code>&lt;&lt;&lt; PLL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' e ' </font></font><code>&lt;&lt;&lt; DDR</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' foram inseridas manualmente posteriormente):</font></font><br>
<blockquote><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ...</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f002700: an√∫ncio cf 00 00 sw t7 = {0x00dodom60}, 0 (t6 = {0xb8116248})</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f00271c: an√∫ncio f9 00 00 sw t9 = {0x000fffff}, 0 (t7 = {0xb800009c})</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f0027a0: an√∫ncio f9 00 00 sw t9 = {0x00018004}, 0 (t7 = {0xb8050008}) &lt;&lt;&lt; PLL</font></font><font></font>
  0x9f0027dc:   ad f9 00 00    sw t9={0x00000352}, 0(t7={0xb8050004}) &lt;&lt;&lt;<font></font>
  0x9f002840:   ad f9 00 00    sw t9={0x40818000}, 0(t7={0xb8050000}) &lt;&lt;&lt;<font></font>
  0x9f002898:   ad f9 00 00    sw t9={0x001003e8}, 0(t7={0xb8050010}) &lt;&lt;&lt;<font></font>
  0x9f0028f4:   ad f9 00 00    sw t9={0x00818000}, 0(t7={0xb8050000}) &lt;&lt;&lt;<font></font>
  0x9f002970:   ad cf 00 00    sw t7={0x00800000}, 0(t6={0xb8116248})<font></font>
 ...<font></font>
  0x9f002994:   ad cf 00 00    sw t7={0x40800700}, 0(t6={0xb8116248})<font></font>
  0x9f002a54:   ad f9 00 00    sw t9={0x00008000}, 0(t7={0xb8050008})<font></font>
  0x9f00309c:   af 38 00 00    sw t8={0x7fbc8cd0}, 0(t9={0xb8000000}) &lt;&lt;&lt; DDR<font></font>
  0x9f0030b0:   af 38 00 00    sw t8={0x9dd0e6a8}, 0(t9={0xb8000004}) &lt;&lt;&lt;<font></font>
  0x9f0030dc:   af 38 00 00    sw t8={0x00000a59}, 0(t9={0xb800008c}) &lt;&lt;&lt;<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  0x9f0030ec: af 38 00 00 sw t8 = {0x00000008}, 0 (t9 = {0xb8000010}) &lt;&lt;&lt;</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 ...</font></font></pre></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como os endere√ßos dos registros do gerador de sinal de clock (PLL) e os endere√ßos dos registros do controlador de mem√≥ria do tipo DDR s√£o conhecidos, √© f√°cil descobrir quais n√∫meros devem ser gravados em quais endere√ßos para inicializar corretamente o controlador de RAM.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sum√°rio</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, a depura√ß√£o atrav√©s do JTAG usando o openocd e o GDB n√£o √© nada dif√≠cil, e os m√©todos de trabalho descritos s√£o adequados n√£o apenas para o AR9331, mas ap√≥s algumas adapta√ß√µes e at√© mesmo para processadores com uma arquitetura diferente, para os quais h√° suporte no openocd e no GDB.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt383505/">https://habr.com/ru/post/pt383505/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt383495/index.html">Sobreviv√™ncia na R√∫ssia. ‚ÄúHuskies, republica√ß√µes, tweets: como n√£o violar a legisla√ß√£o anti-extremista‚Äù</a></li>
<li><a href="../pt383497/index.html">Porting Lode Runner de BC para UKNC</a></li>
<li><a href="../pt383499/index.html">Entalhe est√° passando por tempos dif√≠ceis</a></li>
<li><a href="../pt383501/index.html">Nos Estados Unidos, lan√ßou um experimento para simular um v√¥o para Marte com dura√ß√£o de 365 dias</a></li>
<li><a href="../pt383503/index.html">Fotoc√©lulas de perovskita: cinco gramas por metro quadrado</a></li>
<li><a href="../pt383507/index.html">Projetos da Base Lunar: Hist√≥ria</a></li>
<li><a href="../pt383509/index.html">Fundador do Pirate Bay preso imediatamente ap√≥s a sa√≠da</a></li>
<li><a href="../pt383511/index.html">Os primeiros momentos da fotoss√≠ntese calculados em um supercomputador</a></li>
<li><a href="../pt383513/index.html">Oferta on-line de medicamentos aumenta mesmo ap√≥s o fechamento da Rota da Seda</a></li>
<li><a href="../pt383517/index.html">RAICamp 2015 - Primeiro dia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>