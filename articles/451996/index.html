<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîé üèîÔ∏è ‚åöÔ∏è Mi experiencia de errores ü§™ üßíüèø üõµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mi experiencia de errores 
 Lista de errores 


1. Clase omnipotente MCManager 
2. Inventando nuestra navegaci√≥n entre pantallas 
3. Nunca hay mucha h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mi experiencia de errores</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451996/"><h3>  Mi experiencia de errores </h3><br><h4>  Lista de errores </h4><br><ol><li>  Clase omnipotente MCManager </li><li>  Inventando nuestra navegaci√≥n entre pantallas </li><li>  Nunca hay mucha herencia </li><li>  Arquitectura de nuestra propia producci√≥n o continuamos creando bicicletas. </li><li>  MVVM con alma MVP </li><li>  El segundo intento con navegaci√≥n o enrutador y la curvatura de la navegaci√≥n. </li><li>  Gerente persistente </li></ol><br>  Muchas personas, incluy√©ndome a m√≠, escriben c√≥mo hacer lo correcto en una situaci√≥n dada, c√≥mo escribir c√≥digo correctamente, c√≥mo aplicar soluciones arquitect√≥nicas, etc. Pero me gustar√≠a compartir mi experiencia de c√≥mo se hizo incorrectamente y las conclusiones que yo hecho en base a sus errores.  Lo m√°s probable es que estos sean errores comunes de todos los que siguen el camino del desarrollador, o tal vez algo sea nuevo.  Solo quiero compartir mi experiencia y leer los comentarios de otros chicos. <br><a name="habracut"></a><br><h4>  Clase omnipotente MCManager </h4><br>  Despu√©s del primer a√±o de trabajo en TI, y m√°s espec√≠ficamente en el desarrollo de iOS, decid√≠ que ya era lo suficientemente arquitecto y estaba bastante listo para crear.  Incluso entonces, entend√≠ intuitivamente que era necesario separar la l√≥gica empresarial de la capa de presentaci√≥n.  Pero la calidad de mi idea de c√≥mo hacer esto estaba lejos de la realidad. <br><br>  Me mud√© a un nuevo lugar de trabajo, donde me asignaron a desarrollar independientemente una nueva caracter√≠stica para un proyecto existente.  Fue un an√°logo a la grabaci√≥n de videos en Instagram, donde la grabaci√≥n se realiza mientras el usuario mantiene el dedo sobre el bot√≥n, y luego varios fragmentos del video se conectan entre s√≠.  Inicialmente, se decidi√≥ hacer esta caracter√≠stica como un proyecto separado, o m√°s bien en forma de muestra.  Esto, seg√∫n tengo entendido, comienza la fuente de mis problemas arquitect√≥nicos, que duraron m√°s de un a√±o. <br><br>  En el futuro, esta muestra se convirti√≥ en una aplicaci√≥n completa para grabar y editar videos.  Es curioso que la muestra originalmente tuviera un nombre, de la abreviatura de la cual se recolect√≥ el prefijo MC.  Aunque el proyecto pronto fue renombrado, pero el prefijo requerido por la convenci√≥n de nombres en Objective-C, MC permaneci√≥.  As√≠ naci√≥ la clase todopoderosa MCManager. <br><br><img src="https://habrastorage.org/webt/sz/jw/m_/szjwm_hbfvtxjbovprczya2jyca.jpeg"><br><br>  Como era una muestra y al principio la funcionalidad era simple, decid√≠ que una clase de administrador ser√≠a suficiente.  La funcionalidad, como mencion√© anteriormente, incluy√≥ la grabaci√≥n de un fragmento de video con opciones de inicio / parada y la combinaci√≥n de estos fragmentos en un video completo.  Y en ese mismo momento puedo nombrar mi primer error: el nombre de la clase MCManager.  MCManager, Karl!  ¬øQu√© debe decir un nombre de clase a otros desarrolladores sobre su prop√≥sito, sus capacidades y c√≥mo usarlo?  Correcto, absolutamente nada!  Y esto est√° en el ap√©ndice, cuyo nombre ni siquiera contiene las letras M y, su madre, C. Aunque, este no es mi error principal, ya que la clase con el nombre partidista hizo todo, todo desde la palabra es absolutamente todo, que fue el error clave. <br><br>  La grabaci√≥n de video es un servicio peque√±o, la administraci√≥n del almacenamiento de archivos de video en el sistema de archivos es el segundo servicio adicional para combinar varios videos en uno.  El trabajo de estos tres servicios independientes, se decidi√≥ combinar en un solo gerente.  La idea era noble, utilizando el patr√≥n de fachada, para crear una interfaz simple para la l√≥gica empresarial y ocultar todos los detalles innecesarios sobre la interacci√≥n de varios componentes.  En las etapas iniciales, incluso el nombre de tal clase de fachada no levant√≥ ninguna sospecha, especialmente en la muestra. <br>  Pero al cliente le gust√≥ la demostraci√≥n y pronto la muestra se convirti√≥ en una aplicaci√≥n completa.  Puede justificar que no hubo tiempo suficiente para refactorizar, que el cliente no quer√≠a rehacer el c√≥digo de trabajo, pero, francamente, en ese momento yo mismo pens√© que hab√≠a establecido una excelente arquitectura.  En verdad, la idea de separar la l√≥gica comercial y la presentaci√≥n fue un √©xito.  La arquitectura era una clase de MCManager singleton, que era la fachada de un par de docenas de servicios y otros gerentes.  S√≠, tambi√©n era un singleton, que estaba disponible desde todos los rincones de la aplicaci√≥n. <br><br>  Ya se puede entender la escala de todo el desastre.  Una clase con varios miles de l√≠neas de c√≥digo que es dif√≠cil de leer y dif√≠cil de mantener.  Ya estoy en silencio sobre la posibilidad de resaltar caracter√≠sticas individuales para transferirlas a otra aplicaci√≥n, lo cual es bastante com√∫n en el desarrollo m√≥vil. <br>  Las conclusiones que hice despu√©s de un tiempo no son crear clases universales con nombres oscuros.  Me di cuenta de que la l√≥gica debe romperse en pedazos y no crear una interfaz universal para todo.  De hecho, este fue un ejemplo de lo que suceder√≠a si no se adhiere a uno de los principios de SOLID, el Principio de segregaci√≥n de interfaz. <br><br><h4>  Inventando nuestra navegaci√≥n entre pantallas </h4><br>  La separaci√≥n de la l√≥gica y la interfaz no es el √∫nico problema que me preocupa sobre el proyecto anterior.  No dir√© que en ese momento iba a separar el c√≥digo de pantalla y el c√≥digo de navegaci√≥n, pero result√≥ que se me ocurri√≥ mi bicicleta para la navegaci√≥n. <br><br><img src="https://habrastorage.org/webt/ab/dt/j1/abdtj1sogyy-j7ppjfbk9uhshge.jpeg"><br><br>  La muestra ten√≠a solo tres pantallas: un men√∫ con una tabla de videos grabados, una pantalla de grabaci√≥n y una pantalla de procesamiento posterior.  Para no preocuparme de que la pila de navegaci√≥n contenga ViewControllers duplicados, decid√≠ no usar UINavigationController.  Agregu√© el RootViewcontroller, los lectores atentos ya han adivinado que era el MCRootViewController, que se configur√≥ como el principal en la configuraci√≥n del proyecto.  Al mismo tiempo, el controlador ra√≠z no era una de las pantallas de la aplicaci√≥n, solo presentaba el UIViewController deseado.  Como si esto no fuera suficiente, el controlador ra√≠z tambi√©n era un delegado de todos los controladores representados.  Como resultado, en cada momento en el tiempo solo hab√≠a dos vc en la jerarqu√≠a, y toda la navegaci√≥n se implement√≥ utilizando el patr√≥n de delegado. <br><br>  C√≥mo se ve√≠a: cada pantalla ten√≠a su propio protocolo delegado, donde se indicaban los m√©todos de navegaci√≥n, y el controlador ra√≠z implement√≥ estos m√©todos y cambi√≥ las pantallas.  RootViewController desestim√≥ el controlador actual, cre√≥ uno nuevo y lo present√≥, mientras que era posible transferir informaci√≥n de una pantalla a otra.  Afortunadamente, la l√≥gica de negocios estaba en la mejor clase de singleton, por lo que ninguna de las pantallas almacenaba nada y pod√≠a destruirse sin dolor.  Una vez m√°s, se realiz√≥ una buena intenci√≥n, aunque la realizaci√≥n coje√≥ en ambas piernas, y a veces tropez√≥. <br><br>  Como puede suponer, si necesita pasar de la pantalla de grabaci√≥n de video al men√∫ principal, el m√©todo se denomin√≥: <br><br><pre><code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)cancel;</code> </pre> <br>  o algo as√≠, y el controlador ra√≠z ya est√° haciendo todo el trabajo sucio. <br>  Al final, MCRootViewController, se convirti√≥ en un an√°logo de MCManager, pero en la navegaci√≥n entre pantallas, al igual que con el crecimiento de la aplicaci√≥n y la adici√≥n de nuevas funcionalidades, se agregaron nuevas pantallas. <br><br>  La f√°brica de bicicletas funcionaba inexorablemente y segu√≠ ignorando los art√≠culos sobre arquitecturas de aplicaciones m√≥viles.  Pero nunca renunci√© a la idea de separar la navegaci√≥n de las pantallas. <br><br>  La ventaja era que las pantallas eran independientes y pod√≠an reutilizarse, pero esto no es exacto.  Pero las desventajas incluyen la dificultad para mantener tales clases.  El problema con la falta de una pila de pantallas cuando necesita regresar desplaz√°ndose por las pantallas previamente seleccionadas.  La compleja l√≥gica de transici√≥n entre pantallas, el controlador ra√≠z afect√≥ parte de la l√≥gica de negocios para mostrar correctamente una nueva pantalla. <br><br>  En general, no debe implementar toda la navegaci√≥n en la aplicaci√≥n de esta manera, ya que mi MCRootViewController viol√≥ el principio de principio abierto-cerrado.  Es casi imposible expandirse, y todos los cambios deben hacerse constantemente a la clase misma. <br>  Comenc√© a leer m√°s sobre la navegaci√≥n entre pantallas en una aplicaci√≥n m√≥vil, me familiaric√© con enfoques como Router y Coordinator.  Escribir√© sobre Router un poco m√°s tarde, ya que hay algo para compartir. <br><br><h4>  Nunca hay mucha herencia </h4><br>  Tambi√©n quiero compartir no solo mis perlas, sino tambi√©n los enfoques y soluciones divertidas de otras personas con las que tuve que lidiar. En el mismo lugar donde cre√© mis obras maestras, me confiaron una tarea simple.  La tarea consist√≠a en agregar una pantalla de otro proyecto a mi proyecto.  Como determinamos con PM, despu√©s de un an√°lisis superficial y un poco de reflexi√≥n, esto deber√≠a haber tomado dos o tres horas y no m√°s, porque lo que est√° mal con esto, solo necesita agregar una clase de pantalla preparada a su aplicaci√≥n.  De hecho, todo ya se ha hecho por nosotros, necesitamos hacer ctrl + c y ctrl + v.  Aqu√≠ hay solo un peque√±o matiz, el desarrollador que escribi√≥ esta aplicaci√≥n realmente amaba la herencia. <br><br><img src="https://habrastorage.org/webt/bv/e7/h8/bve7h8vugtvsjzyw_ml4esh5vbe.jpeg"><br><br>  R√°pidamente encontr√© el ViewController que necesitaba, tuve la suerte de que no hab√≠a separaci√≥n de l√≥gica y presentaci√≥n.  Era un buen enfoque antiguo, cuando el controlador conten√≠a todo el c√≥digo necesario.  Lo copi√© en mi proyecto y comenc√© a descubrir c√≥mo hacerlo funcionar.  Y lo primero que descubr√≠ es que el controlador que necesito hereda de otro controlador.  Una cosa com√∫n, un evento bastante esperado.  Como no ten√≠a mucho tiempo, encontr√© la clase que necesitaba y la arrastr√© a mi proyecto.  Bueno, ahora deber√≠a funcionar, pens√©, ¬°y nunca me hab√≠a equivocado tanto! <br><br>  La clase que necesitaba no solo ten√≠a muchas variables de clases personalizadas que tambi√©n deb√≠an copiarse en mi proyecto, por lo que cada una de ellas hered√≥ algo.  A su vez, las clases base eran campos heredados o contenidos con tipos personalizados que, como muchos habr√≠an adivinado, heredaron algo, y esto, desafortunadamente, no era NSObject, UIViewController o UIView.  Por lo tanto, un buen tercio del proyecto innecesario migr√≥ a m√≠ en el proyecto. <br><br>  Como no se esperaba mucho tiempo para completar esta tarea, no vi otra manera de simplemente agregar las clases necesarias que xCode requer√≠a simplemente para iniciar mi proyecto sin problemas.  Como resultado, dos o tres horas se prolongaron un poco, ya que al final tuve que profundizar en toda la red de la jerarqu√≠a de la herencia, como un verdadero escultor, cortando el exceso. <br><br>  Como resultado, llegu√© a la conclusi√≥n de que todas las cosas buenas deber√≠an ser con moderaci√≥n, incluso algo tan "maravilloso" como la herencia.  Entonces comenc√© a comprender las desventajas de la herencia.  Conclu√≠ por m√≠ mismo, si quiero hacer m√≥dulos reutilizables, deber√≠a hacerlos m√°s independientes. <br><br><h4>  Arquitectura de nuestra propia producci√≥n o continuamos creando bicicletas. </h4><br>  Al mudarme a un nuevo lugar de trabajo y comenzar un nuevo proyecto, tom√© en cuenta toda la experiencia disponible en el dise√±o de arquitectura y continu√© creando.  Naturalmente, segu√≠ ignorando las arquitecturas ya inventadas, pero al mismo tiempo me adher√≠ persistentemente al principio de "divide y vencer√°s". <br><br>  No pas√≥ mucho tiempo antes del advenimiento de Swift, as√≠ que profundic√© en las posibilidades de Objective-c.  Decid√≠ hacer una inyecci√≥n de dependencia usando las caracter√≠sticas del lenguaje.  Me inspir√≥ la herramienta de expansi√≥n lib; ni siquiera recuerdo su nombre. <br><br>  La conclusi√≥n es: en la clase base BaseViewController, agregu√© un campo de clase BaseViewModel.  En consecuencia, para cada pantalla cre√© mi propio controlador, que hered√≥ los b√°sicos, y agregu√© un protocolo para que el controlador interact√∫e con viewModel.  Luego vino la magia.  Redefin√≠ las propiedades de viewModel y agregu√© soporte para el protocolo deseado.  A su vez, cre√© una nueva clase ViewModel para una pantalla particular que implement√≥ este protocolo.  Como resultado, en BaseViewController en el m√©todo viewDidLoad, verifiqu√© el tipo de protocolo del modelo, verifiqu√© la lista de todos los descendientes de BaseViewModel, encontr√© la clase que necesitaba y cre√© el viewModel del tipo que necesitaba. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de ViewController b√°sico</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;UIKit/UIKit.h&gt;</span></span></span><span class="hljs-meta"> // MVC model #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"BaseMVCModel.h"</span></span></span><span class="hljs-meta"> @class BaseViewController; @protocol BaseViewControllerDelegate </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;NSObject&gt;</span></span></span><span class="hljs-meta"> @required - (void)backFromNextViewController:(BaseViewController *)aNextViewController withOptions:(NSDictionary *)anOptionsDictionary; @end @interface BaseViewController : UIViewController </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;BaseViewControllerDelegate&gt;</span></span></span><span class="hljs-meta"> @property (nonatomic, weak) BaseMVCModel *model; @property (nonatomic, assign) id</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;BaseViewControllerDelegate&gt;</span></span></span><span class="hljs-meta"> prevViewController; - (void)backWithOptions:(NSDictionary *)anOptionsDictionary; + (void)setupUIStyle; @end import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"BaseViewController.h"</span></span></span><span class="hljs-meta"> // Helpers #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RuntimeHelper.h"</span></span></span><span class="hljs-meta"> @interface BaseViewController () @end @implementation BaseViewController + (void)setupUIStyle { } #pragma mark - #pragma mark Life cycle - (void)viewDidLoad { [super viewDidLoad]; self.model = [BaseMVCModel getModel:FindPropertyProtocol(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"model"</span></span></span><span class="hljs-meta">, [self class])]; } #pragma mark - #pragma mark Navigation - (void)backWithOptions:(NSDictionary *)anOptionsDictionary { if (self.prevViewController) { [self.prevViewController performSelector:@selector(backFromNextViewController:withOptions:) withObject:self withObject:anOptionsDictionary]; } } #pragma mark - #pragma mark Seque - (void)prepareForSegue:(UIStoryboardSegue *)segue sender:(id)sender { if ([segue.destinationViewController isKindOfClass:[BaseViewController class]] { ((BaseViewController *)segue.destinationViewController).prevViewController = self; } } #pragma mark - #pragma mark BaseViewControllerDelegate - (void)backFromNextViewController:(BaseViewController *)aNextViewController withOptions:(NSDictionary *)anOptionsDictionary { [self doesNotRecognizeSelector:_cmd]; } @end</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de ViewModel b√°sico</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface BaseMVCModel : NSObject @property (nonatomic, assign) id delegate; + (id)getModel:(NSString *)someProtocol; @end #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"BaseMVCModel.h"</span></span></span><span class="hljs-meta"> // IoC #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IoCContainer.h"</span></span></span><span class="hljs-meta"> @implementation BaseMVCModel + (id)getModel:(NSString *)someProtocol { return [[IoCContainer sharedIoCContainer] getModel:NSProtocolFromString(someProtocol)]; } @end</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Clases de ayuda</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface IoCContainer : NSObject + (instancetype)sharedIoCContainer; - (id)getModel:(Protocol *)someProtocol; @end #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"IoCContainer.h"</span></span></span><span class="hljs-meta"> // Helpers #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RuntimeHelper.h"</span></span></span><span class="hljs-meta"> // Models #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"BaseMVCModel.h"</span></span></span><span class="hljs-meta"> @interface IoCContainer () @property (nonatomic, strong) NSMutableSet *models; @end @implementation IoCContainer #pragma mark - #pragma mark Singleton + (instancetype)sharedIoCContainer { static IoCContainer *_sharedIoCContainer = nil; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^{ _sharedIoCContainer = [IoCContainer new]; }); return _sharedIoCContainer; } - (id)getModel:(Protocol *)someProtocol { if (!someProtocol) { return [BaseMVCModel new]; } NSArray *modelClasses = ClassGetSubclasses([BaseMVCModel class]); __block Class currentClass = NULL; [modelClasses enumerateObjectsUsingBlock:^(Class class, NSUInteger idx, BOOL *stop) { if ([class conformsToProtocol:someProtocol]) { currentClass = class; } }]; if (currentClass == nil) { return [BaseMVCModel new]; } __block BaseMVCModel *currentModel = nil; [self.models enumerateObjectsUsingBlock:^(id model, BOOL *stop) { if ([model isKindOfClass:currentClass]) { currentModel = model; } }]; if (!currentModel) { currentModel = [currentClass new]; [self.models addObject:currentModel]; } return currentModel; } - (NSMutableSet *)models { if (!_models) { _models = [NSMutableSet set]; } return _models; } @end #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> NSString * FindPropertyProtocol(NSString *propertyName, Class class); NSArray * ClassGetSubclasses(Class parentClass); #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RuntimeHelper.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;objc/runtime.h&gt;</span></span></span><span class="hljs-meta"> #pragma mark - #pragma mark Functions NSString * FindPropertyProtocol(NSString *aPropertyName, Class class) { unsigned int propertyCount; objc_property_t *properties = class_copyPropertyList(class, &amp;propertyCount); for (unsigned int i = 0; i </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; propertyCount; i++) { objc_property_t property = properties[i]; const char *propertyName = property_getName(property); if ([@(propertyName) isEqualToString:aPropertyName]) { const char *attrs = property_getAttributes(property); NSString* propertyAttributes = @(attrs); NSScanner *scanner = [NSScanner scannerWithString: propertyAttributes]; [scanner scanUpToString:@"&lt;" intoString:NULL]; [scanner scanString:@"&lt;" intoString:NULL]; NSString* protocolName = nil; [scanner scanUpToString:@"&gt;</span></span></span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" intoString: &amp;protocolName]; return protocolName; } } return nil; } NSArray * ClassGetSubclasses(Class parentClass) { int numClasses = objc_getClassList(NULL, 0); Class *classes = NULL; classes = (Class *)malloc(sizeof(Class) * numClasses); numClasses = objc_getClassList(classes, numClasses); NSMutableArray *result = [NSMutableArray array]; for (NSInteger i = 0; i &lt; numClasses; i++) { Class superClass = classes[i]; do { superClass = class_getSuperclass(superClass); } while(superClass &amp;&amp; superClass != parentClass); if (superClass == nil) { continue; } [result addObject:classes[i]]; } free(classes); return result; }</span></span></span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de pantalla de inicio de sesi√≥n</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"BaseViewController.h"</span></span></span><span class="hljs-meta"> @protocol LoginProtocol </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;NSObject&gt;</span></span></span><span class="hljs-meta"> @required - (void)login:(NSString *)aLoginString password:(NSString *)aPasswordString completionBlock:(DefaultCompletionBlock)aCompletionBlock; @end @interface LoginVC : BaseViewController @end #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"LoginVC.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UIViewController+Alert.h"</span></span></span><span class="hljs-meta"> #import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"UIViewController+HUD.h"</span></span></span><span class="hljs-meta"> @interface LoginVC () @property id</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;LoginProtocol&gt;</span></span></span><span class="hljs-meta"> model; @property (weak, nonatomic) IBOutlet UITextField *emailTF; @property (weak, nonatomic) IBOutlet UITextField *passTF; @end @implementation LoginVC @synthesize model = _model; #pragma mark - #pragma mark IBActions - (IBAction)loginAction:(id)sender { [self login]; } #pragma mark - #pragma mark UITextFieldDelegate - (BOOL)textFieldShouldReturn:(UITextField *)textField { if (textField == self.emailTF) { [self.passTF becomeFirstResponder]; } else { [self login]; } return YES; } #pragma mark - #pragma mark Login - (void)login { NSString *email = self.emailTF.text; NSString *pass = self.passTF.text; if (email.length == 0 || pass.length == 0) { [self showAlertOkWithMessage:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Please, input info!"</span></span></span><span class="hljs-meta">]; return; } __weak __typeof(self)weakSelf = self; [self showHUD]; [self.model login:self.emailTF.text password:self.passTF.text completionBlock:^(BOOL isDone, NSError *anError) { [weakSelf hideHUD]; if (isDone) { [weakSelf backWithOptions:nil]; } }]; } @end</span></span></code> </pre> <br></div></div><br>  De una manera tan directa, hice una inicializaci√≥n perezosa de viewModel y conect√© mal la vista con los modelos a trav√©s de protocolos.  Con todo esto, en ese momento todav√≠a no sab√≠a nada sobre la arquitectura MVP, aunque algo similar se cern√≠a sobre m√≠. <br>  La navegaci√≥n entre las pantallas se dej√≥ a discreci√≥n de "viewModel", ya que agregu√© un enlace d√©bil al controlador. <br><br>  Recordando esta implementaci√≥n ahora, no puedo decir con certeza si todo estuvo mal.  La idea de separar capas fue un √©xito, se simplific√≥ el momento de crear y asignar modelos al controlador. <br>  Pero por m√≠ mismo, decid√≠ aprender m√°s sobre enfoques y arquitecturas ya hechas, ya que durante el desarrollo de una aplicaci√≥n con mi propia arquitectura, tuve que lidiar con muchos matices.  Por ejemplo, reutilizaci√≥n de pantallas y modelos, herencia, transiciones complejas entre pantallas.  En ese momento, me pareci√≥ que viewModel era parte de la l√≥gica empresarial, aunque ahora entiendo que todav√≠a es una capa de presentaci√≥n.  Obtuve una gran experiencia durante este experimento. <br><br><h4>  MVVM con alma MVP </h4><br>  Habiendo adquirido experiencia, decid√≠ elegir una arquitectura espec√≠fica para m√≠ y seguirla, en lugar de inventar bicicletas.  Comenc√© a leer m√°s sobre arquitecturas, a estudiar en detalle lo popular en ese momento y me decid√≠ por MVVM.  Francamente, no entend√≠ de inmediato su esencia, pero la eleg√≠ porque me gust√≥ el nombre. <br><br>  No entend√≠ de inmediato la esencia de la arquitectura y la relaci√≥n entre ViewModel y View (ViewController), pero comenc√© a hacer lo que entend√≠a.  Los ojos tienen miedo y las manos escriben fren√©ticamente el c√≥digo. <br><br>  En mi defensa, agregar√© que en ese momento el tiempo y el tiempo para pensar y analizar la creaci√≥n que cre√© eran muy ajustados.  Por lo tanto, en lugar de carpetas, hice enlaces directos en el ViewModel a la Vista correspondiente.  Y ya en ViewModel, hice la configuraci√≥n de la presentaci√≥n. <br><br>  Sobre MVP, tuve la misma idea que sobre otras arquitecturas, as√≠ que cre√≠ firmemente que era MVVM, en el que ViewModel result√≥ ser la presentaci√≥n m√°s real. <br><br><div class="spoiler">  <b class="spoiler_title">Un ejemplo de mi arquitectura "MVVM" y s√≠, me gust√≥ la idea con RootViewController, que es responsable del m√°s alto nivel de navegaci√≥n en la aplicaci√≥n.</b>  <b class="spoiler_title">Sobre el enrutador se escribe a continuaci√≥n.</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit class RootViewController: UIViewController { var viewModel: RootViewModel? override func viewDidLoad() { super.viewDidLoad() let router = (UIApplication.shared.delegate as? AppDelegate)!.router viewModel = RootViewModel(with: self, router: router) viewModel?.setup() } } <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit protocol ViewModelProtocol: class { func setup() func backAction() } class RootViewModel: NSObject, ViewModelProtocol { unowned var router : RootRouter unowned var view: RootViewController init(with view: RootViewController, router: RootRouter) { self.view = view self.router = router } <span class="hljs-comment"><span class="hljs-comment">// MARK: - ViewModelProtocol func setup() { if AccountManager.shared.isLoggedIn() { router.route(to: RootRoutes.launch.rawValue, from: view, parameters: nil) } else { router.route(to: RootRoutes.loginregistartion.rawValue, from: view, parameters: nil) } } func backAction() { } }</span></span></code> </pre> <br></div></div><br>  Esto no afect√≥ particularmente la calidad del proyecto, ya que se respet√≥ el orden y un enfoque √∫nico.  Pero la experiencia fue invaluable.  Despu√©s de las bicicletas que cre√©, finalmente comenc√© a hacerlo seg√∫n la arquitectura generalmente aceptada.  A menos que los presentadores se llamaran presentadores, lo que podr√≠a confundir a un desarrollador externo. <br><br>  Decid√≠ que en el futuro vale la pena hacer peque√±os proyectos de prueba, para profundizar en la esencia de un enfoque particular en el dise√±o con m√°s detalle.  Por as√≠ decirlo, primero siente en la pr√°ctica y luego entra en la batalla.  Tal es la conclusi√≥n que hice por m√≠ mismo. <br><br><h4>  El segundo intento con navegaci√≥n o enrutador y la curvatura de la navegaci√≥n. </h4><br>  En el mismo proyecto, donde implement√© MVVM valiente e ingenuamente, decid√≠ probar un nuevo enfoque en la navegaci√≥n entre pantallas.  Como mencion√© anteriormente, todav√≠a me adhiero a la idea de separar las pantallas y la l√≥gica de transici√≥n entre ellas. <br><br>  Leyendo sobre MVVM, estaba interesado en un patr√≥n como Router.  Despu√©s de revisar la descripci√≥n nuevamente, comenc√© a implementar la soluci√≥n en mi proyecto. <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de enrutador</b> <div class="spoiler_text"><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UIKit protocol Router: class { func route(to routeID: String, from view: UIViewController, parameters: Any?) func back(from view: UIViewController, parameters: Any?) } extension Router { func back(from view: UIViewController, parameters: Any?) { let navigationController: UINavigationController = checkNavigationController(for: view) navigationController.popViewController(animated: false) } } enum RootRoutes: String { case launch = "Launch" case loginregistartion = "LoginRegistartionRout" case mainmenu = "MainMenu" } class RootRouter: Router { var loginRegistartionRouter: LoginRegistartionRouter? var mainMenuRouter: MainMenuRouter? <span class="hljs-comment"><span class="hljs-comment">// MARK: Router func route(to routeID: String, from view: UIViewController, parameters: Any?) { var rootView = view if view is EPLaunchViewController { rootView = (view.navigationController?.viewControllers.first)! view.navigationController?.popViewController(animated: false) } if routeID == RootRoutes.loginregistartion.rawValue { loginRegistartionRouter = LoginRegistartionRouter(with: self) loginRegistartionRouter?.route(to: LRRouteID.phoneNumber.rawValue, from: rootView, parameters: nil) } else if routeID == RootRoutes.mainmenu.rawValue { if mainMenuRouter == nil { mainMenuRouter = MainMenuRouter(with: self) } mainMenuRouter?.route(to: MMRouteID.start.rawValue, from: rootView, parameters: nil) } else if routeID == RootRoutes.launch.rawValue { let storyboard = UIStoryboard(name: "RootStoryboard", bundle: nil) let launchView = storyboard.instantiateViewController(withIdentifier: "LaunchViewController") as! LaunchViewController let navigationController: UINavigationController = checkNavigationController(for: view) launchView.viewModel = LaunchViewModel(with: launchView, router: self) navigationController.pushViewController(launchView, animated: false) } } }</span></span></code> </pre><br></div></div><br>  La falta de experiencia en la implementaci√≥n de este patr√≥n se ha hecho sentir.  Todo parec√≠a estar ordenado y claro, el enrutador cre√≥ una nueva clase UIViewController, cre√≥ un ViewModel para √©l y ejecut√≥ la l√≥gica para cambiar a esta pantalla.  Pero a√∫n as√≠, muchas deficiencias se hicieron sentir. <br>  Comenzaron a surgir dificultades cuando era necesario abrir una aplicaci√≥n con una pantalla determinada despu√©s de una notificaci√≥n push.  Como resultado, en algunos lugares obtuvimos una l√≥gica confusa para elegir la pantalla correcta y m√°s dificultades para respaldar dicho enfoque. <br><br>  No abandon√© la idea de implementar Router, pero continu√© en esta direcci√≥n, ganando m√°s y m√°s experiencia.  No renuncies a algo despu√©s del primer intento fallido. <br><br><h4>  Gerente persistente </h4><br>  Otra clase de gerente interesante en mi pr√°ctica.  Pero este es relativamente joven.  De todos modos, el proceso de desarrollo consiste en prueba y error, y dado que todos, bueno, o la mayor√≠a de nosotros, estamos constantemente en el proceso de desarrollo, siempre aparecen errores. <br><br>  La esencia del problema es esta, la aplicaci√≥n tiene servicios que deben colgarse constantemente y al mismo tiempo deben estar disponibles en muchos lugares. <br><br>  Ejemplo: determinar el estado de Bluetooth.  En mi aplicaci√≥n, en varios servicios necesito comprender si bluetooth est√° activado o desactivado y suscribirme a las actualizaciones de estado.  Como hay varios lugares de este tipo: un par de pantallas, varios administradores de l√≥gica de negocios adicionales, etc., es necesario que cada uno de ellos se suscriba al delegado CBPeripheralManager (o CBCentralManager). <br><br>  La soluci√≥n parece ser obvia, creamos una clase separada que monitorea el estado del bluetooth y notifica a todos los que lo necesitan a trav√©s del patr√≥n Observador.  Pero entonces surge la pregunta, ¬øqui√©n almacenar√° permanentemente este servicio?  ¬°Lo primero que viene a la mente en este momento es hacerlo un singleton!  ¬°Todo parece estar bien! <br><br>  Pero aqu√≠ llega el momento en que m√°s de uno de estos servicios se ha acumulado en mi aplicaci√≥n.  Tampoco quiero hacer 100500 singletones en el proyecto. <br><br>  Y luego se encendi√≥ otra luz sobre mi peque√±a cabeza ya brillante.  Cree un singleton que almacene todos esos servicios y brinde acceso a ellos en toda la aplicaci√≥n.  Y as√≠ naci√≥ el "gerente permanente".  Con el nombre, no pens√© por mucho tiempo y lo llam√©, como todos ya pod√≠an adivinar, PersistentManager. <br><br>  Como puede ver, tambi√©n tengo un enfoque muy original para nombrar clases.  Creo que necesito agregar una moda sobre el nombre de las clases en mi plan de desarrollo. <br><br>  El tema clave en esta implementaci√≥n es el singleton, que est√° disponible en cualquier parte del proyecto.  Y esto lleva al hecho de que los gerentes que usan uno de los servicios permanentes acceden a √©l dentro de sus m√©todos, lo cual no es obvio.  Por primera vez, me encontr√© con esto cuando estaba haciendo una gran caracter√≠stica compleja en un proyecto de demostraci√≥n por separado y transfiriendo parte de la l√≥gica empresarial del proyecto principal.  Luego comenc√© a recibir mensajes con errores sobre servicios faltantes. <br><br>  La conclusi√≥n que hice despu√©s de esto es que necesita dise√±ar sus clases de tal manera que no haya dependencias ocultas.  Los servicios necesarios se deben pasar como par√°metros al inicializar la clase, pero no utilizando un singleton, al que se puede acceder desde cualquier lugar.  Y a√∫n m√°s bonito, vale la pena hacerlo usando protocolos. <br>  Esto result√≥ ser otra confirmaci√≥n de la falta de un patr√≥n singleton. <br><br><h4>  Resumen </h4><br>  Y eso, no me quedo quieto, sino que sigo adelante, dominando nuevos enfoques en la programaci√≥n.  Lo principal es moverse, buscar y experimentar.  Los errores siempre ser√°n, no hay escapatoria de esto.  Pero solo por el reconocimiento de sus errores, uno puede desarrollarse cualitativamente. <br><br><img src="https://habrastorage.org/webt/xe/xr/wf/xexrwfhf0_i5cpoxtv3kjrqxsne.gif"><br><br>  En la mayor√≠a de los casos, los problemas son las superclases que hacen mucho o las dependencias incorrectas entre las clases.  Lo que sugiere que es necesario descomponer la l√≥gica de manera m√°s competente. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451996/">https://habr.com/ru/post/451996/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451974/index.html">Historia de AMD: 50 a√±os de r√°pido desarrollo</a></li>
<li><a href="../451976/index.html">¬øCu√°nto cuesta un Runet "soberano"?</a></li>
<li><a href="../451982/index.html">Cuanto m√°s r√°pido se olvide de OOP, mejor para usted y sus programas.</a></li>
<li><a href="../451986/index.html">¬°Obtener datos con ORM es f√°cil! O no?</a></li>
<li><a href="../451990/index.html">Preguntas frecuentes sobre transferencias y vuelos de conexi√≥n: ¬øcu√°l es la diferencia que un pasajero puede y no puede hacer?</a></li>
<li><a href="../451998/index.html">Problemas de la agricultura de precisi√≥n y c√≥mo vivir con ellos.</a></li>
<li><a href="../452000/index.html">C√≥mo en Leroy Merlin puede comprar bienes en el almac√©n de un proveedor que no est√° en el surtido de la tienda</a></li>
<li><a href="../452004/index.html">Encontr√≥ el lugar del accidente de Bereshit en la luna</a></li>
<li><a href="../452006/index.html">Metaverso √©pico: por qu√© los autores de Fortnite deber√≠an obtenerlo</a></li>
<li><a href="../452008/index.html">Enfoques de ingenier√≠a y lista de verificaci√≥n: c√≥mo no volverse loco en el caos de las tareas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>