<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСЖЁЯП╗ ЁЯЩП ЁЯджЁЯП╝ рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди + Caliburn.Micro + рдСрдЯреЛрдлреЗрдХ ЁЯд╛ЁЯП╝ тЫ╡я╕П тЩ┐я╕П</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдореИрдВрдиреЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╛рд╕ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рд╣реИред рдореБрдЭреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдорд╡реАрд╡реАрдПрдо рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдФрд░ рдЖрдИрдУрд╕реА рдХрдВрдЯреЗрдирд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрдмреНрд▓реНрдпреВрдкреАрдПрдл...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди + Caliburn.Micro + рдСрдЯреЛрдлреЗрдХ</h1><div class="post__text post__text-html js-mediator-article" id="post-content-body" data-io-article-url="https://habr.com/ru/post/145583/">  рдореИрдВрдиреЗ рд╣рд╛рд▓ рд╣реА рдореЗрдВ рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╛рд╕ рдХреЗ рд╕рд╛рде рдкреНрд░рдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд┐рдпрд╛ рд╣реИред  рдореБрдЭреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <a href="http://ru.wikipedia.org/wiki/Model-View-ViewModel">рдПрдорд╡реАрд╡реАрдПрдо</a> рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдФрд░ рдЖрдИрдУрд╕реА рдХрдВрдЯреЗрдирд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <a href="http://ru.wikipedia.org/wiki/Model-View-ViewModel">рдбрдмреНрд▓реНрдпреВрдкреАрдПрдл</a> рдФрд░ рд╕рд┐рд▓реНрд╡рд░рд▓рд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд╕рд┐рдд рд╣реЛрдиреЗ рдХрд╛ рдХреБрдЫ рдЕрдиреБрднрд╡ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдХрд╛рд░реНрдп рдореЗрд░реЗ рд▓рд┐рдП рдмрд╣реБрдд рдореБрд╢реНрдХрд┐рд▓ рдирд╣реАрдВ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рдирд┐рдХрд▓рд╛, рдореЗрд░рд╛ рдкрд╕рдВрджреАрджрд╛ <a href="http://caliburnmicro.codeplex.com/">Caliburn.Micro</a> MVVM рдлреНрд░реЗрдорд╡рд░реНрдХ (CM) рдФрд░ рдореЗрд░рд╛ рдкрд╕рдВрджреАрджрд╛ <a href="http://code.google.com/p/autofac/">Autofac IoC</a> рдХрдВрдЯреЗрдирд░ рдЗрд╕ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред  рдореИрдВрдиреЗ рдЕрдкрдиреА рдЖрд╕реНрддреАрдиреЗрдВ рдЙрддрд╛рд░реАрдВ рдФрд░ рдЖрд╡реЗрджрди рдХреЗ рдХрдВрдХрд╛рд▓ рдмрдирд╛рдиреЗ рд╢реБрд░реВ рдХрд┐рдПред  CM рдЕрдкрдиреЗ рдХрд╛рдо рдХреЗ рд▓рд┐рдП IoC рдХрдВрдЯреЗрдирд░ рдХрд╛ рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред  рдЖрдк рдпрд╛ рддреЛ рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдХрдВрдЯреЗрдирд░ (рд╕рд┐рдВрдкрд▓рдХреЙрдирдЯреЗрдирд░) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╛ рдХрдИ рдЕрдиреНрдп рдЬрд┐рдирдХреЗ рд▓рд┐рдП рд╕реАрдПрдо рдХреЗ рд▓рд┐рдП рдПрдбреЗрдкреНрдЯрд░ рд╣реИрдВред  рдСрдЯреЛрдлрд╛рдХ рдХреЗ рд▓рд┐рдП рдРрд╕рд╛ рдПрдХ рдПрдбреЗрдкреНрдЯрд░ рд╣реИ - <a href="https://github.com/dbuksbaum/Caliburn.Micro.Autofac">рдХреИрд▓рд┐рдмрд░реНрдиред рдПрдорд┐рдХреНрд░реЛ.рдСрдЯреЛрдлреИрдХ</a> , рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдореИрдВрдиреЗ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА <a href="https://github.com/dbuksbaum/Caliburn.Micro.Autofac">рдбрдмреНрд▓реНрдпреВрдкреАрдПрдл</a> рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдерд╛ред  рдпрд╣ рдЕрджреНрднреБрдд рд╣реИ, рд▓реЗрдХрд┐рди рдЯрд╛рд░ рдмреИрд░рд▓, рд╣рдореЗрд╢рд╛ рдХреА рддрд░рд╣, рдорд░рд╣рдо рдореЗрдВ рдПрдХ рдордХреНрдЦреА рджреНрд╡рд╛рд░рд╛ рдмрд░реНрдмрд╛рдж рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ - рд╕реАрдПрдо 1.3.1 (рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдг) рдХреЗ рд▓рд┐рдП рдСрдЯреЛрдлрд╛рдХ рдПрдбрд╛рдкреНрдЯрд░ рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди рдХреЗ рддрд╣рдд рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдХреБрдЫ рд╕рдордп рдкрд╣рд▓реЗ рддрдХ, рдпрд╣ рд╕рдВрдХрд▓рди рднреА рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд▓реЗрдЦрдХ, <a href="http://buksbaum.us/">рдбреЗрд╡рд┐рдб рдмрдХреНрд╕рдмрд╛рдЙрдо</a> рдиреЗ рд▓рдЧрднрдЧ рддреАрди рд╕рдкреНрддрд╛рд╣ рдкрд╣рд▓реЗ рдЗрд╕ рджреЛрд╖ рдХреЛ рдареАрдХ рдХрд┐рдпрд╛ рдерд╛ред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рддрд░реАрдХрд╛ рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп, рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдЬрд╛рд╣рд┐рд░рд╛ рддреМрд░ рдкрд░ рдбреЗрд╡рд┐рдб рдЦреБрдж рд╡рд┐рдВрдбреЛрдЬ рдлреЛрди рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╡рд┐рдХрд╕рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдпрд╣ рд╕рдВрд╕реНрдХрд░рдг рдЕрдзреВрд░рд╛ рд░рд╣ рдЧрдпрд╛ рд╣реИред  рдореИрдВ рдЕрдкрдиреЗ рдкрд╕рдВрджреАрджрд╛ рдмрдВрдбрд▓ рдХреЛ рдордирд╛ рдирд╣реАрдВ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛ рдФрд░ рдореБрдЭреЗ рдЗрд╕ рдПрдбреЙрдкреНрдЯрд░ рдХреЛ рдЦреБрдж рд▓рд┐рдЦрдирд╛ рдерд╛ред  рдЖрдЬ рдореИрдВ рдЖрдкрдХреЗ рдзреНрдпрд╛рди рдореЗрдВ рдЗрд╕реЗ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реВрдВред <br><br>  рдореБрдЭреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд╣рд▓ рдХрд░рдирд╛ рдерд╛: <br><ul><li>  рдЕрд╡рдпрд╡ рдЬреЛ IPhoneService рдФрд░ INavigationService рдХреЛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдХреЛ рдХрдВрдЯреЗрдирд░ рдореЗрдВ рдкрдВрдЬреАрдХреГрдд рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ AutofacBootstrapper рдореЗрдВ рддреБрд░рдВрдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред </li><li>  IPhoneContainer рдХрд╛ рдХреЛрдИ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдирд╣реАрдВ рд╣реБрдЖ, рдЬрд┐рд╕рд╕реЗ рдмрдбрд╝реА рдореБрд╢реНрдХрд┐рд▓реЗрдВ рдЖрдИрдВред </li></ul><br><a name="habracut"></a><br>  AutofacBootstrapper рдФрд░ AutofacPhoneContainer рдХреЗ рдЕрдВрддрд┐рдо рд╕рдВрд╕реНрдХрд░рдг рдиреАрдЪреЗ рджрд┐рдП рдЧрдП рд╣реИрдВ, рдореИрдВрдиреЗ рдЙрдиреНрд╣реЗрдВ рдХреБрдЫ рд╕рдордп рдкрд╣рд▓реЗ рд▓реЗрдЦрдХ рдХреЛ рднреЗрдЬрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рдЙрдиреНрд╣реЛрдВрдиреЗ рдЙрдиреНрд╣реЗрдВ рдЕрдкрдиреА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдХреАрдХреГрдд рдирд╣реАрдВ рдХрд┐рдпрд╛, рдмрд╕ рдПрдХ рдЯреВрдЯрд╛ рд╣реБрдЖ рд╕рдВрд╕реНрдХрд░рдг рд╣реИ (рдбреЗрдЯрд╛ рдХреЛ рдЕрд▓рдЧ рднрдВрдбрд╛рд░рдг рдФрд░ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП)ред  <a href="">рдкрд░реАрдХреНрд╖рдг рдкрд░рд┐рдпреЛрдЬрдирд╛ рдпрд╣рд╛рдВ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ</a> ред <br>  рд╕рд╛рде рд╣реА, рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ рдореБрдЭреЗ рд╕реАрдПрдо рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ рдПрдХ рдЕрдкреНрд░рд┐рдп рдмрдЧ рдорд┐рд▓рд╛: рдЕрд▓рдЧ-рдЕрд▓рдЧ рднрдВрдбрд╛рд░рдг рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдлрд╝реАрд▓реНрдб рдХреЗ рдорд╛рди рд╕рднреА рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рд╕рд╣реЗрдЬреЗ рдирд╣реАрдВ рдЬрд╛рддреЗ рд╣реИрдВред  рдореЗрд░реЗ рдЯреЗрд╕реНрдЯ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ рдмрд┐рд▓реНрдб CM рдкрд╣рд▓реЗ рд╣реА рдЗрд╕ рдЦрд╛рдореА рдХреЛ рдмрдЦреНрд╢ рдЪреБрдХрд╛ рд╣реИред  рдореИрдВрдиреЗ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реБрдП CM рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдПрдХ <a href="http://caliburnmicro.codeplex.com/workitem/232">рдмрдЧ рд░рд┐рдкреЛрд░реНрдЯ</a> рдмрдирд╛рдИред  рдЖрд╢рд╛ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕реЗ рдЬрд▓реНрдж рд╣реА рдареАрдХ рдХрд░ рд▓рд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br><br><div class="spoiler">  <b class="spoiler_title">рдСрдЯреЛрдлреИрдХ рдмреВрдЯрд╕реНрдЯреНрд░реИрдкрд░</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Project: Caliburn.Micro.Autofac // File name: AutofacBootstrapper.cs // File GUID: C5C743E2-7AD1-496C-824A-9AEFBF5F8979 // Authors: David Buksbaum (david@buksbaum.us), Mike Eshva (mike@eshva.ru) // Date of creation: 20.05.2012 using System; using System.Collections.Generic; using System.ComponentModel; using System.Linq; using System.Reflection; using System.Windows.Controls; using Autofac; using Microsoft.Phone.Controls; using IContainer = Autofac.IContainer; namespace Caliburn.Micro.Autofac { /// &lt;summary&gt; /// Autofac specific &lt;see cref="PhoneBootstrapper"/&gt; realization. /// &lt;/summary&gt; public class AutofacBootstrapper : PhoneBootstrapper { #region Public properties /// &lt;summary&gt; /// Gets or sets flag should the namespace convention be enforced for type registration. The /// default is true. For views, this would require a views namespace to end with Views For /// view-models, this would require a view models namespace to end with ViewModels. /// &lt;/summary&gt; /// &lt;remarks&gt; /// Case is important as views would not match. /// &lt;/remarks&gt; public bool EnforceNamespaceConvention { get; set; } /// &lt;summary&gt; /// Gets or sets flag should the view be treated as loaded when registering the /// &lt;see cref="INavigationService"/&gt;. /// &lt;/summary&gt; public bool TreatViewAsLoaded { get; set; } /// &lt;summary&gt; /// Gets or sets the base type required for a view model. /// &lt;/summary&gt; public Type ViewModelBaseType { get; set; } /// &lt;summary&gt; /// Gets or sets method for creating the window manager. /// &lt;/summary&gt; public Func&lt;IWindowManager&gt; CreateWindowManager { get; set; } /// &lt;summary&gt; /// Gets or sets method for creating the event aggregator. /// &lt;/summary&gt; public Func&lt;IEventAggregator&gt; CreateEventAggregator { get; set; } /// &lt;summary&gt; /// Gets or sets method for creating the frame adapter. /// &lt;/summary&gt; public Func&lt;FrameAdapter&gt; CreateFrameAdapter { get; set; } /// &lt;summary&gt; /// Gets or sets method for creating the phone application service adapter. /// &lt;/summary&gt; public Func&lt;PhoneApplicationServiceAdapter&gt; CreatePhoneApplicationServiceAdapter { get; set; } /// &lt;summary&gt; /// Gets or sets method for creating the vibrate controller. /// &lt;/summary&gt; public Func&lt;IVibrateController&gt; CreateVibrateController { get; set; } /// &lt;summary&gt; /// Gets or sets method for creating the sound effect player. /// &lt;/summary&gt; public Func&lt;ISoundEffectPlayer&gt; CreateSoundEffectPlayer { get; set; } #endregion #region Protected interface /// &lt;summary&gt; /// Gets Autofac container instance. /// &lt;/summary&gt; protected IContainer Container { get; private set; } /// &lt;summary&gt; /// Do not override this method. This is where the IoC container is configured. /// &lt;/summary&gt; /// &lt;exception cref="NullReferenceException"&gt; /// Either CreateFrameAdapter or CreateWindowManager or CreateEventAggregator or /// CreatePhoneApplicationServiceAdapter or CreateVibrateController or /// CreateSoundEffectPlayer is null. /// &lt;/exception&gt; protected override void Configure() { // allow base classes to change bootstrapper settings ConfigureBootstrapper(); // validate settings if (CreateFrameAdapter == null) { throw new NullReferenceException("CreateFrameAdapter is not specified."); } if (CreateWindowManager == null) { throw new NullReferenceException("CreateWindowManager is not specified."); } if (CreateEventAggregator == null) { throw new NullReferenceException("CreateEventAggregator is not specified."); } if (CreatePhoneApplicationServiceAdapter == null) { throw new NullReferenceException( "CreatePhoneApplicationServiceAdapter is not specified."); } if (CreateVibrateController == null) { throw new NullReferenceException("CreateVibrateController is not specified."); } if (CreateSoundEffectPlayer == null) { throw new NullReferenceException("CreateSoundEffectPlayer is not specified."); } // Configure container. ContainerBuilder lBuilder = new ContainerBuilder(); // Register phone services. Assembly lCaliburnAssembly = typeof (IStorageMechanism).Assembly; // Register IStorageMechanism implementors. lBuilder.RegisterAssemblyTypes(lCaliburnAssembly) .Where( aType =&gt; typeof (IStorageMechanism).IsAssignableFrom(aType) &amp;&amp; !aType.IsAbstract &amp;&amp; !aType.IsInterface) .As&lt;IStorageMechanism&gt;() .InstancePerLifetimeScope(); // Register IStorageHandler implementors. lBuilder.RegisterAssemblyTypes(AssemblySource.Instance.ToArray()) .Where( aType =&gt; typeof (IStorageHandler).IsAssignableFrom(aType) &amp;&amp; !aType.IsAbstract &amp;&amp; !aType.IsInterface) .As&lt;IStorageHandler&gt;() .InstancePerLifetimeScope(); // Register view models. lBuilder.RegisterAssemblyTypes(AssemblySource.Instance.ToArray()) // Must be a type with a name that ends with ViewModel. .Where(aType =&gt; aType.Name.EndsWith("ViewModel")) // Mmust be in a namespace ending with ViewModels. .Where( aType =&gt; !EnforceNamespaceConvention || (!string.IsNullOrEmpty(aType.Namespace) &amp;&amp; aType.Namespace.EndsWith("ViewModels"))) // Must implement INotifyPropertyChanged (deriving from PropertyChangedBase will statisfy this). .Where(aType =&gt; aType.GetInterface(ViewModelBaseType.Name, false) != null) // Registered as self. .AsSelf() // Subscribe on Activated event for viewmodels to make storage mechanism work. .OnActivated(aArgs =&gt; ActivateInstance(aArgs.Instance)) // Always create a new one. .InstancePerDependency(); // Register views. lBuilder.RegisterAssemblyTypes(AssemblySource.Instance.ToArray()) // Must be a type with a name that ends with View. .Where(aType =&gt; aType.Name.EndsWith("View")) // Must be in a namespace that ends in Views. .Where( aType =&gt; !EnforceNamespaceConvention || (!string.IsNullOrEmpty(aType.Namespace) &amp;&amp; aType.Namespace.EndsWith("Views"))) // Registered as self. .AsSelf() // Always create a new one. .InstancePerDependency(); // Register the singletons. lBuilder.Register&lt;IPhoneContainer&gt;( aContext =&gt; new AutofacPhoneContainer(aContext.Resolve&lt;IComponentContext&gt;())) .SingleInstance(); lBuilder.RegisterInstance&lt;INavigationService&gt;(CreateFrameAdapter()) .SingleInstance(); PhoneApplicationServiceAdapter lPhoneService = CreatePhoneApplicationServiceAdapter(); lBuilder.RegisterInstance&lt;IPhoneService&gt;(lPhoneService) .SingleInstance(); lBuilder.Register(aContext =&gt; CreateEventAggregator()) .SingleInstance(); lBuilder.Register(aContext =&gt; CreateWindowManager()) .SingleInstance(); lBuilder.Register(aContext =&gt; CreateVibrateController()) .SingleInstance(); lBuilder.Register(aContext =&gt; CreateSoundEffectPlayer()) .SingleInstance(); lBuilder.RegisterType&lt;StorageCoordinator&gt;().AsSelf() .SingleInstance(); lBuilder.RegisterType&lt;TaskController&gt;().AsSelf() .SingleInstance(); // Allow derived classes to add to the container. ConfigureContainer(lBuilder); // Build the container Container = lBuilder.Build(); // Get the phone container instance. PhoneContainer = (AutofacPhoneContainer) Container.Resolve&lt;IPhoneContainer&gt;(); // Start the storage coordinator. StorageCoordinator lStorageCoordinator = Container.Resolve&lt;StorageCoordinator&gt;(); lStorageCoordinator.Start(); // Start the task controller. TaskController lTaskController = Container.Resolve&lt;TaskController&gt;(); lTaskController.Start(); // Add custom conventions for the phone. AddCustomConventions(); } /// &lt;summary&gt; /// Do not override unless you plan to full replace the logic. This is how the framework /// retrieves services from the Autofac container. /// &lt;/summary&gt; /// &lt;param name="aService"&gt; /// The service to locate. /// &lt;/param&gt; /// &lt;param name="aKey"&gt; /// The key to locate. /// &lt;/param&gt; /// &lt;returns&gt; /// The located service. /// &lt;/returns&gt; /// &lt;exception cref="Exception"&gt; /// Could not locate any instances of service. /// &lt;/exception&gt; protected override object GetInstance(Type aService, string aKey) { object lInstance; if (string.IsNullOrEmpty(aKey)) { if (Container.TryResolve(aService, out lInstance)) { return lInstance; } } else { if (Container.TryResolveNamed(aKey, aService, out lInstance)) { return lInstance; } } throw new Exception( string.Format( "Could not locate any instances of service {0}.", aKey ?? aService.Name)); } /// &lt;summary&gt; /// Do not override unless you plan to full replace the logic. This is how the framework /// retrieves services from the Autofac container. /// &lt;/summary&gt; /// &lt;param name="aService"&gt; /// The service to locate. /// &lt;/param&gt; /// &lt;returns&gt; /// The located services. /// &lt;/returns&gt; protected override IEnumerable&lt;object&gt; GetAllInstances(Type aService) { IEnumerable&lt;object&gt; lResult = Container.Resolve(typeof (IEnumerable&lt;&gt;).MakeGenericType(aService)) as IEnumerable&lt;object&gt;; return lResult; } /// &lt;summary&gt; /// Do not override unless you plan to full replace the logic. This is how the framework /// retrieves services from the Autofac container. /// &lt;/summary&gt; /// &lt;param name="aInstance"&gt; /// The instance to perform injection on. /// &lt;/param&gt; protected override void BuildUp(object aInstance) { Container.InjectProperties(aInstance); } /// &lt;summary&gt; /// Override to provide configuration prior to the Autofac configuration. You must call the base version BEFORE any /// other statement or the behaviour is undefined. /// Current Defaults: /// EnforceNamespaceConvention = true /// TreatViewAsLoaded = false /// ViewModelBaseType = &lt;see cref="System.ComponentModel.INotifyPropertyChanged"/&gt; /// CreateWindowManager = &lt;see cref="Caliburn.Micro.WindowManager"/&gt; /// CreateEventAggregator = &lt;see cref="Caliburn.Micro.EventAggregator"/&gt; /// CreateFrameAdapter = &lt;see cref="Caliburn.Micro.FrameAdapter"/&gt; /// CreatePhoneApplicationServiceAdapter = &lt;see cref="Caliburn.Micro.PhoneApplicationServiceAdapter"/&gt; /// CreateVibrateController = &lt;see cref="Caliburn.Micro.SystemVibrateController"/&gt; /// CreateSoundEffectPlayer = &lt;see cref="Caliburn.Micro.XnaSoundEffectPlayer"/&gt; /// &lt;/summary&gt; protected virtual void ConfigureBootstrapper() { // By default, enforce the namespace convention. EnforceNamespaceConvention = true; // By default, do not treat the view as loaded. TreatViewAsLoaded = false; // The default view model base type. ViewModelBaseType = typeof (INotifyPropertyChanged); // Default window manager. CreateWindowManager = () =&gt; new WindowManager(); // Default event aggregator. CreateEventAggregator = () =&gt; new EventAggregator(); // Default frame adapter. CreateFrameAdapter = () =&gt; new FrameAdapter(RootFrame, TreatViewAsLoaded); // Default phone application service adapter. CreatePhoneApplicationServiceAdapter = () =&gt; new PhoneApplicationServiceAdapter(RootFrame); // Default vibrate controller. CreateVibrateController = () =&gt; new SystemVibrateController(); // Default sound effect player. CreateSoundEffectPlayer = () =&gt; new XnaSoundEffectPlayer(); } /// &lt;summary&gt; /// Override to include your own Autofac configuration after the framework has finished its /// configuration, but before the container is created. /// &lt;/summary&gt; /// &lt;param name="aBuilder"&gt; /// The Autofac configuration builder. /// &lt;/param&gt; protected virtual void ConfigureContainer(ContainerBuilder aBuilder) { } /// &lt;summary&gt; /// Activates an instance in phone container. Derived types should call this method for /// registering types that should support storage mechanism. /// &lt;/summary&gt; /// &lt;param name="aInstance"&gt; /// Instance to activate. /// &lt;/param&gt; /// &lt;remarks&gt; /// Use this method as event handler on service registation in /// &lt;see cref="ConfigureContainer"/&gt; method. ViewModels already registering with using it. /// &lt;/remarks&gt; protected void ActivateInstance(object aInstance) { if (PhoneContainer == null) { return; } PhoneContainer.ActivateInstance(aInstance); } #endregion #region Private properties private AutofacPhoneContainer PhoneContainer { get; set; } #endregion #region Private methods private static void AddCustomConventions() { ConventionManager.AddElementConvention&lt;Pivot&gt;( ItemsControl.ItemsSourceProperty, "SelectedItem", "SelectionChanged").ApplyBinding = (aViewModelType, aPath, aProperty, aElement, aConvention) =&gt; { if (ConventionManager .GetElementConvention(typeof (ItemsControl)) .ApplyBinding(aViewModelType, aPath, aProperty, aElement, aConvention)) { ConventionManager .ConfigureSelectedItem( aElement, Pivot.SelectedItemProperty, aViewModelType, aPath); ConventionManager .ApplyHeaderTemplate( aElement, Pivot.HeaderTemplateProperty, null, aViewModelType); return true; } return false; }; ConventionManager.AddElementConvention&lt;Panorama&gt;( ItemsControl.ItemsSourceProperty, "SelectedItem", "SelectionChanged").ApplyBinding = (aViewModelType, aPath, aProperty, aElement, aConvention) =&gt; { if (ConventionManager .GetElementConvention(typeof (ItemsControl)) .ApplyBinding(aViewModelType, aPath, aProperty, aElement, aConvention)) { ConventionManager .ConfigureSelectedItem( aElement, Panorama.SelectedItemProperty, aViewModelType, aPath); ConventionManager .ApplyHeaderTemplate( aElement, Panorama.HeaderTemplateProperty, null, aViewModelType); return true; } return false; }; } #endregion } }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">рдСрдЯреЛрдлреИрдХ рдмреВрдЯрд╕реНрдЯреНрд░реИрдкрд░</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Project: Caliburn.Micro.Autofac // File name: AutofacBootstrapper.cs // File GUID: CB807DF7-2D69-4B05-AC17-C3E191D7C182 // Authors: Mike Eshva (mike@eshva.ru) // Date of creation: 20.05.2012 using System; using System.IO.IsolatedStorage; using Autofac; namespace Caliburn.Micro.Autofac { /// &lt;summary&gt; /// Component that allows storage system to communicate with Autofac IoC container. /// &lt;/summary&gt; public class AutofacPhoneContainer : IPhoneContainer { #region Constructors /// &lt;summary&gt; /// Initialize new instance of component that allows storage system to communicate with /// Autofac IoC container. /// &lt;/summary&gt; /// &lt;param name="aContext"&gt; /// Autofac IoC context. /// &lt;/param&gt; /// &lt;exception cref="ArgumentNullException"&gt; /// Autofac IoC context not specified. /// &lt;/exception&gt; public AutofacPhoneContainer(IComponentContext aContext) { if (aContext == null) { throw new ArgumentNullException("aContext", "Autofac IoC context is not specified."); } Context = aContext; } #endregion #region IPhoneContainer Members /// &lt;summary&gt; /// Registers the service as a singleton stored in the phone state. /// &lt;/summary&gt; /// &lt;param name="aService"&gt; /// The service. /// &lt;/param&gt; /// &lt;param name="aPhoneStateKey"&gt; /// The phone state key. /// &lt;/param&gt; /// &lt;param name="aImplementation"&gt; /// The implementation. /// &lt;/param&gt; public void RegisterWithPhoneService (Type aService, string aPhoneStateKey, Type aImplementation) { string lObjectKey = aPhoneStateKey ?? aService.FullName; IPhoneService lPhoneService = Context.Resolve&lt;IPhoneService&gt;(); if (!lPhoneService.State.ContainsKey(lObjectKey)) { // There is no object with such a key in the phone state. // Create a plain new object and store it the phone state. object lEntireGraphObject = Context.Resolve(aService); lPhoneService.State[lObjectKey] = lEntireGraphObject; // Effectively replace service registration in // Autofac-container (the last registration wins). ContainerBuilder lBuilder = new ContainerBuilder(); lBuilder.RegisterType(aImplementation) .As(aService) .OnActivating( // Replace an object build by the container with one // from the phone state using OnActivating event. aArgs =&gt; { IPhoneService lInnerPhoneService = aArgs.Context.Resolve&lt;IPhoneService&gt;(); if (lInnerPhoneService.State.ContainsKey(lObjectKey)) { object lInstance = lInnerPhoneService.State[lObjectKey]; aArgs.ReplaceInstance(lInstance); } }); lBuilder.Update(Context.ComponentRegistry); } } /// &lt;summary&gt; /// Registers the service as a singleton stored in the app settings. /// &lt;/summary&gt; /// &lt;param name="aService"&gt; /// The service. /// &lt;/param&gt; /// &lt;param name="aPhoneSettingsKey"&gt; /// The app settings key. /// &lt;/param&gt; /// &lt;param name="aImplementation"&gt; /// The implementation. /// &lt;/param&gt; /// &lt;exception cref="ArgumentNullException"&gt; /// Service or implementation not specified. /// &lt;/exception&gt; public void RegisterWithAppSettings (Type aService, string aPhoneSettingsKey, Type aImplementation) { string lObjectKey = aPhoneSettingsKey ?? aService.FullName; if (!IsolatedStorageSettings.ApplicationSettings.Contains(lObjectKey)) { // There is no object with such a key in the application isolated storage. // Probably it is the first time application executed. // Create a plain new object and store it the application isolated storage. object lEntireGraphObject = Context.Resolve(aImplementation); IsolatedStorageSettings.ApplicationSettings[lObjectKey] = lEntireGraphObject; } // Effectively replace service registration in // Autofac-container (the last registration wins). ContainerBuilder lBuilder = new ContainerBuilder(); lBuilder.RegisterType(aImplementation) .As(aService) .OnActivating( // Replace an object build by the container with one // from the application isolated storage using OnActivating event. aArgs =&gt; { if (IsolatedStorageSettings.ApplicationSettings.Contains(lObjectKey)) { object lInstance = IsolatedStorageSettings.ApplicationSettings[lObjectKey]; aArgs.ReplaceInstance(lInstance); } }); lBuilder.Update(Context.ComponentRegistry); } /// &lt;summary&gt; /// Occurs when a new instance is created. /// &lt;/summary&gt; public event Action&lt;object&gt; Activated = delegate { }; #endregion #region Assembly interface /// &lt;summary&gt; /// Activates &lt;paramref name="aInstance"/&gt;. /// &lt;/summary&gt; /// &lt;param name="aInstance"&gt; /// Instance to activate. /// &lt;/param&gt; internal void ActivateInstance(object aInstance) { Activated(aInstance); } #endregion #region Private properties private IComponentContext Context { get; set; } #endregion } }</span></span></code> </pre><br></div></div><br><br>  PS рдореИрдВ рдареАрдХ рд╕реЗ рдХрд╣реВрдВрдЧрд╛ рдХрд┐ рдпрд╣ рдореЗрд░реЗ рдмреНрд▓реЙрдЧ рдХреА рдПрдХ рдкреЛрд╕реНрдЯ рд╣реИ, рдФрд░ рдореИрдВ рдирд┐рдпрдо рдХреЗ рдкреБрдирд░реНрдореБрджреНрд░рдг рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирддрд╛ рд╣реВрдВред  рд▓реЗрдХрд┐рди рддрдереНрдп рдпрд╣ рд╣реИ рдХрд┐ рдореЗрд░реЗ рдмреНрд▓реЙрдЧ рдХрд╛ рдкреНрд░рдЪрд╛рд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдФрд░ рдЬреЛ рдЬрд╛рдирдХрд╛рд░реА рдореИрдВ рдЕрдкрдиреЗ рд╡рд┐рдЪрд╛рд░ рдореЗрдВ рд╕рд╛рдЭрд╛ рдХрд░рддрд╛ рд╣реВрдВ, рд╡рд╣ рдХрдИ рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреА рд╣реИред  рдПрдХ рдмрд╣рд╛рдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ, рдореБрдЭреЗ рдЖрд╢рд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЧрд┐рдирд╛ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рдореИрдВ рдЕрдкрдиреЗ рдмреНрд▓реЙрдЧ рдХреЗ рд▓рд┐рдВрдХ рдирд╣реАрдВ рджреЗрддрд╛ред </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/In145583/">https://habr.com/ru/post/In145583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../In145578/index.html">рдЧреАрдХреНрд╕ рдХреЗ рд▓рд┐рдП рд╕рд░рд▓ phpMyAdmin рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрди</a></li>
<li><a href="../In145579/index.html">DataGenetics рд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рдбреЛрдореЗрди рддрдереНрдп</a></li>
<li><a href="../In145580/index.html">рд░рд┐рдЪрд░реНрдб рдлреЗрдирдореИрди рдкрд░ рдПрдлрдмреАрдЖрдИ рдбреЛрдЬрд┐рдпрд░ рдкреНрд░рдХрд╛рд╢рд┐рдд</a></li>
<li><a href="../In145581/index.html">Stuxnet, Flame рдФрд░ Duqu рдиреЗ GPL рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛</a></li>
<li><a href="../In145582/index.html">рдирдпрд╛ рдкрд░рд┐рд╡рд░реНрддрди: TAICHI рдЕрд▓реНрдЯреНрд░рд╛рдмреБрдХ рдФрд░ рдЯреНрд░рд╛рдВрд╕рдлрд╛рд░реНрдорд░ рдмреБрдХ</a></li>
<li><a href="../In145584/index.html">Beeline Wi-Fi рдЗрд╕рдХреЗ рд▓рд┐рдП рдЦреБрд▓реЗ рдЯреИрдм рдХреЗ рдкрддреЗ рджреЗрддрд╛ рд╣реИ</a></li>
<li><a href="../In145585/index.html">Ubuntu рд╕рд░реНрд╡рд░ 12.04 LTS рд╣реЛрдо рдореАрдбрд┐рдпрд╛ рд╕рд░реНрд╡рд░</a></li>
<li><a href="../In145586/index.html">рдХрд▓рд╛рдИ рдХрд╛ рдПрдХ рдЭрдЯрдХрд╛ рдХреЗ рд╕рд╛рде, рд╣реЙрдЯрдореЗрд▓ рдмрджрд▓ рд░рд╣рд╛ рд╣реИ ... рдиреНрдпреВрдореЗрд▓ рдореЗрдВ рдмрджрд▓ рд░рд╣рд╛ рд╣реИ</a></li>
<li><a href="../In145587/index.html">рдбрд┐рдмреНрд░реАрдбрд┐рдВрдЧ - рдПрдкрд┐рд╕реЛрдб 20 - рдСрдкреНрдЯрд┐рдорд┐рд╕реНрдЯ рдкреНрд░реЛрдЧреНрд░рд╛рдорд░</a></li>
<li><a href="../In145588/index.html">рдПрдПрдордбреА рдиреЗ рдЕрдкрдирд╛ рдорд┐рдиреА рдкреАрд╕реА рдкреЗрд╢ рдХрд┐рдпрд╛</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>