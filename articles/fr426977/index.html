<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§û ‚ùì üë®üèΩ‚Äçüé® LibreOffice: le cauchemar d'un comptable üò´ üåò üë∏</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="LibreOffice est une puissante suite bureautique gratuite pour un usage priv√©, √©ducatif et commercial. Ses d√©veloppeurs font un produit merveilleux, qu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LibreOffice: le cauchemar d'un comptable</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/426977/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bf0/ff5/4b4/bf0ff54b40fb8527f7bf79edc4050d37.png"></div><br>  LibreOffice est une puissante suite bureautique gratuite pour un usage priv√©, √©ducatif et commercial.  Ses d√©veloppeurs font un produit merveilleux, qui dans de nombreux domaines est utilis√© comme une alternative √† Microsoft Office.  L'√©quipe de PVS-Studio est toujours int√©ress√©e √† regarder le code de ces projets bien connus et √† essayer d'y trouver des erreurs.  Cette fois, c'√©tait facile √† faire.  Le projet contient de nombreuses erreurs pouvant entra√Æner de graves probl√®mes.  L'article discutera de quelques d√©fauts int√©ressants trouv√©s dans le code. <br><br><h2>  Pr√©sentation </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LibreOffice</a> est un tr√®s grand projet C ++.  La maintenance d'un projet de cette taille est une t√¢che difficile pour l'√©quipe de d√©veloppement.  Et, malheureusement, on a l'impression que la qualit√© du code LibreOffice ne fait pas assez attention. <br><br>  D'une part, le projet est tout simplement √©norme, tous les outils d'analyse statique ou dynamique ne peuvent pas g√©rer l'analyse des fichiers de code source 13k.  Tant de fichiers sont impliqu√©s dans la construction de la suite bureautique avec des biblioth√®ques tierces.  Le r√©f√©rentiel principal de LibreOffice stocke environ 8 000 fichiers de code source.  Cette quantit√© de code cr√©e des probl√®mes non seulement pour les d√©veloppeurs: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/95d/8f8/322/95d8f8322f57ac9af0206a3ef955e55e.png"></div><a name="habracut"></a><br>  D'un autre c√¥t√©, le projet a de nombreux utilisateurs et doit trouver et corriger autant d'erreurs que possible.  Chaque erreur peut blesser des centaines et des milliers d'utilisateurs.  Par cons√©quent, la grande taille de la base de code ne doit pas devenir une excuse pour refuser d'utiliser certains outils qui peuvent d√©tecter des erreurs.  Je pense que le lecteur a d√©j√† devin√© que nous parlons d'analyseurs de code statique :). <br><br>  Oui, l'utilisation d'analyseurs statiques ne garantit pas l'absence d'erreurs dans le projet.  Cependant, des outils tels que PVS-Studio sont capables de trouver un grand nombre d'erreurs au stade du d√©veloppement et ainsi de r√©duire la quantit√© de travail associ√©e au d√©bogage et au support de projet. <br><br>  Voyons ce que vous pouvez trouver d'int√©ressant dans le code source de LibreOffice si vous prenez l'analyseur de code statique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PVS-Studio</a> .  Les possibilit√©s d'ex√©cution de l'analyseur sont nombreuses: Windows, Linux, macOS.  Pour √©crire cette revue, le rapport PVS-Studio a √©t√© utilis√©, cr√©√© lors de l'analyse du projet sous Windows. <br><br><h2>  Changements depuis le dernier contr√¥le en 2015 </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b28/750/671/b28750671ffb2784af092ee21c716259.png"></div><br><br>  En mars 2015, la premi√®re analyse de LibreOffice (" <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V√©rification du projet LibreOffice</a> ") a √©t√© r√©alis√©e √† l'aide de PVS-Studio.  Depuis lors, la suite bureautique a beaucoup √©volu√© en tant que produit, mais elle contient √©galement de nombreuses erreurs.  Et certains mod√®les d'erreur n'ont pas chang√© du tout depuis lors.  Voici, par exemple, une erreur du premier article: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V656</a> Les variables 'aVRP', 'aVPN' sont initialis√©es via l'appel √† la m√™me fonction.  Il s'agit probablement d'une erreur ou d'un code non optimis√©.  Pensez √† inspecter l'expression ¬´rSceneCamera.GetVRP ()¬ª.  V√©rifiez les lignes: 177, 178. viewcontactofe3dscene.cxx 178 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ViewContactOfE3dScene::createViewInformation3D(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> basegfx::<span class="hljs-function"><span class="hljs-function">B3DPoint </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aVRP</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rSceneCamera.GetVRP())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> basegfx::<span class="hljs-function"><span class="hljs-function">B3DVector </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aVPN</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rSceneCamera.GetVRP())</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= const basegfx::B3DVector aVUV(rSceneCamera.GetVUV()); .... }</span></span></code> </pre> <br>  Ce bug a √©t√© corrig√©, mais voici ce qui a √©t√© trouv√© dans la derni√®re version du code: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V656</a> Les variables 'aSdvURL', 'aStrURL' sont initialis√©es via l'appel √† la m√™me fonction.  Il s'agit probablement d'une erreur ou d'un code non optimis√©.  Pensez √† inspecter l'expression ¬´pThm-&gt; GetSdvURL ()¬ª.  V√©rifier les lignes: 658, 659. gallery1.cxx 659 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetThmURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aThmURL; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSdgURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aSdgURL; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSdvURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aSdvURL; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> INetURLObject&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStrURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aStrURL; } <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Gallery::RemoveTheme( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString&amp; rThemeName ) { .... <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aThmURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetThmURL() )</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aSdgURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetSdgURL() )</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aSdvURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetSdvURL() )</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">INetURLObject </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">aStrURL</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( pThm-&gt;GetSdvURL() )</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  Comme vous l'avez peut-√™tre remarqu√©, les noms de fonction compos√©s subtils sont toujours une source d'erreurs. <br><br>  Un autre exemple int√©ressant de l'ancien code: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V656</a> Les variables 'nDragW', 'nDragH' sont initialis√©es via l'appel √† la m√™me fonction.  Il s'agit probablement d'une erreur ou d'un code non optimis√©.  Pensez √† inspecter l'expression ¬´rMSettings.GetStartDragWidth ()¬ª.  V√©rifier les lignes: 471, 472. winproc.cxx 472 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VCL_DLLPUBLIC</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MouseSettings</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStartDragWidth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetStartDragHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImplHandleMouseEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( .... )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> nDragW = rMSettings.GetStartDragWidth(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> nDragH = rMSettings.GetStartDragWidth(); .... }</code> </pre> <br>  Ce morceau de code contenait vraiment un bug qui est maintenant corrig√©.  Mais les erreurs dans le code ne diminuent pas ... Une situation similaire a maintenant √©t√© identifi√©e: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V656</a> Les variables 'defaultZoomX', 'defaultZoomY' sont initialis√©es via l'appel √† la m√™me fonction.  Il s'agit probablement d'une erreur ou d'un code non optimis√©.  Pensez √† inspecter l'expression ¬´pViewData-&gt; GetZoomX ()¬ª.  V√©rifiez les lignes: 5673, 5674. gridwin.cxx 5674 <br><br><pre> <code class="cpp hljs">OString ScGridWindow::getCellCursor(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... SCCOL nX = pViewData-&gt;GetCurX(); SCROW nY = pViewData-&gt;GetCurY(); Fraction defaultZoomX = pViewData-&gt;GetZoomX(); Fraction defaultZoomY = pViewData-&gt;GetZoomX(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  Les erreurs sont introduites dans le code litt√©ralement par analogie. <br><br><h2>  Ne vous laissez pas berner </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e64/21a/1a9/e6421a1a9d0e05a1dff0c27f304ce403.png"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V765</a> Une expression d'affectation compos√©e 'x - = x - ...' est suspecte.  Pensez √† l'inspecter pour une √©ventuelle erreur.  swdtflvr.cxx 3509 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> SwTransferable::PrivateDrop(...) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( rSrcSh.IsSelFrameMode() ) { <span class="hljs-comment"><span class="hljs-comment">//Hack: fool the special treatment aSttPt -= aSttPt - rSrcSh.GetObjRect().Pos(); } .... }</span></span></code> </pre> <br>  Voici un "Hack" si int√©ressant qui a √©t√© trouv√© en utilisant le diagnostic <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V765</a> .  Si vous simplifiez une ligne de code avec un commentaire, vous pouvez obtenir un r√©sultat inattendu: <br><br>  1√®re √©tape: <br><br><pre> <code class="cpp hljs">aSttPt = aSttPt - (aSttPt - rSrcSh.GetObjRect().Pos());</code> </pre> <br>  2√®me √©tape: <br><br><pre> <code class="cpp hljs">aSttPt = aSttPt - aSttPt + rSrcSh.GetObjRect().Pos();</code> </pre> <br>  3e √©tape <br><br><pre> <code class="cpp hljs">aSttPt = rSrcSh.GetObjRect().Pos();</code> </pre> <br>  Et puis qu'est-ce que le hack? <br><br>  Un autre exemple sur ce sujet: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V567</a> La modification de la variable 'nCount' n'est pas s√©quenc√©e par rapport √† une autre op√©ration sur la m√™me variable.  Cela peut conduire √† un comportement ind√©fini.  stgio.cxx 214 <br><br><pre> <code class="cpp hljs">FatError EasyFat::Mark(....) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ) { --nCount /= GetPageSize(); nCount++; } .... }</code> </pre> <br>  L'ex√©cution de code dans de telles situations peut d√©pendre du compilateur et de la norme de langage.  Pourquoi ne pas r√©√©crire cet extrait de code d'une mani√®re plus simple, plus claire et plus fiable? <br><br><h2>  Comment ne pas utiliser les tableaux et les vecteurs </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d61/38d/483/d6138d483ed86734a4b6d20405af255c.png"></div><br><br>  Pour une raison quelconque, quelqu'un a fait beaucoup d'erreurs similaires en travaillant avec des tableaux et des vecteurs.  Regardons ces exemples. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V557 Le</a> d√©passement de matrice est possible.  L'index 'nPageNum' pointe au-del√† de la limite du tableau.  pptx-epptooxml.cxx 1168 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PowerPointExport::ImplWriteNotes(sal_uInt32 nPageNum) { .... <span class="hljs-comment"><span class="hljs-comment">// add slide implicit relation to notes if (mpSlidesFSArray.size() &gt;= nPageNum) addRelation(mpSlidesFSArray[ nPageNum ]-&gt;getOutputStream(), oox::getRelationship(Relationship::NOTESSLIDE), OUStringBuffer() .append("../notesSlides/notesSlide") .append(static_cast&lt;sal_Int32&gt;(nPageNum) + 1) .append(".xml") .makeStringAndClear()); .... }</span></span></code> </pre> <br>  Le dernier index valide doit √™tre une valeur √©gale √† <i>size () - 1</i> .  Mais dans ce fragment de code, une situation a √©t√© autoris√©e lorsque l'index <i>nPageNum</i> peut avoir la valeur <i>mpSlidesFSArray.size ()</i> , √† cause de laquelle il existe un tableau hors limites et fonctionne avec un √©l√©ment compos√© de "garbage". <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V557 Le</a> d√©passement de matrice est possible.  L'index 'mnSelectedMenu' pointe au-del√† de la limite du tableau.  checklistmenu.cxx 826 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ScMenuFloatingWindow::ensureSubMenuNotVisible() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mnSelectedMenu &lt;= maMenuItems.size() &amp;&amp; maMenuItems[mnSelectedMenu].mpSubMenuWin &amp;&amp; maMenuItems[mnSelectedMenu].mpSubMenuWin-&gt;IsVisible()) { maMenuItems[mnSelectedMenu].mpSubMenuWin-&gt;ensureSubMenuNotVisible(); } EndPopupMode(); }</code> </pre> <br>  Fait int√©ressant, dans ce fragment de code, ils ont √©crit une v√©rification d'index plus clairement, mais en m√™me temps, ils ont fait la m√™me erreur. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V557 Le</a> d√©passement de matrice est possible.  L'index 'nXFIndex' pointe au-del√† de la limite du tableau.  xestyle.cxx 2613 <br><br><pre> <code class="cpp hljs">sal_Int32 XclExpXFBuffer::GetXmlStyleIndex( sal_uInt32 nXFIndex ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { OSL_ENSURE( nXFIndex &lt; maStyleIndexes.size(), <span class="hljs-string"><span class="hljs-string">"...."</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nXFIndex &gt; maStyleIndexes.size() ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// should be caught/debugged via above assert; return maStyleIndexes[ nXFIndex ]; }</span></span></code> </pre> <br>  Et cette erreur est doublement int√©ressante!  Dans la macro de d√©bogage, ils ont √©crit la v√©rification d'index correcte et, √† un autre endroit, ils ont √† nouveau fait une erreur, leur permettant de sortir du tableau. <br><br>  Consid√©rons maintenant un autre type d'erreur qui n'est pas li√© aux index. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V554</a> Utilisation incorrecte de shared_ptr.  La m√©moire allou√©e avec ¬´nouveau []¬ª sera nettoy√©e √† l'aide de ¬´supprimer¬ª.  dx_vcltools.cxx 158 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RawRGBABitmap</span></span></span><span class="hljs-class"> {</span></span> sal_Int32 mnWidth; sal_Int32 mnHeight; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; sal_uInt8 &gt; mpBitmapData; }; <span class="hljs-function"><span class="hljs-function">RawRGBABitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bitmapFromVCLBitmapEx</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ::BitmapEx&amp; rBmpEx )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">// convert transparent bitmap to 32bit RGBA // ======================================== const ::Size aBmpSize( rBmpEx.GetSizePixel() ); RawRGBABitmap aBmpData; aBmpData.mnWidth = aBmpSize.Width(); aBmpData.mnHeight = aBmpSize.Height(); aBmpData.mpBitmapData.reset( new sal_uInt8[ 4*aBmpData.mnWidth *aBmpData.mnHeight ] ); .... }</span></span></code> </pre> <br>  Ce morceau de code contient une erreur conduisant √† un comportement de programme non d√©fini.  Le fait est que la m√©moire est allou√©e et lib√©r√©e de diff√©rentes mani√®res.  Pour lib√©rer correctement la m√©moire, vous devez d√©clarer un champ de classe comme celui-ci: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">shared_ptr</span></span>&lt; sal_uInt8[] &gt; mpBitmapData;</code> </pre> <br><h2>  Comment cr√©er des macros deux fois </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ead/1d2/de0/ead1d2de04413fc43dba4e42280f98ed.png"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V568</a> Il est √©trange que l'argument de l'op√©rateur sizeof () soit le 'bTextFrame?  aProps: expression de aShapeProps.  wpscontext.cxx 134 <br><br><pre> <code class="cpp hljs">oox::core::ContextHandlerRef WpsContext::onCreateContext(....) { .... OUString aProps[] = { .... }; OUString aShapeProps[] = { .... }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; SAL_N_ELEMENTS(bTextFrame ? aProps : aShapeProps); <span class="hljs-comment"><span class="hljs-comment">//1 ++i) if (oInsets[i]) xPropertySet-&gt;setPropertyValue((bTextFrame ? aProps : aShapeProps)[i], //2 uno::makeAny(*oInsets[i])); .... }</span></span></code> </pre> <br>  Malheureusement pour de nombreux d√©veloppeurs, les arguments de macro ne se comportent pas comme des arguments de fonction.  Ignorer ce fait conduit souvent √† des erreurs.  Dans les cas # 1 et # 2, une construction presque identique est utilis√©e en utilisant l'op√©rateur ternaire.  Mais dans le premier cas - une macro, dans le second - une fonction.  Cependant, ce n'est que le sommet du probl√®me. <br><br>  Dans le cas # 1, l'analyseur a effectivement d√©tect√© le code d'erreur suivant: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (bTextFrame ? aProps : aShapeProps) / <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> ((bTextFrame ? aProps : aShapeProps)[<span class="hljs-number"><span class="hljs-number">0</span></span>])); ++i)</code> </pre> <br>  C'est notre boucle avec la macro <i>SAL_N_ELEMENTS</i> .  L'op√©rateur <i>sizeof</i> n'√©value pas l'expression dans l'op√©rateur ternaire.  Dans ce cas, l'arithm√©tique est effectu√©e avec la taille des pointeurs, dont le r√©sultat est des valeurs qui sont loin de la taille r√©elle des tableaux indiqu√©s.  Le calcul des valeurs incorrectes est en outre affect√© par la profondeur de bits de l'application. <br><br>  Mais il s'est av√©r√© qu'il y avait 2 macros <i>SAL_N_ELEMENTS</i> !  C'est-√†-dire  le pr√©processeur a ouvert la mauvaise macro, comment est-ce possible?  La d√©finition de la macro et les commentaires des d√©veloppeurs nous aideront √†: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> SAL_N_ELEMENTS # </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> defined(__cplusplus) &amp;&amp; ( defined(__GXX_EXPERIMENTAL_CXX0X__) || __cplusplus &gt;= 201103L ) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* * Magic template to calculate at compile time the number of elements * in an array. Enforcing that the argument must be a array and not * a pointer, eg * char *pFoo="foo"; * SAL_N_ELEMENTS(pFoo); * fails while * SAL_N_ELEMENTS("foo"); * or * char aFoo[]="foo"; * SAL_N_ELEMENTS(aFoo); * pass * * Unfortunately if arr is an array of an anonymous class then we need * C++0x, ie see * http://www.open-std.org/jtc1/sc22/wg21/docs/cwg_defects.html#757 */</span></span></span><span class="hljs-meta"> template </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;typename T, size_t S&gt; char (&amp;sal_n_array_size( T(&amp;)[S] ))[S]; # define SAL_N_ELEMENTS(arr) (sizeof(sal_n_array_size(arr))) # else # define SAL_N_ELEMENTS(arr) (sizeof (arr) / sizeof ((arr)[0])) # endif #endif</span></span></span></span></code> </pre> <br>  Une autre version de la macro contient une fonction de mod√®le s√ªre, mais quelque chose s'est mal pass√©: <br><br><ol><li>  La macro s√ªre n'√©tait pas incluse dans le code; </li><li>  Il est toujours impossible d'utiliser une autre macro, car  l'instanciation r√©ussie d'une fonction de mod√®le n'est effectu√©e que si des tableaux de m√™me taille sont transf√©r√©s √† l'op√©rateur ternaire.  Et dans ce cas, l'utilisation d'une telle macro perd son sens. </li></ol><br><h2>  Typos et copier-coller </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19d/419/905/19d41990527e23e0654820cfcddcbe9a.png"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V1013 Sous-</a> expression suspecte f1.Pitch == f2.CharSet dans une s√©quence de comparaisons similaires.  xmldlg_export.cxx 1251 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">equalFont</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Style </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; style1, Style </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> &amp; style2 )</span></span></span><span class="hljs-function"> </span></span>{ awt::FontDescriptor <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; f1 = style1._descr; awt::FontDescriptor <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp; f2 = style2._descr; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( f1.Name == f2.Name &amp;&amp; f1.Height == f2.Height &amp;&amp; f1.Width == f2.Width &amp;&amp; f1.StyleName == f2.StyleName &amp;&amp; f1.Family == f2.Family &amp;&amp; f1.CharSet == f2.CharSet &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= f1.Pitch == f2.CharSet &amp;&amp; // &lt;= f1.CharacterWidth == f2.CharacterWidth &amp;&amp; f1.Weight == f2.Weight &amp;&amp; f1.Slant == f2.Slant &amp;&amp; f1.Underline == f2.Underline &amp;&amp; f1.Strikeout == f2.Strikeout &amp;&amp; f1.Orientation == f2.Orientation &amp;&amp; bool(f1.Kerning) == bool(f2.Kerning) &amp;&amp; bool(f1.WordLineMode) == bool(f2.WordLineMode) &amp;&amp; f1.Type == f2.Type &amp;&amp; style1._fontRelief == style2._fontRelief &amp;&amp; style1._fontEmphasisMark == style2._fontEmphasisMark ); }</span></span></code> </pre> <br>  L'erreur est un bon candidat pour la mise √† jour de l'article ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Evil lives dans les fonctions de comparaison</a> ¬ª si jamais nous d√©cidons de le mettre √† jour ou de l'√©tendre.  Je pense que la probabilit√© de trouver une telle erreur (passer <i>f2.Pitch</i> ) seule est extr√™mement faible.  Qu'en penses-tu? <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V501</a> Il existe des sous-expressions identiques ¬´mpTable [ocArrayColSep]! = MpTable [eOp]¬ª √† gauche et √† droite de l'op√©rateur ¬´&amp;&amp;¬ª.  formulacompiler.cxx 632 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> FormulaCompiler::OpCodeMap::putOpCode(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ocSep: bPutOp = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; bRemoveFromMap = (mpTable[eOp] != <span class="hljs-string"><span class="hljs-string">";"</span></span> &amp;&amp; mpTable[ocArrayColSep] != mpTable[eOp] &amp;&amp; mpTable[ocArrayColSep] != mpTable[eOp]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; .... }</code> </pre> <br>  Le r√©sultat d'une copie irr√©fl√©chie √©tait un tel morceau de code.  Peut-√™tre que l'expression conditionnelle est simplement dupliqu√©e encore une fois, mais toujours dans le code il n'y a pas de place pour de telles ambigu√Øt√©s. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V517</a> L'utilisation du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mod√®le</a> 'if (A) {...} else if (A) {...}' a √©t√© d√©tect√©e.  Il y a une probabilit√© de pr√©sence d'erreur logique.  V√©rifiez les lignes: 781, 783. mysqlc_databasemetadata.cxx 781 <br><br><pre> <code class="cpp hljs">Reference&lt;XResultSet&gt; SAL_CALL ODatabaseMetaData::getColumns(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bIsCharMax = !xRow-&gt;wasNull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sDataType.equalsIgnoreAsciiCase(<span class="hljs-string"><span class="hljs-string">"year"</span></span>)) nColumnSize = sColumnType.copy(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).toInt32(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sDataType.equalsIgnoreAsciiCase(<span class="hljs-string"><span class="hljs-string">"date"</span></span>)) <span class="hljs-comment"><span class="hljs-comment">// &lt;= nColumnSize = 10; else if (sDataType.equalsIgnoreAsciiCase("date")) // &lt;= nColumnSize = 8; else if (sDataType.equalsIgnoreAsciiCase("datetime") || sDataType.equalsIgnoreAsciiCase("timestamp")) nColumnSize = 19; else if (!bIsCharMax) nColumnSize = xRow-&gt;getShort(7); else nColumnSize = nCharMaxLen; .... }</span></span></code> </pre> <br>  √Ä la suite de la copie d'expressions conditionnelles, une erreur a √©t√© commise dans le code, √† cause de laquelle la valeur <i>8</i> pour la variable <i>nColumnSize n'est</i> jamais d√©finie. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V523</a> L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instruction</a> 'then' est √©quivalente √† l'instruction 'else'.  svdpdf.hxx 146 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/// Transform the rectangle (left, right, top, bottom) by this Matrix. template &lt;typename T&gt; void Transform(....) { .... if (top &gt; bottom) top = std::max(leftTopY, rightTopY); else top = std::min(leftTopY, rightTopY); if (top &gt; bottom) bottom = std::max(leftBottomY, rightBottomY); // &lt;= else bottom = std::max(leftBottomY, rightBottomY); // &lt;= }</span></span></code> </pre> <br>  Ici, les fonctions <i>min ()</i> et <i>max () sont</i> confondues.  S√ªrement, √† cause de cette faute de frappe dans l'interface, quelque chose est √©trangement mis √† l'√©chelle. <br><br><h2>  Cycles √©tranges </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/361/175/35d/36117535d4e5edba8d6a11ce89ae5cbc.gif"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V533</a> Il est probable qu'une mauvaise variable soit incr√©ment√©e √† l'int√©rieur de l'op√©rateur 'for'.  Pensez √† revoir ¬´i¬ª.  javatypemaker.cxx 602 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">printConstructors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt; unoidl::SingleInterfaceBasedServiceEntity::Constructor:: Parameter &gt;::const_iterator j(i-&gt;parameters.begin()); j != i-&gt;parameters.end(); ++i) { o &lt;&lt; <span class="hljs-string"><span class="hljs-string">", "</span></span>; printType(o, options, manager, j-&gt;type, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j-&gt;rest) { o &lt;&lt; <span class="hljs-string"><span class="hljs-string">"..."</span></span>; } o &lt;&lt; <span class="hljs-string"><span class="hljs-string">' '</span></span> &lt;&lt; codemaker::java::translateUnoToJavaIdentifier( u2b(j-&gt;name), <span class="hljs-string"><span class="hljs-string">"param"</span></span>); } .... }</code> </pre> <br>  L'expression <i>++ i</i> dans la boucle semble tr√®s suspecte.  Il devrait peut-√™tre y avoir <i>++ j</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V756</a> Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">compteur</a> 'nIndex2' n'est pas utilis√© dans une boucle imbriqu√©e.  Envisagez d'inspecter l'utilisation du compteur ¬´nIndex¬ª.  treex.cxx 34 <br><br><pre> <code class="cpp hljs">SAL_IMPLEMENT_MAIN_WITH_ARGS(argc, argv) { OString sXHPRoot; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nIndex = <span class="hljs-number"><span class="hljs-number">1</span></span>; nIndex != argc; ++nIndex) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(argv[nIndex], <span class="hljs-string"><span class="hljs-string">"-r"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { sXHPRoot = OString( argv[nIndex + <span class="hljs-number"><span class="hljs-number">1</span></span>] ); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nIndex2 = nIndex+<span class="hljs-number"><span class="hljs-number">3</span></span>; nIndex2 &lt; argc; nIndex2 = nIndex2 + <span class="hljs-number"><span class="hljs-number">2</span></span> ) { argv[nIndex<span class="hljs-number"><span class="hljs-number">-3</span></span>] = argv[nIndex<span class="hljs-number"><span class="hljs-number">-1</span></span>]; argv[nIndex<span class="hljs-number"><span class="hljs-number">-2</span></span>] = argv[nIndex]; } argc = argc - <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } common::HandledArgs aArgs; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !common::handleArguments(argc, argv, aArgs) ) { WriteUsage(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... }</code> </pre> <br>  Il y a une sorte d'erreur dans la boucle <i>for</i> <b>interne</b> .  Parce que  la variable <i>nIndex ne</i> change pas; les deux m√™mes √©l√©ments du tableau sont remplac√©s √† chaque it√©ration.  Tr√®s probablement, au lieu de <i>nIndex</i> , la variable <b><i>nIndex2</i></b> aurait d√ª √™tre utilis√©e <b><i>partout</i></b> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V1008</a> Envisagez d'inspecter l'op√©rateur ¬´pour¬ª.  Pas plus d'une it√©ration de la boucle sera effectu√©e.  diagramhelper.cxx 292 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DiagramHelper::setStackMode( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Reference&lt; XDiagram &gt; &amp; xDiagram, StackMode eStackMode ) { .... sal_Int32 nMax = aChartTypeList.getLength(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( nMax &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> ) nMax = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( sal_Int32 nT = <span class="hljs-number"><span class="hljs-number">0</span></span>; nT &lt; nMax; ++nT ) { uno::Reference&lt; XChartType &gt; xChartType( aChartTypeList[nT] ); .... } .... }</code> </pre> <br>  La boucle <i>for</i> est intentionnellement limit√©e √† 1 it√©ration.  On ne sait pas pourquoi cela se fait de cette fa√ßon. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V612</a> Un ¬´retour¬ª inconditionnel dans une boucle.  pormulti.cxx 891 <br><br><pre> <code class="cpp hljs">SwTextAttr <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>* MergedAttrIterMulti::NextAttr(....) { .... <span class="hljs-function"><span class="hljs-function">SwpHints </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function">*</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pHints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m_pNode-&gt;GetpSwpHints())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pHints) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (m_CurrentHint &lt; pHints-&gt;Count()) { <span class="hljs-function"><span class="hljs-function">SwTextAttr </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function">*</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pHint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pHints-&gt;Get(m_CurrentHint))</span></span></span></span>; ++m_CurrentHint; rpNode = m_pNode; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pHint; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; .... }</code> </pre> <br>  Un exemple d'une boucle bizarre plus simple √† partir d'une it√©ration, qui est pr√©f√©rable de r√©√©crire dans une instruction conditionnelle. <br><br>  Quelques autres endroits de ce genre: <br><br><ul><li>  V612 Un ¬´retour¬ª inconditionnel dans une boucle.  txtfrm.cxx 144 </li><li>  V612 Un ¬´retour¬ª inconditionnel dans une boucle.  txtfrm.cxx 202 </li><li>  V612 Un ¬´retour¬ª inconditionnel dans une boucle.  txtfrm.cxx 279 </li></ul><br><h2>  Des conditions √©tranges </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f6/73a/01b/9f673a01bb41965f47539e9311546201.png"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V637</a> Deux conditions oppos√©es ont √©t√© rencontr√©es.  La deuxi√®me condition est toujours fausse.  V√©rifiez les lignes: 281, 285. authfld.cxx 281 <br><br><pre> <code class="cpp hljs">sal_uInt16 SwAuthorityFieldType::GetSequencePos(sal_IntPtr nHandle) { .... SwTOXSortTabBase* pOld = aSortArr[i].get(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(*pOld == *pNew) { <span class="hljs-comment"><span class="hljs-comment">//only the first occurrence in the document //has to be in the array if(*pOld &lt; *pNew) pNew.reset(); else // remove the old content aSortArr.erase(aSortArr.begin() + i); break; } .... }</span></span></code> </pre> <br>  L'analyseur a trouv√© des comparaisons contradictoires.  Quelque chose ne va clairement pas avec ce morceau de code. <br><br>  Le m√™me code est vu √† cet endroit: <br><br><ul><li>  V637 Deux conditions oppos√©es ont √©t√© rencontr√©es.  La deuxi√®me condition est toujours fausse.  V√©rifiez les lignes: 1827, 1829. doctxm.cxx 1827 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V590</a> Envisagez d'inspecter cette expression.  L'expression est excessive ou contient une erreur d'impression.  fileurl.cxx 55 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">OUString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convertToFileUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * filename, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((filename[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'.'</span></span>) || (filename[<span class="hljs-number"><span class="hljs-number">0</span></span>] != SEPARATOR)) { .... } .... }</code> </pre> <br>  Le probl√®me avec le fragment de code ci-dessus est que la premi√®re expression conditionnelle n'affecte pas le r√©sultat de l'expression enti√®re. <br><br>  Sur la base de telles erreurs, j'ai m√™me √©crit un article th√©orique: " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Expressions logiques en C / C ++. Comment les professionnels se trompent</a> ." <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V590</a> Envisagez d'inspecter cette expression.  L'expression est excessive ou contient une erreur d'impression.  unoobj.cxx 1895 <br><br><pre> <code class="cpp hljs">uno::Sequence&lt; beans::PropertyState &gt; SwUnoCursorHelper::GetPropertyStates(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION == eCaller) || (SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION_TOLERANT == eCaller)) &amp;&amp; pEntry-&gt;nWID &lt; FN_UNO_RANGE_BEGIN &amp;&amp; pEntry-&gt;nWID &gt; FN_UNO_RANGE_END &amp;&amp; pEntry-&gt;nWID &lt; RES_CHRATR_BEGIN &amp;&amp; pEntry-&gt;nWID &gt; RES_TXTATR_END ) { pStates[i] = beans::PropertyState_DEFAULT_VALUE; } .... }</code> </pre> <br>  Je ne comprends pas imm√©diatement quel est le probl√®me de cette condition, par cons√©quent, un fragment de code √©tendu a √©t√© √©crit √† partir du fichier pr√©trait√©: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION == eCaller) || (SW_PROPERTY_STATE_CALLER_SWX_TEXT_PORTION_TOLERANT == eCaller)) &amp;&amp; pEntry-&gt;nWID &lt; (<span class="hljs-number"><span class="hljs-number">20000</span></span> + <span class="hljs-number"><span class="hljs-number">1600</span></span>) &amp;&amp; pEntry-&gt;nWID &gt; ((<span class="hljs-number"><span class="hljs-number">20000</span></span> + <span class="hljs-number"><span class="hljs-number">2400</span></span>) + <span class="hljs-number"><span class="hljs-number">199</span></span>) &amp;&amp; pEntry-&gt;nWID &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; pEntry-&gt;nWID &gt; <span class="hljs-number"><span class="hljs-number">63</span></span> ) { pStates[i] = beans::PropertyState_DEFAULT_VALUE; }</code> </pre> <br>  Il se trouve que pas un seul nombre n'est inclus simultan√©ment dans les 4 plages sp√©cifi√©es dans la condition par des nombres.  Les d√©veloppeurs ont fait une erreur. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V590</a> Envisagez d'inspecter l'expression '* pData &lt;= MAXLEVEL &amp;&amp; * pData &lt;= 9'.  L'expression est excessive ou contient une erreur d'impression.  ww8par2.cxx 756 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sal_uInt8 MAXLEVEL = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SwWW8ImplReader::Read_ANLevelNo(....) { .... <span class="hljs-comment"><span class="hljs-comment">// Range WW:1..9 -&gt; SW:0..8 no bullets / numbering if (*pData &lt;= MAXLEVEL &amp;&amp; *pData &lt;= 9) { .... } else if( *pData == 10 || *pData == 11 ) { // remember type, the rest happens at Sprm 12 m_xStyles-&gt;mnWwNumLevel = *pData; } .... }</span></span></code> </pre> <br>  Du fait que la premi√®re condition utilise une constante avec une valeur de <i>10</i> , la condition s'est av√©r√©e redondante.  Ce morceau de code peut √™tre r√©√©crit comme suit: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*pData &lt;= <span class="hljs-number"><span class="hljs-number">9</span></span>) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( *pData == <span class="hljs-number"><span class="hljs-number">10</span></span> || *pData == <span class="hljs-number"><span class="hljs-number">11</span></span> ) { .... }</code> </pre> <br>  Mais il y avait peut-√™tre un autre probl√®me dans le code pr√©sent√©. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V757</a> Il est possible qu'une variable incorrecte soit compar√©e √† nullptr apr√®s la conversion de type en utilisant 'dynamic_cast'.  V√©rifiez les lignes: 2709, 2710. menu.cxx 2709 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> PopupMenu::ClosePopup(Menu* pMenu) { MenuFloatingWindow* p = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;MenuFloatingWindow*&gt;(ImplGetWindow()); PopupMenu *pPopup = <span class="hljs-keyword"><span class="hljs-keyword">dynamic_cast</span></span>&lt;PopupMenu*&gt;(pMenu); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p &amp;&amp; pMenu) p-&gt;KillActivePopup(pPopup); }</code> </pre> <br>  Tr√®s probablement, la condition contient une erreur.  Il a fallu v√©rifier les pointeurs <i>p</i> et <i>pPopup</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V668</a> Il est inutile de tester le pointeur 'm_pStream' contre null, car la m√©moire a √©t√© allou√©e √† l'aide de l'op√©rateur 'new'.  L'exception sera g√©n√©r√©e en cas d'erreur d'allocation de m√©moire.  zipfile.cxx 408 <br><br><pre> <code class="cpp hljs">ZipFile::ZipFile(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::wstring &amp;FileName) : m_pStream(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>), m_bShouldFree(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { m_pStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(FileName.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_pStream &amp;&amp; !isZipStream(m_pStream)) { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> m_pStream; m_pStream = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; } }</code> </pre> <br>  L'analyseur a d√©tect√© une situation o√π la valeur du pointeur renvoy√© par le <i>nouvel</i> op√©rateur est compar√©e √† z√©ro.  Selon le standard du langage C ++, si l'allocation de m√©moire n'est pas possible, le <i>nouvel</i> op√©rateur <i>l√®vera</i> une exception <i>std :: bad_alloc</i> .  Seuls 45 de ces emplacements ont √©t√© trouv√©s dans le projet LibreOffice, ce qui est tr√®s petit pour un tel volume de code.  Mais tout de m√™me, cela peut entra√Æner des probl√®mes pour les utilisateurs.  Les d√©veloppeurs doivent supprimer les v√©rifications inutiles ou cr√©er des objets de cette fa√ßon: <br><br><pre> <code class="cpp hljs">m_pStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::nothrow) FileStream(FileName.c_str());</code> </pre> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V728</a> Un contr√¥le excessif peut √™tre simplifi√©.  Le '(A &amp;&amp;! B) ||  (! A &amp;&amp; B) 'est √©quivalente √† l'expression' bool (A)! = Bool (B) '.  toolbox2.cxx 1042 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ToolBox::SetItemImageMirrorMode( sal_uInt16 nItemId, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bMirror ) { ImplToolItems::size_type nPos = GetItemPos( nItemId ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( nPos != ITEM_NOTFOUND ) { ImplToolItem* pItem = &amp;mpData-&gt;m_aItems[nPos]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((pItem-&gt;mbMirrorMode &amp;&amp; !bMirror) || <span class="hljs-comment"><span class="hljs-comment">// &lt;= (!pItem-&gt;mbMirrorMode &amp;&amp; bMirror)) // &lt;= { .... } } }</span></span></code> </pre> <br>  Il y a tr√®s longtemps, les diagnostics <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V728 ont</a> √©t√© √©tendus aux cas qui, tr√®s probablement, ne sont pas erron√©s, mais compliquent le code.  Et dans le code complexe, t√¥t ou tard, des erreurs sont encore commises. <br><br>  Cette condition est simplifi√©e comme suit: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pItem-&gt;mbMirrorMode != bMirror) { .... }</code> </pre> <br>  Une soixantaine de structures similaires se trouvent dans le projet, certaines d'entre elles sont tr√®s, tr√®s volumineuses.  Il est pr√©f√©rable que les auteurs du projet se familiarisent avec le rapport complet de l'analyseur PVS-Studio. <br><br><h2>  Probl√®mes de s√©curit√© </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38b/9aa/9ba/38b9aa9ba87c83eb5207957913b918af.png"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V523</a> L' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">instruction</a> 'then' est √©quivalente √† l'instruction 'else'.  docxattributeoutput.cxx 1571 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> DocxAttributeOutput::DoWritePermissionTagEnd( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; permission) { OUString permissionIdAndName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (permission.startsWith(<span class="hljs-string"><span class="hljs-string">"permission-for-group:"</span></span>, &amp;permissionIdAndName)) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sal_Int32 sparatorIndex = permissionIdAndName.indexOf(<span class="hljs-string"><span class="hljs-string">':'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString permissionId = permissionIdAndName.copy(....); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OString rId = OUStringToOString(....).getStr(); m_pSerializer-&gt;singleElementNS(XML_w, XML_permEnd, FSNS(XML_w, XML_id), rId.getStr(), FSEND); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sal_Int32 sparatorIndex = permissionIdAndName.indexOf(<span class="hljs-string"><span class="hljs-string">':'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString permissionId = permissionIdAndName.copy(....); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OString rId = OUStringToOString(....).getStr(); m_pSerializer-&gt;singleElementNS(XML_w, XML_permEnd, FSNS(XML_w, XML_id), rId.getStr(), FSEND); } }</code> </pre> <br>  Un tr√®s gros morceau de code est copi√© ici.  Pour une fonction qui modifie certains droits, le probl√®me identifi√© semble tr√®s suspect. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V1001</a> La variable 'DL' est affect√©e mais n'est pas utilis√©e √† la fin de la fonction.  cipher.cxx 811 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BF_updateECB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( CipherContextBF *ctx, rtlCipherDirection direction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sal_uInt8 *pData, sal_uInt8 *pBuffer, sal_Size nLength)</span></span></span><span class="hljs-function"> </span></span>{ CipherKeyBF *key; sal_uInt32 DL, DR; key = &amp;(ctx-&gt;m_key); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (direction == rtl_Cipher_DirectionEncode) { RTL_CIPHER_NTOHL64(pData, DL, DR, nLength); BF_encode(key, &amp;DL, &amp;DR); RTL_CIPHER_HTONL(DL, pBuffer); RTL_CIPHER_HTONL(DR, pBuffer); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { RTL_CIPHER_NTOHL(pData, DL); RTL_CIPHER_NTOHL(pData, DR); BF_decode(key, &amp;DL, &amp;DR); RTL_CIPHER_HTONL64(DL, DR, pBuffer, nLength); } DL = DR = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  Les variables <i>DL</i> et <i>DR</i> sont annul√©es par une simple affectation √† la fin de la fonction et ne sont plus utilis√©es.  Pour le compilateur, c'est une excuse pour supprimer les commandes d'optimisation. <br><br>  Pour nettoyer correctement les variables dans les applications Windows, vous pouvez r√©√©crire le code de cette fa√ßon: <br><br><pre> <code class="cpp hljs">RtlSecureZeroMemory(&amp;DL, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(DL)); RtlSecureZeroMemory(&amp;DR, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(DR));</code> </pre> <br>  Mais pour LibreOffice, une solution multiplateforme est requise ici. <br><br>  Un avertissement similaire d'une autre fonction: <ul><li>  V1001 La variable 'DL' est affect√©e mais n'est pas utilis√©e √† la fin de la fonction.  cipher.cxx 860 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V764</a> Ordre incorrect possible des arguments pass√©s √† la fonction 'queryStream': 'rUri' et 'rPassword'.  tdoc_storage.cxx 271 <br><br><pre> <code class="cpp hljs">css::uno::Reference&lt; css::io::XStream &gt; queryStream( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> css::uno::Reference&lt; css::embed::XStorage &gt; &amp; xParentStorage, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rPassword, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rUri, StorageAccessMode eMode, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bTruncate ); uno::Reference&lt; io::XOutputStream &gt; StorageElementFactory::createOutputStream( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rUri, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> OUString &amp; rPassword, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bTruncate ) { .... uno::Reference&lt; io::XStream &gt; xStream = queryStream( xParentStorage, rUri, rPassword, READ_WRITE_CREATE, bTruncate ); .... }</code> </pre> <br>  Veuillez noter que dans la fonction <i>queryStream</i> , dans la liste des param√®tres, <i>rPassword d'</i> abord puis <i>rUri</i> .  Il y avait un endroit dans le code o√π les arguments correspondants √©taient m√©lang√©s lorsque cette fonction √©tait appel√©e. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V794</a> L'op√©rateur d'affectation doit √™tre prot√©g√© contre le cas de 'this == &amp; rToBeCopied'.  hommatrixtemplate.hxx 121 <br><br><pre> <code class="cpp hljs">ImplHomMatrixTemplate&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=(....) { <span class="hljs-comment"><span class="hljs-comment">// complete initialization using copy for(sal_uInt16 a(0); a &lt; (RowSize - 1); a++) { memcpy(&amp;maLine[a], &amp;rToBeCopied.maLine[a], sizeof(....)); } if(rToBeCopied.mpLine) { mpLine.reset( new ImplMatLine&lt; RowSize &gt;(....) ); } return *this; }</span></span></code> </pre> <br>  Ce cas concerne davantage l'√©criture s√©curis√©e de code.  Il n'y a pas de contr√¥le dans l'instruction de copie pour attribuer un objet √† lui-m√™me.  Au total, le projet compte environ 30 impl√©mentations de ce type de l'op√©rateur de copie. <br><br><h2>  Erreurs avec SysAllocString </h2><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39c/568/55a/39c56855adffe06a5e0d517f764ecea6.png"></div><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V649</a> Il existe deux instructions 'if' avec des expressions conditionnelles identiques.  La premi√®re instruction ¬´if¬ª contient la fonction return.  Cela signifie que la deuxi√®me d√©claration ¬´si¬ª est insens√©e.  V√©rifiez les lignes: 125, 137. acctable.cxx 137 <br><br><pre> <code class="cpp hljs">STDMETHODIMP CAccTable::get_columnDescription(<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> column, BSTR * description) { SolarMutexGuard g; ENTER_PROTECTED_BLOCK <span class="hljs-comment"><span class="hljs-comment">// #CHECK# if(description == nullptr) return E_INVALIDARG; // #CHECK XInterface# if(!pRXTable.is()) return E_FAIL; .... SAFE_SYSFREESTRING(*description); *description = SysAllocString(o3tl::toW(ouStr.getStr())); if(description==nullptr) // &lt;= return E_FAIL; return S_OK; LEAVE_PROTECTED_BLOCK }</span></span></code> </pre> <br>  La fonction <i>SysAllocString ()</i> renvoie un pointeur qui peut √™tre <i>NULL</i> .  Quelque chose d'√©trange a √©t√© √©crit par l'auteur de ce code.  Le pointeur vers la m√©moire allou√©e n'est pas v√©rifi√©, ce qui peut entra√Æner des probl√®mes dans le programme. <br><br>  Avertissements similaires provenant d'autres fonctions: <br><br><ul><li>  V649 Il existe deux instructions 'if' avec des expressions conditionnelles identiques.  La premi√®re instruction ¬´if¬ª contient la fonction return.  Cela signifie que la deuxi√®me d√©claration ¬´si¬ª est insens√©e.  V√©rifiez les lignes: 344, 356. acctable.cxx 356 </li><li>  V649 Il existe deux instructions 'if' avec des expressions conditionnelles identiques.  La premi√®re instruction ¬´if¬ª contient la fonction return.  Cela signifie que la deuxi√®me d√©claration ¬´si¬ª est insens√©e.  V√©rifier les lignes: 213, 219. trvlfrm.cxx 219 </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V530</a> La valeur de retour de la fonction 'SysAllocString' doit √™tre utilis√©e.  maccessible.cxx 1077 <br><br><pre> <code class="cpp hljs">STDMETHODIMP CMAccessible::put_accValue(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(varChild.lVal==CHILDID_SELF) { SysAllocString(m_pszValue); m_pszValue=SysAllocString(szValue); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> S_OK; } .... }</code> </pre> <br>  Le r√©sultat de l'un des appels √† la fonction <i>SysAllocString ()</i> n'est pas utilis√©.  Les d√©veloppeurs doivent pr√™ter attention √† ce morceau de code. <br><br><h2>  Divers </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">V716</a> Conversion de type suspect dans l'instruction return: a renvoy√© HRESULT, mais la fonction renvoie en fait BOOL.  maccessible.cxx 2649 <br><br><pre> <code class="cpp hljs">BOOL CMAccessible::get_IAccessibleFromXAccessible(....) { ENTER_PROTECTED_BLOCK <span class="hljs-comment"><span class="hljs-comment">// #CHECK# if(ppIA == nullptr) { return E_INVALIDARG; // &lt;= } BOOL isGet = FALSE; if(g_pAgent) isGet = g_pAgent-&gt;GetIAccessibleFromXAccessible(....); if(isGet) return TRUE; else return FALSE; LEAVE_PROTECTED_BLOCK }</span></span></code> </pre> <br>  L'une des branches de l'ex√©cution de la fonction renvoie une valeur dont le type ne correspond pas au type de la valeur de retour de la fonction.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HRESULT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a un format plus complexe que le type </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BOOL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et est con√ßu pour stocker les √©tats d'op√©ration. </font><font style="vertical-align: inherit;">Par exemple, la valeur de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E_INVALIDARG</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x80070057L</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Il sera correct d'√©crire, par exemple, comme ceci:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FAILED(E_INVALIDARG);</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous pouvez en savoir plus √† ce sujet dans la documentation de diagnostic du V716. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelques endroits plus similaires:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Conversion de type suspect dans l'instruction return: a renvoy√© HRESULT, mais la fonction renvoie en fait BOOL. </font><font style="vertical-align: inherit;">inprocembobj.cxx 1299</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V716 Conversion de type suspect dans l'instruction return: a renvoy√© HRESULT, mais la fonction renvoie en fait BOOL. </font><font style="vertical-align: inherit;">maccessible.cxx 2660</font></font></li></ul><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V670</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Le membre de classe non initialis√© 'm_aMutex' est utilis√© pour initialiser le membre 'm_aModifyListeners'. </font><font style="vertical-align: inherit;">N'oubliez pas que les membres sont initialis√©s dans l'ordre de leurs d√©clarations √† l'int√©rieur d'une classe. </font><font style="vertical-align: inherit;">fmgridif.cxx 1033</font></font><br><br><pre> <code class="cpp hljs">FmXGridPeer::FmXGridPeer(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Reference&lt; XComponentContext &gt;&amp; _rxContext) :m_aModifyListeners(m_aMutex) ,m_aUpdateListeners(m_aMutex) ,m_aContainerListeners(m_aMutex) ,m_aSelectionListeners(m_aMutex) ,m_aGridControlListeners(m_aMutex) ,m_aMode( getDataModeIdentifier() ) ,m_nCursorListening(<span class="hljs-number"><span class="hljs-number">0</span></span>) ,m_bInterceptingDispatch(<span class="hljs-literal"><span class="hljs-literal">false</span></span>) ,m_xContext(_rxContext) { <span class="hljs-comment"><span class="hljs-comment">// Create must be called after this constructor m_pGridListener.reset( new GridListenerDelegator( this ) ); } class __declspec(dllexport) FmXGridPeer: public cppu::ImplInheritanceHelper&lt;....&gt; { .... ::comphelper::OInterfaceContainerHelper2 m_aModifyListeners, m_aUpdateListeners, m_aContainerListeners, m_aSelectionListeners, m_aGridControlListeners; .... protected: css::uno::Reference&lt; css::uno::XComponentContext &gt; m_xContext; ::osl::Mutex m_aMutex; .... };</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selon la norme de langage, l'ordre d'initialisation des membres de classe dans le constructeur se produit dans l'ordre de leur d√©claration dans la classe. </font><font style="vertical-align: inherit;">Dans notre cas, le champ </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m_aMutex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sera initialis√© apr√®s avoir particip√© √† l'initialisation de cinq autres champs de la classe. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voici √† quoi ressemble le constructeur d'un des champs de classe:</font></font><br><br><pre> <code class="cpp hljs">OInterfaceContainerHelper2( ::osl::Mutex &amp; rMutex );</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'objet mutex est transmis par r√©f√©rence. </font><font style="vertical-align: inherit;">Dans ce cas, divers probl√®mes peuvent survenir: de l'acc√®s √† la m√©moire non initialis√©e √† la perte ult√©rieure de modifications d'objets. </font></font><br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V763 Le</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> param√®tre 'nNativeNumberMode' est toujours r√©√©crit dans le corps de la fonction avant d'√™tre utilis√©. </font><font style="vertical-align: inherit;">calendar_jewish.cxx 286</font></font><br><br><pre> <code class="cpp hljs">OUString SAL_CALL Calendar_jewish::getDisplayString(...., sal_Int16 nNativeNumberMode ) { <span class="hljs-comment"><span class="hljs-comment">// make Hebrew number for Jewish calendar nNativeNumberMode = NativeNumberMode::NATNUM2; if (nCalendarDisplayCode == CalendarDisplayCode::SHORT_YEAR) { sal_Int32 value = getValue(CalendarFieldIndex::YEAR) % 1000; return mxNatNum-&gt;getNativeNumberString(...., nNativeNumberMode ); } else return Calendar_gregorian::getDisplayString(...., nNativeNumberMode ); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les arguments de fonction sont remplac√©s pour diverses raisons: lutte contre les avertissements du compilateur, compatibilit√© descendante, b√©quille, etc. </font><font style="vertical-align: inherit;">Cependant, aucune de ces solutions n'est bonne et le code semble d√©routant. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vous devriez revoir le code de cet endroit et quelques autres similaires:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V763 Le param√®tre 'bExtendedInfo' est toujours r√©√©crit dans le corps de la fonction avant d'√™tre utilis√©. </font><font style="vertical-align: inherit;">graphicfilter2.cxx 442</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V763 Le param√®tre 'nVerbID' est toujours r√©√©crit dans le corps de la fonction avant d'√™tre utilis√©. </font><font style="vertical-align: inherit;">oleembed.cxx 841</font></font></li><li> V763 Parameter 'pCursor' is always rewritten in function body before being used. edlingu.cxx 843 </li><li> V763 Parameter 'pOutput' is always rewritten in function body before being used. vnew.cxx 181 </li><li> V763 Parameter 'pOutput' is always rewritten in function body before being used. vnew.cxx 256 </li></ul><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le d√©sir de v√©rifier le code LibreOffice est apparu apr√®s mon utilisation personnelle du produit. </font><font style="vertical-align: inherit;">Pour une raison quelconque, avec certains lancements al√©atoires, le texte dispara√Æt de tous les √©l√©ments de menu. </font><font style="vertical-align: inherit;">Il ne reste que des ic√¥nes et des rayures monotones. </font><font style="vertical-align: inherit;">L'erreur est probablement de haut niveau et, peut-√™tre, elle ne peut pas √™tre trouv√©e √† l'aide d'outils d'analyse statique. </font><font style="vertical-align: inherit;">N√©anmoins, l'analyseur a trouv√© beaucoup de probl√®mes qui ne sont pas li√©s √† cela, et je serai heureux si les d√©veloppeurs de LibreOffice pr√™tent attention aux analyseurs de code statiques et essaient de les utiliser pour am√©liorer la qualit√© et la fiabilit√© du projet. </font><font style="vertical-align: inherit;">Ce sera utile √† tout le monde.</font></font><br><br>  Merci de votre attention.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Abonnez-vous √† nos cha√Ænes et restez √† l'√©coute pour les nouvelles du monde de la programmation! </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vk: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T√©l√©gramme: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instagram: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Twitter: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@pvsstudio_rus</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">YouTube: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@PVSStudioTool</font></font></a> </li></ul><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous souhaitez partager cet article avec un public anglophone, veuillez utiliser le lien vers la traduction: Svyatoslav Razmyslov. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LibreOffice: Cauchemar du comptable</font></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426977/">https://habr.com/ru/post/fr426977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426967/index.html">G√©n√©rateur de code ABAP en ligne</a></li>
<li><a href="../fr426969/index.html">Vigilant Lida: automatisation des tests de s√©curit√©</a></li>
<li><a href="../fr426971/index.html">Fatalisme dans la gestion des erreurs</a></li>
<li><a href="../fr426973/index.html">Sandwichs d'entreprise</a></li>
<li><a href="../fr426975/index.html">Joker 2018: l'impossible est possible</a></li>
<li><a href="../fr426979/index.html">Comment apprendre l'anglais gratuitement: 3 outils communs et des instructions d√©taill√©es pour chacun</a></li>
<li><a href="../fr426981/index.html">10 astuces pour un tableau de bord avanc√© dans Splunk. Partie 1</a></li>
<li><a href="../fr426983/index.html">Nouveau dans SObjectizer-5.5.23: r√©alisation des souhaits ou bo√Æte de Pandore?</a></li>
<li><a href="../fr426985/index.html">kubebox et autres coques de console pour Kubernetes</a></li>
<li><a href="../fr426987/index.html">Apprenez OpenGL. Le√ßon 6.3 - √âclairage bas√© sur l'image. Irradiation diffuse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>