<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>#‚É£ ‚ù§Ô∏è üë®‚Äçüë®‚Äçüë¶ "Ich werde keinen Stein geben" oder wie die Ressourcen des Spiels "Cursed Lands" angeordnet sind üßôüèΩ üÜò üö∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Erinnerst du dich an viele russische Spiele? Qualitativ? Denkw√ºrdig? Ja, das waren sie. Wenn Sie √ºber 35 Jahre alt sind oder ein Fan der russischen Sp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>"Ich werde keinen Stein geben" oder wie die Ressourcen des Spiels "Cursed Lands" angeordnet sind</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434802/"><p><img src="https://habrastorage.org/webt/ry/nk/a_/rynka_dqz5ny9nqgs7gawsw4zxy.jpeg"></p><br><p>  Erinnerst du dich an viele russische Spiele?  Qualitativ?  Denkw√ºrdig?  Ja, das waren sie.  Wenn Sie √ºber 35 Jahre alt sind oder ein Fan der russischen Spielebranche sind, sind Sie wahrscheinlich mit den verfluchten L√§ndern vertraut. </p><br><p>  Die Geschichte begann sehr prosaisch: Sommer, Hitze.  Es gibt nichts Besonderes zu tun, und als ich tr√§ge den Inhalt der Festplatte des Laptops durchsuchte, ergriff mein Blick einen Ordner mit dem bekannten Drachensymbol, das seit einigen Jahren nicht mehr verwendet wurde. </p><br><p>  Welcher Fan des Spiels wird nicht daran interessiert sein zu wissen, was drin ist? </p><a name="habracut"></a><br><h1 id="vvedenie">  Einf√ºhrung </h1><br><h2 id="informaciya-ob-igre">  Spielinfo </h2><br><p>  <strong>Cursed Lands</strong> - oder, wie sie au√üerhalb der GUS genannt wurden, <strong>Evil Islands: Curse of the Lost Soul</strong> , ein Stealth-RPG-Spiel, das im Jahr 2000 ver√∂ffentlicht wurde.  Das Spiel wurde von Nival Interactive entwickelt, das sich zu diesem Zeitpunkt bereits als eine Reihe von Alloda-Spielen (Rage of Mages im Ausland) etabliert hatte.  Meistens arbeiteten Absolventen der Moskauer Staatsuniversit√§t daran - sie waren durchaus in der Lage, eines der ersten Spiele mit einer vollst√§ndig dreidimensionalen Welt zu realisieren. <br>  Im Jahr 2010 hat Mail.Ru ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Information</a> ) den Titel √ºbertragen, aber das Spiel wird weiterhin im Auftrag von Nival im GOG-Store verkauft. </p><br><p>  Vor relativ kurzer Zeit wurde das Spiel 18 Jahre alt - der Geburtstag gilt als 26. Oktober, das Erscheinungsdatum in der GUS.  Trotz seines Alters ist der offizielle Master-Server immer noch in Betrieb: In regelm√§√üigen Abst√§nden beschlie√üt jemand, durch die W√§lder von Gipat zu kriechen und ein oder zwei Dutzend Skelette mit einer Gruppe von Kameraden zu treffen. </p><br><h2 id="korotko-o-state">  Kurz zum Artikel </h2><br><p>  Anfangs war es mein Ziel, in Python 3 nur einen Einwegkonverter "f√ºr mich" zu schreiben, der ausschlie√ülich Standardbibliotheken verwendet.  Dabei begann die Dokumentation der Formate jedoch reibungslos und versuchte, die Ausgabe irgendwie zu standardisieren.  F√ºr einige Formate wurde die Struktur mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kaitai Struct beschrieben</a> .  Infolgedessen f√ºhrte alles zum Schreiben dieses Artikels und des Wikis in Formaten. </p><br><p>  Ich stelle sofort fest: Zum gr√∂√üten Teil wurden bereits Spieledateien recherchiert und Fan-Editoren f√ºr sie geschrieben.  Die Informationen sind jedoch extrem fragmentiert, und es gibt weder eine mehr oder weniger vollst√§ndige Beschreibung der Formate im √∂ffentlichen Bereich noch einen angemessenen Satz zum Erstellen von √Ñnderungen. </p><br><h2 id="i-o-tom-kak-eyo-chitat">  ... und wie man es liest </h2><br><p>  F√ºr alle Formate werden Schemata (.ksy-Dateien) bereitgestellt, die in zwei der beliebtesten Sprachen in Code mit zwei Klicks in den Code konvertiert werden k√∂nnen. </p><br><p>  Leider stellte ich bereits in den letzten Phasen des Schreibens dieses Artikels fest, dass der gesch√§tzte Habr YAML (und JSON) nicht hervorheben kann und alle Schemata es verwenden.  Dies sollte kein gro√ües Problem sein, aber wenn es unpraktisch ist, das Schema zu lesen, kann ich Ihnen raten, es in einen Drittanbieter-Editor zu kopieren, z. B. NPP. </p><br><h1 id="resursy-i-gde-oni-obitayut">  Ressourcen und wo sie leben </h1><br><p>  Das Spiel ist eine tragbare Anwendung, die eine Engine mit Bibliotheken, einem Launcher und tats√§chlich gepackten Ressourcen enth√§lt. </p><br><blockquote>  <strong>Das ist interessant:</strong> Die Einstellungen des Spiels werden fast vollst√§ndig in der Registrierung gespeichert.  Der Kamerafehler in der GOG-Version ist darauf zur√ºckzuf√ºhren, dass das Installationsprogramm nicht die richtigen Standardwerte registriert. </blockquote><p>  Auf den ersten Blick auf den Inhalt des Spielordners fallen uns sofort einige neue Dateierweiterungen auf: ASI und REG. <br>  Die erste ist eine dynamische Bibliothek, die wir nicht ber√ºcksichtigen werden (dies wird von Spezialisten f√ºr Reverse Engineering durchgef√ºhrt), aber die zweite ist das erste native Dateiformat des Spiels. </p><br><h2 id="reg">  REG </h2><br><p>  Dateien dieses Typs sind bin√§re Serialisierungen bekannter Text-INI-Dateien. <br>  Der Inhalt ist in Abschnitte unterteilt, in denen Schl√ºssel und ihre Werte gespeichert sind.  Eine REG-Datei beh√§lt diese Hierarchie bei, beschleunigt jedoch das Lesen und Parsen von Daten - im Jahr 2000 war dies anscheinend kritisch. </p><br><p>  Im Allgemeinen k√∂nnen Sie die Struktur dieses Diagramms beschreiben: <br><img src="https://habrastorage.org/webt/yh/se/fo/yhsefo2h5nxp0ghwse2zla8cmv0.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre><code class="plaintext hljs">meta: id: reg title: Evil Islands, REG file (packed INI) application: Evil Islands file-extension: reg license: MIT endian: le doc: Packed INI file seq: - id: magic contents: [0xFB, 0x3E, 0xAB, 0x45] doc: Magic bytes - id: sections_count type: u2 doc: Number of sections - id: sections_offsets type: section_offset doc: Sections offset table repeat: expr repeat-expr: sections_count types: section_offset: doc: Section position in file seq: - id: order type: s2 doc: Section order number - id: offset type: u4 doc: Global offset of section in file instances: section: pos: offset type: section types: section: doc: Section representation seq: - id: keys_count type: u2 doc: Number of keys in section - id: name_len type: u2 doc: Section name lenght - id: name type: str encoding: cp1251 size: name_len doc: Section name - id: keys type: key doc: Section's keys repeat: expr repeat-expr: keys_count types: key: doc: Named key seq: - id: order type: s2 doc: Key order in section - id: offset type: u4 doc: Key offset in section instances: key_record: pos: _parent._parent.offset + offset type: key_data key_data: seq: - id: packed_type type: u1 doc: Key value info - id: name_len type: u2 doc: Key name lenght - id: name type: str encoding: cp1251 size: name_len doc: Key name - id: value type: value doc: Key value instances: is_array: value: packed_type &gt; 127 doc: Is this key contain array value_type: value: packed_type &amp; 0x7F doc: Key value type types: value: doc: Key value seq: - id: array_size type: u2 if: _parent.is_array doc: Value array size - id: data type: switch-on: _parent.value_type cases: 0: s4 1: f4 2: string repeat: expr repeat-expr: '_parent.is_array ? array_size : 1' doc: Key value data string: doc: Sized string seq: - id: len type: u2 doc: String lenght - id: value type: str encoding: cp1251 size: len doc: String</code> </pre> </div></div><br><blockquote>  <strong>Das ist interessant:</strong> Im Jahr 2002 teilte Nival einige Tools mit der Community des Spiels ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://web.archive.org/web/20020610194020/">Site-Snapshot</a> ) - einer davon war der INI-Serializer in REG.  Wie Sie sich vorstellen k√∂nnen, erschien fast sofort ein Deserialisierer, wenn auch kein offizieller. </blockquote><p>  Nachdem der Startordner aussortiert ist, gehen wir zu den Unterverzeichnissen √ºber. <br>  Der erste Blick f√§llt auf den Ordner "Kameras", der die CAM-Dateien enth√§lt. </p><br><h2 id="cam">  Cam </h2><br><p>  Ein sehr einfaches Format ist einfach das Packen der Positionen der Kameras im Laufe der Zeit.  Die Kamera wird durch Position und Drehung beschrieben.  Die beiden anderen Felder sind vermutlich Zeit und Schritt in der Abfolge der Bewegungen. </p><br><p><img src="https://habrastorage.org/webt/cu/8u/bj/cu8ubjrcz2pode-v3lydliwrvsq.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: cam title: Evil Islands, CAM file (cameras) application: Evil Islands file-extension: cam license: MIT endian: le doc: Camera representation seq: - id: cams type: camera repeat: eos types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis quat: doc: quaternion seq: - id: w type: f4 doc: w component - id: x type: f4 doc: x component - id: y type: f4 doc: y component - id: z type: f4 doc: z component camera: doc: Camera parameters seq: - id: unkn0 type: u4 doc: unknown - id: unkn1 type: u4 doc: unknown - id: position type: vec3 doc: camera's position - id: rotation type: quat doc: camera's rotation</code> </pre> </div></div><br><p>  Im n√§chsten Ordner - Res werden (unerwartet!) RES-Dateien, die Archive sind, gespeichert. </p><br><h2 id="res">  RES </h2><br><p>  Dieses Format wird manchmal unter anderen Erweiterungen ausgeblendet, aber das Original ist immer noch genau RES. <br>  Die Datenstruktur ist sehr typisch f√ºr ein Archiv mit wahlfreiem Zugriff auf Dateien: Es gibt Tabellen zum Speichern von Informationen zu darin enthaltenen Dateien, eine Tabelle mit Namen und den Inhalt von Dateien. <br>  Die Verzeichnisstruktur ist direkt in den Namen enthalten. </p><br><p>  Es lohnt sich, zwei √§u√üerst interessante Fakten zu erw√§hnen: </p><br><ol><li>  Das Archiv ist f√ºr das Laden von Dateiinformationen in eine verkn√ºpfte Liste mit geschlossenem Hashing optimiert. </li><li>  Sie k√∂nnen den Inhalt der Datei einmal speichern, aber unter verschiedenen Namen darauf verweisen.  Soweit ich wei√ü, wurde diese Tatsache in einem Fan-Repack verwendet, bei dem die Gr√∂√üe des Spiels aufgrund dessen stark reduziert wurde.  In der urspr√ºnglichen Distribution wurde die Archivoptimierung nicht verwendet. </li></ol><br><p><img src="https://habrastorage.org/webt/_9/ie/8_/_9ie8_m0lc_b1n0ddnagkue514g.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: res title: Evil Islands, RES file (resources archive) application: Evil Islands file-extension: res license: MIT endian: le doc: Resources archive seq: - id: magic contents: [0x3C, 0xE2, 0x9C, 0x01] doc: Magic bytes - id: files_count type: u4 doc: Number of files in archive - id: filetable_offset type: u4 doc: Filetable offset - id: nametable_size type: u4 doc: Size of filenames instances: nametable_offset: value: filetable_offset + 22 * files_count doc: Offset of filenames table filetable: pos: filetable_offset type: file_record repeat: expr repeat-expr: files_count doc: Files metadata table types: file_record: doc: File metadata seq: - id: next_index type: s4 doc: Next file index - id: file_size type: u4 doc: Size of file in bytes - id: file_offset type: u4 doc: File data offset - id: last_change type: u4 doc: Unix timestamp of last change time - id: name_len type: u2 doc: Lenght of filename - id: name_offset type: u4 doc: Filename offset in name array instances: name: io: _root._io pos: name_offset + _parent.nametable_offset type: str encoding: cp1251 size: name_len doc: File name data: io: _root._io pos: file_offset size: file_size doc: Content of file</code> </pre> </div></div><br><blockquote>  <strong>Das ist interessant:</strong> In der russischen Version des Spiels enth√§lt das Speech.res-Archiv zwei Unterverzeichnisse s und t mit v√∂llig identischen Inhalten, weshalb die Archivgr√∂√üe doppelt so gro√ü ist - weshalb das Spiel nicht auf eine CD passt. </blockquote><p>  Jetzt k√∂nnen Sie alle Archive entpacken (verschachtelt werden): </p><br><ul><li>  RES ist nur ein Archiv, </li><li>  MPR - Landschaft der Spielebenen, </li><li>  MQ - Informationen zu den Aufgaben des Multiplayers, </li><li>  ANM - eine Reihe von Animationen, </li><li>  MOD - 3D Modell, </li><li>  BON - die Position der Knochen des Modells. </li></ul><br><p>  Wenn die Dateien im Archiv keine Erweiterung haben, setzen wir die √ºbergeordnete Erweiterung - f√ºr BON- und ANM-Archive. </p><br><p>  Sie k√∂nnen auch alle empfangenen Dateien in vier Gruppen aufteilen: </p><br><ol><li>  Texturen </li><li>  Datenbanken </li><li>  Modelle </li><li>  Level-Dateien. </li></ol><br><p>  Beginnen wir mit dem Einfachen - mit den Texturen. </p><br><h2 id="mmp">  MMP </h2><br><p>  Eigentlich die Textur.  Es hat eine kleine √úberschrift, die die Bildparameter, die Anzahl der MIP-Pegel und die verwendete Komprimierung angibt.  Nach dem Header werden die MIP-Bildebenen in absteigender Reihenfolge der Gr√∂√üe angezeigt. </p><br><p><img src="https://habrastorage.org/webt/a7/1s/-r/a71s-rtar5cg6ipi53n86bbsxps.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: mmp title: Evil Islands, MMP file (texture) application: Evil Islands file-extension: mmp license: MIT endian: le doc: MIP-mapping texture seq: - id: magic contents: [0x4D, 0x4D, 0x50, 0x00] doc: Magic bytes - id: width type: u4 doc: Texture width - id: height type: u4 doc: Texture height - id: mip_levels_count type: u4 doc: Number of MIP-mapping stored levels - id: fourcc type: u4 enum: pixel_formats doc: FourCC label of pixel format - id: bits_per_pixel type: u4 doc: Number of bits per pixel - id: alpha_format type: channel_format doc: Description of alpha bits - id: red_format type: channel_format doc: Description of red bits - id: green_format type: channel_format doc: Description of green bits - id: blue_format type: channel_format doc: Description of blue bits - id: unused size: 4 doc: Empty space - id: base_texture type: switch-on: fourcc cases: 'pixel_formats::argb4': block_custom 'pixel_formats::dxt1': block_dxt1 'pixel_formats::dxt3': block_dxt3 'pixel_formats::pnt3': block_pnt3 'pixel_formats::r5g6b5': block_custom 'pixel_formats::a1r5g5b5': block_custom 'pixel_formats::argb8': block_custom _: block_custom types: block_pnt3: seq: - id: raw size: _root.bits_per_pixel block_dxt1: seq: - id: raw size: _root.width * _root.height &gt;&gt; 1 block_dxt3: seq: - id: raw size: _root.width * _root.height block_custom: seq: - id: lines type: line_custom repeat: expr repeat-expr: _root.height types: line_custom: seq: - id: pixels type: pixel_custom repeat: expr repeat-expr: _root.width types: pixel_custom: seq: - id: raw type: switch-on: _root.bits_per_pixel cases: 8: u1 16: u2 32: u4 instances: alpha: value: '_root.alpha_format.count == 0 ? 255 : 255 * ((raw &amp; _root.alpha_format.mask) &gt;&gt; _root.alpha_format.shift) / (_root.alpha_format.mask &gt;&gt; _root.alpha_format.shift)' red: value: '255 * ((raw &amp; _root.red_format.mask) &gt;&gt; _root.red_format.shift) / (_root.red_format.mask &gt;&gt; _root.red_format.shift)' green: value: '255 * ((raw &amp; _root.green_format.mask) &gt;&gt; _root.green_format.shift) / (_root.green_format.mask &gt;&gt; _root.green_format.shift)' blue: value: '255 * ((raw &amp; _root.blue_format.mask) &gt;&gt; _root.blue_format.shift) / (_root.blue_format.mask &gt;&gt; _root.blue_format.shift)' channel_format: doc: Description of bits for color channel seq: - id: mask type: u4 doc: Binary mask for channel bits - id: shift type: u4 doc: Binary shift for channel bits - id: count type: u4 doc: Count of channel bits enums: pixel_formats: 0x00004444: argb4 0x31545844: dxt1 0x33545844: dxt3 0x33544E50: pnt3 0x00005650: r5g6b5 0x00005551: a1r5g5b5 0x00008888: argb8</code> </pre> </div></div><br><p>  M√∂gliche Pixelverpackungsformate: </p><br><table><thead><tr><th>  fourcc </th><th>  Beschreibung </th></tr></thead><tbody><tr><td>  44 44 00 00 </td><td>  ARGB4 </td></tr><tr><td>  44 58 54 31 </td><td>  Dxt1 </td></tr><tr><td>  44 58 54 33 </td><td>  Dxt3 </td></tr><tr><td>  50 4E 54 33 </td><td>  PNT3 - RLE Compressed ARGB8 </td></tr><tr><td>  50 56 00 00 </td><td>  R5G5B5 </td></tr><tr><td>  51 55 00 00 </td><td>  A1R5G5B5 </td></tr><tr><td>  88 88 00 00 </td><td>  ARGB8 </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">√úber PNT3</b> <div class="spoiler_text"><p>  Wenn das Bildformat <strong>PNT3 ist</strong> , ist die <strong>Pixelstruktur</strong> nach dem Entpacken ARGB8;  <code>bits_per_pixel</code> - Gr√∂√üe des komprimierten Bildes in Bytes. </p><br><h4 id="raspakovka-pnt3">  PNT3 auspacken </h4><br><pre> <code class="python hljs">n = <span class="hljs-number"><span class="hljs-number">0</span></span> destination = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> src &lt; size: v = int.from_bytes(source[src:src + <span class="hljs-number"><span class="hljs-number">4</span></span>], byteorder=<span class="hljs-string"><span class="hljs-string">'little'</span></span>) src += <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v &gt; <span class="hljs-number"><span class="hljs-number">1000000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> v == <span class="hljs-number"><span class="hljs-number">0</span></span>: n += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: destination += source[src - (<span class="hljs-number"><span class="hljs-number">1</span></span> + n) * <span class="hljs-number"><span class="hljs-number">4</span></span>:src - <span class="hljs-number"><span class="hljs-number">4</span></span>] destination += <span class="hljs-string"><span class="hljs-string">b"\x00"</span></span> * v n = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> </div></div><br><blockquote>  <strong>Das ist interessant:</strong> Einige der Texturen werden vertikal reflektiert (oder andere werden nicht reflektiert?). <br>  Und das Spiel ist sehr eifers√ºchtig auf Transparenz - wenn das Bild einen Alphakanal hat, muss die Farbe der transparenten Pixel genau schwarz sein.  Oder wei√ü - so viel Gl√ºck. </blockquote><p>  Einfache Formate sind vorbei, lassen Sie uns zu starreren √ºbergehen - zu einer Zeit behielten die Reihen der Mod-Hersteller w√ºtend ihre eigenen Bearbeitungswerkzeuge f√ºr die folgenden Formate bei, und das nicht umsonst.  Ich habe dich gewarnt. </p><br><h2 id="bazy-dannyh-db-i-izhe-s-nimi">  Datenbanken (* DB und andere) </h2><br><p>  Die Beschreibung dieses Formats ist √§u√üerst unpraktisch. Im Wesentlichen handelt es sich hierbei um einen serialisierten Baum von Knoten (oder Datensatztabellen).  Eine Datei besteht aus mehreren Tabellen mit den angegebenen Feldtypen.  Allgemeine Struktur: Tabellen sind in einem gemeinsamen "Root" -Knoten verschachtelt, Datens√§tze sind Knoten innerhalb einer Tabelle. </p><br><p>  In jedem Knoten werden Typ und Gr√∂√üe angegeben: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> type_index; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> raw_size; <span class="hljs-comment"><span class="hljs-comment">//      unsigned length; //     read(raw_size); if (raw_size &amp; 1) { length = raw_size &gt;&gt; 1; for (int i = 0; i &lt; 3; i++) length &lt;&lt;= 8; read(raw_size); length += raw_size; } else length = raw_size &gt;&gt; 1;</span></span></code> </pre> <br><p>  Der Typ des Tabellenfeldes wird vom Index aus der Formatzeichenfolge f√ºr die Tabelle √ºbernommen, der reale Typ wird durch den erhaltenen Wert bestimmt. </p><br><div class="spoiler">  <b class="spoiler_title">Feldtypen</b> <div class="spoiler_text"><table><thead><tr><th>  Bezeichnung </th><th>  die Beschreibung </th></tr></thead><tbody><tr><td>  S. </td><td>  Zeichenfolge </td></tr><tr><td>  Ich </td><td>  4b int </td></tr><tr><td>  U. </td><td>  4b ohne Vorzeichen </td></tr><tr><td>  F. </td><td>  4b float </td></tr><tr><td>  X. </td><td>  Bits Byte </td></tr><tr><td>  f </td><td>  Float-Array </td></tr><tr><td>  ich </td><td>  int Array </td></tr><tr><td>  B. </td><td>  Bool </td></tr><tr><td>  b </td><td>  Bool-Array </td></tr><tr><td>  H. </td><td>  unbekannte Hex-Bytes </td></tr><tr><td>  T. </td><td>  Zeit </td></tr><tr><td>  0 </td><td>  nicht angegeben </td></tr><tr><td>  1 </td><td> <code>0FII</code> </td> </tr><tr><td>  2 </td><td> <code>SUFF</code> </td> </tr><tr><td>  3 </td><td> <code>FFFF</code> </td> </tr><tr><td>  4 </td><td> <code>0SISS</code> </td> </tr><tr><td>  5 </td><td> <code>0SISS00000U</code> </td> </tr></tbody></table></div></div><br><div class="spoiler">  <b class="spoiler_title">Beschreibung der Basen</b> <div class="spoiler_text"><h4 id="predmety-idb">  Gegenst√§nde (.idb) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Material </td><td> <code>SSSIFFFIFIFfIX</code> </td> </tr><tr><td>  Waffe </td><td> <code>SSISIIIFFFFIFIXB00000IHFFFfHHFF</code> </td> </tr><tr><td>  R√ºstung </td><td> <code>SSISIIIFFFFIFIXB00000ffBiHH</code> </td> </tr><tr><td>  Schnelle Gegenst√§nde </td><td> <code>SSISIIIFFFFIFIXB00000IIFFSbH</code> </td> </tr><tr><td>  Questgegenst√§nde </td><td> <code>SSISIIIFFFFIFIXB00000Is</code> </td> </tr><tr><td>  Artikel verkaufen </td><td> <code>SSISIIIFFFFIFIXB00000IHI</code> </td> </tr></tbody></table><br><h4 id="pereklyuchateli-ldb">  Schalter (.ldb) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Prototyp wechseln </td><td> <code>SfIFTSSS</code> </td> </tr></tbody></table><br><h4 id="umeniya-i-navyki-pdb">  F√§higkeiten und Fertigkeiten (.pdb) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  F√§higkeiten </td><td> <code>SSI0000000s</code> </td> </tr><tr><td>  F√§higkeiten </td><td> <code>SSI0000000SSIIIFFFIIIIBI</code> </td> </tr></tbody></table><br><h4 id="sledy-printsdb">  Fu√üabdr√ºcke (Drucke.db) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Blutspuren </td><td> <code>0S11</code> </td> </tr><tr><td>  Flammenspuren </td><td> <code>0S110000001</code> </td> </tr><tr><td>  Fu√üabdr√ºcke </td><td> <code>0S11</code> </td> </tr></tbody></table><br><h4 id="zaklinaniya-sdb">  Zauber (.sdb) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Prototypen </td><td> <code>SSSFIFIFFFFIIIIUSSIIbIXFFFFF</code> </td> </tr><tr><td>  Modifikatoren </td><td> <code>SSFIFFISX</code> </td> </tr><tr><td>  Muster </td><td> <code>0SssSX</code> </td> </tr><tr><td>  R√ºstungsvorlagen </td><td> <code>0SssSX</code> </td> </tr><tr><td>  Waffenmuster </td><td> <code>0SssSX</code> </td> </tr></tbody></table><br><h4 id="suschestva-udb">  Kreaturen (.udb) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Besch√§digte Teile </td><td> <code>SffUU</code> </td> </tr><tr><td>  Rennen </td><td> <code>SUFFUUFfFUUf222222000000000000SssFSsfUUfUUIUSBFUUUU</code> </td> </tr><tr><td>  Monster-Prototypen </td><td> <code>SSIUIFFFSFFFFFFFFFUFFFFFFff33sfssSFFFFFUFUSF</code> </td> </tr><tr><td>  Npc </td><td> <code>SUFFFFbbssssFUB</code> </td> </tr></tbody></table><br><h4 id="vykriki-acksdb">  Rufe (acks.db) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Die Antworten </td><td> <code>0S0000000044444444444444444444445444444444444</code> </td> </tr><tr><td>  Schreie </td><td> <code>0S0000000044444</code> </td> </tr><tr><td>  Andere </td><td> <code>0S0000000044</code> </td> </tr></tbody></table><br><h4 id="zadaniya-qdb">  Quests (.qdb) </h4><br><table><thead><tr><th>  Tabelle </th><th>  die Struktur </th></tr></thead><tbody><tr><td>  Missionen </td><td> <code>SFIISIIs</code> </td> </tr><tr><td>  Briefings </td><td> <code>SFFsSsssssI</code> </td> </tr></tbody></table></div></div><br><blockquote>  <strong>Das ist interessant:</strong> 16. Januar 2002 Nival hat die Quelldatenbanken f√ºr den Multiplayer im CSV-Format sowie einen Utility-Konverter im Spielformat ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=https://web.archive.org/web/20020610194020/">Site-Snapshot</a> ) ver√∂ffentlicht.  Nat√ºrlich erschien der inverse Konverter nicht langsam.  Es gibt auch mindestens zwei Dokumente, die die Felder und ihre Typen von den Modmachern beschreiben, aber das Lesen ist sehr schwierig. </blockquote><br><h2 id="adb">  Adb </h2><br><p>  Animationsdatenbank f√ºr einen bestimmten Einheitentyp.  Im Gegensatz zu der oben erw√§hnten * DB ist sie ziemlich "menschlich" - es ist eine einstufige Tabelle mit statischen Feldgr√∂√üen. </p><br><p><img src="https://habrastorage.org/webt/vm/f4/jr/vmf4jr_3jtmqytycobxvurk7v2c.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: adb title: Evil Islands, ADB file (animations database) application: Evil Islands file-extension: adb license: MIT endian: le doc: Animations database seq: - id: magic contents: [0x41, 0x44, 0x42, 0x00] doc: Magic bytes - id: animations_count type: u4 doc: Number of animations in base - id: unit_name type: str encoding: cp1251 size: 24 doc: Name of unit - id: min_height type: f4 doc: Minimal height of unit - id: mid_height type: f4 doc: Middle height of unit - id: max_height type: f4 doc: Maximal height of unit - id: animations type: animation doc: Array of animations repeat: expr repeat-expr: animations_count types: animation: doc: Animation's parameters seq: - id: name type: str encoding: cp1251 size: 16 doc: Animation's name - id: number type: u4 doc: Index in animations array - id: additionals type: additional doc: Packed structure with animation parameters - id: action_probability type: u4 doc: Percents of action probability - id: animation_length type: u4 doc: Lenght of animation in game ticks - id: movement_speed type: f4 doc: Movement speed - id: start_show_hide1 type: u4 - id: start_show_hide2 type: u4 - id: start_step_sound1 type: u4 - id: start_step_sound2 type: u4 - id: start_step_sound3 type: u4 - id: start_step_sound4 type: u4 - id: start_hit_frame type: u4 - id: start_special_sound type: u4 - id: spec_sound_id1 type: u4 - id: spec_sound_id2 type: u4 - id: spec_sound_id3 type: u4 - id: spec_sound_id4 type: u4 types: additional: seq: - id: packed type: u8 instances: weapons: value: 'packed &amp; 127' allowed_states: value: '(packed &gt;&gt; 15) &amp; 7' action_type: value: '(packed &gt;&gt; 18) &amp; 15' action_modifyer: value: '(packed &gt;&gt; 22) &amp; 255' animation_stage: value: '(packed &gt;&gt; 30) &amp; 3' action_forms: value: '(packed &gt;&gt; 36) &amp; 63'</code> </pre> </div></div><br><blockquote>  <strong>Das ist interessant:</strong> F√ºr mehrere Einheiten wird ein teilweise abgeschnittenes Datenbankformat verwendet, das bisher kaum untersucht wurde. </blockquote><p>  Nachdem wir uns mit den Datenbanken befasst haben, erkl√§ren wir eine Werbepause.  Aber wir werden nichts bewerben - nicht unsere Methode.  Bezeichnen Sie besser, was als n√§chstes n√ºtzlich ist - wie Kreaturendateien benannt werden. </p><br><h2 id="format-imyon-modeley">  Modellname Format </h2><br><p>  Der Name wird aus Gruppen von zwei Zeichen gesammelt - Abk√ºrzungen der logischen "Ebene". <br>  Zum Beispiel ist die weibliche Figur <code>unhufe</code> - <code>Unit &gt; Human &gt; Female</code> und <code>initwesp</code> - <code>Inventory &gt; Item &gt; Weapon &gt; Spear</code> , <code>initwesp</code> ein Speer im Inventar (nicht der R√ºcken, und das ist gut so). </p><br><div class="spoiler">  <b class="spoiler_title">Vollst√§ndiger Baum der Namenselemente:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">un: # unit an: # animal wi: # wild ti # tiger ba # bat bo # boar hy # hyen de # deer gi # rat ra # rat cr # crawler wo # wolf ho: # home co # cow pi # pig do # dog ho # horse ha # hare or: # orc fe # female ma # male mo: # monster co # column (menu) un # unicorn cu # Curse be # beholder tr # troll el # elemental su # succub (harpie) ba # banshee dr # driad sh # shadow li # lizard sk # skeleton sp # spider go # golem, goblin ri # Rick og # ogre zo # zombie bi # Rik's dragon cy # cyclope dg # dragon wi # willwisp mi # octopus to # toad hu: # human fe # female ma # male in: # inventory it: # item qu # quest qi # interactive ar: # armor pl # plate gl # gloves lg # leggins bt # boots sh # shirt hl # helm pt # pants li: # loot mt # material tr # trade we: # weapon hm # hammer dg # dagger sp # spear cb # crossbow sw # sword ax # axe bw # bow gm # game menu fa: # faces un: # unit an: # animal wi: # wild ti: # tiger face # face ba: # bat face # face bo: # boar face # face de: # deer face # face ra: # rat face # face cr: # crawler face # face wo: # wolf face # face ho: # home co: # cow face # face pi: # pig face # face do: # dog face # face ho: # horse face # face ha: # hare face # face hu: # human fe: # female fa # me # th # ma: # male fa # me # th # mo: # monster to: # toad face # face tr: # troll face # face or: # orc face # face sp: # spider face # face li: # lizard face # face na: # nature fl: # flora bu # bush te # termitary tr # tree li # waterplant wa # waterfall sk # sky st # stone ef: # effects cu # ar # co # components st: # static si # switch bu: # building to # tower ho # house tr # trap br # bridge ga # gate we # well (waterhole) wa: # wall me # medium li # light to # torch st # static</code> </pre> </div></div><br><blockquote>  <strong>Das ist interessant:</strong> Nach dieser Klassifizierung sind Pilze B√§ume, Golems mit Goblins sind Br√ºder und Tka-Rick ist ein Monster.  Auch hier k√∂nnen Sie die "funktionierenden" Namen von Monstern sehen, die denen von D &amp; D verd√§chtig √§hnlich sind - Betrachter (b√∂ser Blick), Succub (Harpyie), Oger (Kannibale), Driad (F√∂rster). </blockquote><p>  Nachdem wir uns moralisch ausgeruht haben, st√ºrzen wir uns kopf√ºber in das Modell.  Sie werden in verschiedenen Formaten dargestellt, die miteinander verkn√ºpft sind. </p><br><h2 id="lnk">  Lnk </h2><br><p>  Logisch - die Basis des Modells.  Beschreibt die Hierarchie von Teilen des Modells im Sinne der modernen 3D-Modellierung - die Hierarchie der Knochen. </p><br><p><img src="https://habrastorage.org/webt/we/va/a1/wevaa186p5bq4fvw8-4vtxbfiju.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: lnk title: Evil Islands, LNK file (bones hierarchy) application: Evil Islands file-extension: lnk license: MIT endian: le doc: Bones hierarchy seq: - id: bones_count type: u4 doc: Number of bones - id: bones_array type: bone repeat: expr repeat-expr: bones_count doc: Array of bones types: bone: doc: Bone node seq: - id: bone_name_len type: u4 doc: Length of bone's name - id: bone_name type: str encoding: cp1251 size: bone_name_len doc: Bone's name - id: parent_name_len type: u4 doc: Length of bone's parent name - id: parent_name type: str encoding: cp1251 size: parent_name_len doc: Bone's parent name</code> </pre> </div></div><br><p>  Der √ºbergeordnete Name des √ºbergeordneten Knochens ist eine leere Zeichenfolge (L√§nge 0). </p><br><p>  Es gibt Knochen, aber es reicht nicht aus, sie zu benennen und zusammenzusetzen - Sie m√ºssen sie zu einem Skelett zusammensetzen. </p><br><h2 id="bon">  Bon </h2><br><p>  Dieses Format (sofern es sich nicht um ein Archiv handelt) legt die Position der Teile (Bones) des Modells relativ zum √ºbergeordneten Teil fest.  Nur der Offset wird ohne Drehung gespeichert - einer der Unterschiede zu modernen Formaten. </p><br><p><img src="https://habrastorage.org/webt/rq/f0/nt/rqf0ntdd5sxadr0us5gfq5cfq2g.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: bon title: Evil Islands, BON file (bone position) application: Evil Islands file-extension: bon license: MIT endian: le doc: Bone position seq: - id: position type: vec3 doc: Bone translation repeat: eos types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis</code> </pre> </div></div><br><p>  Wie Sie sehen k√∂nnen, gibt es zu viele Zahlen f√ºr einen Versatz - Tatsache ist, dass wir hier zuerst auf eines der Hauptmerkmale der Spiel-Engine gesto√üen sind - die trilineare Modellinterpolation. </p><br><p>  So funktioniert es: Das Modell verf√ºgt √ºber drei Interpolationsparameter - bedingt, St√§rke, Geschicklichkeit, Wachstum.  Es gibt auch 8 extreme Zust√§nde des Modells.  Mit den Parametern k√∂nnen wir das endg√ºltige Modell durch trilineare Interpolation erhalten. </p><br><div class="spoiler">  <b class="spoiler_title">Der Algorithmus selbst</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trilinear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(val, coefs=[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Linear interpolation by str t1 = val[0] + (val[1] - val[0]) * coefs[1] t2 = val[2] + (val[3] - val[2]) * coefs[1] # Bilinear interpolation by dex v1 = t1 + (t2 - t1) * coefs[0] # Linear interpolation by str t1 = val[4] + (val[5] - val[4]) * coefs[1] t2 = val[6] + (val[7] - val[6]) * coefs[1] # Bilinear interpolation by dex v2 = t1 + (t2 - t1) * coefs[0] # Trilinear interpolation by height return v1 + (v2 - v1) * coefs[2]</span></span></code> </pre> </div></div><br><blockquote>  <strong>Dies ist interessant: Die</strong> trilineare Modellinterpolation wird verwendet, um einige Objekte zu animieren, z. B. das √ñffnen einer Steint√ºr und von Truhen. </blockquote><p>  Jetzt ist es an der Zeit, sich die Teile des Modells selbst anzusehen. </p><br><h2 id="fig">  FIG </h2><br><p>  Vielleicht ist diese Kundgebung nicht zu verstehen.  Sie k√∂nnen seine Beschreibung und das Plug-In f√ºr den Mixer im Internet finden, aber selbst mit ihnen kommt das Bewusstsein nicht sofort.  Schauen Sie mal rein: </p><br><p><img src="https://habrastorage.org/webt/c_/yx/bu/c_yxbuglpgn1h0j2g48gc1lk1dw.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: fig title: Evil Islands, FIG file (figure) application: Evil Islands file-extension: fig license: MIT endian: le doc: 3d mesh seq: - id: magic contents: [0x46, 0x49, 0x47, 0x38] doc: Magic bytes - id: vertex_count type: u4 doc: Number of vertices blocks - id: normal_count type: u4 doc: Number of normals blocks - id: texcoord_count type: u4 doc: Number of UV pairs - id: index_count type: u4 doc: Number of indeces - id: vertex_components_count type: u4 doc: Number of vertex components - id: morph_components_count type: u4 doc: Number of morphing components - id: unknown contents: [0, 0, 0, 0] doc: Unknown (aligment) - id: group type: u4 doc: Render group - id: texture_index type: u4 doc: Texture offset - id: center type: vec3 doc: Center of mesh repeat: expr repeat-expr: 8 - id: aabb_min type: vec3 doc: AABB point of mesh repeat: expr repeat-expr: 8 - id: aabb_max type: vec3 doc: AABB point of mesh repeat: expr repeat-expr: 8 - id: radius type: f4 doc: Radius of boundings repeat: expr repeat-expr: 8 - id: vertex_array type: vertex_block doc: Blocks of raw vertex data repeat: expr repeat-expr: 8 - id: normal_array type: vec4x4 doc: Packed normal data repeat: expr repeat-expr: normal_count - id: texcoord_array type: vec2 doc: Texture coordinates data repeat: expr repeat-expr: texcoord_count - id: index_array type: u2 doc: Triangles indeces repeat: expr repeat-expr: index_count - id: vertex_components_array type: vertex_component doc: Vertex components array repeat: expr repeat-expr: vertex_components_count - id: morph_components_array type: morph_component doc: Morphing components array repeat: expr repeat-expr: morph_components_count types: morph_component: doc: Morphing components indeces seq: - id: morph_index type: u2 doc: Index of morphing data - id: vertex_index type: u2 doc: Index of vertex vertex_component: doc: Vertex components indeces seq: - id: position_index type: u2 doc: Index of position data - id: normal_index type: u2 doc: Index of normal data - id: texture_index type: u2 doc: Index of texcoord data vec2: doc: 2d vector seq: - id: u type: f4 doc: u axis - id: v type: f4 doc: v axis vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis vec3x4: doc: 3d vector with 4 values per axis seq: - id: x type: f4 doc: x axis repeat: expr repeat-expr: 4 - id: y type: f4 doc: y axis repeat: expr repeat-expr: 4 - id: z type: f4 doc: z axis repeat: expr repeat-expr: 4 vertex_block: doc: Vertex raw block seq: - id: block type: vec3x4 doc: Vertex data repeat: expr repeat-expr: _root.vertex_count vec4x4: doc: 4d vector with 4 values per axis seq: - id: x type: f4 doc: x axis repeat: expr repeat-expr: 4 - id: y type: f4 doc: y axis repeat: expr repeat-expr: 4 - id: z type: f4 doc: z axis repeat: expr repeat-expr: 4 - id: w type: f4 doc: w axis repeat: expr repeat-expr: 4</code> </pre> </div></div><br><p>  Was ist die Schwierigkeit?  Schlie√ülich werden die Daten von Normalen und Scheitelpunkten in 4er-Bl√∂cken gespeichert, und die Scheitelpunkte werden zur Interpolation auch in 8 Bl√∂cken angeordnet. </p><br><blockquote>  <strong>Das ist interessant:</strong> Vermutlich wurde eine solche Gruppierung vorgenommen, um die Verarbeitung mithilfe von SSE-Anweisungen zu beschleunigen, die seit 1999 auf Intel-Prozessoren verf√ºgbar sind. </blockquote><p>  Nun, wir haben das Modell gelesen und komponiert, aber es fehlt etwas.  Genau - Animationen! </p><br><h2 id="anm">  Anm </h2><br><p>  Die Animation wird in Komponentenform als Schl√ºsselzust√§nde gespeichert.  Eine interessante Tatsache ist, dass es nicht nur Skelettanimationen, sondern auch Vertex-Morphing unterst√ºtzt. </p><br><p><img src="https://habrastorage.org/webt/i_/yb/lr/i_yblr5zy2irqqer1jqi6tm8v_c.png"></p><br><div class="spoiler">  <b class="spoiler_title">Strukturbeschreibung</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: anm title: Evil Islands, ANM file (bone animation) application: Evil Islands file-extension: anm license: MIT endian: le doc: Bone animation seq: - id: rotation_frames_count type: u4 doc: Number of rotation frames - id: rotation_frames type: quat repeat: expr repeat-expr: rotation_frames_count doc: Bone rotations - id: translation_frames_count type: u4 doc: Number of translation frames - id: translation_frames type: vec3 repeat: expr repeat-expr: translation_frames_count doc: Bone translation - id: morphing_frames_count type: u4 doc: Number of morphing frames - id: morphing_vertex_count type: u4 doc: Number of vertices with morphing - id: morphing_frames type: morphing_frame repeat: expr repeat-expr: morphing_frames_count doc: Array of morphing frames types: vec3: doc: 3d vector seq: - id: x type: f4 doc: x axis - id: y type: f4 doc: y axis - id: z type: f4 doc: z axis quat: doc: quaternion seq: - id: w type: f4 doc: w component - id: x type: f4 doc: x component - id: y type: f4 doc: y component - id: z type: f4 doc: z component morphing_frame: doc: Array of verteces morphing seq: - id: vertex_shift type: vec3 repeat: expr repeat-expr: _parent.morphing_vertex_count doc: Morphing shift per vertex</code> </pre> </div></div><br><p>  Das war's - jetzt haben wir ein vollwertiges Modell, Sie k√∂nnen die frisch gerenderte Einsiedeleidechse bewundern: </p><br><p><img src="https://habrastorage.org/webt/bu/tk/sm/butksmbjbom_kgib93drtz9xvj8.jpeg"></p><br><div class="spoiler">  <b class="spoiler_title">Ein Moment der Nostalgie</b> <div class="spoiler_text"><h4 id="uznat-chto-nuzhno-yascheru">  Finde heraus, was die Eidechse braucht </h4><br><p>  <em>Gespr√§ch mit der Eidechse in seinem Haus</em> </p><br><p>  <strong>Einsiedler-Eidechse:</strong> Du bist gekommen, Mann.  Das ist gut. </p><br><p>  <strong>Zach:</strong> Ist das alles was du mir sagen wolltest? </p><br><p>  <strong>Hermit Lizard:</strong> Du hast es wieder eilig.  Ich erinnere mich an Ihre Fragen und werde sie beantworten.  Ich kam zu Leuten in Eisen, um einen Deal zu machen.  Aber ich habe gesehen, wie sie dir angetan haben.  Sie halten kein Wort, ich h√∂rte auf, ihnen zu glauben.  Du hast dein Wort gehalten.  Ein Angebot wird Ihnen angeboten. </p><br><p>  <strong>Einsiedler-Eidechse: Die</strong> Leute lieben Gold.  Gold Eidechsen sind uninteressant.  Du wirst meine Aufgabe erf√ºllen und ich werde dir das Gold geben, das ich habe.  Es gibt viel Gold. </p><br><p>  <strong>Zach <em>(nachdenklich und ohne gro√ües Interesse)</em> :</strong> Hmm ... Gold ... Es wird bestimmt nicht weh tun ... </p><br><p>  <strong>Zach:</strong> Es w√§re besser, wenn Sie mir helfen k√∂nnten herauszufinden, wo der alte Zauberer, nach dem ich gesucht habe, so lange lebt.  Eidechsen sind schlie√ülich ein altes Volk, und Sie k√∂nnen es wissen! </p><br><p>  <strong>Einsiedler-Eidechse:</strong> Du hast recht.  Eidechsen sind ein altes Volk.  Ich kann alles sammeln, was wir √ºber den alten Mann wissen.  Stimmen Sie zu, meine Mission zu erf√ºllen? </p><br><p>  <strong>Zach:</strong> Was f√ºr ein Gespr√§ch!  Bedenken Sie, dass bereits alles erledigt ist. </p><br><p>  <strong>Einsiedler-Eidechse <em>(ernst)</em> :</strong> Schon fertig?  Willst du mich betr√ºgen? </p><br><p>  <strong>Zach:</strong> Eigentlich wollte ich einen Witz machen, sonst warst du wirklich ernst. </p><br><p>  <strong>Die Einsiedeleidechse:</strong> Ich verstehe.  Das ist ein Witz.  Ich denke, ich kann auch einen Witz machen.  Dann.  Und jetzt musst du das Wasser zum Kanal zur√ºckbringen.  Orks haben uns Wasser gestohlen. </p><br><p>  <strong>Einsiedler-Eidechse:</strong> Gehe am Wasser entlang nach S√ºden.  Sie sehen den Damm und den Kanal.  Der Damm muss angehoben werden.  Hebelwirkung.  Ich werde es geben.  Der Kanal muss blockiert werden.  Der Stein.  Ich werde keinen Stein geben.  Er liegt bereits am Rande des Kanals.  Stromaufw√§rts des Dammes.  Der Stein ist schwer.  Als die Orks gruben, hoben sie es f√ºr eine lange Zeit auf.  Wenn Sie ihn schieben, f√§llt er schnell zur√ºck. </p><br><p>  <strong>Hermit Lizard:</strong> Danach komm zur√ºck.  Ich werde dir alles erz√§hlen, was ich √ºber den alten Magier lerne. </p><br><p>  <strong>Zach:</strong> Hand in Hand!  √úbrigens, wenn Sie der Geschichte ein paar M√ºnzen hinzuf√ºgen, werde ich √ºberhaupt nicht beleidigt sein. </p><br><p>  <strong>Die Einsiedeleidechse:</strong> F√ºr M√ºnzen gehen Sie zu meinen Verwandten, die in den Untiefen weiter im S√ºden leben.  Gehe zur am weitesten entfernten Sandinsel, der dritten in Folge.  Sch√§tze geh√∂ren dir! </p><br><p>  <strong>Lizard Hermit <em>(zu sich selbst)</em> :</strong> Seltsam.  Dieser Mann liebt Humor.  Ich habe gescherzt.  Der Mann lachte nicht.  Sehr seltsam. </p></div></div><br><p>  Nun - das Interessanteste: wie die Karte gespeichert wird. </p><br><h2 id="mp">  MP </h2><br><p>  Dies ist die Map-Header-Datei.  Aufgrund eines ungl√ºcklichen Zufalls stimmt die Erweiterung mit der der Mehrspieler-Sicherungsdateien √ºberein, die wir nicht ber√ºcksichtigen werden. </p><br><p>  Zun√§chst m√ºssen Sie eine allgemeine Beschreibung der Landschaft geben: </p><br><ul><li>  die Anzahl der "Brocken" - Teile der Karte 32x32 Meter; </li><li>  maximale H√∂he (da die H√∂he der Eckpunkte in einer ganzzahligen Skala gespeichert ist); </li><li>  Anzahl der Kachelatlanten. </li></ul><br><p>     ,     ‚Äî ,   . </p><br><p><img src="https://habrastorage.org/webt/rq/5a/zv/rq5azvlnywx7dynoartwivfelea.png"></p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: mp title: Evil Islands, MP file (map header) application: Evil Islands file-extension: mp license: MIT endian: le doc: Map header seq: - id: magic contents: [0x72, 0xF6, 0x4A, 0xCE] doc: Magic bytes - id: max_altitude type: f4 doc: Maximal height of terrain - id: x_chunks_count type: u4 doc: Number of sectors by x - id: y_chunks_count type: u4 doc: Number of sectors by y - id: textures_count type: u4 doc: Number of texture files - id: texture_size type: u4 doc: Size of texture in pixels by side - id: tiles_count type: u4 doc: Number of tiles - id: tile_size type: u4 doc: Size of tile in pixels by side - id: materials_count type: u2 doc: Number of materials - id: animated_tiles_count type: u4 doc: Number of animated tiles - id: materials type: material doc: Map materials repeat: expr repeat-expr: materials_count - id: id_array type: u4 doc: Tile type repeat: expr repeat-expr: tiles_count enum: tile_type - id: animated_tiles type: animated_tile doc: Animated tiles repeat: expr repeat-expr: animated_tiles_count types: material: doc: Material parameters seq: - id: type type: u4 doc: Material type by enum: terrain_type - id: color type: rgba doc: RGBA diffuse color - id: self_illumination type: f4 doc: Self illumination - id: wave_multiplier type: f4 doc: Wave speed multiplier - id: warp_speed type: f4 doc: Warp speed multiplier - id: unknown size: 12 types: rgba: doc: RGBA color seq: - id: r type: f4 doc: Red channel - id: g type: f4 doc: Green channel - id: b type: f4 doc: Blue channel - id: a type: f4 doc: Alpha channel enums: terrain_type: 0: base 1: water_notexture 2: grass 3: water animated_tile: doc: Animated tile parameters seq: - id: start_index type: u2 doc: First tile of animation - id: length type: u2 doc: Animation frames count enums: tile_type: 0: grass 1: ground 2: stone 3: sand 4: rock 5: field 6: water 7: road 8: empty 9: snow 10: ice 11: drygrass 12: snowballs 13: lava 14: swamp 15: highrock</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><table><thead><tr><th> terrain type </th><th>  Typ </th></tr></thead><tbody><tr><td>  0 </td><td>   </td></tr><tr><td>  1 </td><td>    </td></tr><tr><td>  2 </td><td>   </td></tr><tr><td>  3 </td><td>   </td></tr></tbody></table></div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><table><thead><tr><th> material type </th><th>  Typ </th></tr></thead><tbody><tr><td>  0 </td><td> grass </td></tr><tr><td>  1 </td><td> ground </td></tr><tr><td>  2 </td><td> stone </td></tr><tr><td>  3 </td><td> sand </td></tr><tr><td>  4 </td><td> rock </td></tr><tr><td>  5 </td><td> field </td></tr><tr><td>  6 </td><td> water </td></tr><tr><td>  7 </td><td> road </td></tr><tr><td>  8 </td><td> (empty) </td></tr><tr><td>  9 </td><td> snow </td></tr><tr><td>  10 </td><td> ice </td></tr><tr><td>  11 </td><td> drygrass </td></tr><tr><td>  12 </td><td> snowballs </td></tr><tr><td>  13 </td><td> lava </td></tr><tr><td>  14 </td><td> swamp </td></tr><tr><td>  15 </td><td> highrock </td></tr></tbody></table></div></div><br><p>      ,      <code>Res/aiinfo.res/tileDesc.reg</code> . </p><br><blockquote> <strong> :</strong>     ,   ‚Äî       . <br>   :       . </blockquote><p>       .  ! </p><br><h2 id="sec"> SEC </h2><br><p>      ‚Äî  3232 .       ,    <code>ZonenameXXXYYY</code> . </p><br><p><img src="https://habrastorage.org/webt/9-/pd/_l/9-pd_ltybkk7hx_oywo4wsfwrpc.png"></p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="plaintext hljs">meta: id: sec title: Evil Islands, SEC file (map sector) application: Evil Islands file-extension: sec license: MIT endian: le doc: Map sector seq: - id: magic contents: [0x74, 0xF7, 0x4B, 0xCF] doc: Magic bytes - id: liquids type: u1 doc: Liquids layer indicator - id: vertexes type: vertex doc: Vertex array 33x33 repeat: expr repeat-expr: 1089 - id: liquid_vertexes type: vertex doc: Vertex array 33x33 if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 1089 : 0' - id: tiles type: tile doc: Tile array 16x16 repeat: expr repeat-expr: 256 - id: liquid_tiles type: tile doc: Tile array 16x16 if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 256 : 0' - id: liquid_material type: u2 doc: Index of material if: liquids != 0 repeat: expr repeat-expr: 'liquids != 0 ? 256 : 0' types: vertex: doc: Vertex data seq: - id: x_shift type: s1 doc: Shift by x axis - id: y_shift type: s1 doc: Shift by y axis - id: altitude type: u2 doc: Height (z position) - id: packed_normal type: normal doc: Packed normal normal: doc: Normal (3d vector) seq: - id: packed type: u4 doc: Normal packed in 4b instances: x: doc: Unpacked x component value: packed &gt;&gt; 11 &amp; 0x7FF y: doc: Unpacked y component value: packed &amp; 0x7FF z: doc: Unpacked z component value: packed &gt;&gt; 22 tile: doc: Tile parameters seq: - id: packed type: u2 doc: Tile information packed in 2b instances: index: doc: Tile index in texture value: packed &amp; 63 texture: doc: Texture index value: packed &gt;&gt; 6 &amp; 255 rotation: doc: Tile rotation (*90 degrees) value: packed &gt;&gt; 14 &amp; 3</code> </pre> </div></div><br><p>      ‚Äî       . </p><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><h4 id="raspakovka-normali">   </h4><br><p> 10    z,  11  x  y </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> packed_normal; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)((packed_normal &gt;&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x7FF</span></span>) - <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(packed_normal &amp; <span class="hljs-number"><span class="hljs-number">0x7FF</span></span>) - <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> z = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(packed_normal &gt;&gt; <span class="hljs-number"><span class="hljs-number">22</span></span>) / <span class="hljs-number"><span class="hljs-number">1000.0f</span></span>;</code> </pre> <br><h4 id="informaciya-o-teksture">    </h4><br><p> 6     , 8   , 2   </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">short</span></span> texture; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tile_index = f &amp; <span class="hljs-number"><span class="hljs-number">63</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> texture_index = (f &gt;&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">255</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> rotation = (f &gt;&gt; <span class="hljs-number"><span class="hljs-number">14</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title"> 3d </b> <div class="spoiler_text"><h4 id="poluchenie-landshafta">   </h4><br><p>    33   33 ,  ,  3232 .     ‚Äî 1  . </p><br><p>  : <br> x =   x + x_offset / 254 <br> y =   y + y_offset / 254 <br> z = altitude / 65535 * max_altitude ( .mp ) </p><br><p>     "",       : </p><br><pre> <code class="plaintext hljs"> 0 1 2 *-*-* |\|\| ~ 33 *-*-* |\|\| ~ 66 *-*-* ~ ~ ~</code> </pre> <br><p>       ,  , 1616 .   ‚Äî 2  .      ,  90 . </p></div></div><br><p>        .   ,     ,     ID  ,       MP . </p><br><blockquote> <strong> :</strong>    MP,     ,       :  ID     , -     . <br>  ID       ‚Äî         . </blockquote><p>  ‚Äî      : </p><br><p><img src="https://habrastorage.org/webt/so/88/c6/so88c6ufcpzn1cqhxc7orbzeif4.jpeg"></p><br><p>   - ‚Äî    ,         . </p><br><h2 id="mob"> MOB </h2><br><p>    ( )   ,     ,     :   .           ‚Äî    " ",     . <br>         ,    (    ). </p><br><p>   : </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> structure { <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> type_id; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> size; byte data[size - <span class="hljs-number"><span class="hljs-number">8</span></span>]; } node;</code> </pre> <br><div class="spoiler"> <b class="spoiler_title">  (,   !)</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/hf/jd/yi/hfjdyiujzmtzizewv5i86pmjil0.png"></p><br><p>   ( , ) </p><br><pre> <code class="plaintext hljs">meta: id: mob title: Evil Islands, MOB file (map entities) application: Evil Islands file-extension: mob license: MIT endian: le doc: Map entities tree seq: - id: root_node type: node doc: Root node types: node: doc: Entity node seq: - id: type_id type: u4 doc: Node children type ID - id: size type: u4 doc: Node full size - id: data type: node_data size: size - 8 doc: Node stored data node_data: doc: Node data seq: - id: value type: switch-on: _parent.type_id cases: 0xA000: node 0x00001E00: node 0x00001E01: node 0x00001E02: node 0x00001E03: node 0x00001E0B: node 0x00001E0E: node 0x0000A000: node 0x0000AA01: node 0x0000ABD0: node 0x0000B000: node 0x0000B001: node 0x0000CC01: node 0x0000DD01: node 0x0000E000: node 0x0000E001: node 0x0000F000: node 0x0000FF00: node 0x0000FF01: node 0x0000FF02: node 0xBBAB0000: node 0xBBAC0000: node 0xBBBB0000: node 0xBBBC0000: node 0xBBBD0000: node 0xBBBE0000: node 0xBBBF0000: node 0xDDDDDDD1: node _: u1 doc: Node elements repeat: eos</code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><table><thead><tr><th>   </th><th>  () </th><th>  </th></tr></thead><tbody><tr><td> AiGraph </td><td></td><td>   </td></tr><tr><td> AreaArray </td><td></td><td></td></tr><tr><td> Byte </td><td>  1 </td><td> 1   </td></tr><tr><td> Diplomacy </td><td> 4096 </td><td> 32x32   2  </td></tr><tr><td> Dword </td><td>  4 </td><td> 4   </td></tr><tr><td>  Float </td><td>  4 </td><td> 4  </td></tr><tr><td> LeverStats </td><td>  12 </td><td>   </td></tr><tr><td> Null </td><td>  0 </td><td>   </td></tr><tr><td> Plot </td><td>  12 </td><td> 3 floats (vec3) </td></tr><tr><td> Plot2DArray </td><td></td><td></td></tr><tr><td> Quaternion </td><td>  16 </td><td> 4 floats (vec4) </td></tr><tr><td> Record </td><td> &gt;8 </td><td>   </td></tr><tr><td> Rectangle </td><td></td><td></td></tr><tr><td>  String </td><td></td><td>  </td></tr><tr><td> StringArray </td><td> &gt;4 </td><td>   </td></tr><tr><td> StringEncrypted </td><td> &gt;4 </td><td>    </td></tr><tr><td> UnitStats </td><td>  180 </td><td>   </td></tr><tr><td>  Unbekannt </td><td></td><td></td></tr></tbody></table></div></div><br><div class="spoiler"> <b class="spoiler_title">  type_id</b> <div class="spoiler_text"><table><thead><tr><th> type_id </th><th>  Datentyp </th><th>   </th></tr></thead><tbody><tr><td> 0x00000000 </td><td> Record </td><td> ROOT </td></tr><tr><td> 0x00001E00 </td><td> Record </td><td> VSS_SECTION </td></tr><tr><td> 0x00001E01 </td><td> Record </td><td> VSS_TRIGER </td></tr><tr><td> 0x00001E02 </td><td> Record </td><td> VSS_CHECK </td></tr><tr><td> 0x00001E03 </td><td> Record </td><td> VSS_PATH </td></tr><tr><td> 0x00001E04 </td><td> Dword </td><td> VSS_ID </td></tr><tr><td> 0x00001E05 </td><td> Rectangle </td><td> VSS_RECT </td></tr><tr><td> 0x00001E06 </td><td> Dword </td><td> VSS_SRC_ID </td></tr><tr><td> 0x00001E07 </td><td> Dword </td><td> VSS_DST_ID </td></tr><tr><td> 0x00001E08 </td><td>  String </td><td> VSS_TITLE </td></tr><tr><td> 0x00001E09 </td><td>  String </td><td> VSS_COMMANDS </td></tr><tr><td> 0x00001E0A </td><td> Byte </td><td> VSS_ISSTART </td></tr><tr><td> 0x00001E0B </td><td> Record </td><td> VSS_LINK </td></tr><tr><td> 0x00001E0C </td><td>  String </td><td> VSS_GROUP </td></tr><tr><td> 0x00001E0D </td><td> Byte </td><td> VSS_IS_USE_GROUP </td></tr><tr><td> 0x00001E0E </td><td> Record </td><td> VSS_VARIABLE </td></tr><tr><td> 0x00001E0F </td><td> StringArray </td><td> VSS_BS_CHECK </td></tr><tr><td> 0x00001E10 </td><td> StringArray </td><td> VSS_BS_COMMANDS </td></tr><tr><td> 0x00001E11 </td><td>  String </td><td> VSS_CUSTOM_SRIPT </td></tr><tr><td> 0x0000A000 </td><td> Record </td><td> OBJECTDBFILE </td></tr><tr><td> 0x0000AA00 </td><td> Null </td><td> LIGHT_SECTION </td></tr><tr><td> 0x0000AA01 </td><td> Record </td><td>  Licht </td></tr><tr><td> 0x0000AA02 </td><td>  Float </td><td> LIGHT_RANGE </td></tr><tr><td> 0x0000AA03 </td><td>  String </td><td> LIGHT_NAME </td></tr><tr><td> 0x0000AA04 </td><td> Plot </td><td> LIGHT_POSITION </td></tr><tr><td> 0x0000AA05 </td><td> Dword </td><td> LIGHT_ID </td></tr><tr><td> 0x0000AA06 </td><td> Byte </td><td> LIGHT_SHADOW </td></tr><tr><td> 0x0000AA07 </td><td> Plot </td><td> LIGHT_COLOR </td></tr><tr><td> 0x0000AA08 </td><td>  String </td><td> LIGHT_COMMENTS </td></tr><tr><td> 0x0000ABD0 </td><td> Record </td><td> WORLD_SET </td></tr><tr><td> 0x0000ABD1 </td><td> Plot </td><td> WS_WIND_DIR </td></tr><tr><td> 0x0000ABD2 </td><td>  Float </td><td> WS_WIND_STR </td></tr><tr><td> 0x0000ABD3 </td><td>  Float </td><td> WS_TIME </td></tr><tr><td> 0x0000ABD4 </td><td>  Float </td><td> WS_AMBIENT </td></tr><tr><td> 0x0000ABD5 </td><td>  Float </td><td> WS_SUN_LIGHT </td></tr><tr><td> 0x0000B000 </td><td> Record </td><td> OBJECTSECTION </td></tr><tr><td> 0x0000B001 </td><td> Record </td><td> OBJECT </td></tr><tr><td> 0x0000B002 </td><td> Dword </td><td> NID </td></tr><tr><td> 0x0000B003 </td><td> Dword </td><td> OBJTYPE </td></tr><tr><td> 0x0000B004 </td><td>  String </td><td> OBJNAME </td></tr><tr><td> 0x0000B005 </td><td> Null </td><td> OBJINDEX </td></tr><tr><td> 0x0000B006 </td><td>  String </td><td> OBJTEMPLATE </td></tr><tr><td> 0x0000B007 </td><td>  String </td><td> OBJPRIMTXTR </td></tr><tr><td> 0x0000B008 </td><td>  String </td><td> OBJSECTXTR </td></tr><tr><td> 0x0000B009 </td><td> Plot </td><td> OBJPOSITION </td></tr><tr><td> 0x0000B00A </td><td> Quaternion </td><td> OBJROTATION </td></tr><tr><td> 0x0000B00B </td><td> Null </td><td> OBJTEXTURE </td></tr><tr><td> 0x0000B00C </td><td> Plot </td><td> OBJCOMPLECTION </td></tr><tr><td> 0x0000B00D </td><td> StringArray </td><td> OBJBODYPARTS </td></tr><tr><td> 0x0000B00E </td><td>  String </td><td> PARENTTEMPLATE </td></tr><tr><td> 0x0000B00F </td><td>  String </td><td> OBJCOMMENTS </td></tr><tr><td> 0x0000B010 </td><td> Null </td><td> OBJ_DEF_LOGIC </td></tr><tr><td> 0x0000B011 </td><td> Byte </td><td> OBJ_PLAYER </td></tr><tr><td> 0x0000B012 </td><td> Dword </td><td> OBJ_PARENT_ID </td></tr><tr><td> 0x0000B013 </td><td> Byte </td><td> OBJ_USE_IN_SCRIPT </td></tr><tr><td> 0x0000B014 </td><td> Byte </td><td> OBJ_IS_SHADOW </td></tr><tr><td> 0x0000B015 </td><td> Null </td><td> OBJ_R </td></tr><tr><td> 0x0000B016 </td><td>  String </td><td> OBJ_QUEST_INFO </td></tr><tr><td> 0x0000C000 </td><td> Null </td><td> SC_OBJECTDBFILE </td></tr><tr><td> 0x0000CC00 </td><td> Null </td><td> SOUND_SECTION </td></tr><tr><td> 0x0000CC01 </td><td> Record </td><td> SOUND </td></tr><tr><td> 0x0000CC02 </td><td> Dword </td><td> SOUND_ID </td></tr><tr><td> 0x0000CC03 </td><td> Plot </td><td> SOUND_POSITION </td></tr><tr><td> 0x0000CC04 </td><td> Dword </td><td> SOUND_RANGE </td></tr><tr><td> 0x0000CC05 </td><td>  String </td><td> SOUND_NAME </td></tr><tr><td> 0x0000CC06 </td><td> Dword </td><td> SOUND_MIN </td></tr><tr><td> 0x0000CC07 </td><td> Dword </td><td> SOUND_MAX </td></tr><tr><td> 0x0000CC08 </td><td>  String </td><td> SOUND_COMMENTS </td></tr><tr><td> 0x0000CC09 </td><td> Null </td><td> SOUND_VOLUME </td></tr><tr><td> 0x0000CC0A </td><td> StringArray </td><td> SOUND_RESNAME </td></tr><tr><td> 0x0000CC0B </td><td> Dword </td><td> SOUND_RANGE2 </td></tr><tr><td> 0x0000CC0D </td><td> Byte </td><td> SOUND_AMBIENT </td></tr><tr><td> 0x0000CC0E </td><td> Byte </td><td> SOUND_IS_MUSIC </td></tr><tr><td> 0x0000D000 </td><td> Null </td><td> PR_OBJECTDBFILE </td></tr><tr><td> 0x0000DD00 </td><td> Null </td><td> PARTICL_SECTION </td></tr><tr><td> 0x0000DD01 </td><td> Record </td><td> PARTICL </td></tr><tr><td> 0x0000DD02 </td><td> Dword </td><td> PARTICL_ID </td></tr><tr><td> 0x0000DD03 </td><td> Plot </td><td> PARTICL_POSITION </td></tr><tr><td> 0x0000DD04 </td><td>  String </td><td> PARTICL_COMMENTS </td></tr><tr><td> 0x0000DD05 </td><td>  String </td><td> PARTICL_NAME </td></tr><tr><td> 0x0000DD06 </td><td> Dword </td><td> PARTICL_TYPE </td></tr><tr><td> 0x0000DD07 </td><td>  Float </td><td> PARTICL_SCALE </td></tr><tr><td> 0x0000E000 </td><td> Record </td><td> DIRICTORY </td></tr><tr><td> 0x0000E001 </td><td> Record </td><td> FOLDER </td></tr><tr><td> 0x0000E002 </td><td>  String </td><td> DIR_NAME </td></tr><tr><td> 0x0000E003 </td><td> Dword </td><td> DIR_NINST </td></tr><tr><td> 0x0000E004 </td><td> Dword </td><td> DIR_PARENT_FOLDER </td></tr><tr><td> 0x0000E005 </td><td> Byte </td><td> DIR_TYPE </td></tr><tr><td> 0x0000F000 </td><td> Record </td><td> DIRICTORY_ELEMENTS </td></tr><tr><td> 0x0000FF00 </td><td> Record </td><td> SEC_RANGE </td></tr><tr><td> 0x0000FF01 </td><td> Record </td><td> MAIN_RANGE </td></tr><tr><td> 0x0000FF02 </td><td> Record </td><td> RANGE </td></tr><tr><td> 0x0000FF05 </td><td> Dword </td><td> MIN_ID </td></tr><tr><td> 0x0000FF06 </td><td> Dword </td><td> MAX_ID </td></tr><tr><td> 0x31415926 </td><td> AiGraph </td><td> AIGRAPH </td></tr><tr><td> 0xACCEECCA </td><td>  String </td><td> SS_TEXT_OLD </td></tr><tr><td> 0xACCEECCB </td><td> StringEncrypted </td><td> SS_TEXT </td></tr><tr><td> 0xBBAB0000 </td><td> Record </td><td> MAGIC_TRAP </td></tr><tr><td> 0xBBAB0001 </td><td> Dword </td><td> MT_DIPLOMACY </td></tr><tr><td> 0xBBAB0002 </td><td>  String </td><td> MT_SPELL </td></tr><tr><td> 0xBBAB0003 </td><td> AreaArray </td><td> MT_AREAS </td></tr><tr><td> 0xBBAB0004 </td><td> Plot2DArray </td><td> MT_TARGETS </td></tr><tr><td> 0xBBAB0005 </td><td> Dword </td><td> MT_CAST_INTERVAL </td></tr><tr><td> 0xBBAC0000 </td><td> Record </td><td> LEVER </td></tr><tr><td> 0xBBAC0001 </td><td> Null </td><td> LEVER_SCIENCE_STATS </td></tr><tr><td> 0xBBAC0002 </td><td> Byte </td><td> LEVER_CUR_STATE </td></tr><tr><td> 0xBBAC0003 </td><td> Byte </td><td> LEVER_TOTAL_STATE </td></tr><tr><td> 0xBBAC0004 </td><td> Byte </td><td> LEVER_IS_CYCLED </td></tr><tr><td> 0xBBAC0005 </td><td> Byte </td><td> LEVER_CAST_ONCE </td></tr><tr><td> 0xBBAC0006 </td><td> LeverStats </td><td> LEVER_SCIENCE_STATS_NEW </td></tr><tr><td> 0xBBAC0007 </td><td> Byte </td><td> LEVER_IS_DOOR </td></tr><tr><td> 0xBBAC0008 </td><td> Byte </td><td> LEVER_RECALC_GRAPH </td></tr><tr><td> 0xBBBB0000 </td><td> Record </td><td> UNIT </td></tr><tr><td> 0xBBBB0001 </td><td> Null </td><td> UNIT_R </td></tr><tr><td> 0xBBBB0002 </td><td>  String </td><td> UNIT_PROTOTYPE </td></tr><tr><td> 0xBBBB0003 </td><td> Null </td><td> UNIT_ITEMS </td></tr><tr><td> 0xBBBB0004 </td><td> UnitStats </td><td> UNIT_STATS </td></tr><tr><td> 0xBBBB0005 </td><td> StringArray </td><td> UNIT_QUEST_ITEMS </td></tr><tr><td> 0xBBBB0006 </td><td> StringArray </td><td> UNIT_QUICK_ITEMS </td></tr><tr><td> 0xBBBB0007 </td><td> StringArray </td><td> UNIT_SPELLS </td></tr><tr><td> 0xBBBB0008 </td><td> StringArray </td><td> UNIT_WEAPONS </td></tr><tr><td> 0xBBBB0009 </td><td> StringArray </td><td> UNIT_ARMORS </td></tr><tr><td> 0xBBBB000A </td><td> Byte </td><td> UNIT_NEED_IMPORT </td></tr><tr><td> 0xBBBC0000 </td><td> Record </td><td> UNIT_LOGIC </td></tr><tr><td> 0xBBBC0001 </td><td> Null </td><td> UNIT_LOGIC_AGRESSIV </td></tr><tr><td> 0xBBBC0002 </td><td> Byte </td><td> UNIT_LOGIC_CYCLIC </td></tr><tr><td> 0xBBBC0003 </td><td> Dword </td><td> UNIT_LOGIC_MODEL </td></tr><tr><td> 0xBBBC0004 </td><td>  Float </td><td> UNIT_LOGIC_GUARD_R </td></tr><tr><td> 0xBBBC0005 </td><td> Plot </td><td> UNIT_LOGIC_GUARD_PT </td></tr><tr><td> 0xBBBC0006 </td><td> Byte </td><td> UNIT_LOGIC_NALARM </td></tr><tr><td> 0xBBBC0007 </td><td> Byte </td><td> UNIT_LOGIC_USE </td></tr><tr><td> 0xBBBC0008 </td><td> Null </td><td> UNIT_LOGIC_REVENGE </td></tr><tr><td> 0xBBBC0009 </td><td> Null </td><td> UNIT_LOGIC_FEAR </td></tr><tr><td> 0xBBBC000A </td><td>  Float </td><td> UNIT_LOGIC_WAIT </td></tr><tr><td> 0xBBBC000B </td><td> Byte </td><td> UNIT_LOGIC_ALARM_CONDITION </td></tr><tr><td> 0xBBBC000C </td><td>  Float </td><td> UNIT_LOGIC_HELP </td></tr><tr><td> 0xBBBC000D </td><td> Byte </td><td> UNIT_LOGIC_ALWAYS_ACTIVE </td></tr><tr><td> 0xBBBC000E </td><td> Byte </td><td> UNIT_LOGIC_AGRESSION_MODE </td></tr><tr><td> 0xBBBD0000 </td><td> Record </td><td> GUARD_PT </td></tr><tr><td> 0xBBBD0001 </td><td> Plot </td><td> GUARD_PT_POSITION </td></tr><tr><td> 0xBBBD0002 </td><td> Null </td><td> GUARD_PT_ACTION </td></tr><tr><td> 0xBBBE0000 </td><td> Record </td><td> ACTION_PT </td></tr><tr><td> 0xBBBE0001 </td><td> Plot </td><td> ACTION_PT_LOOK_PT </td></tr><tr><td> 0xBBBE0002 </td><td> Dword </td><td> ACTION_PT_WAIT_SEG </td></tr><tr><td> 0xBBBE0003 </td><td> Dword </td><td> ACTION_PT_TURN_SPEED </td></tr><tr><td> 0xBBBE0004 </td><td> Byte </td><td> ACTION_PT_FLAGS </td></tr><tr><td> 0xBBBF0000 </td><td> Record </td><td> TORCH </td></tr><tr><td> 0xBBBF0001 </td><td>  Float </td><td> TORCH_STRENGHT </td></tr><tr><td> 0xBBBF0002 </td><td> Plot </td><td> TORCH_PTLINK </td></tr><tr><td> 0xBBBF0003 </td><td>  String </td><td> TORCH_SOUND </td></tr><tr><td> 0xDDDDDDD1 </td><td> Record </td><td> DIPLOMATION </td></tr><tr><td> 0xDDDDDDD2 </td><td> Diplomacy </td><td> DIPLOMATION_FOF </td></tr><tr><td> 0xDDDDDDD3 </td><td> StringArray </td><td> DIPLOMATION_PL_NAMES </td></tr><tr><td> 0xFFFFFFFF </td><td>  Unbekannt </td><td>  UNBEKANNT </td></tr></tbody></table></div></div><br><p>        ‚Äî ,    ,     Nival,    ‚Äî  ,     (  ,  ). </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> key; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { key += (((((key * <span class="hljs-number"><span class="hljs-number">13</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + key) &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) - key) * <span class="hljs-number"><span class="hljs-number">4</span></span> + <span class="hljs-number"><span class="hljs-number">2531011</span></span>; data[i] ^= key &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>; }</code> </pre> </div></div><br><blockquote> <strong> :</strong>      ,       (   )    .   ,      ,       ,       . </blockquote><p>      (  ,   ,    ‚Äî Windows 98): </p><br><p><img src="https://habrastorage.org/webt/8w/qv/gz/8wqvgzyxxuqmqremuny92irjzue.jpeg"></p><br><blockquote> <strong> :</strong>       ,     . ,        ( , ,  " :   ",     ). </blockquote><p>  ,     ,  -     -   , , Collada      : </p><br><p><img src="https://habrastorage.org/webt/l8/2i/tc/l82itcjm6orpd7hb0tp6p9rqq5y.jpeg"></p><br><h1 id="epilog">  </h1><br><p>          .      ,          <em> </em>   . </p><br><p>  ,            .     -   ,   ‚Äî -    ,      . , -... </p><br><p>     ‚Äî     ! </p><br><p> <strong>UPD (23.01.2019):</strong> <br>        ,             : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">github</a> . <br>        ,          (,   ""      ). </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><h3 id="obschaya-informaciya-ob-igre">     </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://ru.nival.com/games/history/zemli</a> ‚Äî    </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://ru.wikipedia.org/wiki/_</a> ‚Äî    </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://allods.gipat.ru/index.php?p=ei</a> ‚Äî    " " </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://evil-islands.github.io</a> ‚Äî  ,     </li></ul><br><h3 id="instrumenty-s-otkrytymi-ishodnikami">     </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://gipatgroup.org/utilities</a> ‚Äî EiEdit (.res, .*db), MobSurgeon (.mob) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://svn.gipat.org/trac/GGWiki</a> ‚Äî EiEdit (.res, .*db), MobSurgeon (.mob),    .mp, .sec, .*db </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/demothorg/eifixer</a> ‚Äî     </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/konstvest/ei_figer</a> ‚Äî   Blender   .lnk, .fig, .bon, .anm </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/demothorg/ei-tools</a> ‚Äî       (.mob, .lnk, .mpr, .res) +   </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/konstvest/ei_maper</a> ‚Äî   (.mpr, .mp, .sec, .mob) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://github.com/chemmalion/EIDBEditor</a> ‚Äî     (.*db) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://gitlab.com/ykurganov/open-evil-islands</a> ‚Äî       ,      </li></ul><br><h3 id="kommyuniti">  </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://vk.com/evil.islands</a> ‚Äî   </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://allods.gipat.ru</a> ‚Äî " " </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://gipat.ru</a> ‚Äî  " " </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://gipatgroup.org/forum</a> ‚Äî  GipatGroup (   ‚Äî  ) </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">http://honestgroup.net/forum</a> ‚Äî  HonestGroup </li></ul></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de434802/">https://habr.com/ru/post/de434802/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de434792/index.html">Freelansim 2018: Ergebnisse des Jahres</a></li>
<li><a href="../de434794/index.html">Soft Skills eines erfolgreichen Testers</a></li>
<li><a href="../de434796/index.html">Coding the Art: Wie wir Grafiken und Animationen in Designprojekten generieren</a></li>
<li><a href="../de434798/index.html">Swagger - intelligente Dokumentation f√ºr Ihre RESTful-Web-API - Junior-Back-End-Entwicklerbewertung f√ºr Neulinge</a></li>
<li><a href="../de434800/index.html">(5-2) M√∂glichkeiten zum Migrieren einer gro√üen SQL-Tabelle</a></li>
<li><a href="../de434804/index.html">Das Fintech-Startup Robinhood konnte kein Analogon von Bankkonten starten</a></li>
<li><a href="../de434806/index.html">Neujahrsabbau mit einem Kanu</a></li>
<li><a href="../de434810/index.html">Starter f√ºr die Arbeit mit Spring Cloud</a></li>
<li><a href="../de434812/index.html">Projektzeitmanagement</a></li>
<li><a href="../de434816/index.html">Detox und Appium: Automatisierter Schnittstellentest in React Native</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>