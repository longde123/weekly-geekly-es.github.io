<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✡️ 👨🏾‍🎨 🤛🏾 根据GOST加密：有关设置动态流量路由的备忘录 👧🏻 🤜 🕢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="如果您的公司通过网络传输或接收受法律保护的个人数据和其他机密信息，则需要按照GOST进行加密。 今天，我们将告诉您如何在其中一位客户的基础上基于S-Terra加密网关（KS）实施这种加密。 这个故事将对信息安全专家以及工程师，设计师和架构师很有趣。 在本文中，我们不会深入探讨技术配置的细微差别-我们...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>根据GOST加密：有关设置动态流量路由的备忘录</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/solarsecurity/blog/471470/"><img src="https://habrastorage.org/webt/v-/53/qf/v-53qfuqlx4ywc8cf8xfp2wlgt8.jpeg"><br> 如果您的公司通过网络传输或接收受法律保护的个人数据和其他机密信息，则需要按照GOST进行加密。 今天，我们将告诉您如何在其中一位客户的基础上基于S-Terra加密网关（KS）实施这种加密。 这个故事将对信息安全专家以及工程师，设计师和架构师很有趣。 在本文中，我们不会深入探讨技术配置的细微差别-我们将介绍基本设置的关键点。  Internet上免费提供了大量有关配置Linux OS守护程序的文档，而S-Terra KS则基于该文档。  S-Terra专有软件配置文档也可以在制造商的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">门户网站</a>上公开获得。 <br><a name="habracut"></a><br><h2> 关于项目的几句话 </h2><br> 客户的网络拓扑是典型的-中心和分支机构之间的全网格。 要求在所有站点之间引入信息交换通道的加密，该站点共有8个。 <br><br> 通常，在此类项目中，所有内容都是静态的：在加密网关（KS）上，将静态路由设置为站点的局域网，并写入用于加密的IP地址（ACL）列表。 但是，在这种情况下，站点没有集中管理，并且本地网络中可能发生任何事情：可以以各种方式添加，删除和修改网络。 为了避免在更改站点上本地网络的地址时重新配置到KS的路由和ACL，决定使用GRE隧道和动态路由OSPF，该协议包括站点上的所有KS和网络核心级别的大多数路由器（在某些站点，首选基础结构管理员）在内核路由器上按照KS的方向使用SNAT）。 <br><br>  GRE隧道解决了两个问题： <br>  <b>1.</b>在ACL中使用加密外部KS接口的IP地址的方法，其中封装了发送到其他站点的所有流量。 <br>  <b>2.</b>在KS之间组织ptp隧道，这使您可以配置动态路由（在我们的示例中，提供商MPLS L3VPN在站点之间进行组织）。 <br><br> 客户命令将加密作为服务实施。 否则，他不仅必须支持加密网关或将某些组织外包，而且还必须独立监控加密证书的生命周期，及时更新它们并安装新证书。 <br><img src="https://habrastorage.org/webt/ho/lc/ch/holcch4mtnk2skxc5_atydslidu.jpeg"><br> 现在，备忘录本身-我们如何以及如何设置 <br><br><h2>  KII主题说明：我们配置了加密网关 </h2><br><h3> 基本网络设置 </h3><br> 首先，我们启动一个新的缓存并进入管理控制台。 您应该首先更改内置管理员的<b>密码</b> - <b>更改用户密码管理员</b>命令。 然后，有必要执行初始化过程（ <b>初始化</b>命令），在该过程中输入许可证数据并初始化随机数传感器（DSN）。 <br><br>  <b><u>注意！</u></b> 初始化S-Terra KS后，将建立安全策略，其中安全网关接口不传递数据包。 您必须创建自己的策略，或使用<b>run csconf_mgr Activate命令</b>激活预定义的权限策略。 <br> 接下来，您需要配置外部和内部接口的寻址以及默认路由。 最好使用缓存的网络配置并通过类似于Cisco的控制台配置加密。 此控制台旨在输入与Cisco IOS命令类似的命令。 依次将使用类似Cisco的控制台创建的配置转换为OS守护程序使用的相应配置文件。 您可以使用<b>configure</b>命令从管理控制台转到类似于Cisco的控制台。 <br><br> 更改内置用户cscons的密码并启用： <br><br>  &gt;启用 <br> 密码：csp（预定义） <br>  ＃配置终端 <br>  #username cscons特权15秘密0＃启用秘密0设置基本网络配置： <br><br>  #interface GigabitEthernet0 / 0 <br>  #ip地址10.111.21.3 255.255.255.0 <br>  ＃不关机 <br>  #interface GigabitEthernet0 / 1 <br>  #ip地址192.168.2.5 255.255.255.252 <br>  ＃不关机 <br>  #ip路由0.0.0.0 0.0.0.0 10.111.21.254 <br><br><h3>  GRE </h3><br> 我们退出类似Cisco的控制台，并使用<b>system</b>命令进入debian shell。 使用<b>passwd</b>命令为<b>root用户</b>设置您自己的密码。 <br> 每个KSh上为每个站点配置了单独的隧道。 隧道接口在<b>/ etc / network / interfaces</b>文件中配置。  IP隧道实用程序是iproute2的预定义集的一部分，它负责创建接口本身。 创建接口的命令被写入pre-up选项中。 <br><br> 典型的隧道接口的示例配置： <br> 汽车网站1 <br>  iface site1 inet静态 <br> 地址192.168.1.4 <br> 网络掩码255.255.255.254 <br> 前置ip隧道添加site1模式gre本地10.111.21.3远程10.111.22.3密钥hfLYEg ^ vCh6p <br><br>  <b><u>注意！</u></b> 应该注意的是，隧道接口设置必须位于本节的外部 <br><br>  ### netifcfg-开始### <br>  ***** <br>  ### netifcfg-end ### <br><br> 否则，当通过类似Cisco的控制台更改物理接口的网络设置时，这些设置将被删除。 <br><br><h3> 动态路由 </h3><br> 在S-Terra中，动态路由是使用Quagga软件包实现的。 要配置OSPF，我们需要启用并配置<b>zebra</b>和<b>ospfd守护程序</b> 。  zebra守护程序负责路由守护程序和操作系统之间的交互。 顾名思义，ospfd守护程序负责实现OSPF协议。 <br> 可以通过守护程序控制台或直接通过<b>/etc/quagga/ospfd.conf</b>配置文件来配置OSPF。 动态路由中涉及的所有物理和隧道接口均已添加到文件中，并且宣布了将要宣布的网络并接收通知。 <br><br> 要添加到<b>ospfd.conf</b>的示例配置： <br>  eth0接口 <br>  ！ <br>  eth1接口 <br>  ！ <br> 界面site1 <br>  ！ <br> 界面site2 <br> 路由器ospf <br>  ospf路由器ID 192.168.2.21 <br> 网络192.168.1.4/31区域0.0.0.0 <br> 网络192.168.1.16/31区域0.0.0.0 <br> 网络192.168.2.4/30区域0.0.0.0 <br><br> 在这种情况下，地址192.168.1.x / 31为站点之间的ptp隧道网络保留，地址192.168.2.x / 30为KS和内核路由器之间的传输网络分配。 <br><br>  <u><b>注意！</b></u> 为了减少大型安装中的路由表，您可以使用<b>no redistribute连接</b>或<b>redistribute连接的路由映射</b>结构过滤传输网络本身的公告。 <br><br> 设置守护程序后，您需要在<b>/ etc / quagga / daemons中</b>更改守护程序启动状态。 在选项<b>zebra</b>和<b>ospfd中，</b>没有固定为yes。 在使用<b>update-rc.d quagga enable</b>命令启动缓存时，运行quagga守护程序并设置其自动运行。 <br><br> 如果GRE隧道和OSPF配置正确，则到其他站点的网络的路由应出现在KS和内核路由器上，因此将在本地网络之间建立网络连接。 <br><br><h3> 我们对传输的流量进行加密 </h3><br> 如前所述，在站点之间进行加密时，我们通常会指定在其间加密通信的IP地址范围（ACL）：如果源地址和目标地址属于这些范围，则将加密它们之间的通信。 但是，在此项目中，结构是动态的，地址可以更改。 由于我们已经设置了GRE隧道，因此我们可以将外部KS地址指定为流量加密的源地址和目标地址-因为对于加密，流量已经被GRE协议封装。 换句话说，所有从一个站点的本地网络到其他站点声明的网络进入缓存的内容均被加密。 并且在每个站点中已经可以执行任何转发。 因此，在本地网络发生任何变化的情况下，管理员只需修改从其网络到中学方向的公告，便可以在其他站点使用。 <br><br>  S-Terra KS中的加密是使用IPSec协议执行的。 我们使用符合GOST R 34.12-2015的Grasshopper算法，并且为了与旧版本兼容，可以使用GOST 28147-89。 从技术上讲，可以在预定义密钥（PSK）和证书上执行身份验证。 但是，在工业操作中，必须使用根据GOST R 34.10-2012颁发的证书。 <br><br> 使用<b>cert_mgr</b>实用程序来处理证书，容器和CRL。 首先，使用<b>cert_mgr create</b>命令， <b>您</b>需要<b>创建</b>一个私钥容器和一个证书请求，这些请求将被发送到证书管理中心。 收到证书后，必须使用<b>cert_mgr import</b>命令以及CA和CRL的根证书（如果使用）将<b>其导入</b> 。 您可以使用<b>cert_mgr show</b>命令<b>验证是否</b>已安装所有证书和CRL。 <br><br> 成功安装证书后，转到类似Cisco的控制台以配置IPSec。 <br> 我们创建了一个IKE策略，该策略指定了所创建安全通道的所需算法和参数，这些策略和参数将提供给合作伙伴以供批准。 <br><br>  #crypto isakmp策略1000 <br>  #encr gost341215k <br>  #hash gost341112-512-tc26 <br>  ＃身份验证标志 <br>  #group vko2 <br>  #lifetime 360​​0 <br><br> 在构建IPSec的第一阶段时，将应用此策略。 第一阶段的成功完成是SA（安全协会）的建立。 <br> 接下来，我们需要定义一个用于加密的源IP地址和目标IP地址（ACL）列表，形成一个转换集，创建一个加密映射（crypto map）并将其绑定到CAB的外部接口。 <br><br> 设置ACL： <br>  #ip访问列表扩展site1 <br>  #permit gre主机10.111.21.3主机10.111.22.3 <br><br> 一组转换（以及对于第一阶段，我们使用模拟模式的Grasshopper加密算法）： <br><br>  #crypto ipsec transform-set GOST esp-gost341215k-mac <br><br> 创建一个加密映射，指定ACL，转换集和对等地址： <br><br>  #crypto map主要100 ipsec-isakmp <br>  #match地址site1 <br>  #set transform-set GOST <br>  #set对等10.111.22.3 <br><br> 我们将加密映射附加到CABG的外部接口： <br><br>  #interface GigabitEthernet0 / 0 <br>  #ip地址10.111.21.3 255.255.255.0 <br>  #crypto map主 <br><br> 要与其他站点加密通道，必须重复创建ACL和加密卡的过程，更改ACL的名称，IP地址和加密卡号。 <br><br>  <b><u>注意！</u></b> 如果未使用CRL证书验证，则必须明确指定： <br><br>  #crypto pki trustpoint s-terra_technologic_trustpoint <br>  ＃吊销检查无 <br><br> 在此设置上可以认为是完整的。 类似于Cisco的控制台命令的输出<b>显示crypto isakmp sa</b>和<b>crypto ipsec sa</b>应该反映IPSec的第一和第二阶段的构建。 使用从debian shell执行的<b>sa_mgr show</b>命令可以获得相同的信息。  <b>cert_mgr show</b>命令的输出<b>应显示</b>远程站点证书。 此类证书的状态为<b>远程</b> 。 如果未构建隧道，则需要查看VPN服务日志，该日志存储在<b>/var/log/cspvpngate.log</b>文件中。 文档中提供了日志文件的完整列表及其内容说明。 <br><br><h2> 监控系统的“健康状况” </h2><br>  S-Terra KS使用标准的snmpd守护程序进行监视。 除了典型的Linux参数外，开箱即用的S-Terra还根据CISCO-IPSEC-FLOW-MONITOR-MIB支持IPSec隧道的输出，这是我们用来监视IPSec隧道状态的工具。 还支持自定义OID的功能，将脚本的结果作为值。 此功能使我们可以跟踪证书的到期日期。 编写的脚本将解析<b>cert_mgr show</b>命令的输出，并因此给出本地证书和根证书到期之前的天数。 在管理大量CABG时，此技术必不可少。 <br><img src="https://habrastorage.org/webt/ho/gl/py/hoglpynhcvdwk7o5x5hpvbtycuo.jpeg"><br><br><h2> 这种加密的秘诀是什么 </h2><br>  KS S-Terra“开箱即用”支持上述所有功能。 也就是说，没有必要安装任何其他可能影响加密网关认证和整个信息系统认证的模块。 站点之间的通道可以是任何通道，甚至可以通过Internet。 <br><br> 由于在更改内部基础结构时无需重新配置加密网关，因此该<b>系统作为服务运行</b> ，对客户而言非常方便：他可以将其服务（客户端和服务器）放置在任何地址，并且所有更改都在加密设备之间动态传输。 <br><br> 当然，由于开销引起的加密会影响数据传输速率，但影响不大-通道带宽最多可减少5-10％。 此外，该技术已经过测试，即使在不稳定且带宽较低的卫星频道上也显示出良好的效果。 <br><br>  <i>Rostelecom Solar第二管理行的工程师Igor Vinokhodov</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN471470/">https://habr.com/ru/post/zh-CN471470/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN471452/index.html">人工智能与地震预测相关</a></li>
<li><a href="../zh-CN471458/index.html">线性回归和梯度下降</a></li>
<li><a href="../zh-CN471462/index.html">下诺夫哥罗德的Java开发人员学院</a></li>
<li><a href="../zh-CN471464/index.html">亲手为儿童设计的微型电器设计师</a></li>
<li><a href="../zh-CN471468/index.html">黑客按危害分类的问题</a></li>
<li><a href="../zh-CN471472/index.html">安全周42：硬件后门，英特尔NUC中的漏洞</a></li>
<li><a href="../zh-CN471474/index.html">生活黑客-免费在云端编写和托管带有访客留言簿的网站</a></li>
<li><a href="../zh-CN471480/index.html">如何建立有效的产品团队？</a></li>
<li><a href="../zh-CN471482/index.html">CLRium＃6：并发与并行。 两天：从处理器到异步/等待</a></li>
<li><a href="../zh-CN471484/index.html">足球转移的模式：深入研究</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>