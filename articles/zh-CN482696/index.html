<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤾 🏨 🤟🏼 Windows Linux安装系统的全磁盘加密。 加密多重启动 🤴🏽 🆑 🚄</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="更新了自己的Runet V0.2中的全磁盘加密指南 

 牛仔策略： 
 [A]阻止Windows 7安装的系统的系统加密； 
 [B] GNU / Linux块系统加密（Debian）的已安装系统（包括/ boot） ； 
 [C] GRUB2设置，通过数字签名/身份验证/哈希保护引导程序； 
 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Windows Linux安装系统的全磁盘加密。 加密多重启动</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482696/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/y7/04/pd/y704pdw4xfrpf8nipub8isyyzra.jpeg"></div><br>  <b>更新了自己的Runet V0.2中的全磁盘加密指南</b> <br><br><h3> 牛仔策略： </h3><br>  [A]阻止Windows 7安装的系统的系统加密； <br>  [B] GNU / Linux块系统加密<i>（Debian）的已</i>安装系统<i>（包括/ boot）</i> ； <br>  [C] GRUB2设置，通过数字签名/身份验证/哈希保护引导程序； <br>  [D]剥离-销毁未加密的数据； <br>  [E]加密操作系统的通用备份； <br>  [F]攻击&lt;on [C6]&gt;目标是引导加载程序GRUB2； <br>  [G]有用的文档。 <br><br>  <b>╭───电路＃房间40＃&lt;BIOS中没有BIOS的MBR / 1HDD&gt;：</b> <br>  ├──╼已安装Windows 7-完整的系统加密，未隐藏； <br>  ├──╼已安装GNU / Linux <i>（Debian和衍生发行版）</i> -未隐藏完整的系统加密<i>（/，包括/ boot; swap）</i> ； <br>  ├──╼独立的引导程序：MBR中安装了VeraCrypt引导程序，扩展分区中安装了GRUB2引导程序； <br>  ├──╼无需进行OS安装/重新安装； <br>  └──╼二手加密软件：VeraCrypt； 加密设置  GnuPG； 海马 哈希深  GRUB2-免费/免费。 <a name="habracut"></a><br><br> 上述方案部分解决了“远程启动到闪存驱动器”的问题，使您可以享受Windows / Linux加密的操作系统，并通过“加密通道”从一个操作系统与另一个操作系统交换数据。 <br><br>  <b>PC引导顺序（选项之一）：</b> <br><br><ul><li> 打开机器； </li><li> 加载VeraCrypt引导加载程序<i>（输入正确的密码将继续加载Windows 7）</i> ； </li><li> 按Esc键将加载GRUB2引导程序； </li><li>  bootloader GRUB2 <i>（发行版/ GNU / Linux / CLI的选择）</i> ，将要求GRUB2超级用户&lt;login / password&gt;的身份验证； </li><li> 成功通过身份验证并选择了分发工具包后，您将需要输入密码来解锁“ /boot/initrd.img”； </li><li> 在GRUB2中输入无错密码后，需要“输入”密码<i>（第三</i>个密码<i>，BIOS密码或GNU / Linux用户帐户密码-不考虑）</i>以解锁和加载GNU / Linux操作系统，或者自动替换一个秘密密钥<i>（两个密码+一个密钥，或者密码+密钥）</i> ； </li><li> 外部侵入GRUB2配置将冻结GNU / Linux引导过程。 </li></ul><br> 麻烦了吗 好的，让我们自动化这些过程。 <br><br> 在标记硬盘<i>（MBR表）时，一</i>台PC最多可以有4个主分区，或3个主分区和1个扩展分区，以及一个未分配的区域。 与主分区不同，扩展分区可以包含小节<i>（逻辑驱动器=扩展分区）</i> 。 换句话说，HDD上的“扩展分区”将LVM替换为当前任务：完全系统加密。 如果将磁盘分区为4个主分区，则需要使用lvm，或者将分区从main转换<i>（通过格式化）</i>到扩展，或者明智地使用所有四个分区，并保留所有内容，以得到所需的结果。 即使磁盘上有一个分区，Gparted也会帮助将HDD拆分<i>为其他分区</i>而不会丢失数据，但这样做的代价很小。 <br><br> 下表列出了将用语言表达整篇文章的硬盘布局。 <br><br><img src="https://habrastorage.org/webt/jd/3k/wf/jd3kwfqr9mas6ldlmil_5qwwbg8.png"><br>  <i>1Tb截面表（第1号）。</i> <br><br> 类似的事情也应该伴随着你。 <br>  sda1-主分区№1NTFS <i>（加密）</i> ； <br>  sda2-扩展标记部分； <br>  sda6-逻辑驱动器<i>（已安装GRUB2引导加载程序）；</i> <br>  sda8-交换（加密交换文件/并非总是）； <br>  sda9-测试逻辑驱动器； <br>  sda5-好奇的逻辑驱动器； <br>  sda7-GNU / Linux操作系统（将操作系统移植到加密的逻辑驱动器上）； <br>  sda3-Windows 7的主要部分2 <i>（加密）</i> ； <br>  sda4是3号主分区<i>（它包含未加密的GNU / Linux，它用于备份/并非总是如此）</i> 。 <br><br><h2>  [A] Windows 7块系统加密 </h2><br><div class="spoiler">  <b class="spoiler_title">A1。</b>  <b class="spoiler_title">Veracrypt</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/-q/in/7s/-qin7s3t7xacdjov7invu_8kb2y.png"><br><br> 从<a href="https://www.veracrypt.fr/en/Downloads.html" rel="nofollow">官方网站</a>或从<a href="https://sourceforge.net/projects/veracrypt/" rel="nofollow">sourceforge</a>镜像下载VeraCrypt加密软件的安装版本<i>（在发布v1.24-Update3时，VeraCrypt的便携式版本不适合系统加密）</i> 。 检查下载软件的校验和 <br><br> <code>$ Certutil -hashfile "C:\VeraCrypt Setup 1.24.exe" SHA256</code> <br> <br> 并将结果与​​VeraCrypt开发人员网站上发布的CS进行比较。 <br><br> 如果安装了HashTab软件，则更加简单：RMB <i>（VeraCrypt Setup 1.24.exe）</i> -文件总和的哈希<i>属性</i> 。 <br><br> 要验证程序的签名，系统必须<a href="https://www.gnupg.org/download/index.html" rel="nofollow">安装gnuPG</a>开发人员的软件和公共pgp密钥；  <a href="https://www.gpg4win.org/get-gpg4win.html" rel="nofollow">gpg4win</a> 。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A2。</b>  <b class="spoiler_title">安装/启动VeraCrypt Administrator软件</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/py/ih/fo/pyihfozxju5pulv79n_3mllt9km.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">A3。</b>  <b class="spoiler_title">选择活动分区的系统加密选项</b> <div class="spoiler_text">  VeraCrypt-系统-加密系统分区/磁盘-普通-加密Windows系统分区-多重引导- <i>（警告：“不建议没有经验的用户使用此方法”，这是真的，我们同意“是”）</i> -引导磁盘<i>（“是”，即使否则，无论如何“是”）</i> -系统磁盘数量“ 2个或更多”-一个磁盘上的多个系统“是”-不是Windows引导程序“否” <i>（但实际上是“是”！否则，VeraCrypt / GRUB2引导程序将不会共享MBR更准确地说，在MBR /引导磁道之间，它们仅存储了引导加载程序代码的最小部分，</i>  <i>它的主要部分位于文件系统中）</i> -Multiboot-加密设置... <br><br> 如果您偏离上述步骤（ <i>阻止系统加密方案）</i> ，则VeraCrypt将推出警告，并且不允许加密分区。 <br><br> 下一步，要进行有针对性的数据保护，请执行“测试”并选择一种加密算法。 如果您使用的是非现代CPU，则可能是最快的Twofish加密算法，请选择它。 如果CPU是现代的，请注意以下区别：AES-根据测试结果进行加密的速度将比其加密竞争对手快几倍。  AES是最流行的加密算法，现代CPU的硬件专门针对“秘密” <s>和“黑客</s> ”进行了优化。 <br><br>  VeraCrypt支持使用AES <i>（Twofish）</i> /和其他组合对驱动器进行加密的功能。 在十年前的旧内核英特尔CPU上<i>（没有对AES-NI的硬件支持，没有通过A / T级联进行加密），</i>性能下降基本上是无法察觉的。  <i>（对于具有相同〜参数时代的AMD CPU，性能会略有下降）</i> 。 操作系统是动态的，透明加密的资源消耗是不可见的。 相比之下，例如，由于在GNU / Linux中安装了测试不稳定的桌面环境Mate v1.20.1 <i>（或者我不记得的v1.20.2）</i> ，或者由于Windows7中遥测杂草例程的运行，性能明显下降。 通常，老练的用户在加密之前会对硬件性能进行测试。 例如，在对Aida64 / Sysbench / systemd-analyze的指责中，将它们与对系统加密后的相同测试结果进行了比较，从而反驳了“系统加密有害”的神话。 备份/还原加密数据时，计算机速度变慢，给用户带来不便，这是因为“系统数据备份”操作本身不是以毫秒为单位进行度量的，并且添加了相同的“动态解密/加密”操作。 最终，每个被允许搞乱密码学的用户在满足目标，他的偏执程度和易用性方面都设置了加密算法的平衡。 <br><br> 最好默认保留PIM参数，以便在每次加载OS时都不必输入确切的迭代值。  VeraCrypt使用大量迭代来创建真正的“慢散列”。 使用“蛮力/彩虹表”方法对这种“密码蜗牛”进行攻击，仅在使用<s>简短的</s> “简单”密码短语和个人受害者的字符集列表时才有意义。 支付密码强度-启动操作系统时正确输入密码的延迟<i>（在GNU / Linux中安装VeraCrypt卷要快得多）。</i> <br> 用于实施暴力攻击的免费软件<i>（从VeraCrypt / LUKS磁盘头提取密码）</i> Hashcat。 开膛手约翰不知道如何“破解Veracrypt”，并且在与LUKS合作时，他不了解Twofish密码学。 顺便说一下，在所有其他方面的非商业软件中，JtR比Hashcat更好。 <br><br> 由于加密算法的加密强度，不可阻挡的密码库及其对立体开发出具有不同攻击向量的软件。 例如，从RAM中提取元数据/密钥<i>（冷启动攻击/直接内存访问），在</i>窃取LUKS标头的同时拦截密码并发送网络数据包，这也许是我所不知道的。 有专门的免费和非免费软件可以实现这些目的。 <br><br> 完成加密活动分区的“唯一元数据”的配置/生成后，VeraCrypt将提供重新启动PC并测试其引导加载程序的性能的功能。  Windows重新启动/启动后，VeraCrypt将以待机模式加载，仅用于确认加密过程-是。 <br><br> 在系统加密的最后一步，VeraCrypt将以“ veracrypt急救磁盘.iso”的形式创建活动加密分区的标头的备份副本-必须完成- <u>在此软件中，此操作是</u>必需的<i>（不幸的是，在LUKS中，</i> <u>此操作被</u> <i>省略了，但强调了在文档中）</i> 。 救援磁盘对每个人都有用，对一个人也有用。 如果没有磁盘头，移动操作系统，丢失<i>（覆盖头/ MBR）</i>头备份，将永久剥夺Windows操作系统对解密分区的访问。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">A4。</b>  <b class="spoiler_title">创建VeraCrypt USB /驱动器救援</b> <div class="spoiler_text"> 默认情况下，VeraCrypt提供将“〜2-3mB元数据”刻录到CD，但并非所有人都具有驱动器或DWD-ROM驱动器，而为某人创建可引导的VeraCrypt Rescue磁盘将是一个技术惊喜： / GUIdd-ROSA ImageWriter和其他类似软件将无法完成任务，因为除了将转移的元数据复制到可启动USB闪存驱动器之外，您还需要从USB驱动器的文件系统外部的映像进行复制/粘贴，总之，正确地将MBR /磁道复制到钥匙扣。 在GNU / Linux下，您可以使用“ dd”实用程序创建一个可引导的闪存驱动器，查看此图板。 <br><br><img src="https://habrastorage.org/webt/_z/zl/f-/_zzlf-zhvflotagy215jpqv9dkw.jpeg"><br><br> 在Windows环境中创建应急磁盘的方法有所不同。  VeraCrypt开发人员并未在“救援磁盘”的官方<a href="https://www.veracrypt.fr/en/VeraCrypt%2520Rescue%2520Disk.html" rel="nofollow">文档中</a>包含针对此问题的解决方案，但提出了另一种解决方案：他在其VeraCrypt论坛上发布了用于创建“ usb救援磁盘”的其他软件，以便免费使用。 更新：2020年，开发人员对“小事”感到可惜，并将<a href="" rel="nofollow">USB应急磁盘</a>解决方案正式纳入其文档中。 <br> 保存应急磁盘.iso之后，将开始对活动分区进行块系统加密。 在加密期间，操作系统不会停止，不需要重新启动PC。 加密操作完成后，活动分区将完全加密，您可以使用它。 如果启动PC时未出现VeraCrypt引导加载程序，并且标头恢复操作无济于事，请检查“引导”标志，应将其安装在存在Windows的分区上<i>（与加密和其他操作系统无关，请参见表1）。</i> <br> 加密系统驱动器和ntfs逻辑驱动器（相同的密码）后，将所有加密的驱动器添加到“系统收藏夹”中。 接下来，在“设置”&gt;“系统收藏夹”中，选中“ Windows启动时挂载系统收藏夹”框，当操作系统启动时，所有ntfs磁盘将自动挂载。 <br>  <i><b>到此完成了Windows块系统加密的描述。</b></i> <br></div></div><br><h2>  [B] LUKS。  GNU / Linux <i>（〜Debian）</i>安装的操作系统的加密。 算法和步骤 </h2><br> 为了加密已安装的Debian /派生发行版，您需要将准备好的分区映射到虚拟块设备，将其传输到映射的GNU / Linux驱动器，然后安装/配置GRUB2。 如果您没有裸服务器，并且珍惜时间，则需要使用GUI，并且以下所述的大多数终端命令都应以“ Chuck-Norris模式”驱动。 <br><br>  <b>B1。</b>  <b>从实时USB GNU / Linux下载PC</b> <br><br>  “对铁的性能进行加密测试” <br><br><pre> <code class="bash hljs">lscpu &amp;&amp; ryptsetup benchmark</code> </pre> <br><img src="https://habrastorage.org/webt/xm/t5/ko/xmt5koolr78zxwr0rwicahnlr78.jpeg"><br><br> 如果您是拥有支持AES-NI硬件的功能强大的汽车的满意所有者，那么如果您满意的话，数字将看起来像终端的右侧，但左侧是古董铁。 <br><br>  <b>B2。</b>  <b>分区磁盘。</b>  <b>在Ext4中安装/格式化fs逻辑驱动器HDD（Gparted）</b> <br><br><div class="spoiler">  <b class="spoiler_title">B2.1。</b>  <b class="spoiler_title">创建一个加密的sda7分区头</b> <div class="spoiler_text"> 在下文中，我将根据上面列出的我的节表来描述节的名称。 根据您的磁盘布局，您必须替换您的分区名称。 <br><br> 逻辑磁盘加密映射<i>（/ dev / sda7&gt; / dev / mapper / sda7_crypt）。</i> <br>  ＃轻松创建“ LUKS-AES-XTS分区” <br><br><pre> <code class="bash hljs">cryptsetup -v -y luksFormat /dev/sda7</code> </pre> <br> 选项： <br><br>  * luksFormat-LUKS标头的初始化； <br>  * -y是密码短语（不是密钥/文件）； <br>  * -v -verbalization（在终端中输出信息）； <br>  * / dev / sda7-从扩展分区<i>（到您计划传输/加密GNU / Linux的位置）的</i>逻辑驱动器。 <br><br> 默认情况下，加密算法为&lt;L <i>UKS1：aes-xts-plain64，密钥：256位，LUKS标头哈希：sha256，RNG：/ dev / urandom</i> &gt; <i>（取决于cryptsetup的版本）。</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># default-  cryptsetup --help #     .</span></span></code> </pre> <br> 在CPU上没有对AES的硬件支持的情况下，创建扩展的“ LUKS-Twofish-XTS-partition”是最佳选择。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.2。</b>  <b class="spoiler_title">高级创建“ LUKS-Twofish-XTS分区”</b> <div class="spoiler_text"><pre> <code class="bash hljs">cryptsetup luksFormat /dev/sda7 -v -y -c twofish-xts-plain64 -s 512 -h sha512 -i 1500 --use-urandom</code> </pre> <br> 选项： <br>  * luksFormat-LUKS标头的初始化； <br>  * / dev / sda7您将来的加密逻辑驱动器； <br>  * -v语言化； <br>  * -y要求确认密码； <br>  * -c选择数据加密算法； <br>  * -s加密密钥大小； <br>  * -h哈希算法/加密函数，由RNG <i>（--use-urandom）</i>用来为逻辑驱动器头，辅助头密钥（XTS）生成唯一的加密/解密密钥； 存储在磁盘加密头中的唯一主密钥，辅助XTS密钥，所有这些元数据和加密例程，使用主密钥和辅助XTS密钥对分区上的任何数据<i>（分区头除外）进行</i>加密/解密，存储在所选硬分区上的〜3 mB中开车。 <br>  * -i LUKS的PBKDF迭代时间（以毫秒为单位） <i>（处理密码短语时的时间延迟会影响OS负载和密钥的加密强度）。</i> 要使用简单的密码（例如“ russian”）保持密码强度的平衡，您需要增加该值-（i）使用复杂的密码（例如“？8dobob /øfh”），您可以减小该值。 <br>  * --use-urandom随机数生成器，生成密钥和盐。 <br><br> 比较sda7&gt; sda7_crypt部分<i>（操作很快，因为创建</i>了带有〜3 <i>mb元数据的加密标头，仅</i>此而已<i>）</i> ，您需要格式化并挂载sda7_crypt文件系统。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.3。</b>  <b class="spoiler_title">制图</b> <div class="spoiler_text"><pre> <code class="bash hljs">cryptsetup open /dev/sda7 sda7_crypt <span class="hljs-comment"><span class="hljs-comment">#       .</span></span></code> </pre><br> 选项： <br>  *打开-映射“名称”部分； <br>  * / dev / sda7-逻辑驱动器； <br>  * sda7_crypt是一个名称映射，用于在操作系统启动时挂载加密分区或对其进行初始化。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.4。</b>  <b class="spoiler_title">在ext4中格式化sda7_crypt文件系统。</b>  <b class="spoiler_title">操作系统安装</b> <div class="spoiler_text">  <i>（注意：Gparted将不再与加密分区一起使用）</i> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#    mkfs.ext4 -v -L DebSHIFR /dev/mapper/sda7_crypt</span></span></code> </pre><br> 选项： <br>  * -v-语言化； <br>  * -L -disk标签（在资源管理器中与其他磁盘一起显示）。 <br><br> 接下来，将虚拟加密的块设备/ dev / sda7_crypt挂载到系统中 <br><br><pre> <code class="bash hljs">mount /dev/mapper/sda7_crypt /mnt</code> </pre> <br> 使用/ mnt文件夹中的文件将自动在sda7中动态加密/解密数据。 <br><br> 在资源管理器<i>（nautilus / caja GUI）中</i>映射并挂载该分区更加方便，该分区将已经在磁盘选择列表中，仅输入用于打开/解密磁盘的密码即可。 匹配名称将被自动选择，而不是“ sda7_crypt”，而是类似/ dev / mapper / Luks-xx-xx的名称。 <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B2.5。</b>  <b class="spoiler_title">备份磁盘头（〜3MB元数据）</b> <div class="spoiler_text"> 需要立即进行的最<b>重要的</b>操作之一是sda7_crypt标头的备份副本。 如果覆盖/破坏标头<i>（例如，通过在sda7分区中安装GRUB2等）</i> ，则加密的数据将永久丢失而无法恢复，因为将无法重新生成相同的密钥，因此将创建唯一的密钥。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cryptsetup luksHeaderBackup --header-backup-file ~/_DebSHIFR /dev/sda7</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   cryptsetup luksHeaderRestore --header-backup-file &lt;file&gt; &lt;device&gt;</span></span></code> </pre> <br> 选项： <br>  * luksHeaderBackup --header-backup-file-backup命令； <br>  * luksHeaderRestore --header-backup-file-restore命令； <br>  *〜/ Backup_DebSHIFR-备份文件； <br>  * / dev / sda7是要保留其加密磁盘头的备份副本的分区。 <br>  <i><b>注意事项</b></i>  <i>不要尝试将LUKS节的标题从[sdaX]还原到[sdaY]，大多数用户名将失败。</i> <br>  <i><b>在此步骤中，完成&lt;创建和编辑加密分区&gt;。</b></i> <br></div></div><br>  <b>B3</b>  <b>将GNU / Linux操作系统<i>（sda4）</i>迁移到加密分区<i>（sda7）</i></b> <br><br>  <i><b>注意事项</b></i>  <i>在将操作系统转移到加密分区之前，建议删除多余的缓存垃圾（可以使用BleachBit软件找到类似的垃圾），例如，在我的情况下，它是数十万个小文件/ var / cache / fontconfig / *和/home/user/.cache / fontconfig / *</i> <i><br></i>  <i>如果清除了fontconfig文件，请执行$ fc-cache -fvr</i> <br><br> 创建/ mnt2文件夹<i>（注意-我们仍在使用实时usb，sda7_crypt安装在/ mnt点），</i>并将GNU / Linux安装在/ mnt2中，必须对其进行加密。 <br><br><pre> <code class="bash hljs">mkdir /mnt2 mount /dev/sda4 /mnt2</code> </pre><br> 我们使用Rsync软件执行正确的OS迁移 <br><pre> <code class="bash hljs">rsync -avlxhHX --progress /mnt2/ /mnt</code> </pre> <br>  Rsync选项在第E1页中描述。 <br><br> 接下来， <b>您需要</b>对逻辑驱动器分区进行碎片整理 <br><br><pre> <code class="bash hljs">e4defrag -c /mnt/ <span class="hljs-comment"><span class="hljs-comment"># , e4defrag ,     ≈ 0,  ,       ! e4defrag /mnt/ #   GNU/Linux</span></span></code> </pre> <br> 遵循规则：如果您有HDD，请不时对加密的GNU / LInux执行e4defrag。 <br>  <i><b>此步骤的迁移和同步[GNU / Linux&gt; GNU / Linux加密]已完成。</b></i> <br><br>  <b>B4。</b>  <b>在sda7加密分区上配置GNU / Linux</b> <br><br> 成功传输OS / dev / sda4&gt; / dev / sda7之后，您需要登录到加密分区上的GNU / Linux，并执行有关加密系统的进一步配置<i>（无需重新启动PC）</i> 。 也就是说，位于实时USB中，但是要执行的命令“相对于加密OS的根目录”。 模拟类似情况将是“ chroot”。 要快速接收当前正在使用哪个操作系统的信息<i>（由于sda4和sda7中的数据已同步</i> ， <i>因此已加密或未加密）</i> ，请<i>取消同步</i> OS。 在根目录<i>（sda4 / sda7_crypt）中</i>创建空的<i>令牌</i>文件，例如/ mnt /加密的OS和/ mnt2 /解密的OS。 快速检查您所处的操作系统<i>（包括将来的</i>操作系统<i>）：</i> <br><pre> <code class="bash hljs">ls /&lt;Tab-Tab&gt;</code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">B4.1。</b>  <b class="spoiler_title">“模拟加密OS的入口”</b> <div class="spoiler_text"><pre> <code class="bash hljs">mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /dev /mnt/dev mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /proc /mnt/proc mount --<span class="hljs-built_in"><span class="hljs-built_in">bind</span></span> /sys /mnt/sys chroot /mnt</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.2。</b>  <b class="spoiler_title">验证正在加密系统上执行工作</b> <div class="spoiler_text"><pre> <code class="bash hljs">ls /mnt&lt;Tab-Tab&gt; <span class="hljs-comment"><span class="hljs-comment">#   "/"</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">history</span></span> <span class="hljs-comment"><span class="hljs-comment">#       su  .</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.3。</b>  <b class="spoiler_title">创建/配置加密交换</b> <div class="spoiler_text"> 由于交换文件是在操作系统的每次启动时进行格式化的，因此像B2.2节中所示，现在就没有必要创建并映射交换到逻辑驱动器并键入命令。 对于交换，每次启动时，都会自动生成其临时加密密钥。 交换a键生命周期：卸载/断开交换分区<i>（+ RAM清洁）</i> ； 或重新启动操作系统。 配置交换，打开负责配置块加密设备<i>的文件（类似于fstab文件，但负责加密）。</i> <br><br><pre> <code class="bash hljs">nano /etc/crypttab</code> </pre> <br> 规则 <br><blockquote>  ＃“目标名称”“源设备”“密钥文件”“选项” <br>  swap / dev / sda8 / dev / urandom交换，密码= twofish-xts-plain64，大小= 512，哈希= sha512 </blockquote><br> 选件 <br>  * swap是/ dev / mapper / swap的映射加密名称。 <br>  * / dev / sda8-在交换下使用您的逻辑分区。 <br>  * / dev / urandom-用于交换的随机加密密钥生成器（ <i>每次新的OS引导都会创建新密钥）。</i>  / dev / urandom生成器的随机性比/ dev / random少，毕竟，在危险的偏执情况下使用/ dev / random。 引导操作系统时，/ dev / random会减慢加载速度达±分钟<i>（请参阅systemd-analyze）</i> 。 <br>  * swap，密码= twofish-xts-plain64，大小= 512，哈希= sha512：-该部分知道它是交换对象，并且其格式为“相应”； 加密算法。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   fstab nano /etc/fstab</span></span></code> </pre><br> 规则 <br><blockquote>  ＃交换在安装过程中在/ dev / sda8上 <br>  / dev / mapper / swap none swap sw 0 0 <br></blockquote><br>  / dev / mapper / swap是在crypttab中设置的名称。 <br><br>  <b>备用加密交换</b> <br> 如果由于某种原因您不想将整个部分都交给交换文件，则可以采用另一种更好的方法：使用操作系统在加密分区上的文件中创建交换文件。 <br><br><pre> <code class="bash hljs">fallocate -l 3G /swap <span class="hljs-comment"><span class="hljs-comment">#   3 (  ) chmod 600 /swap #  mkswap /swap #     swapon /swap #  swap free -m #,       printf "/swap none swap sw 0 0" &gt;&gt; /etc/fstab #    swap  </span></span></code> </pre> <br>  <i><b>交换分区设置已完成。</b></i> <br><br></div></div><br><div class="spoiler">  <b class="spoiler_title">B4.4。</b>  <b class="spoiler_title">配置加密的GNU / Linux（编辑crypttab / fstab文件）</b> <div class="spoiler_text"> 如上所述，文件/ etc / crypttab描述了在引导时配置的加密块设备。 <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/crypttab nano /etc/crypttab</span></span></code> </pre><br> 如果您按照B2.1节中的说明映射了sda7&gt; sda7_crypt节 <br><blockquote>  ＃“目标名称”“源设备”“密钥文件”“选项” <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 none luks <br></blockquote><br> 如果您按照B2.2那样映射了sda7&gt; sda7_crypt部分 <br><blockquote>  ＃“目标名称”“源设备”“密钥文件”“选项” <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 none密码= twofish-xts-plain64，大小= 512，哈希= sha512 </blockquote><br> 如果您按照B2.1或B2.2中的方式比较sda7&gt; sda7_crypt部分，但又不想重新输入密码以解锁并启动OS，则可以用私钥/随机文件代替密码 <br><blockquote>  ＃“目标名称”“源设备”“密钥文件”“选项” <br>  sda7_crypt UUID = 81048598-5bb9-4a53-af92-f3f9e709e2f2 / etc / skey luks </blockquote><br> 内容描述 <br>  * none-报告操作系统启动时，需要一个秘密密码来解锁根。 <br>  * UUID-部分标识符。 要找出您的标识符，请在终端中键入<i>（提醒</i>您，在<i>此之后，您一直在chroot环境中的终端中工作，而不是在另一个活动的USB终端中工作）。</i> <br><br><pre> <code class="bash hljs">fdisk -l <span class="hljs-comment"><span class="hljs-comment">#   blkid #  - </span></span></code> </pre><br><blockquote>  / dev / sda7：UUID =“ 81048598-5bb9-4a53-af92-f3f9e709e2f2” TYPE =“ crypto_LUKS” PARTUUID =“ 0332d73c-07” <br>  / dev / mapper / sda7_crypt：LABEL =“ DebSHIFR” UUID =“ 382111a2-f993-403c-aa2e-292b5eac4780” TYPE =“ ext4” <br></blockquote><br> 从安装了sda7_crypt的实时USB终端请求blkid时，此行可见。 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您从sdaX中获取UUID </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（而不是sdaX_crypt！，UUID sdaX_crypt-在生成grub.cfg配置时它将自动离开）。</font></font></i> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*密码= twofish-xts-plain64，大小= 512，哈希= sha512 -luks高级模式加密。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* / etc / skey-一个秘密密钥文件，将自动替换该密钥文件以解锁操作系统启动</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（而不是输入第三个密码）。</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以指定最大8mb的任何文件，但是数据将读取&lt;1mb。</font></font><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ""   &lt; &gt;  691. head -c 691 /dev/urandom &gt; /etc/skey</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   (691)  7-   luks cryptsetup luksAddKey --key-slot 7 /dev/sda7 /etc/skey</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  "/ luks-" cryptsetup luksDump /dev/sda7</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 它看起来像这样： </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> （自己动手，自己看看。如果在2020年进行加密，则输出将在LUKS2中进行，如果更早，则输出将在LUKS1中进行。 </font></font></blockquote><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Check " " file -s /dev/sda7 /dev/sda7: LUKS encrypted file, ver 1 [twofish, xts-plain64, sha512] UUID: -- #   LUKS /dev/sda7: data #   VeraCrypt</span></span></code> </pre> <br><pre> <code class="bash hljs">cryptsetup luksKillSlot /dev/sda7 7 <span class="hljs-comment"><span class="hljs-comment"># /  7 </span></span></code> </pre> <br><br> /etc/fstab       . <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/fstab nano /etc/fstab</span></span></code> </pre><br><blockquote> # «file system» «mount poin» «type» «options» «dump» «pass» <br> # / was on /dev/sda7 during installation <br> /dev/mapper/sda7_crypt / ext4 errors=remount-ro 0 1 <br></blockquote><br>  <br> * /dev/mapper/sda7_crypt -  sda7&gt;sda7_crypt,     /etc/crypttab. <br> <b> crypttab/fstab .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">B4.5.   .  </b> <div class="spoiler_text"> <b>B4.5.1.   /etc/initramfs-tools/conf.d/resume</b> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      swap ,  . nano /etc/initramfs-tools/conf.d/resume</span></span></code> </pre><br>   <i>( )</i> "#"  «resume».     . <br><br> <b>B4.5.2.   /etc/initramfs-tools/conf.d/cryptsetup</b> <br><br><pre> <code class="bash hljs">nano /etc/initramfs-tools/conf.d/cryptsetup</code> </pre> <br>   <br><blockquote> # /etc/initramfs-tools/conf.d/cryptsetup <br> CRYPTSETUP=yes <br> export CRYPTSETUP <br></blockquote><br><br> <b>B4.5.3.   /etc/default/grub <i>(       grub.cfg     /boot)</i></b> <br><br><pre> <code class="bash hljs">nano /etc/default/grub</code> </pre> <br>   «GRUB_ENABLE_CRYPTODISK=y» <br>  'y', grub-mkconfig  grub-install         ,        <i>(insmod- &lt;cryptomount/set root&gt;)</i> . <br>    <br><blockquote> GRUB_DEFAULT=0 <br> GRUB_TIMEOUT=1 <br> GRUB_DISTRIBUTOR=`lsb_release -i -s 2&gt; /dev/null || echo Debian` <br> GRUB_CMDLINE_LINUX_DEFAULT=«acpi_backlight=vendor» <br> GRUB_CMDLINE_LINUX=«quiet splash noautomount» <br> GRUB_ENABLE_CRYPTODISK=y <br></blockquote><br><br> <b>B4.5.4.   /etc/cryptsetup-initramfs/conf-hook</b> <br><br><pre> <code class="bash hljs">nano /etc/cryptsetup-initramfs/conf-hook</code> </pre> <br> ,   &lt;CRYPTSETUP=y&gt;  &lt;#&gt;. <br>   <i>(   ,       ,       initrd.img).</i> <br><br>    : <br><blockquote> KEYFILE_PATTERN="/etc/skey" <br> UMASK=0077 <br></blockquote><br>     «skey»  initrd.img,         <i>(             «skey» ( + ) . .B4.4).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">B4.6.  /boot/initrd.img [version]</b> <div class="spoiler_text">      initrd.img    cryptsetup,   <br><br><pre> <code class="bash hljs">update-initramfs -u -k all</code> </pre> <br>   initrd.img <i>(  «,    »)</i>  ,   cryptsetup, , ,     Nvidia —   .   , ,     .   <i>( chroot ./boot/initrd.img). <b>!</b>  [update-initramfs -u -k all]  ,  cryptsetup open /dev/sda7 <b>sda7_crypt</b> —     ,    /etc/crypttab,   reboot-a  busybox) <br> <i><b>      .</b></i> <br></i> <br></div></div><br><h2> []    GRUB2/ </h2><br><div class="spoiler"> <b class="spoiler_title">C1.        (    20)</b> <div class="spoiler_text"><pre> <code class="bash hljs">mkfs.ext4 -v -L GRUB2 /dev/sda6</code> </pre> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C2.  /dev/sda6  /mnt</b> <div class="spoiler_text">     chroot,       /mnt2,   /mnt —  . <br>   GRUB2 <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt</code> </pre> <br>       GRUB2,   /mnt/boot/grub/i-386-pc <i>(  , ,  «i386-pc»)</i>   <i>(,     ,   .mod: cryptodisk; luks; gcry_twofish; gcry_sha512; signature_test.mod),</i>    GRUB2  . <br><br><pre> <code class="bash hljs">apt-get update apt-get install grub2</code> </pre><br> !     GRUB2  ,   « »      –     <i>( —   GRUB2 —  «MBR»   live usb)</i> .      / VeraCrypt.    GRUB2,   ,       ,    «MBR».       GRUB2,  <a href="https://www.gnu.org/software/grub/manual/grub/grub.html" rel="nofollow"></a>     –   <i>(    GRUB 2.02 ~BetaX).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C3.  GRUB2    [sda6]</b> <div class="spoiler_text">       [.C.2] <br><br><pre> <code class="bash hljs">grub-install --force --root-directory=/mnt /dev/sda6</code> </pre> <br>  <br> * --force - ,   ,        <i>( ).</i> <br> * --root-directory -  &lt;boot/grub&gt;   sda6. <br> * /dev/sda6 - sda  <i>(  &lt;&gt;  /mnt /dev/sda6).</i> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C4.    [grub.cfg]</b> <div class="spoiler_text">    «update-grub2»,        <br><br><pre> <code class="bash hljs">grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre> <br>   /  grub.cfg,      ()      <i>(«grub-mkconfig»       live usb,       Windows 10     —  ).</i>    «»,  «grub.cfg»  ,     ,    GRUB  <i>(       ),</i>  GRUB2   . <br> <b> « »   GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C5. Proof-test   GNU/Linux</b> <div class="spoiler_text">   .    GNU/Linux <i>(   chroot).</i> <br><br><pre> <code class="bash hljs">umount -a <span class="hljs-comment"><span class="hljs-comment">#     GNU/Linux Ctrl+d #   chroot umount /mnt/dev umount /mnt/proc umount /mnt/sys umount -a #     live usb reboot</span></span></code> </pre> <br>       VeraCrypt. <br><img src="https://habrastorage.org/webt/ih/jd/9c/ihjd9ciwkuzmd6mqdwmxhbcgx5q.jpeg"><br><br> *     —    Windows. <br> *  «Esc»   GRUB2,    GNU/Linux –   (sda7_crypt)   /boot/initrd.img ( grub2  uuid « » —    grub2,   , ,   /  ). <br><img src="https://habrastorage.org/webt/e4/j2/jo/e4j2jofau3dugyj7jrnztkzpbn4.jpeg"><br><br> *   ,     (. .B4.4/4.5)        /boot/initrd.img,     / ,      «skey»,      . <br><img src="https://habrastorage.org/webt/rj/76/al/rj76alpbc7ebscvxe2_0uraoaya.jpeg"><br> ( «   »). <br><br> *     GNU/Linux    . <br><img src="https://habrastorage.org/webt/j_/q0/fn/j_q0fnugeazypbbwrv_sym9qxvq.jpeg"><br><br> *      ,    /boot/initrd.img <i>( 4.6).</i> <br><br><pre> <code class="bash hljs">update-initramfs -u -k all</code> </pre> <br>        GRUB2 <i>(  -  live usb)</i>    <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre><br> <b>     GNU/Linux:</b> <br><br><ul><li> GNU/Linuxinux  ,  /boot/kernel and initrd; </li><li>     initrd.img; </li><li>    <i>(    initrd; /   ;    Linux)</i> . </li></ul><br> <b>«  GRUB2»     .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">6.   GRUB2.     +  </b> <div class="spoiler_text"> GNU/Linux  ,     –    BIOS.       GRUB2 ,  /   ,     –   [. . F]. <br>  «» GRUB2      «/». <br><ul><li>    «  »   ,         –     . </li><li>        - ,      CLI,      -GRUB2. </li></ul><br><br><div class="spoiler"> <b class="spoiler_title">6.1.   </b> <div class="spoiler_text"> ,         <br><br><pre> <code class="bash hljs">ls /&lt;Tab-Tab&gt; <span class="hljs-comment"><span class="hljs-comment"># -</span></span></code> </pre> <br>       GRUB2 <br><br><pre> <code class="bash hljs">grub-mkpasswd-pbkdf2 <span class="hljs-comment"><span class="hljs-comment">#/  .</span></span></code> </pre> <br>   . -    <br><blockquote> grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br></blockquote><br>   GRUB <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt</code> </pre> <br>   <br><br><pre> <code class="bash hljs">nano -$ /mnt/boot/grub/grub.cfg</code> </pre> <br>    ,   «grub.cfg»  -  (" --unrestricted" "--user", <br>     <i>(  ### END /etc/grub.d/41_custom ###)</i> <br> <i>«set superusers=»root" <br> password_pbkdf2 root ".</i> <br><br>     <br><blockquote> # This file provides an easy way to add custom menu entries. Simply type the <br> # menu entries you want to add after this comment. Be careful not to change <br> # the 'exec tail' line above. <br> ### END /etc/grub.d/40_custom ### <br><br> ### BEGIN /etc/grub.d/41_custom ### <br> if [ -f ${config_directory}/custom.cfg ]; then <br> source ${config_directory}/custom.cfg <br> elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then <br> source $prefix/custom.cfg; <br> fi <br> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> ### END /etc/grub.d/41_custom ### <br> # <br></blockquote><br>      «grub-mkconfig -o /mnt/boot/grub/grub.cfg»         grub.cfg,    <i>(/)</i>    GRUB-    <br><br><pre> <code class="bash hljs">nano /etc/grub.d/41_custom</code> </pre> <br><blockquote> cat &lt;&lt; EOF <br> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> EOF <br></blockquote><br><br>    «grub-mkconfig -o /mnt/boot/grub/grub.cfg», ,   ,     grub.cfg. <br> <b>     GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">6.2.    </b> <div class="spoiler_text"> ,        pgp-  <i>(   ).</i>       : gnuPG; kleopatra/GPA; Seahorse. -        . Seahorse —    3.14.0 <i>( , , V3.20 –     ).</i> <br><br> PGP-  //    su! <br><br>     <br><br><pre> <code class="bash hljs">gpg - -gen-key</code> </pre> <br>    <br><br><pre> <code class="bash hljs">gpg --<span class="hljs-built_in"><span class="hljs-built_in">export</span></span> -o ~/perskey</code> </pre> <br>           <br><br><pre> <code class="bash hljs">mount /dev/sda6 /mnt <span class="hljs-comment"><span class="hljs-comment">#sda6 –  GRUB2</span></span></code> </pre> <br>   GRUB2 <br><br><pre> <code class="bash hljs">rm -rf /mnt/</code> </pre> <br>  GRUB2  sda6,        GRUB «core.img» <br><br><pre> <code class="bash hljs">grub-install --force --modules=<span class="hljs-string"><span class="hljs-string">"gcry_sha256 gcry_sha512 signature_test gcry_dsa gcry_rsa"</span></span> -k ~/perskey --root-directory=/mnt /dev/sda6</code> </pre> <br>  <br> * --force - ,   ,    <i>( ).</i> <br> * --modules=«gcry_sha256 gcry_sha512 signature_test gcry_dsa gcry_rsa» - GRUB2        . <br> * -k ~/perskey -  «PGP-» <i>(    ,   ).</i> <br> * --root-directory -  boot   sda6 <br> /dev/sda6 - sda . <br><br> / grub.cfg <br><br><pre> <code class="bash hljs">grub-mkconfig -o /mnt/boot/grub/grub.cfg</code> </pre> <br>     «grub.cfg»  «trust /boot/grub/perskey» <i>(  pgp-.)</i>     GRUB2   ,       «signature_test.mod»,          «set check_signatures=enforce». <br><br>     <i>(    grub.cfg)</i> <br><blockquote> ### BEGIN /etc/grub.d/41_custom ### <br> if [ -f ${config_directory}/custom.cfg ]; then <br> source ${config_directory}/custom.cfg <br> elif [ -z "${config_directory}" -a -f $prefix/custom.cfg ]; then <br> source $prefix/custom.cfg; <br> fi <br> trust /boot/grub/perskey <br> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br> ### END /etc/grub.d/41_custom ### <br> # </blockquote><br><br>   "/boot/grub/perskey"       ,  hd0,6,    «»    ,    GRUB2 <i>(. set rot=..).</i> <br><br>  GRUB2 <i>(     /GRUB)</i>   «perskey». <br>  ,   <i>(  nautilus/caja):</i>     «seahorse»  .         su. <br>    sudo "/mnt/boot" –  – .       <br><br><img src="https://habrastorage.org/webt/ja/bw/id/jabwidfus4xnsjb774pllt4z1hc.jpeg"><br><br>   "/mnt/boot/grub/perskey" <i>(   grub)</i>       . ,   /    [*.sig]. <br>    "/boot" <i>( kernel, initrd).</i>    - ,      bash-   « ». <br><br>      <i>( -   )</i> <br><br><pre> <code class="bash hljs">rm -f $(find /mnt/boot/grub -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -name <span class="hljs-string"><span class="hljs-string">'*.sig'</span></span>)</code> </pre> <br>        ,    ,    GRUB2. <br><br><pre> <code class="bash hljs">apt-mark hold grub-common grub-pc grub-pc-bin grub2 grub2-common</code> </pre> <br> <b>   &lt;   &gt;   GRUB2 .</b> <br></div></div><br><div class="spoiler"> <b class="spoiler_title">C6.3. Proof-test  GRUB2,     </b> <div class="spoiler_text"> GRUB2.   -  GNU/Linux    CLI <i>( )</i>   .    /    initrd <br><br><img src="https://habrastorage.org/webt/wu/ip/nt/wuipntxpfzxczd8sz-_nihhtkrc.jpeg"><br> ,   GRUB2-. <br><br>   -   GRUB2/   grub.cfg,   /,   .mod,    .  GRUB2 . <br><br><img src="https://habrastorage.org/webt/1j/cn/ao/1jcnaogftdd3pme8jexwyrzhe_m.jpeg"><br> ,    GRUB2 « ». <br><br>  «»  « »,     «0».        <i>(  «      »         «0» —  ).</i> <br><br>     ? <br><br>   : /  GRUB2 , ,   luks.mod.sig   . <br><br>  :   CLI     <br><br><pre> <code class="bash hljs">trust_list</code> </pre> <br>      «perskey»,   «0»,     ,  .C6.2. <br> <b>     « GRUB2    » .</b> <br></div></div><br></div></div><br><div class="spoiler"> <b class="spoiler_title">7     GRUB2   </b> <div class="spoiler_text">    «  /» —  . -  GRUB2,       ,      .[F].  ,   /   . <br><br><h4>   GRUB2    </h4><br> <b>  :</b> <br><br><ul><li>    / <i>(/    <u>  </u> .      GRUB2   ,    ,        /   ,    ,   «- »          ).</i> </li><li>   <i>(      ).</i> </li><li>  <i>(/     GRUB2   ).</i> </li><li>    . </li></ul><br> <b>  .</b> <br><br><ul><li>   <i>(,      ).</i> </li><li> The Worst Evil Script <i>( /:       GRUB  ,   usb-/ , /       ,      pass/_LUKS   ).</i> </li><li>    <i>(           GNU/Linux).</i> </li></ul><br>    — <a href="http://bit.ly/2QrQk2O" rel="nofollow"> </a> ,       . <br><br> <b>     GRUB2/</b> <br><br> «»  GRUB2,               ().    ,       ,        <br><br><div class="spoiler"> <b class="spoiler_title">.</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/o9/nz/e0/o9nze0_csyzmfb7wrozs4efqqto.gif"><br></div></div><br>    ,        GRUB, save log,         pas/_LUKS  . <br>    The Worst Evil Script    <s></s>         (  cryptsetup reencrypt),    LUKS  . <br>         GRUB,     . <br>    "-$ _GRUB"         ,      CLI. <br>    "-$ sudo _GRUB"     GRUB2/     <i>(   /boot),    .</i> <br><br> <b>      </b> <br><br> <b>0)</b>  / GRUB,     /media/username <br><pre> <code class="bash hljs">-$ hashdeep -c md5 -r /media/username/GRUB &gt; /podpis.txt</code> </pre> <br> <b>1)</b>         ~/podpis,      744     «». <br><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #      GRUB2  . #  " /  ",        . !    :   GRUB2     OS GNU/Linux. echo -e "******************************************************************\n" &gt;&gt; '/var/log/podpis.txt' &amp;&amp; date &gt;&gt; '/var/log/podpis.txt' &amp;&amp; hashdeep -vvv -a -k '/podpis.txt' -r '/media/username/GRUB' &gt;&gt; '/var/log/podpis.txt' a=`tail '/var/log/podpis.txt' | grep failed` #  "cat"!! b="hashdeep: Audit failed" #:    -      GRUB2         "  "      gif- "warning". if [[ "$a" = "$b" ]] then echo -e "****\n" &gt;&gt; '/var/log/vtorjenie.txt' &amp;&amp; echo "vtorjenie" &gt;&gt; '/var/log/vtorjenie.txt' &amp;&amp; date &gt;&gt; '/var/log/vtorjenie.txt' &amp; sudo -u username DISPLAY=:0 eom '/warning.gif' fi</span></span></code> </pre> <br></div></div><br>    <i>su</i> ,     GRUB   , save . <br><br>   , , « » [virus.mod]   GRUB2    /: <br><br><pre> <code class="bash hljs">-$ hashdeep -vvv -a -k <span class="hljs-string"><span class="hljs-string">'/podpis.txt'</span></span> -r <span class="hljs-string"><span class="hljs-string">'/media/username/GRUB</span></span></code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> CLI      --</b> <div class="spoiler_text"> #   CLI <br><br><pre> <code class="bash hljs">  2 11::41 MSK 2020 /media/username/GRUB/boot/grub/virus.mod: Moved from /media/username/GRUB/1nononoshifr /media/username/GRUB/boot/grub/i386-pc/mda_text.mod: Ok /media/username/GRUB/boot/grub/grub.cfg: Ok hashdeep: Audit failed Input files examined: 0 Known files expecting: 0 Files matched: 325 Files partially matched: 0 Files moved: 1 New files found: 0 Known files not found: 0</code> </pre> <br> #   «Files moved: 1  Audit failed» ,    . <br> -     «New files found» &gt; «Files moved» <br></div></div><br> <b>2)</b>    &gt; ~/warning.gif,   744. <br><br> <b>3)</b>  fstab    GRUB   <br><br><pre> <code class="bash hljs">-$ sudo nano /etc/fstab</code> </pre> <br><blockquote> LABEL=GRUB /media/username/GRUB ext4 defaults 0 0 </blockquote><br> <b>4)</b>    <br><br><pre> <code class="bash hljs">-$ sudo nano /etc/logrotate.d/podpis</code> </pre> <br><blockquote> /var/log/podpis.txt { <br> daily <br> rotate 50 <br> size 5M <br> dateext <br> compress <br> delaycompress <br> olddir /var/log/old <br>  } <br><br> /var/log/vtorjenie.txt { <br> monthly <br> rotate 5 <br> size 5M <br> dateext <br> olddir /var/log/old <br>  } </blockquote><br> <b>5)</b>    cron <br><br><pre> <code class="bash hljs">-$ sudo crontab -e</code> </pre> <br><blockquote> <a href="https://habr.com/ru/users/reboot/" class="user_link">reboot</a> '/podpis' #     <br> 0 */6 * * * '/podpis #   0-00; 6; 12; 18. <br></blockquote><br> <b>6)</b>    <br><br><pre> <code class="bash hljs">-$ sudo su -$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias _GRUB='hashdeep -c md5 -r /media/username/GRUB &gt; /podpis.txt'"</span></span> &gt;&gt; /root/.bashrc &amp;&amp; bash -$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias _GRUB='hashdeep -vvv -a -k '/podpis.txt' -r /media/username/GRUB'"</span></span> &gt;&gt; .bashrc &amp;&amp; bash</code> </pre><br>    <code>-$ apt-get upgrade</code>    GRUB <br> <code>-$ _GRUB</code> <br> <b>      GRUB .</b> <br></div></div><br><h2> [D]  —    </h2><br><blockquote>      ,  «     »,       . </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与往常一样，</font><font style="vertical-align: inherit;">从硬盘驱动器中删除数据后</font><font style="vertical-align: inherit;">，有许多</font><font style="vertical-align: inherit;">关于恢复数据的</font><font style="vertical-align: inherit;">“神话和</font></font><a href="https://docs.bleachbit.org/doc/shred-files-and-wipe-disks.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传说</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ”。如果您相信网络控股，或者是Dr网络社区的成员，并且从未在删除/覆盖数据后尝试恢复数据</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（例如，使用R-studio恢复）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，那么建议的方法不太适合您，请使用更接近您的方法。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将GNU / Linux成功传输到加密分区后，必须删除旧副本，而不能恢复数据。通用清理方法：适用于Windows / Linux的免费GUI软件</font></font><a href="https://www.bleachbit.org/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BleachBit的</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件</font><font style="vertical-align: inherit;">。</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式化</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要销毁数据</font><b><font style="vertical-align: inherit;">的分区</font></b></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用Gparted），</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们启动BleachBit，选择“清除可用空间”-选择分区</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（您的sdaX与以前的GNU / Linux副本）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，清洁过程开始。</font><font style="vertical-align: inherit;">BleachBit-一次性擦除光盘-这就是“我们需要的”，但是！</font><font style="vertical-align: inherit;">仅在格式化磁盘并在BB v2.0软件中将其清理后，这才在理论上起作用。</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！</font><font style="vertical-align: inherit;">BB擦除磁盘，保留元数据：销毁文件的名称在数据</font><i><font style="vertical-align: inherit;">擦除</font></i><font style="vertical-align: inherit;">期间保存</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Ccleaner-不保留元数据）。</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据恢复的神话并不是一个神话。</font></font></b> <div class="spoiler_text"> Bleachbit V2.0-2   unstable OS Debian <i>(    : sfill; wipe-Nautilus -       )</i>      :  «  » <b> </b>  HDD/ <i>(ntfs/ext4)</i> .           ,    .   <i>()</i>   /    /    «»   .   ,   ,   ,   <b>« »  </b>   3+   . <br>  GNU/Linux  Bleachbit <b>2.0-2</b>        ,     .  :  Windows   CCleaner  «  ntfs»  ,        . <br><br>  ,    <u>«»</u>   , <b>   Bleachbit   </b> , ,   « / ». <br>   «    »  Windows  CCleaner/BB   «».  GNU/Linux    <i>(  )</i>      <i>( +           (  ,  ))</i> ,                . <br><br> Bleachbit v3.0  , ,   . <br> Bleachbit v2.0     GNU/Linux   Windows7. <br></div></div><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此步骤中，“磁盘清理”完成。</font></font></b> <br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [E]加密操作系统的通用备份 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个用户都有自己的数据备份方法，但是“系统OS”的加密数据需要稍微不同的方法来完成任务。</font><font style="vertical-align: inherit;">诸如Clonezilla的统一软件和类似软件无法直接使用加密数据。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置加密块设备的备份任务：</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 通用性-适用于Windows / Linux的相同备份算法/软件； </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够与任何实时USB GNU / Linux一起在控制台中工作的能力，而无需下载其他软件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（但仍建议使用GUI）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">；</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 备份安全性-存储的“图像”必须加密/受密码保护； </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 加密数据的大小必须与要复制的实际数据的大小匹配； </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方便地从备份副本中提取必要的文件</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（无需先解密整个分区）。</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 例如，通过“ dd”实用程序进行备份/还原 </font></font><br><br><pre> <code class="bash hljs">dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=/dev/sda7 of=//sda7.img bs=7M conv=sync,noerror dd <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>=//sda7.img of=/dev/sda7 bs=7M conv=sync,noerror</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它几乎相当于任务的所有要点，但是根据权利要求4，它不会受到批评，因为它将整个磁盘分区复制为一个整体，包括可用空间-这并不有趣。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，通过存档程序[tar | GNU / Linux的备份]。</font><font style="vertical-align: inherit;">gpg]“方便”，但是对于Windows备份，您需要寻找另一种解决方案-没意思。</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E1。</font><font style="vertical-align: inherit;">Windows / Linux（rsync（Grsync）捆绑包+ VeraCrypt卷）和Automount加密驱动器的通用备份</font></font></b> <div class="spoiler_text"> <b>   :</b> <br><br><ol><li>    <i>(/)</i> VeraCrypt  ; </li><li> /     Rsync   VeraCrypt; </li><li>     VeraCrypt  www. </li></ol><br><br> <i>   VeraCrypt   : <br></i> <ol><li>    <i>(  <u>    Windows</u> ,     GNU/Linux)</i> ; </li><li>   ,    « » <i>(  )</i> –  . </li></ol><br><br>        Windows,       GNU/Linux &gt; VeraCrypt ,        . <br><br>   Twofish  70   <i>( ,    )</i>  HDD ~   <i>(      ,   ).</i>  VeraCrypt Windows/Linux        ,       «   »,     . <br><br>  2017      VeraCrypt     «      GNU/Linux».   <i> en &gt; ru</i> : <br><br><blockquote>     ,      <br>    ,       .… <br><br>         Linux. <br>     ,       . <br>  ,    . </blockquote><br>  ,   VeraCrypt      HDD   . <br>     ,     ,    <i>( «»    ).</i> <br><br>     VeraCrypt 1.24-Update3        GNU/Linux,      (/dev/sdaX). <br><img src="https://habrastorage.org/webt/ix/pj/dk/ixpjdk9i1dlmojr7obxa49wobey.png"><br>  / —    VeraCrypt-. <br><br>    VeraCrypt <i>(/ntfs)</i> ,     . <br><br> //   VeraCrypt GUI &gt; GNU/Linux live usb <i>(    /media/veracrypt2,   Windows   /media/veracrypt1).</i>      Windows   GUI rsync <i>(grsync)</i> ,  . <br><br><img src="https://habrastorage.org/webt/py/0v/hw/py0vhwm-rlgyctkndhzgcyrzpu8.jpeg"><br><br>   .    ,      . <br><br>      GNU/Linux,    GUI rsync «  Windows». <br><br> <b></b> !  Veracrypt  « GNU/Linux»     <b>ext4</b> .      ntfs,        /    . <br><br>       .    rsync: <br> * -g - ; <br> * -P --progress —     ; <br> * -H - ,  ; <br> * - -  <i>(  rlptgoD)</i> ; <br> * -v -. <br><br>    « Windows VeraCrypt»     cryptsetup,   alias (su) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"alias veramount='cryptsetup open --veracrypt --tcrypt-system --type tcrypt /dev/sdaX Windows_crypt &amp;&amp; mount /dev/mapper/ Windows_crypt /media/veracrypt1'"</span></span> &gt;&gt; .bashrc &amp;&amp; bash</code> </pre><br>    «veramount <s>pictures</s> »      ,   - ,    Windows. <br><br> / <b>  VeraCrypt</b>  cryptsetup  <br><br><pre> <code class="bash hljs">cryptsetup open --veracrypt --tcrypt-system --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sdaX Windows_crypt mount /dev/mapper/Windows_crypt /mnt</code> </pre> <br> / <b>/ VeraCrypt</b>  cryptsetup  <br><br><pre> <code class="bash hljs">cryptsetup open --veracrypt --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sdaY test_crypt mount /dev/mapper/test_crypt /mnt</code> </pre> <br><br> <b> alias-  (  )      Windows     ntfs   GNU/Linux   /</b> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /   ntfs- mkdir /media/Winda7 &amp;&amp; mkdir /media/</span></span></code> </pre> <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      VeraCrypt,  " "    printf 'bob' | base64 Ym9i #  cli   "bob"</span></span></code> </pre> <br>       ~/VeraOpen.sh <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Ym9i'</span></span> | base64 -d | cryptsetup open --veracrypt --tcrypt-system --<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> tcrypt /dev/sda3 Windows_crypt &amp;&amp; mount /dev/mapper/Windows_crypt /media/Winda7 <span class="hljs-comment"><span class="hljs-comment">#   base64 (bob)             Windows. echo 'Ym9i' | base64 -d | cryptsetup open --veracrypt --type tcrypt /dev/sda1 ntfscrypt &amp;&amp; mount /dev/mapper/ntfscrypt /media/ #,     ntfs.</span></span></code> </pre><br>  «» : <pre> <code class="bash hljs">sudo chmod 100 /VeraOpen.sh</code> </pre> <br><br>     ( !)  /etc/rc.local  ~/etc/init.d/rc.local <br>   <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh -e # # rc.local # # This script is executed at the end of each multiuser runlevel. # Make sure that the script will «exit 0» on success or any other # value on error. # # In order to enable or disable this script just change the execution # bits. # # By default this script does nothing. sh -c "sleep 1 &amp;&amp; '/VeraOpen.sh'" #  ,  ~ 1     . exit 0</span></span></code> </pre> <br>  «» : <pre> <code class="bash hljs">sudo chmod 100 /etc/rc.local &amp;&amp; sudo chmod 100 /etc/init.d/rc.local</code> </pre> <br> ,    GNU/Linux         ntfs,   . <br>   ,      : <br><pre> <code class="bash hljs">systemd-analyze &amp;&amp; systemd-analyze blame</code> </pre> <br><br> <i><b>   ,     .E1   (    / OS GNU/Linux)</b></i> <br> 1)     ext4 &gt; 4gb ( ) Linux  Veracrypt []. <br> 2) Reboot  live usb. <br> 3) ~$ cryptsetup open /dev/sda7 Lunux #  . <br> 4) ~$ mount /dev/mapper/Linux /mnt #    /mnt. <br> 5) ~$ mkdir mnt2 #    . <br> 6) ~$ cryptsetup open --veracrypt --type tcrypt ~/  &amp;&amp; mount /dev/mapper/ /mnt2 #  Veracrypt   «»     /mnt2. <br> 7) ~$ rsync -avlxhHX --delete --progress /mnt/ /mnt2 #  /      Veracrypt  .  "--delete"      ( ), ..       . <br><br> (p/s/ <b></b> !     GNU/Linux   /  , , Intel &gt; AMD <i>(            Intel &gt; AMD)</i> , <b> </b>          , .   ~/etc/skey —       ,    «cryptsetup luksAddKey»     chroot —  ,   ~/etc/crypttab   "/etc/skey"  «none»,  rebot-          . <br><br> <u>  IT         Windows/Linux,      .</u> <br> <b>    /   .</b> <br></div></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [F]攻击GRUB2引导程序 </font></font></h2><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细资料</font></font></b> <div class="spoiler_text">        /  <i>( .C6.)</i> ,        .    - ,    <i>(   )</i> GRUB2       ,    <i>(       ,      --  grub.cfg).</i> <br><br>  .  <br><br> *    live usb.   <i>()</i>           .    GRUB2   grub.cfg <i>(    )</i>      <i>(  ,   GRUB2,     .    &lt;0&gt;)</i> <br> *   ,    "/mnt/boot/grub/grub.cfg". <br> *   <i>( «perskey»   core.img)</i> <br><br><pre> <code class="bash hljs">grub-install --force --root-directory=/mnt /dev/sda6</code> </pre> <br> *  «grub.cfg» &gt; "/mnt/boot/grub/grub.cfg",    , ,    «keylogger.mod»     ,  «grub.cfg» &gt;  «insmod keylogger». , ,   ,    GRUB2 <i>(    )</i>     GRUB2,  «grub-mkimage   (-).»  «-»        «grub.cfg».        :    «modern.cfg», , ,  ~400  <i>(+)</i>   "/boot/grub/i386-pc".          ,   "/boot/grub/grub.cfg",     «hashsum»        . <br>  /  GRUB2   ,      <i>(  )</i> "/boot/grub/grub.cfg"   «modern.cfg» <br><blockquote> set superusers=«root» <br> password_pbkdf2 root grub.pbkdf2.sha512.10000.DE10E42B01BB6FEEE46250FC5F9C3756894A8476A7F7661A9FFE9D6CC4D0A168898B98C34EBA210F46FC10985CE28277D0563F74E108FCE3ACBD52B26F8BA04D.27625A4D30E4F1044962D3DD1C2E493EF511C01366909767C3AF9A005E81F4BFC33372B9C041BE9BA904D7C6BB141DE48722ED17D2DF9C560170821F033BCFD8 <br></blockquote><br>     -      GRUB2. <br><br>   <i>(   )</i> ,   ,    <i>(    )</i> . - BIOS     <i>(     GRUB2 &gt;  GRUB2, !)</i> .   -     ,    ,     <i>( )</i> «grub.cfg»   .      ,  , ,     «grub.cfg» <i>(  )   ,     GRUB2.</i> <br><br>     ,  /    sdaY,    GRUB2 <i>( grub-install    )</i>   «grub.cfg» <i>( )</i>     <br><blockquote> menuentry 'GRUBx2' --class parrot --class gnu-linux --class gnu --class os $menuentry_id_option 'gnulinux-simple-382111a2-f993-403c-aa2e-292b5eac4780' { <br> load_video <br> insmod gzio <br> if [ x$grub_platform = xxen ]; then insmod xzio; insmod lzopio; fi <br> insmod part_msdos <br> insmod cryptodisk <br> insmod luks <br> insmod gcry_twofish <br> insmod gcry_twofish <br> insmod gcry_sha512 <br> insmod ext2 <br> cryptomount -u 15c47d1c4bd34e5289df77bcf60ee838 <br> set root='cryptouuid/15c47d1c4bd34e5289df77bcf60ee838' <br> normal /boot/grub/grub.cfg <br>  } <br></blockquote><br>  <br> * insmod -       ; <br> * GRUBx2 -      GRUB2; <br> * cryptomount -u 15c47d1c4bd34e5289df77bcf60ee838 -. fdisk -l (sda9); <br> * set root - ; <br> * normal /boot/grub/grub.cfg -     . <br><br>   ,     «grub.cfg» —      / «sdaY»    «GRUBx2»   GRUB. <br><br>    CLI,    <i>(      «set root»),</i>    , ,    "/shifr_grub",    "/noshifr_grub".   CLI <br><br><pre> <code class="bash hljs">cat /Tab-Tab</code> </pre> <br>    ,       ,       . , ,              "~/i386",          . <br><br>    ,       <i>( )</i> ,      ,  CLI   <br><br><pre> <code class="bash hljs">list_trusted</code> </pre> <br>      «perskey»,    ,    <i>(   «set check_signatures=enforce»)</i> . <br>    ,   .      «grub.cfg»     ,           ,      ,   GRUB2. <br>      :    <a href="https://www.gnu.org/software/grub/manual/grub/grub.html" rel="nofollow"></a> .18.2   <blockquote> «Note that even with GRUB password protection, GRUB itself cannot prevent someone with physical access to the machine from altering that machine's firmware (eg, Coreboot or BIOS) configuration to cause the machine to boot from a different (attacker-controlled) device. GRUB is at best only one link in a secure boot chain». </blockquote><br> GRUB2 —   ,      ,         MS-DOS,      . ,  GRUB2 — «»   ,   GNU/Linux    . <br><br>  ,  ,       GRUB2,        <i>(,   ,     –      /.mod)</i> . <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qhmsLeAN2Ag" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结论： </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1）Windows的块系统加密更易于实现，使用GNU / Linux块系统加密，用一个密码进行保护比使用多个密码进行保护更为方便，公平地说：后者是自动化的。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2）这篇文章是作为一本相关的详细的</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指南</font><font style="vertical-align: inherit;">，介绍了</font><font style="vertical-align: inherit;">在一台机器上进行全盘加密VeraCrypt / LUKS的情况，到目前为止，这是最好的runet（IMHO）。因此，手册&gt; 60k字符中没有涉及一些有趣的章节：关于</font></font><a href="https://en.wikipedia.org/wiki/Talk:FreeOTFE" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消失</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> / </font></font><a href="https://diskcryptor.net/forum/index.php%3Ftopic%3D5347.msg13975" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保留</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><a href="https://www.schneier.com/blog/archives/2014/05/truecrypt_wtf.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阴影</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">；在各种GNU / Linux书中很少/没有写关于密码学的内容；关于《俄罗斯联邦宪法》第51条；有关</font></font><a href="http://www.consultant.ru/document/cons_doc_LAW_128739/1aad6fe079cd2555c9c329d872dfca33764f738f/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许可</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> /禁止</font></font><a href="http://www.consultant.ru/document/cons_doc_LAW_128739/5b53393f08d12d297d683284d87338c801ed859b/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在俄罗斯联邦加密</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，说明您需要对“ root / boot”进行加密。</font><font style="vertical-align: inherit;">最终，该手册已经足够了，但是很详细</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（甚至描述了简单的步骤）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，当您进行“真正的加密”时，这将为您节省大量时间。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3）在Windows 7 64上进行全盘加密；</font><font style="vertical-align: inherit;">GNU / Linux鹦鹉4x; </font><font style="vertical-align: inherit;">GNU / Debian 9.0 / 9.5。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4）落实成功攻击</font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GRUB2引导装载程序。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5）创建了教程来帮助所有</font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏执狂的独联体国家</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些</font><s><font style="vertical-align: inherit;">国家</font></s><font style="vertical-align: inherit;">的立法允许加密。</font><font style="vertical-align: inherit;">首先，对于那些希望在不拆除已配置系统的情况下进行全盘加密的用户。</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6）修订并更新了与2020年相关的手册。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [G]有用的文件 </font></font></h2><br><ol><li> <a href="https://www.dropbox.com/s/tg2etzeptae73xa/TrueCrypt%2520%25D0%25B4%25D0%25BE%25D0%25BA%25D1%2583%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F%2520%25D0%25BF%25D0%25BE%25D0%25B4%2520%25D1%2581%25D0%25B2%25D0%25BE%25D0%25B1%25D0%25BE%25D0%25B4%25D0%25BD%25D0%25BE%25D0%25B9%2520%25D0%25BB%25D0%25B8%25D1%2586%25D0%25B5%25D0%25BD%25D0%25B7%25D0%25B8%25D0%25B5%25D0%25B9.pdf%3Fdl%3D0" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TrueCrypt用户指南</font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（RU 2012年2月）</font></font></i> </li><li> <a href="https://www.veracrypt.fr/en/Documentation.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VeraCrypt文档</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ usr / share / doc / cryptsetup（运行）[本地资源] </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（有关使用cryptsetup配置GNU / Linux加密的官方详细文档）</font></font></i> </li><li> <a href="https://gitlab.com/cryptsetup/cryptsetup/-/wikis/FrequentlyAskedQuestions" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">官方cryptsetup常见问题解答</font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（有关使用cryptsetup配置GNU / Linux加密的简要文档）</font></font></i> </li><li> <a href="https://wiki.archlinux.org/index.php/Dm-crypt/Device_encryption" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LUKS设备加密</font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（archlinux-文档）</font></font></i> </li><li> <a href="" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cryptsetup语法的详细说明</font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（arch手册页）</font></font></i> </li><li> <a href="" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crypttab的详细描述</font></font></a> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（arch手册页）</font></font></i> </li><li> <a href="https://www.gnu.org/software/grub/manual/grub/grub.html" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GRUB2的官方文档</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 标签：VeraCrypt，全盘加密，分区加密，全盘加密Linux，全系统加密LUKS1 / LUKS2。 </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复活节彩蛋</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/8a/32/f-/8a32f-bolla8my7o-yt9hhlanbi.png"><br> © ,     . <br> <a href="https://habr.com/ru/users/ne555/" class="user_link">ne555</a> 2018-2020 <br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN482696/">https://habr.com/ru/post/zh-CN482696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN482684/index.html">我用两周时间和552美元创建了自己的蘸酱</a></li>
<li><a href="../zh-CN482686/index.html">科学家使动物行为研究自动化，以解码大脑功能</a></li>
<li><a href="../zh-CN482690/index.html">在合并中创建发布者</a></li>
<li><a href="../zh-CN482692/index.html">英特尔NUC工作与虚拟化之家</a></li>
<li><a href="../zh-CN482694/index.html">Windows之后有生命吗？或者到2020年在哪里培养Windows系统管理员/工程师？</a></li>
<li><a href="../zh-CN482698/index.html">[论文]专用于浮游生物。 我没有受到工作的启发</a></li>
<li><a href="../zh-CN482700/index.html">如何“操”谷歌和Yandex：网站的黑白SEO促销。 谢斯塔科夫| 人PRO＃74</a></li>
<li><a href="../zh-CN482702/index.html">2020年我们真的需要TypeScript吗？</a></li>
<li><a href="../zh-CN482704/index.html">Go服务的Redis缓存同步</a></li>
<li><a href="../zh-CN482706/index.html">在1C平台上实施并行会计RAS + IFRS的建议</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>