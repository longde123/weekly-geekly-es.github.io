<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤ üë©üèª‚Äçüç≥ üë®üèº‚Äç‚úàÔ∏è Kit de inicio de pruebas de seguridad web üêé üò± üÜö</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola a todos! 

 Me llamo Andrey Durante 10 a√±os he estado buscando vulnerabilidades en varios servicios web. y listo para compartir mi conocimiento c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kit de inicio de pruebas de seguridad web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/">  Hola a todos! <br><br>  Me llamo Andrey  Durante 10 a√±os he estado buscando vulnerabilidades en varios servicios web.  y listo para compartir mi conocimiento contigo.  En mayo pasado, hice un informe sobre esto en la conferencia de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Heisenbug</a> , y ahora estoy listo para compartir mi conocimiento aqu√≠, tambi√©n, en los espacios abiertos de Habr.  Entonces comencemos. <br><br>  Una vez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">encontr√© una vulnerabilidad</a> en los servidores de la famosa empresa Facebook.  Los chicos olvidaron actualizar ImageMagick (la biblioteca de procesamiento de im√°genes) y lo pagaron :) Con este ejemplo, quer√≠a mostrar que todos somos humanos y que todos podemos cometer errores, sin importar en qu√© compa√±√≠as y en qu√© puestos trabajamos.  El √∫nico problema es que estos errores pueden conducir a todo tipo de riesgos. <br>  Cuanto m√°s complicada sea su aplicaci√≥n / sitio web / herramienta, m√°s probable es que algo salga mal. <br>  Debe verificar las vulnerabilidades.  Es una tonter√≠a no hacer esto en absoluto. <br><a name="habracut"></a><br>  Los siguientes elementos pueden ser etapas de verificaci√≥n de aplicaciones web: <br><ul><li>  Preparaci√≥n: <ul><li>  Definir puntos de entrada, de hecho, de d√≥nde pueden venir los datos en la aplicaci√≥n; </li><li>  Identificar stock de tecnolog√≠a; </li><li>  Determine qu√© vulnerabilidades tiene sentido verificar; </li></ul></li><li>  Verificaci√≥n  Debe verificar todas las vulnerabilidades que se aplican al alcance de la tecnolog√≠a de su aplicaci√≥n web; </li><li>  An√°lisis de c√≥digo.  No seas perezoso, no te saltes este art√≠culo.  En algunos casos, sin acceso al c√≥digo, es dif√≠cil encontrar vulnerabilidades, y esto tambi√©n le permite omitir el filtrado que puede estar incrustado en su aplicaci√≥n. </li></ul><br>  Hablar√© de todo esto en detalle. <br><br>  Entonces, preparaci√≥n.  No me enfocar√© en todos los tipos de vulnerabilidades, de lo contrario, la cantidad de texto en el art√≠culo exceder√° todos los tama√±os imaginables e inconcebibles.  Le aconsejo que comience a aprender de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lista de los 10 proyectos principales de OWASP</a> .  Cada pocos a√±os, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el consorcio OWASP</a> forma una lista de las vulnerabilidades m√°s relevantes en este momento.  Consideraremos algunos de ellos en detalle. <br><br><h2>  Xss </h2><br>  <i>XSS (cross-site scripting)</i> es un ataque a un usuario que permite a un atacante ejecutar un script arbitrario en el contexto del navegador de su v√≠ctima.  Muy a menudo, implica la implementaci√≥n de etiquetas <i>HTML</i> y scripts <i>JS</i> . <br>  Ejemplo: en un momento existi√≥ dicho servicio <i>Yahoo!</i>  <i>Ad Exchange</i>  El formulario de recuperaci√≥n de contrase√±a ten√≠a un par√°metro " <i>URL de retorno</i> ".  Podr√≠a indicar a qu√© p√°gina volver despu√©s del proceso de restablecimiento de contrase√±a.  Si inserta uno u otro vector all√≠ que conduce a la ejecuci√≥n del c√≥digo <i>JS</i> , puede obtener todas las <i>cookies</i> del usuario.  Analizaremos c√≥mo sucede esto y por qu√©. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Aqu√≠ est√° el vector en s√≠.  Todo a la vez: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  Para realizar una inyecci√≥n, debe salir del contexto de la variable en la que est√°bamos por defecto (por defecto, esto es lo que asumi√≥ el programador cuando escribi√≥ el c√≥digo). <br>  A continuaci√≥n se muestra el valor original.  Este es un comportamiento v√°lido. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  Vemos que returnURL = / login.jsp <br>  Esto cae dentro del valor de la <i>etiqueta &lt;input&gt;</i> . <br>  Si agregamos una comilla despu√©s de <i>jsp</i> , veremos que se ha vertido la sintaxis <i>HTML</i> .  Afortunadamente, el lenguaje <i>HTML</i> no es estricto, el analizador saltar√° y no habr√° problemas: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  Agrega otro personaje.  Aqu√≠ estamos completamente fuera del contexto de la <i>etiqueta &lt;input&gt;</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  Ahora agregamos la apertura de la <i>etiqueta &lt;svg&gt;</i> y obtenemos dos etiquetas v√°lidas en t√©rminos de sintaxis: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  A continuaci√≥n, agregue todo el vector de ataque: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  En este caso, se dibuja la imagen <i>svg</i> .  Usando el controlador <i>JavaScript</i> " <i>onload</i> ", ejecutamos una alerta con las <i>cookies del</i> documento.  Eso es todo!  El atacante recibi√≥ tus <i>cookies</i> . <br>  Si en la prueba mostramos solo la alerta en s√≠, no ser√° dif√≠cil para un atacante enviar cookies a un servidor controlado por √©l y, en el peor de los casos, incautar su cuenta.  Veamos c√≥mo se ve de nuevo: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Tambi√©n hay m√°s vectores de ataque en el cliente.  Dar√© algunos ejemplos con una breve descripci√≥n.  Pero primero debe comprender c√≥mo salir del contexto: <br><ul><li>  Fuera de contexto.  Estos 6 caracteres ayudar√°n a salir no solo del contexto del valor del par√°metro HTML, sino tambi√©n de muchos otros: <br>  -&gt; '"&gt; <br></li></ul><br>  Bueno, de hecho, los dos vectores de ataque m√°s simples: <br><ul><li>  Insertar enlaces en particular.  Pero en el caso general: cambiar la apariencia de la p√°gina.  Por ejemplo, pueden incrustar c√≥digo html en su p√°gina y mostrar una ventana falsa pidiendo datos: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  La cadena " <i>aaaa</i> " apunta a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">google.com</a> .  Puede ver que el enlace se representa en la p√°gina, pero es posible que no lo vea, pero esto no cancela su presencia en el c√≥digo.  En ambos casos, el caso puede considerarse completado; </li><li>  Ejecuci√≥n de script, por ejemplo, interceptando <i>cookies de</i> usuario: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3>  ¬øD√≥nde y c√≥mo buscar XSS? </h3><br>  Primero, encuentre las funciones de salida de informaci√≥n / datos en la p√°gina.  ¬øAnalizar qu√© datos llegan all√≠?  Aqu√≠ viene el concepto de una <i>fuente no confiable</i> .  Y tal, en primer lugar, es <i>su usuario</i> .  Los vectores de ataque pueden estar contenidos en cualquier otra fuente: fuentes RSS, otros servicios, tanto externos como internos. <br>  Aqu√≠ hay un ejemplo de la vida real: trabajo para SEMrush IT.  Estamos desarrollando una plataforma en l√≠nea, que es una herramienta universal para los vendedores en l√≠nea.  Entonces, un servicio guard√≥ datos, el otro dedujo, cada uno de los equipos se bas√≥ el uno en el otro, result√≥ que en el segundo servicio <i>XSS</i> surgi√≥ debido a la falta de procesamiento adecuado de los datos de salida, y el primer comando no consider√≥ necesario filtrar los datos entrantes. de ninguna manera y los mantuvo " <i>tal cual</i> ".  Conclusi√≥n: si no sabe c√≥mo se almacenan estos o esos datos, deben considerarse no confiables.  O acuerde de antemano qui√©n almacena y c√≥mo, filtros, muestra datos. <br><br>  Si ya tiene datos de fuentes no confiables, le recomiendo: <br><ul><li>  Para estudiar el filtrado de datos entrantes; </li><li>  Examina el contexto de la salida.  No en todos los casos, <i>XSS</i> puede ejecutarse, incluso en ausencia de filtrado.  Por ejemplo, si el <i>tipo de contenido de la</i> respuesta es: <i>text / plain;</i> </li><li>  No conf√≠e en el filtrado de marcos de sistemas de seguridad integrados. </li></ul><br><br><h2>  Inyecci√≥n SQL </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>Implementaci√≥n de c√≥digo SQL (inyecci√≥n SQL en ingl√©s)</i> : la introducci√≥n en la consulta de la base de datos de instrucciones que no estaban impl√≠citas all√≠. <br><br>  Ejemplo (no de la vida, sino tambi√©n bueno): <br>  Vemos un script que muestra una tabla de usuario.  En este caso, puede buscar por nombre de usuario. <br>  A la derecha se muestra c√≥mo se ve la consulta a la base de datos, y a la izquierda es el resultado de la secuencia de comandos en el navegador. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  Adem√°s, para probar y obtener al menos alg√∫n resultado primario, insertamos dos comillas en el valor del par√°metro de nombre.  Sencilla y doble: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  Vemos que desde el punto de vista de la salida, todo se vino abajo, la tabla desapareci√≥ por completo.  La solicitud tambi√©n obtiene las 2 comillas adicionales.  Se viola toda la sintaxis de la consulta <i>SQL</i> . <br>  Si tomamos y agregamos dicha construcci√≥n al valor del par√°metro ( <i>ed .: Mire en el cuadro amarillo</i> ), obtenemos una solicitud absolutamente v√°lida.  El resultado de la p√°gina es completamente id√©ntico a la primera solicitud, que no inclu√≠a una inyecci√≥n: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  Para verificar completamente que hay una vulnerabilidad, agregamos un deuce en lugar de la unidad: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  Resulta que la solicitud se vuelve falsa, desde el punto de vista de la l√≥gica booleana y, como resultado, no contiene datos.  Sin embargo, a diferencia del momento en que tuvimos un error, tenemos la salida de la tabla misma. <br><br>  Para no enumerar todo lo que puede estar en diferentes motores de base de datos y consultas de diferentes tipos, he reducido todo a una l√≠nea: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  Esto es algo que puede intentar ingresar en el par√°metro y luego, de acuerdo con las diferencias en las respuestas, intente comprender lo que est√° sucediendo, ¬øhay una vulnerabilidad o no?  Alrededor del 80% de los casos que puede cubrir con esta manipulaci√≥n. <br>  Queda un 20% de situaciones dif√≠ciles en las que no le dar√° ninguna informaci√≥n, por ejemplo: consultas / filtros anidados, etc.  En mi pr√°ctica, me encontr√© con una persona similar solo una vez.  Luego tuve que evitar el filtrado en el lado del servicio. <br><br>  ¬øCu√°l es el peligro en SQL? <br><ul><li>  De lo obvio: <i>fuga de informaci√≥n</i> .  Si un atacante pudo generar consultas a sus bases de datos, de una forma u otra puede obtener valores que no estaban destinados a la salida (hashes de contrase√±as, direcciones de clientes, etc.); </li><li>  <i>Cambio de datos</i> .  Ahora muchos desarrolladores usan bases de datos a trav√©s de sistemas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ORM</a> .  Estos sistemas, por defecto, le permiten hacer m√∫ltiples consultas a la vez, la sintaxis SQL tambi√©n le permite hacer esto.  Si hay una vulnerabilidad, todo puede volverse no solo a la selecci√≥n de datos, sino tambi√©n a su cambio (hasta eliminar tablas, cambiar la estructura de la base de datos, etc.). <br>  En la misma situaci√≥n, es posible un aumento de los privilegios del usuario.  Cambie los campos en ciertas tablas (por ejemplo, coloque <i>is_admins = true</i> en la base de datos de <i>usuarios</i> ) y aumente sus derechos al administrador; </li><li>  <i>DoS</i> .  En algunos casos, una inyecci√≥n puede conducir a una denegaci√≥n de servicio.  Se generan varias consultas pesadas a la base de datos, se inician en varios subprocesos y su servicio puede dejar de funcionar por alg√∫n tiempo; </li><li>  <i>Leer los archivos del sistema</i> es otro desastre que la inyecci√≥n SQL puede traer.  La aparici√≥n de este riesgo depende del sistema de base de datos que utilice, as√≠ como del usuario que trabaje con √©l (privilegiado o no); </li><li>  <i>RCE (Remote Code Execution)</i> es ejecuci√≥n de c√≥digo.  Depende directamente del tipo de base de datos que se use (anteriormente esto era posible de forma predeterminada, con la configuraci√≥n predeterminada de la base de datos, en MSSQL). </li></ul><br>  La siguiente tabla muestra las vulnerabilidades en la consulta <i>SQL</i> .  Por supuesto, no necesitas memorizarlo.  Adem√°s, estas no son todas las opciones posibles, sino simplemente ejemplos.  Solo preste atenci√≥n al hecho de que los lugares donde puede ocurrir la inyecci√≥n en la consulta <i>SQL</i> si llegan datos sin procesar est√°n resaltados en rojo.  Un atacante experimentado puede encontrar una manera de explotar esto.  Ten cuidado y atento. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF (falsificaci√≥n de solicitudes del lado del servidor) </h2><br>  Traducci√≥n literal: solicitudes falsas en el lado del servidor.  Es decir, un ataque que le permite manipular los datos que env√≠a a la aplicaci√≥n, lo que le obliga a realizar la solicitud no a donde la l√≥gica de negocios originalmente se plane√≥. <br>  El funcionamiento de <i>SSRF se</i> muestra en la imagen a continuaci√≥n: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  Hay un atacante, est√° su servidor, que est√° cerrado por el <i>cortafuegos</i> , pero al mismo tiempo hay una funcionalidad que le permite realizar solicitudes en nombre del servidor. <br>  Si esta funcionalidad no est√° debidamente protegida y / o de manera incorrecta, como suele suceder :), procesa los datos entrantes, el atacante puede recurrir a <i>Memcached</i> , <i>Redis</i> u obtener acceso a los recursos internos de la v√≠ctima. <br><br>  Para un ejemplo m√°s ilustrativo, considere el soporte que SEMrush utiliza para la capacitaci√≥n interna de los empleados. <br>  Es importante prestar atenci√≥n al significado de la " <i>URL de Avatar</i> ": <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  Aqu√≠ prestamos atenci√≥n a 2 puntos: <br><ul><li>  URL del avatar en s√≠ </li><li>  y la capacidad de descargarlo usando un archivo. </li></ul><br>  Tenga en cuenta que el campo " <i>Avatar URL</i> " es un campo de texto para la entrada, lo que significa que podemos manipular este valor.  Intentemos poner el avatar, quiz√°s, la imagen m√°s famosa en Internet: Googlebot de la p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">error 404</a> . <br>  Hazlo una vez: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  Haga dos veces, haga clic en " <i>Guardar</i> ".  Tenemos un robot en lugar de mi foto: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  Aqu√≠ vale la pena prestar atenci√≥n al hecho de que el valor de la " <i>URL del avatar</i> " ha cambiado, a alguna ruta local; aparentemente, la aplicaci√≥n solicit√≥ una imagen, la guard√≥ en el servidor y sustituy√≥ un nuevo valor. <br><br>  Seguimos adelante.  En el campo " <i>Avatar de URL</i> ", ingrese el <i>archivo de</i> valor <i>: /// etc / passwd</i> .  Este dise√±o le permite acceder a la estructura del archivo.  En algunas bibliotecas que sol√≠an trabajar con <i>HTTP</i> , de manera predeterminada, el trabajo con la estructura de archivos est√° activado y recibe datos de los servidores en los que se iniciaron: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  ¬øQu√© sucede despu√©s de hacer clic en el bot√≥n " <i>Guardar</i> "? .. <br>  En primer lugar, la imagen se convirti√≥ en " <i>murci√©lago</i> ", y en segundo lugar, la ruta del archivo cambi√≥. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  Si intentamos solicitar esta imagen en el navegador, no nos mostrar√°n nada (el archivo est√° " <i>roto</i> ").  Pero no somos el primer d√≠a en seguridad de la informaci√≥n, sabemos qu√© hacer :) Mediante simples manipulaciones obtenemos el contenido del archivo en nuestra computadora: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  Por lo tanto, con la ayuda de esta vulnerabilidad, yo, como atacante, puedo obtener todos los c√≥digos fuente de su servicio y otros datos disponibles para leer al usuario que ejecuta el servicio web. <br>  Veamos los peligros de la SSRF: <br><ul><li>  Escaneo de puertos.  Para una red externa, su servicio es un punto de entrada y 2 puertos (http y https).  Al escanear puertos desde el interior de su infraestructura, un atacante puede detectar puertos abiertos; </li><li>  Omitir la autenticaci√≥n basada en host.  Cual es el punto?  Es posible que dentro de su estructura haya servicios que est√©n disponibles solo para ciertos recursos (lea: Lista blanca de IP).  Por lo tanto, si su servidor vulnerable est√° en la lista blanca, obtiene acceso a los servicios que est√°n disponibles para √©l y, como resultado, puede manipularlos; </li><li>  Continuando con el desarrollo del ataque antes mencionado, puede continuar explotando los programas vulnerables que se ejecutan en la intranet o en el servidor local.  Muy a menudo hay situaciones en las que la infraestructura interna, inaccesible desde el exterior, est√° mal monitoreada (las versiones / parches de seguridad, etc. no siempre se actualizan).  Esto tambi√©n puede conducir a ataques y robo de datos; </li><li>  Lectura de datos locales.  Lo mostr√© arriba con un ejemplo.  Sus configuraciones se pueden leer y acceder, tokens y contrase√±as. </li></ul><br><br><h3>  ¬øD√≥nde buscar SSRF? </h3><br>  Esta no es una vulnerabilidad est√°ndar.  Se puede encontrar en diferentes, a menudo en los lugares m√°s inesperados.  En esta situaci√≥n, la t√©cnica "mira aqu√≠, pero quiz√°s ni siquiera mires aqu√≠" no funciona. <br>  Se√±ales de un posible <i>SSRF</i> : <br><ul><li>  <i>Webhook</i>  Si est√°n mal configurados, si Firewall est√° configurado incorrectamente en aquellos servidores desde los cuales Webhooks realiza solicitudes, se puede obtener una vulnerabilidad; </li><li>  <i>Conversi√≥n HTML</i>  Intente incrustar una construcci√≥n de <i>URL</i> <i>&lt;iframe&gt;</i> , <i>&lt;img&gt;</i> , <i>&lt;base&gt;</i> , <i>&lt;script&gt;</i> o <i>CSS</i> que apunte a un servicio interno; </li><li>  <i>Descargar archivos borrados</i> .  ¬øRecuerdas el ejemplo de avatar?  Cuando un usuario tiene la oportunidad de cargar datos por URL al servidor, esto conlleva grandes problemas.  Intente enviar la URL con el puerto y vea qu√© contenido se carga. </li></ul><br><br><h3>  ¬øC√≥mo buscar SSRF? </h3><br><ul><li>  Levante el servidor y ejecute <i>escucha</i> : <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  De esta manera, ver√° todas las solicitudes que llegan a su servidor en el puerto <i>8080</i> .  Por un lado, es un puerto desocupado por sus servidores web y, por otro lado, es un puerto que <i>Firewall</i> no filtra a menudo.  Se cree que se usa para el protocolo <i>http</i> y prohibirlo parece ser opcional; </li><li>  En la aplicaci√≥n en estudio, encuentre el par√°metro al que puede pasar la ruta para solicitar datos de nuestro host (a nuestro <i>oyente</i> ); </li><li>  Examine la salida <i>del enumerador</i> o la respuesta devuelta. </li></ul><br><br><h2>  XXE (entidad externa XML) </h2><br>  Comenzar√© la historia, como siempre con un ejemplo, para que quede m√°s claro: <br>  En el servicio SEMrush mencionado anteriormente, existe una herramienta que se ocupa del an√°lisis de contenido.  El usuario conduce en la URL de su sitio o de un sitio de la competencia y, antes de analizarlo, el servicio descarga este mismo contenido.  Mira c√≥mo sucede esto en el video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Para descargar, el servicio accede al sitio especificado y el rastreador descarga el archivo <i>sitemap.xml</i> .  Y este es el mismo <i>XML del</i> que estamos hablando en este bloque. <br>  En el video, podemos observar c√≥mo el sitio atacante agreg√≥ una definici√≥n de la entidad externa <i>XXE</i> a <i>sitemap.xml</i> , que apunta a " <i>file: /// etc / hosts</i> ".  En los sistemas Linux, este es un archivo que describe qu√© IP corresponde a los hosts si no hay registros <i>DNS</i> para ellos. <br>  A continuaci√≥n, el atacante indica en la <i>etiqueta &lt;loc&gt; la</i> expansi√≥n de esta variable.  Despu√©s de analizar el <i>XML,</i> despu√©s de procesar todo el <i>XML</i> en el compartimento, insertar√° el valor que estaba en " <i>archivo: /// etc / hosts</i> " en la variable de <i>ubicaci√≥n</i> (resaltada en rojo en el video). <br>  El atacante inicia el lanzamiento de nuestro analizador, va a los registros y aqu√≠ aparece una l√≠nea resaltada en blanco en el video.  Este es el contenido del archivo " <i>archivo: /// etc / hosts</i> " obtenido en la solicitud <i>GET</i> en los registros de un servidor controlado por √©l. <br>  Que sigue  El atacante verificar√° que ten√≠a raz√≥n.  Cambiar√° el nombre del archivo a " <i>file: /// etc / fstab</i> ", ejecutar√° el analizador nuevamente y obtendr√° estad√≠sticas sobre los procesos en ejecuci√≥n. <br><br>  Y finalmente: " <i>file: /// etc / hostname</i> ", inicie el analizador, vaya a los registros y obtenga el <i>nombre de host de la</i> m√°quina en la que estamos. <br>  Este es un error real descubierto por una persona real que no est√° relacionada con nuestra empresa.  Tuve que rociar ceniza en mi cabeza y pagar dinero :) <br><br>  Otro ejemplo de <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  Supongamos que tenemos un cierto <i>punto final</i> , se llama: <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">example.com/xxe</a></i> . <br>  Le enviamos la estructura <i>XML</i> ‚Üí en <i>XML</i> declaramos la entidad <i></i> ‚Üí la entidad <i> se</i> refiere al archivo del sistema <i>/ etc / passwd</i> y se abre m√°s en el cuerpo de la respuesta ‚Üí obtenemos el contenido de este archivo en respuesta. <br>  Vale la pena se√±alar que esto no ocurre tan a menudo como nos gustar√≠a. <br><br><h3>  Por que funciona </h3><br>  <i>Los</i> documentos <i>XML</i> son un formato de datos estructurados que, entre otras cosas, le permite describir los tipos de datos que pueden contener utilizando una etiqueta <i>DOCTYPE</i> especial. <br>  <i>Definici√≥n del tipo de datos (DTD)</i> : la definici√≥n de los tipos de datos dentro de este documento <i>XML</i> .  Hay tres opciones sobre c√≥mo se puede hacer esto: <br><ul><li>  Si el documento es compatible con <i>DTD</i> .  El siguiente ejemplo muestra algunos <i>XML</i> en los que hay una estructura de pedido, hay un elemento de <i>producto</i> y un elemento de <i>conteo</i> (presumiblemente: el n√∫mero de inventario del producto y el n√∫mero de art√≠culos en el pedido).  <i>El orden</i> es el padre de estos dos elementos: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li>  DTD externos en el servidor local. <br>  Hacemos lo mismo que en la primera realizaci√≥n, pero hacemos todas las definiciones en un archivo separado, que se encuentra en el servidor local: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li>  DTD externos en un servidor de terceros: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  Si es un lector atento, probablemente haya correlacionado el hecho de que la capacidad de hacer tales solicitudes en su servicio y solicitar esquemas de <i>DTD</i> externos es una vulnerabilidad en s√≠ misma, de lo que hablamos anteriormente, es decir, la vulnerabilidad <i>SSRF</i> . <br>  Una ocurrencia com√∫n: los desarrolladores corrigen la vulnerabilidad <i>XXE</i> , pero olvidan prohibir el procesamiento de <i>DTD</i> externos y obtener <i>SSRF</i> .  De esto no se derivar√°n consecuencias fatales, pero no debe olvidarse de ello. <br><br><h3>  ¬øQu√© son las entidades en XML? </h3><br>  <i>Entidades</i> en <i>XML</i> .  Que es esto  Esta es una oportunidad para definir ciertos valores y convertirlos en variables.  Las entidades tienen tres tipos diferentes: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>Predefinido</i> : predefinido.  De manera similar al c√≥digo <i>HTML</i> , es posible utilizar aquellos caracteres que forman parte de la sintaxis del lenguaje, como una estructura de texto.  Aqu√≠ se dan como ejemplo, para que entiendas de qu√© se trata.  S√≠, en la mayor√≠a de los ataques no se usan, pero pueden ser necesarios en algunos casos excepcionales. <br>  <i>General</i> y <i>Par√°metros</i> .  Este es uno y el mismo, solo cambia la sintaxis de su declaraci√≥n y c√≥mo pueden llamarse despu√©s de la declaraci√≥n <br><br><h3>  ¬øD√≥nde buscar <i>XXE</i> ? </h3><br>  Varias opciones: <br><ul><li>  Procesamiento de <i>XML</i> en cualquier manifestaci√≥n: <br><ul><li>  <i>SVG;</i> </li><li>  <i>mapa del sitio;</i> </li></ul></li><li>  Convierte <i>HTML</i> a otros formatos; </li><li>  Manejo de <i>docx</i> , <i>xlsx</i> y formatos similares. </li></ul><br><br><h3>  ¬øC√≥mo buscarlos? </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  La imagen muestra solo un ejemplo desde el cual comenzar.  No es una clave universal.  Debe optimizarse para los formatos que utiliza en el servicio en estudio. <br><br>  Lo primero que hacemos: declarar una determinada entidad <i>Z</i> , que accede al host controlado por el host atacante, lo expande dentro del cuerpo del documento <i>XML</i> . <br>  Aqu√≠ la segunda opci√≥n es posible: solo la esencia del <i>par√°metro</i> .  Difiere del primer anuncio (signo de <i>%</i> ).  Y para volver a esta esencia, el cuerpo del documento ya no es necesario.  Podemos acceder a √©l directamente en la estructura <i>DOCTYPE</i> y exponer esta entidad: <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  El tercer escenario es ver si la capacidad de solicitar <i>DOCTYPE</i> de servicios externos est√° activada o desactivada: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  A continuaci√≥n, observamos la salida de un servidor controlado por nosotros.  Si vemos una llamada a <i>URL</i> <i>/ verificaci√≥n</i> desde varias direcciones <i>IP</i> , significa que con un alto grado de probabilidad la vulnerabilidad ha pasado, y luego solo tenemos que descubrir c√≥mo obtener datos m√°s interesantes para nosotros. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  ¬øCu√°l es el peligro de <i>XXE</i> ?  Escribir√© brevemente y punto por punto: <br><ul><li>  Lectura de archivos locales; </li><li>  Acceso a recursos locales; </li><li>  Escaneo de puerto / host </li><li>  <i>Contenedores de texto sin formato</i> .  Esta es una oportunidad para acceder a sus servicios que operan en el protocolo de texto sin formato; </li><li>  <i>Ejecuci√≥n remota de c√≥digo</i> (no es frecuente).  Est√° desactivado por defecto; </li><li>  <i>DoS</i> .  Debido al hecho de que las entidades se pueden concatenar, es posible obtener f√°cilmente un aumento exponencial en la cantidad de memoria ocupada por estos par√°metros.  El resultado es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ataque de mil millones de risas</a> .  En otras palabras, simplemente est√° sobrecargando la memoria del servidor atacado. </li></ul><br>  En conclusi√≥n, dir√© que todo esto (el art√≠culo y cualquier conocimiento que haya adquirido) no tiene sentido sin una aplicaci√≥n pr√°ctica.  Por lo tanto, le preguntar√© acerca de una bagatela real: piense en la aplicaci√≥n que escribi√≥ / prob√≥ ayer e intente verificar si hay vulnerabilidades.  ¬øHay formularios de entrada o procesamiento <i>XML</i> ?  ¬øEsta aplicaci√≥n est√° protegida?  ¬øSe ha agregado el filtrado y la <i>DTD est√°</i> deshabilitada? <br>  Abra el manual de <i>SQLmap</i> y descubra c√≥mo verificar su aplicaci√≥n con √©l.  Si no encuentra nada, tome otra herramienta y exam√≠nela, y luego pruebe su aplicaci√≥n para detectar otras vulnerabilidades.  Como dije al principio, el art√≠culo examina solo algunas vulnerabilidades, pero <i>miles de ellas</i> . <br>  No creo que puedas escribir un c√≥digo absolutamente seguro.  Siempre hay vulnerabilidades, <i><u>todav√≠a no las ha encontrado</u></i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/441966/">https://habr.com/ru/post/441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../441952/index.html">Elegir un sistema de almacenamiento de archivos para trabajar en equipo</a></li>
<li><a href="../441954/index.html">Recompensa del usuario a los autores de Habr</a></li>
<li><a href="../441956/index.html">Manejo unificado de errores (opci√≥n C ++ para microcontroladores)</a></li>
<li><a href="../441962/index.html">√çndices en PostgreSQL - 1</a></li>
<li><a href="../441964/index.html">Consejos y trucos de Kubernetes: reubicar recursos del cl√∫ster en Helm 2</a></li>
<li><a href="../441968/index.html">Desarrollo de una nueva rama de producto: c√≥mo deshacerse de lo poco pr√°ctico y seguir siendo √∫til</a></li>
<li><a href="../441970/index.html">An√°lisis FinFisher Butkit</a></li>
<li><a href="../441972/index.html">Invidious - interfaz de YouTube alternativa</a></li>
<li><a href="../441974/index.html">El camino del historiador de RRHH a programadores Java: un poco de suerte y perseverancia</a></li>
<li><a href="../441976/index.html">Contigo FizTech.Science: buscamos par√°metros ocultos y nos sumergimos en el maravilloso mundo cu√°ntico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>