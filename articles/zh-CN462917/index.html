<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>♉️ 👼🏼 🔮 使用R进行网页抓取。比较Kinopoisk和IMDB上的电影收视率 🗓️ 😣 🌹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="万维网是数据的海洋。 在这里，您几乎可以看到您感兴趣的任何信息。 但是，从互联网“拉”该信息已经更加困难。 有几种获取数据的方法，网络抓取是其中一种。 


 什么是网页抓取？ 简而言之，它是一项允许您从HTML页面检索数据的技术。 使用抓取时，无需复制粘贴必要的信息或将其从屏幕传输到记事本。 信息...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>使用R进行网页抓取。比较Kinopoisk和IMDB上的电影收视率</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462917/"><p><img src="https://habrastorage.org/webt/tb/ng/o5/tbngo5ub1m2isuzbdmu38whx75a.jpeg" alt="图片"></p><br><p> 万维网是数据的海洋。 在这里，您几乎可以看到您感兴趣的任何信息。 但是，从互联网“拉”该信息已经更加困难。 有几种获取数据的方法，网络抓取是其中一种。 <a name="habracut"></a></p><br><p> 什么是网页抓取？ 简而言之，它是一项允许您从HTML页面检索数据的技术。 使用抓取时，无需复制粘贴必要的信息或将其从屏幕传输到记事本。 信息将以方便您的形式出现在您的计算机上。 </p><br><h2 id="web-scraping-na-primere-sayta-kinopoiskru"> 在网站Kinopoisk.ru的示例上进行网络爬网 </h2><br><p> 为自己设定目标是一个好主意，以免刮do。 我认为这将是<strong>Kinopoisk.ru和IMDB.com上电影收视率</strong>的<strong>比较，以及各类型电影的平均收视率</strong> 。 为了进行分析，拍摄了从2010年到2018年发行的电影，票数至少为500。 </p><br><p> 首先，加载我们需要的库： </p><br><pre><code class="plaintext hljs">#   library(rvest) library(selectr) library(xml2) library(jsonlite) library(tidyverse)</code> </pre> <br><p> 接下来，我得到一年中满足选择条件的电影数量（超过500票）。 这样做是为了找出包含数据的页面总数并“生成”指向它们的链接，因为 链接的结构相似。 </p><br><pre> <code class="plaintext hljs">#        2018  url &lt;- "https://www.kinopoisk.ru/top/navigator/m_act[year]/2018/m_act[rating]/1%3A/order/rating/page/1/#results"</code> </pre> <br><p><img src="https://habrastorage.org/webt/y7/xz/ef/y7xzeffxqz9uurscdhz_17aawns.png"></p><br><p> 我们的任务是“拉出”数字672，在图中用红色矩形突出显示。 为此，我们需要网页抓取。 </p><br><h4 id="web-scraping-stranicy-sayta-kinopoiskru-s-pomoschyu-paketa-rvest">  Kinopoisk.ru网站使用<code>rvest</code>软件包抓取网页 </h4><br><p> 首先，我们需要“读取”收到的URL。 为此，请使用<code>read_html()</code>包的<code>read_html()</code>函数。 </p><br><pre> <code class="plaintext hljs">#     XML  HTML  webpage &lt;- read_html(url)</code> </pre> <br><p> 然后，使用<code>rvest</code>软件包的功能<code>rvest</code>我们首先“提取” HTML文档中我们需要的部分（ <code>html_nodes()</code>函数），然后从这一部分中以对我们方便的形式提取我们所需的信息（ <code>html_text()</code> ， <code>html_table()</code>函数， <code>html_attr()</code>其他） </p><br><p> 但是，我们如何理解需要提取的元素呢？ 为此，我们必须将鼠标悬停在我们感兴趣的信息上，单击LMB并选择“查看代码”。 在我们的例子中，我们得到以下图片： </p><br><p><img src="https://habrastorage.org/webt/wn/vr/h4/wnvrh4sfkpo9xsjqqhbb0zwt8fy.png"></p><br><p>  <code>html_nodes()</code>函数的格式为<code>html_nodes(x, css)</code> 。  x是先前定义的网页，但是在CSS中，我们编写了id或element类。 在我们的例子中是： </p><br><pre> <code class="plaintext hljs">number_html &lt;- html_nodes(webpage, ".pagesFromTo")</code> </pre> <br><p> 另外，要“检测”所需的元素，可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">selectorGadget</a>扩展，它显示了我们需要明确输入的内容： </p><br><p><img src="https://habrastorage.org/webt/jh/fc/zx/jhfczxtfn3anfeapp4cbtwir0ay.png"></p><br><p> 接下来，使用html_text函数，从所选元素中提取文本部分： </p><br><pre> <code class="plaintext hljs">number &lt;- html_text(number_html) [1] "1—50  672" "1—50  672"</code> </pre> <br><p> 我们从Kinopoisk的HTML页面获得了所需的号码，但是现在我们需要“清除”它。 这是刮擦的标准过程，因为很少需要我们需要的形式的元素。 </p><br><p> 由于影片的总数在页面的顶部和底部显示，并且它们的css选择器完全相同，因此我们得到了2个相同的元素。 因此，对于初学者来说，我们删除了多余的元素： </p><br><pre> <code class="plaintext hljs">number &lt;- number[1] [1] "1—50  672"</code> </pre> <br><p> 接下来，我们需要去除向量中达到672的部分。您可以用不同的方法来完成此操作，但是所有方法的基础都是编写正则表达式。 在这种情况下，我用一个空格“替换”了“ 1-50 of”部分（可以使用<code>str_remove</code>代替<code>str_replace</code> ），然后删除多余的空格（ <code>str_trim</code>函数），最后将向量从字符转换为数字类型。 在输出中，我得到672。确实如此，2018年有很多电影在Kinopoisk上获得了500多个用户投票。 </p><br><pre> <code class="plaintext hljs">number &lt;- str_replace(number, ".{2,}", "") number &lt;- as.numeric(str_trim(number)) [1] 672</code> </pre> <br><p> 接下来我们要做什么？ 如果您浏览一下Kinopoisk上的页面，您会发现搜索页面的地址具有相同的结构，只是数量不同。 因此，为了避免每次都手动输入页面地址，我们将计算页面数并“生成”所需的地址数。 这样做是这样的： </p><br><pre> <code class="plaintext hljs">#   page_number &lt;- ceiling(number/50) #   page &lt;- sapply(seq(1:page_number), function(n){ list_page &lt;- paste0("https://www.kinopoisk.ru/top/navigator/m_act[year]/2018/m_act[rating]/1%3A/order/rating/page/", n, "/#results") })</code> </pre> <br><p> 输出是14个地址。 在此示例中， <code>ceiling</code>函数将数字四舍五入为BIG整数。 </p><br><p> 然后，我们将<code>lapply</code>函数用于页面地址的输入，该函数从Kinopoisk页面“提取”有关电影的名称，等级，票数和主要类型（最多3个）的信息。 功能代码可以在<a href="">Github</a>上的存储库中找到。 </p><br><p> 结果，我们得到了一张包含8111张电影的桌子。 </p><br><div class="scrollable-table"><table><thead><tr><th> 姓名 </th><th> 等级 </th><th> 投票 </th><th> 类型 </th><th> 年份 </th></tr></thead><tbody><tr><td> 夏洛克 </td><td>  8.884 </td><td>  235316 </td><td> 惊悚片，戏剧，犯罪 </td><td>  2010 </td></tr><tr><td> 奔跑的人 </td><td>  8.812 </td><td>  1917年 </td><td> 游戏，电视，喜剧 </td><td>  2010 </td></tr><tr><td> 伟大的战争 </td><td>  8.792 </td><td>  5690 </td><td> 纪录片，军事，历史 </td><td>  2010 </td></tr><tr><td> 发现宇宙如何运作 </td><td>  8.740 </td><td>  3033 </td><td> 纪录片 </td><td>  2010 </td></tr><tr><td> 开始 </td><td>  8.664 </td><td>  533715 </td><td> 小说，动作，惊悚片 </td><td>  2010 </td></tr><tr><td> 斯蒂芬·霍金发现宇宙 </td><td>  8.520 </td><td>  4373 </td><td> 纪录片 </td><td>  2010 </td></tr></tbody></table></div><br><p> 值得注意的是Sys.sleep函数的使用。 使用它，您可以设置表达式之间的延迟时间。 为什么需要这个？ 如果您希望在一年内收到信息，则没有必要。 但是，如果您对大量的电影/年感兴趣，那么在经过一定数量的请求后，Kinopoisk会认为您是机器人，并且您会收到一份空白列表。 为避免这种情况，您必须输入延迟时间。 </p><br><p> 同样， <a href="">“废弃”</a>网站IMDB.com。 </p><br><h4 id="analiz-poluchennyh-dannyh"> 资料分析 </h4><br><p> 我们有两个表格，一个关于IMDB电影的信息，另一个来自Kinopoisk。 现在我们需要将它们结合起来。 我们将根据“名称”和“年份”列进行合并。 为了减少名称中出现的差异，即使在抓取阶段，我也删除了所有标点符号，并将字母转换为小写。 结果，在所有连接和删除之后，我们从两个站点都获得了3450部具有我们所需信息的电影。 </p><br><p> 我对两个站点上电影的收视率差异感兴趣，因此我们将创建DELTA变量，这是IMDB和Kinopoisk估算值之间的差异。 如果DELTA为正，则IMDB分数较高；如果为负，则较低。 </p><br><p> 首先，为DELTA指标构建直方图： <br><img src="https://habrastorage.org/webt/-c/xc/nk/-cxcnkbrmizksvf2wvuvbf3hub8.jpeg"><br> 图表上没有什么奇怪的。 收视率的差异具有正态分布，并且在零附近出现峰值，这表明这两个站点的用户通常会同意电影的收视率。 </p><br><p> 收敛，但不完全一致。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">通过</a>两个独立样本<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">的t检验，</a>我们可以说，对Kinopoisk的评分较高，并且该差异具有统计学意义（p值&lt;0.05）。 <br><img src="https://habrastorage.org/webt/vp/rj/fx/vprjfxr7f_dczpyl3dgcdcxfx2m.png"><br> 尽管差异很大，但差异很小。 </p><br><p> 接下来，让我们看看评分的差异如何取决于票数。 <br><img src="https://habrastorage.org/webt/8e/b0/d4/8eb0d4-dant3xvwu7fojrvjvqqi.jpeg"><br> 这里也没有什么意外的。 票数很高的电影通常收视率差异很小。 </p><br><p> 现在让我们继续按类型评估电影。 值得一提的是，一部电影最多可以有三种类型，但只有一部级别，因此一部电影可以“进入考验”，喜剧和情节剧。 </p><br><p> 让我们从Kinopoisk开始。 在数据库中至少有150种露面的流派中，恐怖是明显的局外人。 低用户也对恐怖片，动作侦探以及科幻小说感到惊讶。 另一方面，Kinopoisk上的情节剧电影表现出色，平均收视率高于6.5，仅次于卡通片和传记片，后者在数据库中要小得多 </p><br><p><img src="https://habrastorage.org/webt/xm/vw/gs/xmvwgstrl970cowgtnab72wrrpc.jpeg"></p><br><p> 现在考虑相同的图表，但适用于IMDB。 原则上，他再次确认两个站点之间的评级差异不明显。 这不足为奇，因为许多用户在两个站点上都有帐户，并且不太可能在不同站点上给出不同的评级。 同样，主要的失败者是恐怖，我们可以说他们是电影中收视率最低的类型。 我很难评估为什么会发生这种情况，因为我一生中唯一看过的恐怖电影是《格林姆斯》。 预算类别最低的可能是恐怖，廉价演员的疲软行为和坦率的坏场景来自哪里。 拥有科幻小说和IMDB惊悚片的人落后了，但激进分子的表现更好。 领导人中又有传记电影和卡通片。 该剧名列第三，但情节剧的得分低于6.5，达到了冒险电影的水平。 同样在IMDB下面的喜剧中。 </p><br><p><img src="https://habrastorage.org/webt/k8/09/u2/k809u2sbxwiw61i284wh6pxipci.jpeg"></p><br><h4 id="zaklyuchenie-i-nemnogo-o-vneshnih-faktorah"> 结论和有关“外部因素”的一些知识 </h4><br><p> 尽管收视率有所不同（在Kinopoisk上，收视率略高），但还是有点。 根据各种流派，巨大的差异也是不可察觉的。 拥有数十甚至数十万张选票的大片，如果有分歧，则在0.5分之内。 </p><br><p> 票数少（尤其是在“怪胎”上）的电影，票数最多不超过一万，通常在收视率上会有很大差异。 但是，对IMDB的评级最大的不同是该电影在国外网站获得30,000票，在Kinopoisk上获得超过90,000票。 这是Alexei Pimanov“ Crimea”的创作。 这部电影受到外国观众的喜爱吗？ 几乎没有 电影制作人很可能对IMDB使用与Kinopoisk中相同的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“营销政策”</a> 。 只是如果Kinopoisk“清理”了这种估算，那么它们仍保留在IMDB中。 我认为这就是为什么“克里米亚”是“好小金奇克”的原因。 </p><br><p>  <em>如果有任何意见，建议和投诉，我将不胜感激</em> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Github</a>仓库链接 <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">我的社交圈</a>个人资料 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN462917/">https://habr.com/ru/post/zh-CN462917/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN462905/index.html">使用Telebot库第2部分在Python中编写电报Bot</a></li>
<li><a href="../zh-CN462907/index.html">ngFanatic每周</a></li>
<li><a href="../zh-CN462909/index.html">ASIC进化的成果：关于制造商，SHA-256的矿工以及天文哈希率的怪异</a></li>
<li><a href="../zh-CN462911/index.html">电动汽车落后一年</a></li>
<li><a href="../zh-CN462915/index.html">通过Cinebench R20看到的性能AMD EPYC 7452</a></li>
<li><a href="../zh-CN462919/index.html">产品经理与项目经理：如何避免混乱？</a></li>
<li><a href="../zh-CN462923/index.html">进入航空网第3集：找到球</a></li>
<li><a href="../zh-CN462929/index.html">我看到你了：蝙蝠的掩盖战术</a></li>
<li><a href="../zh-CN462933/index.html">Internet阻止的工作原理：以实际示例回顾现代方法</a></li>
<li><a href="../zh-CN462935/index.html">在开放式办公室工作时如何保持专注？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>