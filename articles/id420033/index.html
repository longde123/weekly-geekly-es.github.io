<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘â€ğŸ—¨ ğŸ´â€â˜ ï¸ ğŸ‘¨â€ğŸš€ Bagaimana kami mulai mendaftarkan mesin kasir untuk pelanggan kami âœŠğŸ» ğŸ‘¨ğŸ»â€âœˆï¸ ğŸ¼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Menurut amandemen 54-, sejak Juli tahun ini, hampir semua perusahaan dagang wajib menggunakan meja kas online yang mengirimkan data melalui Internet k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana kami mulai mendaftarkan mesin kasir untuk pelanggan kami</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tinkoff/blog/420033/">  Menurut amandemen 54-, sejak Juli tahun ini, hampir semua perusahaan dagang wajib menggunakan meja kas online yang mengirimkan data melalui Internet ke layanan pajak.  Untuk mendapatkan peralatan seperti itu, Anda harus membeli meja kas dan drive fiskal, menandatangani perjanjian, dan membayar layanan operator data fiskal, mendaftar di dua kantor pribadi Layanan Pajak Federal dan OFD, memasukkan rinciannya ke kasir, dan menerima laporan pendaftaran kertas.  Nah, Anda juga akan memerlukan tanda tangan digital elektronik, jika tidak, Anda harus datang ke Layanan Pajak Federal dan secara pribadi mengantre. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a9/fb3/9b6/3a9fb39b680344c3f892804eb41b1a11.png"><br><br>  Kami memutuskan untuk menyelamatkan pelanggan kami dari semua kengerian ini dengan membuat layanan yang mendaftarkan semuanya secara otomatis hampir dalam satu klik.  Kami akan membicarakan ini sekarang. <br><a name="habracut"></a><br><h2>  Mengapa kita membutuhkannya? </h2><br>  Anda sudah menyadari bahwa mendaftarkan kantor tiket adalah pencarian multi-tahap yang membosankan, tetapi ini bukan satu-satunya masalah.  Pada setiap tahap, kebun binatang sedang menunggu antarmuka, yang bentuknya harus diisi secara manual dengan data pendaftaran untuk setiap kantor tiket, serta set lengkap bug yang relevan (salam terpisah dengan persyaratan pajak untuk menggunakan browser IE, Yandex.Browser atau Sputnik).  Ratusan peluang untuk melakukan kesalahan, merusak prosedur dan memulai dari awal.  Dan jika Anda mengatur 5-10 register kas, kemungkinan kesalahan saat memasukkan rincian yang sama meningkat pada waktu-waktu tertentu.  Belum lagi pemborosan waktu yang tidak produktif dan mencari tahu mengapa kantor pajak pribadi menolak untuk menerima token, yang benar-benar "tertelan" baru kemarin. <br><br><img src="https://habrastorage.org/webt/cz/bk/qn/czbkqnhvog24qqgwodhckwfyhew.png"><br><br>  Dan ketika kami merasakan beban terberat dari tragedi di atas, kami memutuskan untuk mengambil perkembangan. <br><br><h2>  Langkah Pendaftaran </h2><br>  Beberapa pihak terlibat dalam mendaftarkan mesin kasir sekaligus.  Ini adalah layanan pajak (FTS), OFD - operator data fiskal yang melaluinya register kas berinteraksi dengan otoritas pajak, pusat sertifikasi yang menerbitkan tanda tangan elektronik dan, sebagai suatu peraturan, seorang pengusaha kecil yang bingung hilang dalam pergolakan birokrasi.  Kami ingin campur tangan dalam hubungan mereka, untuk mengambil semua kesulitan pada diri kita sendiri. <br><br>  Secara kondisional, prosedur ini dibagi menjadi dua tahap: <br><br>  Registrasi meja kas - data perangkat tertentu dikirim ke Layanan Pajak Federal, dan nomor registrasi datang sebagai tanggapan. <br><br>  Fiskalisasi - aktivasi kasir menggunakan nomor registrasi kendaraan yang ditugaskan oleh Layanan Pajak Federal. <br><br>  Pertama-tama, kami pergi ke mitra kami untuk mengerjakan tahap pertama bersama mereka. <br><br><h2>  API untuk Layanan Pajak Federal </h2><br>  Kami bukan yang pertama berpikir tentang otomasi pendaftaran.  Banyak yang mengatakan bahwa mereka melakukan sesuatu di bidang ini, pengembangan sedang berlangsung, tetapi tidak ada yang memiliki antarmuka eksternal yang sudah jadi.  Salah satu operator data fiskal disediakan oleh API - hampir siap untuk berinteraksi dengan pajak. <br><br>  Saat itu, hanya sekitar 80 aplikasi uji yang dikirim menggunakan protokol.  Kami percaya bahwa segera antarmuka akan bekerja pada kapasitas penuh, dan mulai implementasi dan pengujian pada "rintisan". <br><br>  Pergi ke prod, kami menyadari bahwa tes kami dan aplikasi nyata berbeda, seperti siang dan malam.  "Rintisan bertopik" yang kami terima dari OFD hanya menyertakan tiruan sukses, dan mereproduksi skrip yang sukses.  Sebenarnya, mencapai "kesuksesan" itu tidak mudah. <br><br>  Hit termasuk: aplikasi di sisi mitra yang tidak diproses selama beberapa hari, kurangnya umpan balik dari Layanan Pajak Federal dan OFD, kesalahan tanda tangan dan "kesalahan tidak dikenal" favorit kami.  Protokol FTS ternyata tidak terdokumentasi dengan baik dan, seringkali, merespons dengan kegagalan yang tidak ditentukan, yang tidak jelas penyebabnya.  Spesifikasi yang jelas masih belum ada.  Jadi pertama kali kami menguji protokol, dan, bersama dengan OFD, kami membuat keputusan tentang bagaimana menanggapi tanggapan tertentu dari Layanan Pajak Federal dalam kasus-kasus tertentu. <br><br><h2>  API Kasir </h2><br>  Sementara bagian dari tim mempelajari perilaku sistem Layanan Pajak Federal dalam praktiknya, pekerjaan itu tidak berhenti.  Secara paralel, kami mengatur negosiasi dengan produsen mesin kasir, mengundang mereka untuk bertukar data dari kami ke platform mereka, dari platform ke mesin kasir dan dalam urutan terbalik untuk mengatur fiskal otomatis register kasir. <br><br>  Kami memilih sepasang solusi one-piece universal.  Meja kas Evotor dengan layar sentuh dan DreamCas diperuntukkan bagi para pelanggan yang terbiasa dengan tombol-tombol lama yang bagus dan menganggap fungsi tambahan itu berlebihan.  Modelnya berbeda: dengan dan tanpa pemindai. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ro/r7/dc/ror7dcretvhsilz3yiw12judrxi.png"></div><br>  Jika OFD memiliki API sendiri siap, maka untuk kontraktor mesin kasir itu harus dikembangkan dari awal.  Kalau tidak, mustahil untuk membuat semua data pendaftaran datang ke mesin kasir secara otomatis, tanpa entri manual. <br><br>  Kolega berhasil dengan mengatur interaksi melalui platform mereka, dan segera siap: API untuk membuka akun pribadi klien dan protokol kepemilikan untuk mengelola kasir. <br><br><img src="https://habrastorage.org/webt/wy/5h/hr/wy5hhrv-agl7qmya0x9pnpbppde.png"><br><br>  Pemasok kami adalah yang pertama mengatur pengiriman informasi pendaftaran secara otomatis ke kantor tiket.  Dan segera API akan membuatnya mudah untuk deregister dan mendaftar ulang register kas. <br><br>  Sekarang, ketika kita bernegosiasi dengan vendor uang lain, justru dukungan dari antarmuka ini yang menjadi salah satu persyaratan utama. <br><br><h2>  Anatomi Pendaftaran Otomatis </h2><br>  Setelah kami mempelajari cara bekerja dengan Layanan Pajak Federal dan mengimplementasikan API dengan vendor untuk mentransfer data registrasi ke kasir, tiba saatnya untuk menghubungkan semua ini ke dalam satu sistem dan membuat prosedur registrasi. <br><br>  Ini adalah tugas untuk memilih arsitektur yang tepat, yang akan memungkinkan kita untuk mengontrol pendaftaran kasir asinkron dalam OFD, baik dengan Layanan Pajak Federal dan vendor.  Karena mereka menanggapi permintaan dengan penundaan, prosesnya memakan waktu dan memiliki banyak integrasi dengan sistem eksternal.  Karena itu, kami harus menulis dua aplikasi di Java. <br><br>  Layanan pekerjaan berkomunikasi langsung dengan CRF dan sistem pabrikan mesin kasir.  Misalnya, kami mengirim data pelanggan ke OFD dan berharap untuk menerima nomor registrasi sebagai tanggapan. <br><br>  Layanan pekerjaan memilih status pekerjaan pada interval tertentu.  Dia bertanya lagi dan bertanya lagi sampai hasilnya kembali.  Nomor registrasi disimpan, Ayub mentransfer aplikasi ke tahap berikutnya dan fiskalisasi dimulai. <br><br>  Jika pada awalnya kita dengan hati-hati memantau jalannya aplikasi dan secara manual mempelajari setiap kesalahan yang diberikan sistem, sekarang prosesnya otomatis. <br><br>  Kami segera menentukan penyebab kesalahan.  Dan jika terjadi masalah besar, sistem pemantauan telah dibuat yang mencatat anomali yang mengindikasikan kegagalan besar pada Layanan Pajak Federal atau OFD.  Klien, bagaimanapun, mengetahui tentang masalah-masalah dalam satu-satunya kasus: jika, dalam menanggapi permintaan, kami menerima pengurangan spesifik, penolakan yang beralasan untuk mendaftar. <br><br>  Aplikasi kedua, CashReg, adalah sistem pemrosesan di mana model status dipertahankan, disajikan dalam bentuk relasional. <br><br>  Ini dikembangkan berdasarkan API yang disediakan oleh vendor dan CRF, dan mencakup semua kemungkinan transisi untuk setiap kelas yang berpartisipasi dalam proses pendaftaran.  Model status menghindari kesalahan internal dan menghilangkan penyimpangan dari algoritma pemrosesan aplikasi standar. <br><br>  Jadi, jika aplikasi telah dalam status yang sama terlalu lama, misalnya, ia tidak menerima nomor pendaftaran selama beberapa jam, atau CRF merespons dengan tahap atau status aplikasi yang salah, CashReg akan melaporkan kesalahan. <br><br>  Tentu saja, admin diperlukan untuk mengelola prosedur.  Kelompok pendukung keputusan perdagangan bekerja dengannya, melayani dan menyertai register kas selama pendaftaran.  Sekarang hanya dua karyawan yang terlibat dalam hal ini, tetapi antarmuka kerjanya tidak rumit, dan proses persiapan meja kas, berkat penolakan entri data manual, sederhana.  Jadi, kita dapat dengan cepat dan mudah menskala departemen. <br><br>  Ketiga komponen sistem pendaftaran tidak menyiratkan beban tinggi, karena mereka ditempatkan di lingkungan virtual. <br><br><h2>  Bagaimana proses pengerjaan aplikasi </h2><br>  Semua ini diperlukan agar klien, meninggalkan permintaan di akun pribadinya, beberapa hari kemudian meletakkan meja kas yang diaktifkan siap untuk bekerja di belakang meja. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f14/777/abe/f14777abe2e59529a31a321dcfbe01ca.png"></div><br>  Dari sudut pandang dapur domestik, keajaiban registrasi otomatis terlihat sedikit lebih rumit.  Meninggalkan aplikasi di akun pribadi Anda, klien memberi kami izin hukum untuk mengeluarkan tanda tangan elektronik dan menjalani seluruh prosedur atas namanya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36e/5ef/ccb/36e5efccba0427be9fef8324a50323c3.png"></div><br>  Informasi tentang perusahaan, data registrasi untuk toko tertentu dan penandatangan (misalnya, kepada direktur umum) diekstraksi dari basis perbankan.  Mereka diperbarui dalam SPARK, melalui penilaian dan memasuki sistem master di box office. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ae4/749/b78/ae4749b7824fe74ebc8ddefb2d952955.png"></div><br>  Kemudian aplikasi dibentuk di CASHREG.  Ini ditampilkan sebagai tugas baru di panel admin seorang karyawan dari grup pendukung solusi perdagangan.  Dia melihat meja kas dan fiskal mana yang mendorong kebutuhan klien.  Karyawan tersebut menemukan perangkat yang diperlukan di gudang, memilih drive fiskal, barcode nomor seri mereka dan mengkonfirmasi aplikasi.  Jadi, ada perangkat khusus yang terpasang padanya, yang akan dikirim ke klien.  Pada titik ini, OFD menerima permintaan: "Formulir aplikasi untuk pendaftaran meja kas ini dan itu, untuk perusahaan ini dan itu." <br><br>  File yang dikirim oleh OFD sebagai tanggapan diautentikasi oleh tanda tangan elektronik dan, menggunakan API OFD, dikirim ke otoritas pajak.  Di sana kasir diberi nomor pendaftaran. <br><br>  Sekarang paket lengkap dokumen di meja kas sampai ke pabrik mesin kasir (ya, mereka juga terlibat di sini).  Pada saat yang sama, tugas muncul di panel admin - untuk memfitalisasi kasir yang sama.  Ini berarti bahwa karyawan hanya memasukkan kasir.  Sistem vendor "melihat" bahwa perangkat tersebut bersentuhan dan memuat semua data pendaftaran yang diperlukan ke dalam memori secara otomatis.  Kesalahan dengan entri manual dikecualikan, detail yang sama pergi ke Layanan Pajak Federal dan kasir. <br><br>  Kasir mencetak laporan pendaftaran - sesuatu yang semuanya dimulai.  Data fiskal dari laporan: tanggal cetak, tanda tangan, tanda fiskal, berfungsi sebagai konfirmasi bahwa meja kas siap untuk bekerja.  Rincian ini dikirim lagi ke OFD. <br><br>  Segera setelah OFD membuat laporan pendaftaran, kami menandatanganinya untuk klien, dan box office pergi dengan kurir. <br><br><img src="https://habrastorage.org/webt/dc/cs/et/dccsetgp8qnjvcijl84ra3n6vu0.png"><br><br>  OFD belum menyiapkan kartu pendaftaran, tetapi Anda tidak bisa menunggu.  Ini akan tersedia dalam bentuk elektronik di akun pribadi klien dalam dua hingga tiga hari. <br><br><h2>  Kesimpulan </h2><br>  Untuk melaksanakan proyek ini, sekitar dua puluh karyawan dari seluruh bank dan banyak lagi spesialis dari mitra kami, DFD dan vendor uang teralihkan dari tugas-tugas mereka yang biasa, tetapi upaya mereka tidak sia-sia. <br><br>  Waktu rata-rata untuk mendapatkan nomor pendaftaran, dengan pengecualian untuk kasus yang paling negatif, adalah tiga jam.  Secara umum, seluruh prosedur memakan waktu 5 hingga 6 jam.  90% pendaftaran berhasil.  Saat ini, sekitar 1.000 aplikasi telah diproses. <br><br>  Secara umum, seperti yang Anda pahami, di perusahaan kami, kami menyukai kasus seperti itu, yang dapat sangat menyederhanakan kehidupan sejumlah besar orang.  Memecahkan masalah seperti itu, Anda merasa sedang melakukan sesuatu yang benar-benar bermanfaat. <br><br>  PS Jika Anda tertarik, Anda dapat membaca bagaimana kami sendiri <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mencuci ATM kami</a> .  Apalagi bersama dengan protokol pertukaran data. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420033/">https://habr.com/ru/post/id420033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420021/index.html">Mengapa Anda perlu Splunk? Internet Benda dan Data Industri</a></li>
<li><a href="../id420023/index.html">Menyimpan status di aplikasi android</a></li>
<li><a href="../id420025/index.html">Pertanian cerdas. Akan seperti apa dia?</a></li>
<li><a href="../id420029/index.html">Bagaimana kita di 1C: Perusahaan memecahkan sistem persamaan aljabar</a></li>
<li><a href="../id420031/index.html">Menggambar dengan Target Render di Mesin Unreal</a></li>
<li><a href="../id420035/index.html">GUI Golang: GTK + 3</a></li>
<li><a href="../id420037/index.html">Streaming dengan beberapa kamera dari bahan improvisasi</a></li>
<li><a href="../id420039/index.html">Pemikiran fungsional. Bagian 2</a></li>
<li><a href="../id420041/index.html">Perang TypeScript atau Enum Conquest</a></li>
<li><a href="../id420045/index.html">Bunker untuk tanggal: bagaimana saya diizinkan berjalan di sekitar pusat data RUVDS di wilayah pabrik luar angkasa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>