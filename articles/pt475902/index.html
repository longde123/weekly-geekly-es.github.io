<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂ ‚õπüèΩ üë©üèª‚ÄçüöÄ Workflow Core - um mecanismo de processo de neg√≥cios para .Net Core üë©‚Äçüëß‚Äçüëß üëÜüèΩ ‚öúÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 


 Decidimos apoiar o tema da migra√ß√£o do projeto usando a Windows Workflow Foundation para .Net Core , iniciada por colegas da DIRECTUM...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Workflow Core - um mecanismo de processo de neg√≥cios para .Net Core</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/avanpost/blog/475902/"><p><img src="https://habrastorage.org/webt/hp/ll/of/hpllof4hjsvcpfxbkl_q-epwfew.jpeg" alt="imagem"></p><br><p>  Ol√° pessoal! </p><br><p>  Decidimos apoiar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tema da migra√ß√£o do projeto usando a Windows Workflow Foundation para .Net Core</a> , iniciada por colegas da DIRECTUM, porque enfrentamos um problema semelhante h√° alguns anos e seguimos o nosso caminho. </p><a name="habracut"></a><br><h2>  Vamos come√ßar com a hist√≥ria </h2><br><p>  Nosso principal produto, o Avanpost IDM, √© um sistema de gerenciamento de ciclo de vida da conta e acesso aos funcion√°rios.  Ele sabe como gerenciar o acesso automaticamente, com base no modelo e de acordo com as solicita√ß√µes.  No in√≠cio da forma√ß√£o do produto, t√≠nhamos um sistema de autoatendimento bastante simples, com um fluxo de trabalho passo a passo simples, para o qual o mecanismo n√£o era necess√°rio em princ√≠pio. </p><br><p><img src="https://habrastorage.org/webt/hl/uo/c1/hluoc1imf_ejbdyzynpumdefmaa.png" alt="imagem"></p><br><p>  No entanto, quando confrontados com grandes clientes, percebemos que era necess√°ria uma ferramenta muito mais flex√≠vel, pois seus requisitos para os processos de coordena√ß√£o de direitos de acesso buscavam as regras de um bom e pesado fluxo de trabalho.  Ap√≥s analisar os requisitos, decidimos desenvolver nosso pr√≥prio editor de processos no formato BPMN, adequado para nossas necessidades.  Falaremos sobre o desenvolvimento do editor usando React.js + SVG um pouco mais tarde e hoje discutiremos o t√≥pico de back-end - o <strong>mecanismo de fluxo de trabalho</strong> ou mecanismo de processo de neg√≥cios. </p><br><h2>  Exig√™ncias </h2><br><p>  No in√≠cio do desenvolvimento do sistema, t√≠nhamos os seguintes requisitos para o mecanismo: </p><br><ul><li>  Suporte para diagramas de processo, um formato compreens√≠vel, a capacidade de transmitir do nosso formato para o formato do mecanismo </li><li>  Armazenamento do estado do processo </li><li>  Suporte √† vers√£o de processo </li><li>  Suporte para execu√ß√£o paralela (ramifica√ß√µes) do processo </li><li>  Uma licen√ßa adequada para usar a solu√ß√£o em um produto comercial replicado </li><li>  Suporte para dimensionamento horizontal </li></ul><br><p>  Ap√≥s analisar o mercado (para 2014), decidimos por uma solu√ß√£o praticamente n√£o alternativa para .Net: Windows Workflow Foundation. </p><br><h2>  Windows Workflow Foundation (WWF) </h2><br><p>  WWF √© a tecnologia da Microsoft para definir, executar e gerenciar fluxos de trabalho. </p><br><p>  A base de sua l√≥gica √© um conjunto de cont√™ineres para a√ß√µes (atividades) e a capacidade de criar processos sequenciais a partir desses cont√™ineres.  O cont√™iner pode ser comum - uma certa etapa do processo em que a atividade √© realizada.  Pode ser um gerente - contendo a l√≥gica da ramifica√ß√£o. </p><br><p>  Voc√™ pode desenhar um processo diretamente no Visual Studio.  O diagrama de processo de neg√≥cios compilado √© armazenado em Haml, o que √© muito conveniente - o formato √© descrito, √© poss√≠vel criar um designer de processo auto-escrito.  Isso est√° por um lado.  Por outro lado, o Xaml n√£o √© o formato mais conveniente para armazenar uma descri√ß√£o - o esquema compilado para um processo mais ou menos real acaba sendo enorme, principalmente por causa da redund√¢ncia.  √â muito dif√≠cil de entender, mas voc√™ precisa entender. </p><br><p>  Mas se, mais cedo ou mais tarde, √© poss√≠vel compreender o zen com os esquemas e aprender a l√™-los, a falta de transpar√™ncia na opera√ß√£o do mecanismo em si aumenta o aborrecimento j√° durante a opera√ß√£o do sistema pelos usu√°rios.  Quando o erro prov√©m das entranhas de Wf, nem sempre √© poss√≠vel descobrir 100% qual foi exatamente o motivo da falha.  A fonte fechada e a relativa monstruosidade n√£o ajudam o caso.  Muitas vezes, as corre√ß√µes de erros eram devidas a sintomas. </p><br><p> Para ser justo, vale a pena esclarecer aqui que os problemas descritos acima, na maior parte, nos atormentaram devido √† forte personaliza√ß√£o sobre o Wf.  Um dos leitores dir√° com certeza que n√≥s mesmos criamos um monte de problemas e os resolvemos heroicamente.  Era necess√°rio fabricar um motor fabricado desde o in√≠cio.  Em geral, eles estar√£o certos. </p><br><p>  No final das contas, a solu√ß√£o funcionou de maneira est√°vel o suficiente e entrou em produ√ß√£o com sucesso.  Mas a transi√ß√£o de nossos produtos para o .Net Core nos for√ßou a abandonar o WWF e procurar outro mecanismo de processo de neg√≥cios, porque  Desde maio de 2019, o Windows Workflow Foundation n√£o foi migrado para o .Net Core.  Como est√°vamos procurando por um novo mecanismo - o t√≥pico de um artigo separado, mas no final decidimos pelo Workflow Core. </p><br><h2>  N√∫cleo do fluxo de trabalho </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Workflow Core</a> √© um mecanismo de processo de neg√≥cios gratuito.  √â desenvolvido sob a licen√ßa MIT, ou seja, pode ser usado com seguran√ßa no desenvolvimento comercial. </p><br><p>  √â feito ativamente por uma pessoa; v√°rias outras fazem periodicamente uma solicita√ß√£o de recebimento.  Existem portas para outras linguagens (Java, Python e v√°rias outras). </p><br><p>  O motor est√° posicionado como leve.  De fato, este √© apenas um host para execu√ß√£o sequencial de a√ß√µes agrupadas por qualquer regra de neg√≥cios. </p><br><p>  O projeto possui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o wiki</a> .  Infelizmente, ele n√£o descreve todos os recursos do mecanismo.  No entanto, ser√° imprudente exigir documenta√ß√£o completa - o projeto de c√≥digo-fonte aberto √© suportado por um entusiasta.  Portanto, o Wiki ser√° suficiente para come√ßar. </p><br><p>  Pronto para uso, h√° suporte para armazenar o status do processo no armazenamento externo (armazenamento de persist√™ncia).  Os fornecedores s√£o padr√£o para: </p><br><ul><li>  Mongodb </li><li>  SQL Server </li><li>  PostgreSQL </li><li>  Sqlite </li><li>  Amazon DynamoDB </li></ul><br><p>  Escreva o seu provedor n√£o √© um problema.  Tomamos as fontes de qualquer padr√£o e fazemos como um exemplo. </p><br><p>  O dimensionamento horizontal √© suportado, ou seja, voc√™ pode executar o mecanismo em v√°rios n√≥s de uma s√≥ vez, enquanto possui um ponto de armazenamento de estados do processo (um armazenamento de persist√™ncia).  Ao mesmo tempo, a fila de tarefas interna do mecanismo deve estar no armazenamento geral (rabbitMQ, como op√ß√£o).  Para excluir a execu√ß√£o de uma tarefa por v√°rios n√≥s, um gerenciador de bloqueios √© fornecido ao mesmo tempo.  Por analogia com provedores de armazenamento externo, h√° implementa√ß√µes padr√£o: </p><br><ul><li>  Concess√µes de armazenamento do Azure </li><li>  Redis </li><li>  AWS DynamoDB </li><li>  SQLServer (na fonte existe, mas nada √© dito na documenta√ß√£o) </li></ul><br><p>  Conhecer algo novo √© mais f√°cil come√ßar com um exemplo.  Ent√£o vamos l√°.  Descreverei a constru√ß√£o de um processo simples desde o in√≠cio, juntamente com uma explica√ß√£o.  Um exemplo pode parecer impossivelmente simples.  Eu concordo - √© simples.  O m√°ximo para come√ßar. </p><br><p>  Vamos l√° </p><br><h4>  Etapa </h4><br><p>  Uma etapa √© uma etapa do processo em que qualquer a√ß√£o √© executada.  Todo o processo √© constru√≠do a partir de uma sequ√™ncia de etapas.  Uma etapa pode executar muitas a√ß√µes, pode ser repetida, por exemplo, para algum evento externo.  H√° um conjunto de etapas que s√£o dotadas da l√≥gica "pronta para uso": </p><br><ul><li>  Waitfor </li><li>  Se </li><li>  Enquanto </li><li>  Foreach </li><li>  Atraso </li><li>  Paralela </li><li>  Hor√°rio </li><li>  Recorrente </li></ul><br><p>  Obviamente, em algumas primitivas incorporadas voc√™ n√£o suporta o processo.  Precisamos de etapas que concluam tarefas de neg√≥cios.  Portanto, por enquanto, coloque-os de lado e tome medidas com nossa pr√≥pria l√≥gica.  Para fazer isso, voc√™ precisa herdar da abstra√ß√£o <strong>StepBody</strong> . </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StepBody</span></span> : <span class="hljs-title"><span class="hljs-title">IStepBody</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  O m√©todo <strong>Run</strong> √© executado quando o processo entra em uma etapa.  √â necess√°rio colocar a l√≥gica necess√°ria nele. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">StepBody</span></span> : <span class="hljs-title"><span class="hljs-title">IStepBody</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre> <br><p>  As etapas suportam inje√ß√£o de depend√™ncia.  Para fazer isso, basta registr√°-los no mesmo cont√™iner que as depend√™ncias necess√°rias. </p><br><p>  Obviamente, o processo precisa de seu pr√≥prio contexto - um local onde resultados intermedi√°rios de execu√ß√£o podem ser adicionados.  O n√∫cleo Wf possui seu pr√≥prio contexto para a execu√ß√£o de um processo que armazena informa√ß√µes sobre seu estado atual.  Voc√™ pode acess√°-lo usando a vari√°vel de <strong>contexto</strong> do m√©todo <strong>Run</strong> ().  Al√©m do embutido, podemos usar nosso contexto. </p><br><p>  Analisaremos as maneiras de descrever e registrar o processo com mais detalhes abaixo, por enquanto, simplesmente definimos uma determinada classe - o contexto. </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ProcessContext</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Number1 {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Number2 {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> StepResult {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessContext</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Number1 = <span class="hljs-number"><span class="hljs-number">1</span></span>; Number2 = <span class="hljs-number"><span class="hljs-number">2</span></span>; } }</code> </pre> <br><p>  Nas vari√°veis <strong>Number</strong> , escrevemos n√∫meros;  na vari√°vel <strong>StepResult</strong> - o resultado da etapa. </p><br><p>  Decidimos sobre o contexto.  Voc√™ pode escrever sua pr√≥pria etapa: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomStep</span></span> : <span class="hljs-title"><span class="hljs-title">StepBody</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Ilogger _log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Input1 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Input2 { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Action { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomStep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ilogger log</span></span></span><span class="hljs-function">)</span></span> { _log = log; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span> { Result = ‚Äùnone‚Äù; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Action ==‚Äùsum‚Äù) { Result = Number1 + Number2; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Action ==‚Äùdif‚Äù){ Result = Number1 - Number2; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ExecutionResult.Next(); } }</code> </pre> <br><p>  A l√≥gica √© extremamente simples: dois n√∫meros e o nome da opera√ß√£o chegam √† entrada.  O resultado da opera√ß√£o √© gravado na vari√°vel de sa√≠da <strong>Result</strong> .  Se a opera√ß√£o n√£o estiver definida, o resultado ser√° <em>nenhum</em> . </p><br><p>  Decidimos sobre o contexto, h√° um passo com a l√≥gica que precisamos tamb√©m.  Agora precisamos registrar nosso processo no mecanismo. </p><br><h4>  Descri√ß√£o do processo.  Registro no mecanismo. </h4><br><p>  Existem duas maneiras de descrever um processo.  A primeira √© a descri√ß√£o no c√≥digo - o c√≥digo r√≠gido. </p><br><p>  O processo √© descrito atrav√©s da <strong>interface fluente</strong> .  √â necess√°rio herdar da interface <strong>IWorkflow &lt;T&gt;</strong> generalizada, em que T √© a classe de contexto do modelo.  No nosso caso, este √© um <strong>ProcessContext</strong> . </p><br><p>  √â assim: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleWorkflow</span></span> : <span class="hljs-title"><span class="hljs-title">IWorkflow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProcessContext</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWorkflowBuilder&lt;ProcessContext&gt; builder</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    } public string Id =&gt; "SomeWorkflow"; public int Version =&gt; 1; }</span></span></code> </pre> <br><p>  A descri√ß√£o em si estar√° dentro do m√©todo <strong>Build</strong> .  Os campos <strong>Id</strong> e <strong>Version</strong> tamb√©m s√£o obrigat√≥rios.  O n√∫cleo Wf suporta controle de vers√£o do processo - voc√™ pode registrar n vers√µes de processo com o mesmo identificador.  Isso √© conveniente quando voc√™ precisa atualizar um processo existente e, ao mesmo tempo, dar vida √†s tarefas existentes. </p><br><p>  N√≥s descrevemos um processo simples: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleWorkflow</span></span> : <span class="hljs-title"><span class="hljs-title">IWorkflow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProcessContext</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWorkflowBuilder&lt;ProcessContext&gt; builder</span></span></span><span class="hljs-function">)</span></span> { builder.StartWith&lt;CustomStep&gt;() .Input(step =&gt; step.Input1, data =&gt; data.Number1) .Input(step =&gt; step.Input2, data =&gt; data.Number2) .Input(step =&gt; step.Action, data =&gt; ‚Äúsum‚Äù) .Output(data =&gt; data.StepResult, step =&gt; step.Result) .EndWorkflow(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; <span class="hljs-string"><span class="hljs-string">"SomeWorkflow"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Version =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br><p>  Se traduzido para o idioma "humano", ser√° algo assim: o processo come√ßa com a etapa <strong>CustomStep</strong> .  O valor do campo da etapa <strong>Input1</strong> √© obtido do campo de contexto <strong>Number1</strong> , o valor do campo da etapa <strong>Input2</strong> √© obtido do campo de contexto <strong>Number2</strong> , o campo de <strong>a√ß√£o</strong> √© codificado permanentemente para o valor <strong>"sum"</strong> .  A sa√≠da do campo <strong>Resultado √©</strong> gravada no <strong>campo de</strong> contexto <strong>StepResult</strong> .  Complete o processo. </p><br><p>  Concordo, o c√≥digo acabou sendo muito leg√≠vel, √© bem poss√≠vel descobrir isso, mesmo sem conhecimento especial em C #. </p><br><p>  Adicione mais uma etapa ao nosso processo, que produzir√° o resultado da etapa anterior no log: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomStep</span></span> : <span class="hljs-title"><span class="hljs-title">StepBody</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Ilogger _log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TextToOutput { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomStep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ilogger log</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    _log = log; } public override ExecutionResult Run(IStepExecutionContext context) { _log.Debug(TextToOutput); return ExecutionResult.Next(); } }</span></span></code> </pre> <br><p>  E atualize o processo: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleWorkflow</span></span> : <span class="hljs-title"><span class="hljs-title">IWorkflow</span></span>&lt;<span class="hljs-title"><span class="hljs-title">ProcessContext</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Build</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IWorkflowBuilder&lt;ProcessContext&gt; builder</span></span></span><span class="hljs-function">)</span></span> { builder.StartWith&lt;CustomStep&gt;() .Input(step =&gt; step.Input1, data =&gt; data.Number1) .Input(step =&gt; step.Input2, data =&gt; data.Number2) .Input(step =&gt; step.Action, data =&gt; ‚Äúsum‚Äù) .Output(data =&gt; data.StepResult, step =&gt; step.Result) .Then&lt;OutputStep&gt;.Input(step =&gt; step.TextToOutput, data =&gt; data.StepResult) .EndWorkflow(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Id =&gt; <span class="hljs-string"><span class="hljs-string">"SomeWorkflow"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Version =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><p>  Agora, ap√≥s a etapa com a opera√ß√£o de adi√ß√£o, segue a etapa de sa√≠da do resultado no log.  Para a entrada, passamos a vari√°vel <strong>Result</strong> e context na qual o resultado da execu√ß√£o foi gravado na √∫ltima etapa.  Terei a liberdade de afirmar que essa descri√ß√£o por meio de um c√≥digo (hardcode) em sistemas reais seria de pouca utilidade.  A menos que para alguns processos do escrit√≥rio.  √â muito mais interessante poder armazenar o circuito separadamente.  No m√≠nimo, n√£o precisamos remontar o projeto toda vez que precisamos alterar algo no processo ou adicionar um novo.  O n√∫cleo Wf fornece esse recurso armazenando o esquema json.  Continuamos a expandir nosso exemplo. </p><br><h4>  Descri√ß√£o do processo Json </h4><br><p>  <i>Al√©m disso, n√£o fornecerei uma descri√ß√£o atrav√©s do c√≥digo.</i>  <i>Isso n√£o √© particularmente interessante e apenas inflar√° o artigo.</i> </p><br><p>  O n√∫cleo Wf suporta a descri√ß√£o do esquema em json.  Na minha opini√£o, json √© mais visual que o xaml (um bom t√≥pico para o holivar nos coment√°rios :)).  A estrutura do arquivo √© bastante simples: </p><br><pre> <code class="plaintext hljs">{ "Id": "SomeWorkflow", "Version": 1, "DataType": "App.ProcessContext, App", "Steps": [ { /*step1*/ }, { /*step2*/ } ] }</code> </pre> <br><p>  O campo <strong>DataType</strong> indica o nome completo da classe de contexto e o nome do assembly no qual est√° descrito.  <strong>Steps</strong> armazena uma cole√ß√£o de todas as etapas do processo.  Preencha o elemento <strong>Etapas</strong> : </p><br><pre> <code class="plaintext hljs">{ "Id": "SomeWorkflow", "Version": 1, "DataType": "App.ProcessContext, App", "Steps": [ { "Id": "Eval", "StepType": "App.CustomStep, App", "NextStepId": "Output", "Inputs": { "Input1": "data.Number1", "Input2": "data.Number2" }, "Outputs": { "StepResult": "step.Result" } }, { "Id": "Output", "StepType": "App.OutputStep, App", "Inputs": { "TextToOutput": "data.StepResult" } } ] }</code> </pre> <br><p>  Vamos dar uma olhada na estrutura da descri√ß√£o da etapa via json. </p><br><p>  Os campos <strong>Id</strong> e <strong>NextStepId</strong> armazenam o identificador desta etapa e um indicador de qual etapa pode ser a pr√≥xima.  Al√©m disso, a ordem dos elementos da cole√ß√£o n√£o √© importante. </p><br><p>  <strong>StepType √©</strong> semelhante ao campo <strong>DataType</strong> , cont√©m o nome completo da classe da etapa (um tipo que herda de <strong>StepBody</strong> e implementa a l√≥gica da etapa) e o nome do assembly.  Mais interessantes s√£o os objetos <strong>Entradas</strong> e <strong>Sa√≠das</strong> .  Eles s√£o definidos na forma de mapeamento. </p><br><p>  No caso de <strong>Entradas, o</strong> nome do elemento json √© o nome do campo de classe da nossa etapa;  o valor do elemento √© o nome do campo na classe, o contexto do processo. </p><br><p>  Para <strong>sa√≠das, pelo</strong> contr√°rio, o nome do elemento json √© o nome do campo na classe, o contexto do processo;  valor do elemento √© o nome do campo de classe da nossa etapa. </p><br><p>  Por que os campos de contexto s√£o especificados por meio de <em>dados. {Field_name}</em> e, no caso de <strong>Output</strong> , <em>etapa. {Field_name}</em> ?  Como o wf core, o valor do elemento √© executado como uma express√£o C # (a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">biblioteca Dynamic Expressions √©</a> usada).  Isso √© bastante √∫til, com sua ajuda voc√™ pode colocar alguma l√≥gica de neg√≥cios diretamente dentro do esquema, se, √© claro, o arquiteto aprovar essa desgra√ßa :). </p><br><p>  Diversificamos o esquema com primitivas padr√£o.  Adicione uma etapa <strong>If</strong> condicional e processando um evento externo. </p><br><h5>  Se </h5><br><p>  Primitivo <strong>Se</strong> .  Aqui come√ßam as dificuldades.  Se voc√™ est√° acostumado a bpmn e desenha processos nesta nota√ß√£o, encontrar√° uma configura√ß√£o f√°cil.  De acordo com a documenta√ß√£o, a etapa √© descrita da seguinte maneira: </p><br><pre> <code class="plaintext hljs">{ "Id": "IfStep", "StepType": "WorkflowCore.Primitives.If, WorkflowCore", "NextStepId": "nextStep", "Inputs": { "Condition": "&lt;&lt;expression to evaluate&gt;&gt;" }, "Do": [ [ { /*do1*/ }, { /*do2*/ } ] ] }</code> </pre> <br><p>  N√£o h√° sensa√ß√£o de que algo est√° errado aqui?  Eu tenho um  A entrada da etapa √© definida como <em>Condi√ß√£o</em> - express√£o.  Em seguida, definimos a lista de etapas dentro da matriz <strong>Do</strong> (a√ß√µes).  Ent√£o, onde est√° o ramo <strong>falso</strong> ?  Por que n√£o existe uma matriz Do para False?  Na verdade existe.  Entende-se que o ramo <strong>False</strong> √© simplesmente um passo adiante no processo, ou seja, seguindo o ponteiro em <strong>NextStepId</strong> .  No come√ßo, eu estava constantemente confuso por causa disso.  Ok, resolvi isso.  Embora n√£o.  Se as a√ß√µes do processo, no caso de <em>True,</em> precisarem ser colocadas dentro do <strong>Do</strong> , √© isso que ser√° o "belo" json.  E se houver estes <strong>Se</strong> fechado com uma d√∫zia?  Tudo vai para o lado.  Eles tamb√©m dizem que o esquema no xaml √© dif√≠cil de ler.  H√° um pequeno hack.  Apenas amplie o monitor.  Foi mencionado um pouco acima que a ordem das etapas na cole√ß√£o n√£o importa, a transi√ß√£o segue os sinais.  Pode ser usado.  Adicione mais uma etapa: </p><br><pre> <code class="plaintext hljs">{ "Id": "Jump", "StepType": "App.JumpStep, App", "NextStepId": "" }</code> </pre> <br><p>  Adivinha o que estou levando?  √â verdade que apresentamos uma etapa de servi√ßo, que em tr√¢nsito leva o processo a uma etapa no <strong>NextStepId</strong> . </p><br><p>  Atualize nosso esquema: </p><br><pre> <code class="plaintext hljs">{ "Id": "SomeWorkflow", "Version": 1, "DataType": "App.ProcessContext, App", "Steps": [ { "Id": "Eval", "StepType": "App.CustomStep, App", "NextStepId": "MyIfStep", "Inputs": { "Input1": "data.Number1", "Input2": "data.Number2" }, "Outputs": { "StepResult": "step.Result" } }, { "Id": "MyIfStep", "StepType": "WorkflowCore.Primitives.If, WorkflowCore", "NextStepId": "OutputEmptyResult", "Inputs": { "Condition": "!String.IsNullOrEmpty(data.StepResult)" }, "Do": [ [ { "Id": "Jump", "StepType": "App.JumpStep, App", "NextStepId": "Output" } ] ] }, { "Id": "Output", "StepType": "App.OutputStep, App", "Inputs": { "TextToOutput": "data.StepResult" } }, { "Id": "OutputEmptyResult", "StepType": "App.OutputStep, App", "Inputs": { "TextToOutput": "\"Empty result\"" } } ] }</code> </pre> <br><p>  A etapa <strong>If</strong> verifica se o resultado da etapa <strong>Eval</strong> est√° vazio.  Se n√£o estiver vazio, exibimos o resultado; se estiver vazio, a mensagem " <em>Resultado vazio</em> ".  A etapa <strong>Jump</strong> leva o processo para a etapa <strong>Output</strong> , que est√° fora da cole√ß√£o Do.  Assim, mantivemos a ‚Äúverticalidade‚Äù do esquema.  Al√©m disso, dessa maneira, √© poss√≠vel pular n etapas para tr√°s, ou seja,  para organizar um ciclo.  Existem primitivas internas para loops no n√∫cleo wf, mas elas nem sempre s√£o convenientes.  No bpmn, por exemplo, os loops s√£o organizados por meio de <strong>If</strong> . </p><br><p>  Use essa abordagem ou o padr√£o, depende de voc√™.  Para n√≥s, essa organiza√ß√£o era uma medida mais conveniente. </p><br><h5>  Waitfor </h5><br><p>  A primitiva <strong>WaitFor</strong> permite que o mundo externo influencie o processo quando ele j√° estiver em execu√ß√£o.  Por exemplo, se na fase do processo for necess√°ria a aprova√ß√£o do curso adicional por qualquer usu√°rio.  O processo permanecer√° na etapa <strong>WaitFor</strong> at√© receber um evento no qual est√° inscrito. </p><br><p>  Estrutura primitiva: </p><br><pre> <code class="plaintext hljs">{ "Id": "Wait", "StepType": "WorkflowCore.Primitives.WaitFor, WorkflowCore", "NextStepId": "NextStep", "CancelCondition": "If(cancel==true)", "Inputs": { "EventName": "\"UserAction\"", "EventKey": "\"DoSum\"", "EffectiveDate": "DateTime.Now" } }</code> </pre> <br><p>  Vou explicar um pouco os par√¢metros. </p><br><p>  <strong>CancelCondition</strong> - uma condi√ß√£o para interromper uma espera.  Fornece a capacidade de interromper a espera por um evento e seguir em frente no processo.  Por exemplo, se um processo estiver aguardando n eventos diferentes ao mesmo tempo (o n√∫cleo do wf suporta a execu√ß√£o paralela de etapas), n√£o √© necess√°rio aguardar a chegada de todos; nesse caso, o <strong>CancelCondition nos</strong> ajudar√°.  Adicionamos um sinalizador l√≥gico √†s vari√°veis ‚Äã‚Äãde contexto e, ao receber o evento, configuramos o sinalizador como <em>true</em> - todas <strong>as</strong> etapas de <strong>WaitFor</strong> foram conclu√≠das. </p><br><p>  <strong>EventName</strong> e <strong>EventKey</strong> - nome e chave do evento.  Os campos s√£o necess√°rios para distinguir eventos, isto √©, em um sistema real com um grande n√∫mero de processos de trabalho simult√¢neos.  para que o mecanismo entenda qual evento √© destinado a qual processo e qual etapa. </p><br><p>  <strong>EffectiveDate</strong> - um campo opcional que adiciona um registro de data e hora do evento.  Pode ser √∫til se voc√™ precisar publicar um evento "no futuro".  Para que seja publicado imediatamente, voc√™ pode deixar o par√¢metro em branco ou definir a hora atual. </p><br><p>  Em todos os casos, nem sempre √© conveniente dar um passo separado para processar rea√ß√µes externas; antes, mesmo que geralmente seja redundante.  Uma etapa extra pode ser evitada adicionando a expectativa de um evento externo e a l√≥gica de seu processamento √† etapa usual.  <strong>Complementamos a</strong> etapa <strong>CustomStep</strong> assinando um evento externo: </p><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CustomStep</span></span> : <span class="hljs-title"><span class="hljs-title">StepBody</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Ilogger _log; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> TextToOutput { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomStep</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Ilogger log</span></span></span><span class="hljs-function">)</span></span> { _log = log; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> ExecutionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Run</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IStepExecutionContext context</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//-  return ExecutionResult.WaitForEvent("eventName", "eventKey", DateTime.Now); } }</span></span></code> </pre> <br><p>  Usamos o m√©todo de extens√£o padr√£o <strong>WaitForEvent ()</strong> .  Ele aceita os par√¢metros mencionados anteriormente <strong>EventName</strong> , <strong>EventKey</strong> e <strong>EffectiveDate</strong> .  Depois de concluir a l√≥gica dessa etapa, o processo aguardar√° o evento descrito e novamente chamar√° o m√©todo <strong>Run ()</strong> no momento em que o evento for publicado no barramento do mecanismo.  No entanto, na forma atual, n√£o podemos distinguir entre os momentos da entrada inicial na etapa e a entrada ap√≥s o evento.  Mas, de alguma forma, gostaria de separar a l√≥gica antes e depois no n√≠vel da etapa.  E a bandeira <strong>EventPublished</strong> nos ajudar√° com isso.  Ele est√° localizado dentro do contexto geral do processo, voc√™ pode obt√™-lo assim: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ifEvent=context.ExecutionPointer.EventPublished;</code> </pre> <br><p>  Com base nesse sinalizador, voc√™ pode dividir com seguran√ßa a l√≥gica em antes e depois de um evento externo. </p><br><p>  Um esclarecimento importante - de acordo com a ideia do criador do mecanismo, uma etapa pode ser assinada apenas em um evento e reagir a ele uma vez.  Para algumas tarefas, essa √© uma limita√ß√£o muito desagrad√°vel.  N√≥s at√© tivemos que ‚Äúterminar‚Äù o motor para fugir dessa nuance.  Ignoraremos sua descri√ß√£o neste artigo, caso contr√°rio, o artigo nunca terminar√° :).  Pr√°ticas de uso mais complexas e exemplos de melhorias ser√£o abordados nos artigos subseq√ºentes. </p><br><h4>  Processo de registro no mecanismo.  Publica√ß√£o do evento no √¥nibus. </h4><br><p>  Assim, com a implementa√ß√£o da l√≥gica das etapas e descri√ß√µes do processo, foi descoberto.  O que resta √© a coisa mais importante, sem a qual o processo n√£o funcionar√° - a descri√ß√£o precisa ser registrada. </p><br><p>  Usaremos o m√©todo de extens√£o padr√£o <strong>AddWorkflow ()</strong> , que colocar√° suas depend√™ncias em nosso cont√™iner de IoC. </p><br><p>  √â assim: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IServiceCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddWorkflow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IServiceCollection services, Action&lt;WorkflowOptions&gt; setupAction = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p>  <strong>IServiceCollection</strong> - interface - um contrato para uma cole√ß√£o de descri√ß√µes de servi√ßo.  Ele mora dentro do DI da Microsoft (mais sobre isso pode ser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lido aqui</a> ) </p><br><p>  <strong>WorkflowOptions</strong> - configura√ß√µes b√°sicas do mecanismo.  N√£o √© necess√°rio defini-los, os valores padr√£o s√£o bastante aceit√°veis ‚Äã‚Äãpara o primeiro conhecido.  N√≥s estamos indo al√©m. </p><br><p>  Se o processo foi descrito no c√≥digo, o registro ocorre assim: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = _serviceProvider.GetService&lt;IWorkflowHost&gt;(); host.RegisterWorkflow&lt;SomeWorkflow, ProcessContext&gt;();</code> </pre> <br><p>  Se o processo for descrito via json, ele dever√° ser registrado da seguinte forma (√© claro, a descri√ß√£o do json dever√° ser pr√©-carregada a partir do local de armazenamento): </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> host = _serviceProvider.GetService&lt;IWorkflowHost&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> definitionLoader = _serviceProvider.GetService&lt;IDefinitionLoader&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> definition = loader.LoadDefinition({*json  *});</code> </pre> <br><p>  Al√©m disso, para as duas op√ß√µes, o c√≥digo ser√° o mesmo: </p><br><pre> <code class="cs hljs">host.Start(); <span class="hljs-comment"><span class="hljs-comment">//      host.StartWorkflow(definitionId, version, context); //      /// host.Stop(); / /    </span></span></code> </pre> <br><p>  O par√¢metro <strong>definitionId</strong> √© o identificador do processo.  O que est√° escrito no campo Id do processo.  Nesse caso, id = <strong>SomeWorkflow</strong> . </p><br><p>  O par√¢metro <strong>version</strong> especifica qual vers√£o do processo executar.  O mecanismo fornece a capacidade de registrar imediatamente n vers√µes de processo com um identificador.  Isso √© conveniente quando voc√™ precisa fazer altera√ß√µes na descri√ß√£o do processo sem interromper as tarefas j√° em execu√ß√£o - novas ser√£o criadas de acordo com a nova vers√£o, as antigas viver√£o silenciosamente na antiga. </p><br><p>  O par√¢metro <strong>context</strong> √© uma inst√¢ncia do contexto do processo. </p><br><p>  Os <strong>m√©todos host.Start ()</strong> e <strong>host.Stop ()</strong> iniciam e param o processo de hospedagem.  Se no aplicativo o lan√ßamento de processos for uma tarefa aplicada e for realizada periodicamente, a hospedagem dever√° ser interrompida.  Se o aplicativo tiver o foco principal na implementa√ß√£o de v√°rios processos, a hospedagem n√£o poder√° ser interrompida. </p><br><p>  Existe um m√©todo para enviar mensagens do mundo externo para o barramento do mecanismo, que as distribuir√° entre os assinantes: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-function">Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PublishEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventKey, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> eventData, DateTime effectiveDate = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  A descri√ß√£o de seus par√¢metros foi mais alta no artigo ( <em>consulte a parte primitiva WaitFor</em> ). </p><br><h2>  Conclus√£o </h2><br><p>  Definitivamente assumimos riscos quando decidimos a favor do projeto de c√≥digo-fonte do Workflow Core, que √© desenvolvido ativamente por uma pessoa e mesmo com documenta√ß√£o muito ruim.  E voc√™ provavelmente n√£o encontrar√° pr√°ticas reais de uso do n√∫cleo wf em sistemas de produ√ß√£o (exceto os nossos).  √â claro que, ap√≥s selecionar uma camada separada de abstra√ß√µes, nos seguramos contra um caso de falha e a necessidade de retornar rapidamente ao WWF, por exemplo, ou uma solu√ß√£o auto-escrita, mas tudo correu muito bem e a falha n√£o ocorreu. </p><br><p>  A mudan√ßa para o mecanismo de c√≥digo-fonte do Workflow Core de c√≥digo aberto resolveu um certo n√∫mero de problemas que nos impediam de viver pacificamente no WWF.  O mais importante deles √©, obviamente, o suporte ao .Net Core e √† falta dele, mesmo em planos, o WWF. </p><br><p>  A seguir est√° o c√≥digo aberto.  Trabalhando com o WWF e obtendo v√°rios erros de suas entranhas, a capacidade de pelo menos ler a fonte seria muito √∫til.  Sem mencionar a mudan√ßa de algo neles.  Aqui, com a liberdade completa do Workflow Core (incluindo licenciamento - MIT).  Se um erro aparecer repentinamente nas entranhas do mecanismo, basta baixar as fontes do github e procurar calmamente a causa de sua ocorr√™ncia.  Sim, apenas a capacidade de iniciar o mecanismo no modo de depura√ß√£o com pontos de interrup√ß√£o j√° facilita muito o processo. </p><br><p>  Obviamente, resolvendo alguns problemas, o Workflow Core trouxe seus pr√≥prios novos.  Tivemos que fazer uma quantidade significativa de altera√ß√µes no n√∫cleo do motor.  Mas  Trabalhar no "acabamento" por si s√≥ custa menos tempo do que desenvolver seu pr√≥prio mecanismo a partir do zero.  A solu√ß√£o final foi bastante aceit√°vel em termos de velocidade e estabilidade, permitindo esquecer os problemas com o motor e focar no desenvolvimento do valor comercial do produto. </p><br><p>  <em>PS Se o t√≥pico for interessante, haver√° mais artigos sobre o wf core, com uma an√°lise mais profunda do mecanismo e solu√ß√µes para problemas de neg√≥cios complexos.</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt475902/">https://habr.com/ru/post/pt475902/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt475888/index.html">Benef√≠cios do reconhecimento facial da nuvem</a></li>
<li><a href="../pt475892/index.html">Como melhoramos a ordem do almo√ßo no escrit√≥rio (sem acesso ao servidor)</a></li>
<li><a href="../pt475894/index.html">Tr√™s protocolos de passagem</a></li>
<li><a href="../pt475896/index.html">Reator C nu de E / S completa</a></li>
<li><a href="../pt475900/index.html">Os 6 cursos mais recentes do Azure</a></li>
<li><a href="../pt475904/index.html">5 notas para o novo gerente</a></li>
<li><a href="../pt475908/index.html">10 cursos mais populares da Microsoft em russo</a></li>
<li><a href="../pt475912/index.html">Como avaliar e comparar dispositivos de criptografia para redes Ethernet</a></li>
<li><a href="../pt475916/index.html">Adicione olhos ao rob√¥</a></li>
<li><a href="../pt475920/index.html">N√£o em tempo de execu√ß√£o, mas em tempo de design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>