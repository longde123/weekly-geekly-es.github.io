<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ôüèæ üë®üèø‚Äçüíª ‚õîÔ∏è Buildbot: un conte avec des exemples d'un autre syst√®me d'int√©gration continue üèº üöò üë®üèª‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(photo du site officiel ) 

 Buildbot, comme son nom l'indique, est un syst√®me d'int√©gration continue (ci). Il y avait d√©j√† plusieurs articles √† son s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Buildbot: un conte avec des exemples d'un autre syst√®me d'int√©gration continue</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439096/"><img src="https://habrastorage.org/webt/so/qs/u1/soqsu1skae_0xuktzdemfv-n3yq.png"><br>  <i><font color="#aaaaaa">(photo du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">site officiel</a> )</font></i> <br><br>  Buildbot, comme son nom l'indique, est un syst√®me d'int√©gration continue (ci).  Il y avait d√©j√† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plusieurs</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">articles</a> √† son sujet sur le Habr√©, mais, de mon point de vue, les avantages de cet outil ne sont pas tr√®s clairs chez eux.  De plus, ils n'ont presque aucun exemple, ce qui rend difficile de voir toute la puissance du programme.  Dans mon article, je vais essayer de combler ces lacunes, parler du p√©riph√©rique interne Buildbot'a et donner des exemples de plusieurs scripts non standard. <br><a name="habracut"></a><br><h3>  Mots communs </h3><br>  Actuellement, il existe un grand nombre de syst√®mes d'int√©gration continue, et quand il s'agit de l'un d'entre eux, des questions assez logiques se posent dans l'esprit de "Pourquoi est-il n√©cessaire si vous avez d√©j√† un &lt;nom_programme&gt; et que tout le monde l'utilise?"  Je vais essayer de r√©pondre √† une telle question sur Buildbot.  Certaines informations seront dupliqu√©es avec des articles existants, d'autres sont d√©crites dans la documentation officielle, mais cela est n√©cessaire pour la coh√©rence du r√©cit. <br><br>  La principale diff√©rence avec les autres syst√®mes d'int√©gration continue est que Buildbot est un framework Python pour √©crire ci, pas une solution pr√™te √† l'emploi.  Cela signifie que pour connecter un projet √† Buildbot, vous devez d'abord √©crire un programme python distinct en utilisant le framework Buildbot qui impl√©mente la fonctionnalit√© d'int√©gration continue dont votre projet a besoin.  Cette approche offre une grande flexibilit√©, vous permettant de mettre en ≈ìuvre des sc√©narios de test difficiles qui sont impossibles pour les solutions pr√™tes √† l'emploi en raison de limitations architecturales. <br><br>  De plus, Buildbot n'est pas un service, et vous devez donc le d√©ployer honn√™tement sur votre infrastructure.  Ici, je note que le cadre est tr√®s fid√®le aux ressources du syst√®me.  Ce n'est certainement pas du C ou du C ++, mais python gagne contre ses concurrents Java.  Ici, par exemple, en comparant la consommation de m√©moire avec GoCD (et oui, malgr√© le nom, il s'agit d'un syst√®me Java): <br><br>  Buildbot: <br><br><img src="https://habrastorage.org/webt/q1/tg/wu/q1tgwuy-ef8bl6au-s7lc07da-c.png"><br><br>  GoCD: <br><br><img src="https://habrastorage.org/webt/lg/ci/bk/lgcibk9si78bjzf_gfqrgktcgug.png"><br><br>  D√©ployer et √©crire vous-m√™me un programme de test s√©par√© peut vous rendre triste √† l'id√©e de la configuration initiale.  Cependant, l'√©criture de scripts est grandement simplifi√©e par le grand nombre de classes int√©gr√©es.  Ces classes couvrent de nombreuses op√©rations standard, qu'il s'agisse d'obtenir des modifications du r√©f√©rentiel github ou de construire le projet avec CMake.  En cons√©quence, les scripts standard pour les petits projets ne seront pas plus compliqu√©s que les fichiers YML pour certains travis-ci.  Je n'√©crirai pas sur le d√©ploiement, ceci est couvert en d√©tail dans les articles existants et il n'y a rien de compliqu√© non plus. <br><br>  La prochaine fonctionnalit√© de Buildbot, je note que par d√©faut la logique de test est impl√©ment√©e du c√¥t√© du ci-serveur.  Cela contredit l'approche d√©sormais populaire du ¬´pipeline en tant que code¬ª, dans laquelle la logique de test est d√©crite dans un fichier (comme .travis.yml) se trouvant dans le r√©f√©rentiel avec le code source du projet, et le ci-server ne lit que ce fichier et ex√©cute ce qu'il dit.  Encore une fois, ce n'est que le comportement par d√©faut.  Les capacit√©s du framework Buildbot vous permettent d'impl√©menter l'approche d√©crite avec le stockage du script de test dans le r√©f√©rentiel.  Il existe m√™me une solution toute faite - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bb-travis</a> , qui essaie de tirer le meilleur parti de Buildbot et travis-ci.  En outre, plus loin dans cet article, je d√©crirai moi-m√™me comment impl√©menter quelque chose de similaire √† ce comportement. <br><br>  Buildbot collecte par d√©faut chaque commit lors de la pouss√©e.  Cela peut sembler √™tre une petite fonctionnalit√© inutile, mais pour moi, au contraire, elle est devenue l'un des principaux avantages.  De nombreuses solutions populaires pr√™tes √† l'emploi (travis-ci, gitlab-ci) ne fournissent pas du tout une telle opportunit√©, ne fonctionnant qu'avec le dernier commit de la branche.  Imaginez que pendant le d√©veloppement, vous devez souvent choisir les commits.  Il sera d√©sagr√©able de prendre un commit non fonctionnel, qui n'a pas √©t√© v√©rifi√© par le syst√®me de build en raison du fait qu'il a √©t√© lanc√© avec un tas de commits d'en haut.  Bien s√ªr, dans Buildbot, vous ne pouvez g√©n√©rer que le dernier commit, et cela se fait en d√©finissant un seul param√®tre. <br><br>  Le cadre a une assez bonne documentation, qui d√©crit tout en d√©tail de l'architecture g√©n√©rale aux directives pour √©tendre les classes int√©gr√©es.  Cependant, m√™me avec une telle documentation, vous devrez peut-√™tre regarder certaines choses dans le code source.  Il est enti√®rement ouvert sous la licence GPL v2 et est facile √† lire.  Parmi les inconv√©nients - la documentation est disponible uniquement en anglais, en russe, il y a tr√®s peu d'informations sur le r√©seau.  L'outil n'est pas apparu hier, avec son aide <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wireshark</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">LLVM</a> et de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nombreux autres</a> projets bien connus sont assembl√©s.  Des mises √† jour arrivent, le projet est soutenu par de nombreux d√©veloppeurs, nous pouvons donc parler de fiabilit√© et de stabilit√©. <br><br><img src="https://habrastorage.org/webt/22/we/zg/22wezgyvqnccjmk2sl_ehs954bg.png"><br>  <i><font color="#aaaaaa">(Page d'accueil de Python Buildbot)</font></i> <br><br><h3>  Theormin </h3><br>  Cette partie est essentiellement une traduction gratuite du chapitre de la documentation officielle sur l'architecture du framework.  Il montre la cha√Æne compl√®te d'actions depuis la r√©ception des modifications par le ci-syst√®me jusqu'√† l'envoi des notifications du r√©sultat aux utilisateurs.  Ainsi, vous avez apport√© des modifications au code source du projet et les avez envoy√©es au r√©f√©rentiel distant.  Ce qui se passe ensuite est sch√©matis√© dans l'image: <br><br><img src="https://habrastorage.org/webt/hq/ue/na/hquenaedpe7hdlulfnmctiew2b8.png"><br>  <i><font color="#aaaaaa">(photo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la documentation officielle</a> )</font></i> <br><br>  Tout d'abord, Buildbot devrait en quelque sorte d√©couvrir qu'il y a eu des changements dans le r√©f√©rentiel.  Il existe deux fa√ßons principales - les webhooks et les sondages, bien que personne n'interdise de proposer quelque chose de plus sophistiqu√©.  Dans le premier cas, dans Buildbot, les classes descendantes BaseHookHandler en sont responsables.  Il existe de nombreuses solutions pr√™tes √† l'emploi, par exemple, <i>GitHubHandler</i> ou <i>GitoriusHandler</i> .  La m√©thode cl√© de ces classes est <b>getChanges ()</b> .  Sa logique est extr√™mement simple: il doit convertir la requ√™te HTTP en une liste d'objets de modification. <br><br>  Pour le deuxi√®me cas, vous avez besoin des <i>classes</i> descendantes <i>PollingChangeSource</i> .  Encore une fois, il existe des solutions toutes faites, telles que <i>GitPoller</i> ou <i>HgPoller</i> .  La m√©thode cl√© est <b>poll ()</b> .  Il est appel√© avec une certaine fr√©quence et doit en quelque sorte cr√©er une liste de modifications dans le r√©f√©rentiel.  Dans le cas d'un git, cela pourrait √™tre un appel √† git fetch et une comparaison avec l'√©tat enregistr√© pr√©c√©dent.  Si les capacit√©s int√©gr√©es ne sont pas suffisantes, cr√©ez simplement votre propre classe h√©riti√®re et surchargez la m√©thode.  Un exemple d'utilisation de l'interrogation: <br><br><pre><code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [changes.GitPoller( repourl = <span class="hljs-string"><span class="hljs-string">'git@git.example.com:project'</span></span>, project = <span class="hljs-string"><span class="hljs-string">'My Project'</span></span>, branches = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-comment"><span class="hljs-comment">#      pollInterval = 60 )]</span></span></code> </pre> <br>  Webhook est encore plus simple √† utiliser, l'essentiel est de ne pas oublier de le configurer c√¥t√© git-server.  Ceci est juste une ligne dans le fichier de configuration: <br><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>][<span class="hljs-string"><span class="hljs-string">'change_hook_dialects'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'github'</span></span>: {} }</code> </pre> <br>  √Ä l'√©tape suivante, les objets de modification sont entr√©s dans les objets du planificateur ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">planificateurs</a> ).  Exemples de planificateurs <i>int√©gr√©s</i> : <i>AnyBranchScheduler</i> , <i>NightlyScheduler</i> , <i>ForceScheduler</i> , etc.  Chaque ordonnanceur re√ßoit tous les objets de modification en entr√©e, mais ne s√©lectionne que ceux qui passent le filtre.  Le filtre est transmis au planificateur dans le constructeur via l'argument <i>change_filter</i> .  En sortie, les planificateurs cr√©ent des demandes de g√©n√©ration.  Le planificateur s√©lectionne les g√©n√©rateurs en fonction de l'argument constructeurs. <br><br>  Certains planificateurs ont un argument d√©licat appel√© <i>treeStableTimer</i> .  Cela fonctionne comme suit: lorsqu'une modification est re√ßue, le planificateur ne cr√©e pas imm√©diatement une nouvelle demande de g√©n√©ration, mais d√©marre une minuterie.  Si de nouveaux changements arrivent et que le minuteur n'a pas expir√©, l'ancien changement est remplac√© par un nouveau et le minuteur est mis √† jour.  √Ä la fin du temporisateur, le planificateur cr√©e une seule demande de g√©n√©ration √† partir de la derni√®re modification enregistr√©e. <br><br>  Ainsi, la logique de n'assembler que le dernier commit lors du push est impl√©ment√©e.  Exemple de configuration du planificateur: <br><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [schedulers.AnyBranchScheduler( name = <span class="hljs-string"><span class="hljs-string">'My Scheduler'</span></span>, treeStableTimer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, change_filter = util.ChangeFilter(project = <span class="hljs-string"><span class="hljs-string">'My Project'</span></span>), builderNames = [<span class="hljs-string"><span class="hljs-string">'My Builder'</span></span>] )]</code> </pre> <br>  Les demandes de build, aussi √©tranges que cela puisse para√Ætre, sont transmises √† l'entr√©e des constructeurs.  La t√¢che du collecteur est d'ex√©cuter l'assemblage sur un ¬´travailleur¬ª accessible.  Worker est un environnement de g√©n√©ration, tel que stretch64 ou ubuntu1804x64.  La liste des travailleurs passe par l'argument des <i>travailleurs</i> .  Tous les travailleurs de la liste doivent √™tre les m√™mes (c'est-√†-dire que les noms sont naturellement diff√©rents, mais l'environnement √† l'int√©rieur est le m√™me), car le collecteur est libre de choisir n'importe lequel des disponibles.  La d√©finition de plusieurs valeurs ici permet d'√©quilibrer la charge et non de construire dans des environnements diff√©rents.  √Ä l'aide de l'argument <i>facteur</i> y, le collecteur re√ßoit une s√©quence d'√©tapes pour g√©n√©rer le projet.  J'√©crirai √† ce sujet en d√©tail ci-dessous. <br><br>  Un exemple de configuration du collecteur: <br><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [util.BuilderConfig( name = <span class="hljs-string"><span class="hljs-string">'My Builder'</span></span>, workernames = [<span class="hljs-string"><span class="hljs-string">'stretch32'</span></span>], factory = factory )]</code> </pre> <br>  Donc, le projet est pr√™t.  La derni√®re √©tape de Buildbot consiste √† notifier la g√©n√©ration.  Les classes de reporter en sont responsables.  Un exemple classique est la classe <i>MailNotifier</i> , qui envoie un e-mail avec les r√©sultats de la construction.  <i>Exemple de</i> connexion <i>MailNotifier</i> : <br><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [reporters.MailNotifier( fromaddr = <span class="hljs-string"><span class="hljs-string">'buildbot@example.com'</span></span>, relayhost = <span class="hljs-string"><span class="hljs-string">'mail.example.com'</span></span>, smtpPort = <span class="hljs-number"><span class="hljs-number">25</span></span>, extraRecipients = [<span class="hljs-string"><span class="hljs-string">'devel@example.com'</span></span>], sendToInterestedUsers = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> )]</code> </pre> <br>  Eh bien, il est temps de passer √† des exemples √† part enti√®re.  Je note que Buildbot lui-m√™me a √©t√© √©crit en utilisant le framework Twisted, et donc sa connaissance facilitera grandement l'√©criture et la compr√©hension des scripts Buildbot.  Nous aurons un gar√ßon √† fouetter pour un projet appel√© Pet Project.  Laissez-le √™tre √©crit en C ++, assembl√© √† l'aide de CMake, et le code source se trouve dans le r√©f√©rentiel git.  Nous n'√©tions pas trop paresseux et avons √©crit pour lui des tests dirig√©s par l'√©quipe ctest.  Plus r√©cemment, nous avons lu cet article et r√©alis√© que nous voulons appliquer les connaissances fra√Æchement acquises √† notre projet. <br><br><h3>  Exemple un: pour que cela fonctionne </h3><br>  En fait, le fichier de configuration: <br><br><div class="spoiler">  <b class="spoiler_title">100 lignes de code python</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-comment"><span class="hljs-comment"># shortcut c = BuildmasterConfig = {} # create workers c['workers'] = [worker.Worker('stretch32', 'example_password')] # general settings c['title'] = 'Buildbot: test' c['titleURL'] = 'https://buildbot.example.com/' c['buildbotURL'] = 'https://buildbot.example.com/' # setup database c['db'] = { 'db_url': 'sqlite:///state.sqlite' } # port to communicate with workers c['protocols'] = { 'pb': { 'port': 9989 } } # make buildbot developers a little bit happier c['buildbotNetUsageData'] = 'basic' # webserver setup c['www'] = dict(plugins = dict(waterfall_view={}, console_view={}, grid_view={})) c['www']['authz'] = util.Authz( allowRules = [util.AnyEndpointMatcher(role = 'admins')], roleMatchers = [util.RolesFromUsername(roles = ['admins'], usernames = ['root'])] ) c['www']['auth'] = util.UserPasswordAuth([('root', 'root_password')]) # mail notification c['services'] = [reporters.MailNotifier( fromaddr = 'buildbot@example.com', relayhost = 'mail.example.com', smtpPort = 25, extraRecipients = ['devel@example.com'], sendToInterestedUsers = False )] c['change_source'] = [changes.GitPoller( repourl = 'git@git.example.com:pet-project', project = 'Pet Project', branches = True, pollInterval = 60 )] c['schedulers'] = [schedulers.AnyBranchScheduler( name = 'Pet Project Scheduler', treeStableTimer = None, change_filter = util.ChangeFilter(project = 'Pet Project'), builderNames = ['Pet Project Builder'] )] factory = util.BuildFactory() factory.addStep(steps.Git( repourl = util.Property('repository'), workdir = 'sources', haltOnFailure = True, submodules = True, progress = True) ) factory.addStep(steps.ShellSequence( name = 'create builddir', haltOnFailure = True, hideStepIf = lambda results, s: results == util.SUCCESS, commands = [ util.ShellArg(command = ['rm', '-rf', 'build']), util.ShellArg(command = ['mkdir', 'build']) ]) ) factory.addStep(steps.CMake( workdir = 'build', path = '../sources', haltOnFailure = True) ) factory.addStep(steps.Compile( name = 'build project', workdir = 'build', haltOnFailure = True, warnOnWarnings = True, command = ['make']) ) factory.addStep(steps.ShellCommand( name = 'run tests', workdir = 'build', haltOnFailure = True, command = ['ctest']) ) c['builders'] = [util.BuilderConfig( name = 'Pet Project Builder', workernames = ['stretch32'], factory = factory )]</span></span></code> </pre> <br></div></div><br>  En √©crivant ces lignes, nous obtenons un assemblage automatique lors de la pouss√©e vers le r√©f√©rentiel, une belle face Web, des notifications par e-mail et d'autres attributs de tout ci qui se respecte.  La plupart de cela doit √™tre clair: les param√®tres des planificateurs, des collecteurs et d'autres objets sont rendus similaires aux exemples donn√©s pr√©c√©demment, la valeur de la plupart des param√®tres est intuitive.  En d√©tail, je me concentrerai uniquement sur la cr√©ation d'une usine, ce que j'ai promis de faire plus t√¥t. <br><br>  L'usine se compose des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©tapes</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">construction</a> que Buildbot doit effectuer pour le projet.  Comme pour les autres classes, il existe de nombreuses solutions toutes faites.  Notre usine se compose de cinq √©tapes.  En r√®gle g√©n√©rale, la premi√®re √©tape consiste √† obtenir l'√©tat actuel du r√©f√©rentiel, et ici nous ne ferons pas d'exception.  Pour ce faire, nous utilisons la classe <i>Git</i> standard: <br><br><div class="spoiler">  <b class="spoiler_title">Premi√®re √©tape</b> <div class="spoiler_text"><pre> <code class="python hljs">factory = util.BuildFactory() factory.addStep(steps.Git( repourl = util.Property(<span class="hljs-string"><span class="hljs-string">'repository'</span></span>), workdir = <span class="hljs-string"><span class="hljs-string">'sources'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, submodules = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, progress = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) )</code> </pre> <br></div></div><br>  Ensuite, nous devons cr√©er un r√©pertoire dans lequel le projet sera assembl√© - nous allons faire une compilation compl√®te √† partir des sources.  Avant cela, vous devez vous rappeler de supprimer le r√©pertoire s'il existe d√©j√†.  Ainsi, nous devons ex√©cuter deux commandes.  La classe <i>ShellSequence</i> nous aidera avec ceci: <br><br><div class="spoiler">  <b class="spoiler_title">Deuxi√®me √©tape</b> <div class="spoiler_text"><pre> <code class="python hljs">factory.addStep(steps.ShellSequence( name = <span class="hljs-string"><span class="hljs-string">'create builddir'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, hideStepIf = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> results, s: results == util.SUCCESS, commands = [ util.ShellArg(command = [<span class="hljs-string"><span class="hljs-string">'rm'</span></span>, <span class="hljs-string"><span class="hljs-string">'-rf'</span></span>, <span class="hljs-string"><span class="hljs-string">'build'</span></span>]), util.ShellArg(command = [<span class="hljs-string"><span class="hljs-string">'mkdir'</span></span>, <span class="hljs-string"><span class="hljs-string">'build'</span></span>]) ]) )</code> </pre> <br></div></div><br>  Vous devez maintenant d√©marrer CMake.  Pour ce faire, il est logique d'utiliser l'une des deux classes - <i>ShellCommand</i> ou <i>CMake</i> .  Nous utiliserons ce dernier, mais les diff√©rences sont minimes: il s'agit d'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">simple wrapper</a> sur la premi√®re classe, ce qui rend un peu plus pratique le passage d'arguments sp√©cifiques √† CMake. <br><br><div class="spoiler">  <b class="spoiler_title">Troisi√®me √©tape</b> <div class="spoiler_text"><pre> <code class="python hljs">factory.addStep(steps.CMake( workdir = <span class="hljs-string"><span class="hljs-string">'build'</span></span>, path = <span class="hljs-string"><span class="hljs-string">'../sources'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) )</code> </pre> <br></div></div><br>  Il est temps de compiler le projet.  Comme dans le cas pr√©c√©dent, vous pouvez utiliser <i>ShellCommand</i> .  De m√™me, il existe une classe <i>Compile</i> qui est un wrapper sur <i>ShellCommand</i> .  N√©anmoins, c'est un wrapper plus d√©licat: la classe <i>Compile</i> surveille les avertissements pendant la compilation et les affiche avec pr√©cision dans un journal s√©par√©.  C'est pourquoi nous utiliserons la classe <i>Compile</i> : <br><br><div class="spoiler">  <b class="spoiler_title">Quatri√®me √©tape</b> <div class="spoiler_text"><pre> <code class="python hljs">factory.addStep(steps.Compile( name = <span class="hljs-string"><span class="hljs-string">'build project'</span></span>, workdir = <span class="hljs-string"><span class="hljs-string">'build'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, warnOnWarnings = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, command = [<span class="hljs-string"><span class="hljs-string">'make'</span></span>]) )</code> </pre> <br></div></div><br>  Enfin, ex√©cutez nos tests.  Ici, nous utiliserons la classe <i>ShellCommand</i> mentionn√©e pr√©c√©demment: <br><br><div class="spoiler">  <b class="spoiler_title">Cinqui√®me √©tape</b> <div class="spoiler_text"><pre> <code class="python hljs">factory.addStep(steps.ShellCommand( name = <span class="hljs-string"><span class="hljs-string">'run tests'</span></span>, workdir = <span class="hljs-string"><span class="hljs-string">'build'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, command = [<span class="hljs-string"><span class="hljs-string">'ctest'</span></span>]) )</code> </pre> <br></div></div><br><h3>  Exemple 2: pipeline en tant que code </h3><br>  Ici, je vais montrer comment impl√©menter une option budg√©taire pour stocker la logique de test avec le code source du projet, et non dans le fichier de configuration ci-server.  Pour ce faire, placez le fichier <i>.buildbot</i> dans le r√©f√©rentiel avec le code, dans lequel chaque ligne se compose de mots, le premier √©tant interpr√©t√© comme un r√©pertoire pour la commande √† ex√©cuter et le reste comme une commande avec ses arguments.  Pour notre projet pour animaux de compagnie, le fichier <i>.buildbot</i> ressemblera √† ceci: <br><br><div class="spoiler">  <b class="spoiler_title">Fichier .Buildbot avec commandes</b> <div class="spoiler_text"> <code>. rm -rf build <br> . mkdir build <br> build cmake ../sources <br> build make <br> build ctest</code> <br> </div></div><br>  Nous devons maintenant modifier le fichier de configuration de Buildbot.  Pour analyser le fichier <i>.buildbot</i> , nous devrons √©crire une classe de notre propre √©tape.  Cette √©tape lira le fichier <i>.buildbot</i> , apr√®s quoi, pour chaque ligne, ajoutez l'√©tape <i>ShellCommand</i> avec les arguments n√©cessaires.  Pour ajouter des √©tapes de mani√®re dynamique, nous utiliserons la m√©thode <b>build.addStepsAfterCurrentStep ()</b> .  √áa n'a pas l'air effrayant du tout: <br><br><div class="spoiler">  <b class="spoiler_title">Classe AnalyseStep</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnalyseStep</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ShellMixin, BuildStep)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, workdir, **kwargs)</span></span></span><span class="hljs-function">:</span></span> kwargs = self.setupShellMixin(kwargs, prohibitArgs = [<span class="hljs-string"><span class="hljs-string">'command'</span></span>, <span class="hljs-string"><span class="hljs-string">'workdir'</span></span>, <span class="hljs-string"><span class="hljs-string">'want_stdout'</span></span>]) BuildStep.__init__(self, **kwargs) self.workdir = workdir @defer.inlineCallbacks <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.stdio_log = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> self.addLog(<span class="hljs-string"><span class="hljs-string">'stdio'</span></span>) cmd = RemoteShellCommand( command = [<span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-string"><span class="hljs-string">'.buildbot'</span></span>], workdir = self.workdir, want_stdout = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, want_stderr = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, collectStdout = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) cmd.useLog(self.stdio_log) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> self.runCommand(cmd) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cmd.didFail(): defer.returnValue(util.FAILURE) results = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> cmd.stdout.splitlines(): lst = row.split() dirname = lst.pop(<span class="hljs-number"><span class="hljs-number">0</span></span>) results.append(steps.ShellCommand( name = lst[<span class="hljs-number"><span class="hljs-number">0</span></span>], command = lst, workdir = dirname ) ) self.build.addStepsAfterCurrentStep(results) defer.returnValue(util.SUCCESS)</code> </pre> <br></div></div><br>  Gr√¢ce √† cette approche, l'usine du collectionneur est devenue plus simple et plus polyvalente: <br><br><div class="spoiler">  <b class="spoiler_title">Usine pour analyser le fichier .buildbot</b> <div class="spoiler_text"><pre> <code class="python hljs">factory = util.BuildFactory() factory.addStep(steps.Git( repourl = util.Property(<span class="hljs-string"><span class="hljs-string">'repository'</span></span>), workdir = <span class="hljs-string"><span class="hljs-string">'sources'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, submodules = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, progress = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, mode = <span class="hljs-string"><span class="hljs-string">'incremental'</span></span>) ) factory.addStep(AnalyseStep( name = <span class="hljs-string"><span class="hljs-string">'Analyse .buildbot file'</span></span>, workdir = <span class="hljs-string"><span class="hljs-string">'sources'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, hideStepIf = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> results, s: results == util.SUCCESS) )</code> </pre> <br></div></div><br><h3>  Exemple trois: travailleur comme code </h3><br>  Imaginez maintenant qu'√† c√¥t√© du code du projet, nous devons d√©terminer non pas la s√©quence de commandes, mais l'environnement de l'assembly.  En fait, nous d√©finissons travailleur.  <i>Le</i> fichier <i>.buildbot</i> pourrait ressembler √† ceci: <br><br><div class="spoiler">  <b class="spoiler_title">Fichier d'environnement .Buildbot</b> <div class="spoiler_text"> <code>{ <br> "workers": ["stretch32", "wheezy32"] <br> }</code> <br> </div></div><br>  Le fichier de configuration de Buildbot dans ce cas deviendra plus compliqu√©, car nous voulons que les assemblys sur diff√©rents environnements soient interconnect√©s (si au moins un environnement √©choue, la validation enti√®re √©tait consid√©r√©e comme inop√©rante).  Deux niveaux nous aident √† r√©soudre le probl√®me.  Nous aurons un travailleur local qui analyse le fichier <i>.buildbot</i> et ex√©cute les builds sur les travailleurs souhait√©s.  Tout d'abord, comme dans l'exemple pr√©c√©dent, nous allons √©crire notre √©tape pour analyser le fichier <i>.buildbot</i> .  Pour d√©marrer l'assemblage sur un travailleur sp√©cifique, un ensemble de l'√©tape <i>D√©clencheur</i> et un type sp√©cial de planificateurs <i>TriggerableScheduler</i> sont <i>utilis√©s</i> .  Notre d√©marche est devenue un peu plus compliqu√©e, mais assez compr√©hensible: <br><br><div class="spoiler">  <b class="spoiler_title">Classe AnalyseStep</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnalyseStep</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ShellMixin, BuildStep)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, workdir, **kwargs)</span></span></span><span class="hljs-function">:</span></span> kwargs = self.setupShellMixin(kwargs, prohibitArgs = [<span class="hljs-string"><span class="hljs-string">'command'</span></span>, <span class="hljs-string"><span class="hljs-string">'workdir'</span></span>, <span class="hljs-string"><span class="hljs-string">'want_stdout'</span></span>]) BuildStep.__init__(self, **kwargs) self.workdir = workdir @defer.inlineCallbacks <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getWorkerList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> cmd = RemoteShellCommand( command = [<span class="hljs-string"><span class="hljs-string">'cat'</span></span>, <span class="hljs-string"><span class="hljs-string">'.buildbot'</span></span>], workdir = self.workdir, want_stdout = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, want_stderr = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, collectStdout = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> ) cmd.useLog(self.stdio_log) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> self.runCommand(cmd) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cmd.didFail(): defer.returnValue([]) <span class="hljs-comment"><span class="hljs-comment"># parse JSON try: payload = json.loads(cmd.stdout) workers = payload.get('workers', []) except json.decoder.JSONDecodeError as e: raise ValueError('Error loading JSON from .buildbot file: {}' .format(str(e))) defer.returnValue(workers) @defer.inlineCallbacks def run(self): self.stdio_log = yield self.addLog('stdio') try: workers = yield self._getWorkerList() except ValueError as e: yield self.stdio_log.addStdout(str(e)) defer.returnValue(util.FAILURE) results = [] for worker in workers: results.append(steps.Trigger( name = 'check on worker "{}"'.format(worker), schedulerNames = ['Pet Project ({}) Scheduler'.format(worker)], waitForFinish = True, haltOnFailure = True, warnOnWarnings = True, updateSourceStamp = False, alwaysUseLatest = False ) ) self.build.addStepsAfterCurrentStep(results) defer.returnValue(util.SUCCESS)</span></span></code> </pre> <br></div></div><br>  Nous utiliserons cette √©tape sur le travailleur local.  Veuillez noter que nous avons d√©fini la balise sur notre collecteur ¬´Pet Project Builder¬ª.  Avec lui, nous pouvons filtrer <i>MailNotifier</i> , lui disant que les lettres ne doivent √™tre envoy√©es qu'√† certains collectionneurs.  Si ce filtrage n'est pas effectu√©, lors de la construction de la validation sur deux environnements, nous recevrons trois lettres. <br><br><div class="spoiler">  <b class="spoiler_title">Collectionneur g√©n√©ral</b> <div class="spoiler_text"><pre> <code class="python hljs">factory = util.BuildFactory() factory.addStep(steps.Git( repourl = util.Property(<span class="hljs-string"><span class="hljs-string">'repository'</span></span>), workdir = <span class="hljs-string"><span class="hljs-string">'sources'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, submodules = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, progress = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, mode = <span class="hljs-string"><span class="hljs-string">'incremental'</span></span>) ) factory.addStep(AnalyseStep( name = <span class="hljs-string"><span class="hljs-string">'Analyse .buildbot file'</span></span>, workdir = <span class="hljs-string"><span class="hljs-string">'sources'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, hideStepIf = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> results, s: results == util.SUCCESS) ) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [util.BuilderConfig( name = <span class="hljs-string"><span class="hljs-string">'Pet Project Builder'</span></span>, tags = [<span class="hljs-string"><span class="hljs-string">'generic_builder'</span></span>], workernames = [<span class="hljs-string"><span class="hljs-string">'local'</span></span>], factory = factory )]</code> </pre> <br></div></div><br>  Il nous reste √† ajouter les collecteurs et les m√™mes programmateurs d√©clencheurs pour tous nos vrais travailleurs: <br><br><div class="spoiler">  <b class="spoiler_title">Des collectionneurs dans le bon environnement</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> worker <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> allWorkers: c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.Triggerable( name = <span class="hljs-string"><span class="hljs-string">'Pet Project ({}) Scheduler'</span></span>.format(worker), builderNames = [<span class="hljs-string"><span class="hljs-string">'Pet Project ({}) Builder'</span></span>.format(worker)]) ) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig( name = <span class="hljs-string"><span class="hljs-string">'Pet Project ({}) Builder'</span></span>.format(worker), workernames = [worker], factory = specific_factory) )</code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/iq/_n/n4/iq_nn4nhvj07vcina32c2244o6a.png"><br>  <i><font color="#aaaaaa">(construire la page de notre projet dans deux environnements)</font></i> <br><br><h3>  Exemple quatre: une lettre pour plusieurs validations </h3><br>  Si vous utilisez l'un des exemples ci-dessus, vous pouvez remarquer une caract√©ristique d√©sagr√©able.  Puisqu'une lettre est cr√©√©e pour chaque validation, lorsque nous poussons la branche avec 20 nouvelles validations, nous recevrons 20 lettres.  En √©vitant cela, comme dans l'exemple pr√©c√©dent, nous aiderons √† deux niveaux.  Nous devons √©galement modifier la classe pour obtenir les modifications.  Au lieu de cr√©er de nombreux objets de modification, nous ne cr√©erons qu'un seul de ces objets, dans les propri√©t√©s desquels une liste de tous les commits est transmise.  En toute h√¢te, cela peut √™tre fait comme ceci: <br><br><div class="spoiler">  <b class="spoiler_title">Classe MultiGitHubHandler</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MultiGitHubHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(GitHubHandler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getChanges</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, request)</span></span></span><span class="hljs-function">:</span></span> new_changes = GitHubHandler.getChanges(self, request) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> new_changes: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ([], <span class="hljs-string"><span class="hljs-string">'git'</span></span>) change = new_changes[<span class="hljs-number"><span class="hljs-number">-1</span></span>] change[<span class="hljs-string"><span class="hljs-string">'revision'</span></span>] = <span class="hljs-string"><span class="hljs-string">'{}..{}'</span></span>.format( new_changes[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-string"><span class="hljs-string">'revision'</span></span>], new_changes[<span class="hljs-number"><span class="hljs-number">-1</span></span>][<span class="hljs-string"><span class="hljs-string">'revision'</span></span>]) commits = [c[<span class="hljs-string"><span class="hljs-string">'revision'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> new_changes] change[<span class="hljs-string"><span class="hljs-string">'properties'</span></span>][<span class="hljs-string"><span class="hljs-string">'commits'</span></span>] = commits <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ([change], <span class="hljs-string"><span class="hljs-string">'git'</span></span>) c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>][<span class="hljs-string"><span class="hljs-string">'change_hook_dialects'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'base'</span></span>: { <span class="hljs-string"><span class="hljs-string">'custom_class'</span></span>: MultiGitHubHandler } }</code> </pre> <br></div></div><br>  Pour travailler avec un objet de changement aussi inhabituel, nous avons besoin de notre propre √©tape sp√©ciale, qui cr√©e dynamiquement des √©tapes qui collectent un commit sp√©cifique: <br><br><div class="spoiler">  <b class="spoiler_title">Classe GenerateCommitSteps</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GenerateCommitSteps</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BuildStep)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> commits = self.getProperty(<span class="hljs-string"><span class="hljs-string">'commits'</span></span>) results = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> commit <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> commits: results.append(steps.Trigger( name = <span class="hljs-string"><span class="hljs-string">'Checking commit {}'</span></span>.format(commit), schedulerNames = [<span class="hljs-string"><span class="hljs-string">'Pet Project Commits Scheduler'</span></span>], waitForFinish = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, warnOnWarnings = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, sourceStamp = { <span class="hljs-string"><span class="hljs-string">'branch'</span></span>: util.Property(<span class="hljs-string"><span class="hljs-string">'branch'</span></span>), <span class="hljs-string"><span class="hljs-string">'revision'</span></span>: commit, <span class="hljs-string"><span class="hljs-string">'codebase'</span></span>: util.Property(<span class="hljs-string"><span class="hljs-string">'codebase'</span></span>), <span class="hljs-string"><span class="hljs-string">'repository'</span></span>: util.Property(<span class="hljs-string"><span class="hljs-string">'repository'</span></span>), <span class="hljs-string"><span class="hljs-string">'project'</span></span>: util.Property(<span class="hljs-string"><span class="hljs-string">'project'</span></span>) } ) ) self.build.addStepsAfterCurrentStep(results) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> util.SUCCESS</code> </pre> <br></div></div><br>  Ajoutez notre collecteur commun, qui n'est impliqu√© que dans l'ex√©cution des assemblys de commits individuels.  Il doit √™tre balis√© afin de filtrer ensuite l'envoi de lettres par ce tag lui-m√™me. <br><br><div class="spoiler">  <b class="spoiler_title">R√©cup√©rateur de courrier g√©n√©ral</b> <div class="spoiler_text"><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [schedulers.AnyBranchScheduler( name = <span class="hljs-string"><span class="hljs-string">'Pet Project Branches Scheduler'</span></span>, treeStableTimer = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, change_filter = util.ChangeFilter(project = <span class="hljs-string"><span class="hljs-string">'Pet Project'</span></span>), builderNames = [<span class="hljs-string"><span class="hljs-string">'Pet Project Branches Builder'</span></span>] )] branches_factory = util.BuildFactory() branches_factory.addStep(GenerateCommitSteps( name = <span class="hljs-string"><span class="hljs-string">'Generate commit steps'</span></span>, haltOnFailure = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, hideStepIf = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> results, s: results == util.SUCCESS) ) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [util.BuilderConfig( name = <span class="hljs-string"><span class="hljs-string">'Pet Project Branches Builder'</span></span>, tags = [<span class="hljs-string"><span class="hljs-string">'branch_builder'</span></span>], workernames = [<span class="hljs-string"><span class="hljs-string">'local'</span></span>], factory = branches_factory )]</code> </pre> <br></div></div><br>  Il reste √† ajouter uniquement le collecteur pour les validations individuelles.  Nous ne marquons simplement pas ce collecteur avec une balise, et par cons√©quent, aucune lettre ne sera cr√©√©e pour lui. <br><br><div class="spoiler">  <b class="spoiler_title">R√©cup√©rateur de courrier g√©n√©ral</b> <div class="spoiler_text"><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.Triggerable( name = <span class="hljs-string"><span class="hljs-string">'Pet Project Commits Scheduler'</span></span>, builderNames = [<span class="hljs-string"><span class="hljs-string">'Pet Project Commits Builder'</span></span>]) ) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig( name = <span class="hljs-string"><span class="hljs-string">'Pet Project Commits Builder'</span></span>, workernames = [<span class="hljs-string"><span class="hljs-string">'stretch32'</span></span>], factory = specific_factory) )</code> </pre> <br></div></div><br><h3>  Les derniers mots </h3><br>  Cet article ne remplace en aucun cas la lecture de la documentation officielle, donc si vous √™tes int√©ress√© par Buildbot, alors votre prochaine √©tape devrait √™tre de le lire.  Les versions compl√®tes des fichiers de configuration de tous les exemples sont disponibles sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github</a> .  Liens connexes, √† partir desquels la plupart des √©l√©ments de l'article ont √©t√© extraits: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentation officielle</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Code source du projet</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr439096/">https://habr.com/ru/post/fr439096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr439080/index.html">Le RabbitMQ non √©vident dans Yii2 ou pourquoi RabbitMQ √©crit dans toutes les files d'attente √† la fois</a></li>
<li><a href="../fr439082/index.html">Wish Factory Walk</a></li>
<li><a href="../fr439086/index.html">Causes de l'ANR et comment l'√©viter</a></li>
<li><a href="../fr439090/index.html">L'IBM 5150. O√π le monopole a commenc√©</a></li>
<li><a href="../fr439094/index.html">Les scientifiques ont trouv√© le plus vieux vert√©br√© vivant sur Terre</a></li>
<li><a href="../fr439098/index.html">Sasha Memus, Chatfuel: Comment construire une carri√®re dans les produits apr√®s avoir consult√©, est-il dangereux de m√©diter et comment changer de comportement</a></li>
<li><a href="../fr439100/index.html">Comment adapter UX / UI sous les autorisations</a></li>
<li><a href="../fr439102/index.html">Les Russes sont 20% plus susceptibles de subir des insultes sur Internet</a></li>
<li><a href="../fr439104/index.html">Redux Simple comme un r√¢teau</a></li>
<li><a href="../fr439108/index.html">Mesures radioamateur: quand il n'y a pas de fr√©quencem√®tre</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>