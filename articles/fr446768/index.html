<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêß üì´ ü§πüèø Saisie nominale dans TypeScript ou comment prot√©ger votre interface contre les identifiants √©trangers üòâ üö∂ üèéÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, en √©tudiant les causes du mauvais fonctionnement de mon projet de maison, j'ai encore une fois remarqu√© une erreur qui se r√©p√®te souvent √† ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Saisie nominale dans TypeScript ou comment prot√©ger votre interface contre les identifiants √©trangers</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446768/"><p><img src="https://habrastorage.org/webt/7q/sp/un/7qspunk_snsfnuxo4q7czinu_sa.png"><br>  R√©cemment, en √©tudiant les causes du mauvais fonctionnement de mon projet de maison, j'ai encore une fois remarqu√© une erreur qui se r√©p√®te souvent √† cause de la fatigue.  L'essence de l'erreur est que, ayant plusieurs identifiants dans un bloc de code, lorsque j'appelle une fonction, je passe l'identifiant d'un objet d'un autre type.  Dans cet article, je vais vous expliquer comment r√©soudre ce probl√®me √† l'aide de TypeScript. </p><a name="habracut"></a><br><h2 id="nemnogo-teorii">  Un peu de th√©orie </h2><br><p>  TypeScript est bas√© sur un typage structurel, qui correspond bien √† l'id√©ologie canard de JavaScript.  Un nombre suffisant d'articles ont √©t√© √©crits √† ce sujet.  Je ne les r√©p√©terai pas, je ne ferai que souligner la principale diff√©rence avec la dactylographie nominative, qui est plus courante dans d'autres langues.  Jetons un coup d'≈ìil √† un petit exemple. </p><br><pre><code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Car</span></span></span><span class="hljs-class"> </span></span>{ id: number; numberOfWheels: number; move (x: number, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: number) { <span class="hljs-comment"><span class="hljs-comment">//   } } class Boat { id: number; move (x: number, y: number) { //   } } let car: Car = new Boat(); //  TypeScript   let boat: Boat = new Car(); //       </span></span></code> </pre> <br><p>  Pourquoi TypeScript se comporte-t-il de cette fa√ßon?  Ceci n'est qu'une manifestation du typage structurel.  Contrairement au nominatif, qui surveille les noms de type, le typage structurel d√©cide de la compatibilit√© des types en fonction de leur contenu.  La classe Car contient toutes les propri√©t√©s et m√©thodes de la classe Boat, donc Car peut √™tre utilis√© comme bateau.  L'inverse n'est pas vrai car Boat n'a pas la propri√©t√© numberOfWheels. </p><br><h2 id="tipiziruem-identifikatory">  Taper des identifiants </h2><br><p>  Tout d'abord, nous allons d√©finir des types pour les identifiants </p><br><pre> <code class="javascript hljs">type CarId: number; type BoatId: number;</code> </pre> <br><p>  et r√©√©crivez les classes en utilisant ces types. </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Car</span></span></span><span class="hljs-class"> </span></span>{ id: CarId; numberOfWheels: number; move (x: number, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: number) { <span class="hljs-comment"><span class="hljs-comment">//   } } class Boat { id: BoatId; move (x: number, y: number) { //   } }</span></span></code> </pre> <br><p>  Vous remarquerez que la situation n'a pas beaucoup chang√©, car nous n'avons toujours pas de contr√¥le sur la provenance de l'identifiant, et vous aurez raison.  Mais cet exemple donne d√©j√† quelques avantages. </p><br><ol><li><p>  Pendant le d√©veloppement du programme, le type d'identifiant peut soudainement changer.  Ainsi, par exemple, un certain num√©ro de voiture, unique au projet, peut √™tre remplac√© par un num√©ro de cha√Æne VIN.  Sans sp√©cifier le type d'identifiant, vous devrez remplacer le num√©ro par une cha√Æne √† tous les endroits o√π il se produit.  Avec la t√¢che de type, le changement devra √™tre effectu√© uniquement √† un endroit o√π le type lui-m√™me est d√©termin√©. </p><br></li><li><p>  Lors de l'appel de fonctions, nous obtenons des conseils de notre √©diteur de code, quels devraient √™tre les identificateurs de type.  Supposons que nous ayons d√©clar√© les fonctions suivantes: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCarById</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id: CarId</span></span></span><span class="hljs-function">): </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Car</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... } function getBoatById(id: BoatId): Boat { // ... }</span></span></code> </pre> <br><p>  Ensuite, nous obtiendrons un indice de l'√©diteur que nous devons transmettre non seulement un nombre, mais CarId ou BoatId. </p><br></li></ol><br><h2 id="emuliruem-samuyu-stroguyu-tipizaciyu">  √âmuler la frappe la plus stricte </h2><br><p>  Il n'y a pas de typage nominal dans TypeScript, mais nous pouvons √©muler son comportement, ce qui rend tout type unique.  Pour ce faire, ajoutez une propri√©t√© unique au type.  Cette astuce est mentionn√©e dans les articles en anglais sous le terme Branding, et voici √† quoi elle ressemble: </p><br><pre> <code class="javascript hljs">type BoatId = number &amp; { <span class="hljs-attr"><span class="hljs-attr">_type</span></span>: <span class="hljs-string"><span class="hljs-string">'BoatId'</span></span>}; type CarId = number &amp; { <span class="hljs-attr"><span class="hljs-attr">_type</span></span>: <span class="hljs-string"><span class="hljs-string">'CarId'</span></span>};</code> </pre> <br><p>  Apr√®s avoir soulign√© que nos types doivent √™tre √† la fois un nombre et un objet avec une propri√©t√© avec une valeur unique, nous avons rendu nos types incompatibles dans la compr√©hension du typage structurel.  Voyons comment cela fonctionne. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> carId: CarId; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boatId: BoatId; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> car: Car; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> boat: Boat; car = getCarById(carId); <span class="hljs-comment"><span class="hljs-comment">// OK car = getCarById(boatId); // ERROR boat = getBoatById(boatId); // OK boat = getBoatById(carId); // ERROR carId = 1; // ERROR boatId = 2; // ERROR car = getCarById(3); // ERROR boat = getBoatById(4); // ERROR</span></span></code> </pre> <br><p>  Tout semble bon sauf pour les quatre derni√®res lignes.  Pour cr√©er des identifiants, vous avez besoin d'une fonction d'assistance: </p><br><pre> <code class="plaintext hljs">function makeCarIdFromVin(id: number): CarId { return vin as any; }</code> </pre> <br><p>  L'inconv√©nient de cette m√©thode est que cette fonction restera en ex√©cution. </p><br><h2 id="delaem-stroguyu-tipizaciyu-chut-menee-strogoy">  Rendre la frappe forte un peu moins stricte </h2><br><p>  Dans le dernier exemple, j'ai d√ª utiliser une fonction suppl√©mentaire pour cr√©er l'identifiant.  Vous pouvez vous en d√©barrasser en utilisant la d√©finition de l'interface Flavour: </p><br><pre> <code class="plaintext hljs">interface Flavoring&lt;FlavorT&gt; { _type?: FlavorT; } export type Flavor&lt;T, FlavorT&gt; = T &amp; Flavoring&lt;FlavorT&gt;;</code> </pre> <br><p>  Vous pouvez maintenant d√©finir les types d'identifiants comme suit: </p><br><pre> <code class="plaintext hljs">type CarId = Flavor&lt;number, ‚ÄúCarId‚Äù&gt; type BoatId = Flavor&lt;number, ‚ÄúBoatId‚Äù&gt;</code> </pre> <br><p>  √âtant donn√© que la propri√©t√© _type est facultative, vous pouvez utiliser une conversion implicite: </p><br><pre> <code class="plaintext hljs">let boatId: BoatId = 5; // OK let carId: CarId = 3; // OK</code> </pre> <br><p>  Et nous ne pouvons toujours pas m√©langer les identifiants: </p><br><pre> <code class="plaintext hljs">let carId: CarId = boatId; // ERROR</code> </pre> <br><h2 id="kakoy-variant-vybrat">  Quelle option choisir </h2><br><p>  Les deux options ont le droit d'exister.  Le branding a l'avantage de prot√©ger une variable d'une affectation directe.  Ceci est utile si la variable stocke la cha√Æne dans un certain format, tel qu'un chemin de fichier absolu, une date ou une adresse IP.  La fonction d'assistance qui traite de la conversion de type dans ce cas peut √©galement v√©rifier et traiter les donn√©es d'entr√©e.  Dans d'autres cas, il est plus pratique d'utiliser Flavour. </p><br><h2 id="istochniki">  Les sources </h2><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Point de d√©part stackoverflow.com</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interpr√©tation gratuite de l'article</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr446768/">https://habr.com/ru/post/fr446768/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr446752/index.html">Services de tra√ßage, OpenTracing et Jaeger</a></li>
<li><a href="../fr446756/index.html">Armes pour VR - [RAILGUN TUTORIAL]</a></li>
<li><a href="../fr446760/index.html">Sujets √† 3D Expo 2019: 3D Metal Printing, Anton Sotov, Samara University</a></li>
<li><a href="../fr446762/index.html">6. Check Point Getting Started R80.20. Premiers pas avec SmartConsole</a></li>
<li><a href="../fr446764/index.html">Norme WASI: Lancez WebAssembly au-del√† du Web</a></li>
<li><a href="../fr446770/index.html">12 astuces JavaScript introuvables dans la plupart des didacticiels</a></li>
<li><a href="../fr446772/index.html">N'ouvrez pas les ports au monde - ils vous briseront (risques)</a></li>
<li><a href="../fr446774/index.html">Conception de caract√®re Low Poly</a></li>
<li><a href="../fr446776/index.html">Preuve de travail efficace</a></li>
<li><a href="../fr446780/index.html">Comment cr√©er un th√®me sombre et ne pas nuire. Exp√©rience de l'√©quipe Yandex.Mail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>