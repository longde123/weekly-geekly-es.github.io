<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¤¥ âœŒğŸ½ â†—ï¸ å…³åœ¨ç¬¼å­é‡Œçš„æ¯”ç‰¹å¸ï¼Ÿ ğŸ¤ ğŸ¡ ğŸ‘ğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¢°å·§æˆ‘æ˜¯è®¡ç®—æœºç³»ç»Ÿå’Œç½‘ç»œçš„ä¸“ä¸šç®¡ç†å‘˜ï¼ˆç®€ç§°ï¼šsysadminï¼‰ï¼Œæˆ‘ç¢°å·§å‘Šè¯‰æ•™æˆã€‚ å„ç§ç³»ç»Ÿçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬é‚£äº›éœ€è¦[ç”±äº]ä¸Šè¿°å®‰å…¨æªæ–½çš„ç³»ç»Ÿã€‚ äº‹å®è¯æ˜ï¼Œå‰ä¸€æ®µæ—¶é—´æˆ‘å‘ç°è‡ªå·±å¯¹æ¯”ç‰¹å¸å¾ˆæ„Ÿå…´è¶£ï¼Œä¸ä»…ä½¿ç”¨å®ƒï¼Œè€Œä¸”è¿˜æ¨å‡ºäº†ä¸€äº›å¾®æœåŠ¡ï¼Œä»¥ä¾¿ä»å‘å±•çš„è§’åº¦å­¦ä¹ å¦‚ä½•ç‹¬ç«‹äºæ¯”ç‰¹å¸ç½‘ç»œï¼ˆæ¯•ç«Ÿæ˜¯p2pï¼‰å·¥ä½œã€‚ ï¼ˆæˆ‘å½“ç„¶æ˜¯è¿™...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å…³åœ¨ç¬¼å­é‡Œçš„æ¯”ç‰¹å¸ï¼Ÿ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477124/"><p>ç¢°å·§æˆ‘æ˜¯è®¡ç®—æœºç³»ç»Ÿå’Œç½‘ç»œçš„ä¸“ä¸šç®¡ç†å‘˜ï¼ˆç®€ç§°ï¼šsysadminï¼‰ï¼Œæˆ‘ç¢°å·§å‘Šè¯‰æ•™æˆã€‚ å„ç§ç³»ç»Ÿçš„æ´»åŠ¨ï¼ŒåŒ…æ‹¬é‚£äº›éœ€è¦[ç”±äº]ä¸Šè¿°å®‰å…¨æªæ–½çš„ç³»ç»Ÿã€‚ äº‹å®è¯æ˜ï¼Œå‰ä¸€æ®µæ—¶é—´æˆ‘å‘ç°è‡ªå·±å¯¹<a href="https://www.lopp.net/bitcoin-information.html">æ¯”ç‰¹å¸</a>å¾ˆæ„Ÿå…´è¶£ï¼Œä¸ä»…ä½¿ç”¨å®ƒï¼Œè€Œä¸”è¿˜æ¨å‡ºäº†ä¸€äº›å¾®æœåŠ¡ï¼Œä»¥ä¾¿ä»å‘å±•çš„è§’åº¦å­¦ä¹ å¦‚ä½•ç‹¬ç«‹äºæ¯”ç‰¹å¸ç½‘ç»œï¼ˆæ¯•ç«Ÿæ˜¯p2pï¼‰å·¥ä½œã€‚ ï¼ˆæˆ‘å½“ç„¶æ˜¯è¿™æ ·çš„<code>dev</code> ï¼Œæ‰€ä»¥è¿‡å»äº†ï¼‰ã€‚ ä½†æ˜¯æˆ‘ä¸æ˜¯åœ¨è°ˆè®ºå¼€å‘ï¼Œè€Œæ˜¯åœ¨ä¸ºåº”ç”¨ç¨‹åºæä¾›ä¸€ä¸ªå®‰å…¨æœ‰æ•ˆçš„ç¯å¢ƒã€‚ </p><a name="habracut"></a><br><p> é‡‘èæŠ€æœ¯ï¼ˆ <em>fintech</em> ï¼‰ä¸ä¿¡æ¯å®‰å…¨ï¼ˆ <em>infosec</em> ï¼‰ <em>å¹¶é©¾é½é©±</em> ï¼Œç¬¬ä¸€ç§å¯ä»¥åœ¨æ²¡æœ‰ç¬¬äºŒç§çš„æƒ…å†µä¸‹å·¥ä½œï¼Œä½†æ˜¯æ—¶é—´ä¸ä¼šå¾ˆé•¿ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æƒ³åˆ†äº«æˆ‘çš„ç»éªŒå’Œæˆ‘ä½¿ç”¨çš„å·¥å…·é›†ï¼ŒåŒ…æ‹¬<em>fintech</em>å’Œ<em>infosec</em> ï¼ŒåŒæ—¶è¿˜å¯ä»¥å°†å…¶ç”¨äºæ›´å¹¿æ³›æˆ–å®Œå…¨ä¸åŒçš„ç›®çš„ã€‚ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†å‘æ‚¨ä»‹ç»çš„ä¸æ˜¯æ¯”ç‰¹å¸ï¼Œè€Œæ˜¯å…³äºé‡‘èï¼ˆä¸ä»…æ˜¯ï¼‰æœåŠ¡çš„å¼€å‘å’Œè¿è¥çš„åŸºç¡€æ¶æ„æ¨¡å‹-ç®€è€Œè¨€ä¹‹ï¼Œæ˜¯é‚£äº›æ¶‰åŠâ€œ Bâ€çš„æœåŠ¡ã€‚ è¿™ä¸ä»…é€‚ç”¨äºæ¯”ç‰¹å¸äº¤æ˜“æ‰€ï¼Œè€Œä¸”é€‚ç”¨äºæ²¡æœ‰ä»»ä½•å½¢å¼çš„æ— æ¯”ç‰¹å¸çš„å°å…¬å¸æœåŠ¡çš„æœ€å…¸å‹çš„å…¬å¸åŠ¨ç‰©å›­ã€‚ </p><br><p> æˆ‘æƒ³æŒ‡å‡ºçš„æ˜¯ï¼Œæˆ‘æ”¯æŒ<em>â€œä¿æŒæ„šè ¢ç®€å•â€</em>å’Œ<em>â€œå°‘å³æ˜¯å¤šâ€çš„åŸåˆ™</em> ï¼Œå› æ­¤æœ¬æ–‡åŠå…¶ä¸­æ‰€æè¿°çš„éƒ½å°†å…·æœ‰è¿™äº›åŸåˆ™æ‰€å…·æœ‰çš„ç‰¹æ€§ã€‚ </p><br><p>  <em>è™šæ„çš„åœºæ™¯ï¼š</em>è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ¯”ç‰¹å¸äº¤æ¢å™¨çš„ç¤ºä¾‹ã€‚ æˆ‘ä»¬å†³å®šå¼€å§‹å°†å¢å¸ƒï¼Œç¾å…ƒï¼Œæ¬§å…ƒæ¢æˆæ¯”ç‰¹å¸ï¼Œåä¹‹äº¦ç„¶ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ªå¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯å¯¹äºå…¶ä»–æ•°å­—è´§å¸ï¼Œä¾‹å¦‚å¥‡å¼‚æœå’Œç½‘ç»œè´§å¸ï¼Œå³ æˆ‘ä»¬å·²ç»è§£å†³äº†æ‰€æœ‰æ³•å¾‹é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªç°æˆçš„åº”ç”¨ç¨‹åºå¯ä»¥ç”¨ä½œå¢å¸ƒï¼Œç¾å…ƒå’Œæ¬§å…ƒä»¥åŠå…¶ä»–æ”¯ä»˜ç³»ç»Ÿçš„æ”¯ä»˜ç½‘å…³ã€‚ å®ƒä¸æˆ‘ä»¬çš„é“¶è¡Œå¸æˆ·ç»‘å®šï¼Œå¹¶ä¸ºæœ€ç»ˆåº”ç”¨ç¨‹åºæä¾›äº†æŸç§APIã€‚ æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªWebåº”ç”¨ç¨‹åºï¼Œå¯ä»¥å……å½“ç”¨æˆ·çš„äº¤æ¢è€…ï¼Œä¾‹å¦‚å…¸å‹çš„å¥‡å¼‚é¸Ÿæˆ–webmoneyå¸æˆ·-æ‰“å¼€å¸æˆ·ï¼Œæ·»åŠ å¡ç­‰ã€‚ å®ƒä½¿ç”¨LANä¸­çš„REST APIä¸æˆ‘ä»¬çš„ç½‘å…³åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šè¿æ¥æ¯”ç‰¹å¸å¹¶åŒæ—¶å‡çº§åŸºç¡€æ¶æ„ï¼Œå› ä¸º æœ€åˆï¼Œæ‰€æœ‰ä¸œè¥¿éƒ½è¢«æ‰”åˆ°äº†æ¡Œå­ä¸‹é¢åŠå…¬å®¤çš„è™šæ‹Ÿç›’å­ä¸Šâ€¦â€¦ä»–ä»¬å¼€å§‹ä½¿ç”¨è¯¥ç«™ç‚¹ï¼Œæˆ‘ä»¬å¼€å§‹æ‹…å¿ƒæ­£å¸¸è¿è¡Œæ—¶é—´å’Œæ€§èƒ½ã€‚ </p><br><p> å› æ­¤ï¼Œè®©æˆ‘ä»¬ä»ä¸»è¦çš„ä¸€ä¸ªå¼€å§‹-æœåŠ¡å™¨é€‰æ‹©ã€‚ å› ä¸º å¦‚æœæˆ‘ä»¬çš„ç¤ºä¾‹ä¸­çš„ä¸šåŠ¡å¾ˆå°ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¿¡ä»»æ‰˜ç®¡è€…ï¼ˆOVHï¼‰ï¼Œæˆ‘ä»¬å°†é€‰æ‹©ä¸€ä¸ª<a href="https://www.kimsufi.com/">é¢„ç®—é€‰é¡¹ï¼Œ</a>åœ¨è¯¥<a href="https://www.kimsufi.com/">é€‰é¡¹</a>ä¸­ï¼Œæ‚¨æ— æ³•ä»åŸå§‹.isoæ˜ åƒå®‰è£…ç³»ç»Ÿï¼Œä½†æ²¡å…³ç³»ï¼ŒITå®‰å…¨éƒ¨é—¨ä¸€å®šä¼šåˆ†æå·²å®‰è£…çš„æ˜ åƒã€‚ å½“æˆ‘ä»¬é•¿å¤§åï¼Œé€šå¸¸ä¼šåœ¨ç‰©ç†è®¿é—®å—é™çš„æƒ…å†µä¸‹ï¼Œç”¨é”å’Œé’¥åŒ™ç§Ÿç”¨å£æ©±ï¼Œæˆ–è€…æˆ‘ä»¬å¯èƒ½ä¼šå»ºç«‹è‡ªå·±çš„DCã€‚ æ— è®ºå¦‚ä½•ï¼Œå€¼å¾—è®°ä½çš„æ˜¯ï¼Œåœ¨ç§Ÿç”¨é“å¹¶å®‰è£…ç°æˆçš„å›¾åƒæ—¶ï¼Œæ‚¨çš„ç³»ç»Ÿæœ‰å¯èƒ½ä¼šå‡ºç°â€œæ¥è‡ªä¸»æœºçš„æœ¨é©¬â€ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¯¥æœ¨é©¬å¹¶éæ—¨åœ¨è·Ÿè¸ªæ‚¨ï¼Œè€Œæ˜¯æä¾›æ›´æ–¹ä¾¿çš„ç®¡ç†å·¥å…·ã€‚æœåŠ¡å™¨ã€‚ </p><br><p>  <strong>æœåŠ¡å™¨å®‰è£…</strong> </p><br><p> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ æˆ‘ä»¬é€‰æ‹©é€‚åˆæˆ‘ä»¬éœ€æ±‚çš„é“ã€‚ ç„¶åé€‰æ‹©FreeBSDæ˜ åƒã€‚ å¥½å§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡IPMIæˆ–ä½¿ç”¨ç›‘è§†å™¨è¿æ¥ï¼ˆåœ¨ä½¿ç”¨å…¶ä»–ä¸»æœºå’Œæˆ‘ä»¬è‡ªå·±çš„ç¡¬ä»¶çš„æƒ…å†µä¸‹ï¼‰ï¼Œç„¶åå°†.iso FreeBSDæ˜ åƒæä¾›ç»™ä¸‹è½½æ–‡ä»¶ã€‚ å¯¹äºç®¡å¼¦ä¹é˜Ÿçš„å®‰è£…ï¼Œæˆ‘ä½¿ç”¨<a href="https://github.com/ansible/ansible">Ansible</a>å’Œ<a href="https://mfsbsd.vx.sk/">mfsbsd</a> ã€‚ å”¯ä¸€çš„æƒ…å†µæ˜¯ï¼Œåœ¨ä½¿ç”¨kimsufiçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©äº†<em>è‡ªå®šä¹‰å®‰è£…ï¼Œ</em>ä»¥ä¾¿é•œåƒä¸­çš„ä¸¤ä¸ªç£ç›˜ä»…å…·æœ‰â€œå¯åŠ¨â€å’Œ/ homeåˆ†åŒºâ€œå¤„äºæ‰“å¼€â€çŠ¶æ€ï¼Œå…¶ä½™ç£ç›˜ç©ºé—´å°†è¢«åŠ å¯†ï¼Œä½†ç¨åä¼šè¿›è¡Œæ›´å¤šè¯´æ˜ã€‚ </p><br><p><img src="https://habrastorage.org/webt/-m/ve/av/-mveavdklaybhokh5sznmisf7be.png"></p><br><p> ç³»ç»Ÿä»¥æ ‡å‡†æ–¹å¼å®‰è£…ï¼Œæˆ‘ä¸ä¼šåœåœ¨é‚£é‡Œï¼Œæˆ‘åªæ³¨æ„åˆ°åœ¨å¼€å§‹æ“ä½œä¹‹å‰ï¼Œæœ‰å¿…è¦æ³¨æ„<em>åŠ å›º</em>é€‰é¡¹ï¼Œ <code>bsdinstaller</code>åœ¨å®‰è£…ç»“æŸæ—¶æä¾›äº†è¿™äº›<em>åŠ å›º</em>é€‰é¡¹ï¼ˆå¦‚æœæ‚¨è‡ªå·±å®‰è£…ç³»ç»Ÿï¼‰ï¼š </p><br><p><img src="https://habrastorage.org/webt/pj/6w/no/pj6wnohhskxkw6vqigcucollot0.png"></p><br><p> å…³äºè¿™ä¸ªä¸»é¢˜æœ‰<a href="http://bsdadventures.com/harden-freebsd/">å¾ˆå¥½çš„ææ–™</a> ï¼Œç®€è¦åœ°è¯´ï¼Œæˆ‘å°†åœ¨è¿™é‡Œé‡å¤ã€‚ </p><br><p> å¯ä»¥åœ¨å·²å®‰è£…çš„ç³»ç»Ÿä¸Šä»¥ç›¸åŒçš„æ–¹å¼å¯ç”¨ä¸Šè¿°å‚æ•°ã€‚ ä¸ºæ­¤ï¼Œè¯·ç¼–è¾‘å¼•å¯¼ç¨‹åºæ–‡ä»¶å¹¶å¯ç”¨å†…æ ¸å‚æ•°ã€‚  * <em>eeæ˜¯BSDä¸­è¿™æ ·çš„ç¼–è¾‘å™¨</em> </p><br><p> <code># ee /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard clear_tmp_enable="YES" syslogd_flags="-ss" sendmail_enable="NONE"</code> </pre><br><p> <code># ee /etc/sysctl.conf</code> </p> <br><pre> <code class="plaintext hljs">... #sec hard security.bsd.see_other_uids=0 security.bsd.see_other_gids=0 security.bsd.unprivileged_read_msgbuf=0 security.bsd.unprivileged_proc_debug=0 kern.randompid=$(jot -r 1 9999) security.bsd.stack_guard_page=1</code> </pre> <br><p> è¿˜å€¼å¾—ç¡®ä¿å®‰è£…äº†æœ€æ–°ç‰ˆæœ¬çš„ç³»ç»Ÿï¼Œå¹¶<a href="https://www.freebsd.org/doc/handbook/updating-upgrading-freebsdupdate.html">å®Œæˆæ‰€æœ‰æ›´æ–°å’Œå‡çº§</a> ã€‚ ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„æƒ…å†µä¸‹ï¼Œéœ€è¦å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œå› ä¸º å®‰è£…å‰æ˜ åƒè¦è½åå…­ä¸ªæœˆåˆ°ä¸€å¹´ã€‚ å¥½äº†ï¼Œæˆ‘ä»¬é»˜è®¤å°†SSHç«¯å£æ›´æ”¹ä¸ºå…¶ä»–ç«¯å£ï¼Œæ·»åŠ å¯†é’¥èº«ä»½éªŒè¯å¹¶ä½¿ç”¨å¯†ç ç¦ç”¨å®ƒã€‚ </p><br><p> ç„¶åæˆ‘ä»¬é…ç½®<code>aide</code> ï¼Œç›‘è§†ç³»ç»Ÿé…ç½®æ–‡ä»¶çš„çŠ¶æ€ã€‚ å¯ä»¥åœ¨<a href="https://www.digitalocean.com/community/tutorials/how-to-install-aide-on-a-digitalocean-vps">è¿™é‡Œ</a>é˜…è¯»æ›´å¤šå†…å®¹ã€‚ </p><br><p> <code>pkg install aide</code> </p> <br><p> å¹¶ç¼–è¾‘æˆ‘ä»¬çš„crontab </p><br><p> <code>crontab -e</code> </p> <br><p> <code>06 01 * * 0-6 /root/chkaide.sh</code> </p> <br><pre> <code class="plaintext hljs">#! /bin/sh #chkaide.sh MYDATE=`date +%Y-%m-%d` MYFILENAME="Aide-"$MYDATE.txt /bin/echo "Aide check !! `date`" &gt; /tmp/$MYFILENAME /usr/local/bin/aide --check &gt; /tmp/myAide.txt /bin/cat /tmp/myAide.txt|/usr/bin/grep -v failed &gt;&gt; /tmp/$MYFILENAME /bin/echo "**************************************" &gt;&gt; /tmp/$MYFILENAME /usr/bin/tail -20 /tmp/myAide.txt &gt;&gt; /tmp/$MYFILENAME /bin/echo "****************DONE******************" &gt;&gt; /tmp/$MYFILENAME</code> </pre> <br><p> å¼€å¯<a href="https://www.freebsd.org/doc/handbook/audit-config.html">ç³»ç»Ÿå®¡æ ¸</a> </p><br><p> <code>sysrc auditd_enable=YES</code> </p> <br><p> <code># service auditd start</code> </p> <br><p>  <a href="https://www.freebsd.org/doc/handbook/audit-administration.html">æ‰‹å†Œ</a>ä¸­å¯¹å¦‚ä½•ç®¡ç†æ­¤ä¸šåŠ¡è¿›è¡Œäº†è¯¦ç»†è¯´æ˜ã€‚ </p><br><p> ç°åœ¨ï¼Œæˆ‘ä»¬é‡æ–°å¯åŠ¨å¹¶ç»§ç»­ä½¿ç”¨æœåŠ¡å™¨ä¸Šçš„è½¯ä»¶ã€‚ æ¯ä¸ªæœåŠ¡å™¨éƒ½æ˜¯å®¹å™¨æˆ–æ•´ä¸ªè™šæ‹Ÿæœºçš„ç®¡ç†ç¨‹åºã€‚ å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è®¡åˆ’ä½¿ç”¨å®Œå…¨è™šæ‹ŸåŒ–ï¼Œåˆ™å¤„ç†å™¨å¿…é¡»æ”¯æŒVT-xå’ŒEPTï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚ </p><br><p> ä½œä¸ºå®¹å™¨å’Œè™šæ‹Ÿæœºç®¡ç†äººå‘˜ï¼Œæˆ‘ä½¿ç”¨<a href="https://bsdstore.ru/">olevole</a>çš„<a href="https://github.com/olevole">clevd</a> ï¼Œå¸Œæœ›ä»–ä¸ºè¿™ä¸ªå‡ºè‰²çš„å®ç”¨ç¨‹åºå¸¦æ¥æ›´å¤šçš„å¥åº·å’Œæ”¶ç›Šï¼ </p><br><p>  <strong>å®¹å™¨ï¼Ÿ</strong>  <strong>è¿˜æ˜¯dockerè¿˜æ˜¯ä»€ä¹ˆï¼Ÿ</strong> </p><br><p> ä½†æ˜¯æ²¡æœ‰  <a href="https://www.freebsd.org/doc/handbook/jails.html">FreeBSD Jails</a>æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„å®¹å™¨åŒ–å·¥å…·ï¼Œä½†æ˜¯æåˆ°çš„<code>cbsd</code>ç”¨äºç¼–æ’è¿™äº›åç§°ä¸ºcellçš„å®¹å™¨çš„ã€‚ </p><br><p> å•å…ƒæ˜¯ç”¨äºå‡ºäºå„ç§ç›®çš„æ„å»ºåŸºç¡€ç»“æ„çš„æå…¶æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆï¼Œæœ€ç»ˆéœ€è¦å®Œå…¨éš”ç¦»å•ä¸ªæœåŠ¡æˆ–æµç¨‹ã€‚ è¿™æœ¬è´¨ä¸Šæ˜¯ä¸»æœºç³»ç»Ÿçš„å…‹éš†ï¼Œä½†ä¸éœ€è¦ç¡¬ä»¶çš„å®Œå…¨è™šæ‹ŸåŒ–ã€‚ å› æ­¤ï¼Œèµ„æºä¸ä¼šèŠ±è´¹åœ¨â€œæ¥å®¾æ“ä½œç³»ç»Ÿâ€ä¸Šï¼Œè€Œåªä¼šèŠ±è´¹åœ¨æ‰§è¡Œçš„å·¥ä½œä¸Šã€‚ å½“å°†å•å…ƒç”¨äºå†…éƒ¨éœ€æ±‚æ—¶ï¼Œè¿™å¯¹äºèµ„æºçš„æœ€ä½³åˆ©ç”¨è€Œè¨€æ˜¯éå¸¸æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆ-å¿…è¦æ—¶ï¼Œä¸€å°é“æœåŠ¡å™¨ä¸Šçš„ä¸€å †å•å…ƒå¯ä»¥å„è‡ªå•ç‹¬ä½¿ç”¨æ•´ä¸ªæœåŠ¡å™¨èµ„æºã€‚ é‰´äºé€šå¸¸ä¸åŒçš„å­æœåŠ¡éœ€è¦é¢å¤–çš„è´¹ç”¨ã€‚ å¦‚æœæ‚¨æ­£ç¡®åœ°è®¡åˆ’å’Œå¹³è¡¡æœåŠ¡å™¨ä¹‹é—´çš„å•å…ƒï¼Œåˆ™å¯ä»¥åœ¨ä¸åŒæ—¶é—´ä½¿ç”¨èµ„æºï¼Œä»ä¸€å°æœåŠ¡å™¨ä¸­è·å¾—æœ€å¤§æ€§èƒ½ã€‚ å¦‚æœ‰å¿…è¦ï¼Œå•å…ƒä¹Ÿå¯ä»¥è®¾ç½®å·²ä½¿ç”¨èµ„æºçš„é™åˆ¶ã€‚ </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/95c/817/901/95c8179015447a58c383f4a4a81a510d.gif" alt="å›¾ç‰‡"></p><br><p>  <strong>å®Œå…¨è™šæ‹ŸåŒ–åˆå¦‚ä½•å‘¢ï¼Ÿ</strong> </p><br><p> æ®æˆ‘æ‰€çŸ¥ï¼Œ <code>cbsd</code>æ”¯æŒ<code>bhyve</code>å’ŒXENè™šæ‹Ÿæœºç®¡ç†ç¨‹åºçš„å·¥ä½œã€‚ æˆ‘ä»æœªä½¿ç”¨è¿‡ç¬¬äºŒä¸ªï¼Œä½†ç¬¬ä¸€ä¸ªæ˜¯<a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">FreeBSD</a>ç›¸å¯¹è¾ƒå¹´è½»çš„<a href="https://www.freebsd.org/doc/handbook/virtualization-host-bhyve.html">è™šæ‹Ÿæœºç®¡ç†ç¨‹åº</a> ã€‚ æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­æŸ¥çœ‹ä¸€ä¸ªä½¿ç”¨<code>bhyve</code>çš„ç¤ºä¾‹ã€‚ </p><br><p>  <strong>å®‰è£…å’Œé…ç½®ä¸»æœºç¯å¢ƒ</strong> </p><br><p> æˆ‘ä»¬ä½¿ç”¨FS <a href="https://www.freebsd.org/doc/handbook/zfs.html">ZFS</a> ã€‚ è¿™æ˜¯ç”¨äºç®¡ç†æœåŠ¡å™¨ç©ºé—´çš„æå…¶å¼ºå¤§çš„å·¥å…·ã€‚ å€ŸåŠ©ZFSï¼Œæ‚¨å¯ä»¥ç›´æ¥ä»ç£ç›˜ç›´æ¥æ„å»ºå„ç§é…ç½®çš„é˜µåˆ—ï¼ŒåŠ¨æ€æ‰©å±•â€œçƒ­â€ç©ºé—´ï¼Œæ›´æ¢æ­»ç£ç›˜ï¼Œç®¡ç†å¿«ç…§ä»¥åŠè®¸å¤šå…¶ä»–å¯ä»¥åœ¨ä¸€ç³»åˆ—æ–‡ç« ä¸­æè¿°çš„å†…å®¹ã€‚ è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨åŠå…¶ç£ç›˜ã€‚ åœ¨ç£ç›˜ä¸Šå¼€å§‹å®‰è£…æ—¶ï¼Œæˆ‘ä»¬ä¸ºåŠ å¯†åˆ†åŒºç•™å‡ºäº†å¯ç”¨ç©ºé—´ã€‚ ä¸ºä»€ä¹ˆè¿™æ · è¿™æ ·ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å¯åŠ¨å¹¶ä¾¦å¬SSHã€‚ </p><br><p> <code>gpart add -t freebsd-zfs /dev/ada0</code> </p> <br><p> <code>/dev/ada0p4 added!</code> </p> <br><p> å°†ç£ç›˜åˆ†åŒºæ·»åŠ åˆ°å‰©ä½™ç©ºé—´ </p><br><p> <code>geli init /dev/ada0p4</code> </p> <br><p> é©±åŠ¨æˆ‘ä»¬çš„åŠ å¯†å¯†ç  </p><br><p> <code>geli attach /dev/ada0p4</code> </p> <br><p> å†æ¬¡è¾“å…¥å¯†ç ï¼Œæˆ‘ä»¬æœ‰äº†è®¾å¤‡/dev/ada0p4.eli-è¿™æ˜¯æˆ‘ä»¬çš„åŠ å¯†ç©ºé—´ã€‚ ç„¶åï¼Œå¯¹/ dev / ada1å’Œé˜µåˆ—ä¸­çš„å…¶ä»–ç£ç›˜é‡å¤ç›¸åŒçš„æ“ä½œã€‚ å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„<a href="https://www.freebsd.org/doc/handbook/zfs-zpool.html">ZFSæ± </a> ã€‚ </p><br><p>  <code>zpool create vms mirror /dev/ada0p4.eli /dev/ada1p4.eli /dev/ada3p4.eli</code>å¥½ï¼Œç°åœ¨æˆ‘ä»¬å·²å‡†å¤‡å¥½æœ€ä½é™åº¦çš„æˆ˜æ–—ã€‚ å¦‚æœä¸‰ä¸ªç£ç›˜ä¹‹ä¸€å‘ç”Ÿæ•…éšœï¼Œåˆ™ä¸ºé•œåƒç£ç›˜é˜µåˆ—ã€‚ </p><br><p> åœ¨æ–°çš„â€œæ± â€ä¸Šåˆ›å»ºæ•°æ®é›† </p><br><p> <code>zfs create vms/jails</code> </p> <br><p>  <code>pkg install cbsd</code>è¿è¡Œå‘½ä»¤ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„å•å…ƒå®‰è£…ç®¡ç†ã€‚ </p><br><p> å®‰è£…<code>cbsd</code>ä¹‹åï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼š </p><br><p> <code># env workdir="/vms/jails" /usr/local/cbsd/sudoexec/initenv</code> </p> <br><p> å¥½å§ï¼Œæˆ‘ä»¬å›ç­”äº†å¾ˆå¤šé—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹å¤§å¤šæ•°éƒ½æ˜¯ç­”æ¡ˆã€‚ </p><br><p>  *å¦‚æœæ‚¨ä½¿ç”¨åŠ å¯†ï¼Œé‚£ä¹ˆåœ¨æ‰‹åŠ¨æˆ–è‡ªåŠ¨è§£å¯†ç£ç›˜ä¹‹å‰<code>cbsdd</code>å®ˆæŠ¤ç¨‹åº<code>cbsdd</code>è‡ªåŠ¨å¯åŠ¨å¾ˆé‡è¦ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œ <code>cbsdd</code> ï¼‰ </p><br><p>  **å¦å¤–ï¼Œæˆ‘ä¸ä½¿ç”¨<code>cbsd</code> NATï¼Œè€Œæ˜¯è‡ªå·±åœ¨<code>pf</code>é…ç½®å®ƒã€‚ </p><br><p> <code># sysrc pf_enable=YES</code> </p> <br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">IF_PUBLIC="em0" IP_PUBLIC="1.23.34.56" JAIL_IP_POOL="192.168.0.0/24" #WHITE_CL="{ 127.0.0.1 }" icmp_types="echoreq" set limit { states 20000, frags 20000, src-nodes 20000 } set skip on lo0 scrub in all #NAT for jails nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC ## Bitcoin network port forward IP_JAIL="192.168.0.1" PORT_JAIL="{8333}" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p> <code># service pf start</code> </p> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p> é…ç½®é˜²ç«å¢™ç­–ç•¥ä¹Ÿæ˜¯ä¸€ä¸ªå•ç‹¬çš„ä¸»é¢˜ï¼Œå› æ­¤ï¼Œæˆ‘ä¸ä¼šæ›´æ·±å…¥åœ°é…ç½®â€œå…¨éƒ¨é˜»æ­¢â€ç­–ç•¥å’Œè®¾ç½®ç™½åå•ï¼›æ‚¨å¯ä»¥é€šè¿‡é˜…è¯»<a href="https://www.freebsd.org/doc/handbook/firewalls-pf.html">å®˜æ–¹æ–‡æ¡£</a>æˆ–Googleä¸Šæä¾›çš„å¤§é‡æ–‡ç« ä¸­çš„ä»»ä½•ä¸€ç§æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ </p><br><p> å¥½å§...æˆ‘ä»¬å·²ç»å®‰è£…äº†cbsdï¼Œæ˜¯æ—¶å€™åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€åŒ¹ä¸»åŠ›é©¬äº†-ä¸€ä¸ªå…³åœ¨ç¬¼å­é‡Œçš„æ¯”ç‰¹å¸æ¶é­”ï¼ </p><br><p> <code>cbsd jconstruct-tui</code> </p> <br><p><img src="https://habrastorage.org/webt/jf/yn/l5/jfynl5o0yozaua314r4e65yxy0y.png"></p><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å•å…ƒæ ¼åˆ›å»ºå¯¹è¯æ¡†ã€‚ è®¾ç½®æ‰€æœ‰å€¼åï¼Œåˆ›å»ºï¼ </p><br><p> åˆ›å»ºç¬¬ä¸€ä¸ªå•å…ƒæ ¼æ—¶ï¼Œåº”é€‰æ‹©ç”¨ä½œå•å…ƒæ ¼åŸºç¡€çš„å†…å®¹ã€‚ æˆ‘ä½¿ç”¨<code>repo</code>å‘½ä»¤ä»FreeBSDä»“åº“ä¸­é€‰æ‹©å‘è¡Œå¥—ä»¶ã€‚ ä»…å½“åˆ›å»ºç‰¹å®šç‰ˆæœ¬çš„ç¬¬ä¸€ä¸ªå•å…ƒæ ¼æ—¶æ‰åšå‡ºæ­¤é€‰æ‹©ï¼ˆæ‚¨å¯ä»¥æ‰˜ç®¡æ¯”ä¸»æœºç‰ˆæœ¬æ›´æ—©çš„ä»»ä½•ç‰ˆæœ¬çš„å•å…ƒæ ¼ï¼‰ã€‚ </p><br><p> å®‰è£…å®Œæ‰€æœ‰ç»„ä»¶å-è¿è¡Œå•å…ƒï¼ </p><br><p> <code># cbsd jstart bitcoind</code> </p> <br><p> ä½†æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ç¬¼å­é‡Œå®‰è£…è½¯ä»¶ã€‚ </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind</code> </pre> <br><p>  <code>jexec bitcoind</code>è¿›å…¥å•å…ƒæ§åˆ¶å° </p><br><p> å¹¶ä¸”å·²ç»åœ¨å•å…ƒå†…éƒ¨å®‰è£…äº†å…·æœ‰ç›¸å…³æ€§çš„è½¯ä»¶ï¼ˆæˆ‘ä»¬çš„ä¸»æœºç³»ç»Ÿä¿æŒå¹²å‡€ï¼‰ </p><br><p> <code>bitcoind:/@[15:25] # pkg install bitcoin-daemon bitcoin-utils</code> </p> <br><p> <code>bitcoind:/@[15:30] # sysrc bitcoind_enable=YES</code> </p> <br><p> <code>bitcoind:/@[15:30] # service bitcoind start</code> </p> <br><p> å•å…ƒä¸­æœ‰æ¯”ç‰¹å¸ï¼Œä½†æˆ‘ä»¬éœ€è¦åŒ¿åï¼Œå› ä¸ºæˆ‘ä»¬æƒ³é€šè¿‡TOPç½‘ç»œè¿æ¥åˆ°æŸäº›å•å…ƒã€‚ ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬è®¡åˆ’ä»…é€šè¿‡ä»£ç†ä¸ºå¤§å¤šæ•°å•å…ƒæä¾›å¯ç–‘è½¯ä»¶ã€‚ å¤šäºäº†<code>pf</code>æ‚¨å¯ä»¥ä¸ºæœ¬åœ°ç½‘ç»œä¸Šç‰¹å®šèŒƒå›´çš„IPåœ°å€ç¦ç”¨NATï¼Œè€Œä»…å¯¹æˆ‘ä»¬çš„TORèŠ‚ç‚¹å…è®¸NATã€‚ å› æ­¤ï¼Œå³ä½¿æ¶æ„è½¯ä»¶è¿›å…¥è¯¥å•å…ƒï¼Œå®ƒå¾ˆå¯èƒ½ä¹Ÿä¸ä¼šä¸å¤–ç•Œè”ç³»ï¼Œå³ä½¿è¿™æ ·åšï¼Œä¹Ÿä¸ä¼šæ³„éœ²æˆ‘ä»¬æœåŠ¡å™¨çš„IPã€‚ å› æ­¤ï¼Œæˆ‘ä»¬åˆåˆ›å»ºäº†ä¸€ä¸ªå•å…ƒï¼Œç”¨äºå°†â€œè½¬å‘â€æœåŠ¡ä½œä¸ºâ€œ .onionâ€æœåŠ¡ï¼Œå¹¶ä½œä¸ºè®¿é—®Internetåˆ°å„ä¸ªå•å…ƒçš„ä»£ç†ã€‚ </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart tor</code> </p> <br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[15:38] # pkg install tor</code> </p> <br><p> <code>tor:/@[15:38] # sysrc tor_enable=YES</code> </p> <br><p> <code>tor:/@[15:38] # ee /usr/local/etc/tor/torrc</code> </p> <br><p> æˆ‘ä»¬åœ¨æœ¬åœ°åœ°å€ä¸Šç›‘å¬ï¼ˆé€‚ç”¨äºæ‰€æœ‰å•å…ƒï¼‰ </p><br><p> <code>SOCKSPort 192.168.0.2:9050</code> </p> <br><p> ä¸ºäº†å®Œå…¨çš„å¹¸ç¦ï¼Œæˆ‘ä»¬ä»ç„¶ç¼ºå°‘ä»€ä¹ˆã€‚ æ˜¯çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„ç½‘ç«™æä¾›æœåŠ¡ï¼Œä¹Ÿè®¸ä¸éœ€è¦ã€‚ è¿è¡Œnginxï¼Œå®ƒå°†å……å½“åå‘ä»£ç†å¹¶è´Ÿè´£ç»­è®¢â€œè®©æˆ‘ä»¬åŠ å¯†â€è¯ä¹¦ </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart nginx-rev</code> </p> <br><p> <code># jexec nginx-rev</code> </p> <br><p> <code>nginx-rev:/@[15:47] # pkg install nginx py36-certbot</code> </p> <br><p>  <em>ç°åœ¨ï¼Œæˆ‘ä»¬å°†150 MBçš„ä¾èµ–é¡¹æ”¾å…¥ç¬¼ä¸­ã€‚</em>  <em>è€Œä¸”ä¸»æœºè¿˜æ˜¯å¹²å‡€çš„ã€‚</em> </p><br><p> è®©æˆ‘ä»¬ç¨åå†é…ç½®nginxï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæˆ‘ä»¬çš„åˆ°nodejså’Œrustçš„æ”¯ä»˜ç½‘å…³ä»¥åŠä¸€ä¸ªWebåº”ç”¨ç¨‹åºå†å¢åŠ ä¸¤ä¸ªå•å…ƒï¼Œç”±äºæŸäº›åŸå› ï¼Œå®ƒä»¬ä½äºapacheå’Œpkhpä¸Šï¼Œåè€…ä¹Ÿéœ€è¦MySQLæ•°æ®åº“ã€‚ </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart paygw</code> </p> <br><p> <code># jexec paygw</code> </p> <br><p> <code>paygw:/@[15:55] # pkg install git node npm</code> </p> <br><p> <code>paygw:/@[15:55] # curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh</code> </p> <br><p>  <em>...ä»¥åŠéš”ç¦»çš„380 MBè½¯ä»¶åŒ…</em> </p><br><p> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨gitæŠ½è¿æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶è¿è¡Œå®ƒã€‚ </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart webapp</code> </p> <br><p> <code># jexec webapp</code> </p> <br><p> <code>webapp:/@[16:02] # pkg install mariadb104-server apache24 php74 mod_php74 php74-pdo_mysql</code> </p> <br><p>  <em>450 MBè½¯ä»¶åŒ…ã€‚</em>  <em>åœ¨ç¬¼å­é‡Œã€‚</em> </p><br><p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸ºå¼€å‘äººå‘˜æä¾›äº†é€šè¿‡SSHç›´æ¥è®¿é—®è¯¥å•å…ƒçš„æƒé™ï¼Œä»–ä»¬å°†åœ¨é‚£é‡Œåšæ‰€æœ‰äº‹æƒ…ï¼š </p><br><p> <code>webapp:/@[16:02] # ee /etc/ssh/sshd_config</code> </p> <br><p>  <code>Port 2267</code>å°†SSHå•å…ƒçš„ç«¯å£æ›´æ”¹ä¸ºä»»æ„ç«¯å£ </p><br><p> <code>webapp:/@[16:02] # sysrc sshd_enable=YES</code> </p> <br><p> <code>webapp:/@[16:02] # service sshd start</code> </p> <br><p> å¥½äº†ï¼Œè¯¥æœåŠ¡æ­£åœ¨è¿è¡Œï¼Œå®ƒä»ç„¶éœ€è¦åœ¨<code>pf</code>é˜²ç«å¢™ä¸­æ·»åŠ è§„åˆ™ </p><br><p> è®©æˆ‘ä»¬çœ‹çœ‹å•å…ƒä¸­æ‹¥æœ‰çš„IPä»¥åŠâ€œ lokalkaâ€çš„å¤–è§‚ </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp</code> </pre> <br><p> å¹¶æ·»åŠ ä¸€æ¡è§„åˆ™ </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><pre> <code class="plaintext hljs">## SSH for web-Devs IP_JAIL="192.168.0.5" PORT_JAIL="{ 2267 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre><br><p> å¥½å§ï¼Œç”±äºæˆ‘ä»¬åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†åœ¨åå‘ä»£ç†ä¸­æ·»åŠ ç›¸åŒçš„è§„åˆ™ï¼š </p><br><pre> <code class="plaintext hljs">## web-ports for nginx-rev IP_JAIL="192.168.0.3" PORT_JAIL="{ 80, 443 }" rdr pass on $IF_PUBLIC proto tcp from any to $IP_PUBLIC port $PORT_JAIL -&gt; $IP_JAIL</code> </pre> <br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p>  <strong>å¥½å§ï¼Œç°åœ¨æœ‰å…³æ¯”ç‰¹å¸çš„ä¸€äº›çŸ¥è¯†</strong> </p><br><p> æˆ‘ä»¬æ‰€æ‹¥æœ‰çš„-æˆ‘ä»¬æœ‰ä¸€ä¸ªå¯ä»å¤–éƒ¨è®¿é—®çš„Webåº”ç”¨ç¨‹åºï¼Œå®ƒä¸æˆ‘ä»¬çš„ä»˜æ¬¾ç½‘å…³è¿›è¡Œæœ¬åœ°é€šä¿¡ã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸€ä¸ªä¸æ¯”ç‰¹å¸ç½‘ç»œæœ¬èº«è¿›è¡Œäº¤äº’çš„å·¥ä½œç¯å¢ƒ-æ¯”ç‰¹å¸èŠ‚ç‚¹åªæ˜¯ä¸€ä¸ªå®ˆæŠ¤ç¨‹åºï¼Œå®ƒæ”¯æŒå½“å‰åŒºå—é“¾çš„æœ¬åœ°å‰¯æœ¬ã€‚ è¯¥å®ˆæŠ¤ç¨‹åºå…·æœ‰RPCå’Œé’±å¤¹åŠŸèƒ½ï¼Œä½†æ˜¯æœ‰ä¸€äº›æ›´æ–¹ä¾¿çš„â€œåŒ…è£…å™¨â€ç”¨äºå¼€å‘åº”ç”¨ç¨‹åºã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬å†³å®š<code>electrum</code> -è¿™æ˜¯ä¸€ä¸ªCLIé’±åŒ…ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨<a href="https://electrum.org/">æ­¤é’±åŒ…</a>ä½œä¸ºæ¯”ç‰¹å¸çš„â€œå†·å­˜å‚¨â€-é€šå¸¸ï¼Œé‚£äº›æ¯”ç‰¹å¸éœ€è¦å­˜å‚¨åœ¨ç”¨æˆ·å¯è®¿é—®çš„ç³»ç»Ÿå¤–éƒ¨ï¼Œå¹¶ä¸”é€šå¸¸è¿œç¦»æ‰€æœ‰äººã€‚ ä»–è¿˜å…·æœ‰GUIï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„é’±åŒ…ä¸­ä½¿ç”¨ç›¸åŒçš„é’±åŒ… <br> ç¬”è®°æœ¬ç”µè„‘ã€‚ è™½ç„¶æˆ‘ä»¬å°†electrumä¸å…¬å…±æœåŠ¡å™¨ä¸€èµ·ä½¿ç”¨ï¼Œä½†ç¨ååœ¨å¦ä¸€ä¸ªå•å…ƒä¸­ï¼Œæˆ‘ä»¬å°†å¼•å‘<a href="https://github.com/kyuupichan/electrumx">ElectrumX</a> ï¼Œä»¥ä½¿å®ƒå®Œå…¨ä¸ä¾èµ–ä»»ä½•äººã€‚ </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart electrum</code> </p> <br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[8:45] # pkg install py36-electrum</code> </p> <br><p>  <em>æˆ‘ä»¬ç¬¼å­ä¸­è¿˜æœ‰700 MBçš„è½¯ä»¶</em> </p><br><p> <code>electrum:/@[8:53] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: wallet Full name: Uid (Leave empty for default): Login group [wallet]: Login group is wallet. Invite wallet into other groups? []: Login class [default]: Shell (sh csh tcsh nologin) [sh]: tcsh Home directory [/home/wallet]: Home directory permissions (Leave empty for default): Use password-based authentication? [yes]: no Lock out the account after creation? [no]: Username : wallet Password : &lt;disabled&gt; Full Name : Uid : 1001 Class : Groups : wallet Home : /home/wallet Home Mode : Shell : /bin/tcsh Locked : no OK? (yes/no): yes adduser: INFO: Successfully added (wallet) to the user database. Add another user? (yes/no): no Goodbye! electrum:/@[8:53] # su wallet</code> </pre> <br><p> <code>electrum:/@[8:53] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % electrum-3.6 create</code> </p> <br><pre> <code class="plaintext hljs">{ "msg": "Please keep your seed in a safe place; if you lose it, you will not be able to restore your wallet.", "path": "/usr/home/wallet/.electrum/wallets/default_wallet", "seed": "jealous win pig material ribbon young punch visual okay cactus random bird" }</code> </pre> <br><p> ç°åœ¨æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªé’±åŒ…ã€‚ </p><br><p> <code>wallet@electrum:/ % electrum-3.6 listaddresses</code> </p> <br><pre> <code class="plaintext hljs">[ "18WEhbjvMLGRMfwudzUrUd25U5C7uZYkzE", "14XHSejhxsZNDRtk4eFbqAX3L8rftzwQQU", "1KQXaN8RXiCN1ne9iYngUWAr6KJ6d4pPas", ... "1KeVcAwEYhk29qEyAfPwcBgF5mMMoy4qjw", "18VaUuSeBr6T2GwpSHYF3XyNgLyLCt1SWk" ]</code> </pre> <br><p> <code>wallet@electrum:/ % electrum-3.6 help</code> </p> <br><p> ä»ç°åœ¨å¼€å§‹ï¼Œåªæœ‰ä¸€å°éƒ¨åˆ†äººèƒ½å¤Ÿè¿æ¥åˆ°æˆ‘ä»¬<em>çš„é“¾ä¸Š</em>é’±åŒ…ã€‚ ä¸ºäº†ä¸ä»å¤–éƒ¨æ‰“å¼€å¯¹è¯¥å•å…ƒçš„è®¿é—®ï¼ŒSSHè¿æ¥å°†é€šè¿‡TORï¼ˆè¿™ç§VPNçš„åˆ†æ•£ç‰ˆæœ¬ï¼‰å»ºç«‹ã€‚ æˆ‘ä»¬åœ¨å•å…ƒä¸­å¯åŠ¨SSHï¼Œä½†ä¸è¦è§¦æ‘¸ä¸»æœºä¸Šçš„pf.confã€‚ </p><br><p> <code>electrum:/@[9:00] # sysrc sshd_enable=YES</code> </p> <br><p> <code>electrum:/@[9:00] # service sshd start</code> </p> <br><p> ç°åœ¨ï¼Œå…³é—­å¯¹å¸¦æœ‰é’±åŒ…çš„å•å…ƒçš„Internetè®¿é—®ã€‚ æˆ‘ä»¬å°†ä»å¦ä¸€ä¸ªä¸åŸºäºNATçš„å­ç½‘ç©ºé—´ä¸ºå®ƒæä¾›IPåœ°å€ã€‚ é¦–å…ˆï¼Œåœ¨ä¸»æœºä¸Šæ›´æ”¹<code>/etc/pf.conf</code> </p><br><p> <code># ee /etc/pf.conf</code> </p> <br><p>  <code>JAIL_IP_POOL="192.168.0.0/24"</code>æ›´æ”¹ä¸º<code>JAIL_IP_POOL="192.168.0.0/25"</code> ï¼Œå› æ­¤æ‰€æœ‰åœ°å€192.168.0.126-255å°†æ— æ³•ç›´æ¥è®¿é—®Internetã€‚ ä¸€ç§è½¯ä»¶â€œæ°”éš™â€ç½‘ç»œã€‚  NATè§„åˆ™ä¿æŒä¸å˜ </p><br><p> <code>nat pass on $IF_PUBLIC from $JAIL_IP_POOL to any -&gt; $IP_PUBLIC</code> </p> <br><p> é‡è½½è§„åˆ™ </p><br><p> <code># pfctl -f /etc/pf.conf</code> </p> <br><p> ç°åœ¨å¸¦ä¸Šæˆ‘ä»¬çš„ç¬¼å­ </p><br><p> <code># cbsd jconfig jname=electrum</code> </p> <br><p><img src="https://habrastorage.org/webt/mj/zo/ui/mjzouia2v_lhuzln_o9inimlwca.png"></p><br><p><img src="https://habrastorage.org/webt/_x/7-/c9/_x7-c9zdmlojjeqrpzfmv2j5fpc.png"></p><br><pre> <code class="plaintext hljs">jset mode=quiet jname=electrum ip4_addr="192.168.0.200" Remove old IP: /sbin/ifconfig em0 inet 192.168.0.6 -alias Setup new IP: /sbin/ifconfig em0 inet 192.168.0.200 alias ip4_addr: 192.168.0.200</code> </pre> <br><p> å—¯ï¼Œä½†æ˜¯ç°åœ¨ç³»ç»Ÿæœ¬èº«å°†åœæ­¢ä¸ºæˆ‘ä»¬å·¥ä½œã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šç³»ç»Ÿä»£ç†ã€‚ ä½†æ˜¯æœ‰ä¸€ä»¶äº‹ï¼Œä½†æ˜¯ï¼Œåœ¨TORä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªSOCKS5ä»£ç†ï¼Œä¸ºæ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸€ä¸ªHTTPä»£ç†ã€‚ </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart polipo</code> </p> <br><p> <code># jexec polipo</code> </p> <br><p> <code>polipo:/@[9:28] # pkg install polipo</code> </p> <br><p> <code>polipo:/@[9:28] # ee /usr/local/etc/polipo/config</code> </p> <br><pre> <code class="plaintext hljs">socksParentProxy = "192.168.0.2:9050" socksProxyType = socks5</code> </pre> <br><p> <code>polipo:/@[9:42] # sysrc polipo_enable=YES</code> </p> <br><p> <code>polipo:/@[9:43] # service polipo start</code> </p> <br><p> å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­æœ‰ä¸¤ä¸ªä»£ç†ï¼Œå¹¶ä¸”éƒ½é€šè¿‡TORè¾“å‡ºï¼šsocks5ï¼š//192.168.0.2ï¼š9050å’Œ<a href="http://192.168.0.6:8123/">http://192.168.0.6:8123</a> </p><br><p> ç°åœ¨æ‚¨å¯ä»¥è‡ªå®šä¹‰æˆ‘ä»¬é’±åŒ…çš„ç¯å¢ƒ </p><br><p> <code># jexec electrum</code> </p> <br><p> <code>electrum:/@[9:45] # su wallet</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.cshrc</code> </p> <br><pre> <code class="plaintext hljs">#in the end of file proxy config setenv http_proxy http://192.168.0.6:8123 setenv https_proxy http://192.168.0.6:8123</code> </pre> <br><p> å¥½äº†ï¼Œç°åœ¨å¤–å£³ç¨‹åºå¯ä»¥åœ¨ä»£ç†ä¸‹å·¥ä½œäº†ã€‚ å¦‚æœè¦å®‰è£…è½¯ä»¶åŒ…ï¼Œåˆ™å€¼å¾—ä»å•å…ƒæ ¹ç›®å½•ä¸‹å°†å…¶æ·»åŠ åˆ°<code>/usr/local/etc/pkg.conf</code> </p><br><pre> <code class="plaintext hljs">pkg_env: { http_proxy: "http://my_proxy_ip:8123", }</code> </pre> <br><p> å¥½äº†ï¼Œç°åœ¨æ˜¯æ—¶å€™åœ¨é’±åŒ…å•å…ƒä¸­æ·»åŠ TORéšè—æœåŠ¡ä½œä¸ºSSHæœåŠ¡çš„åœ°å€äº†ã€‚ </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/electrum/ HiddenServicePort 22 192.168.0.200:22</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/electrum</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/electrum/hostname</code> </p> <br><pre> <code class="plaintext hljs">mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion</code> </pre> <br><p> è¿™æ˜¯æˆ‘ä»¬çš„è¿æ¥åœ°å€ã€‚ è®©æˆ‘ä»¬ä»æœ¬åœ°æœºå™¨æ£€æŸ¥ã€‚ ä½†æ˜¯é¦–å…ˆï¼Œæ‚¨éœ€è¦æ·»åŠ æˆ‘ä»¬çš„SSHå¯†é’¥ï¼š </p><br><p> <code>wallet@electrum:/ % mkdir ~/.ssh</code> </p> <br><p> <code>wallet@electrum:/ % ee ~/.ssh/authorized_keys</code> </p> <br><pre> <code class="plaintext hljs">ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1MjEAAACFBAG9Fk2Lqi4GQ8EXZrsH3EgSrVIQPQaAlS38MmJLBabihv9KHIDGXH7r018hxqLNNGbaJWO/wrWk7sG4T0yLHAbdQAFsMYof9kjoyuG56z0XZ8qaD/X/AjrhLMsIoBbUNj0AzxjKNlPJL4NbHsFwbmxGulKS0PdAD5oLcTQi/VnNdU7iFw== user@local</code> </pre> <br><p> å¥½äº†ï¼Œä»å®¢æˆ·ç«¯Linuxæœºå™¨ </p><br><p> <code>user@local ~$ nano ~/.ssh/config</code> </p> <br><pre> <code class="plaintext hljs">#remote electrum wallet Host remotebtc User wallet Port 22 Hostname mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion ProxyCommand /bin/ncat --proxy localhost:9050 --proxy-type socks5 %h %p</code> </pre><br><p> è¿æ¥<em>ï¼ˆè¦æ­£å¸¸å·¥ä½œï¼Œæ‚¨éœ€è¦ä¸€ä¸ªæœ¬åœ°TORå®ˆæŠ¤ç¨‹åºï¼Œè¯¥å®ˆæŠ¤ç¨‹åºåœ¨9050ä¸Šä¾¦å¬ï¼‰</em> </p><br><p> <code>user@local ~$ ssh remotebtc</code> </p> <br><pre> <code class="plaintext hljs">The authenticity of host 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion (&lt;no hostip for proxy command&gt;)' can't be established. ECDSA key fingerprint is SHA256:iW8FKjhVF4yyOZB1z4sBkzyvCM+evQ9cCL/EuWm0Du4. Are you sure you want to continue connecting (yes/no/[fingerprint])? yes Warning: Permanently added 'mdjus4gmduhofwcso57b3zl3ufoitguh2knitjco5cmgrokpreuxumad.onion' (ECDSA) to the list of known hosts. FreeBSD 12.1-RELEASE-p1 GENERIC To save disk space in your home directory, compress files you rarely use with "gzip filename". -- Dru &lt;genesis@istar.ca&gt; wallet@electrum:~ % logout</code> </pre><br><p> æˆåŠŸï¼ </p><br><p> è¦ä½¿ç”¨å³æ—¶ä»˜æ¬¾å’Œå°é¢ä»˜æ¬¾ï¼Œæˆ‘ä»¬è¿˜éœ€è¦<a href="https://www.lopp.net/lightning-information.html">é—ªç”µç½‘ç»œ</a>èŠ‚ç‚¹ï¼Œå®é™…ä¸Šï¼Œè¿™å°†æ˜¯æˆ‘ä»¬ä½¿ç”¨æ¯”ç‰¹å¸çš„ä¸»è¦å·¥å…·ã€‚  *æˆ‘ä»¬å°†ç”¨ä½œå®ˆæŠ¤ç¨‹åºçš„<a href="https://github.com/ElementsProject/lightning">C-lightning</a>å…·æœ‰<a href="https://github.com/fiatjaf/sparko">ä¸€ä¸ªSparkoæ’ä»¶</a> ï¼Œå®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„HTTPï¼ˆRESTï¼‰æ¥å£ï¼Œå¹¶å…è®¸å¤„ç†é“¾ä¸‹äº¤æ˜“å’Œé“¾ä¸Šäº¤æ˜“ã€‚  <code>c-lightning</code>éœ€è¦ä¸€ä¸ª<code>bitcoind</code>èŠ‚ç‚¹æ‰èƒ½èµ·ä½œç”¨ã€‚ </p><br><p>  * <em>åœ¨é—ªç”µç½‘ç»œåè®®çš„ä¸åŒPLä¸Šæœ‰ä¸åŒçš„å®ç°ã€‚</em>  <em>åœ¨æˆ‘ä»¬æµ‹è¯•è¿‡çš„c-lightningï¼ˆç”¨Cè¯­è¨€ç¼–å†™ï¼‰ä¸­ï¼Œä¼¼ä¹æœ€ç¨³å®šï¼Œèµ„æºæ•ˆç‡æœ€é«˜</em> </p><br><p> <code># cbsd jsconstruct-tui</code> </p> <br><p> <code># cbsd jstart cln</code> </p> <br><p> <code># jexec cln</code> </p> <br><p> <code>lightning:/@[10:23] # adduser</code> </p> <br><pre> <code class="plaintext hljs">Username: lightning ...</code> </pre> <br><p> <code>lightning:/@[10:24] # pkg install git</code> </p> <br><p> <code>lightning:/@[10:23] # su lightning</code> </p> <br><p> <code>cd ~ &amp;&amp; git clone https://github.com/ElementsProject/lightning</code> </p> <br><p> <code>lightning@lightning:~ % exit</code> </p> <br><p> <code>lightning:/@[10:30] # cd /home/lightning/lightning/</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:31] # pkg install autoconf automake gettext git gmp gmake libtool python python3 sqlite3 libsodium py36-mako bash bitcoin-utils</code> </p> <br><p> <code>lightning:/home/lightning/lightning@[10:34] # ./configure &amp;&amp; gmake &amp;&amp; gmake install</code> </p> <br><p> ç¼–è¯‘å¹¶å®‰è£…æ‰€éœ€çš„ä¸€åˆ‡åï¼Œåœ¨<code>bitcoind</code>ä¸º<code>lightningd</code>åˆ›å»ºRPCç”¨æˆ· </p><br><p> <code># jexec bitcoind</code> </p> <br><p> <code>bitcoind:/@[10:36] # ee /usr/local/etc/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcbind=192.168.0.1 rpcuser=test rpcpassword=test #allow only c-lightning rpcallowip=192.168.0.7/32</code> </pre> <br><p> <code>bitcoind:/@[10:39] # service bitcoind restart</code> </p> <br><p>  <em>å¦‚æœæ‚¨æ³¨æ„åˆ°<code>tmux</code>å®ç”¨ç¨‹åºï¼Œé‚£ä¹ˆæˆ‘åœ¨å•å…ƒæ ¼ä¹‹é—´çš„æ··ä¹±åˆ‡æ¢å°±ä¸ä¼šé‚£ä¹ˆæ··ä¹±äº†ï¼Œå®ƒå…è®¸æ‚¨åœ¨ä¸€ä¸ªä¼šè¯ä¸­åˆ›å»ºç»ˆç«¯çš„è®¸å¤šå­ä¼šè¯ã€‚</em>  <em>æ¨¡æ‹Ÿï¼š <code>screen</code></em> </p><br><p><img src="https://habrastorage.org/webt/xu/cz/14/xucz14wosjbbeme4iis8ws4nxq8.png"></p><br><p> è…Šè‚ çŠ¬ï¼Œæˆ‘ä»¬ä¸æƒ³é€éœ²èŠ‚ç‚¹çš„çœŸå®IPï¼Œè€Œæ˜¯å¸Œæœ›é€šè¿‡TOPè¿›è¡Œæ‰€æœ‰é‡‘èäº¤æ˜“ã€‚ å› æ­¤ï¼Œæ‚¨è¿˜éœ€è¦ä¸€ä¸ªæ´‹è‘±ã€‚ </p><br><p> <code># jexec tor</code> </p> <br><p> <code>tor:/@[9:59] # ee /usr/local/etc/tor/torrc</code> </p> <br><pre> <code class="plaintext hljs">HiddenServiceDir /var/db/tor/cln/ HiddenServicePort 9735 192.168.0.7:9735</code> </pre> <br><p> <code>tor:/@[10:01] # mkdir /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chown -R _tor:_tor /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:01] # chmod 700 /var/db/tor/cln</code> </p> <br><p> <code>tor:/@[10:03] # service tor restart</code> </p> <br><p> <code>tor:/@[10:04] # cat /var/db/tor/cln/hostname</code> </p> <br><pre> <code class="plaintext hljs">en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion</code> </pre> <br><p> ç°åœ¨ä¸ºc-lightningåˆ›å»ºä¸€ä¸ªé…ç½® </p><br><p> <code>lightning:/home/lightning/lightning@[10:31] # su lightning</code> </p> <br><p> <code>lightning@lightning:~ % mkdir .lightning</code> </p> <br><p> <code>lightning@lightning:~ % ee .lightning/config</code> </p> <br><pre> <code class="plaintext hljs">alias=My-LN-Node bind-addr=192.168.0.7:9735 rgb=ff0000 announce-addr=en5wbkavnytti334jc5uzaudkansypfs6aguv6kech4hbzpcz2ove3yd.onion:9735 network=bitcoin log-level=info fee-base=0 fee-per-satoshi=1 proxy=192.168.0.2:9050 log-file=/home/lightning/.lightning/c-lightning.log min-capacity-sat=200000 # sparko plugin # https://github.com/fiatjaf/lightningd-gjson-rpc/tree/master/cmd/sparko sparko-host=192.168.0.7 sparko-port=9737 sparko-tls-path=sparko-tls #sparko-login=mywalletusername:mywalletpassword #sparko-keys=masterkey;secretread:+listchannels,+listnodes;secretwrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice sparko-keys=masterkey;secretread:+listchannels,+listnodes;ultrawrite:+invoice,+listinvoices,+delinvoice,+decodepay,+waitpay,+waitinvoice # for the example above the initialization logs (mixed with lightningd logs) should print something like</code> </pre> <br><p> <code>lightning@lightning:~ % mkdir .lightning/plugins</code> </p> <br><p> <code>lightning@lightning:~ % cd .lightning/plugins/</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins:% fetch https://github.com/fiatjaf/sparko/releases/download/v0.2.1/sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mkdir ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % cd ~/.lightning/sparko-tls</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl genrsa -out key.pem 2048</code> </p> <br><p> <code>lightning@lightning:~/.lightning/sparko-tls % openssl req -new -x509 -sha256 -key key.pem -out cert.pem -days 3650</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % chmod +x sparko_full_freebsd_amd64</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % mv sparko_full_freebsd_amd64 sparko</code> </p> <br><p> <code>lightning@lightning:~/.lightning/plugins % cd ~</code> </p> <br><p> æ‚¨è¿˜éœ€è¦ä¸ºbitcoin-cliåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¯¥å·¥å…·å¯ä¸<code>bitcoind</code>é€šä¿¡ </p><br><p> <code>lightning@lightning:~ % mkdir .bitcoin</code> </p> <br><p> <code>lightning@lightning:~ % ee .bitcoin/bitcoin.conf</code> </p> <br><pre> <code class="plaintext hljs">rpcconnect=192.168.0.1 rpcuser=test rpcpassword=test</code> </pre> <br><p> æ£€æŸ¥ </p><br><p> <code>lightning@lightning:~ % bitcoin-cli echo "test"</code> </p> <br><pre> <code class="plaintext hljs">[ "test" ]</code> </pre> <br><p> è¿è¡Œ<code>lightningd</code> </p><br><p> <code>lightning@lightning:~ % lightningd --daemon</code> </p> <br><p>  <code>lightning-cli</code>æœ¬èº«å¯ä»¥ç”±<code>lightning-cli</code>ç¨‹åºæ§åˆ¶ï¼Œä¾‹å¦‚ï¼š </p><br><p>  <code>lightning-cli newaddr</code> <em>è·å–æ–°æ”¶æ¬¾åœ°å€</em> </p><br><pre> <code class="plaintext hljs">{ "address": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv", "bech32": "bc1q2n2ffq3lplhme8jufcxahfrnfhruwjgx3c78pv" }</code> </pre> <br><p>  <code>lightning-cli withdraw bc1jufcxahfrnfhruwjgx3cq2n2ffq3lplhme878pv all</code> <em>å‘é€åˆ°è¯¥åœ°å€æ‰€æœ‰é’±åŒ…èµ„é‡‘ï¼ˆæ‰€æœ‰é“¾ä¸Šåœ°å€ï¼‰</em> </p><br><p> æ­¤å¤–ï¼Œè¿˜åŒ…æ‹¬é’ˆå¯¹<code>lightning-cli listinvoices</code> <code>lightning-cli invoice</code> ï¼Œ <code>lightning-cli listinvoices</code> <code>lightning-cli invoice</code> ï¼Œ <code>lightning-cli listinvoices</code> <code>lightning-cli pay</code>ç­‰é“¾ä¸‹æ“ä½œçš„å‘½ä»¤ã€‚ </p><br><p> å¥½å§ï¼Œå¯¹äºä¸åº”ç”¨ç¨‹åºçš„é€šä¿¡ï¼Œæˆ‘ä»¬æ‹¥æœ‰REST Api </p><br><p> <code>curl -k https://192.168.0.7:9737/rpc -d '{"method": "pay", "params": ["lnbc..."]}' -H 'X-Access masterkey'</code> </p> <br><p>  <strong>æ€»ç»“ä¸€ä¸‹</strong> </p><br><p> <code># jls</code> </p> <br><pre> <code class="plaintext hljs"> JID IP Address Hostname Path 1 192.168.0.1 bitcoind.space.com /zroot/jails/jails/bitcoind 2 192.168.0.2 tor.space.com /zroot/jails/jails/tor 3 192.168.0.3 nginx-rev.space.com /zroot/jails/jails/nginx-rev 4 192.168.0.4 paygw.space.com /zroot/jails/jails/paygw 5 192.168.0.5 webapp.my.domain /zroot/jails/jails/webapp 7 192.168.0.200 electrum.space.com /zroot/jails/jails/electrum 8 192.168.0.6 polipo.space.com /zroot/jails/jails/polipo 9 192.168.0.7 lightning.space.com /zroot/jails/jails/cln</code> </pre> <br><p><img src="https://habrastorage.org/webt/nt/0k/ew/nt0kewrhuin48nj-lbfk1jpa4rc.png"></p><br><p>     ,            . </p><br><p> <code># zfs list</code> </p> <br><pre> <code class="plaintext hljs">NAME USED AVAIL REFER MOUNTPOINT zroot 279G 1.48T 88K /zroot zroot/ROOT 1.89G 1.48T 88K none zroot/ROOT/default 1.89G 17.6G 1.89G / zroot/home 88K 1.48T 88K /home zroot/jails 277G 1.48T 404M /zroot/jails zroot/jails/bitcoind 190G 1.48T 190G /zroot/jails/jails-data/bitcoind-data zroot/jails/cln 653M 1.48T 653M /zroot/jails/jails-data/cln-data zroot/jails/electrum 703M 1.48T 703M /zroot/jails/jails-data/electrum-data zroot/jails/nginx-rev 190M 1.48T 190M /zroot/jails/jails-data/nginx-rev-data zroot/jails/paygw 82.4G 1.48T 82.4G /zroot/jails/jails-data/paygw-data zroot/jails/polipo 57.6M 1.48T 57.6M /zroot/jails/jails-data/polipo-data zroot/jails/tor 81.5M 1.48T 81.5M /zroot/jails/jails-data/tor-data zroot/jails/webapp 360M 1.48T 360M /zroot/jails/jails-data/webapp-data</code> </pre> <br><p>  , bitcoind   190  .          ?  ZFS   .   <code>cbsd jclone old=bitcoind new=bitcoind-clone host_hostname=clonedbtc.space.com</code>          .        ,               (   190 ) </p><br><p>       ZFS,    . <a href="https://www.freebsd.org/doc/handbook/zfs-zfs.html">ZFS   </a>     ,     SSH.    ,   . </p><br><p>        ,      <a href="https://zabbix.org/wiki/Main_Page">Zabbix</a> . </p><br><p> <strong> â€” </strong> </p><br><p>   ,        : </p><br><p> <em></em> â€”   UNIX-     .           â€” .          .           .                   .       -,             . </p><br><p> <em></em> â€”        . -       , ECC , ZFS  " "        .            .   -     . </p><br><p> <em></em> â€”   .           .           .                (     ).           ,         . </p><br><p> <em> </em> â€”            ,  .          ,               . </p><br><p>            ,     ,    ,         . </p><br><p> <strong>    ?</strong> </p><br><p>     cbsd  <a href="https://www.bsdstore.ru/en/11.2.x/wf_bcreate_ssi.html"> </a> .   ,    <code>bhyve</code>     . </p><br><p> <code># cat /etc/rc.conf</code> </p> <br><pre> <code class="plaintext hljs">... kld_list="vmm if_tap if_bridge nmdm" ...</code> </pre> <br><p> <code># cat /boot/loader.conf</code> </p> <br><pre> <code class="plaintext hljs">... vmm_load="YES" ...</code> </pre> <br><p>        ,   - debian  ! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cb6/219/ffdcb6219c701e2e114100d9601e9fea.gif"></p><br><p> <strong>  </strong> </p><br><p>       .          â€” <a href="https://sochain.com/address/BTC/bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc">bc1qu7lhf45xw83ddll5mnzte6ahju8ktkeu6qhttc</a> .          ,      <a href="https://bitclouds.sh/">pet-project</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN477124/">https://habr.com/ru/post/zh-CN477124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN477110/index.html">å¨±ä¹è®¡åˆ’</a></li>
<li><a href="../zh-CN477114/index.html">MSHè§£é‡Šå™¨å®æ–½</a></li>
<li><a href="../zh-CN477118/index.html">MIROæ˜¯ä¸€ä¸ªå¼€æ”¾çš„å®¤å†…æœºå™¨äººå¹³å°ã€‚ ç¬¬5éƒ¨åˆ†-è½¯ä»¶ç»„ä»¶ï¼šARDUINOï¼ˆAVRï¼‰ï¼Œæˆ‘ä»¬åœ¨â€œå¹•åâ€çˆ¬ä¸‹</a></li>
<li><a href="../zh-CN477120/index.html">Windowsè¿ç»­è¡€ç³–ç›‘æµ‹è½¯ä»¶</a></li>
<li><a href="../zh-CN477122/index.html">å…¬å¸çš„å¤§è„‘ã€‚ ç¬¬ä¸‰éƒ¨åˆ†</a></li>
<li><a href="../zh-CN477126/index.html">åœ¨5åˆ†é’Ÿå†…å®Œæˆç®¡ç†ã€‚ å‰ç«¯-react-adminï¼Œåç«¯-Flask-RESTful</a></li>
<li><a href="../zh-CN477128/index.html">å‘¨æœ«å“ˆå¸ƒæ‹‰ä¾¦æ¢</a></li>
<li><a href="../zh-CN477130/index.html">â€œå°¤é‡‘Â·å¥¥æ¶…é‡‘ï¼ˆEugene Oneginï¼‰â€ï¼šå€’ç½®ï¼ˆN.-F.æ•…äº‹ï¼‰</a></li>
<li><a href="../zh-CN477132/index.html">ä¿„ç½—æ–¯è”é‚¦çš„ä¸ªäººæ•°æ®ï¼šæˆ‘ä»¬éƒ½æ˜¯è°ï¼Ÿ æˆ‘ä»¬è¦å»å“ªé‡Œ</a></li>
<li><a href="../zh-CN477136/index.html">FL.ruå¦‚ä½•é€šè¿‡ä¸¤æ¬¡å‡ºå”®ä¸€é¡¹æœåŠ¡ï¼Œè¿åä»–ä»¬è‡ªå·±çš„è§„åˆ™æ¥æ¬ºéª—ç”¨æˆ·</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>