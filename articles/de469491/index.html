<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèº üñïüèæ üßê Interaktion mit dem Asterisk-Server √ºber eine Java-Anwendung üë®üèª‚Äç‚öñÔ∏è üéå üë®üèº‚Äçüéì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Interaktion mit einem Asterisk-Server von einer Java-Anwendung √ºber das Asterisk Managment Interface (AMI) 
 Wenn Sie gerade erst mit der Forschung in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interaktion mit dem Asterisk-Server √ºber eine Java-Anwendung</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469491/"><h3>  Interaktion mit einem Asterisk-Server von einer Java-Anwendung √ºber das Asterisk Managment Interface (AMI) </h3><br>  Wenn Sie gerade erst mit der Forschung in diesem Bereich beginnen, erscheint Ihnen die Interaktion mit diesem Server m√∂glicherweise etwas verwirrend, wie es mir einst erschien. <br><br>  Um nicht im Stil einer Antwortfrage in den Foren nach den erforderlichen Informationen zu suchen, f√ºge ich ein kleines Tutorial zur Interaktion mit dem Asterisk-Server von Java hinzu. <br><a name="habracut"></a><br>  <b>Wichtig: Ich gehe davon aus, dass Sie nach dem Schreiben von Code bereits √ºber einen funktionierenden Asterisk-Server verf√ºgen, auf den Sie zugreifen k√∂nnen.</b> <br><br>  <b>1) Was soll man w√§hlen, um das Arbeiten bequemer zu machen?</b> <br><br>  Auf jeden Fall - Asterisk Managment Interface (AMI): Diese Schnittstelle verf√ºgt √ºber eine Reihe von Funktionen, mit denen Sie einen Anruf t√§tigen, Ereignisse vom Server in Echtzeit abh√∂ren, einen Anrufstatus empfangen und gegebenenfalls unterbrechen k√∂nnen. <br><br>  <b>2) Welche Bibliothek soll verbunden werden?</b> <br><br>  Dieser: <br><br><pre><code class="java hljs">&lt;dependency&gt; &lt;groupId&gt;org.asteriskjava&lt;/groupId&gt; &lt;artifactId&gt;asterisk-java&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.0</span></span>.4&lt;/version&gt; &lt;/dependency&gt;</code> </pre> <br>  <b>3) Welche Konfigurationen m√ºssen auf dem Server angezeigt werden?</b> <br><br>  extensions.conf - die Konfiguration, die den Diaplan beschreibt.  Sie werden ihn st√§ndig kontaktieren.  In einer verst√§ndlicheren Sprache enth√§lt es Skripte dar√ºber, was der Server tun wird, wenn er einen Anruf an eine bestimmte Nummer erh√§lt.  Zuerst wird ein bestimmter Kontext im Diaplan durchsucht - er wird in eckige Klammern geschrieben, wonach eine Nummer unter dem Tag dieses Kontexts gesucht wird, f√ºr den Sie Kontakt aufnehmen. <br><br>  manager.conf - Konfiguration mit Benutzer und Passwort f√ºr Ihren Asterisk-Server <br><br>  Der Inhalt dieser Konfiguration sollte ungef√§hr wie folgt sein: <br><br><pre> <code class="xml hljs">[user_name] secret = password read = all write = all deny=0.0.0.0/0.0.0.0 permit=0.0.0.0/255.255.255.0</code> </pre><br><ul><li>  Benutzername - Benutzername </li><li>  Geheimnis - Passwort daf√ºr </li><li>  verweigern - IP-Adressen, denen unter diesem Benutzer der Zugriff verweigert wird </li><li>  Erlaubnis - Zugang zu dem erlaubt ist.  Stellen Sie sicher, dass Sie die IP-Adresse angeben, mit der Sie sich in der Genehmigung in Verbindung setzen, da die Aster Ihre Anfrage zur√ºckweisen kann. </li></ul><br>  sip.conf - alle Amtsleitungen sind hier registriert.  Ein Trunk ist ein Telefon, von dem aus wir einen Kunden anrufen. <br><br>  <b>4) Wo soll ich mit dem Schreiben von Code beginnen?</b> <br><br>  Es gibt zwei M√∂glichkeiten: Sie m√ºssen entweder eine Aktion auf dem Asterisk-Server ausf√ºhren oder Ereignisse auf dem Server abh√∂ren.  Unsere Sequenz umfasst beides. <br><br>  Wir beschreiben den Aktionsplan: <br><br><ol><li>  √ñffnen Sie die Verbindung zum Server. </li><li>  Wir beschreiben das Arbeitsszenario; </li><li>  Wir h√∂ren Ereignisse; </li><li>  Schlie√üen Sie die Verbindung. </li></ol><br>  Dementsprechend wird die Verbindung beim Erstellen des DefaultAsteriskServer-Objekts initialisiert: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.asteriskjava.live.AsteriskServer; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.asteriskjava.live.DefaultAsteriskServer;</code> </pre><br><pre> <code class="java hljs">AsteriskServer asteriskServer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultAsteriskServer(HOSTNAME, USERNAME, PASSWORD); asteriskServer.initialize();</code> </pre><br>  Nach dem √ñffnen der Verbindung m√ºssen wir den Benutzer anrufen.  Wir werden dies ein Aktionsszenario nennen.  Die Beschreibung des Szenarios erfolgt in einer separaten Klasse: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScenarioCall</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OriginateAction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger log = LoggerFactory.getLogger(ScenarioCall.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String TRUNK; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PHONE_FOR_RINGING; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String EXTEN_FOR_APP; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String CONTEXT_FOR_APP; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ScenarioCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String trunk, String phoneForRinging, String extension, String context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.TRUNK = trunk; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.PHONE_FOR_RINGING = phoneForRinging; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EXTEN_FOR_APP = extension; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.CONTEXT_FOR_APP = context; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.init(); } <span class="hljs-comment"><span class="hljs-comment">/** *         OriginateAction */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  String callId = ValidValues.getValidCallId(this.PHONE_FOR_RINGING); //    String channelAsterisk = ValidValues.getValidChannel(this.TRUNK, this.PHONE_FOR_RINGING); this.setContext(CONTEXT_FOR_APP); this.setExten(EXTEN_FOR_APP); this.setPriority(1); this.setAsync(true); this.setCallerId(callId); this.setChannel(channelAsterisk); log.info("Create Scenario Call: phone '{}',chanel '{}',context '{}',extension '{}'", callId, channelAsterisk, CONTEXT_FOR_APP, EXTEN_FOR_APP); } }</span></span></code> </pre><br>  Was m√ºssen wir in diesem Szenario verstehen?  Zun√§chst wird eine Amtsleitungsverbindung erstellt.  Eine Amtsleitung ist die Nummer, von der aus Sie den Teilnehmer anrufen.  Danach wird eine Verbindung zwischen der Amtsleitung und dem Teilnehmer hergestellt, danach besteht die Verbindung zwischen dem Teilnehmer und dem, den Sie sonst noch ben√∂tigen. <br><br>  Es ist in dieser Reihenfolge. <br><br><pre> <code class="plaintext hljs">this.setContext(CONTEXT_FOR_APP)</code> </pre>  Der √ºbertragene Wert: Der Kontext, in dem wir nach der Telefonnummer suchen, mit der Sie den Teilnehmer verkn√ºpfen m√∂chten (von extensions.conf). <br><br><pre> <code class="plaintext hljs">this.setExten(EXTEN_FOR_APP)</code> </pre>  √úbertragener Wert: Das Skript, das ausgef√ºhrt wird, nachdem Sie den Abonnenten kontaktiert haben (von extensions.conf). <br><br><pre> <code class="plaintext hljs">this.setCallerId(callId)</code> </pre>  √úbertragungswert: die Nummer unseres Abonnenten <br><br><pre> <code class="plaintext hljs">this.setChannel(channelAsterisk)</code> </pre>  √úbertragungswert: etablierter Kommunikationskanal, sieht normalerweise so aus: Amtsleitungsname / Telefonbenutzer. <br><br>  Wo kann man nach trunk_name suchen?  Auf dem Sternchen-Server befindet sich eine sip.conf-Konfiguration - alle Amtsleitungen sind dort registriert. <br><br>  Anruf erstellen: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (asteriskServer .getManagerConnection().getState().equals(ManagerConnectionState.CONNECTED) || asteriskServer .getManagerConnection().getState().equals(ManagerConnectionState.CONNECTING) || asteriskServer .getManagerConnection().getState().equals(ManagerConnectionState.INITIAL)) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { ScenarioCall scenarioCall = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ScenarioCall(trank, phone, extension, context); CallBack callBackForScenarioCall = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CallBack(); asteriskServer.originateAsync(scenarioCall, callBackForScenarioCall); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (ManagerCommunicationException e) { <span class="hljs-comment"><span class="hljs-comment">//   , StateConnection    RECONNECTING,     } }</span></span></code> </pre><br>  Wir haben einen Anruf erstellt, aber wie kann man ihn dynamisch verfolgen? <br><br>  Hierf√ºr werden zwei Dinge getan: Eine Instanz der CallBack-Klasse wird in der originateAsync-Methode √ºbergeben <br>  und ein Listener wird an den Server geh√§ngt, der alles zusammenf√ºhrt, was uns passiert. <br><br>  Ein Listener wird ben√∂tigt, da die CallBack-Klasse Sie nicht √ºber das Ende des Anrufs benachrichtigt, wenn der Benutzer bereits gesprochen hat, und Sie auch nicht dar√ºber informiert, dass der Benutzer noch an einen anderen Ort √ºbertragen kann. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *        asteriskConnection.originateAsync  *  CallBack -     ,     *  originateAsync. CallBack      , *       ,    onNoAnswer ,  *     onBusy,     ,  onFailure,  . *        . ,      *      (      ,    ) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallBack</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OriginateCallback</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     PRERING,       * OriginateCallback -    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ChannelState resultCall = ChannelState.PRERING; <span class="hljs-comment"><span class="hljs-comment">/** *    ,   .         */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDialing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AsteriskChannel asteriskChannel)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   ,  resultCall, //   asteriskChannel    null, //    resultCall   //   } /** *   .      *      6 - setStatus */ @Override public void onSuccess(AsteriskChannel asteriskChannel) { //   , asteriskChannel   null, // asteriskChannel.getState()      ChannelState.UP //   } /** *      ,    *      7 - setStatus () */ @Override public void onNoAnswer(AsteriskChannel asteriskChannel) { //   , //   asteriskChannel    null, //    resultCall   //   } /** *   *      7 - setStatus () */ @Override public void onBusy(AsteriskChannel asteriskChannel) { //   , //   asteriskChannel    null, //    resultCall   //   } /** *      */ @Override public void onFailure(LiveException e) { //     , //     , // onFailure      } }</span></span></code> </pre> <br>  <b>Wie h√§nge ich einen H√∂rer an ein Sternchen?</b> <br><br>  Erstellen Sie dazu eine implementierende Klasse AsteriskServerListener, PropertyChangeListener. <br>  F√ºr die erstellte Verbindung implementieren wir √ºber eine Instanz der AsteriskConnection-Klasse: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.asteriskConnection.addAsteriskServerListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callBackEventListener);</code> </pre> <br>  this.callBackEventListener - eine Instanz unserer Listener-Klasse, geboren aus: <br><br><pre> <code class="java hljs">** *    Asterisk *  PropertyChangeListener   ,     . *  AsteriskServerListener   ,     AsteriskConnection. */ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallBackEventListener</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsteriskServerListener</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PropertyChangeListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewAsteriskChannel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AsteriskChannel channel)</span></span></span><span class="hljs-function"> </span></span>{ channel.addPropertyChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewMeetMeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MeetMeUser user)</span></span></span><span class="hljs-function"> </span></span>{ user.addPropertyChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewQueueEntry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AsteriskQueueEntry user)</span></span></span><span class="hljs-function"> </span></span>{ user.addPropertyChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewAgent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AsteriskAgent asteriskAgent)</span></span></span><span class="hljs-function"> </span></span>{ asteriskAgent.addPropertyChangeListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/** *    .   {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> PropertyChangeEvent} *    , *        , *        CallBack * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> propertyChangeEvent      */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">propertyChange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PropertyChangeEvent propertyChangeEvent)</span></span></span><span class="hljs-function"> </span></span>{ findEventEndCall(propertyChangeEvent); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findEventEndCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PropertyChangeEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getSource() <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> AsteriskChannel) { AsteriskChannel callBackChannel = (AsteriskChannel) event.getSource(); String callId = getStringWithOnlyDigits(callBackChannel.getCallerId().toString()); callId = ValidValues.getValidCallId(callId); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (callBackChannel.getState().toString().equals(<span class="hljs-string"><span class="hljs-string">"HUNGUP"</span></span>) &amp;&amp; event.getOldValue().toString().contains(<span class="hljs-string"><span class="hljs-string">"RINGING"</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">//      callBackChannel.removePropertyChangeListener(this); //     } else if (callBackChannel.getState().toString().equals("HUNGUP") &amp;&amp; event.getOldValue().toString().contains("UP")) { //     callBackChannel.removePropertyChangeListener(this); //     } else if (callBackChannel.getState().toString().equals("HUNGUP")) { //      callBackChannel.removePropertyChangeListener(this); //     } } } private String getStringWithOnlyDigits(String strForParse) { String result = ""; if (strForParse != null &amp;&amp; !strForParse.isEmpty()) { CharMatcher ASCII_DIGITS = CharMatcher.anyOf("&lt;&gt;").precomputed(); result = ASCII_DIGITS.removeFrom(strForParse.replaceAll("[^0-9?!]", "")); } return result; } }</span></span></code> </pre><br>  Ich rate Ihnen von Anfang an, nur zu versprechen, was zu propertyChange kommt, und sich PropertyChangeEvent anzuschauen. Es wird ein verdammt gro√üer Haufen von allem sein, was auf dem Server passiert.  Es werden √ºberhaupt keine Informationen gefiltert.  Daher die Schlussfolgerung: H√§ngen Sie den H√∂rer so wenig wie m√∂glich auf.  Nicht f√ºr jeden Aufruf, da dies meines Erachtens auch in der OriginateCallback-Klasse m√∂glich ist.  Das ist nutzlos.  Sehen Sie sich an, welche PropertyChangeEvent-Objekte zu Ihnen kommen, welche Art von Feldern Sie ben√∂tigen und welche Sie ben√∂tigen.  Weiter - Willkommen in der Welt der Informationsverarbeitung. <br><br>  Ein bisschen √ºber Datenvalidierung. <br><br>  In OriginateAction.setChannel wird trunk_name / phone_user √ºbergeben <br>  phone_user - Wenn es russisch ist, sollte es mit einer Zahl von acht beginnen, wenn die internationale Nummer mit einem Pluszeichen versehen ist. <br><br>  In OriginateAction.setCallerId wird die Telefonnummer des Clients √ºbertragen. <br>  dann kommt es in CallBackEventListener in callBackChannel.getCallerId (). <br><br>  Wird es so nehmen: <br><br><pre> <code class="java hljs">String callId = getStringWithOnlyDigits(callBackChannel.getCallerId().toString());</code> </pre><br>  Vergessen Sie am Ende nicht: <br><br><pre> <code class="java hljs">asteriskServer.shutdown();</code> </pre><br>  Wenn Sie einen Anruf unterbrechen m√ºssen, dann entweder in der CallBackEventListener-Klasse <br>  zu dem bestehenden Kommunikationskanal f√ºhren wir durch: <br><br><pre> <code class="java hljs">callBackChannel.hangup();</code> </pre><br>  Ein so einfaches Tutorial hat sich herausgestellt.  Auf den ersten Blick ist es nat√ºrlich sehr einfach, aber glauben Sie mir, es braucht viel Zeit und Nerven, um Informationen zu finden, alle Methoden zu verschieben und die Arbeit zu verlassen. <br><br>  Viel Gl√ºck mit Ihren Asterisk-Servern! <br><br>  Weiterf√ºhrende Literatur: <br><br>  1) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Asterisk-Java-Tutorial</a> <br><br>  2) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Asterisk Managment Interface (AMI)</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de469491/">https://habr.com/ru/post/de469491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de469467/index.html">C ++ vs C #</a></li>
<li><a href="../de469471/index.html">"5 Cent", um √ºber Sorten zu sprechen</a></li>
<li><a href="../de469475/index.html">Der Aufstieg und Fall von Flash, dem nervigen Plugin, das das moderne Web gepr√§gt hat</a></li>
<li><a href="../de469477/index.html">Apple ist an der Zeit, den Vergleich von iPad und PC einzustellen</a></li>
<li><a href="../de469479/index.html">Woher kommt die Quantenwahrscheinlichkeit?</a></li>
<li><a href="../de469493/index.html">Machen Sie C ++ wieder gro√üartig! .. in Tula</a></li>
<li><a href="../de469495/index.html">Neue Ans√§tze zum Aufbau von ACS mithilfe von WEB-Technologien</a></li>
<li><a href="../de469497/index.html">Erstellen Sie mit dem Tilemap-System isometrische 2D-Ebenen</a></li>
<li><a href="../de469499/index.html">Wie wir bei Parallels es geschafft haben, uns bei Apple anzumelden</a></li>
<li><a href="../de469503/index.html">Cybersicherheit: Wir sch√ºtzen Teilnehmerdaten 2019 vor Lecks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>