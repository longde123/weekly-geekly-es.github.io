<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ¦ ğŸŒ± ğŸ’‡ğŸ¾ Chromium tidak hanya peramban, tetapi juga kerangka kerja yang baik ğŸ‘® ğŸ‘²ğŸ» ğŸ‘¨ğŸ½â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sebagian besar orang terbiasa dengan fakta bahwa Chromium adalah peramban dan dasar bagi peramban lain. Sampai baru-baru ini, saya juga berpikir begit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Chromium tidak hanya peramban, tetapi juga kerangka kerja yang baik</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/455956/"><img src="https://habrastorage.org/webt/ue/ye/xv/ueyexvk-uewnyghxhvtud7vugrq.jpeg"><br><br>  Sebagian besar orang terbiasa dengan fakta bahwa Chromium adalah peramban dan dasar bagi peramban lain.  Sampai baru-baru ini, saya juga berpikir begitu, tetapi, mempelajari topik ini selama beberapa bulan, saya mulai menemukan dunia lain yang indah.  Chromium adalah ekosistem besar di mana ada segalanya: sistem ketergantungan, sistem pembangunan lintas platform, dan komponen untuk hampir semua kesempatan.  Jadi mengapa tidak mencoba membuat aplikasi sendiri menggunakan semua kekuatan ini? <br><br>  Di bawah kat, panduan kecil tentang cara mulai melakukan ini. <br><a name="habracut"></a><br><h2>  Persiapan lingkungan </h2><br>  Dalam artikel saya akan menggunakan Ubuntu 18.04, prosedur untuk OS lain dapat ditemukan dalam dokumentasi: <br><br><ul><li>  <a href="">Linux</a> <br></li><li>  <a href="">Windows</a> <br></li><li>  <a href="">Mac</a> <br></li></ul><br>  Langkah-langkah berikut membutuhkan Git dan Python.  Jika mereka tidak diinstal, maka mereka harus diinstal menggunakan perintah: <br><br><pre><code class="bash hljs">sudo apt install git python</code> </pre> <br><h3>  Pengaturan depot_tools </h3><br>  <code>depot_tools</code> adalah toolkit pengembangan Chromium.  Untuk menginstalnya, Anda harus melakukan: <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://chromium.googlesource.com/chromium/tools/depot_tools.git</code> </pre> <br>  Dan tambahkan path ke variabel lingkungan PATH: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:/path/to/depot_tools"</span></span></code> </pre> <br>  Penting: jika <code>depot_tools</code> diunduh ke folder rumah Anda, jangan gunakan <code>~</code> dalam variabel <code>PATH</code> , jika tidak, masalah dapat terjadi.  Anda harus menggunakan variabel <code>$HOME</code> : <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${HOME}</span></span></span><span class="hljs-string">/depot_tools"</span></span></code> </pre> <br><h3>  Pengambilan kode </h3><br>  Pertama, Anda perlu membuat folder untuk sumbernya.  Misalnya, di direktori home (dibutuhkan ruang kosong sekitar 30 GB): <br><br><pre> <code class="bash hljs">mkdir ~/chromium &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/chromium</code> </pre> <br>  Setelah itu, Anda dapat mengunduh sumber menggunakan utilitas <code>fetch</code> dari <code>depot_tools</code> : <br><br><pre> <code class="bash hljs">fetch --nohooks --no-history chromium</code> </pre> <br>  Sekarang Anda bisa minum teh / kopi, karena prosedurnya tidak cepat.  Untuk percobaan, tidak diperlukan riwayat, sehingga bendera <code>--no-history</code> digunakan.  Ceritanya akan lebih panjang. <br><br><h3>  Instalasi Ketergantungan </h3><br>  Semua sumber ada di folder <code>src</code> , buka: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> src</code> </pre> <br>  Sekarang Anda harus meletakkan semua dependensi menggunakan skrip: <br><br><pre> <code class="bash hljs">./build/install-build-deps.sh</code> </pre> <br>  Dan jalankan hooks: <br><br><pre> <code class="bash hljs">gclient runhooks</code> </pre> <br>  Ini melengkapi persiapan lingkungan. <br><br><h2>  Membangun sistem </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ninja</a> digunakan sebagai sistem perakitan utama untuk Chromium, dan utilitas <a href="">GN</a> digunakan untuk menghasilkan file <code>.ninja</code> . <br><br>  Untuk memahami cara menggunakan alat ini, saya mengusulkan untuk membuat contoh utilitas pengujian.  Untuk melakukan ini, buat <code>example</code> subfolder di folder <code>src</code> : <br><br><pre> <code class="bash hljs">mkdir example</code> </pre> <br>  Kemudian, di folder <code>src/example</code> , buat file <code>BUILD.gn</code> , yang berisi: <br><br><pre> <code class="cpp hljs">executable(<span class="hljs-string"><span class="hljs-string">"example"</span></span>) { sources = [ <span class="hljs-string"><span class="hljs-string">"example.cc"</span></span>, ] }</code> </pre> <br>  <code>BUILD.gn</code> terdiri dari target ( <code>example</code> executable) dan daftar file yang diperlukan untuk membangun target. <br><br>  Langkah selanjutnya adalah membuat file <code>example.cc</code> itu sendiri.  Untuk memulai, saya mengusulkan untuk membuat aplikasi klasik "Hello world": <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;iostream&gt; int main(int argc, char **argv) { std::cout &lt;&lt; "Hello world" &lt;&lt; std::endl; return 0; }</span></span></span></span></code> </pre> <br>  Kode sumber dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . <br><br>  Agar GN dapat mempelajari tentang proyek baru, dalam file <code>BUILD.gn</code> terletak di <code>src</code> , tambahkan baris <code>"//example"</code> di bagian <code>deps</code> : <br><br><pre> <code class="cpp hljs">... group(<span class="hljs-string"><span class="hljs-string">"gn_all"</span></span>) { testonly = <span class="hljs-literal"><span class="hljs-literal">true</span></span> deps = [ <span class="hljs-string"><span class="hljs-string">":gn_visibility"</span></span>, <span class="hljs-string"><span class="hljs-string">"//base:base_perftests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//base:base_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//base/util:base_util_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//chrome/installer"</span></span>, <span class="hljs-string"><span class="hljs-string">"//chrome/updater"</span></span>, <span class="hljs-string"><span class="hljs-string">"//net:net_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//services:services_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//services/service_manager/public/cpp"</span></span>, <span class="hljs-string"><span class="hljs-string">"//skia:skia_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//sql:sql_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//third_party/flatbuffers:flatbuffers_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//tools/binary_size:binary_size_trybot_py"</span></span>, <span class="hljs-string"><span class="hljs-string">"//tools/ipc_fuzzer:ipc_fuzzer_all"</span></span>, <span class="hljs-string"><span class="hljs-string">"//tools/metrics:metrics_metadata"</span></span>, <span class="hljs-string"><span class="hljs-string">"//ui/base:ui_base_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//ui/gfx:gfx_unittests"</span></span>, <span class="hljs-string"><span class="hljs-string">"//url:url_unittests"</span></span>, # â†“â†“â†“â†“â†“â†“â†“â†“ <span class="hljs-string"><span class="hljs-string">"//example"</span></span>, ] ...</code> </pre> <br>  Sekarang Anda perlu kembali ke folder <code>src</code> dan menghasilkan proyek menggunakan perintah: <br><br><pre> <code class="bash hljs">gn gen out/Default</code> </pre> <br>  GN juga memungkinkan Anda menyiapkan proyek untuk salah satu IDE yang didukung: <br><br><ul><li>  gerhana <br></li><li>  vs. <br></li><li>  vs2013 <br></li><li>  vs2015 <br></li><li>  vs2017 <br></li><li>  vs2019 <br></li><li>  xcode <br></li><li>  qtcreator <br></li><li>  json <br></li></ul><br>  Informasi lebih lanjut dapat diperoleh dengan menggunakan perintah: <br><br><pre> <code class="bash hljs">gn <span class="hljs-built_in"><span class="hljs-built_in">help</span></span> gen</code> </pre> <br>  Misalnya, untuk bekerja dengan proyek <code>example</code> di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">QtCreator,</a> Anda perlu menjalankan perintah: <br><br><pre> <code class="bash hljs">gn gen --ide=qtcreator --root-target=example out/Default</code> </pre> <br>  Setelah itu, Anda dapat membuka proyek di QtCreator: <br><br><pre> <code class="bash hljs">qtcreator out/Default/qtcreator_project/all.creator</code> </pre> <br>  Langkah terakhir adalah membangun proyek menggunakan Ninja: <br><br><pre> <code class="bash hljs">autoninja -C out/Default example</code> </pre> <br>  Pengantar singkat tentang sistem perakitan ini dapat diselesaikan. <br><br>  Aplikasi dapat diluncurkan menggunakan perintah: <br><br><pre> <code class="bash hljs">./out/Default/example</code> </pre> <br>  Dan lihat Hello world.  Bahkan, Anda dapat menulis artikel terpisah tentang sistem perakitan di Chromium.  Mungkin bukan satu. <br><br><h2>  Bekerja dengan baris perintah </h2><br>  Sebagai contoh pertama menggunakan basis kode Chromium sebagai kerangka kerja, saya sarankan bermain-main dengan baris perintah. <br><br>  Tugas: <i>menampilkan semua argumen yang diteruskan ke aplikasi dalam gaya Chromium.</i> <br>  Untuk bekerja dengan baris perintah, Anda harus menyertakan file header di example.cc: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#include "base/command_line.h"</span></span></code> </pre> <br>  Dan juga kita tidak boleh lupa untuk menambahkan ketergantungan pada proyek <code>base</code> di <code>BUILD.gn</code> .  <code>BUILD.gn</code> akan terlihat seperti ini: <br><br><pre> <code class="cpp hljs">executable(<span class="hljs-string"><span class="hljs-string">"example"</span></span>) { sources = [ <span class="hljs-string"><span class="hljs-string">"example.cc"</span></span>, ] deps = [ <span class="hljs-string"><span class="hljs-string">"//base"</span></span>, ] }</code> </pre> <br>  Sekarang semua yang Anda butuhkan akan terhubung ke <code>example</code> . <br><br>  Untuk bekerja dengan baris perintah, Chromium menyediakan <code>base::CommandLine</code> tunggal <code>base::CommandLine</code> .  Untuk mendapatkan tautan ke sana, Anda perlu menggunakan <code>base::CommandLine::ForCurrentProcess</code> metode statis <code>base::CommandLine::ForCurrentProcess</code> , tetapi pertama-tama Anda perlu menginisialisasi menggunakan <code>base::CommandLine::Init</code> Metode <code>base::CommandLine::Init</code> : <br><br><pre> <code class="cpp hljs">base::CommandLine::Init(argc, argv); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> *cmd_line = base::CommandLine::ForCurrentProcess();</code> </pre> <br>  Semua argumen yang diteruskan ke aplikasi pada baris perintah dan dimulai dengan a <code>-</code> dikembalikan sebagai <code>base::SwitchMap</code> (pada dasarnya <code>map&lt;string, string&gt;</code> ) menggunakan metode <code>GetSwitches</code> .  Semua argumen lain dikembalikan sebagai <code>base::StringVector</code> (pada dasarnya <code>vectr&lt;strig&gt;</code> ).  Pengetahuan ini cukup untuk mengimplementasikan kode untuk tugas: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;sw : cmd_line-&gt;GetSwitches()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Switch "</span></span> &lt;&lt; sw.first &lt;&lt; <span class="hljs-string"><span class="hljs-string">": "</span></span> &lt;&lt; sw.second &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;arg: cmd_line-&gt;GetArgs()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Arg "</span></span> &lt;&lt; arg &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre> <br>  Versi lengkap dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . <br><br>  Untuk membangun dan menjalankan aplikasi, Anda perlu menjalankan: <br><br><pre> <code class="bash hljs">autoninja -C out/Default example ./out/Default/example arg1 --sw1=val1 --sw2 arg2</code> </pre> <br>  Layar akan menampilkan: <br><br><pre> <code class="bash hljs">Switch sw1: val1 Switch sw2: Arg arg1 Arg arg2</code> </pre> <br><h2>  Jaringan </h2><br>  Sebagai contoh kedua dan terakhir untuk hari ini, saya mengusulkan untuk bekerja dengan bagian jaringan Chromium. <br><br>  Tugas: <i>menampilkan konten URL yang diteruskan sebagai argumen</i> . <br><br><h3>  Subsistem Jaringan Chromium </h3><br>  Subsistem jaringan cukup besar dan kompleks.  Titik masuk untuk permintaan HTTP, HTTPS, FTP dan sumber daya data lainnya adalah <code>URLRequest</code> , yang sudah menentukan klien mana yang akan digunakan.  Diagram yang disederhanakan terlihat seperti ini: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d6/b9f/e45/7d6b9fe45ac8c5a47d51e4522735e5eb.png"><br><br>  <i>Versi lengkap dapat ditemukan di <a href="">dokumentasi</a> .</i> <br><br>  Untuk membuat <code>URLRequest</code> Anda harus menggunakan <code>URLRequestContext</code> .  Membuat konteks adalah operasi yang agak rumit, oleh karena itu disarankan untuk menggunakan <code>URLRequestContextBuilder</code> .  Ini akan menginisialisasi semua variabel yang diperlukan dengan nilai default, tetapi, jika diinginkan, mereka dapat diubah sendiri, misalnya: <br><br><pre> <code class="cpp hljs">net::URLRequestContextBuilder context_builder; context_builder.DisableHttpCache(); context_builder.SetSpdyAndQuicEnabled(<span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-comment"><span class="hljs-comment">/* http2 */</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-comment"><span class="hljs-comment">/* quic */</span></span>); context_builder.SetCookieStore(<span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>);</code> </pre> <br><h3>  Multithreading </h3><br>  Tumpukan jaringan Chromium dirancang untuk bekerja di lingkungan multi-utas, sehingga Anda tidak dapat melewati topik ini.  Objek dasar untuk bekerja dengan multithreading di Chromium adalah: <br><br><ul><li>  Tugas - tugas untuk dieksekusi, di Chromium itu adalah fungsi dari tipe <code>base::Callback</code> , yang dapat dibuat menggunakan <code>base::Bind</code> . <br></li><li>  Antrian tugas - antrian tugas untuk dieksekusi. <br></li><li>  Fisik thread - pembungkus lintas platform di atas sistem operasi thread ( <code>pthread</code> pada POSIX atau <code>CreateThread()</code> pada Windows).  Diterapkan dalam <code>base::PlatformThread</code> kelas <code>base::PlatformThread</code> , jangan gunakan secara langsung. <br></li><li>  base :: Utas - utas nyata yang memproses pesan dari antrian tugas khusus tanpa henti;  Tidak disarankan untuk membuatnya secara langsung. <br></li><li>  Thread pool - pool thread dengan antrian tugas umum.  Diimplementasikan dalam <code>base::ThreadPool</code> kelas <code>base::ThreadPool</code> .  Sebagai aturan, buat satu instance.  Tugas dikirim ke sana menggunakan fungsi dari <code>base/task/post_task.h</code> . <br></li><li>  Urutan atau Urutan virtual - utas virtual yang menggunakan utas nyata dan dapat beralih di antara mereka. <br></li><li>  Pelari tugas - antarmuka untuk mengatur tugas, diimplementasikan di <code>base::TaskRunner</code> . <br></li><li>  Pelari tugas berurutan - antarmuka untuk mengatur tugas, yang memastikan bahwa tugas akan dieksekusi dalam urutan yang sama dengan saat mereka tiba.  Diimplementasikan dalam <code>base::SequencedTaskRunner</code> kelas <code>base::SequencedTaskRunner</code> . <br></li><li>  Pelari tugas utas tunggal - mirip dengan yang sebelumnya, tetapi menjamin bahwa semua tugas akan dilakukan dalam satu utas OS.  Diterapkan dalam <code>base::SingleThreadTaskRunner</code> . <br></li></ul><br><h3>  Implementasi </h3><br>  Beberapa komponen Chromium memerlukan kehadiran <code>base::AtExitManager</code> - ini adalah kelas yang memungkinkan Anda untuk mendaftarkan operasi yang harus dilakukan ketika aplikasi berakhir.  Menggunakannya sangat sederhana, Anda perlu membuat objek di stack: <br><br><pre> <code class="cpp hljs">base::AtExitManager exit_manager;</code> </pre> <br>  Ketika <code>exit_manager</code> keluar dari ruang lingkup, semua panggilan balik yang terdaftar akan dieksekusi. <br><br>  Sekarang Anda perlu menjaga ketersediaan semua komponen multithreading yang diperlukan untuk subsistem jaringan.  Untuk melakukan ini, buat kumpulan <code>Thread pool</code> , <code>Message loop</code> dengan tipe <code>TYPE_IO</code> untuk memproses pesan jaringan, dan <code>Run loop</code> - loop program utama: <br><br><pre> <code class="cpp hljs">base::ThreadPool::CreateAndStartWithDefaultParams(<span class="hljs-string"><span class="hljs-string">"downloader"</span></span>); base::<span class="hljs-function"><span class="hljs-function">MessageLoop </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base::MessageLoop::TYPE_IO)</span></span></span></span>; base::RunLoop run_loop;</code> </pre> <br>  Selanjutnya, gunakan <code>Context builder</code> untuk membuat <code>Context</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> ctx = net::URLRequestContextBuilder().Build();</code> </pre> <br>  Untuk mengirim permintaan, Anda harus membuat objek <code>URLRequest</code> menggunakan metode <code>CreateRequest</code> dari objek <code>ctx</code> .  Parameter berikut dilewatkan: <br><br><ul><li>  URL, string dengan tipe GURL; <br></li><li>  prioritas; <br></li><li>  delegasikan yang menangani acara. <br></li></ul><br>  Delegasi adalah kelas yang mengimplementasikan antarmuka <code>net::URLRequest::Delegate</code> .  Untuk tugas ini, mungkin terlihat seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyDelegate</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> net::URLRequest::Delegate { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">explicit</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyDelegate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base::Closure quit_closure)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quit_closure_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::move(quit_closure))</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buf_</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(base::MakeRefCounted&lt;net::IOBuffer&gt;(BUF_SZ))</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReceivedRedirect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net::RedirectInfo &amp;redirect_info, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *defer_redirect)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"redirect to "</span></span> &lt;&lt; redirect_info.new_url &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnAuthRequired</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest* request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net::AuthChallengeInfo&amp; auth_info)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"auth req"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnCertificateRequested</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, net::SSLCertRequestInfo *cert_request_info)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"cert req"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSSLCertificateError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest* request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net_error, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net::SSLInfo&amp; ssl_info, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fatal)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"cert err"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnResponseStarted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> net_error)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"resp started"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> n = request-&gt;Read(buf_.get(), BUF_SZ); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"resp read "</span></span> &lt;&lt; n &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n == net::ERR_IO_PENDING) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { OnReadCompleted(request, n); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(buf_-&gt;data(), n) &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReadCompleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(net::URLRequest *request, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bytes_read)</span></span></span><span class="hljs-function"> override </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"completed"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; quit_closure_.Run(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: base::Closure quit_closure_; scoped_refptr&lt;net::IOBuffer&gt; buf_; };</code> </pre> <br>  Semua logika utama ada di event <code>OnResponseStarted</code> : isi respons dikurangi sampai kesalahan terjadi atau tidak ada yang dibaca.  Karena setelah membaca respons yang Anda butuhkan untuk menyelesaikan aplikasi, delegasi harus memiliki akses ke fungsi yang akan mengganggu <code>Run loop</code> utama, dalam hal ini panggilan balik dari tipe <code>base::Closure</code> digunakan. <br><br>  Sekarang semuanya siap untuk mengirim permintaan: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">MyDelegate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delegate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(run_loop.QuitClosure())</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> req = ctx-&gt;CreateRequest(GURL(args[<span class="hljs-number"><span class="hljs-number">0</span></span>]), net::RequestPriority::DEFAULT_PRIORITY, &amp;delegate); req-&gt;Start();</code> </pre> <br>  Untuk permintaan untuk mulai memproses, Anda perlu menjalankan <code>Run loop</code> : <br><br><pre> <code class="cpp hljs">run_loop.Run();</code> </pre> <br>  Versi lengkap dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitHub</a> . <br><br>  Untuk membangun dan menjalankan aplikasi, Anda perlu menjalankan: <br><br><pre> <code class="bash hljs">autoninja -C out/Default example out/Default/example <span class="hljs-string"><span class="hljs-string">"https://example.com/"</span></span></code> </pre> <br><h2>  Terakhir </h2><br>  Bahkan, di Chromium Anda dapat menemukan banyak kubus dan batu bata yang berguna untuk membangun aplikasi.  Ini terus berkembang, yang, di satu sisi, merupakan nilai tambah, dan di sisi lain, perubahan reguler pada API tidak membuat Anda rileks.  Misalnya, dalam rilis terbaru, <code>base::TaskScheduler</code> berubah menjadi <code>base::ThreadPool</code> , untungnya, tanpa mengubah API. <br><br>  PS Kami mencari programmer C ++ terkemuka di tim kami!  Jika Anda merasakan kekuatan dalam diri Anda, maka keinginan kami dijelaskan di sini: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">team.mail.ru/vacancy/4641/</a> .  Ada juga tombol "Tanggapi". </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id455956/">https://habr.com/ru/post/id455956/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id455946/index.html">Konten yang dilarang di Google Play - pencarian survival</a></li>
<li><a href="../id455948/index.html">RAMBleed: mengambil kunci RSA dalam 34 jam</a></li>
<li><a href="../id455950/index.html">Bahasa pemrograman yang paling langka dan paling mahal. Bagian II</a></li>
<li><a href="../id455952/index.html">Pembuatan Kode dengan Roslyn</a></li>
<li><a href="../id455954/index.html">Penggunaan dan perlindungan warisan di dunia modern</a></li>
<li><a href="../id455958/index.html">Automata Seluler Berkembang</a></li>
<li><a href="../id455960/index.html">Mengapa pengembang pergi: 8 alasan</a></li>
<li><a href="../id455962/index.html">Ilmu Data dan Konferensi Tropis</a></li>
<li><a href="../id455966/index.html">5 perusahaan pengembang aplikasi seluler teratas di Inggris</a></li>
<li><a href="../id455968/index.html">Saya membuat setengah roda gigi besar di panel surya untuk 250.000 rubel (1 bagian)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>