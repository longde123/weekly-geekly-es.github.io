<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèí ü•ä üé® Infrastructure √† cl√© publique (suite): Autorit√© de certification bas√©e sur OpenSSL et SQLite3 üï∂Ô∏è ‚úãüèΩ üßëüèΩ‚Äçü§ù‚Äçüßëüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si l'un des principaux objets de l'infrastructure √† cl√© publique (PKI) est les certificats X509, alors le sujet central de l'ICP sont les autorit√©s de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Infrastructure √† cl√© publique (suite): Autorit√© de certification bas√©e sur OpenSSL et SQLite3</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413493/"><img src="https://habrastorage.org/webt/60/9k/sk/609ksklwykcs1xqbwuoyvqw7wg8.png" align="left" alt="image">  Si l'un des principaux objets de l'infrastructure √† cl√© publique (PKI) est les certificats X509, alors le sujet central de l'ICP sont les autorit√©s de certification (CA).  C'est l'autorit√© de certification qui d√©livre les certificats, met fin √† leur validit√© (r√©vocation des certificats), confirme leur validit√©.  Sur les pages de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Habrahabr,</a> vous pouvez trouver diverses publications sur la question des certificats num√©riques utilisant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenSSL</a> . <a name="habracut"></a>  Fondamentalement, ces articles d√©crivent l'utilisation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'utilitaire openssl</a> , d√©crivent son interface de ligne de commande et travaillent avec des fichiers qui stockent tout: cl√©s, demandes, certificats, y compris la racine, etc.  Mais si vous d√©veloppez un centre de certification (CA) √† grande √©chelle bas√© sur OpenSSL, il est naturel de vouloir se d√©barrasser de cette vari√©t√© de fichiers et de passer √† l'utilisation des bases de donn√©es, ainsi que d'avoir une interface graphique pour l'√©mission et la gestion des certificats.  Et si vous vous souvenez de la loi f√©d√©rale du 6 avril 2011.  N ¬∞ 63- Sur les signatures √©lectroniques, il est n√©cessaire que l'AC se conforme aux exigences de cette loi, ainsi qu'aux exigences relatives au formulaire de certificat qualifi√© d'un certificat de cl√© de v√©rification de signature √©lectronique, approuv√© par l'ordonnance du Service f√©d√©ral de s√©curit√© de Russie du 27 d√©cembre 2011 n ¬∞ 795 <br><br>  Les citoyens ordinaires ont l'impression que les UT sont quelque chose d'√©norme (enfin, le Centre, presque comme le Centre de contr√¥le de mission). <br><br><img src="https://habrastorage.org/webt/b5/3v/g7/b53vg7cflxhkndwjyavz3ppfcuy.png" align="right" alt="image">  Du point de vue de la responsabilit√© de l'AC - c'est exactement le cas.  Apr√®s tout, les certificats d√©livr√©s par l'AC sont actuellement √©gaux dans le passeport. <br><br>  Du point de vue d'un programmeur, tout n'est pas si effrayant.  C'est ainsi qu'est n√© le projet de centre de certification CAFL63.  La mise en ≈ìuvre du projet CAFL63 repose sur trois ¬´piliers¬ª, √† savoir OpenSSL, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SQLite3</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tcl / Tk</a> . <br><br>  Qu'est-ce qu'une autorit√© de certification aujourd'hui?  Tout d'abord, c'est le Centre d'enregistrement, o√π les repr√©sentants des personnes morales, des particuliers, des entrepreneurs individuels viennent chercher des certificats avec un ensemble de documents n√©cessaires, en particulier, identifiant l'identit√© et l'autorit√© du demandeur.  Ils peuvent venir avec des applications pr√™tes √† l'emploi par voie √©lectronique.  Le CR v√©rifie les documents, la demande (donn√©es compl√©t√©es, l'exactitude de la signature √©lectronique, etc.), et si tout se passe bien, acceptez la demande, approuvez-la et envoyez-la au Centre de Certification (CA).  Mais c'est l'id√©al.  En pratique, tout semble diff√©rent. <br><br>  Les citoyens, les organisations ont besoin d'un certificat (pour acc√©der au portail des services de l'√âtat, pour les d√©clarations fiscales, pour les appels d'offres), mais ils ne savent pas ce que c'est et quoi en faire.  Ils sont sinc√®rement convaincus que l'AC re√ßoit une signature √©lectronique telle qu'un fac-simil√©.  Mais ce sont des probl√®mes d'illumination.  Par cons√©quent, les requ√©rants se pr√©sentent √† l'administration centrale de l'administration centrale et pr√©sentent des documents.  Avec l'employ√© du bureau central, ils se rendent dans un lieu de travail s√©par√© et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©parent une demande de</a> certificat: <br><br><img src="https://habrastorage.org/webt/-i/ni/fr/-inifrinlnabszqrmm9w11vpz98.png"><br><br>  Une demande pr√©par√©e sur support √©lectronique, comme d√©j√† mentionn√©, est re√ßue par le CR.  De quoi le demandeur doit-il se souvenir?  Tout d'abord, r√©cup√©rez les m√©dias avec la cl√© priv√©e cr√©√©e! <br>  Une demande approuv√©e sur support √©lectronique est transmise √† l'AC, o√π un certificat sera d√©livr√© sur cette base. <br><br>  Il s'agit d'un diagramme sch√©matique du travail de l'AC.  Les d√©tails deviendront clairs ci-dessous.  Une remarque, pour la commodit√© de la d√©monstration, l'utilitaire de pr√©paration d'une demande, CR et CA sont combin√©s en un seul complexe de d√©monstration.  Mais la diversit√© fonctionnelle ne pose aucun probl√®me.  Le plus simple d'entre eux est d'avoir une instance CAFL63 sur chaque poste de travail et d'utiliser uniquement les fonctionnalit√©s requises. <br><br>  Lorsque le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">battait</a> son plein, le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SimpleCA</a> a attir√© mon attention.  L'√©tude de ce projet a beaucoup aid√© √† la mise en ≈ìuvre finale de CAFL63 CA. <br><br>  Le code source de l'utilitaire et ses distributions pour les plates-formes Linux et MS Windows peuvent √™tre trouv√©s <div class="spoiler">  <b class="spoiler_title">ici:</b> <div class="spoiler_text"><ul><li>  <a href="">code source</a> </li><li>  <a href="">Linux32</a> </li><li>  <a href="">Linux64</a> </li><li>  <a href="">WIN32</a> </li><li>  <a href="">WIN64</a> </li></ul><br></div></div><br>  Ex√©cutez donc l'utilitaire CAFL63 et la page de d√©marrage appara√Æt √† l'√©cran: <br><br><img src="https://habrastorage.org/webt/ej/d4/6z/ejd46z3sdsymivi7ougryho9q-g.png"><br><br>  Nous commen√ßons le travail en appuyant sur la touche "Cr√©er une base de donn√©es".  La base de donn√©es CA est cr√©√©e √† l'aide d'un SGBD multiplateforme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SQLite3</a> .  La base de donn√©es CA contient plusieurs tables.  La table principale mainDB contient un seul enregistrement, qui stocke le certificat racine, la cl√© priv√©e chiffr√©e avec un mot de passe et les param√®tres de l'autorit√© de certification.  Il existe deux tables li√©es aux demandes de certificat: les demandes reqDB actuelles et l'archive des demandes reqDBArc.  Trois tables sont cr√©√©es pour les certificats: la table des nouveaux certificats certDBNew, la table de l'archive des certificats certDB et la table des certificats r√©voqu√©s certDBRev: <br><br><pre><code class="sql hljs">. . . certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDB( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> , nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, certPEM <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, notAfter <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, notBefore <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, dateRevoke <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, state <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDBRev( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> certDBNew( ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> )} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> reqDB (ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, datereq <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, reqpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pkcs7 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> reqDBAr (ckaID <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>, nick <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, sernum <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, subject <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, datereq <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, reqpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, pkcs7 <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} certdb eval {<span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> crlDB(<span class="hljs-keyword"><span class="hljs-keyword">ID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> autoincrement, signtype <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, issuer <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, publishdate <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, nextdate <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, crlpem <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>)} . . .</code> </pre> <br>  Toutes les tables de demandes et de certificats utilisent <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la valeur de hachage</a> (sha1) de la cl√© publique comme cl√© (cl√© primaire).  Pour plus de commodit√©, √† l'avenir, la valeur de hachage de la valeur de cl√© publique sera appel√©e CKAID (terminologie PKCS # 11).  Cela s'est av√©r√© tr√®s pratique, par exemple, lors de la recherche d'un certificat sur demande ou vice versa.  Il existe une autre table crlDB dans la base de donn√©es qui stocke les listes de certificats r√©voqu√©s. <br><br>  La valeur de la cl√© publique est stock√©e √† la fois dans la demande et dans le certificat.  Par cons√©quent, avant de les mettre dans la base de donn√©es, il est n√©cessaire d'en extraire la cl√© publique et de calculer le CKAID.  Pour extraire la valeur de la cl√© publique, il est pratique d'utiliser le package pki (le package n√©cessite pki), qui contient des outils pour travailler avec les certificats et les requ√™tes.  Cependant, ce package n'est pas con√ßu pour fonctionner avec la cryptographie russe.  √Ä cet √©gard, sur la base des proc√©dures parse_cert et parse_csr incluses dans le package pki, √©crivez les proc√©dures parce_cert_gost et parse_csr_gost: <br><br><pre> <code class="plaintext hljs">... ## Convert Pubkey type to string set pubkey_type [::pki::_oid_number_to_name $pubkey_type] # Parse public key, based on type switch -- $pubkey_type { "rsaEncryption" { set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) ::asn::asnGetSequence pubkey pubkey_parts ::asn::asnGetBigInteger pubkey_parts ret(n) ::asn::asnGetBigInteger pubkey_parts ret(e) set ret(n) [::math::bignum::tostr $ret(n)] set ret(e) [::math::bignum::tostr $ret(e)] set ret(l) [expr {int([::pki::_bits $ret(n)] / 8.0000 + 0.5) * 8}] set ret(type) rsa } "1.2.643.2.2.19" - "1.2.643.7.1.1.1.1" - "1.2.643.7.1.1.1.2" { # gost2001, gost2012-256,gost2012-512 set pubkey [binary format B* $pubkey] binary scan $pubkey H* ret(pubkey) set ret(type) $pubkey_type ::asn::asnGetSequence pubkey_algoid pubalgost #OID -  ::asn::asnGetObjectIdentifier pubalgost oid1 #OID -   ::asn::asnGetObjectIdentifier pubalgost oid2 } default { error "Unknown algorithm" } } ...</code> </pre> <br>  Contrairement aux proc√©dures "natives", elles vous permettent de travailler avec des objets non seulement au format PEM, mais aussi au format DER.  Pour travailler avec les listes de r√©vocation de certificats CRL, la proc√©dure parse_crl a √©t√© √©crite.  Toutes ces proc√©dures peuvent √™tre trouv√©es dans le code source, qui est stock√© avec la distribution. <br><br>  Il n'y a pas non plus d'oid-s russes dans le paquet pki, par exemple, TIN, SNILS, etc.  Ce probl√®me est facilement r√©solu en ajoutant des oid-s russes au tableau :: pki :: oids: <br><br><pre> <code class="plaintext hljs">. . . set ::pki::oids(1.2.643.100.1) "OGRN" set ::pki::oids(1.2.643.100.5) "OGRNIP" set ::pki::oids(1.2.643.3.131.1.1) "INN" set ::pki::oids(1.2.643.100.3) "SNILS" #  set ::pki::oids(1.2.643.2.2.3) "  34.10-2001" set ::pki::oids(1.2.643.7.1.1.3.2) "  34.10-2012-256" set ::pki::oids(1.2.643.7.1.1.3.3) "  34.10-2012-512" . . .</code> </pre> <br>  Ayant les fonctions parse_cert_gost et parse_csr_gost, les valeurs de CKAID (cl√© primaire pour la base de donn√©es) sont calcul√©es comme suit: <br><br><pre> <code class="plaintext hljs">. . . array set b [parse_csr_gost $req] set pem $b(pem) set subject $b(subject) set pubkey $b(pubkey) set key1 [binary format H* $pubkey] set ckaID [::sha1::sha1 $key1] . . .</code> </pre> <br>  Alors, cliquez sur le bouton "Cr√©er une base de donn√©es": <br><br><img src="https://habrastorage.org/webt/fj/uh/3q/fjuh3qvrwugzxspgjchbonu9is0.png"><br><br>  La cr√©ation de l'autorit√© de certification commence par le choix du r√©pertoire dans lequel nous stockons les param√®tres de base de donn√©es et de mot de passe pour acc√©der √† la cl√© priv√©e de l'autorit√© de certification.  L'utilitaire CAFL63 surveille attentivement la longueur du mot de passe: <br><br><img src="https://habrastorage.org/webt/dw/eb/hf/dwebhfn5hqfjh8bv3jge5jxllx8.png"><br><br>  Le mot de passe est stock√© dans la base de donn√©es CA sous forme de hachage: <br><br><pre> <code class="plaintext hljs">. . . set hash256 [::sha2::sha256 $wizData(capassword)] . . .</code> </pre> <br>  Apr√®s avoir appuy√© sur la touche ¬´Trace¬ª, le processus de formation d'un certificat racine auto-sign√© de l'autorit√© de certification d√©ploy√©e d√©marre.  √Ä la premi√®re √©tape de ce processus, le type et les param√®tres de la paire de cl√©s sont s√©lectionn√©s: <br><br><img src="https://habrastorage.org/webt/zr/e4/ag/zre4agh8ilw-tvjiy354y_o337c.png"><br><br>  Apr√®s avoir d√©cid√© de la paire de cl√©s pour le certificat racine du centre de certification cr√©√©, nous remplissons le formulaire avec des informations sur le propri√©taire (la premi√®re capture d'√©cran est manquante). <br><br>  Notez que l'utilitaire CAFL63 a une certaine ¬´intelligence¬ª et contr√¥le donc non seulement la disponibilit√© des donn√©es dans les champs, mais aussi l'exactitude (surbrillance rouge - incorrect) de remplir des champs tels que TIN, PSRN, SNILS, PSRNIP, adresse e-mail, etc.: <br><br><img src="https://habrastorage.org/webt/4o/pt/vr/4optvrvc8o6gfd413eh5ggshby4.png"><br><br>  Apr√®s avoir rempli les champs avec des informations sur le propri√©taire de l'autorit√© de certification, il vous sera propos√© de d√©terminer les param√®tres syst√®me de l'autorit√© de certification: <br><br><img src="https://habrastorage.org/webt/it/wq/nc/itwqnccdburbtmsdybckzdqf1u8.png"><br><br>  Si vous ne travaillez pas avec la cryptographie russe, vous pouvez utiliser l'OpenSSL habituel.  Pour travailler avec la cryptographie russe, vous devez s√©lectionner la version appropri√©e, une modification d'OpenSSL.  Pour plus de d√©tails, lisez README.txt dans la distribution t√©l√©charg√©e.  Puisqu'il est pr√©vu de d√©livrer des certificats qualifi√©s, il est √©galement n√©cessaire de fournir des informations sur la certification de l'AC elle-m√™me et le syst√®me de protection des informations cryptographiques qu'elle utilise (voir ¬´Exigences pour le formulaire de certificat qualifi√© d'une cl√© de v√©rification de signature √©lectronique¬ª, approuv√©e par une ordonnance du Service f√©d√©ral de s√©curit√© de Russie du 27 d√©cembre 2011 n ¬∞ 795). <br><br>  Apr√®s avoir correctement rempli tous les champs, il vous sera √† nouveau propos√© de v√©rifier leur pr√©cision et de cliquer sur le bouton ¬´Terminer¬ª: <br><br><img src="https://habrastorage.org/webt/zo/pd/xf/zopdxfb8rtzcvoei5xuvpt7udqe.png"><br><br>  Apr√®s avoir cliqu√© sur le bouton "Terminer", la base de donn√©es CA sera cr√©√©e dans laquelle le certificat racine CA, la cl√© priv√©e, les param√®tres syst√®me seront enregistr√©s et la page de d√©marrage de l'utilitaire CAFL63 r√©appara√Ætra √† l'√©cran.  Maintenant que nous avons cr√©√© la base de donn√©es de l'autorit√© de certification nouvellement cr√©√©e, nous cliquons sur le bouton "Ouvrir la base de donn√©es", s√©lectionnons le r√©pertoire avec la base de donn√©es, allons dans la fen√™tre de travail principale de l'autorit√© de certification et cliquez sur le bouton "Afficher l'autorit√© de certification", assurez-vous que le certificat racine que nous avons cr√©√© : <br><br><img src="https://habrastorage.org/webt/c-/x_/3r/c-x_3r8rrexuvvbov7ayzay6pze.png"><br><br>  L'√©tape suivante consiste √† pr√©parer des mod√®les / profils d'application pour les personnes morales, les particuliers et les entrepreneurs individuels ( <b><i>Outils-&gt; Param√®tres-&gt; Types de certificats-&gt; Nouveau</i></b> ): <br><br><img src="https://habrastorage.org/webt/hw/-o/ml/hw-omloedtpyfgtfq1vex8h3mug.png"><br><br>  Apr√®s avoir d√©fini le nom du nouveau profil, il vous sera propos√© de d√©terminer sa composition: <br><br><img src="https://habrastorage.org/webt/bf/yc/g_/bfycg_oxromnvlpisghe64bbuwe.png"><br><br>  La composition du profil est d√©termin√©e par le nom distinctif (nom unique / distinctif du titulaire du certificat).  Chaque profil a sa propre composition avec des champs / oids obligatoires (obligatoires) ou non.  La composition du profil pour les personnes morales, les particuliers et les entrepreneurs individuels est d√©termin√©e par les exigences de la loi f√©d√©rale-63 et les ¬´Exigences relatives au formulaire de certificat qualifi√© d'un certificat de cl√© de v√©rification de signature √©lectronique¬ª FSB de Russie. <br><br>  Apr√®s avoir pr√©par√© les profils, l'AC est pr√™te √† recevoir les candidats et les candidatures de leur part.  Comme indiqu√© ci-dessus, le demandeur peut venir avec ou sans une demande de certificat pr√™te. <br>  Si le demandeur est venu avec une demande pr√™te, puis apr√®s v√©rification de ses documents, la demande est import√©e dans la base de donn√©es de l'AC.  Pour ce faire, s√©lectionnez l'onglet ¬´Demandes de certificats¬ª dans la fen√™tre de travail principale, cliquez sur le bouton ¬´Importer la demande / CSR¬ª et s√©lectionnez le fichier avec la demande.  Apr√®s cela, une fen√™tre contenant des informations sur la demande appara√Ætra: <br><br><img src="https://habrastorage.org/webt/rd/dz/ry/rddzryagss1nr3eodjcs08bwero.png"><br><br>  Apr√®s avoir examin√© la demande et vous √™tre assur√© qu'elle est correctement remplie, vous pouvez cliquer sur le bouton ¬´Importer¬ª pour la saisir dans la base de donn√©es.  Imm√©diatement, nous notons que lorsque vous essayez de refaire une demande dans la base de donn√©es de l'AC, un message s'affiche: <br><br><img src="https://habrastorage.org/webt/ih/dy/q_/ihdyq_rplawbuh56jkw2czs8cto.png"><br><br>  Les demandes √† la base de donn√©es de l'AC sont marqu√©es (colonne ¬´Type¬ª) soit comme ¬´Param√®tres r√©gionaux¬ª cr√©√©s dans le centre d'enregistrement de l'AC, soit comme ¬´Importation¬ª cr√©√©s par le demandeur lui-m√™me, et l'heure de r√©ception de la demande dans l'AC est √©galement enregistr√©e.  Cela peut √™tre utile pour r√©soudre des situations de conflit.  Par cons√©quent, lors de l'importation d'une demande de certificat, vous devez indiquer qui a cr√©√© la demande (voir capture d'√©cran). <br>  L'application import√©e se trouve dans la base de donn√©es de l'autorit√© de certification et s'affiche dans la fen√™tre principale de l'onglet ¬´Demandes de certificat¬ª.  Les demandes re√ßues sont au stade de ¬´prise en compte¬ª (la colonne ¬´Statut¬ª des onglets ¬´Demandes de certificats¬ª et ¬´Archives des demandes¬ª).  Pour chaque demande nouvellement re√ßue, une d√©cision doit √™tre prise (menu d√©roulant lorsque vous cliquez avec le bouton droit sur la demande s√©lectionn√©e): <br><br><img src="https://habrastorage.org/webt/2e/08/l1/2e08l1p6pmp0ebvd_l1yi1b7aiy.png"><br><br>  Chaque demande doit √™tre rejet√©e ou approuv√©e: <br><br><img src="https://habrastorage.org/webt/hx/al/pt/hxalptjfajymsui_5xmtpxqnemc.png"><br><br>  Si la demande est rejet√©e, elle est d√©plac√©e de la table des demandes reqDB actuelles vers la table de l'archive de demande reqDBArc et, en cons√©quence, dispara√Æt dans l'onglet "Demandes de certificat" et appara√Æt dans l'onglet "Archive de demande". <br><br>  La demande approuv√©e reste dans le tableau reqDB et dans l'onglet ¬´Demandes de certificat¬ª jusqu'√† ce que le certificat soit √©mis, puis il finit √©galement dans l'archive. <br><br>  Avant de d√©livrer le certificat, il est n√©cessaire de pr√©ciser avec le demandeur √† quelles fins (par exemple, pour acc√©der au portail des services d'√âtat) le certificat sera utilis√© ( <b><i>Outils-&gt; Param√®tres-&gt; Types de certificats -&gt; Individuel -&gt; √âditer -&gt; Utilisation des cl√©s</i></b> ): <br><br><img src="https://habrastorage.org/webt/2p/kt/jm/2pktjm2nczklrb2mime0exznj7u.png"><br><br>  Pour √©mettre un certificat, vous devez s√©lectionner la demande approuv√©e dans l'onglet "Demande de certificats", cliquer avec le bouton droit et s√©lectionner "√âmettre le certificat" dans le menu d√©roulant.  Dans le widget qui appara√Æt, vous devrez s√©lectionner le profil auquel le profil de la demande / du certificat doit correspondre: <br><br><img src="https://habrastorage.org/webt/tl/b6/x0/tlb6x0l6lk9i8c01qnyvqma-4si.png"><br><br>  Notez que dans le processus de d√©livrance d'un certificat, vous pouvez clarifier les valeurs d'un champ particulier: <br><br><img src="https://habrastorage.org/webt/v1/07/4k/v1074kdeoyswmznoaaxx-gi7pee.png"><br><br>  La proc√©dure de d√©livrance d'un certificat lui-m√™me (√©l√©ment de menu "√âmettre un certificat") diff√®re peu de la proc√©dure de cr√©ation d'un certificat racine ou d'√©mission d'une application: <br><br><img src="https://habrastorage.org/webt/xc/yk/ls/xcyklse8bwkvsqwwqfakk_o0dvu.png"><br><br>  Le certificat √©mis appara√Ætra imm√©diatement sur l'onglet Certificats.  Dans ce cas, le certificat lui-m√™me tombe dans la table certDBNew de la base de donn√©es CA et y reste jusqu'√† sa publication.  Un certificat est consid√©r√© comme publi√© apr√®s avoir √©t√© export√© vers le vidage SQL des nouveaux certificats, qui est transf√©r√© √† un service public.  La publication d'un certificat le d√©place de la table certDBNew vers la table certDB. <br><br>  Si vous cliquez avec le bouton droit sur la ligne s√©lectionn√©e dans l'onglet "Certificats", un menu avec les fonctions suivantes appara√Ætra: <br><br><img src="https://habrastorage.org/webt/pz/f1/yn/pzf1ynfqhicu8ferbge-gtgyc9i.png"><br><br>  Ces fonctions vous permettent d'afficher √† la fois le certificat lui-m√™me et la demande sur la base de laquelle il a √©t√© √©mis.  Vous pouvez √©galement exporter le certificat vers un fichier ou vers le lecteur flash d'un demandeur.  La fonction la plus importante ici est la fonction de r√©vocation de certificat!  Il existe une fonctionnalit√© aussi exotique que l'exportation d'un certificat vers un conteneur s√©curis√© PKCS # 12.  Il est utilis√© lorsque le demandeur souhaite recevoir un tel conteneur.  Pour ces candidats, une fonction de g√©n√©ration de demande avec enregistrement de la cl√© priv√©e dans un fichier est sp√©cialement pr√©vue (bouton ¬´Cr√©er demande / CSR¬ª sur l'onglet ¬´Demandes de certificat¬ª). <br><br>  Ainsi, l'AC a commenc√© sa vie, a d√©livr√© le premier certificat.  L'un des objectifs de l'AC est l'organisation du libre acc√®s aux certificats d√©livr√©s.  La publication des certificats passe g√©n√©ralement par les services Web.  CAFL63 propose √©galement ce service: <br><br><img src="https://habrastorage.org/webt/xt/a7/6w/xta76wp2bsjapckltfuqkl0pr2y.png"><br><br>  Pour publier des certificats et des listes de certificats r√©voqu√©s sur un service public, l'AC pr√©-t√©l√©charge les certificats dans des fichiers ( <b><i>Certificats-&gt; Exporter des certificats</i></b> ), ou effectue un vidage SQL de la table de certificats enti√®re √† partir de laquelle vous pouvez cr√©er une base de donn√©es de certificats et les t√©l√©charger vers elle, puis les faire Vidage SQL des nouveaux certificats √† partir desquels ils seront ajout√©s √† la base de donn√©es de service public: <br><br><img src="https://habrastorage.org/webt/he/_d/1n/he_d1nxytwkmjwe-skvpzlzadig.png"><br><br>  La fonction fondamentale d'une autorit√© de certification est de publier une liste de certificats r√©voqu√©s, comme le fait le minist√®re de l'Int√©rieur en ce qui concerne les passeports expir√©s.  Le certificat peut √™tre r√©voqu√© √† la demande du propri√©taire.  La r√©vocation est principalement due √† la perte de la cl√© priv√©e ou √† la perte de confiance en celle-ci. <br><br>  Pour r√©voquer un certificat, il suffit de le s√©lectionner dans l'onglet "Certificats", de cliquer avec le bouton droit et de s√©lectionner l'√©l√©ment de menu "R√©vocation de certificat": <br><br><img src="https://habrastorage.org/webt/ai/7p/hk/ai7phklvqrbu1a0z7yl-xi-5xxw.png"><br><br>  La proc√©dure de r√©vocation n'est pas diff√©rente de la proc√©dure d'approbation d'une demande ou de d√©livrance d'un certificat.  Le certificat r√©voqu√© tombe dans la table cerDBRev de la base de donn√©es CA et appara√Æt dans l'onglet "Certificats r√©voqu√©s". <br><br>  Il reste √† consid√©rer la derni√®re fonction de l'AC - la publication de CRL - une liste de certificats r√©voqu√©s.  La liste CRL est form√©e sur l'onglet "Certificats r√©voqu√©s" lorsque vous cliquez sur le bouton "Cr√©er SOS / CRL".  L'administrateur doit simplement saisir le mot de passe de l'autorit√© de certification et confirmer votre intention d'√©mettre la liste de r√©vocation de certificats: <br><br><img src="https://habrastorage.org/webt/5t/db/_c/5tdb_csh_qehcmmlaws9t75pssc.png"><br><br>  La CRL √©mise tombe dans la table crlDB de la base de donn√©es et s'affiche dans l'onglet CRL / SOS. <br><br>  Pour analyser la CRL avant de la placer dans la base de donn√©es, la proc√©dure parse_crl a √©t√© √©crite: <br><br><pre> <code class="plaintext hljs">proc parse_crl {crl} { array set ret [list] if { [string range $crl 0 9 ] == "-----BEGIN" } { array set parsed_crl [::pki::_parse_pem $crl "-----BEGIN X509 CRL-----" "-----END X509 CRL-----"] set crl $parsed_crl(data) } ::asn::asnGetSequence crl crl_seq ::asn::asnGetSequence crl_seq crl_base ::asn::asnGetSequence crl_base crl_full ::asn::asnGetObjectIdentifier crl_full ret(signtype) #puts "KEY_TYPE=$ret(signtype)" ::::asn::asnGetSequence crl_base crl_issue set ret(issue) [::pki::x509::_dn_to_string $crl_issue] #puts "ISSUE=$ret(issue)" ::asn::asnGetUTCTime crl_base ret(publishDate) ::asn::asnGetUTCTime crl_base ret(nextDate) #puts "publishDate=$ret(publishDate)" return [array get ret] }</code> </pre> <br>  Pour afficher la liste de r√©vocation de certificats ou l'exporter pour publication sur un service public, vous devez, comme toujours, s√©lectionner la ligne souhait√©e, cliquer avec le bouton droit de la souris et s√©lectionner l'√©l√©ment de menu appropri√©: <br><br><img src="https://habrastorage.org/webt/np/c7/f2/npc7f2i1qb_rvyreerzj6wrbjgc.png"><br><br>  C'est tout, l'autorit√© de certification est pr√™te. <br><img src="https://habrastorage.org/webt/q1/i1/vs/q1i1vspugm4raux1pq5chgyysd4.png" align="left" alt="image">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">D√©couvrez</a> comment assembler et connecter OpenSSL √† la cryptographie russe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413493/">https://habr.com/ru/post/fr413493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413481/index.html">Exporter l'arbre de test de JMeter vers le texte</a></li>
<li><a href="../fr413485/index.html">Sortie de GitLab 10.8: mise en miroir push open source et d√©ploiement incr√©mentiel</a></li>
<li><a href="../fr413487/index.html">√Ä quoi doit s'attendre un d√©veloppeur dans le domaine de la finance: conditions de travail, projets et comp√©tences n√©cessaires</a></li>
<li><a href="../fr413489/index.html">Comment choisir un messager vraiment s√©curis√© et qu'est-ce que la blockchain a √† voir avec lui</a></li>
<li><a href="../fr413491/index.html">Food Design Digest, mai 2018</a></li>
<li><a href="../fr413495/index.html">D√©ploiement rapide ou comment d√©ployer le front-end en 15 minutes</a></li>
<li><a href="../fr413499/index.html">Ouverture d'un programme de master conjoint chez JetBrains et ITMO</a></li>
<li><a href="../fr413501/index.html">L'ann√©e pass√©e avec React: conclusions et recommandations</a></li>
<li><a href="../fr413503/index.html">Corrigez-moi si vous le pouvez: comment nous d√©boguons sur la production. Partie 1</a></li>
<li><a href="../fr413505/index.html">2 billets gratuits pour In-Memory Computing Summit Europe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>