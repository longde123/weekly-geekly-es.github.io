<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§≤ üõåüèΩ ‚èØÔ∏è Como desenvolvemos a TI na Leroy Merlin: reconstruindo um mecanismo em movimento üçº üöò üìá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="H√° quatro anos, uma base de clientes era mantida separadamente em cada loja, al√©m de outra no site. 

 Na s√©rie anterior: h√° tr√™s anos, decidimos que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como desenvolvemos a TI na Leroy Merlin: reconstruindo um mecanismo em movimento</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/leroy_merlin/blog/457466/"><img src="https://habrastorage.org/webt/cy/-z/2f/cy-z2fzscbxzwe8sybjnsqkg7j8.jpeg"><br><br>  H√° quatro anos, uma base de clientes era mantida separadamente em cada loja, al√©m de outra no site. <br><br>  Na s√©rie anterior: h√° tr√™s anos, decidimos que precis√°vamos fazer nosso desenvolvimento na R√∫ssia.  Dois anos atr√°s, eles come√ßaram a escrever seu pr√≥prio c√≥digo, em vez de modificar o c√≥digo da bifurca√ß√£o da empresa-m√£e.  A hist√≥ria de hoje ser√° sobre como mudamos de um grande mon√≥lito Legado para um monte de pequenos microsservi√ßos conectados por um tipo de √¥nibus (orquestrador). <br><br>  O caso mais f√°cil para o usu√°rio: fa√ßa um pedido pelo site e pegue na loja real Leroy Merlin na R√∫ssia.  Anteriormente, os pedidos da loja on-line eram processados ‚Äã‚Äãem outro aplicativo em geral e de acordo com um esquema diferente.  Agora, precis√°vamos de uma vitrine omnichannel para que qualquer pedido fosse dividido em uma interface: um caixa em uma loja, um aplicativo m√≥vel, um terminal em uma loja, um site - qualquer que seja.  Se voc√™ colocar o Linux no microondas, deixe-o estar.  O principal √© que algumas interfaces podem bater na API para tr√°s e dizer que aqui voc√™ precisa fazer esse e aquele pedido.  E eles receberam uma resposta clara para isso.  A segunda hist√≥ria foi com pedidos de disponibilidade e propriedades das mercadorias do cart√£o. <br><br>  Na frente (escreveremos sobre isso em breve), temos um monstro - AEM, e atr√°s dele havia duas grandes aplica√ß√µes: OPUS e MoVe.  O primeiro √© um banco de dados das propriedades de cada produto (das dimens√µes √† descri√ß√£o), o segundo √© respons√°vel pelo checkout, ou seja, o mon√≥lito do caixa.  Se bastante simplificado. <a name="habracut"></a><br><br><h3>  O que havia de errado com o Opus? </h3><br>  O OPUS √© uma grande base distribu√≠da.  Mais precisamente, este √© um software que fornece uma interface para acessar o banco de dados, ou seja, ele acessa o banco de dados e, por exemplo, pesquisa ou simplesmente define a API para que os clientes n√£o acessem diretamente o banco de dados.  Este software funciona e √© suportado na Fran√ßa.  A segunda caracter√≠stica, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como j√° dissemos</a> , √© que a linha de melhorias √© muito longa e n√£o temos a maior prioridade em compara√ß√£o com a unidade de neg√≥cios da Fran√ßa. <br><br>  Com muita dificuldade, pudemos entender como os desenvolvedores poderiam fazer altera√ß√µes sem uma equipe da Fran√ßa; aprova√ß√µes muito longas ocorreram.  Recurso lan√ßado por seis meses.  Na verdade, a princ√≠pio, quer√≠amos fazer nosso pr√≥prio desenvolvimento e sua revis√£o, e depois chegamos ao nosso pr√≥prio desenvolvimento, nossa infraestrutura, nossos testes e, em geral, o nosso.  E, ao mesmo tempo, jogou fora quase um ter√ßo do c√≥digo legado. <br><br>  Mas voltando ao OPUS.  Como o sistema armazena informa√ß√µes relevantes sobre a disponibilidade, caracter√≠sticas, transa√ß√µes e outras coisas, n√≥s o utilizamos por qualquer motivo.  Especificamente para o site, isso significava que, se o usu√°rio tiver tr√™s produtos na cesta, ser√° necess√°rio bater no banco de dados de cada p√°gina, porque a relev√¢ncia √© verificada.  Mesmo se voc√™ bater uma vez no cache e atualiz√°-lo de forma inteligente, ainda havia recursos.  Quando voc√™ abre a p√°gina do cat√°logo em geral, todas as especifica√ß√µes do produto foram obtidas do OPUS. <br><br>  O pr√≥ximo passo l√≥gico √© que come√ßamos a extrair OPUS com menos frequ√™ncia e criamos nossa base (mais precisamente, microsservi√ßos com bases).  O sistema como um todo foi chamado de PUB russo. <br><br>  Ent√£o eles fizeram uma orquestra, que j√° pode armazenar agregados, ou seja, os dados coletados para a cria√ß√£o de p√°ginas.  No sentido em que, quando o usu√°rio alterna a visualiza√ß√£o da p√°gina de cart√µes para listas, ainda √© o mesmo agregado, apenas a frente √© diferente. <br><br>  Ou seja, deixamos o OPUS original (ainda est√° na Fran√ßa), mas nosso espelho ‚Äúquase completo‚Äù ‚Äúsuga‚Äù, que corta a base em peda√ßos, pronta para montagem em uma orquestra.  E o orquestrador coleta e armazena os agregados (ou os recebe rapidamente e come√ßa a armazen√°-los), de que outros sistemas precisam.  Como resultado, esta parte funciona como deveria.  Da funcionalidade original do OPUS franc√™s, restam cerca de cinco por cento.  Em breve iremos substitu√≠-lo completamente. <br><br><h3>  O que havia de errado com o MoVe? </h3><br>  Nada de especial, exceto pelo fato de termos decidido jogar fora todo o c√≥digo, porque: <br><br><ol><li>  Era antigo em uma pilha velha. </li><li>  Ele levou em considera√ß√£o as caracter√≠sticas de cada regi√£o "Leroy Merlin" na cadeia de FIs. </li><li>  Era t√£o dif√≠cil ler e manter que o melhor m√©todo de refatora√ß√£o era "escrever novamente e imediatamente documentar normalmente". </li></ol><br>  O que n√≥s fizemos.  Somente o reescrevemos n√£o como um mon√≥lito, mas come√ßamos a fazer microsservi√ßos para cada fun√ß√£o individual ao redor.  E ent√£o parte da funcionalidade do MoVe com a mudan√ßa para o microsservi√ßo foi removida sem problemas.  E assim - um por um, at√© a funcionalidade do MoVe terminar completamente.  Ou seja, ele ainda funciona, mas em algum lugar no v√°cuo e sem fluxos de dados. <br><br>  Desde que constru√≠mos a plataforma a partir de pe√ßas, o projeto recebeu o nome de Lego. <br><br>  Lego mudou completamente este meio.  Sim, vamos esclarecer: um back-end real √© um barramento herdado, sistemas de arquivos, bancos de dados e outros quase em n√≠vel de infraestrutura.  Grandes aplicativos em torno disso e microsservi√ßos da l√≥gica s√£o intermedi√°rios.  A apresenta√ß√£o j√° √© a frente. <br><br><h3>  Por que voc√™ precisou reescrever tudo isso? </h3><br>  Porque vivemos com bases de clientes separadas para cada inst√¢ncia, 15 anos ap√≥s a abertura na R√∫ssia, e isso n√£o serviu para ningu√©m.  Tamb√©m n√£o houve sincroniza√ß√£o.  Em outros pa√≠ses, eles ainda vivem assim. <br><br>  A matriz da Fran√ßa fez a log√≠stica geral, reutilizamos o sistema Pixis - trata-se de uma √∫nica loja de recebimentos, ou seja, pedidos de clientes: uma loja v√™ os pedidos de outra loja.  Mas isso n√£o resolveu completamente o problema de pedidos omnichannel.  Portanto, era necess√°rio consolidar a base e fazer o processamento geral.  Esta √© a principal coisa. <br><br>  O segundo motivo foi a lei federal das bilheterias: com nossos prazos de desenvolvimento para um sistema comum (e testes) para todos os pa√≠ses, ter√≠amos multado por multas. <br><br>  Uma op√ß√£o aproximadamente semelhante foi lan√ßada no Brasil: eles come√ßaram a Leroy Merlin l√° sem nenhum software da controladora e tiveram sucesso.  Isso foi antes da decis√£o dividida.  A prop√≥sito, eles se comprometem muito com os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">innersors</a> , eles t√™m um desenvolvimento muito r√°pido. <br><br>  Pixis permitiu fazer um pedido apenas na caixa registradora, na verdade.  Mudamos a situa√ß√£o em tr√™s etapas: <br><br><ol><li>  Primeiro, fizemos um aplicativo m√≥vel para o funcion√°rio, o que simplifica bastante sua vida.  Com base nisso, eles come√ßaram a construir um ecossistema em que as interfaces s√£o separadas pela l√≥gica. </li><li>  Enquanto tudo estava pronto, os pedidos pela Internet eram levados √† mesa de caixa manualmente. </li><li>  Eles colocaram microsservi√ßos, que substitu√≠ram tudo no meio. </li></ol><br>  Por que voc√™ precisou come√ßar com o aplicativo da loja?  Porque, novamente, temos processos √∫nicos em compara√ß√£o com a Fran√ßa.  Por exemplo, uma pessoa decidiu comprar seis metros e dez cent√≠metros de uma corrente em uma loja.  O vendedor o interrompeu, deu um documento por quanto tempo e quanto custa.  Voc√™ vai ao caixa com este peda√ßo de papel e paga l√°.  Do ponto de vista da l√≥gica, a venda n√£o deve ser nas bilheterias, mas o vendedor deve t√™-la, mas, de fato, √© nas bilheterias que come√ßa a coisa mais interessante: voc√™ precisa ter as mercadorias e o papel. <br><br>  No final, seremos uma plataforma para fazer pedidos: agora, por exemplo, no topo de nosso sistema principal, foram adicionados servi√ßos de compra de mestres (comprei uma cozinha - pedi a instala√ß√£o de um mestre externo, mas a encontramos e garantimos a n√≥s mesmos), <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mercado</a> ( compra direta de um fornecedor em uma faixa mais ampla) e logo deve haver um afiliado para que nossos blocos possam ser colocados em qualquer lugar.  Algo como incorporar lojas da Amazon em blogs, apenas mais vers√°til. <br><br><h3>  Como foi tomada a decis√£o de substitui√ß√£o? </h3><br>  <b>Eu passo.</b>  <b>Refine o modelo de neg√≥cios.</b> <br><br>  Verificamos e, de fato: o modelo, como na R√∫ssia - pre√ßos baixos todos os dias - √© bem-sucedido.  A Leroy Merlin na Europa √© significativamente mais cara, mas √© na R√∫ssia que este √© o nosso nicho: uma loja de constru√ß√£o onde voc√™ pode encontrar mercadorias com o melhor pre√ßo. <br><br>  <b>II passo.</b>  <b>Crie um script de cliente.</b> <br><br>  Ou seja, criar processos como queremos que eles interajam conosco do ponto de vista do cliente.  Ou seja, uma vis√£o √∫nica de quem queremos ser daqui a alguns anos e como ela se parece do ponto de vista da arquitetura. <br><br>  <b>III passo.</b>  <b>Construa uma arquitetura.</b> <br><br>  Divida essa vis√£o em TK e arquitetura espec√≠ficas com mais detalhes.  Foram 110 projetos, divididos em cinco categorias por cinco anos. <br><br>  Ent√£o eles formaram equipes especializadas.  Na maioria das vezes, essas pessoas s√£o seu pessoal e um contratado.  A princ√≠pio, eles sofreram muito com isso: quando foram ao prod, eles realmente n√£o entenderam como digerir um volume t√£o grande de altera√ß√µes.  Ent√£o eles come√ßaram a fazer uma abordagem comum para as tarefas e aumentar gradualmente a parcela de seu desenvolvimento. <br><br>  Nos lugares em que o erro era cr√≠tico, eles trabalhavam de acordo com os esquemas da NASA, onde o erro √© inaceit√°vel, n√£o √© uma op√ß√£o.  Isso √© tudo sobre transa√ß√µes em dinheiro. <br><br>  E onde era poss√≠vel cair, o principal era levantar-se rapidamente, usamos uma abordagem pr√≥xima ao SRE do Google.  Iterativamente, com batentes, mas os projetos podem ser implementados o mais r√°pido poss√≠vel.  E agora estamos fazendo muito, e √© muito legal desenvolver. <br><br>  A terceira abordagem √© a inova√ß√£o.  Desenvolvemos um sandbox de id√©ias para fazer rapidamente os primeiros MVPs com nossos recursos internos, o que nos permite testar de forma r√°pida e barata.  Este √© o verdadeiro "tente r√°pido, falhe r√°pido".  Isso permitiu que voc√™ obtivesse um or√ßamento e autoridade para aqueles que criaram um projeto interessante. <br><br>  O segundo foco importante estava no geodesenvolvimento.  Em seguida, abriu 20 lojas por ano (agora um pouco mais lento).  Seis mil funcion√°rios.  Muitas regi√µes.  Era necess√°rio reescrever toda a cadeia de suprimentos, desenvolver rapidamente processos para elevar a infraestrutura das lojas. <br><br>  Em 2017, decidimos nos tornar uma plataforma para pedidos de constru√ß√£o: essa √© uma estrat√©gia promissora nos pr√≥ximos anos. <br><br>  Para a geografia, precis√°vamos de um grande escrit√≥rio de TI para o crescimento da empresa e o crescimento da cadeia de suprimentos.  Para omnichannel (ordem geral) - um n√≠vel diferente de SLA para sistemas internos, tempo real, microsservi√ßos e sincroniza√ß√£o entre centenas de subsistemas.  Geralmente, esse √© um n√≠vel diferente de maturidade de TI.  Para a plataforma, a velocidade da mudan√ßa tamb√©m √© importante. <br><br>  Quando estava come√ßando, todos pensavam que o √°gil salvaria o mundo.  Com os contratados, o √°gil pode n√£o ser t√£o eficaz.  Da√≠ o desejo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recrutar</a> 200 pessoas no departamento de TI. <br><br>  Observamos com que rapidez podemos implementar tudo sem perda para a marca.  Algo poderia ser escrito rapidamente, mas n√£o havia tempo para preparar o servi√ßo.  Por exemplo, se n√£o houver informa√ß√µes sobre o estoque, n√£o h√° como pagar on-line sem a garantia de que as mercadorias ser√£o reservadas.  N√≥s decompusemos a cadeia de interdepend√™ncias em v√°rias.  Agora j√° sabemos que precisamos reduzir os ciclos, porque as compet√™ncias da equipe ainda s√£o importantes.  Agora estamos vendo recursos em peda√ßos pequenos, estamos coletando uma conex√£o, agora apenas o ano atual est√° nos planos.  Uma estrat√©gia de longo prazo, mas por recursos, tem no m√°ximo um ano e muitas equipes de produtos separadas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt457466/">https://habr.com/ru/post/pt457466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt457450/index.html">As 10 principais tend√™ncias tecnol√≥gicas em processamento e an√°lise de dados em 2019, de acordo com o Gartner</a></li>
<li><a href="../pt457458/index.html">Suporte m√≥vel para m√°quinas-ferramentas chinesas. Ou como coloc√°-los em um apartamento</a></li>
<li><a href="../pt457460/index.html">Placa de Seguran√ßa do Kernel Linux</a></li>
<li><a href="../pt457462/index.html">Uber: vis√£o geral dos principais algoritmos de gerenciamento de plataforma</a></li>
<li><a href="../pt457464/index.html">Desduplica√ß√£o de an√∫ncios no Yandex.Real Estate</a></li>
<li><a href="../pt457468/index.html">Mem√≥ria universal: SRAM, DRAM e mem√≥ria flash em um frasco</a></li>
<li><a href="../pt457470/index.html">Matem√°tica das folhas: como um arbusto incomum mudou a equa√ß√£o de um modelo de crescimento vegetal</a></li>
<li><a href="../pt457476/index.html">Reduzindo o tamanho de uma imagem do Docker com um aplicativo de inicializa√ß√£o por mola</a></li>
<li><a href="../pt457480/index.html">Criando um aplicativo de escuta para visualizar o tr√°fego m√≥vel do MMORPG</a></li>
<li><a href="../pt457490/index.html">Aisioshechka de Zuckerberg - brevemente e no caso Libra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>