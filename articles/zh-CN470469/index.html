<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍🔬 👍🏻 🔎 PVS-Studio走向云端：CircleCI 🚄 👨🏻‍🏫 🧔🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="我们继续介绍在云CI系统中使用PVS-Studio静态分析器的系列文章。 今天，我们正在考虑另一项服务-CircleCI。 这次，Kodi媒体播放器将充当分析项目，我们将在其源代码中尝试找到有趣的地方。 

 注意事项 可以在此处找到有关将PVS-Studio集成到云CI系统中的其他文章： 



...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio走向云端：CircleCI</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/470469/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/97b/e54/c6a/97be54c6a44e36ab4503e4e94e67d1ad.png" alt="图片2"></div><br> 我们继续介绍在云CI系统中使用PVS-Studio静态分析器的系列文章。 今天，我们正在考虑另一项服务-CircleCI。 这次，Kodi媒体播放器将充当分析项目，我们将在其源代码中尝试找到有趣的地方。 <br><a name="habracut"></a><br>  <b>注意事项</b> 可以在此处找到有关将PVS-Studio集成到云CI系统中的其他文章： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PVS-Studio走向云端：Azure DevOps</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PVS-Studio走向云端-在Travis CI上启动分析</a> </li></ul><br> 在我们直接设置和分析分析仪警告之前，让我们先谈谈使用和分析的软件。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CircleCI</a>是基于云的CI服务，用于自动化软件的组装，测试和发布。 它支持在容器以及运行Windows，Linux和macOS的虚拟机中的项目组装。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kodi</a>是一个免费的开源跨平台媒体播放器。 允许您播放家用计算机以及本地网络或Internet上的音频和视频文件。 它通过安装插件来支持主题和功能。 适用于Windows，Linux，macOS和Android。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PVS-Studio</a>是静态代码分析器，用于搜索用C，C ++，C＃和Java编写的代码中的错误和潜在漏洞。 适用于Windows，Linux和macOS。 <br><br><h2> 客制化 </h2><br> 转到<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CircleCI</a>主页，然后单击“注册”按钮 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ee0/121/d75/ee0121d7543f1955b5d4284efa438eff.png" alt="图片1"></div><br> 在下一页上，将提示我们使用GitHub或Bitbucket帐户进行身份验证。 选择GitHub并转到CircleCI应用程序授权页面。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dae/985/d5a/dae985d5a2bff1cfef699d9f8a650360.png" alt="图片3"></div><br> 我们授权该应用程序（绿色按钮“ Authorize circleci”），然后将我们重定向到欢迎页面“ Welcome to CircleCI！”。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c46/7e9/5c8/c467e95c8d8a6e055667f8b934645e67.png" alt="图片4"></div><br> 在此页面上，我们可以立即配置将在CircleCI中组装的项目。 我们标记我们的存储库，然后单击“关注”。 <br><br> 添加存储库后，CircleCI将自动开始构建，但是由于 存储库中还没有配置文件-构建任务将失败。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ad2/946/66d/ad294666d51018dd62cdbc91e331050d.png" alt="图片5"></div><br> 在添加配置文件之前，我们将添加包含分析仪许可证数据的项目变量。 为此，请单击左侧面板中的“设置”，然后在“组织”组中选择“项目”项，然后单击我们所需项目右侧的齿轮。 将打开一个设置窗口。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e15/9fa/42c/e159fa42c18e0dd7fb7f3783b5b97bb5.png" alt="图片6"></div><br> 我们对“环境变量”部分感兴趣。 我们进入其中，并创建<i>PVS_USERNAME</i>和<i>PVS_KEY</i>变量，其中包含分析仪的用户名和许可证密钥。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74a/2ce/b69/74a2ceb69055932dae23b3e1843aa303.png" alt="图片7"></div><br> 启动项目构建时，CircleCI从存储库中的文件中沿路径.circleci / config.yml读取任务配置。 添加它。 <br><br> 首先，我们指示分析器将在其中启动的虚拟机的映像。 图像的完整列表在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">此处提供</a> 。 <br><br><pre><code class="cpp hljs">version: <span class="hljs-number"><span class="hljs-number">2</span></span> jobs: build: machine: image: ubuntu<span class="hljs-number"><span class="hljs-number">-1604</span></span>:<span class="hljs-number"><span class="hljs-number">201903</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span></code> </pre> <br> 接下来，添加必要的存储库以apt并安装项目依赖项： <br><br><pre> <code class="cpp hljs">steps: - checkout - run: sudo -- sh -c <span class="hljs-string"><span class="hljs-string">" add-apt-repository -y ppa:team-xbmc/xbmc-ppa-build-depends &amp;&amp; add-apt-repository -y ppa:wsnipex/vaapi &amp;&amp; add-apt-repository -y ppa:pulse-eight/libcec &amp;&amp; apt-get update"</span></span> - run: sudo apt-get install -y automake autopoint build-essential cmake curl <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-jre gawk gdb gdc gettext git-core gperf libasound2-dev libass-dev libbluray-dev libbz2-dev libcap-dev libcdio-dev libcec4-dev libcrossguid-dev libcurl3 libcurl4-openssl-dev libdbus<span class="hljs-number"><span class="hljs-number">-1</span></span>-dev libegl1-mesa-dev libfmt3-dev libfontconfig-dev libfreetype6-dev libfribidi-dev libfstrcmp-dev libgif-dev libgl1-mesa-dev libglu1-mesa-dev libiso9660-dev libjpeg-dev liblcms2-dev libltdl-dev liblzo2-dev libmicrohttpd-dev libmysqlclient-dev libnfs-dev libpcre3-dev libplist-dev libpng-dev libpulse-dev libsmbclient-dev libsqlite3-dev libssl-dev libtag1-dev libtinyxml-dev libtool libudev-dev libusb-dev libva-dev libvdpau-dev libxml2-dev libxmu-dev libxrandr-dev libxrender-dev libxslt1-dev libxt-dev mesa-utils nasm pmount python-dev python-imaging python-sqlite rapidjson-dev swig unzip uuid-dev yasm zip zlib1g-dev wget</code> </pre> <br> 添加PVS-Studio存储库并安装分析器： <br><br><pre> <code class="cpp hljs">- run: wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add - &amp;&amp; sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - run: sudo -- sh -c "apt-get update &amp;&amp; apt-get install pvs-studio -y"</span></span></code> </pre> <br> 让我们收集项目依赖项： <br><br><pre> <code class="cpp hljs">- run: sudo make -C tools/depends/target/flatbuffers PREFIX=/usr/local</code> </pre> <br> 在程序集目录中生成Makefile： <br><br><pre> <code class="cpp hljs">- run: mkdir build &amp;&amp; cd build &amp;&amp; cmake -DCMAKE_BUILD_TYPE=Debug ..</code> </pre><br> 下一步是配置并运行我们项目的静态分析。 <br><br> 首先，使用分析器许可证创建文件。 第二个命令开始编译项目程序集跟踪。 <br><br> 跟踪之后，我们直接开始静态分析。 使用试用许可证时，必须使用以下参数启动分析仪： <br><br>  <i>--disableLicenseExpirationCheck</i> 。 <br><br> 最后一个命令将带有分析器结果的文件转换为html报告： <br><br><pre> <code class="cpp hljs">- run: pvs-studio-analyzer credentials -o PVS.lic ${PVS_USER} ${PVS_KEY} - run: pvs-studio-analyzer trace -- make -j2 -C build/ - run: pvs-studio-analyzer analyze -j2 -l PVS.lic -o PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> --disableLicenseExpirationCheck - run: plog-converter -t html -o PVS-Studio.html PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br> 完成测试后，保存分析器报告： <br><br><pre> <code class="cpp hljs">- run: mkdir PVS_Result &amp;&amp; cp PVS-Studio.* ./PVS_Result/ - store_artifacts: path: ./PVS_Result</code> </pre> <br>  .circleci / config.yml文件的全文： <br><br><pre> <code class="cpp hljs">version: <span class="hljs-number"><span class="hljs-number">2.1</span></span> jobs: build: machine: image: ubuntu<span class="hljs-number"><span class="hljs-number">-1604</span></span>:<span class="hljs-number"><span class="hljs-number">201903</span></span><span class="hljs-number"><span class="hljs-number">-01</span></span> steps: - checkout - run: sudo -- sh -c <span class="hljs-string"><span class="hljs-string">" add-apt-repository -y ppa:team-xbmc/xbmc-ppa-build-depends &amp;&amp; add-apt-repository -y ppa:wsnipex/vaapi &amp;&amp; add-apt-repository -y ppa:pulse-eight/libcec &amp;&amp; apt-get update"</span></span> - run: sudo apt-get install -y automake autopoint build-essential cmake curl <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>-jre gawk gdb gdc gettext git-core gperf libasound2-dev libass-dev libbluray-dev libbz2-dev libcap-dev libcdio-dev libcec4-dev libcrossguid-dev libcurl3 libcurl4-openssl-dev libdbus<span class="hljs-number"><span class="hljs-number">-1</span></span>-dev libegl1-mesa-dev libfmt3-dev libfontconfig-dev libfreetype6-dev libfribidi-dev libfstrcmp-dev libgif-dev libgl1-mesa-dev libglu1-mesa-dev libiso9660-dev libjpeg-dev liblcms2-dev libltdl-dev liblzo2-dev libmicrohttpd-dev libmysqlclient-dev libnfs-dev libpcre3-dev libplist-dev libpng-dev libpulse-dev libsmbclient-dev libsqlite3-dev libssl-dev libtag1-dev libtinyxml-dev libtool libudev-dev libusb-dev libva-dev libvdpau-dev libxml2-dev libxmu-dev libxrandr-dev libxrender-dev libxslt1-dev libxt-dev mesa-utils nasm pmount python-dev python-imaging python-sqlite rapidjson-dev swig unzip uuid-dev yasm zip zlib1g-dev wget - run: wget -q -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | sudo apt-key add – &amp;&amp; sudo wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - run: sudo -- sh -c "apt-get update &amp;&amp; apt-get install pvs-studio -y" - run: sudo make -C tools/depends/target/flatbuffers PREFIX=/usr/local - run: mkdir build &amp;&amp; cd build &amp;&amp; cmake -DCMAKE_BUILD_TYPE=Debug .. - run: pvs-studio-analyzer credentials -o PVS.lic ${PVS_USER} ${PVS_KEY} - run: pvs-studio-analyzer trace -- make -j2 -C build/ - run: pvs-studio-analyzer analyze -j2 -l PVS.lic -o PVS-Studio.log --disableLicenseExpirationCheck - run: plog-converter -t html -o PVS-Studio.html PVS-Studio.log - run: mkdir PVS_Result &amp;&amp; cp PVS-Studio.* ./PVS_Result/ - store_artifacts: path: ./PVS_Result</span></span></code> </pre> <br> 我们将文件上传到存储库，CircleCI将自动开始项目的组装。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/56d/a82/597/56da82597874166081473599a7c69e5f.png" alt="图片12"></div><br> 任务结束后，可以在“工件”选项卡上下载带有分析仪结果的文件。 <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a7/90d/f7e/5a790df7eb8a3868d7266b05aeabff4e.png" alt="图片11"></div><br><h2> 分析结果 </h2><br> 好了，现在让我们看一下分析仪在工作期间发出的一些警告。 <br><br>  <b>PVS-Studio警告</b> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V504</a>分号';'的可能性很大。  “ return”关键字后缺失。  AdvancedSettings.cpp：1476 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CAdvancedSettings::SetExtraArtwork(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TiXmlElement* arttypes, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;&amp; artworkMap) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!arttypes) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> artworkMap.clear(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TiXmlNode* arttype = arttypes-&gt;FirstChild(<span class="hljs-string"><span class="hljs-string">"arttype"</span></span>); .... }</code> </pre> <br> 根据代码的格式判断，假定以下执行逻辑： <br><br><ul><li> 如果<i>arttypes</i>是空指针，则完成该方法的执行； </li><li> 如果<i>arttypes</i>是一个非零的指针，请清除ArtworkMap矢量，然后执行一些其他操作。 </li></ul><br> 但是，缺少字符“;” 进行了调整； 结果，执行逻辑根本不对应于格式化。 结果，它变为以下内容： <br><br><ul><li> 如果<i>arttypes</i>是一个空指针，则<i>清除articleMap</i>向量，然后退出该方法。 </li><li> 如果<i>arttypes</i>是非零指针， <i>则将</i>执行进一步的操作，但不会清除<i>artsMapMap</i>向量。 </li></ul><br> 通常，没有错误的可能性很小。 而且几乎没有人会本着<i>返回artworkMap.clear（）</i>的精神来编写表达式<i>。</i>  :)。 <br><br>  <b>PVS-Studio警告</b> ： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V547</a>表达式“ lastsector”始终为false。  udf25.cpp：636 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V547</a>表达式“ lastsector”始终为false。  udf25.cpp：644 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V571</a>定期检查。  'if（lastsector）'条件已在第636行中得到验证。udf25.cpp：644 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> udf25::UDFGetAVDP( struct <span class="hljs-keyword"><span class="hljs-keyword">avdp_t</span></span> *avdp) { .... <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> lastsector; .... lastsector = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... for(;;) { .... if( lastsector ) { // &lt;= V547 lbnum = lastsector; terminate = 1; } else { //! @todo Find last sector of the disc (this is optional). if( lastsector ) // &lt;= V547 lbnum = lastsector - 256; else return 0; } } .... }</span></span></code> </pre><br> 请注意标有<i>// &lt;=</i>的地方。 将值0写入<i>lastsector</i>变量，然后将其两次用作<i>if语句</i>的条件表达式。 由于变量的值在循环或这些赋值之间都不会改变，因此两个<i>if语句</i>的分支都不会执行。 <br><br> 确实可能尚未实现必要的功能（请注意<i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" class="user_link">todo</a></i> ）。 <br><br> 顺便说一下，正如您所看到的，分析仪立即为该代码发出3条警告。 但是，有时甚至没有几个警告是不够的，并且用户仍然认为分析仪是错误的...一位同事在“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PVS-Studio用户支持的一天</a> ” <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">一</a>文中写道： <br><br>  <b>PVS-Studio</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">警告</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V547</a>表达式'values.size（）！= 2'始终为false。  GUIControlSettings.cpp：1174 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CGUIControlRangeSetting::OnClick() { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;CVariant&gt; values; SettingConstPtr listDefintion = settingList-&gt;GetDefinition(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (listDefintion-&gt;GetType()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SettingType::Integer: values.push_back(m_pSlider-&gt; GetIntValue(CGUISliderControl::RangeSelectorLower)); values.push_back(m_pSlider-&gt; GetIntValue(CGUISliderControl::RangeSelectorUpper)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> SettingType::Number: values.push_back(m_pSlider-&gt; GetFloatValue(CGUISliderControl::RangeSelectorLower)); values.push_back(m_pSlider-&gt; GetFloatValue(CGUISliderControl::RangeSelectorUpper)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (values.size() != <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; SetValid(CSettingUtils::SetList(settingList, values)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsValid(); }</code> </pre> <br> 在这种情况下，检查<i>values.size（）！= 2</i>是多余的，因为条件表达式的结果将始终为<i>false</i> 。 实际上，如果执行进入<i>switch语句</i>的<i>case</i>分支之一，则将2个元素添加到向量中，并且由于该向量为空，因此其大小将等于2； 否则（执行<i>默认</i>分支时），该方法将退出。 <br><br>  <b>PVS-Studio</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">警告</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V547</a>表达式' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">prio</a> == 0x7fffffff'始终为true。  DBusReserve.cpp：57 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CDBusReserve::AcquireDevice(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; device) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> prio = INT_MAX; .... res = dbus_bus_request_name( m_conn, service.c_str(), DBUS_NAME_FLAG_DO_NOT_QUEUE | (prio == INT_MAX ? <span class="hljs-number"><span class="hljs-number">0</span></span> : DBUS_NAME_FLAG_ALLOW_REPLACEMENT), <span class="hljs-comment"><span class="hljs-comment">// &lt;= error); .... }</span></span></code> </pre> <br>  <i>prio</i>变量使用值<i>INT_MAX</i>初始化，此后在比较<i>prio == INT_MAX中</i>也用在三元运算符中。 但是，在初始化和使用之间，其值不会改变，因此，表达式<i>prio == INT_MAX的</i>值为<i>true</i> ，三元运算符将始终返回0。 <br><br>  <b>PVS-Studio警告</b> ： <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V575</a>潜在的空指针被传递到“ memcpy”函数中。 检查第一个参数。 检查行：39，38。DVDOverlayImage.h：39 </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V575</a>潜在的空指针被传递到“ memcpy”函数中。 检查第一个参数。 检查行：44，43。DVDOverlayImage.h：44 </li></ul><br><pre> <code class="cpp hljs">CDVDOverlayImage(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CDVDOverlayImage&amp; src) : CDVDOverlay(src) { Data = (<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>*)<span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(src.linesize * src.height); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(data, src.data, src.linesize * src.height); <span class="hljs-comment"><span class="hljs-comment">// &lt;= if(src.palette) { palette = (uint32_t*)malloc(src.palette_colors * 4); memcpy(palette, src.palette, src.palette_colors * 4); // &lt;= } .... }</span></span></code> </pre> <br> 两种警告的模式相同-通过调用<i>malloc</i>函数获得的指针将在<i>memcpy</i>函数中进一步使用，而无需先检查<i>NULL</i> 。 <br><br> 有人可能希望在以下关键字中反对这些警告： <i>malloc</i>永远不会返回空指针，如果确实如此，则会让应用程序更好地运行。 这是一个长时间讨论的主题，但是我建议采用一种或多种方式阅读同事的笔记-“ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">检查malloc函数返回的重要性为什么很重要</a> ”。 <br><br> 如果需要，可以将分析器配置为以不认为<i>malloc</i>可以返回空指针的方式运行-则不会出现此类警告。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关此内容的更多信息。 <br><br>  <b>PVS-Studio警告</b> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V522</a>可能会取消引用潜在的空指针“入口”。 检查行：985、981。emu_msvcrt.cpp：985 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">struct dirent *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dll_readdir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(DIR *dirp)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dirent</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entry</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NULL</span></span></span><span class="hljs-class">;</span></span> entry = (dirent*) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(*entry)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dirData-&gt;curr_index &lt; dirData-&gt;items.Size() + <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dirData-&gt;curr_index == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">strncpy</span></span>(entry-&gt;d_name, <span class="hljs-string"><span class="hljs-string">".\0"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); .... }</code> </pre> <br> 这种情况类似于上述情况。 由于调用<i>malloc</i>而获得的指针被写入到<i>入口</i>变量中，然后使用该指针而不检查<i>NULL</i> （ <i>entry-&gt; d_name</i> ）。 <br><br>  <b>PVS-Studio警告</b> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V773</a>在没有释放内存的情况下退出了'progressHandler'指针的可见性范围。 可能发生内存泄漏。  PVRGUIChannelIconUpdater.cpp：94 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CPVRGUIChannelIconUpdater::SearchAndUpdateMissingChannelIcons() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... CPVRGUIProgressHandler* progressHandler = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CPVRGUIProgressHandler(g_localizeStrings.Get(<span class="hljs-number"><span class="hljs-number">19286</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; group : m_groups) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;PVRChannelGroupMember&gt; members = group-&gt;GetMembers(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> channelIndex = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; member : members) { progressHandler-&gt;UpdateProgress(member.channel-&gt;ChannelName(), channelIndex++, members.size()); .... } progressHandler-&gt;DestroyProgress(); }</code> </pre> <br>  <i>progressHandler</i>指针包含通过调用<i>运算符new</i>获得的值。 但是，此指针未调用<i>运算符delete</i> ，这会导致内存泄漏。 <br><br>  <b>PVS-Studio警告</b> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V557</a>阵列可能超限。  'idx'索引指向数组边界之外。  PlayerCoreFactory.cpp：240 <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;CPlayerCoreConfig *&gt; m_vecPlayerConfigs; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CPlayerCoreFactory::PlaysVideo(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&amp; player) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-function"><span class="hljs-function">CSingleLock </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(m_section)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> idx = GetPlayerIndex(player); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_vecPlayerConfigs.empty() || idx &gt; m_vecPlayerConfigs.size()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_vecPlayerConfigs[idx]-&gt;m_bPlaysVideo; }</code> </pre> <br> 由于条件表达式， <i>if语句</i>对向量<i>m_vecPlayerConfigs</i>的大小施加了限制，如果为true，则退出方法。 结果，如果代码执行到达最后一个<i>return语句</i> ，则向量<i>m_vecPlayerConfigs</i>的大小在指定范围内：[1;  idx]。 但是，下面的几行是<i>idx</i> <i>调用</i> ： <i>m_vecPlayerConfigs [idx]-&gt; m_bPlaysVideo</i> 。 结果，如果<i>idx</i>等于向量的大小，它将超出允许范围的边界。 <br><br> 最后，看看关于<b>Platinum</b>库代码的一些警告。 <br><br>  <b>PVS-Studio警告</b> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V542</a>请考虑检查一个奇怪的类型转换：'bool'到'char *'。  PltCtrlPoint.cpp：1617 <br><br><pre> <code class="cpp hljs">NPT_Result PLT_CtrlPoint::ProcessSubscribeResponse(...) { .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> subscription = (request.GetMethod().ToUppercase() == <span class="hljs-string"><span class="hljs-string">"SUBSCRIBE"</span></span>); .... NPT_String prefix = NPT_String::Format(<span class="hljs-string"><span class="hljs-string">" PLT_CtrlPoint::ProcessSubscribeResponse %ubscribe for service \"%s\" (result = %d, status code = %d)"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)subscription?<span class="hljs-string"><span class="hljs-string">"S"</span></span>:<span class="hljs-string"><span class="hljs-string">"Uns"</span></span>, <span class="hljs-comment"><span class="hljs-comment">// &lt;= (const char*)service-&gt;GetServiceID(), res, response?response-&gt;GetStatusCode():0); .... }</span></span></code> </pre> <br> 在这种情况下，操作的优先级会混淆。  <i>const char *</i>不是计算三元运算符（ <i>预订？“ S”：“ Uns”</i> ）的结果，而是变量<i>subscription</i> 。 至少看起来很奇怪。 <br><br>  <b>PVS-Studio</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">警告</a> ： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">V560</a>条件表达式的一部分始终为false：c =='\ t'。  NptUtils.cpp：863 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">NPT_Result </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NPT_ParseMimeParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NPT_MIME_PARAMETER_PARSER_STATE_NEED_EQUALS: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-string"><span class="hljs-string">' '</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NPT_ERROR_INVALID_SYNTAX; <span class="hljs-comment"><span class="hljs-comment">// END or CTLs are invalid if (c == ' ' || c == '\t') continue; // ignore leading whitespace .... }</span></span></code> </pre> <br> 空格代码为0x20，制表符代码为0x09。 因此，子表达式<i>c =='\ t'</i>将始终为<i>false</i> ，因为这种情况已经由表达式<i>c &lt;''</i>覆盖（如果为true，则该函数将退出）。 <br><br><h2> 结论 </h2><br> 从本文中可以看到，在下一个CI系统（CircleCI）上，我们设法使用PVS-Studio配置项目验证。 我建议您<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">下载并</a>在项目上<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">试用</a>分析仪。 如果您对配置或使用分析仪有任何疑问，请随时<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">给我们写信</a> ，我们将竭诚为您服务。 <br><br> 当然，还有朋友，你粗心的代码。  :) <br><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><img src="https://habrastorage.org/getpro/habr/post_images/898/3b6/5a7/8983b65a74adb29a2113eba12fbec3f1.png" align="left"></a> </p><br><br> 如果您想与讲英语的读者分享这篇文章，请使用以下链接：Sergey Vasiliev，Ilya Gainulin。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">云中的PVS-Studio：CircleCI</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN470469/">https://habr.com/ru/post/zh-CN470469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN470449/index.html">成为前端开发人员所需的主要技能</a></li>
<li><a href="../zh-CN470451/index.html">绿色初中如何融入IT</a></li>
<li><a href="../zh-CN470453/index.html">零售IT自行车-就像12年前一样</a></li>
<li><a href="../zh-CN470461/index.html">我们如何在一天内将整个团队移植到另一种语言中（实际上不是）</a></li>
<li><a href="../zh-CN470465/index.html">云中的PVS-Studio：CircleCI</a></li>
<li><a href="../zh-CN470473/index.html">导入编年史：MyOffice的回顾</a></li>
<li><a href="../zh-CN470475/index.html">无障碍访问：低成本音频评论</a></li>
<li><a href="../zh-CN470477/index.html">变形金刚宇宙拉克塔中心。 第1集：上下</a></li>
<li><a href="../zh-CN470479/index.html">如果您真的没有藏身之处，为什么跟踪cookie会很危险</a></li>
<li><a href="../zh-CN470483/index.html">莫斯科的Azure技术实验室</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>