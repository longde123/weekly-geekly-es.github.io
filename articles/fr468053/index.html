<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßñüèº üë≠ üëºüèª Apprentissage automatique pour votre chasse √† plat. Partie 1 üõê ‚òπÔ∏è üîí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avez-vous d√©j√† cherch√© un appartement? Souhaitez-vous ajouter un apprentissage automatique et rendre un processus plus int√©ressant? 



 Aujourd'hui, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apprentissage automatique pour votre chasse √† plat. Partie 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468053/"><p>  Avez-vous d√©j√† cherch√© un appartement?  Souhaitez-vous ajouter un apprentissage automatique et rendre un processus plus int√©ressant? </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="Appartements √† Iekaterinbourg"></div><a name="habracut"></a><br><p>  Aujourd'hui, nous envisagerons d'appliquer le Machine Learning pour trouver un appartement optimal. </p><br><h2 id="introduction">  Pr√©sentation </h2><br><p> Tout d'abord, je veux clarifier ce moment et expliquer ce que signifie "un appartement optimal".  C'est un appartement avec un ensemble de caract√©ristiques diff√©rentes comme "zone", "quartier", "nombre de balcons" et ainsi de suite.  Et pour ces caract√©ristiques de l'appartement, nous attendons un prix sp√©cifique.  Ressemble √† une fonction qui prend plusieurs param√®tres et renvoie un nombre.  Ou peut-√™tre une bo√Æte noire qui apporte de la magie. </p><br><p>  Mais ... il y a un grand "mais", parfois vous pouvez faire face √† un appartement qui est trop cher pour une s√©rie de raisons comme une bonne position g√©ographique.  En outre, il existe des quartiers plus prestigieux au centre d'une ville et des quartiers √† l'ext√©rieur de la ville.  Ou ... parfois, les gens veulent vendre leurs appartements parce qu'ils se d√©placent vers un autre point de la Terre.  En d'autres termes, de nombreux facteurs peuvent affecter le prix.  Cela vous semble familier? </p><br><h2 id="little-stepaside">  Petit pas de c√¥t√© </h2><br><p>  Avant de continuer, permettez-moi de faire une petite digression lyrique. <br>  J'ai v√©cu √† Ekaterinbourg (la ville entre l'Europe et l'Asie, l'une des villes qui avaient organis√© le Championnat du monde de football en 2018) pendant 5 ans. </p><br><p>  J'√©tais amoureux de ces jungles en b√©ton.  Et je d√©testais cette ville pour l'hiver et les transports en commun.  C'est une ville en pleine croissance et chaque mois il y a des milliers et des milliers d'appartements √† vendre. </p><br><p>  Oui, c'est une ville surpeupl√©e et pollu√©e.  Dans le m√™me temps - c'est un bon endroit pour analyser un march√© immobilier.  J'ai re√ßu beaucoup de publicit√©s pour des appartements, sur Internet.  Et j'utiliserai ces informations dans une plus large mesure. </p><br><p>  J'ai √©galement essay√© de visualiser diff√©rentes offres sur la carte d'Ekaterinbourg.  Oui, c'est l'image accrocheuse de habracut, elle a √©t√© faite sur Kepler.gl </p><br><p><img src="https://habrastorage.org/webt/af/w7/7e/afw77esq32gd2e0admnmjfby4kk.png" alt="image"></p><br><p>  Il y a plus de 2000 appartements d'une chambre qui ont √©t√© vendus en juillet 2019 √† Iekaterinbourg.  Ils avaient un prix diff√©rent, de moins d'un million √† pr√®s de 14 millions de roubles. </p><br><p>  Ces points se r√©f√®rent √† leur g√©o-position.  La couleur des points sur la carte repr√©sente le prix, plus le prix est proche de la couleur bleue, plus le prix est proche du rouge.  Vous pouvez le consid√©rer comme une analogie avec des couleurs froides et chaudes, la couleur plus chaude est la plus grande est le prix. <br>  S'il vous pla√Æt, souvenez-vous de ce moment, plus la couleur est rouge, plus la valeur de quelque chose est √©lev√©e.  La m√™me id√©e fonctionne pour le bleu mais dans le sens du prix le plus bas. </p><br><p>  Vous avez maintenant un aper√ßu <em>g√©n√©ral</em> de l'image et le moment de l'analyse arrive. </p><br><h3 id="goal">  Objectif </h3><br><p>  Qu'est-ce que je voulais quand j'habitais √† Iekaterinbourg?  J'ai cherch√© un appartement assez bon, ou si nous parlons de ML - je voulais construire un mod√®le qui me donnera une recommandation d'achat. </p><br><p>  D'une part, si un appartement est trop cher, le mod√®le devrait recommander d'attendre une baisse du prix en affichant le prix attendu de cet appartement. <br>  D'un autre c√¥t√© - si un prix est assez bon, selon l'√©tat du march√© - je devrais peut-√™tre envisager cette offre. </p><br><p>  Bien s√ªr, il n'y a rien d'id√©al et j'√©tais pr√™t √† accepter une erreur de calcul.  Habituellement, pour ce type de t√¢che, utiliser une erreur de pr√©diction moyenne et j'√©tais pr√™t √† une erreur de 10%.  Par exemple, si vous avez 2-3 millions de roubles russes, vous pouvez ignorer l'erreur dans 200-300 mille, vous pouvez vous le permettre.  Comme il me semblait. </p><br><h2 id="preparing">  Pr√©parez </h2><br><p>  Comme je l'ai mentionn√© pr√©c√©demment, il y avait beaucoup d'appartements, regardons-les attentivement. <br>  importer des pandas en tant que pd </p><br><pre><code class="python hljs">df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'flats.csv'</span></span>) df.shape</code> </pre> <br><p><img src="https://habrastorage.org/webt/qx/_0/qg/qx_0qgrsiuprxgsbno2ccihjdia.png" alt="image"></p><br><p>  2310 appartements pendant un mois, on pourrait en tirer quelque chose d'utile.  Qu'en est-il d'un aper√ßu g√©n√©ral des donn√©es? </p><br><pre> <code class="python hljs">df.describe()</code> </pre> <br><p><img src="https://habrastorage.org/webt/is/pi/tj/ispitjyk3gpg-cbkhwfwnrayloa.png" alt="image"><br>  Il n'y a pas quelque chose d'extraordinaire - longitude, latitude, prix d'un appartement (l'√©tiquette " <em>co√ªt</em> "), etc.  Oui, pour ce moment j'ai utilis√© " <em>co√ªt</em> " au lieu de " <em>prix</em> ", j'esp√®re que cela ne conduira pas √† des malentendus, veuillez les consid√©rer comme les m√™mes. </p><br><h2 id="cleaning">  Le nettoyage </h2><br><p>  Est-ce que chaque enregistrement a la m√™me signification?  Certains d'entre eux sont des appartements repr√©sent√©s comme une cabine, vous pouvez y travailler, mais vous ne souhaitez pas y vivre.  Ce sont de petites pi√®ces exigu√´s, pas un vrai appartement.  Laissez-les retirer. </p><br><pre> <code class="python hljs">df = df[df.total_area &gt;= <span class="hljs-number"><span class="hljs-number">20</span></span>]</code> </pre> <br><p>  Le prix de pr√©diction de l'appartement provient des probl√®mes les plus anciens de l'√©conomie et des domaines connexes.  Il n'y avait rien de li√© au terme "ML" et les gens essayaient de deviner le prix en fonction des m√®tres carr√©s / pieds. <br>  Donc, nous regardons ces colonnes / √©tiquettes et essayons d'en obtenir la distribution. </p><br><pre> <code class="python hljs">numerical_fields = [<span class="hljs-string"><span class="hljs-string">'total_area'</span></span>,<span class="hljs-string"><span class="hljs-string">'cost'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> numerical_fields: mask = ~np.isnan(df[col]) sns.distplot(df[col][mask], color=<span class="hljs-string"><span class="hljs-string">"r"</span></span>,label=col) plot.show()</code> </pre> <br><p><img src="https://habrastorage.org/webt/w2/kj/eq/w2kjeqg-gr-qzcum6hcgqnoz6eo.png" alt="image"></p><br><p>  Eh bien ... il n'y a rien de sp√©cial, √ßa ressemble √† une distribution normale.  Peut-√™tre que nous devons aller plus loin? </p><br><pre> <code class="python hljs">sns.pairplot(df[numerical_fields])</code> </pre> <br><p><img src="https://habrastorage.org/webt/df/fw/lg/dffwlggd_vemlbfl96qdw-0h3fw.png" alt="image"></p><br><p>  Oups ... quelque chose de mal est l√†.  Nettoyez les valeurs aberrantes dans ces domaines et essayez d'analyser √† nouveau nos donn√©es. </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#Remove outliers df = df[abs(df.total_area - df.total_area.mean()) &lt;= (3 * df.total_area.std())] df = df[abs(df.cost - df.cost.mean()) &lt;= (3 * df.cost.std())] #Redraw our data sns.pairplot(df[numerical_fields])</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/uu/zp/ok/uuzpokfgmae_4d2bxqvsmp53jns.png" alt="image"></p><br><p>  Les valeurs aberrantes ont disparu, et maintenant √ßa a l'air mieux. </p><br><h2 id="transformation">  Transformation </h2><br><p>  Le label "ann√©e", qui d√©signe une ann√©e de construction devrait √™tre transform√© en quelque chose de plus informatif.  Que ce soit l'√¢ge de la construction, c'est-√†-dire la fa√ßon dont une maison sp√©cifique est ancienne. </p><br><pre> <code class="python hljs">df[<span class="hljs-string"><span class="hljs-string">'age'</span></span>] = <span class="hljs-number"><span class="hljs-number">2019</span></span> -df[<span class="hljs-string"><span class="hljs-string">'year'</span></span>]</code> </pre> <br><p>  Jetons un ≈ìil au r√©sultat. </p><br><pre> <code class="python hljs">df.head()</code> </pre> <br><p><img src="https://habrastorage.org/webt/wq/j_/h-/wqj_h-w8jwshp3fi0ofyhhuanca.png" alt="image"></p><br><p>  Il existe toutes sortes de donn√©es, cat√©gorielles, valeurs nanom√©triques, description textuelle et quelques informations g√©ographiques (longitude et latitude).  Mettons de c√¥t√© les derniers parce qu'√† ce stade ils sont inutiles.  Nous y reviendrons plus tard. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">"lon"</span></span>,<span class="hljs-string"><span class="hljs-string">"lat"</span></span>,<span class="hljs-string"><span class="hljs-string">"description"</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h3 id="categorical-data">  Donn√©es cat√©goriques </h3><br><p>  Habituellement, pour les donn√©es cat√©gorielles, les gens utilisent diff√©rents types d'encodage ou des choses comme CatBoost qui offrent la possibilit√© de travailler avec eux comme avec des variables num√©riques. <br>  Mais, pourrions-nous utiliser quelque chose de plus logique et plus intuitif?  Il est maintenant temps de rendre nos donn√©es plus compr√©hensibles sans en perdre le sens. </p><br><h3 id="districts">  Districts </h3><br><p>  Eh bien, il y a plus de vingt districts possibles, pourrions-nous ajouter plus de 20 variables suppl√©mentaires dans notre mod√®le?  Bien s√ªr, nous pourrions, mais ... devrions-nous?  Nous sommes des gens et nous pourrions comparer les choses, n'est-ce pas? <br>  Tout d'abord, tous les districts ne sont pas √©quivalents √† un autre.  Dans le centre de la ville, les prix d'un m√®tre carr√© sont plus √©lev√©s, plus √©loign√©s du centre-ville - ils diminuent.  Cela semble-t-il logique?  Pouvons-nous l'utiliser? <br>  Oui, nous pourrions certainement faire correspondre n'importe quel district avec un coefficient sp√©cifique et le district le plus √©loign√© est celui des appartements les moins chers. </p><br><p>  Apr√®s avoir fait correspondre la ville et utilis√© une autre carte de service Web (ArcGIS Online) a chang√© et a une vue similaire <br><img src="https://habrastorage.org/webt/ji/a6/sw/jia6swan_kxipvxp4y2p1ycfqk4.png" alt="image"></p><br><p>  J'ai utilis√© la m√™me id√©e que pour la visualisation √† plat.  Le quartier le plus "prestigieux" et "cher" color√© en rouge et le moins - bleu.  Une temp√©rature de couleur, vous vous en souvenez? <br>  De plus, nous devons manipuler notre trame de donn√©es. </p><br><pre> <code class="python hljs">district_map = {<span class="hljs-string"><span class="hljs-string">'alpha'</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'beta'</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span>, ... <span class="hljs-string"><span class="hljs-string">'delta'</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>, ... <span class="hljs-string"><span class="hljs-string">'epsilon'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>} df.district = df.district.str.lower() df.replace({<span class="hljs-string"><span class="hljs-string">"district"</span></span>: district_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  La m√™me approche sera utilis√©e pour d√©crire la qualit√© interne de l'appartement.  Parfois, il a besoin d'une r√©paration, parfois plat est assez bien et pr√™t √† vivre.  Et dans d'autres cas, vous devriez d√©penser de l'argent suppl√©mentaire pour le rendre plus beau (pour changer les robinets, pour peindre les murs).  Il pourrait √©galement y avoir des coefficients d'utilisation. </p><br><pre> <code class="python hljs">repair = {<span class="hljs-string"><span class="hljs-string">'A'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>: <span class="hljs-number"><span class="hljs-number">0.6</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>: <span class="hljs-number"><span class="hljs-number">0.7</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>} df.repair.fillna(<span class="hljs-string"><span class="hljs-string">'D'</span></span>, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.replace({<span class="hljs-string"><span class="hljs-string">"repair"</span></span>: repair}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Soit dit en passant, sur les murs.  Bien s√ªr, cela influence √©galement le prix de l'appartement.  Le mat√©riau moderne est meilleur que l'ancien, la brique est meilleure que le b√©ton.  Les murs en bois sont un moment assez controvers√©, c'est peut-√™tre un bon choix pour la campagne, mais pas si bon pour la vie urbaine. </p><br><p>  Nous utilisons la m√™me approche que pr√©c√©demment, et faisons une suggestion sur les lignes dont nous ne savons rien.  Oui, parfois les gens ne fournissent pas toutes les informations sur leur appartement.  En outre, sur la base de l'histoire, nous pouvons essayer de deviner le mat√©riau des murs.  Dans une p√©riode de temps sp√©cifique (par exemple la p√©riode la plus importante de Khrouchtchev) - nous connaissons les mat√©riaux typiques pour la construction. </p><br><pre> <code class="python hljs">walls_map = {<span class="hljs-string"><span class="hljs-string">'brick'</span></span>: <span class="hljs-number"><span class="hljs-number">1.0</span></span>, ... <span class="hljs-string"><span class="hljs-string">'concrete'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, <span class="hljs-string"><span class="hljs-string">'block'</span></span>: <span class="hljs-number"><span class="hljs-number">0.8</span></span>, ... <span class="hljs-string"><span class="hljs-string">'monolith'</span></span>: <span class="hljs-number"><span class="hljs-number">0.9</span></span>, <span class="hljs-string"><span class="hljs-string">'wood'</span></span>: <span class="hljs-number"><span class="hljs-number">0.4</span></span>} mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2010</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'monolith'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">2000</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'concrete'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()][df.year &gt;= <span class="hljs-number"><span class="hljs-number">1990</span></span>].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> mask = df[df[<span class="hljs-string"><span class="hljs-string">'walls'</span></span>].isna()].index df.loc[mask, <span class="hljs-string"><span class="hljs-string">'walls'</span></span>] = <span class="hljs-string"><span class="hljs-string">'block'</span></span> df.replace({<span class="hljs-string"><span class="hljs-string">"walls"</span></span>: walls_map}, inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'year'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  En outre, il y a des informations sur le balcon.  √Ä mon humble avis - le balcon est une chose vraiment utile, donc je ne pouvais pas m'emp√™cher de le consid√©rer. <br>  Malheureusement, il existe des valeurs nulles.  Si l'auteur d'une publicit√© avait v√©rifi√© les informations √† son sujet, nous aurions des informations plus r√©alistes. <br>  Eh bien, s'il n'y a aucune information, cela signifiera "il n'y a pas de balcon". </p><br><pre> <code class="python hljs">df.balcony.fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>,inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  Apr√®s cela, nous d√©posons des colonnes avec des informations sur l'ann√©e de construction (nous avons une bonne alternative pour elle).  De plus, nous supprimons la colonne contenant des informations sur le type de b√¢timent car il contient beaucoup de valeurs NaN et je n'ai trouv√© aucune possibilit√© de combler ces lacunes.  Et nous supprimons toutes les lignes avec NaN que nous avons. </p><br><pre> <code class="python hljs">df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'type_house'</span></span>],inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df = df.astype(np.float64) df.dropna(inplace=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><h2 id="checking">  V√©rification </h2><br><p>  Donc ... nous avons utilis√© une approche non standard et remplacer les valeurs cat√©gorielles par leur repr√©sentation num√©rique.  Et maintenant, nous avons termin√© avec une transformation de nos donn√©es. <br>  Une partie des donn√©es a √©t√© supprim√©e, mais en g√©n√©ral, il s'agit d'un assez bon ensemble de donn√©es.  Regardons la corr√©lation entre les variables ind√©pendantes. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show_correlation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(df)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"whitegrid"</span></span>) corr = df.corr() * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-comment"><span class="hljs-comment"># Select upper triangle of correlation matrix mask = np.zeros_like(corr, dtype=np.bool) mask[np.triu_indices_from(mask)] = True # Set up the matplotlib figure f, ax = plt.subplots(figsize=(15, 11)) # Generate a custom diverging colormap cmap = sns.diverging_palette(220, 10) # Draw the heatmap with the mask and correct aspect ratio sns.heatmap(corr, mask=mask, cmap=cmap, center=0, linewidths=1, cbar_kws={"shrink": .7}, annot=True, fmt=".2f") plot.show() # df[columns] = scale(df[columns]) return df df1 = show_correlation(df.drop(columns=['cost']))</span></span></code> </pre> <br><p><img src="https://habrastorage.org/webt/ht/dv/ir/htdvirxheiytace3nmaujf3wet8.png" alt="image"></p><br><p>  Euh ... c'est devenu tr√®s int√©ressant. <br>  <strong>Corr√©lation positive</strong> <br>  <em>Superficie totale - balcons</em> .  Pourquoi pas?  Si notre appartement est grand, il y aura un balcon. <br>  <strong>Corr√©lation n√©gative</strong> <br>  <em>Superficie totale - √¢ge</em> .  Le plus r√©cent est plat, le plus grand est un espace de vie.  Sonne logique, les nouveaux sont plus spacieux que les anciens. <br>  <em>√Çge - balcon</em> .  Plus l'ancien est plat, moins il y a de balcons.  On dirait une corr√©lation √† travers une autre variable.  C'est peut-√™tre un triangle Age-Balcony-Area o√π une variable a une influence implicite sur une autre.  Mettez cela en attente pendant un certain temps. <br>  <em>√Çge - district.</em>  L'appartement le plus ancien est la grande probabilit√© qui sera plac√©e dans les quartiers les plus prestigieux.  Cela pourrait-il √™tre li√© √† un prix plus √©lev√© pr√®s du centre? </p><br><p>  En outre, nous avons pu voir la corr√©lation avec la variable d√©pendante </p><br><pre> <code class="python hljs">plt.figure(figsize=(<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>)) corr = df.corr()*<span class="hljs-number"><span class="hljs-number">100.0</span></span> sns.heatmap(corr[[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]], cmap= sns.diverging_palette(<span class="hljs-number"><span class="hljs-number">220</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), center=<span class="hljs-number"><span class="hljs-number">0</span></span>, linewidths=<span class="hljs-number"><span class="hljs-number">1</span></span>, cbar_kws={<span class="hljs-string"><span class="hljs-string">"shrink"</span></span>: <span class="hljs-number"><span class="hljs-number">.7</span></span>}, annot=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, fmt=<span class="hljs-string"><span class="hljs-string">".2f"</span></span>)</code> </pre> <br><p><img src="https://habrastorage.org/webt/o7/ax/m1/o7axm1zph-x3eterypsfcod38zo.png" alt="image"></p><br><p>  C'est parti ... </p><br><p>  La tr√®s forte corr√©lation entre le domaine du flat et le prix.  Si vous voulez avoir un plus grand logement, il vous faudra plus d'argent. <br>  Il existe une corr√©lation n√©gative entre les paires ¬´ <em>√¢ge / co√ªt</em> ¬ª et ¬´ <em>district / co√ªt</em> ¬ª.  Un appartement dans une maison neuve moins abordable que l'ancienne.  Et √† la campagne, les appartements sont moins chers. <br>  Quoi qu'il en soit, cela semble clair et compr√©hensible, alors j'ai d√©cid√© d'y aller. </p><br><h2 id="model">  Mod√®le </h2><br><p>  Pour les t√¢ches li√©es au prix forfaitaire de pr√©diction, utilisez g√©n√©ralement la r√©gression lin√©aire.  Selon une corr√©lation significative d'une √©tape pr√©c√©dente, nous pourrions essayer de l'utiliser √©galement.  C'est un cheval de bataille qui convient √† de nombreuses t√¢ches. <br>  Pr√©parez nos donn√©es pour les prochaines actions </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split y = df.cost X = df.drop(columns=[<span class="hljs-string"><span class="hljs-string">'cost'</span></span>]) X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number"><span class="hljs-number">0.2</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">42</span></span>)</code> </pre> <br><p>  De plus, nous cr√©ons des fonctions simples pour la pr√©diction et l'√©valuation du r√©sultat.  Faisons notre premier essai pour pr√©dire le prix! </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y_test, model)</span></span></span><span class="hljs-function">:</span></span> y = model.predict(X) score = round((r2_score(y_test, y) * <span class="hljs-number"><span class="hljs-number">100</span></span>), <span class="hljs-number"><span class="hljs-number">2</span></span>) print(<span class="hljs-string"><span class="hljs-string">f'Score on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{score}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> score <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, regressor)</span></span></span><span class="hljs-function">:</span></span> model = regressor.fit(X, y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model</code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinearRegression regressor = LinearRegression() model = train_model(X_train, y_train, regressor) predict(X_test, y_test, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/ak/v3/_a/akv3_antf7wwaxndcpjwx90rvju.png" alt="image"></p><br><p>  Eh bien ... 76,67% de pr√©cision.  Est-ce un grand nombre ou non?  Selon mon point de vue, ce n'est pas mal.  De plus, c'est un bon point de d√©part.  Bien s√ªr, ce n'est pas id√©al et il y a un potentiel d'am√©lioration. </p><br><p>  Dans le m√™me temps - nous avons essay√© de pr√©dire une seule partie des donn√©es.  Qu'en est-il de l'application de la m√™me strat√©gie pour d'autres donn√©es?  Oui, le temps de la validation crois√©e. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cross_validation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(X, y, model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.model_selection <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KFold, cross_val_score regressor_name = model.__class__.__name__ fold = KFold(n_splits=<span class="hljs-number"><span class="hljs-number">10</span></span>, shuffle=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>) scores_on_this_split = cross_val_score(estimator=model, X=X, y=y, cv=fold, scoring=<span class="hljs-string"><span class="hljs-string">'r2'</span></span>) scores_on_this_split = np.round(scores_on_this_split * <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) mean_accuracy = scores_on_this_split.mean() print(<span class="hljs-string"><span class="hljs-string">f'Crossvaladaion accuracy on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{model.__class__.__name__}</span></span></span><span class="hljs-string"> is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{mean_accuracy}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mean_accuracy do_cross_validation(X, y, model)</code> </pre> <br><p><img src="https://habrastorage.org/webt/yn/uf/3y/ynuf3yr9ew4kgjrvnb-nifevbnq.png" alt="image"></p><br><p>  Le r√©sultat de la validation crois√©eNous prenons maintenant un autre r√©sultat.  73 est inf√©rieur √† 76. Mais, c'est aussi un bon candidat jusqu'√† un moment o√π nous en aurons un meilleur.  Cela signifie √©galement qu'une r√©gression lin√©aire fonctionne assez stable sur notre ensemble de donn√©es. </p><br><p>  Et c'est maintenant le moment de la derni√®re √©tape. </p><br><p>  Nous examinerons la meilleure caract√©ristique de la r√©gression lin√©aire - l' <strong>interpr√©tabilit√©</strong> . <br>  Cette famille de mod√®les, contrairement aux mod√®les plus complexes, a une meilleure capacit√© de compr√©hension.  Il y a juste quelques nombres avec des coefficients et vous pouvez mettre vos nombres dans l'√©quation, faire des calculs simples et avoir un r√©sultat. </p><br><p>  Essayons d'interpr√©ter notre mod√®le </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">estimate_model</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model)</span></span></span><span class="hljs-function">:</span></span> sns.set(style=<span class="hljs-string"><span class="hljs-string">"white"</span></span>, context=<span class="hljs-string"><span class="hljs-string">"talk"</span></span>) f, ax = plot.subplots(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, figsize=(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>), sharex=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) sns.barplot(x=model.coef_, y=X.columns, palette=<span class="hljs-string"><span class="hljs-string">"vlag"</span></span>, ax=ax) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i, v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(model.coef_.astype(int)): ax.text(v + <span class="hljs-number"><span class="hljs-number">3</span></span>, i + <span class="hljs-number"><span class="hljs-number">.25</span></span>, str(v), color=<span class="hljs-string"><span class="hljs-string">'black'</span></span>) ax.set_title(<span class="hljs-string"><span class="hljs-string">f"Coefficients"</span></span>) estimate_model(regressor)</code> </pre> <br><p><img src="https://habrastorage.org/webt/1j/bc/_a/1jbc_apacascsr3cakmwz4qbnu8.png" alt="Les coefficients de notre mod√®le"></p><br><p>  L'image semble assez logique.  <em>Balcon / Murs / Surface / R√©paration</em> contribuent <strong>positivement</strong> √† un prix forfaitaire. <br>  Plus le plat est √©lev√©, plus la <strong>contribution n√©gative est importante</strong> .  S'applique √©galement √† l'√¢ge.  Le plus ancien appartement est le prix le plus bas. </p><br><p>  C'√©tait donc un voyage fascinant. <br>  Nous sommes partis du terrain, utilisons l'approche atypique pour la transformation des donn√©es bas√©e sur le point de vue humain (les nombres au lieu des variables factices), les variables v√©rifi√©es et leur relation les unes avec les autres.  Apr√®s cela, nous construisons notre mod√®le simple, utilis√© la validation crois√©e pour tester son.  Et comme la cerise sur le g√¢teau - regardez les internes du mod√®le, ce qui nous donne confiance en notre chemin. </p><br><p>  Mais!  Ce n'est pas la fin de notre voyage mais seulement une pause.  Nous allons essayer de changer notre mod√®le √† l'avenir et peut-√™tre (juste peut-√™tre) cela augmentera la pr√©cision de la pr√©diction. </p><br><p>  <strong>Merci d'avoir lu!</strong> </p><br><blockquote>  La deuxi√®me partie est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">l√†</a> <br></blockquote><p>  PS Les donn√©es sources et le bloc-notes Ipython <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s'y</a> trouvent </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468053/">https://habr.com/ru/post/fr468053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468041/index.html">Annonce de l'interface Web de Kubernetes Web View (et un bref aper√ßu des autres interfaces Web pour Kubernetes)</a></li>
<li><a href="../fr468043/index.html">Comment cr√©er un kit d'interface utilisateur √† vendre. √âtapes de d√©veloppement d'un syst√®me de conception commerciale</a></li>
<li><a href="../fr468047/index.html">Utilisation des hi√©rarchies dans lsFusion</a></li>
<li><a href="../fr468049/index.html">Utilisation de werf pour d√©ployer des graphiques Helm complexes</a></li>
<li><a href="../fr468051/index.html">VDS avec Windows Server sous licence pour 100 roubles: mythe ou r√©alit√©?</a></li>
<li><a href="../fr468057/index.html">D√©veloppement de syst√®me d'exploitation de type Unix - Multit√¢che et appels syst√®me (7)</a></li>
<li><a href="../fr468059/index.html">Ma deuxi√®me semaine avec Haiku: beaucoup de diamants cach√©s et d'agr√©ables surprises, ainsi que quelques probl√®mes</a></li>
<li><a href="../fr468061/index.html">Cron sur Linux: historique, utilisation et appareil</a></li>
<li><a href="../fr468063/index.html">Angulareact</a></li>
<li><a href="../fr468067/index.html">Fonctionnement de la composition alpha</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>