<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîΩ üßúüèº ü•® Acerca de las entidades, DTO, ORM y carga diferida üë©üèø‚Äçüíª üà∫ üêÑ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El paradigma orientado a objetos es el est√°ndar para el software de aplicaci√≥n. DBMS relacional: un est√°ndar para almacenar datos en software de aplic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Acerca de las entidades, DTO, ORM y carga diferida</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/437418/">  El paradigma orientado a objetos es el est√°ndar para el software de aplicaci√≥n.  DBMS relacional: un est√°ndar para almacenar datos en software de aplicaci√≥n.  S√≠, puede escribir en Haskell y almacenar datos exclusivamente en ClickHouse.  Pero se trata de la corriente principal. <br><br>  ORM le permite <s>tirar de un b√∫ho en un globo</s> para pretender que no hay RDBMS y que los datos se almacenan en un modelo de objeto que es m√°s adecuado para OOP.  Sigue existiendo un problema "peque√±o": esta abstracci√≥n, como muchas otras, "fluye".  Donde en el modelo de objetos hay un enlace a otro objeto en la clave externa y la identificaci√≥n de la base de datos.  En el momento de la materializaci√≥n de la entidad, nos enfrentamos a una elecci√≥n: <br><br><ol><li>  Descargue todo y caiga de la memoria / tiempo de espera </li><li>  Indique expl√≠citamente qu√© dependencias queremos descargar y cu√°les no, y viole el principio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no preguntar</a> </li><li>  Cargue dependencias impl√≠citamente bajo demanda usando Lazy Load y obtenga problemas de rendimiento en alg√∫n lugar del c√≥digo llamado </li></ol><br>  ¬øQu√© tipo de pierna debes cortar: izquierda o derecha? <br><br>  <b>TLDR Lazy Load no es tan malo si se usa solo para escribir y no se usa al leer.</b>  <b>Pero no todo es tan simple y hay muchos matices.</b> <br><a name="habracut"></a><br>  Con el tiempo, llegu√© a la conclusi√≥n de que Lazy Load y / o la dependencia de las entidades en la implementaci√≥n de ORM es el mal menor en ciertas condiciones. <br><br><h3>  En el subsistema de lectura, siempre lea solo DTO </h3><br>  En el 90% de los casos, los problemas con Lazy Load surgen precisamente al leer.  Obtenemos la lista de entidades, la revisamos y repetimos y comenzamos a seleccionar todos los datos necesarios.  Recibimos un mont√≥n de consultas a la base de datos.  En este caso, la mayor√≠a de las veces lo √∫nico que debe hacerse es obtener los datos, serializarlos y enviarlos nuevamente en forma de JSON.  ¬øPor qu√©, entonces, cargar entidades en absoluto?  No es necesario agregar estos datos al rastreador de cambios UOW, para leer toda la entidad junto con los campos "extra".  En su lugar, siempre puede escribir <code>Select</code> o <code><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ProjectTo</a></code> .  Lazy Load no es necesaria porque el c√≥digo C # de <code>Select</code> se traducir√° a SQL y se ejecutar√° en el lado de la base de datos. <br><br><a name="interfaces"></a><h3>  ¬øQu√© pasa si mi l√≥gica no se traduce a SQL? </h3><br>  Recomiendo mantener la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">evaluaci√≥n del cliente</a> desactivada.  En primer lugar, puede "ayudar" y agregar soporte para las funciones necesarias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">directamente en sub</a> .  No es una mala opci√≥n cuando se trata de computaci√≥n simple, no de reglas comerciales.  Opci√≥n n√∫mero dos: extraer la interfaz de la entidad e implementarla tanto en la entidad como en el DTO. <br><br>  Por ejemplo, en la base de datos hay dos campos: "precio sin descuento" y "precio con descuento".  Si se completa el campo "precio de descuento", util√≠celo, si no, utilice el campo con el precio habitual.  Agrega una regla m√°s.  Al comprar 3 productos, solo paga por los 2 m√°s caros, mientras que tambi√©n se tienen en cuenta los descuentos regulares. <br><br>  La implementaci√≥n puede ser la siguiente: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IHasProductPrice</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span> BasePrice { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">decimal</span></span>? SalePrice { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Product</span></span>: <span class="hljs-title"><span class="hljs-title">IHasProductPrice</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ... a lot of code public decimal BasePrice { get; protected set;} public decimal? SalePrice { get; protected set;} } public class ProductDto: IHasProductPrice { public decimal BasePrice { get; set;} public decimal? SalePrice { get; set;} } public static class ProductCalculator { public static void decimal Calculate(IEnumerable&lt;IHasProductPrice&gt; prices) }</span></span></code> </pre><br><h3>  En el subsistema de escritura, Lazy Load no da tanto miedo </h3><br>  En el subsistema de escritura, por el contrario, a menudo solo la identificaci√≥n para escribir no es suficiente.  Todo tipo de comprobaciones a menudo le hacen leer toda la entidad, porque el paradigma del objeto implica combinar datos y operaciones en ellos dentro del objeto de clase y su invariante.  Si el proyecto usa DDD, las operaciones de escritura / cambio deben realizarse a trav√©s de la ra√≠z de agregaci√≥n y, por lo tanto, solo sobre un objeto y sus dependencias.  Una gran cantidad de consultas solo puede ocurrir cuando se trabaja con colecciones relacionadas. <br><br><h3>  Colecciones asociadas en agregados </h3><br>  Si hay demasiados datos en la m√°quina, esto puede indicar un problema de dise√±o.  Ra√≠ces t√≠picas de agregaci√≥n: canasta, orden, paquete.  Las personas generalmente no trabajan con datos de miles de filas, por lo que descargar toda la colecci√≥n vinculada puede no ser la operaci√≥n m√°s productiva, pero no mortal.  Pero si hay miles de objetos en la colecci√≥n, es posible que realmente no exista tal ra√≠z de agregaci√≥n y los desarrolladores se le ocurri√≥, porque era muy simple hacerlo usando herramientas improvisadas. <br><br><h3>  ¬øQu√© pasa si todav√≠a hay miles de registros en el agregado? </h3><br>  Pase el <code>DbContext</code> al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">constructor</a> y lea de √©l solo los datos necesarios en el contexto de la operaci√≥n.  S√≠, violar DIP.  O eso, o no use la unidad en este caso. <br><br><h3>  Operaciones masivas </h3><br>  Importar un archivo de 10,000 l√≠neas es un gran objetivo para Lazy Load.  Aqu√≠, a todos los problemas del subsistema de lectura, tambi√©n se agregan los frenos de ChangeTracker.  Para la grabaci√≥n masiva, debe usar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramientas</a> separadas.  Prefiero Batch Extensions, porque de nuevo puedes hacerlo sin crear entidades.  Para casos especialmente severos, existen buenos procedimientos almacenados e incluso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">herramientas especiales de DBMS</a> . <br><br><h3>  Hack de vida </h3><br>  Si necesita implementar tanto una operaci√≥n en masa como una convencional, debe comenzar con una operaci√≥n en masa.  Una operaci√≥n normal es solo un caso especial de c√≥digo de masa en una secuencia con un solo elemento. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/437418/">https://habr.com/ru/post/437418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../437406/index.html">Microkernel seL4. Verificaci√≥n formal de programas en el mundo real.</a></li>
<li><a href="../437408/index.html">802.1x, EX2200, NPS y todo-todo-todo ...</a></li>
<li><a href="../437410/index.html">Introducci√≥n a Spring Boot con Spring Data Mongo</a></li>
<li><a href="../437414/index.html">Donde m√°s de 20 millones de tarjetas de transporte son vulnerables en Rusia: desensamblamos y desarrollamos MIFARE Classic</a></li>
<li><a href="../437416/index.html">Gesti√≥n de capacidad: encontrar el equilibrio perfecto</a></li>
<li><a href="../437420/index.html">¬øQuieres LED eternos? Descubra soldadores y archivos. O iluminaci√≥n casera casera</a></li>
<li><a href="../437422/index.html">Punto de partida</a></li>
<li><a href="../437424/index.html">¬øSue√±a la inteligencia artificial con zerglings?</a></li>
<li><a href="../437426/index.html">Estudiantes, estudiantes eternos y sedientos de nuevos conocimientos.</a></li>
<li><a href="../437428/index.html">Para aquellos que saben con sus o√≠dos: podcasts para desarrolladores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>