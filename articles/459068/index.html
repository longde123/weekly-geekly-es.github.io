<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🦀 🌰 🤛🏻 Windows Server 2008 R2 - El rey está muerto, viva el rey 🕝 🦄 🚶🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hola Habr! El 14/01/2020 se acerca y esta fecha marca el final del soporte extendido para Windows Server 2008 R2, y si todavía usa Windows Server 2008...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Windows Server 2008 R2 - El rey está muerto, viva el rey</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459068/"><img src="https://habrastorage.org/webt/8y/mw/mb/8ymwmb8srnrvkgraayebcfvtg1s.png"><br><br>  Hola Habr!  El 14/01/2020 se acerca y esta fecha marca el final del soporte extendido para Windows Server 2008 R2, y si todavía usa Windows Server 2008 R2, debería considerar migrar a una plataforma más actual. <br><br>  Debajo del corte hay una pequeña comparación de los recursos consumidos de las viejas y nuevas plataformas de Windows Server: el rol de RDSH.  En primer lugar, estaba interesado en la oportunidad de continuar utilizando los servidores HP G6 / G7 ya disponibles que ejecutan VMware Vsphere 5.5. <br><br>  La información sobre el ciclo de vida del servidor de Windows está disponible en este enlace <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Buscar ciclo de vida del producto</a> . <br><a name="habracut"></a><br><h4>  Tendré dos bancos de prueba: </h4><br><ol><li>  HP DL120 G7, 1 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CPU Intel Xeon E3-1240</a> </li><li>  HP ML350 G6, 2 * <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CPU Intel Xeon E5620</a> </li></ol><br>  Los servidores se ejecutarán con VMware ESXi 5.5, la imagen de VMware-ESXi-5.5.0-Update1-1746018-HP-5.75.4-Dec2014.  También intenté usar la imagen VMware-ESXi-5.5.0-Update3-3116895-HP-550.9.4.26-Nov2015, pero esto no afecta los resultados. <br><br>  Pero la imagen de VMware-ESXi-5.5.0-Update2-2403361-HP-550.9.2.40.2-Sep2015 da resultados distorsionados, por alguna razón las estadísticas que muestra el servidor son dos veces diferentes de las reales.  Con esta imagen, el máximo que muestra el servidor es el 50 por ciento de la carga del procesador, aparentemente algún tipo de error.  Al principio, estaba encantado cuando obtuve los primeros resultados, pero luego me di cuenta de que algo andaba mal ... <br><br>  También se debe mencionar que el soporte para VMware Vsphere 5.5 tampoco es eterno, y la plataforma ya no es relevante, y debe pensar en actualizar.  La información sobre VMware Lifecycle está disponible en esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">matriz de productos de VMware Lifecycle</a> . <br><br><img src="https://habrastorage.org/webt/3b/eq/_i/3beq_ihj_p9wxkw4zvg-tbbdwd4.png"><br><br>  Y no olvide la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Guía de compatibilidad de VMware</a> .  Si hablamos del servidor HP DL120 G7, este servidor nunca estuvo presente en las matrices de compatibilidad, pero ESXi 5.5 U3 puede instalarse oficialmente en el servidor HP ML350 G6. <br><br><h4>  SO invitado </h4><br>  La información sobre la compatibilidad de ESXi con los sistemas operativos invitados también está disponible en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Guía de compatibilidad de VMware</a> . <br><br>  ESXi 5.5 U3 le permite instalar Windows Server 2016 como sistema operativo invitado, e incluso la versión 5.5 será suficiente para esto.  Pero para instalar Windows Server 2019 necesitará ESXi versión 6+, pero esto no me impide probar mi plan. <br><br>  Tendré las siguientes máquinas virtuales de prueba: WS2008R2SP1, WS2012R2, WS2016 y WS2019. <br><br>  Los agentes de VMware Tools 5.5.0-10.2.5.8068406 están instalados en todas las máquinas virtuales.  Se instalaron todas las actualizaciones de Microsoft para mayo de 2019 e incluso algunas para junio de 2019, después de lo cual se deshabilitó el servicio de actualización. <br><br>  Para mis pruebas, realicé el ajuste mínimo, quiero que todo funcione con los parámetros más estándar.  Para esto, usaré políticas de grupo local, un poco más sobre esto escribiré al final. <br><br><ol><li>  "composición de escritorio" deshabilitada </li><li>  permite redirigir audio y video </li><li>  RemoteFX habilitado para clientes WS2008R2SP1 y WS2008R2SP1 </li><li>  suavizado de fuente deshabilitado </li><li>  limitó la profundidad de bits de la paleta de colores a 32 </li><li>  limitado el número de monitores a un valor de 1 </li></ol><br><blockquote>  Para que el códec RemoteFX comience a funcionar en WS2008R2SP1, debe instalarse la función RDSH; para las versiones más recientes, esto puede omitirse.  Quizás RemoteFX se usa en WS2008R2SP1 sin instalar RDSH, pero no hay eventos en los registros sobre la activación de este códec. </blockquote><br><h4>  Prueba 1 </h4><br>  Como prueba, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">usaré</a> un video en YouTube con una resolución de 720p, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Novedades de los Servicios de escritorio remoto en Windows Server 2019 - BRK2242</a> . <br><br>  En cada uno de los servidores, abriré una sesión rdp y un video de prueba en Chrome (versión 75.0.3770.80 (64bit)). <br><br>  En esta prueba, el cliente ligero HP t510 que ejecuta el sistema operativo HP ThinOS 4.4 y el paquete Freerdp-1.1hp10d-all-4.4-x86-SQ se utilizará como cliente.  Esta unidad está conectada a un monitor con resolución Full HD y el perfil de cliente ligero se ha restablecido al de fábrica. <br><br>  Realicé los gráficos desde el host, todas las primeras pruebas se realizarán en el servidor HP DL120G7. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ys/py/oa/yspyoaqc-lg1stpfaswzdveqrhq.png"></div><br>  <b>Comentarios sobre los resultados de la primera prueba:</b> <br><br>  En esta prueba, ws2008 consume tres veces menos recursos de procesador, pero al mismo tiempo tres veces más tráfico que otros participantes en la prueba. <br><br>  Con el tráfico actual, se pueden colocar 66 sesiones en un gigabit, pero cambiar a una nueva versión del servidor probablemente reducirá en tres veces la cantidad de usuarios que pueden trabajar con este consumo de procesador. <br><br>  Visualmente, la imagen en esta presentación es aceptable en todas las versiones de Windows Server.  Por supuesto, si ejecuta algo más dinámico, las versiones más nuevas de los servidores muestran una imagen mucho mejor.  Supongo que esto se debe a la cantidad de cuadros, más cuadros = reproducción suave = más carga de CPU. <br><br><h4>  Prueba 2 </h4><br>  El script para la segunda prueba permanece sin cambios, con la excepción de usar Firefox (versión 67.0.2 (64 bits)) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/3g/0p/gw3g0phogvrhasadejts3wle3uw.png"></div><br>  <b>Comentarios sobre los resultados de la segunda prueba:</b> <br><br>  Firefox emparejado con ws2019 muestra un buen resultado, consume un poco más de procesador y notablemente menos tráfico que ws2008. <br><br><h4>  Prueba 3 </h4><br>  Se utilizará Chrome en esta prueba, pero el cliente ya será una computadora portátil con Windows 10 1903, la computadora portátil está conectada a un monitor con resolución FullHD. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i8/ns/fc/i8nsfcbu2s3gwaa90locpi6zmfw.png"></div><br>  <b>Comentarios sobre los resultados de la tercera prueba:</b> <br><br>  En casos con ws2008, se consume menos tráfico, otros cambios no son significativos ... <br><br>  También noté que Chrome, cuando se muestra en el fondo del video, el progreso de la barra consume 1000 MHz más, pero en Firefox no noté tal efecto, y dibujar el progreso de la barra no afecta la cantidad de recursos consumidos. <br><br><h4>  Prueba 4 </h4><br>  Una computadora portátil con Windows 10 emparejado con Firefox <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zo/8m/wl/zo8mwlxg1yf3z2m9cmlwflhixwi.png"></div><br>  <b>Comentarios sobre los resultados de la cuarta prueba:</b> <br><br>  En esta combinación servidor-cliente-navegador, ws2019 + Firefox consume menos recursos que con Chrome, pero comenzó a consumir significativamente más procesador en comparación con los resultados de la Prueba 2. <br><br>  En los casos con ws2012 y ws2016, los resultados de todas las pruebas realizadas son mucho más uniformes, no existe tal variación como ws2019. <br><br><h4>  Prueba 5 </h4><br>  Esta prueba consiste en comenzar el número máximo de sesiones de rdp y lanzar una presentación en cada sesión.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Remote Desktop Connection Manager</a> me ayudará con esto, RDCM se lanzará en una computadora portátil con Windows 10. <br><br>  La resolución de la sesión tuvo que reducirse a 1440 * 900.  Solo daré una tabla resumen como resultado: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hx/vq/vs/hxvqvslz4p1skrmddvv9pfmite0.png"></div><br>  <b>Comentarios sobre los resultados de la quinta prueba:</b> <br><br>  Inesperadamente, el servidor 2019 mostró peores resultados que ws2012 y ws2016.  El servidor 2008 pudo abrir 8 sesiones, mientras que los servidores 2012/2016 pueden abrir 4 sesiones, y el quinto eleva la carga al 100%.  Server 2019 pudo trabajar con un máximo de 4 sesiones. <br><br>  Firefox no es un navegador prioritario para mí y, por lo tanto, solo lo ejecuté en ws2019 para verificar los números recibidos. <br><br><h4>  Prueba 6 </h4><br>  En esta prueba, entra en juego el servidor HP ML350G6 con dos procesadores E5620, solo probaré los servidores 2008 y 2019.  La prueba es la misma, comenzando el número máximo de sesiones, solo se usará Chrome. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/p2/dz/qq/p2dzqqt6bunqeznn6cuyjnobox0.png"></div><br>  <b>Comentarios sobre los resultados de la sexta prueba:</b> <br><br>  Para ejecutar 10 sesiones en el servidor 2008, se necesitaba el 60 por ciento de los recursos del procesador, y para iniciar solo 5 sesiones en el servidor 2019, se necesita más del 90 por ciento. <br><br><h4>  La parte final - Tuning </h4><br>  Devolví todas las máquinas virtuales de prueba al servidor HP DL120G7 y usé una computadora portátil con Windows 10 y su pantalla nativa con una resolución de 1366 * 768 como cliente. <br><br>  Desafortunadamente, no llamaría exitosos los intentos de reducir el consumo del procesador, pero es imposible decir que tampoco hay resultados.  Aquí hay una lista de todas las configuraciones de directiva de grupo local disponibles que puede usar para la optimización: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fz/di/lb/fzdilbns_mntqxophz-c3gzoaws.png"></div><br>  En Windows Server 2008R2, las opciones "Optimizar la experiencia visual al usar RemoteFX" le permiten controlar la calidad de la imagen y la cantidad de fotogramas, y esto le da un resultado notable.  Reducir el número de tramas reduce la carga en el procesador y la red.  Para Windows Server 2019, estas opciones no funcionan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/k-/db/rk/k-dbrks-k4ac01ipqkfmiffviwy.png"></div><br>  La calidad de la imagen en Windows Server 2019 se puede controlar mediante el parámetro "Configurar calidad de imagen para gráficos adaptables RemoteFX", pero no hay nada que cambie la cantidad de fotogramas, o no encontré dicho parámetro. <br><br>  Probé varias combinaciones de parámetros, pero pude obtener cambios notables en los resultados en solo unos pocos casos.  Y lo más interesante es que puede notar cambios en el tráfico, pero al mismo tiempo, la carga en el procesador cambia poco. <br><br>  - La priorización de H.264 / AVC 444 aumentó la carga en el procesador, pero al mismo tiempo, el tráfico cayó notablemente de 2x a 1 megabit. <br><blockquote>  Esta configuración de directiva prioriza el modo de gráficos H.264 / AVC 444 para escenarios vGPU que no son RemoteFX.  Cuando use esta configuración en el servidor RDP, el servidor usará H.264 / AVC 444 como códec en una conexión RDP 10 donde tanto el cliente como el servidor pueden usar H.264 / AVC 444. </blockquote><br>  - La desactivación de la compresión RDP no redujo la carga en el procesador, pero al mismo tiempo el tráfico aumentó de 2x a 7 megabits. <br><br>  - La habilitación del parámetro Losles para la calidad de la imagen conduce a un consumo de tráfico inadecuado, sin cambiar la carga en el procesador.  Para qué escenarios, esta opción me fue agregada no está del todo clara. <br><blockquote>  Si habilita esta configuración de directiva y establece la calidad en Sin pérdida, RemoteFX Adaptive Graphics usa codificación sin pérdida.  En este modo, la integridad del color de los datos gráficos no se ve afectada.  Sin embargo, esta configuración resulta en un aumento significativo en el consumo de ancho de banda de la red.  Recomendamos que configure esto solo para casos muy específicos. </blockquote><br><br><img src="https://habrastorage.org/webt/xq/zm/nr/xqzmnrlocn2gyxeyc930sdxg5zy.png"><br><br><h4>  Resumen </h4><br>  Si antes, para la operación de 10 usuarios activos, 8 servidores nucleares eran suficientes y todavía había espacio libre, ahora dicho servidor solo es suficiente para 5 usuarios. <br><br>  Creo que es hora de prepararse para reemplazar los servidores de generación HP G6 y G7.  Es una pena separarse de los servidores que tienen&gt; 100 GB de RAM instalados, supuse que servirán más. <br><br>  No excluyo que los procesadores antiguos carezcan de instrucciones de hardware, por lo que planeo obtener un servidor moderno para pruebas en el futuro cercano.  Pero, sinceramente, mi pronóstico es pesimista, creo que será posible obtener el resultado deseado solo por la fuerza bruta, un aumento en el número de núcleos de procesador, y esto implicará un aumento en el número de licencias y costos requeridos. <br><br>  <b>El final</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459068/">https://habr.com/ru/post/459068/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459050/index.html">Potente módulo de escritura Vuex</a></li>
<li><a href="../459052/index.html">Cómo comparar: "coche increíble" y "choza fea", en una encuesta de marketing y en Big Data</a></li>
<li><a href="../459054/index.html">Mapa de calor de clics: cómo se comportan los usuarios en el sitio</a></li>
<li><a href="../459062/index.html">El resumen de materiales interesantes para el desarrollador móvil # 305 (del 1 al 7 de julio)</a></li>
<li><a href="../459066/index.html">Balance de escritura y lectura de bases de datos</a></li>
<li><a href="../459070/index.html">Creación de defensa de la torre en la unidad: torres y enemigos que disparan</a></li>
<li><a href="../459074/index.html">Petty little joy # 7: tres por el precio de uno: animación de consola, algoritmos y depuración</a></li>
<li><a href="../459078/index.html">CERN cambia a software de código abierto, ¿por qué?</a></li>
<li><a href="../459080/index.html">Características HttpUrlConnection de java.net</a></li>
<li><a href="../459082/index.html">¿Quiénes son los eidéticos, cómo funcionan los recuerdos falsos y tres mitos populares sobre la memoria?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>