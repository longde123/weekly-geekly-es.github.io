<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñçÔ∏è üí± üèø OMower avec ROS, les premi√®res √©tapes üíé ‚úíÔ∏è ü¶É</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Initialement, OMower a √©t√© con√ßu pour les interfaces de contr√¥le pfodApp et Modbus simples. Le premier est un protocole de texte de haut niveau dans l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>OMower avec ROS, les premi√®res √©tapes</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434952/">  Initialement, OMower a √©t√© con√ßu pour les interfaces de contr√¥le pfodApp et Modbus simples.  Le premier est un protocole de texte de haut niveau dans lequel les menus et les commandes de contr√¥le sont transmis, et le second est une chose bien connue, mais pas tr√®s pratique dans cette application, car il n√©cessite que le programme de contr√¥le interroge constamment l'√©tat de tous les capteurs utilis√©s ¬´manuellement¬ª.  Par cons√©quent, il a √©t√© d√©cid√© de passer progressivement √† ROS (Robot OS), un framework largement utilis√© pour contr√¥ler divers robots. <br><br> <a href=""><img src="https://habrastorage.org/webt/rr/7_/np/rr7_npqnn9lphvkluh3gc2ulsx8.jpeg" width="720"></a> <br><br><a name="habracut"></a><br><br>  √Ä l'heure actuelle, le support ROS est √† un stade initial, comprenant uniquement la transmission d'informations √† partir de capteurs sous la forme de tableaux simples (sans utiliser les formats de message sp√©cialis√©s offerts par de nombreuses biblioth√®ques ROS), les journaux de d√©bogage et le flux de contr√¥le des commandes au format pfodApp / Modbus, sans possibilit√© vraiment contr√¥ler le robot avec des outils ROS standard.  Autrement dit, afin de d√©placer le robot de sa place ou de modifier n'importe quel param√®tre interne du robot, vous devrez lui envoyer une commande de texte au format pfodApp.  Mais m√™me sous une forme aussi tronqu√©e - vous pouvez facilement diffuser et enregistrer ce qui se passe avec le robot, en visualisant ses mouvements dans les outils ROS (rviz) standard, ainsi qu'en ajoutant des services pour des fonctions suppl√©mentaires.  C'est, par exemple, l'occasion de rouler en direction du gabarit visuel (damier) fourni par omower_seeker.py, pour une arriv√©e pr√©cise au parking. <br><br>  L'image montre des flux de donn√©es dans le robot.  Les principaux services ROS sont ex√©cut√©s sur Orange PI Zero, coinc√© dans un emplacement sp√©cial sur la carte du robot (sur une machine de test, Raspberry PI3 est utilis√© pour cela, connect√© de mani√®re similaire - via le port s√©rie).  Via l'interface rosserial, le robot transmet des messages de capteurs (tels que / imu / orientation ou / motors / PWM), son journal de d√©bogage au format texte et la sortie des menus / messages au format pfodApp ou Modbus vers le noyau ROS, recevant un flux de commandes texte ou Modbus -quies.  Deux Raspberry PI Zero suppl√©mentaires sont livr√©s avec des flux d'images provenant de cam√©ras, mais comme la pratique l'a montr√©, il est impossible d'obtenir une synchronisation normale pour le traitement des images st√©r√©o avec ce sch√©ma (la qualit√© est visible dans l'image ci-dessous), donc une cam√©ra st√©r√©o normale sera bient√¥t remplac√©e. <br><br>  Le degr√© d'int√©gration de ROS dans OMower augmentera progressivement, jusqu'√† fournir un acc√®s complet √† toutes les variables internes du robot et la capacit√© de le g√©rer via des outils ROS standard (tels que les messages cmd_vel qui sp√©cifient la vitesse requise). <br><br> <a href=""><img src="https://habrastorage.org/webt/id/u6/pw/idu6pwvomgxmosirsfjwpl0silm.png" width="720"></a> <br><br>  Je vais vous en dire un peu plus sur le module omower_seeker.py, comme exemple d'utilisation de ROS pour ajouter des fonctions √† OMower.  Son but est assez simple - aller dans la direction de l'√©chiquier, en ajustant votre itin√©raire en temps r√©el.  Cette fonction sera utilis√©e pour conduire la tondeuse jusqu'√† la station de stationnement, o√π elle pourra rapidement charger ses batteries.  En analysant l'image de l'une des cam√©ras, le module calcule deux angles (l'angle de d√©viation de la carte par rapport au centre de la cam√©ra et l'angle de rotation de la carte elle-m√™me par rapport √† la perpendiculaire) et les transmet sous forme de commande de texte au module de recherche interne (omower-seeker.h / cpp dans le SDK OMower). <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/gCKC3lw30Vo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Ext√©rieurement, cela semble √™tre une t√¢che assez simple, mais dans la vraie vie, il y a un probl√®me grave - la vitesse de traitement de l'image sur un micro-ordinateur int√©gr√© au robot.  Comme le montre la pratique, la vitesse de recherche de motifs en ouverture dans l'image lors de l'utilisation d'Orange PI et de Raspberry Pi relativement faible puissance est tr√®s faible et instable, prenant de quelques dizaines √† centaines de millisecondes √† une r√©solution de 640x480, ce qui pendant la conduite se transforme en d√©viations de l'itin√©raire n√©cessaire, car le robot , m√™me avec sa faible vitesse, parvient √† tourner un angle important ou √† parcourir une distance relativement importante pendant ce temps.  En fait, c'est pourquoi un √©chiquier avec un minimum de cellules a √©t√© choisi, car les autres mod√®les prennent encore plus de temps. <br><br>  Pour compenser le long temps de recherche du mod√®le visuel, un sch√©ma de boussole est utilis√© - le microcontr√¥leur robot stocke ses valeurs toutes les 100 millisecondes, stockant cinq √©chantillons dans la derni√®re demi-seconde (les analyses plus longues sont simplement ignor√©es, car elles sont peu utiles pour une navigation pr√©cise).  Les angles calcul√©s √† partir d'omower_seeker.py (qui transmet √©galement le temps de recherche du mod√®le au microcontr√¥leur) sont recalcul√©s √† l'angle de rotation r√©el en utilisant la valeur de la boussole enregistr√©e, qui ne d√©passe pas 100 millisecondes √† partir du temps de recherche, et le robot se d√©place le long de cet angle.  Cela vous permet d'aller plus ou moins pr√©cis√©ment en direction de l'√©chiquier en ligne droite.  Ou, s'il est l√©g√®rement tourn√© par rapport √† la perpendiculaire - le long d'un arc corrigeant l'angle d'approche afin qu'il soit aussi proche que possible de l'axe du gabarit, car nous devons non seulement conduire jusqu'√† la planche, mais aussi entrer dans les rails de guidage et se connecter aux contacts de charge. <br><br>  L'algorithme complet d'arriv√©e √† la gare est mis en ≈ìuvre en trois √©tapes.  Deux points sont d√©finis sur le champ GPS - le point de d√©part (quelque part au milieu de la zone de travail) et le point devant la station, ainsi que l'angle de rotation par rapport √† la station.  Une fois que le robot est arriv√© du point de d√©part au second et s'est tourn√© vers l'angle souhait√© vers le damier de la station, le module de recherche entre en action, ajustant la vitesse des moteurs via le contr√¥leur PID.  Si l'une des √©tapes a √©chou√© ou si les angles de d√©viation d√©passent les valeurs d√©finies, le robot annule la course et revient √† nouveau au point de d√©part. <br><br>  Liens et vid√©o: <br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OMower SDK, biblioth√®que pour Arduino IDE et disposition des circuits imprim√©s</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Micrologiciel pr√™t √† l'emploi utilisant le SDK qui impl√©mente √† la fois pfodApp / Modbus et la connexion √† ROS</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">package omower_gateway pour ROS</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/dyz7xH9U1kY" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><iframe width="560" height="315" src="https://www.youtube.com/embed/mmV4WPHlc7Y" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr434952/">https://habr.com/ru/post/fr434952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr434940/index.html">Affaires je t'aime</a></li>
<li><a href="../fr434942/index.html">L'art du chamanisme ou du firmware personnalis√© pour Olinuxino. UBOOT Partie 2</a></li>
<li><a href="../fr434944/index.html">Notes d'un phytochimiste. La peau de banane contre-attaque</a></li>
<li><a href="../fr434946/index.html">Mon d√©m√©nagement en Norv√®ge</a></li>
<li><a href="../fr434950/index.html">Le pr√©sent qui d√©terminera notre avenir</a></li>
<li><a href="../fr434956/index.html">La soci√©t√© informatique se d√©veloppe, le profit n'est pas particuli√®rement. Que faire</a></li>
<li><a href="../fr434960/index.html">Tic-tac-toe: d√©monstration d'un processus contr√¥l√© de reconfiguration des structures d'ADN</a></li>
<li><a href="../fr434962/index.html">Non, vous n'avez pas besoin d'Express dans votre API REST sur Node.js</a></li>
<li><a href="../fr434964/index.html">Assez de parano√Øa ou pourquoi vous ne brillez pas 100 points dans Page Speed</a></li>
<li><a href="../fr434966/index.html">Nouveau langage de programmation Mash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>