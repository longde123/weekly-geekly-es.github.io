<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍱 🖐🏻 🥕 Orquesta de rendimiento 🤚🏼 🈴 🙎🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No es falso decir que las mejores personas 
 ganar alegría a través del sufrimiento. 
 Ludwig van Beethoven 





 Soy Sergey, trabajo en Yandex. Dine...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Orquesta de rendimiento</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/443822/"><p>  <em>No es falso decir que las mejores personas</em> <em><br></em>  <em>ganar alegría a través del sufrimiento.</em> <em><br></em>  <em>Ludwig van Beethoven</em> </p><br><p><img src="https://habrastorage.org/webt/9k/ht/xx/9khtxxwiwqsesccfpb5n2sbrnwo.jpeg"></p><br><p>  Soy Sergey, trabajo en Yandex. Dinero en un equipo de investigación de rendimiento.  Quiero contarles el comienzo de una historia sobre nuestro camino hacia el uso de la orquestación: cómo elegimos los instrumentos y lo que tomamos en cuenta.  Todos los eventos del artículo tienen lugar en tiempo real, por lo que ustedes, queridos lectores, siguen el desarrollo de la situación casi en vivo. </p><a name="habracut"></a><br><h2 id="zachem-nam-dirizhyor-v-komande">  ¿Por qué necesitamos un conductor en el equipo? </h2><br><p>  ¿Quién es un conductor?  De fr.  diriger - administrar, dirigir, liderar - en el mundo de la música - esta es una persona, el líder del aprendizaje y la interpretación de la música de conjunto.  En nuestro caso, este lugar está ocupado por sistemas de orquestación y automatización. </p><br><p>  Su papel no es diferente del papel del director de orquesta en la música: son necesarios para ayudar al equipo, dirigir y organizar su obra. </p><br><p>  Como regla general, un equipo tiene un cierto conjunto de capacidades, llamémosles servidores en los que implementan sus proyectos. </p><br><p>  El enfoque para obtener y operar estos servidores es diverso.  Algunos ejemplos </p><br><ul><li>  El equipo realiza una solicitud, por ejemplo, al grupo de operaciones, para proporcionarles recursos con ciertos parámetros. </li><li>  El grupo de operación les proporciona la cantidad requerida (nube o metal desnudo ("metal desnudo") y se compromete a mantenerlos en buenas condiciones de acuerdo con el SLA.  El ajuste también lo realiza el equipo de operaciones. </li><li>  El equipo recibe solo recursos en la nube o bare metal del grupo de operación; realiza su propia configuración. </li><li>  El equipo mismo "compra" recursos y los apoya / configura de forma completamente independiente. </li></ul><br><p>  Nuestro equipo utiliza servidores que necesitan soporte: actualice el sistema operativo, instale nuevos paquetes, etc. </p><br><p>  Para nosotros, los distinguimos en dos tipos principales: </p><br><ul><li>  grupo de tanques </li><li>  grupo de servicio </li></ul><br><p>  El grupo de tanques consta de hosts con Yandex.Tank. </p><br><p>  El grupo de servicios incluye todo lo relacionado con el mantenimiento: estos son varios servicios para proporcionar soporte para el ciclo de lanzamiento, generar informes automáticos, etc. </p><br><p>  En un momento, todo se volvió inconveniente para administrar todo esto manualmente, y pensamos en automatizar todo el proceso, comenzando por "cargar" los servidores y terminando con el desarrollo, diseño y lanzamiento de nuestro servicio interno. </p><br><h2 id="pochemu-dirizhyor-nuzhen-dazhe-esli-orkestr-sam-umeet-igrat">  ¿Por qué se necesita un director, incluso si la orquesta misma puede tocar? </h2><br><p>  Para empezar, dominamos Ansible y comenzamos a "verter" nuestros servidores básicos para que sean menos dependientes de los administradores del sistema: todos ganan aquí, adquirimos nuevas habilidades y liberamos a los administradores de la parte del trabajo que siempre tienen sin nosotros.  Nos esforzamos por desarrollar nuestro equipo fuera de nuestra especialidad y autonomía tanto como sea posible. </p><br><p>  La compañía ha estado trabajando con Ansible durante mucho tiempo ya establecida y regulada, por lo que integramos fácilmente nuestra solución en este proceso. </p><br><p>  El alojamiento ahora consta de tres roles de Ansible: </p><br><ul><li>  el primer rol instala el sistema operativo, </li><li>  el segundo despliega la configuración básica para el host, la autorización LDAP, por ejemplo, </li><li>  y el tercero instala Yandex.Tank y las dependencias relacionadas en el contenedor docker. </li></ul><br><p>  Pasemos a los servicios que usamos dentro del equipo. </p><br><p> Para nuestras tareas, utilizamos igualmente Kotlin y Python, y un poco más de Golang.  Para unificar el desarrollo y la implementación de nuestros servicios, decidimos empacarlos en contenedores acoplables.  Esto le da libertad para elegir un lenguaje de programación y al mismo tiempo regula el formato de entrega uniforme de su aplicación. </p><br><h3 id="nebolshaya-remarka-pro-ipv6-v-docker">  Un pequeño comentario sobre ipv6 en Docker </h3><br><p>  Algunos de los servicios con los que interactuamos están disponibles solo a través de ipv6, por lo que tuve que descubrir cómo hacer ipv6 para contenedores. </p><br><p>  De acuerdo con la documentación para ipv6 en el sitio web oficial de Docker, ipv6 se habilita agregando parámetros a daemon.json: </p><br><pre><code class="plaintext hljs">{ "ipv6": true, "fixed-cidr-v6": "2001:db8:1::/64" }</code> </pre> <br><p>  En este caso, el proveedor debe emitir la subred ipv6, que <code>fixed-cidr-v6.</code> en <code>fixed-cidr-v6.</code> <br>  Sin embargo, elegimos otra opción: ipv6 NAT, y he aquí por qué: </p><br><ul><li>  Ahora docker <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no se puede usar</a> solo con ipv6. </li><li>  La presencia de una dirección globalmente enrutable en cada contenedor significa que todos los puertos (incluso los no publicados) estarán disponibles para todos si no se realiza un filtrado adicional. </li><li>  proxy de userland para puertos de publicación, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">iptables solo para ipv4</a> . </li></ul><br><p>  ipv6 NAT es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">contenedor acoplable</a> que administra las reglas en ip6tables y las edita cuando se agrega un nuevo contenedor. </p><br><p>  Para que esta solución funcione correctamente, se tuvieron que realizar varias manipulaciones.  Asegúrese de inicializar ip6table_nat en el sistema.  La presencia de un módulo instalado en el sistema no garantiza que, al inicio, el módulo se cargará en el núcleo.  Nos encontramos con esto cuando recibimos este error al iniciar un contenedor con NAT en un host nuevo: </p><br><pre> <code class="plaintext hljs">2019/01/22 14:59:54 running [/sbin/ip6tables -t filter -N DOCKER --wait]: exit status 3: modprobe: can't change directory to '/lib/modules': No such file or directory ip6tables v1.6.2: can't initialize ip6tables table `filter': Table does not exist (do you need to insmod?)</code> </pre> <br><p>  El problema se resolvió después de agregar la inicialización a la función Ansible usando el módulo modprobe y cargarlo al inicio usando lineinfile: </p><br><pre> <code class="plaintext hljs">- name: Add ip6table_nat module modprobe: name: ip6table_nat state: present - name: Add ip6table_nat to boot lineinfile: path: /etc/modules line: 'ip6table_nat'</code> </pre> <br><p>  Por cierto, hay un buen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">artículo</a> sobre Haber, que describe breve y claramente las ventajas y desventajas de un método particular para trabajar con ipv6 en Docker. </p><br><p>  Pero volviendo a nuestra pregunta formulada al principio: <br>  <strong>¿Por qué se necesita un director, incluso si la orquesta misma puede tocar?</strong> </p><br><p>  Ahora todos saben cómo jugar en nuestro equipo: </p><br><ul><li>  se crea el proceso de "llenar" los servidores, </li><li>  El desarrollo y despliegue de servicios están unificados. </li></ul><br><p>  Surge una pregunta razonable: ¿cómo implementar, actualizar y controlar nuestros servicios en contenedores acoplables de manera eficiente y lo más automatizada posible? </p><br><p>  A pesar de que cada miembro de la orquesta conoce su propia parte, puede extraviarse, alejarse de la idea original.  Aquí llegamos al hecho de que sin un director de orquesta, nuestra orquesta no ensayará y tocará armoniosamente.  El conductor es responsable de todos los parámetros de rendimiento, para garantizar que todo esté unido por un solo ritmo y estado de ánimo. </p><br><h2 id="kak-s-minimalnymi-vlozheniyami-poluchit-horoshego-dirizhera">  ¿Cómo conseguir un buen conductor con una inversión mínima? </h2><br><p>  El tema de la orquestación está bien desarrollado en el mercado.  Pero primero, hablemos sobre las herramientas de apoyo que pueden ayudar al conductor. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Consul</a> es un sistema que proporciona dos funciones principales: </p><br><ul><li>  descubrimiento de servicio </li><li>  almacenamiento distribuido de valor-clave. </li></ul><br><p>  En nuestra orquesta, el Cónsul será responsable de registrar los servicios y almacenar sus configuraciones.  Hay dos opciones de registro: </p><br><ul><li>  Activo: esto es cuando el servicio en sí se registra utilizando la API HTTP; </li><li>  Pasivo: el servicio debe registrarse manualmente. </li></ul><br><p>  Vault es un repositorio que estandariza y unifica el almacenamiento seguro y trabaja con secretos: contraseñas, certificados. <br>  Estos son los beneficios que obtendremos con esta herramienta: </p><br><ul><li>  Un único centro para crear y guardar secretos, gestionando su ciclo de vida a través de la API HTTP. </li><li>  Transit Secrets Engine: cifrado-descifrado de datos sin guardarlos.  La capacidad de transmitir datos en forma cifrada a través de canales de comunicación no seguros. </li><li>  Políticas de acceso convenientes para configurar. </li><li>  Auditar el acceso a los secretos. </li><li>  Capacidad para crear su propia CA (Autoridad de certificación) para administrar certificados autofirmados dentro de su infraestructura. </li></ul><br><p>  Teniendo en cuenta todos nuestros requisitos, dos opciones se adaptaron al papel de director: Kubernetes y Nomad. </p><br><h4 id="kubernetes">  Kubernetes </h4><br><p>  Cuántos artículos y libros ya se han escrito sobre él (este, por ejemplo), se han informado informes que escribiré en resumen: esta es una combinación universal que puede hacer casi cualquier cosa.  Pagar por ello no siempre es fácil de configurar y soportar un clúster en Kubernetes. </p><br><h4 id="nomad">  Nómada </h4><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">La herramienta es</a> de HashiCorp, una compañía conocida por el cónsul y la bóveda mencionados anteriormente. </p><br><p>  Nomad nos pareció bastante simple de instalar y configurar que Kubernetes.  Un archivo binario funciona tanto en modo servidor como en modo cliente.  Al mismo tiempo, Nomad cubre la lista completa de tareas que queremos que resuelva: administración de clústeres, planificador rápido, soporte para centros múltiples.  Además, cuando usamos cónsul y bóveda, obtenemos una integración más estrecha para orquestar nuestros servicios. </p><br><p>  Lo que ahora está en el trabajo: </p><br><ul><li>  preparó los servidores para el despliegue de cónsul, </li><li>  la configuración del clúster nómada se ingresará en Cónsul, con lo cual el nómada se implementará automáticamente, </li><li>  Paralelamente, instalaremos una bóveda para guardar secretos. </li></ul><br><p>  La pregunta en la sala es si vale la pena tener un director para tales tareas o si una orquesta es buena sin ella.  Cuéntanos en los comentarios lo que piensas sobre esto. </p><br><hr><br><p>  Suscríbase a nuestro blog y manténgase en contacto: pronto le diremos qué sucedió al final y si configuramos el clúster nómada, como queríamos. </p><br><p>  Visite nuestra acogedora <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sala de chat de telegramas</a> donde siempre puede pedir consejos, ayudar a colegas y simplemente hablar sobre investigación de desempeño y más. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443822/">https://habr.com/ru/post/443822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443812/index.html">Cómo implementar un lenguaje de programación en JavaScript. Parte 2: Intérprete</a></li>
<li><a href="../443814/index.html">Dar es mi "negocio anterior"</a></li>
<li><a href="../443816/index.html">El Ministerio de Comunicaciones insiste en un solo operador 5G</a></li>
<li><a href="../443818/index.html">Resumen de eventos de TI de marzo (segunda parte)</a></li>
<li><a href="../443820/index.html">Cómo el aeropuerto de Fukuoka descubrió qué medidas serían efectivas para reducir las colas</a></li>
<li><a href="../443824/index.html">5 razones para cambiar a la impresión 3D de productos metálicos</a></li>
<li><a href="../443826/index.html">Prevenir la obsolescencia de los materiales de enseñanza.</a></li>
<li><a href="../443828/index.html">Los orígenes de la cultura de inicio: cómo las primeras historias de éxito configuraron el estado moderno de la industria tecnológica</a></li>
<li><a href="../443830/index.html">Tesla presentó el nuevo Modelo Y: detalles, fotos de la presentación e impresiones de la prueba de manejo.</a></li>
<li><a href="../443834/index.html">Runet en el cambio de milenio: ¿qué recuerdas al respecto?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>