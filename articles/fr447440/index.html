<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüë® ‚òÉÔ∏è üë©üèΩ‚Äçüé® RBKmoney Payments sous le capot - la logique de la plateforme de paiement ‚úÖ üë®üèΩ‚ÄçüöÄ üí©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Je continue de publier le cycle sur l'int√©rieur de la plate-forme de paiement RBK.money, qui a commenc√© dans ce post . Aujourd'hui, nou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>RBKmoney Payments sous le capot - la logique de la plateforme de paiement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/rbkmoney/blog/447440/"><p><img src="https://habrastorage.org/webt/ao/li/cv/aolicvi50stowouvsmwppnyc7qk.jpeg"></p><br><p>  Bonjour, Habr!  Je continue de publier le cycle sur l'int√©rieur de la plate-forme de paiement RBK.money, qui a commenc√© dans ce <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">post</a> .  Aujourd'hui, nous allons parler du sch√©ma de traitement logique, des microservices sp√©cifiques et de leur relation les uns avec les autres, comment les services qui traitent chaque √©l√©ment de la logique m√©tier sont logiquement s√©par√©s, pourquoi le noyau de traitement ne sait rien du nombre de vos cartes de paiement et comment les paiements s'ex√©cutent √† l'int√©rieur de la plateforme.  Aussi, un peu plus en d√©tail, je vais r√©v√©ler le sujet de la fa√ßon dont nous fournissons une haute disponibilit√© et une mise √† l'√©chelle pour g√©rer des charges √©lev√©es. </p><a name="habracut"></a><br><h2 id="obzornaya-logicheskaya-shema-i-obschie-podhody">  Aper√ßu de la logique et des approches g√©n√©rales </h2><br><p>  En g√©n√©ral, le sch√©ma des √©l√©ments de base de la partie du traitement responsable des paiements ressemble √† ceci. </p><br><p><img src="https://habrastorage.org/webt/r8/ee/bz/r8eebzud9-g1muc_xguixpokwfc.png"></p><br><p>  Logiquement en nous-m√™mes, nous divisons les domaines de responsabilit√© en 3 domaines: </p><br><ul><li>  zone externe, les entit√©s qui sont sur Internet, telles que les applications JS de notre formulaire de paiement (vous y entrez les d√©tails de votre carte), les backends de nos clients marchands, ainsi que les passerelles de traitement de nos banques partenaires et fournisseurs d'autres modes de paiement; </li><li>  une zone interne hautement accessible, des microservices y vivent, qui fournissent directement le travail de la passerelle de paiement et g√®rent le d√©bit de l'argent, en les prenant en compte dans notre syst√®me et d'autres services en ligne, qui se caract√©risent par l'exigence `` devrait toujours √™tre disponible, malgr√© les d√©faillances √† l'int√©rieur de nos DC ''; <br><ul><li>  il existe un domaine distinct de services qui fonctionne directement avec les donn√©es compl√®tes des titulaires de carte; ces services ont des exigences distinctes propos√©es par le minist√®re des Chemins de fer et soumises √† une certification obligatoire en vertu des normes PCI-DSS.  Nous expliquerons plus en d√©tail pourquoi une telle s√©paration ci-dessous; </li></ul></li><li>  la zone int√©rieure, o√π il y a des exigences moindres pour la disponibilit√© des services fournis ou le temps de leur r√©ponse, au sens classique - c'est un back office.  Bien que, bien s√ªr, nous essayons √©galement ici de garantir le principe du ¬´toujours disponible¬ª, nous y consacrons simplement moins d'efforts; </li></ul><br><p> √Ä l'int√©rieur de chaque zone, il existe des microservices qui ex√©cutent leurs parties de traitement de la logique m√©tier.  Ils re√ßoivent des appels RPC en entr√©e et en sortie, ils g√©n√®rent des donn√©es trait√©es √† l'aide d'algorithmes int√©gr√©s, qui sont √©galement ex√©cut√©s en tant qu'appels d'autres microservices le long de la cha√Æne. </p><br><p>  Pour garantir l'√©volutivit√©, nous essayons de stocker les √©tats dans le moins d'endroits possible.  Les services sans √©tat dans le diagramme n'ont pas de connexions avec des magasins persistants, avec √©tat, respectivement, qui leur sont connect√©s.  En g√©n√©ral, nous utilisons plusieurs services limit√©s pour le stockage d'√©tat persistant - pour la partie principale du traitement, ce sont les clusters Riak KV, pour les services connexes - PostgreSQL, pour le traitement des files d'attente asynchrones, nous utilisons Kafka. </p><br><p>  Pour garantir une haute disponibilit√©, nous d√©ployons des services dans plusieurs instances, g√©n√©ralement de 3 √† 5. </p><br><p>  Il est facile de faire √©voluer les services sans √©tat, nous augmentons simplement le nombre d'instances dont nous avons besoin sur diff√©rentes machines virtuelles, ils sont enregistr√©s dans Consul, ils sont disponibles pour la r√©solution via le DNS de la console et commencent √† recevoir des appels d'autres services, en traitant les donn√©es re√ßues et en les envoyant plus loin. </p><br><p>  Les services avec √©tat, ou plut√¥t c'est notre principal et montr√© dans le diagramme comme Machinegun, impl√©mentent une interface hautement accessible (l'architecture distribu√©e est bas√©e sur Erlang Distribution), et la synchronisation via Consul KV est utilis√©e pour assurer la mise en file d'attente et le verrouillage distribu√©.  Il s'agit d'une br√®ve description d√©taill√©e dans un article s√©par√©. </p><br><p>  Hors de la bo√Æte, Riak fournit un stockage sans ma√Ætre persistant hautement accessible, nous ne le pr√©parons en aucune fa√ßon, la configuration est presque par d√©faut.  Avec le profil de charge actuel, nous avons 5 n≈ìuds dans le cluster d√©ploy√©s sur des h√¥tes distincts.  Remarque importante - nous n'utilisons pratiquement pas d'index et de grands √©chantillons de donn√©es, nous travaillons avec des cl√©s sp√©cifiques. </p><br><p>  Lorsque la mise en ≈ìuvre du sch√©ma KV est trop co√ªteuse, nous utilisons des bases de donn√©es PostgeSQL avec r√©plication, ou m√™me des solutions monomodes, car nous pouvons toujours t√©l√©charger les √©v√©nements n√©cessaires en cas de d√©faillance de la partie en ligne via Machinegun. </p><br><p>  La s√©paration des couleurs des microservices dans le diagramme indique les langages dans lesquels ils sont √©crits - vert clair - ce sont des applications Java, bleu clair - Erlang. </p><br><p>  Tous les services fonctionnent dans des conteneurs Docker, qui sont des artefacts de g√©n√©ration CI et sont situ√©s dans le registre Docker local.  D√©ploie des services sur la production SaltStack, dont la configuration se trouve dans le r√©f√©rentiel Github priv√©. </p><br><p>  Les d√©veloppeurs effectuent ind√©pendamment des demandes de modifications dans ce r√©f√©rentiel, o√π ils d√©crivent les exigences du service - indiquent la version et les param√®tres souhait√©s, tels que la taille de la m√©moire allou√©e au conteneur, transf√©r√©e aux variables d'environnement et autres.  De plus, apr√®s confirmation manuelle de la demande de changement par les employ√©s autoris√©s (nous avons DevOps, support et s√©curit√© de l'information), le CD d√©ploie automatiquement les instances de conteneur avec les nouvelles versions vers les h√¥tes de l'environnement du produit. </p><br><p><img src="https://habrastorage.org/webt/31/ec/iy/31eciyvgovypqogaegextoyyuf0.jpeg"></p><br><p>  De plus, chaque service √©crit des journaux dans un format compr√©hensible par Elasticsearch.  Les fichiers journaux sont r√©cup√©r√©s par Filebeat, qui les √©crit dans le cluster Elasticsearch.  Ainsi, malgr√© le fait que les d√©veloppeurs n'aient pas acc√®s √† l'environnement du produit, ils ont toujours la possibilit√© de d√©boguer et de voir ce qui arrive √† leurs services. </p><br><h2 id="vzaimodeystvie-s-vneshnim-mirom">  Interaction avec le monde ext√©rieur </h2><br><p><img src="https://habrastorage.org/webt/nd/wp/lw/ndwplwol-avyp6uixovsla-otfq.jpeg"></p><br><p>  Tout changement dans l'√©tat de la plateforme avec nous se produit exclusivement par le biais d'appels aux m√©thodes correspondantes des API publiques.  Nous n'utilisons pas d'applications Web classiques et de g√©n√©ration de contenu c√¥t√© serveur, en fait, tout ce que vous voyez comme une interface utilisateur est des vues JS sur nos API publiques.  En principe, toute action dans la plate-forme peut √™tre effectu√©e avec une cha√Æne d'appels de boucle √† partir de la console, que nous utilisons.  En particulier, pour √©crire des tests d'int√©gration (nous les avons √©crits en JS en tant que biblioth√®que), qui en CI, lors de chaque assemblage, v√©rifient toutes les m√©thodes publiques. </p><br><p>  De plus, une telle approche r√©sout tous les probl√®mes d'int√©gration externe avec notre plate-forme, vous permettant d'obtenir un protocole unique pour l'utilisateur final sous la forme d'une belle forme de saisie des donn√©es de paiement et d'h√¥te √† h√¥te pour une int√©gration directe avec un traitement tiers utilisant exclusivement une interaction interserveur. </p><br><p>  En plus de la couverture compl√®te des tests d'int√©gration, nous utilisons les approches de mise √† jour interm√©diaire, dans une architecture distribu√©e, il est assez facile de le faire, par exemple, en d√©ployant un seul service de chaque groupe en un seul passage, suivi d'une pause et d'une analyse des journaux et des graphiques. </p><br><p>  Cela nous permet de d√©ployer presque 24 heures sur 24, y compris les vendredis soirs, de d√©ployer quelque chose d'inop√©rant sans trop de crainte, ou de revenir rapidement en arri√®re, en effectuant un simple retour en arri√®re avec un changement, jusqu'√† ce que personne ne le remarque. </p><br><h2 id="registraciya-v-platforme-i-publichnye-api">  Enregistrement de la plateforme et API publiques </h2><br><p><img src="https://habrastorage.org/webt/tw/m4/0l/twm40lykiloaelwx8elbj6shjge.jpeg"></p><br><p>  Avant tout appel √† la m√©thode publique, nous devons autoriser et authentifier le client.  Pour qu'un client apparaisse sur la plateforme, vous avez besoin d'un service qui prendra en charge toutes les interactions avec l'utilisateur final, fournira des interfaces pour l'enregistrement, la saisie et la r√©initialisation des mots de passe, le contr√¥le de s√©curit√© et d'autres liaisons. </p><br><p>  Ici, nous n'avons pas invent√© un v√©lo, mais simplement int√©gr√© la solution open source de Redhat - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Keycloak</a> .  Avant de commencer toute interaction avec nous, vous devrez vous inscrire sur la plateforme, ce qui, en fait, se fait via Keycloak. </p><br><p>  Apr√®s une authentification r√©ussie dans le service, le client re√ßoit un JWT.  Nous l'utiliserons plus tard pour l'autorisation - du c√¥t√© de Keycloak, vous pouvez sp√©cifier des champs arbitraires qui d√©crivent les r√¥les qui seront incorpor√©s comme une structure json simple dans JWT et sign√©s avec la cl√© priv√©e du service. </p><br><p>  <em>L'une des caract√©ristiques de JWT est que cette structure est sign√©e par la cl√© priv√©e du serveur; en cons√©quence, pour autoriser la liste des r√¥les et ses autres objets, nous n'avons pas besoin d'acc√©der au service d'autorisation, le processus est compl√®tement d√©coupl√©.</em>  <em>Les services CAPI au d√©marrage lisent la cl√© publique Keycloak et l'utilisent pour autoriser les appels aux m√©thodes API publiques.</em> </p><br><p>  <em>Lorsque nous avons √©labor√© le sch√©ma de r√©vocation cl√©, l'histoire est distincte et m√©rite son propre article.</em> </p><br><p>  Donc, nous avons re√ßu le JWT, nous pouvons l'utiliser pour l'authentification.  Ici, le groupe de microservices Common API entre en jeu, sur le diagramme indiqu√© comme CAPI et CAPI-DSS, qui impl√©mentent les fonctions suivantes: </p><br><ul><li>  autorisation des messages re√ßus.  Chaque appel d'API public est pr√©c√©d√© d'un en-t√™te HTTP Authorizaion: Bearer {JWT}.  Les services du groupe Common API l'utilisent pour v√©rifier les donn√©es sign√©es avec la cl√© publique existante du service d'autorisation; </li><li>  validation des donn√©es re√ßues.  √âtant donn√© que le sch√©ma est d√©crit comme une sp√©cification OpenAPI, √©galement connue sous le nom de Swagger, la validation des donn√©es peut √™tre tr√®s facile et avec peu de chances de recevoir des commandes de contr√¥le dans le flux de donn√©es.  Cela a un effet positif sur la s√©curit√© du service dans son ensemble; </li><li>  traduction des formats de donn√©es du REST JSON public en Thrift binaire interne; </li><li>  encadrer la liaison de transport avec des donn√©es telles qu'un trace_id unique et transmettre l'√©v√©nement plus loin √† l'int√©rieur de la plate-forme √† un service qui g√®re la logique m√©tier et sait ce qu'est, par exemple, le paiement. </li></ul><br><p>  Nous avons de nombreux services de ce type, ils sont assez simples et en ch√™ne, ne stockent aucun √©tat, donc pour une mise √† l'√©chelle lin√©aire des performances, nous les d√©ployons simplement √† pleine capacit√© dans les quantit√©s dont nous avons besoin. </p><br><h3 id="pci-dss-i-otkrytye-kartochnye-dannye">  PCI-DSS et donn√©es de carte ouvertes </h3><br><p><img src="https://habrastorage.org/webt/ak/fh/x-/akfhx-regosuv_tbadtr-x2p6uo.jpeg"></p><br><p>  Comme vous pouvez le voir dans le diagramme, nous avons deux de ces groupes de services - le principal, l'API commune, est responsable du traitement de tous les flux de donn√©es qui n'ont pas de donn√©es de titulaire de carte ouvertes, et le second, l'API commune PCI-DSS, qui fonctionne directement avec ces cartes.  √Ä l'int√©rieur, ils sont exactement les m√™mes, mais nous les avons s√©par√©s physiquement et dispos√©s sur diff√©rents morceaux de fer. </p><br><p>  Ceci est fait afin de minimiser le nombre d'emplacements de stockage et de traitement des donn√©es de carte, de r√©duire les risques de fuite de ces donn√©es et la zone de certification PCI-DSS.  Et cela, croyez-moi, est un processus assez long et co√ªteux - en tant qu'entreprise de paiement, nous sommes tenus de subir une certification payante pour la conformit√© aux normes MPS chaque ann√©e, et moins il y a de serveurs et de services impliqu√©s, plus il est rapide et facile de terminer ce processus.  Eh bien, sur la s√©curit√©, cela se refl√®te de la mani√®re la plus positive. </p><br><h2 id="obrabotka-platezhnyh-dannyh-i-tokenizaciya">  Facturation et tokenisation </h2><br><p><img src="https://habrastorage.org/webt/2y/ya/cm/2yyacmg2lhhzmvnbjv0azaei8gi.jpeg"></p><br><p>  Nous voulons donc commencer le paiement et radier l'argent de la carte du payeur. </p><br><p>  Imaginez que la demande se fasse sous la forme d'une cha√Æne d'appels aux m√©thodes de notre API publique, qui a √©t√© initi√©e par vous en tant que payeur apr√®s que vous soyez all√© sur la boutique en ligne, r√©cup√©r√© un panier de marchandises, cliqu√© sur "Acheter", saisi les d√©tails de votre carte dans notre paiement formulaire et cliqu√© sur le bouton "Payer". </p><br><p>  <em>Nous fournissons divers processus commerciaux pour radier de l'argent, mais le plus int√©ressant est le processus utilisant des comptes cr√©diteurs.</em>  <em>Dans notre plateforme, vous pouvez cr√©er une facture pour le paiement, ou une facture qui sera un conteneur pour les paiements.</em> </p><br><p>  <em>Dans une m√™me facture, vous pouvez essayer de la payer une par une, c'est-√†-dire cr√©er des paiements jusqu'√† ce que le prochain paiement soit r√©ussi.</em>  <em>Par exemple, vous pouvez essayer de payer une facture √† partir de diff√©rentes cartes, portefeuilles et autres modes de paiement.</em>  <em>S'il n'y a pas d'argent sur l'une des cartes, vous pouvez en essayer une autre et ainsi de suite.</em> </p><br><p>  <em>Cela a un effet positif sur la conversion et l'exp√©rience utilisateur.</em> </p><br><h3 id="konechnyy-avtomat-invoysa">  Machine d'√©tat de facture </h3><br><p><img src="https://habrastorage.org/webt/gh/u0/ld/ghu0ld9cimq5z13mc1blstsuycy.jpeg"></p><br><p>  √Ä l'int√©rieur de la plate-forme, cette cha√Æne se transforme en interactions le long de l'itin√©raire suivant: </p><br><ul><li>  Avant de livrer du contenu √† votre navigateur, notre client-commer√ßant int√©gr√© √† notre plateforme, s'est enregistr√© aupr√®s de nous et a re√ßu un JWT pour autorisation; </li><li>  √† partir de son backend, le commer√ßant a appel√© la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">createInvoice ()</a> , c'est-√†-dire qu'il a cr√©√© une facture pour le paiement dans notre plateforme.  En fait, le backend marchand a envoy√© une requ√™te HTTP POST du contenu suivant √† notre point de terminaison: </li></ul><br><pre><code class="bash hljs">curl -X POST \ https://api.rbk.money/v2/processing/invoices \ -H <span class="hljs-string"><span class="hljs-string">'Authorization: Bearer {JWT}'</span></span> \ -H <span class="hljs-string"><span class="hljs-string">'Content-Type: application/json; charset=utf-8'</span></span> \ -H <span class="hljs-string"><span class="hljs-string">'X-Request-ID: 1554417367'</span></span> \ -H <span class="hljs-string"><span class="hljs-string">'cache-control: no-cache'</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{ "shopID": "TEST", "dueDate": "2019-03-28T17:41:32.569Z", "amount": 6000, "currency": "RUB", "product": "Order num 12345", "description": "Delicious meals", "cart": [ { "price": 5000, "product": "Sandwich", "quantity": 1, "taxMode": { "rate": "10%", "type": "InvoiceLineTaxVAT" } }, { "price": 1000, "product": "Cola", "quantity": 1, "taxMode": { "rate": "18%", "type": "InvoiceLineTaxVAT" } } ], "metadata": { "order_id": "Internal order num 13123298761" } }'</span></span></code> </pre> <br><p>  La demande √©tait √©quilibr√©e sur l'une des applications erlang du groupe Common API, qui a v√©rifi√© sa validit√©, s'est rendue au service Bender, o√π elle a re√ßu la cl√© d'idempotency, l'a transf√©r√©e au tift et a envoy√© une demande au groupe de services Hellgate.  L'instance Hellgate a effectu√© des v√©rifications commerciales, par exemple, s'est assur√©e que le propri√©taire de ce JWT n'est pas en principe bloqu√©, peut cr√©er des factures et g√©n√©ralement interagir avec la plate-forme et a commenc√© √† cr√©er une facture. </p><br><p>  <em>Nous pouvons dire que Hellgate est au c≈ìur de notre traitement, car il op√®re avec des entit√©s commerciales, sait comment lancer un paiement, qui doit √™tre vir√© pour que ce paiement se transforme en une somme d'argent r√©elle, comment calculer l'itin√©raire de ce paiement, √† qui il faudrait dire de l'annuler refl√©t√©es dans les bilans, calculer les commissions et autres consolidations.</em> </p><br><p>  <em>En r√®gle g√©n√©rale, il ne stocke aucun √©tat et est √©galement facilement √©volutif.</em>  <em>Mais nous ne voudrions pas perdre la facture ou recevoir une double charge d'argent de la carte en cas de rupture de r√©seau ou de d√©faillance de Hellgate pour une raison quelconque.</em>  <em>Il est n√©cessaire de sauvegarder ces donn√©es de mani√®re persistante.</em> </p><br><p>  Voici le troisi√®me microservice, √† savoir Machinegun.  Hellgate envoie √† Machinegun un appel pour "cr√©er un automate" avec une charge utile sous forme de param√®tres de requ√™te.  Machinegun organise les demandes simultan√©es et, √† l'aide de Hellgate, cr√©e le premier √©v√©nement √† partir des param√®tres - InvoiceCreated.  Ce qui alors lui-m√™me et √©crit dans Riak et les files d'attente.  Apr√®s cela, une r√©ponse r√©ussie est renvoy√©e dans l'ordre inverse √† la demande initiale de la cha√Æne. </p><br><p>  <em>En bref, Machinegun est un tel SGBD avec des temporisateurs sur tout autre SGBD, dans la version actuelle de la plate-forme - sur Riak.</em>  <em>Il fournit une interface qui vous permet de contr√¥ler des machines ind√©pendantes et fournit des garanties d'idempotence et d'ordre d'enregistrement.</em>  <em>C'est MG qui ne permettra pas que l'√©v√©nement soit automatiquement supprim√© de la file d'attente si plusieurs HG lui parviennent soudainement avec une telle demande.</em> </p><br><p>  <em>Un automate est une entit√© unique au sein de la plate-forme, compos√©e d'un identifiant, d'un ensemble de donn√©es sous la forme d'une liste d'√©v√©nements et d'un temporisateur.</em>  <em>L'√©tat final de l'automate est calcul√© √† partir du traitement de tous ses √©v√©nements qui d√©clenchent sa transition vers l'√©tat correspondant.</em>  <em>Nous utilisons cette approche pour travailler avec des entit√©s commerciales, en les d√©crivant comme des machines √† √©tats finis.</em>  <em>En fait, toutes les factures cr√©√©es par nos marchands, ainsi que leurs paiements, sont des machines √† √©tats finis avec leur propre logique de transition entre les √©tats.</em> </p><br><p>  <em>L'interface pour travailler avec des minuteries dans Machinegun vous permet de recevoir une demande du formulaire "Je veux continuer √† traiter cette machine dans 15 ans" d'un autre service avec des √©v√©nements pour l'enregistrement.</em>  <em>Ces t√¢ches en attente sont impl√©ment√©es sur des minuteries int√©gr√©es.</em>  <em>En pratique, ils sont tr√®s souvent utilis√©s - appels p√©riodiques √† la banque, actions automatiques avec paiements dus √† une longue inactivit√©, etc.</em> </p><br><p>  <em>Soit dit en passant, les codes source de Machinegun sont ouverts sous la licence Apache 2.0 dans notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©f√©rentiel public</a> .</em>  <em>Nous esp√©rons que ce service pourra √™tre utile √† la communaut√©.</em> </p><br><p>  <em>Une description d√©taill√©e du travail de Machinegun et, en g√©n√©ral, de la fa√ßon dont nous pr√©parons le syst√®me de distribution, est tir√©e vers un autre poste important, donc je ne m'arr√™terai pas ici plus en d√©tail.</em> </p><br><h3 id="nyuansy-avtorizacii-vneshnih-klientov">  Les nuances de l'autorisation des clients externes </h3><br><p><img src="https://habrastorage.org/webt/-l/4v/zo/-l4vzorvyofnp2f4cb9xq6n3oky.jpeg"></p><br><p>  Apr√®s une sauvegarde r√©ussie, Hellgate renvoie les donn√©es au CAPI, il convertit la structure binaire de trift en un JSON magnifiquement con√ßu, pr√™t √† √™tre envoy√© au backend marchand: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"invoice"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"amount"</span></span>: <span class="hljs-number"><span class="hljs-number">6000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cart"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"cost"</span></span>: <span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"Sandwich"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"taxMode"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"rate"</span></span>: <span class="hljs-string"><span class="hljs-string">"10%"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"InvoiceLineTaxVAT"</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"cost"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"Cola"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"taxMode"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"rate"</span></span>: <span class="hljs-string"><span class="hljs-string">"18%"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"InvoiceLineTaxVAT"</span></span> } } ], <span class="hljs-attr"><span class="hljs-attr">"createdAt"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-04-04T23:00:31.565518Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"currency"</span></span>: <span class="hljs-string"><span class="hljs-string">"RUB"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Delicious meals"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dueDate"</span></span>: <span class="hljs-string"><span class="hljs-string">"2019-04-05T00:00:30.889000Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"18xtygvzFaa"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"metadata"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"order_id"</span></span>: <span class="hljs-string"><span class="hljs-string">"Internal order num 13123298761"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"Order num 12345"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"shopID"</span></span>: <span class="hljs-string"><span class="hljs-string">"TEST"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"status"</span></span>: <span class="hljs-string"><span class="hljs-string">"unpaid"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"invoiceAccessToken"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"payload"</span></span>: <span class="hljs-string"><span class="hljs-string">"{JWT}"</span></span> } }</code> </pre> <br><p>  Il semblerait que vous puissiez envoyer du contenu au payeur dans le navigateur et d√©marrer le processus de paiement, mais ici, nous pensions que tous les commer√ßants ne seraient pas pr√™ts √† mettre en ≈ìuvre ind√©pendamment l'autorisation c√¥t√© client, nous l'avons donc mise en ≈ìuvre nous-m√™mes.  L'approche est que CAPI g√©n√®re un autre JWT qui vous permet de d√©marrer des processus de tokenisation de carte et de g√©rer une facture sp√©cifique et l'ajoute √† la structure de facture retourn√©e. </p><br><p>  Un exemple des r√¥les d√©crits dans un JWT similaire: </p><br><pre> <code class="json hljs"> <span class="hljs-string"><span class="hljs-string">"resource_access"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"common-api"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"roles"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"invoices.18xtygvzFaa.payments:read"</span></span>, <span class="hljs-string"><span class="hljs-string">"invoices.18xtygvzFaa.payments:write"</span></span>, <span class="hljs-string"><span class="hljs-string">"invoices.18xtygvzFaa:read"</span></span>, <span class="hljs-string"><span class="hljs-string">"payment_resources:write"</span></span> ] } }</code> </pre> <br><p>  Ce JWT a un nombre limit√© de tentatives d'utilisation et la dur√©e de vie que nous configurons, ce qui vous permet de le publier dans le navigateur du payeur.  M√™me s'il est intercept√©, le maximum qu'un attaquant puisse faire est de payer la facture de quelqu'un d'autre ou de lire ses donn√©es.  De plus, √©tant donn√© que la machine de paiement ne fonctionne pas avec des donn√©es de carte ouvertes, le maximum qu'un attaquant peut voir est un num√©ro de carte masqu√© du formulaire <code>4242 42** **** 4242</code> , le montant du paiement et, √©ventuellement, un panier de marchandises. </p><br><p>  La facture cr√©√©e et sa cl√© d'acc√®s vous permettent de d√©marrer le processus commercial de paiement.  Nous donnons l'ID de facture et son JWT au navigateur du payeur et transf√©rons le contr√¥le √† nos applications JS. </p><br><p>  Notre application Checkout JS met en ≈ìuvre une interface pour interagir avec vous en tant que payeur - dessine un formulaire de saisie des donn√©es de paiement, d√©marre un paiement, re√ßoit son statut final, affiche un point dr√¥le ou triste. </p><br><h3 id="tokenizaciya-i-kartochnye-dannye">  Tokenisation et donn√©es de carte </h3><br><p><img src="https://habrastorage.org/webt/gq/1d/gb/gq1dgbxkq1ewsfohsytcdvnotzs.jpeg"></p><br><p>  Mais Checkout ne fonctionne pas avec les donn√©es de la carte.  Comme mentionn√© ci-dessus, nous souhaitons stocker des donn√©es sensibles sous forme de donn√©es de titulaire de carte dans le moins d'endroits possible.  Pour ce faire, nous impl√©mentons la tokenisation. </p><br><p>  C'est l√† que la biblioth√®que Tokenizer JS entre en jeu.  Lorsque vous entrez votre carte dans les champs de saisie et cliquez sur "Payer", elle intercepte ces donn√©es et nous les envoie de mani√®re asynchrone pour traitement en appelant la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">createPaymentResource ()</a> . </p><br><p>  Cette demande est √©quilibr√©e pour les applications CAPI-DSS individuelles, qui autorisent √©galement la demande, uniquement en v√©rifiant la facture JWT, en validant les donn√©es et en les envoyant par tront au service de stockage des donn√©es de la carte.  Dans le diagramme, il est indiqu√© comme CDS - Stockage de donn√©es sur carte. </p><br><p>  Les principaux objectifs de ce service: </p><br><ul><li>  recevoir des donn√©es sensibles sur une entr√©e, dans notre cas - les donn√©es de votre carte; </li><li>  crypter ces donn√©es avec une cl√© de cryptage des donn√©es; </li><li>  g√©n√©rer une valeur al√©atoire utilis√©e comme cl√©; </li><li>  enregistrez les donn√©es chiffr√©es sur cette cl√© dans votre cluster Riak; </li><li>  retourner la cl√© sous forme de jeton de donn√©es de paiement au service CAPI-DSS. </li></ul><br><p>  En cours de route, le service r√©sout un tas de t√¢ches importantes, telles que la g√©n√©ration de cl√©s pour le chiffrement de cl√©s, la saisie s√©curis√©e de ces cl√©s, le rechiffrement des donn√©es, le contr√¥le de l'effacement de CVV apr√®s le paiement, etc., mais cela d√©passe le cadre de cet article. </p><br><p>  <em>Ce n'√©tait pas sans protection contre la possibilit√© de se tirer une balle dans le pied.</em>  <em>Il existe une probabilit√© non nulle qu'un JWT priv√©, con√ßu pour autoriser les demandes du backend, soit publi√© sur le Web dans le navigateur du client.</em>  <em>Pour √©viter cela, nous avons int√©gr√© une protection - vous ne pouvez appeler la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">createPaymentResource ()</a> qu'avec la cl√© d'autorisation de facturation.</em>  <em>Lorsque vous essayez d'utiliser une plateforme JWT priv√©e, une erreur HTTP / 401 sera renvoy√©e.</em> </p><br><p>  Apr√®s avoir termin√© la demande de tokenisation, le Tokenizer renvoie le jeton re√ßu √† Checkout et termine son travail √† ce sujet. </p><br><h3 id="biznes-process-platezhnogo-avtomata">  Processus op√©rationnel de la machine de paiement </h3><br><p><img src="https://habrastorage.org/webt/ai/9s/7j/ai9s7jsxfzkuoume64zcw_chcks.png"></p><br><p>  Checkout d√©marre le processus de paiement, √† savoir, il appelle la m√©thode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">createPayment ()</a> , en passant le jeton de carte pr√©c√©demment re√ßu comme argument et d√©marre le processus d'interrogation des √©v√©nements, en fait, en appelant la m√©thode API <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">getInvoiceEvents ()</a> une fois par seconde. </p><br><p>  Ces demandes via CAPI tombent dans Hellgate, qui commence √† mettre en ≈ìuvre un processus commercial de paiement, sans utiliser les donn√©es de la carte: </p><br><ul><li>  tout d'abord, Hellgate passe au service de gestion de configuration - Dominant et re√ßoit la r√©vision actuelle de la configuration du domaine.  Il contient toutes les r√®gles selon lesquelles ce paiement sera effectu√©, pour quelle banque il ira √† l'autorisation, quels frais de transaction seront enregistr√©s, etc. <br><ul><li>  du service de gestion des membres, qui fait maintenant partie de HG, apprend des donn√©es sur les num√©ros internes des comptes du commer√ßant en faveur desquels le paiement est effectu√©, applique le montant des frais, pr√©pare un plan d'affichage et le met dans le service Shumway.  Ce service est responsable de la gestion des informations sur les mouvements d'argent sur les comptes des participants √† une transaction lors d'un paiement.  Le plan de d√©tachement contient l'instruction "de geler les √©ventuels mouvements de fonds sur les comptes des participants √† la transaction sp√©cifi√©e dans le plan"; </li><li>  enrichit les donn√©es de paiement en se r√©f√©rant √† des services suppl√©mentaires, par exemple, dans Binbase afin de conna√Ætre le pays de la banque √©mettrice qui a √©mis la carte et son type, par exemple, ¬´or, cr√©dit¬ª; </li><li>  appelle le service de l'inspecteur, en r√®gle g√©n√©rale, il s'agit d'Antifraud afin de recevoir la notation de paiement et de d√©cider du choix d'un terminal qui couvre le niveau de risque √©mis par la notation.  Par exemple, un terminal sans 3D-Secure peut √™tre utilis√© pour les paiements √† faible risque, et un paiement qui a re√ßu un niveau de risque fatal mettra fin √† sa vie √† ce sujet; </li><li>  appelle le service de d√©tection d'erreurs, le Faultdetector, et sur la base des donn√©es re√ßues, il s√©lectionne la voie de paiement - l'adaptateur de protocole bancaire, qui pr√©sente actuellement le moins d'erreurs et la plus grande probabilit√© de paiement r√©ussi; </li><li>  envoie une demande √† l'adaptateur de protocole bancaire s√©lectionn√©, que ce soit l'adaptateur YellowBank, "autorisez le montant sp√©cifi√© √† partir de ce jeton" dans ce cas. </li></ul></li></ul><br><p>  L'adaptateur de protocole pour le jeton re√ßu va √† CDS, re√ßoit les donn√©es de la carte d√©chiffr√©e, les transf√®re vers un protocole sp√©cifique √† la banque et, en g√©n√©ral, re√ßoit l'autorisation - confirmation de la banque acqu√©reuse que le montant indiqu√© a √©t√© gel√© sur le compte du payeur. </p><br><p>  C'est √† ce moment que vous recevez un SMS avec un message sur le d√©bit des fonds de votre carte de votre banque, bien qu'en fait les fonds n'aient √©t√© gel√©s que sur votre compte. </p><br><p>  L'adaptateur informe HG de l'autorisation r√©ussie, votre code CVV est supprim√© du service CDS et c'est la fin de l'√©tape d'interaction.  La direction revient √† HG. </p><br><p><img src="https://habrastorage.org/webt/jv/mm/cu/jvmmcuhwjxslwo0rvu5w-lsfsyy.jpeg"></p><br><p>  Selon le processus de paiement sp√©cifi√© par l'appel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">createPayment ()</a> par le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">commer√ßant du</a> processus commercial de paiement, HG attend des appels de l'API externe vers la m√©thode de capture d'autorisation, c'est-√†-dire la confirmation du retrait d'argent de votre carte, ou le fait imm√©diatement de lui-m√™me, si le commer√ßant a choisi le sch√©ma paiement en une seule √©tape. </p><br><p>  <em>En r√®gle g√©n√©rale, la plupart des commer√ßants utilisent un paiement en une seule √©tape, mais il existe des cat√©gories d'entreprises qui, au moment de l'autorisation, ne connaissent pas encore le montant total factur√©.</em>  <em>Cela se produit souvent dans l'industrie du tourisme lorsque vous r√©servez une visite pour un montant, et apr√®s confirmation de la r√©servation, le montant est sp√©cifi√© et peut diff√©rer de celui qui √©tait autoris√© au d√©but.</em> </p><br><p>  <em>Malgr√© le fait que le montant de la confirmation peut √™tre exclusivement √©gal ou inf√©rieur au montant de l'autorisation, il y a des √©cueils ici.</em>  <em>Imaginez que vous payez un produit ou un service √† partir d'une carte dans une devise diff√©rente de la devise de votre compte bancaire auquel la carte est li√©e.</em> </p><br><p>  <em>Au moment de l'autorisation, le montant bloqu√© sur votre compte en fonction du taux de change au jour de l'autorisation.</em>  <em>√âtant donn√© que le paiement peut avoir le statut ¬´autoris√©¬ª (malgr√© le fait que le minist√®re des Chemins de fer a des recommandations pour une p√©riode maximale et est maintenant de 3 jours) pendant plusieurs jours, la capture de l'autorisation sera effectu√©e au rythme du jour o√π elle a √©t√© faite.</em> </p><br><p>  <em>Ainsi, vous portez des risques de change, qui peuvent √™tre √† la fois en votre faveur et contre vous, notamment dans une situation de forte volatilit√© sur le march√© des devises.</em> </p><br><p>  Pour capturer l'autorisation, le m√™me processus de communication avec l'adaptateur de protocole se produit que pour la recevoir, et en cas de succ√®s, HG applique le plan de comptabilisation du compte √† l'int√©rieur de Shumway et transf√®re le paiement au statut "Pay√©".  C'est √† ce moment que nous, en tant que syst√®me de paiement, avons des obligations financi√®res envers les participants √† la transaction. </p><br><p>  Il convient √©galement de noter que tout changement dans l'√©tat de la machine √† facture, y compris le processus de paiement, est enregistr√© par Hellgate dans Machinegun, garantissant la persistance des donn√©es et enrichissant la facture avec de nouveaux √©v√©nements. </p><br><h3 id="sinhronizaciya-sostoyaniy-avtomata-platezha-i-ui">  Synchronisation d'√©tat d'une machine de paiement et de l'interface utilisateur </h3><br><p><img src="https://habrastorage.org/webt/o7/hf/iz/o7hfizxfqdiyz_5xlxugdhc_fsq.jpeg"></p><br><p>  Pendant que le processus de paiement en arri√®re-plan se d√©roule √† l'int√©rieur de la plateforme, Checkout verse le traitement en demandant des √©v√©nements.  √Ä la r√©ception de certains √©v√©nements, il dessine l'√©tat actuel du paiement sous une forme compr√©hensible pour une personne - dessine un pr√©chargeur, affiche l'√©cran `` Votre paiement a √©t√© trait√© avec succ√®s '' ou `` Le paiement n'a pas pu √™tre effectu√© '' ou redirige le navigateur vers la page de votre banque √©mettrice pour saisir le mot de passe 3D-Secure; </p><br><p>  En cas d'√©chec, Checkout vous proposera de choisir un autre mode de paiement ou de r√©essayer, commen√ßant ainsi un nouveau paiement dans le cadre de la facture. </p><br><p>  Un tel sch√©ma avec interrogation des √©v√©nements permet de restaurer l'√©tat m√™me apr√®s la fermeture de l'onglet du navigateur - en cas de lancement r√©p√©t√©, Checkout recevra la liste actuelle des √©v√©nements et dessinera le sc√©nario actuel d'interaction avec l'utilisateur, par exemple, sugg√©rera d'entrer le code 3D-Secure ou montrera que le paiement a d√©j√† √©t√© effectu√© avec succ√®s. </p><br><h2 id="replikaciya-sobytiy-v-offline-zone">  R√©plication des √©v√©nements dans la zone hors ligne </h2><br><p><img src="https://habrastorage.org/webt/ay/rm/sb/ayrmsbidsvdz2c9rxxkgge6easo.jpeg"></p><br><p>  Parall√®lement aux interfaces de contr√¥le des machines, Machinegun impl√©mente un service charg√© de faire d√©border le flux d'√©v√©nements vers des services charg√©s d'autres t√¢ches moins en ligne de la plateforme. </p><br><p>  En tant que courtier de file d'attente en finale, nous nous sommes install√©s sur Kafka, bien que nous ayons pr√©c√©demment impl√©ment√© cette fonctionnalit√© en utilisant Machinegun lui-m√™me.  Dans le cas g√©n√©ral, ce service est la pr√©servation d'un flux d'√©v√©nements ordonn√© garanti, ou l'√©mission d'une liste sp√©cifique d'√©v√©nements sur demande √† d'autres consommateurs. </p><br><p>  Nous avons √©galement initialement mis en ≈ìuvre un syst√®me de d√©duplication des √©v√©nements, offrant des garanties que le m√™me √©v√©nement ne serait pas r√©pliqu√© deux fois, cependant, la charge sur Riak, qui a √©t√© g√©n√©r√©e par un similaire, nous a forc√© √† l'abandonner - apr√®s tout, la recherche d'index n'est pas la meilleure chose Capacit√© de stockage KV.  D√©sormais, chaque consommateur de services est responsable de la d√©duplication des √©v√©nements de mani√®re ind√©pendante. </p><br><p>  En g√©n√©ral, la r√©plication des √©v√©nements par Machinegun se termine par la confirmation du stockage des donn√©es dans Kafka, et les consommateurs sont d√©j√† connect√©s aux sujets Kafka et t√©l√©chargent les listes d'√©v√©nements qui les int√©ressent. </p><br><h3 id="shablon-tipichnogo-prilozheniya-offline-zony">  Mod√®le d'application de zone hors ligne typique </h3><br><p>  Par exemple, le service Dudoser est charg√© de vous envoyer une notification par e-mail d'un paiement r√©ussi.  Au d√©marrage, il g√©n√®re une liste d'√©v√©nements de paiements r√©ussis, prend des informations sur l'adresse et le montant √† partir de l√†, l'enregistre dans une instance PostgreSQL locale et l'utilise pour un traitement ult√©rieur de la logique m√©tier. </p><br><p>  Tous les autres services similaires fonctionnent selon la m√™me logique, par exemple le service Magista, qui est charg√© de rechercher les factures et les paiements dans le compte personnel du commer√ßant ou le service Hooker, qui envoie des rappels asynchrones au backend aux commer√ßants qui, pour une raison ou une autre, ne peuvent pas organiser des √©v√©nements de sondage en contactant directement √† l'API de traitement. </p><br><p>  Cette approche nous permet de lib√©rer la charge de traitement, d'allouer des ressources maximales et de fournir une vitesse et une disponibilit√© √©lev√©es du traitement des paiements, offrant une conversion √©lev√©e.  Les requ√™tes lourdes telles que ¬´les clients professionnels veulent voir des statistiques sur les paiements au cours de la derni√®re ann√©e¬ª sont trait√©es par des services qui n'affectent pas la charge actuelle de la partie de traitement en ligne et ne vous affectent donc pas, en tant que payeurs et commer√ßants, en tant que clients. </p><br><p>  Peut-√™tre que nous nous arr√™terons √† cela pour ne pas transformer le message en un trop long.  Dans les prochains articles, je vais certainement vous parler des nuances d'assurer l'atomicit√© des changements, des garanties et de l'ordre dans un syst√®me distribu√© charg√© en utilisant Machinegun, Bender, CAPI et Hellgate comme exemples. </p><br><p>  Eh bien, √† propos de Salt Stack la prochaine fois <code>¬Ø\_(„ÉÑ)_/¬Ø</code> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr447440/">https://habr.com/ru/post/fr447440/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr447426/index.html">Comment, √† qui et pourquoi consulter? Exp√©rience personnelle avec le Big Data</a></li>
<li><a href="../fr447430/index.html">IntelliJ IDEA 2019.1: personnalisation des th√®mes d'interface, passer des expressions √† partir de Java 12, d√©bogage √† l'int√©rieur des conteneurs Docker</a></li>
<li><a href="../fr447434/index.html">Avec amour de Stepik: plateforme √©ducative Hyperskill</a></li>
<li><a href="../fr447436/index.html">Webinaire "Pourquoi avons-nous besoin de testeurs?"</a></li>
<li><a href="../fr447438/index.html">Tests les plus simples et abstraits</a></li>
<li><a href="../fr447442/index.html">Pr√©sentation de l'op√©rateur shell: faciliter encore plus les op√©rateurs pour Kubernetes</a></li>
<li><a href="../fr447446/index.html">Ateliers IBM: printemps-√©t√© 2019 - intelligence artificielle, d√©veloppement cloud, chat bots, blockchain et autres technologies</a></li>
<li><a href="../fr447448/index.html">Evolution de l'intelligence: le d√©but</a></li>
<li><a href="../fr447450/index.html">Briser une simple ¬´fissure¬ª avec Ghidra - Partie 1</a></li>
<li><a href="../fr447452/index.html">S√©curit√© de la cha√Æne d'approvisionnement: "Si j'√©tais un √âtat-nation ..."</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>