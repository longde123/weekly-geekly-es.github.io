<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄºÔ∏è üîè üèïÔ∏è Experiencia en el desarrollo de un activo de Unity para encontrar un camino en el espacio 3D üß° üòÖ ‚ô†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬°Bienvenido al Equipo de Algoritmos Graciosos! 

 Como experimento, decidimos mantener "diarios" de desarrolladores en los que compartiremos experienc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Experiencia en el desarrollo de un activo de Unity para encontrar un camino en el espacio 3D</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450854/">  ¬°Bienvenido al Equipo de Algoritmos Graciosos! <br><br>  Como experimento, decidimos mantener "diarios" de desarrolladores en los que compartiremos experiencias y destacaremos algunos resultados interesantes de nuestros experimentos.  Este es nuestro primer art√≠culo sobre el proyecto "Pathfinder 3D", un activo para el motor del juego Unity, que le permite buscar rutas en un espacio tridimensional.  En √©l, hablaremos sobre el camino desde el origen de la idea hasta un producto completo y sobre algunos de los problemas que encontramos.  Este material ser√° √∫til para las personas que desean comenzar su proyecto y apoyarlo en el futuro, as√≠ como para aquellos que desean implementar una b√∫squeda de un camino en el espacio. <br><a name="habracut"></a><br>  Un equipo de dos personas comenz√≥ a trabajar en el activo.  El primero ten√≠a algunos desarrollos que permit√≠an acelerar el proceso de encontrar el camino m√°s corto en gr√°ficos complejos lo suficiente como para trabajar en tiempo real, y un deseo de encontrar una aplicaci√≥n pr√°ctica para ellos, el segundo ten√≠a algo de experiencia trabajando con Unity y estaba buscando una idea para una startup.  Dado que a menudo se comunicaban entre s√≠, no es sorprendente que en alg√∫n momento surgiera la idea de la posibilidad de crear un activo para buscar un camino en el espacio tridimensional. <br><br>  Al estudiar el cat√°logo de activos de Unity, se encontraron muchas soluciones para encontrar la ruta en un espacio bidimensional, pero no una en tridimensional.  Se hizo evidente que esta era una gran oportunidad para ingresar al mercado de complementos de software de Unity, especialmente teniendo en cuenta la visibilidad y el entretenimiento del resultado esperado. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/g0/mm/slg0mmebuga20hyrv4hiic-j2ho.jpeg"></div><br>  El objetivo era implementar directamente la b√∫squeda de una ruta en el espacio tridimensional y las capacidades t√≠picas de las soluciones existentes para encontrar una ruta en el espacio bidimensional.  Comenzamos a trabajar: uno desarroll√≥ directamente el mecanismo de b√∫squeda de ruta, las segundas clases y m√©todos para administrar el proceso de b√∫squeda de ruta, las interfaces de configuraci√≥n, las escenas de prueba, la documentaci√≥n, el sitio del proyecto, y tambi√©n particip√≥ en el registro y la configuraci√≥n de las cuentas de servicio necesarias para vender el activo. <br><br>  Poco despu√©s del inicio del trabajo, qued√≥ claro que se necesitaba alg√∫n tipo de recurso com√∫n para que el equipo tomara notas: una lista de tareas y problemas que deben resolverse, informaci√≥n sobre las decisiones tomadas, ideas interesantes y resultados de investigaci√≥n en el futuro.  Despu√©s de analizar las soluciones existentes, nos detuvimos en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Trello</a> , debido a su funcionalidad, simplicidad, conveniencia y una apariencia agradable.  Como ha demostrado la pr√°ctica, este servicio es muy conveniente para equipos peque√±os.  Si el equipo tiene m√°s de 5 personas, recomendamos utilizar un sistema de gesti√≥n de proyectos completo. <br><br>  A continuaci√≥n, describimos las decisiones tomadas durante el desarrollo de la primera versi√≥n del activo y la l√≥gica que seguimos al tomarlas.  Las personas que tienen experiencia con Unity y est√°n familiarizadas con los algoritmos de b√∫squeda de rutas comprender√°n de inmediato d√≥nde surgir√°n los problemas en el futuro.  En estos lugares, utilizamos una soluci√≥n simple para reducir el tiempo de desarrollo hasta que se recibi√≥ la primera versi√≥n de trabajo del activo, para no quedar empantanado, porque el entusiasmo es limitado e inconstante.  Por lo tanto, tratamos una de las razones m√°s comunes para cerrar tales startups, debido a que muchos proyectos mueren sin nacer.  Todas las √°reas problem√°ticas se corrigieron despu√©s de la publicaci√≥n del activo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jk/ri/sp/jkrisph5ng_tz1slmdzfttxdoie.gif"></div><br>  Para encontrar la ruta, se eligi√≥ el algoritmo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">A * (una estrella)</a> debido a su alta velocidad de operaci√≥n en grandes espacios abiertos.  La mayor√≠a de los algoritmos de b√∫squeda de ruta funcionan en gr√°ficos representados por una matriz discreta.  Ser√≠a posible construir esta matriz de antemano, pero el proceso de una sola vez de su construcci√≥n en un espacio tridimensional con obst√°culos en ese momento parec√≠a una tarea bastante dif√≠cil.  Adem√°s, no estaba claro c√≥mo hacer esto sin sacrificar el rendimiento, ya que en el momento del comienzo del trabajo en el activo no hab√≠a experiencia con procesos en segundo plano y subprocesos m√∫ltiples en Unity, as√≠ como con subprocesos m√∫ltiples en general.  El gr√°fico se form√≥ en tiempo real sondeando el espacio con rayos f√≠sicos (Physics.BoxCast) en la direcci√≥n de la b√∫squeda.  Las trayectorias encontradas se redujeron a rotas con menos puntos intermedios, y luego se suavizaron mediante splines. <br><br>  La principal dificultad era la imposibilidad de usar los m√©todos f√≠sicos del motor de forma as√≠ncrona, ya que pueden funcionar exclusivamente en el hilo principal.  En escenas no demasiado complejas, el uso de la funci√≥n de b√∫squeda al mismo tiempo por no m√°s de veinte agentes no afect√≥ significativamente la velocidad de fotogramas.  Para deshacerse de las fuertes y raras reducciones de FPS, la carga computacional se espaci√≥ en el tiempo usando corutinas.  Esto ralentiz√≥ la b√∫squeda, pero no significativamente. <br><br>  Antes de enviar un activo para moderaci√≥n, debe ordenar el c√≥digo y redactar documentaci√≥n detallada, de acuerdo con los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">requisitos</a> , registrarse y configurar el correo de soporte.  Tambi√©n es aconsejable crear un sitio web del proyecto donde se muestren convenientemente noticias y demostraciones de desarrollo.  Esta ser√° una gran ventaja tanto durante el paso de la moderaci√≥n, como al estudiar su activo por el usuario antes de comprar.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BeGet</a> nos encarg√≥ los servicios de alojamiento y correo, ya que en ese momento ofrec√≠a las ofertas m√°s ventajosas y nos costaba 1000 r / a√±o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7u/h4/7q/7uh47qdtjz_vkhribjsh19_xcc8.png"></div><br>  La moderaci√≥n de activos dur√≥ 22 d√≠as y pas√≥ la primera vez, ya que abordamos con mucho cuidado la documentaci√≥n y el dise√±o de la p√°gina de activos en la tienda Unity.  Despu√©s de la publicaci√≥n, el activo cay√≥ inmediatamente en el primer lugar en la categor√≠a Scripting / AI.  A partir de ese momento, comenzaron a llegar cartas al correo de soporte pidiendo ayuda para resolver ciertos problemas.  A veces unos pocos por d√≠a, a veces no un mes.  Si usted hace un promedio, entonces durante un mes 2 personas hicieron preguntas, cuya correspondencia tom√≥ un total de 2-3 horas.  No tanto, pero debe tenerse en cuenta que, independientemente de su carga de trabajo actual, debe responder muy r√°pidamente para que los usuarios enojados no escriban malas cr√≠ticas sobre el producto, sino que, por el contrario, entusiasmados con el soporte de calidad, dejen comentarios positivos.  Adem√°s, muchas preguntas llegan al correo como "¬øfuncionar√° su activo si ...".  Dichas cartas tampoco deben ignorarse, ya que este es un comprador potencial que puede irse. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x8/3b/kd/x83bkdcsm3bxsxmeor0yhe8xij0.jpeg"></div><br>  Cuando se recibieron las quejas de los primeros compradores, qued√≥ claro que muchos usuarios usan activos en escenas complejas que tienen la configuraci√≥n de un laberinto u otra cavidad conectada.  En tales proyectos, nuestro esquema de b√∫squeda de ruta, basado en la verificaci√≥n de colisiones, e incluso en la corriente principal, no fue lo suficientemente efectivo.  Por lo tanto, comenzamos a implementar la construcci√≥n temprana del gr√°fico para que fuera posible buscar la ruta en el flujo lateral sin usar la f√≠sica y acceder a los objetos de la escena. <br><br>  La discreci√≥n del espacio tridimensional lo divide en cubos.  El almacenamiento de informaci√≥n sobre todos los cubos de partici√≥n es redundante y requiere mucha memoria.  Por lo tanto, es l√≥gico almacenar solo las coordenadas de las c√©lulas intransitables, lo cual se hizo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2k/kl/5p/2kkl5pn7lgswpe_7bwixkioulpw.jpeg"></div><br>  Los obst√°culos del juego son figuras poligonales y consisten en tri√°ngulos.  Para tener en cuenta los obst√°culos en el gr√°fico de b√∫squeda, debe encontrar todos los cubos de la partici√≥n que se cruzan con cualquier tri√°ngulo de cualquier obst√°culo.  Ya en esta etapa, se estableci√≥ la posibilidad de eliminar din√°micamente y agregar obst√°culos al escenario, y no solo se guardaron las coordenadas de los cubos ocupados, sino tambi√©n los identificadores de los obst√°culos que estaban en ellos.  Ahora es posible construir un gr√°fico de navegaci√≥n antes del inicio del proceso del juego y, debido a la eliminaci√≥n de una gran cantidad de c√°lculos complejos durante la b√∫squeda de una ruta, m√°s de doscientos agentes podr√≠an hacerlo simult√°neamente sin sacrificar el rendimiento. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/6o/yn/bd/6oynbdbckmzfhtzu289blvzhqcu.jpeg"></div><br>  Otro problema conocido por nosotros tambi√©n se hizo sentir: el algoritmo A * y sus modificaciones funcionan extremadamente mal en espacios confinados en gr√°ficos de alta potencia.  Dado que su algoritmo prefiere la direcci√≥n de la ruta hacia el punto objetivo, cualquier punto muerto que conduzca al objetivo ralentiz√≥ en gran medida la b√∫squeda de la ruta, ya que antes de elegir una direcci√≥n diferente de "germinaci√≥n", el algoritmo primero "llena" todo el espacio dentro del callej√≥n sin salida. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ff/ph/is/ffphis2un_0wdpsehrnwra1fiha.gif"></div><br>  En tales situaciones, el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">algoritmo de b√∫squeda de ondas (Algoritmo de Lee)</a> demuestra ser muy efectivo debido al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">menor n√∫mero de operaciones</a> requeridas para "llenar" el espacio.  Por lo tanto, se agreg√≥ al activo como una alternativa.  Al realizar pruebas en un escenario que es un laberinto, el tiempo de b√∫squeda de la ruta se redujo en m√°s de 30 veces. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/eq/lt/nd/eqltndonsivsvukp1t6lhn_awmo.jpeg"></div><br>  Para acelerar el procesamiento preliminar de la escena y encontrar el camino hacia el activo, se agreg√≥ la posibilidad de ejecuci√≥n paralela de procesos, pero la eficiencia del paralelismo fue extremadamente baja, debido al hecho de que cuando se trabaja con un contenedor que almacena las coordenadas de las celdas ocupadas, es necesario sincronizar los flujos, que se realiz√≥ utilizando mutexes, ya que las colecciones competitivas y muchas otras herramientas para garantizar una sincronizaci√≥n eficiente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se implementaron</a> solo en el est√°ndar .NET Framework 4.5, y en Unity, la versi√≥n .NE se utiliz√≥ hasta la versi√≥n 2018.  Marco T 3.5.  Intentamos resolver este problema usando las herramientas disponibles, pero ten√≠an un rendimiento muy mediocre, y solo obtuvimos el resultado deseado despu√©s de cambiar a la versi√≥n Unity 2018.  El uso de colecciones competitivas tambi√©n abri√≥ la posibilidad de realizar el cambio din√°mico de obst√°culos en la escena. <br><br>  En una cierta etapa, comenzaron a surgir desacuerdos en el equipo con respecto a la distribuci√≥n de ganancias, y una tercera persona se uni√≥ al equipo, quien introdujo un sistema para evaluar la inversi√≥n de tiempo de cada miembro del equipo, y tambi√©n comenz√≥ a participar en la inspecci√≥n y prueba del c√≥digo, lo que mejor√≥ significativamente la calidad del producto. <br><br>  El sistema para estimar los costos de tiempo en este momento se realiza en forma de una tabla de Excel y es un sistema automatizado en el que una vez al mes es necesario ingresar informaci√≥n sobre ventas y tareas completadas durante el √∫ltimo mes.  Los miembros del equipo deben evaluar cu√°nto tiempo necesitar√≠an para resolver un problema en particular.  Por lo tanto, al evaluar la complejidad temporal de las tareas, se tiene en cuenta la velocidad de cada participante.  Una sobreestimaci√≥n o subestimaci√≥n anormal por parte de uno de los participantes se hace evidente de inmediato a partir de las estad√≠sticas acumuladas de sus evaluaciones anteriores.  Y, en ausencia de una explicaci√≥n satisfactoria, este tema lo decide todo el equipo.  Este enfoque demostr√≥ ser bueno durante seis meses de uso y permiti√≥ recopilar estad√≠sticas interesantes.  No encontramos una soluci√≥n gratuita ya preparada que ofrezca las caracter√≠sticas descritas.  Por lo tanto, en este momento, para equipos peque√±os, la implementaci√≥n en forma de tablas de Excel nos parece √≥ptima.  Para equipos relativamente grandes, lo m√°s probable es que tenga que dise√±ar su base de datos, desarrollar la parte del servidor y el cliente, o implementar una extensi√≥n para uno de los sistemas de gesti√≥n de proyectos existentes. <br><br>  <strong>Para resumir.</strong>  Ha pasado un a√±o desde el inicio del desarrollo hasta la primera versi√≥n con la funcionalidad m√≠nima necesaria y el rendimiento suficiente para su uso en proyectos reales.  Se pasaron otros seis meses para mejorar el rendimiento e implementar el trabajo de subprocesos m√∫ltiples del activo.  Por el momento, estimamos los costos de tiempo para este proyecto en 1065 horas hombre (esta es una estimaci√≥n bastante optimista), y la ganancia promedio para el mes es de 9.5t.  Es f√°cil calcular que el costo promedio de una hora de trabajo en este momento es de aproximadamente 160 rublos, lo que no es tanto.  Sin embargo, lo principal en este evento es la experiencia adquirida por cada participante.  Incluyendo experiencia en trabajo en equipo y experiencia en soporte de productos de software.  El proyecto puede considerarse exitoso. <br><br>  Ahora nuestro equipo ha comenzado a implementar funcionalidades adicionales √∫tiles: verificaci√≥n de accesibilidad algor√≠tmica;  la capacidad de asignar objetos del juego a portales;  soporte din√°mico de obst√°culos;  Navegaci√≥n local entre agentes para evitar colisiones y planificar rutas locales. <br><br>  Esperamos que este material ayude a alguien a llevar su proyecto a la meta. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450854/">https://habr.com/ru/post/450854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450840/index.html">La √∫ltima linterna est√° cansada o ¬øEl parpadeo salvar√° a Bielorrusia (upd. Spinner?)</a></li>
<li><a href="../450844/index.html">Introducci√≥n a la asignaci√≥n de ejemplos</a></li>
<li><a href="../450846/index.html">Las maravillas del empaque de Microsoft: el kernel de Linux en Windows 10 y el motor IE dentro de Chromium Edge</a></li>
<li><a href="../450848/index.html">Sobre el f√≥sforo amarillo y la naturaleza de p√°nico del hombre</a></li>
<li><a href="../450850/index.html">Hacia un futuro m√°s brillante para compiladores inteligentes</a></li>
<li><a href="../450858/index.html">Reuni√≥n de redes de c√≥digo abierto - ahora en Yandex.Cloud # 3.2019</a></li>
<li><a href="../450860/index.html">Toma inteligente REDMOND SkyPort 100S</a></li>
<li><a href="../450862/index.html">@Pythonetc Abril 2019</a></li>
<li><a href="../450864/index.html">Consejos y trucos de mi canal de Telegram @pythonetc, abril de 2019</a></li>
<li><a href="../450868/index.html">Informes en video de la reuni√≥n de automatizaci√≥n de control de calidad de FunTech</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>