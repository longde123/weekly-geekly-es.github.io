<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>   Ejecute OpenVPN en Docker en 2 segundos   </title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="隆Hola, ciudadanos de Habrovsk! 驴Alguna vez ha encontrado una situaci贸n en la que realmente le gustar铆a viajar virtualmente a otra ciudad, pa铆s o a otr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ejecute OpenVPN en Docker en 2 segundos</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458606/">  隆Hola, ciudadanos de Habrovsk!  驴Alguna vez ha encontrado una situaci贸n en la que realmente le gustar铆a viajar virtualmente a otra ciudad, pa铆s o a otro continente?  Tengo tanta necesidad, por lo que la posibilidad de tener mi propio servidor VPN que se puede iniciar en cualquier lugar en un par de segundos fue bastante aguda. En este art铆culo quiero hablar sobre mi proyecto, que plane茅 cuando estaba buscando una soluci贸n preparada, en este caso, docker una imagen que le permitir铆a elevar r谩pidamente el servidor OpenVPN, con un m铆nimo de configuraciones y un nivel aceptable de seguridad. <p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/118/940/919/11894091908f95b1d8f42980f553fa10.png"></div><p></p><br><a name="habracut"></a><h3>  Antecedentes </h3> La capacidad de ejecutar el servicio en cualquier m谩quina: ya sea un servidor f铆sico, un servidor privado virtual o, en general, el espacio del contenedor dentro de otro sistema de administraci贸n de contenedores, fue fundamental.  Mi mirada cay贸 inmediatamente en el Docker.  En primer lugar, este servicio est谩 ganando popularidad y, por lo tanto, cada vez m谩s proveedores ofrecen soluciones llave en mano con su preinstalaci贸n;  en segundo lugar, hay un repositorio centralizado de im谩genes, desde donde puede descargar e iniciar el servicio con un solo comando en el terminal.  La idea de que tal proyecto ya deber铆a existir, me visit贸 y busqu茅 persistentemente.  Pero, la mayor铆a de los proyectos que encontr茅 eran demasiado engorrosos (era necesario crear un contenedor para el almacenamiento permanente de datos y ejecutar el contenedor varias veces con una aplicaci贸n con diferentes par谩metros), ya sea sin documentaci贸n sensata o completamente abandonado. No encontr茅 nada aceptable, comenc茅 trabaja en tu proyecto.  M谩s adelante hab铆a noches de insomnio estudiando documentaci贸n, escribiendo c贸digo y depurando, pero al final, mi servicio vio la luz y jug贸 en todos los colores del panel LED monocrom谩tico del enrutador.  Entonces, por favor ama y favorece - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Docker-OpenVPN</a> .  Incluso se me ocurri贸 un logotipo (arriba, delante del corte), pero no lo juzgo estrictamente, porque no soy dise帽ador (ya). Cuando implement茅 este proyecto, me concentr茅 en la velocidad de implementaci贸n, un m铆nimo de configuraciones y un nivel aceptable de seguridad.  Por prueba y error, encontr茅 el equilibrio 贸ptimo de estos criterios, sin embargo, en algunos lugares tuve que sacrificar la velocidad de implementaci贸n por seguridad, y tuve que pagar la portabilidad por un m铆nimo de configuraciones: en la configuraci贸n actual, el contenedor una vez creado en un servidor no se puede transferir y ejecutar en otro.  Por ejemplo, todos los certificados de cliente y servidor se generan cuando se inicia el servicio y esto demora aproximadamente 2 segundos.  Sin embargo, la generaci贸n del archivo Defi Hellman tuvo que eliminarse en el tiempo de compilaci贸n: se crea durante la compilaci贸n de la imagen del acoplador y puede durar hasta 10 minutos.  Me gustar铆a recibir una auditor铆a de seguridad de dicha soluci贸n de una comunidad respetada. <h3>  Lanzamiento </h3>  Para comenzar el servicio necesitamos algunas cosas: <ol><li>  Servidor: f铆sico o virtual.  Te贸ricamente, puede ejecutar en modo acoplable en acoplador, pero no he realizado pruebas exhaustivas de esta opci贸n; </li><li>  En realidad, acoplador.  Muchos proveedores de hosting ofrecen soluciones listas para usar con Docker "a bordo"; </li><li>  La direcci贸n IP p煤blica. </li></ol>  Si todos los detalles est谩n en su lugar, nos queda ejecutar el siguiente comando en la consola de su servidor: <pre><code class="bash hljs">docker run --<span class="hljs-built_in"><span class="hljs-built_in">cap</span></span>-add=NET_ADMIN \ -it -p 1194:1194/udp -p 80:8080/tcp \ -e HOST_ADDR=$(curl -s https://api.ipify.org) \ alekslitvinenk/openvpn</code> </pre>  Un lector atento podr铆a prestar atenci贸n al hecho de que la direcci贸n IP del servidor se determina autom谩ticamente mediante <i>ipify.org</i> .  Si por alguna raz贸n esto no funciona, puede especificar la direcci贸n manualmente. Si todos los pasos anteriores se completaron correctamente, deber铆amos ver algo similar en la consola: <pre> <code class="bash hljs">Sun Jun 9 08:56:11 2019 Initialization Sequence Completed Sun Jun 9 08:56:12 2019 Client.ovpn file has been generated Sun Jun 9 08:56:12 2019 Config server started, download your client.ovpn config at http://example.com/ Sun Jun 9 08:56:12 2019 NOTE: After you download you client config, http server will be shut down!</code> </pre>  Estamos cerca del objetivo: ahora tenemos que copiar <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">example.com</a></i> (en su caso, habr谩 la direcci贸n de su servidor) y pegarla en la barra de direcciones del navegador.  Despu茅s de presionar Entrar, el archivo client.ovpn se descargar谩 y el servidor http en s铆 mismo quedar谩 en el olvido.  Si esta soluci贸n est谩 en duda, puede usar el siguiente truco: ejecute el comando anterior y agregue los indicadores y la contrase帽a de <i>zp</i> .  Ahora, si pega el enlace generado en la ventana del navegador, recibir谩 un archivo zip con una contrase帽a. Cuando tenga un archivo con la configuraci贸n del cliente, puede usar cualquier cliente adecuado.  Yo uso Tunnelblick para Mac. <h3>  Video tutorial </h3>  Este video tutorial contiene instrucciones detalladas para implementar el servicio en DigitalOcean. <iframe width="560" height="315" src="https://www.youtube.com/embed/y5Dwakc6hMs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>  <b>PD:</b> si este proyecto le resulta 煤til, dele un asterisco en GitHub, bifurque y d铆gaselo a sus amigos.  Los colaboradores y las auditor铆as de seguridad tambi茅n son ampliamente bienvenidos.  <b>PPS</b> Si este art铆culo trata sobre Habr, entonces planeo escribir lo siguiente sobre c贸mo lanc茅 docker-in-docker y docker-in-docker-in-docker, por lo que hice y lo que sali贸 de 茅l. <br>  <b>EDITAR1:</b> <ol><li>  Errores corregidos en la publicaci贸n, </li><li>  En respuesta a los comentarios, decid铆 poner esta informaci贸n aqu铆: - se necesita una marca de privilegio para trabajar con iptables </li></ol><br>  <b>EDIT2:</b> <ol><li>  Comando de lanzamiento de imagen mejorado: ahora no requiere el indicador --privileged </li><li>  Se agreg贸 un enlace a la gu铆a de video en ruso: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">youtu.be/A8zvrHsT9A0</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/458606/">https://habr.com/ru/post/458606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458596/index.html">Petty little joy # 6: OpenAI Gym - juega juegos y controla robots</a></li>
<li><a href="../458598/index.html">Reconocimiento de fuentes de luz en mapas ambientales.</a></li>
<li><a href="../458600/index.html">驴Qu茅 son las bicicletas el茅ctricas (revisi贸n grupal en dos partes de cinco modelos de dos fabricantes), parte 1</a></li>
<li><a href="../458602/index.html">C贸mo atravesamos el Gran Cortafuegos chino (Parte 1)</a></li>
<li><a href="../458604/index.html">驴Por qu茅 los dos mayores fabricantes de productos electr贸nicos unieron fuerzas en un nuevo proyecto de GPU?</a></li>
<li><a href="../458608/index.html">Herramientas de desarrollo de Node.js Cola de trabajo</a></li>
<li><a href="../458612/index.html">Cosmos 7 a帽os</a></li>
<li><a href="../458614/index.html">Crear un enlace Reactivo UsePosition () para obtener y rastrear las coordenadas del navegador</a></li>
<li><a href="../458622/index.html">Automatizaci贸n para los m谩s peque帽os. Primera parte (que es despu茅s de cero). Virtualizaci贸n de red</a></li>
<li><a href="../458624/index.html">C贸mo aprendimos a dibujar textos en lienzo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>