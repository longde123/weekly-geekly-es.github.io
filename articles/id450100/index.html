<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïØÔ∏è ‚ô£Ô∏è ü§ΩüèΩ Pembuatan kode untuk backend. Apa yang dihasilkan, bagaimana dan mengapa? üìâ üßíüèæ üìÉ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini saya ingin menunjukkan bagaimana kode backend (dan sedikit front-end) dihasilkan di perusahaan kami, mengapa diperlukan sama sekali d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pembuatan kode untuk backend. Apa yang dihasilkan, bagaimana dan mengapa?</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450100/"> Pada artikel ini saya ingin menunjukkan bagaimana kode backend (dan sedikit front-end) dihasilkan di perusahaan kami, mengapa diperlukan sama sekali dan bagaimana melakukannya dengan lebih baik. <br><br>  Apa yang akan kita hasilkan sebenarnya tidak begitu penting. <br>  Adalah penting bahwa kita menggambarkan 3 jenis objek berdasarkan yang kita akan menghasilkan interaksi frontend dengan backend, dan di beberapa tempat implementasi backend akan sepenuhnya <br><br>  Jenis-jenis objek: <br>  1. <i>Pesan</i> - objek yang, bersambung dalam JSON, berpartisipasi dalam pertukaran informasi antara frontend dan backend <br>  2. <i>Endpoint</i> - URI yang memanggil front-end bersama dengan deskripsi metode HTTP, parameter permintaan, tipe Badan Permintaan, dan tipe responden <br>  3. <i>Entitas</i> - Ini adalah pesan yang memiliki titik akhir standar untuk Buat / Perbarui / Daftar / Hapus (mungkin tidak semua), mereka disimpan dalam database dan bagi mereka ada Objek Akses Data, atau repositori Spring JPA - umumnya tergantung pada teknologi, tetapi semacam akses ke database <br><br>  Saya tidak melakukan front-end sama sekali, tetapi <br>  1) Saya tahu bahwa ini ditulis dalam naskah, jadi kami juga menghasilkan kelas naskah <br>  2) Sebagian besar persyaratan backend berasal dari pengembang frontend. <br><br><h3>  Persyaratan kode </h3><br><br><a name="habracut"></a>  Jadi, apa saja persyaratan dari ujung depan? <br><br>  1. Antarmuka interaksi seperti REST <br>  2. Respons yang monoton - json, muatan di bidang 'data' <br>  3. Kesalahan monoton jika pengecualian terjadi pada backend, disarankan juga menambahkan stack trace <br>  4. Kode HTTP "benar" - 404 jika buku tidak ditemukan, 400 jika permintaannya buruk (katakanlah, json tidak valid), dll. <br><br>  Saya akan menambahkan persyaratan ke kode backend "sendiri": <br>  1. Kesalahan penanganan di satu tempat <br>  2. Kemampuan untuk menghentikan aliran di mana saja dalam kode dan mengembalikan kode HTTP yang diinginkan <br>  3. Saya ingin menulis beberapa logika bisnis sebagai pemblokiran, dan beberapa sebagai asinkron, tergantung pada perpustakaan yang digunakan.  Tetapi semua ini harus bekerja dalam satu kerangka asinkron <br>  4. Dianjurkan agar pengembang backend tidak memikirkan permintaan dan tanggapan HTTP, tentang rute Vertx dan bass acara, tetapi cukup tulis logika bisnis mereka. <br><br>  Dianjurkan untuk menerapkan semua persyaratan di atas dengan pewarisan dan komposisi, dan hanya jika gagal, gunakan pembuatan kode <br><br>  Juga disarankan untuk membuat kelas secara paralel untuk typscript dan kotlin sehingga frontend selalu mengirimkan backend apa yang dibutuhkan (dan tidak bergantung pada pengembang sehingga mereka tidak akan lupa menambahkan bidang baru ke kelas) <br><br><h3>  Apa yang akan kita hasilkan </h3><br><br>  Misalnya, ambil aplikasi web hipotetis yang dapat menyimpan dan mengedit buku, menampilkan daftar mereka dan mencari berdasarkan nama. <br><br>  Dalam hal teknologi, backend Kotlin, Vert.x, coroutine.  Sesuatu seperti apa yang saya perlihatkan dalam artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">‚ÄúTiga Paradigma Pemrograman Asinkron di Vertx‚Äù</a> <br><br>  Untuk membuatnya lebih menarik, kami akan membuat akses ke database berdasarkan Spring Data JPA. <br>  Saya tidak mengatakan bahwa Anda perlu mencampur Spring dan Vert.x dalam satu proyek (walaupun saya melakukannya sendiri, saya akui), tetapi saya hanya mengambil Spring karena paling mudah baginya untuk menunjukkan generasi berdasarkan Entitas. <br><br><h3>  Struktur proyek dengan generasi </h3><br><cut></cut><br>  Sekarang Anda perlu membuat proyek untuk generasi. <br>  Kami akan memiliki banyak proyek gradle.  Sekarang saya akan membuatnya dalam satu repositori git, tetapi dalam kehidupan nyata setiap orang harus duduk di tempatnya sendiri, karena mereka akan berubah pada waktu yang berbeda, mereka akan memiliki versinya sendiri. <br><br>  Jadi, proyek pertama adalah proyek dengan anotasi yang akan menunjukkan router kami, metode HTTP, dll.  Sebut saja <i>metainfo</i> <br>  Dua proyek lain bergantung padanya: <br>  <i>codegen</i> dan <i>api</i> <br><br>  <i>Api</i> berisi deskripsi router dan pesan - kelas-kelas yang akan bolak-balik antara backend dan frontend <br>  <i>codegen</i> adalah proyek pembuatan kode (tetapi bukan proyek di mana kode dihasilkan!) - ini berisi kumpulan informasi dari kelas <i>api</i> dan generator kode aktual. <br>  Generator akan menerima semua detail dari generasi dalam argumen - dari paket mana untuk mengambil deskripsi router, ke direktori mana untuk menghasilkan, apa nama templat Velocity untuk generasi - yaitu.  <i>metainfo</i> dan <i>codegen</i> umumnya dapat digunakan dalam proyek yang sama sekali berbeda <br><br>  Nah, dua proyek di mana generasi sebenarnya akan dilakukan: <br>  <i>frontend-generate</i> di mana kita akan menghasilkan kelas Filescript yang sesuai dengan pesan kotlin kita <br>  dan <i>backend</i> - dengan aplikasi Vertx yang sebenarnya. <br><br>  Agar satu proyek dapat "melihat" hasil kompilasi yang lain, kami akan menggunakan plugin untuk menerbitkan artefak ke repositori Maven lokal. <br><br>  <b>Proyek <i>Metafinfo</i></b> : <br><br>  Anotasi yang dengannya kami akan menandai sumber generasi - deskripsi endpoins, pesan, entitas: <br><pre><code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">/* Contains a number of endpoints. We will generate Vert.x router or Spring MVC controller from it*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EndpointController</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url:String) <span class="hljs-comment"><span class="hljs-comment">/* Endpoint inside a controller. Concrete URI and HTTP method. May be has query param */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Endpoint</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: HttpMethodName, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> param: String = <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-comment"><span class="hljs-comment">/* For empty constructor generation */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmptyConstructorMessage</span></span></span><span class="hljs-class"> /* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Make</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abstract</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endpoint</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">logic</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">asynchronous</span></span></span><span class="hljs-class"> */ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsyncHandler</span></span></span><span class="hljs-class"> /* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">All</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">next</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotations</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">are</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">for</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entities</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">only</span></span></span><span class="hljs-class">:</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">*/ annotation class GenerateCreate annotation class GenerateUpdate annotation class GenerateGetById annotation class GenerateList annotation class GenerateDelete /* Make CRUD implementation abstract</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">so that we will override it*/ annotation class AbstractImplementation /* Generate search by this field in DAO layer */ annotation class FindBy /* This entity is child of another entity</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">so generate end point like /parent/$id/child to bring all children of concrete parent instead of /child - bring all entities of this type */ annotation class ChildOf</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">vararg</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parents: KClass&lt;*&gt;) <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HttpMethodName</span></span></span><span class="hljs-class"> </span></span>{ POST,PUT,GET,DELETE }</code> </pre> <br>  Untuk kelas naskah, kami akan mendefinisikan anotasi yang dapat digantung di bidang dan yang akan jatuh ke dalam kelas naskah yang dihasilkan <br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">annotation</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsString</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsEmail</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IsBoolean</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">annotation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MaxLength</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> len:<span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>)</code> </pre><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode sumber proyek metainfo</a> <br><br>  <b>Proyek <i>api</i> :</b> <br><br>  Perhatikan plugin noArg dan jpa di build.gradle untuk menghasilkan konstruktor tanpa argumen <br><br>  Saya tidak punya cukup fantasi, jadi kami akan membuat beberapa deskripsi gila tentang pengontrol dan Entitas untuk aplikasi kami: <br><br><pre> <code class="kotlin hljs"><span class="hljs-meta"><span class="hljs-meta">@EndpointController(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/util"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SearchRouter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Endpoint(HttpMethodName.GET, param = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(id: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: String <span class="hljs-meta"><span class="hljs-meta">@Endpoint(method = HttpMethodName.POST)</span></span> <span class="hljs-meta"><span class="hljs-meta">@AsyncHandler</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(searchRequest: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">SearchRequest</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// we have no check or response type } data class SearchRequest( @field:IsString val author: String?, @field:IsEmail val someEmail: String, @field:IsString val title: String? ) @GenerateList @GenerateGetById @GenerateUpdate @Entity @AbstractImplementation data class Book( @Id @GeneratedValue(strategy = GenerationType.IDENTITY) var id: Long?, @field:IsBoolean @Column(name = "is_deleted") var hardcover: Boolean, @field:IsString @field:MaxLength(128) @Column(nullable = false, length = 128) val title: String, @field:IsString @field:MaxLength(128) @Column(nullable = false, length = 255) val author: String ) @GenerateList @GenerateGetById @GenerateUpdate @GenerateDelete @GenerateCreate @Entity @ChildOf(Book::class) data class Chapter( @Id @GeneratedValue(strategy = GenerationType.IDENTITY) var id: Long?, @Column(nullable = false, name = "book_id") var bookId: Long?, @field:IsString @field:MaxLength(128) @Column(nullable = false, length = 128) @field:FindBy val name: String, @Column(nullable = false) val page:Int )</span></span></code> </pre> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode sumber proyek api</a> <br><br>  <b>Proyek <i>Codegen</i> :</b> <br><br>  Pertama kita mendefinisikan "deskriptor" - kelas-kelas yang akan kita isi dengan melalui refleksi pada proyek api kita: <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EndPoint</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> input: String?, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> param: String?, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> output: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> method: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> handler: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> asyncHandler: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Router</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endpoints: List&lt;EndPoint&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span></span>( name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> parents: List&lt;String&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> abstractVerticle: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> crudFeatures: CrudFeatures, fields: List&lt;Field&gt;, <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> children: List&lt;Entity&gt; ) : Message(name, fields) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGenerateRouterAndVerticle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> crudFeatures.generateRouterAndVerticle() } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Entity(parents=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$parents</span></span></span><span class="hljs-string">, abstractVerticle=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$abstractVerticle</span></span></span><span class="hljs-string">, crudFeatures=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$crudFeatures</span></span></span><span class="hljs-string">, children=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$children</span></span></span><span class="hljs-string">)"</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudFeatures</span></span></span></span>( <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> list: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> create: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> update: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> delete: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> ) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateRouterAndVerticle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list || create || update || delete || <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } } <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> fields: List&lt;Field&gt;) <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Field</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> type: String, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> validators: List&lt;Annotation&gt;, <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> findBy: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>)</code> </pre><br><br>  Kode yang mengumpulkan informasi terlihat seperti ini: <br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntitiesCreator</span></span></span></span>(typeMapper: TypeMapper, frontendAnnoPackage:String) { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> messagesDescriptor = MessagesCreator(typeMapper, frontendAnnoPackage) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEntities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entitiesPackage: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Entity&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reflections = Reflections(entitiesPackage, SubTypesScanner(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types = reflections.getSubTypesOf(Object::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> </span></span>{ createEntity(it) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEntityRestEndpoints</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(entity: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Entity</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;EndPoint&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name = entity.name <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> url = name.toLowerCase() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endpoints: MutableList&lt;EndPoint&gt; = mutableListOf() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.create) { endpoints.add( EndPoint(url, name, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, name, <span class="hljs-string"><span class="hljs-string">"post"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleNew</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>) { endpoints.add( EndPoint( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$url</span></span></span><span class="hljs-string">/:id"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, name, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleGet</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.update) { endpoints.add( EndPoint(url, name, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, name, <span class="hljs-string"><span class="hljs-string">"put"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleUpdate</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.delete) { endpoints.add( EndPoint( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$url</span></span></span><span class="hljs-string">/:id"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"delete"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleDelete</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.crudFeatures.list) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entity.parents.isEmpty()) { endpoints.add( EndPoint( url, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"List&lt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleGetAllFor</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } } entity.children.forEach { endpoints.add( EndPoint( <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$url</span></span></span><span class="hljs-string">/:id/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.name.toLowerCase()}</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"id"</span></span>, <span class="hljs-string"><span class="hljs-string">"List&lt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"get"</span></span>, <span class="hljs-string"><span class="hljs-string">"handleGet</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${it.name}</span></span></span><span class="hljs-string">For</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$name</span></span></span><span class="hljs-string">"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span> ) ) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> endpoints } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEntity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: Entity { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Entity( aClass.simpleName, getParents(aClass), isVerticleAbstract(aClass), shouldGenerateCrud(aClass), messagesDescriptor.createFields(aClass), listOf() ) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isVerticleAbstract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aClass.getDeclaredAnnotation(AbstractImplementation::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getParents</span></span></span></span>(aClass: Class&lt;*&gt;): List&lt;String&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aClass.getDeclaredAnnotation(ChildOf::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">)?.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">parents</span></span></span><span class="hljs-class">?.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">map</span></span></span><span class="hljs-class"> </span></span>{ it.simpleName }?.requireNoNulls() ?: listOf() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">shouldGenerateCrud</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: CrudFeatures { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> listAnno = aClass.getDeclaredAnnotation(GenerateList::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateCreate::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateGetById::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateUpdate::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleteAnno</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">aClass</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getDeclaredAnnotation</span></span></span></span>(GenerateDelete::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CrudFeatures</span></span></span></span>( list = listAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, create = createAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, update = updateAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, delete = deleteAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> = getAnno != <span class="hljs-literal"><span class="hljs-literal">null</span></span> ) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessagesCreator</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> typeMapper: TypeMapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> frontendAnnotationsPackageName: String) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMessages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(packageName: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: List&lt;Message&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reflections = Reflections(packageName, SubTypesScanner(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reflections.allTypes.map { Class.forName(it) }.map { createMessages(it) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createMessages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: Message { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Message(aClass.simpleName, createFields(aClass)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: List&lt;Field&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ReflectionUtils.getAllFields(aClass).map { createField(it) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createField</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(field: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">java</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">lang</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">reflect</span></span></span></span><span class="hljs-function"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Field</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: Field { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> annotations = field.declaredAnnotations <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Field( field.name, typeMapper.map(field.type), createConstraints(annotations), annotations.map { anno -&gt; anno::annotationClass.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>() }.contains(FindBy::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) ) } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">createConstraints</span></span></span></span>(annotations: Array&lt;<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> Annotation&gt;): List&lt;Annotation&gt; { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> annotations.filter { it.toString().startsWith(<span class="hljs-string"><span class="hljs-string">"@</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$frontendAnnotationsPackageName</span></span></span><span class="hljs-string">"</span></span>) } } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RoutersCreator</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> typeMapper: TypeMapper, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> endpointsPackage:String ) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRouters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: List&lt;Router&gt; { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> reflections = Reflections(endpointsPackage, SubTypesScanner(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reflections.allTypes.map { createRouter( Class.forName( it ) ) } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRouter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: Router { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Router(aClass.simpleName, getUrl(aClass), ReflectionUtils.getAllMethods(aClass).map { createEndpoint(it) }) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUrl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(aClass: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Class</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;*&gt;)</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> aClass.getAnnotation(EndpointController::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getEndPointMethodName</span></span></span></span>(declaredAnnotation: Endpoint?): String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> httpMethodName = declaredAnnotation?.method <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (httpMethodName ?: HttpMethodName.GET).name.toLowerCase() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getParamName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(declaredAnnotation: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Endpoint</span></span></span></span><span class="hljs-function"><span class="hljs-params">?)</span></span></span></span>: String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> paramName = declaredAnnotation?.param <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (paramName ?: <span class="hljs-string"><span class="hljs-string">"id"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEndpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Method</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: EndPoint { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> types = method.parameterTypes <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> declaredAnnotation: Endpoint? = method.getDeclaredAnnotation(Endpoint::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">methodName</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getEndPointMethodName</span></span></span></span>(declaredAnnotation) <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = method.name <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> input: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> param: String? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> hasInput = types.isNotEmpty() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> handlerName = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$methodName</span></span></span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${StringUtils.capitalize(url)}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasInput) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inputType = types[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inputTypeName = typeMapper.map(inputType) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> createUrlParameterName = inputType == java.lang.String::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">if</span></span></span><span class="hljs-class"> </span></span>(createUrlParameterName) { param = getParamName(declaredAnnotation) url += <span class="hljs-string"><span class="hljs-string">"/:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$param</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { input = simpleName(inputTypeName) } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> EndPoint( url, input, param, method.returnType.toString(), methodName, handlerName, isHandlerAsync(method) ) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isHandlerAsync</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Method</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> declaredAnnotation: AsyncHandler? = method.getDeclaredAnnotation(AsyncHandler::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">declaredAnnotation</span></span></span><span class="hljs-class"> != </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">null</span></span></span><span class="hljs-class"> } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">simpleName</span></span></span></span>(name: String): String { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> index = name.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) name.substring(index + <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> name } }</code> </pre><br><br>  Yah, ada juga kelas "utama" yang menerima argumen - paket mana yang harus direfleksikan, yang digunakan templat Velocity, dll. <br>  Mereka tidak begitu tertarik, Anda dapat melihat segala sesuatu di repositori: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kode sumber</a> <br><br>  <b>Dalam proyek yang <i>dihasilkan frontend</i> dan <i>backend</i> ,</b> kami melakukan hal serupa: <br>  1. ketergantungan pada <i>api</i> pada waktu kompilasi <br>  2. ketergantungan pada <i>codegen</i> pada tahap build <br>  3. Templat generasi terletak di direktori <i>buildSrc di</i> mana file dan kode dibutuhkan secara bertahap, yang diperlukan pada tahap build, tetapi tidak pada tahap kompilasi atau runtime.  Yaitu  kita dapat mengubah pola pembuatan tanpa mengkompilasi ulang proyek <i>codegen</i> <br>  4. <i>frontend-generate</i> mengkompilasi Script yang dihasilkan dan menerbitkannya ke repositori paket npm <br>  5. Di <i>backend</i> , router dihasilkan yang mewarisi dari router abstrak yang tidak dibuat yang tahu bagaimana menangani berbagai jenis permintaan.  Abstrak Verticle juga dihasilkan yang harus diwariskan dengan implementasi logika bisnis itu sendiri.  Selain itu, segala macam hal kecil dihasilkan yang saya sebagai programmer tidak ingin pikirkan - mendaftarkan codec dan alamat konstanta di bass acara. <br>  Kode sumber yang <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dihasilkan frontend</a></i> dan <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">backend</a></i> <br><br>  Di <i>frontend-generate,</i> Anda perlu memperhatikan plugin yang menerbitkan sumber yang dihasilkan di repositori npm.  Agar ini berfungsi, Anda perlu memasukkan IP repositori Anda di build.gradle dan memasukkan token otentikasi Anda ke .npmrc <br><br>  Kelas yang dihasilkan terlihat seperti ini: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { IsString, MaxLength, IsDate, IsArray, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'class-validator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Type } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'class-transformer'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Entity(parents=[], abstractVerticle=false, crudFeatures=CrudFeatures(list=true, create=true, update=true, delete=true, get=true), children=[]) export class Chapter { // Field(name=bookId, type=number, validators=[], findBy=false) bookId!: number; @IsString() @MaxLength(128) // Field(name=name, type=string, validators=[@com.valapay.test.annotations.frontend.IsString(), @com.valapay.test.annotations.frontend.MaxLength(len=128)], findBy=false) name!: string; // Field(name=id, type=number, validators=[], findBy=false) id!: number; // Field(name=page, type=number, validators=[], findBy=false) page!: number; }</span></span></code> </pre><br><br>  Perhatikan anotasi validator kelas tc. <br><br>  Di proyek backend, repositori untuk Spring Data JPA juga dihasilkan, dimungkinkan untuk mengatakan bahwa proyek pemrosesan pesan di Verticle memblokir (dan dijalankan melalui Vertx.executeBlocking) atau asynchronous (dengan coroutine), dimungkinkan untuk mengatakan bahwa Vertikel yang dihasilkan untuk Entitas adalah abstrak dan kemudian ada kemungkinan menimpa kait yang dipanggil sebelum dan sesudah memanggil metode yang dihasilkan.  Penyebaran vertikular otomatis pada antarmuka kacang pegas - yah, singkatnya, banyak barang. <br><br>  Dan semua ini mudah diperluas - misalnya, menggantung daftar peran pada Endpoint dan menghasilkan pemeriksaan peran pengguna yang masuk saat memanggil titik akhir dan banyak lagi - itu cukup untuk itu. <br><br>  Ini juga mudah untuk menghasilkan bukan Vertx, bukan Spring, tetapi sesuatu yang lain - bahkan akka-http, cukup untuk hanya mengubah template di proyek backend. <br><br>  Arah pengembangan lain yang mungkin adalah menghasilkan lebih banyak front-end. <br><br>  Semua kode sumber ada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Terima kasih kepada Ildar dari front-end untuk bantuan dalam menciptakan generasi dalam proyek kami dan dalam menulis artikel <br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id450100/">https://habr.com/ru/post/id450100/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id450090/index.html">Berita dari dunia OpenStreetMap No. 457 (04.16.2019-22.04.2019)</a></li>
<li><a href="../id450092/index.html">Apa itu apa dan siapa siapa di pasar perlindungan DDoS</a></li>
<li><a href="../id450094/index.html">Kopi surya: meningkatkan efisiensi sel surya akibat kafein</a></li>
<li><a href="../id450096/index.html">Toilet kucing otomatis</a></li>
<li><a href="../id450098/index.html">Yuri Bushmelev "Rake peta pada bidang pengumpulan dan pengiriman log" - transkrip laporan</a></li>
<li><a href="../id450102/index.html">Arloji menyesuaikan diri dengan tampilan elektronik</a></li>
<li><a href="../id450104/index.html">Sangat sulit dan sangat menarik: Komunitas TI di TechTrain</a></li>
<li><a href="../id450106/index.html">Proyek organisasi konstruksi dan rekonstruksi dalam kondisi sempit di lokasi Konstruksi SPDS</a></li>
<li><a href="../id450110/index.html">Paten desain: bagian dua (contoh dari Microsoft, Snapchat, Samsung, Netflix, Airbnb, Tinder)</a></li>
<li><a href="../id450112/index.html">Eh, apa yang terjadi dengan kopernya ?! Pada contoh skuter-koper anak-anak ZINC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>