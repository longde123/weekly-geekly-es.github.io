<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕺🏾 👨🏿‍💻 🏷️ Toute la vérité sur RTOS. Article # 17. Groupes de drapeaux d'événements: introduction et services de base 🕔 🚝 👩🏽‍🤝‍👨🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Des groupes de drapeaux d'événements ont déjà été mentionnés précédemment dans l'un des articles précédents (# 5). Dans Nucleus SE, ils sont similaire...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toute la vérité sur RTOS. Article # 17. Groupes de drapeaux d'événements: introduction et services de base</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428131/"><img src="https://habrastorage.org/webt/y6/hx/yw/y6hxyww0r_cp5m_lr0uspctzgqk.jpeg"><br><br>  Des groupes de drapeaux d'événements ont déjà été mentionnés précédemment dans l'un des articles précédents (# 5).  Dans Nucleus SE, ils sont similaires aux signaux, mais sont plus flexibles.  Ils offrent un moyen peu coûteux et flexible de transférer des messages simples entre les tâches. <br><a name="habracut"></a><br><br>  Articles précédents de la série: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 16.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Signaux</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 15.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Partitions de mémoire: services et structures de données</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 14.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sections de mémoire: introduction et services de base</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 13.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Structures de données de tâche et appels d'API non pris en charge</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 12.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Services pour travailler avec des tâches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 11.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches: configuration et introduction à l'API</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 10.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: fonctionnalités avancées et préservation du contexte</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 9.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Scheduler: implémentation</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 8.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: conception interne et déploiement</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 7.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nucleus SE: Introduction</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 6.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autres services RTOS</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 5.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Interaction et synchronisation des tâches</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 4.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches, changement de contexte et interruptions</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 3.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tâches et planification</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 2.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: Structure et mode temps réel</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Article # 1.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RTOS: introduction.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><br></a> <br><br><h2>  Utilisation de drapeaux d'événements </h2><br>  Dans Nucleus SE, les indicateurs d'événement sont définis pendant la phase de génération.  Le nombre maximal de groupes d'indicateurs d'événements dans l'application est de 16. Si les groupes d'indicateurs d'événements ne sont pas définis, le code lié aux structures de données et aux appels de service des groupes d'indicateurs d'événements ne sera pas inclus dans l'application. <br><br>  Groupe de drapeaux d'événements - un ensemble de drapeaux de huit bits, dont l'accès est réglementé afin que plusieurs tâches puissent utiliser en toute sécurité un drapeau.  Une tâche peut définir ou effacer toute combinaison de drapeaux d'événements.  Une autre tâche consiste à lire un groupe de drapeaux à tout moment, et il peut également attendre une certaine séquence de drapeaux (par sondage ou avec une pause). <br><br><h2>  Configuration des groupes d'indicateurs d'événements </h2><br><h3>  Nombre de groupes d'indicateurs d'événements </h3><br>  Comme pour la plupart des objets Nucleus SE, la configuration des groupes d'indicateurs d'événements est spécifiée par les directives <b>#define</b> dans <b>nuse_config.h</b> .  Le paramètre principal est <b>NUSE_EVENT_GROUP_NUMBER</b> , qui détermine le nombre de groupes d'indicateurs d'événements qui seront définis dans l'application.  Par défaut, ce paramètre est défini sur 0 (c'est-à-dire que les groupes d'indicateurs d'événements ne sont pas utilisés) et peut avoir n'importe quelle valeur jusqu'à 16. Une valeur incorrecte entraînera une erreur de compilation, qui sera générée en <b>archivant nuse_config_check.h</b> (elle est activée par <b>nuse_config.c</b> , ce qui signifie qu'il compile avec ce module), par conséquent, la directive <b>#error</b> fonctionnera.  La sélection d'une valeur différente de zéro est le principal activateur des groupes de drapeaux d'événements.  Ce paramètre est utilisé lors de la définition des structures de données et leur taille dépend de sa valeur (plus d'informations à ce sujet dans les articles suivants).  De plus, une valeur différente de zéro active les paramètres de l'API. <br><br><h3>  Activer les appels API </h3><br>  Chaque fonction API (appel d'utilitaire) dans Nucleus SE est activée par la directive <b>#define</b> dans <b>nuse_config.h</b> .  Pour les groupes de drapeaux d'événements, ceux-ci incluent: <br> <code>NUSE_EVENT_GROUP_SET <br> NUSE_EVENT_GROUP_RETRIEVE <br> NUSE_EVENT_GROUP_INFORMATION <br> NUSE_EVENT_GROUP_COUNT <br></code> <br>  Par défaut, ils sont définis sur <b>FALSE</b> , désactivant ainsi chaque appel de service et bloquant l'inclusion de code qui les implémente.  Pour configurer des groupes d'indicateurs d'événements, vous devez sélectionner les appels d'API nécessaires et définir les directives correspondantes sur <b>TRUE</b> . <br><br>  Ce qui suit est un extrait du fichier nuse_config.h par défaut. <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_EVENT_GROUP_NUMBER 0 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Number of event groups in the system - 0-16 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_EVENT_GROUP_SET FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_EVENT_GROUP_RETRIEVE FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_EVENT_GROUP_INFORMATION FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUSE_EVENT_GROUP_COUNT FALSE </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Service call enabler */</span></span></span></span></code> </pre><br>  Une fonction API activée s'il n'y a pas de groupes d'indicateurs d'événements dans l'application entraînera une erreur de compilation (sauf pour <b>NUSE_Event_Group_Count ()</b> , qui est toujours activé).  Si votre code utilise un appel d'API qui n'a pas été activé, une erreur de mise en page se produira car le code d'implémentation n'a pas été inclus dans l'application. <br><br><h2>  Appels de l'utilitaire d'appel d'événement </h2><br>  Nucleus RTOS prend en charge sept appels d'utilitaires qui offrent les fonctionnalités suivantes: <br><br><ul><li>  Définissez des drapeaux d'événements.  Nucleus SE est implémenté dans la fonction <b>NUSE_Event_Group_Set ()</b> . </li><li>  Lecture des drapeaux d'événements.  Dans Nucleus SE, implémenté dans <b>NUSE_Event_Group_Retrieve ()</b> . </li><li>  Fournir des informations sur un groupe spécifique d'indicateurs d'événements.  Dans Nucleus SE, implémenté dans <b>NUSE_Event_Group_Information ()</b> . </li><li>  Renvoie le nombre de groupes d'indicateurs d'événements actuellement configurés dans l'application.  Dans Nucleus SE, implémenté dans <b>NUSE_Event_Group_Count ()</b> . </li><li>  Ajout d'un nouveau groupe d'indicateurs d'événements à l'application.  Nucleus SE n'est pas implémenté. </li><li>  Suppression d'un groupe d'indicateurs d'événements de l'application.  Nucleus SE n'est pas implémenté. </li><li>  Renvoyer des pointeurs vers tous les groupes d'indicateurs d'événements dans l'application.  Nucleus SE n'est pas implémenté. </li></ul><br>  La mise en œuvre de chacun de ces appels de surcharge est discutée en détail ci-dessous. <br><br>  Il convient de noter qu'il n'y a pas de fonction de réinitialisation dans Nucleus RTOS ou Nucleus SE.  Cela se fait intentionnellement.  La fonction de réinitialisation implique la prévalence de l'état spécial des drapeaux.  Pour les groupes de drapeaux d'événements, le seul état «spécial» est de réinitialiser tous les drapeaux, ce qui peut être fait en utilisant <b>NUSE_Event_Group_Set ()</b> . <br><br><h2>  Appels de service pour la définition et la lecture de groupes d'indicateurs d'événements </h2><br>  Les opérations fondamentales qui peuvent être effectuées sur un groupe d'indicateurs d'événements sont la définition de la valeur d'un ou plusieurs indicateurs, ainsi que la lecture des valeurs d'indicateurs actuelles.  Nucleus RTOS et Nucleus SE fournissent quatre appels d'API de base pour ces opérations. <br><br>  Étant donné que les drapeaux d'événements sont des bits, ils sont mieux visualisés sous forme de nombres binaires.  Étant donné que la norme C n'a historiquement pas pris en charge la représentation des constantes binaires (uniquement octales et hexadécimales), Nucleus SE possède un fichier d'en-tête utile <b>nuse_binary.h</b> qui contient des caractères <b>#define</b> comme <b>b01010101</b> pour les 256 valeurs 8 bits. <br><br><h3>  Définir des indicateurs d'événement </h3><br>  L'appel de l'utilitaire Nucleus RTOS API pour le marquage est très flexible et vous permet de définir et d'effacer des valeurs de drapeau à l'aide d'opérations <b>ET</b> et <b>OU</b> .  Nucleus SE offre des fonctionnalités similaires, mais la pause de tâche est facultative. <br><br>  <b><i>Appel à définir des indicateurs dans Nucleus RTOS</i></b> <br>  Prototype d'appel de service: <br><br>  <b>STATUS NU_Set_Events (groupe NU_EVENT_GROUP *, UNSIGNED event_flags, opération OPTION);</b> <br><br>  Paramètres: <br><br>  <b>group</b> - un pointeur vers un bloc de contrôle fourni par l'utilisateur pour un groupe de drapeaux d'événements; <br>  <b>event_flags</b> - valeur du masque de bits du groupe de drapeaux; <br>  <b>operation</b> - l' <b>opération à</b> effectuer, <b>NU_OR</b> (pour définir les indicateurs) ou <b>NU_AND</b> (pour effacer les indicateurs). <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_INVALID_GROUP</b> - pointeur non valide vers un groupe de drapeaux d'événements; <br>  <b>NU_INVALID_OPERATION</b> - L'opération spécifiée est différente de <b>NU_OR</b> et <b>NU_AND</b> . <br><br>  <b><i>Appel à définir des drapeaux dans Nucleus SE</i></b> <br>  Cet appel d'API prend en charge la fonctionnalité principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NUSE_Event_Group_Set (groupe NUSE_EVENT_GROUP, U8 event_flags, opération OPTION);</b> <br><br>  Paramètres: <br><br>  <b>group</b> - l'index (ID) du groupe d'événements dont les indicateurs sont définis / effacés; <br>  <b>event_flags</b> - valeur du bit maxi d'un groupe de drapeaux; <br>  <b>operation</b> - l' <b>opération à</b> effectuer, <b>NUSE_OR</b> (pour définir les drapeaux) ou <b>NUSE_AND</b> (pour effacer les drapeaux). <br><br>  Valeur de retour: <br><br>  <b>NUSE_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NUSE_INVALID_GROUP</b> - index non valide d'un groupe de drapeaux d'événements; <br>  <b>NUSE_INVALID_OPERATION</b> - L'opération spécifiée est différente de <b>NUSE_OR</b> et <b>NUSE_AND</b> . <br><br>  <b><i>Implémentation de l'installation de drapeaux d'événements dans Nucleus SE</i></b> <br>  Le code initial de la fonction d'API <b>NUSE_Event_Group_Set ()</b> est général (après vérification des paramètres), que l'API prenne en charge les appels de blocage (suspendre les tâches) ou non.  La logique est assez simple: <br><br><pre> <code class="hljs powershell">NUSE_CS_Enter(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (operation == NUSE_OR) { NUSE_Event_Group_Data[<span class="hljs-type"><span class="hljs-type">group</span></span>] |= event_flags; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> /* NUSE_AND */ { NUSE_Event_Group_Data[<span class="hljs-type"><span class="hljs-type">group</span></span>] &amp;= event_flags; }</code> </pre> <br>  Le <b>masque de bits event_flags est</b> superposé (à l'aide de l'opération <b>AND</b> ou <b>OR</b> ) sur la valeur du groupe sélectionné de drapeaux d'événements. <br><br>  Le code restant n'est activé que lorsque le verrouillage des tâches est activé: <br><br><pre> <code class="hljs mel">#<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NUSE_BLOCKING_ENABLE <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (NUSE_Event_Group_Blocking_Count[<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { U8 index; <span class="hljs-comment"><span class="hljs-comment">/* check whether any tasks are blocked */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* on this event group */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index=<span class="hljs-number"><span class="hljs-number">0</span></span>; index&lt;NUSE_TASK_NUMBER; index++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((LONIB(NUSE_Task_Status[index]) == NUSE_EVENT_SUSPEND) &amp;&amp; (HINIB(NUSE_Task_Status[index]) == <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>)) { NUSE_Task_Blocking_Return[index] = NUSE_SUCCESS; NUSE_Task_Status[index] = NUSE_READY; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } NUSE_Event_Group_Blocking_Count[<span class="hljs-keyword"><span class="hljs-keyword">group</span></span>]--; } #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> NUSE_SCHEDULER_TYPE == NUSE_PRIORITY_SCHEDULER NUSE_Reschedule(NUSE_NO_TASK); #endif #endif NUSE_CS_Exit(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NUSE_SUCCESS;</code> </pre> <br>  Si des tâches sont suspendues (pour lecture) à partir de ce groupe d'indicateurs, elles reprennent.  Lorsqu'ils ont la possibilité de poursuivre l'exécution (cela dépend de l'ordonnanceur), ils peuvent déterminer si les conditions de leur reprise sont remplies ou non (voir lecture des drapeaux d'événements). <br><br><h3>  Lecture des drapeaux d'événements </h3><br>  Les appels à la lecture de l'utilitaire Nucleus RTOS API sont très flexibles et vous permettent de suspendre les tâches indéfiniment ou avec un délai d'expiration spécifique si l'opération ne peut pas être terminée immédiatement (par exemple, si vous essayez de lire une séquence spécifique d'indicateurs d'événements qui ne représente pas l'état actuel).  Nucleus SE offre les mêmes fonctionnalités, seule la pause de tâche est facultative et le délai d'attente n'est pas implémenté. <br><br>  <b><i>Défi des drapeaux dans Nucleus RTOS</i></b> <br>  Prototype d'appel de service: <br><br>  <b>STATUS NU_Retrieve_Events (groupe NU_EVENT_GROUP *, UNSIGNED required_events, opération OPTION, UNSIGNED * retrieved_events, UNSIGNED suspend);</b> <br><br>  Paramètres: <br><br>  <b>group</b> - un pointeur vers un bloc de contrôle fourni par l'utilisateur pour un groupe de drapeaux d'événements; <br>  <b>required_events</b> - un masque de bits qui définit les drapeaux à lire; <br>  <b>opération</b> - quatre <b>opérations</b> sont disponibles: <b>NU_AND</b> , <b>NU_AND_CONSUME</b> , <b>NU_OR</b> et <b>NU_OR_CONSUME</b> .  Les opérations <b>NU_AND</b> et <b>NU_AND_CONSUME</b> indiquent que tous les indicateurs demandés sont requis.  Les opérations <b>NU_OR</b> et <b>NU_OR_CONSUME</b> indiquent qu'un ou plusieurs des fanions demandés sont suffisants.  Le paramètre <b>CONSUME</b> efface automatiquement les indicateurs existants après une requête réussie; <br>  <b>retrieved_events</b> - pointeur de stockage pour les valeurs des drapeaux d'événements lus; <br>  <b>suspend</b> - spécification pour <b>suspendre</b> les tâches;  peut prendre les valeurs <b>NU_NO_SUSPEND</b> ou <b>NU_SUSPEND</b> , ou la valeur de timeout en ticks du temporisateur système (de 1 à 4 294 967 293). <br><br>  Valeur de retour: <br><br>  <b>NU_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NU_NOT_PRESENT</b> - l'opération spécifiée n'a pas renvoyé d'événements (pas un seul événement dans le cas de NU_OR et pas tous les événements dans le cas de NU_AND); <br>  <b>NU_INVALID_GROUP</b> - pointeur non valide vers un groupe de drapeaux d'événements; <br>  <b>NU_INVALID_OPERATION</b> - l'opération spécifiée était incorrecte; <br>  <b>NU_INVALID_POINTER</b> - pointeur nul vers le magasin de drapeaux d'événements (NULL); <br>  <b>NU_INVALID_SUSPEND</b> - tentative de pause à partir d'un thread non lié à une tâche; <br>  <b>NU_TIMEOUT</b> - la combinaison requise de drapeaux d'événements n'a pas été définie même après le délai spécifié; <br>  <b>NU_GROUP_DELETED</b> - le groupe d'indicateurs d'événements a été supprimé alors que la tâche était suspendue. <br><br>  <b><i>Défi des drapeaux dans Nucleus SE</i></b> <br>  Cet appel d'API prend en charge la fonctionnalité principale de l'API Nucleus RTOS. <br><br>  Prototype d'appel de service: <br><br>  <b>STATUS NUSE_Event_Group_Retrieve (groupe NUSE_EVENT_GROUP, U8 request_events, opération OPTION, U8 * retrieved_events, U8 suspend);</b> <br><br>  Paramètres: <br><br>  <b>groupe</b> - index (ID) du groupe lu d'indicateurs d'événement; <br>  <b>required_events</b> - un masque de bits qui définit les drapeaux à lire; <br>  <b>opération</b> - une spécification indiquant le nombre de drapeaux nécessaires: <b>NUSE OR</b> (certains drapeaux) ou <b>NUSE AND</b> (tous les drapeaux); <br>  <b>retrieved_events</b> - un pointeur vers le magasin pour les valeurs réelles des drapeaux d'événements lus (avec l'opération <b>NUSE_AND,</b> ce sera le même que celui transmis dans le paramètre <b>required_events</b> ); <br>  <b>suspend</b> - spécification pour <b>suspendre</b> la tâche, peut prendre les valeurs <b>NUSE_NO_SUSPEND</b> ou <b>NUSE_SUSPEND</b> . <br><br>  Valeur de retour: <br><br>  <b>NUSE_SUCCESS</b> - l'appel s'est terminé avec succès; <br>  <b>NUSE_NOT_PRESENT</b> - l'opération spécifiée n'a pas renvoyé d'événements (pas un seul événement dans le cas de <b>NUSE_OR</b> et pas tous les événements dans le cas de <b>NUSE_AND</b> ); <br>  <b>NUSE_INVALID_GROUP</b> - index non valide d'un groupe de drapeaux d'événements; <br>  <b>NUSE_INVALID_OPERATION</b> - l'opération spécifiée est différente de <b>NUSE_OR</b> ou <b>NUSE_AND</b> ; <br>  <b>NUSE_INVALID_POINTER</b> - un pointeur nul vers le magasin de drapeaux d'événements lus ( <b>NULL</b> ); <br>  <b>NUSE_INVALID_SUSPEND</b> - une tentative de pause à partir d'un flux non-tâche ou lorsque la prise en charge du blocage des appels d'API est désactivée. <br><br>  <b><i>Implémentation de la lecture des drapeaux d'événements dans Nucleus SE</i></b> <br>  La version du code de fonction API <b>NUSE_Event_Group_Retrieve ()</b> (après vérification des paramètres) est sélectionnée lors de la compilation conditionnelle selon que la prise en charge des appels API pour bloquer (suspendre) les tâches est activée ou non.  Examinons ces deux options séparément. <br><br>  Si le verrou est désactivé, le code complet de cet appel API ressemblera à ceci: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">temp_events</span></span> = NUSE_Event_Group_Data[group] &amp; requested_events; <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (operation == NUSE_OR) { <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (temp_events != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-attribute"><span class="hljs-attribute">return_value</span></span> = NUSE_SUCCESS; } <span class="hljs-section"><span class="hljs-section">else</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">return_value</span></span> = NUSE_NOT_PRESENT; } } <span class="hljs-attribute"><span class="hljs-attribute">else</span></span> /* operation == NUSE_AND */ { <span class="hljs-attribute"><span class="hljs-attribute">if</span></span> (temp_events == requested_events) { <span class="hljs-attribute"><span class="hljs-attribute">return_value</span></span> = NUSE_SUCCESS; } <span class="hljs-section"><span class="hljs-section">else</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">return_value</span></span> = NUSE_NOT_PRESENT; } }</code> </pre><br>  Les indicateurs d'événement requis sont sélectionnés dans le groupe d'indicateurs d'événement spécifié.  La valeur est comparée aux événements requis, en tenant compte de l'opération <b>ET / OU</b> , ainsi que du résultat renvoyé et des valeurs immédiates des drapeaux demandés. <br><br>  Si le verrouillage des tâches est activé, le code devient plus complexe: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { temp_events = NUSE_Event_Group_Data[group] &amp; requested_events; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (operation == NUSE_OR) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (temp_events != <span class="hljs-number"><span class="hljs-number">0</span></span>) { return_value = NUSE_SUCCESS; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { return_value = NUSE_NOT_PRESENT; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-comment"><span class="hljs-comment">/* operation == NUSE_AND */</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (temp_events == requested_events) { return_value = NUSE_SUCCESS; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { return_value = NUSE_NOT_PRESENT; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (return_value == NUSE_SUCCESS) { <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> = NUSE_NO_SUSPEND; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> == NUSE_SUSPEND) <span class="hljs-comment"><span class="hljs-comment">/* block task */</span></span> { NUSE_Event_Group_Blocking_Count[group]++; NUSE_Suspend_Task(NUSE_Task_Active, (group &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) | NUSE_EVENT_SUSPEND); return_value = NUSE_Task_Blocking_Return[NUSE_Task_Active]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (return_value != NUSE_SUCCESS) { <span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> = NUSE_NO_SUSPEND; } } } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">suspend</span></span> == NUSE_SUSPEND);</code> </pre><br>  Le code est placé dans une <b>boucle do ... while</b> , qui fonctionne lorsque le paramètre <b>suspend</b> est <b>NUSE_SUSPEND</b> . <br><br>  Les drapeaux d'événements demandés sont lus comme s'ils étaient appelés sans blocage.  Si la lecture <b>échoue</b> et que le paramètre de <b>suspension</b> est <b>NUSE_NO_SUSPEND</b> , l'appel d'API est défini sur <b>NUSE_NOT_PRESENT</b> .  Si le paramètre <b>suspend a</b> été défini sur <b>NUSE_SUSPEND</b> , la tâche se met en pause.  Lors du retour (lorsque la tâche reprend), si la valeur de retour est <b>NUSE_SUCCESS</b> , indiquant que la tâche a été reprise car les indicateurs d'événement de ce groupe ont été définis ou effacés, le cycle recommence depuis le début, les indicateurs sont lus et vérifiés.  Puisqu'il n'y a pas de fonction API pour réinitialiser les groupes d'indicateurs d'événements, c'est la seule raison pour que la tâche reprenne, mais le processus de vérification <b>NUSE_Task_Blocking_Return []</b> a été laissé sur le système pour la compatibilité du contrôle de verrouillage avec d'autres types d'objets. <br><br>  L'article suivant décrit les appels d'API supplémentaires associés aux groupes d'indicateurs d'événements, ainsi que leurs structures de données. <br><br>  <b>À propos de l'auteur:</b> Colin Walls travaille dans l'industrie électronique depuis plus de trente ans, consacrant la majeure partie de son temps au micrologiciel.  Il est maintenant ingénieur firmware chez Mentor Embedded (une division de Mentor Graphics).  Colin Walls intervient souvent lors de conférences et séminaires, auteur de nombreux articles techniques et de deux livres sur le firmware.  Vit au Royaume-Uni.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Blog</a> professionnel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de Colin</a> , e-mail: colin_walls@mentor.com. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428131/">https://habr.com/ru/post/fr428131/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428121/index.html">Stan Drapkin. Pièges de cryptographie de haut niveau dans .NET</a></li>
<li><a href="../fr428123/index.html">Semaine de la sécurité 41: Bonne nouvelle</a></li>
<li><a href="../fr428125/index.html">Qui sont les analyses de produits et pourquoi sont-elles nécessaires dans une équipe?</a></li>
<li><a href="../fr428127/index.html">Cache Nginx: tout nouveau - vieux bien oublié</a></li>
<li><a href="../fr428129/index.html">Une logique floue simple collée «de ce qui était» pour un moteur à turbine à gaz</a></li>
<li><a href="../fr428133/index.html">Hasura. Architecture GraphQL à SQL Server haute performance</a></li>
<li><a href="../fr428135/index.html">Comment configurer ou désactiver les peluches dans l'éditeur de code intégré</a></li>
<li><a href="../fr428137/index.html">Olympiade, concours d'idées, conférences sur la gestion de projets informatiques et projections de films: 10 événements à venir à l'Université ITMO</a></li>
<li><a href="../fr428141/index.html">Le backend pour le frontend, ou comment Yandex.Market crée une API sans béquilles</a></li>
<li><a href="../fr428143/index.html">Approche de mise en œuvre de ReactJS RBAC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>