<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèø‚Äç‚úàÔ∏è ü•£ üìπ Precarga en php 7.4: Compositor y selecci√≥n de archivos para precarga üçè üå™Ô∏è ‚ö†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En Badoo estamos haciendo una transici√≥n activa a PHP 7.4 y estamos muy entusiasmados con la oportunidad de usar la nueva funci√≥n de precarga. No hace...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Precarga en php 7.4: Compositor y selecci√≥n de archivos para precarga</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/badoo/blog/480746/">  En Badoo estamos haciendo una transici√≥n activa a PHP 7.4 y estamos muy entusiasmados con la oportunidad de usar la nueva funci√≥n de precarga.  No hace mucho tiempo <a href="https://habr.com/ru/company/badoo/blog/472528/">hablamos</a> de nuestros experimentos con ella. <br><br>  Aparentemente, la comunidad est√° tan emocionada como nosotros.  Los desarrolladores de framework est√°n <a href="https://github.com/laravel/ideas/issues/1406">discutiendo</a> activamente <a href="https://github.com/laravel/ideas/issues/1406">la</a> posibilidad de introducir una precarga (y algunos ya han <a href="https://symfony.com/blog/new-in-symfony-4-4-preloading-symfony-applications-in-php-7-4">hecho su apoyo</a> ).  Ahora es el turno del administrador de dependencias de Composer. <br><br><img src="https://habrastorage.org/webt/t2/b9/bm/t2b9bmzxxtkxl00vu23lyoqwnd4.png"><br><br>  <a href="https://medium.com/%40DarkGhostHunter">Italo Baeza</a> escribi√≥ <a href="https://medium.com/swlh/composer-how-it-should-preload-in-php-7-4-3f8d19fda40">un art√≠culo</a> en el que expres√≥ su opini√≥n sobre c√≥mo Composer deber√≠a trabajar con la precarga.  Decid√≠ compartir una traducci√≥n de este texto, y al mismo tiempo una traducci√≥n de <a href="https://medium.com/swlh/preloading-your-php-7-4-project-in-one-line-9ede756f292c">su otro art√≠culo</a> , sobre c√≥mo los propios desarrolladores de Composer respondieron a la propuesta, as√≠ como sobre una nueva herramienta que facilita el trabajo con la precarga. <br><a name="habracut"></a><br><h2>  C√≥mo Composer deber√≠a precargarse en PHP 7.4 </h2><br>  La precarga es una de las caracter√≠sticas importantes que PHP 7.4 ofrece a los desarrolladores que necesitan un mejor rendimiento.  Esta funci√≥n se puede llamar "calentamiento" antes de implementar el motor JIT, que aparecer√° (o deber√≠a aparecer) en PHP 8. Antes de eso, la carga previa ser√° suficiente, y qui√©n sabe, tal vez puedan trabajar en conjunto. <br><br>  La funci√≥n de precarga se explica en <a href="https://stitcher.io/blog/preloading-in-php-74">este art√≠culo</a> .  La conclusi√≥n es muy simple: php.ini especifica un script PHP para el cual, cuando se inicia el proceso, los archivos se cargan en la memoria (precarga).  En combinaci√≥n con OPCache y la funci√≥n de autocargador <a href="https://medium.com/tech-tajawal/php-composer-the-autoloader-d676a2f103aa">, los</a> archivos Composer tambi√©n se pueden compilar y vincular una vez, despu√©s de lo cual estar√°n disponibles para todas las solicitudes posteriores.  Gracias a esto, PHP no necesita descargar y compilar archivos con cada solicitud. <br><br>  Sin embargo, los desarrolladores de Composer no han acordado c√≥mo deber√≠a ayudar a la precarga, adem√°s de proporcionar funciones de inicio.  Los hechos son los siguientes: <br><br><ul><li>  la precarga se anunci√≥ por primera vez en PHP 7.4; <br></li><li>  no existe una directiva Composer para ayudar a precargar archivos; <br></li><li>  para la precarga, necesita acceso a php.ini, es decir, al proceso en s√≠; <br></li><li>  precargar todos los archivos no necesariamente mejorar√° el rendimiento en comparaci√≥n con precargar solo los archivos m√°s solicitados. <br></li></ul><br>  En otras palabras, solo aquellos que tienen acceso total a los servidores pueden usar la precarga.  Esto excluye los servidores compartidos y algunas soluciones PaaS que no implican trabajar con php.ini. <br><br>  Entonces, ¬øc√≥mo puede Composer ayudar a la precarga dado que esto es una innovaci√≥n?  Aqu√≠ est√° mi opini√≥n. <br><br><h2>  C√≥mo deber√≠a funcionar la precarga </h2><br>  El mecanismo de precarga debe basarse en una lista de archivos que se cargar√°n y almacenar√°n en la memoria al inicio.  Y como se trata de una lista, debemos trabajar con una variedad de archivos y dejar que Composer haga todo el trabajo, en lugar de <i>cargar</i> cada archivo manualmente. <br><br>  Composer debe tomar la lista de archivos especificados por la aplicaci√≥n (el proyecto ra√≠z) y compilar todo en archivos que PHP pueda usar sin ninguna dificultad. <br>  Al mismo tiempo, necesitamos la capacidad de agregar y eliminar paquetes del mecanismo de precarga. <br>  La precarga nunca deber√≠a funcionar a nivel de paquete, ya que es responsabilidad del desarrollador habilitar o deshabilitar la precarga de cada paquete. <br><br>  La precarga en Composer debe ser opcional.  El desarrollador debe poder deshabilitarlo para que PHP use su propio precargador, que puede funcionar sobre la base del an√°lisis OPCache; depende de la carga de la aplicaci√≥n y funciona de manera mucho m√°s eficiente que simplemente precargar todos los archivos. <br><br><h3>  Todo comienza en preload.json </h3><br>  Para no complicar el sistema, coloque el archivo preload.json en la ra√≠z del proyecto.  Enumerar√° los archivos de precarga que Composer puede seleccionar.  Como se trata de un archivo JSON, el desarrollador puede incluso generarlo con la ayuda de un comando especial.  Creo que ser√≠a genial si Composer tuviera una utilidad para crear un archivo JSON basado en scripts. <br><br><pre><code class="php hljs">{ <span class="hljs-string"><span class="hljs-string">"pre-compile"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"my-script.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"my-other-script.php"</span></span> ], <span class="hljs-string"><span class="hljs-string">"extensions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"php"</span></span> ], <span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"app/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"config/"</span></span>, <span class="hljs-string"><span class="hljs-string">"helpers.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"app/Models/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"app/Controllers/*/Http/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"app/Views/Compiled*.php"</span></span> ], <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"App\\Models"</span></span>, <span class="hljs-string"><span class="hljs-string">"App\\Controllers\\"</span></span>, <span class="hljs-string"><span class="hljs-string">"App\\Views\\MainView"</span></span>, <span class="hljs-string"><span class="hljs-string">"Vendor\\Package\\*"</span></span>, ], <span class="hljs-string"><span class="hljs-string">"packages"</span></span>: { <span class="hljs-string"><span class="hljs-string">"symfony/http-client"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"robert/*-client"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"vendor/package"</span></span>: { <span class="hljs-string"><span class="hljs-string">"files"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }, <span class="hljs-string"><span class="hljs-string">"foo/bar"</span></span>: { <span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"helpers.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"loaders/*"</span></span> ], <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Foo\\Bar\\DynamicLoaders\\*"</span></span>, <span class="hljs-string"><span class="hljs-string">"Foo\\Bar\\Clients"</span></span> ] } }, <span class="hljs-string"><span class="hljs-string">"output"</span></span>: <span class="hljs-string"><span class="hljs-string">"preload-compiled.php"</span></span> }</code> </pre> <br>  El uso de preload.json le permite verificar r√°pidamente si la precarga est√° incluida en el proyecto: si falta el archivo, la precarga no es compatible o no es deseable. <br><br>  Veamos qu√© hacen las llaves. <br><br>  <b>precompilar</b> <br><br>  Estos archivos ser√°n ejecutados por Composer.  Cada secuencia de comandos debe devolver una matriz de rutas de archivos absolutas para agregarlas a la lista de precarga, que desempe√±ar√° el papel de la lista principal. <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"pre-compile"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"my-script.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"my-other-script.php"</span></span> ]</code> </pre><br>  Estos archivos se ejecutar√°n en el orden especificado. <br><br>  El objetivo es que el desarrollador cree una lista de archivos como mejor le parezca, en lugar de confiar en un solo archivo JSON.  Estos archivos se ejecutar√°n en primer lugar.  Y s√≠, solo puede implementar preload.json con esta clave.  Como estamos hablando de archivos PHP, al compilar una matriz, incluso puede agregar otros archivos. <br><br>  <b>extensiones</b> <br><br>  Esta es una lista de extensiones de archivo que deben precargarse.  Por defecto, solo se toman los archivos con la extensi√≥n php. <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"extensions"</span></span>: [<span class="hljs-string"><span class="hljs-string">"php"</span></span>, <span class="hljs-string"><span class="hljs-string">"php5"</span></span>, <span class="hljs-string"><span class="hljs-string">"php7"</span></span>]</code> </pre> <br>  Por ejemplo, puede agregar un directorio lleno de archivos * .phtml, incluidos algunos archivos PHP √∫tiles, y Composer los seleccionar√° solo a ellos, y no a todo el contenido del directorio. <br>  Como comprender√°, este proceso se puede reemplazar agregando archivos manualmente. <br><br>  <b>archivos</b> <br><br>  Esta clave le dice a Composer que descargue todos los archivos de la lista cuyas rutas son relativas a la ubicaci√≥n de composer.json. <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"files"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"helpers.php"</span></span>, <span class="hljs-string"><span class="hljs-string">"app/Models/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"app/Controllers/*/Http/*"</span></span>, <span class="hljs-string"><span class="hljs-string">"app/Views/Compiled*.php"</span></span>, ]</code> </pre><br>  Encontrar la lista es f√°cil: <br><br><ul><li>  use rutas relativas para agregar archivos y directorios; <br></li><li>  de los directorios solo se agregar√°n archivos secundarios almacenados en ellos (no de forma recursiva); <br></li><li>  las rutas recursivas se indican con un asterisco que termina (*); <br></li><li>  usando este s√≠mbolo tambi√©n puede, por ejemplo, agregar ciertos archivos y directorios: <code>src/Clients/*/Stores</code> o <code>src/Model*.php</code> . <br></li></ul><br>  Agregar archivos por m√°scara sin seleccionar o crear scripts espec√≠ficos de la aplicaci√≥n es especialmente √∫til cuando se desarrollan aplicaciones grandes. <br><br>  Si solo necesita precargar todos los archivos con <a href="">la clave de carga autom√°tica</a> en el archivo JSON de Composer, config√∫relo como <code>true</code> . <br><br>  <b>espacio de nombres</b> <br><br>  Esta clave le dice a Composer que cargue archivos con un espacio de nombres o nombre de clase dado, como un <code>file</code> o <code>directory</code> .  El mismo mecanismo le permite llamar din√°micamente nombres de espacio desde otros paquetes instalados. <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"namespaces"</span></span>: [   <span class="hljs-string"><span class="hljs-string">"App\\Models"</span></span>,   <span class="hljs-string"><span class="hljs-string">"App\\Controllers\\"</span></span>,   <span class="hljs-string"><span class="hljs-string">"App\\Views\\MainView"</span></span>,   <span class="hljs-string"><span class="hljs-string">"Vendor\\Package\\*"</span></span>, ]</code> </pre> <br>  Esto tambi√©n es conveniente cuando se trabaja en aplicaciones grandes que dependen m√°s de espacios de nombres, en lugar de archivos que pueden cambiar en cualquier momento.  Composer extraer√° autom√°ticamente los archivos de acuerdo con el espacio de nombres y los colocar√° en una lista. <br><br>  <b>paquetes</b> <br><br>  Esta clave le permite cargar otros archivos registrados desde paquetes externos, como archivos auxiliares o clases asociadas con un espacio de nombres. <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"packages"</span></span>: {   <span class="hljs-string"><span class="hljs-string">"symfony/http-client"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,   <span class="hljs-string"><span class="hljs-string">"robert/*-client"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,   <span class="hljs-string"><span class="hljs-string">"vendor/package"</span></span>: {       <span class="hljs-string"><span class="hljs-string">"files"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,       <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>   },   <span class="hljs-string"><span class="hljs-string">"foo/bar"</span></span>: {       <span class="hljs-string"><span class="hljs-string">"files"</span></span>: {           <span class="hljs-string"><span class="hljs-string">"helpers.php"</span></span>,           <span class="hljs-string"><span class="hljs-string">"loaders/*"</span></span>       },       <span class="hljs-string"><span class="hljs-string">"namespace"</span></span>: [           <span class="hljs-string"><span class="hljs-string">"Foo\\Bar\\DynamicLoaders\\*"</span></span>,           <span class="hljs-string"><span class="hljs-string">"Foo\\Bar\\Clients"</span></span>       ]   } }</code> </pre> <br>  Aqu√≠ todo es muy simple: si el valor es verdadero, se cargar√° todo el contenido <a href="">de la clave de carga autom√°tica</a> en el archivo composer.json de este paquete.  De lo contrario, puede controlar m√°s finamente la adici√≥n de precarga. <br><br>  Si el valor de la clave es verdadero, descargar√° todos los archivos registrados en la <code>autoload</code> .  El valor predeterminado es <code>false</code> .  Esto tambi√©n es cierto para la clave de <code>namespace</code> . <br><br>  Tambi√©n puede seleccionar archivos individuales o espacios de nombres con esta regla.  Pero en este caso, la clave de <code>autoload</code> no se utilizar√°. <br><br>  <b>salida</b> <br><br>  Este es simplemente el nombre del archivo de lista de precarga compilado. <br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">"output"</span></span>: <span class="hljs-string"><span class="hljs-string">"preload-compiled.php"</span></span></code> </pre> <br><h3>  F√°cil montaje </h3><br>  Nuestra lista de precarga est√° lista, y podemos llamar a Composer para compilar el script de precarga principal. <br><br><pre> <code class="php hljs">composer preload</code> </pre> <br>  Como resultado, preload-compiled.php se crear√° con todos los archivos que PHP debe precargar.  Por supuesto, puede cambiar el nombre del archivo como lo desee. <br><br>  Tambi√©n debe anular las teclas de <code>preload</code> par√°metros. <br><br><pre> <code class="php hljs">composer preload \   --input=my-custom-preload-<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.json \   --output=my-preload.php</code> </pre> <br><h3>  Deshabilitado por defecto </h3><br>  Los proyectos sin preload.json devolver√°n un error si intentas compilar un archivo para precargarlo.  La raz√≥n es que Composer no adivinar√° (y no deber√≠a) adivinar qu√© debe precargarse. <br><br>  Perm√≠tame recordarle que la precarga no interfiere con la funcionalidad normal de Composer.  Como se trata de un comando de consola, con desarrollo local, puede abandonar por completo la precarga.  Lo √∫nico que necesita el mecanismo de precarga de Composer es un archivo de carga autom√°tica, que debe generarse si falta.  Bueno, despu√©s de todo, casi el a√±o 2020 est√° en el patio, PSR-4 se usa en todas partes, ¬øverdad? <br><br><h3>  Resultado </h3><br>  Deber√≠as obtener un archivo php con algo como esto: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * Preloading </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@generated</span></span></span><span class="hljs-comment"> by Composer */</span></span> <span class="hljs-comment"><span class="hljs-comment">// Autoload the classes so those can be preloaded using `require_once`. require_once __DIR__.'/../autoload.php'; // File list $files = [ '/var/www/app/Foo.php', '/var/www/app/Bar.php', '/var/www/helpers/basic.php', '/var/www/helpers/advanced.php', '/var/www/vendor/Foo/Bar/src/Class.php', '/var/www/vendor/Foo/Bar/helpers/helpers.php', '/var/www/vendor/Foo/Bar/config.php', // ... ]; // Preload all root project files foreach ($files as $file) { require_once $file; }</span></span></code> </pre> <br>  De hecho, esta es solo una lista de archivos que se cargar√°n previamente usando la funci√≥n de autocargador en Composer.  PHP ejecutar√° este archivo una vez, y se convertir√° en historia. <br><hr><br>  Espero sinceramente que Composer tenga alguna forma de precargar archivos sin tener que escribir un truco. <br><br>  Dado que el m√©todo descrito anteriormente no es parte del n√∫cleo Composer, a√∫n puede seleccionar los archivos m√°s importantes para la precarga en funci√≥n del an√°lisis OPCache sin tocar los menos necesarios.  Imagine que en lugar de precargar 1.500 archivos con una capacidad de 100 MB, puede descargar solo 150 archivos con una capacidad de 10 MB, mientras mantiene el 99% del rendimiento original. <br><br><h2>  Precargamos el proyecto PHP 7.4 en una l√≠nea </h2><br>  Poco despu√©s de escribir un art√≠culo sobre c√≥mo Composer puede ayudarlo a precargar un proyecto, <a href="https://github.com/Seldaek">Seldaek</a> (miembro del equipo de desarrollo de Composer) <a href="https://github.com/composer/composer/issues/7777">elimin√≥ toda esperanza de</a> que Composer tuviera una opci√≥n f√°cil de precargar el proyecto en el proceso PHP desde el administrador de paquetes. <br><br><blockquote>  (...) Explicar√©: estoy seguro de que en el futuro cercano no agregaremos nada relacionado con la precarga en Composer. </blockquote><br>  Por qu√©  La precarga en PHP es m√°s un problema de desarrollo (en lugar de una dependencia); se resuelve editando manualmente php.ini: solo los desarrolladores pueden hacerlo si ellos mismos administran PHP. <br><br>  Pero esto no me impide crear mi propio paquete para precargar el proyecto.  Y tu tambien. <br><br><h2>  Precarga y m√©tricas </h2><br>  La precarga puede ser una buena herramienta para un aumento <a href="https://wiki.php.net/rfc/preload">simple y econ√≥mico</a> de la productividad sin un procesamiento serio. <br><br>  Pero el problema no es <i>c√≥mo</i> precargar, sino <i>qu√©</i> .  La carga previa de marcos completos y miles de archivos agotar√° r√°pidamente la memoria, por lo que hacerlo a ciegas no es una opci√≥n, al menos en proyectos grandes.  Es recomendable descargar solo los archivos m√°s solicitados.  ¬øPero c√≥mo definirlos? <br><br>  Afortunadamente, OPCache permite que <a href="https://www.php.net/manual/en/function.opcache-get-status.php">opcache_get_status ()</a> recopile datos sobre a qu√© archivos se accede m√°s.  No solo puede averiguar qu√© archivos tienen m√°s demanda, sino incluso cu√°nta memoria consumen alg√∫n tiempo despu√©s de que se inicia la aplicaci√≥n. <br><br>  Se recomienda esperar una semana o hasta el momento en que OPCache registre un cierto n√∫mero de visitas.  Todo depende de la aplicaci√≥n, pero entiendes el punto. <br>  As√≠ que creemos una lista de precarga basada en estad√≠sticas de los archivos m√°s populares.  Hice un paquete para esto. <br><br><h2>  Imagina ... ¬°Preloader! </h2><br>  Este paquete crear√° autom√°ticamente una lista de precarga para su aplicaci√≥n.  Recopilar√° estad√≠sticas de uso de OPCache, ordenar√° los archivos por el n√∫mero de visitas y crear√° una lista para que el tama√±o total del archivo no exceda el umbral especificado. <br><br><img src="https://habrastorage.org/webt/sm/1b/vi/sm1bvipjlzifwjfc4evvvpaqaau.png"><br><br>  Durante mucho tiempo estuve desconcertado en busca de la mejor estrategia para crear una lista.  Y llegu√© a la conclusi√≥n de que es mejor agregarle todos los archivos hasta que se encuentre con el l√≠mite de memoria, que para los paquetes es de 32 MB por defecto.  Los archivos se ordenar√°n por la cantidad de visitas y el paquete en s√≠ se excluir√° autom√°ticamente. <br><br>  En otras palabras, PHP mejorar√° el rendimiento de la aplicaci√≥n cuando procese la mayor√≠a de las solicitudes. <br><br>  ¬øY c√≥mo usarlo?  Dile a Composer Autoloader d√≥nde escribir la secuencia de comandos Preloader, y listo. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">DarkGhostHunter</span></span>\<span class="hljs-title"><span class="hljs-title">Preloader</span></span>\<span class="hljs-title"><span class="hljs-title">Preloader</span></span>; Preloader::make() -&gt;autoload(<span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>) -&gt;output(<span class="hljs-string"><span class="hljs-string">'preload.php'</span></span>) -&gt;generate();</code> </pre><br>  Por supuesto, tienes que elegir cu√°ndo generar, pero ese es el punto.  Incluso puede hacer esto al azar y reescribir la lista, por ejemplo, para cada solicitud n√∫mero 100. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">DarkGhostHunter</span></span>\<span class="hljs-title"><span class="hljs-title">Preloader</span></span>\<span class="hljs-title"><span class="hljs-title">Preloader</span></span>; Preloader::make() -&gt;whenOneIn(<span class="hljs-number"><span class="hljs-number">100</span></span>) -&gt;autoload(<span class="hljs-string"><span class="hljs-string">'vendor/autoload.php'</span></span>) -&gt;output(<span class="hljs-string"><span class="hljs-string">'preload.php'</span></span>) -&gt;overwrite() -&gt;generate();</code> </pre><br>  Obtendr√° un script de precarga listo para usar que puede poner en php.ini. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * This file is generated automatically by Preloader. * * This script uses Composer Autoload file and `require_once` to preload the files in this * list. Add this file to your `php.ini` in `opcache.preload` to preload this list into * PHP at startup. Additionally, this file also includes information about Opcache. * * * Add (or update) this line in `php.ini`: * * opcache.preload=/www/app/vendor/preload.php * * --- Config --- * Generated at: 2019-11-20 15:20:49 UTC * Opcache * - Used Memory: 130585 B * - Free Memory: 294896 B * - Wasted Memory: 347764 B * - Cached files: 2675 * - Hit rate: 94% * - Misses: 542 * Preloader config * - Memory limit: 32 MB * - Overwrite: false * - Files excluded: 0 * - Files appended: 0 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'/www/app/vendor/autoload.php'</span></span>; $files = [ <span class="hljs-string"><span class="hljs-string">'/www/app/ClassFoo.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'/www/app/ClassBar.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'/www/app/ClassBaz.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'/www/app/ClassQuz.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'/www/app/ClassQux.php'</span></span>, <span class="hljs-string"><span class="hljs-string">'/www/app/vendor/author/package/src/Example.php'</span></span>, <span class="hljs-comment"><span class="hljs-comment">// ... ]; foreach ($files as $file) { require_once $file; }</span></span></code> </pre><br>  Y eso es todo.  Pru√©belo usted mismo: <a href="https://packagist.org/packages/darkghosthunter/preloader%3Fsource%3Dpost_page-----9ede756f292c----------------------">darkghosthunter / preloader - Packagist</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/480746/">https://habr.com/ru/post/480746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../480734/index.html">Que TestMace es mejor que Postman</a></li>
<li><a href="../480736/index.html">¬øPor qu√© no todos los errores deben corregirse para mejorar un producto de TI?</a></li>
<li><a href="../480738/index.html">Experiencia en la creaci√≥n de un producto en Rusia o C√≥mo crear una aspiradora inal√°mbrica "popular" PRO-EXPERT</a></li>
<li><a href="../480740/index.html">4 caracter√≠sticas geniales de Numpy que uso constantemente</a></li>
<li><a href="../480744/index.html">¬øC√≥mo puede un programador proteger su proyecto favorito?</a></li>
<li><a href="../480748/index.html">¬øPor qu√© necesitas tantos desarrolladores?</a></li>
<li><a href="../480752/index.html">ICANN suspende la venta de la zona de dominio .ORG</a></li>
<li><a href="../480754/index.html">Gesti√≥n del caos: limpieza con enrutamiento</a></li>
<li><a href="../480760/index.html">Trabajar en el extranjero: ¬øen qu√© pa√≠ses est√° Internet m√°s r√°pido?</a></li>
<li><a href="../480762/index.html">V&V no significa venganza</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>