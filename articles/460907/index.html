<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëäüèø üêÆ üë©üèª‚Äçüöí Uso de Liquibase para administrar la estructura de la base de datos en una aplicaci√≥n Spring Boot. Parte 2 ü§òüèº ‚úãüèº ü¶ã</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la parte anterior, descubrimos las caracter√≠sticas b√°sicas de Liquibase y escribimos un ejemplo b√°sico de una aplicaci√≥n de arranque Spring que usa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uso de Liquibase para administrar la estructura de la base de datos en una aplicaci√≥n Spring Boot. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460907/"> En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte anterior,</a> descubrimos las caracter√≠sticas b√°sicas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Liquibase</a> y escribimos un ejemplo b√°sico de una aplicaci√≥n de <i>arranque Spring</i> que usa Liquibase para inicializar la base de datos.  El c√≥digo completo de la aplicaci√≥n base se puede ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ en GitHub</a> .  En este art√≠culo hablaremos sobre <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">liquibase-maven-plugin</a></i> y las caracter√≠sticas adicionales que nos brinda para versionar la estructura de la base de datos.  Comencemos con c√≥mo crear autom√°ticamente scripts usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la funci√≥n de comparaci√≥n</a> . <br><br>  Supongamos que necesitamos hacer algunos cambios en la estructura de nuestra base de datos.  Por ejemplo, queremos que el <i>correo electr√≥nico</i> no sea <i>nulo</i> .  Por supuesto, para un cambio tan peque√±o, puede corregir manualmente el c√≥digo y las secuencias de comandos, pero ¬øqu√© pasa si hay m√°s cambios?  En este caso, la capacidad de comparar la base de datos integrada en Liquibase nos ayudar√°.  Una caracter√≠stica interesante es que puede comparar no solo dos bases de datos, sino tambi√©n una base de datos con un conjunto de entidades JPA en nuestra aplicaci√≥n.  ¬°Eso es exactamente lo que haremos ahora! <br><a name="habracut"></a><br><h4>  Crear un script con cambios usando liquibase-diff </h4><br>  En la secci√≥n de <i>complementos</i> del archivo <i>pom.xml</i> , agregamos este dise√±o bastante complicado.  Esto es <i>liquibase-maven-plugin</i> , al que se conecta una dependencia para analizar <i>entidades de hibernaci√≥n</i> y trabajar con archivos YAML.  El complemento nos ayudar√° a generar autom√°ticamente <i>scripts de liquibase</i> comparando estructuras en dos bases de datos o incluso comparando la estructura de datos en una base de datos y un conjunto de entidades hiberante en nuestra aplicaci√≥n (se <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">agrega liquibase-hibernate5</a></i> para esto). <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.8.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">propertyFile</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}/liquibase-maven-plugin.properties<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">propertyFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">systemProperties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user.name</span></span></span><span class="hljs-tag">&gt;</span></span>your_liquibase_username<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user.name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">systemProperties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span>info<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase.ext<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-hibernate5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-data-jpa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.0.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Presta atenci√≥n a la configuraci√≥n de <i>user.name</i> .  Es opcional, pero sin ella Liquibase indicar√° en los scripts creados el nombre del usuario actual del sistema operativo bajo el cual se inicia el complemento. <br><br>  La configuraci√≥n del complemento se puede escribir directamente en pom.xml o pasar como par√°metros de l√≠nea de comando al llamar a maven, pero prefiero la opci√≥n con un archivo <i>liquibase-maven-plugin.properties</i> separado.  Su contenido se ver√° m√°s o menos as√≠. <br><br><pre> <code class="plaintext hljs">changeLogFile= @project.basedir@/src/main/resources/db/changelog/db.changelog-master.yaml url= jdbc:mysql://localhost:3306/geek_db?createDatabaseIfNotExist=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC username= dbusername password= dbpassword driver= com.mysql.cj.jdbc.Driver referenceUrl= hibernate:spring:ru.usharik.liquibase.demo.persist.model?dialect=org.hibernate.dialect.MySQLDialect diffChangeLogFile= @project.basedir@/src/main/resources/db/changelog/db.changelog-@timestamp@.yaml ignoreClasspathPrefix= true</code> </pre>  Vale la pena prestar atenci√≥n a los par√°metros <i>url</i> y <i>referenceUrl</i> .  El script que crear√° liquibase despu√©s de la comparaci√≥n ser√° la diferencia entre la base que usa el enlace referenceUrl y la base que usa el enlace <i>url</i> .  Si luego ejecuta este script en la base utilizando el enlace <i>url</i> , se convertir√° en el mismo que se encuentra en el enlace referenceUrl.  Se debe prestar especial atenci√≥n al enlace referenceUrl.  Como puede ver, no se refiere a la base de datos, sino al paquete de nuestra aplicaci√≥n en el que se ubican las clases de entidad.  Gracias a esto, ahora podemos encontrar un script que agregar√° a la base de datos los cambios que se hicieron en el c√≥digo. <br><br>  Ahora necesitamos configurar el complemento de recursos maven para reemplazar los marcadores de posici√≥n en el archivo de configuraci√≥n, como <code>@project.basedir@</code> y <code>@timestamp@</code> .  Para hacer esto, agregue la secci√≥n de <i>recursos</i> del siguiente formulario a la secci√≥n de <i>compilaci√≥n</i> <br><br><pre> <code class="plaintext hljs">&lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;*.properties&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;**/*.*&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt;</code> </pre> <br>  Por cierto, Spring boot cambia el formato est√°ndar para marcadores de posici√≥n poblados usando el <i>complemento maven-resource</i> de <code>${smth}</code> a <code>@smth@</code> .  El hecho es que los marcadores de posici√≥n del <code>@smth@</code> en Spring Boot se utilizan para sustituir las variables de entorno y los par√°metros de la aplicaci√≥n Spring Boot. <br><br>  Adem√°s, cambiamos ligeramente la secci√≥n de <i>propiedades</i> en <i>pom.xml</i> para asignar el valor a la variable de <i>marca de tiempo</i> en el formato que necesitamos.  Por desgracia, el formato est√°ndar puede contener caracteres que est√°n prohibidos en los nombres de archivo para algunos sistemas operativos. <br><br><pre> <code class="plaintext hljs">&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;timestamp&gt;${maven.build.timestamp}&lt;/timestamp&gt; &lt;maven.build.timestamp.format&gt;yyyyMMdd-HHmmssSSS&lt;/maven.build.timestamp.format&gt; &lt;/properties&gt;</code> </pre> <br>  Ahora cambiemos el campo de correo electr√≥nico en la clase Usuario <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"email"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String email;</code> </pre> <br>  Finalmente, ejecute el comando de compilaci√≥n usando <i>liquibase-maven-plugin</i> para comparar. <br><br><pre> <code class="plaintext hljs">mvn clean install liquibase:diff -DskipTests=true</code> </pre> <br>  En este caso, necesitamos reconstruir completamente el proyecto, porque el complemento (liquibase: diff) usar√° fuentes no compiladas, sino archivos de clase de entidad compilados de la carpeta de <i>destino</i> para el an√°lisis. <br><br>  Si todo se hace correctamente, luego de la ejecuci√≥n exitosa del comando en la carpeta <i>resources / db / changelog</i> , ver√° un archivo con el nombre <i>db.changelog-20190723-100748666.yaml</i> .  Debido al hecho de que usamos la fecha y hora actuales en el nombre del archivo, con cada lanzamiento tendremos un nuevo archivo, lo cual es bastante conveniente.  Si ya ha creado una base de datos con la estructura de tabla correspondiente a la lecci√≥n anterior, el contenido del archivo deber√≠a ser as√≠. <br><br><pre> <code class="plaintext hljs">databaseChangeLog: - changeSet: id: 1563876485764-1 author: your_liquibase_username (generated) changes: - addNotNullConstraint: columnDataType: varchar(255) columnName: email tableName: users</code> </pre>  Como puede ver, este script realiza exactamente el cambio que se realiz√≥ en el c√≥digo.  Como ejercicio, recomendar√≠a que ejecute este script en una base de datos vac√≠a y mire el resultado. <br><br>  Luego, simplemente podemos copiar el changeSet de este archivo a <i>db.changelog-master.yaml</i> o podemos conectar este archivo con una instrucci√≥n <br><br><pre> <code class="plaintext hljs"> - include: file: db.changelog-20190723-100748666.yaml relativeToChangelogFile: true</code> </pre> <br>  Tambi√©n en este archivo debe especificar <code>logicalFilePath: db/changelog/db.changelog-20190723-100748666.yaml</code> , similar a c√≥mo se hizo en <i>db.changelog-master.yaml</i> . <br>  Esto ayudar√° a hacer frente a algunos problemas que son posibles al usar el bean <i>liquibase incorporado y el plugin liquibase-maven-plugin</i> en la aplicaci√≥n.  Despu√©s de eso, reinicie la aplicaci√≥n o ejecute el comando: <br><br><pre> <code class="plaintext hljs">mvn liquibase:update</code> </pre> <br>  Intentemos hacer un cambio m√°s complejo en el c√≥digo.  Por ejemplo, agregue una tabla de roles que tendr√° una relaci√≥n de muchos a muchos con la tabla de usuario. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"roles"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Role</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>, unique = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(mappedBy = <span class="hljs-string"><span class="hljs-string">"roles"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;User&gt; users; <span class="hljs-comment"><span class="hljs-comment">//  , ,  }</span></span></code> </pre> <br>  Y en la tabla Usuarios agregamos <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(fetch = FetchType.LAZY) <span class="hljs-meta"><span class="hljs-meta">@JoinTable</span></span>(name = <span class="hljs-string"><span class="hljs-string">"users_roles"</span></span>, joinColumns = <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user_id"</span></span>), inverseJoinColumns = <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"role_id"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;Role&gt; roles;</code> </pre> <br>  Despu√©s de comenzar la comparaci√≥n, obtenemos un archivo con los siguientes contenidos <br><pre> <code class="plaintext hljs">databaseChangeLog: - changeSet: id: 1563877765929-1 author: your_liquibase_username (generated) changes: - createTable: columns: - column: autoIncrement: true constraints: primaryKey: true primaryKeyName: rolesPK name: id type: BIGINT - column: constraints: nullable: false name: name type: VARCHAR(255) tableName: roles - changeSet: id: 1563877765929-2 author: your_liquibase_username (generated) changes: - createTable: columns: - column: constraints: nullable: false name: user_id type: BIGINT - column: constraints: nullable: false name: role_id type: BIGINT tableName: users_roles - changeSet: id: 1563877765929-3 author: your_liquibase_username (generated) changes: - addPrimaryKey: columnNames: user_id, role_id tableName: users_roles - changeSet: id: 1563877765929-4 author: your_liquibase_username (generated) changes: - addUniqueConstraint: columnNames: name constraintName: UC_ROLESNAME_COL tableName: roles - changeSet: id: 1563877765929-5 author: your_liquibase_username (generated) changes: - addForeignKeyConstraint: baseColumnNames: user_id baseTableName: users_roles constraintName: FK2o0jvgh89lemvvo17cbqvdxaa deferrable: false initiallyDeferred: false referencedColumnNames: id referencedTableName: users - changeSet: id: 1563877765929-6 author: your_liquibase_username (generated) changes: - addForeignKeyConstraint: baseColumnNames: role_id baseTableName: users_roles constraintName: FKj6m8fwv7oqv74fcehir1a9ffy deferrable: false initiallyDeferred: false referencedColumnNames: id referencedTableName: roles</code> </pre> <br>  Tambi√©n podemos agregar f√°cilmente este archivo a scripts de trabajo. <br><br><h4>  Revertir cambios </h4><br>  Ahora veamos c√≥mo deshacer los cambios realizados.  Por alguna raz√≥n, los identificadores que especificamos en changeSets no se pueden usar para revertirlos.  Hay tres opciones, especificar un punto de reversi√≥n <br><br><ul><li>  a trav√©s del n√∫mero de conjuntos de cambios contando desde el actual </li><li>  despu√©s de la fecha del cambio </li><li>  a trav√©s de la etiqueta (establecida usando changeSet de un tipo especial) </li></ul><br>  La etiqueta se establece de la siguiente manera. <br><br><pre> <code class="plaintext hljs"> - changeSet: id: some_uniqui_id author: liquibase_user_name changes: - tagDatabase: tag: db_tag</code> </pre> <br>  Bueno, los comandos para las tres formas enumeradas para hacer rollback <br><br><pre> <code class="plaintext hljs">mvn liquibase:rollback -Dliquibase.rollbackTag=db_tag mvn liquibase:rollback -Dliquibase.rollbackCount=1 mvn liquibase:rollback "-Dliquibase.rollbackDate=Jun 03, 2017"</code> </pre><br>  Y finalmente, algunos materiales adicionales. <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C√≥digo para este art√≠culo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sobre la reversi√≥n en Liquibase</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sobre la migraci√≥n con Liquibase</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Liquibase en github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Muy buen art√≠culo sobre varios enfoques para versionar una base de datos</a> </li></ol><br>  Por supuesto, estar√© muy contento de cualquier comentario, adiciones, aclaraciones, etc. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460907/">https://habr.com/ru/post/460907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460893/index.html">Una mirada a la reubicaci√≥n en Estonia desde adentro hacia afuera: pros, contras y dificultades</a></li>
<li><a href="../460897/index.html">JUnit en GitLab CI con Kubernetes</a></li>
<li><a href="../460899/index.html">26 de julio, Deworkacy - DocOps de Rostelecom</a></li>
<li><a href="../460901/index.html">Por qu√© los desarrolladores senior no pueden conseguir un trabajo</a></li>
<li><a href="../460905/index.html">M√≠nimo conocimiento de SEO para emprendedores</a></li>
<li><a href="../460909/index.html">¬øQu√© comeremos en 2050?</a></li>
<li><a href="../460911/index.html">Hacer el bien, hacer el mal: escribir c√≥digo malvado con Go, parte 2</a></li>
<li><a href="../460913/index.html">Recorrido fotogr√°fico por el museo del Instituto de F√≠sica y Energ√≠a en Obninsk</a></li>
<li><a href="../460915/index.html">Conveniente sistema de gesti√≥n de bases de datos</a></li>
<li><a href="../460923/index.html">Tarea de prueba Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>