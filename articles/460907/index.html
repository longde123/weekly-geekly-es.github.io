<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👊🏿 🐮 👩🏻‍🚒 Uso de Liquibase para administrar la estructura de la base de datos en una aplicación Spring Boot. Parte 2 🤘🏼 ✋🏼 🦋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la parte anterior, descubrimos las características básicas de Liquibase y escribimos un ejemplo básico de una aplicación de arranque Spring que usa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Uso de Liquibase para administrar la estructura de la base de datos en una aplicación Spring Boot. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460907/"> En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">parte anterior,</a> descubrimos las características básicas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Liquibase</a> y escribimos un ejemplo básico de una aplicación de <i>arranque Spring</i> que usa Liquibase para inicializar la base de datos.  El código completo de la aplicación base se puede ver <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí en GitHub</a> .  En este artículo hablaremos sobre <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">liquibase-maven-plugin</a></i> y las características adicionales que nos brinda para versionar la estructura de la base de datos.  Comencemos con cómo crear automáticamente scripts usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la función de comparación</a> . <br><br>  Supongamos que necesitamos hacer algunos cambios en la estructura de nuestra base de datos.  Por ejemplo, queremos que el <i>correo electrónico</i> no sea <i>nulo</i> .  Por supuesto, para un cambio tan pequeño, puede corregir manualmente el código y las secuencias de comandos, pero ¿qué pasa si hay más cambios?  En este caso, la capacidad de comparar la base de datos integrada en Liquibase nos ayudará.  Una característica interesante es que puede comparar no solo dos bases de datos, sino también una base de datos con un conjunto de entidades JPA en nuestra aplicación.  ¡Eso es exactamente lo que haremos ahora! <br><a name="habracut"></a><br><h4>  Crear un script con cambios usando liquibase-diff </h4><br>  En la sección de <i>complementos</i> del archivo <i>pom.xml</i> , agregamos este diseño bastante complicado.  Esto es <i>liquibase-maven-plugin</i> , al que se conecta una dependencia para analizar <i>entidades de hibernación</i> y trabajar con archivos YAML.  El complemento nos ayudará a generar automáticamente <i>scripts de liquibase</i> comparando estructuras en dos bases de datos o incluso comparando la estructura de datos en una base de datos y un conjunto de entidades hiberante en nuestra aplicación (se <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">agrega liquibase-hibernate5</a></i> para esto). <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-maven-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.8.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">propertyFile</span></span></span><span class="hljs-tag">&gt;</span></span>${project.build.outputDirectory}/liquibase-maven-plugin.properties<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">propertyFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">systemProperties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user.name</span></span></span><span class="hljs-tag">&gt;</span></span>your_liquibase_username<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">user.name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">systemProperties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span>info<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">logging</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase.ext<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-hibernate5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.springframework.boot<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spring-boot-starter-data-jpa<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>2.2.0.RELEASE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependencies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Presta atención a la configuración de <i>user.name</i> .  Es opcional, pero sin ella Liquibase indicará en los scripts creados el nombre del usuario actual del sistema operativo bajo el cual se inicia el complemento. <br><br>  La configuración del complemento se puede escribir directamente en pom.xml o pasar como parámetros de línea de comando al llamar a maven, pero prefiero la opción con un archivo <i>liquibase-maven-plugin.properties</i> separado.  Su contenido se verá más o menos así. <br><br><pre> <code class="plaintext hljs">changeLogFile= @project.basedir@/src/main/resources/db/changelog/db.changelog-master.yaml url= jdbc:mysql://localhost:3306/geek_db?createDatabaseIfNotExist=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC username= dbusername password= dbpassword driver= com.mysql.cj.jdbc.Driver referenceUrl= hibernate:spring:ru.usharik.liquibase.demo.persist.model?dialect=org.hibernate.dialect.MySQLDialect diffChangeLogFile= @project.basedir@/src/main/resources/db/changelog/db.changelog-@timestamp@.yaml ignoreClasspathPrefix= true</code> </pre>  Vale la pena prestar atención a los parámetros <i>url</i> y <i>referenceUrl</i> .  El script que creará liquibase después de la comparación será la diferencia entre la base que usa el enlace referenceUrl y la base que usa el enlace <i>url</i> .  Si luego ejecuta este script en la base utilizando el enlace <i>url</i> , se convertirá en el mismo que se encuentra en el enlace referenceUrl.  Se debe prestar especial atención al enlace referenceUrl.  Como puede ver, no se refiere a la base de datos, sino al paquete de nuestra aplicación en el que se ubican las clases de entidad.  Gracias a esto, ahora podemos encontrar un script que agregará a la base de datos los cambios que se hicieron en el código. <br><br>  Ahora necesitamos configurar el complemento de recursos maven para reemplazar los marcadores de posición en el archivo de configuración, como <code>@project.basedir@</code> y <code>@timestamp@</code> .  Para hacer esto, agregue la sección de <i>recursos</i> del siguiente formulario a la sección de <i>compilación</i> <br><br><pre> <code class="plaintext hljs">&lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;true&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;*.properties&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;resource&gt; &lt;directory&gt;src/main/resources&lt;/directory&gt; &lt;filtering&gt;false&lt;/filtering&gt; &lt;includes&gt; &lt;include&gt;**/*.*&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt;</code> </pre> <br>  Por cierto, Spring boot cambia el formato estándar para marcadores de posición poblados usando el <i>complemento maven-resource</i> de <code>${smth}</code> a <code>@smth@</code> .  El hecho es que los marcadores de posición del <code>@smth@</code> en Spring Boot se utilizan para sustituir las variables de entorno y los parámetros de la aplicación Spring Boot. <br><br>  Además, cambiamos ligeramente la sección de <i>propiedades</i> en <i>pom.xml</i> para asignar el valor a la variable de <i>marca de tiempo</i> en el formato que necesitamos.  Por desgracia, el formato estándar puede contener caracteres que están prohibidos en los nombres de archivo para algunos sistemas operativos. <br><br><pre> <code class="plaintext hljs">&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; &lt;timestamp&gt;${maven.build.timestamp}&lt;/timestamp&gt; &lt;maven.build.timestamp.format&gt;yyyyMMdd-HHmmssSSS&lt;/maven.build.timestamp.format&gt; &lt;/properties&gt;</code> </pre> <br>  Ahora cambiemos el campo de correo electrónico en la clase Usuario <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"email"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String email;</code> </pre> <br>  Finalmente, ejecute el comando de compilación usando <i>liquibase-maven-plugin</i> para comparar. <br><br><pre> <code class="plaintext hljs">mvn clean install liquibase:diff -DskipTests=true</code> </pre> <br>  En este caso, necesitamos reconstruir completamente el proyecto, porque el complemento (liquibase: diff) usará fuentes no compiladas, sino archivos de clase de entidad compilados de la carpeta de <i>destino</i> para el análisis. <br><br>  Si todo se hace correctamente, luego de la ejecución exitosa del comando en la carpeta <i>resources / db / changelog</i> , verá un archivo con el nombre <i>db.changelog-20190723-100748666.yaml</i> .  Debido al hecho de que usamos la fecha y hora actuales en el nombre del archivo, con cada lanzamiento tendremos un nuevo archivo, lo cual es bastante conveniente.  Si ya ha creado una base de datos con la estructura de tabla correspondiente a la lección anterior, el contenido del archivo debería ser así. <br><br><pre> <code class="plaintext hljs">databaseChangeLog: - changeSet: id: 1563876485764-1 author: your_liquibase_username (generated) changes: - addNotNullConstraint: columnDataType: varchar(255) columnName: email tableName: users</code> </pre>  Como puede ver, este script realiza exactamente el cambio que se realizó en el código.  Como ejercicio, recomendaría que ejecute este script en una base de datos vacía y mire el resultado. <br><br>  Luego, simplemente podemos copiar el changeSet de este archivo a <i>db.changelog-master.yaml</i> o podemos conectar este archivo con una instrucción <br><br><pre> <code class="plaintext hljs"> - include: file: db.changelog-20190723-100748666.yaml relativeToChangelogFile: true</code> </pre> <br>  También en este archivo debe especificar <code>logicalFilePath: db/changelog/db.changelog-20190723-100748666.yaml</code> , similar a cómo se hizo en <i>db.changelog-master.yaml</i> . <br>  Esto ayudará a hacer frente a algunos problemas que son posibles al usar el bean <i>liquibase incorporado y el plugin liquibase-maven-plugin</i> en la aplicación.  Después de eso, reinicie la aplicación o ejecute el comando: <br><br><pre> <code class="plaintext hljs">mvn liquibase:update</code> </pre> <br>  Intentemos hacer un cambio más complejo en el código.  Por ejemplo, agregue una tabla de roles que tendrá una relación de muchos a muchos con la tabla de usuario. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"roles"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Role</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"name"</span></span>, unique = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String name; <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(mappedBy = <span class="hljs-string"><span class="hljs-string">"roles"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;User&gt; users; <span class="hljs-comment"><span class="hljs-comment">//  , ,  }</span></span></code> </pre> <br>  Y en la tabla Usuarios agregamos <br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(fetch = FetchType.LAZY) <span class="hljs-meta"><span class="hljs-meta">@JoinTable</span></span>(name = <span class="hljs-string"><span class="hljs-string">"users_roles"</span></span>, joinColumns = <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"user_id"</span></span>), inverseJoinColumns = <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"role_id"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Set&lt;Role&gt; roles;</code> </pre> <br>  Después de comenzar la comparación, obtenemos un archivo con los siguientes contenidos <br><pre> <code class="plaintext hljs">databaseChangeLog: - changeSet: id: 1563877765929-1 author: your_liquibase_username (generated) changes: - createTable: columns: - column: autoIncrement: true constraints: primaryKey: true primaryKeyName: rolesPK name: id type: BIGINT - column: constraints: nullable: false name: name type: VARCHAR(255) tableName: roles - changeSet: id: 1563877765929-2 author: your_liquibase_username (generated) changes: - createTable: columns: - column: constraints: nullable: false name: user_id type: BIGINT - column: constraints: nullable: false name: role_id type: BIGINT tableName: users_roles - changeSet: id: 1563877765929-3 author: your_liquibase_username (generated) changes: - addPrimaryKey: columnNames: user_id, role_id tableName: users_roles - changeSet: id: 1563877765929-4 author: your_liquibase_username (generated) changes: - addUniqueConstraint: columnNames: name constraintName: UC_ROLESNAME_COL tableName: roles - changeSet: id: 1563877765929-5 author: your_liquibase_username (generated) changes: - addForeignKeyConstraint: baseColumnNames: user_id baseTableName: users_roles constraintName: FK2o0jvgh89lemvvo17cbqvdxaa deferrable: false initiallyDeferred: false referencedColumnNames: id referencedTableName: users - changeSet: id: 1563877765929-6 author: your_liquibase_username (generated) changes: - addForeignKeyConstraint: baseColumnNames: role_id baseTableName: users_roles constraintName: FKj6m8fwv7oqv74fcehir1a9ffy deferrable: false initiallyDeferred: false referencedColumnNames: id referencedTableName: roles</code> </pre> <br>  También podemos agregar fácilmente este archivo a scripts de trabajo. <br><br><h4>  Revertir cambios </h4><br>  Ahora veamos cómo deshacer los cambios realizados.  Por alguna razón, los identificadores que especificamos en changeSets no se pueden usar para revertirlos.  Hay tres opciones, especificar un punto de reversión <br><br><ul><li>  a través del número de conjuntos de cambios contando desde el actual </li><li>  después de la fecha del cambio </li><li>  a través de la etiqueta (establecida usando changeSet de un tipo especial) </li></ul><br>  La etiqueta se establece de la siguiente manera. <br><br><pre> <code class="plaintext hljs"> - changeSet: id: some_uniqui_id author: liquibase_user_name changes: - tagDatabase: tag: db_tag</code> </pre> <br>  Bueno, los comandos para las tres formas enumeradas para hacer rollback <br><br><pre> <code class="plaintext hljs">mvn liquibase:rollback -Dliquibase.rollbackTag=db_tag mvn liquibase:rollback -Dliquibase.rollbackCount=1 mvn liquibase:rollback "-Dliquibase.rollbackDate=Jun 03, 2017"</code> </pre><br>  Y finalmente, algunos materiales adicionales. <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Código para este artículo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sobre la reversión en Liquibase</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sobre la migración con Liquibase</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Liquibase en github</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Muy buen artículo sobre varios enfoques para versionar una base de datos</a> </li></ol><br>  Por supuesto, estaré muy contento de cualquier comentario, adiciones, aclaraciones, etc. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/460907/">https://habr.com/ru/post/460907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460893/index.html">Una mirada a la reubicación en Estonia desde adentro hacia afuera: pros, contras y dificultades</a></li>
<li><a href="../460897/index.html">JUnit en GitLab CI con Kubernetes</a></li>
<li><a href="../460899/index.html">26 de julio, Deworkacy - DocOps de Rostelecom</a></li>
<li><a href="../460901/index.html">Por qué los desarrolladores senior no pueden conseguir un trabajo</a></li>
<li><a href="../460905/index.html">Mínimo conocimiento de SEO para emprendedores</a></li>
<li><a href="../460909/index.html">¿Qué comeremos en 2050?</a></li>
<li><a href="../460911/index.html">Hacer el bien, hacer el mal: escribir código malvado con Go, parte 2</a></li>
<li><a href="../460913/index.html">Recorrido fotográfico por el museo del Instituto de Física y Energía en Obninsk</a></li>
<li><a href="../460915/index.html">Conveniente sistema de gestión de bases de datos</a></li>
<li><a href="../460923/index.html">Tarea de prueba Yandex</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>