<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèø üöø üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë© Implementierung meines Hausautomationssystems üíí ‚ÜïÔ∏è üêí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ich habe lange Zeit Artikel √ºber Hausautomationssysteme auf Habr√© gelesen und wollte beschreiben, woran ich seit mehr als zwei Jahren arbeite. Zum bes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Implementierung meines Hausautomationssystems</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/386457/"><img src="https://habrastorage.org/files/ea9/62e/a6d/ea962ea6d63c4af99f2a68e426d88fa5.jpg" align="right"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich habe lange Zeit Artikel √ºber Hausautomationssysteme auf Habr√© gelesen und wollte beschreiben, woran ich seit mehr als zwei Jahren arbeite. Zum besseren Verst√§ndnis meiner Situation m√ºssen Sie eine kleine Einf√ºhrung machen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vor drei Jahren zogen meine Familie und ich in eine neue Dreizimmerwohnung (67,5 m¬≤), obwohl die Wohnung technisch gesehen nat√ºrlich alt ist - Stalin, ein Haus aus dem Jahr 1946. Aluminium-Zweidrahtverdrahtung mit Kupferlitzen an einigen Stellen 1 m¬≤. Die √úberholung stand vor der T√ºr, ich beschloss, alles selbst zu tun, und begann mit einem vollst√§ndigen Austausch der Verkabelung. 700 m Netzkabel f√ºr Beleuchtung und Steckdosen 1,5 und 2,5 m¬≤, ein Twisted-Pair-Schacht, ein kleines Koaxialkabel f√ºr Fernsehantennen wurden gekauft (nur f√ºr den Fall). Warum so viel und was daraus wurde - ich bitte um eine Katze.</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich habe mich entschlossen, die Verkabelung sofort vorzunehmen, n√§mlich: Ohne Verteilerk√§sten f√ºhrt das Kabel von jedem Punkt zur Abschirmung (mit Ausnahme der Steckdosen, die in einer Gruppe von 2-3 Punkten liegen k√∂nnen, geht das Kabel von der Spitze zur Abschirmung, der Rest ist durch eine Schleife verbunden) - t. e. Von jedem Schalter sein eigenes Kabel zur Abschirmung, von jedem Beleuchtungspunkt sein eigenes Kabel zur Abschirmung, in der N√§he von Buchsen entlang eines Paares von rj-45-Punkten, nur f√ºr den Fall. Nat√ºrlich gibt es viele Kabel. Irgendwo wird es nach allen Regeln des PUE auf den Boden gelegt, wie zum Beispiel im Kinderzimmer: </font></font><br>
<br>
<img src="https://habrastorage.org/files/09e/071/732/09e0717328cb46a0b0df95701ac88122.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Irgendwo - an der Decke zum Beispiel Blick auf die Schlafzimmert√ºr:</font></font><br>
<br>
<img src="https://habrastorage.org/files/f0f/f50/510/f0ff505103224720825920b62b9da86c.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infolgedessen erhalten wir alle Kabel im Korridor an einem Ort, an dem sich die Abschirmung befindet, und sie k√∂nnen nach Belieben zwischen ihnen ausgetauscht werden. Selbst wenn Sie das Verbindungsschema in Zukunft √§ndern m√ºssen, wird es nicht viel Zeit in Anspruch nehmen und Sie m√ºssen die Reparatur nicht verderben. Und nat√ºrlich wurden viele Steckdosen f√ºr alle Gelegenheiten hergestellt - insgesamt etwa 90 Punkte f√ºr die gesamte Wohnung. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sah der tempor√§re ‚ÄûSchild‚Äú w√§hrend der Experimente aus: Ein </font></font><br>
<br>
<img src="https://habrastorage.org/files/1e4/0bd/131/1e40bd1311d2412686170c0ae8619274.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
schrecklicher Anblick, aber alles funktionierte und in dieser Form lebte dieses Monster mehrere Monate. Eines sch√∂nen Tages wurden die Sterne erfolgreich geformt und der Schild durch vors√§tzliche Entscheidung erneuert. Es dauerte 3 Tage auf einer klapprigen Treppe unter der Decke (und die Decken im Stalin 3m), aber es hat sich gelohnt. So sah das Dashboard danach aus: </font></font><br>
<br>
<img src="https://habrastorage.org/files/34b/2e4/1e9/34b2e41e94a54217bad80ce53d2e0e45.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und die allgemeine Ansicht:</font></font><br>
<br>
<img src="https://habrastorage.org/files/054/e15/85e/054e1585eeb74b7ebe62e3fcd946e1a3.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dies ist weit entfernt von der endg√ºltigen Form der Abschirmung, es gibt immer noch nicht gen√ºgend FI-Schutzschalter, es gibt dreimal weniger Leistungsschalter als erforderlich, es gibt keine Impulsrelais - aber es gibt keine Trennleitungen, alle Kabel sind an die Klemmen angeschlossen, es gibt zumindest eine Art Leistungsschalter-Selektivit√§t. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem Sie eine ungef√§hre Vorstellung davon haben, womit ich genau arbeiten musste, k√∂nnen Sie beginnen, die ‚ÄûGehirne‚Äú des Systems zu beschreiben. Ohne weiteres nahm ich Arduino als Basis, zumal ich bereits 2 Freeduino-Boards, 2 Ethernet-Shields und einen Motor Shield hatte, die ich lange zuvor gekauft hatte. Ebenfalls bei den Chinesen bestellt mehrere Relaismodule zu je 4 St√ºck. Auf Anraten eines Artikels √ºber Habr√© in Ob fand ich auch Schalter, in die spezielle Federn eingesetzt werden konnten, und die sich ohne Befestigung in Schalter verwandelten. Es ist Zeit, Code zu schreiben.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen bin ich eng mit Computern im Leben verbunden. Er hat die Pelzmatte fertiggestellt, auf die er gerade nicht geschrieben hat - Pascal, C #, C ++, 1c, PHP, Javascript - Sie k√∂nnen immer noch viel auflisten. Das letzte Mal, wenn ich im Bereich Webentwicklung arbeite, besch√§ftige ich mich auch mit IP-Telefonie. Daher ist es einfach, einen Algorithmus zu entwickeln, aber mit Elektronik ‚Äûf√ºr Sie‚Äú kenne und kenne ich einfache Dinge, und wenn es um etwas Komplizierteres geht - Mikrocontroller, Sicherungen, Kontaktsprung - ist es schwieriger. Aber es sind nicht die G√∂tter, die die T√∂pfe verbrennen, die Augen haben Angst, sondern die H√§nde. Ich beschloss, alles einfach zu machen. Ich speise die Erde vom Arduino zum Eingang des Schalters, ich verbinde die Ausg√§nge des Schalters mit den analogen Pins des Arduino (obwohl es m√∂glich ist, digital zu sein, ist es nicht wichtig). Ich verbinde die Pins des Arduino mit den Pins des Relaismoduls. Technisch ist alles bereit. Wenn Sie den Schalter dr√ºcken, sieht das Arduino den LOW-Wert am gew√ºnschten Pin und setzt den LOW-Wert an dem mit dem Relaismodul verbundenen Pin.Da alle Kabel von den Punkten in der Wohnung zu den Terminals kommen, dauerte die Verbindung nicht lange.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um das Abprallen von Kontakten zu bek√§mpfen, wurde nach dem Studium des Themas im Internet die Bounce2-Bibliothek ausgew√§hlt. Im Allgemeinen wollte ich zun√§chst einen universellen Code schreiben, damit er mit mindestens 2 Schaltern verwendet werden kann, mindestens 22. Diese Aufgabe bildete die Grundlage des gesamten Algorithmus. Nun, von den W√∂rtern zum Code. Ich werde nicht den gesamten Code hochladen, Links zum Github befinden sich am Ende des Artikels. Ich werde aus meiner Sicht nur wichtige Momente zeigen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Deklarieren von Bibliotheken und Variablen:</font></font><br>
<br>
<pre><code class="hljs apache"><span class="hljs-comment">#include &lt;Bounce2.h&gt;</span>
<span class="hljs-comment">#include &lt;EEPROM.h&gt;</span><font></font>
<font></font>
<span class="hljs-attribute">const</span> byte cnt = <span class="hljs-number">8</span>;
<span class="hljs-attribute">const</span> byte pin_cnt = <span class="hljs-number">19</span>;<font></font>
<font></font>
<span class="hljs-attribute">int</span> pins[] = {<span class="hljs-number">11</span>,<span class="hljs-number">12</span>,<span class="hljs-number">13</span>,<span class="hljs-number">13</span>,<span class="hljs-number">14</span>,<span class="hljs-number">15</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>};
<span class="hljs-attribute">int</span> leds[] = {<span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">3</span>};<font></font>
<font></font>
<span class="hljs-attribute">byte</span> init_leds[cnt] ;
<span class="hljs-attribute">byte</span> init_buttons[cnt];
<span class="hljs-attribute">int</span> button_states[cnt];
<span class="hljs-attribute">Bounce</span> debouncers[cnt];
<span class="hljs-attribute">unsigned</span> long buttonPressTimeStamps[cnt];
<span class="hljs-attribute">boolean</span> changed[cnt];
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Punkt ist: Es reicht aus, die Konstante mit der Anzahl der Lampen / Schalter zu erh√∂hen und neue Assoziationen in den Arrays zu registrieren - und das ist alles, eine neue Lampe oder ein neuer Schalter wird hinzugef√ºgt. </font><font style="vertical-align: inherit;">Gleichzeitig erm√∂glicht die Codestruktur, dass ein Switch mehrere Ger√§te gleichzeitig steuert. </font><font style="vertical-align: inherit;">Oder mehrere Schalter, um sofort eine Lampe zu steuern. </font><font style="vertical-align: inherit;">Au√üerdem wird f√ºr jeden Switch eine eigene Instanz des Bounce-Objekts f√ºr Anti-Bounce erstellt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der Setup-Funktion werden alle Arrays initialisiert, w√§hrend der Status der Leuchten im nichtfl√ºchtigen Speicher gespeichert wird, sodass bei einem Stromausfall oder Neustart alles auf die gleiche Weise wie vor dem Ausfall eingeschaltet wird.</font></font><br>
<br>
<pre><code class="hljs matlab">  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    EEPROM.write(pins[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;<font></font>
    <font></font>
    byte value = EEPROM.read(leds[<span class="hljs-built_in">i</span>]);
    <span class="hljs-keyword">if</span>(value==<span class="hljs-number">11</span>) {<font></font>
      init_leds[<span class="hljs-built_in">i</span>] = LOW ;<font></font>
    }<span class="hljs-keyword">else</span>{<font></font>
      init_leds[<span class="hljs-built_in">i</span>] = HIGH ;<font></font>
    }<font></font>
    init_buttons[<span class="hljs-built_in">i</span>] = HIGH;<font></font>
    buttonPressTimeStamps[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;<font></font>
    changed[<span class="hljs-built_in">i</span>] = <span class="hljs-built_in">false</span>;<font></font>
<font></font>
    debouncers[<span class="hljs-built_in">i</span>] = Bounce();<font></font>
<font></font>
    pinMode(pins[<span class="hljs-built_in">i</span>], INPUT);<font></font>
    pinMode(leds[<span class="hljs-built_in">i</span>], OUTPUT);<font></font>
    <font></font>
    digitalWrite(pins[<span class="hljs-built_in">i</span>], init_buttons[<span class="hljs-built_in">i</span>]);<font></font>
    digitalWrite(leds[<span class="hljs-built_in">i</span>], init_leds[<span class="hljs-built_in">i</span>]);<font></font>
    <font></font>
    debouncers[<span class="hljs-built_in">i</span>].attach( pins[<span class="hljs-built_in">i</span>] );<font></font>
    debouncers[<span class="hljs-built_in">i</span>].interval(<span class="hljs-number">5</span>);<font></font>
  }<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ich werde nichts √ºber den ersten Zyklus sagen, wir werden etwas sp√§ter darauf zur√ºckkommen. </font><font style="vertical-align: inherit;">Und das Interessanteste beginnt im Hauptzyklus.</font></font><br>
<br>
<pre><code class="hljs matlab">void loop(){
  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>){<font></font>
    byte dvalue = EEPROM.read(pins[<span class="hljs-built_in">i</span>]);
    <span class="hljs-keyword">if</span>(dvalue!=<span class="hljs-number">11</span>) {<font></font>
      changed[<span class="hljs-built_in">i</span>] = debouncers[<span class="hljs-built_in">i</span>].update();<font></font>
      <font></font>
      <span class="hljs-keyword">if</span> ( changed[<span class="hljs-built_in">i</span>] ) {<font></font>
        int value = debouncers[<span class="hljs-built_in">i</span>].read();
        <span class="hljs-keyword">if</span> ( value == HIGH) {<font></font>
         button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">0</span>;   <font></font>
        } <span class="hljs-keyword">else</span> {
           <span class="hljs-keyword">if</span> (<span class="hljs-built_in">i</span> &gt; <span class="hljs-number">0</span> and pins[<span class="hljs-built_in">i</span>] == pins[<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>]) {<font></font>
             byte prev_value = EEPROM.read(leds[<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>]);<font></font>
                            <font></font>
             <span class="hljs-keyword">if</span>(prev_value == <span class="hljs-number">11</span>) {<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], LOW );<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">11</span>);<font></font>
             }<span class="hljs-keyword">else</span>{<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], HIGH);<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
             }<font></font>
           } <span class="hljs-keyword">else</span> {               <font></font>
             byte value = EEPROM.read(leds[<span class="hljs-built_in">i</span>]);
             <span class="hljs-keyword">if</span>(value==<span class="hljs-number">11</span>) {<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], HIGH );<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
             }<span class="hljs-keyword">else</span>{<font></font>
               digitalWrite(leds[<span class="hljs-built_in">i</span>], LOW);<font></font>
               EEPROM.write(leds[<span class="hljs-built_in">i</span>], <span class="hljs-number">11</span>);<font></font>
             }<font></font>
           }<font></font>
                 <font></font>
           button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">1</span>;<font></font>
           buttonPressTimeStamps[<span class="hljs-built_in">i</span>] = millis();     <font></font>
        }<font></font>
      }<font></font>
   <font></font>
      <span class="hljs-keyword">if</span> ( button_states[<span class="hljs-built_in">i</span>] == <span class="hljs-number">1</span> ) {
        <span class="hljs-keyword">if</span> ( millis() - buttonPressTimeStamps[<span class="hljs-built_in">i</span>] &gt;= <span class="hljs-number">200</span> ) {<font></font>
            button_states[<span class="hljs-built_in">i</span>] = <span class="hljs-number">2</span>;<font></font>
        }<font></font>
      }<font></font>
    }<font></font>
  }<font></font>
<font></font>
  delay( <span class="hljs-number">10</span> );<font></font>
} <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei Tests der ersten Versionen des Algorithmus wurde festgestellt, dass die Kinder (und ich habe drei von ihnen, Jungen) sehr gerne auf die Schalter klickten. </font><font style="vertical-align: inherit;">Daher war es notwendig, einige Schalter ausschalten zu k√∂nnen, damit der Controller nicht darauf reagierte. </font><font style="vertical-align: inherit;">Die naheliegendste M√∂glichkeit besteht darin, einfach die erforderlichen Stifte von der Platine zu entfernen. Dies ist jedoch falsch und uninteressant. </font><font style="vertical-align: inherit;">Daher werden Flags auch in den nichtfl√ºchtigen Speicher geschrieben, um anzuzeigen, ob der Schalter ge√∂ffnet ist oder nicht. </font><font style="vertical-align: inherit;">Dies wird mit dieser Schleife initialisiert:</font></font><br>
<br>
<pre><code class="hljs matlab">  <span class="hljs-keyword">for</span>(byte <span class="hljs-built_in">i</span>=<span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>&lt;cnt; <span class="hljs-built_in">i</span>=<span class="hljs-built_in">i</span>+<span class="hljs-number">1</span>) {<font></font>
    EEPROM.write(pins[<span class="hljs-built_in">i</span>], <span class="hljs-number">10</span>);<font></font>
  }<font></font>
<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und hier √ºberpr√ºft:</font></font><br>
<br>
<pre><code class="hljs lisp">  for(<span class="hljs-name">byte</span> i=0<span class="hljs-comment">; i&lt;cnt; i=i+1){</span>
    byte dvalue = EEPROM.read(<span class="hljs-name">pins</span>[i])<span class="hljs-comment">;</span>
    if(<span class="hljs-name">dvalue!=11</span>) {<font></font>
    ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bereits zu diesem Zeitpunkt begannen lokale Schalter an den W√§nden zu funktionieren. Aber ein Smart Home w√§re ohne eine Schnittstelle nicht intelligent. Da ich mich mit Webentwicklung besch√§ftige, wurde beschlossen, ein Webinterface zu erstellen. Hier haben sich Ethernet-Schilde als n√ºtzlich erwiesen. Leider konnte ich die Quellen der ersten Versionen von Programmen nicht finden, die Ethernet-Schutzschilde f√ºr die Fernsteuerung verwenden. Ich werde versuchen, in Backups zu suchen, vielleicht sind sie da. Aber die Bedeutung war primitiv f√ºr die Schande. Jeder Controller hat seine eigene IP-Adresse. Auf dem Arduino stieg ein Webserver an, der GET-Anforderungen analysierte und die entsprechende Lampe je nach Portnummer ein- oder ausschaltete. Es gibt viele Beispiele dieser Art im Internet. F√ºr die Weboberfl√§che wurde auf dem Motherboard ein Server mit integriertem Intel Atom erstellt, Ubuntu Server 14.02 wurde installiert, das Standard-LAMP-Set wurde installiert,Dort ist eine einfache Schnittstelle geschrieben. Alle Quellen finden Sie auch am Ende des Artikels. Im Moment sieht es so aus:</font></font><br>
<br>
<img src="https://habrastorage.org/files/7ba/5b2/d4c/7ba5b2d4c95c48f0ac3873cef3c76b23.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie Sie sehen, ist eine Lampe in der K√ºche eingeschaltet und der daf√ºr verantwortliche Schalter verriegelt. Die Verwaltung ist mega einfach - klicken Sie einfach auf das gew√ºnschte Element und dessen Status √§ndert sich.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und alles w√§re gro√üartig, wenn nicht ein "aber". Ethernet-Abschirmungen hingen st√§ndig. Nein, die lokale Steuerung √ºber die Schalter funktionierte immer wie eine Uhr. Die Fernbedienung √ºber das Webinterface fiel jedoch st√§ndig aus. Wenn das Management einen Tag lang arbeitete, war es ausgezeichnet. Aber √∂fter hing der Schild nur wenige Stunden nach dem Neustart. Was ich einfach nicht getan habe, war zu versuchen, mit Wachhunden umzugehen, aber meine Boards haben es nicht unterst√ºtzt. Ich bestellte in China und ersetzte die Schilde durch andere - auf en28j60 - es wurde besser, aber sie legten immer noch regelm√§√üig auf. Ich f√ºgte dem Controller ein Relaismodul hinzu, versorgte die Arduino-Karten √ºber normalerweise geschlossene Kontakte mit Strom, und eine der Arduino-Karten zog das Relais mit einer bestimmten Frequenz und die Stromversorgung wurde abgeschaltet, und dann wurde es wiederhergestellt - dies funktionierte jedoch auch nicht immer und blinkte zum Zeitpunkt des Neustarts Licht an,sogar f√ºr ein paar Sekunden, aber trotzdem. So sah der Controller zu diesem Zeitpunkt aus:</font></font><br>
<br>
<img src="https://habrastorage.org/files/ab0/71d/eb3/ab071deb30a94677a261c5378a809124.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dann wurde beschlossen, die Ethernet-Schilde vollst√§ndig aufzugeben. Ich suchte nach anderen Remoteverwaltungsfunktionen. Ich habe versucht, Arduins direkt mit dem Server zu verbinden und Befehle √ºber Serial.read () / Serial.print () zu senden - es funktionierte jedes Mal, Stabilit√§t wurde nicht erreicht, da die Karte bei jedem Zugriff √ºber ein Skript neu gestartet wurde auf dem Server. Ich habe viel √ºber solche Fehler gelesen, ich habe nur festgestellt, dass es mit dem DTR verbunden ist, irgendwo haben sie geschrieben, dass man den Port mit anderen Flags initialisieren kann, und Beispiele gegeben, die f√ºr mich nicht funktionierten. Nach einer Weile stie√ü ich auf einen Artikel √ºber die Herstellung eines USB-I2C-Adapters aus einem USBAsp-Programmierer. Ich entschied - warum nicht? Ich bestellte ein paar solcher Programmierer bei den Chinesen - und wartete.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und vor einer Woche ist mein Paket angekommen. </font><font style="vertical-align: inherit;">Ein Programmierer wurde mit der winzigen USB-Firmware von i2c geflasht, und ich setzte mich erneut hin, um den Code neu zu schreiben. </font><font style="vertical-align: inherit;">Hier begannen die Protokollmerkmale zu erscheinen. </font><font style="vertical-align: inherit;">Nat√ºrlich war der Server der Master und alle Arduino-Boards waren Slaves. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code sollte die folgenden Aufgaben l√∂sen: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - den Status des angeforderten Ports melden; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - den Status des angeforderten Ports √§ndern; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 - Alle Lichter aus- oder einschalten. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und ich bin auf ein Problem gesto√üen. </font><font style="vertical-align: inherit;">Ich kann die Standardbefehle aus der i2c-tools-Suite verwenden, um mit Arduino-Boards zu kommunizieren. </font><font style="vertical-align: inherit;">Das ist ein Team</font></font><br>
<br>
<pre><code class="bash hljs">i2cget -y &lt; &gt; &lt;&gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
und</font></font><br>
<br>
<pre><code class="bash hljs">i2cset -y &lt; &gt; &lt;&gt; 0x00 &lt;byte &gt;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nach dem Mann zu urteilen, k√∂nnte man den Wortwert √ºbergeben, aber es hat bei mir nicht funktioniert, oder ich habe mich irgendwo geirrt. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Das Problem ist, dass ich, wenn ich den Status eines bestimmten Ports √§ndern muss, zuerst die Nummer des f√ºr diesen Vorgang verantwortlichen Befehls und dann die Portnummer √ºbergeben muss. </font><font style="vertical-align: inherit;">Ich habe sogar versucht, dies zu tun, 2 Befehle zu senden und sie im Code zu sammeln - aber es war h√§sslich und irrational. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Problem Nummer zwei - Arduino kann im Moment, in dem sie die Daten empf√§ngt, nichts beantworten. </font><font style="vertical-align: inherit;">Es gibt zwei Methoden der Wire-Bibliothek: onReceive (), wenn Daten vom Master empfangen werden, und onRequest (), wenn Daten vom Master angefordert werden. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Also habe ich folgendes gemacht: Der Webserver hat 6 Befehle:</font></font><br>
<br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl "1" - Ermittelt den Status aller Lichter</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl "2" - Ermittelt den Sperrstatus aller Schalter</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl "5" - Schalte die ganze Welt ein</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Befehl "6" - Schalte die ganze Welt aus</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ein Befehl, der wie folgt gebildet wird: eine Dezimalzahl der folgenden Form &lt;Hunderte (1 oder 2) - Lampe oder Schaltersperre schalten&gt; &lt;Portnummer (von 0 auf 99)&gt;; </font><font style="vertical-align: inherit;">Zum Beispiel 105 - Switch 5 Port, 213 - Switch 13 Port Lock. </font><font style="vertical-align: inherit;">Dieser Befehl wird in hex √ºbersetzt und an das Arduino √ºbergeben, das die inversen Transformationen ausf√ºhrt und versteht, was zu tun ist. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
So sieht es auf der Serverseite aus:</font></font><br>
<br>
<pre><code class="php hljs">  ...
  <span class="hljs-keyword">if</span> ($action == <span class="hljs-number">3</span>)<font></font>
     $val_hex = dechex(intval($port) + <span class="hljs-number">100</span>);
  <span class="hljs-keyword">else</span>
     $val_hex = dechex(intval($port) + <span class="hljs-number">200</span>);<font></font>
  <font></font>
  exec(<span class="hljs-string">"sudo i2cset -y 7 $addr 0x00 0x$val_hex"</span>, $output);<font></font>
  ...<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und von der Seite des Arduino:</font></font><br>
<br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">receiveEvent</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> howMany</span>)</span> {
  <span class="hljs-keyword">byte</span> bytes = Wire.available();
  <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">1</span>; i &lt;= bytes; i=i+<span class="hljs-number">1</span>) {<font></font>
    x = Wire.read();<font></font>
  }<font></font>
  <font></font>
  <span class="hljs-keyword">if</span> (x == <span class="hljs-number">1</span> or x == <span class="hljs-number">2</span> or x == <span class="hljs-number">5</span> or x == <span class="hljs-number">6</span>) {<font></font>
    do_action(x, <span class="hljs-number">0</span>);<font></font>
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> ( x &gt; <span class="hljs-number">200</span>) {<font></font>
      do_action (<span class="hljs-number">4</span>, x - <span class="hljs-number">200</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      do_action (<span class="hljs-number">3</span>, x - <span class="hljs-number">100</span>);<font></font>
    }<font></font>
  }  <font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es sieht ziemlich primitiv aus, aber es funktioniert. </font><font style="vertical-align: inherit;">Das zweite Problem wird wie folgt gel√∂st. </font><font style="vertical-align: inherit;">Hier ist die Funktion do_action:</font></font><br>
<br>
<pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">do_action</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span> command, <span class="hljs-keyword">byte</span> port</span>)</span> {
  <span class="hljs-keyword">byte</span> <span class="hljs-keyword">value</span> = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">byte</span> dvalue = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">switch</span> (command) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<font></font>
      start_request = <span class="hljs-literal">true</span>;<font></font>
      request_type = <span class="hljs-number">1</span>;<font></font>
      current_port = <span class="hljs-number">0</span>;<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<font></font>
      start_request = <span class="hljs-literal">true</span>;<font></font>
      request_type = <span class="hljs-number">2</span>;<font></font>
      current_port = <span class="hljs-number">0</span>;<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
      <span class="hljs-keyword">value</span> = EEPROM.read(port);
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>==<span class="hljs-number">11</span>) {<font></font>
        digitalWrite(port, HIGH);<font></font>
        EEPROM.write(port, <span class="hljs-number">10</span>);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        digitalWrite(port, LOW);<font></font>
        EEPROM.write(port, <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<font></font>
      dvalue = EEPROM.read(port);<font></font>
      <span class="hljs-keyword">if</span>(dvalue==<span class="hljs-number">11</span>) {<font></font>
        EEPROM.write(port, <span class="hljs-number">10</span>);<font></font>
      } <span class="hljs-keyword">else</span> {<font></font>
        EEPROM.write(port, <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">0</span>; i&lt;cnt; i = i + <span class="hljs-number">1</span>) {<font></font>
        digitalWrite(leds[i], LOW);<font></font>
        EEPROM.write(leds[i], <span class="hljs-number">11</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">byte</span> i=<span class="hljs-number">0</span>; i&lt;cnt; i = i + <span class="hljs-number">1</span>) {<font></font>
        digitalWrite(leds[i], HIGH);<font></font>
        EEPROM.write(leds[i], <span class="hljs-number">10</span>);<font></font>
      }<font></font>
      <font></font>
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:<font></font>
      <font></font>
    <span class="hljs-keyword">break</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bei den Teams 3-6 ist alles klar, aber die Teams 1 oder 2 k√∂nnen detaillierter beschrieben werden. </font><font style="vertical-align: inherit;">Der Server sendet zuerst den gew√ºnschten Befehl, und wenn der Arduino den Befehl 1 oder 2 empf√§ngt, werden die Flags initialisiert:</font></font><br>
<br>
<pre><code class="hljs nginx">  <span class="hljs-attribute">start_request</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-attribute">request_type</span> = <span class="hljs-number">1</span>;
  <span class="hljs-attribute">current_port</span> = <span class="hljs-number">0</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Und dann beginnt der Server, Anfragen so oft an das Arduino zu senden, wie die Ports, die er abfragen m√∂chte. </font><font style="vertical-align: inherit;">Auf der Serverseite:</font></font><br>
<br>
<pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_data</span>(<span class="hljs-params">$address, $action, $cnt</span>) </span>{<font></font>
	exec(<span class="hljs-string">"sudo i2cset -y 7 $address 0x00 0x0$action"</span>, $output);<font></font>
	$tmp = @$output[<span class="hljs-number">0</span>];
	<span class="hljs-keyword">while</span> (strpos($tmp,<span class="hljs-string">"rror"</span>)!==<span class="hljs-literal">false</span>) {<font></font>
		exec(<span class="hljs-string">"sudo i2cset -y 7 $address 0x00 0x0$action"</span>, $output);<font></font>
		$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
	}<font></font>
	$str = <span class="hljs-string">""</span>;
	<span class="hljs-keyword">for</span> ($i = <span class="hljs-number">1</span>; $i &lt;= $cnt; $i++) {<font></font>
		exec(<span class="hljs-string">"sudo i2cget -y 7 $address"</span>, $output);<font></font>
		$tmp = @$output[<span class="hljs-number">0</span>];
		<span class="hljs-keyword">while</span> (strpos($tmp,<span class="hljs-string">"rror"</span>)!==<span class="hljs-literal">false</span>) {<font></font>
			exec(<span class="hljs-string">"sudo i2cget -y 7 $address"</span>, $output);<font></font>
			$tmp = @$output[<span class="hljs-number">0</span>];<font></font>
		}<font></font>
		<span class="hljs-keyword">if</span> ($tmp) {
			<span class="hljs-keyword">if</span> (strpos($tmp,<span class="hljs-string">"1"</span>)!==<span class="hljs-literal">false</span>)<font></font>
				$str .= <span class="hljs-string">"1"</span>;
			<span class="hljs-keyword">else</span>
				$str .= <span class="hljs-string">"0"</span>;<font></font>
		}<font></font>
		<span class="hljs-keyword">unset</span>($output);
		<span class="hljs-keyword">unset</span>($tmp);<font></font>
	}<font></font>
			<font></font>
	<span class="hljs-keyword">return</span> $str;<font></font>
}<font></font>
<font></font>
$str = <span class="hljs-keyword">array</span>();<font></font>
$c = <span class="hljs-number">1</span>;
<span class="hljs-keyword">while</span> ($c &lt;= $tryes) {<font></font>
	$tmp = get_data($addr, $action, $cnt);<font></font>
	<font></font>
	<span class="hljs-keyword">if</span> (strlen($tmp) == $cnt)<font></font>
		$str[] = $tmp;<font></font>
	<font></font>
	$c++;<font></font>
}<font></font>
<font></font>
$new_array = array_count_values($str);<font></font>
<font></font>
asort($new_array);<font></font>
<font></font>
$res = <span class="hljs-string">""</span>;<font></font>
$max = <span class="hljs-number">0</span>;
<span class="hljs-keyword">foreach</span> ($new_array <span class="hljs-keyword">AS</span> $key=&gt;$val) {
	<span class="hljs-keyword">if</span> ($val &gt;= $max) {<font></font>
		$res = $key;<font></font>
		$max = $val;<font></font>
	}<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword">return</span> preg_split(<span class="hljs-string">'//'</span>, $res, <span class="hljs-number">-1</span>, PREG_SPLIT_NO_EMPTY);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kurz gesagt - wir machen mehrere ($ tryes&gt; 3) Versuche, das Arduino abzufragen. Wir erhalten eine Zeile bestehend aus 0 oder 1. √úberall, wo wir mit einem Befehl die Antwort sehen, wenn das Wort Fehler vorhanden ist, bedeutet dies, dass w√§hrend der √úbertragung Fehler aufgetreten sind und Sie die √úbertragung wiederholen m√ºssen . </font><font style="vertical-align: inherit;">Es wurden mehrere Versuche unternommen, um die Richtigkeit der √ºbertragenen Zeichenfolge sicherzustellen. Das Array wird mithilfe der Methode array_count_values ‚Äã‚Äã($ str) durch eine Zeichenfolge reduziert. </font><font style="vertical-align: inherit;">und am Ende erhalten wir ein Array mit der Anzahl der Vorkommen derselben Zeilen. Wir geben die Zeile aus, die wir am meisten von Arduino erhalten haben. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Von der Seite des Arduino ist alles einfacher:</font></font><br>
<br>
<pre><code class="hljs pgsql"><span class="hljs-type">void</span> requestEvent() {
  <span class="hljs-keyword">if</span> (request_type == <span class="hljs-number">1</span>) {<font></font>
    byte <span class="hljs-keyword">value</span> = EEPROM.<span class="hljs-keyword">read</span>(leds[current_port]);
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">value</span>==<span class="hljs-number">11</span>) {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
    <font></font>
    current_port = current_port + <span class="hljs-number">1</span>;<font></font>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (request_type == <span class="hljs-number">2</span>) {<font></font>
    byte dvalue = EEPROM.<span class="hljs-keyword">read</span>(pins[current_port]);
    <span class="hljs-keyword">if</span>(dvalue==<span class="hljs-number">11</span>) {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">1</span>);<font></font>
    } <span class="hljs-keyword">else</span> {<font></font>
      Wire.<span class="hljs-keyword">write</span>(<span class="hljs-number">0</span>);<font></font>
    }<font></font>
<font></font>
    current_port = current_port + <span class="hljs-number">1</span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Der Code der Webseite enth√§lt die Steuerelemente:</font></font><br>
<br>
<pre><code class="html hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp living_room"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d3"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 3);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp kitchen"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d4"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 4);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp children_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d5"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 5);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp children_second"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x4d6"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x4d'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x4d',this.id, 6);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x423"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 3);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_lyuda"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x424"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 4);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"lamp sleeproom_anton"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lamp0x425"</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">'0x42'</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"lamp_click('0x42',this.id, 5);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><font></font>
<font></font>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_living_room"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d15"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 15);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_kitchen"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d14"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 14);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_children_main"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d16"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 16);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_children_second"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4d17"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x4d',this.id, 17);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_door1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4212"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 12);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_door2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4213"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 13);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_lyuda1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4214"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 14);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_lyuda2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4215"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 15);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_anton1"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4216"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 16);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"button button_sleeproom_anton2"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"button0x4217"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"button_click('0x42',this.id, 17);"</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eigentlich gebe ich explizit die Adresse der Karte an, auf die ich zugreifen muss, und die Portnummer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oh ja, der Controller sieht jetzt so aus:</font></font><br>
<br>
<img src="https://habrastorage.org/files/05d/20e/6f0/05d20e6f0e8747bc940f202e2606fd2a.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nachdem alles installiert war, wurde alles beim ersten Mal gestartet. Und am n√§chsten Tag trat ein unverst√§ndlicher Effekt auf - wenn Sie alle Lichter im Schlafzimmer einschalten, beginnt das gesamte Licht im Schlafzimmer alle 2 bis 3 Sekunden zu blinken. Ich habe die ganze Nacht damit verbracht, den Code auszuw√§hlen. Auf dem Pr√ºfstand befand sich kein solcher Pfosten. Das Problem liegt also nicht im Code. Ich kramte in einer Reihe von Foren, fand in einer Toga in einem von ihnen eine Beschreibung eines √§hnlichen Symptoms, √ºberpr√ºfte meine Vermutung - und das Problem verschwand. Und die Sache war, dass ich alle drei Arduins von einem Computer-Netzteil, 12 V, speiste und der alte Freeduino leise a√ü und nicht summte, und Arduino uno v3 konnte nicht, und als alle Relais eingeschaltet waren, wurde der Leistungsregler so erw√§rmt, dass Es war unm√∂glich zu ber√ºhren. Reduzierte die Versorgungsspannung auf 5V 2A - und es funktionierte wie es sollte.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt viele Pl√§ne, wir m√ºssen die Reparatur in der Wohnung abschlie√üen, der Korridor und das Badezimmer mit der Toilette sind in einer Linie, in meinen Tr√§umen m√∂chte ich den Warmwasserbereiter und jede Steckdose steuern, da ich jetzt jede Menge Arduin an den I2C-Bus h√§ngen kann und jeder sein eigenes Ding machen wird. </font><font style="vertical-align: inherit;">Es ist auch geplant, der Din-Schiene Impulsrelais hinzuzuf√ºgen, damit die Relaismodule nur diese Impulsrelais steuern und bereits die gesamte Last durch diese geht. </font><font style="vertical-align: inherit;">Weil es ernsthafte Zweifel an der Zuverl√§ssigkeit chinesischer Relaismodule gibt. </font><font style="vertical-align: inherit;">Aber das ist alles in der Zukunft. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie versprochen, Links zu github: Sketchy </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Webinterface </font></font></a><br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f√ºr Arduino</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de386457/">https://habr.com/ru/post/de386457/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de386443/index.html">Moderne Technologie eliminiert das Schnarchen: das nicht-invasive Nora-System</a></li>
<li><a href="../de386447/index.html">Der Location Magic-Dienst verfolgt die Position Ihres Ger√§ts ohne GPS</a></li>
<li><a href="../de386449/index.html">29 US-Dollar f√ºr Anweisungen zum Aufbau eines Transformatorentisches</a></li>
<li><a href="../de386451/index.html">Optimale Interaktion mit Smartwatches: SHIFT-Armband</a></li>
<li><a href="../de386455/index.html">Ein Rechenkriterium zur Bestimmung des Planeten wird vorgeschlagen.</a></li>
<li><a href="../de386459/index.html">Ein alter Freund ist besser als zwei neue. Landschaftsgenerator. Teil 1</a></li>
<li><a href="../de386461/index.html">–°–ø—É—Ç–Ω–∏–∫ –ú–∞—Ä—Å–∞ –§–æ–±–æ—Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞–∑—Ä—É—à–∞–µ—Ç—Å—è –ø–æ–¥ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º –ø—Ä–∏–ª–∏–≤–Ω—ã—Ö —Å–∏–ª</a></li>
<li><a href="../de386463/index.html">Ausweg aus den Schatten: Wie neuer Austausch entsteht</a></li>
<li><a href="../de386465/index.html">3D-Scannen und Drucken in der Pal√§ontologie. Fortsetzung</a></li>
<li><a href="../de386467/index.html">Blizzard verklagt Bot-Entwickler wegen Urheberrechtsverletzung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>