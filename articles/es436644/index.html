<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôçüèª üíÄ üéØ S√≠mbolos sint√©ticos y m√≥dulos (WinDbg / DbgEng) ‚õπüèª üë©‚Äçüë©‚Äçüëß‚Äçüëß ‚èÆÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta publicaci√≥n se centrar√° en los m√≥dulos sint√©ticos y los s√≠mbolos del motor de depuraci√≥n de Windows (motor de depuraci√≥n). Es decir, sobre entida...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>S√≠mbolos sint√©ticos y m√≥dulos (WinDbg / DbgEng)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/436644/"><p>  Esta publicaci√≥n se centrar√° en los m√≥dulos sint√©ticos y los s√≠mbolos del motor de depuraci√≥n de Windows (motor de depuraci√≥n).  Es decir, sobre entidades que pueden agregarse artificialmente al depurador para <em>colorear</em> direcciones de memoria. </p><br><p><img src="https://habrastorage.org/webt/it/zq/x2/itzqx23xm_48b5cu4ues9blvojk.png"></p><a name="habracut"></a><br><h2 id="sinteticheskie-moduli">  M√≥dulos sint√©ticos </h2><br><p>  En general, un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√≥dulo</a> como parte de un motor de depuraci√≥n es una cierta √°rea continua de memoria virtual: la direcci√≥n base del m√≥dulo (direcci√≥n del primer byte del archivo proyectado) y su tama√±o.  Para cada tipo de depuraci√≥n (depuraci√≥n en vivo / an√°lisis de volcado, modo de usuario / modo kernel, etc.), el depurador tiene su propio mecanismo para leer y mantener actualizada la lista de m√≥dulos cargados.  La forma m√°s f√°cil de forzar la actualizaci√≥n de la lista de m√≥dulos cargados es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">el comando .reload con la opci√≥n / s</a> . </p><br><p> Si hablamos, por ejemplo, de la depuraci√≥n en vivo del proceso en modo usuario, la lista de m√≥dulos cargados se construye de acuerdo con <a href="">tres listas principales del cargador</a> : una lista de orden de carga de m√≥dulos (InLoadOrderModuleList), una lista de m√≥dulos en memoria (InMemoryOrderModuleList) y una lista de prioridad de inicializaci√≥n (InInitializationOrderModuleList).  Por un lado, no hay ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">casi</a> ) nada que nos impida tomar datos arbitrarios (de un archivo <abbr title="Ejecutable port√°til">PE</abbr> en el disco, por ejemplo) y marcarlos en la memoria para su ejecuci√≥n con nuestras propias manos.  Por otro lado, las t√©cnicas para eliminar <abbr title="Biblioteca de enlaces din√°micos">DLL</abbr> cargadas con medios regulares de las tres listas de cargadores anteriores (ocultar el m√≥dulo) se conocen desde hace mucho tiempo. </p><br><p>  En ambos casos, al depurar esta situaci√≥n, ser√° √∫til marcar el √°rea del m√≥dulo oculto.  Para esto, los m√≥dulos sint√©ticos son adecuados.  Como experimento pr√°ctico, simplemente puede hacer que WinDbg suelte el m√≥dulo cargado de su lista interna con el mismo comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.reload, pero con la opci√≥n / u</a> . </p><br><p>  Adem√°s, en la calidad de los listados enumerados, utilizar√© la depuraci√≥n habitual del proceso del modo de usuario (notepad.exe).  Primero, recuerde la direcci√≥n base del m√≥dulo ntdll (0x07ffa8a160000) y calcule su tama√±o (0x01e1000): </p><br><pre><code class="plaintext hljs">0:007&gt; lm m ntdll Browse full module list start end module name 00007ffa`8a160000 00007ffa`8a341000 ntdll 0:007&gt; ? 00007ffa`8a341000-00007ffa`8a160000 Evaluate expression: 1970176 = 00000000`001e1000</code> </pre> <br><p>  Considere una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lista de la</a> funci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RtlFreeSid</a> simple del m√≥dulo ntdll, que llama a la funci√≥n RtlFreeHeap de este m√≥dulo, recordando simult√°neamente las direcciones de los caracteres RtlFreeSid y RtlFreeHeap (0x7ffa8a1cbc20 y 0x7ffa8a176df0): </p><br><pre> <code class="plaintext hljs">0:007&gt; uf ntdll!RtlFreeSid ntdll!RtlFreeSid: 00007ffa`8a1cbc20 4053 push rbx 00007ffa`8a1cbc22 4883ec20 sub rsp,20h 00007ffa`8a1cbc26 488bd9 mov rbx,rcx 00007ffa`8a1cbc29 33d2 xor edx,edx 00007ffa`8a1cbc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ffa`8a1cbc34 4c8bc3 mov r8,rbx 00007ffa`8a1cbc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ffa`8a1cbc3b e8b0b1faff call ntdll!RtlFreeHeap (00007ffa`8a176df0) 00007ffa`8a1cbc40 33c9 xor ecx,ecx 00007ffa`8a1cbc42 85c0 test eax,eax 00007ffa`8a1cbc44 480f45d9 cmovne rbx,rcx 00007ffa`8a1cbc48 488bc3 mov rax,rbx 00007ffa`8a1cbc4b 4883c420 add rsp,20h 00007ffa`8a1cbc4f 5b pop rbx 00007ffa`8a1cbc50 c3 ret</code> </pre> <br><p>  Adem√°s, de acuerdo con la lista, es f√°cil calcular el tama√±o de la funci√≥n ntdll! RtlFreeSid: </p><br><pre> <code class="plaintext hljs">0:007&gt; ? 00007ffa`8a1cbc51 - 0x07ffa8a1cbc20 Evaluate expression: 49 = 00000000`00000031</code> </pre> <br><p>  Y el tama√±o de la funci√≥n ntdll! RtlFreeHeap no es importante para nuestro experimento, por lo que, por simplicidad, puede tomarlo igual a un byte. </p><br><p>  Ahora simule ocultar el m√≥dulo ntdll: </p><br><pre> <code class="plaintext hljs">0:007&gt; .reload /u ntdll Unloaded ntdll</code> </pre> <br><p>  El campo de este trabajo con la direcci√≥n de la funci√≥n ntdll! RtlFreeSid en el depurador no es tan informativo (y ya puede acceder al comienzo de la funci√≥n solo por la direcci√≥n virtual): </p><br><pre> <code class="plaintext hljs">0:007&gt; uf 00007ffa`8a1cbc20 00007ffa`8a1cbc20 4053 push rbx 00007ffa`8a1cbc22 4883ec20 sub rsp,20h 00007ffa`8a1cbc26 488bd9 mov rbx,rcx 00007ffa`8a1cbc29 33d2 xor edx,edx 00007ffa`8a1cbc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ffa`8a1cbc34 4c8bc3 mov r8,rbx 00007ffa`8a1cbc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ffa`8a1cbc3b e8b0b1faff call 00007ffa`8a176df0 00007ffa`8a1cbc40 33c9 xor ecx,ecx 00007ffa`8a1cbc42 85c0 test eax,eax 00007ffa`8a1cbc44 480f45d9 cmovne rbx,rcx 00007ffa`8a1cbc48 488bc3 mov rax,rbx 00007ffa`8a1cbc4b 4883c420 add rsp,20h 00007ffa`8a1cbc4f 5b pop rbx 00007ffa`8a1cbc50 c3 ret</code> </pre> <br><p>  Para agregar un m√≥dulo sint√©tico, debe llamar a la interfaz del programa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IDebugSymbols3 :: AddSyntheticModule</a> . <del>  Simplemente no hay comandos integrados que permitan realizar esta llamada (que yo sepa). </del>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mikhail I. Izmestev</a> sugiri√≥ que existe un mecanismo similar: el mismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.reload</a> , pero con el nombre, la direcci√≥n y los par√°metros de tama√±o: "M√≥dulo = Direcci√≥n, Tama√±o" (y, posiblemente, se implementa en m√≥dulos sint√©ticos). </p><br><div class="spoiler">  <b class="spoiler_title">.reload ntdll = 00007ff8`470e1000,001e1000</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">0:007&gt; .reload ntdll=00007ff8`470e1000,001e1000 *** WARNING: Unable to verify timestamp for ntdll *** ERROR: Module load completed but symbols could not be loaded for ntdll 0:007&gt; uf 00007ff8`4714bc20 ntdll+0x6ac20: 00007ff8`4714bc20 4053 push rbx 00007ff8`4714bc22 4883ec20 sub rsp,20h 00007ff8`4714bc26 488bd9 mov rbx,rcx 00007ff8`4714bc29 33d2 xor edx,edx 00007ff8`4714bc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ff8`4714bc34 4c8bc3 mov r8,rbx 00007ff8`4714bc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ff8`4714bc3b e8b0b1faff call ntdll+0x15df0 (00007ff8`470f6df0) 00007ff8`4714bc40 33c9 xor ecx,ecx 00007ff8`4714bc42 85c0 test eax,eax 00007ff8`4714bc44 480f45d9 cmovne rbx,rcx 00007ff8`4714bc48 488bc3 mov rax,rbx 00007ff8`4714bc4b 4883c420 add rsp,20h 00007ff8`4714bc4f 5b pop rbx 00007ff8`4714bc50 c3 ret</code> </pre> </div></div><br><p>  Bueno, usaremos la extensi√≥n del depurador, y aqu√≠ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pykd</a> vendr√° al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">rescate</a> <img src="https://habrastorage.org/webt/kz/-m/2t/kz-m2tie3aamd7obq0j1pmczjn8.png">  .  En la √∫ltima versi√≥n (en el momento de la redacci√≥n) <a href="">0.3.4.3</a> , se <a href="">agregaron</a> funciones para administrar m√≥dulos sint√©ticos: <strong>addSyntheticModule</strong> (...) (que es necesario en nuestro caso) y <strong>removeSyntheticModule</strong> (...). </p><br><p>  Usando la direcci√≥n base y el tama√±o del m√≥dulo que se guard√≥ previamente, agregamos informaci√≥n sobre el m√≥dulo ntdll <em>oculto</em> al depurador (en caso de error, se generar√° una excepci√≥n, por lo tanto, la ejecuci√≥n silenciosa es una se√±al de √©xito, las advertencias de impresi√≥n pueden ignorarse): </p><br><pre> <code class="plaintext hljs">0:007&gt; !py Python 2.7.15 (v2.7.15:ca079a3ea3, Apr 30 2018, 16:30:26) [MSC v.1500 64 bit (AMD64)] on win32 Type "help", "copyright", "credits" or "license" for more information. (InteractiveConsole) &gt;&gt;&gt; addSyntheticModule(0x07ffa8a160000, 0x01e1000, 'ntdll') *** WARNING: Unable to verify timestamp for ntdll &gt;&gt;&gt; exit()</code> </pre> <br><p>  Ahora la lista de desensambladores se ha vuelto un poco m√°s informativa: </p><br><pre> <code class="plaintext hljs">0:007&gt; uf 00007ffa`8a1cbc20 ntdll+0x6bc20: 00007ffa`8a1cbc20 4053 push rbx 00007ffa`8a1cbc22 4883ec20 sub rsp,20h 00007ffa`8a1cbc26 488bd9 mov rbx,rcx 00007ffa`8a1cbc29 33d2 xor edx,edx 00007ffa`8a1cbc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ffa`8a1cbc34 4c8bc3 mov r8,rbx 00007ffa`8a1cbc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ffa`8a1cbc3b e8b0b1faff call ntdll+0x16df0 (00007ffa`8a176df0) 00007ffa`8a1cbc40 33c9 xor ecx,ecx 00007ffa`8a1cbc42 85c0 test eax,eax 00007ffa`8a1cbc44 480f45d9 cmovne rbx,rcx 00007ffa`8a1cbc48 488bc3 mov rax,rbx 00007ffa`8a1cbc4b 4883c420 add rsp,20h 00007ffa`8a1cbc4f 5b pop rbx 00007ffa`8a1cbc50 c3 ret</code> </pre> <br><p>  M√°s precisamente, vemos que la funci√≥n dentro del m√≥dulo ntdll llama a otra funci√≥n dentro del mismo m√≥dulo. </p><br><h2 id="sinteticheskie-simvoly">  S√≠mbolos sint√©ticos </h2><br><p>  El listado, despu√©s de agregar un m√≥dulo sint√©tico, se ha vuelto m√°s informativo, pero a√∫n no tan elocuente como el original.  Carece de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">caracteres</a> (en nuestro caso, los nombres de las funciones RtlFreeSid y RtlFreeHeap).  Para solucionar esto, se requiere una llamada nuevamente, pero de una interfaz de programa diferente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IDebugSymbols3 :: AddSyntheticSymbol</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pykd</a> otra vez <img src="https://habrastorage.org/webt/kz/-m/2t/kz-m2tie3aamd7obq0j1pmczjn8.png">  listo para ayudarnos con esto: </p><br><pre> <code class="plaintext hljs">0:007&gt; !py Python 2.7.15 (v2.7.15:ca079a3ea3, Apr 30 2018, 16:30:26) [MSC v.1500 64 bit (AMD64)] on win32 Type "help", "copyright", "credits" or "license" for more information. (InteractiveConsole) &gt;&gt;&gt; addSyntheticSymbol(0x07ffa8a1cbc20, 0x31, 'RtlFreeSid') &lt;pykd.syntheticSymbol object at 0x0000014D47699518&gt; &gt;&gt;&gt; addSyntheticSymbol(0x07ffa8a176df0, 1, 'RtlFreeHeap') &lt;pykd.syntheticSymbol object at 0x0000014D476994A8&gt; &gt;&gt;&gt; exit()</code> </pre> <br><p>  El resultado es muy similar al que se usaba al usar los s√≠mbolos del archivo ntdll pdb: </p><br><pre> <code class="plaintext hljs">0:007&gt; uf 00007ffa`8a1cbc20 ntdll!RtlFreeSid: 00007ffa`8a1cbc20 4053 push rbx 00007ffa`8a1cbc22 4883ec20 sub rsp,20h 00007ffa`8a1cbc26 488bd9 mov rbx,rcx 00007ffa`8a1cbc29 33d2 xor edx,edx 00007ffa`8a1cbc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ffa`8a1cbc34 4c8bc3 mov r8,rbx 00007ffa`8a1cbc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ffa`8a1cbc3b e8b0b1faff call ntdll!RtlFreeHeap (00007ffa`8a176df0) 00007ffa`8a1cbc40 33c9 xor ecx,ecx 00007ffa`8a1cbc42 85c0 test eax,eax 00007ffa`8a1cbc44 480f45d9 cmovne rbx,rcx 00007ffa`8a1cbc48 488bc3 mov rax,rbx 00007ffa`8a1cbc4b 4883c420 add rsp,20h 00007ffa`8a1cbc4f 5b pop rbx 00007ffa`8a1cbc50 c3 ret</code> </pre> <br><h2 id="osobennosti-sinteticheskih-suschnostey">  Caracter√≠sticas de las entidades sint√©ticas. </h2><br><p>  Vale la pena se√±alar que la creaci√≥n de s√≠mbolos sint√©ticos est√° permitida en cualquier m√≥dulo existente, y no solo en los sint√©ticos.  Es decir, puede agregar s√≠mbolos tanto a m√≥dulos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">con archivos pdb accesibles</a> como a m√≥dulos para los que no tenemos archivos con informaci√≥n de depuraci√≥n.  Pero no puedes crear personajes fuera de los m√≥dulos.  Es decir, para marcar una direcci√≥n de memoria arbitraria fuera de los l√≠mites de los m√≥dulos existentes, primero debe crear un m√≥dulo sint√©tico envolvente y luego (si es necesario, porque el nombre del m√≥dulo puede ser suficiente para <em>colorear</em> ) crear un s√≠mbolo sint√©tico en √©l. </p><br><p>  Tambi√©n vale la pena mencionar que los m√≥dulos y s√≠mbolos sint√©ticos se pueden quitar con un movimiento <em>descuidado</em> de la mano: </p><br><ul><li>  recargar los s√≠mbolos de depuraci√≥n del m√≥dulo elimina todos los s√≠mbolos sint√©ticos de este m√≥dulo; </li><li>  La recarga de todos los m√≥dulos eliminar√° todos los m√≥dulos sint√©ticos. </li></ul><br><h2 id="synextshttpsgithubcomkiteresynexts">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">! synexts</a> </h2><br><p>  Aunque el uso de <strong>pykd es</strong> conveniente en la gran mayor√≠a de los casos (especialmente teniendo en cuenta la presencia de un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">bootstarpper</a> ), a veces puede entrar en una situaci√≥n en la que tendr√° que gastar un esfuerzo considerable para usar pykd.  Por ejemplo, una vez necesitaba depurar desde la m√°quina host'ovy en la que trabajaba Windows XP.  Al final result√≥ que, pykd no ha sido compatible con XP durante bastante tiempo, y necesitaba caracteres y m√≥dulos sint√©ticos.  Me pareci√≥ que para esta tarea es m√°s f√°cil ensamblar una peque√±a extensi√≥n separada que resolver√° un rango estrecho de tareas necesarias que restaurar el soporte completo de XP para pykd.  Como resultado, se cre√≥ un proyecto separado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">! Synexts</a> . </p><br><p>  Esta es una extensi√≥n simple que tiene dos exportaciones disponibles para el usuario: </p><br><ul><li>  ! synexts.addsymbol: crea un s√≠mbolo sint√©tico en cualquier m√≥dulo existente; </li><li>  ! synexts.addmodule: crea un m√≥dulo sint√©tico en la lista interna del motor de depuraci√≥n. </li></ul><br><p>  Para demostrarlo, simulamos ocultar nuevamente el m√≥dulo ntdll: </p><br><pre> <code class="plaintext hljs">0:007&gt; .reload /u ntdll Unloaded ntdll 0:007&gt; uf 00007ffa`8a1cbc20 00007ffa`8a1cbc20 4053 push rbx 00007ffa`8a1cbc22 4883ec20 sub rsp,20h 00007ffa`8a1cbc26 488bd9 mov rbx,rcx 00007ffa`8a1cbc29 33d2 xor edx,edx 00007ffa`8a1cbc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ffa`8a1cbc34 4c8bc3 mov r8,rbx 00007ffa`8a1cbc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ffa`8a1cbc3b e8b0b1faff call 00007ffa`8a176df0 00007ffa`8a1cbc40 33c9 xor ecx,ecx 00007ffa`8a1cbc42 85c0 test eax,eax 00007ffa`8a1cbc44 480f45d9 cmovne rbx,rcx 00007ffa`8a1cbc48 488bc3 mov rax,rbx 00007ffa`8a1cbc4b 4883c420 add rsp,20h 00007ffa`8a1cbc4f 5b pop rbx 00007ffa`8a1cbc50 c3 ret</code> </pre> <br><p>  Nuevamente, restauramos el conocimiento del m√≥dulo y los s√≠mbolos en forma de entidades sint√©ticas, pero ya utilizamos la extensi√≥n! Synexts: </p><br><pre> <code class="plaintext hljs">0:007&gt; !synexts.addmodule ntdll C:\Windows\System32\ntdll.dll 00007ffa`8a160000 0x01e1000 *** WARNING: Unable to verify timestamp for C:\Windows\System32\ntdll.dll Synthetic module successfully added 0:007&gt; !synexts.addsymbol RtlFreeSid 00007ffa`8a1cbc20 31 Synthetic symbol successfully added 0:007&gt; !synexts.addsymbol RtlFreeHeap 00007ffa`8a176df0 1 Synthetic symbol successfully added</code> </pre> <br><p>  Se supone que ya ha copiado la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca compilada synexts.dll</a> (correspondiente a la profundidad de bits utilizada por WinDbg) en el directorio winext del depurador: </p><br><pre> <code class="plaintext hljs">0:007&gt; .chain Extension DLL search Path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\WINXP;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext\arcade;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\pri;C:\Program Files (x86)\Windows Kits\10\Debuggers\x64;&lt;‚Ä¶&gt; Extension DLL chain: pykd.pyd: image 0.3.4.3, API 1.0.0, built Thu Jan 10 19:56:25 2019 [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext\pykd.pyd] synexts: API 1.0.0, built Fri Jan 18 17:38:17 2019 [path: C:\Program Files (x86)\Windows Kits\10\Debuggers\x64\winext\synexts.dll] &lt;‚Ä¶&gt;</code> </pre> <br><p>  Y nuevamente vemos el resultado de agregar caracteres sint√©ticos al m√≥dulo sint√©tico: </p><br><pre> <code class="plaintext hljs">0:007&gt; uf 00007ffa`8a1cbc20 ntdll!RtlFreeSid: 00007ffa`8a1cbc20 4053 push rbx 00007ffa`8a1cbc22 4883ec20 sub rsp,20h 00007ffa`8a1cbc26 488bd9 mov rbx,rcx 00007ffa`8a1cbc29 33d2 xor edx,edx 00007ffa`8a1cbc2b 65488b0c2560000000 mov rcx,qword ptr gs:[60h] 00007ffa`8a1cbc34 4c8bc3 mov r8,rbx 00007ffa`8a1cbc37 488b4930 mov rcx,qword ptr [rcx+30h] 00007ffa`8a1cbc3b e8b0b1faff call ntdll!RtlFreeHeap (00007ffa`8a176df0) 00007ffa`8a1cbc40 33c9 xor ecx,ecx 00007ffa`8a1cbc42 85c0 test eax,eax 00007ffa`8a1cbc44 480f45d9 cmovne rbx,rcx 00007ffa`8a1cbc48 488bc3 mov rax,rbx 00007ffa`8a1cbc4b 4883c420 add rsp,20h 00007ffa`8a1cbc4f 5b pop rbx 00007ffa`8a1cbc50 c3 ret</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436644/">https://habr.com/ru/post/es436644/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436634/index.html">Solo acerca de la configuraci√≥n interna y externa de la aplicaci√≥n en Unity3D</a></li>
<li><a href="../es436636/index.html">C√≥mo creo un servicio de recomendaci√≥n comunitaria VKontakte</a></li>
<li><a href="../es436638/index.html">Redistribuir ventanas entre monitores despu√©s de salir del modo de suspensi√≥n</a></li>
<li><a href="../es436640/index.html">Mi experiencia en publicidad y desarrollo de aplicaciones Android e iOS</a></li>
<li><a href="../es436642/index.html">Ticket to Ride.Europe: pasos modestos en la aritm√©tica del juego</a></li>
<li><a href="../es436646/index.html">Transl√∫cido en Android y ajuste.</a></li>
<li><a href="../es436648/index.html">Combinando proyectos en diferentes centros de datos</a></li>
<li><a href="../es436650/index.html">3 estrategias ganadoras de monetizaci√≥n de aplicaciones en 2019</a></li>
<li><a href="../es436652/index.html">MPS 2018.3: planes de generaci√≥n, mejoras en el lenguaje de ensamblaje y empaquetado y en el lenguaje del editor, interfaz actualizada</a></li>
<li><a href="../es436654/index.html">Desarrollo de un equipo para consultar datos de la base de datos - parte 4, concluyendo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>