<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëÇüèø üë©‚Äçüé® ‚ûñ QEMU Block Devices üêøÔ∏è üè° üßîüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O QEMU tem v√°rias maneiras de conectar um dispositivo de bloco a uma m√°quina virtual. Inicialmente, isso foi implementado da seguinte maneira: 


-hda...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>QEMU Block Devices</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412825/"><p><img src="https://habrastorage.org/getpro/habr/post_images/65a/367/b43/65a367b437b3a4242250ff30063f4455.png" alt="imagem"></p><br><p>  O QEMU tem v√°rias maneiras de conectar um dispositivo de bloco a uma m√°quina virtual.  Inicialmente, isso foi implementado da seguinte maneira: </p><br><pre><code class="plaintext hljs">-hda /dev/sda1</code> </pre> <br><p>  Assim, discos virtuais conectados nos velhos tempos da virtualiza√ß√£o.  Pode ser usado hoje se quisermos apenas testar alguns liveCDs.  Infelizmente, tem suas desvantagens. <a name="habracut"></a>  : </p><br><ul><li>  Ao conectar discos virtuais, √© poss√≠vel usar apenas a interface considerada como <code>/dev/hda</code> (hda, hdb, hdc, ..) na m√°quina virtual;  Para CD, a op√ß√£o <code>-cdrom</code> √© <code>-cdrom</code> </li><li>  Quando um arquivo (ou dispositivo) √© conectado a uma m√°quina virtual, o QEMU usa apenas as configura√ß√µes padr√£o. </li></ul><br><h2 id="drive">  dirigir </h2><br><p>  Para definir outros par√¢metros (tipo de barramento, uso de cache etc.), a op√ß√£o <code>-drive</code> foi adicionada ao <code>-drive</code> .  Embora tenha sido originalmente usado para definir par√¢metros para o <em>back</em> - <em>end</em> e o <em>front</em> - <em>end</em> , atualmente √© usado <strong>apenas</strong> para definir os par√¢metros de <em>back</em> - <em>end</em> , ou seja, par√¢metros que afetam a conex√£o do dispositivo virtual dentro da m√°quina virtual </p><br><pre> <code class="plaintext hljs">-drive file=/dev/sda1,if=ide,cache=writeback,aio=threads</code> </pre> <br><h2 id="device">  dispositivo </h2><br><p>  Definir todos os par√¢metros de um dispositivo de bloco com uma op√ß√£o ao longo do tempo n√£o era razo√°vel.  Portanto, as op√ß√µes foram divididas em duas.  Par√¢metros de <em>back-end</em> , ou seja, aqueles usados ‚Äã‚Äãpara configurar o ambiente de virtualiza√ß√£o.  E <em>front-end</em> , que afeta como o dispositivo est√° conectado na m√°quina virtual.  Para esse conjunto de par√¢metros, uma nova op√ß√£o <code>-device</code> foi introduzida, que cont√©m o <em>ID do ID do</em> inversor especificado pelo par√¢metro <code>-drive</code> . </p><br><p>  O exemplo de configura√ß√£o a seguir conectar√° a unidade ao <strong>identificador ide0-hd0</strong> e o resultado ser√° o mesmo que conectar uma unidade virtual, conforme mostrado na introdu√ß√£o. </p><br><pre> <code class="plaintext hljs">-drive file=/dev/sda1,id=ide0-hd0,if=none,cache=writeback,aio=threads \ -device ide-drive,bus=ide.0,drive=ide0-hd0</code> </pre> <br><h1 id="lokalnye-blochnye-ustroystva-v-virtualnoy-mashine">  Dispositivos de bloco local em uma m√°quina virtual </h1><br><p> <a href=""><img src="https://habrastorage.org/webt/iu/bk/t0/iubkt0a0zeavkt_ntiqdcmg45bw.png"></a> </p><br><p>  Atualmente, o uso de dispositivos de bloco f√≠sico para m√°quinas virtuais n√£o √© generalizado, devido ao uso generalizado de discos virtuais.  Tecnicamente, somos capazes de executar uma m√°quina virtual com algum sistema propriet√°rio a partir de um disco r√≠gido antigo.  No entanto, nesse caso, √© melhor criar uma imagem de disco usando o <strong>dd</strong> e iniciar o sistema a partir dele. </p><br><p>  Como um dispositivo de bloco local, ele pode ser conectado a uma m√°quina virtual. </p><br><ul><li>  Matriz RAID local - dispositivo do tipo <em>md</em> </li><li>  DRBD principal (rede RAID1) - <em>dispositivo do</em> tipo <em>drbd</em> </li><li>  Parti√ß√£o de disco criada no grupo LVM - dispositivo do tipo <em>dm</em> </li><li>  Um arquivo comum conectado via loop √© um dispositivo de loop </li><li><p>  Bloquear dispositivo de outro computador exportado via servidor NBD - <em>dispositivo do</em> tipo <em>nbd</em> </p><br><p>  <em>(Aqui tamb√©m vale a pena mencionar sobre o tipo de dispositivo Ceph rbd e o tipo de dispositivo ZFS zvol - aprox. Por)</em> <br><br></p><br><h2 id="nbd">  NBD </h2><br><p>  Considere o conceito de conectar um dispositivo de bloco de um computador remoto em uma rede.  Consulte o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">manual separado para NBD</a> . </p><br></li></ul><br><p> <a href=""><img src="https://habrastorage.org/webt/on/dy/nf/ondynfow2qyce6r0j65pjmqwnqo.png" align="right"></a> <a href=""><img src="https://habrastorage.org/webt/tq/uv/am/tquvamsriwa3hlj4sh3972xbvyq.png" align="left"></a>  O QEMU possui uma API NBD integrada, para que um dispositivo de bloco remoto expandido com um servidor NBD possa ser conectado diretamente √† m√°quina virtual via QEMU - veja a figura √† esquerda. </p><br><p>  No entanto, o NBD √© um protocolo bastante simples que n√£o usa autentica√ß√£o em um servidor remoto e n√£o controla o status da conex√£o.  O protocolo NBD pressup√µe que o cliente possa se reconectar se a conex√£o com o servidor for interrompida, mas infelizmente o QEMU n√£o. </p><br><p>  Em parte, a situa√ß√£o pode ser resolvida conectando v√°rios dispositivos NBD e criando uma matriz RAID virtual dentro deles.  Essa abordagem tem v√°rias vantagens e uma falha fatal.  Se um dos dispositivos desligar, nada de ruim acontecer√°.  Mas se eles voarem de uma s√≥ vez = ser√° ruim.  As opera√ß√µes de E / S em um ambiente virtual ser√£o muito mais r√°pidas, pois as solicita√ß√µes ser√£o executadas paralelamente a v√°rias m√°quinas f√≠sicas (servidores NBD) de uma s√≥ vez.  Mas, por outro lado, exigir√° mais recursos do processador virtual e da mem√≥ria virtual. </p><br><p>  A principal desvantagem da cria√ß√£o de uma matriz RAID a partir de dispositivos NBD em uma m√°quina virtual √© o dispositivo QEMU; se o dispositivo NBD travar, ele ser√° reconectado somente ap√≥s uma <strong>reinicializa√ß√£o completa da</strong> m√°quina, enquanto uma reinicializa√ß√£o interna do sistema operacional dentro da m√°quina virtual n√£o ser√° suficiente.  Mas voc√™ pode criar uma m√°quina virtual sem discos que acessem independentemente o servidor NBD e conectem os dispositivos NBD necess√°rios.  Al√©m disso, os dispositivos com falha devem ser adicionados novamente √† matriz e sincronizados novamente, isso pode ser feito manualmente ou usando scripts dentro da m√°quina virtual. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/2z/hj/h8/2zhjh8517alwckyyggummg1-wj8.png" align="left"></a>  √â melhor acessar o servidor NBD usando o dispositivo da m√°quina virtual NBD.  Especialmente bom, em termos de desempenho de E / S, √© a constru√ß√£o de uma matriz RAID a partir de dispositivos NBD. </p><br><p>  Essa solu√ß√£o acabou sendo absolutamente a mais produtiva de todas as testadas.  E a m√°quina virtual conseguiu continuar a opera√ß√£o ininterrupta, mesmo no caso de uma desconex√£o do servidor NBD (ou falha) ao longo do tempo. </p><br><p>  Assim, foi poss√≠vel organizar um ambiente de virtualiza√ß√£o relativamente est√°vel e ao mesmo tempo produtivo em equipamentos inst√°veis. </p><br><blockquote>  O principal problema com matrizes RAID em cima de dispositivos NBD √© que voc√™ precisa ter muito cuidado ao conectar um dispositivo que faz parte de uma matriz RAID a partir do servidor NBD.  Esse √© um processo bastante delicado, com uma alta probabilidade de erro fatal, que pode levar √† perda de dados.  Um pequeno erro de digita√ß√£o √© suficiente.  Veja a descri√ß√£o fatal de um acidente de carro em 21 de julho de 2012 na p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Amendoins</a> . </blockquote><p>  A desvantagem √© que um dispositivo de bloco com o qual uma m√°quina virtual j√° est√° trabalhando n√£o pode ser conectado em outro local se o seu sistema de arquivos n√£o permitir - isso √© semelhante ao <strong>iSCSI</strong> (Internet Explorer) e ao <strong>AoE (</strong> vers√£o em rede do SCSI) ou <strong>AoE</strong> ( <strong>Uma</strong> tecnologia da Internet). </p><br><h1 id="virtualnye-diski">  Discos virtuais </h1><br><p> <a href=""><img src="https://habrastorage.org/webt/id/fl/lr/idfllr5zwpo6jniv5emsyqhir2m.png"></a> </p><br><p>  O QEMU pode conectar n√£o apenas dispositivos de bloco √† m√°quina virtual, mas tamb√©m, usando v√°rias APIs, um arquivo regular tamb√©m pode ser conectado, que se parecer√° com um dispositivo de bloco dentro da m√°quina. </p><br><h2 id="formaty-virtualnyh-diskov">  Formatos de disco virtual </h2><br><blockquote>  O Qemu pode trabalhar com discos virtuais de v√°rios formatos.  Para os discos virtuais que s√£o apresentados na forma de arquivos comuns, existe um <strong>utilit√°rio qemu-img</strong> padr√£o que pode ser usado tanto para a convers√£o, quanto para determinar o formato usado e seus par√¢metros. <br><br>  Recuperando informa√ß√µes do disco virtual salvas como um arquivo regular.  Da mesma maneira, voc√™ pode obter informa√ß√µes sobre um disco virtual armazenado no GlusterFS: <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info /path_to_file/soubor.img</code> </pre> <br><br>  No entanto, para obter informa√ß√µes sobre um disco virtual usando a API GlusterFS, √© necess√°rio usar os mesmos par√¢metros usados ‚Äã‚Äãpara conectar o disco virtual √† m√°quina virtual.  Assim, voc√™ pode identificar o disco interno na m√°quina em que o cliente GlusterFS est√° instalado e usado: <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info gluster+tcp://192.168.0.2/volume_name/soubor.img</code> </pre> <br><br>  O disco virtual VDI pode ser identificado apenas atrav√©s da API Sheepdog: <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info sheepdog:192.168.0.2:8000:vdi_name</code> </pre> <br><br>  Para um disco virtual exportado do servidor NBD, √© necess√°rio garantir que o servidor correto e a porta correta sejam especificados, porque o NBD n√£o usa nenhum outro mecanismo de identifica√ß√£o ou autentica√ß√£o que elimine a confus√£o com outros discos virtuais <em>(a nova vers√£o do nbd-server usa apenas uma porta e identifica o dispositivo pelo nome - aprox. por)</em> : <br><pre> <code class="plaintext hljs">root@stroj~# qemu-img info nbd:192.168.0.2:8000</code> </pre> <br><br>  <strong>192.168.0.2</strong> <br>  O endere√ßo IP do host ao qual o dispositivo virtual se conecta.  Se esta √© a mesma informa√ß√£o <strong>qemu-img do</strong> <em>host</em> , o <em>localhost</em> pode ser usado em vez do endere√ßo IP <br><br>  <strong>8000</strong> <br>  O n√∫mero da porta na qual o daemon ou servidor est√° atendendo.  Por padr√£o, o Sheepdog usa a porta 7000, mas tamb√©m pode ser executada em uma porta diferente para evitar conflitos com outro aplicativo.  Um servidor NBD pode escutar em portas diferentes se mais de um dispositivo for exportado. </blockquote><p>  <strong>cru</strong> <br>  em geral, √© simplesmente um conjunto de dados gravados no mesmo formato que em um dispositivo de bloco convencional.  Um arquivo 5G ocupar√° todo esse lugar, independentemente de conter dados √∫teis ou apenas espa√ßo vazio.  <em>(que n√£o se aplica a arquivos esparsos - aprox. por)</em> </p><br><p>  <strong>qcow</strong> <br>  Ele difere do formato bruto, pois pode ser incremental, porque cresce gradualmente - isso √© conveniente para os sistemas de arquivos que n√£o suportam arquivos esparsos, por exemplo, FAT32.  Esse formato tamb√©m permite criar c√≥pias incrementais separadas a partir de um √∫nico disco base.  Usar esse "modelo" economiza tempo e espa√ßo em disco.  Al√©m disso, ele suporta criptografia AES e compacta√ß√£o zlib.  A desvantagem √© que, diferentemente dos discos brutos, esse arquivo n√£o pode ser montado na m√°quina diretamente na qual est√° localizado.  Felizmente, existe um utilit√°rio <strong>qemu-nbd</strong> que pode exportar esse arquivo como um dispositivo de bloco de rede e conect√°-lo a um dispositivo NBD. </p><br><p>  <strong>qcow2</strong> <br>  √© uma vers√£o atualizada do formato qcow.  A principal diferen√ßa √© que ele suporta instant√¢neos.  Caso contr√°rio, eles n√£o s√£o fundamentalmente diferentes.  Tamb√©m √© poss√≠vel atender ao qcow2, que √© definido internamente como QCOW vers√£o 3, uma vez que foi inclu√≠do no formato qcow2 h√° muito tempo.  De fato, este √© um qcow2 modificado com o par√¢metro lazy_refcounts, usado para capturas instant√¢neas.  Como a diferen√ßa √© de apenas um bit, o <strong>qemu-img</strong> da vers√£o 1.7 tem a op√ß√£o "corrigir" para alter√°-la.  As vers√µes anteriores do <strong>qemu-img</strong> n√£o.  Se voc√™ queria alterar a vers√£o do formato, era necess√°rio converter o disco virtual em um novo arquivo. Durante a convers√£o, o par√¢metro compat foi instalado com o par√¢metro compat, para o qual foi necess√°rio reduzir "1,1" para 0,10 ".  A presen√ßa da op√ß√£o "alterar" √© conveniente, pois n√£o h√° necessidade de substituir os dados devido a essas pequenas altera√ß√µes. </p><br><pre> <code class="plaintext hljs">qemu-img create -f qcow2 -o compat=1.1 test.qcow2 8G</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">http://blog.wikichoon.com/2014/12/virt-manager-10-creates-qcow2-images.html</a> </p><br><p>  <strong>qed</strong> <br>  Esse √© um formato incremental de COW de um disco virtual que cria a menor carga no host.  Ele n√£o suporta compacta√ß√£o e usa duas tabelas paralelas para endere√ßar blocos de dados (clusters).  Infelizmente, nem um √∫nico desenvolvedor estava interessado em seu desenvolvimento por um longo tempo, portanto, seu uso traz alguns problemas que ser√£o mencionados. </p><br><p>  <strong>vdi</strong> <br>  formato de disco virtual usado pelo sistema de virtualiza√ß√£o Oracle Virtualbox. </p><br><p>  <strong>vmdk</strong> <br>  formato de disco virtual usado pelos produtos VMware.  Este tamb√©m √© um formato que permite que um arquivo cres√ßa gradualmente.  No entanto, possui uma grande vantagem sobre os formatos qcow2 e qed, que tamb√©m podem ser usados ‚Äã‚Äãcom solu√ß√µes sem disco ou com sistemas de arquivos de rede.  Ele permite que voc√™ tenha um arquivo de disco virtual dividido em v√°rios arquivos pequenos com tamanhos de 2 GB.  Isso permanece desde o momento em que os sistemas de arquivos n√£o puderam criar arquivos maiores que 2 GB.  A vantagem √© que, se um disco virtual desse tipo for replicado pela rede, menos dados ser√£o transferidos e a sincroniza√ß√£o ser√° muito mais r√°pida (por exemplo, no caso do GlusterFS).  No caso de uma solu√ß√£o sem disco, ela tamb√©m √© usada para armazenar apenas arquivos pequenos com diferen√ßas para cada instant√¢neo </p><br><p>  <strong>vhdx</strong> <br>  formato de disco virtual usado pelo sistema de virtualiza√ß√£o Microsoft Hyper-V </p><br><p>  <strong>vpc</strong> <br>  formato de disco virtual usado pelo sistema de virtualiza√ß√£o Microsoft VirtualPC. </p><br><table><thead><tr><th></th><th>  <sup>Incre</sup> <sup><br></sup>  <sup>menti</sup> <sup><br></sup>  <sup>enraizado</sup> <sup><br></sup>  <sup>Ou seja,</sup> <br></th><th>  <sup>Cifra</sup> <sup><br></sup>  <sup>nova√ß√£o</sup> <br></th><th>  <sup>Com</sup> <sup><br></sup>  <sup>pres</sup> <sup><br></sup>  <sup>isto</sup> <br></th><th>  <sup>Preal</sup> <sup><br></sup>  <sup>localiza√ß√£o</sup> <br></th><th>  <sup>Shabl</sup> <sup><br></sup>  <sup>oniz</sup> <sup><br></sup>  <sup>na√ß√£o</sup> <br></th><th>  <sup>Prop</sup> <sup><br></sup>  <sup>doninhas</sup> <br></th><th>  <sup>Se√ß√£o</sup> <sup><br></sup>  <sup>imagem</sup> <br></th><th>  <sup>Dentro</sup> <sup><br></sup>  <sup>instant√¢neos</sup> <sup><br></sup>  <sup>voc√™</sup> <br></th><th>  <sup>Verifica√ß√£o aprovada</sup> <sup><br></sup>  <sup>nosti</sup> <br></th><th>  <sup>Nota</sup> <br></th></tr></thead><tbody><tr><td>  <sup><b>cru</b></sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>Pode ser montado via <i>loop</i></sup> <br></td></tr><tr><td>  <sup><b>arquivo</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>op√ß√£o</sup> <sup><br></sup>  <sup>pessoalmente</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>Para Btrfs, voc√™ deve desativar a c√≥pia na grava√ß√£o</sup> <br></td></tr><tr><td>  <sup><b>qcow</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td></td></tr><tr><td>  <sup><b>qcow2</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>op√ß√£o</sup> <sup><br></sup>  <sup>pessoalmente</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>sim</sup> </td><td></td></tr><tr><td>  <sup><b>qed</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td></td></tr><tr><td>  <sup><b>vmdk</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>op√ß√£o</sup> <sup><br></sup>  <sup>pessoalmente</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>hein</sup> <sup>?</sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td></td></tr><tr><td>  <sup><b>vdi</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>op√ß√£o</sup> <sup><br></sup>  <sup>est√°tico (est√°tico)</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>sim</sup> </td><td></td></tr><tr><td>  <sup><b>vhdx</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>op√ß√£o</sup> <sup><br></sup>  <sup>fixo (fixo)</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>sim</sup> <sup><a name="cite_ref-1"></a></sup>  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">1</a></sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td></td></tr><tr><td>  <sup><b>vpc</b></sup> </td><td>  <sup>sim</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>op√ß√£o</sup> <sup><br></sup>  <sup>fixo (fixo)</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td>  <sup>n√£o</sup> </td><td></td></tr></tbody></table><br><ol><li><a name="cite_note-1"></a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">‚Üë</a> √â poss√≠vel usar apenas em imagens pr√©-instaladas (fixas) <br></li></ol><br><h2 id="ispolzuemye-api">  APIs usadas </h2><br><p>  Al√©m dos formatos de arquivo, o <strong>qemu-img</strong> tamb√©m trabalha com "formatos" fornecidos usando a API atrav√©s da qual esses dispositivos de bloco podem ser acessados ‚Äã‚Äãremotamente. </p><br><p>  <strong>nfs</strong> <br>  arquivo de disco virtual conectado ao QEMU via protocolo NFS </p><br><p>  <strong>iscsi</strong> <br>  a comunica√ß√£o com o dispositivo de bloco √© via iSCSI.  Um dispositivo n√£o pode ser usado simultaneamente em mais de um cliente. </p><br><p>  <strong>nbd</strong> <br>  O acesso via NBD pode ser muito r√°pido.  Isso ocorre porque o protocolo √© muito simples.  Isso √© uma vantagem, mas ao mesmo tempo uma desvantagem.  Isso pode ser conveniente quando v√°rios clientes podem se conectar ao mesmo servidor NBD se eles usarem uma conex√£o local atrav√©s do servidor xnbd.  No entanto, como o nbd n√£o possui mecanismos de seguran√ßa ou autentica√ß√£o, uma situa√ß√£o pode surgir facilmente quando um cliente acidentalmente se conecta ao dispositivo errado, que no momento especificado j√° pode ser usado e o danifica. </p><br><p>  <strong>ssh</strong> <br>  a conex√£o com o servidor remoto √© feita via sshfs </p><br><p>  <strong>gluster</strong> <br>  usa a API do sistema de arquivos GlusterFS para acessar o arquivo do disco virtual.  Se o arquivo fizer parte de um volume replicado ou distribu√≠do, ele distribuir√° os dados armazenados entre outros n√≥s.  Isso permite que ele, em caso de falha, esteja dispon√≠vel em outros n√≥s. </p><br><p>  <strong>c√£o pastor</strong> <br>  tamb√©m √© um sistema de arquivos distribu√≠dos ativado para replica√ß√£o.  Ao contr√°rio do GlusterFS, um disco virtual por meio da API est√° dispon√≠vel n√£o como um arquivo, mas como um dispositivo de bloco.  Isso √© ben√©fico em termos de desempenho, mas desvantajoso se precisarmos ir al√©m do ambiente do Sheepdog. </p><br><p>  <strong>paralelos</strong> </p><br><h1 id="virtualnye-diski-na-setevom-hranilische">  Unidades virtuais no armazenamento conectado √† rede </h1><br><p>  A vantagem dos dispositivos de bloco localizados fora do sistema de virtualiza√ß√£o √© que eles s√£o imunes a falhas da m√°quina virtual. </p><br><p>  Nesse caso, alta disponibilidade e volume suficiente para armazenamento remoto tamb√©m s√£o fornecidos. </p><br><p>  <strong>Usando NFS</strong> <br> <a href=""><img src="https://habrastorage.org/webt/ws/ce/6f/wsce6f0lvdglrpbl1g_v4lif9py.png"></a> </p><br><p>  <strong>C√£o pastor</strong> <br> <a href=""><img src="https://habrastorage.org/webt/lv/ko/k4/lvkok49hqjv-kp1uiis-8sg3ejw.png"></a> </p><br><p>  <strong>GlusterFS</strong> <br> <a href=""><img src="https://habrastorage.org/webt/n9/jz/0z/n9jz0zjuprv_mj-tmq9lhjtqfjy.png"></a> </p><br><h1 id="virtualnye-mashiny-bez-blochnyh-ustroystv">  M√°quinas virtuais sem bloco </h1><br><p>  Sem dispositivos de bloco, os sistemas operacionais que podem inicializar via NFS ou com um sistema de arquivos host lan√ßado usando o Plan9 podem funcionar. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt412825/">https://habr.com/ru/post/pt412825/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt412813/index.html">Cabe√ßalhos HTTP desnecess√°rios</a></li>
<li><a href="../pt412815/index.html">Chaves do cliente OpenVPN do Gerenciador da Web VPNFace Lite</a></li>
<li><a href="../pt412819/index.html">Aquecimento de sexta-feira para a mente: Karma perfeito para Habrahabr</a></li>
<li><a href="../pt412821/index.html">Veja, observe, veja: qual √© a diferen√ßa?</a></li>
<li><a href="../pt412823/index.html">Entrevista em ingl√™s: como n√£o piorar do que o amigo do filho da m√£e</a></li>
<li><a href="../pt412827/index.html">Pavel Durov: Ap√≥s o recurso do ILV, a Apple bloqueou as atualiza√ß√µes do Telegram em todo o mundo</a></li>
<li><a href="../pt412829/index.html">Data centers distribu√≠dos do provedor: o que e por qu√™</a></li>
<li><a href="../pt412831/index.html">Vers√£o do YouTrack 2018.2: nova p√°gina do projeto, imagem do YouTrack Docker e muito mais</a></li>
<li><a href="../pt412833/index.html">Mais que a Ford</a></li>
<li><a href="../pt412835/index.html">NanoIntrodu√ß√£o √† Internet das Nano-Coisas. Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>