<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññ üç´ üßïüèª Capture bricolage de cl√©s cryptographiques Mifare et copie par vous-m√™me des cl√©s d'interphone IronLogic üåæ ‚õìÔ∏è üôãüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä peine saisir des cl√©s de chiffrement et copier des porte-cl√©s Mifare pour les interphones est bien s√ªr impossible, mais assembler un appareil qui le...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Capture bricolage de cl√©s cryptographiques Mifare et copie par vous-m√™me des cl√©s d'interphone IronLogic</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479370/">  √Ä peine saisir des cl√©s de chiffrement et copier des porte-cl√©s Mifare pour les interphones est bien s√ªr impossible, mais assembler un appareil qui le fera est tr√®s r√©el.  Je ne parlerai pas ici de ce qu'est Mifare et j'entrerai dans les d√©tails techniques, je dirai seulement que cette technologie est utilis√©e maintenant, par exemple, dans les interphones, et pour copier un trousseau d'intercom, vous devez conna√Ætre les cl√©s cryptographiques avec lesquelles il a √©t√© ferm√©. <br><blockquote>  Attention!  Cet article est uniquement √† des fins √©ducatives.  Nous vous rappelons que toute p√©n√©tration dans les syst√®mes d'information peut √™tre poursuivie par la loi. </blockquote>  De nombreuses personnes int√©ress√©es par la technologie MIfare ont probablement le lecteur / enregistreur de carte / porte-cl√©s Mifare le plus simple, compos√© d'un module PN532 et d'un adaptateur USB-UART: <br><br><img src="https://habrastorage.org/webt/05/xq/ra/05xqrajis6urtbznevn5vfgy8xi.jpeg"><br><br>  Par un raffinement simple et peu co√ªteux, cet appareil peut √™tre con√ßu pour capturer <br>  Donn√©es d'authentification du lecteur, √† l'aide desquelles les cl√©s de chiffrement sont calcul√©es, si n√©cessaires pour la lecture et la copie.  Il existe √©galement des appareils disponibles dans le commerce √† cet effet - SMKey, Proxmark3, Chameleon et quelques autres.  Ce sont des appareils avec de nombreuses fonctions, pratiques, mais pas bon march√©. <br><br>  J'attire votre attention sur une option plus √©conomique bas√©e sur un "petit ensemble de gentleman" similaire du module PN532 et un adaptateur USB-UART, qui vous permet de capturer des donn√©es √† partir d'un lecteur Mifare, comme un interphone, et de calculer les cl√©s cryptographiques avec lesquelles le lecteur se r√©f√®re √† la balise. <br><a name="habracut"></a><br>  Le dispositif d√©velopp√© dispose d'une carte de d√©bogage peu co√ªteuse et ¬´populaire¬ª bas√©e sur le processeur STM32F103C8T6, √©galement appel√© ¬´BluePill¬ª avec le module PN532 et l'adaptateur USB-UART qui y sont connect√©s.  Cet appareil est connect√© via un c√¢ble USB-OTG √† un smartphone sur Android.  Tout cela est assembl√© dans une version maquette sans soudure, √† l'aide de cavaliers, et a quelque chose comme √ßa, bien qu'il soit non pr√©sentable, mais tout √† fait fonctionnel: <br><br><img src="https://habrastorage.org/webt/91/je/bh/91jebhmz4putgxatntmyldqvnas.jpeg"><br><br>  Le sch√©ma d'assemblage est tr√®s simple et se pr√©sente sous forme de texte: <br><br>  PN532 ___________________STM32F103C8T6 <br><br>  SCK _____________________ PA5 (SPI1_SCK) <br>  MISO ____________________ PA6 (SPI1_MISO) <br>  MOSI ____________________ PA7 (SPI1_MOSI) <br>  SS ______________________ PB0 (GPIO_OUTPUT) <br>  SIGIN ___________________ PB11 (TIM2_CH4) <br>  SIGOUT __________________ PA12 (TIM1_ETR) <br>  SIGOUT __________________ PA0 (TIM2_ETR) <br>  VCC _____________________ + 5V <br>  GND_____________________GND <br><br><br>  USB-UART ________________ STM32F103C8T6 <br><br>  RX ______________________ PA9 (USART1_TX) <br>  TX ______________________ PA10 (USART1_RX) <br>  + 5V _____________________ + 5V <br>  GND_____________________GND <br><br>  IMPORTANT!  Les commutateurs d'interface PN532 doivent √™tre r√©gl√©s en mode SPI!  Vous pouvez flasher STM32 √† l'aide de l'utilitaire FlashLoaderDemonstrator via l'adaptateur USB-UART existant. <br><br>  Voici une d√©monstration de la capture d'une cl√© de chiffrement √† partir d'un simulateur de lecteur d'interphone (Arduino + PN532): <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/aUDXUIzN1kc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  √âtant donn√© que les lecteurs IronLogic (IL), pour travailler avec qui cet appareil a √©t√© d√©velopp√©, tentent de lire une balise avec une cl√© de chiffrement calcul√©e sur la base de l'UID de cette balise, cet UID doit d'abord √™tre d√©fini.  Vous pouvez le faire de deux mani√®res: manuellement ou lire √† partir de la balise.  Apr√®s cela, nous faisons une capture et attendons le calcul des cl√©s de chiffrement. <br><br>  L'onglet suivant du programme ¬´Record on Classic¬ª utilise la capacit√© des versions ant√©rieures des lecteurs IL √† √©crire des copies sur des blancs Mifare Classic bon march√©.  Cette m√©thode est bas√©e sur le fait que le lecteur IL apr√®s autorisation envoie √† l'interphone non pas l'UID d'origine de la balise, mais les informations enregistr√©es dans le premier bloc (dans le cas g√©n√©ral, correspondant √† l'UID de l'original).  Pour ce faire, nous devons capturer et calculer la cl√© de chiffrement de l'√©tiquette qui servira de blanc, fermer le secteur z√©ro avec elle et √©crire quatre octets de l'UID de l'√©tiquette qui sert de prototype dans le premier bloc de cette √©tiquette.  Pour ce faire, nous n'avons m√™me pas besoin de r√©cup√©rer la cl√© de crypto-monnaie d'origine et de supprimer son vidage, il suffit de conna√Ætre son UID, mais cela n'est vrai que si l'original est "original" et non une copie, alors vous devez toujours lire le premier bloc et d√©j√† √©crire sur une copie.  Pour le rendre plus clair, consid√©rons cet exemple - supposons que nous voulions faire une copie de la cl√© d'origine avec l'UID 0xEBD52AC5, qui est √©galement √©crite dans le premier bloc de l'original, sur une √©tiquette Mifare Classic r√©guli√®re avec un UID, disons 0x12345678.  Pour ce faire, √† l'aide de l'appareil pr√©sent√©, qui a √©t√© judicieusement appel√© par un camarade Shaitan-Mashina, nous trouvons la cl√© de cryptage pour cet UID et pour l'objet particulier (entr√©e, maison ...) dont nous avons besoin.  Laissez la cl√© de chiffrement √™tre 0xABCDEF098765, puis modifiez le secteur z√©ro du vidage de copie comme suit: <br><br><img src="https://habrastorage.org/webt/rc/sh/lb/rcshlbqwctujngjr0dkvnhlb8zk.jpeg"><br><br>  Dans le premier bloc, nous √©crivons l'UID du 0xEBD52AC5 d'origine, et dans le troisi√®me bloc, les six octets de la cl√© de chiffrement trouv√©e pour cette pi√®ce sont 0xABCDEF098765.  Nous √©crivons le vidage sur le blanc et obtenons une copie de la cl√© d'interphone.  Quelque chose comme √ßa SMKey fait des copies d'IronLogic sur Mifare Classic normal, et c'est ce que fait ce programme d'enregistrement.  Dans le champ ¬´Code¬ª, nous saisissons ou lisons manuellement 4 octets d'UID √† partir de la cl√© d'origine, qui seront enregistr√©s dans le 1er bloc de la copie.  Nous commen√ßons puis suivons les invites du programme.  Nous lisons d'abord l'UID de la pi√®ce, puis nous amenons l'appareil √† l'interphone et capturons les donn√©es d'authentification.  Une fois le calcul termin√©, le programme proposera d'apporter le blanc pour l'enregistrement des donn√©es.  Si plus d'une cl√© cryptographique est trouv√©e, apr√®s avoir enregistr√© la premi√®re option, elle aura la possibilit√© de v√©rifier la copie re√ßue.  Si la copie ne tient pas, vous devez essayer la cl√© calcul√©e suivante ou effacer (restaurer) le blanc pour une utilisation future.  La copie peut √©galement ne pas fonctionner car le code qui est √©crit dans le 1er bloc de la copie a √©t√© mal d√©fini - par exemple, si vous essayez d'√©crire le vrai UID non pas le porte-cl√©s d'origine, mais d'une copie effectu√©e √† l'aide de la m√©thode ci-dessus. Dans ce cas, vous ne devez pas utiliser l'UID les √©tiquettes et les donn√©es du 1er bloc, qui peuvent √™tre obtenues dans la section "Copie d'un secteur". <br><br>  Cette m√©thode ne fonctionnera pas non plus pour les derni√®res versions du logiciel de lecture IL.  Dans ce cas, une copie peut √™tre effectu√©e en copiant le 0e secteur entier (4 blocs) sur une pi√®ce qui vous permet d'enregistrer le 0e secteur √† l'aide de la section ¬´Copie d'un secteur¬ª dans l'application.  Ici, nous trouvons √©galement d'abord la cl√© de crypto-monnaie d'origine, lisons son secteur z√©ro, puis √©crivons dans le blanc.  En raison du manque de blancs OTP et OTP-2.0 √† port√©e de main, cette fonctionnalit√© n'a jusqu'√† pr√©sent √©t√© test√©e que sur des blancs ZERO, bien que les nouvelles versions de lecteurs n√©cessitent l'utilisation d'OTP-2.0. <br><br>  Eh bien, pour commencer - la section "Enregistrer l'UID" de l'application vous permet de modifier l'UID, de restaurer le 0e bloc endommag√© et de r√©initialiser les cl√©s de chiffrement des blancs ZERO par d√©faut. <br><br>  Donc - pour r√©sumer bri√®vement.  Pour fabriquer un tel appareil, nous achetons ou recherchons un module PN532, l'un des adaptateurs USB - UART FTDI, PL2303, CH340 ou CP2102, une carte de d√©bogage STM32F103C8T6, une douzaine de cavaliers, un adaptateur USB-OTG et un smartphone (tablette) sur Android avec OTG.  Nous assemblons l'appareil lui-m√™me selon le sch√©ma ci-dessus, flash * .bin avec le fichier STM32 et installons l'application * .apk √† partir de l' <a href="https://yadi.sk/d/1qKtoRTPWBYBpg">archive</a> <br><cut>  sur un smartphone.  Pour un fonctionnement correct, l'application sur le smartphone doit √™tre lanc√©e lorsque l'adaptateur USB-UART est connect√©, soit par d√©faut, soit par s√©lection manuelle, sinon l'application n'aura pas acc√®s √† l'adaptateur. <br><br>  Je veux dire quelques mots sur le module PN532 - tous ces modules ne sont pas ¬´tout aussi utiles¬ª!  Sur les trois modules (comme sur la photo ci-dessus) que j'ai achet√©s, un ne lisait pas et n'√©crivait pas de balises, en particulier ZERO et OTP-2.0, mais il fonctionnait normalement en mode passif avec des lecteurs intercom, l'autre se comportait exactement le contraire, et seulement le troisi√®me de plus- moins faire face √† la fois aux tags et aux interphones (bien pire que les deux premiers).  Peut-√™tre que je n'ai pas de chance et que ce lot particulier de modules s'est av√©r√© ne pas √™tre de la meilleure qualit√©, mais d'autres personnes s'en plaignent.  Cependant - √† quelqu'un d'aussi chanceux.  Que dis-je?  Les modules PN532 sont apparus en vente pour une disposition l√©g√®rement diff√©rente, qui sont plus chers, mais, selon les critiques, ils n'ont pas de tels probl√®mes: <br><br><img src="https://habrastorage.org/webt/jr/vi/9s/jrvi9sfl-57ao-v8t0otqa0mm8a.jpeg"><br><br>  Si quelqu'un rencontre PN532, qui n'√©crit pas ou ne lit pas bien les √©tiquettes, je peux recommander d'ajouter un module RC522 √† l'appareil, qui vaut un sou, mais remplit parfaitement ses fonctions, selon le sch√©ma suivant: <br><br>  RC522____________________STM32F103C8T6 <br><br>  RST ______________________ PB12 (GPIO_OUTPUT) <br>  SCK ______________________ PB13 (SPI2_SCK) <br>  MISO _____________________ PB14 (SPI2_MISO) <br>  MOSI _____________________ PB15 (SPI2_MOSI) <br>  SDA ______________________ PA8 (GPIO_OUTPUT) <br>  VCC ______________________ + 5V <br>  GND______________________GND <br>  Dans ce cas, le PN532 ne fonctionnera que lors de la capture de donn√©es du lecteur, et toute la charge de travailler avec des balises tombera sur les √©paules du RC522. <br><br>  En conclusion, je tiens √† dire que les performances de l'appareil en conditions r√©elles n'ont √©t√© test√©es que sur des lecteurs IronLogic de toute premi√®re g√©n√©ration, sans filtres ZERO, OTP, OTP-2.0.  Les autres versions n'ont tout simplement pas acc√®s, donc pour les lecteurs IL plus modernes, le d√©veloppement de logiciels sera n√©cessaire, et, bien s√ªr, la pr√©sence de ces lecteurs. <br><br>  <a href="https://yadi.sk/d/1qKtoRTPWBYBpg">Archive</a> </cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr479370/">https://habr.com/ru/post/fr479370/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr479358/index.html">R√©f√©rence rapide des cat√©gories de valeurs C ++: Partie 2</a></li>
<li><a href="../fr479360/index.html">Cr√©ez un projet open source pour Angels en quelques clics</a></li>
<li><a href="../fr479364/index.html">Classement des meilleurs processeurs pour PC de jeu en 2019</a></li>
<li><a href="../fr479366/index.html">R√©sultats du sondage mobile du vendredi</a></li>
<li><a href="../fr479368/index.html">Comment obtenir l'assurance qualit√© et les tests CMM niveau 5</a></li>
<li><a href="../fr479374/index.html">Prenez soin de vos dongles: √©tude de s√©curit√© du r√©cepteur clavier Logitech</a></li>
<li><a href="../fr479376/index.html">S√©curis√© par Knox - Samsung Mobile Security Mechanisms</a></li>
<li><a href="../fr479378/index.html">Pensez SRE: regardez les projets avec les yeux d'un ing√©nieur SRE</a></li>
<li><a href="../fr479382/index.html">D√©veloppement acc√©l√©r√© avec Spring Boot DevTools</a></li>
<li><a href="../fr479384/index.html">Que fait le Big Data dans MegaFon et comment y arriver?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>