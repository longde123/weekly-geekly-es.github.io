<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèæ üë©‚Äçüëß‚Äçüëß üõê ArduPilot pour les d√©butants. Installer et configurer sur BeagleBone Blue ü§ï üë®üèª‚Äçüåæ üîÇ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nous, avec une √©quipe (√† laquelle vous pouvez vous joindre ) de personnes partageant les m√™mes id√©es de Habr, d√©veloppons un robot pour ramasser des b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ArduPilot pour les d√©butants. Installer et configurer sur BeagleBone Blue</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/robogazon/blog/429510/"> Nous, avec une √©quipe (√† <b>laquelle vous pouvez vous joindre</b> ) de personnes partageant les m√™mes id√©es de Habr, d√©veloppons un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">robot pour ramasser des balles de golf sur le practice</a> .  Il s'agit d'un robot de service hautement sp√©cialis√©, nous pr√©voyons donc de d√©velopper simultan√©ment un complexe logiciel et mat√©riel unique, qui pourrait √™tre utilis√© √† l'avenir comme base pour d'autres robots de service et <b>UGV</b> . <br><br><img src="https://habrastorage.org/webt/3x/wy/of/3xwyof39bhwkwbvvqoyjqmxdmay.jpeg"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Dans le dernier article,</a> nous avons expliqu√© pourquoi nous nous sommes arr√™t√©s sur ce logiciel.  Lors de la mise en place de notre projet, nous avons utilis√© les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">informations de l'article</a> .  En fait, nous pr√©sentons ici la traduction de ce bref guide, peut-√™tre que pour quelqu'un, il sera utile et vous aidera √† cr√©er votre premier ou prochain robot. <br><a name="habracut"></a><br>  Avant de commencer, je tiens √† souligner qu'il vaut la peine d'utiliser BeagleBone Blue (il est toujours bleu).  En r√®gle g√©n√©rale, nous attacherons quelques p√©riph√©riques li√©s √† la navigation, et ils ne fonctionneront pas correctement sans une puissance suffisante. <br><br><h2>  Partie 1. Pr√©parer le BeagleBone </h2><br>  Acc√©dez √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://rcn-ee.net/rootfs/bb.org/testing/</a> et s√©lectionnez le r√©pertoire avec la derni√®re date.  Ouvrez ensuite le sous <b>-</b> r√©pertoire <b>stretch-console</b> .  Ici, vous verrez plusieurs fichiers.  T√©l√©chargez un fichier appel√© Quelque chose comme <b>'bone-debian-VV-console-armhf-20YY-MM-DD-1gb.img.xz'</b> .  Il s'agit d'une distribution Debian minimale contenant uniquement l'essentiel.  Une alternative est l'image IoT (IoT = Internet of Things), qui est fournie avec des logiciels suppl√©mentaires et peut rendre votre travail plus confortable si vous √™tes nouveau sous Linux.  Il est disponible sur le m√™me site. <br><br>  Nous utilisons: <a href="">https://rcn-ee.net/rootfs/bb.org/testing/2018-10-07/stretch-console/bone-debian-9.5-console-armhf-2018-10-07-1gb.img .xz</a> . <br><br>  Ensuite, vous devrez flasher l'image sur la carte microSD.  Que vous utilisiez Linux ou Windows, je recommande fortement un programme appel√© Etcher pour cette t√¢che ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://etcher.io/</a> ). <br><br>  Vous pouvez maintenant t√©l√©charger BeagleBone Blue √† partir de la carte microSD.  Cela d√©passe le cadre de ce document pour d√©crire en d√©tail toutes les m√©thodes d'interaction, mais souvent cela est r√©alis√© en se connectant via un c√¢ble micro-USB ou via SSH (√† 'debian@192.168.7.2', mot de passe 'temppwd') ou via le port COM ( Utilisateur Debian ', mot de passe' temppwd) dans un programme comme minicom ou PuTTY.  Cette connexion √† la console Linux via le port COM.  UART1 sur les versions BBB est toujours li√© √† la console, d'abord U-boot, puis Linux.  Plus d'informations peuvent √™tre trouv√©es ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://beagleboard.org/blue</a> <br><br>  Les pilotes BeagleBone sont livr√©s avec Windows 10. Sous Linux, BBB en tant que port COM USB universel peut ne pas √™tre d√©tect√©.  Si vous rencontrez des probl√®mes, essayez: <br><br><pre><code class="bash hljs">sudo -s cat &gt;/etc/udev/rules.d/73-beaglebone.rules &lt;&lt;EOF ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"usb"</span></span>, ENV{DEVTYPE}==<span class="hljs-string"><span class="hljs-string">"usb_interface"</span></span>, ATTRS{idVendor}==<span class="hljs-string"><span class="hljs-string">"0403"</span></span>, ATTRS{idProduct}==<span class="hljs-string"><span class="hljs-string">"a6d0"</span></span>, DRIVER==<span class="hljs-string"><span class="hljs-string">""</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/sbin/modprobe -b ftdi_sio"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"drivers"</span></span>, ENV{DEVPATH}==<span class="hljs-string"><span class="hljs-string">"/bus/usb-serial/drivers/ftdi_sio"</span></span>, ATTR{new_id}=<span class="hljs-string"><span class="hljs-string">"0403 a6d0"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"00"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-jtag"</span></span> ACTION==<span class="hljs-string"><span class="hljs-string">"add"</span></span>, KERNEL==<span class="hljs-string"><span class="hljs-string">"ttyUSB*"</span></span>, ATTRS{interface}==<span class="hljs-string"><span class="hljs-string">"BeagleBone"</span></span>, ATTRS{bInterfaceNumber}==<span class="hljs-string"><span class="hljs-string">"01"</span></span>, SYMLINK+=<span class="hljs-string"><span class="hljs-string">"beaglebone-serial"</span></span> EOF udevadm control --reload-rules <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br>  J'esp√®re que vous √™tes maintenant connect√© √† la ligne de commande.  Nous commencerons par permettre √† l'utilisateur Debian d'ex√©cuter sudo sans avoir √† saisir de mot de passe √† chaque fois (par la suite): <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"debian ALL=(ALL) NOPASSWD: ALL"</span></span> | sudo tee -a /etc/sudoers.d/debian &gt;/dev/null</code> </pre><br>  La prochaine t√¢che consiste √† mettre √† jour et √† installer le logiciel √† l'aide d'une connexion Internet abordable, il est donc temps de configurer connman pour un acc√®s Wi-Fi.  Je fais cela parce que cela facilitera le travail √† l'avenir.  Tout d'abord, notez le SSID et le mot de passe WiFi de votre routeur.  Saisissez ensuite les informations suivantes: <br><br><pre> <code class="bash hljs"> sudo -s connmanctl services | grep <span class="hljs-string"><span class="hljs-string">'&lt;your SSID&gt;'</span></span> | grep -Po <span class="hljs-string"><span class="hljs-string">'wifi_[^ ]+'</span></span></code> </pre><br>  La r√©ponse ressemblera √† ceci: ¬´wifi_38d279e099a8_4254487562142d4355434b_managed_psk¬ª.  Si vous ne voyez rien, essayez √† nouveau - vous avez probablement fait une faute de frappe. <br><br>  Maintenant, en utilisant cet ID r√©seau, nous allons entrer le fichier directement depuis le clavier (stdin) en utilisant cat, une ligne √† la fois: <br><br><pre> <code class="bash hljs"> cat &gt;/var/lib/connman/wifi.config [service_&lt;your <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span>&gt;] Type = wifi Security = wpa2 Name = &lt;your SSID&gt; Passphrase = &lt;your WiFi password&gt;</code> </pre><br>  Important!  Avant Ctrl + C, assurez-vous d'appuyer sur Entr√©e, sinon toute la ligne actuelle sera perdue. <br>  Appuyez sur Ctrl-C pour quitter, puis tapez: quitter <br><br>  La LED verte visible s'allume, ce qui signifie que le Wi-Fi est activ√©.  BBBlue est connect√© au routeur et son adresse IP sur votre r√©seau Wi-Fi peut √™tre trouv√©e en utilisant: <br><br><pre> <code class="bash hljs">ip addr show wlan0</code> </pre><br>  Si, pour une raison quelconque, vous ne pouvez pas demander directement BBBlue, utilisez d'autres utilitaires tels que nmap (sudo nmap 192.168.0.0/24) ou en vous connectant √† votre routeur et en y cherchant d'autres moyens pour trouver son adresse IP. <br><br>  Essayez maintenant de vous connecter via SSH en utilisant son adresse IP Wi-Fi.  N'oubliez pas que 192.168.7.2 fonctionnera √©galement. <br><br>  Si vous ne pouvez pas faire fonctionner le WiFi avec connman, ou si vous ne voulez tout simplement pas utiliser connman, vous pouvez utiliser la m√©thode suivante.  Tout d'abord, tapez: sudo systemctl disable connman.  Ensuite, avec votre SSID et votre mot de passe WiFi, √©ditez / etc / network / interfaces <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># The loopback network interface. auto lo iface lo inet loopback # WiFi w/ onboard device (dynamic IP). auto wlan0 iface wlan0 inet dhcp wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" dns-nameservers 8.8.8.8 1.1.1.1 # Ethernet/RNDIS gadget (g_ether). # Used by: /opt/scripts/boot/autoconfigure_usb0.sh iface usb0 inet static address 192.168.7.2 netmask 255.255.255.252 network 192.168.7.0 gateway 192.168.7.1</span></span></code> </pre><br>  Rechargez maintenant BBBlue avec: <b>sudo reboot</b> <br><br>  Apr√®s vous √™tre connect√©, tapez: sudo ifup wlan0.  La LED verte doit s'allumer. <br><br>  Si vous voulez que le BB ait une IP statique (disons 192.168.0.99), changez la section "# WiFi avec appareil embarqu√© (IP dynamique)". Section / etc / network / interfaces pour lire: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># WiFi w/ onboard device (static IP). auto wlan0 iface wlan0 inet static wpa-ssid "&lt;your SSID&gt;" wpa-psk "&lt;your WiFi password&gt;" address 192.168.0.99 # &lt;--- The desired static IP address of the BBBlue. netmask 255.255.255.0 gateway 192.168.0.1 # &lt;--- The address of your router. dns-nameservers 8.8.8.8 1.1.1.1</span></span></code> </pre><br>  Mise √† jour et installation de tous les programmes de support n√©cessaires: <br><br><pre> <code class="bash hljs">sudo apt-get -y update sudo apt-get -y dist-upgrade sudo apt-get install -y cpufrequtils git</code> </pre><br>  Mettre √† jour les scripts: cd / opt / scripts &amp; &amp; git pull <br><br>  <b>Le noyau temps r√©el contient actuellement des bugs!</b>  <b>Utilisez le correctif suivant: Sp√©cifiez le noyau Ti en temps r√©el 4_4.</b>  <b>N'utilisez pas 4_14.</b> <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/update_kernel.sh --ti-rt-channel --lts-4_4 sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-14-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt sudo sed -i <span class="hljs-string"><span class="hljs-string">'s|#uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|uboot_overlay_pru=/lib/firmware/AM335X-PRU-RPROC-4-4-TI-00A0.dtbo|g'</span></span> /boot/uEnv.txt</code> </pre><br>  Enfin, copiez am335x-bone blue.dtb (depuis le r√©pertoire bin de ce r√©f√©rentiel) vers /boot/dtbs/4.4.113-ti-rt-r149 <br><br>  Installer le script sur l'ex√©cution automatique <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/#dtb=/dtb=am335x-boneblue.dtb/g'</span></span> /boot/uEnv.txt</code> </pre><br>  R√©glez la fr√©quence <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/GOVERNOR="ondemand"/GOVERNOR="performance"/g'</span></span> /etc/init.d/cpufrequtils</code> </pre><br>  Configuration de bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  Configuration de bb-wl18xx-wlan0.service <br><br><pre> <code class="bash hljs">sudo sed -i <span class="hljs-string"><span class="hljs-string">'s/RestartSec=5/RestartSec=1/g'</span></span> /lib/systemd/system/bb-wl18xx-wlan0.service</code> </pre><br>  D√©sactiver Bluetooth (facultatif) <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> bb-wl18xx-bluetooth.service</code> </pre><br>  D√©veloppez la partition de carte microSD existante (/ dev / mmcblk0p1): <br><br><pre> <code class="bash hljs">sudo /opt/scripts/tools/grow_partition.sh</code> </pre><br>  Red√©marrez maintenant: <br><br><pre> <code class="bash hljs">sudo reboot</code> </pre><br><h2>  Partie 2. Installer ArduPilot sur un BeagleBone </h2><br>  Lorsque le BeagleBone red√©marre, nous devons cr√©er des fichiers texte.  Tout d'abord, am√©liorer le fichier de configuration de l'environnement, / etc / default / ardupilot: <br>  <i>(Astuce: entrez sudoedit / etc / default / ardupilot et ins√©rez votre propre adresse IP cible, par exemple 192.168.0.13)</i> <br><br><pre> <code class="bash hljs">TELEM1=<span class="hljs-string"><span class="hljs-string">"-C /dev/ttyO1"</span></span> TELEM2=<span class="hljs-string"><span class="hljs-string">"-A udp:&lt;target IP address&gt;:14550"</span></span> GPS=<span class="hljs-string"><span class="hljs-string">"-B /dev/ttyS2"</span></span></code> </pre><br>  Il s'agit d'une configuration assez typique. <br><br>  Il s'agit du param√®tre de lancement -C mappe le port s√©rie ¬´Telem1¬ª d'ArduPilot (SERIAL1, 57600 par d√©faut) pour UART1 dans BBBlue.  Par exemple, j'ai une radio RFDesign 868x connect√©e √† UART1.  Il s'agit d'un canal de donn√©es bidirectionnel avec mon drone.  Il envoie diverses donn√©es de t√©l√©m√©trie √† la station de base et re√ßoit des commandes RTK et des corrections diff√©rentielles de la station de base. <br><br>  Il s'agit du param√®tre de lancement -A mappe le port s√©rie ¬´Console¬ª d'ArduPilot (SERIAL0, 115200 par d√©faut) avec le protocole, l'adresse IP de destination et le num√©ro de port en option.  Par exemple, cela me permet de recevoir des donn√©es MAVLink provenant du Wi-Fi √† des fins de test.  Vraiment utile, d'autant plus que les donn√©es peuvent imm√©diatement √™tre transmises √† Mission Planner et QGroundControl. <br><br><img src="https://habrastorage.org/webt/3d/d7/m1/3dd7m1ilxlbkd3elqxnddq_1rcm.jpeg" alt="image"><br><br>  Il s'agit du param√®tre de lancement -B mappe le port s√©rie ¬´GPS¬ª d'ArduPilot (SERIAL3, 57600 par d√©faut) avec Uart2 BBBlue (UART, vaguement marqu√© ¬´GPS¬ª sur la carte elle-m√™me).  Par exemple, j'ai un U-blox NEO-M8P connect√© √† UART2. <br><br>  Il existe d'autres possibilit√©s - il existe d'autres options de lancement, avec des vitesses de port pr√©d√©finies et les ports eux-m√™mes: <br><br><pre> <code class="bash hljs">Switch -A --&gt; <span class="hljs-string"><span class="hljs-string">"Console"</span></span>, SERIAL0, default 115200 Switch -B --&gt; <span class="hljs-string"><span class="hljs-string">"GPS"</span></span>, SERIAL3, default 57600 Switch -C --&gt; <span class="hljs-string"><span class="hljs-string">"Telem1"</span></span>, SERIAL1, default 57600 Switch -D --&gt; <span class="hljs-string"><span class="hljs-string">"Telem2"</span></span>, SERIAL2, default 38400 Switch -E --&gt; Unnamed, SERIAL4, default 38400 Switch -F --&gt; Unnamed, SERIAL5, default 57600</code> </pre><br>  Consultez la documentation officielle d'ArduPilot pour plus d'informations sur les diff√©rents ports s√©rie: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://ardupilot.org/plane/docs/parameters.html?highlight=parameters</a> <br><br>  Ensuite, nous allons cr√©er les fichiers de service ArduPilot systemd, un pour ArduCopter, /lib/systemd/system/arducopter.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduCopter Service After=networking.service StartLimitIntervalSec=0 Conflicts=arduplane.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arducopter <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Un pour ArduPlane, /lib/systemd/system/arduplane.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduPlane Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service ardurover.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/arduplane <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Un pour ArduRover, /lib/systemd/system/ardurover.service: <br><br><pre> <code class="bash hljs">[Unit] Description=ArduRover Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service antennatracker.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/ardurover <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Et AntennaTracker aussi?  Cr√©ez /lib/systemd/system/antennatracker.service: <br><br><pre> <code class="bash hljs">[Unit] Description=AntennaTracker Service After=networking.service StartLimitIntervalSec=0 Conflicts=arducopter.service arduplane.service ardurover.service [Service] EnvironmentFile=/etc/default/ardupilot ExecStartPre=/usr/bin/ardupilot/aphw ExecStart=/usr/bin/ardupilot/antennatracker <span class="hljs-variable"><span class="hljs-variable">$TELEM1</span></span> <span class="hljs-variable"><span class="hljs-variable">$TELEM2</span></span> <span class="hljs-variable"><span class="hljs-variable">$GPS</span></span> Restart=on-failure RestartSec=1 [Install] WantedBy=multi-user.target</code> </pre><br>  Allons dans le dossier sudo mkdir -p / usr / bin / ardupilot <br><br>  Cr√©ez un fichier de configuration de fer pour ArduPilot, / usr / bin / ardupilot / aphw qui s'ex√©cute avant les fichiers ex√©cutables. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash # aphw # ArduPilot hardware configuration. /bin/echo 80 &gt;/sys/class/gpio/export /bin/echo out &gt;/sys/class/gpio/gpio80/direction /bin/echo 1 &gt;/sys/class/gpio/gpio80/value /bin/echo pruecapin_pu &gt;/sys/devices/platform/ocp/ocp:P8_15_pinmux/state</span></span></code> </pre><br>  Les lignes 5-7 incluent la puissance servo BBBlue + 5V, c'est-√†-dire lorsque vous utilisez des servos.  Pas n√©cessaire pour ESC. <br><br>  La ligne 8 comprend le PRU. <br><br>  Utilisez sudo chmod 0755 / usr / bin / ardupilot / aphw pour d√©finir les autorisations pour ce fichier. <br><br>  C'est presque arriv√©!  Vous devriez maintenant obtenir les derniers fichiers ex√©cutables ArduCopter, ArduPlane, etc. cr√©√©s sp√©cifiquement pour l'architecture Arm BBBlue et les placer dans le r√©pertoire / usr / bin / ardupilot.  Mirko Denecke les a t√©l√©charg√©s sur son site Web ici: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://bbbmini.org/download/blue/</a> <br><br>  Copiez dans ce r√©f√©rentiel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/imfatant/test/blob/master/bin/</a> <br><br>  N'oubliez pas de d√©finir les droits: sudo chmod 0755 / usr / bin / ardupilot / a * <br><br>  Si vous trouvez que vous devez compiler √† partir de la source, n‚Äôayez pas peur - ce n‚Äôest pas si difficile.  De plus, cela signifie que vous pouvez cr√©er votre propre logiciel ArduPilot. <br><br>  Les collecter sur le BBBlue lui-m√™me prendra trop de temps.  Patrick Poirier explique le processus de BBBMINI (bas√© sur le BeagleBone noir) sur son site Web.  Voici la proc√©dure sp√©cifique √† BBBlue, en supposant que vous avez termin√© toutes les √©tapes jusqu'√† pr√©sent et que vous √™tes dans le r√©pertoire / home / debian: <br><br><pre> <code class="bash hljs">sudo apt-get install g++ make pkg-config python python-dev python-lxml python-pip sudo pip install future git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/ArduPilot/ardupilot <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ardupilot git checkout Copter-3.6 <span class="hljs-comment"><span class="hljs-comment"># &lt;-- For ArduCopter. git submodule update --init --recursive ./waf configure --board=blue # &lt;-- BeagleBone Blue. ./waf sudo cp ./build/blue/bin/a* /usr/bin/ardupilot</span></span></code> </pre><br>  Patrick fournit √©galement des instructions pour les compiler de mani√®re crois√©e sur un PC de bureau x64 relativement puissant dans Ubuntu, ce qui est beaucoup, beaucoup plus rapide. <br><br>  Selon l'option logicielle dont vous avez besoin <br>  sudo systemctl enable arducopter.service <br>  ou <br>  sudo systemctl enable arduplane.service <br>  ou <br>  sudo systemctl enable ardurover.service <br>  ou <br>  sudo systemctl enable antennatracker.service <br><br>  Apr√®s le red√©marrage, votre ArduPilot devrait d√©marrer automatiquement.  Vous verrez une LED rouge clignotante! <br><br>  Vous pouvez consulter systemctl ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.freedesktop.org/software/systemd/man/systemctl.html</a> ).  Quelques exemples de commandes utiles: <br><br><pre> <code class="bash hljs">sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> ... sudo systemctl start ... sudo systemctl stop ...</code> </pre><br><h3>  Partie 3. Connexion des p√©riph√©riques </h3><br><img src="https://habrastorage.org/webt/fx/xo/ae/fxxoaey0otck_4ti6yl0p1dzbgu.jpeg" alt="image"><br><br>  La configuration minimale de base comprendra probablement: <br><br><ul><li>  R√©cepteur R / C. </li><li>  R√©cepteur GPS (avec ou sans boussole int√©gr√©e). </li><li>  Un modem radio pour un canal de donn√©es bidirectionnel, en particulier sur de longues distances. </li><li>  (Le WiFi BBBlue int√©gr√© est id√©al pour le d√©bogage et les tests √† courte port√©e si 2,4 GHz est disponible, mais pour quelque chose de plus int√©ressant, un canal de donn√©es bidirectionnel d√©di√© est recommand√©. Gardez √©galement √† l'esprit le type et l'emplacement des antennes qui utilisent tous ces √©l√©ments. ) </li></ul><br>  Quelques mots sur les connecteurs, les c√¢bles et les outils dont vous avez besoin.  Je vais donner quelques recommandations, sinon, si vous √™tes d√©butant, vous pouvez d√©penser beaucoup de temps, d'efforts et d'argent.  Le type de connecteur le plus couramment utilis√© est JST-SH 1,0 mm.  Vous devez acheter plusieurs connecteurs femelles en tailles 4 et 6 positions et contacts √† sertir.  Obtenez ensuite quelques m√®tres de fils de diff√©rentes couleurs. <br><br>  Revenons donc √† la connexion des p√©riph√©riques: <br><br><img src="https://habrastorage.org/webt/h4/mq/7k/h4mq7kn51qxgbc4orkk4ghmluoo.jpeg"><br><br>  R√©cepteur R / C: peut √™tre d√©sactiv√© √† tout contact + 5V et GND.  Il ne reste plus qu'√† connecter la sortie SBUS, la sortie DSM ou la sortie PPM du r√©cepteur √† l'une des deux broches SBUS marqu√©es sur le sch√©ma.  Les r√©cepteurs suivants ont √©t√© test√©s et fonctionnent: <br><br>  FrSky ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.frsky-rc.com/</a> ): R-XSR, XR4SB, X6R, X8R, R9 Slim et R9 Mini (les deux firmwares EU LBT 868 MHz et Universal 915 MHz). <br><br>  Spektrum ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://www.spektrumrc.com/</a> ): AR7700 DSMX avec PPM / SRXL / Remote Rx. <br><br>  TBS ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://team-blacksheep.com/</a> ): Crossfire ¬´complet¬ª avec Nano Rx (Rx r√©gl√© sur le mode SBUS). <br><br>  Soit dit en passant, ils parlent beaucoup du ¬´SBUS invers√©¬ª.  En fait, SBUS n'est qu'un protocole de transfert de donn√©es en s√©rie que Futaba a invent√© et que FrSky a copi√©.  Il est √† l'envers par rapport √† l'UART ¬´standard¬ª.  Heureusement, l'Ardupilot Blue attend ce signal SBUS invers√©, il n'y a donc pas besoin d'un inverseur de signal. <br><br>  R√©cepteur GPS: la plupart des gens utilisent des r√©cepteurs u-blox, en particulier NEO-M8N et NEO-M8P.  NEO-M8N est bon march√© et abordable aupr√®s d'entreprises chinoises telles que HobbyKing, g√©n√©ralement sous forme de disque.  Id√©alement, ils contiennent le r√©cepteur lui-m√™me, une tr√®s petite antenne patch en c√©ramique et comprennent souvent une boussole.  Alors que BBBlue a d√©j√† une boussole int√©gr√©e (AKM AK8963), ArduPilot peut √™tre configur√© pour utiliser cette boussole ¬´externe¬ª au lieu de la sienne, pour √©viter les interf√©rences. <br><br>  Une alternative (beaucoup) plus ch√®re au NEO-M8N est le NEO-M8P.  Ce r√©cepteur prend en charge un mode de fonctionnement appel√© ¬´RTK¬ª, ou cin√©matique en temps r√©el, qui peut atteindre une pr√©cision de positionnement de quelques centim√®tres en temps r√©el.  Cependant, ce type de pr√©sentation a un prix environ 10 fois plus cher que le NEO-M8N, et ceci sans station de base.  Plus loin dans le manuel, je consacrerai une section sp√©ciale au M8P. <br><br>  Fichier de configuration I2C ArduPilot: /var/APM/{ArduCopter.stg,ArduPlane.stg,APMrover2.stg,AntennaTracker.stg} <br><br><pre> <code class="bash hljs">sudo apt-get install i2c-tools sudo i2cdetect -r -y 0 sudo i2cdetect -r -y 1 sudo i2cdetect -r -y 2</code> </pre><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 2 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- 0c -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- 68 -- -- -- -- -- -- -- 70: -- -- -- -- -- -- 76 --</code> </pre><br>  68 = IMU InvenSense MPU-9250 (√† bord), 0c = boussole AKM AK8963 (√† bord), 76 = barom√®tre Bosch BMP280 (√† bord). <br><br><pre> <code class="bash hljs">$ sudo i2cdetect -r -y 1 0 1 2 3 4 5 6 7 8 9 abcdef 00: -- -- -- -- -- -- -- -- -- -- -- -- -- 10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- 1e -- 20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 40: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- 70: -- -- -- -- -- -- -- --</code> </pre><br>  1e = boussole Honeywell HMC5843 (externe) - souvent int√©gr√©e dans les modules GPS bas√©s sur u-blox NEO-M8N. <br><br><h2>  Prise en main du logiciel Ground Control Station (GCS) </h2><br>  T√©l√©chargez n'importe quel planificateur de mission (http://firmware.ardupilot.org/Tools/MissionPlanner/MissionPlanner-latest.msi) pour Windows ou QGroundControl (http://qgroundcontrol.com/) pour Linux et Windows.  Ces deux programmes se connecteront aux flux de donn√©es MAVLink arrivant sur le r√©seau (par exemple, via le port UDP 14550) ou via les ports COM. <br><br><h2>  En option </h2><br>  √âquiper votre bbblue bas√© sur drone avec un haut-parleur Bluetooth peut √™tre amusant, √† condition que les transmissions RF Bluetooth n'interf√®rent pas avec d'autres syst√®mes.  Il y a une tonne d'informations sur BlueZ / PulseAudio / ALSA, mais, heureusement, cela se r√©sume √† quelque chose d'assez simple. <br><br>  a) installez d'abord le logiciel n√©cessaire (√† l'aide de la console ou de l'image IoT): <br><br><pre> <code class="bash hljs"> sudo apt-get install -y bluetooth pulseaudio pulseaudio-module-bluetooth alsa-utils</code> </pre><br>  b) Activer Bluetooth (si d√©sactiv√©): sudo systemctl enable bb-wl18xx-bluetooth.service <br><br>  c) Modifiez /etc/pulse/default.pa: <br><pre> <code class="bash hljs"> <span class="hljs-comment"><span class="hljs-comment">### Automatically suspend sinks/sources that become idle for too long # load-module module-suspend-on-idle</span></span></code> </pre><br>  d) Red√©marrage: red√©marrage sudo <br><br>  e) Apr√®s avoir charg√© BBBlue, activez la colonne Bluetooth en mode connexion: <br><br><pre> <code class="bash hljs"> bluetoothctl scan on agent on default-agent pair &lt;Bluetooth speaker<span class="hljs-string"><span class="hljs-string">'s MAC address&gt; # &lt;--- eg AB:58:EC:5C:0C:03 connect &lt;Bluetooth speaker'</span></span>s MAC address&gt; <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Sometimes unnecessary. trust &lt;Bluetooth speaker's MAC address&gt; scan off exit</span></span></code> </pre><br>  f) Enfin: <br><br><pre> <code class="bash hljs"> pulseaudio --start <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"connect &lt;Bluetooth speaker's MAC address&gt;"</span></span> | bluetoothctl pactl list <span class="hljs-comment"><span class="hljs-comment"># &lt;--- Use this to check that your Bluetooth speaker has been picked up by PulseAudio. pacmd set-card-profile 0 a2dp_sink aplay /usr/share/sounds/alsa/Front_Center.wav</span></span></code> </pre><br>  C'est tout!  Soit dit en passant, si vous pr√©voyez d'utiliser un synth√©tiseur vocal, je recommande Festival. <br><br>  Si vous voulez aider - veuillez m'√©crire dans le LAN ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">VK</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FB</a> . <br><br><img src="https://habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg" alt="image">  <a href="">habrastorage.org/webt/mt/lh/91/mtlh91x8jag1t-ibt_np3uayuke.jpeg</a> <br><br>  Merci d'avoir lu, demandez-nous et critiquez-nous compl√®tement. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr429510/">https://habr.com/ru/post/fr429510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr429500/index.html">"Le temps de faire des affaires" a finalement vol√©</a></li>
<li><a href="../fr429502/index.html">Vaut-il la peine de d√©velopper des comp√©tences crois√©es</a></li>
<li><a href="../fr429504/index.html">Comment appeler les m√©thodes audio vk</a></li>
<li><a href="../fr429506/index.html">Nous regardons sous le capot du nouveau Gmail</a></li>
<li><a href="../fr429508/index.html">R√©sum√© du rapport ¬´Comment devenir un sp√©cialiste sympa des bases de donn√©es¬ª (HL2018, Data Egret, Ilya Kosmodemyansky)</a></li>
<li><a href="../fr429512/index.html">√âv√©nements num√©riques √† Moscou du 12 au 18 novembre</a></li>
<li><a href="../fr429514/index.html">Microsoft a expliqu√© comment r√©soudre le probl√®me de la s√©curit√© des donn√©es sur les SSD avec un cryptage mat√©riel qui fuit</a></li>
<li><a href="../fr429522/index.html">Concevoir un robot de service. √ânonc√© du probl√®me, architecture de la solution</a></li>
<li><a href="../fr429524/index.html">La bonne API JSON ou JSON RPC</a></li>
<li><a href="../fr429528/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 338 (5-11 novembre 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>