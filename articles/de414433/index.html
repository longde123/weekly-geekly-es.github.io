<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõÄüèø üë®üèø‚Äçüöí üí™üèæ Wir laufen mit Bedacht durch die Stadt: Als ich den Dienst tat, um interessante Wanderrouten zu bauen üíÉ üòõ üëØ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD: Da das Thema gut angekommen ist und gezeigt hat, dass eine Nachfrage nach einem solchen Service besteht, werde ich ihn weiterentwickeln. Ich habe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wir laufen mit Bedacht durch die Stadt: Als ich den Dienst tat, um interessante Wanderrouten zu bauen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414433/">  <b>UPD:</b> Da das Thema gut angekommen ist und gezeigt hat, dass eine Nachfrage nach einem solchen Service besteht, werde ich ihn weiterentwickeln.  Ich habe eine VKontakte-√ñffentlichkeit gestartet, um Feedback zu sammeln und Update-Informationen zu ver√∂ffentlichen: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://vk.com/sightsafari</a> <br><br>  Eine unbekannte Gegend der Stadt, ein wenig Freizeit und die Notwendigkeit (oder der Wunsch), zu Fu√ü zur U-Bahn / zum Hotel / zum Bahnhof zu gelangen - wahrscheinlich ist jeder mindestens einmal in diese Situation geraten.  Gleichzeitig m√∂chte ich einerseits einige sch√∂ne und interessante Orte sehen, andererseits erlaubt mir die begrenzte Zeit nicht, zu stark vom direkten Weg abzuweichen. <br><br>  Die Situation ist noch komplizierter, wenn es in der N√§he keine wichtigen Sehensw√ºrdigkeiten gibt, die jeder kennt und die nach einer kurzen Suche im Internet in Ihre Route aufgenommen werden k√∂nnten.  Was tun, wenn Sie in einem Kupchino festsitzen, von dem Sie nur geh√∂rt haben, dass es besser ist, nicht dort festzusitzen?  Wir m√ºssen auf den Navigator gehen und hoffen, dass es auf dem Weg etwas Interessantes gibt.  Beliebte Navigatoren ber√ºcksichtigen jedoch nur Entfernung und Reisezeit, ber√ºcksichtigen jedoch nicht die Interessantheit der Route.  Ich bin auf weitere Projekte gesto√üen, die versucht haben, die Bequemlichkeit einer Wanderroute zu ber√ºcksichtigen (die um laute Autobahnen herumf√ºhrt), aber ich m√∂chte nicht nur bequem fahren, sondern auch etwas Sch√∂nheit sehen. <br><br><img src="https://habrastorage.org/webt/_b/-b/fl/_b-bflyvxlr6x2jswq-njjc8o9s.jpeg"><br><br>  Ich dachte ein wenig nach und beschloss, diese Aufgabe selbst zu √ºbernehmen.  Wie immer ist die allgemeine Idee des Algorithmus recht einfach, aber der Teufel steckt im Detail.  Und im Falle der Navigation k√∂nnen die kleinen Dinge sehr bedeutsam und gesundheitssch√§dlich sein, da es unwahrscheinlich ist, dass ein Tourist gl√ºcklich ist, wenn der Navigator ihn f√ºr ein kleines Gedenkschild in die Wildnis eines halb verlassenen Industriegebiets f√ºhrt (Arbeit, sobald es passiert ist). . <br><br>  Beschreibung des Algorithmus und Beispiele f√ºr Arbeiten unter dem Schnitt, Link am Ende. <br><a name="habracut"></a><br><h2>  Hauptidee </h2><br>  Meine urspr√ºngliche Idee war folgende: Laden Sie die Open Street Map-Karte herunter, analysieren Sie sie, entfernen Sie Informationen zu allen potenziell interessanten Objekten f√ºr Fu√üg√§nger (wir mussten uns noch f√ºr ihre Liste entscheiden) und zeichnen Sie einige Pufferzonen um sie herum.  Wir suchen nach Wegen mit einem Standard-Framework, einem kleinen Teil des Prozesses zum Erstellen eines Navigationsdiagramms, damit in diesen Bereichen die Kantengewichte geringer werden und dadurch die Anziehungskraft von Fu√üg√§ngerwegen auf sie organisiert wird. <br><br>  Kaum gesagt als getan.  Um den Weg zu finden, haben wir die GraphHopper-Bibliothek verwendet, die OSM-Karten aus der Box lesen, Routen f√ºr verschiedene Transportarten (Auto, Fu√üg√§nger, Fahrrad) erstellen kann und √ºber verschiedene Algorithmen verf√ºgt, um den Weg zu finden (einfache Suche, Suche nach alternativen Routen, alle Arten von beschleunigten, optimierten Optionen) ) und kann das Navigationsdiagramm vorverarbeiten, um die Suche zu beschleunigen (die einfache Suche in der Stadt funktioniert sehr schnell, in wenigen Millisekunden).  F√ºr mein Arbeitsbeispiel wurde meine Heimatstadt St. Petersburg ausgew√§hlt - hier konnte ich die Qualit√§t und das Interesse der gebauten Strecken selbst beurteilen. <br><br>  Infolgedessen wurde die Basisversion des Algorithmus einige Abende lang auf einem Knie zusammengeklebt, und dann begann eine aufregende Reise entlang des Rechen und kleiner Dinge, in denen der Teufel bekannt ist und l√ºgt, die ich sp√§ter diskutieren werde. <br><br><h2>  Objekte f√ºr Touristen und Probleme mit OSM </h2><br>  In der Open Street Map besteht jedes Objekt aus einer Geometrie (Knoten, Weg oder Beziehung) sowie einer Reihe von Schl√ºssel-Wert-Zeichenfolgenpaaren. <br><br>  Hier ist der Winterpalast in OSM: <br><br><img src="https://habrastorage.org/webt/tq/fn/u3/tqfnu3oazgejzzpy_isave3t-d8.png"><br><br>  Das Problem ist, dass die Standardisierung auf beiden Beinen lahm ist, da OSM eine Karte ist, die von den Teilnehmern ge√∂ffnet und bearbeitet werden kann.  Um den gleichen Objekttyp zu kennzeichnen, kann ein anderer Satz von Tags und eine andere Kombination von Objekten verwendet werden. Einige der Tags werden als ‚Äûkanonisch‚Äú betrachtet und im Wiki beschrieben. Es gibt jedoch eine Reihe von Optionen, die sowohl einfach alternativ als auch offen gesagt fehlerhaft sind, aber dennoch verwendet werden .  Infolgedessen muss jeder Code, der mit OSM funktioniert (insbesondere alle Navigatoren und Renderer), all dies ber√ºcksichtigen und eine Reihe von Code enthalten, um solche Sonderf√§lle zu behandeln. <br><br>  Zum Beispiel bedeutet das Tag Autobahn = nicht spezifiziert nicht "irgendeine Art von Stra√üe eines unbekannten Typs", wie viele Kartierer denken, sondern einen sehr spezifischen Stra√üentyp gem√§√ü der europ√§ischen Klassifikation, aber sie formen ihn aufgrund des Namens √ºberall.  Dar√ºber hinaus setzt diese Art von Stra√üe das Vorhandensein einer Fu√üg√§ngerzone oder eines B√ºrgersteigs voraus, weshalb der Navigator Fu√üg√§ngerrouten entlang dieser Stra√üe baut, w√§hrend Fu√üg√§nger in St. Petersburg nicht auf eine solche echte Stra√üe fahren (dies ist die Fahrbahn der Stra√üe).  Oder ein anderes Beispiel: addr: Hausname Wir verwenden manchmal ein Tag f√ºr den Namen von Geb√§uden. Aus irgendeinem Grund ist beispielsweise der Westfl√ºgel des Generalstabs am Palastplatz nach diesem Tag benannt.  W√§hrend OSM-Leitf√§den sagen, dass es nur in L√§ndern verwendet werden sollte, in denen Namen anstelle von Hausnummern verwendet werden (in Japan scheint dies der Fall zu sein), verwenden Sie f√ºr offizielle Geb√§udenamen das Namensschild und dergleichen. <br><br>  Ein weiterer Moment, der mich ver√§rgert, ist die Markierung von Gr√ºnfl√§chen.  Zu diesem Zweck gibt es zwei verschiedene Tags: Freizeit = Park und Landnutzung = Gras.  Auf der Karte sehen sie ungef√§hr gleich aus: nur eine gr√ºne Zone, etwas anders in der Farbe.  Infolgedessen werden sie nach Belieben miteinander vermischt.  Aus diesem Grund wird der Rasen zwischen den Fahrbahnen der Stra√üe oft zu einem "Park" und zieht Wanderwege an. <br><br>  All diese Nuancen mussten f√ºr uns entdeckt werden, als wir Routen bauten und analysierten. <br>  Als eine Reihe von Objekten, die f√ºr Fu√üg√§nger von Interesse sind, wurde schlie√ülich die folgende Liste ausgew√§hlt: <br><br><ul><li>  Touristenattraktionen gekennzeichnet Tourismus </li><li>  Gr√ºnfl√§chen.  Freizeit = Park, Garten.  Nach einiger √úberlegung wurden Friedh√∂fe f√ºr Landnutzung = Friedhof hinzugef√ºgt.  Einerseits gibt es eine mittelm√§√üige Attraktion, andererseits zum Beispiel auf der Wassiljewski-Insel in St. Petersburg, die einzige gro√üe gr√ºne Zone ist der Friedhof, den die Einheimischen anstelle des Parks nutzen, aber dort gibt es keine echten Parks. </li><li>  Wasser: Fl√ºsse, Seen, Teiche.  Es gibt eine Mischung aus Wasser, Wasserstra√üen-Tags und eine Reihe doppelter Werte.  Es ist so sch√∂n, an einem hei√üen Tag die Promenade entlang zu gehen.  Auf jeden Fall dachte ich mir das, bis ich versuchte, Smolensk zu verarbeiten - es stellte sich pl√∂tzlich heraus, dass es sich in den Tiefen des Flussufers nicht um einen sch√∂nen Damm wie unseren in St. Petersburg handelte, sondern um ein bewachsenes und verschmutztes √ñdland, von dem Fu√üg√§nger lieber fern bleiben w√ºrden.  Bisher war es jedoch nicht m√∂glich, diese Situationen rein von der Karte zu unterscheiden. </li><li>  Historische Geb√§ude und Strukturen, gekennzeichnet als historisch.  Sie sind normalerweise einfach nur sch√∂n </li><li>  Alle anderen kleinen Dinge in der Stadt sind mit einem Ausstattungsetikett versehen.  Es hat viele Bedeutungen, ich habe nur einige ausgew√§hlt, zum Beispiel eine Stra√üenuhr (Uhr) - es sind oft sch√∂ne religi√∂se Geb√§ude (Ort der Anbetung), Stra√üenkunst f√ºr alle (Graffiti) und einige andere </li><li>  Fu√üg√§ngerzonen und Pl√§tze Autobahn = Fu√üg√§nger </li></ul><br>  Im Verlauf der Studie wurde mir klar, dass es zus√§tzlich zu den positiven Bereichen, die Fu√üg√§nger anziehen, notwendig ist, negative Bereiche hinzuzuf√ºgen, die sie absto√üen.  Diese Liste enth√§lt bisher: <br><br><ul><li>  Geb√§ude Landnutzung = Bau.  Fu√üg√§nger sind nicht sehr erfreut, unter Ger√ºsten zu gehen, in Staub, der von einer Baustelle fliegt </li><li>  Industriegebiete und Garagen Landnutzung = Industrie, Garagen.  In diesem Moment ereignete sich diese Nuance mit der Einrichtung eines Fu√üg√§ngers (und wir vom Institut f√ºr Design und St√§dtebau der ITMO testeten sie an Studenten, die auf festgelegten Wegen gingen und dann im Rahmen einer Studie √ºber den Gehkomfort des Petrograder Bezirks Bewertungen verfassten) in der Wildnis des Industriegebiets Lenpolygraphmash.  Es stellte sich heraus, dass dort nicht das gesamte Viertel mit diesem Etikett gekennzeichnet ist (wie dies normalerweise f√ºr die Kennzeichnung gro√üer Industriegebiete der Fall ist), sondern jedes Geb√§ude separat. </li><li>  Idealerweise m√∂chte ich auch Fu√üg√§nger von den breiten Autobahnen der Stadt wegbringen, wo es staubig, laut, viele Autos ist und normalerweise nichts zu sehen ist.  Bisher war es jedoch nicht m√∂glich, sie eindeutig zu erkennen.  In OSM gibt es im Wesentlichen nur die Anzahl der Fahrspuren, aber dieses Kriterium reicht nicht aus (viele wichtige Touristenstra√üen wie der Newski-Prospekt sind ebenfalls mehrspurig). </li></ul><br>  Derselbe Lenpolygraphmash, der irgendwo in seiner Wildnis ein Denkmal f√ºr die Druckmaschine enthielt und in dem mein Algorithmus den armen Studenten schleppte <br><br><img src="https://habrastorage.org/webt/yy/di/ai/yydiaik86aloogncpomcsobrjum.png"><br><br><h2>  Die Bedeutung von Attraktionen </h2><br>  Offensichtlich sind die Sehensw√ºrdigkeiten unterschiedlich.  Es gibt gro√üe, weltber√ºhmte Objekte - wie den Eiffelturm oder die Isaakskathedrale in St. Petersburg, die eine gro√üe Anzahl von Touristen anziehen und die Menschen besuchen m√∂chten, um einen anst√§ndigen Haken zu machen.  Und es gibt einige kleine Kleinstadtdekorationen - einige Stra√üenkunst, eine kleine Skulptur im Hof, die die Leute nur auf dem Weg sehen k√∂nnen und die sie nicht aus der Ferne ziehen wollen.  F√ºr die korrekte Erstellung interessanter und bequemer Routen musste gelernt werden, wie verschiedene Kategorien von Attraktionen getrennt werden. In OSM verf√ºgen wir lediglich √ºber eine bestimmte Geometrie und eine Reihe von Tags.  Ich musste mir eine Reihe von Faustregeln ausdenken, um die ‚ÄûWichtigkeit‚Äú eines Sonderziels zuzuweisen, das die √Ñnderungen der Gewichte in der Grafik weiter bestimmt. <br><br>  Anfangs ist die Wichtigkeit Null und nimmt zu, wenn die folgenden Bedingungen erf√ºllt sind: <br><br><ul><li>  +3 wenn es ein historisches Tag gibt - nur wichtige historische Geb√§ude haben es, und selbst dann nicht alle </li><li>  +3 f√ºr das Vorhandensein von Wikipedia- oder Wikidata-Tags.  Nur wichtige Objekte haben normalerweise ihre eigenen Wiki-Seiten. </li><li>  +1 f√ºr das Vorhandensein eines Links oder einer URL - auch hier hat nicht jeder seine eigene Site, aber oft f√ºhrt dieses Tag zu einer Seite eines Katalogs und kleine Objekte haben sie </li><li>  +1 f√ºr jedes Namensschild.  Der Name kann auf verschiedene Arten festgelegt werden. Es gibt alle Arten von alten Namen f√ºr historische Namen oder Namen, die in andere Sprachen √ºbersetzt wurden.  Auch hier zeigt das Vorhandensein vieler Namen die ausreichende Bedeutung des Objekts an (da jemand es satt hatte, sie alle niederzulegen). </li><li>  Geb√§ude: Architektur - architektonischer Stil, der normalerweise auf alle m√∂glichen sch√∂nen architektonischen Denkm√§ler gesetzt wird </li></ul><br>  Diese Liste wird empirisch ermittelt und erm√∂glicht es Ihnen zumindest, den Winterpalast von namenlosen Graffiti am Stadtrand zu trennen.  Infolgedessen bedeutet eine Wichtigkeit von 0, dass ein lokales kleines namenloses Objekt (ein St√ºck Gr√ºn, Graffiti), etwa 3-4 bereits etwas Interessantes (eine Kirche, ein Platz, auf dem man sitzen und sich entspannen kann), n√§her an 10, Attraktionen auf Stadtebene beginnen. der gleiche Winterpalast. <br><br>  Die Liste ist nicht perfekt und st√ºtzt sich stark auf OSM-Daten, die oft unvollst√§ndig sind.  Zum Beispiel hatte das Narva-Tor anfangs nur eine Einheit von Bedeutung, da nichts au√üer dem Namen an ihnen angebracht war.  Ich musste selbst zu OSM gehen und die Namen, den Stil, die Baujahre, die H√∂he (um die Sichtbarkeit richtig zu bestimmen, was als n√§chstes kommt) usw. hinzuf√ºgen.  Im Allgemeinen hat dies auch einen √∂ffentlichen Vorteil: Um die Qualit√§t der Routen zu verbessern, gehe ich von Zeit zu Zeit zu OSM und schreibe dort fehlende Tags ab, die dann von anderen Navigatoren oder Programmen verwendet werden k√∂nnen. <br><br><h2>  Einflussbereiche </h2><br>  Attraktionen gibt es in verschiedenen Gr√∂√üen.  Eine kleine Skulptur sollte aus einer Entfernung von nicht mehr als 5-7 Metern betrachtet werden.  Der Bronze Horseman ist von 20-30 gut sichtbar.  Die Isaakskathedrale, eines der h√∂chsten Geb√§ude im Stadtzentrum, ist von 200 bis 300 anst√§ndig sichtbar (ich verstehe, dass es nicht notwendig ist, dass ein Tourist in die N√§he kommt, aber es ist recht angenehm, die Aussicht aus dieser Entfernung zu genie√üen, sie kann sogar einen Kilometer vom anderen Ufer der Newa entfernt gesehen werden , aber ohne Details).  Wie kann bestimmt werden, in welcher Entfernung die Attraktion die Routen der Fu√üg√§nger beeinflussen soll? <br><br>  Der bronzene Reiter und die Kuppel der Isaakskathedrale in der Ferne <br><br><img src="https://habrastorage.org/webt/qf/mt/ac/qfmtachakldz_hek0cft9da_vkc.jpeg"><br><br>  Zuerst habe ich empirische Sichtbarkeitsradien erstellt.  Sie h√§ngen von allen verf√ºgbaren Informationen √ºber die Attraktion ab und verwandeln sie in einen von vier Radien: kleine 30 Meter, mittlere 100, gro√üe 250 und gro√üe 350 Meter. <br><br>  Ein wenig auseinander ist die Sichtbarkeit von Fl√ºssen und Parks.  F√ºr sie stelle ich 30 Meter ein, d.h.  entspricht ungef√§hr der Breite der Promenade oder Stra√üe rund um den Park.  Da es ziemlich sinnlos ist, den Park aus der Ferne zu betrachten, m√ºssen Sie daneben gehen. <br><br>  Die Art der Sichtbarkeit wird durch die Regeln bestimmt: <br><br><ul><li>  Punktobjekte (d. H. Durch den Punkt-OSM-Typ spezifiziert) sind kleine Sichtbarkeit, dies sind normalerweise kleine Denkm√§ler und Stra√üenkunst </li><li>  Aber Punkt und mit dem historischen Tag ist Medium, weil  Dies sind oft gro√üe Denkm√§ler auf hohen Sockeln, wie der gleiche Bronze-Reiter </li><li>  Gebiete mit weniger als 20 * 20 Metern (Weg oder Beziehung) sind mittelgro√ü </li><li>  Mehr - gro√ü </li><li>  Wenn das Objekt eine Markierungsh√∂he (H√∂he in Metern) oder Geb√§udeebenen (Anzahl der Stockwerke) hat, wird es in einer H√∂he von mehr als 50 Metern als riesig angesehen - dies ist nur speziell f√ºr Isaac und andere gro√üe Kathedralen und Geb√§ude gemacht, die von weitem sichtbar sind </li></ul><br>  Es trat jedoch ein Problem auf: Unter den Bedingungen einer dichten Entwicklung des historischen Zentrums von St. Petersburg funktionierte der naive Ansatz mit Radien nicht, da der tats√§chliche Sichtbereich eines Tempels im Hinterhof viel kleiner war und tats√§chlich nur vom Stra√üenabschnitt direkt gegen√ºber sichtbar war.  Ich musste anfangen, ehrliche (fast) Sichtbarkeitspolygone aufzubauen. <br><br>  Die Katharinenkirche steht im hinteren Teil des Hofes, umgeben von H√§usern auf allen Seiten: <br><br><img src="https://habrastorage.org/webt/i1/v9/7x/i1v97xyfbvptyyalot5aegbmjp0.png"><br><br>  Zun√§chst mussten die Hindernisse ermittelt werden.  Nun, alles ist einfach, ich habe alle Polygone mit dem Building-Tag aus den OSM-Daten genommen und gelesen.  Dies sind Polygone, die unsere Sichtbarkeit blockieren.  Dann schrieb er einen einfachen naiven Algorithmus zum Konstruieren eines Polygons f√ºr die Sichtbarkeit eines Punktes mittels Raytracing.  Ich brauche dort keine hohe Genauigkeit, ein Dutzend Strahlen pro Punkt waren genug.  Zuerst habe ich ohne weiteres den Schwerpunkt der Geometrie des Wahrzeichens genommen, aber dies ergab nicht die besten Ergebnisse f√ºr lange (lange und schmale) Geb√§ude.  Daher begann ich in Zukunft f√ºr gro√üe Attraktionen, drei Punkte zu nehmen - den Schwerpunkt und die beiden Punkte, die am weitesten davon und an der Au√üengrenze voneinander entfernt sind.  Warum habe ich nicht ehrlich Sichtbarkeit aufgebaut?  Denn wenn der Algorithmus zum Konstruieren des Sichtbarkeitsbereichs eines Punkts trivial ist (wir lassen die Strahlen in alle Richtungen aus dem Punkt heraus, sehen, wo sie die n√§chsten Hindernisse √ºberqueren, verbinden diese Punkte), ist es viel schwieriger, eine ehrliche Sichtbarkeit einer Kante (und schlie√ülich eines Polygons) zu erstellen (der erste kommt zu) Kopfentscheidung - die Sichtbarkeit der beiden Enden der Rippen zu verbessern und zu kombinieren - offensichtlich falsch). <br><br>  Das Ergebnis ist eine gute Ann√§herung.  Es baut sich unvollkommen auf, aber f√ºr die Bed√ºrfnisse der Fu√üg√§ngernavigation reicht diese Genauigkeit f√ºr uns aus.  Das einzige Problem besteht darin, dass die H√∂he von Geb√§uden, d. H.  Jeder kleine Stand versperrt uns den Blick auf den f√ºnfst√∂ckigen Glockenturm.  Es ist jedoch nichts zu tun - OSM-Daten enthalten nicht immer mehrere Stockwerke, und es ist viel schwieriger, Sichtbarkeitsvolumina in 3D zu erstellen.  Obwohl ich vielleicht darauf zur√ºckkommen werde. <br><br>  Konstruierte Sichtbarkeitspolygone f√ºr diese und benachbarte Kirchen <br><br><img src="https://habrastorage.org/webt/u3/nn/d1/u3nnd1avv5rxery--jfkrhtawpq.png"><br><br><h2>  Die Sch√∂nheit der Route und wie man sie erh√∂ht </h2><br>  Wir haben also gelernt, die Bedeutung und Sichtbarkeit von Attraktionen zu ber√ºcksichtigen, und scheinen begonnen zu haben, gute Routen zu bauen.  Auf jeden Fall war dies so, als ich in den zentralen Regionen von St. Petersburg testete, die eine sehr hohe Dichte an Sch√∂nheiten pro Quadratkilometer aufweisen. <br><br>  Es lohnte sich jedoch, sich ein wenig vom Zentrum zu entfernen, als der Algorithmus pl√∂tzlich begann, seine Ohnmacht zu erkennen.  Und die Route, die er baute, fiel mit der k√ºrzesten zusammen.  Da die Katze in diesen Gebieten viele Sehensw√ºrdigkeiten hat, befinden sie sich weit voneinander entfernt. Bei der Suche nach einem Pfad unter Verwendung der kombinierten Metrik ‚ÄûSch√∂nheit + Entfernung‚Äú stellte sich heraus, dass der Beitrag des ersten Terms nahe Null war. Infolgedessen erstellte der Algorithmus einfach die k√ºrzesten Routen. <br><br>  Nat√ºrlich k√∂nnte man immer sagen: "Wir sind nicht so, das sind unsere langweiligen St√§dte", aber das w√§re nicht sehr richtig.  Daher habe ich mich gefragt, wie ich die konstruierte Route bewerten und verbessern kann.  Die einfachste L√∂sung, die sofort in den Sinn kommt, besteht darin, die Route zu erweitern, indem ein Haken an einen beliebigen Punkt von Interesse gedr√ºckt wird, der ausgelassen wurde. <br><br>  In F√§llen, in denen a) die Gesamtbedeutung aller Attraktionen der Route einen Kilometer unter einem bestimmten Wert liegt oder b) der Benutzer selbst die interessanteste Route erstellt hat, versucht mein Algorithmus, diese zu verbessern.  Dazu wird die anf√§ngliche Route erstellt, ein Puffer wird um sie herum genommen (ihre Dicke wird durch die L√§nge bestimmt, je l√§nger die Route ist - je l√§nger der Haken darf), und mehrere neue (noch nicht in der Route enthaltene) Sehensw√ºrdigkeiten mit einer Punktzahl&gt; 2 werden in diesem Puffer durchsucht (wir wollen nicht) Haken pro Kilometer zu nicht benannten √∂ffentlichen G√§rten machen) und neue Routen werden vom Startpunkt zu diesem Zwischenziel und von dort zum Zielpunkt gelegt.  Gleichzeitig wird die L√§nge zus√§tzlich gesteuert, so dass wir eine Route erhalten m√ºssen, die nicht mehr als doppelt so lang ist wie der k√ºrzeste Weg zwischen Start- und Endpunkt. <br><br>  Die erste Version des Algorithmus (links) konnte nichts Interessantes finden und baute den k√ºrzesten Weg.  Die Version mit einer zus√§tzlichen Attraktion (rechts) enthielt jedoch den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">DOT KV-19</a> , der sich in der unteren rechten Ecke der Route befindet (bei dieser Zoomstufe ist er nicht sichtbar, aber der Dienst zeigt ihn in der Liste an und erm√∂glicht es Ihnen, ihn auf der Karte zu finden, indem Sie auf den Namen klicken). . <br><br><img src="https://habrastorage.org/webt/-a/xs/v9/-axsv9ra4o2tcvhthknqhqumwws.jpeg"><br><br>  Der gleiche Bunker.  Im Allgemeinen gibt es in Kupchino gen√ºgend solche Objekte im Zusammenhang mit der Verteidigung Leningrads, da dort die Verteidigungslinien der Stadt vorbeigingen: <br><br><img src="https://habrastorage.org/webt/gh/vv/an/ghvvanixv70ulqi2m45sgcipbtm.jpeg"><br><br>  Nat√ºrlich wird sich jeder Fu√üg√§nger bereit erkl√§ren, einen Umweg zu machen, um seiner Meinung nach unbedeutend zu sein.  Aus diesem Grund zeigt der Dienst die L√§nge der Route im Vergleich zur k√ºrzesten und die Liste der Attraktionen an, und nur der Benutzer kann entscheiden, ob er an einer solchen Route interessiert ist.  Au√üerdem gibt es einen Schieberegler, mit dem Sie den maximal zul√§ssigen Haken verringern (oder umgekehrt erh√∂hen) k√∂nnen. <br><br>  In der Praxis musste ich mich weiteren Problemen und Kuriosit√§ten stellen.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Erstens "kroch" der Puffer mit der naiven Implementierung um die Route aus dem Anfang und dem Ende heraus. Und oft kam es vor, dass die Route noch ein paar hundert Meter √ºber den Endpunkt hinausging. Oder umgekehrt, es ging vom Ende an von Anfang an in die entgegengesetzte Richtung und kehrte erst dann in die gew√ºnschte Richtung zur√ºck. Obwohl solche Routen es erm√∂glichten, mehr Sehensw√ºrdigkeiten zu sehen, m√∂chten Fu√üg√§nger wirklich nicht sehr weit vom Ziel weggef√ºhrt werden. Zuerst musste ich den Bereich um den Endpunkt im Navigationsdiagramm ‚Äûherausstechen‚Äú (um die Kanten bei der Suche nach dem Weg zum Zwischenprodukt unpassierbar zu machen) und dann einen Puffer vollst√§ndig erstellen, nicht um die gesamte Routenlinie, sondern nur ab einer bestimmten Entfernung vom Start bis zu einer bestimmten Entfernung bis zum Ende .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Das zweite Problem waren die R√ºckwege entlang derselben Stra√üe. Ich wei√ü nichts √ºber dich, aber ich hasse es, den gleichen Weg zur√ºckzugehen, den ich gegangen bin. Ich gehe immer lieber den anderen Weg. Und deshalb versuche ich mit meinem Algorithmus, dasselbe Verhalten zu erreichen. Die Wahrheit ist, dass dies immer noch ein Problem ist. Als ersten Versuch habe ich es so gemacht, dass alle Kanten (au√üer der letzten), die am Pfad vom Anfang bis zum Zwischenpunkt beteiligt waren, bei der Suche nach dem Pfad vom Zwischenpunkt bis zum Ende aus dem Diagramm herausgeschnitten werden. Dies vermeidet die R√ºckkehr auf genau die gleiche Weise, sch√ºtzt jedoch nicht vor fast demselben Weg - zum Beispiel der R√ºckkehr auf die andere Seite derselben Stra√üe. Das Ausschneiden aller Kanten in der Nachbarschaft macht es oft v√∂llig unm√∂glich, den R√ºckweg zu finden. Im Allgemeinen gibt es noch etwas zu √ºberlegen. Obwohl in dieser Hinsicht mein Algorithmus bereits besser funktioniert als einige der Konkurrenten,die einfach nicht √ºber dieses Thema nachdenken und leicht Sackgassen der Route bauen.</font></font><br><br><h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die aktuelle Implementierung befindet sich auf </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sightsafari.city.</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Es gibt dort noch fast keinen Geocoder (es gibt ein OSM, aber es funktioniert ziemlich schlecht). Es ist daher besser, die Punkte direkt auf der Karte zu platzieren, mit der rechten Maustaste zu klicken oder lange zu tippen. Der Schieberegler ist f√ºr die Art der Route verantwortlich: Die Position ganz links sucht nach der k√ºrzesten, ohne Ber√ºcksichtigung der Sehensw√ºrdigkeiten, das Standarddrittel sorgt f√ºr eine gute Balance, die Position ganz rechts versucht immer, die Route zu verbessern, und generiert h√§ufig recht komplizierte Pfade. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier einige Beispiele. Die Route von dem Haus, in dem ich fr√ºher gelebt habe, zur Moskauer U-Bahn ist laut Yandex ein langweiliger Weg durch H√∂fe und kleine Stra√üen: </font></font><br><br><img src="https://habrastorage.org/webt/br/fh/9g/brfh9gm8tff7duh4f5pmngdmlmu.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aber die Route entspricht meinem Algorithmus. Es geht durch den Rand des Victory Park, vorbei am historischen Museum, vorbei an der Chesme-Kirche und dem Palast, entlang des Bereichs des Hauses der Sowjets, vorbei an Springbrunnen und cooler stalinistischer Architektur.</font></font><br><br><img src="https://habrastorage.org/webt/ij/s3/sg/ijs3sgj22wuqs5amlzwo1hange0.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Chesme Kirche. </font><font style="vertical-align: inherit;">Ich selbst machte normalerweise einen kleinen Umweg, um durch diesen Ort zu gehen, und nicht direkt durch die langweiligen Innenh√∂fe der Chruschtschows. </font></font><br><br><img src="https://habrastorage.org/webt/4h/1x/ll/4h1xlltxfkpj22i2-h0zrtwsxlw.jpeg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ein weiteres Beispiel: Der k√ºrzeste Weg von Smolny (wo sich die Verwaltung von St. Petersburg befindet) zur U-Bahn-Station "Ploshchad Vosstaniya" f√ºhrt entlang des Suworowsky-Prospekts. </font><font style="vertical-align: inherit;">Aber in der N√§he, etwas abseits, gibt es einen wundersch√∂nen Tauridengarten, in dem mein Algorithmus Ihnen einen Einblick bietet.</font></font><br><br><img src="https://habrastorage.org/webt/nn/qo/0e/nnqo0etvaljjcuoycvb9-rky83c.png"><br><br><h2>  Fazit </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W√§hrend der Dienst nur f√ºr St. Petersburg, Puschkin und Smolensk funktioniert (Zonen mit zug√§nglicher Navigation sind mit einer rot gepunkteten Linie markiert). </font><font style="vertical-align: inherit;">Es gibt noch viel zu verbessern, und daf√ºr ist zun√§chst Feedback erforderlich. </font><font style="vertical-align: inherit;">Versuchen Sie also, Bewertungen zu Routen zu schreiben (√ºber der Liste der Sehensw√ºrdigkeiten befindet sich ein Button). Ich hoffe, dass dies f√ºr jemanden interessant und n√ºtzlich ist.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf Anfrage kann ich neue St√§dte verbinden - Moskau, ich f√ºrchte, der Server wird knacken (obwohl nicht alle k√∂nnen, aber nat√ºrlich nur das Zentrum), hier ist etwas weniger. Die Hauptsache ist, dass OSM f√ºr diese Region mehr oder weniger qualitativ gekennzeichnet sein sollte und dass es einige Sehensw√ºrdigkeiten geben sollte, was f√ºr kleine St√§dte nicht sehr interessant ist (in demselben Smolensk, das ich f√ºr einen meiner Kameraden dort hinzugef√ºgt habe, sind alle interessanten Dinge geb√ºndelt 2-3 Orte in der Stadt, und Sie k√∂nnen sie ohne intelligente Navigation umgehen). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Moskau innerhalb der TTK hinzugef√ºgt, Ufa, Kaliningrad, Nischni Nowgorod, Kiew, Kasan, Rostow am Don, Blagoweschtschensk, Saratow, Penza, Odessa, Minsk, Jekaterinburg, danach lief der Speicher auf dem Server aus. Antr√§ge f√ºr neue St√§dte werden daher vor√ºbergehend nicht angenommen, bis ich herausgefunden habe, wie dieses Gesch√§ft optimiert werden kann.</font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD 2:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der OSM-Geocoder funktioniert, wie ich bereits geschrieben habe, nicht gut (kennt nur wenige Adressen, erfordert strukturierte Eingabedaten). Daher ist es besser, Punkte manuell auf der Karte zu platzieren, als die Adresse einzugeben. </font><font style="vertical-align: inherit;">In Zukunft m√ºssen Sie sich etwas einfallen lassen, aber alle normalen Geocoder (z. B. Yandex) kosten zu viel Geld f√ºr ein Hobbyprojekt, und in der kostenlosen Version verf√ºgen sie √ºber zu restriktive Lizenzen (z. B. k√∂nnen Sie Suchergebnisse nur auf der Karte von Yandex selbst anzeigen). </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD 3: Ich habe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> eine √ñffentlichkeit in VK gegr√ºndet, in der es m√∂glich sein wird, meine Ideen und Anfragen f√ºr neue St√§dte zu ver√∂ffentlichen und √ºber Aktualisierungen des Dienstes </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;">https://vk.com/public168028574 zu</font></a><font style="vertical-align: inherit;"> schreiben</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"></font></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de414433/">https://habr.com/ru/post/de414433/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de414423/index.html">An diesem Tag haben wir so nah wie m√∂glich gebracht ... Eine neue Version von SBM 11.4 wurde ver√∂ffentlicht</a></li>
<li><a href="../de414425/index.html">Algorithmus zur Erkennung von One-Shot-Lernmustern</a></li>
<li><a href="../de414427/index.html">Was kann ein 3D-Drucker? Bericht aus der Ausstellung Maker Faire Bay Area 2018</a></li>
<li><a href="../de414429/index.html">Wie man eine Fremdsprache ohne Lehrer lernt. Teil 1. "Meine Erfahrung"</a></li>
<li><a href="../de414431/index.html">Mitap JavaJam. Javista Debatte, Log Rafting, Experimente und Microservices</a></li>
<li><a href="../de414437/index.html">Die Blockierung von Telegrammen l√∂ste einen Anstieg der Kosten f√ºr inl√§ndische Startups aus</a></li>
<li><a href="../de414441/index.html">Erleben Sie 1440 Datenbankmigrationen</a></li>
<li><a href="../de414443/index.html">Funktionen von Funktionsaufrufen in C ++</a></li>
<li><a href="../de414445/index.html">Verbesserung von Zimbra mit der Zextras Suite</a></li>
<li><a href="../de414447/index.html">Sorten aller Zeiten</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>