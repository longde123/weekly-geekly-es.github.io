<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî¶ üßùüèæ üèõÔ∏è Gotta Go Fast: Building for Speed ‚Äã‚Äãen iOS. Parte 1 üõåüèæ üò¨ üèòÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hay muchos consejos y trucos que permiten a los desarrolladores de iOS saber c√≥mo realizar optimizaciones de rendimiento para que las animaciones en l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gotta Go Fast: Building for Speed ‚Äã‚Äãen iOS. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/e-Legion/blog/436360/"><img src="https://habrastorage.org/webt/cl/ww/k-/clwwk-yxw7f1pbfvtly5lytqnac.png"><br><br>  Hay muchos consejos y trucos que permiten a los desarrolladores de iOS saber c√≥mo realizar optimizaciones de rendimiento para que las animaciones en las aplicaciones funcionen sin problemas.  Despu√©s de leer el art√≠culo, se dar√° cuenta de lo que significa 16.67 milisegundos para el desarrollador de iOS y qu√© herramientas son mejores para rastrear el c√≥digo. <br><br>  El art√≠culo se basa en la charla magistral impartida por <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Luke Parham</a> , actualmente ingeniero de iOS en Apple y autor de tutoriales para el desarrollo de iOS en RayWenderlich.com, en la Conferencia Internacional de Desarrolladores M√≥viles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">MBLT DEV 2017</a> . <a name="habracut"></a><br><br><blockquote>  "Hola chicos.  Si puede, digamos, puede ahorrar 10 segundos del tiempo de arranque, multiplicar eso por 5 millones de usuarios y eso es 50 millones de segundos cada d√≠a.  M√°s de un a√±o, eso es probablemente decenas de vidas.  Entonces, si haces que arranque diez segundos m√°s r√°pido, has salvado una docena de vidas.  Eso realmente vale la pena, ¬øno te parece? </blockquote><br>  <i>Steve Jobs sobre el rendimiento (tiempo de arranque de Apple II).</i> <br><br><h2>  Rendimiento en iOS o c√≥mo salir de main </h2><br>  El hilo principal es responsable de aceptar la entrada del usuario y mostrar los resultados en la pantalla.  Aceptar grifos, sartenes, todos los gestos y luego renderizar.  La mayor√≠a de los tel√©fonos m√≥viles modernos se procesan a 60 cuadros por segundo.  Significa que todos quieren hacer todo el trabajo en 16.67 milisegundos.  Entonces, salir del hilo principal es algo realmente grande. <br><br>  Si algo demora m√°s de 16.67 milisegundos, entonces soltar√° cuadros autom√°ticamente y sus usuarios lo ver√°n cuando haya animaciones.  Algunos dispositivos tienen incluso menos tiempo para renderizar, por ejemplo, el nuevo iPad tiene 120 Hertz, por lo que solo hay 8 milisegundos por marco para hacer el trabajo. <br><br><h2>  Marcos ca√≠dos </h2><br><h3>  Regla n. ¬∞ 1: utilice un CADisplayLink para rastrear fotogramas descartados </h3><br>  CADisplayLink es un temporizador especial que se activa en Vsync.  El Vsync es cuando la aplicaci√≥n se procesa en la pantalla, y ocurre cada 16 milisegundos.  Para fines de prueba, en su AppDelegate, puede configurar CADisplayLink agregado al ciclo de ejecuci√≥n principal y luego simplemente tener otra funci√≥n donde hacer un poco de matem√°tica.  Luego realiza un seguimiento de cu√°nto tiempo ha estado funcionando la aplicaci√≥n y cu√°nto tiempo ha pasado desde la √∫ltima vez que se activ√≥ esta funci√≥n.  Y vea si tard√≥ m√°s de 16 milisegundos. <br><br><img src="https://habrastorage.org/webt/pm/jv/r_/pmjvr_ketfth1a_vhcp36_lu-mu.png"><br><br>  Esto solo se dispara cuando realmente se renderiza.  Si estaba haciendo un mont√≥n de trabajo y redujo la velocidad del hilo principal, esto se ejecutar√° 100 milisegundos m√°s tarde, lo que significa que ha hecho demasiado trabajo y ha perdido fotogramas en ese momento. <br><br>  Por ejemplo, esta es la aplicaci√≥n Catstagram.  Tartamudea cuando se carga la imagen.  Y luego puede ver que el marco se cay√≥ en un momento determinado y tuvo un tiempo transcurrido de unos 200 milisegundos.  Eso significa que esta aplicaci√≥n est√° haciendo algo que lleva demasiado tiempo. <br><br><img src="https://habrastorage.org/webt/tz/8b/_u/tz8b_u-2r_f5-p7k9pjll9hvhfk.gif"><br><br>  A los usuarios no les gusta tal experiencia, especialmente si la aplicaci√≥n es compatible con dispositivos m√°s antiguos como iPhone 5, iPods antiguos, etc. <br><br><h3>  Perfil de tiempo </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Time Profiler</a> es probablemente la herramienta m√°s √∫til para rastrear las cosas.  Las otras herramientas son √∫tiles pero, al final, en Fyusion usamos Time Profiler como el 90% del tiempo.  Los sospechosos habituales de la aplicaci√≥n son scrollview, texto e im√°genes. <br><br>  Las im√°genes son realmente grandes.  Tenemos decodificaci√≥n JPEG: "UIImageView" equivale a algo de UIImage.  UIimages decodifica todos los archivos JPEG para la aplicaci√≥n.  Lo hacen lentamente, por lo que no puedes seguir el rendimiento directamente.  No sucede justo cuando configura la imagen, pero puede verla en los rastros del generador de perfiles de tiempo. <br>  La medici√≥n de texto es otra gran cosa.  Aparece, por ejemplo, si tiene muchos tipos realmente complejos como el japon√©s o el chino.  Estos pueden tomar mucho tiempo para medir las l√≠neas. <br><br>  El dise√±o de la jerarqu√≠a tambi√©n ralentiza el procesamiento de la aplicaci√≥n.  Esto es especialmente cierto con el dise√±o autom√°tico.  Es conveniente, pero tambi√©n es agresivamente lento en comparaci√≥n con el dise√±o manual.  Por lo tanto, es una de esas compensaciones.  Si ralentiza la aplicaci√≥n, puede ser el momento de alejarse y probar alguna otra t√©cnica de dise√±o. <br><br><h3>  Traza de ejemplo </h3><br><br><img src="https://habrastorage.org/webt/sx/od/dw/sxoddwfs536ehipsoclxey4yysw.png"><br><br>  En el √°rbol de llamadas de ejemplo, puede ver cu√°nto trabajo est√°n haciendo sus CPU.  Puede cambiar las vistas, mirarlo por hilos, mirarlo por CPU.  Por lo general, lo m√°s interesante es separar por hilos y luego mirar lo que est√° en main. <br><br>  Muchas veces, cuando comienzas a mirar esto, parece s√∫per abrumador.  A veces tienes un sentimiento: ‚Äú¬øQu√© es toda esta basura?  No s√© lo que esto significa "FRunLoopDoSource0". <br><br>  Pero es una de las cosas en las que podr√≠a profundizar y comprender c√≥mo funcionan las cosas y comienza a tener sentido.  Para que pueda seguir el rastro de la pila y ver todas las cosas del sistema que no escribi√≥.  Pero en la parte inferior, puedes ver tu c√≥digo real. <br><br><h3>  El √°rbol de llamadas </h3><br>  Por ejemplo, tenemos una aplicaci√≥n realmente simple que tiene la funci√≥n principal, y luego llama a algunos m√©todos dentro de la principal.  Lo que hace el generador de perfiles de tiempo es que toma una instant√°nea de cualquier rastro de su pila en este momento por defecto cada milisegundo.  Luego espera un milisegundo y toma una instant√°nea, donde ha llamado "principal", que ha llamado "foo", que ha llamado "bar".  Hay el primer rastro de la pila sobre la captura de pantalla.  Entonces eso se recoge.  Tenemos estos recuentos: 1, 1, 1. <br><br><img src="https://habrastorage.org/webt/uc/rc/uq/ucrcuqen-b5unzzu3hinwhxny6e.png"><br><br>  Cada una de estas funciones se ha llamado una vez.  Luego, un milisegundo m√°s tarde, capturamos otra pila.  Y esta vez, es exactamente lo mismo, aumentamos todos los recuentos por 2. <br><br><img src="https://habrastorage.org/webt/r2/ak/ez/r2akezneiolgd_p4robekqxddtg.jpeg"><br><br>  Luego, en el tercer milisegundo, tenemos una pila de llamadas ligeramente diferente.  Main llama directamente a "bar".  Principal y bar est√°n arriba por uno.  Pero luego tenemos una divisi√≥n.  A veces, las llamadas principales "foo", a veces las llamadas principales "bar" directamente.  Eso pasa una vez.  Un m√©todo ha sido llamado dentro de otro. <br><br>  M√°s adelante, se ha llamado a un m√©todo dentro de otro que llama al tercer m√©todo.  Vemos que "buz" fue llamado dos veces.  Pero es un m√©todo tan peque√±o que ocurre entre un milisegundo. <br><br>  Usando el generador de perfiles de tiempo, es importante recordar que no proporciona los tiempos exactos.  No dice exactamente cu√°nto tiempo lleva un m√©todo.  Indica con qu√© frecuencia aparece en las instant√°neas, que solo puede aproximarse a cu√°nto tiempo llev√≥ la ejecuci√≥n de cada m√©todo.  Porque si algo es lo suficientemente corto, nunca aparecer√°. <br><br><img src="https://habrastorage.org/webt/2x/9_/3a/2x9_3a7jrotn2hmb7qwcrstnqq8.jpeg"><br><br>  Si cambia al modo de consola en el √°rbol de llamadas, puede ver todos los eventos de ca√≠da de cuadros y puede hacerlos coincidir.  Tenemos un mont√≥n de cuadros que se est√°n cayendo y tenemos un mont√≥n de trabajo en curso.  Puede ampliar el generador de perfiles de tiempo y ver lo que se estaba ejecutando solo en esta secci√≥n. <br><br><img src="https://habrastorage.org/webt/py/rr/mg/pyrrmgpd2zi_g7sfmd0bxkrb0jw.jpeg"><br><br>  En realidad, en Mac, en general, puedes hacer clic en los tri√°ngulos de revelaci√≥n y se abrir√° m√°gicamente y te mostrar√° lo que sea m√°s importante.  Se desplegar√° a lo que sea que est√© haciendo m√°s trabajo.  Y el 90% del tiempo ser√° CFRunLoopRun, y luego las devoluciones de llamada. <br><br><img src="https://habrastorage.org/webt/a9/v-/u0/a9v-u04m0cv1rlw6iodwjhale3y.jpeg"><br><br>  Toda la aplicaci√≥n se basa en un Run Loop.  Tiene este bucle que dura para siempre y luego, en cada iteraci√≥n del bucle, se llaman las devoluciones de llamada.  Cuando llegue a este punto, puede profundizar en cada uno de estos y b√°sicamente ver cu√°les son sus tres o cuatro cuellos de botella principales. <br><br>  Si profundizamos en uno de estos, podemos ver esas cosas donde es realmente f√°cil mirarlo y decir: "Guau, no s√© lo que est√° haciendo".  Como renders, proveedor de im√°genes, IO. <br><br><img src="https://habrastorage.org/webt/jd/ay/wp/jdaywpohjztghohyu9qnxpgqkky.jpeg"><br><br>  Hay una opci√≥n donde puede ocultar las bibliotecas del sistema.  Es realmente tentador esconderse, pero en realidad, este es en realidad el mayor cuello de botella en la aplicaci√≥n. <br><br>  Existen los pesos que muestran qu√© porcentaje del trabajo est√° haciendo esta funci√≥n o m√©todo en particular.  Y si profundizamos en el ejemplo, tenemos un 34% y sucede debido a Apple jpeg_decode_image_all.  Despu√©s de un poco de investigaci√≥n, queda claro que significa que la decodificaci√≥n JPEG est√° ocurriendo en el hilo principal y provoca que la mayor√≠a de los fotogramas caigan. <br><br><img src="https://habrastorage.org/webt/ke/zk/zl/kezkzlggrh1akcegmmvuqefzl7u.png"><br><br><h3>  Regla # 2 </h3><br>  En general, es mejor decodificar archivos JPEG en segundo plano.  La mayor√≠a de las bibliotecas de terceros (AsyncDisplayKit, SDWebImage, ...) lo hacen de forma inmediata.  Si no desea utilizar marcos, puede hacerlo usted mismo.  Lo que hace es pasar una imagen, en este caso, es una extensi√≥n de UIImage, y luego configura un contexto y dibuja la imagen manualmente en un contexto en un CGBitmap. <br><br><img src="https://habrastorage.org/webt/yu/7j/k3/yu7jk3lnsy0csn-k2kddmjha-_w.jpeg"><br><br>  Cuando haces eso, puedes llamar al m√©todo Decodificado Image () desde un hilo de fondo.  Eso siempre devolver√° la imagen decodificada.  No hay forma de verificar si UIImage en particular ya est√° decodificado, y siempre tiene que pasarlos por aqu√≠.  Pero si almacena las cosas correctamente, no hace ning√∫n trabajo adicional. <br><br>  Hacer esto es t√©cnicamente menos eficiente.  Usar UIimageView est√° s√∫per optimizado, s√∫per eficiente.  Har√° decodificaci√≥n de hardware, por lo que es una compensaci√≥n.  Sus im√°genes ser√°n decodificadas m√°s lentamente de esta manera.  Pero lo bueno es que puede enviar a una cola de fondo, decodificar su imagen con el m√©todo que acabamos de ver, y luego volver al hilo principal y configurar su contenido. <br><br><img src="https://habrastorage.org/webt/xu/lv/dg/xulvdgmhnxm6zk4hrfaslok81fg.png"><br><br>  Aunque ese trabajo tom√≥ m√°s tiempo, tal vez no sucedi√≥ en el hilo principal, por lo que no bloque√≥ la interacci√≥n del usuario ya que no bloque√≥ el desplazamiento.  Entonces eso es una victoria. <br><br><h3>  Advertencias de memoria </h3><br>  Cualquier signo de que reciba una advertencia de memoria que desea eliminar todo, elimine toda la memoria no utilizada que pueda.  Pero si tiene cosas que suceden en subprocesos en segundo plano, la asignaci√≥n de estos grandes archivos JPEG decodificados ocupa mucha memoria nueva en subprocesos en segundo plano. <br><br>  Esto sucedi√≥ en la aplicaci√≥n Fyuse.  Si saltara a un hilo de fondo, decodificara todos mis archivos JPEG, en algunos casos en tel√©fonos similares, el sistema lo matar√≠a instant√°neamente.  Y eso se debe a que est√° enviando una advertencia de memoria que dice: ‚Äú¬°Hola!  Desh√°gase de su memoria "pero las colas de fondo no escuchan.  Qu√© sucede si est√° asignando todas estas im√°genes y luego se bloquea cada vez.  La soluci√≥n a esto es hacer ping al hilo principal desde el hilo de fondo. <br><br><img src="https://habrastorage.org/webt/i2/pj/fb/i2pjfbbvytxdsiut5jqirpaibvi.png"><br><br>  En general, el hilo principal es una cola.  Las cosas se ponen en cola y suceden en el hilo principal.  Cuando va al fondo en Objective-C, puede usar performSelectorOnMainThread: withObject: waitUntilDone:.  Esto lo colocar√° al final de la l√≠nea de colas principales, por lo que si la cola principal est√° ocupada procesando advertencias de memoria, esta llamada de funci√≥n ir√° al final de la l√≠nea y esperar√° a que se procesen todas las advertencias de memoria antes de realizar toda esta pesada asignaci√≥n de memoria <br><br>  En Swift, es m√°s simple.  Puede hacer un env√≠o del bloque vac√≠o principal sincr√≥nicamente en main. <br><br>  Aqu√≠ hay un ejemplo en el que hemos limpiado cosas y estamos haciendo decodificaci√≥n de im√°genes en colas de fondo.  Y el desplazamiento visual es mucho m√°s bonito.  Todav√≠a tenemos ca√≠das de fotogramas, pero esto est√° en un iPod 5g, por lo que es una de las peores cosas en las que puedes probar y que todav√≠a es compatible con iOS 10 y 11. <br><br><img src="https://habrastorage.org/webt/bw/fa/og/bwfaog8aavwenf4h1lkqipapnds.gif"><br><br>  Cuando tenga estas ca√≠das de cuadros, puede seguir buscando.  Todav√≠a hay trabajo que est√° sucediendo y est√° causando la ca√≠da de estos cuadros.  Hay m√°s cosas que puedes hacer para hacerlo m√°s r√°pido. <br><br>  En resumen, no siempre es tan f√°cil, pero si tiene peque√±as cosas que toman mucho tiempo, puede hacerlas en segundo plano. <br><br>  Aseg√∫rese de que no est√© relacionado con UIKit.  Muchas clases de UIKit no son seguras para subprocesos y no puede asignar esa UIView en segundo plano. <br><br>  Use Core Graphics si necesita hacer im√°genes en segundo plano.  No oculte las bibliotecas del sistema.  Y no te olvides de las advertencias de memoria. <br><br>  Esta es la primera parte de un art√≠culo basado en la presentaci√≥n de Luke Parham.  Si desea obtener m√°s informaci√≥n sobre la forma en que funciona la interfaz de usuario en iOS, por qu√© utilizar una ruta m√°s clara y cu√°ndo recurrir a la gesti√≥n de memoria manual, lea la segunda parte de un art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h2>  Video </h2><br>  Mira la charla completa aqu√≠: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/tZIQjrPdFcI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es436360/">https://habr.com/ru/post/es436360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436350/index.html">Aprenda t√°cticas adversas, t√©cnicas y conocimientos comunes (ATT @ CK). T√°cticas empresariales. Parte 7</a></li>
<li><a href="../es436352/index.html">Resumen de noticias de PostgreSQL. Edici√≥n No14</a></li>
<li><a href="../es436354/index.html">El ej√©rcito de los Estados Unidos descuida los problemas de ciberseguridad</a></li>
<li><a href="../es436356/index.html">[Interesante desde detr√°s de la colina] ¬øC√≥mo detenemos la dependencia tecnol√≥gica?</a></li>
<li><a href="../es436358/index.html">¬øPor qu√© los desarrolladores senior ense√±an a los estudiantes?</a></li>
<li><a href="../es436364/index.html">Liveprof mostrar√° cu√°ndo y por qu√© ha cambiado el rendimiento de su aplicaci√≥n PHP</a></li>
<li><a href="../es436370/index.html">Infraestructura de clave p√∫blica Cadena de certificados ra√≠z X509 v.3</a></li>
<li><a href="../es436372/index.html">Plugin isom√©trico para Unity3D</a></li>
<li><a href="../es436374/index.html">Tendencias de dise√±o de UI y UX 2019</a></li>
<li><a href="../es436376/index.html">Descripci√≥n general del robot todo terreno EZ-Robot Roli Rover</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>