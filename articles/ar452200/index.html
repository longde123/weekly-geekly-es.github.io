<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ปโโ๏ธ ๐คด๐ฝ ๐ GOSTIM: P2P F2F E2EE IM ูู ูููุฉ ูุงุญุฏุฉ ูุน ุชุดููุฑ GOST ๐๐ฟ ๐ฅ โ๐ฝ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุจุตูุชู ูุทูุฑูุง ูููุชุจุฉ PyGOST ( ุจุฏุงูุงุช ุชุดููุฑ GOST ูู Python ุงูุฎุงูุต) ุ ุบุงูุจูุง ูุง ุฃุญุตู ุนูู ุฃุณุฆูุฉ ุญูู ููููุฉ ุชูููุฐ ุฃุจุณุท ุงูุฑุณุงุฆู ุงูุขููุฉ ุนูู ุฑูุจุชู. ูุนุชุจุฑ ุงููุซู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GOSTIM: P2P F2F E2EE IM ูู ูููุฉ ูุงุญุฏุฉ ูุน ุชุดููุฑ GOST</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452200/" style=";text-align:right;direction:rtl">  ุจุตูุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุทูุฑูุง</a> ูููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PyGOST</a> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุจุฏุงูุงุช</a> ุชุดููุฑ GOST ูู Python ุงูุฎุงูุต) ุ ุบุงูุจูุง ูุง ุฃุญุตู ุนูู ุฃุณุฆูุฉ ุญูู ููููุฉ ุชูููุฐ ุฃุจุณุท ุงูุฑุณุงุฆู ุงูุขููุฉ ุนูู ุฑูุจุชู.  ูุนุชุจุฑ ุงููุซูุฑูู ุฃู ุงูุชุดููุฑ ุงููุทุจู ุฃูุฑ ุจุณูุท ุฅูู ุญุฏ ูุง ุ ูุณุชููู ููุงููุฉ. encrypt () ุฅูู ุชุดููุฑ ุงูุจููู ูุงููุฉ ูุฅุฑุณุงููุง ุจุฃูุงู ุนุจุฑ ููุงุฉ ุงุชุตุงู.  ูุนุชูุฏ ุงูุจุนุถ ุงูุขุฎุฑ ุฃู ุงูุชุดููุฑ ุงููุทุจู ูู ูุตูุฑ ุนุฏุฏ ูููู ุ ููู ุงูููุจูู ุฃู ุงูุดุฑูุงุช ุงูุบููุฉ ูุซู Telegram ูุน ุฃูููุจูุงุฏ ุงูุฑูุงุถูุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุง ุชุณุชุทูุน ุชุทุจูู</a> ุจุฑูุชูููู ุขูู. <br><br>  ูู ูุฐุง ุฏูุนูู ุฅูู ูุชุงุจุฉ ูุฐู ุงูููุงูุฉ ูุฅุธูุงุฑ ุฃู ุชูููุฐ ุจุฑูุชููููุงุช ุงูุชุดููุฑ ูุงูุชุฑุงุณู ุงูููุฑู ุงูุขูู ููุณ ูููุฉ ุตุนุจุฉ.  ููุน ุฐูู ุ ูุฅู ุงุจุชูุงุฑ ุจุฑูุชููููุงุช ุงููุตุงุฏูุฉ ูุงูุงุชูุงู ุงูุฑุฆูุณูุฉ ูุง ูุณุชุญู ูู ูุฐุง ุงูุนูุงุก. <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img alt="ุงูุณูุน" src="https://habrastorage.org/getpro/habr/post_images/4e2/2bb/f04/4e22bbf0480a8181bcbb2054c6f95815.jpg"></div><br>  ุณูุชู ูุชุงุจุฉ ุงูููุงู ุจุฑุณุงูุฉ ููุฑูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดูุฑุฉ ูู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุธูุฑ ุฅูู ูุธูุฑ</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุตุฏูู ุฅูู ุตุฏูู</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดูุฑุฉ ูู ุทุฑู ุฅูู ุทุฑู</a> ูุน ูุตุงุฏูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SIGMA-I</a> ูุจุฑูุชูููู ุงุชูุงู ุงูููุชุงุญ (ุจูุงุกู ุนูู ุชุทุจูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">IPsec IKE</a> ) ุ ุจุงุณุชุฎุฏุงู ุฎูุงุฑุฒููุงุช ุชุดููุฑ GOST ุญุตุฑููุง ููุชุจุฉ PyGOST ู ุชุฑููุฒ ASN.1 ููุฑุณุงุฆู ูุน ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PyDERASN</a> (ุงูุชู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุชุจุช ุนููุง ูู ูุจู</a> ).  ุงููุชุทูุจ ุงูุณุงุจู: ูุฌุจ ุฃู ูููู ุงูุฃูุฑ ุจุณูุทูุง ููุบุงูุฉ ุจุญูุซ ูููู ูุชุงุจุชู ูู ููุทุฉ ุงูุตูุฑ ูู ุฅุญุฏู ุงูููุงูู (ุฃู ููู ุงูุนูู) ุ ูุฅูุง ูุฅูู ูู ูุนุฏ ุจุฑูุงูุฌูุง ุจุณูุทูุง.  ูู ุงููุญุชูู ุฃูู ูุญุชูู ุนูู ุฃุฎุทุงุก ูุตุนูุจุงุช ุบูุฑ ุถุฑูุฑูุฉ ูุฃูุฌู ูุตูุฑ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฃู ูุฐุง ูู ุฃูู ุจุฑูุงูุฌ ูู ุจุงุณุชุฎุฏุงู ููุชุจุฉ asyncio. <br><a name="habracut"></a><br><h2 style=";text-align:right;direction:rtl">  ุชุตููู ุงูุฏุฑุฏุดุฉ </h2><br>  ูุชุจุฏุฃ ุ ุชุญุชุงุฌ ุฅูู ููู ููู ุณูุจุฏู IM ูุฏููุง.  ููุจุณุงุทุฉ ุ ููููู ุดุจูุฉ ูู ูุธูุฑ ุฅูู ูุธูุฑ ุ ุฏูู ุฃู ุงูุชุดุงู ูููุดุงุฑููู.  ุณูุดูุฑ ุดุฎุตููุง ุฅูู ุงูุนููุงู: ุงููููุฐ ุงูุฐู ุณูุชู ุงูุงุชุตุงู ุจู ููุชูุงุตู ูุน ุงููุญุงูุฑ. <br><br>  ุฃููู ุฃูู ูู ุงูููุช ุงูุญุงูู ุ ูุนุฏ ุงูุชุฑุงุถ ุชููุฑ ุงูุงุชุตุงู ุงููุจุงุดุฑ ุจูู ุฌูุงุฒู ููุจููุชุฑ ุชุนุณูููู ุฃุญุฏ ุงููููุฏ ุงููููุฉ ุนูู ุชุทุจูู ุงูุฑุณุงุฆู ุงูููุฑูุฉ ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ.  ูููู ูููุง ุฒุงุฏ ุนุฏุฏ ุงููุทูุฑูู ุงูุฐูู ุณูููุฐูู ุฌููุน ุฃููุงุน ุนูุงุฒ NAT-traversal ุ ูููุง ุจูููุง ุนูู ุงูุฅูุชุฑูุช IPv4 ุ ูุน ุงุญุชูุงู ูุญุจุท ููุงุชุตุงู ุจูู ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงูุชุนุณููุฉ.  ุญุณููุง ุ ุฅูู ุฃู ูุฏู ููููู ุชุญูู ููุต IPv6 ูู ุงูููุฒู ููู ุงูุนููุ <br><br>  ุณูููู ูุฏููุง ุดุจูุฉ ูู ุตุฏูู ุฅูู ุตุฏูู: ูุฌุจ ุฃู ุชููู ุฌููุน ุงููุญุงูุฑูู ุงููุญุชูููู ูุนุฑููุฉ ูุณุจููุง.  ุฃููุงู ุ ุฅูู ูุจุณุท ูู ุดูุก ุฅูู ุญุฏ ูุจูุฑ: ูุฏู ููุณู ุ ุฃู ูุฌุฏ ุฃู ูู ูุฌุฏ ุงุณููุง / ููุชุงุญูุง ุ ุฃู ุบูุฑ ูุชุตู ุฃู ูุณุชูุฑ ูู ุงูุนูู ุ ููุนุฑูุฉ ุงููุญุงูุฑ.  ุซุงููุงู ุ ูู ุงูุญุงูุฉ ุงูุนุงูุฉ ุ ุฅูู ุขูู ููุณุชุจุนุฏ ุงูุนุฏูุฏ ูู ุงููุฌูุงุช. <br><br>  ุณุชููู ูุงุฌูุฉ ุงููุฑุงุณูุฉ ุงูููุฑูุฉ ูุฑูุจุฉ ูู ุงูุญููู ุงูููุงุณูููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุดุงุฑูุน ุบูุฑ ุงูููููุณุฉ</a> ุ ูุงูุชู ุฃุญุจูุง ุญููุง ูููุณูุชูุง ูููุณูุชูุง ูู ูุธุงู Unix-way.  ูููู ุจุฑูุงูุฌ IM ููู ูุญุงูุฑ ุจุฅูุดุงุก ุฏููู ูุญุชูู ุนูู ุซูุงุซุฉ ูุขุฎุฐ ูููุทุงู Unix: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู - ูุชู ุชุณุฌูู ุงูุฑุณุงุฆู ุงููุฑุณูุฉ ุฅูู ุงููุญุงูุฑ ูููุง ุ </li><li style=";text-align:right;direction:rtl">  ุงูุฑุณุงุฆู ุงูุฎุงุฑุฌูุฉ ุงููุงุฑุฏุฉ ูู ุงููุญุงูุฑ ุชุชู ูุฑุงุกุชูุง ููู ุ </li><li style=";text-align:right;direction:rtl">  ุงูุญุงูุฉ - ูู ุฎูุงู ุงููุฑุงุกุฉ ุ ุณููุชุดู ูุง ุฅุฐุง ูุงู ุงููุญุงูุฑ ูุชุตู ุงูุขู ุ ูุนููุงู / ูููุฐ ุงูุงุชุตุงู. </li></ul><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุชู ุฅูุดุงุก ูุฃุฎุฐ ุชูุตูู conn ุ ููุชุจ ุฅูู ุฃู ูููุฐ ูุถูู ุ ูุจุฏุฃ ูู ุงูุงุชุตุงู ุจูุญุงูุฑ ุจุนูุฏ. <br><br><pre style=";text-align:right;direction:rtl"> | - ุฃููุณ
 |  | - ูู
 |  | - ุฎุงุฑุฌ
 |  `- ุงูุฏููุฉ
 | - ุจูุจ
 |  | - ูู
 |  | - ุฎุงุฑุฌ
 |  `- ุงูุฏููุฉ
 `- ููู
</pre><br>  ูุชูุญ ูู ูุฐุง ุงูููุฌ ุฅุฌุฑุงุก ุชุทุจููุงุช ูุณุชููุฉ ูููู ุงูุฑุณุงุฆู ุงูููุฑูุฉ ููุงุฌูุฉ ุงููุณุชุฎุฏู ุ ูุฃูู ูุง ููุฌุฏ ุตุฏูู ููุฐูู ูุงูููู ุ ููู ูุฑุถู ุงูุฌููุน.  ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">tmux</a> ู / ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">multitail</a> ุ ููููู ุงูุญุตูู ุนูู ูุงุฌูุฉ ูุชุนุฏุฏุฉ ุงูููุงูุฐ ูุน ุชุณููุท ุงูุถูุก ุนูู ุจูุงุก ุงูุฌููุฉ.  ููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">rlwrap ุ</a> ููููู ุงูุญุตูู ุนูู ุณูุณูุฉ ูุชูุงููุฉ ูุน GNU Readline ูุฅุฏุฎุงู ุงูุฑุณุงุฆู. <br><br>  ูู ุงููุงูุน ุ ุชุณุชุฎุฏู ูุดุงุฑูุน suckless ูููุงุช FIFO.  ุดุฎุตูุง ุ ูู ุฃุณุชุทุน ุฃู ุฃููู ููู ุฃู ุงูุนูู ุบูุฑ ุงููุชุฒุงูู ูุน ุงููููุงุช ุจุดูู ุชูุงูุณู ุฏูู ุฑููุฒุฉ ูุตููุนุฉ ูุฏูููุง ูู ุณูุงุณู ุงูุฑุณุงุฆู ุงููุญุฏุฏุฉ (ููุช ุฃุณุชุฎุฏู ูุบุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Go</a> ููุซู ูุฐู ุงูุฃุดูุงุก ููุชุฑุฉ ุทูููุฉ).  ูุฐูู ุ ูุฑุฑุช ุฃู ุฃุญุตู ุนูู ูุขุฎุฐ ุงููุฌุงู ูููููุณ.  ูุณูุก ุงูุญุธ ุ ูุฐุง ูุฌุนู ูู ุงููุณุชุญูู ุงูููุงู ุตุฏู 2001: 470: dead :: babe 6666&gt; conn.  ููุฏ ููุช ุจุญู ูุฐู ุงููุดููุฉ ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">socat</a> : echo 2001: 470: dead :: babe 6666 |  socat - UNIX-CONNECT: connุ socat READLINE UNIX-CONNECT: alice / in. <br><br><h2 style=";text-align:right;direction:rtl">  ุจุฑูุชูููู ุบูุฑ ุขูู ุงูุฃููู </h2><br>  ูุณุชุฎุฏู TCP ููุณููุฉ ููู: ุฅูู ูุถูู ุงูุชุณููู ูุชุฑุชูุจู.  ูุถูู UDP ูุง ูุฐุง ููุง ุฐุงู (ูุงูุฐู ุณูููู ูููุฏูุง ุนูุฏ ุชุทุจูู ุงูุชุดููุฑ) ุ ูุฏุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SCTP</a> ูู Python ุฎุงุฑุฌ ุงูุตูุฏูู. <br><br>  ูุณูุก ุงูุญุธ ุ ููุณ ูุฏู TCP ููููู ููุฑุณุงูุฉ ุ ูููู ููุท ุฏูู ูู ุงูุจุงูุช.  ูุฐูู ุ ูู ุงูุถุฑูุฑู ุงูุชูุตู ุฅูู ุชูุณูู ููุฑุณุงุฆู ุจุญูุซ ูููู ูุดุงุฑูุชูุง ูููุง ุจูููุง ูู ูุฐุง ุงูุฏูู.  ูููููุง ุฃู ููุงูู ุนูู ุงุณุชุฎุฏุงู ุญุฑู ุชุบุฐูุฉ ุงูุณุทุฑ.  ุจุงููุณุจุฉ ูููุจุชุฏุฆูู ุ ูู ุงูููุงุณุจ ุ ุนูุฏูุง ูุจุฏุฃ ุจุชุดููุฑ ุฑุณุงุฆููุง ุ ูุฏ ูุธูุฑ ูุฐุง ุงูุฑูุฒ ูู ุฃู ููุงู ูู ุงููุต ุงููุดูุฑ.  ูุฐูู ุ ุชุนุชุจุฑ ุงูุจุฑูุชููููุงุช ุดุงุฆุนุฉ ุนูู ุงูุดุจูุงุช ุ ุญูุซ ุชุฑุณู ุฃููุงู ุทูู ุงูุฑุณุงูุฉ ุจุงูุจุงูุช.  ุนูู ุณุจูู ุงููุซุงู ุ ูู Python ุ ููุฌุฏ ุฎุงุฑุฌ ุงูุตูุฏูู xdrlib ุ ูุงูุฐู ูุณูุญ ูู ุจุงูุนูู ุจุชูุณูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">XDR</a> ููุงุซู. <br><br>  ูู ูุนูู ุจุดูู ุตุญูุญ ูููุก ูุน ูุฑุงุกุฉ TCP - ูุญู ูุจุณุท ุงูุดูุฑุฉ.  ููุฑุฃ ุงูุจูุงูุงุช ูู ูุฃุฎุฐ ุงูุชูุตูู ูู ุญููุฉ ูุง ููุงุฆูุฉ ุญุชู ูููู ุจูู ุชุดููุฑ ุงูุฑุณุงูุฉ ูุงููุฉ.  ููููู ุฃูุถูุง ุงุณุชุฎุฏุงู JSON ูุน XML ูุชูุณูู ููุฐุง ุงูููุฌ.  ูููู ุนูุฏ ุฅุถุงูุฉ ุงูุชุดููุฑ ุ ุณูุชุนูู ุชูููุน ุงูุจูุงูุงุช ูุงููุตุงุฏูุฉ ุนูููุง - ููุฐุง ุณูุชุทูุจ ุชูุซูููุง ูุชุทุงุจููุง ุจุงูุช ููู ูุงุฆูุงุช ุ ูุงูุชู ูุง ูููุฑูุง JSON / XML (ูุฏ ุชุฎุชูู ุนูููุงุช ุงูุชูุฑูุบ). <br><br>  XDR ููุงุณุจุฉ ููุซู ูุฐู ุงููููุฉ ุ ููุน ุฐูู ุ ุงุฎุชุฑุช ASN.1 ูุน DER ุชุฑููุฒ ูููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PyDERASN</a> ุ ุญูุซ ุณูููู ูุฏููุง ูุงุฆูุงุช ุนุงููุฉ ุงููุณุชูู ูู ูุชูุงูู ุงููุฏ ุ ูุงูุชู ุบุงูุจุง ูุง ุชููู ุฃูุซุฑ ููุงุกูุฉ ููุนูู.  ุจุฎูุงู bencode ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">MessagePack</a> ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CBOR</a> ุ ูุฅู ASN.1 ุณุชููู ุชููุงุฆููุง ุจุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช ููุงุจู ูุฎุทุท ูุดูุฑ. <br><br><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Msg ::= CHOICE { # text MsgText, # handshake [0] EXPLICIT MsgHandshake } class Msg(Choice): schema = (( ("text", MsgText()), ("handshake", MsgHandshake(expl=tag_ctxc(0))), )) # MsgText ::= SEQUENCE { # text UTF8String (SIZE(1..MaxTextLen))} class MsgText(Sequence): schema = (( ("text", UTF8String(bounds=(1, MaxTextLen))), )) # MsgHandshake ::= SEQUENCE { # peerName UTF8String (SIZE(1..256)) } class MsgHandshake(Sequence): schema = (( ("peerName", UTF8String(bounds=(1, 256))), ))</span></span></code> </pre> <br>  ุณุชููู ุงูุฑุณุงูุฉ ุงููุณุชููุฉ ูู Msg: ุฅูุง ูุต MsgText (ูุน ุญูู ูุต ูุงุญุฏ ุญุชู ุงูุขู) ุฃู ุฑุณุงูุฉ ูุตุงูุญุฉ MsgHandshake (ุงูุชู ูุชู ูููุง ููู ุงุณู ุงููุญุงูุฑ).  ุงูุขู ูุจุฏู ุงูุฃูุฑ ูุนูุฏูุง ุ ูููู ุชุญุฏู ูููุณุชูุจู. <br><br><pre style=";text-align:right;direction:rtl">      โโโโโโโ โโโโโโโ
      eerPeerAโ โPeerBโ
      โโโโฌโโโ โโโโฌโโโ
         sgMsgHandshake (IdA) โ
         โโโโโโโโโโโโโโโโโโ &gt;&gt; โ
         โ โ
         sgMsgHandshake (IdB) โ
         โ &lt;โโโโโโโโโโโโโโโโโโ
         โ โ
         sg MsgText () โ
         โโโโโโโโโโโโโโโโโโ &gt;&gt; โ
         โ โ
         sg MsgText () โ
         โ &lt;โโโโโโโโโโโโโโโโโโ
         โ โ
</pre><br><br><h2 style=";text-align:right;direction:rtl">  ุงูุฏุฑุฏุดุฉ ุฏูู ุงูุชุดููุฑ </h2><br>  ููุง ููุช ุ ุณูุชู ุงุณุชุฎุฏุงู ููุชุจุฉ ุงููุฒุงููุฉ ูุฌููุน ุงูุนูููุงุช ูุน ูุขุฎุฐ.  ุฃุนูู ูุง ูุชููุนู ุนูุฏ ุงูุฅุทูุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">parser = argparse.ArgumentParser(description=<span class="hljs-string"><span class="hljs-string">"GOSTIM"</span></span>) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--our-name"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Our peer name"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--their-names"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Their peer names, comma-separated"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--bind"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"::1"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Address to listen on"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--port"</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">6666</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Port to listen on"</span></span>, ) args = parser.parse_args() OUR_NAME = UTF8String(args.our_name) THEIR_NAMES = set(args.their_names.split(<span class="hljs-string"><span class="hljs-string">","</span></span>))</code> </pre><br>  ุญุฏุฏ ุงุณูู ุงูุฎุงุต (- ุงุณูู ุฃููุณ).  ุชุณุฑุฏ ุงููุงุตูุฉ ุฌููุน ุงููุญุงูุฑูู ุงููุชููุนูู (- ุฃุณูุงุกูู bob ุ eve).  ููู ูู ุงููุญุงูุฑูู ุ ูุชู ุฅูุดุงุก ุฏููู ูุน ูุขุฎุฐ ููููุณ ุ ููุฐูู coroutine ููู ูู ุ ุฎุงุฑุฌ ุ ุงูุฏููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> peer_name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> THEIR_NAMES: makedirs(peer_name, mode=<span class="hljs-number"><span class="hljs-number">0o700</span></span>, exist_ok=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) out_queue = asyncio.Queue() OUT_QUEUES[peer_name] = out_queue asyncio.ensure_future(asyncio.start_unix_server( partial(unixsock_out_processor, out_queue=out_queue), path.join(peer_name, <span class="hljs-string"><span class="hljs-string">"out"</span></span>), )) in_queue = asyncio.Queue() IN_QUEUES[peer_name] = in_queue asyncio.ensure_future(asyncio.start_unix_server( partial(unixsock_in_processor, in_queue=in_queue), path.join(peer_name, <span class="hljs-string"><span class="hljs-string">"in"</span></span>), )) asyncio.ensure_future(asyncio.start_unix_server( partial(unixsock_state_processor, peer_name=peer_name), path.join(peer_name, <span class="hljs-string"><span class="hljs-string">"state"</span></span>), )) asyncio.ensure_future(asyncio.start_unix_server(unixsock_conn_processor, <span class="hljs-string"><span class="hljs-string">"conn"</span></span>))</code> </pre><br>  ูุชู ุฅุฑุณุงู ุงูุฑุณุงุฆู ูู ูุฃุฎุฐ ุงูุชูุตูู ูู ุงููุณุชุฎุฏู ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ IN_QUEUES: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_in_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer, in_queue: asyncio.Queue)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> reader.read(MaxTextLen) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text == <span class="hljs-string"><span class="hljs-string">b""</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> in_queue.put(text.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>))</code> </pre><br>  ูุชู ุฅุฑุณุงู ุงูุฑุณุงุฆู ูู ุงููุญุงูุฑูู ุฅูู ูุงุฆูุฉ ุงูุชุธุงุฑ OUT_QUEUES ุ ูุงูุชู ุชุชู ูุชุงุจุฉ ุงูุจูุงูุงุช ูููุง ุฅูู ูุฃุฎุฐ ุงูุชูุตูู ุงูุฎุงุฑุฌู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_out_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer, out_queue: asyncio.Queue)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> out_queue.get() writer.write((<span class="hljs-string"><span class="hljs-string">"[%s] %s"</span></span> % (datetime.now(), text)).encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain()</code> </pre><br>  ุนูุฏ ุงููุฑุงุกุฉ ูู ูุฃุฎุฐ ุงูุญุงูุฉ ุ ูุจุญุซ ุงูุจุฑูุงูุฌ ูู ูุงููุณ PEER_ALIVE ุนู ุนููุงู ุงููุญุงูุฑ.  ุฅุฐุง ูู ููู ููุงู ุงุชุตุงู ุจุงููุญุงูุฑ ุจุนุฏ ุ ูุณูุชู ูุชุงุจุฉ ุณุทุฑ ูุงุฑุบ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_state_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer, peer_name: str)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> peer_writer = PEER_ALIVES.get(peer_name) writer.write( <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> peer_writer <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> (<span class="hljs-string"><span class="hljs-string">" "</span></span>.join([ str(i) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> peer_writer.get_extra_info(<span class="hljs-string"><span class="hljs-string">"peername"</span></span>)[:<span class="hljs-number"><span class="hljs-number">2</span></span>] ]).encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) + <span class="hljs-string"><span class="hljs-string">b"\n"</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() writer.close()</code> </pre><br>  ุนูุฏ ูุชุงุจุฉ ุนููุงู ุฅูู ููุจุณ conn ุ ูุชู ุฅุทูุงู ูุธููุฉ "ุงูุจุงุฏุฆ" ุงูุฎุงุตุฉ ุจุงูุงุชุตุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unixsock_conn_processor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> reader.read(<span class="hljs-number"><span class="hljs-number">256</span></span>) writer.close() host, port = data.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>).split(<span class="hljs-string"><span class="hljs-string">" "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> initiator(host=host, port=int(port))</code> </pre><br>  ุงููุธุฑ ูู ุงูุจุงุฏุฆ.  ุฃููุงู ุ ูู ุงููุงุถุญ ุฃูู ููุชุญ ุงุชุตุงููุง ุจุงููุถูู / ุงููููุฐ ุงููุญุฏุฏ ููุฑุณู ุฑุณุงูุฉ ูุตุงูุญุฉ ุจุงุณูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">130</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initiator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host, port)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">131</span></span> _id = repr((host, port)) <span class="hljs-number"><span class="hljs-number">132</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: dialing"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">133</span></span> reader, writer = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.open_connection(host, port) <span class="hljs-number"><span class="hljs-number">134</span></span> <span class="hljs-comment"><span class="hljs-comment"># Handshake message {{{ 135 writer.write(Msg(("handshake", MsgHandshake(( 136 ("peerName", OUR_NAME), 137 )))).encode()) 138 # }}} 139 await writer.drain()</span></span></code> </pre><br>  ุซู ููุชุธุฑ ุงุณุชุฌุงุจุฉ ูู ุงูุฌุงูุจ ุงูุจุนูุฏ.  ูุญุงููุงุช ูู ุชุดููุฑ ุงูุงุณุชุฌุงุจุฉ ุงููุชููุงุฉ ููููุง ููุธุงู Msg ASN.1.  ููุชุฑุถ ุฃู ุงูุฑุณุงูุฉ ุจุฃููููุง ุณูุชู ุฅุฑุณุงููุง ุจูุงุณุทุฉ ูุทุนุฉ TCP ูุงุญุฏุฉ ูุณูุณุชูููุง ุชููุงุฆููุง ุนูุฏ ุงุณุชุฏุนุงุก .read ().  ูุชุญูู ูู ุชููููุง ุฑุณุงูุฉ ุงููุตุงูุญุฉ ุชูุงููุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">141</span></span> <span class="hljs-comment"><span class="hljs-comment"># Wait for Handshake message {{{ 142 data = await reader.read(256) 143 if data == b"": 144 logging.warning("%s: no answer, disconnecting", _id) 145 writer.close() 146 return 147 try: 148 msg, _ = Msg().decode(data) 149 except ASN1Error: 150 logging.warning("%s: undecodable answer, disconnecting", _id) 151 writer.close() 152 return 153 logging.info("%s: got %s message", _id, msg.choice) 154 if msg.choice != "handshake": 155 logging.warning("%s: unexpected message, disconnecting", _id) 156 writer.close() 157 return 158 # }}}</span></span></code> </pre><br>  ูุชุญูู ูู ุฃู ุงุณู ุงูุดุฎุต ุงูุฐู ูุชุญุฏุซ ูุนู ูุนุฑูู ููุง.  ุฅุฐุง ูู ููู ูุฐูู ุ ุซู ูุทุน ุงูุงุชุตุงู.  ูุชุญูู ููุง ุฅุฐุง ููุง ูุฏ ุฃูุดุฃูุง ุจุงููุนู ุงุชุตุงููุง ูุนู (ุฃุนุทู ุงููุญุงูุฑ ุงูุฃูุฑ ูุฑุฉ ุฃุฎุฑู ููุงุชุตุงู ุจูุง) ูุฅุบูุงูู.  ูุชู ูุถุน ุณูุงุณู Python ูุน ูุต ุงูุฑุณุงูุฉ ูู ูุงุฆูุฉ ุงูุชุธุงุฑ IN_QUEUES ุ ูููู ููุงู ูููุฉ ุฎุงุตุฉ ุจูุง ุ ูุงูุชู ุชุดูุฑ ุฅูู msg_sender ุฅูู coroutine ููุชููู ุนู ุงูุนูู ุญุชู ุฅููุง ุณุชูุณู ูุงุชุจูุง ุงููุชุตู ุจุงุชุตุงู TCP ุงููุฏูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">159</span></span> msg_handshake = msg.value <span class="hljs-number"><span class="hljs-number">160</span></span> peer_name = str(msg_handshake[<span class="hljs-string"><span class="hljs-string">"peerName"</span></span>]) <span class="hljs-number"><span class="hljs-number">161</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> peer_name <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> THEIR_NAMES: <span class="hljs-number"><span class="hljs-number">162</span></span> logging.warning(<span class="hljs-string"><span class="hljs-string">"unknown peer name: %s"</span></span>, peer_name) <span class="hljs-number"><span class="hljs-number">163</span></span> writer.close() <span class="hljs-number"><span class="hljs-number">164</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">165</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: session established: %s"</span></span>, _id, peer_name) <span class="hljs-number"><span class="hljs-number">166</span></span> <span class="hljs-comment"><span class="hljs-comment"># Run text message sender, initialize transport decoder {{{ 167 peer_alive = PEER_ALIVES.pop(peer_name, None) 168 if peer_alive is not None: 169 peer_alive.close() 170 await IN_QUEUES[peer_name].put(None) 171 PEER_ALIVES[peer_name] = writer 172 asyncio.ensure_future(msg_sender(peer_name, writer)) 173 # }}}</span></span></code> </pre><br>  ููุจู msg_sender ุงูุฑุณุงุฆู ุงูุตุงุฏุฑุฉ (ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูู ูุฃุฎุฐ ุชูุตูู) ุ ููุณูุณููุง ุฅูู ุฑุณุงูุฉ MsgText ุ ููุฑุณููุง ุนุจุฑ ุงุชุตุงู TCP.  ูููู ุฃู ุชููุฌุฑ ูู ุฃู ูุญุธุฉ - ูุญู ูุนุชุฑุถ ุฐูู ุจูุถูุญ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_sender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(peer_name: str, writer)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> in_queue = IN_QUEUES[peer_name] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> in_queue.get() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> writer.write(Msg((<span class="hljs-string"><span class="hljs-string">"text"</span></span>, MsgText(( (<span class="hljs-string"><span class="hljs-string">"text"</span></span>, UTF8String(text)), )))).encode()) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionResetError: <span class="hljs-keyword"><span class="hljs-keyword">del</span></span> PEER_ALIVES[peer_name] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: sent %d characters message"</span></span>, peer_name, len(text))</code> </pre><br>  ูู ุงูููุงูุฉ ุ ูุฏุฎู ุงูุจุงุฏุฆ ุฏูุฑุฉ ูุง ููุงูุฉ ููุง ูู ูุฑุงุกุฉ ุงูุฑุณุงุฆู ูู ุงูููุจุณ.  ููุชุญูู ููุง ุฅุฐุง ูุงูุช ูุฐู ุฑุณุงูุฉ ูุตูุฉ ุ ููุถุน ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ OUT_QUEUES ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุชู ุณูุชู ุฅุฑุณุงููุง ูููุง ุฅูู ูุฃุฎุฐ ุงูุชูุตูู ุงูุฎุงุฑุฌ ูู ุงููุญุงูุฑ ุงูููุงุจู.  ููุงุฐุง ูุง ููููู ุงูููุงู ุจุฐูู ููุท .read () ููู ุชุดููุฑ ุงูุฑุณุงูุฉุ  ูุฃูู ูู ุงููููู ุชุฌููุน ุนุฏุฉ ุฑุณุงุฆู ูู ุงููุณุชุฎุฏู ูู ุงููุฎุฒู ุงููุคูุช ููุธุงู ุงูุชุดุบูู ูุฅุฑุณุงููุง ุจูุงุณุทุฉ ูุทุนุฉ TCP ูุงุญุฏุฉ.  ูููููุง ูู ุชุดููุฑ ุงูุฃูู ุ ุซู ูุฏ ูุธู ุฌุฒุก ูู ุงููุงุญู ูู ุงููุฎุฒู ุงููุคูุช.  ูู ุฃู ุญุงูุฉ ูู ุญุงูุงุช ุงูุทูุงุฑุฆ ุ ูุบูู ุงุชุตุงู TCP ููููู ุชุดุบูู corgine msg_sender (ุนู ุทุฑูู ุฅุฑุณุงู ุจูุง ุฅูู ูุงุฆูุฉ ุงูุชุธุงุฑ OUT_QUEUES). <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">174</span></span> buf = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-number"><span class="hljs-number">175</span></span> <span class="hljs-comment"><span class="hljs-comment"># Wait for test messages {{{ 176 while True: 177 data = await reader.read(MaxMsgLen) 178 if data == b"": 179 break 180 buf += data 181 if len(buf) &gt; MaxMsgLen: 182 logging.warning("%s: max buffer size exceeded", _id) 183 break 184 try: 185 msg, tail = Msg().decode(buf) 186 except ASN1Error: 187 continue 188 buf = tail 189 if msg.choice != "text": 190 logging.warning("%s: unexpected %s message", _id, msg.choice) 191 break 192 try: 193 await msg_receiver(msg.value, peer_name) 194 except ValueError as err: 195 logging.warning("%s: %s", err) 196 break 197 # }}} 198 logging.info("%s: disconnecting: %s", _id, peer_name) 199 IN_QUEUES[peer_name].put(None) 200 writer.close() 66 async def msg_receiver(msg_text: MsgText, peer_name: str) -&gt; None: 67 text = str(msg_text["text"]) 68 logging.info("%s: received %d characters message", peer_name, len(text)) 69 await OUT_QUEUES[peer_name].put(text)</span></span></code> </pre><br>  ุฏุนูุง ูุนูุฏ ุฅูู ุงูุฑูุฒ ุงูุฑุฆูุณู.  ุจุนุฏ ุฅูุดุงุก ุฌููุน coroutines ุ ูู ููุช ุจุฏุก ุงูุจุฑูุงูุฌ ุ ุจุฏุฃูุง ุฎุงุฏู TCP.  ููู ุงุชุตุงู ุงูููุดุฃุฉ ุ ููุงู ุงูู ูุฎูู coroutine ุงููุณุชุฌูุจ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">logging.basicConfig( level=logging.INFO, format=<span class="hljs-string"><span class="hljs-string">"%(levelname)s %(asctime)s: %(funcName)s: %(message)s"</span></span>, ) loop = asyncio.get_event_loop() server = loop.run_until_complete(asyncio.start_server(responder, args.bind, args.port)) logging.info(<span class="hljs-string"><span class="hljs-string">"Listening on: %s"</span></span>, server.sockets[<span class="hljs-number"><span class="hljs-number">0</span></span>].getsockname()) loop.run_forever()</code> </pre><br>  ูุดุจู ุงููุณุชุฌูุจ ุงูุจุงุฏุฆ ููุนูุณ ุฌููุน ุงูุฅุฌุฑุงุกุงุช ููุณูุง ุ ูููู ุญููุฉ ูุง ููุงูุฉ ููุง ูู ูุฑุงุกุฉ ุงูุฑุณุงุฆู ุชุจุฏุฃ ุนูู ุงูููุฑ ุ ูู ุฃุฌู ุงูุจุณุงุทุฉ.  ุงูุขู ูุฑุณู ุจุฑูุชูููู ุงููุตุงูุญุฉ ุฑุณุงูุฉ ูุงุญุฏุฉ ูู ูู ุฌุงูุจ ุ ูููู ูู ุงููุณุชูุจู ุ ุณุชููู ููุงู ุฑุณุงูุชุงู ูู ุจุงุฏุฆ ุงูุงุชุตุงู ุ ูุจุนุฏ ุฐูู ูููู ุฅุฑุณุงู ุงูุฑุณุงุฆู ุงููุตูุฉ ุนูู ุงูููุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">72</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">responder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">73</span></span> _id = writer.get_extra_info(<span class="hljs-string"><span class="hljs-string">"peername"</span></span>) <span class="hljs-number"><span class="hljs-number">74</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: connected"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">75</span></span> buf = <span class="hljs-string"><span class="hljs-string">b""</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span> msg_expected = <span class="hljs-string"><span class="hljs-string">"handshake"</span></span> <span class="hljs-number"><span class="hljs-number">77</span></span> peer_name = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-number"><span class="hljs-number">78</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-number"><span class="hljs-number">79</span></span> <span class="hljs-comment"><span class="hljs-comment"># Read until we get Msg message {{{ 80 data = await reader.read(MaxMsgLen) 81 if data == b"": 82 logging.info("%s: closed connection", _id) 83 break 84 buf += data 85 if len(buf) &gt; MaxMsgLen: 86 logging.warning("%s: max buffer size exceeded", _id) 87 break 88 try: 89 msg, tail = Msg().decode(buf) 90 except ASN1Error: 91 continue 92 buf = tail 93 # }}} 94 if msg.choice != msg_expected: 95 logging.warning("%s: unexpected %s message", _id, msg.choice) 96 break 97 if msg_expected == "text": 98 try: 99 await msg_receiver(msg.value, peer_name) 100 except ValueError as err: 101 logging.warning("%s: %s", err) 102 break 103 # Process Handshake message {{{ 104 elif msg_expected == "handshake": 105 logging.info("%s: got %s message", _id, msg_expected) 106 msg_handshake = msg.value 107 peer_name = str(msg_handshake["peerName"]) 108 if peer_name not in THEIR_NAMES: 109 logging.warning("unknown peer name: %s", peer_name) 110 break 111 writer.write(Msg(("handshake", MsgHandshake(( 112 ("peerName", OUR_NAME), 113 )))).encode()) 114 await writer.drain() 115 logging.info("%s: session established: %s", _id, peer_name) 116 peer_alive = PEER_ALIVES.pop(peer_name, None) 117 if peer_alive is not None: 118 peer_alive.close() 119 await IN_QUEUES[peer_name].put(None) 120 PEER_ALIVES[peer_name] = writer 121 asyncio.ensure_future(msg_sender(peer_name, writer)) 122 msg_expected = "text" 123 # }}} 124 logging.info("%s: disconnecting", _id) 125 if msg_expected == "text": 126 IN_QUEUES[peer_name].put(None) 127 writer.close()</span></span></code> </pre><br><h2 style=";text-align:right;direction:rtl">  ุจุฑูุชูููู ุขูู </h2><br>  ููุฏ ุญุงู ุงูููุช ูุชุฃููู ุงุชุตุงูุงุชูุง.  ูุงุฐุง ูุนูู ุจุงูุฃูู ููุงุฐุง ูุฑูุฏ: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุณุฑูุฉ ุงูุฑุณุงุฆู ุงููุฑุณูุฉ ุ </li><li style=";text-align:right;direction:rtl">  ุตุญุฉ ูุณูุงูุฉ ุงูุฑุณุงุฆู ุงููุฑุณูุฉ - ูุฌุจ ุงูุชุดุงู ุชุบููุฑูุง ุ </li><li style=";text-align:right;direction:rtl">  ุงูุญูุงูุฉ ูู ูุฌูุงุช ุงูุฅุนุงุฏุฉ - ูุฌุจ ุฃู ูุชู ุงููุดู ุนู ุญูููุฉ ุฃู ุงูุฑุณุงุฆู ูุฏ ููุฏุช ุฃู ุฃุนูุฏุช ุงููุญุงููุฉ (ูููุฑุฑ ูุทุน ุงูุงุชุตุงู) ุ </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ูุชูุซูู ุงููุญุงูุฑูู ูู ุฎูุงู ููุงุชูุญ ุนููููุฉ ูุฏููุนุฉ ูุณุจููุง - ููุฏ ูุฑุฑูุง ุณุงุจููุง ุฃููุง ูุตูุน ุดุจูุฉ ุฃุตุฏูุงุก ุฅูู ุตุฏูู.  ููุท ุจุนุฏ ุงููุตุงุฏูุฉ ุณูู ูููู ูุน ูู ูุชูุงุตู ูุนู ุ </li><li style=";text-align:right;direction:rtl">  ูุฌูุฏ ุฎุตุงุฆุต <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณุฑูุฉ ูุชูุฏูุฉ ููุฃูุงู</a> (PFS) - ูุง ููุจุบู ุฃู ูุคุฏู ุชูููู ููุชุงุญ ุงูุชูููุน ุงูุทููู ูุฏููุง ุฅูู ุฅููุงููุฉ ูุฑุงุกุฉ ุฌููุน ุงููุฑุงุณูุงุช ุงูุณุงุจูุฉ.  ุชุณุฌูู ุญุฑูุฉ ุงููุฑูุฑ ุงุนุชุฑุงุถ ุชุตุจุญ ุนุฏููุฉ ุงููุงุฆุฏุฉ. </li><li style=";text-align:right;direction:rtl">  ุตูุงุญูุฉ / ุตูุงุญูุฉ ุงูุฑุณุงุฆู (ุงูููู ูุงููุตุงูุญุงุช) ููุท ุฎูุงู ููุณ ุฌูุณุฉ TCP.  ูุง ูููู ุฅุฏุฑุงุฌ ุฑุณุงุฆู ูููุนุฉ / ูุตุงุฏูุฉ ุจุดูู ุตุญูุญ ูู ุฌูุณุฉ ุฃุฎุฑู (ุญุชู ูุน ููุณ ุงููุญุงูุฑ) ุ </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃูุง ูุฑู ุงููุฑุงูุจ ุงูุณูุจู ูุนุฑูุงุช ุงููุณุชุฎุฏู ุ ูุงูููุงุชูุญ ุงูุนุงูุฉ ุงููููููุฉ ููุชุฑุฉ ุทูููุฉ ุ ููุง ุชุฌุฒุฆุฉ ูููุง.  ููุน ูู ุนุฏู ุงููุดู ุนู ูููุชู ูู ุงููุฑุงูุจ ุงูุณูุจู. </li></ul><br>  ูู ุงููุซูุฑ ููุฏูุดุฉ ุฃู ูู ุดุฎุต ูุฑูุฏ ุชูุฑูุจูุง ุงูุญุตูู ุนูู ูุฐุง ุงูุญุฏ ุงูุฃุฏูู ูู ุฃู ุจุฑูุชูููู ููุตุงูุญุฉ ุ ููุชู ุชูููุฐ ุนุฏุฏ ูููู ุฌุฏูุง ูู ุงูุนูุงุตุฑ ุงููุฐููุฑุฉ ุฃุนูุงู ูู ุงูููุงูุฉ ููุจุฑูุชููููุงุช ุงููุญููุฉ.  ุญุชู ุงูุขู ูู ูุฎุชุฑุน ุฃุดูุงุก ุฌุฏูุฏุฉ.  ุจุงูุชุฃููุฏ ุฃูุตู ุจุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุทุงุฑ ุงูุถูุถุงุก</a> ูุฅูุดุงุก ุจุฑูุชููููุงุช ุ ูููู ุฏุนูุง ูุฎุชุงุฑ ุดูุฆูุง ุฃูุซุฑ ุจุณุงุทุฉ. <br><br>  ุงูุฃูุซุฑ ุดุนุจูุฉ ูู ุจุฑูุชูููููู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">TLS</a> ูู ุจุฑูุชูููู ูุนูุฏ ูู ุชุงุฑูุฎ ุทููู ูู ุงูุฃุฎุทุงุก ูุงููุฏุงุฑุณ ูููุงุท ุงูุถุนู ูุถุนู ุงูุชูููุฑ ุ ูุงูุชุนููุฏ ูุฃูุฌู ุงููุตูุฑ (ููุน ุฐูู ุ ูุง ููุทุจู ูุฐุง ูุซูุฑูุง ุนูู TLS 1.3).  ููููุง ูุง ูุนุชุจุฑ ุฐูู ุจุณุจุจ ุงูุชุนููุฏ. </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">IPsec</a> ูุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">IKE</a> - ููุณ ูุฏูู ูุดุงูู ุชุดููุฑ ุฎุทูุฑุฉ ุ ุนูู ุงูุฑุบู ูู ุฃููุง ููุณุช ุจุณูุทุฉ ุฃูุถูุง.  ุฅุฐุง ูุฑุฃุช ุนู IKEv1 ู IKEv2 ุ ูุฅู ูุตุฏุฑูุง ูู ุจุฑูุชููููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">STS</a> ู ISO / IEC IS 9798-3 ู SIGMA (SIGn-and-MAc) - ุจุณูุทุฉ ุจูุง ูููู ููุชูููุฐ ูู ูุณุงุก ูุงุญุฏ. </li></ul><br>  ููู SIGMA ุ ุจุงุนุชุจุงุฑูุง ุงูุญููุฉ ุงูุฃุฎูุฑุฉ ูู ุชุทููุฑ ุจุฑูุชููููุงุช STS / ISO ุ ุฌูุฏุฉุ  ูุฑุถู ุฌููุน ูุชุทูุจุงุชูุง (ุจูุง ูู ุฐูู "ุฅุฎูุงุก" ูุนุฑูุงุช ุงููุชุญุงูุฑูู) ุ ูููุณ ูุฏูู ูุดุงูู ุชุดููุฑ ูุนุฑููุฉ.  ุฅูู ุจุณูุท - ุฅุฒุงูุฉ ุนูุตุฑ ูุงุญุฏ ุนูู ุงูุฃูู ูู ุฑุณุงูุฉ ุงูุจุฑูุชูููู ุณูุคุฏู ุฅูู ุงูุนุฏุงู ุงูุฃูู. <br><br>  ุฏุนูุง ููุชูู ูู ุฃุจุณุท ุจุฑูุชูููู ูุญูู ุฅูู SIGMA.  ุฅู ุงูุนูููุฉ ุงูุฃูุซุฑ ุฃูููุฉ ุงูุชู ููุชู ุจูุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุทุงุจูุฉ ุงูููุงุชูุญ</a> : ูุธููุฉ ูู ุงููุงุชุฌ ูุญุตู ููุง ุงููุดุงุฑููู ูููุง ุนูู ููุณ ุงููููุฉ ุงูุชู ูููู ุงุณุชุฎุฏุงููุง ูููุชุงุญ ูุชูุงุซู.  ุฏูู ุงูุฎูุถ ูู ุงูุชูุงุตูู: ูููู ูู ุทุฑู ุจุฅูุดุงุก ุฒูุฌ ุฑุฆูุณู (ูุณุชุฎุฏู ููุท ูู ููุณ ุงูุฌูุณุฉ) ุฒูุฌ ููุงุชูุญ (ููุงุชูุญ ุนุงูุฉ ูุฎุงุตุฉ) ุ ููุชุจุงุฏู ุงูููุงุชูุญ ุงูุนุงูุฉ ุ ููุฏุนู ุฅูู ูุธููุฉ ุงููุทุงุจูุฉ ุ ุงูุชู ูุฑุณููู ุฅูููุง ููุชุงุญูู ุงูุฎุงุต ูุงูููุชุงุญ ุงูุนุงู ูููุญุงูุฑ. <br><br><pre style=";text-align:right;direction:rtl"> โโโโโโโ โโโโโโโ
 eerPeerAโ โPeerBโ
 โโโโฌโโโ โโโโฌโโโ
    โ IdA ุ PubA โ โโโโโโโโโโโโโโโโโโโโโโ
    โโโโโโโโโโโโโโโ &gt;&gt; P rPrvA ุ PubA = DHgen () โ
    โ โ โโโโโโโโโโโโโโโโโโโโโ
    โ IdBุ PubB โ โโโโโโโโโโโโโโโโโโโโโโ
    โ &lt;โโโโโโโโโโโโโโโโ โPrvB ุ PubB = DHgen () โ
    โ โ โโโโโโโโโโโโโโโโโโโโโ
    โโโโโ โโโโโโโโโโโโโโโโโโโโโ
        = โKey = DH (PrvAุ PubB) โ
    &lt;โโโโ โโโโโโโโโคโโโโโโโโโโโโ
    โ โ
    โ โ
</pre><br><br>  ูููู ูุฃู ุดุฎุต ุงูุชุฏุฎู ูู ุงููุณุท ูุงุณุชุจุฏุงู ุงูููุงุชูุญ ุงูุนุงูุฉ ุจููุงุชูุญ ุฎุงุตุฉ ุจูู - ูู ูุฐุง ุงูุจุฑูุชูููู ูุง ููุฌุฏ ูุตุงุฏูุฉ ูููุญุงูุฑูู.  ุฅุถุงูุฉ ุชูููุน ูุน ููุงุชูุญ ุทูููุฉ ุงูุนูุฑ. <br><br><pre style=";text-align:right;direction:rtl"> โโโโโโโ โโโโโโโ
 eerPeerAโ โPeerBโ
 โโโโฌโโโ โโโโฌโโโ
    โIdA ุ PubA ุ ุนูุงูุฉ (SignPrvA ุ (PubA)) โ โโโโโโโโโโโโโโโโโโโโโโโโโ
    โ โ โ โ โ ign ign ign ign ign ign ign โ โ โ โ โ โ โ โ โ P P P Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign load load load load load load load load load load load load load load load load load load load load load load load load load load load
    r โ โPrvA ุ PubA = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โIdB ุ PubB ุ ุนูุงูุฉ (SignPrvB ุ (PubB)) โ โโโโโโโโโโโโโโโโโโโโโโโโโ
    SignPrvB ุ SignPubB = load () โ
    r โ โPrvB ุ PubB = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โโโโโ โโโโโโโโโโโโโโโโโโโโโโโ โ
        ุชุญูู ูู (SignPubB ุ ...) โ โ
    &lt;โโโโ โKey = DH (PrvAุ PubB) โ โ
    โ โโโโโโโโโโโโโโโโโโโโโโโ โ
    โ โ
</pre><br><br>  ูู ูุนูู ูุฐุง ุงูุชูููุน ุ ูุฃูู ุบูุฑ ูุฑุชุจุท ุจุฌูุณุฉ ูุญุฏุฏุฉ.  ูุฐู ุงูุฑุณุงุฆู ููุงุณุจุฉ ุฃูุถูุง ููุฌูุณุงุช ูุน ุงููุดุงุฑููู ุงูุขุฎุฑูู.  ูุฌุจ ุงูุงุดุชุฑุงู ูู ุงูุณูุงู ุจุฃูููู.  ูุฐุง ููุฑุถ ุฃูุถูุง ุฅุถุงูุฉ ุฑุณุงูุฉ ุฃุฎุฑู ูู A. <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุงูุถุฑูุฑู ุฅุถุงูุฉ ุงููุนุฑูู ุงูุฎุงุต ุจู ูุชูููุน ุ ูุฃูู ุ ูุฅูุง ุ ูููููุง ุงุณุชุจุฏุงู IdXXX ูุฅุนุงุฏุฉ ุชูููุน ุงูุฑุณุงูุฉ ุจููุชุงุญ ูุญุงูุฑ ูุนุฑูู ุขุฎุฑ.  ูููุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฌูุงุช ุงูุงูุนูุงุณ</a> ุ ูู ุงูุถุฑูุฑู ุฃู ุชููู ุงูุนูุงุตุฑ ุงูููุฌูุฏุฉ ุชุญุช ุงูุชูููุน ูู ุฃูุงูู ูุญุฏุฏุฉ ุจูุถูุญ ุจูุนูุงูุง: ุฅุฐุง ูุงูุช ุนูุงูุงุช A (PubA ุ PubB) ุ ููุฌุจ ุนูู B ุงูุชูููุน (PubB ุ PubA).  ูุดูุฑ ูุฐุง ุฃูุถูุง ุฅูู ุฃูููุฉ ุงุฎุชูุงุฑ ุจููุฉ ูุดูู ุงูุจูุงูุงุช ุงููุชุณูุณูุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ูุชู ูุฑุฒ ุงููุฌููุนุงุช ูู ุชุฑููุฒ ASN.1 DER: SET OF (PubA ุ PubB) ุณุชููู ูุทุงุจูุฉ ูู SET OF (PubB ุ PubA). <br><br><pre style=";text-align:right;direction:rtl"> โโโโโโโ โโโโโโโ
 eerPeerAโ โPeerBโ
 โโโโฌโโโ โโโโฌโโโ
    โ IdA ุ PubA โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ
    ign โ โ โ โ โ โ ign ign ign ign ign ign ign ign โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ SignPubA = load () โ
    r โ โPrvA ุ PubA = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โIdB ุ PubB ุ sign (SignPrvBุ (IdBุ PubAุ PubB)) โ โโโโโโโโโโโโโโโโโโโโโโโ
    โ SignPrvB ุ โ SignPubB = load () โ
    r โ โPrvB ุ PubB = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โ sign (SignPrvAุ (IdAุ PubBุ PubA)) โ โโโโโโโโโโโโโโโโโโโโโ
    โ โ โ โ โ โ&gt; ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify ify SignPubB ุ ...) โ
    โ โ โKey = DH (PrvAุ PubB) โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ
    โ โ
</pre><br><br>  ููุน ุฐูู ุ ูู ูุซุจุช ุจุนุฏ ุฃููุง ุทูุฑูุง ููุณ ุงูููุชุงุญ ุงููุดุชุฑู ููุฐู ุงูุฌูุณุฉ.  ูู ุญูุซ ุงููุจุฏุฃ ุ ููููู ุงูุงุณุชุบูุงุก ุนู ูุฐู ุงูุฎุทูุฉ - ุณูููู ุงุชุตุงู ุงูููู ุงูุฃูู ุบูุฑ ุตุงูุญ ุ ููููุง ูุฑูุฏ ุฃูู ุนูุฏ ุงูุชูุงู ุงููุตุงูุญุฉ ุ ุณูููู ูุชุฃูุฏูู ูู ุฃู ูู ุดูุก ุชู ุงูุงุชูุงู ุนููู ุญููุง.  ูู ุงูููุช ุงูุญุงูู ุ ูุฏููุง ุจูู ุฃูุฏููุง ุจุฑูุชูููู ISO / IEC IS 9798-3. <br><br>  ูููููุง ุงูุชูููุน ุนูู ุงูููุชุงุญ ููุณู.  ูุฐุง ุฃูุฑ ุฎุทูุฑ ุ ูุฃูู ูู ุงููุญุชูู ุฃู ูููู ููุงู ุชุณุฑุจ ูู ุฎูุงุฑุฒููุฉ ุงูุชูููุน ุงููุณุชุฎุฏูุฉ (ุงุณูุญ ุจุช ููู ุชูููุน ุ ูููู ูุง ูุฒุงู ุชุณุฑุจ).  ููููู ุชุณุฌูู ุนูุงูุฉ ุชุฌุฒุฆุฉ ูู ุงูููุชุงุญ ุงูุฐู ุชู ุฅูุดุงุคู ุ ูููู ุญุชู ุชุณุฑุจ ุนูุงูุฉ ุชุฌุฒุฆุฉ ูู ุงูููุชุงุญ ุงูุฐู ุชู ุฅูุดุงุคู ูููู ุฃู ูููู ุฐุง ูููุฉ ูู ูุฌูู ุงูููุฉ ุงูุบุงุดูุฉ ุนูู ูุธููุฉ ุงูุชูููุฏ.  ุชุณุชุฎุฏู SIGMA ูุธููุฉ MAC ุชููู ุจูุตุงุฏูุฉ ูุนุฑู ุงููุฑุณู. <br><br><pre style=";text-align:right;direction:rtl"> โโโโโโโ โโโโโโโ
 eerPeerAโ โPeerBโ
 โโโโฌโโโ โโโโฌโโโ
    โ IdA ุ PubA โ โโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ &gt; ign ignSignPrvA ุ SignPubA = load () โ
    r โ โPrvA ุ PubA = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โIdB ุ PubB ุ ุนูุงูุฉ (SignPrvB ุ (PubA ุ PubB)) ุ MAC (IdB) โ โโโโโโโโโโโโโโโโโโโ
    โ &lt;โโโ โ โ โ โ โ โ โ โ โ โ โ ign ignSignPrvB ุ SignPubB = load () โ
    r โ โPrvB ุ PubB = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ
    โ sign (SignPrvAุ (PubBุ PubA))ุ MAC (IdA) โ โKey = DH (PrvAุ PubB) โ
    โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ &gt; โ โ ุงูุชุญูู (ุงูููุชุงุญ ุ IdB) โ
    ify โ โ ุชุญูู (SignPubB ุ ...) โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ
    โ โ
</pre><br><br>  ูุชุญุณูู ุ ูุฏ ูุฑุบุจ ุงูุจุนุถ ูู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงููุคูุชุฉ ุงูุฎุงุตุฉ ุจูู (ูุงูุชู ุ ุจุงูุทุจุน ุ ุฃูุฑ ูุญุฒู ุจุงููุณุจุฉ ูู PFS).  ุนูู ุณุจูู ุงููุซุงู ุ ุฃูุดุฃูุง ุฒูุฌูุง ุฑุฆูุณููุง ุ ุญุงูููุง ุงูุงุชุตุงู ุ ููู TCP ูู ููู ูุชุงุญูุง ุฃู ููุทูุนูุง ูู ููุงู ูุง ูู ููุชุตู ุงูุจุฑูุชูููู.  ุฅูู ูุฃูุฑ ูุคุณู ุฃู ุชููู ููุงุฑุฏ ุงูููู ูุงููุนุงูุฌ ุงูุชู ุชููู ุนูู ุฒูุฌ ุฌุฏูุฏ.  ูุฐูู ุ ููุฏู ูุง ูุณูู ููู ุชุนุฑูู ุงูุงุฑุชุจุงุท - ูููุฉ ุนุดูุงุฆูุฉ ุฒุงุฆูุฉ ูู ุดุฃููุง ุฃู ุชุญูู ูู ูุฌูุงุช ุงูุฅุนุงุฏุฉ ุงูุนุฑุถูุฉ ุงููุญุชููุฉ ุนูุฏ ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู ุงูููุงุชูุญ ุงูุนุงูุฉ ุงููุคูุชุฉ.  ูุธุฑูุง ููุฑุจุท ุจูู ููู ุชุนุฑูู ุงูุงุฑุชุจุงุท ูุงูููุชุงุญ ุงูุนูููู ุงููุคูุช ุ ูููู ุฅุฒุงูุฉ ุงูููุชุงุญ ุงูุนูููู ููุทุฑู ุงูููุงุจู ูู ุงูุชูููุน ุจุงุนุชุจุงุฑู ุบูุฑ ุถุฑูุฑู. <br><br><pre style=";text-align:right;direction:rtl"> โโโโโโโ โโโโโโโ
 eerPeerAโ โPeerBโ
 โโโโฌโโโ โโโโฌโโโ
    โ IdA ุ PubA ุ CookieA โ โโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โโโโโโโโโโโโโโโโโโโโ &gt;&gt; โ โ SignPrvAุ SignPubA = load () โ
    r โ โPrvA ุ PubA = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โIdBุ PubBุ CookieBุ sign (SignPrvBุ (CookieAุ CookieBุ PubB))ุ MAC (IdB) โ โ โ โ โ โ โ โโโโ
    โ &lt;โโโ โ โ โ โ โ โ โ โ โ โ โ ign ignSignPrvB ุ SignPubB = load () โ
    r โ โPrvB ุ PubB = DHgen () โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ โ โ โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ
    โ sign (SignPrvA ุ (CookieB ุ CookieA ุ PubA)) ุ MAC (IdA) DH Key = DH (PrvAุ PubB) โ
    โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ ify ify ify ify ify ify ify ify ify ify ify Verify (Keyุ IdB) โ
    ify โ โ ุชุญูู (SignPubB ุ ...) โ
    โ โ โโโ โ โ โ โ โ โ โ โ โ โ
    โ โ
</pre><br><br>  ุฃุฎูุฑูุง ุ ูุฑุบุจ ูู ุงูุญุตูู ุนูู ุฎุตูุตูุฉ ููุนุฑููุงุช ุงููุญุงูุฑ ูุฏููุง ูู ูุฑุงูุจ ุณูุจู.  ููููุงู ุจุฐูู ุ ุชูุชุฑุญ SIGMA ุฃููุงู ุชุจุงุฏู ููุงุชูุญ ุณุฑูุนุฉ ุงูุฒูุงู ุ ูุงูุนูู ุนูู ููุชุงุญ ุดุงุฆุน ููุตุงุฏูุฉ ุฑุณุงุฆู ุงููุตุงุฏูุฉ.  ูุตู SIGMA ุฎูุงุฑูู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  SIGMA-I - ูุญูู ุงูุจุงุฏุฆ ูู ุงููุฌูุงุช ุงููุดุทุฉ ุ ูุงููุณุชุฌูุจ ูู ุงููุฌูุงุช ุงูุณูุจูุฉ: ุงูุจุงุฏุฆ ูุตุงุฏู ุงููุณุชุฌูุจ ูุฅุฐุง ูุงู ููุงู ุดูุก ุบูุฑ ููุงุณุจ ุ ูุฅูู ูุง ูุนุทู ูููุชู.  ูุนุทู ุงููุฏุนู ุนููู ูููุชู ุฅุฐุง ุจุฏุฃุช ุจุฑูุชูููู ูุดุท ูุนู.  ุงููุฑุงูุจ ุงูุณูุจู ูู ูุนุฑู ุดูุฆูุง ุ <br>  SIGMA-R - ูุญูู ุงููุณุชุฌูุจ ูู ุงููุฌูุงุช ุงููุดุทุฉ ุ ุงูุจุงุฏุฆ ูู ุงููุจูู ูููุฌููู.  ูู ุดูุก ุนูุณ ุฐูู ุชูุงููุง ุ ูููู ูู ูุฐุง ุงูุจุฑูุชูููู ูุชู ุจุงููุนู ุฅุฑุณุงู ุฃุฑุจุน ุฑุณุงุฆู ูุตุงูุญุฉ. <br><br><br>  ูุฎุชุงุฑ SIGMA-I ุฃูุซุฑ ุดุจูุงู ุจูุง ูุชููุนู ูู ุงูุฃุดูุงุก ุงููุนุชุงุฏุฉ ูู ุงูุฎุงุฏู-ุงูุนููู: ููุท ุงูุฎุงุฏู ุงููุตุงุฏู ุนููู ูุชุนุฑู ุนูู ุงูุนููู ุ ููุนุฑู ุงูุฌููุน ุงูุฎุงุฏู ุนูู ุฃู ุญุงู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฃูู ูู ุงูุฃุณูู ุชูููุฐู ุจุณุจุจ ุนุฏุฏ ุฑุณุงุฆู ุงููุตุงูุญุฉ ุฃูู.  ูู ูุง ูุถููู ุฅูู ุงูุจุฑูุชูููู ูู ุชุดููุฑ ุฌุฒุก ุงูุฑุณุงูุฉ ูููู ุงููุนุฑู A ุฅูู ุงูุฌุฒุก ุงููุดูุฑ ูู ุงูุฑุณุงูุฉ ุงูุฃุฎูุฑุฉ: <br><br><pre style=";text-align:right;direction:rtl"> โโโโโโโ โโโโโโโ
 eerPeerAโ โPeerBโ
 โโโโฌโโโ โโโโฌโโโ
    โ PubA ุ CookieA โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
    โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ โ ign ign ign ign ign ign ign ign ign ign ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ ุุ Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign Sign ((((((((((((
    r โ โPrvA ุ PubA = DHgen () โ<font></font>
   โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ<font></font>
   โPubB, CookieB, Enc((IdB, sign(SignPrvB, (CookieA, CookieB, PubB)), MAC(IdB))) โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ<font></font>
   โ&lt;โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โSignPrvB, SignPubB = load()โ<font></font>
   โ โ โPrvB, PubB = DHgen() โ<font></font>
   โ โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ<font></font>
   โ โ โโโโโโโโโโโโโโโโโโโโโโโ<font></font>
   โ Enc((IdA, sign(SignPrvA, (CookieB, CookieA, PubA)), MAC(IdA))) โ โKey = DH(PrvA, PubB) โ<font></font>
   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ&gt;โ โverify(Key, IdB) โ<font></font>
   โ โ โverify(SignPubB, ...)โ<font></font>
   โ โ โโโโโโโโโโโโโโโโโโโโโโโ<font></font>
   โ โ<font></font>
</pre><br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">34.10-2012</a>   256- . </li><li style=";text-align:right;direction:rtl">      34.10-2012 VKO. </li><li style=";text-align:right;direction:rtl">   MAC  CMAC.       ,     34.13-2015.        โ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> (34.12-2015). </li><li style=";text-align:right;direction:rtl">          .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">-256</a> (34.11-2012 256 ). </li></ul><br><br>        .         .         :   ,  ,  (MAC)   , .         ,    , .     , ,  ?          .   ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">KDF</a> (key derivation function).  ,     - : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HKDF</a>  ,       .  ,    Python   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">hkdf</a> . HKDF   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">HMAC</a> , ,   ,  -.    Python   Wikipedia    .      34.10-2012,   -   -256.         ,      : <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">kdf = Hkdf(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, key_session, hash=GOST34112012256) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake1-mac-identity"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake1-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake1-mac"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake2-mac-identity"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake2-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"handshake2-mac"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-initiator-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-initiator-mac"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-responder-enc"</span></span>) kdf.expand(<span class="hljs-string"><span class="hljs-string">b"transport-responder-mac"</span></span>)</code> </pre><br><h2 style=";text-align:right;direction:rtl"> / </h2><br>     ASN.1         : <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Msg</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Choice)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"text"</span></span>, MsgText()), (<span class="hljs-string"><span class="hljs-string">"handshake0"</span></span>, MsgHandshake0(expl=tag_ctxc(<span class="hljs-number"><span class="hljs-number">0</span></span>))), (<span class="hljs-string"><span class="hljs-string">"handshake1"</span></span>, MsgHandshake1(expl=tag_ctxc(<span class="hljs-number"><span class="hljs-number">1</span></span>))), (<span class="hljs-string"><span class="hljs-string">"handshake2"</span></span>, MsgHandshake2(expl=tag_ctxc(<span class="hljs-number"><span class="hljs-number">2</span></span>))), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgText</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"payload"</span></span>, MsgTextPayload()), (<span class="hljs-string"><span class="hljs-string">"payloadMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgTextPayload</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"nonce"</span></span>, Integer(bounds=(<span class="hljs-number"><span class="hljs-number">0</span></span>, float(<span class="hljs-string"><span class="hljs-string">"+inf"</span></span>)))), (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">1</span></span>, MaxTextLen))), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgHandshake0</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"cookieInitiator"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"pubKeyInitiator"</span></span>, PubKey()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgHandshake1</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"cookieResponder"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"pubKeyResponder"</span></span>, PubKey()), (<span class="hljs-string"><span class="hljs-string">"ukm"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>))), (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString()), (<span class="hljs-string"><span class="hljs-string">"ciphertextMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MsgHandshake2</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString()), (<span class="hljs-string"><span class="hljs-string">"ciphertextMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandshakeTBE</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"identity"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>))), (<span class="hljs-string"><span class="hljs-string">"signature"</span></span>, OctetString(bounds=(<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>))), (<span class="hljs-string"><span class="hljs-string">"identityMac"</span></span>, MAC()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HandshakeTBS</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Sequence)</span></span></span><span class="hljs-class">:</span></span> schema = (( (<span class="hljs-string"><span class="hljs-string">"cookieTheir"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"cookieOur"</span></span>, Cookie()), (<span class="hljs-string"><span class="hljs-string">"pubKeyOur"</span></span>, PubKey()), )) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cookie</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(OctetString)</span></span></span><span class="hljs-class">:</span></span> bounds = (<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PubKey</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(OctetString)</span></span></span><span class="hljs-class">:</span></span> bounds = (<span class="hljs-number"><span class="hljs-number">64</span></span>, <span class="hljs-number"><span class="hljs-number">64</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MAC</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(OctetString)</span></span></span><span class="hljs-class">:</span></span> bounds = (<span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>)</code> </pre><br> HandshakeTBS โ ,    (to be signed). HandshakeTBE โ ,    (to be encrypted).     ukm  MsgHandshake1. 34.10 VKO,      ,   UKM (user keying material) โ   . <br><br><h2 style=";text-align:right;direction:rtl">     </h2><br>        ,      (  ,     ,       ). <br><br>           ,     -  .    JSON  : <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs">{ <span class="hljs-string"><span class="hljs-string">"our"</span></span>: { <span class="hljs-string"><span class="hljs-string">"prv"</span></span>: <span class="hljs-string"><span class="hljs-string">"21254cf66c15e0226ef2669ceee46c87b575f37f9000272f408d0c9283355f98"</span></span>, <span class="hljs-string"><span class="hljs-string">"pub"</span></span>: <span class="hljs-string"><span class="hljs-string">"938c87da5c55b27b7f332d91b202dbef2540979d6ceaa4c35f1b5bfca6df47df0bdae0d3d82beac83cec3e353939489d9981b7eb7a3c58b71df2212d556312a1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"their"</span></span>: { <span class="hljs-string"><span class="hljs-string">"alice"</span></span>: <span class="hljs-string"><span class="hljs-string">"d361a59c25d2ca5a05d21f31168609deeec100570ac98f540416778c93b2c7402fd92640731a707ec67b5410a0feae5b78aeec93c4a455a17570a84f2bc21fce"</span></span>, <span class="hljs-string"><span class="hljs-string">"bob"</span></span>: <span class="hljs-string"><span class="hljs-string">"aade1207dd85ecd283272e7b69c078d5fae75b6e141f7649ad21962042d643512c28a2dbdc12c7ba40eb704af920919511180c18f4d17e07d7f5acd49787224a"</span></span> } }</code> </pre><br> our โ   ,     . their โ      .        JSON : <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pygost <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gost3410 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pygost.gost34112012256 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GOST34112012256 CURVE = gost3410.GOST3410Curve( *gost3410.CURVE_PARAMS[<span class="hljs-string"><span class="hljs-string">"GostR3410_2001_CryptoPro_A_ParamSet"</span></span>] ) parser = argparse.ArgumentParser(description=<span class="hljs-string"><span class="hljs-string">"GOSTIM"</span></span>) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--keys-gen"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Generate JSON with our new keypair"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--keys"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"keys.json"</span></span>, required=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, help=<span class="hljs-string"><span class="hljs-string">"JSON with our and their keys"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--bind"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"::1"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Address to listen on"</span></span>, ) parser.add_argument( <span class="hljs-string"><span class="hljs-string">"--port"</span></span>, type=int, default=<span class="hljs-number"><span class="hljs-number">6666</span></span>, help=<span class="hljs-string"><span class="hljs-string">"Port to listen on"</span></span>, ) args = parser.parse_args() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> args.keys_gen: prv_raw = urandom(<span class="hljs-number"><span class="hljs-number">32</span></span>) pub = gost3410.public_key(CURVE, gost3410.prv_unmarshal(prv_raw)) pub_raw = gost3410.pub_marshal(pub) print(json.dumps({ <span class="hljs-string"><span class="hljs-string">"our"</span></span>: {<span class="hljs-string"><span class="hljs-string">"prv"</span></span>: hexenc(prv_raw), <span class="hljs-string"><span class="hljs-string">"pub"</span></span>: hexenc(pub_raw)}, <span class="hljs-string"><span class="hljs-string">"their"</span></span>: {}, })) exit(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Parse and unmarshal our and their keys {{{ with open(args.keys, "rb") as fd: _keys = json.loads(fd.read().decode("utf-8")) KEY_OUR_SIGN_PRV = gost3410.prv_unmarshal(hexdec(_keys["our"]["prv"])) _pub = hexdec(_keys["our"]["pub"]) KEY_OUR_SIGN_PUB = gost3410.pub_unmarshal(_pub) KEY_OUR_SIGN_PUB_HASH = OctetString(GOST34112012256(_pub).digest()) for peer_name, pub_raw in _keys["their"].items(): _pub = hexdec(pub_raw) KEYS[GOST34112012256(_pub).digest()] = { "name": peer_name, "pub": gost3410.pub_unmarshal(_pub), } # }}}</span></span></code> </pre><br>   34.10  โ  .  256-  256-  . PyGOST     ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> ,     (urandom(32))    ,  gost3410.prv_unmarshal().      ,  gost3410.public_key().   34.10 โ   ,            ,  gost3410.pub_marshal(). <br><br>   JSON ,  , ,   ,  gost3410.pub_unmarshal().             ,              . -256   gost34112012256.GOST34112012256(),   hashlib  -. <br><br>    ? ,    :  cookie (128-  ),    34.10,     VKO   . <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">395</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initiator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(host, port)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">396</span></span> _id = repr((host, port)) <span class="hljs-number"><span class="hljs-number">397</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: dialing"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">398</span></span> reader, writer = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.open_connection(host, port) <span class="hljs-number"><span class="hljs-number">399</span></span> <span class="hljs-comment"><span class="hljs-comment"># Generate our ephemeral public key and cookie, send Handshake 0 message {{{ 400 cookie_our = Cookie(urandom(16)) 401 prv = gost3410.prv_unmarshal(urandom(32)) 402 pub_our = gost3410.public_key(CURVE, prv) 403 pub_our_raw = PubKey(gost3410.pub_marshal(pub_our)) 404 writer.write(Msg(("handshake0", MsgHandshake0(( 405 ("cookieInitiator", cookie_our), 406 ("pubKeyInitiator", pub_our_raw), 407 )))).encode()) 408 # }}} 409 await writer.drain()</span></span></code> </pre><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">      Msg ; </li><li style=";text-align:right;direction:rtl">    handshake1; </li><li style=";text-align:right;direction:rtl">          ; </li><li style=";text-align:right;direction:rtl">       TBE  . </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">423</span></span> logging.info(<span class="hljs-string"><span class="hljs-string">"%s: got %s message"</span></span>, _id, msg.choice) <span class="hljs-number"><span class="hljs-number">424</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> msg.choice != <span class="hljs-string"><span class="hljs-string">"handshake1"</span></span>: <span class="hljs-number"><span class="hljs-number">425</span></span> logging.warning(<span class="hljs-string"><span class="hljs-string">"%s: unexpected message, disconnecting"</span></span>, _id) <span class="hljs-number"><span class="hljs-number">426</span></span> writer.close() <span class="hljs-number"><span class="hljs-number">427</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">428</span></span> <span class="hljs-comment"><span class="hljs-comment"># }}} 429 msg_handshake1 = msg.value 430 # Validate Handshake message {{{ 431 cookie_their = msg_handshake1["cookieResponder"] 432 pub_their_raw = msg_handshake1["pubKeyResponder"] 433 pub_their = gost3410.pub_unmarshal(bytes(pub_their_raw)) 434 ukm_raw = bytes(msg_handshake1["ukm"]) 435 ukm = ukm_unmarshal(ukm_raw) 436 key_session = kek_34102012256(CURVE, prv, pub_their, ukm, mode=2001) 437 kdf = Hkdf(None, key_session, hash=GOST34112012256) 438 key_handshake1_mac_identity = kdf.expand(b"handshake1-mac-identity") 439 key_handshake1_enc = kdf.expand(b"handshake1-enc") 440 key_handshake1_mac = kdf.expand(b"handshake1-mac")</span></span></code> </pre><br> UKM  64-  (urandom(8)),       ,  gost3410_vko.ukm_unmarshal(). VKO   34.10-2012 256-  gost3410_vko.kek_34102012256() (KEK โ key encryption key). <br><br>      256-   .        HKDF .   GOST34112012256  hashlib ,        Hkdf .  (  Hkdf)   ,     -               . kdf.expand()       256-,     . <br><br>   TBE  TBS   : <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    MAC   ; </li><li style=";text-align:right;direction:rtl">  ; </li><li style=";text-align:right;direction:rtl">  TBE ; </li><li style=";text-align:right;direction:rtl">            ; </li><li style=";text-align:right;direction:rtl">    MAC   ; </li><li style=";text-align:right;direction:rtl">    TBS ,    cookie        .      . </li></ul><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">441</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-number"><span class="hljs-number">442</span></span> peer_name = validate_tbe( <span class="hljs-number"><span class="hljs-number">443</span></span> msg_handshake1, <span class="hljs-number"><span class="hljs-number">444</span></span> key_handshake1_mac_identity, <span class="hljs-number"><span class="hljs-number">445</span></span> key_handshake1_enc, <span class="hljs-number"><span class="hljs-number">446</span></span> key_handshake1_mac, <span class="hljs-number"><span class="hljs-number">447</span></span> cookie_our, <span class="hljs-number"><span class="hljs-number">448</span></span> cookie_their, <span class="hljs-number"><span class="hljs-number">449</span></span> pub_their_raw, <span class="hljs-number"><span class="hljs-number">450</span></span> ) <span class="hljs-number"><span class="hljs-number">451</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> err: <span class="hljs-number"><span class="hljs-number">452</span></span> logging.warning(<span class="hljs-string"><span class="hljs-string">"%s: %s, disconnecting"</span></span>, _id, err) <span class="hljs-number"><span class="hljs-number">453</span></span> writer.close() <span class="hljs-number"><span class="hljs-number">454</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">455</span></span> <span class="hljs-comment"><span class="hljs-comment"># }}} 128 def validate_tbe( 129 msg_handshake: Union[MsgHandshake1, MsgHandshake2], 130 key_mac_identity: bytes, 131 key_enc: bytes, 132 key_mac: bytes, 133 cookie_their: Cookie, 134 cookie_our: Cookie, 135 pub_key_our: PubKey, 136 ) -&gt; str: 137 ciphertext = bytes(msg_handshake["ciphertext"]) 138 mac_tag = mac(GOST3412Kuznechik(key_mac).encrypt, KUZNECHIK_BLOCKSIZE, ciphertext) 139 if not compare_digest(mac_tag, bytes(msg_handshake["ciphertextMac"])): 140 raise ValueError("invalid MAC") 141 plaintext = ctr( 142 GOST3412Kuznechik(key_enc).encrypt, 143 KUZNECHIK_BLOCKSIZE, 144 ciphertext, 145 8 * b"\x00", 146 ) 147 try: 148 tbe, _ = HandshakeTBE().decode(plaintext) 149 except ASN1Error: 150 raise ValueError("can not decode TBE") 151 key_sign_pub_hash = bytes(tbe["identity"]) 152 peer = KEYS.get(key_sign_pub_hash) 153 if peer is None: 154 raise ValueError("unknown identity") 155 mac_tag = mac( 156 GOST3412Kuznechik(key_mac_identity).encrypt, 157 KUZNECHIK_BLOCKSIZE, 158 key_sign_pub_hash, 159 ) 160 if not compare_digest(mac_tag, bytes(tbe["identityMac"])): 161 raise ValueError("invalid identity MAC") 162 tbs = HandshakeTBS(( 163 ("cookieTheir", cookie_their), 164 ("cookieOur", cookie_our), 165 ("pubKeyOur", pub_key_our), 166 )) 167 if not gost3410.verify( 168 CURVE, 169 peer["pub"], 170 GOST34112012256(tbs.encode()).digest(), 171 bytes(tbe["signature"]), 172 ): 173 raise ValueError("invalid signature") 174 return peer["name"]</span></span></code> </pre><br>    , 34.13-2015   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   </a>  34.12-2015.      ,  MAC-.  PyGOST  gost3413.mac().       (     ),   , ,  .   hardcode-  ? 34.12-2015    128-  ,    64- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> โ    28147-89,               . <br><br>   gost.3412.GOST3412Kuznechik(key)      .encrypt()/.decrypt() ,     34.13 . MAC   : gost3413.mac(GOST3412Kuznechik(key).encrypt, KUZNECHIK_BLOCKSIZE, ciphertext).      MAC-     (==)  ,        , ,   ,       <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">BEAST</a>   TLS.  Python   hmac.compare_digest   . <br><br>         .   ,      ,    .  34.13-2015  : ECB, CTR, OFB, CBC, CFB.        .   ,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a> ( CCM, OCB, GCM  ) โ       MAC.   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> (CTR):       ,  ,    ,          (   CBC,      ). <br><br>   .mac(), .ctr()     : ciphertext = gost3413.ctr(GOST3412Kuznechik(key).encrypt, KUZNECHIK_BLOCKSIZE, plaintext, iv).    ,     .           (    ),      .   handshake        . <br><br>   gost3410.verify() :        (      GOSTIM ),    ( ,         ,    ), 34.11-2012     . <br><br> ,       handshake2  ,           ,  :      ,  .โฆ <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">456</span></span> <span class="hljs-comment"><span class="hljs-comment"># Prepare and send Handshake 2 message {{{ 457 tbs = HandshakeTBS(( 458 ("cookieTheir", cookie_their), 459 ("cookieOur", cookie_our), 460 ("pubKeyOur", pub_our_raw), 461 )) 462 signature = gost3410.sign( 463 CURVE, 464 KEY_OUR_SIGN_PRV, 465 GOST34112012256(tbs.encode()).digest(), 466 ) 467 key_handshake2_mac_identity = kdf.expand(b"handshake2-mac-identity") 468 mac_tag = mac( 469 GOST3412Kuznechik(key_handshake2_mac_identity).encrypt, 470 KUZNECHIK_BLOCKSIZE, 471 bytes(KEY_OUR_SIGN_PUB_HASH), 472 ) 473 tbe = HandshakeTBE(( 474 ("identity", KEY_OUR_SIGN_PUB_HASH), 475 ("signature", OctetString(signature)), 476 ("identityMac", MAC(mac_tag)), 477 )) 478 tbe_raw = tbe.encode() 479 key_handshake2_enc = kdf.expand(b"handshake2-enc") 480 key_handshake2_mac = kdf.expand(b"handshake2-mac") 481 ciphertext = ctr( 482 GOST3412Kuznechik(key_handshake2_enc).encrypt, 483 KUZNECHIK_BLOCKSIZE, 484 tbe_raw, 485 8 * b"\x00", 486 ) 487 mac_tag = mac( 488 GOST3412Kuznechik(key_handshake2_mac).encrypt, 489 KUZNECHIK_BLOCKSIZE, 490 ciphertext, 491 ) 492 writer.write(Msg(("handshake2", MsgHandshake2(( 493 ("ciphertext", OctetString(ciphertext)), 494 ("ciphertextMac", MAC(mac_tag)), 495 )))).encode()) 496 # }}} 497 await writer.drain() 498 logging.info("%s: session established: %s", _id, peer_name)</span></span></code> </pre><br>   ,     (   ,  ,    ),       MAC-: <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">499</span></span> <span class="hljs-comment"><span class="hljs-comment"># Run text message sender, initialize transport decoder {{{ 500 key_initiator_enc = kdf.expand(b"transport-initiator-enc") 501 key_initiator_mac = kdf.expand(b"transport-initiator-mac") 502 key_responder_enc = kdf.expand(b"transport-responder-enc") 503 key_responder_mac = kdf.expand(b"transport-responder-mac") ... 509 asyncio.ensure_future(msg_sender( 510 peer_name, 511 key_initiator_enc, 512 key_initiator_mac, 513 writer, 514 )) 515 encrypter = GOST3412Kuznechik(key_responder_enc).encrypt 516 macer = GOST3412Kuznechik(key_responder_mac).encrypt 517 # }}} 519 nonce_expected = 0 520 # Wait for test messages {{{ 521 while True: 522 data = await reader.read(MaxMsgLen) ... 530 msg, tail = Msg().decode(buf) ... 537 try: 538 await msg_receiver( 539 msg.value, 540 nonce_expected, 541 macer, 542 encrypter, 543 peer_name, 544 ) 545 except ValueError as err: 546 logging.warning("%s: %s", err) 547 break 548 nonce_expected += 1 549 # }}}</span></span></code> </pre><br> msg_sender    ,    TCP-.      nonce,          .           . <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_sender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(peer_name: str, key_enc: bytes, key_mac: bytes, writer)</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> nonce = <span class="hljs-number"><span class="hljs-number">0</span></span> encrypter = GOST3412Kuznechik(key_enc).encrypt macer = GOST3412Kuznechik(key_mac).encrypt in_queue = IN_QUEUES[peer_name] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: text = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> in_queue.get() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> text <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> ciphertext = ctr( encrypter, KUZNECHIK_BLOCKSIZE, text.encode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>), long2bytes(nonce, <span class="hljs-number"><span class="hljs-number">8</span></span>), ) payload = MsgTextPayload(( (<span class="hljs-string"><span class="hljs-string">"nonce"</span></span>, Integer(nonce)), (<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>, OctetString(ciphertext)), )) mac_tag = mac(macer, KUZNECHIK_BLOCKSIZE, payload.encode()) writer.write(Msg((<span class="hljs-string"><span class="hljs-string">"text"</span></span>, MsgText(( (<span class="hljs-string"><span class="hljs-string">"payload"</span></span>, payload), (<span class="hljs-string"><span class="hljs-string">"payloadMac"</span></span>, MAC(mac_tag)), )))).encode()) nonce += <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>     msg_receiver,    : <br><br><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">msg_receiver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( msg_text: MsgText, nonce_expected: int, macer, encrypter, peer_name: str, )</span></span></span><span class="hljs-function"> -&gt; </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">None</span></span></span><span class="hljs-function">:</span></span> payload = msg_text[<span class="hljs-string"><span class="hljs-string">"payload"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> int(payload[<span class="hljs-string"><span class="hljs-string">"nonce"</span></span>]) != nonce_expected: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">"unexpected nonce value"</span></span>) mac_tag = mac(macer, KUZNECHIK_BLOCKSIZE, payload.encode()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> compare_digest(mac_tag, bytes(msg_text[<span class="hljs-string"><span class="hljs-string">"payloadMac"</span></span>])): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError(<span class="hljs-string"><span class="hljs-string">"invalid MAC"</span></span>) plaintext = ctr( encrypter, KUZNECHIK_BLOCKSIZE, bytes(payload[<span class="hljs-string"><span class="hljs-string">"ciphertext"</span></span>]), long2bytes(nonce_expected, <span class="hljs-number"><span class="hljs-number">8</span></span>), ) text = plaintext.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> OUT_QUEUES[peer_name].put(text)</code> </pre><br><h2 style=";text-align:right;direction:rtl">  ุงุณุชูุชุงุฌ </h2><br> GOSTIM       (    ,  )!      <a href=""></a> (-256 : 995bbd368c04e50a481d138c5fa2e43ec7c89bc77743ba8dbabee1fde45de120).     ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GoGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PyDERASN</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">NNCP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GoVPN</a> , GOSTIM   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GPLv3+</a> . <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> , Python/Go-,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> ยซ โโ</a> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar452200/">https://habr.com/ru/post/ar452200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar452186/index.html">ุฃูุฏุฑ ูุฃุบูู ูุบุงุช ุงูุจุฑูุฌุฉ</a></li>
<li><a href="../ar452188/index.html">ุงุฎุชุจุงุฑ ูุญุฏุฉ ุงูุชุณูุณู Json ูู Spring Boot</a></li>
<li><a href="../ar452190/index.html">ุงุณุชุฎุฏุงู WebAssembly 20x Web Application Accelerated</a></li>
<li><a href="../ar452192/index.html">ูุง ูุฐุง ููุงุ ุงูุชุดุบูู ุงูุฏุงุฎูู ููุงุฆูุงุช JavaScript</a></li>
<li><a href="../ar452198/index.html">ูุง ุงูุฐู ูุฌุจ ุนูู ูู ูููุฏุณ ุถูุงู ุงูุฌูุฏุฉ ูุนุฑูุชู ุนู ุงูุณููููููู 4ุ</a></li>
<li><a href="../ar452202/index.html">ุณุจุฑููุช ูุฑุงุฌุนุฉ: ุฃุณูู - ุฃุณูู</a></li>
<li><a href="../ar452204/index.html">ููุง ูุชุจุช ุฃูู ููุธูุฉ ุงูุนูู ุงูุฏูููุฉ ุจูุฏู</a></li>
<li><a href="../ar452206/index.html">ุงูุชุฌุฑุจุฉ ุงูุฅููุชุฑูููุฉ. ุฃู ููู ูุณุงุนุฏ ุงูุนูู ูู ุชุตููู ูุงุฌูุงุช</a></li>
<li><a href="../ar452210/index.html">ุจูุช ู VK ุนูู ุจูุซูู ูุน ุงูุฎููุฉ ูู ุณุงุนุฉ ุ ุงูุฌุฒุก 2</a></li>
<li><a href="../ar452212/index.html">ููููุฉ ุงูุงูุชูุงู ุฅูู ุงูููุงูุงุช ุงููุชุญุฏุฉ ุงูุฃูุฑูููุฉ ูู ุฎูุงู ุจุฏุก ุงูุชุดุบูู: 3 ุฎูุงุฑุงุช ุชุฃุดูุฑุฉ ุญููููุฉ ูููุฒุงุชูุง ูุฅุญุตุงุฆูุงุชูุง</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>