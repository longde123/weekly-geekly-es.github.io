<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèæ ü¶è ü§¶üèø Como o Dark implanta c√≥digo de 50ms üíª üë©üèº‚Äçüîß üë®üèø‚Äç‚úàÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quanto mais r√°pido o processo de desenvolvimento, mais r√°pida a empresa de tecnologia est√° se desenvolvendo. 


 Infelizmente, aplicativos modernos fu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o Dark implanta c√≥digo de 50ms</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/462027/"><p><img src="https://habrastorage.org/webt/o4/lk/bi/o4lkbi449pbpjqw84e0wt-tywlq.png"></p><br><p>  Quanto mais r√°pido o processo de desenvolvimento, mais r√°pida a empresa de tecnologia est√° se desenvolvendo. </p><br><p>  Infelizmente, aplicativos modernos funcionam contra n√≥s - nossos sistemas devem ser atualizados em tempo real e ao mesmo tempo para n√£o incomodar ningu√©m e n√£o levar a tempo de inatividade e interrup√ß√µes.  A implanta√ß√£o em tais sistemas se torna uma tarefa complexa e requer pipelines de entrega cont√≠nua complexos, mesmo em equipes pequenas. </p><br><p>  Esses oleodutos costumam ter uma aplica√ß√£o estreita, funcionam lentamente e n√£o s√£o confi√°veis.  Os desenvolvedores devem primeiro cri√°-los manualmente e depois gerenci√°-los, e as empresas costumam contratar equipes inteiras de DevOps para isso. </p><br><p>  A velocidade do desenvolvimento depende da velocidade desses oleodutos.  Para as melhores equipes, a implanta√ß√£o leva de 5 a 10 minutos, mas geralmente leva muito mais tempo e, para uma implanta√ß√£o, leva v√°rias horas. </p><a name="habracut"></a><br><p>  No escuro, s√£o necess√°rios 50 ms.  <em>Cinquenta</em>  <em>Milissegundos</em>  O Dark √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">uma solu√ß√£o completa com uma linguagem de programa√ß√£o, editor e infraestrutura</a> projetada especificamente para entrega cont√≠nua, e todos os aspectos do Dark, incluindo o pr√≥prio idioma, s√£o constru√≠dos com a vis√£o de implanta√ß√£o instant√¢nea segura. </p><br><h3 id="pochemu-konveyery-nepreryvnoy-postavki-takie-medlennye">  Por que os transportadores cont√≠nuos s√£o t√£o lentos? </h3><br><p> Digamos que temos um aplicativo da Web Python e j√° criamos um pipeline de entrega cont√≠nua maravilhoso e moderno.  Para um desenvolvedor que est√° ocupado com esse projeto todos os dias, a implanta√ß√£o de uma altera√ß√£o menor ser√° algo como isto: </p><br><h3 id="vnesenie-izmeneniy">  Fazendo altera√ß√µes </h3><br><ul><li>  Criando uma nova ramifica√ß√£o no git </li><li>  Fazendo altera√ß√µes atr√°s da chave de fun√ß√£o </li><li>  Teste de unidade para verificar altera√ß√µes com e sem chave de fun√ß√£o </li></ul><br><h3 id="pul-rekvest">  Pedido de piscina </h3><br><ul><li>  Confirmar confirma√ß√£o </li><li>  Publicando altera√ß√µes em um reposit√≥rio remoto no github </li><li>  Pedido de piscina </li><li>  O IC √© criado automaticamente em segundo plano </li><li>  Revis√£o de c√≥digo </li><li>  Mais algumas cr√≠ticas, se necess√°rio </li><li>  Mesclar altera√ß√µes com o assistente git. </li></ul><br><h3 id="ci-vypolnyaetsya-na-mastere">  O IC √© executado no assistente </h3><br><ul><li>  Definindo depend√™ncias de front-end via npm </li><li>  Construindo e otimizando recursos HTML + CSS + JS </li><li>  Execute no front end dos testes de unidade e fun√ß√£o </li><li>  Instale depend√™ncias do Python a partir do PyPI </li><li>  Executar no back-end de testes de unidade e funcionais </li><li>  Teste de integra√ß√£o nas duas extremidades </li><li>  Enviar recursos de front-end para CDN </li><li>  Construindo um cont√™iner para um programa Python </li><li>  Enviando um cont√™iner para o registro </li><li>  Atualiza√ß√£o do manifesto do Kubernetes </li></ul><br><h3 id="zamena-starogo-koda-novym">  Substituindo c√≥digo antigo por novo </h3><br><ul><li>  Kubernetes lan√ßa v√°rias inst√¢ncias de um novo cont√™iner </li><li>  O Kubernetes est√° aguardando inst√¢ncias se tornarem operacionais </li><li>  Kubernetes adiciona inst√¢ncias ao balanceador de carga HTTP </li><li>  Kubernetes aguarda que inst√¢ncias antigas deixem de ser usadas </li><li>  Kubernetes interrompe inst√¢ncias antigas </li><li>  O Kubernetes repete essas opera√ß√µes at√© que novas inst√¢ncias substituam todas as antigas </li></ul><br><h3 id="vklyuchenie-novogo-pereklyuchatelya-funkcii">  Ligue o novo interruptor de fun√ß√£o </h3><br><ul><li>  O novo c√≥digo √© inclu√≠do apenas para mim, para garantir que est√° tudo bem </li><li>  Novo c√≥digo √© inclu√≠do para 10% dos usu√°rios; as m√©tricas operacionais e de neg√≥cios s√£o rastreadas </li><li>  Novo c√≥digo √© inclu√≠do para 50% dos usu√°rios; as m√©tricas operacionais e de neg√≥cios s√£o rastreadas </li><li>  O novo c√≥digo √© inclu√≠do para 100% dos usu√°rios, as m√©tricas operacionais e de neg√≥cios s√£o rastreadas </li><li>  Por fim, repita todo o procedimento para remover o c√≥digo antigo e alternar </li></ul><br><p>  O processo depende das ferramentas, linguagem e uso de arquiteturas orientadas a servi√ßos, mas, em termos gerais, parece com isso.  N√£o mencionei as implanta√ß√µes de migra√ß√£o de banco de dados porque isso exige um planejamento cuidadoso, mas abaixo descreverei como o Dark lida com isso. </p><br><p>  Existem muitos componentes aqui, e muitos deles podem facilmente desacelerar, travar, causar concorr√™ncia tempor√°ria ou derrubar o sistema de trabalho. </p><br><p>  E como esses pipelines s√£o quase sempre criados para uma ocasi√£o especial, √© dif√≠cil confiar neles.  Muitas pessoas t√™m dias em que o c√≥digo n√£o pode ser implantado, porque h√° problemas no Dockerfile, uma das dezenas de servi√ßos travou ou o especialista certo nas f√©rias. </p><br><p>  Pior ainda, muitos desses passos n√£o fazem nada.  N√≥s precis√°vamos deles antes, quando implantamos o c√≥digo imediatamente para os usu√°rios, mas agora temos op√ß√µes para o novo c√≥digo, e esses processos s√£o divididos.  Como resultado, a etapa na qual o c√≥digo √© implantado (o antigo √© substitu√≠do pelo novo) agora se tornou apenas um risco extra. </p><br><p>  Obviamente, este √© um pipeline muito atencioso.  A equipe que criou levou tempo e dinheiro para implantar rapidamente.  Geralmente, os pipelines de implanta√ß√£o s√£o muito mais lentos e menos confi√°veis. </p><br><h3 id="realizaciya-nepreryvnoy-postavki-v-dark">  Implementando a entrega cont√≠nua no escuro </h3><br><p>  A entrega cont√≠nua √© t√£o importante para a Dark que chegamos a tempo em menos de um segundo.  Passamos por todas as etapas do pipeline para remover tudo o que era desnecess√°rio e lembramos o resto.  Foi assim que removemos as etapas. </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jessie Frazelle</a> cunhou a nova palavra deployless na confer√™ncia Future of Software Development em Reykjavik </blockquote><p>  Decidimos imediatamente que Dark seria baseado no conceito de ‚Äúdeployless‚Äù (obrigado a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jesse Frazel</a> pelo neologismo).  Implanta√ß√£o significa que qualquer c√≥digo √© implantado instantaneamente e pronto para uso na produ√ß√£o.  Obviamente, n√£o perderemos um c√≥digo com defeito ou incompleto (descreverei os princ√≠pios de seguran√ßa abaixo). </p><br><p>  Na demo Dark, muitas vezes nos perguntam como conseguimos acelerar a implanta√ß√£o.  Pergunta estranha.  As pessoas provavelmente pensam que criamos algum tipo de supertecnologia que compara o c√≥digo, o compila, o empacota em um cont√™iner, lan√ßa uma m√°quina virtual, lan√ßa um cont√™iner em um frio e coisas assim - e tudo isso em 50 ms.  Isso dificilmente √© poss√≠vel.  Mas criamos um mecanismo de implanta√ß√£o especial, que n√£o precisa de tudo isso. </p><br><p>  Dark lan√ßa int√©rpretes na nuvem.  Suponha que voc√™ escreva c√≥digo em uma fun√ß√£o ou manipulador para HTTP ou eventos.  Enviamos diff para a √°rvore de sintaxe abstrata (a implementa√ß√£o do c√≥digo usado internamente por nosso editor e servidores) para nossos servidores e, em seguida, executamos esse c√≥digo quando as solicita√ß√µes s√£o recebidas.  Portanto, a implanta√ß√£o se parece com um registro modesto no banco de dados - instant√¢neo e elementar.  A implanta√ß√£o √© t√£o r√°pida porque inclui o m√≠nimo necess√°rio. </p><br><p>  No futuro, planejamos criar um compilador de infraestrutura fora do Dark, que criar√° e executar√° a infraestrutura ideal para alto desempenho e confiabilidade dos aplicativos.  A implanta√ß√£o instant√¢nea, √© claro, n√£o vai a lugar nenhum. </p><br><h2 id="bezopasnoe-razvertyvanie">  Implanta√ß√£o segura </h2><br><h3 id="strukturirovannyy-redaktor">  Editor Estruturado </h3><br><p>  O c√≥digo no Dark est√° escrito no editor Dark.  O editor estruturado n√£o comete erros de sintaxe.  De fato, Dark nem sequer tem um analisador.  Enquanto voc√™ digita, trabalhamos diretamente com a √Årvore de sintaxe abstrata (AST), como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Paredit</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Esbo√ßo e esbo√ßo</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tofu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Prune</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MPS</a> . </p><br><p>  Qualquer c√≥digo incompleto no Dark possui sem√¢ntica de execu√ß√£o v√°lida, como os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">buracos digitados no Hazel</a> .  Por exemplo, se voc√™ alterar uma chamada de fun√ß√£o, mantemos a fun√ß√£o antiga at√© que a nova se torne utiliz√°vel. </p><br><p>  Cada programa no Dark tem seu pr√≥prio significado, portanto, o c√≥digo incompleto n√£o interfere no trabalho final. </p><br><h3 id="rezhimy-redaktirovaniya">  Modos de edi√ß√£o </h3><br><p>  Voc√™ escreve c√≥digo no Dark em dois casos.  Primeiro: voc√™ escreve um novo c√≥digo e √© o √∫nico usu√°rio.  Por exemplo, ele est√° no REPL e outros usu√°rios nunca ter√£o acesso a ele, ou √© uma nova rota HTTP √† qual voc√™ n√£o se refere em nenhum lugar.  Voc√™ pode trabalhar aqui sem nenhuma precau√ß√£o e agora est√° trabalhando aproximadamente no ambiente de desenvolvimento. </p><br><p>  Segunda situa√ß√£o: o c√≥digo j√° est√° em uso.  Se o tr√°fego passar pelo c√≥digo (fun√ß√µes, manipuladores de eventos, bancos de dados, tipo), deve-se tomar cuidado.  Para fazer isso, bloqueamos todo o c√≥digo usado e exigimos o uso de ferramentas mais estruturadas para edit√°-lo.  A seguir, falarei sobre ferramentas estruturais: comutadores de fun√ß√£o para HTTP e manipuladores de eventos, uma poderosa plataforma de migra√ß√£o para bancos de dados e um novo m√©todo de controle de vers√£o para fun√ß√µes e tipos. </p><br><h3 id="pereklyuchateli-funkciy">  Interruptores de fun√ß√£o </h3><br><p>  Uma maneira <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de remover a complexidade extra</a> no Dark √© corrigir v√°rios problemas com uma solu√ß√£o.  Os comutadores de fun√ß√£o executam muitas tarefas diferentes: substitui√ß√£o do ambiente de desenvolvimento local, ramifica√ß√µes git, c√≥digo de implanta√ß√£o e, √© claro, a libera√ß√£o lenta e controlada tradicional do novo c√≥digo. </p><br><p>  A cria√ß√£o e a implanta√ß√£o de um comutador de fun√ß√£o s√£o realizadas em nosso editor em uma opera√ß√£o.  Ele cria um espa√ßo vazio para o novo c√≥digo e fornece controles de acesso ao c√≥digo antigo e novo, al√©m de bot√µes e comandos para transi√ß√£o gradual para o novo c√≥digo ou sua exclus√£o. </p><br><p>  Os comutadores de fun√ß√£o s√£o incorporados ao idioma Escuro, e at√© comutadores incompletos realizam sua tarefa - se a condi√ß√£o no comutador n√£o for atendida, o c√≥digo bloqueado antigo ser√° executado. </p><br><h3 id="sreda-razrabotki">  Ambiente de desenvolvimento </h3><br><p>  As chaves de fun√ß√£o substituem o ambiente de desenvolvimento local.  Hoje, √© dif√≠cil para as equipes garantir que todos usem as mesmas vers√µes de ferramentas e bibliotecas (formatadores de c√≥digo, linters, gerenciadores de pacotes, compiladores, pr√©-processadores, ferramentas de teste etc.) Com o Dark, voc√™ n√£o precisa instalar depend√™ncias localmente, controlar a instala√ß√£o local do Docker ou tomar outras medidas para garantir pelo menos uma apar√™ncia de igualdade entre o ambiente de desenvolvimento e a produ√ß√£o.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dado que essa igualdade ainda √© imposs√≠vel</a> , nem fingiremos que estamos lutando por ela. </p><br><p>  Em vez de criar um ambiente local clonado, os switches no Dark criam uma nova sandbox na produ√ß√£o que substitui o ambiente de desenvolvimento.  No futuro, tamb√©m planejamos criar uma caixa de prote√ß√£o para outras partes do aplicativo (por exemplo, clones de banco de dados instant√¢neos), embora, por enquanto, isso n√£o pare√ßa t√£o importante. </p><br><h3 id="vetki-i-razvertyvaniya">  Ramos e implanta√ß√µes </h3><br><p>  Agora, existem v√°rias maneiras de inserir novo c√≥digo nos sistemas: ramifica√ß√µes git, fase de implanta√ß√£o e comutadores de fun√ß√µes.  Eles resolvem um problema em diferentes partes do fluxo de trabalho: git - nos est√°gios antes da implanta√ß√£o, na implanta√ß√£o - no momento da transi√ß√£o do c√≥digo antigo para o novo e nos comutadores de fun√ß√£o - para a libera√ß√£o controlada do novo c√≥digo. </p><br><p>  A maneira mais eficaz √© a troca de fun√ß√µes (ao mesmo tempo, a mais f√°cil de entender e usar).  Com eles, voc√™ pode abandonar completamente os outros dois m√©todos.  √â especialmente √∫til remover a implanta√ß√£o - se usarmos as op√ß√µes de fun√ß√£o para incluir o c√≥digo de qualquer maneira, a etapa de transferir os servidores para o novo c√≥digo criar√° apenas riscos desnecess√°rios. </p><br><p>  O Git √© dif√≠cil de usar, especialmente para iniciantes, e realmente o limita, mas possui ramifica√ß√µes convenientes.  N√≥s eliminamos muitas das falhas do Git.  O Dark √© editado em tempo real e oferece a capacidade de trabalhar em conjunto no estilo do Google Docs, para que voc√™ n√£o precise enviar o c√≥digo e com menos frequ√™ncia realize a realoca√ß√£o e a mesclagem. </p><br><p>  Os comutadores de recursos sustentam a implanta√ß√£o segura.  Juntamente com implanta√ß√µes instant√¢neas, eles permitem que voc√™ teste rapidamente conceitos em pequenos fragmentos com baixo risco, em vez de aplicar uma grande mudan√ßa que pode derrubar o sistema. </p><br><h3 id="versionirovanie">  Versionamento </h3><br><p>  Para alterar fun√ß√µes e tipos, usamos versionamento.  Se voc√™ deseja alterar uma fun√ß√£o, o Dark cria uma nova vers√£o dessa fun√ß√£o.  Em seguida, voc√™ pode invocar esta vers√£o usando a op√ß√£o no HTTP ou no manipulador de eventos.  (Se essa fun√ß√£o estiver no fundo do gr√°fico de chamadas, uma nova vers√£o de cada fun√ß√£o ser√° criada no processo. Pode parecer muito, mas as fun√ß√µes n√£o interferem se voc√™ n√£o as usar, por isso voc√™ nem notar√°.) </p><br><p>  Pelas mesmas raz√µes, somos tipos de vers√£o.  Falamos sobre nosso sistema de tipos em detalhes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em um post anterior</a> . </p><br><p>  Ao versionar fun√ß√µes e tipos, voc√™ pode fazer altera√ß√µes no aplicativo gradualmente.  Voc√™ pode verificar se cada manipulador individual trabalha com a nova vers√£o; n√£o √© necess√°rio fazer imediatamente todas as altera√ß√µes nos aplicativos (mas temos ferramentas para fazer isso rapidamente, se voc√™ quiser). </p><br><p>  Isso √© muito mais seguro do que implantar totalmente tudo de uma vez, como √© agora. </p><br><h3 id="novye-versii-paketov-i-standartnaya-biblioteka">  Novas vers√µes de pacotes e biblioteca padr√£o </h3><br><p>  Quando voc√™ atualiza um pacote no Dark, n√£o substitu√≠mos imediatamente o uso de cada fun√ß√£o ou tipo em toda a base de c√≥digo.  Isso n√£o √© seguro.  O c√≥digo continua a usar a mesma vers√£o usada e voc√™ atualiza o uso de fun√ß√µes e tipos para uma nova vers√£o para cada caso individual usando as op√ß√µes. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/rh/t3/4w/rht34wyibolrgracbz88tnqqhg0.png"></a> <br>  <em>Uma captura de tela de uma parte de um processo autom√°tico no Dark mostrando duas vers√µes da fun√ß√£o Dict :: get.</em>  <em>Dict :: get_v0 retornou o tipo Any (que recusamos) e Dict :: get_v1 retornou o tipo Option.</em> </p><br><p>  N√≥s geralmente fornecemos um novo recurso na biblioteca padr√£o e exclu√≠mos vers√µes mais antigas.  Usu√°rios com vers√µes antigas no c√≥digo reter√£o acesso a eles, mas novos usu√°rios n√£o poder√£o obt√™-los.  Forneceremos ferramentas para transferir usu√°rios de vers√µes antigas para novas em uma etapa e novamente usando as op√ß√µes de fun√ß√£o. </p><br><p>  O Dark tamb√©m oferece uma oportunidade √∫nica: uma vez que executamos seu c√≥digo de trabalho, podemos testar as novas vers√µes, comparando a sa√≠da de solicita√ß√µes novas e antigas para inform√°-lo das altera√ß√µes.  Como resultado, as atualiza√ß√µes de pacotes, que geralmente s√£o realizadas √†s cegas (ou exigem testes rigorosos de seguran√ßa), apresentam muito menos riscos e podem ocorrer automaticamente. </p><br><h3 id="novye-versii-dark">  Novas vers√µes escuras </h3><br><p>  A transi√ß√£o do Python 2 para o Python 3 se estendeu por mais de uma d√©cada e ainda permanece um problema.  Depois que criamos o Dark para entrega cont√≠nua, essas altera√ß√µes de idioma precisam ser consideradas. </p><br><p>  Quando fazemos pequenas altera√ß√µes no idioma, criamos uma nova vers√£o do Dark.  O c√≥digo antigo permanece na vers√£o antiga do Dark, e o novo c√≥digo √© usado na nova vers√£o.  Para mudar para a nova vers√£o do Dark, voc√™ pode usar as op√ß√µes ou vers√µes de fun√ß√µes. </p><br><p>  Isso √© especialmente √∫til, considerando que o Dark apareceu recentemente.  Muitas altera√ß√µes no idioma ou na biblioteca podem falhar.  O versionamento gradual do idioma nos permite fazer pequenas atualiza√ß√µes, ou seja, n√£o podemos nos apressar e adiar muitas decis√µes sobre o idioma at√© termos mais usu√°rios e, portanto, mais informa√ß√µes. </p><br><h3 id="migracii-baz-dannyh">  Migra√ß√µes de banco de dados </h3><br><p>  Existe uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">f√≥rmula padr√£o</a> para migra√ß√£o segura de banco de dados: </p><br><ul><li>  Reescreva o c√≥digo para suportar formatos novos e antigos </li><li>  Converta todos os dados para um novo formato </li><li>  Excluir acesso antigo a dados </li></ul><br><p>  Como resultado, a migra√ß√£o do banco de dados est√° atrasada e requer muitos recursos.  E estamos acumulando esquemas desatualizados, porque mesmo tarefas simples, como corrigir o nome de uma tabela ou coluna, n√£o valem o esfor√ßo. </p><br><p>  O Dark tem uma plataforma eficaz de migra√ß√£o de banco de dados que (esperamos) simplificar√° tanto o processo que voc√™ n√£o ter√° mais medo dele.  Todos os armazenamentos de dados no Escuro (pares de valores-chave ou tabelas de hash persistentes) s√£o do tipo.  Para migrar um data warehouse, voc√™ simplesmente atribui a ele um novo tipo e uma fun√ß√£o de revers√£o e revers√£o para converter valores entre os dois tipos. </p><br><p>  O acesso aos data warehouses no Dark √© por meio de nomes de vari√°veis ‚Äã‚Äãcom vers√£o.  Por exemplo, o armazenamento de dados Usu√°rios seria chamado inicialmente Usu√°rios-v0.  Quando uma nova vers√£o com um tipo diferente √© criada, o nome muda para Usu√°rios-v1.  Se os dados s√£o salvos por meio de Users-v0 e voc√™ os acessa por meio de Users-v1, a fun√ß√£o de rollover √© aplicada.  Se os dados s√£o salvos atrav√©s do Users-v1 e voc√™ os acessa atrav√©s do Users-v0, a fun√ß√£o de revers√£o √© usada. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ui/sl/wd/uislwdrfrvact0d1ts5icnk-4ka.png"></a> <br>  <em>Tela de migra√ß√£o de banco de dados com nomes de campo para o banco de dados antigo, express√µes de revers√£o e revers√£o e instru√ß√µes para ativar a migra√ß√£o.</em> </p><br><p>  Use os comutadores de fun√ß√£o para rotear chamadas para Usu√°rios-v0 para Usu√°rios-v1.  Voc√™ pode fazer esse manipulador HTTP de cada vez para reduzir riscos, e os comutadores tamb√©m funcionam para usu√°rios individuais, para que voc√™ possa verificar se tudo est√° funcionando conforme o esperado.  Quando o Users-v0 n√£o √© deixado, o Dark converte todos os dados restantes em segundo plano do formato antigo para o novo.  Voc√™ nem percebe. </p><br><h3 id="testirovanie">  Teste </h3><br><p>  Dark √© uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">linguagem de programa√ß√£o funcional com tipagem est√°tica</a> e valores imut√°veis; portanto, sua superf√≠cie de teste √© significativamente menor em compara√ß√£o com linguagens orientadas a objetos com tipagem din√¢mica.  Mas voc√™ ainda precisa testar. <br>  No escuro, o editor executa automaticamente testes de unidade em segundo plano para c√≥digo edit√°vel e, por padr√£o, executa esses testes para todas as op√ß√µes de fun√ß√£o.  No futuro, queremos usar os tipos est√°ticos para confundir automaticamente o c√≥digo e encontrar bugs. </p><br><p>  Al√©m disso, o Dark executa sua infraestrutura em produ√ß√£o, e isso abre novas possibilidades.  Salvamos automaticamente as solicita√ß√µes HTTP na infraestrutura Dark (por enquanto, salvamos todas as solicita√ß√µes, mas queremos mudar para a busca).  Testamos um novo c√≥digo neles e realizamos testes de unidade e, se desejar, voc√™ pode facilmente converter consultas interessantes em testes de unidade. </p><br><h3 id="ot-chego-my-izbavilis">  Do que nos livramos </h3><br><p>  Como n√£o temos uma implanta√ß√£o, mas h√° comutadores de fun√ß√µes, cerca de 60% do pipeline de implanta√ß√£o permanece no mar.  N√£o precisamos de solicita√ß√µes de ramos ou pool de git, criando recursos e cont√™ineres de back-end, enviando recursos e cont√™ineres para registros ou etapas de implanta√ß√£o no Kubernetes. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/gc/9e/g-/gc9eg-szouq0dtrxxr8jd6c6dyo.jpeg"></a> <br>  <em>Compara√ß√£o do pipeline de entrega cont√≠nua padr√£o (esquerda) e do fornecimento cont√≠nuo de Dark (direita).</em>  <em>No escuro, a entrega consiste em 6 etapas e um ciclo, enquanto a vers√£o tradicional inclui 35 etapas e 3 ciclos.</em> </p><br><p>  No Dark, existem apenas 6 etapas e 1 ciclo na implanta√ß√£o (etapas repetidas v√°rias vezes), enquanto o pipeline de suprimento cont√≠nuo moderno consiste em 35 etapas e 3 ciclos.  No escuro, os testes s√£o executados automaticamente e voc√™ nem v√™;  depend√™ncias s√£o instaladas automaticamente;  nada relacionado ao git ou github n√£o √© mais necess√°rio;  N√£o √© necess√°rio coletar, testar e enviar cont√™ineres do Docker;  A implanta√ß√£o do Kubernetes n√£o √© mais necess√°ria. </p><br><p>  At√© as etapas restantes no Dark se tornaram mais f√°ceis.  Como as comuta√ß√µes de fun√ß√µes podem ser controladas em uma a√ß√£o, voc√™ n√£o precisa passar pelo pipeline de implanta√ß√£o inteiro uma segunda vez para remover o c√≥digo antigo. </p><br><p>  Simplificamos a entrega do c√≥digo o m√°ximo poss√≠vel, reduzindo o tempo e os riscos da entrega cont√≠nua.  Tamb√©m simplificamos bastante as atualiza√ß√µes de pacotes, as migra√ß√µes de bancos de dados, os testes, o controle de vers√£o, a instala√ß√£o de depend√™ncias, a igualdade entre o ambiente e a produ√ß√£o de desenvolvimento e as atualiza√ß√µes r√°pidas e seguras de vers√µes de idiomas. </p><br><p>  Eu respondo perguntas sobre isso no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">HackerNews</a> . </p><br><p>  Para saber mais sobre o dispositivo Dark, leia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o artigo Dark</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">siga-nos no Twitter</a> (ou em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mim</a> ) ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">inscreva-se em uma vers√£o beta e receba notifica√ß√µes das seguintes postagens</a> .  Se voc√™ vier ao StrangeLoop em setembro, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">venha ao nosso lan√ßamento</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt462027/">https://habr.com/ru/post/pt462027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt462013/index.html">Hist√≥rico de problemas de migra√ß√£o do Docker storage (docker root)</a></li>
<li><a href="../pt462015/index.html">Universo de relat√≥rios SAP</a></li>
<li><a href="../pt462021/index.html">Como parar de fazer a mesma coisa</a></li>
<li><a href="../pt462023/index.html">Cascadeur: O Futuro da Anima√ß√£o de Jogos</a></li>
<li><a href="../pt462025/index.html">Modelo de dados de rede relacional</a></li>
<li><a href="../pt462029/index.html">19 recursos √∫teis do arquivo .htaccess</a></li>
<li><a href="../pt462031/index.html">Por exemplo, se voc√™ ler os logs!: Inicie o Hotspot 2.0 na rede Wi-Fi no metr√¥</a></li>
<li><a href="../pt462033/index.html">A √öltima Ceia dos Desenvolvedores</a></li>
<li><a href="../pt462035/index.html">Python Vs R - Ci√™ncia de Dados</a></li>
<li><a href="../pt462041/index.html">Abordagens de segmenta√ß√£o para celular - tradu√ß√£o</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>