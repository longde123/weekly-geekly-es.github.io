<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçüè´ üõ§Ô∏è ‚ôåÔ∏è TR-069 chez Mikrotik. Test de Freeacs en tant que serveur de configuration automatique pour RouterOS üôåüèæ üåé üñêüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans cet article, je vais essayer de d√©crire √©tape par √©tape le processus d'installation du serveur de test d'un excellent projet Freeacs √† un √©tat en...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>TR-069 chez Mikrotik. Test de Freeacs en tant que serveur de configuration automatique pour RouterOS</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468241/">  Dans cet article, je vais essayer de d√©crire √©tape par √©tape le processus d'installation du serveur de test d'un excellent projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Freeacs</a> √† un √©tat enti√®rement fonctionnel, et montrer les techniques pratiques pour travailler avec mikrotik: configuration via les param√®tres, ex√©cution de script, mise √† jour, installation de modules suppl√©mentaires, etc. <br><br>  Le but de l'article est d'encourager ses coll√®gues √† abandonner la gestion des p√©riph√©riques r√©seau √† l'aide de r√¢teaux et de b√©quilles terribles, sous la forme de scripts auto-√©crits, Dude, Ansible, etc. Et, √† cet √©gard, provoquent des feux d'artifice et des r√©jouissances massives dans les carr√©s. <br><a name="habracut"></a><br><h4>  0. Choix </h4><br>  Pourquoi les freeacs, et non les g√©nies-ac, mentionn√©s dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mikrotik-wiki</a> , sont-ils plus vivants? <br>  Parce que selon genie-acs avec mikrotik il y a des publications des Espagnols.  Voici leur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pdf</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vid√©o</a> du MUM de l'ann√©e derni√®re.  Les caravanes automatiques sur les diapositives sont cool, mais je voudrais m'√©loigner du concept d'√©criture de scripts, ex√©cuter des scripts, ex√©cuter des scripts ... <br><br><h4>  1. Installer des freeacs </h4><br>  Nous allons l'installer dans Centos7, et puisque les appareils transmettent beaucoup de donn√©es, et ACS travaille activement avec la base de donn√©es - nous ne serons pas avides de ressources.  Pour un travail confortable, nous allouons 2 c≈ìurs de processeur, 4 Go de RAM et 16 Go de stockage rapide ssd raid10.  Je vais installer des freeacs dans le conteneur Proxmox VE lxc, et vous pouvez travailler dans n'importe quel outil qui vous convient. <br>  N'oubliez pas de r√©gler l'heure correcte sur la machine avec ACS. <br><br>  Le syst√®me sera un test, nous ne serons donc pas intelligents et utiliserons simplement le script d'installation fourni avec gentillesse. <br><br><pre><code class="bash hljs">wget https://raw.githubusercontent.com/freeacs/freeacs/master/scripts/install_centos.sh chmod +x install_centos.sh ./ install_centos.sh</code> </pre> <br>  D√®s que le script est termin√©, vous pouvez imm√©diatement acc√©der √† l'interface Web sur la machine IP, avec les informations d'identification admin / freeacs <br><br><img src="https://habrastorage.org/webt/uf/w0/xn/ufw0xnstxoxejymip04wkk17sca.png"><br>  <i>Voici une si belle interface minimaliste, et √† quel point tout cela a √©t√© cool et rapide</i> <br><br><h4>  2. Configuration initiale des freeacs </h4><br>  L'unit√© de commande de base pour ACS est une unit√© ou CPE (√©quipement pour les locaux du client).  Et surtout, ce dont nous avons besoin pour g√©rer les unit√©s est leur type d'unit√©, c'est-√†-dire  mod√®le d'√©quipement qui d√©finit un ensemble de param√®tres d'unit√© personnalisables et son logiciel.  Mais bien que nous ne sachions pas comment obtenir le nouveau type d'unit√©, il est pr√©f√©rable de demander l'unit√© elle-m√™me en activant le mode d√©couverte. <br><br>  En production, ce mode est absolument impossible √† utiliser, mais nous devons bient√¥t d√©marrer le moteur et voir les capacit√©s du syst√®me.  Tous les param√®tres de base sont stock√©s dans / opt / freeacs- *.  Par cons√©quent, ouvrez <br><br><pre> <code class="bash hljs"> vi /opt/freeacs-tr069/config/application-config.conf</code> </pre> <br>  nous trouvons <br><br><pre> <code class="bash hljs">discovery.mode = <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  et changer pour <br><br><pre> <code class="bash hljs">discovery.mode = <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  De plus, nous aimerions augmenter les tailles de fichiers maximales avec lesquelles nginx et mysql fonctionneront.  Pour mysql, ajoutez la ligne √† /etc/my.cnf <br><br><pre> <code class="bash hljs">max_allowed_packet=32M</code> </pre> <br>  et pour nginx, dans /etc/nginx/nginx.conf, ajoutez <br><br><pre> <code class="bash hljs">client_max_body_size 32m;</code> </pre> <br>  √† la section http.  Sinon, nous ne pouvons pas travailler avec plus de 1M de firmware. <br><br>  Nous red√©marrons et nous sommes pr√™ts √† travailler avec des appareils. <br><br>  Et dans le r√¥le de l'appareil (CPE), nous aurons le <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">hAP</a></b> kid <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ACAP lite</a></b> . <br><br>  Avant la connexion de test, il est conseill√© de configurer manuellement le CPE √† la configuration de travail minimale afin que les param√®tres que vous souhaitez configurer √† l'avenir ne soient pas vides.  Pour le routeur, vous pouvez activer au minimum le client DHCP sur ether1, installer le package tr-069client et d√©finir les mots de passe. <br><br><h4>  3. Nous connectons Mikrotik </h4><br>  Il est conseill√© de connecter toutes les unit√©s en utilisant un num√©ro de s√©rie valide comme identifiant.  Ensuite, tout sera clair pour vous dans les journaux.  Quelqu'un conseille d'utiliser WAN MAC - ne croyez pas.  Quelqu'un utilise une paire de connexion / passe commune pour tout le monde - contournez-les. <br><br>  Nous ouvrons le journal tr-069 pour le suivi des ¬´n√©gociations¬ª <br><br><pre> <code class="bash hljs">tail -f /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/freeacs-tr069/tr069-conversation.log</code> </pre> <br>  Ouvrez winbox, √©l√©ment de menu TR-069. <br>  URL ACS: <code>http://10.110.0.109/tr069/prov</code> (remplacer par votre IP) <br>  Nom d'utilisateur: 9249094C26CB (copiez la s√©rie du syst√®me&gt; carte m√®re) <br>  Mot de passe: 123456 (non n√©cessaire pour la d√©couverte, mais pour l'√™tre) <br>  Intervalle d'information p√©riodique que nous ne changeons pas.  Nous √©mettrons ce param√®tre via notre ACS <br><br>  Vous trouverez ci-dessous les param√®tres d'initialisation de la connexion √† distance, mais je n'ai pas pu travailler avec mikrotik pour y parvenir.  Bien que la demande √† distance fonctionne avec les t√©l√©phones pr√™ts √† l'emploi.  Il faudra comprendre. <br><br><img src="https://habrastorage.org/webt/xo/xp/sx/xoxpsxqyjlnpjcuph3xhjjanrpc.png"><br><br>  Apr√®s avoir cliqu√© sur le bouton Appliquer, les donn√©es seront √©chang√©es dans le terminal, et dans l'interface Web Freeacs, vous pouvez voir notre routeur avec le type d'unit√© ¬´hAPaclite¬ª cr√©√© automatiquement. <br><br><img src="https://habrastorage.org/webt/ov/sc/nu/ovscnujrn-t5deekdeqgbpl-y6e.png"><br><br>  Le routeur est connect√©.  Vous pouvez consulter le type d'unit√© cr√©√© automatiquement.  Ouvrez <code>Easy Provisioning &gt; Unit Type &gt; Unit Type Overview &gt; hAPaclite</code> .  Qu'y a-t-il non seulement!  Jusqu'√† 928 param√®tres (j'ai espionn√© dans le shell).  Que ce soit beaucoup ou un peu, nous le d√©couvrirons plus tard, mais pour l'instant juste un coup d'≈ìil.  C'est ce que signifie le type d'unit√©.  Il s'agit d'une liste de param√®tres pris en charge avec des cl√©s mais pas de valeurs.  Les valeurs sont d√©finies dans les niveaux ci-dessous - Profils et unit√©s. <br><br><h4>  4. Configurer Mikrotik </h4><br>  Il est temps de t√©l√©charger <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">le</a> guide de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">interface Web</a> . Ce guide 2011 est comme une bouteille de bon vin vieilli.  Ouvrons-le et partons respirer. <br><br>  Et nous-m√™mes, dans l'interface web, cliquez sur le crayon √† c√¥t√© de notre unit√© et passez en mode de configuration de l'unit√©.  Cela ressemble √† ceci: <br><br><img src="https://habrastorage.org/webt/it/3l/tf/it3ltfcesvywjovfuqgurxoj_co.png"><br><br>  Examinez bri√®vement ce qui est int√©ressant sur cette page: <br><br>  <i>Bloc de configuration de l'unit√©</i> <br><br><ul><li>  Profil: il s'agit du profil √† l'int√©rieur du type d'unit√©.  La hi√©rarchie est la suivante: <code>UnitType &gt; Profile &gt; Unit</code> .  Autrement dit, nous pouvons obtenir, par exemple, les profils <code>hAPaclite &gt; hotspot</code> et <code>hAPaclite &gt; branch</code> , mais dans le mod√®le d'appareil </li></ul><br>  <i>Provisionnement des boutons</i> <br>  Les indications indiquent que tous les boutons du bloc Provisioning peuvent appliquer instantan√©ment la configuration via ConnectionRequestURL.  Mais, comme je l'ai dit ci-dessus, cela ne fonctionne pas, donc apr√®s avoir cliqu√© sur les boutons, vous devrez red√©marrer le client tr-069 sur mikrotik pour d√©marrer manuellement l'approvisionnement. <br><br><ul><li>  Freq / Spread: combien de fois par semaine pour fournir une configuration de ¬±% afin de r√©duire la charge sur le serveur et les canaux de communication.  Par d√©faut, cela co√ªte 7/20, soit  tous les jours ¬± 20% et un indice comme celui-ci en quelques secondes.  Bien qu'il soit inutile de modifier la fr√©quence de livraison, tk.  il y aura un bruit excessif dans les journaux et pas toujours l'application attendue des param√®tres </li></ul><br>  <i>Historique de provisionnement des blocs</i> (derni√®res 48 heures) <br><br><ul><li>  Cela ressemble √† une histoire, comme une histoire, mais en cliquant sur le titre, vous acc√©dez √† un outil de recherche de base de donn√©es pratique, avec regexp et buns </li></ul><br>  <i>Bloc de param√®tres</i> <br><br>  Le bloc le plus grand et le plus important, o√π, en fait, les param√®tres de cette unit√© sont d√©finis et lus.  Nous ne voyons maintenant que les param√®tres syst√®me les plus importants, sans lesquels ACS ne peut pas fonctionner avec l'unit√©.  Mais nous nous souvenons que nous avons <i>928</i> unit√©s de type.  Examinons toutes les valeurs et d√©cidons de ce que tout cela mange avec Mikrotik. <br><br><h4>  4.1 Lire les param√®tres </h4><br>  Dans le bloc Provisioning, cliquez sur le bouton Read all.  Dans le bloc - une inscription rouge.  La colonne de <i>valeur CPE (actuelle)</i> appara√Æt √† droite.  Dans les param√®tres syst√®me, ProvisioningMode est devenu READALL. <br><br><img src="https://habrastorage.org/webt/eu/tg/no/eutgnogavgnitu8wwhvtb7w4qcw.png"><br><br>  Et ... rien ne se passera sauf le message dans System.X_FREEACS-COM.IM.Message <code>Kick failed at...</code> <br><br>  Red√©marrez le client TR-069 ou red√©marrez le routeur et continuez √† actualiser la page du navigateur jusqu'√† ce que vous obteniez les param√®tres dans les rectangles gris gais √† droite <br>  Si quelqu'un veut prendre une gorg√©e de l'ancien - ce mode dans le manuel est d√©crit comme 10.2 Mode d'inspection.  Il s'allume et fonctionne un peu mal, mais l'essence est d√©crite assez <br><br><img src="https://habrastorage.org/webt/em/ut/g1/emutg1mnfctnq7vh5uoqr48wwiu.png"><br><br>  Le mode READALL lui-m√™me s'√©teindra apr√®s 15 minutes, et nous essaierons de d√©terminer ce qui est utile et ce qui peut √™tre corrig√© ¬´√† la vol√©e¬ª pendant que nous sommes dans ce mode. <br><br>  Vous pouvez changer les adresses IP, activer / d√©sactiver les interfaces, les r√®gles de pare-feu, qui ont des commentaires (sinon un d√©sordre complet), le Wi-Fi et ainsi de suite. <br><br>  Autrement dit, il n'est pas encore possible de configurer mikrotik sane avec TR-069 uniquement.  Mais vous pouvez tr√®s bien surveiller.  Statistiques disponibles sur les interfaces et leur √©tat, m√©moire libre, etc. <br><br><h4>  4.2 Param√®tres de livraison </h4><br>  Essayons maintenant de fournir les param√®tres au routeur, via tr-069, de mani√®re "naturelle".  La premi√®re victime sera Device.DeviceInfo.X_MIKROTIK_SystemIdentity.  On le retrouve dans les param√®tres unitaires All.  Apparemment - ce n'est pas r√©gl√©.  Cela signifie que n'importe quelle unit√© peut elle-m√™me avoir n'importe quelle identit√©.  Arr√™te √ßa! <br>  Poke a daw dans la colonne de cr√©ation, d√©finissez le nom Mr.White et piquez le bouton Mettre √† jour les param√®tres.  Que se passera-t-il ensuite, vous l'avez d√©j√† devin√©.  Lors de la prochaine session de communication avec le si√®ge, le routeur doit changer son identit√©. <br><br><img src="https://habrastorage.org/webt/yn/an/e8/ynane8pm3vt76wuvhwtfoqtxvis.png"><br><br>  Mais cela ne nous suffit pas.  Un param√®tre tel que l'identit√© est bon d'avoir toujours √† port√©e de main lors de la recherche de l'unit√© souhait√©e.  Nous poussons dans le nom du param√®tre et y mettons l'affichage des griffes (D) et consultable (S).  La cl√© de param√®tre devient RWSD (n'oubliez pas que les noms et les cl√©s sont d√©finis au niveau le plus √©lev√© du type d'unit√©) <br><br><img src="https://habrastorage.org/webt/40/yf/zg/40yfzgpolinlrvj6aqq0zxlw0js.png"><br><br>  La valeur est d√©sormais non seulement affich√©e dans la liste de recherche g√©n√©rale, mais √©galement disponible pour la recherche dans <code>Support &gt; Search &gt; Advanced form</code> <br><br><img src="https://habrastorage.org/webt/sd/p_/1g/sdp_1gntzb5ly1wnzrd0uvwbrza.png"><br><br>  Nous initions la mise √† disposition et examinons l'identit√©.  Bonjour Mr.White!  Maintenant, vous ne pourrez plus changer votre identit√© pendant que tr-069client est en cours d'ex√©cution <br><br><img src="https://habrastorage.org/webt/by/oc/j4/byocj4kosk_jiekvn8jgkuzi-y0.png"><br><br><h4>  4.3 Nous ex√©cutons des scripts </h4><br>  Puisque nous avons d√©couvert qu‚Äôil n‚Äôy avait aucun moyen sans eux, ex√©cutons-les. <br><br>  Mais avant de commencer √† travailler avec des fichiers, nous devons corriger la directive <code>public.url</code> dans le fichier <code>/opt/freeacs-tr069/config/application-config.conf</code> <br>  Apr√®s tout, nous avons toujours une configuration de test install√©e par un script.  N'oubliez pas? <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># --- Public url (used for download f. ex.) --- public.url = "http://10.110.0.109" public.url: ${?PUBLIC_URL}</span></span></code> </pre> <br><br>  Red√©marrez ACS et dirigez-vous directement vers <code>Files &amp; Scripts</code> . <br><br><img src="https://habrastorage.org/webt/cb/ah/wk/cbahwkm8ckqb0r0gg3q2xsaiumi.png"><br><br>  Mais ce que nous ouvrons maintenant appartient au type d'unit√©, c'est-√†-dire  globalement √† tous les routeurs hAP ac lite, qu'il s'agisse d'un routeur de branche, d'un hotspot ou d'un capsman.  Nous n'avons pas encore besoin d'un niveau aussi √©lev√©, par cons√©quent, avant de travailler avec des scripts et des fichiers, vous devez cr√©er un profil.  Vous pouvez l'appeler vous-m√™me, comme la ¬´position¬ª de l'appareil. <br><br>  Faisons de notre b√©b√© un serveur de temps.  Poste d√©cent avec un progiciel s√©par√© et un petit nombre de param√®tres.  Acc√©dez √† <code>Easy Provisioning &gt; Profile &gt; Create Profile</code> et cr√©ez un profil de serveur de temps dans Type d'unit√©: <i>hAPaclite</i> .  Nous n'avions pas de param√®tres dans le profil par d√©faut, il n'y a donc rien √† <i>copier Copier les param√®tres de: "ne pas copier ..."</i> <br><br><img src="https://habrastorage.org/webt/vf/9y/nc/vf9yncecit2scfc9pezngwg9sz0.png"><br><br>  Il n'y a pas encore de param√®tres, mais il sera possible de d√©finir ceux que nous voulons voir plus tard sur nos serveurs de temps, bricol√© √† partir de hAPaclite.  Par exemple, les adresses communes des serveurs NTP. <br>  Passons √† la configuration de l'unit√© et d√©pla√ßons-la dans le profil du serveur de temps <br><br>  Enfin, nous allons dans <code>Files &amp; Scripts</code> , faisons des scripts, et ici nous attendons des petits pains incroyablement pratiques. <br><br>  Pour ex√©cuter le script sur l'unit√©, nous devons s√©lectionner <i>Type: TR069_SCRIPT</i> et <i>Nom</i> et <i>Nom cible</i> doivent avoir l'extension .alter <br>  Dans le m√™me temps, pour les scripts, contrairement aux logiciels, vous pouvez soit charger le fichier fini, soit simplement l'√©crire / le modifier dans le champ <i>Contenu.</i>  Essayons d'√©crire ici. <br><br>  Et pour voir imm√©diatement le r√©sultat - ajoutez un routeur vlan √† ether1 <br><br><pre> <code class="bash hljs">/interface vlan add interface=ether1 name=vlan1 vlan-id=1</code> </pre> <br><img src="https://habrastorage.org/webt/jr/lh/7s/jrlh7sk9y_benjwmujnnv1ypk_u.png"><br><br>  Entrez, cliquez sur <i>T√©l√©charger</i> et vous avez termin√©.  Notre script <code>vlan1.alter</code> attend dans les coulisses. <br><br>  Eh bien, l'a conduit?  Non.  Nous devons √©galement ajouter un groupe √† notre profil.  Les groupes ne sont pas inclus dans la hi√©rarchie des √©quipements, mais sont n√©cessaires pour rechercher des unit√©s dans UnitType ou Profile et sont requis pour ex√©cuter des scripts via Advanced Provisioning.  Habituellement, les groupes sont associ√©s √† des emplacements et ont une structure imbriqu√©e.  Faisons un groupe Russie. <br><br><img src="https://habrastorage.org/webt/mz/73/bj/mz73bjayacypyy98f3thi1oe8ng.png"><br><br>  Imaginez, nous avons pu restreindre la recherche de ¬´Serveurs de tous les temps du monde sur hAPaclite¬ª √† ¬´Serveurs de tous les temps de la Russie sur hAPaclite¬ª.  Il y a encore une √©norme couche de tout ce qui est int√©ressant avec les groupes, mais nous n'avons pas le temps.  D√©j√† conduit dans des scripts. <br><br><pre> <code class="plaintext hljs">Advanced Provisioning &gt; Job &gt; Create Job</code> </pre> <br><img src="https://habrastorage.org/webt/si/yh/b4/siyhb4rjztp3yyqi__zgetxhigi.png"><br><br>  Puisque nous sommes apr√®s tout en mode avanc√©, vous pouvez sp√©cifier ici un tas de conditions diff√©rentes pour d√©marrer le travail, le comportement d'erreur, les tentatives et les d√©lais d'attente.  Je recommande de tout lire dans les manuels ou d'en discuter plus tard lors de sa mise en ≈ìuvre en production.  Pour l'instant, il suffit de mettre n1 dans les r√®gles Stop pour que la t√¢che s'arr√™te d√®s qu'elle est termin√©e sur notre 1 unit√©. <br><br>  Nous remplissons le n√©cessaire, et il ne reste plus qu'√† courir! <br><br><img src="https://habrastorage.org/webt/xn/mw/3m/xnmw3mthgxsoyrj1jv7widfjfai.png"><br><br>  Appuyez sur START et attendez.  Maintenant, le compteur d'appareils tu√©s par un script sous-d√©velopp√© fonctionnera rapidement!  Non, bien s√ªr.  De telles t√¢ches sont donn√©es depuis longtemps, et c'est leur diff√©rence avec les scripts, Ansible et ainsi de suite.  Les unit√©s elles-m√™mes postulent pour des t√¢ches selon un calendrier ou lorsqu'elles apparaissent sur le r√©seau, ACS garde la trace des unit√©s qui ont d√©j√† re√ßu des t√¢ches, et comment elles se sont termin√©es, et les √©crit dans les param√®tres de l'unit√©.  Il y a 1 unit√© dans notre groupe, et s'il y en avait 1001, l'administrateur ex√©cuterait cette t√¢che et irait p√™cher <br><br>  Allez.  Red√©marrez d√©j√† le routeur ou red√©marrez le client TR-069.  Tout devrait bien se passer et Mr.White obtiendra un nouveau vlan.  Et notre affectation de r√®gle d'arr√™t passera au statut PAUSED.  Autrement dit, il peut toujours √™tre red√©marr√© ou modifi√©.  Si vous cliquez sur TERMINER, la t√¢che sera √©crite dans l'archive <br><br><h4>  4.4 Mettre √† jour le logiciel </h4><br>  C'est un point tr√®s important, car le firmware Mikrotik est modulaire, mais l'ajout de modules ne change pas la version g√©n√©rale du firmware de l'appareil.  Notre ACS est normal, et je n'y suis pas habitu√©. <br>  Maintenant, nous allons le faire dans un style rapide et sale, et pousser le module NTP dans le firmware g√©n√©ral tout de suite, mais d√®s que la version sera mise √† jour sur l'appareil, nous ne pourrons pas ajouter un autre module de la m√™me mani√®re. <br>  En production, une telle astuce est pr√©f√©rable de ne pas appliquer et d'installer des modules facultatifs pour le type d'unit√© uniquement avec des scripts. <br><br>  Donc, la premi√®re chose que nous devons faire est de pr√©parer les packages logiciels des versions et de l'architecture requises, et de les mettre sur un serveur Web accessible.  Pour le test, tout le monde ira que notre Mr.White peut atteindre, et pour la production, il est pr√©f√©rable d'assembler un miroir de mise √† jour automatique du logiciel n√©cessaire, ce qui n'est pas effrayant √† mettre sur le web <br>  Important!  N'oubliez pas de toujours inclure un package avec tr-069client dans les mises √† jour! <br><br>  Il s'est av√©r√© que la longueur du chemin vers les paquets est tr√®s importante!  Lorsque j'ai essay√© d'utiliser quelque chose comme <code>http://192.168.0.237/routeros/stable/mipsbe/routeros-mipsbe-6.45.6.npk</code> , mikrotik est tomb√© dans une connexion cyclique √† la ressource, donnant le TRFERCOMPLETE au journal tr-069.  Et j'ai pass√© une certaine quantit√© de cellules nerveuses √† essayer de comprendre ce qui n'allait pas.  Par cons√©quent, pendant que nous mettons √† la racine, jusqu'√† clarification <br><br>  Donc, nous devrions avoir trois fichiers npk disponibles via http.  Il s'est av√©r√© donc pour moi <br><br><pre> <code class="bash hljs">http://192.168.0.241/routeros-mipsbe-6.45.6.npk http://192.168.0.241/routeros/stable/mipsbe/ntp-6.45.6-mipsbe.npk http://192.168.0.241/routeros/stable/mipsbe/tr069-client-6.45.6-mipsbe.npk</code> </pre> <br>  Maintenant, il doit √™tre publi√© dans le fichier xml avec FileType = "1 Firmware Upgrade Image", dont nous alimentons la microtique.  Que le nom soit ros.xml <br><br>  Nous suivons les instructions du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mikrotik-wiki</a> : <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">upgrade</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"links"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">config</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">links</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/routeros-mipsbe-6.45.6.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/ntp-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.241/tr069-client-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">links</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">upgrade</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  L'absence de nom d' <code>Username/Password</code> de <code>Username/Password</code> pour acc√©der au serveur de t√©l√©chargement est frappante.  Vous pouvez soit essayer de saisir ceci comme dans la clause A.3.2.8 du protocole tr-069: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://192.168.0.237/routeros/stable/mipsbe/ntp-6.45.6-mipsbe.npk<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Username</span></span></span><span class="hljs-tag">&gt;</span></span>user<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Username</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span>pass<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Password</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Ou demandez directement au Mikrotik officiel, ainsi que la longueur maximale du chemin vers * .npk <br><br>  Nous allons aux <code>Files &amp; Scripts</code> nous connaissons et cr√©ons un fichier comme SOFTWARE avec le <b>nom:</b> ros.xml, le <b>nom cible:</b> ros.xml et la <b>version:</b> 6.45.6 <br>  Attention!  La version ici doit √™tre sp√©cifi√©e dans le format dans lequel elle est affich√©e sur l'appareil et transmise dans le param√®tre <code>System.X_FREEACS-COM.Device.SoftwareVersion</code> . <br><br>  Nous s√©lectionnons notre fichier xm √† t√©l√©charger et vous avez termin√©. <br><br><img src="https://habrastorage.org/webt/th/w7/0-/thw70-pm9bruivrrcogyx1v2vig.png"><br><br>  Nous avons maintenant une tonne de fa√ßons de mettre √† niveau votre appareil.  Via l'assistant du menu principal, le provisionnement avanc√© et les t√¢ches de type LOGICIEL, ou acc√©dez simplement √† la configuration de l'unit√© et cliquez sur Mettre √† niveau.  Nous choisissons le moyen le plus simple, et m√™me alors, l'article est gonfl√©. <br><br><img src="https://habrastorage.org/webt/le/jk/fg/lejkfgwuolymtutzfswkpcnwel0.png"><br><br>  Cliquez sur le bouton, lancez la mise √† disposition et vous avez termin√©.  Le programme de test est termin√©.  Maintenant, nous pouvons faire plus avec mikrotik. <br><br><h4>  5. Conclusion </h4><br>  Quand j'ai commenc√© √† √©crire, je voulais d'abord d√©crire la connexion de l'ip-phone, et en utilisant son exemple pour expliquer √† quel point cela peut √™tre cool lorsque le tr-069 fonctionne facilement et sans effort.  Mais ensuite, en progressant et en fouillant dans les documents, j'ai pens√© que pour celui qui avait connect√© Mikrotik, aucun t√©l√©phone ne ferait peur pour une √©tude ind√©pendante. <br><br>  En principe, les Freeacs que nous avons test√©s peuvent d√©j√† √™tre utilis√©s en production, mais pour cela, vous devez configurer la s√©curit√©, SSL, vous devez configurer Mikrotik pour la configuration automatique apr√®s la r√©initialisation, vous devez d√©boguer l'ajout correct du type d'unit√©, d√©monter le travail des services Web et du shell de fusion, et bien plus encore.  Essayez, inventez et √©crivez une suite! <br><br>  Merci √† tous pour votre attention!  Je serai ravi des amendements et commentaires! <br><br>  Liste des mat√©riaux utilis√©s et liens utiles: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le fil de discussion que j'ai rencontr√© au d√©but des recherches sur le sujet</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">TR-069 CPE WAN Management Protocol Amendement-6</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Wiki Freeacs</a> <br>  <a href="">Param√®tres tr-069 dans Mikrotik, et leur conformit√© avec les commandes du terminal</a> <br><br>  Mise √† jour 10.13.2019: <br><br>  En parcourant les informations sur le projet FreeACS, je suis tomb√© sur un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">patch</a> tr√®s int√©ressant propos√© par des Polonais qui ont FreeACS desservant des appareils 20K. <br><br>  Le patch est fait pour diff√©rentes versions de mat√©riel, mais dans le cas des microtics, il vous permettra de cr√©er plusieurs types d'unit√©s pour les m√™mes routeurs avec un ensemble diff√©rent de modules logiciels. <br>  Par exemple, hAPaclite-ntp, hAPaclite-ups, etc.  Et, en cons√©quence, pour contourner la restriction "un mod√®le == un firmware" </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr468241/">https://habr.com/ru/post/fr468241/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr468231/index.html">La s√©curit√© dans AEM est-elle un probl√®me de plate-forme ou d'impl√©mentation?</a></li>
<li><a href="../fr468233/index.html">La fa√ßon de taper la v√©rification de 4 millions de lignes de code Python. partie 1</a></li>
<li><a href="../fr468235/index.html">La fa√ßon de taper la v√©rification de 4 millions de lignes de code Python. 2e partie</a></li>
<li><a href="../fr468237/index.html">La fa√ßon de taper la v√©rification de 4 millions de lignes de code Python. 3e partie</a></li>
<li><a href="../fr468239/index.html">Choisir la bonne structure de donn√©es dans Swift</a></li>
<li><a href="../fr468245/index.html">Nous n'avons pas besoin de corrections de traduction: notre traducteur sait mieux comment cela doit √™tre traduit</a></li>
<li><a href="../fr468251/index.html">Il n'y a pas d'avenir</a></li>
<li><a href="../fr468253/index.html">Curseur d'image simple en CSS et Javascript</a></li>
<li><a href="../fr468259/index.html">Cinq temps forts du Helm Summit 2019 √† Amsterdam</a></li>
<li><a href="../fr468261/index.html">Un nouveau jeu avec une vieille ambiance sur Three.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>