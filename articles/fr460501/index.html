<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äçüé§ üíë üê∞ Exemple d'impl√©mentation d'int√©gration continue √† l'aide de BuildBot ü§∑üèª üòØ ‚õµÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(Image par Computerizer de Pixabay) 
 
 Salut 

 Je m'appelle Evgeny Cherkin , je suis le programmeur de l'√©quipe de d√©veloppement de la soci√©t√© mini√®...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Exemple d'impl√©mentation d'int√©gration continue √† l'aide de BuildBot</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460501/"><img src="https://habrastorage.org/webt/jj/-4/-g/jj-4-gindpovkdi6rbmzxax4yqu.jpeg" alt="Configuration d'essai buildbot"><br>  <i>(Image par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Computerizer</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Pixabay)</a></i> <i><br></i> <br>  Salut <br><br>  Je m'appelle <b>Evgeny Cherkin</b> , je suis le programmeur de l'√©quipe de d√©veloppement de la soci√©t√© mini√®re <b>Polymetal</b> . <br><br>  Lorsque vous lancez un projet majeur, vous commencez √† penser: "Quel logiciel est pr√©f√©rable d'utiliser pour sa maintenance?".  Un projet informatique avant la sortie de la prochaine version passe par une s√©rie d'√©tapes.  C'est bien quand la cha√Æne de ces √©tapes est automatis√©e.  Le processus automatis√© de publication d'une nouvelle version d'un projet informatique est appel√© <i>int√©gration continue</i> .  <b>BuildBot</b> s'est av√©r√© √™tre une bonne aide pour nous, impl√©mentant ce processus. <br><br>  Dans cet article, j'ai d√©cid√© de fournir un aper√ßu des fonctionnalit√©s de <b>BuildBot</b> .  De quoi est capable ce logiciel?  Comment l'approcher et comment construire avec lui une RELATION DE TRAVAIL EFFICACE normale?  Vous pouvez √©galement vous appliquer notre exp√©rience en cr√©ant sur votre machine un service de travail pour assembler et tester votre projet. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Table des mati√®res</b> <div class="spoiler_text"><div class="scrollable-table"><table><tbody><tr><td colspan="4" align="center"><h3>  Table des mati√®res </h3></td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">1. Pourquoi BuildBot?</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">2. Concept dirig√© par BuildMaster</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">3. Installation</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">4. Premi√®res √©tapes</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5. Configuration.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Recette √©tape par √©tape</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.1 BuildmasterConfig</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.2 travailleurs</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.3 change_source</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.4 d√©chiqueteurs</a> </td></tr><tr><td colspan="2" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.5 BuildFactory</a> </td><td colspan="2" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.6 constructeurs</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6. Exemple de configuration propre</a> </td></tr><tr><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.1 En route vers votre master.cfg</a> </td><td>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.2 Travailler avec svn</a> </td><td colspan="2">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">6.3 Une lettre √† vous: les journalistes sont autoris√©s √† d√©clarer</a> </td></tr><tr><td colspan="4" align="center">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Nous l'avons fait!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mes f√©licitations</a> </td></tr></tbody></table></div><br></div></div><br><a name="Why"></a><h3>  1. Pourquoi BuildBot? </h3><hr><br>  Plus t√¥t sur habr-e, je suis tomb√© sur des articles sur la mise en ≈ìuvre de l' <i>int√©gration continue √† l'</i> aide de <b>BuildBot</b> .  Par exemple, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">celui-ci</a> m'a sembl√© le plus instructif.  Il y a un autre exemple - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus simple</a> .  Ces articles peuvent √™tre assaisonn√©s avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un exemple tir√© du manuel</a> , et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce</a> apr√®s, en anglais.  Le coup√© est un bon point de d√©part.  Apr√®s avoir lu ces articles, vous voudrez probablement faire quelque chose sur <b>BuildBot tout de suite</b> . <br><br>  Arr√™te √ßa!  Quelqu'un l'a-t-il m√™me utilis√© dans ses projets?  Il s'av√®re que oui, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">beaucoup l'ont</a> appliqu√© dans leurs t√¢ches.  Vous pouvez trouver des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">exemples d'</a> utilisation de <b>BuildBot</b> dans les archives de code Google. <br><br>  Alors, quelle est la logique des gens qui utilisent <b>buildbot</b> ?  Apr√®s tout, il existe d'autres outils: <b>CruiseControl</b> et <b>Jenkins</b> .  Je r√©pondrai de cette fa√ßon.  Pour la plupart des t√¢ches, <b>Jenkins</b> sera vraiment suffisant.  <b>BuildBot</b> , √† son tour, est plus adaptatif, et les t√¢ches y sont r√©solues aussi facilement que dans <b>Jenkins</b> .  Choisissez-vous.  Mais comme nous recherchons un outil pour un projet cible en d√©veloppement, pourquoi ne pas choisir celui qui nous permet, √† partir d'√©tapes simples, d'obtenir un syst√®me de build interactif et dot√© d'une interface unique. <br><br>  Pour ceux dont le projet cible est √©crit en python, la question se pose: ¬´Pourquoi ne pas choisir un syst√®me d'int√©gration qui a une interface claire en termes de langage utilis√© dans le projet?¬ª.  Et puis il est temps de pr√©senter les avantages de <b>BuildBot</b> . <br><blockquote>  Alors, notre ¬´quatuor instrumental¬ª.  Pour moi, j'ai d√©fini les quatre fonctionnalit√©s de <b>BuildBot</b> : <br><ol><li>  Ceci est un framework open source sous la GPL </li><li>  Cela utilise python comme outil de configuration et d√©crit les actions requises. </li><li>  C'est l'occasion de recevoir une r√©ponse de la machine sur laquelle se d√©roule le montage. </li><li>  Ce sont enfin les exigences minimales pour l'h√¥te.  Le d√©ploiement n√©cessite python et twisted, et aucune machine virtuelle ou machine java n'est requise. </li></ol><br></blockquote><a name="Concepts"></a><h3>  2. Concept dirig√© par BuildMaster </h3><hr><br><img src="https://habrastorage.org/webt/so/qs/u1/soqsu1skae_0xuktzdemfv-n3yq.png" alt="BuildBot BuildMaster"><br><br>  <b>BuildMaster</b> est au <b>c≈ìur de l'</b> architecture de distribution des <b>t√¢ches</b> .  C'est un service qui: <br><br><ul><li>  <b>suit les</b> changements dans l'arborescence source du projet </li><li>  <b>envoie les</b> commandes que le service Worker doit ex√©cuter pour cr√©er un projet et le tester </li><li>  <b>informe les</b> utilisateurs des r√©sultats des actions entreprises </li></ul><br>  <b>BuildMaster est</b> configur√© via le <i>fichier master.cfg</i> .  Ce fichier est √† la racine de <b>BuildMaster</b> .  Plus tard, je montrerai comment cette racine est cr√©√©e.  Le <i>fichier master.cfg lui</i> - <i>m√™me</i> contient python, un script qui utilise les appels <b>BuildBot</b> . <br><br>  Le prochain <b>BuildBot le</b> plus important est appel√© <b>Worker</b> .  Ce service peut √™tre ex√©cut√© sur un h√¥te diff√©rent avec un syst√®me d'exploitation diff√©rent, ou peut-√™tre sur l'emplacement de <b>BuildMaster</b> .  Il peut √©galement exister dans un environnement virtuel sp√©cialement pr√©par√© avec ses propres packages et variables.  Ces environnements virtuels peuvent √™tre pr√©par√©s √† l'aide d'utilitaires python comme <i>vertualenv, venv</i> . <br><br>  <b>BuildMaster</b> diffuse des commandes √† chaque <b>Worker</b> , qui, √† son tour, les ex√©cute.  Autrement dit, il s'av√®re que le processus de construction et de test du projet peut aller au <b>Worker</b> sous Windows et √† un autre Worker sous Linux. <br><br>  <i>La r√©cup√©ration</i> du code source du projet se produit sur chaque <b>Worker</b> . <br><br><a name="Install"></a><h3>  3. Installation </h3><hr><br>  Alors allons-y.  J'utiliserai Ubuntu 18.04 comme h√¥te.  Je vais y placer un <b>BuildMaster</b> -a et un <b>Worker</b> -a.  Mais vous devez d'abord installer python3.7: <br><br><pre><code class="bash hljs">sudo apt-get update sudo apt-get install python3.7</code> </pre> <br>  Pour ceux qui ont besoin de python3.7.2 au lieu de 3.7.1, vous pouvez faire ce qui suit: <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get software-properties-common sudo add-apt-repository ppa:deadsnakes/ppa sudo apt-get install python3.7 sudo ln -fs /usr/bin/python3.7 /usr/bin/python3 pip3 install --upgrade pip</code> </pre><br>  L'√©tape suivante consiste √† installer <i>Twited</i> et <b>BuildBot</b> , ainsi que des packages qui activent des fonctionnalit√©s <b>BuildBot</b> -a suppl√©mentaires. <br><br><pre> <code class="bash hljs">/*   sudo        /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/python3.7/dist-packages*/ <span class="hljs-comment"><span class="hljs-comment">#     Worker- sudo pip install twisted # twisted sudo pip install buildbot #BuildMaster #  pip install pysqlite3 #  sqllite    pip install jinja2 #framework  django,  web     pip install autobahn #Web c   BuildMaster-&gt;Worker pip install sqlalchemy sqlalchemy-migrate #     # Web  BuildBot-a pip install buildbot-www buildbot-grid-view buildbot-console-view buildbot-waterfall-view pip install python-dateutil #   web #         pip install buildbot-worker #Worker #  sudo pip install virtualenv # </span></span></code> </pre><br><a name="master"></a><h3>  4. Premi√®res √©tapes </h3><hr><br>  Il est temps de cr√©er un <b>BuildMaster</b> .  Nous l'aurons dans le dossier <i>/ home / habr / master</i> . <br><pre> <code class="bash hljs">mkdir master buildbot create-master master <span class="hljs-comment"><span class="hljs-comment">#    </span></span></code> </pre> <br><a name="createworker"></a>  La prochaine √©tape.  Cr√©ez un <b>travailleur</b> .  Nous l'aurons dans le dossier <i>/ home / habr / worker</i> . <br><pre> <code class="bash hljs">mkdir worker buildbot-worker create-worker --<span class="hljs-built_in"><span class="hljs-built_in">umask</span></span>=0o22 --keepalive=60 worker localhost:4000 yourWorkerName password</code> </pre><br>  Lorsque vous d√©marrez <b>Worker</b> , par d√©faut, il cr√©e un dossier dans <i>/ home / habr / worker</i> avec le nom du projet, qui est sp√©cifi√© dans <i>master.cfg</i> .  Et dans le dossier avec le nom du projet, il cr√©era le r√©pertoire de <i>construction</i> , puis la <i>v√©rification</i> y sera effectu√©e.  Le r√©pertoire de travail de <b>Worker</b> sera le r√©pertoire <i>/ home / habr / yourProject / build</i> . <br><br>  <b>Cl√© d'or</b> <br>  Et maintenant, pour ce que j'ai √©crit le paragraphe pr√©c√©dent: le script que <b>Master</b> exigera que <b>Worker</b> fasse √† distance dans ce r√©pertoire ne sera pas ex√©cut√©, car le script n'a pas la permission de s'ex√©cuter.  Pour corriger la situation, vous avez besoin d'une cl√© <a name="umask"></a>  <i>--umask = 0o22</i> , ce qui interdit d'√©crire dans ce r√©pertoire, mais laisse les droits de d√©marrage.  Et nous en avons seulement besoin. <br><br>  <b>BuildMaster</b> et <b>Worker</b> √©tablissent une connexion entre eux.  Il arrive qu'il se casse et <b>Worker</b> attend une r√©ponse de <b>BuildMaster</b> pendant un certain temps.  Si aucune r√©ponse n'est re√ßue, la connexion est red√©marr√©e.  La cl√© <b>--keepalive = 60</b> est exactement ce dont vous avez besoin pour indiquer le temps apr√®s lequel la <i>connexion</i> red√©marre. <br><br><a name="Recept"></a><h3>  5. Configuration.  Recette √©tape par √©tape </h3><hr><br>  <b>La</b> configuration de <b>BuildMaster</b> se fait c√¥t√© machine, o√π nous avons ex√©cut√© la commande <i>create-master</i> .  Dans notre cas, il s'agit du r√©pertoire <i>/ home / habr / master</i> .  Le <i>fichier de</i> configuration <i>master.cfg n'existe</i> pas encore, mais la commande elle-m√™me a d√©j√† cr√©√© le <i>fichier master.cmg.sample</i> .  Vous devez le renommer dans <i>master.cfg.sample</i> en <i>master.cfg</i> <br><pre> <code class="bash hljs">mv master.cfg.sample master.cfg</code> </pre> <br>  <i>Ouvrons</i> ce <i>master.cfg</i> .  Et nous analyserons en quoi il consiste.  Et apr√®s cela, nous essaierons de cr√©er notre propre fichier de configuration. <br><br><div class="spoiler">  <b class="spoiler_title">master.cfg</b> <div class="spoiler_text"><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( <span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'gitpoller-workdir'</span></span>, branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>, pollInterval=<span class="hljs-number"><span class="hljs-number">300</span></span>)) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"all"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>), treeStableTimer=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.ForceScheduler( name=<span class="hljs-string"><span class="hljs-string">"force"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) factory = util.BuildFactory() factory.addStep(steps.Git(repourl=<span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'incremental'</span></span>)) factory.addStep(steps.ShellCommand(command=[<span class="hljs-string"><span class="hljs-string">"trial"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>], env={<span class="hljs-string"><span class="hljs-string">"PYTHONPATH"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>})) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append( util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>], factory=factory)) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = <span class="hljs-string"><span class="hljs-string">"Hello World CI"</span></span> c[<span class="hljs-string"><span class="hljs-string">'titleURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"https://buildbot.github.io/hello-world/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'buildbotURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://localhost:8010/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>] = dict(port=<span class="hljs-number"><span class="hljs-number">8010</span></span>, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c[<span class="hljs-string"><span class="hljs-string">'db'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'db_url'</span></span> : <span class="hljs-string"><span class="hljs-string">"sqlite:///state.sqlite"</span></span>, }</code> </pre><br></div></div><br><a name="BC"></a><h4>  <u>5.1 BuildmasterConfig</u> </h4><br><pre> <code class="python hljs">c = BuildmasterConfig = {}</code> </pre> <br>  <i>BuildmasterConfig</i> - le dictionnaire de base du fichier de configuration.  Il doit √™tre impliqu√© dans le fichier de configuration.  Pour plus de facilit√© d'utilisation, son alias <i>"c"</i> est saisi dans le code de configuration.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les</a> noms de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cl√©s</a> dans <i>c ["keyFromDist"]</i> sont des √©l√©ments fixes pour interagir avec <b>BuildMaster</b> .  Sous chaque cl√©, l'objet correspondant est substitu√© en tant que valeur. <br><br><a name="Worker"></a><h4>  <u>5.2 travailleurs</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [worker.Worker(<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>, <span class="hljs-string"><span class="hljs-string">"pass"</span></span>)]</code> </pre> <br>  Cette fois, nous <b>signalons la</b> liste <b>BuildMaster</b> des <b>travailleurs</b> .  Nous avons cr√©√© <b>Worker</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ci-dessus</a> en sp√©cifiant <i>votre nom de travailleur</i> et votre <i>mot de passe</i> .  Maintenant, ils doivent √™tre sp√©cifi√©s au lieu d' <i>exemple-travailleur</i> et <i>passer</i> . <br><br><a name="CS"></a><h4>  <u>5.3 change_source</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>].append(changes.GitPoller( <span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, workdir=<span class="hljs-string"><span class="hljs-string">'gitpoller-workdir'</span></span>, branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>, pollInterval=<span class="hljs-number"><span class="hljs-number">300</span></span>))</code> </pre><br>  <i>En utilisant la</i> cl√© <i>change_source</i> du dictionnaire <i>c</i> , nous avons acc√®s √† la liste o√π vous souhaitez placer l'objet qui interroge le r√©f√©rentiel avec le code source du projet.  L'exemple utilise le r√©f√©rentiel Git, qui est interrog√© √† une certaine p√©riodicit√©. <br><br>  Le premier argument est le chemin d'acc√®s √† votre r√©f√©rentiel. <br><br>  <i>workdir</i> est le chemin d'acc√®s au dossier o√π, <b>du</b> c√¥t√© <b>du travailleur</b> , par rapport au chemin <i>/ home / habr / worker / yourProject / build,</i> git stockera la version locale du r√©f√©rentiel. <br><br>  <i>branche</i> contient une branche sp√©cifique dans le r√©f√©rentiel qui doit √™tre surveill√©e. <br><br>  <i>pollInterval</i> contient le nombre de secondes apr√®s lesquelles <b>BuildMaster</b> interrogera le r√©f√©rentiel pour les modifications. <br><br>  Il existe plusieurs m√©thodes pour suivre les modifications dans un r√©f√©rentiel de projet. <br><br>  La m√©thode la plus simple est <i>Polling</i> , ce qui implique que <b>BuildMaster</b> interroge p√©riodiquement le serveur avec le r√©f√©rentiel.  Si <i>commit</i> refl√©tait les changements dans le r√©f√©rentiel, alors <b>BuildMaster</b> cr√©era un certain d√©lai un objet <i>Change</i> interne et l'enverra au gestionnaire d'√©v√©nements du <i>planificateur</i> , qui lancera les √©tapes de g√©n√©ration et de test du projet sur <i>Worker</i> .  Parmi ces √©tapes, la <i>mise √† jour du</i> r√©f√©rentiel sera indiqu√©e.  C'est sur <b>Worker qu'une</b> copie locale du r√©f√©rentiel sera cr√©√©e.  Les d√©tails de ce processus seront divulgu√©s ci-dessous dans les deux sections suivantes <b>( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.4</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">5.5</a> )</b> . <br><br>  Une m√©thode encore plus √©l√©gante de suivi des modifications dans le r√©f√©rentiel consiste √† envoyer des messages directement depuis le serveur sur lequel il se trouve √† <b>BuildMaster</b> concernant la modification des codes source du projet.  Dans ce cas, d√®s que le d√©veloppeur effectue une <i>validation</i> , le serveur avec le r√©f√©rentiel de projet enverra un message √† <b>BuildMaster</b> .  Et cela, √† son tour, sera intercept√© en cr√©ant un objet <i>PBChangeSource</i> .  De plus, cet objet sera transf√©r√© √† <i>Scheduler</i> , qui activera les √©tapes de construction du projet et ses tests.  Une partie importante de cette m√©thode consiste √† travailler avec des scripts de <i>hook de</i> serveur dans le r√©f√©rentiel.  Dans le script de <i>raccordement</i> responsable de la gestion des actions lors de la <i>validation</i> , vous devez appeler l'utilitaire <i>sendchange</i> et sp√©cifier l'adresse r√©seau de <b>BuildMaster</b> .  Vous devez <i>sp√©cifier le</i> port r√©seau qui √©coutera <i>PBChangeSource</i> .  <i>Soit dit</i> en passant, <b>PBChangeSource</b> fait partie de <b>BuildMaster</b> .  Cette m√©thode n√©cessite le privil√®ge <i>admin</i> -a sur le serveur o√π se trouve le r√©f√©rentiel de projet.  Vous devez d'abord cr√©er un r√©f√©rentiel de sauvegarde. <br><br><a name="shedulers"></a><h4>  <u>5.4 d√©chiqueteurs</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"all"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-string"><span class="hljs-string">'master'</span></span>), treeStableTimer=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>])) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>].append(schedulers.ForceScheduler( name=<span class="hljs-string"><span class="hljs-string">"force"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>]))</code> </pre><br>  <i>Les ordonnanceurs</i> sont un √©l√©ment qui agit comme un d√©clencheur qui ex√©cute l'ensemble de la cha√Æne d'assemblage et de test d'un projet. <br><img src="https://habrastorage.org/webt/sh/1j/jo/sh1jjoo3rog47fsyjgqgorizyfs.png" alt="Decicheteurs buildbot"><br><br>  Ces modifications qui ont √©t√© enregistr√©es par <i>change_source</i> ont √©t√© converties pendant le fonctionnement de <b>BuildBot</b> -a en l'objet <i>Change</i> et maintenant chaque <i>Sheduler en</i> fonction d'eux cr√©e des demandes pour d√©marrer le processus de g√©n√©ration de projet.  Cependant, il d√©termine √©galement quand envoyer ces demandes √† la file d'attente.  Objet <a name="builder"></a>  <i>Le g√©n√©rateur</i> conserve une file d'attente de demandes et surveille le statut de l'assembly actuel sur un <b>Worker</b> -e distinct.  <i>Le</i> <b>g√©n√©rateur</b> existe sur <b>BuildMaster</b> -e et <b>Worker</b> -e.  Il envoie une <i>build</i> sp√©cifique de <b>BuildMaster</b> √† <b>Worker</b> , une s√©rie d'√©tapes qui doivent √™tre suivies. <br>  Nous voyons que dans l'exemple actuel de tels <i>ordonnanceurs</i> , 2 pi√®ces sont cr√©√©es.  De plus, chacun a son propre type. <br><br>  <i>SingleBranchScheduler</i> est l'une des classes d'horaires les plus populaires.  Il surveille une branche et est d√©clench√© par un changement enregistr√© dans celle-ci.  Lorsqu'il voit les modifications, il peut reporter l'envoi d'une demande de construction (reporter pour la p√©riode sp√©cifi√©e dans le param√®tre sp√©cial <i>treeStableTimer</i> ).  Le <i>nom</i> sp√©cifie le nom de la planification qui sera affich√©e dans l'interface <b>BuildBot</b> -web.  Un <i>filtre</i> est d√©fini dans <i>ChangeFilter</i> , apr√®s avoir travers√© les modifications de la branche qui invitent la planification √† envoyer une demande de g√©n√©ration.  Le nom <i>builder</i> -a est sp√©cifi√© dans <i>builderNames</i> , que nous pr√©ciserons un peu plus tard.  Le nom dans notre cas sera le m√™me que le nom du projet: <i>yourProject</i> . <br><br>  <i>ForceScheduler est une</i> chose tr√®s simple.  Ce type de planification est d√©clench√© par un clic de souris via l'interface <b>BuildBot</b> -web.  Les param√®tres ont la m√™me essence que dans <i>SingleBranchScheduler</i> . <br><br>  <b>PS n ¬∞ 3.</b>  <b>Soudainement utile</b> <br>  <i>P√©riodique</i> est un programme qui est d√©clench√© √† une fr√©quence fixe dans le temps.  Cela ressemble √† un appel comme celui-ci <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> schedulers nightly = schedulers.Periodic(name=<span class="hljs-string"><span class="hljs-string">"daily"</span></span>, builderNames=[<span class="hljs-string"><span class="hljs-string">"full-solaris"</span></span>], periodicBuildTimer=<span class="hljs-number"><span class="hljs-number">24</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>*<span class="hljs-number"><span class="hljs-number">60</span></span>) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [nightly]</code> </pre><br><a name="buildfactory"></a><h4>  <u>5.5 BuildFactory</u> </h4><br><pre> <code class="python hljs">factory = util.BuildFactory() factory.addStep(steps.Git(repourl=<span class="hljs-string"><span class="hljs-string">'git://github.com/buildbot/hello-world.git'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'incremental'</span></span>)) factory.addStep(steps.ShellCommand(command=[<span class="hljs-string"><span class="hljs-string">"trial"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello"</span></span>], env={<span class="hljs-string"><span class="hljs-string">"PYTHONPATH"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>}))</code> </pre><br>  <i>periodicalBuildTimer</i> d√©finit le temps de cette p√©riodicit√© en secondes. <br><br>  <i>BuildFactory</i> cr√©e une <i>construction en</i> b√©ton, que le <i>g√©n√©rateur</i> envoie ensuite au <b>Worker</b> .  <i>BuildFactory</i> indique les √©tapes qu'un <b>Worker</b> doit suivre.  Les √©tapes sont ajout√©es en appelant la m√©thode <i>addStep.</i> <i><br></i> <br><br>  La premi√®re √©tape ajout√©e dans cet exemple est <i>git clean -d -f -f ‚Äìx</i> , puis <i>git checkout</i> .  Ces actions sont int√©gr√©es dans le param√®tre de <i>m√©thode</i> , qui n'est pas clairement indiqu√©, mais implique la valeur par d√©faut de <i>fresh</i> .  Le param√®tre <i>mode = 'incremental'</i> indique que les fichiers du r√©pertoire o√π <i>s'effectue</i> le <i>chechout, bien qu'ils</i> soient absents du r√©f√©rentiel, restent intacts. <br><br>  La deuxi√®me √©tape ajout√©e consiste √† appeler le script d' <i>essai</i> avec le param√®tre <i>hello</i> du c√¥t√© <b>Worker</b> depuis le r√©pertoire <i>/ home / habr / worker / yourProject / build</i> avec la variable d'environnement PATHONPATH = ... Vous pouvez donc √©crire vos propres scripts et les ex√©cuter du c√¥t√© <b>Worker</b> -a via l'√©tape <i>util.ShellCommand</i> .  Ces scripts peuvent √™tre plac√©s directement dans le r√©f√©rentiel.  Ensuite, pendant le <i>chechout,</i> ils iront dans <i>/ home / habr / worker / yourProject / build</i> .  Cependant, il y a ensuite deux ¬´mais¬ª: <br><ol><li>  <b>Le travailleur</b> doit √™tre cr√©√© avec le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>commutateur --umask</i></a> afin qu'il ne bloque pas les droits d'ex√©cution apr√®s l' <i>extraction</i> -a. </li><li>  Lorsque <i>git envoie</i> ces scripts, il est n√©cessaire de sp√©cifier la propri√©t√© <i>exacutable</i> , afin qu'avec <i>chechout</i> -e Git ne perde pas le droit d'ex√©cuter le script. </li></ol><br><br><a name="builders"></a><h4>  <u>5.6 constructeurs</u> </h4><br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"runtests"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"example-worker"</span></span>], factory=factory))</code> </pre><br>  √Ä propos de ce que <i>Builder a</i> √©t√© d√©crit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Je vais maintenant parler plus en d√©tail de la fa√ßon de le cr√©er.  <i>BuilderConfig</i> est un constructeur <i>constructeur</i> .  Vous pouvez sp√©cifier plusieurs de ces constructeurs dans <i>c ['constructeurs']</i> , car il s'agit d'une liste d'objets de type <i>constructeur</i> .  Nous allons maintenant r√©√©crire l√©g√®rement l'exemple de <b>BuildBot</b> , en le rapprochant de notre t√¢che. <br><pre> <code class="python hljs">c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [] c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>].append(util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>, workernames=[<span class="hljs-string"><span class="hljs-string">"yourWorkerName"</span></span>], factory=factory))</code> </pre><br>  Je vais maintenant parler des param√®tres <i>BuilderConfig</i> . <br><br>  <i>nom</i> d√©finit le <i>constructeur de</i> noms -a.  Ici, nous l'avons appel√© votre <i>projet</i> .  Cela signifie que sur le <b>Worker,</b> ce chemin <i>/ home / habr / worker / yourProject / build</i> sera cr√©√©.  <i>Sheduler</i> recherche un <i>constructeur</i> par ce nom. <br><br>  <i>workernames</i> contient une liste de <b>Workers</b> .  Dont chacun doit √™tre ajout√© √† <i>c [¬´travailleurs¬ª]</i> . <br><br>  <i>factory</i> est le <i>build</i> sp√©cifique auquel le <i>constructeur est</i> associ√©.  Il enverra un objet de <i>g√©n√©ration</i> √† <b>Worker</b> pour terminer toutes les √©tapes qui composent cette <i>g√©n√©ration</i> -a. <br><br><a name="myconfig"></a><h3>  6. Exemple de configuration propre </h3><hr><br>  Voici l'architecture d'un exemple de projet que je propose de mettre en ≈ìuvre via <b>BuildBot</b> <b><br></b>  . <br><br>  Nous utiliserons <i>svn</i> comme syst√®me de contr√¥le de version.  Le r√©f√©rentiel lui-m√™me sera dans un certain cloud.  Voici l'adresse de ce cloud <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">svn.host/svn/yourProject/trunk</a></i> .  Dans le cloud sous <i>svn,</i> il y a un nom d'utilisateur: <i>utilisateur</i> , passwd: <i>mot de passe</i> .  Les scripts qui constituent les √©tapes de <i>build</i> -a se trouvent √©galement dans la branche <i>svn</i> , dans un <i>dossier buildbot / worker_linux distinct</i> .  Ces scripts sont dans le r√©f√©rentiel avec la propri√©t√© <i>ex√©cutable</i> enregistr√©e. <br><br>  <b>BuildMaster</b> et <b>Worker</b> fonctionnent sur le m√™me h√¥te <i>project.host</i> .  <b>BuildMaster</b> stocke ses fichiers dans le dossier <i>/ home / habr / master</i> .  <b>Worker</b> stocke le chemin suivant <i>/ home / habr / worker</i> .  La communication entre les processus <b>BuildMaster</b> et <b>Worker</b> <b>s'effectue</b> via le port 4000 √† l'aide du protocole <b>BuildBot</b> -a, c'est-√†-dire le protocole <i>¬´pb¬ª</i> . <br><br>  Le projet cible est enti√®rement √©crit en python.  La t√¢che consiste √† suivre ses modifications, √† cr√©er un fichier ex√©cutable, √† g√©n√©rer de la documentation et √† effectuer des tests.  En cas d'√©chec, tous les d√©veloppeurs doivent envoyer un message au courrier √©lectronique indiquant qu'une action a √©chou√©. <br><br>  Nous allons connecter la cartographie Web <b>BuildBot</b> au port 80 pour <i>project.host</i> .  Apatch est facultatif.  La biblioth√®que <i>torsad√©e</i> poss√®de d√©j√† un serveur Web, <b>BuildBot l'</b> utilise. <br><br>  <b>Nous</b> utiliserons <i>sqlite</i> pour stocker des informations internes pour <b>BuildBot</b> . <br><br>  Pour l'envoi, vous avez besoin de l'h√¥te <i>smtp.your.domain</i> - il permet d'envoyer des e-mails depuis <i>projectHost@your.domain</i> sans authentification.  √âgalement sur l'h√¥te ¬´ <i>smtp</i> ¬ª, le protocole est √©cout√© √† 1025. <br><br>  Il y a deux personnes impliqu√©es dans le processus: l' <i>administrateur</i> et l' <i>utilisateur</i> .  admin administre <b>BuildBot</b> .  utilisateur est la personne qui commet la <i>validation</i> . <br><br>  Un fichier exacutable est g√©n√©r√© via <i>pyinstaller</i> .  La documentation est g√©n√©r√©e via <i>doxygen</i> . <br><br>  Pour cette architecture, j'ai √©crit ce <i>master.cfg</i> : <br><br><div class="spoiler">  <b class="spoiler_title">master.cfg</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, re <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> buildbot.plugins <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> steps, util, schedulers, worker, changes, reporters c= BuildmasterConfig ={} c[<span class="hljs-string"><span class="hljs-string">'workers'</span></span>] = [ worker.Worker(<span class="hljs-string"><span class="hljs-string">'yourWorkerName'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>) ] c[<span class="hljs-string"><span class="hljs-string">'protocols'</span></span>] = {<span class="hljs-string"><span class="hljs-string">'pb'</span></span>: {<span class="hljs-string"><span class="hljs-string">'port'</span></span>: <span class="hljs-number"><span class="hljs-number">4000</span></span>}} svn_poller = changes.SVNPoller(repourl=<span class="hljs-string"><span class="hljs-string">"https://svn.host/svn/yourProject/trunk"</span></span>, svnuser=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, svnpasswd=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, pollinterval=<span class="hljs-number"><span class="hljs-number">60</span></span>, split_file=util.svn.split_file_alwaystrunk ) c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = svn_poller hourlyscheduler = schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"your-project-schedulers"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), builderNames=[<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>], properties = {<span class="hljs-string"><span class="hljs-string">'owner'</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>} ) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [hourlyscheduler] checkout = steps.SVN(repourl=<span class="hljs-string"><span class="hljs-string">'https://svn.host/svn/yourProject/trunk'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, method=<span class="hljs-string"><span class="hljs-string">'fresh'</span></span>, username=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, haltOnFailure=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) projectHost_build = util.BuildFactory() cleanProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Clean"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/pyinstaller_project"</span></span>, <span class="hljs-string"><span class="hljs-string">"clean"</span></span>] ) buildProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Build"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/pyinstaller_project"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>] ) doxyProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Update Docs"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"buildbot/worker_linux/gendoc"</span></span>, []] ) testProject = steps.ShellCommand(name=<span class="hljs-string"><span class="hljs-string">"Tests"</span></span>, command=[<span class="hljs-string"><span class="hljs-string">"python"</span></span>,<span class="hljs-string"><span class="hljs-string">"tests/utest.py"</span></span>], env={<span class="hljs-string"><span class="hljs-string">'PYTHONPATH'</span></span>: <span class="hljs-string"><span class="hljs-string">'.'</span></span>} ) projectHost_build.addStep(checkout) projectHost_build.addStep(cleanProject) projectHost_build.addStep(buildProject) projectHost_build.addStep(doxyProject) projectHost_build.addStep(testProject) c[<span class="hljs-string"><span class="hljs-string">'builders'</span></span>] = [ util.BuilderConfig(name=<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>, workername=<span class="hljs-string"><span class="hljs-string">'yourWorkerName'</span></span>, factory=projectHost_build) ] template_html=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;  : {{ summary }}&lt;/h4&gt; &lt;p&gt;   : {{ workername }}&lt;/p&gt; &lt;p&gt;: {{ projects }}&lt;/p&gt; &lt;p&gt;         : {{ buildbot_url }}&lt;/p&gt; &lt;p&gt;         : {{ build_url }}&lt;/p&gt; &lt;p&gt; WinSCP     c ip:xxx.xx.xxx.xx.   habr/password,   executable    ~/worker/yourProject/build/dist.&lt;/p&gt; &lt;p&gt;&lt;b&gt;    Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> sendMessageToAll = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"projectHost@your.domain"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, lookup=<span class="hljs-string"><span class="hljs-string">"your.domain"</span></span>, relayhost=<span class="hljs-string"><span class="hljs-string">"smtp.your.domain"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">1025</span></span>, mode=<span class="hljs-string"><span class="hljs-string">"warnings"</span></span>, extraRecipients=[<span class="hljs-string"><span class="hljs-string">'user@your.domain'</span></span>], messageFormatter=reporters.MessageFormatter( template=template_html, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [sendMessageToAll] c[<span class="hljs-string"><span class="hljs-string">'title'</span></span>] = <span class="hljs-string"><span class="hljs-string">"The process of bulding"</span></span> c[<span class="hljs-string"><span class="hljs-string">'titleURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://project.host:80/"</span></span> c[<span class="hljs-string"><span class="hljs-string">'buildbotURL'</span></span>] = <span class="hljs-string"><span class="hljs-string">"http://project.host"</span></span> c[<span class="hljs-string"><span class="hljs-string">'www'</span></span>] = dict(port=<span class="hljs-number"><span class="hljs-number">80</span></span>, plugins=dict(waterfall_view={}, console_view={}, grid_view={})) c[<span class="hljs-string"><span class="hljs-string">'db'</span></span>] = { <span class="hljs-string"><span class="hljs-string">'db_url'</span></span> : <span class="hljs-string"><span class="hljs-string">"sqlite:///state.sqlite"</span></span> }</code> </pre><br></div></div><br>  Vous devez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'abord cr√©er</a> <b>BuildMaster</b> et <b>Worker</b> -a.  <i>Collez</i> ensuite ce <i>fichier master.cfg</i> dans <i>/ home / habr / master</i> . <br><br>  L'√©tape suivante consiste √† d√©marrer le service <b>BuildMaster</b> <br><pre> <code class="bash hljs">sudo buildbot start /home/habr/master</code> </pre><br>  Ensuite, d√©marrez le service <b>Worker</b> -a <br><pre> <code class="bash hljs">buildbot-worker start /home/habr/worker</code> </pre><br>  C'est fait!  Maintenant, <b>Buildbot</b> suivra les modifications et <b>s'ex√©cutera</b> lors de la <i>validation</i> dans <i>svn</i> , en suivant les √©tapes de construction et de test du projet avec l'architecture ci-dessus. <br><br>  Ci-dessous, je d√©crirai quelques fonctionnalit√©s du <i>master.cfg</i> ci-dessus <i>.</i> <i><br></i> <br><br><a name="fails"></a><h4>  <u>6.1 En route vers votre master.cfg</u> </h4><br>  Lors de l'√©criture de votre <i>master.cfg, de</i> nombreuses erreurs seront commises, vous devrez donc lire le fichier journal.  Il est stock√© √† la fois sur le chemin absolu <b>BuildMaster</b> -ec <i>/home/habr/master/twistd.log</i> et sur le c√¥t√© <b>Worker</b> -a avec le chemin absolu <i>/home/habr/worker/twistd.log</i> .  Lorsque vous lisez l'erreur et la <b>corrigez</b> , vous devrez red√©marrer le service <b>BuildMaster</b> -a.  Voici comment proc√©der: <br><pre> <code class="bash hljs">sudo buildbot stop /home/habr/master sudo buildbot upgrade-master /home/habr/master sudo buildbot start /home/habr/master</code> </pre><br><a name="svn"></a><h4>  <u>6.2 Travailler avec svn</u> </h4><br><pre> <code class="python hljs">svn_poller = changes.SVNPoller(repourl=<span class="hljs-string"><span class="hljs-string">"https://svn.host/svn/yourProject/trunk"</span></span>, svnuser=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, svnpasswd=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, pollinterval=<span class="hljs-number"><span class="hljs-number">60</span></span>, split_file=util.svn.split_file_alwaystrunk ) c[<span class="hljs-string"><span class="hljs-string">'change_source'</span></span>] = svn_poller hourlyscheduler = schedulers.SingleBranchScheduler( name=<span class="hljs-string"><span class="hljs-string">"your-project-schedulers"</span></span>, change_filter=util.ChangeFilter(branch=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>), builderNames=[<span class="hljs-string"><span class="hljs-string">"yourProject"</span></span>], properties = {<span class="hljs-string"><span class="hljs-string">'owner'</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>} ) c[<span class="hljs-string"><span class="hljs-string">'schedulers'</span></span>] = [hourlyscheduler] checkout = steps.SVN(repourl=<span class="hljs-string"><span class="hljs-string">'https://svn.host/svn/yourProject/trunk'</span></span>, mode=<span class="hljs-string"><span class="hljs-string">'full'</span></span>, method=<span class="hljs-string"><span class="hljs-string">'fresh'</span></span>, username=<span class="hljs-string"><span class="hljs-string">"user"</span></span>, password=<span class="hljs-string"><span class="hljs-string">"password"</span></span>, haltOnFailure=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br>  Tout d'abord, jetez un ≈ìil √† <i>svn_poller</i> .  Il s'agit de la m√™me interface qui interroge r√©guli√®rement le r√©f√©rentiel une fois par minute.  Dans ce cas, <i>svn_poller</i> acc√®de uniquement √† la branche du <i>tronc</i> .  Le myst√©rieux param√®tre <i>split_file = util.svn.split_file_alwaystrunk</i> d√©finit les r√®gles: comment diviser la structure des dossiers <i>svn</i> en branches.  Il leur propose des moyens relatifs.  √Ä son tour, <i>split_file_alwaystrunk</i> simplifie le processus en disant que seul le <i>tronc est</i> dans le r√©f√©rentiel. <br><br>  Dans <i>Schedulers</i> , <i>ChangeFilter</i> est <i>sp√©cifi√©</i> , qui voit <i>None</i> et associe la branche de <i>jonction</i> avec elle en fonction de l'association sp√©cifi√©e via <i>split_file_alwaystrunk</i> .  R√©pondant aux modifications du <i>tronc</i> , il d√©marre le <i>g√©n√©rateur</i> nomm√© <i>yourProject</i> . <br><br>  <i>Les propri√©t√©s</i> ici sont n√©cessaires pour que l'administrateur re√ßoive la newsletter de l'assembly et teste les r√©sultats en tant que propri√©taire du processus. <br><br>  L'√©tape de <i>v√©rification de</i> <i>build</i> -a est capable de supprimer compl√®tement tous les fichiers qui se trouvent dans la version locale du r√©f√©rentiel <b>Worker</b> .  Faites ensuite la <i>mise √† jour svn</i> compl√®te.  Le mode est configur√© via le param√®tre <i>mode = full</i> , <i>method = fresh</i> .  Le param√®tre <i>haltOnTailure</i> indique que si la <i>mise √† jour svn</i> <i>√©choue</i> , l'ensemble du processus d'assemblage et de test doit √™tre suspendu, car les √©tapes ult√©rieures n'ont aucun sens. <br><br><a name="reporter"></a><h4>  <u>6.3 Une lettre √† vous: les journalistes sont autoris√©s √† d√©clarer</u> </h4><br>  <i>reporters</i> est un service de notification par courrier. <br><pre> <code class="python hljs">template_html=<span class="hljs-string"><span class="hljs-string">u'''\ &lt;h4&gt;  : {{ summary }}&lt;/h4&gt; &lt;p&gt;   : {{ workername }}&lt;/p&gt; &lt;p&gt;: {{ projects }}&lt;/p&gt; &lt;p&gt;         : {{ buildbot_url }}&lt;/p&gt; &lt;p&gt;         : {{ build_url }}&lt;/p&gt; &lt;p&gt; WinSCP     c ip:xxx.xx.xxx.xx.   habr/password,   executable    ~/worker/yourProject/build/dist.&lt;/p&gt; &lt;p&gt;&lt;b&gt;    Buildbot&lt;/b&gt;&lt;/p&gt; '''</span></span> sendMessageToAll = reporters.MailNotifier(fromaddr=<span class="hljs-string"><span class="hljs-string">"projectHost@your.domain"</span></span>, sendToInterestedUsers=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, lookup=<span class="hljs-string"><span class="hljs-string">"your.domain"</span></span>, relayhost=<span class="hljs-string"><span class="hljs-string">"smtp.your.domain"</span></span>, smtpPort=<span class="hljs-number"><span class="hljs-number">1025</span></span>, mode=<span class="hljs-string"><span class="hljs-string">"warnings"</span></span>, extraRecipients=[<span class="hljs-string"><span class="hljs-string">'user@your.domain'</span></span>], messageFormatter=reporters.MessageFormatter( template=template_html, template_type=<span class="hljs-string"><span class="hljs-string">'html'</span></span>, wantProperties=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, wantSteps=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) ) c[<span class="hljs-string"><span class="hljs-string">'services'</span></span>] = [sendMessageToAll]</code> </pre><br>  Il peut envoyer des messages de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plusieurs mani√®res</a> . <br><br>  <i>MailNotifier</i> utilise le courrier √©lectronique pour envoyer des notifications. <br><br>  <i>template_html</i> d√©finit le mod√®le de texte pour la newsletter.  Pour cr√©er un balisage, utilisez html.  Il est modifi√© par le moteur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><i>jinja2</i></a> (peut √™tre compar√© √† <i>django</i> ).  <b>BuildBot</b> a un ensemble de variables, dont les valeurs sont substitu√©es dans le mod√®le dans le processus de formation du texte du message.  Ces variables sont inscrites entre {{accolades doubles}}.  Ainsi, par exemple, le <i>r√©sum√©</i> affiche l'√©tat des op√©rations termin√©es, c'est-√†-dire le succ√®s ou l'√©chec.  Et les <i>projets</i> <i>g√©n√©reront votre projet</i> .  Ainsi, en utilisant les commandes de contr√¥le dans <i>jinja2</i> , les variables <i>BuildBot</i> et les formateurs de cha√Ænes python, vous pouvez cr√©er un message tr√®s informatif. <br><br>  <i>MailNotifier</i> contient les arguments suivants. <br><br>  <i>fromaddr</i> - l'adresse √† partir de laquelle tout le monde recevra la newsletter. <br><br>  <i>sendToInterestedUsers</i> = True envoie un message au propri√©taire et √† l'utilisateur qui ont effectu√© la <i>validation</i> . <br><br>  <i>recherche</i> - suffixe √† ajouter aux noms des utilisateurs recevant la newsletter.  L' <i>administrateur en</i> tant qu'utilisateur recevra donc la newsletter √† admin@your.domain. <br><br>  <i>relayhost</i> sp√©cifie le nom d'h√¥te sur lequel le serveur <i>smtp</i> est ouvert et <i>smptPort</i> sp√©cifie le num√©ro de port sur lequel le serveur <i>smtp</i> √©coute. <br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mode = ¬´warning¬ª</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> indique que l'envoi ne doit √™tre effectu√© que s'il y a au moins une √©tape de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g√©n√©ration</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> qui s'est termin√©e avec un √©tat d'√©chec ou d'avertissement. En cas de succ√®s, l'envoi n'est pas obligatoire. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">extraRecipients</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contient une liste de personnes √† qui le mailing doit √™tre fait en plus du propri√©taire et de la personne qui a effectu√© la </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">validation</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">messageFormatter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est un objet qui d√©finit le format du message, son mod√®le et l'ensemble de variables disponibles √† partir de </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jinja2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Des param√®tres tels que </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wantProperties = True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> et </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wantSteps = True</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sp√©cifient cet ensemble de variables disponibles. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with ['services'] = [sendMessageToAll]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fournit une liste de services, parmi lesquels nos</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">journaliste</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><a name="goodboy"></a><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous l'avons fait! </font><font style="vertical-align: inherit;">Mes f√©licitations</font></font></h3><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons cr√©√© notre propre configuration et vu les fonctionnalit√©s dont </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildBot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> est </font><b><font style="vertical-align: inherit;">capable</font></b><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Je pense que cela suffit pour comprendre si cet outil est n√©cessaire pour cr√©er votre projet. </font><font style="vertical-align: inherit;">Est-ce qu'il vous int√©resse? </font><font style="vertical-align: inherit;">Cela vous sera-t-il utile? </font><font style="vertical-align: inherit;">Est-il pratique de travailler avec? </font><font style="vertical-align: inherit;">Ensuite, j'√©cris cet article pour une bonne raison.</font></font><br><br>  Et encore une chose.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'aimerais que la communaut√© professionnelle utilisant </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BuildBot</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> devienne plus large, des manuels traduits et plus d'exemples.</font></font><br><br>  Merci √† tous pour votre attention.  Bonne chance </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr460501/">https://habr.com/ru/post/fr460501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr460491/index.html">Capteur de temp√©rature et d'humidit√© Arduino avec envoi et tra√ßage (partie 1)</a></li>
<li><a href="../fr460493/index.html">¬´Killer apps¬ª pour PC des ann√©es 80: VisiCalc et WordStar</a></li>
<li><a href="../fr460495/index.html">Container-to-pipeline: CRI-O est d√©sormais la valeur par d√©faut dans OpenShift Container Platform 4</a></li>
<li><a href="../fr460497/index.html">Utilisation intuitive des m√©thodes de Monte Carlo avec les cha√Ænes de Markov</a></li>
<li><a href="../fr460499/index.html">Trois laur√©ats du prix Dijkstra: comment Hydra 2019 et SPTDC 2019 se sont-ils d√©roul√©s?</a></li>
<li><a href="../fr460503/index.html">Configuration sans fil du Raspberry PI 3 B +</a></li>
<li><a href="../fr460505/index.html">Attirer trois croix, ou pourquoi les projets sont si difficiles √† terminer √† temps</a></li>
<li><a href="../fr460509/index.html">Comment les mandataires r√©sidents aident-ils dans les affaires: un cas r√©el d'utilisation d'Infatica dans l'exploration de donn√©es</a></li>
<li><a href="../fr460511/index.html">R√©glage PHP-FPM: utilisation de pm statique pour des performances maximales</a></li>
<li><a href="../fr460513/index.html">Flutter 1.7 - Quoi de neuf dans la version du 10 juillet 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>