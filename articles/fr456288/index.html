<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üò£ üëΩ üë®üèº‚Äç‚úàÔ∏è MAM: assemblage frontal sans douleur üíé üíÄ üå¶Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je m'appelle Dmitry Karlovsky et j'adore MAM. M AM gouverne les modules Gnostic M , me faisant ainsi gagner la part du lion de la routine. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>MAM: assemblage frontal sans douleur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456288/"><p>  Bonjour, je m'appelle Dmitry Karlovsky et j'adore MAM.  <strong>M</strong> AM gouverne les modules Gnostic <strong>M</strong> , me faisant ainsi gagner la part du lion de la routine. </p><br><p><img src="https://habrastorage.org/webt/m2/5h/ps/m25hpsfevki-o6lwx4v_ukfxvtu.png" alt="Module agnostique typique"></p><br><p> <strong>Un module agnostique</strong> , contrairement au <strong>module</strong> traditionnel, n'est pas un fichier avec une source, mais un r√©pertoire dans lequel il peut y avoir des sources dans diff√©rents langages: logique de programme en <code>JS</code> / <code>TS</code> , tests pour celui-ci en <code>TS</code> / <code>JS</code> , composition des composants dans <code>view.tree</code> , styles en <code>CSS</code> , localisation en <code>locale=*.json</code> , images, etc., etc.  Si vous le souhaitez, il n‚Äôest pas difficile d‚Äôobtenir le support d‚Äôune autre langue.  Par exemple, Stylus pour √©crire des styles ou HTML pour d√©crire des mod√®les. </p><br><p>  Les d√©pendances entre les modules sont suivies automatiquement en analysant la source.  Si le module est activ√©, il est activ√© dans son ensemble - chaque code source du module est transpos√© et tombe dans le bundle correspondant: scripts - s√©par√©ment, styles - s√©par√©ment, tests - s√©par√©ment.  Pour diff√©rentes plates-formes - leurs bundles: pour un n≈ìud - le leur, pour un navigateur - le leur. </p><br><p>  Automatisation compl√®te, manque de configuration et de passe-partout, tailles de paquet minimales, pompage automatique des d√©pendances, d√©veloppement de centaines de biblioth√®ques et d'applications ali√©n√©es dans une base de code sans douleur ni souffrance.  <strong>Wow quelle d√©pendance!</strong>  Retirez les enceintes, les enfants nerveux des moniteurs et bienvenue dans le sous-marin! </p><a name="habracut"></a><br><h1 id="filosofiya">  La philosophie </h1><br><p>  MAM est une exp√©rience audacieuse pour changer radicalement la fa√ßon dont le code est organis√© et le processus de travail avec lui.  Voici les principes de base: </p><br><p>  <strong>Conventions au lieu de la configuration.</strong>  Des accords raisonnables, simples et universels vous permettent d'automatiser l'ensemble de la routine, tout en conservant la commodit√© et l'uniformit√© entre les diff√©rents projets. </p><br><p>  <strong>L'infrastructure est s√©par√©e, le code est s√©par√©.</strong>  Une situation n'est pas rare lorsque vous devez d√©velopper des dizaines, voire des centaines de biblioth√®ques et d'applications.  Ne d√©ployez pas l'infrastructure d'assemblage, de d√©veloppement, de d√©ploiement, etc. pour chacun d'eux.  Il suffit de le poser une fois puis de riveter des applications comme des tartes. </p><br><p>  <strong>Ne payez pas pour ce que vous n'utilisez pas.</strong>  Vous utilisez une sorte de module - il est inclus dans le bundle avec toutes ses d√©pendances.  Ne pas utiliser - ne s'allume pas.  Plus les modules sont petits, plus la granularit√© est grande et moins de code inutile dans le bundle. </p><br><p>  <strong>Code redondant minimum.</strong>  D√©composer le code en modules devrait √™tre aussi simple que d'√©crire tout le code dans un seul fichier.  Sinon, le d√©veloppeur sera paresseux pour diviser les gros modules en petits modules. </p><br><p>  <strong>Aucun conflit de version.</strong>  Il n'y a qu'une seule version - la version actuelle.  Il n'est pas n√©cessaire de d√©penser des ressources pour prendre en charge les anciennes versions, si vous pouvez les d√©penser pour mettre √† jour ces derni√®res. </p><br><p>  <strong>Gardez un doigt sur le pouls.</strong>  La r√©troaction la plus rapide concernant les incompatibilit√©s ne permettra pas au code de mal tourner. </p><br><p>  <strong>Le moyen le plus simple est le plus s√ªr.</strong>  Si le bon chemin n√©cessite des efforts suppl√©mentaires, assurez-vous que personne ne s'y rendra. </p><br><h1 id="importyeksporty">  Importations / exportations </h1><br><p>  Nous ouvrons le premier projet qui a <a href="">vu le jour en</a> utilisant un syst√®me de modules moderne: <a href="">Un module a moins de 300 lignes de long, dont 30 sont des importations.</a> </p><br><p>  Mais ce sont encore des fleurs: <a href="">pour une fonction de 9 lignes, 8 importations sont n√©cessaires.</a> </p><br><p>  Et mon pr√©f√©r√©: <a href="">pas une seule ligne de code utile.</a>  20 lignes de valeurs de d√©calage du tas de modules en un, afin que vous puissiez plus tard importer √† partir d'un module, et non de vingt. </p><br><p>  Tout cela est un passe-partout, ce qui conduit au fait que les d√©veloppeurs sont trop paresseux pour allouer de petits morceaux de code dans des modules s√©par√©s, pr√©f√©rant les gros modules aux petits.  Et m√™me s'ils ne sont pas paresseux, il s'av√®re que beaucoup de code pour importer de petits modules, ou des modules sp√©ciaux qui importent beaucoup de modules en eux-m√™mes et les exportent tous en vrac. </p><br><p>  Tout cela conduit √† une faible granularit√© du code et √† un gonflement de la taille des bundles avec du code inutilis√©, ce qui a la chance d'√™tre proche de celui qui est utilis√©.  Pour JS, ils essaient de r√©soudre ce probl√®me en compliquant le pipeline d'assemblage en ajoutant ce que l'on appelle le ¬´tremblement d'arbre¬ª, ce qui coupe l'exc√©dent de ce que vous avez import√©.  Cela ralentit l'assemblage, mais tout n'est pas coup√©. </p><br><p>  Id√©e: <strong>que se passe-t-il si nous n'importons pas, mais prenons et utilisons simplement, et le collectionneur lui-m√™me trouvera ce qui doit √™tre import√©?</strong> </p><br><p>  Les IDE modernes peuvent g√©n√©rer automatiquement des importations pour les entit√©s que vous utilisez.  Si l'EDI peut le faire, qu'est-ce qui emp√™che le collecteur de le faire?  Il suffit d'avoir une convention simple sur la d√©nomination et l'emplacement des fichiers, ce qui serait pratique pour l'utilisateur et compr√©hensible pour la machine.  PHP a depuis longtemps une telle convention standard: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PSR-4</a> .  MAM introduit la m√™me chose pour les fichiers <em>.ts et</em> .jam.js: les noms commen√ßant par $ sont le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nom</a> complet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'</a> une entit√© globale dont le code est charg√© le long du chemin obtenu √† partir de FQN en rempla√ßant les d√©limiteurs par des barres obliques.  Un exemple simple de deux modules: </p><br><p>  <strong>mon / alert / alert.ts</strong> </p><br><pre> <code class="plaintext hljs">const $my_alert = alert // FQN   </code> </pre> <br><p>  <strong>mon / app / app.ts</strong> </p><br><pre> <code class="plaintext hljs">$my_alert( 'Hello!' ) // ,   /my/alert/</code> </pre> <br><p>  Un module entier √† partir d'une seule ligne - quoi de plus simple?  Le r√©sultat ne tarde pas √† venir: la simplicit√© de cr√©ation et d'utilisation des modules permet de minimiser leur taille.  En cons√©quence, pour maximiser la granularit√©.  Et comme une cerise - minimiser la taille des faisceaux sans secouer les arbres. </p><br><p>  Un bon exemple est la famille de modules de validation JSON <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">/ mol / data</a> .  Si vous utilisez la fonction <code>$mol_data_integer</code> quelque part dans votre code, les modules <code>/mol/data/integer</code> et <code>/mol/data/number</code> , dont d√©pend <code>$mol_data_integer</code> , seront inclus dans le bundle.  Mais, par exemple, le collecteur <code>/mol/data/email</code> ne lira m√™me pas √† partir du disque, car personne n'en d√©pend. </p><br><h1 id="razgrebaya-bardak">  Ratisser un g√¢chis </h1><br><p>  Depuis que nous avons commenc√© √† frapper Angular, nous ne nous arr√™terons pas.  O√π pensez-vous rechercher la <code>applyStyles</code> fonction <code>applyStyles</code> ?  Vous ne devinerez pas sur <a href=""><code>/packages/core/src/render3/styling_next/bindings.ts</code></a> .  La possibilit√© de placer n'importe quoi n'importe o√π conduit au fait que, dans chaque projet, nous observons un syst√®me de localisation de fichiers unique, qui ne se pr√™te souvent √† aucune logique.  Et si l'IDE est souvent sauvegard√© par le ¬´saut √† la d√©finition¬ª, alors afficher le code sur le github ou revoir la demande de pull est priv√© de cette opportunit√©. </p><br><p>  Id√©e: <strong>que se passe-t-il si les noms d'entit√© correspondent strictement √† leur emplacement?</strong> </p><br><p>  Pour placer le code dans le fichier <code>/angular/packages/core/src/render3/stylingNext/bindings.ts</code> , dans l'architecture MAM, vous devez nommer l'entit√© <code>$angular_packages_core_src_render3_stylingNext_applyStyles</code> , mais bien s√ªr, personne <code>$angular_packages_core_src_render3_stylingNext_applyStyles</code> , car il y a tellement plus dans le nom.  Mais les noms dans le code que je veux voir courts et concis, donc le d√©veloppeur essaiera d'exclure tous les inutiles du nom, ne laissant que l'important: <code>$angular_render3_applyStyles</code> .  Et il sera situ√© en cons√©quence dans <code>/angular/render3/applyStyles/applyStyles.ts</code> . </p><br><p>  Remarquez comment MAM utilise les faiblesses des d√©veloppeurs pour atteindre le r√©sultat souhait√©: chaque entit√© obtient un nom court globalement unique qui peut √™tre utilis√© dans n'importe quel contexte.  Par exemple, dans les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">messages de commits,</a> ces noms vous permettent de saisir rapidement et pr√©cis√©ment ce dont ils parlent: </p><br><pre> <code class="plaintext hljs">73ebc45e517ffcc3dcce53f5b39b6d06fc95cae1 $mol_vector: range expanding support 3a843b2cb77be19688324eeb72bd090d350a6cc3 $mol_data: allowed transformations 24576f087133a18e0c9f31e0d61052265fd8a31a $mol_data_record: support recursion</code> </pre> <br><p>  Ou, disons que vous voulez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">trouver toutes les mentions du module $ mol_fiber sur Internet</a> - ce qui rend plus facile que jamais gr√¢ce √† FQN. </p><br><h1 id="ciklicheskie-zavisimosti">  D√©pendances cycliques </h1><br><p>  √âcrivons 7 lignes de code simple dans un seul fichier: </p><br><pre> <code class="plaintext hljs">export class Foo { get bar() { return new Bar(); } } export class Bar extends Foo {} console.log(new Foo().bar);</code> </pre> <br><p>  Malgr√© la d√©pendance cyclique, cela fonctionne correctement.  Nous le d√©composons en 3 fichiers: </p><br><p>  <strong>mon / foo.js</strong> </p><br><pre> <code class="plaintext hljs">import { Bar } from './bar.js'; export class Foo { get bar() { return new Bar(); } }</code> </pre> <br><p>  <strong>mon / bar.js</strong> </p><br><pre> <code class="plaintext hljs">import { Foo } from './foo.js'; export class Bar extends Foo {}</code> </pre> <br><p>  <strong>mon / app.js</strong> </p><br><pre> <code class="plaintext hljs">import { Foo } from './foo.js'; console.log(new Foo().bar);</code> </pre> <br><p>  Oups, <code>ReferenceError: Cannot access 'Foo' before initialization</code> .  Quel genre de non-sens?  Pour r√©soudre ce probl√®me, notre <code>app.js</code> doit savoir que <code>foo.js</code> d√©pend de <code>bar.js</code>  Par cons√©quent, nous devons d'abord importer <code>bar.js</code> , qui importe <code>foo.js</code>  Apr√®s quoi, nous pouvons d√©j√† importer <code>foo.js</code> sans erreur: </p><br><p>  <strong>mon / app.js</strong> </p><br><pre> <code class="plaintext hljs">import './bar.js'; import { Foo } from './foo.js'; console.log(new Foo().bar);</code> </pre> <br><p>  Ces navigateurs, ce NodeJS, ce Webpack, ce Parcel - ils fonctionnent tous de fa√ßon tordue avec des d√©pendances circulaires.  Et bien, ils les interdiraient simplement - on pourrait imm√©diatement compliquer le code pour qu'il n'y ait pas de boucles.  Mais ils peuvent bien fonctionner, puis bam, et donner une erreur incompr√©hensible. </p><br><p>  Id√©e: <strong>que se passe-t-il si lors de l'assemblage, nous collons simplement les fichiers dans le bon ordre, comme si tout le code √©tait √† l'origine √©crit dans un seul fichier?</strong> </p><br><p>  Divisons le code en utilisant les principes de MAM: </p><br><p>  <strong>mon / foo / foo.ts</strong> </p><br><pre> <code class="plaintext hljs">class $my_foo { get bar() { return new $my_bar(); } }</code> </pre> <br><p>  <strong>mon / bar / bar.ts</strong> </p><br><pre> <code class="plaintext hljs">class $my_bar extends $my_foo {}</code> </pre> <br><p>  <strong>mon / app / app.ts</strong> </p><br><pre> <code class="plaintext hljs">console.log(new $my_foo().bar);</code> </pre> <br><p>  Tout de m√™me 7 lignes de code qui √©taient √† l'origine.  Et ils fonctionnent simplement sans chamanisme suppl√©mentaire.  Le fait est que le collecteur comprend que la d√©pendance de <code>my/bar</code> sur <code>my/foo</code> plus stricte que <code>my/foo</code> sur <code>my/bar</code> .  Cela signifie que vous devez inclure ces modules dans le bundle dans cet ordre: <code>my/foo</code> , <code>my/bar</code> , <code>my/app</code> . </p><br><p>  Comment le collectionneur comprend-il cela?  Maintenant, l'heuristique est simple - par le nombre d'indentation dans la ligne dans laquelle la d√©pendance est d√©tect√©e.  Veuillez noter qu'une d√©pendance plus forte dans notre exemple a une indentation nulle et une faible a une indentation double. </p><br><h1 id="raznye-yazyki">  Diff√©rentes langues </h1><br><p>  Il se trouve que pour diff√©rentes choses, nous avons des langues diff√©rentes pour ces diff√©rentes choses aiguis√©es.  Les plus courants sont: JS, TS, CSS, HTML, SVG, SCSS, Less, Stylus.  Chacun a son propre syst√®me de modules, qui n'interagit en aucune fa√ßon avec les autres langues.  Il va sans dire, environ 100500 types de langues plus sp√©cifiques.  Par cons√©quent, pour connecter un composant, vous devez connecter s√©par√©ment ses scripts, s√©parer les styles, enregistrer les mod√®les s√©par√©ment, configurer s√©par√©ment le d√©ploiement des fichiers statiques dont il a besoin, etc., etc. </p><br><p>  Gr√¢ce aux chargeurs, Webpack essaie de r√©soudre ce probl√®me.  Mais il a un point d'entr√©e, c'est un script qui connecte d√©j√† des fichiers dans d'autres langues.  Et si nous n'avons pas besoin d'un script?  Par exemple, nous avons un module avec de beaux styles pour les assiettes et nous voulons qu'ils aient les m√™mes couleurs dans le th√®me clair et d'autres dans le noir: </p><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.dark-theme</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: black; } <span class="hljs-selector-class"><span class="hljs-selector-class">.light-theme</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: white; }</code> </pre> <br><p>  De plus, si nous d√©pendons du sujet, alors un script devrait √™tre charg√© qui installera le sujet souhait√© en fonction de l'heure de la journ√©e.  Autrement dit, CSS d√©pend en fait de JS. </p><br><p>  Id√©e: et <strong>si un syst√®me modulaire ne d√©pend pas des langues?</strong> </p><br><p>  √âtant donn√© que dans MAM, le syst√®me modulaire est s√©par√© des langues, les d√©pendances peuvent √™tre inter-langues.  CSS peut d√©pendre de JS, qui peut d√©pendre de TS, qui peut d√©pendre d'un autre JS.  Cela est d√ª au fait que les d√©pendances de source sont d√©tect√©es sur les modules et que les modules sont enti√®rement connect√©s et peuvent contenir des codes source dans toutes les langues.  Dans le cas de l'exemple de th√®mes, cela ressemble √† ceci: </p><br><p>  <strong>/my/table/table.css</strong> </p><br><pre> <code class="css hljs"><span class="hljs-comment"><span class="hljs-comment">/* ,   /my/theme */</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[my_theme="dark"]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: black; } <span class="hljs-selector-attr"><span class="hljs-selector-attr">[my_theme="light"]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">table</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: white; }</code> </pre> <br><p>  <strong>/my/theme/theme.js</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.documentElement.setAttribute( <span class="hljs-string"><span class="hljs-string">'my_theme'</span></span> , ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>().getHours() + <span class="hljs-number"><span class="hljs-number">15</span></span> ) % <span class="hljs-number"><span class="hljs-number">24</span></span> &lt; <span class="hljs-number"><span class="hljs-number">12</span></span> ? <span class="hljs-string"><span class="hljs-string">'light'</span></span> : <span class="hljs-string"><span class="hljs-string">'dark'</span></span> , )</code> </pre> <br><p>  En utilisant cette technique, vous pouvez d'ailleurs impl√©menter votre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Modernizr</a> , mais sans 300 contr√¥les dont vous n'avez pas besoin, car seuls les contr√¥les dont votre CSS d√©pend vraiment seront inclus dans le bundle. </p><br><h1 id="mnogo-bibliotek">  De nombreuses biblioth√®ques </h1><br><p>  En r√®gle g√©n√©rale, le point d'entr√©e pour la cr√©ation d'un bundle est une sorte de fichier.  Dans le cas de Webpack, il s'agit de JS.  Si vous d√©veloppez de nombreuses biblioth√®ques et applications ali√©nables, vous avez besoin de beaucoup de bundles.  Et pour chaque bundle, vous devez cr√©er un point d'entr√©e distinct.  Dans le cas de Parcel, le point d'entr√©e est HTML, qui pour les applications devra de toute fa√ßon √™tre cr√©√©.  Mais pour les biblioth√®ques, ce n'est pas tr√®s appropri√©. </p><br><p>  Id√©e: <strong>que se passe-t-il si un module peut √™tre assembl√© en un bundle ind√©pendant sans pr√©paration pr√©alable?</strong> </p><br><p>  Pr√©parons la derni√®re version du g√©n√©rateur de projet MAM $ mol_build: </p><br><pre> <code class="plaintext hljs">mam mol/build</code> </pre> <br><p>  Maintenant, lancez ce collecteur et laissez-le se reconstituer pour vous assurer qu'il est toujours en mesure de se rassembler: </p><br><pre> <code class="plaintext hljs">node mol/build/-/node.js mol/build</code> </pre> <br><p>  Bien que non, demandons-lui d'ex√©cuter des tests avec l'assembly: </p><br><pre> <code class="plaintext hljs">node mol/build/-/node.test.js mol/build</code> </pre> <br><p>  Et si tout s'est bien pass√©, publiez le r√©sultat dans NPM: </p><br><pre> <code class="plaintext hljs">npm publish mol/build/-</code> </pre> <br><p>  Comme vous pouvez le voir, lors de l'assemblage du module, un sous-r√©pertoire est cr√©√© avec le nom <code>-</code> et tous les artefacts d'assemblage y sont plac√©s.  Passons en revue les fichiers que vous pouvez y trouver: </p><br><ul><li>  <code>web.dep.json</code> - toutes les informations sur le graphe de d√©pendances </li><li>  <code>web.js</code> - ensemble de scripts de navigateur </li><li>  <code>web.js.map</code> - sorsmaps pour lui </li><li>  <code>web.esm.js</code> - il se pr√©sente sous la forme d'un module es </li><li>  <code>web.esm.js.map</code> - et sorsmaps pour cela </li><li>  <code>web.test.js</code> - bundle de test </li><li>  <code>web.test.js.map</code> - et pour les tests sorsmap </li><li>  <code>web.d.ts</code> - bundle avec les types de tout ce qui est dans le bundle de script </li><li>  <code>web.css</code> - bundle avec styles </li><li>  <code>web.css.map</code> - et sortsmaps pour cela </li><li>  <code>web.test.html</code> - point d'entr√©e pour ex√©cuter des tests de performances dans un navigateur </li><li>  <code>web.view.tree</code> - d√©clarations de tous les composants inclus dans le bundle view.tree </li><li>  <code>web.locale=*.json</code> - bundles avec textes localis√©s, chaque bundle a son propre bundle </li><li>  <code>package.json</code> - vous permet de publier imm√©diatement le module assembl√© dans NPM </li><li>  <code>node.dep.json</code> - toutes les informations sur le graphe de d√©pendances </li><li>  <code>node.js</code> - bundle de script de noeud </li><li>  <code>node.js.map</code> - sorsmaps pour cela </li><li>  <code>node.esm.js</code> - il se pr√©sente sous la forme d'un es-module </li><li>  <code>node.esm.js.map</code> - et sorsmaps pour cela </li><li>  <code>node.test.js</code> - le m√™me bundle, mais aussi avec des tests </li><li>  <code>node.test.js.map</code> - et sorsmaps pour cela </li><li>  <code>node.d.ts</code> - bundle avec les types de tout ce qui est dans le bundle de script </li><li>  <code>node.view.tree</code> - d√©clarations de tous les composants inclus dans le bundle view.tree </li><li>  <code>node.locale=*.json</code> - bundles avec des textes localis√©s, chaque bundle a son propre bundle </li></ul><br><p>  La statique est simplement copi√©e avec les chemins.  Par exemple, prenez une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">application qui affiche ses propres codes source</a> .  Ses sources sont ici: </p><br><ul><li> <code>/mol/app/quine/quine.view.tree</code> </li> <li> <code>/mol/app/quine/quine.view.ts</code> </li> <li> <code>/mol/app/quine/index.html</code> </li> <li> <code>/mol/app/quine/quine.locale=ru.json</code> </li> </ul><br><p>  Malheureusement, dans le cas g√©n√©ral, le collecteur ne peut pas savoir que nous aurons besoin de ces fichiers lors de l'ex√©cution.  Mais nous pouvons le lui dire en mettant un fichier sp√©cial √† proximit√©: </p><br><p>  <strong>/mol/app/quine/quine.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">deploy \/mol/app/quine/quine.view.tree deploy \/mol/app/quine/quine.view.ts deploy \/mol/app/quine/index.html deploy \/mol/app/quine/quine.locale=ru.json</code> </pre> <br><p>  √Ä la suite de l'assembly <code>/mol/app/quine</code> , ils seront copi√©s de la mani√®re suivante: </p><br><ul><li> <code>/mol/app/quine/-/mol/app/quine/quine.view.tree</code> </li> <li> <code>/mol/app/quine/-/mol/app/quine/quine.view.ts</code> </li> <li> <code>/mol/app/quine/-/mol/app/quine/index.html</code> </li> <li> <code>/mol/app/quine/-/mol/app/quine/quine.locale=ru.json</code> </li> </ul><br><p>  Maintenant, le r√©pertoire <code>/mol/app/quine/-</code> peut √™tre dispos√© sur n'importe quel h√©bergement statique et l'application sera enti√®rement fonctionnelle. </p><br><h1 id="celevye-platformy">  Plateformes cibles </h1><br><p>  JS peut √™tre ex√©cut√© √† la fois sur le client et sur le serveur.  Et comme c'est cool quand on peut √©crire un code et √ßa marchera partout.  Cependant, parfois l'impl√©mentation de la m√™me chose sur le client et le serveur est fondamentalement diff√©rente.  Et je veux, par exemple, une impl√©mentation √† utiliser pour un n≈ìud, et une autre pour un navigateur. </p><br><p>  Id√©e: <strong>que se passe-t-il si le but du fichier est refl√©t√© dans son nom?</strong> </p><br><p>  MAM utilise un syst√®me de balises dans les noms de fichiers.  Par exemple, le module <code>$mol_state_arg</code> permet d'acc√©der aux param√®tres d'application d√©finis par l'utilisateur.  Dans le navigateur, ces param√®tres sont d√©finis via la barre d'adresse.  Et dans le n≈ìud, via des arguments de ligne de commande.  <code>$mol_sate_arg</code> r√©sume le reste de l'application de ces nuances en impl√©mentant les deux options avec une seule interface, en les pla√ßant dans des fichiers: </p><br><ul><li>  / mol / state / arg / arg.  <strong>web</strong> .ts - impl√©mentation pour les navigateurs </li><li>  / mol / state / arg / arg.  <strong>node</strong> .ts - impl√©mentation pour un noeud </li></ul><br><p>  Les sources non balis√©es avec ces balises sont incluses quelle que soit la plateforme cible. </p><br><p>  Une situation similaire est observ√©e avec les tests - ils veulent √™tre stock√©s √† c√¥t√© du reste des sources, mais ils ne veulent pas √™tre inclus dans le bundle qui va √† l'utilisateur final.  Par cons√©quent, les tests sont √©galement marqu√©s avec une balise distincte: </p><br><ul><li>  / mol / state / arg / arg.  <strong>test</strong> .ts - tests de module, ils tomberont dans le bundle de test </li></ul><br><p>  Les balises peuvent √™tre param√©triques.  Par exemple, avec chaque module, des textes dans diff√©rentes langues peuvent venir et doivent √™tre inclus dans les packs de langues correspondants.  Un fichier texte est un dictionnaire JSON standard nomm√© avec les param√®tres r√©gionaux dans le nom: </p><br><ul><li>  / mol / app / life / life.  <strong>locale = ru</strong> .json - textes pour la langue russe </li><li>  / mol / app / life / life.  <strong>locale = jp</strong> .json - textes pour le japonais </li></ul><br><p>  Enfin, que se passe-t-il si nous voulons placer des fichiers √† proximit√©, mais que le collecteur les ignore et ne les inclut pas automatiquement dans le bundle?  Il suffit d'ajouter au d√©but de leur nom tout caract√®re non alphanum√©rique.  Par exemple: </p><br><ul><li>  / hyoo / jouets / <strong>.</strong>  git - commence par un point, donc le collecteur ignorera ce r√©pertoire </li></ul><br><h1 id="versionirovanie">  Versioning </h1><br><p>  Google a d'abord publi√© AngularJS et l'a publi√© dans NPM en tant <code>angular</code> .  Puis il a cr√©√© un tout nouveau framework avec un nom similaire - Angular et l'a publi√© sous le m√™me nom, mais d√©j√† la version 2. Maintenant, ces deux feux d'artifice se d√©veloppent ind√©pendamment.  Un seul changement de rupture d'API se produit entre les versions principales.  Et l'autre - <a href="">entre le mineur</a> .  Et comme il est impossible de mettre deux versions de la m√™me d√©pendance au m√™me niveau, il ne peut √™tre question de transition en douceur, lorsque deux versions de la biblioth√®que coexistent simultan√©ment pendant un certain temps dans l'application. </p><br><p>  Il semble que l'√©quipe d'Angular ait d√©j√† march√© sur tous les r√¢teaux possibles.  Et encore une chose: le code cadre est divis√© en plusieurs grands modules.  Au d√©but, ils les ont versionn√©s ind√©pendamment, mais tr√®s rapidement, m√™me eux-m√™mes ont commenc√© √† se demander quelles versions des modules sont compatibles entre elles, sans parler des d√©veloppeurs ordinaires.  Par cons√©quent, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Angular est pass√© au versionnage de bout en bout</a> , o√π la version principale du module peut changer m√™me sans aucune modification du code.  La prise en charge de plusieurs versions de plusieurs modules est un gros probl√®me √† la fois pour les responsables eux-m√™mes et pour l'√©cosyst√®me dans son ensemble.  Apr√®s tout, beaucoup de ressources de tous les membres de la communaut√© sont consacr√©es √† assurer la compatibilit√© avec des modules d√©j√† obsol√®tes. </p><br><p>  La belle id√©e de la version <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©mantique</a> se transforme en une dure r√©alit√© - vous ne savez jamais si quelque chose se cassera lorsque vous changez la version mineure <a href="">ou m√™me la version du patch</a> .  Par cons√©quent, dans de nombreux projets, une version sp√©cifique de la d√©pendance est corrig√©e.  Cependant, un tel correctif n'affecte pas les d√©pendances transitives, qui peuvent √™tre tir√©es vers la derni√®re version lors de l'installation √† partir de z√©ro, mais peuvent rester les m√™mes si elles sont d√©j√† install√©es.  Ce g√¢chis conduit au fait que vous ne pouvez jamais compter sur une version fixe et que vous devez v√©rifier r√©guli√®rement la compatibilit√© avec les versions actuelles des d√©pendances (au moins transitives). </p><br><p>  Mais qu'en est-il des <a href="">fichiers de verrouillage</a> ?  Si vous d√©veloppez une biblioth√®que qui est install√©e via des d√©pendances, le fichier de verrouillage ne vous aidera pas, car il sera ignor√© par le gestionnaire de packages.  Pour l'application finale, le fichier de verrouillage vous donnera la soi-disant ¬´reproductibilit√© des assemblages¬ª.  Mais soyons honn√™tes.  Combien de fois avez-vous besoin de cr√©er l'application finale √† partir de la m√™me source?  Exactement une fois.  Recevoir la sortie, ind√©pendamment de tout NPM, l'artefact d'assemblage: un binaire ex√©cutable, un conteneur de docker ou juste une archive avec tout le code n√©cessaire pour l'ex√©cuter.  J'esp√®re que vous ne faites pas d' <code>npm install</code> sur prod? </p><br><p>  Certains trouvent l'utilisation de fichiers de verrouillage dans la mesure o√π le serveur CI compile exactement ce que le d√©veloppeur a commis.  Mais attendez, le d√©veloppeur lui-m√™me peut simplement l'assembler sur sa machine locale.  ,    ,  ,    . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Continuous Integration</a>       ,     ,    ,  ,   - .  CI        ,            . </p><br><p>        ,     ,  . ,            Angular@4 (  3).  ,     ,  "     "  "     ".      Angular@4     ,      Angular@5.      Angular@6,         .  Angular   TypeScript    .     .  ,   2  ,  ‚Ä¶      ,   business value    ,     ,  ,  ,  . </p><br><p>                   ,    ,       ,   ,       2 .    :      ,  ‚Äî ,  ‚Äî .       3 React, 5 jQuery, 7 lodash. </p><br><p> : <strong>         ‚Äî ?</strong> </p><br><p>         .     -   .     ,       .     ,     .  ,    .  ,       .        ,    .   ,        ,            .      :  issue,    ,  workaround,  pull request,    ,      .          ,    ,    .        .            . </p><br><p>               ,        . ,        ,       .        .        .  :  ,       ,     -.     -      ‚Äî       .  ,            ,    -  .         , ,  ,   NPM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>     .  ,      .       . </p><br><p>         ,      ?   ‚Äî   .  <code>mobx</code> ,  <code>mobx2</code>     API  .   ‚Äî    ,    :     ,       .     <code>mobx</code>        <code>mobx2</code> ,      API.         API,     . </p><br><p>        .           ‚Äî .  ,      : </p><br><pre> <code class="plaintext hljs">var pages_count = $mol_atom2_sync( ()=&gt; $lib_pdfjs.getDocument( uri ).promise ).document().numPages</code> </pre> <br><p>  <strong> </strong>   <code>mol_atom2_sync</code>  <code>lib_pdfjs</code> ,      : </p><br><pre> <code class="plaintext hljs">npm install mol_atom2_sync@2.1 lib_pdfjs@5.6</code> </pre> <br><p> ,   , ‚Äî   ,       .        ?    ‚Äî    ,    <code>*.meta.tree</code> ,          : </p><br><p> <strong>/.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">pack node git \https://github.com/nin-jin/pms-node.git pack mol git \https://github.com/eigenmethod/mol.git pack lib git \https://github.com/eigenmethod/mam-lib.git</code> </pre> <br><p>    .             . </p><br><h1 id="integraciya-s-npm">   NPM </h1><br><p> MAM ‚Äî    NPM . ,         ‚Äî . ,    ,     NPM      . </p><br><p>          NPM ,     $node. ,   -        -: </p><br><p> <strong>/my/app/app.ts</strong> </p><br><pre> <code class="plaintext hljs">$node.portastic.find({ min : 8080 , max : 8100 , retrieve : 1 }).then( ( ports : number[] ) =&gt; { $node.express().listen( ports[0] ) })</code> </pre> <br><p>       ,     . -    <code>lib</code>      NPM . ,     NPM- <code>pdfjs-dist</code> : </p><br><p> <strong>/lib/pdfjs/pdfjs.ts</strong> </p><br><pre> <code class="plaintext hljs">namespace $ { export let $lib_pdfjs : typeof import( 'pdfjs-dist' ) = require( 'pdfjs-dist/build/pdf.min.js' ) $lib_pdfjs.disableRange = true $lib_pdfjs.GlobalWorkerOptions.workerSrc = '-/node_modules/pdfjs-dist/build/pdf.worker.min.js' }</code> </pre> <br><p> <strong>/lib/pdfjs/pdfjs.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">deploy \/node_modules/pdfjs-dist/build/pdf.worker.min.js</code> </pre> <br><p>        ,    . </p><br><h1 id="okruzhenie-razrabotchika">   </h1><br><p>          .     <code>create-react-app</code>  <code>angular-cli</code> ,       . , ,   <code>eject</code>       .          .       ,         ,       . </p><br><p> : <strong>      ?</strong> </p><br><p>    MAM      .          . </p><br><p>      MAM  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">   MAM </a> ,    : </p><br><pre> <code class="plaintext hljs">git clone https://github.com/eigenmethod/mam.git ./mam &amp;&amp; cd mam npm install npm start</code> </pre> <br><p>   8080   . ,    ‚Äî        MAM. </p><br><p>     (  ‚Äî <code>acme</code> )         (  ‚Äî <code>hello</code>  <code>home</code> ): </p><br><p> <strong>/acme/acme.meta.tree</strong> </p><br><pre> <code class="plaintext hljs">pack hello git \https://github.com/acme/hello.git pack home git \https://github.com/acme/home.git</code> </pre> <br><p>           <code>npm start</code> : </p><br><pre> <code class="plaintext hljs">npm start acme/hello acme/home</code> </pre> <br><p>         .     ‚Äî  . ,  ,   .     ‚Äî   : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://t.me/mam_mol</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456288/">https://habr.com/ru/post/fr456288/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456272/index.html">Qu'est-ce qu'Android Lint et comment vous aide-t-il √† √©crire du code pris en charge?</a></li>
<li><a href="../fr456274/index.html">Psychologues: les robots sexuels entra√Æneront une augmentation du nombre de personnes sans couple qui n'ont pas besoin de relations avec d'autres personnes</a></li>
<li><a href="../fr456276/index.html">Qu'est-ce que l'information?</a></li>
<li><a href="../fr456280/index.html">D√©buter avec stm32 ou ne pas r√©p√©ter mes erreurs</a></li>
<li><a href="../fr456282/index.html">Graphiques multidimensionnels en Python - de trois dimensions √† six dimensions</a></li>
<li><a href="../fr456294/index.html">Diff√©rences entre LabelEncoder et OneHotEncoder dans SciKit Learn</a></li>
<li><a href="../fr456296/index.html">Le monde de l'hypersph√®re tridimensionnelle. Tra√ßage de rayons g√©od√©siques dans un univers ferm√© √† g√©om√©trie sph√©rique</a></li>
<li><a href="../fr456298/index.html">Les technologies de la micro√©lectronique sur les doigts: la loi de Moore, les mouvements de marketing et pourquoi les nanom√®tres ne sont plus les m√™mes aujourd'hui. 2e partie</a></li>
<li><a href="../fr456300/index.html">Trouver zina</a></li>
<li><a href="../fr456302/index.html">Pourquoi pr√©f√©rons-nous CSS (- variable) √† SASS ($ variable)?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>