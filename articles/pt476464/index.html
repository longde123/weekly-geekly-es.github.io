<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ç üì© üë®‚Äç‚öïÔ∏è Problemas de log de eventos de seguran√ßa do sistema Windows üç∫ üë®üèª‚Äçüé§ üë§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os sistemas operacionais Windows t√™m um bom sistema de log de eventos de seguran√ßa. Muitas coisas boas foram escritas sobre ela em v√°rias publica√ß√µes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Problemas de log de eventos de seguran√ßa do sistema Windows</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476464/"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/r3/ka/al/r3kaaljcd70px_fvggsc4jmu4es.jpeg"></a> <br><br>  Os sistemas operacionais Windows t√™m um bom sistema de log de eventos de seguran√ßa.  Muitas coisas boas foram escritas sobre ela em v√°rias publica√ß√µes e resenhas, mas este artigo ser√° sobre outra coisa.  Aqui falamos sobre problemas e defici√™ncias neste sistema.  Alguns dos problemas considerados n√£o ser√£o cr√≠ticos, complicando apenas os procedimentos de an√°lise de eventos, enquanto outros representam amea√ßas muito graves √† seguran√ßa. <br><br>  Os problemas identificados foram testados no Windows 7 Maximum (vers√£o em russo), Windows 7 Professional (vers√£o em ingl√™s), Windows 10 Pro (vers√£o em russo), Windows Server 2019 Datacenter (vers√£o em russo).  Todos os sistemas operacionais foram completamente atualizados. <br><a name="habracut"></a><br><h2>  Problema n¬∫ 1. Falha no sistema de gerenciamento de par√¢metros de auditoria </h2><br>  <i>O problema foi confirmado no Windows 7/10 / Server 2019.</i> <br><br><h3>  Descri√ß√£o do problema </h3><br>  Leve o Windows 7 e instale-o com as configura√ß√µes padr√£o.  N√£o entraremos no dom√≠nio.  Vamos ver as configura√ß√µes de auditoria de eventos de seguran√ßa.  Para fazer isso, abra o snap-in "Diretivas de seguran√ßa local" (secpol.msc ou "Painel de controle -&gt; Ferramentas administrativas -&gt; Diretivas de seguran√ßa local") e consulte as configura√ß√µes b√°sicas de auditoria ("Configura√ß√µes de seguran√ßa -&gt; Diretivas locais -&gt; Diretivas de auditoria" ) <br><br><img src="https://habrastorage.org/webt/bd/sm/cw/bdsmcwohkqtxgp9dzcac8p63daw.jpeg"><br><br>  Como voc√™ pode ver, a auditoria n√£o est√° configurada.  Agora vamos ver as pol√≠ticas de auditoria avan√ßadas ("Configura√ß√µes de seguran√ßa -&gt; Configura√ß√£o avan√ßada da pol√≠tica de auditoria -&gt; Pol√≠ticas de auditoria do sistema - objeto de diretiva de grupo local"). <br><br><img src="https://habrastorage.org/webt/om/oy/po/omoypoc15q9ynn0osefv-gawd4i.jpeg"><br><br>  Aqui a auditoria tamb√©m n√£o est√° configurada.  Nesse caso, teoricamente n√£o deve haver nenhum evento de seguran√ßa nos logs.  N√≥s verificamos.  Abra o log de seguran√ßa (eventvwr.exe ou "Painel de Controle -&gt; Ferramentas Administrativas -&gt; Exibir Eventos"). <br><br><img src="https://habrastorage.org/webt/j0/s4/ot/j0s4otidlwtntmyx-s02-kom3uk.jpeg"><br><br>  <b>Pergunta: ‚ÄúDe onde vem o evento no log de seguran√ßa se a auditoria n√£o est√° configurada?‚Äù</b> <br><br><h3>  Explica√ß√£o </h3><br>  Para entender o motivo desse comportamento, voc√™ precisa "entender" o sistema operacional.  Para come√ßar, lidaremos com pol√≠ticas de auditoria b√°sicas e avan√ßadas. <br><br>  Antes do Windows Vista, havia apenas uma pol√≠tica de auditoria, que agora √© chamada b√°sica.  O problema era que a granularidade do gerenciamento de auditoria naquela √©poca era muito baixa.  Portanto, se fosse necess√°rio rastrear o acesso aos arquivos, eles inclu√≠am a categoria da pol√≠tica b√°sica ‚ÄúAuditar o acesso a objetos‚Äù.  Como resultado, al√©m das opera√ß√µes de arquivo, v√°rios outros eventos de "ru√≠do" foram derramados no log de seguran√ßa.  Isso complicou bastante o processamento de logs e usu√°rios irritados. <br><br>  A Microsoft ouviu essa "dor" e decidiu ajudar.  O problema √© que o Windows se baseia no conceito de compatibilidade com vers√µes anteriores, e fazer altera√ß√µes no mecanismo de gerenciamento de auditoria existente eliminaria essa compatibilidade.  Portanto, o fornecedor seguiu o outro caminho.  Ele criou uma nova ferramenta e a chamou de Pol√≠ticas avan√ßadas de auditoria. <br><br>  A ess√™ncia da ferramenta √© que, a partir das categorias de pol√≠ticas b√°sicas de auditoria, s√£o feitas categorias de pol√≠ticas avan√ßadas e essas, por sua vez, s√£o divididas em subcategorias que podem ser ativadas e desativadas separadamente.  Agora, se voc√™ precisar rastrear o acesso aos arquivos nas pol√≠ticas de auditoria avan√ßadas, precisar√° ativar apenas a subcategoria "Sistema de Arquivos", inclu√≠da na categoria "Acesso ao Objeto".  Ao mesmo tempo, eventos de "ru√≠do" relacionados ao acesso ao registro ou √† filtragem do tr√°fego de rede n√£o ser√£o inclu√≠dos no log de seguran√ßa. <br><br>  A enorme confus√£o em todo esse esquema √© causada pelo fato de os nomes das categorias de pol√≠ticas b√°sicas de auditoria e avan√ßadas n√£o coincidirem e, a princ√≠pio, pode parecer que essas s√£o coisas completamente diferentes, mas n√£o √© assim. <br><br>  Aqui est√° uma tabela de conformidade dos nomes das categorias b√°sicas e avan√ßadas de gerenciamento de auditoria <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nome das pol√≠ticas b√°sicas de auditoria</b> </td><td>  <b>Nome da pol√≠tica de auditoria estendida</b> </td></tr><tr><td>  Auditoria de acesso ao servi√ßo de diret√≥rio </td><td>  Acesso ao Servi√ßo de Diret√≥rio (DS) </td></tr><tr><td>  Auditoria de acesso a objetos </td><td>  Acesso a instala√ß√µes </td></tr><tr><td>  Auditoria de privil√©gios </td><td>  Uso de direitos </td></tr><tr><td>  Auditoria de login </td><td>  Entrada / Sa√≠da </td></tr><tr><td>  Eventos de login de auditoria </td><td>  Login da conta </td></tr><tr><td>  Altera√ß√µes na pol√≠tica de auditoria </td><td>  Altera√ß√£o de pol√≠tica </td></tr><tr><td>  Eventos do sistema de auditoria </td><td>  O sistema </td></tr><tr><td>  Auditoria de gerenciamento de contas </td><td>  Gerenciamento de contas </td></tr><tr><td>  Auditoria de rastreamento de processos </td><td>  Rastreamento detalhado </td></tr></tbody></table></div><br>  √â importante entender que as categorias b√°sicas e avan√ßadas controlam essencialmente a mesma coisa.  A inclus√£o de uma categoria b√°sica de pol√≠tica de auditoria leva √† inclus√£o da categoria correspondente de pol√≠tica de auditoria estendida e, como conseq√º√™ncia, de todas as suas subcategorias.  Para evitar consequ√™ncias imprevistas, a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Microsoft n√£o recomenda o</a> uso de pol√≠ticas de auditoria b√°sicas e avan√ßadas ao mesmo tempo. <br><br>  Agora √© a hora de descobrir onde as configura√ß√µes de auditoria est√£o armazenadas.  Para come√ßar, apresentamos v√°rios conceitos: <br><br><ol><li>  <i>Pol√≠ticas de auditoria eficazes</i> - informa√ß√µes armazenadas na RAM que determinam os par√¢metros operacionais atuais dos m√≥dulos do sistema operacional que implementam fun√ß√µes de auditoria. </li><li>  <i>Pol√≠ticas de auditoria salvas</i> - informa√ß√µes armazenadas no registro em HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv e usadas para determinar pol√≠ticas de auditoria eficazes ap√≥s a reinicializa√ß√£o do sistema. </li></ol><br>  Consideraremos v√°rias ferramentas administrativas e indicamos quais par√¢metros de auditoria eles exibem e quais definem.  Os dados na tabela s√£o baseados em experimentos. <br><div class="scrollable-table"><table><tbody><tr><td>  <b>Nome dos fundos</b> </td><td>  <b>Pol√≠ticas de auditoria exibidas</b> </td><td>  <b>Pol√≠ticas de auditoria persistentes</b> </td></tr><tr><td>  Diretivas b√°sicas de auditoria do snap-in Diretivas de seguran√ßa local </td><td>  Pol√≠ticas eficazes de auditoria </td><td>  Pol√≠ticas de auditoria eficazes, pol√≠ticas de auditoria salvas </td></tr><tr><td>  Pol√≠ticas de auditoria avan√ßadas do snap-in Pol√≠ticas de seguran√ßa local </td><td colspan="2"> Arquivo <code>%SystemRoot%\System32\GroupPolicy\Machine\Microsoft\Windows NT\Audit\audit.csv</code> </td></tr><tr><td>  Utilit√°rio Auditpol </td><td>  Configura√ß√µes de auditoria salvas </td><td>  Configura√ß√µes de auditoria eficazes, configura√ß√µes de auditoria salvas </td></tr></tbody></table></div><br>  Vamos explicar a tabela com exemplos. <br><br>  <b>Exemplo 1</b> <br><br>  Se voc√™ executar o auditpol para visualizar as configura√ß√µes de auditoria: <br>  <code>auditpol /get /category:*</code> , os par√¢metros de auditoria salvos ser√£o exibidos, ou seja, aqueles armazenados no registro em HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv. <br><br>  <b>Exemplo 2</b> <br><br>  Se voc√™ executar o mesmo utilit√°rio, mas j√° definir os par√¢metros: <br>  <code>auditpol /set /category:*</code> , as configura√ß√µes de auditoria efetivas e as configura√ß√µes de auditoria salvas ser√£o alteradas. <br><br>  Um coment√°rio separado requer a ordem em que as configura√ß√µes de auditoria s√£o exibidas no "Diretivas b√°sicas de auditoria" do snap-in "Diretivas de seguran√ßa local".  A categoria da pol√≠tica de auditoria b√°sica √© exibida como definida se todas as subcategorias da pol√≠tica de auditoria estendida correspondente estiverem instaladas.  Se pelo menos um deles n√£o estiver instalado, a pol√≠tica ser√° exibida como n√£o instalada. <br><br>  <b>Exemplo 3</b> <br><br>  Usando o <code>auditpol /set /category:*</code> , o <code>auditpol /set /category:*</code> define todas as subcategorias de auditoria como Audit Success Mode.  Al√©m disso, se voc√™ for para as "Pol√≠ticas b√°sicas de auditoria" do snap-in "Pol√≠ticas locais de seguran√ßa", uma Auditoria de sucesso ser√° instalada em frente a cada categoria. <br><br>  <b>Exemplo 4</b> <br><br>  Agora, o administrador <code>auditpol /clear</code> comando <code>auditpol /clear</code> e redefiniu todas as configura√ß√µes de auditoria.  Ele ent√£o configurou a auditoria do sistema de arquivos executando <code>auditpol /set /subcategory:" "</code> .  Agora, se voc√™ for para o "Pol√≠ticas b√°sicas de auditoria" do snap-in "Pol√≠ticas de seguran√ßa local", todas as categorias ser√£o definidas no estado "Sem auditoria", pois nenhuma categoria da pol√≠tica de auditoria estendida est√° totalmente definida. <br><br>  Agora, finalmente, podemos responder √† pergunta de onde v√™m os logs no sistema operacional rec√©m-instalado.  O problema √© que, ap√≥s a instala√ß√£o, a auditoria no Windows √© configurada e definida nas configura√ß√µes de auditoria salvas.  Voc√™ pode verificar isso executando o <code>auditpol /get /category:*</code> . <br><br><img src="https://habrastorage.org/webt/dx/ot/1s/dxot1swbotmghm7jxzo0zuafvcy.jpeg"><br><br>  No snap-in Diretivas B√°sicas de Auditoria do Diret√≥rio de Seguran√ßa Local, essas informa√ß√µes de auditoria n√£o s√£o exibidas, pois uma ou mais subcategorias n√£o est√£o definidas em todas as categorias.  No snap-in Diretivas Avan√ßadas de Auditoria do Diret√≥rio de Seguran√ßa Local, essas informa√ß√µes n√£o s√£o exibidas porque o snap-in funciona apenas com as configura√ß√µes de auditoria armazenadas no arquivo% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv. <br><br><h3>  Qual √© a ess√™ncia do problema? </h3><br>  A princ√≠pio, pode parecer que tudo isso n√£o √© um problema, mas n√£o √©.  O fato de todas as ferramentas mostrarem os par√¢metros de auditoria de maneiras diferentes cria a oportunidade de manipula√ß√£o maliciosa de pol√≠ticas e, como resultado, resultados de auditoria. <br><br>  <b>Considere o cen√°rio prov√°vel</b> <br><br>  Deixe uma esta√ß√£o de trabalho tecnol√≥gica baseada no Windows 7 funcionar na rede corporativa. <br><br>  A m√°quina n√£o est√° inclu√≠da no dom√≠nio e executa as fun√ß√µes de um rob√¥ que envia relat√≥rios diariamente √†s autoridades reguladoras.  Os invasores, de uma forma ou de outra, t√™m acesso remoto a ele com direitos de administrador.  Ao mesmo tempo, o principal objetivo dos invasores √© a espionagem, e a tarefa √© permanecer sem ser detectada no sistema.  Os invasores decidiram secretamente que n√£o deveria haver eventos com o c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4719 "Altera√ß√µes</a> na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pol√≠tica de auditoria"</a> no log de seguran√ßa, para desativar a auditoria de acesso a arquivos, mas ao mesmo tempo em que todas as ferramentas administrativas dizem que a auditoria est√° ativada.  Para realizar a tarefa, eles executaram as seguintes a√ß√µes: <br><br><ol><li>  Na esta√ß√£o de trabalho atacada, eles concederam permiss√µes de grava√ß√£o √† chave de registro HKEY_LOCAL_MACHINE \ SECURITY \ Policy \ PolAdtEv e exportaram essa chave para um arquivo chamado "+ fs.reg". </li><li>  Importamos esse arquivo em outro computador, reinicializamos e desativamos a auditoria do sistema de arquivos usando o auditpol, ap√≥s o qual exportamos a chave de registro acima para o arquivo "-fs.reg". </li><li>  Na m√°quina atacada, o arquivo "-fs.reg" foi importado para o registro. </li><li>  Fizemos backup do arquivo% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv localizado na m√°quina atacada e, em seguida, removemos a subcategoria Sistema de Arquivos. </li><li>  Eles reinicializaram a esta√ß√£o de trabalho atacada e substitu√≠ram o arquivo% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv por uma c√≥pia de backup salva anteriormente e tamb√©m importaram o arquivo "+ fs.reg" </li></ol><br>  Como resultado de todas essas manipula√ß√µes, n√£o h√° entradas de altera√ß√£o de pol√≠tica no log de seguran√ßa, todas as ferramentas mostram que a auditoria est√° ativada, mas, na verdade, n√£o funciona. <br><br><h2>  Problema n¬∫ 2. Log de opera√ß√µes malsucedidas para excluir arquivos, diret√≥rios e chaves do Registro </h2><br>  <i>O problema foi confirmado no Windows 7/10 / Server 2019.</i> <br><br><h3>  Descri√ß√£o do problema </h3><br>  Para uma opera√ß√£o excluir um arquivo, diret√≥rio ou chave do registro, o sistema operacional gera uma sequ√™ncia de eventos com os c√≥digos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4663</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4660</a> .  O problema √© que, em todo o fluxo de eventos, esse casal n√£o √© t√£o f√°cil de se conectar.  Para isso, os eventos analisados ‚Äã‚Äãdevem ter os seguintes par√¢metros: <br><br>  <i>Evento 1. C√≥digo 4663 "Foi feita uma tentativa de obter acesso ao objeto."</i>  Par√¢metros do evento: <br>  "ObjectType" = Arquivo. <br>  "ObjectName" = nome do arquivo ou diret√≥rio a ser exclu√≠do. <br>  "HandleId" = identificador para o arquivo a ser exclu√≠do. <br>  ‚ÄúAcessMask‚Äù = 0x10000 (este c√≥digo corresponde √† opera√ß√£o DELETE. Voc√™ pode encontrar a descriptografia de todos os c√≥digos de opera√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no site da Microsoft</a> ). <br><br><img src="https://habrastorage.org/webt/ez/it/6z/ezit6zapdorhyh5blpomzppv1dc.jpeg"><br><br>  <i>Evento 2. C√≥digo 4660 "Objeto exclu√≠do".</i> <br>  Par√¢metros do evento: <br><br>  "HandleId" = "Eventos HandleId 1" <br>  "System \ EventRecordID" = "System \ EventRecordID do evento 1" + 1. <br><br><img src="https://habrastorage.org/webt/qy/bj/6a/qybj6a3724rrph9wsqki1bpcntm.jpeg"><br><br>  Com a remo√ß√£o da chave do registro (chave), tudo fica igual, apenas no primeiro evento com o c√≥digo 4663, o par√¢metro "ObjectType" = Chave. <br><br>  Observe que a remo√ß√£o de valores no registro √© descrita por outro evento (c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4657</a> ) e n√£o causa esses problemas. <br><br><h3>  Recursos de exclus√£o de arquivos no Windows 10 e Server 2019 </h3><br>  No Windows 10 / Server 2019, existem duas maneiras de excluir um arquivo. <br><br><ol><li>  Se o arquivo for exclu√≠do para a lixeira, ent√£o, como antes, a sequ√™ncia de eventos 4663 e 4660. </li><li>  Se o arquivo for exclu√≠do permanentemente (ap√≥s a lixeira), em seguida, com um √∫nico evento com o c√≥digo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">4659</a> . </li></ol><br>  Aconteceu uma coisa estranha.  Se antes, para determinar os arquivos exclu√≠dos, era necess√°rio monitorar a totalidade dos eventos 4663 e 4660, agora a Microsoft ‚Äúfoi conhecer usu√°rios‚Äù e, em vez de dois eventos, agora precisamos monitorar tr√™s.  Tamb√©m √© importante notar que o procedimento para excluir diret√≥rios n√£o foi alterado, pois, como antes, consiste em dois eventos 4663 e 4660. <br><br><h3>  Qual √© a ess√™ncia do problema? </h3><br>  O problema √© que descobrir quem excluiu o arquivo ou diret√≥rio se torna uma tarefa n√£o trivial.  Em vez de procurar banalmente o evento correspondente no log de seguran√ßa, √© necess√°rio analisar a sequ√™ncia de eventos, o que √© bastante trabalhoso fazer manualmente.  No habr, mesmo sobre isso, havia um artigo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Auditando a remo√ß√£o e acesso a arquivos e registrando eventos em um arquivo de log usando o Powershell"</a> . <br><br><h2>  Problema n√∫mero 3 (cr√≠tico).  Registro malsucedido da opera√ß√£o de renomea√ß√£o de arquivos, diret√≥rios e chaves do Registro </h2><br>  <i>O problema foi confirmado no Windows 7/10 / Server 2019.</i> <br><br><h3>  Descri√ß√£o do problema </h3><br>  Esse problema possui dois subproblemas: <br><br><ol><li>  Nos eventos gerados pelo sistema durante a renomea√ß√£o, o novo nome do objeto n√£o √© corrigido em nenhum lugar. </li><li>  O procedimento de renomea√ß√£o √© muito semelhante √† exclus√£o.  S√≥ pode ser distinguido pelo fato de o primeiro evento com o c√≥digo 4663, com o par√¢metro "AcessMask" = 0x10000 (DELETE) <b>, n√£o possuir o</b> evento 4660. </li></ol><br>  Vale ressaltar que, com rela√ß√£o ao registro, esse problema se aplica apenas a chaves.  A renomea√ß√£o de valores no registro √© descrita por uma sequ√™ncia de eventos 4657 e n√£o causa essas reclama√ß√µes, embora, √© claro, seria muito mais conveniente se houvesse apenas um evento. <br><br><h3>  Qual √© a ess√™ncia do problema? </h3><br>  Al√©m da dificuldade de procurar opera√ß√µes de renomea√ß√£o de arquivos, esse recurso do di√°rio n√£o permite rastrear o ciclo de vida completo dos objetos do sistema de arquivos ou chaves do registro.  Como resultado, torna-se extremamente dif√≠cil determinar o hist√≥rico de um arquivo que foi renomeado v√°rias vezes em um servidor de arquivos usado ativamente. <br><br><h2>  Problema n√∫mero 4 (cr√≠tico).  N√£o foi poss√≠vel rastrear a cria√ß√£o de diret√≥rio e chave de registro </h2><br>  <i>O problema foi confirmado no Windows 7/10 / Server 2019.</i> <br><br><h3>  Descri√ß√£o do problema </h3><br>  O Windows n√£o controla a cria√ß√£o de um diret√≥rio do sistema de arquivos e uma chave do Registro.  Isso consiste no fato de o sistema operacional n√£o gerar um evento que contenha o nome do diret√≥rio ou da chave do registro criado e cujos par√¢metros indicariam que esta √© a opera√ß√£o de cria√ß√£o. <br><br>  Teoricamente, por sinais indiretos, √© poss√≠vel o fato de criar um cat√°logo.  Por exemplo, se ele foi criado atrav√©s do "Explorer", durante o processo de cria√ß√£o, ser√£o gerados eventos de pesquisa para os atributos do novo diret√≥rio.  O problema √© que, se voc√™ criar um diret√≥rio por meio do comando <code>mkdir</code> , nenhum evento ser√° gerado.  O mesmo se aplica √† cria√ß√£o de chaves no registro. <br><br><h3>  Qual √© a ess√™ncia do problema? </h3><br>  Esse problema dificulta a investiga√ß√£o de incidentes de seguran√ßa da informa√ß√£o.  N√£o h√° explica√ß√£o razo√°vel para o fato de que essas informa√ß√µes n√£o s√£o registradas nos peri√≥dicos. <br><br><h2>  Problema n√∫mero 5 (cr√≠tico).  Configura√ß√µes de auditoria incorretas nas vers√µes russas do Windows </h2><br>  <i>A presen√ßa do problema √© confirmada nas edi√ß√µes russas do Windows 7/10 / Server 2019.</i> <br><br><h3>  Descri√ß√£o do problema </h3><br>  H√° um erro nas vers√µes russas do Windows que torna o sistema de gerenciamento de auditoria de seguran√ßa inoperante. <br><br><h3>  Sintomas </h3><br>  A altera√ß√£o das pol√≠ticas de seguran√ßa avan√ßadas n√£o afeta as configura√ß√µes efetivas de auditoria ou, em outras palavras, as pol√≠ticas n√£o s√£o aplicadas.  Por exemplo, o administrador ativou a subcategoria "Logon", reinicializou o sistema, executa o <code>auditpol /get /category:*</code> e essa subcategoria permanece <code>auditpol /get /category:*</code> .  O problema √© relevante para computadores de dom√≠nio gerenciados por meio de pol√≠ticas de grupo e computadores n√£o pertencentes a dom√≠nio gerenciados usando um GPO local configurado por meio do snap-in Pol√≠ticas de Seguran√ßa Local. <br><br><h3>  Raz√µes </h3><br>  O problema surge se o administrador tiver ativado pelo menos uma das subcategorias "com falha" das pol√≠ticas de auditoria avan√ßadas.  Tais categorias com falha, em particular, incluem: <br><br><ol><li>  Uso de direitos -&gt; Audite o uso de direitos que afetam dados confidenciais.  GUID: {0cce9228-69ae-11d9-bed3-505054503030}. </li><li>  Uso de direitos -&gt; Audite o uso de direitos que n√£o afetam dados confidenciais.  GUID: {0cce9229-69ae-11d9-bed3-505054503030}. </li><li>  Acesso a objetos -&gt; Auditar eventos criados por aplicativos.  GUID: {0cce9222-69ae-11d9-bed3-505054503030}. </li></ol><br><h3>  Recomenda√ß√µes para resolver o problema </h3><br>  Se o problema ainda n√£o ocorreu, n√£o ative as subcategorias indicadas "com falha".  Se os eventos dessas subcategorias forem muito necess√°rios, use o utilit√°rio auditpol para ativ√°-los ou gerenciar a auditoria usando pol√≠ticas b√°sicas. <br><br>  Se ocorrer um problema, voc√™ deve: <br><br><ol><li>  No diret√≥rio de diretivas de grupo de dom√≠nio, exclua o arquivo \ Machine \ microsoft \ windows nt \ Audit \ audit.csv </li><li>  Em todos os computadores com problemas de auditoria, exclua os arquivos:% SystemRoot% \ security \ audit \ audit.csv,% SystemRoot% \ System32 \ GroupPolicy \ Machine \ Microsoft \ Windows NT \ Audit \ audit.csv </li></ol><br><h3>  Qual √© a ess√™ncia do problema? </h3><br>  A presen√ßa desse problema reduz o n√∫mero de eventos de seguran√ßa que podem ser monitorados regularmente por meio de pol√≠ticas de auditoria avan√ßadas e tamb√©m cria amea√ßas para desconectar, bloquear e desestabilizar o gerenciamento do sistema de auditoria na rede corporativa. <br><br><h2>  Problema n√∫mero 6 (cr√≠tico).  Droga "Novo texto document.txt ... e tamb√©m Novo bitmap.bmp" </h2><br>  <i>O problema foi confirmado no Windows 7. O problema est√° ausente no Windows 10 / Server 2019.</i> <br><br><h3>  Descri√ß√£o do problema </h3><br>  Este √© um problema muito estranho que foi descoberto por acidente.  A ess√™ncia do problema √© que o sistema operacional possui uma brecha que permite ignorar a auditoria de cria√ß√£o de arquivos. <br><br>  <b>Parte preparat√≥ria:</b> <br><br><ol><li>  Fa√ßa um Windows 7 instalado recentemente. </li><li>  Redefina todas as configura√ß√µes de auditoria usando o comando <code>auditpol /clear</code> .  Este item √© opcional e serve apenas para a conveni√™ncia de analisar revistas. </li><li>  Configuramos a auditoria do sistema de arquivos executando <code>auditpol /set /subcategory:" "</code> . </li><li>  Vamos criar o diret√≥rio C: \ TEST e atribuir par√¢metros de auditoria para a conta "Tudo": "Criar arquivos / gravar dados", "Criar pastas / gravar dados", "Escrever atributos", "Escrever atributos", "Escrever atributos adicionais", "Excluir subpastas e arquivos ‚Äù,‚Äú Excluir ‚Äù,‚Äú Altera√ß√£o de permiss√µes ‚Äù,‚Äú Altera√ß√£o de propriedade ‚Äù, ou seja, tudo relacionado √† grava√ß√£o de dados no sistema de arquivos. </li></ol><br>  Para maior clareza, antes de cada experimento, limparemos o log de seguran√ßa do sistema operacional. <br><br>  <b>Experi√™ncia 1.</b> <br>  <b>N√≥s fazemos:</b> <br><br>  Na linha de comando, execute o comando: <code>echo &gt; "c:\test\  .txt"</code> <br>  <b>Observamos:</b> <br><br>  Ap√≥s a cria√ß√£o do arquivo, um evento com o c√≥digo 4663 apareceu no log de seguran√ßa, contendo o nome do arquivo sendo criado no campo "ObjectName" e 0x2 no campo "AccessMask" ("Gravando dados ou adicionando um arquivo"). <br><br><img src="https://habrastorage.org/webt/k3/cn/6l/k3cn6ltuqg-gclek4pgtn7u_tea.jpeg"><br><br>  Para executar as seguintes experi√™ncias, limpamos a pasta e o log de eventos. <br><br>  <b>Experi√™ncia 2.</b> <br>  <b>N√≥s fazemos:</b> <br><br>  Abra a pasta C: \ TEST atrav√©s do Explorer e use o menu de contexto "Criar -&gt; Documento de Texto", chamado clicando com o bot√£o direito do mouse, crie o arquivo "New Text Document.txt". <br><br><img src="https://habrastorage.org/webt/cc/nh/gj/ccnhgj_6_2xrciyj4m6ubv9hmpk.jpeg"><br><br>  <b>Observamos:</b> <br><br>  Esta a√ß√£o n√£o foi refletida no log de eventos !!!  Al√©m disso, n√£o haver√° entradas se voc√™ usar o mesmo menu de contexto para criar um "Bitmap". <br><br><img src="https://habrastorage.org/webt/-y/52/4b/-y524b96wuzs9eszx5cybyrwsdk.jpeg"><br><br>  <b>Experi√™ncia 3.</b> <br>  <b>N√≥s fazemos:</b> <br><br>  Usando o Explorer, abra a pasta C: \ TEST e, no menu de contexto "Criar -&gt; Documento no formato RTF", chamado clicando com o bot√£o direito do mouse, crie o arquivo "Novo documento no formato RTF.rtf". <br><br>  <b>Observamos:</b> <br><br>  Como no caso da cria√ß√£o do arquivo por meio da linha de comando, um evento com o c√≥digo 4663 e o conte√∫do correspondente apareceu no log. <br><br><img src="https://habrastorage.org/webt/de/pf/wq/depfwqhwv1umoii77gpofddmoro.jpeg"><br><br><h3>  Qual √© a ess√™ncia do problema? </h3><br>  Obviamente, criar documentos de texto ou imagens n√£o √© particularmente prejudicial.  No entanto, se o "Explorer" puder ignorar o log de opera√ß√µes de arquivo, o malware poder√° fazer isso. <br><br>  Esse problema √© talvez o mais significativo de todos os considerados, pois prejudica seriamente a credibilidade dos resultados da auditoria das opera√ß√µes de arquivo. <br><br><h2>  Conclus√£o </h2><br>  A lista de problemas acima n√£o √© exaustiva.  No processo, conseguimos encontrar um n√∫mero ainda bastante grande de v√°rias falhas menores, que incluem o uso de constantes localizadas como valores de par√¢metros para v√°rios eventos, o que nos obriga a escrever nossos scripts de an√°lise para cada localiza√ß√£o do sistema operacional, a divis√£o il√≥gica dos c√≥digos de eventos em opera√ß√µes com significado pr√≥ximo. por exemplo, excluir uma chave do registro √© uma sequ√™ncia de eventos 4663 e 4660 e excluir um valor no registro √© 4657, bem, e at√© as pequenas coisas ... <br><br>  Para ser sincero, observamos que, apesar de todas as defici√™ncias, o sistema de registro de eventos de seguran√ßa no Windows tem um grande n√∫mero de aspectos positivos.  Corrigir os problemas cr√≠ticos listados aqui pode devolver a coroa a uma solu√ß√£o melhor para registrar eventos de seguran√ßa imediatamente. <br><br>  FA√áA O LOGIN DE EVENTOS DE SEGURAN√áA DO WINDOWS NOVAMENTE! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt476464/">https://habr.com/ru/post/pt476464/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt476450/index.html">Vis√£o geral do cPanel - um console baseado na Web para gerenciar sites e hospedagem</a></li>
<li><a href="../pt476452/index.html">Armazenamento de valor-chave ou como nossos aplicativos se tornaram mais convenientes</a></li>
<li><a href="../pt476454/index.html">O 5G est√° chegando: quais empresas garantir√£o a introdu√ß√£o de novas tecnologias em 2020</a></li>
<li><a href="../pt476456/index.html">O sistema de cr√©dito social chin√™s n√£o √©, antes de tudo, um sistema de avalia√ß√£o de cidad√£os, mas uma API massiva</a></li>
<li><a href="../pt476460/index.html">O primeiro formato de arquivo de sucesso na Internet n√£o foi o MP3, mas o MIDI</a></li>
<li><a href="../pt476466/index.html">O livro "Arquitetos da intelig√™ncia"</a></li>
<li><a href="../pt476468/index.html">Novo curso online gratuito de an√°lise de texto de rede neural da Samsung</a></li>
<li><a href="../pt476474/index.html">Devolvemos o Keenetic no suporte KN-1310 do modem usb</a></li>
<li><a href="../pt476476/index.html">Exibir o Gmail apenas em html</a></li>
<li><a href="../pt476478/index.html">Etapas da introdu√ß√£o de modelos de aprendizado de m√°quina em grandes empresas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>