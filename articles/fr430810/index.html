<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔞 📔 ⏪ Test de charge avec criquet. 2e partie 🙎🏾 🤳 👩🏻‍✈️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pour ceux qui ont aimé mon article précédent , je continue à partager mes impressions sur l'outil de test de stress acridien. 

 Je vais essayer de dé...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Test de charge avec criquet. 2e partie</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/infopulse/blog/430810/">  Pour ceux qui ont aimé mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article précédent</a> , je continue à partager mes impressions sur l'outil de test de stress acridien. <br><br>  Je vais essayer de démontrer clairement les avantages de l'écriture d'un python de test de charge avec du code dans lequel vous pouvez facilement préparer toutes les données pour le test et traiter les résultats. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/decfhwQPd9E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br><h2>  Traitement des réponses du serveur </h2><br>  Parfois, lors des tests de charge, il ne suffit pas d'obtenir simplement 200 OK du serveur HTTP.  Arrive, il est nécessaire de vérifier le contenu de la réponse pour s'assurer que sous charge le serveur émet les données correctes ou effectue des calculs précis.  Juste pour de tels cas, Locust a ajouté la possibilité de remplacer les paramètres de réussite de la réponse du serveur.  Prenons l'exemple suivant: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> rnd <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_albums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> photo_id = rnd.randint(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">5000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">f'/photos/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{photo_id}</span></span></span><span class="hljs-string">'</span></span>, catch_response=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, name=<span class="hljs-string"><span class="hljs-string">'/photos/[id]'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> response: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> response.status_code == <span class="hljs-number"><span class="hljs-number">200</span></span>: album_id = response.json().get(<span class="hljs-string"><span class="hljs-string">'albumId'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> album_id % <span class="hljs-number"><span class="hljs-number">10</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>: response.success() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'album id cannot be </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{album_id}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: response.failure(<span class="hljs-string"><span class="hljs-string">f'status code is </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{response.status_code}</span></span></span><span class="hljs-string">'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  Il n'a qu'une seule demande, ce qui créera une charge dans le scénario suivant: <br><blockquote>  À partir du serveur, nous demandons des objets photos avec un identifiant aléatoire compris entre 1 et 5000 et vérifions l'identifiant de l'album dans cet objet, en supposant qu'il ne peut pas être un multiple de 10 <br></blockquote>  Ici, vous pouvez immédiatement donner quelques explications: <br><br><ul><li>  la construction impressionnante <i>avec request () comme réponse:</i> vous pouvez le remplacer avec succès par <i>response = request ()</i> et travailler tranquillement avec l'objet de réponse </li><li>  L'URL est formée en utilisant la syntaxe de format de chaîne ajoutée en python 3.6, si je ne me trompe pas - <i>f '/ photos / {photo_id}'</i> .  Dans les versions précédentes, cette conception ne fonctionnera pas! </li><li>  un nouvel argument que nous n'avions pas utilisé auparavant, <i>catch_response = True</i> , indique à Locust que nous déterminerons nous-mêmes le succès de la réponse du serveur.  Si vous ne le spécifiez pas, nous recevrons l'objet réponse de la même manière et nous pourrons traiter ses données, mais pas redéfinir le résultat.  Voici un exemple détaillé. </li><li>  Un autre <i>nom d'</i> argument <i>= '/ photos / [id]'</i> .  Il est nécessaire de regrouper les demandes en statistiques.  Le nom peut être n'importe quel texte, la répétition de l'url n'est pas nécessaire.  Sans cela, chaque demande avec une adresse ou des paramètres uniques sera enregistrée séparément.  Voici comment cela fonctionne: <br></li></ul><br><img src="https://habrastorage.org/webt/ai/fm/ca/aifmcaycbzv9khpohj5sxjcohgo.png"><br>  En utilisant le même argument, vous pouvez effectuer une autre astuce - il arrive parfois qu'un service avec différents paramètres (par exemple, différents contenus de requêtes POST) exécute une logique différente.  Pour que les résultats du test ne se mélangent pas, vous pouvez écrire plusieurs tâches distinctes, en spécifiant pour chacune son propre <i>nom d'</i> argument. <br><br>  Ensuite, nous faisons les vérifications.  J'en ai 2. Tout d'abord, nous vérifions que le serveur a retourné une réponse si <i>response.status_code == 200</i> : <br><br>  Si oui, vérifiez si l'ID de l'album est un multiple de 10. Si ce n'est pas un multiple, marquez cette réponse comme une <i>réponse réussie.success ()</i> <br><br>  Dans d'autres cas, nous indiquons pourquoi la réponse a échoué <i>response.failure («texte d'erreur»)</i> .  Ce texte sera affiché sur la page Échecs pendant le test. <br><br><img src="https://habrastorage.org/webt/52/se/dt/52sedt-fqe0jhasmdnq3k94ia7m.png"><br><br>  De plus, les lecteurs attentifs pourraient remarquer l'absence d'exceptions caractéristiques du code qui fonctionne avec les interfaces réseau.  En effet, en cas de timeout, erreur de connexion et autres incidents imprévus, Locust traitera les erreurs et restituera toujours une réponse, indiquant cependant que le statut du code de réponse est 0. <br><br>  Si le code lève toujours une exception, il sera écrit dans l'onglet Exceptions au moment de l'exécution afin que nous puissions le gérer.  La situation la plus typique est que le json'e de la réponse n'a pas retourné la valeur que nous recherchions, mais nous y effectuons déjà les opérations suivantes. <br><br>  Avant de fermer le sujet - dans l'exemple, j'utilise le serveur json pour plus de clarté, car il est plus facile de traiter les réponses.  Mais vous pouvez travailler avec le même succès avec HTML, XML, FormData, les pièces jointes et autres données utilisées par les protocoles HTTP. <br><br><h2>  Travailler avec des scénarios complexes </h2><br>  Presque chaque fois que la tâche consiste à effectuer des tests de charge d'une application Web, il devient rapidement clair qu'il est impossible de fournir une couverture décente avec les seuls services GET - qui renvoient simplement des données. <br><br>  Exemple classique: pour tester une boutique en ligne, il est souhaitable que l'utilisateur <br><br><ol><li>  Ouverture du magasin principal </li><li>  Je cherchais des marchandises </li><li>  Détails des éléments ouverts </li><li>  Article ajouté au panier </li><li>  Payé </li></ol><br>  À partir de l'exemple, nous pouvons supposer que les services d'appel dans un ordre aléatoire ne fonctionneront pas, uniquement de manière séquentielle.  De plus, les marchandises, les paniers et les modes de paiement peuvent avoir des identifiants uniques pour chaque utilisateur. <br><br>  En utilisant l'exemple précédent, avec des modifications mineures, vous pouvez facilement implémenter le test d'un tel scénario.  Nous adaptons l'exemple pour notre serveur de test: <br><br><ol><li>  L'utilisateur écrit un nouveau message. </li><li>  L'utilisateur écrit un commentaire sur le nouveau message </li><li>  L'utilisateur lit le commentaire </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlowException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_flow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># step 1 new_post = {'userId': 1, 'title': 'my shiny new post', 'body': 'hello everybody'} post_response = self.client.post('/posts', json=new_post) if post_response.status_code != 201: raise FlowException('post not created') post_id = post_response.json().get('id') # step 2 new_comment = { "postId": post_id, "name": "my comment", "email": "test@user.habr", "body": "Author is cool. Some text. Hello world!" } comment_response = self.client.post('/comments', json=new_comment) if comment_response.status_code != 201: raise FlowException('comment not created') comment_id = comment_response.json().get('id') # step 3 self.client.get(f'/comments/{comment_id}', name='/comments/[id]') if comment_response.status_code != 200: raise FlowException('comment not read') class WebsiteUser(HttpLocust): task_set = UserBehavior min_wait = 1000 max_wait = 2000</span></span></code> </pre> <br>  Dans cet exemple, j'ai ajouté une nouvelle classe <b>FlowException</b> .  Après chaque étape, si cela ne s'est pas passé comme prévu, je lance cette classe d'exception pour abandonner le script - si le message n'a pas fonctionné, il n'y aura rien à commenter, etc.  Si vous le souhaitez, la construction peut être remplacée par le <b>retour</b> habituel, mais dans ce cas, au moment de l'exécution et lors de l'analyse des résultats, il ne sera pas si clair où le script exécuté se trouve dans l'onglet Exceptions.  Pour la même raison, je n'utilise pas la <b>méthode try ... except</b> . <br><br><h2>  Rendre la charge réaliste </h2><br>  Maintenant, on peut me reprocher - dans le cas de la boutique, tout est vraiment linéaire, mais l'exemple des articles et des commentaires est trop tiré par les cheveux - ils lisent les articles 10 fois plus souvent qu'ils n'en créent.  Raisonnablement, rendons l'exemple plus viable.  Et il y a au moins 2 approches: <br><br><ol><li>  Vous pouvez «coder en dur» la liste des publications que les utilisateurs lisent et simplifier le code de test s'il y a une telle possibilité et la fonctionnalité du backend ne dépend pas de publications spécifiques </li><li>  Enregistrez les articles créés et lisez-les s'il n'est pas possible de prédéfinir la liste des articles ou la charge réaliste dépend des articles lus (j'ai supprimé la création de commentaires de l'exemple pour rendre son code plus petit et plus visuel) </li></ol><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> r <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> created_posts = [] @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> new_post = {<span class="hljs-string"><span class="hljs-string">'userId'</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span>: <span class="hljs-string"><span class="hljs-string">'my shiny new post'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'hello everybody'</span></span>} post_response = self.client.post(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, json=new_post) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post_response.status_code != <span class="hljs-number"><span class="hljs-number">201</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = post_response.json().get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) self.created_posts.append(post_id) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_post</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(self.created_posts) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post_id = r.choice(self.created_posts) self.client.get(<span class="hljs-string"><span class="hljs-string">f'/posts/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{post_id}</span></span></span><span class="hljs-string">'</span></span>, name=<span class="hljs-string"><span class="hljs-string">'read post'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  Dans la classe <b>UserBehavior,</b> j'ai créé une liste <b>created_posts</b> .  Faites particulièrement attention - il s'agit d'un objet qui n'a pas été créé dans le constructeur de la <b>classe __init __ (), par</b> conséquent, contrairement à la session client, cette liste est commune à tous les utilisateurs.  La première tâche crée un article et écrit son identifiant dans la liste.  Le second - 10 fois plus souvent, lit un article sélectionné au hasard dans la liste.  Une condition supplémentaire de la deuxième tâche consiste à vérifier s'il existe des postes créés. <br><br>  Si nous voulons que chaque utilisateur ne fonctionne qu'avec ses propres données, nous pouvons les déclarer dans le constructeur comme suit: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, parent)</span></span></span><span class="hljs-function">:</span></span> super(UserBehavior, self).__init__(parent) self.created_posts = list()</code> </pre> <br><h2>  Quelques fonctionnalités supplémentaires </h2><br>  Pour le lancement séquentiel des tâches, la documentation officielle suggère que nous utilisons également l'annotation de tâche @seq_task (1), en spécifiant le numéro de série de la tâche dans l'argument <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTaskSequence</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSequence)</span></span></span><span class="hljs-class">:</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">first_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">second_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> @seq_task(<span class="hljs-number"><span class="hljs-number">3</span></span>) @task(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">third_task</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br>  Dans cet exemple, chaque utilisateur exécutera d'abord <b>first_task</b> , puis <b>second_task</b> , puis 10 fois <b>third_task</b> . <br><br>  Franchement, la disponibilité d'une telle opportunité plaît, mais, contrairement aux exemples précédents, il n'est pas clair comment transférer les résultats de la première tâche à la seconde si nécessaire. <br><br>  De plus, pour des scénarios particulièrement complexes, il est possible de créer des ensembles de tâches imbriqués, en fait, en créant plusieurs classes TaskSet et en se connectant entre elles. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> locust <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HttpLocust, TaskSet, task <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Todo</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/todos"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.interrupt() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserBehavior</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(TaskSet)</span></span></span><span class="hljs-class">:</span></span> tasks = {Todo: <span class="hljs-number"><span class="hljs-number">1</span></span>} @task(<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) @task(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">posts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.client.get(<span class="hljs-string"><span class="hljs-string">"/posts"</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebsiteUser</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(HttpLocust)</span></span></span><span class="hljs-class">:</span></span> task_set = UserBehavior min_wait = <span class="hljs-number"><span class="hljs-number">1000</span></span> max_wait = <span class="hljs-number"><span class="hljs-number">2000</span></span></code> </pre> <br>  Dans l'exemple ci-dessus, avec une probabilité de 1 à 6, le script <b>Todo</b> sera lancé et sera exécuté jusqu'à ce que, avec une probabilité de 1 à 4, il revienne au script <b>UserBehavior</b> .  Il est très important que vous <b>appeliez self.interrupt ()</b> - sans cela, les tests se concentreront sur la sous-tâche. <br><br>  Merci d'avoir lu.  Dans le dernier article, j'écrirai sur les tests distribués et les tests sans interface utilisateur, ainsi que sur les difficultés que j'ai rencontrées lors des tests avec Locust et comment les contourner. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr430810/">https://habr.com/ru/post/fr430810/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr430800/index.html">Création du jeu «Like Coins» sur Godot Engine. 2e partie</a></li>
<li><a href="../fr430802/index.html">PMI RU: Etude des salaires des chefs de projets en Russie pour 2017</a></li>
<li><a href="../fr430804/index.html">Les batteries Tesla / Panasonic sont les batteries de véhicules électriques les plus abordables du marché</a></li>
<li><a href="../fr430806/index.html">Nous avons commencé à apprendre l'anglais - écrit une application: EWM - expérience dans la création d'un projet de formation</a></li>
<li><a href="../fr430808/index.html">Théorie des conférenciers: 16 documents sur le fonctionnement des conférenciers et des conférenciers</a></li>
<li><a href="../fr430812/index.html">Qu'est-ce que developer.android.com parle de RecyclerView</a></li>
<li><a href="../fr430818/index.html">Accélération SQLAlchemy pour les astronautes architecturaux</a></li>
<li><a href="../fr430820/index.html">Black Friday 2018 - VDS à Moscou et Amsterdam</a></li>
<li><a href="../fr430822/index.html">Sécurité de l'information de l'Internet des objets: qui est la chose et qui est le maître?</a></li>
<li><a href="../fr430824/index.html">Rechercher un objet endommagé par numéro de page endommagé dans MS SQL Server 2005</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>