<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏭️ ⤵️ 📂 CI / CD dengan AWS dan Bambu 👩‍🌾 🤾🏻 🆔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tim kami terdiri dari satu pengembang dan satu insinyur DevOps. Saya bertanggung jawab untuk menyebarkan aplikasi ke kluster ECS Amazon. Sebagai serve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CI / CD dengan AWS dan Bambu</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/458648/">  Tim kami terdiri dari satu pengembang dan satu insinyur DevOps.  Saya bertanggung jawab untuk menyebarkan aplikasi ke kluster ECS Amazon.  Sebagai server CI / CD, saya menggunakan Bamboo.  Pada artikel ini, saya akan menjelaskan secara rinci bagaimana saya menggunakan aplikasi di lingkungan pengembang. <br><br><img src="https://habrastorage.org/webt/cn/bu/3w/cnbu3wmmjkhiqhwgxpuhk3pu2fc.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ev/oz/rs/evozrsbpwhmgd0zodgrz4pukurm.png"><br><br><h4>  Bangun gambar Docker </h4><br>  Di sini saya ikuti langkah-langkah ini: <br><br><ul><li>  Langkah 1: Instal dan konfigurasikan Docker; </li><li>  Langkah 2: Konfigurasikan artefak dalam Bambu; </li><li>  Langkah 3: Mengkonfigurasi repositori Amazon ECR; </li><li>  Langkah 4: Bangun gambar Docker di Bambu. </li></ul><br><h1>  Langkah 1: Instal dan Konfigurasi Docker </h1><br>  Pertama, saya memutakhirkan server tempat Bamboo diinstal, menginstal paket yang diperlukan, dan mengatur repositori Docker.  Perlu dicatat bahwa saya menginstal Bamboo pada sistem operasi CentOS 7. Informasi tentang menginstal buruh pelabuhan pada sistem operasi lain dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">www.docker.com</a> . <br><br><pre><code class="plaintext hljs">$ sudo yum update $ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 $ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code> </pre> <br>  Kemudian saya menginstal aplikasi Docker dan memulai layanan: <br><br><pre> <code class="plaintext hljs">$ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl enable docker $ sudo systemctl start docker</code> </pre><br>  Lalu saya menambahkan pengguna bambu ke grup Docker: <br><br><pre> <code class="plaintext hljs">$ sudo usermod -aG docker bamboo $ sudo su - bamboo $ docker run hello-world</code> </pre><br>  Jika, setelah menjalankan perintah ini, buruh pelabuhan merespons dengan pesan "Halo dari Docker!", Maka ini berarti instalasi saya berfungsi dengan benar. <br><br><h1>  Langkah 2. Konfigurasikan artefak dalam Bambu </h1><br>  Pengembangan aplikasi sedang berlangsung di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Grails</a> .  Saat mengompilasi aplikasi, file dengan perang ekstensi dibuat.  File ini, dalam terminologi Bambu, adalah artefak.  Konfigurasikan Bamboo untuk menggunakan file ini dalam tugas selanjutnya.  Untuk melakukan ini, saya pergi ke tab <b>Tugas</b> : <br><br><img src="https://habrastorage.org/webt/l2/xf/rh/l2xfrhlwvte_3enperkvbqadtey.png"><br><br>  Dan saya mengatur tugas Grails, seperti yang ditunjukkan di bawah ini: <br><br><img src="https://habrastorage.org/webt/ba/6l/s7/ba6ls73snayld5eazip7mcc0eg4.png"><br><br>  Kita melihat bahwa Grails pertama membersihkan folder build, kemudian menjalankan tes, dan akhirnya membuat file perang untuk lingkungan dev. <br><br>  Setelah itu, saya klik pada tab <b>Artefak</b> dan tombol <b>Buat artefak</b> : <br><br><img src="https://habrastorage.org/webt/2a/sj/am/2asjam033lqmwc9txcj_slq_5jc.png"><br><br>  Saya mendefinisikan artefak seperti yang ditunjukkan di bawah ini: <br><br><img src="https://habrastorage.org/webt/jw/_b/wb/jw_bwbdddrwx1pa1gh7etxonvys.png"><br><br>  Grails menempatkan file perang di direktori <b>build / libs</b> .  Saya akan memeriksa parameter <b>Bersama</b> , karena saya akan memerlukan artefak ini nanti. <br><br>  Sekarang saya membuat proyek penyebaran dan menetapkan artefak untuk digunakan dalam rencana pembangunan saya: <br><br><img src="https://habrastorage.org/webt/y7/fs/uf/y7fsufkg7rsi-6d3i-hfk8o6rlc.png"><br><br><img src="https://habrastorage.org/webt/s7/nf/tu/s7nftu9r8vwudgjzi1qdtlaljpw.png"><br><br>  Saya juga mengatur tugas <b>unduhan Artifact</b> dalam proyek penerapan: <br><br><img src="https://habrastorage.org/webt/ie/vv/uv/ievvuvkegkneya15tqd9xlcayhu.png"><br><br>  Dengan demikian, Bamboo sekarang dikonfigurasi untuk menggunakan file perang. <br><br><h1>  Langkah 3. Konfigurasikan repositori Amazon ECR </h1><br>  Amazon ECR adalah layanan penyimpanan dan manajemen Docker untuk gambar.  Untuk mengonfigurasi, buka konsol AWS dan pilih ECR: <br><br><img src="https://habrastorage.org/webt/ys/fd/1i/ysfd1ijutkdnzcugeldnemvywl4.png"><br><br>  Setelah membuat repositori, saya mendapatkan alamat berikut: <br><br><pre> <code class="plaintext hljs">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard</code> </pre><br>  Setelah menyelesaikan konfigurasi, di sini Anda juga dapat menemukan instruksi tentang cara masuk, cara mengunduh gambar dari repositori dan mengunggah gambar ke repositori. <br><br><h1>  Langkah 4: Bangun Gambar Docker di Bambu </h1><br>  Sekarang saya perlu mengkonfigurasi pemicu untuk mulai membangun gambar Docker.  Untuk melakukan ini, saya pergi ke tab <b>Pemicu</b> dan klik tombol <b>Tambahkan pemicu</b> : <br><br><img src="https://habrastorage.org/webt/ev/gq/nu/evgqnu95-my1ralvlnxrw6tx3fe.png"><br><br>  Di sini saya memilih <b>Build setelah berhasil membangun</b> opsi <b>paket</b> sehingga gambar Docker dibangun setelah mengkompilasi proyek. <br><br>  Sekarang kita perlu menambahkan tugas membangun gambar Docker.  Untuk melakukan ini, buka tab <b>Tugas</b> , klik <b>Tambahkan tugas</b> , pilih jenis <b>Docker</b> .  Masukkan deskripsi dan pilih <b>gambar Build a Docker</b> dari menu drop-down.  Di bidang <b>Repositori</b> , masukkan <br><br><pre> <code class="plaintext hljs"> aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest.</code> </pre><br>  Adapun Dockerfile, bisa seperti yang ditunjukkan di bawah ini: <br><br><pre> <code class="plaintext hljs">FROM openjdk:8-jre COPY *.war /usr/src/onboard.war WORKDIR /usr/src CMD ["/bin/bash", "-c", "java -DdataSource.url=$DATASOURCE_URL -DdataSource.username=$DATASOURCE_USERNAME -DdataSource.password=$DATASOURCE_PASSWORD -jar onboard.war"]</code> </pre><br>  Ketika Anda memulai aplikasi, Anda harus menentukan database.  Variabel lingkungan DATASOURCE_URL, DATASOURCE_USERNAME, DATASOURCE_PASSWORD digunakan untuk mengirimkan informasi ini ke aplikasi, tetapi nilainya ditentukan saat wadah dimulai. <br><br>  Ini menyelesaikan proses pengaturan untuk merakit gambar Docker dengan aplikasi.  Langkah selanjutnya adalah mengonfigurasi unduhan gambar ini ke repositori Amazon ECR. <br><br><img src="https://habrastorage.org/webt/yx/n_/3t/yxn_3t_bqhvr2azfbyaywzadhpe.png"><br><br><h4>  Unggah gambar ke Registry Wadah Elastis </h4><br>  Anda dapat menggunakan Elastic Container Registry untuk menyimpan gambar yang dikumpulkan menggunakan Bamboo.  Untuk mencapai ini, saya mengikuti langkah-langkah ini: <br><br><ul><li>  Langkah 1. Instal Pembantu Kredensial Amazon ECR Docker </li><li>  Langkah 2. Hubungkan peran IAM ke server Bamboo </li><li>  Langkah 3: Konfigurasikan pekerjaan booting gambar Docker </li></ul><br><h1>  Langkah 1. Instal Pembantu Kredensial Amazon ECR Docker </h1><br>  Untuk mengunduh gambar Docker ke Amazon ECR, Anda harus memiliki kredensial.  Kredensial ini dapat diperoleh dengan menjalankan perintah <br><br><pre> <code class="plaintext hljs">aws ecr get-login</code> </pre><br>  Namun, kredensial ini hanya berlaku selama 12 jam.  Oleh karena itu, Anda dapat menjalankan perintah di atas setiap kali sebelum mengunggah gambar ke ECR, atau menginstal ECR Docker Credential Helper, yang menjaga kredensial sementara tetap mutakhir dan masuk ke ECR.  Ikuti langkah-langkah ini untuk menginstal ECR Docker Credential Helper. <br><br>  Pertama, Anda perlu menginstal <i>git</i> dan kemudian mengkloning repositori github: <br><br><pre> <code class="plaintext hljs">$ sudo yum install git $ sudo su - bamboo $ git clone https://github.com/awslabs/amazon-ecr-credential-helper.git $ make docker</code> </pre><br>  Maka Anda perlu meletakkan baris berikut di file <i>/home/bamboo/.docker/config.json</i> : <br><br><pre> <code class="plaintext hljs">{ "credsStore": "ecr-login" }</code> </pre><br>  Dan salin aplikasi yang dikompilasi ke <i>direktori / usr / bin</i> : <br><br><pre> <code class="plaintext hljs">$ exit $ sudo cp /home/bamboo/docker-credential-ecr-login /usr/bin/</code> </pre><br><h1>  Langkah 2. Hubungkan peran IAM ke server Bamboo </h1><br>  Agar server Bamboo dapat menggunakan ECR, Anda harus membuat peran, menambahkan kebijakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AmazonEC2ContainerRegistryPowerUser</a> ke peran ini, dan kemudian melampirkan peran ini ke instance EC2 Bamboo.  Buka konsol AWS dan pilih IAM.  Selanjutnya, klik tombol <b>Buat peran</b> , pilih <b>layanan AWS</b> dan <b>EC2</b> , seperti yang ditunjukkan di bawah ini: <br><br><img src="https://habrastorage.org/webt/1o/vs/jf/1ovsjfchxa3p-bgv4y-6unnz8sk.png"><br><br>  Kemudian kita klik tombol <b>Next: Izin</b> dan pada layar berikutnya kita menemukan dan memilih kebijakan <b>AmazonEC2ContainerRegistryPowerUser</b> .  Setelah itu, kami selesai membuat peran dan melampirkannya ke server Bamboo kami. <br><br><h1>  Langkah 3: Konfigurasikan pekerjaan booting gambar Docker </h1><br>  Aplikasi yang kami buat dan kumpulkan gambar Docker dengan file perang.  Sekarang Anda perlu mengunggah gambar ini ke repositori.  Untuk melakukan ini, saya menambahkan tugas Docker lain, kali ini untuk mengunggah gambar ke repositori ECR.  Saya pergi ke tab <b>Tugas</b> , klik <b>Tambah tugas</b> , pilih jenis <b>Docker</b> .  Saya memasukkan deskripsi dan memilih <b>Push a Docker image to an Docker registry</b> dari menu drop-down.  Saya memilih <b>Custom registry</b> dan memasukkan alamat repositori di bidang <b>Repository</b> .  Untuk <b>jenis Otentikasi,</b> saya pilih <b>Gunakan kredensial asli agen</b> . <br><br>  Ini menyelesaikan proses pengaturan untuk memuat gambar Docker ke repositori Amazon ECR.  Langkah-langkah berikut menjelaskan proses mengonfigurasi kluster dan layanan untuk meluncurkan aplikasi kontainer.  Tetapi sebelum itu, Anda perlu mengonfigurasi opsi peluncuran untuk wadah.  Inilah yang akan kita lakukan sekarang. <br><br><img src="https://habrastorage.org/webt/f7/ku/os/f7kuosux7wvkojanpgoy8zd7wya.png"><br><br><h4>  Buat Definisi Tugas ECS Amazon </h4><br>  Definisi Tugas - parameter eksekusi wadah ditulis di sini.  Aplikasi kita menggunakan basis data yang parameternya ditentukan saat wadah dimulai, jadi di bagian ini kita juga akan membuat basis data.  Saya menggunakan <b>Amazon RDS</b> sebagai database, dan saya menyimpan kata sandi untuk mengakses database dalam bentuk terenkripsi di <b>AWS System Manager Parameter Store</b> .  Langkah-langkah berikut yang saya ikuti untuk membuat Definisi Tugas: <br><br><ul><li>  Langkah 1. Membuat database pada instance Amazon RDS; </li><li>  Langkah 2. Mengkonfigurasi Parameter Store AWS System Manager; </li><li>  Langkah 3. Buat Definisi Tugas. </li></ul><br><h1>  Langkah 1. Buat database pada instance Amazon RDS </h1><br>  Aplikasi kami menggunakan database PostgreSQL.  Untuk membuat database, buka konsol AWS, pilih layanan Amazon RDS, klik tombol <b>Buat database</b> , lalu pilih <b>PostgreSQL</b> sebagai mesin basis data.  Pada halaman berikutnya, saya memilih <b>Dev / Test</b> sebagai lingkungan kerja dan klik <b>Next</b> .  Kemudian saya menunjuk <b>DB instance identifier sebagai onboard-dev-db</b> , dan <b>master username</b> sebagai <b>devdbadmin</b> .  Lalu saya pergi ke halaman berikutnya untuk mengkonfigurasi VPC, grup subnet, dan grup keamanan.  Basis data ini akan digunakan pada jaringan pribadi, jadi saya pilih <b>Tidak</b> untuk parameter <b>aksesibilitas Publik</b> .  Saya memasukkan <b>devdb</b> di <b>bidang</b> <b>Nama database</b> dan klik tombol <b>Buat database</b> . <br><br><h1>  Langkah 2. Mengkonfigurasi Parameter Store AWS System Manager </h1><br>  Saya menyimpan kata sandi basis data dalam bentuk terenkripsi.  Untuk melakukan ini, buka konsol AWS dan pergi ke AWS System Manager → Sumber Daya Bersama → Toko Parameter → Buat Parameter.  Saya memasukkan <b>devdbpassword</b> sebagai <b>nama</b> parameter dan memilih <b>SecureString</b> untuk jenis parameter, lalu saya memasukkan kata sandi basis data di bidang <b>Nilai</b> . <br><br><h1>  Langkah 3. Buat Definisi Tugas </h1><br>  Amazon ECS adalah kluster tempat aplikasi wadah berjalan.  Ini menggunakan Definisi Tugas untuk menentukan parameter eksekusi untuk aplikasi kontainer.  Untuk mengatur parameter tersebut, klik tombol <b>Buat Definisi Tugas baru</b> .  Lalu saya pilih <b>Fargate</b> sebagai <b>jenis</b> startup dan beralih ke langkah berikutnya.  Di sini saya menetapkan nama sebagai <b>onboard-dev-taskdef</b> .  Untuk parameter <b>bidang peran IAM pelaksanaan</b> tugas, pilih <b>Buat peran baru</b> .  Adapun sumber daya yang dialokasikan untuk aplikasi ini, saya menetapkan 2 GB memori dan 1 vCPU.  Sekarang Anda perlu menambahkan opsi peluncuran kontainer.  Saya akan <b>beri</b> nama container <b>onboard-dev-container</b> .  Saya akan memberi nama nama gambar seperti ini: <br><br>  <i>aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest</i> .  Pembantu Kredensial Amazon ECR Docker akan menangani autentikasi ECR, jadi saya membiarkan opsi <b>otentikasi repositori Pribadi</b> tidak dicentang.  Di lingkungan dev, aplikasi tersedia di port 8080, jadi untuk parameter pemetaan port saya menulis <b>8080</b> dan pilih protokol <b>tcp</b> .  Parameter URL Database, nama pengguna, dan kata sandi diteruskan ke wadah menggunakan variabel lingkungan.  Saya mengatur parameter ini di bagian variabel Lingkungan.  Untuk mendapatkan nilai parameter <b>devdbpassword</b> dari Parameter Store, saya menentukan tipe <b>ValueFrom</b> .  Hal terakhir yang saya konfigurasikan adalah konfigurasi <b>Log</b> , di sini saya pilih <b>Auto-configure CloudWatch Logs</b> .  Sekarang pembuatan Definisi Tugas selesai. <br><br>  Namun, peran ecsTaskExecutionRole memerlukan kebijakan untuk mendapatkan devdbpassword dari Parameter Store.  Untuk melakukannya, buka Peran IAM dan pilih ecsTaskExecutionRole, klik <b>Tambahkan kebijakan sebaris</b> .  Dalam hal ini, saya menambahkan menggunakan editor visual.  Oleh karena itu, di bidang Layanan saya masuk ke <b>System Manager</b> , di bidang Tindakan - <b>GetParameters</b> .  Lalu saya klik <b>Tambahkan ARN</b> untuk bidang Sumber Daya dan isi nilai saya: <br><br><img src="https://habrastorage.org/webt/2j/wd/6r/2jwd6r5dpp41jbjj4g7gctfeafw.png"><br><br>  Pada akhirnya, saya melihat nilai-nilai parameter yang ditetapkan dengan mengklik Tinjau kebijakan, berikan nama dan selesai bekerja dengan konfigurasi ecsTaskExecutionRole. <br><br>  Ini melengkapi konfigurasi pengaturan aplikasi wadah peluncuran.  Sekarang Anda perlu membuat kluster dan layanan ECS. <br><br><img src="https://habrastorage.org/webt/0k/u7/xn/0ku7xnp7bctypewbbcwyzdda_-y.png"><br><br><h4>  Buat Layanan ECS Amazon </h4><br>  Aplikasi kontainer kami berjalan sebagai layanan di kluster ECS.  Untuk mengonfigurasi, Anda harus melakukan langkah-langkah berikut: <br><br><ul><li>  Langkah 1. Buat kluster Amazon ECS; </li><li>  Langkah 2: Membuat Layanan </li></ul><br><h1>  Langkah 1. Buat Amazon ECS Cluster </h1><br>  Untuk membuat kluster ECS, buka konsol AWS dan pilih layanan ECS.  Kemudian klik <b>Buat Cluster</b> dan pilih templat klaster <b>hanya Jaringan</b> .  Pada halaman berikutnya, saya menamakan cluster sebagai <b>onboard-dev-cluster</b> dan menyelesaikan cluster.  Sekarang saya memiliki klaster ECS berbasis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Fargate</a> . <br><br><h1>  Langkah 2: Membuat Layanan </h1><br>  Untuk membuat layanan, saya mengklik tautan <b>on-cluster-dev</b> , kemudian pergi ke tab <b>Layanan</b> dan klik tombol <b>Buat</b> .  Untuk <b>tipe peluncuran saya</b> pilih Fargate, untuk <b>Definisi Tugas saya</b> pilih onboard-dev-taskdef.  Selain itu, saya memilih onboard-dev-cluster di bidang Cluster.  Di bidang <b>Nama layanan</b> , saya menulis onboard-dev.  Saya menetapkan parameter <b>Jumlah tugas</b> ke nol, karena saya tidak ingin memulai aplikasi sekarang.  Saya membiarkan parameter <b>persen sehat minimum</b> sama dengan 100, dan <b>persen</b> <b>maksimum</b> sama dengan 200. Untuk parameter <b>tipe</b> penempatan, pilih <b>Pembaruan bergulir</b> dan pergi ke langkah berikutnya. <br><br>  Pada halaman <b>Konfigurasi Jaringan</b> , untuk parameter <b>VPC Cluster</b> , saya memilih VPC yang sebelumnya dibuat yang disebut <b>VPC Pengembangan</b> .  Aplikasi yang sedang dikembangkan hanya tersedia di jaringan pribadi, jadi saya memilih dua subnet pribadi.  Untuk mengkonfigurasi grup keamanan, saya klik tombol <b>Edit</b> , lalu pilih <b>Pilih grup keamanan yang ada</b> , kemudian grup keamanan <b>default</b> dan klik tombol <b>Simpan</b> .  Untuk parameter <b>IP publik yang ditetapkan secara otomatis</b> , saya pilih <b>Dinonaktifkan</b> .  Selanjutnya, untuk parameter <b>jenis penyeimbang beban</b> , saya memilih <b>Tidak Ada</b> dan membiarkan opsi <b>Aktifkan integrasi penemuan layanan tidak dicentang</b> .  Lalu saya klik <b>Next, Next</b> dan <b>Create service</b> . <br><br>  Sekarang saya memiliki layanan di mana jumlah pekerjaan yang berjalan adalah nol.  Kami akan mengonfigurasi peluncuran aplikasi pada langkah berikutnya. <br><br><img src="https://habrastorage.org/webt/dg/_9/er/dg_9er1txnjnjbhpkrcmn5af4lk.png"><br><br><h4>  Pembaruan Layanan </h4><br>  Segera setelah pengembang memperbarui kode aplikasi, penerapan kami melalui pembuatan gambar Docker, mengunggahnya ke Elastic Container Registry, dan akhirnya meluncurkan aplikasi kontainer sebagai layanan di ECS Fargate cluster.  Saat ini, jumlah pekerjaan yang berjalan di cluster adalah nol.  Agar aplikasi dapat dimulai, Anda perlu memperbarui layanan, menunjukkan jumlah yang sama dengan satu.  Saya mengikuti langkah-langkah ini untuk mencapai ini: <br><br><ul><li>  Langkah 1. Menginstal Tugas untuk plugin AWS Bamboo; </li><li>  Langkah 2. Memperbarui Layanan ECS </li></ul><br><h1>  Langkah 1. Menginstal Tugas untuk plugin AWS Bamboo </h1><br>  <b>Tugas untuk AWS Bamboo</b> adalah sebuah plugin yang menyederhanakan persiapan dan pengoperasian sumber daya AWS dari proyek pembangunan dan penyebaran Bamboo.  Untuk menginstal plugin ini, saya pergi ke proyek penyebaran, klik <b>Tambahkan tugas</b> , pergi ke Atlassian Marketplace dan instal <b>Tugas untuk AWS (Bambu)</b> . <br><br><h1>  Langkah 2. Memperbarui Layanan ECS </h1><br>  Sekarang dalam proyek penyebaran, saya menambahkan pekerjaan <b>Layanan ECS Amazon</b> .  Kemudian saya menulis di bidang deskripsi pekerjaan <b>Layanan Pembaruan untuk onBoard-dev</b> .  Di bidang Tindakan, pilih <b>Perbarui Layanan</b> dan <b>Paksa penyebaran baru</b> .  Lalu saya memilih US East (Ohio) sebagai wilayah peluncuran.  Kemudian saya menulis di bidang ARN (Nama Sumber Daya Amazon) yang sesuai untuk Task Definiton, cluster dan layanan.  Dalam tugas ini, saya memperbarui jumlah tugas berjalan yang diinginkan menjadi satu.  Berikutnya, saya mengisi kotak teks konfigurasi penempatan dengan nilai-nilai berikut: <br><br><pre> <code class="plaintext hljs">{ "maximumPercent": 200, "minimumHealthyPercent": 100 }</code> </pre><br>  Saya mengatur jaringan tanpa IP publik sebagai berikut: <br><br><pre> <code class="plaintext hljs">{ "awsvpcConfiguration": { "assignPublicIp": "DISABLED", "subnets": ["subnet-ID1", "subnet-ID2"], "securityGroups": ["sg-ID"] } }</code> </pre><br>  Di bagian <b>Sumber</b> untuk <b>Kredensial Keamanan AWS,</b> saya memilih <b>Peran IAM untuk EC2</b> . <br><br>  Saya harus dapat memperbarui ECS, jadi saya melampirkan kebijakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AmazonECS_FullAccess</a> ke instance Bamboo EC2 saya.  Untuk melakukan ini, buka konsol AWS, pilih IAM.  Kemudian saya memilih peran yang saya gunakan untuk server Bamboo saya.  Saya klik tombol <b>Lampirkan kebijakan</b> , saya menemukan kebijakan AmazonECS_FullAccess, saya memilih kotak centang di sebelah kiri dan selesai melampirkan kebijakan. <br><br>  Ini menyimpulkan pengaturan CI / CD menggunakan AWS dan Bamboo.  Dengan demikian, ketika pengembang memperbarui kode aplikasi, mengunggah kode ini ke repositori, pengujian dan perakitan aplikasi diluncurkan.  Kemudian gambar Docker dibangun dengan file perang aplikasi, dan gambar ini disalin ke repositori Amazon ECR.  Selanjutnya, di kluster Amazon ECS, aplikasi kontainer diluncurkan sebagai layanan, yang memperbarui aplikasi saat ini jika belum dihentikan.  Jika aplikasi dihentikan untuk menghemat sumber daya, maka aplikasi akan dimulai.  Setelah memeriksa aplikasi di lingkungan dev, Anda dapat menghentikan aplikasi dengan menentukan jumlah pekerjaan yang berjalan di cluster ke nol. <br><br>  Jika Anda menyukai artikel dan memiliki ide untuk perbaikan, tulis di komentar. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458648/">https://habr.com/ru/post/id458648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458636/index.html">Kaset video dari mitap DevLeads dari kantor Tutu.ru</a></li>
<li><a href="../id458638/index.html">Intel oneAPI Project: banyak arsitektur, satu API</a></li>
<li><a href="../id458640/index.html">Menemukan Dash Panjang</a></li>
<li><a href="../id458642/index.html">Teori bukannya heuristik: menjadi lebih baik sebagai pengembang frontend</a></li>
<li><a href="../id458646/index.html">Atom Swap Singkatnya</a></li>
<li><a href="../id458650/index.html">Tantangan Dunia Maya. Tingkat baru. Persaingan online dari Rostelecom Solar</a></li>
<li><a href="../id458652/index.html">RamblerFront & Meetup # 7</a></li>
<li><a href="../id458654/index.html">Virus Lurk meretas bank ketika ditulis oleh pekerja sewaan biasa</a></li>
<li><a href="../id458658/index.html">Beralih dari mesin virtual ke wadah LXC: alasan, keunggulan, dan instruksi yang siap digunakan</a></li>
<li><a href="../id458660/index.html">Gangguan Penggunaan Perangkat Lunak Gangguan Layanan Cloudflare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>