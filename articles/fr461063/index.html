<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòã üëÄ üöµüèæ Interaction de R avec des bases de donn√©es sur l'exemple de Microsoft SQL Server et d'autres SGBD ü§õüèΩ üßú ü§≤üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Depuis la part du lion des informations commerciales sont stock√©es dans des bases de donn√©es. Quel que soit le langage de programmation que vous √©criv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interaction de R avec des bases de donn√©es sur l'exemple de Microsoft SQL Server et d'autres SGBD</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461063/"><p>  Depuis la part du lion des informations commerciales sont stock√©es dans des bases de donn√©es.  Quel que soit le langage de programmation que vous √©crivez, vous devez effectuer diverses actions avec eux. </p><br><p>  Dans cet article, je parlerai de deux interfaces pour travailler avec des bases de donn√©es dans R. La plupart des exemples montrent qu'ils fonctionnent avec Microsoft SQL Server, cependant, tous les exemples de code fonctionneront avec d'autres bases de donn√©es, telles que: MySQL, PostgreSQL, SQLite, ClickHouse , Google BigQuery, etc. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/925/a23/786/925a23786a89917d9a314a793545cbb1.jpg" alt="image"></p><a name="habracut"></a><br><h1 id="soderzhanie">  Table des mati√®res </h1><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Logiciel requis</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Package DBI</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Liste des fonctions DBI de base</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Connectivit√© √† la base de donn√©es</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un exemple de connexion √† Microsoft SQL Server √† l'aide du package odbc</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un exemple de connexion √† Microsoft SQL Server √† l'aide du package RMSSQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Comment masquer les mots de passe de base de donn√©es dans les scripts R</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Cr√©ation de tables et √©criture dans la base de donn√©es</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lecture des donn√©es d'un SGBD</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Manipulation de donn√©es dans un SGBD (DML)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transactions dans le SGBD</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Forfait RODBC</a> <br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Fonctionnalit√©s cl√©s du package RODBC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un exemple de collaboration avec RODBC</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Transactionnel</a> </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conclusion</a> </li></ul><br><h1 id="trebuemoe-programmnoe-obespechenie">  Logiciel requis </h1><br><p>  Afin de r√©p√©ter tous les exemples d'utilisation du SGBD d√©crits dans l'article, vous aurez besoin des logiciels gratuits suivants r√©pertori√©s ci-dessous: </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Langue R</a> ; </li><li>  Environnement de d√©veloppement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RStudio</a> ; </li><li>  Syst√®me de gestion de base de donn√©es, au choix: <br>  3.1.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Microsoft SQL Server</a> <br>  3.2.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MySQL</a> <br>  3.3.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostgreSQL</a> </li></ol><br><h1 id="paket-dbi">  Package DBI </h1><br><p> Le package <code>DBI</code> est le moyen le plus populaire et le plus pratique pour interagir avec les bases de donn√©es dans R. </p><br><p>  <code>DBI</code> vous fournit un ensemble de fonctions avec lesquelles vous pouvez g√©rer des bases de donn√©es.  Mais pour vous connecter aux bases de donn√©es, vous devez installer des packages suppl√©mentaires qui sont des pilotes pour divers syst√®mes de gestion de base de donn√©es (SGBD). </p><br><h3 id="spisok-osnovnyh-funkciy-dbi">  Liste des fonctions DBI de base </h3><br><ul><li>  <code>dbConnect</code> - connexion √† la base de donn√©es; </li><li>  <code>dbWriteTable</code> - √©crit une table dans la base de donn√©es; </li><li>  <code>dbReadTable</code> - chargement d'une table √† partir d'une base de donn√©es; </li><li>  <code>dbGetQuery</code> - chargement du r√©sultat de l'ex√©cution de la requ√™te; </li><li>  <code>dbSendQuery</code> - envoi d'une requ√™te √† la base de donn√©es; </li><li>  <code>dbFetch</code> - extrait des √©l√©ments d'un jeu de r√©sultats; </li><li>  <code>dbExecute</code> - ex√©cution de demandes de mise √† jour / suppression / insertion de donn√©es dans des tables; </li><li>  <code>dbGetInfo</code> - demande des informations sur le r√©sultat de la demande ou de la connexion; </li><li>  <code>dbListFields</code> - demande d'une liste de champs de table; </li><li>  <code>dbListTables</code> - interroge une liste de tables de base de donn√©es; </li><li>  <code>dbExistsTable</code> - v√©rifie la pr√©sence d'une table dans la base de donn√©es; </li><li>  <code>dbRemoveTable</code> - supprime une table de la base de donn√©es; </li><li>  <code>dbDisconnect</code> - se d√©connecte de la base de donn√©es. </li></ul><br><h3 id="podklyuchenie-k-bazam-dannyh">  Connectivit√© √† la base de donn√©es </h3><br><p>  Pour interagir avec des bases de donn√©es, vous devez d'abord vous y connecter.  Selon le SGBD avec lequel vous pr√©voyez de travailler, vous aurez besoin d'un package suppl√©mentaire, voici une liste des plus fr√©quemment utilis√©s. </p><br><ul><li>  <code>odbc</code> - Pilote pour la connexion via l'interface ODBC; </li><li>  <code>RSQLite</code> - Pilote pour SQLite; </li><li>  <code>RMySQL</code> / <code>RMariaDB</code> - Pilote pour MySQL et MariaDB; </li><li>  <code>RPostgreSQL</code> - Pilote pour PosrtgreSQL; </li><li>  <code>bigrquery</code> - Pilote pour Google BigQuery; </li><li>  <code>RClickhouse</code> / <code>clickhouse</code> - Pilote pour ClickHouse; </li><li>  <code>RMSSQL</code> - Le pilote pour Microsoft SQL Server (MS SQL), <em>au moment de la r√©daction, n'est pr√©sent que sur GitHub</em> . </li></ul><br><p>  Le package <code>DBI</code> est fourni avec le package R de base, mais les packages qui sont des pilotes de base de donn√©es doivent √™tre install√©s √† l'aide de la commande <code>install.packages(" ")</code> . </p><br><p>  Pour installer des packages √† partir de GitHub, vous aurez √©galement besoin d'un package suppl√©mentaire - <code>devtools</code> .  Par exemple, le package <code>RMSSQL</code> n'est pas actuellement publi√© dans le r√©f√©rentiel de packages R principal, utilisez le code suivant pour l'installer: </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><h4 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-odbc">  Un exemple de connexion √† Microsoft SQL Server √† l'aide du package odbc </h4><br><p>  Avant d'utiliser un package dans une session R, il doit d'abord √™tre connect√© √† l'aide de la fonction de <code>library(" ")</code> . </p><br><p>  Ce n'est pas sans raison que j'ai choisi Microsoft SQL Server comme SGBD principal, qui fournira la plupart des exemples de cet article.  Le fait est qu'il s'agit d'une base de donn√©es assez populaire, mais en m√™me temps, elle n'a toujours pas de pilote de connexion depuis R publi√© sur CRAN. </p><br><p>  Mais heureusement, SQL Server, comme presque toutes les autres bases de donn√©es, dispose d'une interface <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ODBC</a> (English Open Database Connectivity) pour la connexion.  Il existe un certain nombre de packages pour la connexion au SGBD via l'interface ODBC dans R.  Tout d'abord, nous examinerons la connexion via le package <code>odbc</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Connexion facile √† la base de donn√©es via l'interface ODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   odbc install.packages("odbc") #   library(odbc) #   MS SQL con &lt;- dbConnect(drv = odbc(), Driver = "SQL Server", Server = "localhost", Database = "mybase", UID = "my_username", PWD = "my_password", Port = 1433)</code> </pre> </div></div><br><p>  Dans la fonction <code>dbConnect()</code> , vous devez passer la fonction, qui est le pilote de connexion au SGBD ( <code>odbc()</code> ), comme premier argument de <em>drv</em> .  Ces fonctions sont g√©n√©ralement appel√©es les m√™mes que le SGBD et sont fournies avec des packages qui sont des pilotes pour <code>DBI</code> . </p><br><p>  Ensuite, vous devez r√©pertorier les param√®tres de connexion.  Pour vous connecter √† MS SQL via ODBC, vous devez sp√©cifier les param√®tres suivants: </p><br><ul><li>  Driver - Nom du pilote ODBC; </li><li>  Serveur - adresse IP du serveur SQL; </li><li>  Base de donn√©es - Le nom de la base de donn√©es √† laquelle se connecter; </li><li>  UID - Nom d'utilisateur de la base de donn√©es; </li><li>  PWD - Mot de passe; </li><li>  Port - Le port auquel se connecter, avec SQL Server, le port par d√©faut est 1433. </li></ul><br><p>  Un pilote ODBC pour la connexion √† Microsoft SQL Server est inclus avec Windows, mais il peut avoir un nom diff√©rent.  Vous pouvez afficher la liste des pilotes install√©s dans l'administrateur de source de donn√©es ODBC.  Vous pouvez d√©marrer l'administrateur de source de donn√©es dans Windows 10 de la mani√®re suivante: </p><br><ul><li>  Version 32 bits: <code>%systemdrive%\Windows\SysWoW64\Odbcad32.exe</code> </li><li>  Version 64 bits: <code>%systemdrive%\Windows\System32\Odbcad32.exe</code> </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c6c/816/934/c6c816934a70e2386a4547d7626d515f.png"></p><br><p>  Vous pouvez √©galement obtenir une liste de tous les pilotes install√©s sur votre PC en utilisant la fonction <code>odbcListDrivers()</code> . </p><br><pre> <code class="plaintext hljs"> name attribute value &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 1 SQL Server APILevel 2 2 SQL Server ConnectFunctions YYY 3 SQL Server CPTimeout 60 4 SQL Server DriverODBCVer 03.50 5 SQL Server FileUsage 0 6 SQL Server SQLLevel 1 7 SQL Server UsageCount 1 8 MySQL ODBC 5.3 ANSI Driver UsageCount 1 9 MySQL ODBC 5.3 Unicode Driver UsageCount 1 10 Simba ODBC Driver for Google BigQuery Description Simba ODBC Driver for Google BigQuery2.0 # ... with 50 more rows</code> </pre> <br><p>  Vous pouvez t√©l√©charger des pilotes ODBC pour d'autres SGBD aux liens suivants: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">MySQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostgreSQL</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Google bigquery</a> </li></ul><br><p>  Pour diff√©rents SGBD, le nom des param√®tres de connexion peut √™tre diff√©rent, par exemple: </p><br><ul><li>  PostgreSQL / MySQL / MariaDB - utilisateur, mot de passe, h√¥te, port, dbname; </li><li>  GoogleBigQuery - projet, jeu de donn√©es; </li><li>  ClickHouse - utilisateur, mot de passe, db, port, h√¥te; </li></ul><br><p>  √Ä l'aide de l'administrateur de source de donn√©es ODBC, vous pouvez ex√©cuter l'Assistant pour cr√©er une source de donn√©es ODBC.  Pour ce faire, ouvrez simplement l'administrateur, allez dans l'onglet "DSN personnalis√©" et cliquez sur le bouton "Ajouter ...". </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9ae/e92/ba3/9aee92ba30bdc8de811623aae1fb58fa.png"></p><br><p>  Lorsque vous cr√©ez une source de donn√©es √† l'aide d'un administrateur, vous lui donnez un nom, DSN (Data Source Name). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b03/a0c/a7c/b03a0ca7c90fa0d5bddccb53575563a3.png"></p><br><p>  Dans l'exemple ci-dessus, nous avons cr√©√© une source de donn√©es avec le DSN "my_test_source".  Nous pouvons maintenant utiliser cette source pour se connecter √† Microsoft SQL Server et ne pas sp√©cifier d'autres param√®tres de connexion dans le code. </p><br><div class="spoiler">  <b class="spoiler_title">Connexion √† la base de donn√©es via l'interface ODBC √† l'aide de DSN</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password")</code> </pre> </div></div><br><p>  Vous pouvez voir les noms de toutes les sources de donn√©es ODBC cr√©√©es sur votre PC √† l'aide de la fonction <code>odbcListDataSources()</code> . </p><br><pre> <code class="plaintext hljs"> name description &lt;chr&gt; &lt;chr&gt; 1 BQ Simba ODBC Driver for Google BigQuery 2 BQ_main Simba ODBC Driver for Google BigQuery 3 BQ ODBC Simba ODBC Driver for Google BigQuery 4 OLX Simba ODBC Driver for Google BigQuery 5 Multicharts Simba ODBC Driver for Google BigQuery 6 PostgreSQL35W PostgreSQL Unicode(x64) 7 hillel_bq Simba ODBC Driver for Google BigQuery 8 blog_bq Simba ODBC Driver for Google BigQuery 9 MyClientMSSQL SQL Server 10 local_mssql SQL Server 11 MSSQL_localhost SQL Server 12 my_test_source SQL Server 13 Google BigQuery Simba ODBC Driver for Google BigQuery</code> </pre> <br><h3 id="primer-podklyucheniya-k-microsoft-sql-server-s-pomoschyu-paketa-rmssql">  Un exemple de connexion √† Microsoft SQL Server √† l'aide du package RMSSQL </h3><br><p>  <code>RMSSQL</code> pas publi√© sur CRAN, vous pouvez donc l'installer √† partir de GitHub √† l'aide du package <code>devtools</code> . </p><br><pre> <code class="plaintext hljs">install.packages("devtools") devtools::install_github("bescoto/RMSSQL")</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Exemple de connexion √† l'aide du pilote DBI RMSSQL</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#    library(RJDBC) library(RMSSQL) library(DBI) #  RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase")</code> </pre> </div></div><br><p>  Dans la plupart des cas, en utilisant le package <code>DBI</code> pour travailler avec des bases de donn√©es, vous vous connecterez de cette mani√®re.  C'est-√†-dire  installez l'un des packages de pilotes requis, en passant la fonction <code>dbConnect</code> comme valeur de l'argument <em>drv</em> , la fonction de pilote pour vous connecter au SGBD dont vous avez besoin. </p><br><div class="spoiler">  <b class="spoiler_title">Un exemple de connexion √† MySQL, PostgreSQL, SQLite et BigQuery</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   MySQL library(RMySQL) con &lt;- dbConnect(MySQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   PostrgeSQL library(RPostgreSQL) con &lt;- dbConnect(PostgreSQL(), host = 'localhost', user = 'my_username', password = 'my_password', dbname = "mybase", host = "localhost") #   SQLite library(RSQLite) # connection or create base con &lt;- dbConnect(drv = SQLite(), "localhost.db") #   Google BigQuery library(bigrquery) con &lt;- dbConnect(drv = bigquery(), project = "my_proj_id", dataset = "dataset_name")</code> </pre> </div></div><br><h3 id="kak-skryt-paroli-ot-bazy-dannyh-v-r-skriptah">  Comment masquer les mots de passe de base de donn√©es dans les scripts R </h3><br><p>  Ci-dessus, j'ai donn√© quelques exemples qui peuvent √™tre utilis√©s pour se connecter √† n'importe quelle base de donn√©es, mais il y a un inconv√©nient, sous cette forme, tous les acc√®s √† la base de donn√©es, y compris les mots de passe, sont stock√©s sous forme de texte dans les scripts eux-m√™mes. </p><br><p>  Si tous vos scripts sont d√©ploy√©s et ex√©cut√©s exclusivement localement sur votre PC et qu'ils sont prot√©g√©s par mot de passe en m√™me temps, il n'y aura probablement aucun probl√®me.  Mais si vous travaillez avec quelqu'un sur le m√™me serveur, le stockage des mots de passe des bases de donn√©es dans le texte de vos scripts n'est pas la meilleure solution. </p><br><p>  Chaque syst√®me d'exploitation dispose d'un utilitaire de gestion des informations d'identification.  Par exemple, sous Windows, il s'agit du gestionnaire d'informations d'identification.  Vous pouvez ajouter le mot de passe que vous utilisez pour vous connecter √† la base de donn√©es via le package de <code>keyring</code> - <code>keyring</code> dans ce r√©f√©rentiel.  Le package est multiplateforme et l'exemple ci-dessus fonctionnera dans n'importe quel syst√®me d'exploitation, au moins sous Windows, MacOS et Linux. </p><br><pre> <code class="plaintext hljs"># install.packages("keyring") #   library(keyring) library(RMSSQL) #   key_set_with_value(service = "mssql", username = "my_username", password = "my_password") #   RMSSQL con &lt;- dbConnect(MSSQLServer(), host = 'localhost', user = 'my_username', password = key_get("mssql", "my_username"), dbname = "mybase")</code> </pre> <br><p>  C'est-√†-dire  en utilisant la fonction <code>key_set_with_value()</code> , vous ajoutez un mot de passe au stockage des informations d'identification et en utilisant <code>key_get()</code> demandez, et seul l'utilisateur qui l'a ajout√© au magasin peut demander un mot de passe.  √Ä l'aide de <code>keyring</code> vous pouvez stocker des mots de passe non seulement √† partir de bases de donn√©es, mais √©galement √† partir de n'importe quel service, ainsi que des jetons d'autorisation lorsque vous travaillez avec l'API. </p><br><h3 id="sozdanie-tablic-i-zapis-v-bazu-dannyh">  Cr√©ation de tables et √©criture dans la base de donn√©es </h3><br><p>  L'√©criture dans la base de donn√©es est effectu√©e par la fonction <code>dbWriteTable()</code> . </p><br><p>  Arguments de la fonction <code>dbWriteTable()</code> : </p><br><p>  <em>Les arguments requis sont en gras, l'italique est facultatif</em> </p><br><ul><li>  <strong>conn</strong> - Objet de connexion au SGBD cr√©√© √† l'aide de la fonction <code>dbConnect</code> ; </li><li>  <strong>nom</strong> - le nom de la table du SGBD dans laquelle les donn√©es seront √©crites; </li><li>  <strong>valeur</strong> - une table (un objet de la classe data.frame / data.table / tibble_frame) dans R, dont les donn√©es seront √©crites dans le SGBD; </li><li>  <em>row.names</em> - Ajoute une colonne row_names avec des num√©ros de ligne √† la table, par <em>d√©faut FALSE</em> . </li><li>  <em>√©craser</em> - √âcraser la table si la table portant le nom sp√©cifi√© dans l'argument <em>nom</em> est d√©j√† pr√©sente dans le SGBD; <em>la valeur par d√©faut est FAUX</em> ; </li><li>  <em>append</em> - Ajoute des donn√©es si une table avec le nom sp√©cifi√© dans l'argument <em>name</em> est d√©j√† pr√©sente dans le SGBD; <em>la valeur par d√©faut est FALSE</em> ; </li><li>  <em>field.types</em> - Accepte un vecteur nomm√© et d√©finit le type de donn√©es dans chaque champ lors de l'√©criture dans le SGBD, par <em>d√©faut NULL</em> ; </li><li>  <em>temporaire</em> - Vous permet de cr√©er des tables temporaires dans le SGBD, qui seront disponibles jusqu'√† ce que la connexion avec la base de donn√©es soit d√©connect√©e; <em>la valeur par d√©faut est FALSE</em> . </li></ul><br><div class="spoiler">  <b class="spoiler_title">Un exemple d'√©criture de donn√©es dans un SGBD via DBI</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #     DSN con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     iris,         R  iris dbWriteTable(conn = con, name = "iris", value = iris) #     dbDisconnect(con)</code> </pre> </div></div><br><p>  Pour afficher les tables dans la base de donn√©es, utilisez la fonction <code>dbListTables()</code> , pour supprimer les tables <code>dbRemoveTable()</code> </p><br><div class="spoiler">  <b class="spoiler_title">Un exemple d'interrogation d'une liste de tables et de suppression d'une table d'un SGBD</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #    dbListTables(con) #   iris dbRemoveTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="chtenie-dannyh-iz-subd">  Lecture des donn√©es d'un SGBD </h3><br><p>  √Ä l'aide de <code>DBI</code> vous pouvez interroger des tables enti√®res ou le r√©sultat de l'ex√©cution de votre requ√™te SQL.  Les fonctions <code>dbReadTable()</code> et <code>dbGetQuery()</code> sont utilis√©es pour effectuer ces op√©rations. </p><br><div class="spoiler">  <b class="spoiler_title">Un exemple d'interrogation d'une table d'iris √† partir d'un SGBD</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   iris   iris dbiris &lt;- dbReadTable(con, "iris") #     dbDisconnect(con)</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Un exemple de chargement du r√©sultat de l'ex√©cution de SQL √† partir d'un SGBD</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #     setosa &lt;- dbGetQuery(con, "SELECT * FROM iris WHERE Species = 'setosa'") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="manipulirovanie-dannymi-v-subd-dml">  Manipulation de donn√©es dans un SGBD (DML) </h3><br><p>  La fonction <code>dbGetQuery()</code> ci <code>dbGetQuery()</code> dessus est utilis√©e exclusivement pour interroger des √©chantillons de donn√©es (SELECT). </p><br><p>  Pour les op√©rations de manipulation de donn√©es, telles que UPDATE, INSERT, DELETE, la fonction <code>dbExecute()</code> existe dans <code>DBI</code> . </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de code pour manipuler des donn√©es dans un SGBD</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #   (INSERT) dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   (UPDATE) dbExecute(con, "UPDATE iris SET [Species] = 'old_value' WHERE row_names = 51") #     (DELETE) dbExecute(con, "DELETE FROM iris WHERE row_names = 51") #     dbDisconnect(con)</code> </pre> </div></div><br><h3 id="tranzakcii-v-subd">  Transactions dans le SGBD </h3><br><blockquote>  Une transaction est une op√©ration s√©quentielle de lecture et d'√©criture.  La fin d'une transaction peut √™tre soit l'enregistrement des modifications (validation, validation) ou l'annulation des modifications (restauration, restauration).  En ce qui concerne la base de donn√©es, une transaction est une s√©rie de requ√™tes, qui sont trait√©es comme une requ√™te unique. </blockquote><p>  <em><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Citation de l'article "Les transactions et les m√©canismes de leur contr√¥le"</a></em> </p><br><p>  Une transaction encapsule plusieurs instructions SQL dans une unit√© √©l√©mentaire.  Dans <code>DBI</code> d√©but d'une transaction est initi√© avec <code>dbBegin()</code> puis confirm√© avec <code>dbCommit()</code> ou annul√© avec <code>dbRollback()</code> .  Dans tous les cas, le SGBD garantit que: tout ou partie des d√©clarations seront appliqu√©es aux donn√©es. </p><br><p>  Par exemple, pendant la transaction, ajoutons 51 lignes √† la table iris, puis changez la valeur <em>Sepal.Width</em> en 5 lignes et <em>supprimons</em> 43 lignes de la table. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de code de transaction</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbCommit(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5 8.0 1.4 0.2 setosa # 2 51 7 3.2 4.7 1.4 versicolor # 3 51 5 3.3 1.7 0.3 new_values</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Exemple de code d'annulation de transaction</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(odbc) #    con &lt;- dbConnect(odbc(), DSN = "my_test_source", UID = "my_username", PWD = "my_password") #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor #    dbBegin(con) #   dbExecute(con, "INSERT INTO iris (row_names, [Sepal.Length], [Sepal.Width], [Petal.Length], [Petal.Width], [Species]) VALUES (51, 5.0, 3.3, 1.7, 0.3, 'new_values')") #   dbExecute(con, "UPDATE iris SET [Sepal.Width] = 8 WHERE row_names = 5") #   43 dbExecute(con, "DELETE FROM iris WHERE row_names = 43") #   dbRollback(con) #      dbGetQuery(con, "SELECT * FROM iris WHERE row_names IN (5, 43, 51)") # row_names Sepal.Length Sepal.Width Petal.Length Petal.Width Species # 1 5 5.0 3.6 1.4 0.2 setosa # 2 43 4.4 3.2 1.3 0.2 setosa # 3 51 7.0 3.2 4.7 1.4 versicolor</code> </pre> </div></div><br><h1 id="paket-rodbc">  Forfait RODBC </h1><br><p>  Le package <code>RODBC</code> fournit une interface autonome pour la connexion et l'utilisation d'un SGBD via une interface ODBC. </p><br><p>  <code>RODBC</code> pas compatible <code>DBI</code> , c'est-√†-dire  vous ne pouvez pas utiliser l'objet de connexion cr√©√© √† l'aide de <code>RODBC</code> dans les fonctions fournies par le package <code>DBI</code> . </p><br><h3 id="osnovnye-funkcii-paketa-rodbc">  Fonctionnalit√©s cl√©s du package RODBC </h3><br><ul><li>  <code>odbcConnect</code> - Connexion au SGBD via DSN; </li><li>  <code>odbcDriverConnect</code> - Connexion √† la base de donn√©es via la cha√Æne de connexion; </li><li>  <code>sqlQuery</code> - Envoi d'une requ√™te au SGBD et obtention du r√©sultat de son ex√©cution.  Prend en charge les requ√™tes de tout type: SELECT, UPDATE, INSERT, DELETE. </li><li>  <code>sqlFetch</code> - R√©cup√®re la table enti√®re du SGBD; </li><li>  <code>sqlTables</code> - R√©cup√®re une liste des tables dans la base de donn√©es. </li><li>  <code>sqlSave</code> - Cr√©ez une nouvelle table dans la base de donn√©es ou ajoutez de nouvelles donn√©es √† une table existante; </li><li>  <code>sqlUpdate</code> - Mise √† jour des donn√©es dans une table qui existe d√©j√† dans le SGBD; </li><li>  <code>sqlDrop</code> - Supprimer une table dans un SGBD; </li><li>  <code>odbcClose</code> - <code>odbcClose</code> fin √† une connexion √† un SGBD. </li></ul><br><h3 id="primer-raboty-s-rodbc">  Un exemple de collaboration avec RODBC </h3><br><p>  De mon point de vue, <code>RODBC</code> moins fonctionnel que <code>DBI</code> , mais il a toutes les fonctions n√©cessaires pour travailler avec un SGBD. </p><br><div class="spoiler">  <b class="spoiler_title">Un exemple d'interaction avec un SGBD via RODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   con_string &lt;- odbcDriverConnect(connection = "Driver=SQL Server;Server=localhost;Database=mybase;UID=my_username;PWD=my_password;Port=1433") #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #     iris sqlSave(con_dsn, dat = iris, tablename = "iris", append = TRUE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) #   sqlDrop(con_dsn, sqtable = "iris") #     odbcCloseAll()</code> </pre> </div></div><br><h1 id="tranzakcionnost">  Transactionnel </h1><br><p>  Par d√©faut, la transactionnalit√© dans <code>RODBC</code> d√©sactiv√©e.  La gestion des transactions est assur√©e par deux fonctions. </p><br><ul><li>  <code>odbcSetAutoCommit</code> - Bascule entre les modes de fonctionnement SGBD normal et transactionnel; </li><li>  <code>odbcEndTran</code> - Confirmer ou annuler une transaction. </li></ul><br><p>  L'activation et la d√©sactivation du mode de transaction est effectu√©e par la fonction <code>odbcSetAutoCommit</code> √† l'aide de l'argument <em>autoCommit</em> . </p><br><div class="spoiler">  <b class="spoiler_title">Exemple de travail en mode transactionnel dans RODBC</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">#   library(RODBC) #   DSN con_dsn &lt;- odbcConnect(dsn = "my_test_source", uid = "my_username", pwd = "my_password") #     sqlSave(con_dsn, dat = iris, tablename = "iris") #    odbcSetAutoCommit(con_dsn, autoCommit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #      R iris[1, 5] &lt;- "virginica" #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #   odbcEndTran(con_dsn, commit = FALSE) #   4  sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 setosa # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     sqlUpdate(con_dsn, dat = iris, tablename = "iris") #   odbcEndTran(con_dsn, commit = TRUE) #   4     sqlFetch(con_dsn, "iris", rownames = FALSE, max = 4) # rownames SepalLength SepalWidth PetalLength PetalWidth Species # 1 1 5.1 3.5 1.4 0.2 virginica # 2 2 4.9 3.0 1.4 0.2 setosa # 3 3 4.7 3.2 1.3 0.2 setosa # 4 4 4.6 3.1 1.5 0.2 setosa #     odbcClose(con_dsn)</code> </pre> </div></div><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  Les deux m√©thodes de travail avec des bases de donn√©es dans les langages R, <code>DBI</code> et <code>RODBC</code> d√©crites dans l'article sont assez universelles et fonctionneront avec presque tous les SGBD. </p><br><p>  La seule diff√©rence de fonctionnement entre diff√©rents SGBD est le processus de connexion.  Pour les SGBD les plus courants, il existe des packages distincts qui sont des pilotes.  Pour le reste du SGBD, il est n√©cessaire de configurer la connexion via l'interface ODBC √† <code>odbc</code> <code>RODBC</code> <code>odbc</code> ou <code>RODBC</code> .  Toutes les autres manipulations, quel que soit le SGBD que vous avez choisi, seront inchang√©es.  Une exception est l'envoi de requ√™tes SQL, selon le dialecte SQL pris en charge par le SGBD avec lequel vous travaillez. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461063/">https://habr.com/ru/post/fr461063/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461053/index.html">Nous connectons des cartes en ligne au navigateur sur le smartphone. Partie 2 - Cartes vectorielles</a></li>
<li><a href="../fr461055/index.html">Rekko Challenge 2019: comment c'√©tait</a></li>
<li><a href="../fr461057/index.html">Cha√Ænes de t√©l√©gramme sur le d√©veloppement de jeux</a></li>
<li><a href="../fr461059/index.html">√âcrire une application Android pour les fans de films - Partie 1 (Prototypage)</a></li>
<li><a href="../fr461061/index.html">Alliages de magn√©sium, fronti√®res jumelles et s√©gr√©gation</a></li>
<li><a href="../fr461067/index.html">Les 65 principales questions SQL des entretiens d'embauche auxquelles vous devriez vous pr√©parer en 2019. Partie I</a></li>
<li><a href="../fr461069/index.html">Cam√©ras IP ext√©rieures Nobelic: tests, technologies et capacit√©s des syst√®mes de vid√©osurveillance Ivideon</a></li>
<li><a href="../fr461071/index.html">Optimisation des requ√™tes de base de donn√©es sur l'exemple de service B2B pour les constructeurs</a></li>
<li><a href="../fr461073/index.html">Nous connectons des cartes en ligne au navigateur sur le smartphone. Partie 3 - OverpassTurbo</a></li>
<li><a href="../fr461075/index.html">Intelligence d'affaires. Objets informatiques, composants, outils</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>