<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïµÔ∏è üßìüèº üõåüèº C√≥mo no dispararte en la pierna con una m√°quina de estado üì© üë∞ üò∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La m√°quina de estado rara vez es utilizada por los desarrolladores m√≥viles. Aunque la mayor√≠a conoce los principios del trabajo y lo implementa f√°cilm...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√≥mo no dispararte en la pierna con una m√°quina de estado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/423293/"> La m√°quina de estado rara vez es utilizada por los desarrolladores m√≥viles.  Aunque la mayor√≠a conoce los principios del trabajo y lo implementa f√°cilmente de forma independiente.  En el art√≠culo, descubriremos qu√© tareas resuelve la m√°quina de estado utilizando el ejemplo de las aplicaciones de iOS.  La historia se aplica en la naturaleza y est√° dedicada a los aspectos pr√°cticos del trabajo. <br><br>  Debajo del corte, encontrar√° una transcripci√≥n ampliada del discurso de Alexander Sychev ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Brain89</a> ) en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AppsConf</a> , en el que comparti√≥ sus opciones para usar la m√°quina de estado en el desarrollo de aplicaciones que no son de juegos. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/GKMrJe3mfwU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>Sobre el orador:</b> Alexander Sychev ha estado involucrado en el desarrollo de iOS durante ocho a√±os, tiempo durante el cual particip√≥ en la creaci√≥n de aplicaciones simples y clientes complejos para redes sociales y el sector financiero.  Por el momento, es un l√≠der t√©cnico en Sberbank. <br><a name="habracut"></a><br>  Llegan a la programaci√≥n desde muchas √°reas, con diferentes antecedentes y experiencia, as√≠ que primero recordamos la teor√≠a b√°sica. <br><br><h2>  Declaraci√≥n del problema. <br></h2><br><img src="https://habrastorage.org/webt/ow/wa/vd/owwavd51w_12g14nwehehu4yfu4.jpeg"><br><br>  Una m√°quina de estados es una abstracci√≥n matem√°tica que consta de tres elementos principales: <br><br><ul><li>  muchos estados internos </li><li>  el conjunto de se√±ales de entrada que determinan la transici√≥n del estado actual al siguiente, </li><li>  conjuntos de estados finales, tras la transici√≥n a la cual el aut√≥mata completa su trabajo ("admite la palabra de entrada x"). </li></ul><br><h3>  Condici√≥n <br></h3><br>  Por estado queremos decir una variable o un grupo de variables que determinan el comportamiento de un objeto.  Por ejemplo, en la aplicaci√≥n est√°ndar de iOS "Configuraci√≥n <strong>"</strong> hay un elemento "Negrita" ("B√°sico ‚Üí Acceso universal").  El valor de este elemento le permite cambiar entre dos opciones para mostrar texto en la pantalla del dispositivo. <br><br><img src="https://habrastorage.org/webt/mx/if/68/mxif68m4rgadt4kgjqovnzswvny.jpeg"><br><br>  Al enviar la misma se√±al "Cambiar el valor del interruptor de palanca <strong>"</strong> , obtenemos una reacci√≥n diferente del sistema: ya sea el estilo de fuente habitual o en negrita: todo es simple.  Al estar en diferentes estados y recibir la misma se√±al, un objeto reacciona de manera diferente a un cambio de estado. <br><br><h2>  Tareas tradicionales <br></h2><br>  En la pr√°ctica, los programadores a menudo se encuentran con una m√°quina de estados finitos. <br><br><h3>  Aplicaciones de juegos <br></h3><br>  Esto es lo primero que viene a la mente: como parte del juego, casi todo est√° determinado por el estado actual del juego.  Entonces, Apple asume el uso de m√°quinas de estado principalmente en aplicaciones de juegos (discutiremos esto en detalle m√°s adelante). <br><br>  Los siguientes ejemplos ilustran el comportamiento del sistema cuando procesa la misma se√±al pero con un estado interno diferente.  Por ejemplo: <br><br>  ‚óè el personaje del juego puede tener diferentes puntos fuertes: uno con armadura mec√°nica y con una pistola l√°ser, y el otro est√° d√©bilmente bombeado.  Dependiendo de este estado, se determina el comportamiento de los enemigos: atacan o huyen. <br><br><img src="https://habrastorage.org/webt/-9/ur/ci/-9urcijninqy6zo8as2i8adn46o.jpeg"><br><br>  ‚óè el juego est√° en pausa: no es necesario dibujar el cuadro actual;  El jugador en el modo de men√∫ o en el proceso del juego: el renderizado es completamente diferente. <br><br><h3>  An√°lisis de texto <br></h3><br>  Una de las tareas de an√°lisis de texto m√°s populares asociadas con el uso de una m√°quina de estado son los filtros de spam.  Deje que haya un conjunto de palabras de parada y una secuencia de entrada.  Debe filtrar esta secuencia o no mostrarla en absoluto. <br><br><img src="https://habrastorage.org/webt/vo/ka/c2/vokac2-lpmhmsapxqmtked5buo4.jpeg"><br><br>  Formalmente, esta es la tarea de encontrar una subcadena en una cadena.  Para resolverlo, se utiliza el algoritmo Knut-Morris-Pratt, cuya implementaci√≥n de software es una m√°quina de estados finitos.  El estado es el desplazamiento de la secuencia de entrada y el n√∫mero de caracteres encontrados en el patr√≥n - palabra de parada. <br><br>  Adem√°s, <strong>al analizar expresiones regulares</strong> , a menudo se usan m√°quinas de estados finitos. <br><br><h3>  Procesamiento de consultas paralelas <br></h3><br>  Una m√°quina de estados es una de las opciones para implementar el procesamiento de solicitudes y ejecutar un conjunto estricto de instrucciones. <br><br><img src="https://habrastorage.org/webt/i_/ll/n9/i_lln9kr6-tfmnr0ejx7mjn3ytk.jpeg"><br><br>  Por ejemplo, en el servidor web nginx, las solicitudes de entrada de varios protocolos se procesan utilizando m√°quinas de estado.  Dependiendo del protocolo espec√≠fico, se selecciona una implementaci√≥n espec√≠fica de la m√°quina de estado y, en consecuencia, se ejecuta un conjunto de instrucciones bien conocido. <br><br>  En general, se obtienen dos clases de problemas: <br><br><ul><li>  administrar la l√≥gica de un objeto complejo con un estado interno complejo, </li><li>  formaci√≥n de control y flujos de datos (descripci√≥n del algoritmo). </li></ul><br>  Obviamente, tales tareas comunes se encuentran en la pr√°ctica de cualquier programador.  Por lo tanto, el uso de una m√°quina de estado es posible, incluso en aplicaciones de contenido que no son de juegos, que est√°n involucradas en la mayor√≠a de los desarrolladores m√≥viles. <br><br>  A continuaci√≥n, analizaremos d√≥nde y cu√°ndo se puede usar la m√°quina de estado para crear aplicaciones t√≠picas de iOS. <br><br>  La mayor√≠a de las aplicaciones m√≥viles tienen una arquitectura en capas.  Hay tres capas base. <br><br><ul><li>  Capa de presentaci√≥n </li><li>  Capa l√≥gica empresarial. </li><li>  Un conjunto de ayudantes, clientes de red, etc. (Core layer). </li></ul><br>  Como se indic√≥ anteriormente, la m√°quina de estado controla objetos con un comportamiento complejo, es decir,  Con condici√≥n compleja.  Dichos objetos est√°n definitivamente en la capa de presentaci√≥n, porque toma decisiones al procesar la entrada del usuario o los mensajes del sistema operativo.  Veamos los diferentes enfoques para su ejecuci√≥n. <br><br><img src="https://habrastorage.org/webt/ic/iq/pw/iciqpwtfuuokmoik0j5abflppg4.jpeg"><br><br>  En la met√°fora arquitect√≥nica cl√°sica de Modelo-Vista-Controlador, el estado estar√° en el controlador: decide qu√© se muestra en la Vista y c√≥mo responder a las se√±ales de entrada: presionar un bot√≥n, cambiar el control deslizante, etc.  Es l√≥gico que una de las implementaciones del controlador sea una m√°quina de estado. <br><br><img src="https://habrastorage.org/webt/xt/sv/cr/xtsvcrd3ehffxfreo8ivtwx7jy8.jpeg"><br><br>  En VIPER, el estado est√° en el presentador: es √©l quien determina la transici√≥n de navegaci√≥n espec√≠fica desde la pantalla actual y la visualizaci√≥n de datos en la Vista. <br><br><img src="https://habrastorage.org/webt/_p/ob/xb/_pobxbwjjwduuken8qiucqg5o30.jpeg"><br><br>  En Model-View-ViewModel, el estado est√° en ViewModel.  Independientemente de si tenemos aglutinantes reactivos o no, el comportamiento del m√≥dulo definido en la met√°fora MVVM se registrar√° en ViewModel.  Obviamente, su implementaci√≥n a trav√©s de una m√°quina de estado es una opci√≥n aceptable. <br><br><img src="https://habrastorage.org/webt/x0/8e/kf/x08ekfoc9zyg1s9_9jiirethpgm.jpeg"><br><br>  Los objetos complejos con un conjunto no trivial de estados tambi√©n se encuentran en la capa de l√≥gica de negocios de la aplicaci√≥n.  Por ejemplo, un cliente de red que, seg√∫n se establezca o no una conexi√≥n con el servidor, env√≠a o bloquea solicitudes.  O un objeto para trabajar con una base de datos que necesita traducir funciones de lenguaje en una consulta SQL, ejecutarla, obtener una respuesta, traducirla en objetos, etc. <br><br><img src="https://habrastorage.org/webt/pb/bq/yt/pbbqytlwgtmbcutdlliqv5xkwjs.jpeg"><br><br>  En tareas m√°s espec√≠ficas, como un m√≥dulo de pago, en el que un conjunto m√°s amplio de estados, l√≥gica compleja, el uso de una m√°quina de estados tambi√©n es correcto. <br><br>  Como resultado, encontramos que en las aplicaciones m√≥viles hay muchos objetos cuyo estado y l√≥gica de comportamiento se describen m√°s complicados que con una oraci√≥n.  Deben ser capaces de gestionar. <br><br>  Considere un <strong>ejemplo real</strong> y comprenda en qu√© punto se necesita realmente una m√°quina de estados finitos, y d√≥nde su aplicaci√≥n no est√° justificada. <br><br><img src="https://habrastorage.org/webt/96/hk/lw/96hklw8ditorh2imz2zcx36wmga.jpeg"><br><br>  Considere el ViewController de la aplicaci√≥n Championship iOS, un recurso deportivo popular.  Este controlador muestra un conjunto de comentarios en forma de tabla.  Los usuarios ingresan la descripci√≥n del partido, ven fotos, leen las noticias y dejan sus comentarios.  La pantalla es bastante simple: la capa subyacente proporciona datos, se procesa y se muestra en la pantalla. <br><img src="https://habrastorage.org/webt/m7/m1/yz/m7m1yz9--h4qttlcuxjrozagl48.jpeg"><br><br>  Se pueden transmitir datos reales o un error a la pantalla.  Entonces aparece el primer operador condicional, la primera rama, que determina el comportamiento adicional de la aplicaci√≥n. <br><br>  La siguiente pregunta es qu√© hacer si no hay datos.  ¬øEs esta condici√≥n un error?  Lo m√°s probable es que no: no todas las noticias tienen comentarios de los usuarios.  Por ejemplo, el hockey en Egipto es de poco inter√©s para cualquiera; en un art√≠culo de este tipo generalmente no hay comentarios.  Este es el comportamiento normal y el estado normal de la pantalla que debe poder mostrar.  Entonces aparece el segundo operador condicional. <br><br>  Es l√≥gico suponer que tambi√©n hay un estado de inicio en el que el usuario espera datos (por ejemplo, cuando la pantalla de comentarios solo aparece en la pantalla).  En este caso, muestre el indicador de carga correctamente.  Esta es la tercera declaraci√≥n condicional. <br><br>  Entonces, ya tenemos cuatro estados en una pantalla simple, cuya l√≥gica de visualizaci√≥n se describe a trav√©s de la construcci√≥n if-else-if-else. <br><br><img src="https://habrastorage.org/webt/ys/yg/mq/ysygmq4fbj3mog3p6mjb0t5av9o.jpeg"><br><br>  Pero, ¬øy si hay m√°s de esos estados?  El desarrollo iterativo de la pantalla conduce a una intrincada mara√±a de construcciones condicionales, un grupo de banderas o una engorrosa caja de interruptores m√∫ltiples.  Este c√≥digo da miedo.  Imagina que el desarrollador que lo apoyar√° sabe d√≥nde vives y tiene una motosierra que siempre lleva consigo.  Y realmente quiere estar a la altura de su peque√±a pero bien merecida pensi√≥n. <br><br>  Creo que en este caso vale la pena considerar si vale la pena dejar tal implementaci√≥n en la aplicaci√≥n. <br><br><h3>  Desventajas <br></h3><br>  Comprendamos lo que no nos gusta de este c√≥digo. <br><br><img src="https://habrastorage.org/webt/2u/a-/67/2ua-67iwmlvw9zki5oxmjf4mfqe.jpeg"><br><br>  En primer lugar, es <strong>dif√≠cil de leer</strong> . <br><br>  Dado que el c√≥digo se lee mal, significa que ser√° dif√≠cil para un nuevo desarrollador averiguar qu√© se implementa exactamente en un lugar particular del proyecto.  En consecuencia, pasar√° mucho tiempo analizando la l√≥gica de comportamiento de la aplicaci√≥n; el <strong>costo de soporte y desarrollo aumentar√°</strong> . <br><br>  Este c√≥digo no es <strong>flexible</strong> .  Si necesita agregar un nuevo estado que no se sigue de la escalera actual, ¬°es posible que no tenga √©xito!  Si necesita un pasaje pasante, deje de pasar abruptamente los controles en esta escalera, ¬øc√≥mo hacerlo?  Casi nada <br><br>  Adem√°s, con este enfoque, <strong>no hay protecci√≥n contra los estados ficticios</strong> .  Cuando las transiciones se describen a trav√©s de un caso de cambio, lo m√°s probable es que se implemente el comportamiento predeterminado.  Este estado es l√≥gico en t√©rminos del comportamiento del programa, pero dif√≠cilmente l√≥gico en t√©rminos de la l√≥gica humana o comercial de la aplicaci√≥n. <br><br>  ¬øCu√°l puede ser la soluci√≥n a las deficiencias indicadas?  Por supuesto, esta es la construcci√≥n de la l√≥gica de cada m√≥dulo / controlador / objeto complejo, no basada en la intuici√≥n, sino utilizando un buen enfoque formal.  Por ejemplo, una m√°quina de estados finitos. <br><br><h2>  Gameplaykit <br></h2><br>  Como <strong>ejemplo,</strong> tomamos lo que ofrece Apple.  Dentro del marco del marco de GameplayKit, hay dos clases que nos ayudan a trabajar con la m√°quina de estados. <br><br><ul><li>  GKState. </li><li>  GKStateMachine. </li></ul><br>  El nombre del marco deja en claro que Apple quer√≠a ser utilizado en juegos.  Pero <strong>en aplicaciones que no sean de juego,</strong> ser√° √∫til. <br><br><img src="https://habrastorage.org/webt/pz/ez/de/pzezdem8jc81mab3alsm3e8pqwo.png"><br><br>  La clase <strong>GKState</strong> define el estado.  Para describirlo, debe realizar pasos simples.  Heredamos de esta clase, establecemos el nombre del estado y definimos tres m√©todos. <br><br><ul><li>  isValidNextState: si el estado actual es v√°lido en funci√≥n del anterior. </li><li>  didEnterFrom: acciones sobre la transici√≥n a este estado. </li><li>  willExitTo: acciones al salir de este estado. </li></ul><br><br><img src="https://habrastorage.org/webt/z2/q2/gj/z2q2gj0bg2-vsoejvz0crdbhmb4.png"><br><br>  <strong>GKStateMachine es</strong> una clase de m√°quina de estados.  Es a√∫n m√°s f√°cil.  Es suficiente realizar dos acciones. <br><br><ul><li>  Pasamos el conjunto de estados de entrada a la matriz escrita a trav√©s del inicializador. </li><li>  Hacemos transiciones dependiendo de las se√±ales de entrada usando el m√©todo enter.  A trav√©s de √©l, tambi√©n se establece el estado inicial. </li></ul><br>  Puede ser confuso que cualquier clase se pase como argumento al m√©todo <strong>enter</strong> .  Pero debe tenerse en cuenta que un objeto de cualquier clase no se puede definir en una variedad de estados <strong>;</strong> esto proh√≠be la escritura estricta.  En consecuencia, si establece una clase arbitraria como la siguiente clase de estado, no ocurrir√° nada y el m√©todo enter devolver√° falso. <br><br><h3>  Estados y transiciones entre ellos <br></h3><br>  Habiendo familiarizado con el marco de Apple, volvamos al ejemplo.  Es necesario describir los estados y las transiciones entre ellos.  Debe hacer esto de la manera m√°s comprensible.  Hay dos opciones comunes: una tabla o un gr√°fico de transici√≥n.  El gr√°fico de transici√≥n, en mi opini√≥n, es una opci√≥n m√°s comprensible.  Est√° en UML de forma estandarizada.  Por lo tanto, lo elegimos. <br><br>  En el gr√°fico de transici√≥n hay estados que se describen por nombres y flechas que conectan estos estados para describir las transiciones.  En el ejemplo, hay un estado inicial <strong>,</strong> esperamos datos <strong>,</strong> y hay tres estados que se pueden alcanzar desde el inicial: datos recibidos, sin datos y error. <br><br><img src="https://habrastorage.org/webt/cg/dn/gs/cgdngsj7omvfgbfvkpdgtazpeva.jpeg"><br><br>  En la implementaci√≥n, obtenemos cuatro clases peque√±as. <br><br><img src="https://habrastorage.org/webt/qo/tc/rq/qotcrq6wbihios-sonhj8ajfhey.png"><br><br>  Analicemos el estado "Datos pendientes".  En la entrada, vale la pena mostrar el indicador de descarga.  Y cuando salgas de este estado <strong>,</strong> esc√≥ndelo.  Para hacer esto, debe tener un enlace d√©bil al ViewController, que es controlado por la m√°quina de estado creada. <br><br><img src="https://habrastorage.org/webt/p8/41/aa/p841aapjpxsvcqirsklkcy9o4us.png"><br><br><h3>  Par√°metros de la m√°quina <br></h3><br>  El segundo paso que debe hacerse <strong>es</strong> establecer los par√°metros de la m√°quina de estados.  Para hacer esto, cree estados y transfi√©ralos al objeto aut√≥mata. <br><br><img src="https://habrastorage.org/webt/zd/ww/pm/zdwwpm8i_i6lxoxjkzh_a2deqzi.jpeg"><br><br>  Tambi√©n aseg√∫rese de establecer el estado inicial <br><br><img src="https://habrastorage.org/webt/mx/sg/ka/mxsgkacbkni4fjczcvsagtec8lm.png"><br><br>  En principio, todo, la m√°quina est√° lista.  Ahora es necesario procesar reacciones a eventos externos, cambiando el estado del aut√≥mata. <br><br><img src="https://habrastorage.org/webt/_c/jt/hf/_cjthf0r7-5d5u0fdxucgksdz2w.png"><br><br>  Recordemos la declaraci√≥n del problema.  Obtuvimos una escalera de if-else, en base a la cual se decidi√≥ qu√© acci√≥n se deber√≠a realizar.  Como control para un aut√≥mata simple, tal opci√≥n de implementaci√≥n puede ser (de hecho, un simple interruptor <strong>,</strong> esta es una implementaci√≥n primitiva de una m√°quina de estados finitos), pero pr√°cticamente no nos deshacemos de los inconvenientes mencionados anteriormente. <br><br>  Hay otro enfoque que le permitir√° alejarse de estas escaleras.  Lo proponen los cl√°sicos de la programaci√≥n <strong>: la</strong> llamada "pandilla de cuatro". <br><br><img src="https://habrastorage.org/webt/qv/if/sf/qvifsfqe0iqs3rsroauy4bptayg.jpeg"><br><br>  Hay un patr√≥n de dise√±o especial, que se llama "Estado". <br><br><img src="https://habrastorage.org/webt/nd/eh/wp/ndehwptccwh7lh90dmsixkzybo0.jpeg"><br><br>  Este es un patr√≥n de comportamiento similar a una estrategia que describe una abstracci√≥n de m√°quina de estado.  Permite que el objeto cambie su comportamiento seg√∫n el estado.  El objetivo principal de la aplicaci√≥n <strong>es</strong> encapsular el comportamiento y los datos asociados con un estado particular en una clase separada.  Por lo tanto, la m√°quina de estados, que inicialmente tom√≥ la decisi√≥n de qu√© estado causar, ahora transmitir√° una se√±al, la traducir√° a un estado y el estado tomar√° una decisi√≥n.  Descargue parcialmente la escalera y el c√≥digo ser√° m√°s agradable de usar. <br><br>  El marco est√°ndar no sabe c√≥mo.  Sugiere que <strong>GKStateMachine</strong> tomar√° la decisi√≥n.  Por lo tanto, expandimos la m√°quina de estados finitos con un nuevo m√©todo, donde, como configuraci√≥n, pasamos la descripci√≥n de todas las variables condicionales que determinan de manera √∫nica el siguiente estado.  Dentro de este m√©todo, puede delegar la selecci√≥n del siguiente estado al actual. <br><br><img src="https://habrastorage.org/webt/gu/sw/nr/guswnro2dw8m3fsctqqjx8_7js8.png"><br><br>  Es una buena pr√°ctica describir el estado con un objeto y siempre transmitirlo, en lugar de escribir muchos, muchos par√°metros de entrada.  A continuaci√≥n, delegamos la elecci√≥n del siguiente estado al actual.  Esa es toda la actualizaci√≥n. <br><br><img src="https://habrastorage.org/webt/te/9t/5a/te9t5acirqz1o5awpxzy1tsbyia.png"><br><br>  <strong>Ventajas de GameplayKit.</strong> <br><br><ul><li>  Biblioteca est√°ndar  No es necesario descargar nada, use cocoapods o carthage. </li><li>  La biblioteca es bastante f√°cil de aprender. </li><li>  Hay dos implementaciones a la vez: en Objective-C y en Swift. </li></ul><br>  <strong>Desventajas</strong> <br><br><ul><li>  Las realizaciones de estados y transiciones est√°n estrechamente relacionadas. <br>  Se viola el principio de responsabilidad exclusiva: el estado sabe a d√≥nde va y c√≥mo. </li><li>  Los estados duplicados no se controlan de ninguna manera. <br>  Se pasa una matriz a la m√°quina de estado, no muchos estados.  Si transfiere varios estados id√©nticos, se utilizar√° el √∫ltimo de la lista. </li></ul><br>  ¬øQu√© m√°s son las implementaciones de m√°quinas de estados finitos?  Echa un vistazo a GitHub. <br><br><h2>  Implementaciones de Objective-C <br></h2><br><img src="https://habrastorage.org/webt/vo/zt/zy/voztzyatty-amllrmtl8ny4ke3c.png"><br><br><h3>  TransitionKit <br></h3><br>  Esta es la biblioteca de Objective-C m√°s popular durante mucho tiempo, sin deficiencias identificadas en GamePlayKit.  Nos permite implementar una m√°quina de estado y todas las acciones asociadas con ella en bloques. <br><br>  <strong>El estado est√° separado de las transiciones</strong> . <br><br>  Dentro de TransitionKit hay 2 clases. <br><br><ol><li>  TKState: para configurar estados y acciones de entrada y salida. </li><li>  TKEvent es una clase para describir la transici√≥n. <br>  TKEvent une algunos estados a otros.  El evento en s√≠ mismo se define simplemente por una cadena. </li></ol><br>  Adem√°s, hay beneficios adicionales. <br><br>  <strong>Puede transferir datos √∫tiles durante la transici√≥n</strong> .  Esto funciona igual que cuando se usa NSNotificationCenter.  Toda la carga √∫til viene en forma de un diccionario userInfo, y el usuario analiza la informaci√≥n. <br><br>  <strong>La transici√≥n err√≥nea tiene una descripci√≥n</strong> .  Cuando intentamos hacer una transici√≥n inexistente (imposible), no solo obtenemos el valor NO al regresar del m√©todo de transici√≥n, sino tambi√©n una descripci√≥n detallada del error, que es √∫til al depurar una m√°quina de estados. <br><br><img src="https://habrastorage.org/webt/hi/x9/bx/hix9bx5ctgjldoay4btqajopgb0.jpeg"><br><br>  TransitionKit se utiliza en la popular cosechadora de red RestKit.  Este es un buen ejemplo de c√≥mo se puede usar una m√°quina de estado en el n√∫cleo de la aplicaci√≥n al implementar operaciones de red. <br><br><img src="https://habrastorage.org/webt/ls/os/d3/lsosd3z1zbg5knnmbrggmpq2zro.jpeg"><br><br>  RestKit tiene una clase especial, RKOperationStateMachine, para administrar operaciones concurrentes.  En la entrada, acepta la operaci√≥n que se est√° procesando y la cola para su ejecuci√≥n. <br><br><img src="https://habrastorage.org/webt/r2/pn/mc/r2pnmcfsl_6uzdzhsin_mrq_vkg.jpeg"><br><br>  Internamente, la m√°quina de estados es muy simple: tres estados (listo, ejecutado, completado) y dos transiciones: inicio y finalizaci√≥n.  Despu√©s del inicio del procesamiento (y en cualquier transici√≥n), la m√°quina de estados comienza a controlar un bloque de c√≥digo de usuario predefinido en la cola especificada al crear la cola. <br><br>  Una operaci√≥n asociada con su aut√≥mata transfiere eventos externos al aut√≥mata y realiza transiciones entre estados y todas las acciones relacionadas.  La m√°quina de estado se encarga de <br><br><ul><li>  ejecuci√≥n de c√≥digo asincr√≥nico </li><li>  ejecuci√≥n de c√≥digo at√≥mico durante las transiciones, </li><li>  control de transici√≥n </li><li>  Cancelaci√≥n de operaciones. </li><li>  la correcci√≥n del cambio de las variables de estado de operaci√≥n: isReady, isExecuting, isFinished. </li></ul><br><h3>  Cambio <br></h3><br>  Adem√°s de TransitionKit, vale la pena mencionar por separado <strong>Shift</strong> , una peque√±a biblioteca implementada como una categor√≠a sobre NSObject.  Este enfoque le permite convertir cualquier objeto en una m√°quina de estados, describiendo su estado en forma de constantes de cadena y acciones en bloques durante las transiciones.  Por supuesto, este es m√°s un proyecto de capacitaci√≥n, pero bastante interesante y le permite probar lo que es una m√°quina de estado a un costo m√≠nimo. <br><br><h2>  Implementaciones r√°pidas <br></h2><br><img src="https://habrastorage.org/webt/_t/dx/kd/_tdxkdwt0sqzgy78o-q-_z0c_nq.png"><br><br>  Hay muchas implementaciones de m√°quinas de estados finitos en Swift.  Se√±alar√© uno ( <strong>comentario</strong> : desafortunadamente, el proyecto no se ha desarrollado en los √∫ltimos dos a√±os despu√©s del informe, pero vale la pena contar las ideas contenidas en el art√≠culo). <br><br><h3>  SwiftyStateMachine <br></h3><br>  En SwiftyStateMachine, la m√°quina de estado est√° representada por una estructura no estable; a trav√©s de los m√©todos didSet de la propiedad, puede detectar f√°cilmente los cambios de estado. <br><br>  En esta biblioteca, la m√°quina de estados se define a trav√©s de la tabla de correspondencia de estados y transiciones entre ellos.  Este esquema se describe por separado del objeto que controlar√° la m√°quina.  Esto se implementa a trav√©s de un conmutador anidado. <br><br><img src="https://habrastorage.org/webt/y5/cz/dl/y5czdlkikmxb4kyylgwgxfsdxuy.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Las caracter√≠sticas clave, las ventajas de esta biblioteca son. </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La necesidad de describir completamente el esquema de transiciones de estado. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esto le permite obtener un error en la etapa de compilaci√≥n si no se procesa la transici√≥n para un estado espec√≠fico.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control estricto de las se√±ales de entrada. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No puede pasar una se√±al a una m√°quina de estado que no est√© definida o que est√© definida para otra m√°quina de estado.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Separar el circuito y el objeto que controla le permite ahorrar tiempo al inicializar la m√°quina. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualizaci√≥n utilizando el lenguaje de descripci√≥n de gr√°ficos DOT. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Existe un lenguaje de marcado gr√°fico para trabajar con diagramas de estado: DOT. </font><font style="vertical-align: inherit;">Esta biblioteca lo usa para indicar c√≥mo se representar√° la m√°quina de estado.</font></font></li></ul><br><img src="https://habrastorage.org/webt/wb/zg/du/wbzgduy9duy-shpt0pcjjjt0ru8.jpeg"><br><br><h2>  Conclusi√≥n <br></h2><br>          . <br><br><ul><li> <strong>.</strong> <br>           ,     .    ,         . ,   . <br></li><li> <strong>  .</strong> <br>     ( ). <br></li><li> <strong> .</strong> <br>       ,    ,        . </li><li> <strong>       .</strong> , SwiftyStateMachine     ,    ,     .     . </li><li> <strong> .</strong> <br>   ,    . , ,      .       . <br></li></ul><br>        . <br><br><img src="https://habrastorage.org/webt/wb/ek/ww/wbekwwlr0a_w8wzt6z0bo12jdmm.jpeg"><br><br>       .      ,    .    , ,    switch case:  ,  ,  ‚Äî     . <br><br><img src="https://habrastorage.org/webt/hq/ay/db/hqaydbygw58xgcalwyvph1haeho.jpeg"><br><br>  .    .    ,  .  ,    ,  ,     .    . <br><br><img src="https://habrastorage.org/webt/b9/mb/ze/b9mbze-xdkufz2mbs7p61obsjqo.jpeg"><br><br>      ,      ,      .     . <br><br><img src="https://habrastorage.org/webt/bc/qp/hr/bcqphramltmjhaakirn_uo00e4i.png"><br><br>    ‚Äî  <strong> </strong> .       :      , ‚Äî    . <br><br><img src="https://habrastorage.org/webt/iw/qz/we/iwqzwefnjh4xnqexwoovxccugqo.jpeg"><br><br><img src="https://habrastorage.org/webt/i4/80/vk/i480vkfuwmhwpdd31totlvl5298.jpeg"><br><br>   ¬´-¬ª     <strong> </strong> . <br><br><img src="https://habrastorage.org/webt/s-/kf/ox/s-kfoxsckujhbrzsslebpzuqwei.jpeg"><br><br> ,    .         . <br><br><img src="https://habrastorage.org/webt/le/oo/ju/leoojuz3yycfncczpfbgftsa1tq.jpeg"><br><br>        <strong>app coordinators</strong> ‚Äî   ,     ,    : ,     .       ,       . <br><br>  , app coordinator ,  state machine.            . ,    app coordinators  state machine,         , ,  , <strong>  </strong> .      , ,   ,         .    . <br><br><img src="https://habrastorage.org/webt/mx/yu/1q/mxyu1qczcjazzunuhe7jfoolv2e.png"><br><br> , state machine  ,    ,         . <br><br>     state machine  ,     if-else.   ,         . <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este a√±o, en Apps Conf 2018, que se llevar√° a cabo los d√≠as 8 y 9 de octubre, Alexander </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">planea discutir</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cinco principios b√°sicos de programaci√≥n orientada a objetos y los l√≠mites de su aplicabilidad. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para obtener m√°s informes de desarrollo m√≥vil, consulte nuestro </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canal de YouTube</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Y si desea recibir informaci√≥n sobre nuevas transcripciones e informes interesantes, suscr√≠base al </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bolet√≠n</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423293/">https://habr.com/ru/post/es423293/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423279/index.html">C√≥mo desarroll√© la tableta rusa</a></li>
<li><a href="../es423281/index.html">Comentarios en el equipo, 360 y 14 de febrero</a></li>
<li><a href="../es423283/index.html">Modelando el efecto Sagnac usando √≥ptica geom√©trica</a></li>
<li><a href="../es423285/index.html">Ingenier√≠a social: el enemigo evasivo en el mundo de la ciberseguridad</a></li>
<li><a href="../es423291/index.html">Los rusos establecieron un r√©cord: 110 pel√≠culas piratas por persona</a></li>
<li><a href="../es423295/index.html">Conferencia de desarrollo m√≥vil m√°s √∫til</a></li>
<li><a href="../es423297/index.html">Del desarrollador de Android a DevOps</a></li>
<li><a href="../es423299/index.html">Coordinador de aplicaciones en aplicaciones iOS</a></li>
<li><a href="../es423303/index.html">AI, curso pr√°ctico. Transformaci√≥n de m√∫sica basada en la emoci√≥n</a></li>
<li><a href="../es423305/index.html">Rendimiento de la ruina</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>