<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêú ‚úçüèª üå™Ô∏è Conectamos el gamepad de PS1 / PS2 a Raspberry pi ‚òïÔ∏è ‚úåÔ∏è üñ§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el patio est√°n las vacaciones de mayo. Y eso significa tiempo para comer kebabs y beber varias bebidas de barril y embotelladas. Y hago todo tipo d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conectamos el gamepad de PS1 / PS2 a Raspberry pi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403753/">  En el patio est√°n las vacaciones de mayo.  Y eso significa tiempo para comer kebabs y beber varias bebidas de barril y embotelladas.  Y hago todo tipo de tonter√≠as.  La idea de este proyecto surgi√≥ antes del a√±o nuevo.  Pero durante mucho tiempo no pude darme cuenta.  Despu√©s de comprar el primer gamepad (que tir√© m√°s tarde) y de intentar interrogarlo, me di cuenta de que no basta con leer los manuales, aunque hay suficiente informaci√≥n.  Afortunadamente, para este 23 de febrero, recib√≠ como regalo no espuma de afeitar empacada en calcetines, sino 600 rublos.  con el deseo de no negarte nada en aliexpress.  Donde se compr√≥ la copia china del analizador l√≥gico Saleae Logic.  Aquellos que est√©n interesados ‚Äã‚Äãen lo que surgi√≥ pueden hacer clic en el bot√≥n a continuaci√≥n.  Y aquellos que son demasiado flojos para leer pueden ver inmediatamente el resultado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><img src="https://habrastorage.org/web/079/966/3bb/0799663bb6154ee49ee69e0583654ac3.jpg"><br><a name="habracut"></a><br>  Despu√©s de atornillar el analizador l√≥gico a un dise√±o sin complicaciones, vi que se envi√≥ una escoria expl√≠cita al gamepad. <br><br>  Un momento de teor√≠a. <br><br>  El hecho es que la consola se comunica con el gamepad a trav√©s de la interfaz SPI.  Y hay modos regulados de operaci√≥n de esta interfaz.  En este caso, debe haber MODO 3, transmisi√≥n hacia adelante y el nivel l√≥gico en la l√≠nea Habilitar chip o Seleccionar esclavo al acceder al gamepad "0".  La frecuencia en la l√≠nea clk es de 250 kHz.  Pero hice 100 kHz, y funciona bien.  Todo, en principio, se describe claramente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Y el sistema de comandos para el gamepad, y la transcripci√≥n de respuestas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Tambi√©n en el portal Radiokot, hay una publicaci√≥n, pero hay errores en los equipos.  En pocas palabras, para interrogar a un gamepad est√°ndar, debe darle un comando: <br><br><pre><code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x1</span></span> <span class="hljs-number"><span class="hljs-number">0x42</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span> <span class="hljs-number"><span class="hljs-number">0x0</span></span>   , -  <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x41</span></span> <span class="hljs-number"><span class="hljs-number">0x5a</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span></code> </pre> <br>  Donde 0x41 es el tipo de gamepad, y los √∫ltimos 2 bytes es el estado de los botones.  Con anal√≥gico, todo es similar, solo necesita agregar 4 bytes cero m√°s al paquete. <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0x1</span></span>, <span class="hljs-number"><span class="hljs-number">0x42</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>, <span class="hljs-number"><span class="hljs-number">0x0</span></span>   , -  <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x73</span></span> <span class="hljs-number"><span class="hljs-number">0x5a</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0x80</span></span></code> </pre><br>  Aqu√≠ 0x73 esto significa que el gamepad es anal√≥gico, los √∫ltimos 4 bytes son el estado de los an√°logos. <br><br>  Es importante que el gamepad funcione desde 3.3 V., lo que le permite alimentarse directamente desde Raspberry pi.  En modo est√°ndar (solo funcionan los botones), el consumo es de aproximadamente 2 mA, en modo anal√≥gico 12 mA.  Y luego estos 10 mA agregan un LED en el controlador.  Y en la l√≠nea Raspberry pi de 3.3 V, se puede plantar una carga de hasta 50 mA. <br><br>  En realidad, para conectar un gamepad, necesitas 4 puertos GPIO y energ√≠a.  Solo 6 cables. <br><br>  Entonces aqu√≠.  Me di cuenta de que las bibliotecas para trabajar con GPIO, que bcm2835, ese cableadoPi, funcionan muy mal con SPI.  En principio, no saben c√≥mo transmitir paquetes con el bit hacia adelante menos significativo.  En los muelles de uno de ellos, esto se describe honestamente, pero en alg√∫n lugar muy profundo.  Y realmente no pueden cumplir con los reg√≠menes. <br><br>  Pero nada impide reproducir el paquete en s√≠ y leer los datos del gamepad.  Apenas dicho que hecho.  Tome la biblioteca de cableado y escriba: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;unistd.h&gt; #include &lt;wiringPi.h&gt; #define mosi 12 #define miso 13 #define clk 14 #define ce 5 unsigned char i, b; unsigned char cmd[9] = {0x1, 0x42, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}; int main() { wiringPiSetup () ; //  pinMode (mosi, OUTPUT); pinMode (clk, OUTPUT); pinMode (ce, OUTPUT); pinMode (miso, INPUT); digitalWrite (clk, HIGH); digitalWrite (mosi, LOW); digitalWrite (ce, HIGH); while(1) { unsigned char data[9] = {0}; digitalWrite (ce, LOW); delayMicroseconds(20); for (i = 0; i &lt; 9; i++) { for (b = 0; b &lt; 8; b++) { if (((cmd[i] &gt;&gt; b)&amp;1) == 1) { digitalWrite (mosi, HIGH); digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[i] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); digitalWrite (mosi, LOW); } else { digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[i] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); } } delayMicroseconds(40); } digitalWrite (ce, HIGH); printf("%x %x %x %x %x %x\n", data[3], data[4], data[5], data[6], data[7], data[8]); delayMicroseconds(100); } }</span></span></span></span></code> </pre><br>  Todo es cl√°sico, declaramos puertos GPIO, variables y una variedad de comandos.  A continuaci√≥n, se configuran los modos de funcionamiento del puerto y se restablecen las l√≠neas clk, mosi y ce (habilitaci√≥n de chip).  Luego se forman 2 ciclos.  En el primero, los bytes del comando se ordenan, y en el segundo, los bytes mismos son en forma de bits, para proporcionar una unidad l√≥gica o cero a la l√≠nea mosi, dependiendo del valor del bit.  Y al mismo tiempo leemos la respuesta.  Cuando vi la atesorada respuesta: <br><br><pre> <code class="cpp hljs"><span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0x41</span></span> <span class="hljs-number"><span class="hljs-number">0x5a</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span> <span class="hljs-number"><span class="hljs-number">0xff</span></span></code> </pre><br>  Casi salt√© al techo.  Aqu√≠ hay un ejemplo de la salida del programa, en este caso, estaba jugando con el an√°logo izquierdo. <br><br><pre> <code class="cpp hljs">ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">80</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">40</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">4b</span></span> ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">1</span></span>a ff ff <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> ff <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Bueno, entonces ya estaba listo para integrar este c√≥digo en el emulador.  En este caso, la pregunta con la elecci√≥n del emulador no fue.  Definitivamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pcsx_rearmed</a> .  Al igual que la vez anterior, fue necesario encontrar una funci√≥n que se lanz√≥ una de las primeras para inicializar la biblioteca en ella.  PsxInit result√≥ ser una funci√≥n de este tipo; se encuentra en el archivo r3000a.c, que emula el funcionamiento del procesador central.  Agregu√© el archivo de encabezado de la biblioteca a este archivo y declar√≥ los puertos GPIO.  En la funci√≥n psxInit, inicializo la biblioteca y establezco los niveles iniciales en los puertos GPIO.  A continuaci√≥n se muestran las primeras l√≠neas de este archivo con los cambios. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r3000a.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cdrom.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"mdec.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gte.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wiringPi.h&gt; #define mosi 12 #define miso 13 #define clk 14 #define ce 5 R3000Acpu *psxCpu = NULL; psxRegisters psxRegs; int psxInit() { SysPrintf(_("Running PCSX Version %s (%s).\n"), PACKAGE_VERSION, __DATE__); wiringPiSetup () ; //  pinMode (mosi, OUTPUT); pinMode (clk, OUTPUT); pinMode (ce, OUTPUT); pinMode (miso, INPUT); digitalWrite (clk, HIGH); digitalWrite (mosi, LOW); digitalWrite (ce, HIGH); #ifdef PSXREC if (Config.Cpu == CPU_INTERPRETER) { psxCpu = &amp;psxInt; } else psxCpu = &amp;psxRec; #else psxCpu = &amp;psxInt; #endif Log = 0; if (psxMemInit() == -1) return -1; return psxCpu-&gt;Init(); }</span></span></span></span></code> </pre><br>  Luego, tuve que descubrir c√≥mo el emulador simula el funcionamiento de un gamepad.  Hay un archivo de encabezado psemu_plugin_defs.h, se encuentra en el directorio de inclusi√≥n, aqu√≠ contiene la estructura en la que se almacenan las variables en las que el tipo de gamepad es est√°ndar, anal√≥gico, variable de estado de bot√≥n, variables de estado anal√≥gico y variables de control de vibraci√≥n. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">// controler type - fill it withe predefined values above unsigned char controllerType; // status of buttons - every controller fills this field unsigned short buttonStatus; // for analog pad fill those next 4 bytes // values are analog in range 0-255 where 127 is center position unsigned char rightJoyX, rightJoyY, leftJoyX, leftJoyY; // for mouse fill those next 2 bytes // values are in range -128 - 127 unsigned char moveX, moveY; unsigned char Vib[2]; unsigned char VibF[2]; unsigned char reserved[87]; } PadDataS;</span></span></code> </pre><br>  Entonces, la tarea principal es escribir los datos recibidos en estas variables.  Este emulador tiene complementos.  Incluyendo el complemento de gamepad, en el directorio de complementos hay un subdirectorio dfinput, en el que se encuentra el archivo pad.c deseado, en el que se lee el estado del gamepad, as√≠ como su configuraci√≥n.  Aqu√≠ es donde se transfiri√≥ el c√≥digo del programa de prueba.  Los puertos y el archivo de encabezado de la biblioteca tambi√©n se declaran.  Tambi√©n tiene variables que almacenan el c√≥digo de los comandos enviados al gamepad.  Estas variables se utilizan en las funciones de acceso al gamepad.  A continuaci√≥n se muestra este c√≥digo: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt; #include "../include/psemu_plugin_defs.h" #include "main.h" #include &lt;wiringPi.h&gt; #define mosi 12 #define miso 13 #define clk 14 #define ce 5 unsigned char a, b; unsigned char cmd[9] = {0x1, 0x42, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0}; enum { ANALOG_LEFT = 0, ANALOG_RIGHT, ANALOG_TOTAL }; enum { CMD_READ_DATA_AND_VIBRATE = 0x42, CMD_CONFIG_MODE = 0x43, CMD_SET_MODE_AND_LOCK = 0x44, CMD_QUERY_MODEL_AND_MODE = 0x45, CMD_QUERY_ACT = 0x46, // ?? CMD_QUERY_COMB = 0x47, // ?? CMD_QUERY_MODE = 0x4C, // QUERY_MODE ?? CMD_VIBRATION_TOGGLE = 0x4D, };</span></span></span></span></code> </pre><br>  Estamos interesados ‚Äã‚Äãen el primero, que tiene un valor de 42. Aqu√≠, cuando se llama a esta variable, se ejecutar√° el c√≥digo.  Adem√°s, en el archivo original est√° vac√≠o.  Y en la funci√≥n de enumeraci√≥n del comando do_cmd, insert√© el c√≥digo principal: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> uint8_t </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_cmd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ PadDataS *pad = &amp;padstate[CurPad].pad; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pad_num = CurPad; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> data[<span class="hljs-number"><span class="hljs-number">9</span></span>] = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; CmdLen = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (CurCmd) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_SET_MODE_AND_LOCK: buf = stdmode[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_MODEL_AND_MODE: buf = stdmodel[pad_num]; buf[<span class="hljs-number"><span class="hljs-number">4</span></span>] = padstate[pad_num].PadMode; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_ACT: buf = unk46[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_COMB: buf = unk47[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_QUERY_MODE: buf = unk4c[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_VIBRATION_TOGGLE: buf = unk4d[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> CMD_CONFIG_MODE: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (padstate[pad_num].ConfigMode) { buf = stdcfg[pad_num]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0xF3</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// else FALLTHROUGH case CMD_READ_DATA_AND_VIBRATE: digitalWrite (ce, LOW); delayMicroseconds(20); for (a = 0; a &lt; 9; a++) { for (b = 0; b &lt; 8; b++) { if (((cmd[a] &gt;&gt; b)&amp;1) == 1) { digitalWrite (mosi, HIGH); digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[a] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); digitalWrite (mosi, LOW); } else { digitalWrite (clk, LOW); delayMicroseconds(5); digitalWrite (clk, HIGH); data[a] ^= digitalRead(miso) &lt;&lt; b; delayMicroseconds(5); } } delayMicroseconds(40); } digitalWrite (ce, HIGH); pad-&gt;buttonStatus = data[4]; pad-&gt;buttonStatus = pad-&gt;buttonStatus &lt;&lt; 8; pad-&gt;buttonStatus |= data[3]; pad-&gt;rightJoyX = data[5]; pad-&gt;rightJoyY = data[6]; pad-&gt;leftJoyX = data[7]; pad-&gt;leftJoyY = data[8]; default: buf = stdpar[pad_num]; buf[2] = pad-&gt;buttonStatus; buf[3] = pad-&gt;buttonStatus &gt;&gt; 8; if (padstate[pad_num].PadMode == 1) { buf[4] = pad-&gt;rightJoyX; buf[5] = pad-&gt;rightJoyY; buf[6] = pad-&gt;leftJoyX; buf[7] = pad-&gt;leftJoyY; } else { CmdLen = 4; } return padstate[pad_num].PadID; } }</span></span></code> </pre><br>  Luego, cuando el comando actual est√° leyendo, el gamepad se sondea y los datos se escriben en variables, y luego el emulador los toma. <br><br>  Eso es todo, solo queda compilar el proyecto.  Para que el compilador recoja la biblioteca wirigPi, debe insertar un enlace en el Makefile del proyecto.  Esto es suficiente para hacer desde el principio. <br><br><pre> <code class="cpp hljs"># Makefile <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> PCSX ReARMed <span class="hljs-meta"><span class="hljs-meta"># default stuff goes here, so that config can override TARGET ?= pcsx CFLAGS += -Wall -ggdb -Ifrontend -ffast-math -I/usr/</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> -I/usr/</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta">/SDL LDLIBS += -lpthread -lSDL -lpng -lwiringPi </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> DEBUG CFLAGS += -DNDEBUG -g </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> CXXFLAGS += $(CFLAGS) #DRC_DBG = 1 #PCNT = 1</span></span></code> </pre><br>  Y es importante.  Para usar un gamepad anal√≥gico, el emulador debe especificar en la configuraci√≥n que se usa. <br><br>  No tengo muchos juegos para PS1, revis√© en alg√∫n lugar alrededor de 7. No funcion√≥ en Tomb Raider2 y Nuclear strike, pero esto es evidente porque estos juegos no saben qu√© es un gamepad anal√≥gico.  Probablemente necesite seleccionar el est√°ndar en la configuraci√≥n e intentarlo. <br><br>  PD: el emulador en s√≠ es mejor para ensamblar con banderas de optimizaci√≥n.  Est√° bien descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es403753/">https://habr.com/ru/post/es403753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es403743/index.html">Google AIY: Kit de fabricante de gadgets de control de voz</a></li>
<li><a href="../es403745/index.html">Competencia de reemplazo RD-180: Pasi√≥n</a></li>
<li><a href="../es403747/index.html">El asistente digital de Amazon Amazon se transform√≥ en asistente de laboratorio de ciencias</a></li>
<li><a href="../es403749/index.html">Preparaci√≥n de impuestos en 1950: "programaci√≥n" del IBM 403 utilizando un panel de complementos</a></li>
<li><a href="../es403751/index.html">La vida en el aire del oc√©ano. Lo que sucede a 326 metros sobre Petersburgo</a></li>
<li><a href="../es403755/index.html">Computadora de papel</a></li>
<li><a href="../es403757/index.html">Gestos m√°gicos como desaf√≠o para un ingeniero electr√≥nico.</a></li>
<li><a href="../es403759/index.html">Cient√≠ficos chinos han ense√±ado a la red neuronal a comprender lo que una persona ve a partir de escaneos de actividad cerebral</a></li>
<li><a href="../es403761/index.html">Bitcoin: volvamos al principio?</a></li>
<li><a href="../es403763/index.html">Trazado con dos ejes independientes en Matlab</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>