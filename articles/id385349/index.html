<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ∫Ô∏è üëÜüèº üíâ Arduino Mega Server dan Jam Waktu Nyata üë®üèø‚Äçü§ù‚Äçüë®üèΩ üî® üèÇüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pada artikel ini, Anda akan mempelajari cara kerja Arduino Mega Server dari waktu ke waktu dan bagaimana Anda dapat membuat proyek di Arduino yang ter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino Mega Server dan Jam Waktu Nyata</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/385349/"><img src="https://habrastorage.org/files/ce4/e16/81f/ce4e1681f98841af80ec3eeef2fce455.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini, Anda akan mempelajari cara kerja Arduino Mega Server dari waktu ke waktu dan bagaimana Anda dapat membuat proyek di Arduino yang terhubung secara waktu-nyata, terlepas dari apakah mereka memiliki modul RTC berbasis besi yang diinstal atau tidak. </font><font style="vertical-align: inherit;">Semua masalah bekerja dengan waktu nyata di Arduino akan dibahas secara rinci dan setelah membaca artikel ini Anda akan menjadi "pembuat jam" yang nyata.</font></font><br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esensi dari pertanyaan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setiap proyek yang kurang lebih serius di Arduino harus memiliki gagasan tentang waktu nyata saat ini. Misalnya, pembacaan sensor harus terikat waktu (jika tidak, tidak mungkin untuk membuat statistik dan bahkan grafik dasar), pengontrol harus melakukan tindakan tertentu tergantung pada waktu saat ini hari, akhir pekan, liburan, dll. Jika pengontrol Anda tidak tahu tentang waktu nyata, itu berubah menjadi mesin sederhana yang hanya dapat melakukan tindakan dasar pada program yang didefinisikan dengan kaku. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sejak </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arduino Mega Server</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ini adalah sistem yang kuat dan dikembangkan, maka keadaan ini (kurangnya pekerjaan dengan waktu nyata) tidak cocok untuk saya, dan semua pengguna sistem lainnya. </font><font style="vertical-align: inherit;">Oleh karena itu, masalah integrasi ke dalam sistem RTC adalah salah satu yang pertama dalam agenda.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jam waktu nyata virtual</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Semuanya akan baik-baik saja, tetapi baik saya, maupun sebagian besar pengguna AMS memiliki modul RTC "besi" yang sama, sehingga diputuskan untuk melakukan "menunggang kuda" dan, sebagai tindakan sementara, mengatur jam waktu nyata yang bekerja di dalam sistem, tanpa modul fisik nyata. </font><font style="vertical-align: inherit;">Yang berhasil diimplementasikan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, bagaimana mengatur RTC virtual, tanpa modul nyata. </font><font style="vertical-align: inherit;">Ada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perpustakaan Waktu yang</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> luar biasa </font><font style="vertical-align: inherit;">yang melakukan bagian terbesar dari pekerjaan menyediakan waktu yang akurat bagi kami. </font><font style="vertical-align: inherit;">Untuk mulai bekerja dengannya, Anda perlu mengunduh, membuka ritsletingnya dan meletakkannya di lokasi standar semua perpustakaan di lingkungan Arduino, yaitu di folder:</font></font><br>
<br>
<pre><code class="java hljs">\rduino\libraries\
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah itu, semua kemungkinan bekerja dengan waktu yang disediakannya tersedia bagi kami.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bagaimana itu bekerja</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Prinsipnya sangat sederhana. Perpustakaan "meluncurkan" jam virtual "di dalam" controller dan menyediakan kemampuan untuk menyinkronkannya dalam berbagai cara, untuk dipilih. Anda dapat memilih metode yang paling sesuai untuk Anda. Karena Arduino Mega Server adalah perangkat jaringan, opsi untuk menyinkronkan jam melalui jaringan dengan server waktu yang tepat dipilih. Ini bisa berupa server di Internet atau server di jaringan lokal tempat layanan terkait berjalan. Misalnya, dalam versi dasar AMS, jam disinkronkan dengan server </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MajorDoMo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan Anda tidak perlu mengonfigurasi apa pun untuk ini, semuanya berfungsi di luar kotak. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, agar ini berfungsi, Anda harus menghubungkan perpustakaan yang sesuai di awal sketsa.</font></font><br>
<br>
<pre><code class="java hljs">#include &lt;SPI.h&gt;<font></font>
#include &lt;Ethernet.h&gt;<font></font>
#include &lt;EthernetUdp.h&gt;<font></font>
#include &lt;Time.h&gt; <font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
File Time.h sebenarnya adalah sebuah perpustakaan untuk bekerja dengan waktu, dan sisa file diperlukan untuk bekerja dengan jaringan dan untuk menyinkronkan waktu menggunakan protokol NTP (perpustakaan Ethernet juga harus diinstal). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, Anda perlu menentukan alamat IP server yang ingin Anda selaraskan waktu</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function">IPAddress <span class="hljs-title">timeServer</span><span class="hljs-params">(<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>)</span></span>; <span class="hljs-comment">//   MajorDoMo  </span>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan port yang sesuai</font></font><br>
<br>
<pre><code class="java hljs">unsigned <span class="hljs-keyword">int</span> localPort = <span class="hljs-number">8888</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tetapi ada satu titik: port 8888 cocok untuk sinkronisasi pada jaringan lokal, dan sebagian besar server di Internet tidak merespons, jadi jika Anda berencana untuk menyinkronkan waktu dengan server waktu yang tepat di Internet, lebih baik untuk mengatur port 123:</font></font><br>
<br>
<pre><code class="java hljs">unsigned <span class="hljs-keyword">int</span> localPort = <span class="hljs-number">123</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
tetap hanya untuk menunjukkan zona waktu</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> timeZone = <span class="hljs-number">4</span>;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan membuat objek EthernetUDP</font></font><br>
<br>
<pre><code class="java hljs">EthernetUDP Udp;
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mengenai hal ini, operasi persiapan dapat dianggap selesai dan Anda dapat menggambarkan fungsionalitas yang Anda perlukan untuk bekerja seiring waktu. </font><font style="vertical-align: inherit;">Fungsi inisialisasi:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rtcInit</span><span class="hljs-params">()</span> </span>{<font></font>
  Udp.begin(localPort);<font></font>
  Serial.println(<span class="hljs-string">"Waiting for NTP sync..."</span>);<font></font>
  setSyncProvider(getNtpTime);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda perlu memperhatikan fungsinya</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(getNtpTime);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi ini menetapkan sumber sinkronisasi waktu (dalam hal ini, sinkronisasi NTP melalui jaringan). Tetapi bisa juga sumber lain, misalnya, modul fisik RTC. Kinerja fungsi ini mengarah pada pemasangan sumber sinkronisasi (untuk masa depan) dan, pada saat yang sama, menuju sinkronisasi waktu melalui sumber ini. Pada saat melakukan fungsi ini maka waktu yang tepat "muncul" di sistem Anda. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perpustakaan itu sendiri memiliki fitur menarik lainnya,</font></font><br>
<br>
<pre><code class="java hljs">setSyncInterval(interval);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
yang memungkinkan Anda untuk mengatur interval yang diinginkan antara sinkronisasi (diatur dalam detik, sinkronisasi itu sendiri terjadi secara otomatis, tanpa partisipasi Anda). </font></font><br>
<br>
<img src="https://habrastorage.org/files/994/655/c68/994655c686114b5c897a038f300e1e61.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda dapat menggunakan waktu yang tepat di dalam sketsa Arduino, misalnya, menampilkan acara di monitor Serial tidak mudah, tetapi terikat dengan waktu yang tepat. </font><font style="vertical-align: inherit;">Ini dilakukan menggunakan fungsi timeStamp ():</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">timeStamp</span><span class="hljs-params">()</span> </span>{<font></font>
  serialRTC();<font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
yang merupakan pembungkus untuk fungsi serialRTC ():</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">serialRTC</span><span class="hljs-params">()</span> </span>{<font></font>
  Serial.print(year()); <font></font>
  Serial.print(<span class="hljs-string">"-"</span>);<font></font>
  printDigits(month());<font></font>
  Serial.print(<span class="hljs-string">"-"</span>);<font></font>
  printDigits(day());<font></font>
  Serial.print(<span class="hljs-string">" "</span>);<font></font>
  printDigits(hour());<font></font>
  Serial.print(<span class="hljs-string">":"</span>);<font></font>
  printDigits(minute());<font></font>
  Serial.print(<span class="hljs-string">":"</span>);<font></font>
  printDigits(second());<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Analisis mekanisme untuk mentransmisikan dan menampilkan waktu di antarmuka web AMS berada di luar cakupan cerita ini dan layak untuk artikel terpisah dan, jika ada minat, kita dapat menulis sekuel dan menjelaskan secara terperinci bagaimana "keajaiban" tampilan waktu di antarmuka web Arduino Mega Server </font></font><br>
<br>
<img src="https://habrastorage.org/files/ca9/d1c/bec/ca9d1cbec3084d169566dbaa1cf2cf99.png" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebenarnya itu saja. </font><font style="vertical-align: inherit;">Ini adalah bagaimana jam real-time virtual diorganisasikan dalam AMS hingga versi 0.12 inklusif, dan Anda juga dapat mengatur kerja dengan waktu yang akurat dalam proyek Anda, bahkan jika Anda tidak memiliki modul fisik untuk jam real-time. </font><font style="vertical-align: inherit;">Tapi ini bukan akhir dari cerita, melainkan hanya permulaan.</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kode modul RTC penuh dari Arduino Mega Server 0.12</font></font></b><div class="spoiler_text">/*<br>
 Modul Virtual RTC<br>
 part of Arduino Mega Server project<br>
*/<br>
<br>
// Virtual RTC<br>
<br>
IPAddress timeServer(192, 168, 2, 8);<br>
unsigned int localPort = 8888; // local port to listen for UDP packets<br>
EthernetUDP Udp;<br>
<br>
const int timeZone = 4;<br>
time_t prevDisplay = 0; // when the digital clock was displayed<br>
<br>
void rtcInit() {<br>
 Udp.begin(localPort);<br>
 Serialprint(¬´Waiting for NTP sync‚Ä¶ \n¬ª);<br>
 setSyncProvider(getNtpTime);<br>
 modulRtc = 1;<br>
}<br>
<br>
void rtcWorks() {<br>
 if (timeStatus() != timeNotSet) {<br>
 if (now() != prevDisplay) { // update the display only if time has changed<br>
 setLifer();<br>
 prevDisplay = now();<br>
 //digitalClockDisplay(); <br>
 }<br>
 }<br>
}<br>
<br>
void printDigits(int digits) {<br>
 if(digits &lt; 10) {<br>
 Serial.print('0');<br>
 }<br>
 Serial.print(digits);<br>
}<br>
<br>
void serialRTC() {<br>
 Serial.print(year()); <br>
 Serial.print("-");<br>
 printDigits(month());<br>
 Serial.print("-");<br>
 printDigits(day());<br>
 Serial.print(" ");<br>
 printDigits(hour());<br>
 Serial.print(":");<br>
 printDigits(minute());<br>
 Serial.print(":");<br>
 printDigits(second());<br>
}<br>
<br>
void timeStamp() {<br>
 serialRTC();<br>
 Serial.print(" ");<br>
}<br>
<br>
void printRTC(){<br>
 serialRTC();<br>
 Serial.println();<br>
}<br>
<br>
// NTP code<br>
<br>
const int NTP_PACKET_SIZE = 48; // NTP time is in the first 48 bytes of message<br>
byte packetBuffer[NTP_PACKET_SIZE]; //buffer to hold incoming &amp; outgoing packets<br>
<br>
#ifdef RTC_FEATURE<br>
<br>
time_t getNtpTime() {<br>
 while (Udp.parsePacket() &gt; 0); // discard any previously received packets<br>
 Serialprint(¬´Transmit NTP request\n¬ª);<br>
 sendNTPpacket(timeServer);<br>
 uint32_t beginWait = millis();<br>
 while (millis() ‚Äî beginWait &lt; 1500) {<br>
 int size = Udp.parsePacket();<br>
 if (size &gt;= NTP_PACKET_SIZE) {<br>
 Serialprint(¬´Receive NTP response\n¬ª);<br>
 Udp.read(packetBuffer, NTP_PACKET_SIZE); // read packet into the buffer<br>
 unsigned long secsSince1900;<br>
 // convert four bytes starting at location 40 to a long integer<br>
 secsSince1900 = (unsigned long)packetBuffer[40] &lt;&lt; 24;<br>
 secsSince1900 |= (unsigned long)packetBuffer[41] &lt;&lt; 16;<br>
 secsSince1900 |= (unsigned long)packetBuffer[42] &lt;&lt; 8;<br>
 secsSince1900 |= (unsigned long)packetBuffer[43];<br>
 return secsSince1900 ‚Äî 2208988800UL + timeZone * SECS_PER_HOUR;<br>
 }<br>
 }<br>
 Serialprint(¬´No NTP response\n¬ª);<br>
 return 0; // return 0 if unable to get the time<br>
}<br>
<br>
// send an NTP request to the time server at the given address<br>
void sendNTPpacket(IPAddress &amp;address) {<br>
 // set all bytes in the buffer to 0<br>
 memset(packetBuffer, 0, NTP_PACKET_SIZE);<br>
 // Initialize values needed to form NTP request<br>
 // (see URL above for details on the packets)<br>
 packetBuffer[0] = 0b11100011; // LI, Version, Mode<br>
 packetBuffer[1] = 0; // Stratum, or type of clock<br>
 packetBuffer[2] = 6; // Polling Interval<br>
 packetBuffer[3] = 0xEC; // Peer Clock Precision<br>
 // 8 bytes of zero for Root Delay &amp; Root Dispersion<br>
 packetBuffer[12] = 49;<br>
 packetBuffer[13] = 0x4E;<br>
 packetBuffer[14] = 49;<br>
 packetBuffer[15] = 52;<br>
 // all NTP fields have been given values, now<br>
 // you can send a packet requesting a timestamp: <br>
 Udp.beginPacket(address, 123); //NTP requests are to port 123<br>
 Udp.write(packetBuffer, NTP_PACKET_SIZE);<br>
 Udp.endPacket();<br>
}<br>
<br>
#endif<br>
<br>
// Duration<br>
<br>
void showDuration(time_t duration) {<br>
 // prints the duration in days, hours, minutes and seconds<br>
 Serialprint(" (duration ");<br>
 if(duration &gt;= SECS_PER_DAY){<br>
 Serial.print(duration / SECS_PER_DAY);<br>
 Serialprint(" day "); <br>
 duration = duration % SECS_PER_DAY; <br>
 }<br>
 if(duration &gt;= SECS_PER_HOUR){<br>
 Serial.print(duration / SECS_PER_HOUR);<br>
 Serialprint(" hour "); <br>
 duration = duration % SECS_PER_HOUR; <br>
 }<br>
 if(duration &gt;= SECS_PER_MIN){<br>
 Serial.print(duration / SECS_PER_MIN);<br>
 Serialprint(" min "); <br>
 duration = duration % SECS_PER_MIN; <br>
 }<br>
 Serial.print(duration);<br>
 Serialprint(" sec) \n"); <br>
}<br>
<br>
void checkEvent(time_t* prevEvent) {<br>
 time_t duration = 0;<br>
 time_t timeNow = now();<br>
 <br>
 if (*prevEvent &gt; 0) {<br>
 duration = timeNow ‚Äî *prevEvent;<br>
 } <br>
 if (duration &gt; 0) {<br>
 showDuration(duration);<br>
 } <br>
 *prevEvent = timeNow;<br>
}<br>
<br>
</div></div><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kejutan yang menyenangkan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya tidak akan sibuk mengintegrasikan modul RTC ke dalam sistem untuk waktu yang lama (ada juga cukup tugas mendesak lainnya), tetapi di sini, dalam rangka kerja sama teknologi dengan proyek kami, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSTER</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> menyediakan </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;">peralatan</font></a><font style="vertical-align: inherit;"> untuk pengujian dan integrasi ke dalam AMS, di antaranya terdapat modul Ethernet berdasarkan chip </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W5500</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan ... modul jam waktu nyata pada chip </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DS3231</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , yang ternyata menjadi yang paling tepat dan berfungsi sebagai pendorong untuk integrasi modul RTC ke dalam sistem. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ternyata perusahaan CHIPSTER tidak hanya menjual peralatan elektronik, tetapi juga mengembangkan produknya sendiri untuk Arduino dan otomatisasi dengan merek </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Geegrow</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dan memiliki rencana besar untuk masa depan dalam arah ini, khususnya, ia memiliki proyek untuk rilis versi khusus dari Arduino Mega 2560 dengan fitur-fitur canggih dan "disesuaikan" khusus untuk Server Arduino Mega. </font><font style="vertical-align: inherit;">Dan, jika papan ini dirilis, itu akan menjadi acara yang sangat menarik. </font><font style="vertical-align: inherit;">Tetapi kembali ke jam waktu nyata.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jam waktu nyata</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Karena modul RTC ada di ujung jari saya, akan menjadi dosa jika tidak mengintegrasikannya ke dalam sistem. Untungnya, ini menjadi sangat sederhana berkat Time Library yang sama. Tetapi hal pertama yang pertama. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bagi mereka yang tidak tahu, ada dua jenis modul waktu nyata - "biasa" (biasanya pada chip DS1307) dan "lanjutan" (pada chip DS3231, yang saya dapatkan). Perbedaan antara keduanya adalah bahwa yang pertama tidak terlalu akurat dan dapat "melarikan diri" dengan sangat cepat dan sangat kuat, dan yang kedua adalah arloji presisi tinggi dengan perawatan yang dinormalisasi tidak lebih dari dua menit setahun, yang sebenarnya berlaku dalam praktik. Dan akurasi dicapai berkat desain sirkuit yang lebih kompleks dan kompensasi termal bawaan.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Namun secara pemrograman, kedua versi modul tersebut kompatibel dan keduanya akan bekerja dengan pustaka dan kode. </font><font style="vertical-align: inherit;">Perbedaannya hanya pada akurasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan tentu saja, salah satu sifat utama jam real-time adalah kemampuan untuk bekerja ketika daya dimatikan, karena baterai bawaan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Koneksi fisik</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita bicara tentang bagaimana menghubungkan secara fisik modul RTC ke Arduino Mega Server atau ke proyek Arduino Anda. Saya harus mengatakan bahwa ini sangat sederhana dan Anda hanya perlu dua resistor dan beberapa kabel. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sambungan sepele: Anda perlu menemukan empat kontak pada modul Anda - GND (ground), VCC (tegangan suplai), SCL (signal clock), SDA (data). Kontak lain digunakan dalam kasus yang jarang dan spesifik dan Anda dapat mengabaikannya. </font></font><br>
<br>
<img src="https://habrastorage.org/files/7ec/49a/566/7ec49a56688f40f2a824adef2f625774.jpg" alt="gambar"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami menghubungkan pin GND ke ground, pin VCC ke tegangan suplai pengontrol. Semuanya sederhana di sini dan tidak ada pertanyaan yang muncul.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Kesimpulan lainnya tidak jauh lebih rumit. </font><font style="vertical-align: inherit;">Modul RTC berkomunikasi dengan controller melalui antarmuka I2C, yang hanya memiliki dua kabel: sinkronisasi dan data, dan pengontrol Arduino sudah memiliki kontak untuk menghubungkan antarmuka ini. </font><font style="vertical-align: inherit;">Arduino Uno adalah A4 (SDA) dan A5 (SCL), sedangkan arduino Mega adalah D20 (SDA) dan D21 (SCL). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Satu-satunya kehalusan adalah bahwa pin SCL dan SDA perlu "ditarik" ke sumber daya melalui resistor 4,7 kŒ©. </font><font style="vertical-align: inherit;">Jika Anda tidak memiliki peringkat ini secara tepat, maka Anda dapat menggunakan resistor dari kisaran 2 KOhm - 10 KOhm.</font></font><br>
<br>
<img src="https://habrastorage.org/files/490/875/26d/49087526d1544d56947ee66ed7b19150.jpg" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dukungan perangkat lunak</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang tinggal menambahkan dukungan untuk modul dalam kode AMS atau proyek Anda. </font><font style="vertical-align: inherit;">Seperti yang saya katakan, itu akan sangat sederhana karena Perpustakaan Waktu yang sama akan bekerja dengan modul. </font><font style="vertical-align: inherit;">Benar, kita perlu menambahkan perpustakaan lain, yaitu </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perpustakaan DS1307RTC</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Kami juga membongkar dan meletakkannya di folder perpustakaan standar:</font></font><br>
<br>
<pre><code class="java hljs">\rduino\libraries\
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambahkan baris berikut ke kode sketsa Anda</font></font><br>
<br>
<pre><code class="java hljs">#include &lt;Wire.h&gt;<font></font>
#include &lt;DS1307RTC.h&gt;<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang kita sudah lengkap dan kita dapat mulai menulis kode untuk sketsa itu sendiri, bekerja dengan modul fisik RTC. </font><font style="vertical-align: inherit;">Berfungsi</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rtcInit</span><span class="hljs-params">()</span> </span>{<font></font>
  Udp.begin(localPort);<font></font>
  Serial.println(<span class="hljs-string">"Waiting for NTP sync..."</span>);<font></font>
  setSyncProvider(getNtpTime);<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
ganti string</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(getNtpTime);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
di</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(RTC.get);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan waktu internal Arduino Mega Server (atau pengontrol Anda) akan disinkronkan dengan pengontrol RTC "besi", dan bukan dengan server di Internet atau jaringan lokal. </font><font style="vertical-align: inherit;">Jadi, dengan memanggil fungsi setSyncProvider (getNtpTime) dan setSyncProvider (RTC.get), Anda dapat memanipulasi sumber sinkronisasi waktu dan menyinkronkan waktu sesuai keinginan, tergantung pada berbagai kondisi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Fungsi lain yang perlu Anda ketahui adalah</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-keyword">if</span> (timeStatus() != timeNotSet) {<font></font>
<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
yang memungkinkan Anda untuk mengetahui apakah waktu disinkronkan dan, tergantung pada kondisi ini, mengambil tindakan yang diperlukan.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Momen halus</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Anda perlu membedakan antara dua hal: waktu yang ada di modul "besi" RTC dan waktu yang ada di controller Anda. Ini bukan hal yang sama. Yang "utama" bagi Anda adalah waktu di controller, dan waktu di modul hanyalah sumber untuk sinkronisasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi! karena waktu dalam RTC fisik juga secara bertahap ‚Äúhabis‚Äù, maka juga perlu disesuaikan dengan menyinkronkan dengan sumber yang lebih akurat, misalnya server di Internet. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, algoritme yang optimal seharusnya adalah ini: jika memungkinkan, kemudian menyinkronkan semua jam dengan server di Internet, jika jaringan tidak tersedia, maka kami mulai menyinkronkan waktu dalam pengontrol dengan modul RTC, segera setelah jaringan muncul, kembali ke sinkronisasi melalui Internet.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jika Anda berada dalam kondisi ekstrem, tanpa akses ke sumber sinkronisasi apa pun, Anda dapat secara manual menyesuaikan arah jam besi dari waktu ke waktu. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sebagai contoh, mari kita perhatikan fungsi sinkronisasi jam internal controller dan modul RTC melalui jaringan:</font></font><br>
<br>
<pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">rtcSync</span><span class="hljs-params">()</span> </span>{<font></font>
  setSyncProvider(getNtpTime);<font></font>
  Serial.println(<span class="hljs-string">"...getNtpTime..."</span>);
  <span class="hljs-keyword">if</span> (timeStatus() != timeNotSet) {<font></font>
    Serial.println(<span class="hljs-string">"...set!..."</span>);<font></font>
    time_t t = getNtpTime();<font></font>
    RTC.set(t);<font></font>
    setSyncProvider(RTC.get);<font></font>
  }<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini kita pertama kali mendapatkan waktu yang tepat melalui jaringan.</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(getNtpTime);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
kemudian, jika berhasil, pasang di modul RTC</font></font><br>
<br>
<pre><code class="java hljs">RTC.set(t);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
dan kemudian dari modul ini kita atur waktu pengontrol</font></font><br>
<br>
<pre><code class="java hljs">setSyncProvider(RTC.get);
</code></pre><br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Peluncuran awal</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tapi itu belum semuanya. </font><font style="vertical-align: inherit;">Ada juga masalah start-up awal, ketika modul RTC hanya terhubung, tetapi waktu di dalamnya tidak diatur dan oleh karena itu tidak mungkin untuk melakukan sinkronisasi dengannya. </font><font style="vertical-align: inherit;">Anda perlu entah bagaimana mengatur waktu yang tepat di dalamnya. </font><font style="vertical-align: inherit;">Ada dua cara untuk mengatasi masalah ini di Server Arduino Mega: Anda dapat menyinkronkan RTC fisik melalui jaringan (jika server waktu tersedia) atau menggunakan utilitas Arduino Serial Commander.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengatur waktu dalam modul RTC, cukup ... klik pada tombol. </font><font style="vertical-align: inherit;">Segala sesuatu yang lain akan dilakukan untuk Anda oleh dua pemuda bernama Arduino Mega Server dan Arduino Serial Commander. </font><font style="vertical-align: inherit;">Jika Anda tidak menggunakan AMS, tetapi sedang mengembangkan proyek Anda sendiri, Anda dapat mengambil kode dari kit distribusi Arduino Mega Server (kode tersedia dan benar-benar gratis) atau mencari solusi untuk masalah ini di Internet (ada beberapa solusi).</font></font><br>
<br>
<img src="https://habrastorage.org/files/df7/2b1/c4b/df72b1c4b4594bd082d9a0b8c7cdc6c6.png" alt="gambar"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versi dengan dukungan RTC nyata</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Arduino Mega Server, dimulai dengan versi 0.13, mendukung RTC "besi". </font><font style="vertical-align: inherit;">Anda dapat mengunduh versi terbaru saat ini dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">situs web resmi proyek</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , dan </font><font style="vertical-align: inherit;">Anda dapat </font><font style="vertical-align: inherit;">mengajukan pertanyaan di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forum</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan, tentu saja, saya mengucapkan terima kasih kepada </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CHIPSTER</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> atas kerja sama dan peralatan yang disediakan untuk pengujian dan integrasi (saya akan memberi tahu Anda tentang modul W5500 dan percepatan operasi jaringan AMS di salah satu artikel berikut). </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saluran Youtube terbuka dan berikut ini adalah </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">video promo dari</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Arduino Mega Server, yang menunjukkan cara bekerja dengan sistem nyata.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id385349/">https://habr.com/ru/post/id385349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id385339/index.html">Intel memperkenalkan SSD tercepat</a></li>
<li><a href="../id385341/index.html">Daging artifisial yang tumbuh di laboratorium akan dijual dalam 5 tahun ke depan</a></li>
<li><a href="../id385343/index.html">Sihir kecil dari Apple - Magic Keyboard, Trackpad, Mouse dan iMac baru</a></li>
<li><a href="../id385345/index.html">Thor's Hammer in Real Life: Magnet dan Pemindai Sidik Jari</a></li>
<li><a href="../id385347/index.html">Pembuat komputer Bitcoin 21 Bitcoin meluncurkan kursus pengembang</a></li>
<li><a href="../id385351/index.html">–í –ù–ê–°–ê –æ—Ç–≤–µ—Ä–≥–ª–∏ –ø—Ä–æ–µ–∫—Ç –¥–æ—Å—Ç–∞–≤–∫–∏ –æ—Ä–±–∏—Ç–∞–ª—å–Ω—ã—Ö –≥—Ä—É–∑–æ–≤ –æ—Ç Lockheed Martin –∫–∞–∫ —Å–ª–∏—à–∫–æ–º —Å–ª–æ–∂–Ω—ã–π –∏ –¥–æ—Ä–æ–≥–æ–π</a></li>
<li><a href="../id385353/index.html">Prototipe kerja modul akselerator mikropartikel dengan panjang 1,5 cm telah dibuat</a></li>
<li><a href="../id385355/index.html">Pembajakan online Australia menurun berkat Netflix</a></li>
<li><a href="../id385361/index.html">Windows 10 Mobile - build 10549 tersedia untuk orang dalam</a></li>
<li><a href="../id385363/index.html">Video autopilot Tesla lalu lintas perkotaan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>