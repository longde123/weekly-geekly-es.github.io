<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíò üé† üèùÔ∏è ChipWhisperer: ataque de energia no magma ü§ó üë®üèª‚Äçüî¨ üë©üèø‚Äçü§ù‚Äçüë®üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Postado por rakf 





 Como parte do ver√£o do Hack 2019 na Digital Security, lidei com um ataque de energia e trabalhei com o ChipWhisperer. 
 O que ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ChipWhisperer: ataque de energia no magma</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/477730/"><p>  Postado por <a href="https://habr.com/ru/users/rakf/" class="user_link">rakf</a> </p><br><p><img src="https://habrastorage.org/webt/t1/qx/44/t1qx44fuppd2dlfmn-vvb6fsriq.jpeg"></p><br><p>  Como parte do ver√£o do Hack 2019 na Digital Security, lidei com um ataque de energia e trabalhei com o ChipWhisperer. </p><br><h2 id="chto-eto">  O que √© isso </h2><br><p>  A an√°lise de energia √© um tipo de ataque atrav√©s de canais de terceiros.  Ou seja, ataques que usam informa√ß√µes que aparecem como resultado da implementa√ß√£o f√≠sica do sistema. </p><br><p>  Quais informa√ß√µes podem ser √∫teis para um invasor: </p><br><ul><li>  tempo de convers√£o criptogr√°fica; </li><li>  consumo de energia; </li><li>  campos eletromagn√©ticos; </li><li>  barulho etc. </li></ul><br><p>  Um ataque de energia √© considerado o mais universal. </p><a name="habracut"></a><br><h2 id="pochemu-rabotaet">  Por que isso funciona? </h2><br><p>  Microprocessadores, microcontroladores, RAM e muitos outros circuitos l√≥gicos s√£o baseados na tecnologia CMOS.  O consumo de energia dos circuitos CMOS consiste em dois componentes: est√°tico e din√¢mico.  O consumo de energia est√°tica √© muito pequeno, o que √© uma das raz√µes da monopoliza√ß√£o da tecnologia.  A pot√™ncia din√¢mica √© devida √† comuta√ß√£o de transistores e depende dos dados processados ‚Äã‚Äãe das opera√ß√µes executadas.  Como o componente est√°tico √© principalmente constante, a mudan√ßa na pot√™ncia total √© devida exclusivamente √† energia din√¢mica e, portanto, o consumo total de energia pode ser usado para an√°lise. </p><br><h2 id="instrumentariy">  Toolkit </h2><br><p>  <a href="https://newae.com/tools/chipwhisperer/">ChipWhisperer</a> , usei a vers√£o em duas partes: </p><br><p><img src="https://habrastorage.org/webt/56/p3/p4/56p3p4nq89l3drktqn9c0eo1mta.jpeg" alt="Vers√£o em 2 Partes ChipWhisperer"></p><br><p>  O ChipWhisperer √© um kit de ferramentas de c√≥digo aberto para pesquisar a seguran√ßa de dispositivos incorporados.  Permite an√°lise de energia e ataques baseados em erros. </p><br><p>  A taxa vai custar US $ 250.  Os desenvolvedores a posicionam como uma solu√ß√£o revolucion√°ria, porque esses complexos, segundo os criadores, custam US $ 30 mil.  O dispositivo consiste em 2 placas: placa de captura e alvo. </p><br><p>  Existem outras vers√µes, com suas vantagens (mas tamb√©m com um grande custo), voc√™ tamb√©m pode comprar separadamente v√°rias placas de destino, placas de expans√£o, sondar para uma an√°lise completa de seus dispositivos e usar o ChipWhisperer apenas para remo√ß√£o. </p><br><p>  O ChipWhisperer possui um <a href="https://wiki.newae.com/Main_Page">wiki</a> excelente, pequenos <a href="https://chipwhisperer.readthedocs.io/en/latest/tutorials.html">laborat√≥rios de</a> desenvolvimento e, na 5¬™ vers√£o, eles at√© fizeram uma boa <a href="https://chipwhisperer.readthedocs.io/en/latest/api.html">documenta√ß√£o da</a> API.  As faixas s√£o removidas do dispositivo conectado usando seu software e gravadas como uma matriz NumPy. </p><br><p>  Primeiro voc√™ precisa escrever o firmware para o dispositivo de destino.  Como parte do laborat√≥rio, as cifras AES, DES, TEA s√£o consideradas.  Para eles, j√° existem firmware e configura√ß√µes prontos para remover rastreamentos (o n√∫mero de amostras a serem coletadas, deslocamento, frequ√™ncia ADC, etc.).  Para pesquisas independentes, as configura√ß√µes dever√£o ser selecionadas experimentalmente. </p><br><p>  Como mencionado acima, voc√™ pode provocar uma falha no quadro de destino: causando um mau funcionamento do sinal do rel√≥gio, pular instru√ß√µes e extrair informa√ß√µes secretas. </p><br><p>  Em grandes complexos, um oscilosc√≥pio √© usado para rastrear trilhas. </p><br><h2 id="analiz">  An√°lise </h2><br><p>  Existem v√°rios m√©todos b√°sicos de an√°lise: </p><br><ul><li>  an√°lise simples de energia (SPA); </li><li>  an√°lise de pot√™ncia diferencial (DPA); </li><li>  an√°lise de correla√ß√£o de pot√™ncia (CPA). </li></ul><br><p> Uma simples an√°lise de pot√™ncia inclui uma an√°lise visual do gr√°fico de pot√™ncia.  Por exemplo, uma senha pode ser obtida com um caractere de cada vez, observando o perfil de pot√™ncia quando o caractere correto √© inserido e comparando com o errado. </p><br><p><img src="https://habrastorage.org/webt/ep/rf/tg/eprftggxt26idk5tq4uccp3p9kq.png" alt="An√°lise de poder da senha"></p><br><p>  Ou voc√™ pode ver as rodadas de criptografia nas faixas.  N√£o h√° dados suficientes para obter uma chave, mas pode-se assumir qual algoritmo √© executado.  A figura mostra claramente 10 rodadas de AES. </p><br><p><img src="https://habrastorage.org/webt/ib/pl/e7/ibple7hxooxtxb1bkah2d1k-i_s.png" alt="AES SPA"></p><br><p>  A an√°lise diferencial (DPA) √© muito mais eficiente do que a an√°lise simples, baseada em m√©todos de an√°lise estat√≠stica para detectar diferen√ßas nos tra√ßos de energia.  Uma ferramenta muito eficaz, no entanto, para "abrir" a chave exigir√° um grande n√∫mero de rotas.  N√£o usei esse m√©todo para an√°lise, mas no final darei alguns links para fontes onde √© bem descrito. </p><br><p>  A base da an√°lise de correla√ß√£o √© um aparato estat√≠stico para determinar a chave de criptografia secreta.  √Äs vezes, √© isolado em um tipo separado, √†s vezes chamado de DPA.  Este m√©todo requer menos tra√ßos do que o DPA, usei-o para an√°lise de energia.  Vou lhe contar mais sobre isso. </p><br><p>  A principal tarefa √© construir um modelo preciso de consumo de energia do dispositivo em estudo.  Se um modelo preciso for constru√≠do, h√° uma correla√ß√£o percept√≠vel entre o valor previsto e o real. </p><br><p>  Um dos modelos de pot√™ncia que pode ser usado √© o modelo de peso de Hamming.  O peso de Hamming √© o n√∫mero de valores diferentes de zero na representa√ß√£o bin√°ria.  A suposi√ß√£o deste modelo √© que o n√∫mero de bits definido no registro se correlacionar√° com a energia consumida pelo dispositivo.  O pr√≥prio peso de Hamming √© usado posteriormente como uma unidade convencional de energia.  O modelo de dist√¢ncia de Hamming tamb√©m √© usado - o n√∫mero de bits diferentes em 2 valores. </p><br><p>  Para comparar o modelo de peso de Hamming e o consumo real de energia, √© usado um coeficiente linear de Pearson.  Mostra a depend√™ncia linear de uma quantidade em outra.  Com um modelo constru√≠do corretamente, esse coeficiente tender√° a 1. </p><br><p>  O algoritmo de CPA generalizado consiste nas seguintes etapas principais: </p><br><ul><li>  remova o consumo de energia ao converter mensagens em uma chave desconhecida; </li><li>  constru√≠mos um modelo de consumo de energia do chip ao converter as mesmas mensagens em todas as variantes poss√≠veis do sub-bloco de chaves (256 op√ß√µes para cada byte); </li><li>  encontramos o coeficiente de correla√ß√£o linear para o consumo de energia simulado e real.  No caso de uma chave verdadeira, o coeficiente tender√° a 1; </li><li>  o algoritmo √© repetido para os sub-blocos de chaves restantes. </li></ul><br><p>  Como resultado, a chave √© restaurada sequencialmente, em pequenas partes.  Se atacarmos um byte da chave de cada vez, usaremos 2 <sup>8</sup> tentativas para cada chave.  Por exemplo, se voc√™ escolher AES - 128, o n√∫mero total de tentativas para 16 bytes da chave ser√° 2 <sup>12</sup> , o que √© muito melhor do que pressionar 2 <sup>128</sup> . </p><br><h3 id="analiz-shifra-magma">  An√°lise de Cifras de Magma </h3><br><p>  Magma √© um c√≥digo definido no GOST R 34.12-2015, na verdade o mesmo GOST 28147-89, apenas no perfil.  O bloco criptografado passa por 32 rodadas nas quais ocorrem algumas transforma√ß√µes.  A chave consiste em 256 bits, cada tecla redonda faz parte do original. </p><br><p><img src="https://habrastorage.org/webt/il/lf/jg/illfjg84nei10xf2xgboiifkmjy.png" alt="Fun√ß√£o Feistel GOST"></p><br><p>  Analisaremos os dados obtidos usando o m√©todo CPA. </p><br><p>  Primeiro, voc√™ precisa escolher um valor intermedi√°rio do algoritmo, que depende dos dados conhecidos e de uma pequena parte da chave e pode ser calculado por transforma√ß√µes simples.  Normalmente, esse valor √© a sa√≠da da caixa S (o Magma agora possui 1 tabela de substitui√ß√£o, portanto, √© mais f√°cil realizar esses ataques) do primeiro (textos abertos s√£o conhecidos) ou da √∫ltima rodada (textos cifrados s√£o conhecidos). </p><br><p>  Eu pesquisei uma chave com textos abertos bem conhecidos, portanto essa op√ß√£o ser√° considerada mais adiante.  No algoritmo Magma, ao contr√°rio do DES, AES, a adi√ß√£o de um bloco de 32 bits com uma chave redonda ocorre no m√≥dulo 2 <sup>32</sup> , portanto, √© melhor iniciar a an√°lise a partir das √∫ltimas sa√≠das S-box, pois a adi√ß√£o dos valores mais altos n√£o afeta os mais novos.  Consideramos a sa√≠da de cada caixa S: primeiro 8, depois 8, 7 e assim sucessivamente at√© o primeiro.  A remo√ß√£o da faixa foi realizada em um microcontrolador de 8 bits e podemos assumir que funcionou com duas caixas S.  Portanto, atacarei imediatamente por 1 byte. </p><br><p>  C√°lculo do modelo de energia para o √∫ltimo byte chave: </p><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> kguess <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-comment"><span class="hljs-comment">#Initialize arrays &amp; variables to zero sumnum = np.zeros(numpoint) sumden1 = np.zeros(numpoint) sumden2 = np.zeros(numpoint) hyp = np.zeros(numtraces) for tnum in range(numtraces): hyp[tnum] = HW[leak("Gost28147_tc26_ParamZ", kguess, block2ns(text[tnum])[0], 0)]</span></span></code> </pre> <br><p>  onde a fun√ß√£o de vazamento simplesmente retorna a sa√≠da S-box do √∫ltimo byte. </p><br><p>  Calculamos o coeficiente linear de Pearson para os valores simulados e reais de acordo com a f√≥rmula: </p><br><p><img src="https://habrastorage.org/webt/yt/wd/f-/ytwdf-ah0p0fshbi-i83_tldkvs.png" alt="Correla√ß√£o"></p><br><pre> <code class="python hljs"> cpaoutput = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> maxcpa = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-comment"><span class="hljs-comment">#Mean of hypothesis meanh = np.mean(hyp, dtype=np.float64) #Mean of all points in trace meant = np.mean(traces, axis=0, dtype=np.float64) #For each trace, do the following for tnum in range(0, numtraces): hdiff = (hyp[tnum] - meanh) tdiff = traces[tnum,:] - meant sumnum = sumnum + (hdiff*tdiff) sumden1 = sumden1 + hdiff*hdiff sumden2 = sumden2 + tdiff*tdiff cpaoutput[kguess] = sumnum / np.sqrt( sumden1 * sumden2 ) maxcpa[kguess] = max(abs(cpaoutput[kguess]))</span></span></code> </pre> <br><p>  Ao escolher uma subchave verdadeira, o coeficiente de correla√ß√£o ter√° um aumento significativo: </p><br><p><img src="https://habrastorage.org/webt/8o/7j/8z/8o7j8zrfxosgutb_eymflrxxhp0.png" alt="Correla√ß√£o1"></p><br><p>  Assim, cada byte da chave redonda √© analisado. </p><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): cpaoutput = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> maxcpa = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> kguess <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>): best_round_key = kguess &lt;&lt; (bnum * <span class="hljs-number"><span class="hljs-number">8</span></span>) | best_round ...</code> </pre> <br><p>  Dada a chave da primeira rodada, podemos calcular as 2 e as chaves da rodada subsequentes da mesma maneira.  Uma chave Magma completa pode ser obtida retirando 8 teclas redondas. </p><br><p>  No processo de solu√ß√£o desse problema, v√°rias nuances surgem.  Ao contr√°rio de AES, DES, cifras Grasshopper, a adi√ß√£o de uma chave redonda em texto simples ocorre no m√≥dulo 2 <sup>32</sup> .  A adi√ß√£o de bits baixos afeta o alto, ao contr√°rio do XORa.  Ao calcular cada subchave subseq√ºente, voc√™ deve considerar os resultados do passado.  Da mesma forma com as teclas redondas.  Os dados s√£o muito sens√≠veis.  Se um dos valores for calculado incorretamente, o c√°lculo adicional da chave inteira estar√° incorreto. </p><br><p>  Tamb√©m vale a pena considerar que agora √© bastante dif√≠cil encontrar um chip com arquitetura de quatro bits: a maioria dos chips possui oito bits.  Obviamente, existem chips criptogr√°ficos especializados, projetados para um algoritmo de convers√£o de seguran√ßa espec√≠fico (ou v√°rios algoritmos) e com a arquitetura mais eficiente. </p><br><p>  Para executar a cifra DES, esse criptoprocessador pode ter uma arquitetura de seis bits para o Magma - uma de quatro bits, que permite que cada caixa S seja processada separadamente.  Meu dispositivo de destino √© de 8 bits e, no caso de "Magma", a convers√£o ser√° realizada em oito bits em uma abordagem, ou seja,  a substitui√ß√£o ocorrer√° na caixa 2 S, o consumo de energia ser√° considerado na caixa 2 S.  Se uma das caixas S, s√™nior ou junior, corresponder √† chave verdadeira e a outra n√£o corresponder, poder√£o ocorrer altas explos√µes de correla√ß√£o. </p><br><p>  Diante de tudo isso, na sa√≠da, temos o seguinte script para a an√°lise dos caminhos de consumo de energia para a cifra Magma: </p><br><div class="spoiler">  <b class="spoiler_title">Script Python</b> <div class="spoiler_text"><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np path = <span class="hljs-string"><span class="hljs-string">r'C:\Users\user\chipwhisperer\projects\gost_10000_2_data\traces\2019.08.11-19.53.25_'</span></span> traces = np.load(path + <span class="hljs-string"><span class="hljs-string">'traces.npy'</span></span>) text = np.load(path + <span class="hljs-string"><span class="hljs-string">'textin.npy'</span></span>) keys = np.load(path + <span class="hljs-string"><span class="hljs-string">'keylist.npy'</span></span>) HW = [bin(n).count(<span class="hljs-string"><span class="hljs-string">"1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">256</span></span>)] SBOXES = {<span class="hljs-string"><span class="hljs-string">"Gost28147_tc26_ParamZ"</span></span>: ( (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>), (<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), (<span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>), (<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>), (<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), (<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>), )} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_K</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s, _in)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" S-box substitution :param s: S-box :param _in: 32-bit word :returns: substituted 32-bit word """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( (s[<span class="hljs-number"><span class="hljs-number">0</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">1</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">2</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">3</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">12</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">12</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">4</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">5</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">20</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">20</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">6</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>) + (s[<span class="hljs-number"><span class="hljs-number">7</span></span>][(_in &gt;&gt; <span class="hljs-number"><span class="hljs-number">28</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">28</span></span>) ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">block2ns</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Convert block to N1 and N2 integers """</span></span> data = bytearray(data) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( data[<span class="hljs-number"><span class="hljs-number">7</span></span>] | data[<span class="hljs-number"><span class="hljs-number">6</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | data[<span class="hljs-number"><span class="hljs-number">5</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | data[<span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>, data[<span class="hljs-number"><span class="hljs-number">3</span></span>] | data[<span class="hljs-number"><span class="hljs-number">2</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | data[<span class="hljs-number"><span class="hljs-number">1</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | data[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span>, ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addmod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y, mod=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ** </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">32</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Modulo adding of two integers """</span></span> r = x + int(y) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r &lt; mod <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> r - mod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_shift11</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" 11-bit cyclic shift """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((x &lt;&lt; <span class="hljs-number"><span class="hljs-number">11</span></span>) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">32</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>)) | ((x &gt;&gt; (<span class="hljs-number"><span class="hljs-number">32</span></span> - <span class="hljs-number"><span class="hljs-number">11</span></span>)) &amp; (<span class="hljs-number"><span class="hljs-number">2</span></span> ** <span class="hljs-number"><span class="hljs-number">32</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">round</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sbox, key, data, byte)</span></span></span><span class="hljs-function">:</span></span> s = SBOXES[sbox] _in = addmod(data, key) sbox_leak = _K(s, _in); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (sbox_leak &gt;&gt; (<span class="hljs-number"><span class="hljs-number">8</span></span> * byte)) &amp; <span class="hljs-number"><span class="hljs-number">0xFF</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Feistel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sbox, key, data, nround)</span></span></span><span class="hljs-function">:</span></span> s = SBOXES[sbox] w = bytearray(key) x = [ w[<span class="hljs-number"><span class="hljs-number">3</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] | w[<span class="hljs-number"><span class="hljs-number">2</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span> | w[<span class="hljs-number"><span class="hljs-number">1</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span> | w[<span class="hljs-number"><span class="hljs-number">0</span></span> + i * <span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>) ] n1, n2 = block2ns(data) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(nround): n1, n2 = _shift11(_K(s, addmod(n1, x[i]))) ^ n2, n1 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n1 numtraces = len(traces) numpoint = np.shape(traces)[<span class="hljs-number"><span class="hljs-number">1</span></span>] bestguess = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">32</span></span> round_data = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * numtraces <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(numtraces): round_data[i] = [<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> rnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>): best_round = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> tnum_r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(numtraces): round_data[tnum_r][rnum] = Feistel(<span class="hljs-string"><span class="hljs-string">"Gost28147_tc26_ParamZ"</span></span>, bestguess, text[tnum_r], rnum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bnum <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>): cpaoutput = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> maxcpa = [<span class="hljs-number"><span class="hljs-number">0</span></span>]*<span class="hljs-number"><span class="hljs-number">256</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> kguess <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">256</span></span>): <span class="hljs-comment"><span class="hljs-comment">#Initialize arrays &amp; variables to zero best_round_key = kguess &lt;&lt; (bnum * 8) | best_round sumnum = np.zeros(numpoint) sumden1 = np.zeros(numpoint) sumden2 = np.zeros(numpoint) hyp = np.zeros(numtraces) for tnum in range(numtraces): hyp[tnum] = HW[round("Gost28147_tc26_ParamZ", best_round_key, round_data[tnum][rnum], bnum)] #Mean of hypothesis meanh = np.mean(hyp, dtype=np.float64) #Mean of all points in trace meant = np.mean(traces, axis=0, dtype=np.float64) #For each trace, do the following for tnum in range(0, numtraces): hdiff = (hyp[tnum] - meanh) tdiff = traces[tnum,:] - meant sumnum = sumnum + (hdiff*tdiff) sumden1 = sumden1 + hdiff*hdiff sumden2 = sumden2 + tdiff*tdiff cpaoutput[kguess] = sumnum / np.sqrt( sumden1 * sumden2 ) maxcpa[kguess] = max(abs(cpaoutput[kguess])) best_round = best_round | (np.argmax(maxcpa) &lt;&lt; (bnum * 8)) bestguess[((rnum + 1) * 4)-bnum - 1] = np.argmax(maxcpa) print "Best Key Guess: " for b in bestguess: print "%02x "%b,</span></span></code> </pre> </div></div><br><p>  <a href="https://github.com/rakf/ChipWhisperer/tree/master/GOST">Reposit√≥rio de Resultados do GitHub</a> </p><br><h2 id="vyvody">  Conclus√µes </h2><br><p>  Como parte do estudo, trabalhei com o ChipWhisperer.  Apesar de n√£o ter experimentado todas as ferramentas (por exemplo, falhas), definitivamente considero o ChipWhisperer √∫til, especialmente se voc√™ n√£o deseja comprar hardware especial caro. </p><br><p>  Quanto √† an√°lise de nossa cifra para consumo de energia, ela √© mais resistente a esse ataque do que as cifras descritas acima, mas com dados suficientes, a chave pode ser obtida sem problemas. </p><br><p>  Materiais interessantes: </p><br><ul><li>  An√°lise de Pot√™ncia Diferencial P. Kocher </li><li>  "Ataques de an√°lise de energia: revelando os segredos dos cart√µes inteligentes" </li><li>  <a href="https://xakep.ru/2015/01/29/crypto-i-keys/">Criptografia na mira da arma I: procurando chaves de algoritmos criptogr√°ficos</a> R. Korkikyan. </li><li>  <a href="https://xakep.ru/2015/01/27/kriptogry-191/">Criptografia na mira da arma II: an√°lise nutricional diferencial</a> R. Korkikyan. </li><li>  <a href="https://xakep.ru/2015/01/27/kriptogry-191/">Relat√≥rio com ZeroNights 2014</a> R. Korkikyan. </li><li>  <a href="http://2014.zeronights.org/assets/files/slides/cryptocodingv2.pdf">cryptocoding v2</a> com ZeroNights 2014 sobre implementa√ß√£o de software. </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt477730/">https://habr.com/ru/post/pt477730/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt477716/index.html">Os matem√°ticos que usam o exemplo de "tag" calculam como a aleatoriedade ocorre</a></li>
<li><a href="../pt477718/index.html">Camada convolucional: convolu√ß√£o r√°pida de acordo com o m√©todo de Shmuel Vinograd</a></li>
<li><a href="../pt477722/index.html">Guia de estilo do Google em C ++. Parte 8</a></li>
<li><a href="../pt477724/index.html">Marca de RH habraseminar: sobre talentos, ca√ßa e conte√∫do</a></li>
<li><a href="../pt477728/index.html">O que fazer liderar a equipe para que ela n√£o se queime</a></li>
<li><a href="../pt477732/index.html">Classifica√ß√£o errada dos dedos dos sistemas de navega√ß√£o subaqu√°tica</a></li>
<li><a href="../pt477734/index.html">Compreendendo o UICollectionViewLayout com o aplicativo Fotos</a></li>
<li><a href="../pt477736/index.html">O caminho do testador: do "freio de m√£o" √† automa√ß√£o</a></li>
<li><a href="../pt477738/index.html">iKassa ou como domamos o "caixa digital"</a></li>
<li><a href="../pt477740/index.html">E onde olhar para este telesc√≥pio com o olho?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>