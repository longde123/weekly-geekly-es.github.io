<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍👩‍👧‍👦 🤶🏻 👩‍👧‍👧 Komplexität Wasserfall und Architektur auf Abruf 🧔🏼 🥙 😠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Wenn von "schlechtem Code" die Rede ist, meinen die Leute mit ziemlicher Sicherheit "komplexen Code" unter anderen populären Problemen. Die Sache mit ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Komplexität Wasserfall und Architektur auf Abruf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472876/"><p><img src="https://habrastorage.org/webt/g9/_9/wk/g9_9wkgu4h6i8xyelaq9p5nwmjy.png" alt="Logo"></p><br><p>  Wenn von "schlechtem Code" die Rede ist, meinen die Leute mit ziemlicher Sicherheit "komplexen Code" unter anderen populären Problemen.  Die Sache mit der Komplexität ist, dass sie aus dem Nichts kommt.  Eines Tages starten Sie Ihr ziemlich einfaches Projekt, am anderen Tag finden Sie es in Trümmern.  Und niemand weiß, wie und wann es passiert ist. </p><br><p>  Dies geschieht jedoch letztendlich aus einem bestimmten Grund!  Die Codekomplexität wird auf zwei Arten in Ihre Codebasis eingegeben: mit großen Blöcken und inkrementellen Ergänzungen.  Und die Leute sind schlecht darin, beide zu überprüfen und zu finden. </p><a name="habracut"></a><br><p>  Wenn ein großer Teil des Codes eingeht, wird der Prüfer aufgefordert, den genauen Ort zu finden, an dem der Code komplex ist, und was er dagegen tun soll.  Dann muss die Überprüfung den Punkt beweisen: Warum dieser Code überhaupt komplex ist.  Und andere Entwickler könnten anderer Meinung sein.  Wir alle kennen diese Art von Codeüberprüfungen! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/198/8ff/e0e/1988ffe0e3d5dc3b29b4743630b52e06.png" alt="Anzahl der zu überprüfenden Zeilen und Kommentarverhältnis"></p><br><p> Die zweite Möglichkeit, Komplexität in Ihren Code zu integrieren, ist die inkrementelle Hinzufügung: Wenn Sie eine oder zwei Zeilen an die vorhandene Funktion senden.  Und es ist äußerst schwer zu bemerken, dass Ihre Funktion vor einem Commit in Ordnung war, aber jetzt ist sie zu komplex.  Es erfordert einen guten Teil der Konzentration, der Überprüfung der Fähigkeiten und der guten Code-Navigationspraxis, um sie tatsächlich zu erkennen.  Den meisten Menschen (wie mir!) Fehlen diese Fähigkeiten und die Komplexität kann regelmäßig in die Codebasis eingegeben werden. </p><br><p>  Was kann also getan werden, um zu verhindern, dass Ihr Code komplex wird?  Wir müssen Automatisierung verwenden!  Lassen Sie uns einen tiefen Einblick in die Komplexität des Codes und die Möglichkeiten geben, ihn zu finden und schließlich zu lösen. </p><br><p>  In diesem Artikel werde ich Sie durch Orte führen, an denen Komplexität lebt und wie man sie dort bekämpft.  Anschließend werden wir diskutieren, wie gut geschriebener einfacher Code und Automatisierung die Möglichkeit der Entwicklungsstile "Continuous Refactoring" und "Architecture on Demand" ermöglichen. </p><br><h2 id="complexity-explained">  Komplexität erklärt </h2><br><p>  Man kann sich fragen: Was genau ist "Codekomplexität"?  Und obwohl es vertraut klingt, gibt es versteckte Hindernisse beim Verständnis des genauen Komplexitätsorts.  Beginnen wir mit den primitivsten Teilen und gehen dann zu übergeordneten Entitäten über. </p><br><p>  Denken Sie daran, dass dieser Artikel "Complexity Waterfall" heißt?  Ich werde Ihnen zeigen, wie die Komplexität von den einfachsten Primitiven in die höchsten Abstraktionen übergeht. </p><br><p> Ich werde <code>python</code> als Hauptsprache für meine Beispiele und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>wemake-python-styleguide</code></a> als Hauptwerkzeug verwenden, um die Verstöße in meinem Code zu finden und meinen Standpunkt zu veranschaulichen. </p><br><h3 id="expressions">  Ausdrücke </h3><br><p>  Ihr gesamter Code besteht aus einfachen Ausdrücken wie <code>a + 1</code> und <code>print(x)</code> .  Obwohl Ausdrücke selbst einfach sind, können sie Ihren Code irgendwann unbemerkt mit Komplexität überfluten.  Beispiel: Stellen Sie sich vor, Sie haben ein Wörterbuch, das ein <code>User</code> , und Sie verwenden es folgendermaßen: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format_username</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(user)</span></span></span><span class="hljs-function"> -&gt; str:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user[<span class="hljs-string"><span class="hljs-string">'email'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> len(user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">12</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>][:<span class="hljs-number"><span class="hljs-number">12</span></span>] + <span class="hljs-string"><span class="hljs-string">'...'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'@'</span></span> + user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]</code> </pre> <br><p>  Es sieht ziemlich einfach aus, nicht wahr?  Tatsächlich enthält es zwei ausdrucksbasierte Komplexitätsprobleme.  Es verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>overuses 'username'</code></a> und verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">magische Nummer</a> <code>12</code> (warum verwenden wir diese Nummer überhaupt, warum nicht <code>13</code> oder <code>10</code> ?).  Es ist schwer, solche Dinge alleine zu finden.  So würde die bessere Version aussehen: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#: That's how many chars fit in the preview box. LENGTH_LIMIT: Final = 12 def format_username(user) -&gt; str: username = user['username'] if not username: return user['email'] elif len(username) &gt; LENGTH_LIMIT: # See? It is now documented return username[:LENGTH_LIMIT] + '...' return '@' + username</span></span></code> </pre> <br><p>  Es gibt auch verschiedene Probleme mit dem Ausdruck.  Wir können auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">überstrapazierte Ausdrücke haben</a> : Wenn Sie das Attribut <code>some_object.some_attr</code> überall verwenden, anstatt eine neue lokale Variable zu erstellen.  Wir können auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu komplexe logische Bedingungen</a> oder einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zu tiefen Punktzugriff haben</a> . </p><br><p>  <strong>Lösung</strong> : Erstellen Sie neue Variablen, Argumente oder Konstanten.  Erstellen und verwenden Sie gegebenenfalls neue Dienstprogrammfunktionen oder -methoden. </p><br><h3 id="lines">  Linien </h3><br><p>  Ausdrücke bilden Codezeilen (bitte verwechseln Sie Zeilen nicht mit Anweisungen: Eine einzelne Anweisung kann mehrere Zeilen umfassen und mehrere Anweisungen können sich in einer einzelnen Zeile befinden). </p><br><p>  Die erste und offensichtlichste Komplexitätsmetrik für eine Linie ist ihre Länge.  Ja, du hast es richtig gehört.  Deshalb halten wir (Programmierer) es vor, uns an die Regel mit <code>80</code> Zeichen pro Zeile zu halten, und nicht, weil sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zuvor</a> in den Teletypewritern verwendet wurde.  In letzter Zeit gibt es viele Gerüchte darüber, dass es keinen Sinn macht, in 2k19 <code>80</code> Zeichen für Ihren Code zu verwenden.  Aber das stimmt offensichtlich nicht. </p><br><p>  Die Idee ist einfach.  Sie können in einer Zeile mit <code>160</code> Zeichen doppelt so viel Logik haben wie in einer Zeile mit nur <code>80</code> Zeichen.  Deshalb sollte dieses Limit festgelegt und durchgesetzt werden.  Denken Sie daran, dies ist <em>keine stilistische Wahl</em> .  Es ist eine Komplexitätsmetrik! </p><br><p>  Die zweite Metrik für die Komplexität der Hauptleitung ist weniger bekannt und wird weniger verwendet.  Es heißt <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Jones Complexity</a> .  Die Idee dahinter ist einfach: Wir zählen Code- (oder <code>ast</code> ) Knoten in einer einzigen Zeile, um ihre Komplexität zu ermitteln.  Schauen wir uns das Beispiel an.  Diese beiden Linien unterscheiden sich grundlegend in Bezug auf die Komplexität, haben jedoch genau die gleiche Breite in Zeichen: </p><br><pre> <code class="python hljs">print(first_long_name_with_meaning, second_very_long_name_with_meaning, third) print(first * <span class="hljs-number"><span class="hljs-number">5</span></span> + math.pi * <span class="hljs-number"><span class="hljs-number">2</span></span>, matrix.trans(*matrix), display.show(matrix, <span class="hljs-number"><span class="hljs-number">2</span></span>))</code> </pre> <br><p>  Zählen wir die Knoten im ersten: einen Anruf, drei Namen.  Insgesamt vier Knoten.  Der zweite hat einundzwanzig <code>ast</code> .  Nun, der Unterschied ist klar.  Aus diesem Grund verwenden wir die Jones Complexity-Metrik, um die erste lange Zeile zuzulassen und die zweite nicht zuzulassen, basierend auf einer internen Komplexität, nicht nur auf der Rohlänge. </p><br><p>  Was tun mit Linien mit einem hohen Jones Complexity Score? </p><br><p>  <strong>Lösung</strong> : Teilen Sie sie in mehrere Zeilen auf oder erstellen Sie neue Zwischenvariablen, Dienstprogrammfunktionen, neue Klassen usw. </p><br><pre> <code class="python hljs">print( first * <span class="hljs-number"><span class="hljs-number">5</span></span> + math.pi * <span class="hljs-number"><span class="hljs-number">2</span></span>, matrix.trans(*matrix), display.show(matrix, <span class="hljs-number"><span class="hljs-number">2</span></span>), )</code> </pre> <br><p>  Jetzt ist es viel lesbarer! </p><br><h3 id="structures">  Strukturen </h3><br><p>  Der nächste Schritt ist die Analyse von Sprachstrukturen wie <code>if</code> , <code>for</code> , <code>with</code> usw., die aus Linien und Ausdrücken gebildet werden.  Ich muss sagen, dass dieser Punkt sehr sprachspezifisch ist.  Ich werde auch einige Regeln aus dieser Kategorie mit <code>python</code> . </p><br><p>  Wir fangen mit <code>if</code> .  Was kann einfacher sein als ein guter Alter, <code>if</code> ?  Eigentlich, <code>if</code> es richtig schnell knifflig wird.  Hier ist ein Beispiel, wie man einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>reimplement switch</code></a> kann <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>reimplement switch</code></a> <code>if</code> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(some, int): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, float): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, complex): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, str): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, bytes): ... <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(some, list): ...</code> </pre> <br><p>  Was ist das Problem mit diesem Code?  Stellen Sie sich vor, wir haben Dutzende von Datentypen, die abgedeckt werden sollten, einschließlich Zolltypen, die uns noch nicht bekannt sind.  Dann ist dieser komplexe Code ein Indikator dafür, dass wir hier ein falsches Muster wählen.  Wir müssen unseren Code umgestalten, um dieses Problem zu beheben.  Zum Beispiel kann man <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>singledispatch</code></a> oder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>singledispatch</code></a> .  Sie haben den gleichen Job, aber schöner. </p><br><p>  <code>python</code> hört nie auf, uns zu amüsieren.  Zum Beispiel können Sie mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einer beliebigen Anzahl von Fällen</a> schreiben, was zu mental komplex und verwirrend ist: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> first(), second(), third(), fourth(): ...</code> </pre> <br><p>  Sie können auch Verständnisse mit einer beliebigen Anzahl von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>if</code></a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>for</code></a> Ausdrücken schreiben, was zu komplexem, unlesbarem Code führen kann: </p><br><pre> <code class="python hljs">[ (x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> x_coords <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> y_coords <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> z <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> z_coords <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> y &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> z &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x + y &lt;= z <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x + z &lt;= y <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> y + z &lt;= x ]</code> </pre> <br><p>  Vergleichen Sie es mit der einfachen und lesbaren Version: </p><br><pre> <code class="python hljs">[ (x, y, z) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x, y, x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> itertools.product(x_coords, y_coords, z_coords) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> valid_coordinates(x, y, z) ]</code> </pre> <br><p>  Sie können auch versehentlich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>multiple statements inside a try</code></a> Fall <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>multiple statements inside a try</code></a> , was unsicher ist, da eine Ausnahme an einer erwarteten Stelle ausgelöst und behandelt werden kann: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: user = fetch_user() <span class="hljs-comment"><span class="hljs-comment"># Can also fail, but don't expect that log.save_user_operation(user.email) # Can fail, and we know it except MyCustomException as exc: ...</span></span></code> </pre> <br><p>  Und das sind nicht einmal 10% der Fälle, die mit Ihrem <code>python</code> Code schief gehen können und werden.  Es gibt viele, viele <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">weitere Randfälle</a> , die verfolgt und analysiert werden sollten. </p><br><p>  <strong>Lösung</strong> : Die einzig mögliche Lösung besteht darin, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen guten Linter</a> für die Sprache Ihrer Wahl zu verwenden.  Und Refactor komplexe Orte, die dieser Linter hervorhebt.  Andernfalls müssen Sie das Rad neu erfinden und benutzerdefinierte Richtlinien für genau dieselben Probleme festlegen. </p><br><h3 id="functions">  Funktionen </h3><br><p>  Ausdrücke, Anweisungen und Strukturen bilden Funktionen.  Die Komplexität dieser Entitäten fließt in Funktionen ein.  Und hier beginnen die Dinge faszinierend zu werden.  Weil Funktionen buchstäblich Dutzende von Komplexitätsmetriken haben: sowohl gute als auch schlechte. </p><br><p>  Wir beginnen mit den bekanntesten: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zyklomatische Komplexität</a> und Funktionslänge, gemessen in Codezeilen.  Die zyklomatische Komplexität gibt an, wie viele Umdrehungen Ihr Ausführungsablauf dauern kann: Sie entspricht fast der Anzahl der Komponententests, die erforderlich sind, um den Quellcode vollständig abzudecken.  Es ist eine gute Metrik, da sie die Semantik respektiert und dem Entwickler hilft, das Refactoring durchzuführen.  Andererseits ist die Länge einer Funktion eine schlechte Metrik.  Es stimmt nicht mit der zuvor erläuterten Jones Complexity-Metrik überein, da wir bereits wissen: Mehrere Zeilen sind leichter zu lesen als eine große Zeile mit allem darin.  Wir werden uns nur auf gute Metriken konzentrieren und schlechte ignorieren. </p><br><p>  Nach meiner Erfahrung sollten anstelle der Länge der regulären Funktion mehrere nützliche Komplexitätsmetriken gezählt werden: </p><br><ul><li>  Anzahl der Funktionsdekorateure;  niedriger ist besser </li><li>  Anzahl der Argumente;  niedriger ist besser </li><li>  Anzahl der Anmerkungen;  höher ist besser </li><li>  Anzahl lokaler Variablen;  niedriger ist besser </li><li>  Anzahl der Renditen, Renditen, erwartet;  niedriger ist besser </li><li>  Anzahl der Aussagen und Ausdrücke;  niedriger ist besser </li></ul><br><p>  Die Kombination all dieser Prüfungen ermöglicht es Ihnen wirklich, einfache Funktionen zu schreiben (alle Regeln werden auch auf Methoden angewendet). </p><br><p>  Wenn Sie versuchen, einige böse Dinge mit Ihrer Funktion zu tun, werden Sie sicherlich mindestens eine Metrik brechen.  Und das wird unseren Linter enttäuschen und Ihren Build sprengen.  Dadurch wird Ihre Funktion gespeichert. </p><br><p>  <strong>Lösung</strong> : Wenn eine Funktion zu komplex ist, besteht die einzige Lösung darin, diese Funktion in mehrere Funktionen aufzuteilen. </p><br><h3 id="classes">  Klassen </h3><br><p>  Die nächste Abstraktionsebene nach Funktionen sind Klassen.  Und wie Sie bereits vermutet haben, sind sie noch komplexer und flüssiger als Funktionen.  Da Klassen möglicherweise mehrere Funktionen enthalten (die als Methode bezeichnet werden) und andere einzigartige Funktionen wie Vererbung und Mixins, Attribute auf Klassenebene und Dekoratoren auf Klassenebene aufweisen.  Wir müssen also alle Methoden als Funktionen und den Klassenkörper selbst überprüfen. </p><br><p>  Für Klassen müssen wir die folgenden Metriken messen: </p><br><ul><li>  Anzahl der Dekorateure auf Klassenebene;  niedriger ist besser </li><li>  Anzahl der Basisklassen;  niedriger ist besser </li><li>  Anzahl der öffentlichen Attribute auf Klassenebene;  niedriger ist besser </li><li>  Anzahl der öffentlichen Attribute auf Instanzebene;  niedriger ist besser </li><li>  Anzahl der Methoden;  niedriger ist besser </li></ul><br><p>  Wenn eines davon zu kompliziert ist, müssen wir den Alarm auslösen und den Build nicht bestehen! </p><br><p>  <strong>Lösung</strong> : Refaktorieren Sie Ihre fehlgeschlagene Klasse!  Teilen Sie eine vorhandene komplexe Klasse in mehrere einfache auf oder erstellen Sie neue Dienstprogrammfunktionen und verwenden Sie die Komposition. </p><br><p>  Bemerkenswerte Erwähnung: Sie können auch <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kohäsions-</a> und Kopplungsmetriken verfolgen, um die Komplexität Ihres OOP-Designs zu überprüfen. </p><br><h3 id="modules">  Module </h3><br><p>  Module enthalten mehrere Anweisungen, Funktionen und Klassen.  Und wie Sie vielleicht bereits erwähnt haben, empfehlen wir normalerweise, Funktionen und Klassen in neue aufzuteilen.  Deshalb müssen wir die Komplexität der Module im Auge behalten: Sie fließt buchstäblich aus Klassen und Funktionen in Module. </p><br><p>  Um die Komplexität des Moduls zu analysieren, müssen wir Folgendes überprüfen: </p><br><ul><li>  Die Anzahl der Importe und importierten Namen;  niedriger ist besser </li><li>  Die Anzahl der Klassen und Funktionen;  niedriger ist besser </li><li>  Die durchschnittliche Komplexität der Funktionen und Klassen im Inneren;  niedriger ist besser </li></ul><br><p>  Was machen wir bei einem komplexen Modul? </p><br><p>  <strong>Lösung</strong> : Ja, Sie haben es richtig gemacht.  Wir teilen ein Modul in mehrere auf. </p><br><h3 id="packages">  Pakete </h3><br><p>  Pakete enthalten mehrere Module.  Zum Glück ist das alles, was sie tun. </p><br><p>  Daher kann die Anzahl der Module in einem Paket bald zu groß werden, sodass Sie am Ende zu viele davon haben.  Und es ist die einzige Komplexität, die mit Paketen gefunden werden kann. </p><br><p>  <strong>Lösung</strong> : Sie müssen Pakete in Unterpakete und Pakete unterschiedlicher Ebenen aufteilen. </p><br><h2 id="complexity-waterfall-effect">  Komplexität Wasserfalleffekt </h2><br><p>  Wir haben jetzt fast alle möglichen Arten von Abstraktionen in Ihrer Codebasis behandelt.  Was haben wir daraus gelernt?  Die wichtigste Erkenntnis ist vorerst, dass die meisten Probleme gelöst werden können, indem die Komplexität auf dieselbe oder eine höhere Abstraktionsebene ausgeworfen wird. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9b6/8ad/453/9b68ad45340cdf61f51a8deb2c07930d.png" alt="Komplexitätswasserfall"></p><br><p>  Dies führt uns zu der wichtigsten Idee dieses Artikels: Lassen Sie Ihren Code nicht mit der Komplexität überlaufen.  Ich werde einige Beispiele geben, wie es normalerweise passiert. </p><br><p>  Stellen Sie sich vor, Sie implementieren eine neue Funktion.  Und das ist die einzige Änderung, die Sie vornehmen: </p><br><pre> <code class="diff hljs"><span class="hljs-comment"><span class="hljs-comment">+++ if user.is_active and user.has_sub() and sub.is_due(tz.now() + delta): --- if user.is_active and user.has_sub():</span></span></code> </pre> <br><p>  Sieht in Ordnung aus, ich würde diesen Code bei der Überprüfung weitergeben.  Und nichts Schlimmes würde passieren.  Aber der Punkt, den ich vermisse, ist, dass die Komplexität diese Linie überflutet hat!  Das wird <code>wemake-python-styleguide</code> berichten: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c87/b9e/0e5/c87b9e0e584a8cd01235e0ae7695a6c0.png" alt="wemake-python-styleguide-output"></p><br><p>  Ok, wir müssen jetzt diese Komplexität lösen.  Lassen Sie uns eine neue Variable erstellen: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid: ... ... ...</code> </pre> <br><p>  Jetzt ist die Leitungskomplexität gelöst.  Aber warte eine Minute.  Was ist, wenn unsere Funktion jetzt zu viele Variablen hat?  Weil wir eine neue Variable erstellt haben, ohne zuerst ihre Nummer innerhalb der Funktion zu überprüfen.  In diesem Fall müssen wir diese Methode in mehrere Methoden aufteilen: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._has_paid_sub(user, sub, delta): ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_has_paid_sub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user, sub, delta)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid ...</code> </pre> <br><p>  Jetzt sind wir fertig!  Richtig?  Nein, denn wir müssen jetzt die Komplexität der <code>Product</code> überprüfen.  Stellen Sie sich vor, dass es jetzt zu viele Methoden gibt, seit wir eine neue <code>_has_paid_sub</code> Methode erstellt haben. </p><br><p>  Ok, wir lassen unseren Linter laufen, um die Komplexität erneut zu überprüfen.  Und es stellt sich heraus, dass unsere <code>Product</code> derzeit in der Tat zu komplex ist.  Unsere Handlungen?  Wir haben es in mehrere Klassen aufgeteilt! </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Policy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SubcsriptionPolicy</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Policy)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can_be_purchased</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self._has_paid_sub(user, sub, delta): ... ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_has_paid_sub</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user, sub, delta)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> is_sub_paid = sub.is_due(tz.now() + delta) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.is_active <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> user.has_sub() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> is_sub_paid <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> _purchasing_policy: Policy ... ...</code> </pre> <br><p>  Bitte sagen Sie mir, dass es die letzte Iteration ist!  Nun, es tut mir leid, aber wir müssen jetzt die Komplexität des Moduls überprüfen.  Und weißt du was?  Wir haben jetzt zu viele Modulmitglieder.  Wir müssen also Module in separate aufteilen!  Dann überprüfen wir die Paketkomplexität.  Und möglicherweise auch in mehrere Unterpakete aufgeteilt. </p><br><p>  Hast du es gesehen  Aufgrund der genau definierten Komplexitätsregeln stellte sich heraus, dass unsere einzeilige Änderung eine große Refactoring-Sitzung mit mehreren neuen Modulen und Klassen war.  Und wir haben selbst keine einzige Entscheidung getroffen: Alle unsere Refactoring-Ziele wurden von der internen Komplexität und dem Linter bestimmt, der sie offenbart. </p><br><p>  Das nenne ich einen "Continuous Refactoring" -Prozess.  Sie sind gezwungen, das Refactoring durchzuführen.  Immer. </p><br><p>  Dieser Prozess hat auch eine interessante Konsequenz.  Es ermöglicht Ihnen "Architecture on Demand".  Lass mich erklären.  Mit der Philosophie "Architecture on Demand" fangen Sie immer klein an.  Zum Beispiel mit einer einzelnen Datei <code>logic/domains/user.py</code>  Und Sie fangen an, alles, was mit dem <code>User</code> tun hat, dort <code>User</code> .  Denn in diesem Moment wissen Sie wahrscheinlich nicht, wie Ihre Architektur aussehen wird.  Und es ist dir egal.  Sie haben nur drei Funktionen. </p><br><p>  Einige Leute fallen in die Falle von Architektur gegen Codekomplexität.  Sie können ihre Architektur von Anfang an mit den vollständigen Repository- / Service- / Domänenschichten übermäßig komplizieren.  Oder sie können den Quellcode ohne klare Trennung übermäßig komplizieren.  Kämpfe und lebe jahrelang so (wenn sie jahrelang mit dem Code wie diesem leben können!). </p><br><p>  Das Konzept "Architecture on Demand" löst diese Probleme.  Sie fangen klein an, wenn es soweit ist - Sie teilen und überarbeiten Dinge: </p><br><ol><li>  Sie beginnen mit <code>logic/domains/user.py</code> und legen alles dort ab </li><li>  Später erstellen Sie die Datei <code>logic/domains/user/repository.py</code> wenn Sie über genügend datenbankbezogene Inhalte verfügen </li><li>  Dann teilen Sie es in <code>logic/domains/user/repository/queries.py</code> und <code>logic/domains/user/repository/queries.py</code> wenn die Komplexität Sie dazu auffordert </li><li>  Dann erstellen Sie <code>logic/domains/user/services.py</code> mit <code>http</code> bezogenen Sachen </li><li>  Anschließend erstellen Sie ein neues Modul mit dem Namen <code>logic/domains/order.py</code> </li><li>  Und so weiter und so fort </li></ol><br><p>  Das war's.  Es ist ein perfektes Werkzeug, um Ihre Architektur und Codekomplexität in Einklang zu bringen.  Und holen Sie sich so viel Architektur, wie Sie im Moment wirklich brauchen. </p><br><h2 id="conclusion">  Fazit </h2><br><p>  Guter Linter kann viel mehr als nur fehlende Kommas und schlechte Anführungszeichen finden.  Mit Good Linter können Sie sich bei Architekturentscheidungen darauf verlassen und beim Refactoring-Prozess helfen. </p><br><p>  Zum Beispiel kann <code>wemake-python-styleguide</code> Ihnen bei der Komplexität des <code>python</code> Quellcodes helfen. Es ermöglicht Ihnen <code>wemake-python-styleguide</code> : </p><br><ul><li>  Bekämpfe erfolgreich die Komplexität auf allen Ebenen </li><li>  Erzwingen Sie die enorme Menge an Namensstandards, Best Practices und Konsistenzprüfungen </li><li>  Integrieren Sie es einfach mit Hilfe der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>diff</code> Option</a> oder des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><code>flakehell</code></a> Tools in eine Legacy-Codebasis, sodass alte Verstöße vergeben werden, neue jedoch nicht zulässig sind </li><li>  Aktivieren Sie es in Ihrem [CI] (), auch als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github-Aktion</a> </li></ul><br><p>  Lassen Sie nicht zu, dass die Komplexität Ihren Code überflutet. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Verwenden Sie einen guten Linter</a> ! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472876/">https://habr.com/ru/post/de472876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de472862/index.html">Kaskadierende Cache-Ungültigmachung. Teil 2</a></li>
<li><a href="../de472864/index.html">Prüfpunkt: CPU- und RAM-Optimierung</a></li>
<li><a href="../de472868/index.html">Verwaltung des Telefonservers: RUVDS Mobile Client</a></li>
<li><a href="../de472870/index.html">Warum Agile zum Stillstand kommt, ohne Architektur und Entwicklungstools zu verändern - Konferenzpräsentation</a></li>
<li><a href="../de472872/index.html">Wie man das Startup auf 50 Mitarbeiter erhöht, ohne die Kultur zu verlieren</a></li>
<li><a href="../de472884/index.html">Wie die Stereotypen eines unerfahrenen Entwicklers zu Beginn des Spiels zusammenbrechen</a></li>
<li><a href="../de472886/index.html">Wie implementiere ich einen statischen Analysator in die Entwicklung, damit alle zufrieden sind?</a></li>
<li><a href="../de472890/index.html">DeepPavlov für Entwickler: # 1 NLP-Tools und Chatbots erstellen</a></li>
<li><a href="../de472894/index.html">DartUP 2019: Dart- und Flatterkonferenz am 23. November in St. Petersburg</a></li>
<li><a href="../de472896/index.html">Hubschrauber von einem Drucker: Zum ersten Mal haben Wissenschaftler einen großen Koffer eines Hubschraubermotors „gedruckt“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>