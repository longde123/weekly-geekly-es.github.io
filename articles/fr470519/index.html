<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🍀 🏂🏽 ☝🏿 Expérience dans la création d'assemblages Linux pour les mises à jour sur une seule carte avec prise en charge 🤙🏻 💍 🌞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Présentation 
 À l'heure actuelle, le marché propose une large gamme de payeurs uniques pour tous les goûts à un prix abordable. 

 En règle générale,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Expérience dans la création d'assemblages Linux pour les mises à jour sur une seule carte avec prise en charge</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470519/"><img src="https://habrastorage.org/webt/uv/15/sj/uv15sjkhjdjizxf0g2acp_abzai.jpeg" alt="image"><br><br><h2>  Présentation </h2><br>  À l'heure actuelle, le marché propose une large gamme de payeurs uniques pour tous les goûts à un prix abordable. <br><br>  En règle générale, divers assemblages de fabricants sont conçus pour évaluer la plate-forme et sont le point de départ d'un nouveau projet, ils ne conviennent donc pas toujours à des tâches spécifiques.  Dans les tâches où une haute fiabilité est requise, le développeur pose la question de savoir comment modifier le kit de distribution et ensuite ne pas le payer avec une révision complète de l'image et du système de mise à jour. <br><a name="habracut"></a><br>  Sur Internet, il n'y a presque aucune information sur ce que la version devrait être et comment implémenter sa mise à jour, donc le développeur est obligé de proposer un «vélo» ou d'utiliser ses propres développements, qui ne sont pas toujours testés à 100%. <br><br>  Étant donné que je participe au développement de logiciels pour différents appareils Linux (mon portfolio peut être google par le mot develinux) et que je suis également l'auteur du projet en 11 parties, je dois régulièrement m'occuper non seulement de construire des assemblages, mais aussi de développer des mécanismes de mise à jour via WEB ou USB flash. <br><br>  Dans cet article, je souhaite partager mon expérience et mes connaissances dans des domaines pertinents. <br><br><h2>  Exigences d'assemblage </h2><br>  Dans le processus de développement d'assemblages et de mises à jour pour divers appareils, j'ai identifié plusieurs exigences pour moi-même: <br><br><ul><li>  l'ensemble ne doit pas être endommagé lorsque l'alimentation est coupée soudainement; </li><li>  l'assemblage doit se charger rapidement; </li><li>  le chargeur de démarrage devrait fonctionner parfaitement; </li><li>  l'assembly doit prendre en charge la mise à jour. </li></ul><br>  J'essaierai d'expliquer ces exigences plus en détail ci-dessous, puis je décrirai 3 approches dans la division des images en sections et leurs mises à jour. <br><br><h2>  L'ensemble ne doit pas être endommagé lorsque l'alimentation est coupée soudainement. </h2><br>  Qui a besoin d'un appareil qui ne fonctionne plus après un dixième redémarrage?  À personne!  Si vous prenez des distributions prêtes à l'emploi (et il y en a très peu pour les incorporées), alors sans un fichier de la boîte, elles sont toutes très peu fiables à cet égard.  Je me souvenais très bien du projet où j'utilisais ubuntu sous imx6, les systèmes de fichiers sur la carte étaient endommagés, parfois à partir du dixième redémarrage, parfois à partir de la quarantième, cela dépendait des étoiles dans le ciel.  Le projet a sauvé FS aufs.  Le fait est que ubuntu n'est pas conçu pour être en lecture seule et qu'il doit toujours écrire quelque chose.  Je me souviens d'une situation similaire dans un autre projet où yocto était utilisé sur une carte SD.  En général, notez donc que les cartes SD sont le type de lecteur le plus laid qui plante le plus rapidement, beaucoup plus fiable que emmc et nand.  Si vous utilisez une carte SD, il est conseillé de lui écrire le moins possible pendant le fonctionnement, les algorithmes de transfert en arrière-plan pour les secteurs sont très imprévisibles, j'ai travaillé avec des dizaines de cartes SD différentes de marques mondiales et je n'ai pas trouvé une seule carte que je pourrais recommander. <br>  Mais les cartes SD ont plusieurs avantages, elles sont abordables, peu coûteuses et pratiques pour le débogage des logiciels. <br><br>  Pourquoi suis-je ... Et, voici le problème - le FS racine doit être en lecture seule, il ne doit y avoir aucune entrée pendant le fonctionnement.  Vous penserez probablement: comment cela?  Des millions d'appareils Android écrivent toujours quelque chose et n'échouent pas.  C'est vrai, mais c'est tout parce que la plupart des appareils Android, d'une part, ont une batterie, et d'autre part, la racine FS est encadrée comme un disque virtuel et la partition système est en lecture seule. <br><br>  Si le système doit être fiable, alors toutes sortes de choses avec l'installation de packages dans la racine FS peuvent gâcher beaucoup.  Je recommande squashfs comme système de fichiers.  Il fonctionne rapidement, ne peut rien écrire, économise de l'espace grâce à la compression ... <br><br>  Mais qu'en est-il de l'enregistrement des configurations, du téléchargement de fichiers, etc.  demandez-vous? <br>  Mais pour cela, vous devez créer des partitions RW distinctes.  Si vous prévoyez d'écrire en NAND, je recommande une option éprouvée - UBIFS.  Si dans NOR, alors jffs2.  Si j'écris sur un autre lecteur, je recommande ext4, btrfs, ReiserFS, je ne peux pas indiquer le meilleur FS parmi eux, car  il y avait divers problèmes avec tout le monde. <br><br>  Dans ce cas, toujours avant de monter des partitions rw, assurez-vous de vérifier les partitions pour les erreurs en utilisant des utilitaires de type fsck. <br><br><h2>  L'assemblage doit se charger rapidement </h2><br>  Les vitesses de téléchargement des appareils affectent la convivialité globale.  Dans certaines tâches, le temps de chargement ne dépasse pas 30 secondes, dans certaines, 5 minutes sont autorisées.  Pour moi, j'ai travaillé jusqu'à 1 minute, moins c'est mieux.  Attendez le téléchargement pendant plus d'une minute pendant trop longtemps, il peut sembler que l'appareil s'est bloqué, donc si vous pouvez réduire le temps, il est préférable de l'utiliser. <br><br><h2>  Le chargeur de démarrage doit fonctionner correctement </h2><br>  Le chargeur est ce sans quoi l'assemblage ne commencera pas.  Récemment, j'observe souvent comment les fabricants de cartes simples facilitent le développement en téléchargeant une démo pour une carte SD avec une description de la façon d'enregistrer un chargeur de démarrage ou une image finie avec un chargeur de démarrage, qui est simplement remplie avec la commande dd.  Mais que faire si la carte SD se fige?  La même chose n'est pas rare.  Personnellement, dans ma pratique, les cartes tombaient souvent.  C’est ainsi que vous travaillez pour plusieurs heures pendant des heures, vous écrivez des logiciels, bam et c’est tout ... des erreurs dans le noyau commencent à couler, la carte est tombée.  Mais que faire si c'est un appareil qui devrait fonctionner sur le terrain sans redémarrer?  Et au fait, le redémarrage, y compris le chien de garde, ne fait pas toujours revivre une carte bloquée, la carte n'a pas de signal de réinitialisation, ce n'est pas emmc, bien sûr, c'est plus une question pour les circuits de la carte, si la carte a une réinitialisation de la puissance de la carte, cela économisera, mais ce n'est pas partout.  Sur certaines cartes, seule une distorsion de l'alimentation ou de la carte est utile.  D'après mon expérience, je ne recommande pas de stocker le chargeur de démarrage sur le lecteur avec l'ensemble principal si l'enregistrement est effectué sur le lecteur pendant le fonctionnement.  Si le système n'écrit rien sur le lecteur avec le chargeur de démarrage, et cela se produit rarement, alors s'il vous plaît.  D'après mon expérience, en mode lecture seule, le système de fichiers a été déformé uniquement en raison d'erreurs matérielles, mais pas d'erreurs logicielles. <br><br>  Le chargeur de démarrage doit être stocké dans un endroit sûr, sur un lecteur fiable, par exemple, dans une puce NOR ou EEPROM distincte.  Voici un exemple de module basé sur la puce imx6ull, avec SPI NOR pour stocker le chargeur de démarrage. <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/w0/ka/um/w0kaumujmmpo6mey_ubuk6oknm4.jpeg" alt="image" width="50%"></a> </div><br><h2>  La version doit prendre en charge la mise à niveau </h2><br>  Sans mise à jour, nulle part ... J'ai participé à de nombreux projets et je n'ai jamais obtenu le logiciel parfait pour la livraison du travail.  Une erreur est toujours détectée ou une amélioration fonctionnelle est requise.  Vous devez comprendre que pendant que les gens écrivent des logiciels, ils feront des erreurs, tandis que les gens utiliseront l'appareil, ils en voudront un peu plus.  Dans 90% des cas, l'absence d'un système de mise à jour bien pensé peut conduire à la fois à un casse-tête pour le constructeur et à l'effondrement de l'ensemble du projet.  Par exemple, un système de vidéosurveillance a été développé pour le transport, le système a été installé dans toute la Russie, et il s'avère que les spécialistes du marketing ont sous-estimé le marché et n'ont pas fourni de streaming, et d'ailleurs, plusieurs erreurs ont été trouvées dans le firmware, plus le consommateur commence à regarder dans la direction des concurrents, car ils ont il y a juste quelque chose qui n'est pas dans l'appareil acheté ... Oui, oui, dans un jardin étrange, les fraises sont plus savoureuses et le temps est meilleur (psychologie). <br>  Que faire dans une telle situation?  Si la mise à jour est prise en charge, il existe de nombreuses solutions, des erreurs peuvent être corrigées, la diffusion de flux peut être améliorée et la fonctionnalité peut être personnalisée pour le consommateur, donner au micrologiciel du consommateur des instructions et c'est tout.  Mais si ce n'est pas pris en charge, le fabricant aura de grandes aventures avec des voyages d'affaires d'ingénieurs de service jusqu'au remplacement des appareils. <br><br>  Le système de mise à jour de l'appareil doit être pensé dans les moindres détails et testé à 100%.  Une erreur dans cette partie transformera le fer en brique, il ne devrait donc pas y avoir de tolérances et d'exceptions. <br><br>  Le processus de mise à jour doit être résistant à la mise hors tension et ne doit en aucun cas gâcher l'appareil. <br><br><h2>  Un aperçu des approches de partitionnement pour les futures mises à jour </h2><br>  Parmi les nombreuses approches, je peux recommander 3 types que j'ai personnellement mis en œuvre.  Ce ne sont pas toutes des approches; leur portée dépasse le cadre de cet article.  Les 3 types ont des défauts et sont loin d'être idéaux, mais, comme il me semble, sont proches du juste milieu du bon sens. <br><br><h3>  Approche n ° 1 </h3><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/j4/y0/1l/j4y01l02_tkwvnpe-gs1e2jabiy.jpeg" alt="image" width="50%"></a> </div><br>  Le moyen le plus simple et le plus abordable: <br>  Une image est placée sur un lecteur, par exemple une carte SD, qui est flashée depuis u-boot dans le lecteur intégré de l'appareil, par exemple, le flash NAND. <br>  Dans u-boot, vous devez préparer des scripts pour cela. <br>  Parmi les avantages, il s'agit du type de mise à jour le plus simple, dont le développement prendra au maximum 1 jour. <br>  Les inconvénients de cette approche sont le manque de visualisation du processus et les capacités très limitées du chargeur de démarrage, c'est-à-dire  pas de logique compliquée avec des outils standard, à moins bien sûr de trouver votre propre commande u-boot (mais c'est un autre type de mise à jour, C est une grande force).  Cette méthode n'est pas destinée aux mises à jour via WEB - il est problématique de contrôler l'intégrité de l'image du firmware; dans certains cas, la taille de l'assemblage ne doit pas dépasser la taille de la RAM. <br>  De plus, dans certaines tâches, il est nécessaire d'enregistrer les paramètres pendant la mise à niveau, et cela, avec cette approche, n'est pas facile à mettre en œuvre. <br><br><h3>  Approche n ° 2 </h3><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/ia/ox/vd/iaoxvdexq7u8_biakyniktekgmk.jpeg" alt="image" width="50%"></a> </div><br><br>  La méthode la plus fiable et la plus protégée des envisagées, mais la plus difficile.  Je recommande que cette méthode soit utilisée dans des développements particulièrement responsables,  Il protège à la fois des images cassées et des dommages physiques du lecteur principal, car le circuit en utilise un autre. <br><br>  L'approche utilise une construction minimale (taille du disque virtuel de 8 à 16 Mo) et la principale.  Ramdisk est une archive compressée, donc une construction de 16 Mo sera physiquement plusieurs fois plus petite. <br>  Le but d'un assemblage minimal est d'évaluer l'assemblage principal et de le charger. <br>  Ramdisk est hébergé avec le noyau et les scripts u-boot dans une image FIT. <br><br>  Pourquoi l'image FIT et que donne-t-elle?  L'image FIT est un format pris en charge par u-boot.  Il assure l'intégrité de tous les composants (noyau, dts, ramdisk, scripts).  Le déballage de l'image FIT s'effectue en u-boot, et si la somme de contrôle ne converge pas, u-boot refusera de la charger.  C'est pratique, c'est-à-dire  pas besoin de s'occuper du contrôle d'intégrité par vous-même, pas besoin d'écrire plusieurs fichiers séparément ou d'inventer vos propres images, tout se fait par image FIT.  Habituellement, une image FIT occupe 7 à 20 Mo, elle doit être écrite sur un lecteur distinct hautement fiable, par exemple, en qspi ni en flash.  L'ensemble principal peut être stocké dans une mémoire moins chère et peu fiable, par exemple, un flash NAND.  Puisque les travaux principaux auront lieu dans l'ensemble principal, c'est précisément lui qui sera le premier endommagé.  Dans ce cas, un lecteur séparé avec un minimum de rootfs viendra à la rescousse. <br><br>  Processus de démarrage. <br><br>  u-boot télécharge un script qui essaie d'utiliser les mises à jour FIT (FIT2), puis le firmware d'usine FIT (FIT1). <br><br>  Si FIT2 n'est pas présent ou que son intégrité est violée, le test d'ajustement échouera et u-boot chargera le premier FIT (FIT1).  S'il y a des mises à jour FIT (FIT2), et qu'il n'est pas cassé, alors son ramdisk est chargé qui vérifie les mises à jour rootfs (Rootfs2). <br><br>  Si Rootfs2 est cassé, les scripts supprimeront les mises à jour FIT (FIT2), puis après le redémarrage, l'image d'usine composée de FIT (FIT1) et Rootfs1 sera téléchargée. <br><br>  Processus de mise à jour. <br><br>  L'image de mise à jour contient FIT, rootfs et diverses informations d'assemblage, y compris les sommes de contrôle de tous ses composants.  Les informations d'assemblage sont utilisées pendant la mise à niveau pour surveiller l'intégrité et la compatibilité. <br><br>  Mettre à jour la progression par étapes: <br><br><ul><li>  vérifier la compatibilité de l'image avec le matériel et les logiciels, </li><li>  vérifier l'intégrité de l'image dans le fichier de mise à jour, </li><li>  copier Rootfs2 du fichier de mise à jour dans une section préalablement préparée, </li><li>  vérification de l'intégrité de l'image copiée dans la section, </li><li>  copier FIT2 dans la section appropriée, </li><li>  redémarrer. </li></ul><br>  Si le processus échoue, l'absence ou l'endommagement de FIT2 ne ruinera pas le système, comme  u-boot refusera simplement de l'utiliser et chargera l'image d'usine.  Par conséquent, pendant la mise à niveau, l'intégrité de FIT2 n'est pas vérifiée. <br><br>  Après la mise à jour, le nouvel assemblage sera placé sur le lecteur principal sous la forme de FIT2 et Rootfs2. <br><br>  Cette méthode résiste aux dommages mécaniques du variateur et aux erreurs FS. <br><br>  En cas de dysfonctionnements critiques, l'image d'usine démarrera, où le logiciel de récupération fonctionnera, qui, par exemple, peut revérifier NAND, télécharger le micrologiciel à partir du réseau en utilisant le protocole SSH, puis l'enregistrer. <br><br>  J'ai donné juste un exemple de récupération, il existe de nombreuses options.  Dans cette approche, le processus de récupération est piloté par un Linux à part entière, qui peut tout faire ... et non par le chargeur de démarrage comme dans la première version. <br><br><h3>  Approche n ° 3 </h3><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/webt/wx/mz/o-/wxmzo-tpggd3a6goz48-us359_s.jpeg" alt="image" width="50%"></a> </div><br><br>  Ce type de mise à jour est utilisé dans presque tous les projets en 11 parties, car il a très bien fonctionné. <br><br>  La mise à jour convient à toutes les tailles d'assemblage, à tous les types de lecteurs.  Contrairement au type précédent, ici SPI NOR n'est utilisé que pour le u-boot, il a donc une taille plus petite et un coût inférieur, 1 Mo suffit. <br><br>  Ce type de mise à jour ne nécessite pas de build séparé de ramdisk, ce qui signifie que le temps de programmation est économisé pour son développement et son support à l'avenir. <br><br>  L'exemple utilise un lecteur de carte SD, mais il peut également être NAND en utilisant UBIFS, aucune différence.  Dans cette approche, il n'y a pas de contrôle de Rootfs RO avant le chargement, si l'ensemble est endommagé, le système ne saura pas qu'il a été endommagé et le chargera en cercle.  Ici, il est supposé que les données de la section RO ne peuvent en aucun cas être modifiées, cette approche élimine le dysfonctionnement physique du variateur.  Si le lecteur n'est pas physiquement sain, l'appareil doit être transporté dans un centre de service, aucune auto-guérison n'est fournie.  C'est le prix à payer pour augmenter la vitesse de développement, un support moins cher et une base élémentaire moins chère, mais c'est justifié.  Pourquoi s'assurer contre quelque chose qui n'arrive presque jamais. <br><br>  La logique de téléchargement et de mise à jour est la même que dans l'approche précédente. <br><br>  Dans le cas du chargement, u-boot télécharge d'abord les mises à jour FIT (FIT2), s'il n'y est pas ou que l'intégrité est violée, u-boot charge le premier FIT (FIT1), l'assemblage qui a été cousu en usine démarre, et ainsi de suite jusqu'à la mise à jour du système.  Lorsque le système est mis à jour, FIT2 et Rootfs2 apparaissent.  Dans ce cas, au démarrage de l'appareil, la mise à jour FIT (FIT2) démarre en premier.  Dans les scripts u-boot qui sont stockés dans chaque FIT, il doit être écrit quels rootfs monter. <br><br><h2>  Partition partagée RW </h2><br>  Sur les graphiques, il y a un bloc de partition partagé partout, c'est un groupe de sections pour l'écriture.  Toutes les entrées sont faites uniquement là-bas.  La partition partagée est présentée comme une partition pour plus de clarté.  En fait, il y en a 3: deux petits pour les configurations fonctionnant dans le miroir et un grand pour tout le reste.  De plus, je vous recommande de conserver certaines configurations lors de la mise à jour, ce qui est pratique, par exemple, si vous configurez le réseau et effectuez une mise à niveau, vous n'aurez pas besoin de reconfigurer les paramètres réseau. <br><br><h2>  Pour résumer </h2><br>  L'article décrit trois types d'assemblages avec prise en charge des mises à jour, tous vérifiés par moi personnellement, vous pouvez les utiliser en toute sécurité dans les projets. <br><br>  Pour le moment, je n'utilise que les deux derniers, car ils conviennent le mieux aux exigences.  Pour plus de clarté, vous pouvez voir des exemples d'appareils où ces types de mises à jour sont utilisés (détails dans la gamme de 11 pièces): <br><br><ul><li>  Répéteur RS485 via 4G / WiFi / LAN, </li><li>  Carte de commande de contrôleur d'affichage industriel 4K V-By-One, </li><li>  système de climatisation intégré au hangar, </li><li>  Contrôleur vidéo d'affichage industriel 2DisplayPort-LVDS, </li><li>  système de contrôle de ligne </li><li>  Passerelle VPN. </li></ul><br>  Si mon article est utile et intéressant, je suis prêt à partager mon expérience et mes solutions techniques éprouvées dans le domaine du Linux embarqué sur ce site. <br><br>  Merci à tous. <br>  Gorchakov Ilya <br>  télégramme: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">develinux</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr470519/">https://habr.com/ru/post/fr470519/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr470503/index.html">Utilisateurs et autorisation de Kubernetes RBAC</a></li>
<li><a href="../fr470511/index.html">L'informatique en Arménie: secteurs stratégiques et sphères technologiques du pays</a></li>
<li><a href="../fr470513/index.html">Comment j'ai trouvé une maison intelligente dominée par un botnet</a></li>
<li><a href="../fr470515/index.html">Une petite étape pour le testeur: les 10 meilleurs rapports de Heisenbug 2019 Piter</a></li>
<li><a href="../fr470517/index.html">EP russe pour les plus petits</a></li>
<li><a href="../fr470521/index.html">Publication de la mise à jour 3CX V16 3 et de la nouvelle application mobile 3CX pour Android</a></li>
<li><a href="../fr470525/index.html">Windows dans un navigateur sans inscription et SMS - vue d'ensemble des clients HTML5 RDP</a></li>
<li><a href="../fr470531/index.html">Le neurophysiologue discute du projet Neuralink et parle du travail du cerveau «sur les doigts»</a></li>
<li><a href="../fr470535/index.html">Façons de créer des graphiques à barres à l'aide de Python</a></li>
<li><a href="../fr470537/index.html">Nouveau package de validation pour React sur Mobx @ quantumart / mobx-form-validation-kit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>