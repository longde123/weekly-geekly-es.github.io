<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏽‍🔬 🏼 🧘🏾 Benachrichtigungen: Maßnahmen zur Gewinnmitnahme / Stop-Loss erforderlich. Falls Ihr Broker diese Bestellungen nicht unterstützt 🕛 🔠 🧑🏽‍🤝‍🧑🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Es gibt einen russischen Broker - Tinkoff Bank. Hier ist das Problem: Der Broker unterstützt keine Take-Profit- und Stop-Loss-Aufträge. Überhaupt nich...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Benachrichtigungen: Maßnahmen zur Gewinnmitnahme / Stop-Loss erforderlich. Falls Ihr Broker diese Bestellungen nicht unterstützt</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443434/">  Es gibt einen russischen Broker - Tinkoff Bank.  Hier ist das Problem: Der Broker unterstützt keine Take-Profit- und Stop-Loss-Aufträge.  Überhaupt nicht.  Wenn Sie sich beim Handeln wohler fühlen möchten, benötigen Sie eine Problemumgehung für diese Situation, bis die Entwickler der Tinkoff Bank diese Aufträge endgültig als Killer-Feature veröffentlichen.  In dem Artikel werde ich Ihnen meine Problemumgehung zeigen. <br>  <b>Update:</b> 2019-03-22, veröffentlichte der Broker die Plattform 3.0.0 (ein wichtiges Update) in Google Play.  Die Changelog-Funktionen nehmen Gewinn- / Stop-Loss-Aufträge entgegen <br><a name="habracut"></a><br>  Warum habe ich beschlossen, den Artikel hier zu posten?  Ich gehe davon aus, dass die Tinkoff Bank und seine Produkte bei IT-Kunden in Russland sehr beliebt sind und wahrscheinlich einige von ihnen denselben Bedarf haben, aber nicht genügend Zeit oder Bereitschaft haben, eine eigene vorübergehende Problemumgehung zu entwickeln.  Deshalb teile ich meine Lösung und die Geschichte der Lösung. <br><br>  Hier sollte ich etwas zu Problemumgehungen sagen, die vom Broker bereitgestellt werden.  Erstens hat der Broker Limit Orders.  Das Feature wurde im Februar 2019 veröffentlicht (und die Kunden haben fast zwei Jahre darauf gewartet).  Sie arbeiten innerhalb eines Handelstages.  Sie müssen sie also an jedem Handelstag neu einstellen.  Noch ein Fehler: Sie können keine Grenzen setzen, wie Sie möchten.  Es gibt eine Preisspanne und Sie können keine Limit-Bestellung mit einem Preis außerhalb der Bandbreite aufgeben.  Und dieser Bereich ist extrem eng.  In einem volatilen Markt fühlen Sie sich unwohl.  Schließlich können Sie nicht zwei multidirektionale Bestellungen erstellen (in meinem Fall führt sogar die erste Limit-Bestellung zu einem sofortigen Absturz der mobilen Broker-App, und die Broker-Site bietet diese Funktion nicht). <br><br>  Zweitens bietet die mobile App des Brokers eine Funktion: Sie können die Preisänderung des Assets abonnieren.  Wenn der Schwellenwert (absolut, im Preis oder relativ, in Prozent) überschritten wird, erhalten Sie eine Benachrichtigung.  Sie können jedoch auch hier keine zwei Schwellenwerte für das Asset erstellen. <br><br>  Meine Problemumgehung ist ganz einfach: <br><br><ol><li> Wir haben Schwellenwerte für einen Vermögenswert.  Wir berechnen die Schwellenwerte selbst.  Wenn Schwellenwerte überschritten werden, führen wir eine manuelle Aktion durch: Verkaufen oder Kaufen, um als Ergebnis Gewinn oder Verlust zu erzielen. </li><li>  Wir sollten eine Datenquelle erhalten, um den Preis des tatsächlichen Vermögenswerts zu erhalten </li><li>  Wenn der Schwellenwert überschritten wird, sollten wir eine Benachrichtigung senden. </li></ol><br>  Obwohl es einfach genug aussieht, enthält meine Lösung einige Details, die ich teilen und diskutieren möchte. <br><br>  1. Während mein Wertpapierportfolio über einen Vermögenswert verfügte, wurden im Skript Schwellenwerte definiert, und die Aktiensuche wurde einfach, einfach und überhaupt nicht konfigurierbar durchgeführt.  Es war eine schlechte Lösung, aber schnell und zeigte, dass die Idee richtig war.  Wenn ich neue Assets im Portfolio habe, habe ich Aktiennamen, Börsen und Schwellenwerte aus einer Datei geladen. <br><br>  2. Mein erster Vermögenswert war eine ausländische Aktie, und die ausländische Aktie konnte nur an der Börse in Sankt Petersburg gekauft oder verkauft werden.  Mein erster Ansturm war es, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">die Site</a> der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SPb-Börse</a> zu analysieren. <br><br>  Es gibt eine absteigende Volumensortierung, daher war das Parsen einfach, da sich mein Asset immer auf der ersten Seite befand.  Aber am 8. März war es kaputt.  Ich weiß nicht warum, aber TSLA tauchte auf einer 25. Seite auf.  Ihr Paginator verwendet JavaScript, um die Daten der Seiten herunterzuladen.  Es gibt eine klare Lösung: Laden Sie alle Seiten herunter, analysieren Sie sie und suchen Sie das Asset.  Das Herunterladen und Parsen von mehr als 25 Seiten in jeder Schleife erfordert jedoch zu viel Zeit. <br><br>  Stattdessen habe ich beschlossen, die Website tradeview.com als weitere Datenquelle hinzuzufügen.  Es ist nicht erforderlich, viele Seiten zu analysieren, um Ihren Bestand zu finden, da jedes Asset eine eigene Seite hat, wie diese: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.tradingview.com/symbols/NASDAQ-TSLA</a> <br><br>  Ich nahm an, dass jetzt meine Probleme weg sind, aber ich habe mich geirrt.  Die Daten auf den Seiten werden nur mit JS geladen und aktualisiert.  Anfragen, die ich zum Herunterladen von Seiten verwendet habe, sind fehlgeschlagen. <br><br>  Für dieses Problem kenne ich drei verschiedene Lösungen: <br><br>  PyQT, Selen (Webdriver) und eine Erweiterung Requests-HTML.  Da ich bereits ein Anforderungsmodul in meinem Projekt habe, habe ich mich für Requests-HTML entschieden. <br><br>  Für meine starke Enttäuschung war es nicht sehr stabil, bis ich einige Hinweise auf StackOverFlow und so fand. <br><br><pre><code class="python hljs">session = HTMLSession() r = session.get(url) my = r.html.render(timeout=<span class="hljs-number"><span class="hljs-number">30</span></span>) selector = <span class="hljs-string"><span class="hljs-string">'span.tv-symbol-header-quote__value.tv-symbol-header-quote__value--large.js-symbol-last'</span></span> price = r.html.find(selector)[<span class="hljs-number"><span class="hljs-number">0</span></span>].text r.close() session.close()</code> </pre> <br>  Achten Sie auf das Timeout sowie auf beide close () -Aufrufe.  Den meisten Beispielen fehlen diese Details, und es können einige Probleme auftreten. <br><br>  3. Wenn wir nun Seiten mit JS-Daten heruntergeladen, analysiert und entschieden haben, ob wir eine Benachrichtigung senden müssen, gibt es nur die Frage: "Wie senden wir eine Benachrichtigung?".  In meinem Fall bietet sms.ru eine praktische API und 5 kostenlose SMS pro Tag.  Melden Sie sich an einem SMS-Gate an.  Erstellen Sie einen API-Schlüssel.  Der Schlüssel so etwas: <br><br><pre> <code class="plaintext hljs">24A41EA5-EEEE-CCCC-5555-094143C2EDDD</code> </pre> <br>  Senden einer SMS-Funktion aus einer früheren Version meiner Lösung: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mymessage)</span></span></span><span class="hljs-function">:</span></span> sms_url = <span class="hljs-string"><span class="hljs-string">'https://sms.ru/sms/send?api_id=key&amp;to=number&amp;msg=message&amp;json=1'</span></span> sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'key'</span></span>, mykey) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'number'</span></span>, mynumber) sms_url = sms_url.replace(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, mymessage) sms_response = requests.get(sms_url)</code> </pre> <br>  Es funktioniert gut.  Ich bin auf die Frage gestoßen: Was ist, wenn wir bereits eine SMS gesendet haben?  In der ersten Version fehlen Überprüfungen, daher wird innerhalb jeder Schleife eine SMS gesendet.  Immer wieder. <br><br>  Ich habe einen SMS-Zähler hinzugefügt, den das Skript überprüft, bevor send_message aufgerufen wird. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> sms_counter sms_counter = sms_counter + <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  Okay, wir haben es verstanden.  Aber wenn ein neuer Tag auftaucht, taucht ein neues Problem auf: Wie spült man den SMS-Zähler?  Oder eigentlich wann?  Ich sehe drei verschiedene Möglichkeiten: Speichern des Zählers in der Datenbank (aber meine Lösung ist derzeit zustandslos), Analysieren von Datum und Uhrzeit, um den Zähler zwischen Handelstagen zu leeren und das Skript irgendwann zwischen zwei Handelstagen neu zu starten.  Im Moment habe ich die neueste Variante implementiert, aber in Zukunft kann ich sie ändern. <br><br>  Meine Lösung funktioniert jetzt. Sie können sie von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> herunterladen. <br><br>  Für Benutzer, die nicht wissen, wie sie mit Python-Skripten umgehen sollen, biete ich eine Paketlösung <a href="">für Windows an</a> (mit freundlicher Genehmigung von PyInstaller). <br><br>  TODOs: <br><br><ol><li>  Analysieren Sie die Datums- und Uhrzeit, um die SMS-Zähler zu leeren, anstatt das Skript neu zu starten. </li><li>  Im Moment ist es die zustandslose Anwendung. Ich möchte eine Datenbank hinzufügen. </li><li>  Nach # 2 wäre es schön, einen starken Anstieg oder Rückgang des Preises des Vermögenswerts (im Vergleich zum Schlusskurs des vorherigen Handelstages) zu verfolgen. </li><li>  Erweitern Sie Kommunikationspfade (Telegramm, Viber, Sprachanrufe) und Anbieter (aus Gründen der Zuverlässigkeit möchte ich smsc.ru SMS-gate hinzufügen, da sms.ru manchmal hängen bleibt und sms_response nicht zurückgibt, obwohl SMS gesendet wird). </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443434/">https://habr.com/ru/post/de443434/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443424/index.html">Umschreiben des Testfalls für das Junior-Frontend auf TypeScript und React-Hooks</a></li>
<li><a href="../de443426/index.html">Schwarze Markierung - wie OpenShift mit SELinux vor Container-Schwachstellen schützt</a></li>
<li><a href="../de443428/index.html">Palmer Lucky, der "Vater" von Oculus Rift, entwickelt ein virtuelles Schlachtfeldsystem für das Pentagon</a></li>
<li><a href="../de443430/index.html">Warum ist es schlecht, wenn das Internet alles über Sie weiß?</a></li>
<li><a href="../de443432/index.html">Blazor 0.9.0 veröffentlicht</a></li>
<li><a href="../de443436/index.html">Wo kann man über Apache Ignite, verteilte Datenbanken und verteiltes maschinelles Lernen im Frühjahr sprechen?</a></li>
<li><a href="../de443438/index.html">7 nützliche Firefox-Erweiterungen zum Englischlernen</a></li>
<li><a href="../de443440/index.html">PHP-Modul zum Arbeiten mit hierarchischen Daten in InterSystems IRIS</a></li>
<li><a href="../de443450/index.html">Warum die Armen nicht gesund sein können</a></li>
<li><a href="../de443452/index.html">Das russische Militär wird ein eigenes geschlossenes Internet schaffen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>