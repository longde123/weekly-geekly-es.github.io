<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèΩ üë©üèº‚Äçü§ù‚Äçüë®üèæ üêå Creaci√≥n de una m√°quina arcade emulador. Parte 2 üõ•Ô∏è üö´ üñ§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La primera parte est√° aqu√≠ . 

 Desmontador del procesador 8080 
 Conocido 
 Necesitaremos informaci√≥n sobre los c√≥digos de operaci√≥n y sus respectivo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Creaci√≥n de una m√°quina arcade emulador. Parte 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418683/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f48/668/8f8/f486688f8d67a372f8911558cc312204.jpg" alt="imagen"></div><br>  La primera parte est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h1>  Desmontador del procesador 8080 </h1><br><h2>  Conocido </h2><br>  Necesitaremos informaci√≥n sobre los c√≥digos de operaci√≥n y sus respectivos comandos.  Cuando busque informaci√≥n en Internet, notar√° que hay mucha informaci√≥n mixta sobre el 8080 y el Z80.  El Z80 era un seguidor del 8080: ejecuta todas las instrucciones 8080 con los mismos c√≥digos hexadecimales, pero tambi√©n tiene instrucciones adicionales.  Creo que, si bien debe evitar la informaci√≥n sobre el Z80, para no confundirse.  Cre√© una tabla de c√≥digo de operaci√≥n para nuestro trabajo, est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  Cada procesador tiene una gu√≠a de referencia escrita por el fabricante.  Por lo general, se llama algo as√≠ como "Manual del entorno del programador".  El manual 8080 se llama Manual de usuario de sistemas de microordenador Intel 8080.  Siempre se le ha llamado un "libro de datos", as√≠ que tambi√©n lo llamar√© as√≠.  Pude descargar la referencia 8080 de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">http://www.datasheetarchive.com/</a> .  Este PDF es un escaneo de baja calidad, as√≠ que si encuentra una versi√≥n mejor, √∫sela. <br><a name="habracut"></a><br>  Comencemos y echemos un vistazo a la ROM de Space Invaders.  (El archivo ROM se puede encontrar en Internet). Trabajo en Mac OS X, as√≠ que solo uso el comando hexdump para ver su contenido.  Para m√°s trabajo, encuentre el editor hexadecimal para su plataforma.  Aqu√≠ est√°n los primeros 128 bytes del archivo invaders.h: <br><br><pre><code class="hljs dos">$ hexdump -v invaders.h <span class="hljs-number"><span class="hljs-number">0000000</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> c3 d4 <span class="hljs-number"><span class="hljs-number">18</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> f5 c5 d5 e5 c3 <span class="hljs-number"><span class="hljs-number">8</span></span>c <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0000010</span></span> f5 c5 d5 e5 <span class="hljs-number"><span class="hljs-number">3</span></span>e <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> c0 <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">0000020</span></span> db <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>f da <span class="hljs-number"><span class="hljs-number">67</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a ea <span class="hljs-number"><span class="hljs-number">20</span></span> a7 ca <span class="hljs-number"><span class="hljs-number">42</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a eb <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">0000030</span></span> fe <span class="hljs-number"><span class="hljs-number">99</span></span> ca <span class="hljs-number"><span class="hljs-number">3</span></span>e <span class="hljs-number"><span class="hljs-number">00</span></span> c6 <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> eb <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-number"><span class="hljs-number">47</span></span> <span class="hljs-number"><span class="hljs-number">19</span></span> af <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">0000040</span></span> ea <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a e9 <span class="hljs-number"><span class="hljs-number">20</span></span> a7 ca <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a ef <span class="hljs-number"><span class="hljs-number">20</span></span> a7 c2 <span class="hljs-number"><span class="hljs-number">6</span></span>f <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0000050</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a eb <span class="hljs-number"><span class="hljs-number">20</span></span> a7 c2 <span class="hljs-number"><span class="hljs-number">5</span></span>d <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> bf <span class="hljs-number"><span class="hljs-number">0</span></span>a c3 <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a <span class="hljs-number"><span class="hljs-number">93</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">0000060</span></span> a7 c2 <span class="hljs-number"><span class="hljs-number">82</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> c3 <span class="hljs-number"><span class="hljs-number">65</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>e <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> ea <span class="hljs-number"><span class="hljs-number">20</span></span> c3 <span class="hljs-number"><span class="hljs-number">3</span></span>f <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-number"><span class="hljs-number">0000070</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>a <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-number"><span class="hljs-number">48</span></span> <span class="hljs-number"><span class="hljs-number">02</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> ...</code> </pre> <br>  Este es el comienzo del programa Space Invaders.  Cada n√∫mero hexadecimal es un comando o datos para el programa.  Podemos usar una referencia u otra informaci√≥n de referencia para comprender lo que significan estos c√≥digos hexadecimales.  Exploremos un poco m√°s el c√≥digo de la imagen ROM. <br><br>  El primer byte de este programa es $ 00.  Mirando la tabla, vemos que es NOP, as√≠ como los siguientes dos comandos.  (Pero no se desanime, Space Invaders probablemente utiliz√≥ estos comandos como un retraso para permitir que el sistema se calme un poco despu√©s del encendido). <br><br>  El cuarto comando es $ C3, es decir, a juzgar por la tabla, esto es JMP.  La definici√≥n de un comando JMP establece que recibe una direcci√≥n de dos bytes, es decir, los siguientes dos bytes son la direcci√≥n de salto JMP.  Luego vienen dos NOP m√°s ... as√≠ que, ¬øsabes qu√©?  Perm√≠tanme firmar las primeras instrucciones yo mismo ... <br><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">0000</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> NOP <span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> NOP <span class="hljs-number"><span class="hljs-number">0002</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> NOP <span class="hljs-number"><span class="hljs-number">0003</span></span> c3 d4 <span class="hljs-number"><span class="hljs-number">18</span></span> JMP <span class="hljs-meta"><span class="hljs-meta">$18</span></span>d4 <span class="hljs-number"><span class="hljs-number">0006</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> NOP <span class="hljs-number"><span class="hljs-number">0007</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span> NOP <span class="hljs-number"><span class="hljs-number">0008</span></span> f5 PUSH PSW <span class="hljs-number"><span class="hljs-number">0009</span></span> c5 PUSH B <span class="hljs-number"><span class="hljs-number">000</span></span>a d5 PUSH D <span class="hljs-number"><span class="hljs-number">000</span></span>b e5 PUSH H <span class="hljs-number"><span class="hljs-number">000</span></span>c c3 <span class="hljs-number"><span class="hljs-number">8</span></span>c <span class="hljs-number"><span class="hljs-number">00</span></span> JMP <span class="hljs-meta"><span class="hljs-meta">$008</span></span>c <span class="hljs-number"><span class="hljs-number">000</span></span>f <span class="hljs-number"><span class="hljs-number">00</span></span> NOP <span class="hljs-number"><span class="hljs-number">0010</span></span> f5 PUSH PSW <span class="hljs-number"><span class="hljs-number">0011</span></span> c5 PUSH B <span class="hljs-number"><span class="hljs-number">0012</span></span> d5 PUSH D <span class="hljs-number"><span class="hljs-number">0013</span></span> e5 PUSH H <span class="hljs-number"><span class="hljs-number">0014</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>e <span class="hljs-number"><span class="hljs-number">80</span></span> MVI A,#<span class="hljs-number"><span class="hljs-number">0x80</span></span> <span class="hljs-number"><span class="hljs-number">0016</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-number"><span class="hljs-number">72</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> STA <span class="hljs-meta"><span class="hljs-meta">$2072</span></span></code> </pre> <br>  Parece que hay alguna forma de automatizar este proceso ... <br><br><h2>  Desensamblador, Parte 1 </h2><br>  Un desensamblador es un programa que simplemente traduce una secuencia de n√∫meros hexadecimales al c√≥digo fuente en lenguaje ensamblador.  Esta es exactamente la tarea que realizamos a mano en la secci√≥n anterior: una gran oportunidad para automatizar este trabajo.  Al escribir este fragmento de c√≥digo, nos familiarizamos con el procesador y obtenemos un c√≥digo de depuraci√≥n conveniente que es √∫til al escribir un emulador de CPU. <br><br>  Aqu√≠ est√° el algoritmo de desmontaje del c√≥digo 8080: <br><br><ol><li>  Lee el c√≥digo en el b√∫fer </li><li>  Obtenemos un puntero al comienzo del b√∫fer </li><li>  Use el byte en el puntero para determinar el c√≥digo de operaci√≥n. </li><li>  Muestra el nombre del c√≥digo de operaci√≥n, si es necesario, usando bytes despu√©s del c√≥digo de operaci√≥n como datos </li><li>  Mueva el puntero al n√∫mero de bytes utilizados por este comando (1, 2 o 3 bytes) </li><li>  Si el b√∫fer no termina, vaya al paso 3 </li></ol><br>  Para sentar las bases del procedimiento, agregu√© un par de instrucciones a continuaci√≥n.  Presentar√© el procedimiento completo para la descarga, pero le recomiendo que intente escribirlo usted mismo.  No tomar√° mucho tiempo y, en paralelo, aprender√° el conjunto de instrucciones del procesador 8080. <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">/* *codebuffer -       8080 pc -          */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Disassemble8080Op</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *codebuffer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *code = &amp;codebuffer[pc]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> opbytes = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> (<span class="hljs-string"><span class="hljs-string">"%04x "</span></span>, pc); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (*code) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x00</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"NOP"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x01</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"LXI B,#$%02x%02x"</span></span>, code[<span class="hljs-number"><span class="hljs-number">2</span></span>], code[<span class="hljs-number"><span class="hljs-number">1</span></span>]); opbytes=<span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x02</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"STAX B"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x03</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"INX B"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x04</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"INR B"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x05</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"DCR B"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x06</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"MVI B,#$%02x"</span></span>, code[<span class="hljs-number"><span class="hljs-number">1</span></span>]); opbytes=<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x07</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"RLC"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x08</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"NOP"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ........ */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x3e</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"MVI A,#0x%02x"</span></span>, code[<span class="hljs-number"><span class="hljs-number">1</span></span>]); opbytes = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ........ */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xc3</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"JMP $%02x%02x"</span></span>,code[<span class="hljs-number"><span class="hljs-number">2</span></span>],code[<span class="hljs-number"><span class="hljs-number">1</span></span>]); opbytes = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* ........ */</span></span> } <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> opbytes; }</code> </pre><br>  En el proceso de escribir este procedimiento y estudiar cada c√≥digo de operaci√≥n, aprend√≠ mucho sobre el procesador 8080. <br><br><ol><li>  Me di cuenta de que la mayor√≠a de los equipos toman un byte, el resto dos o tres.  El c√≥digo anterior supone que el comando tiene un tama√±o de un byte, pero las instrucciones de dos y tres bytes cambian el valor de la variable "opbytes" para devolver el tama√±o correcto del comando. </li><li>  El 8080 tiene registros con los nombres A, B, C, D, E, H y L. Tambi√©n hay un contador de programas (contador de programas, PC) y un puntero de pila separado (puntero de pila, SP). </li><li>  Algunas instrucciones funcionan con registros en pares: B y C son un par, as√≠ como DE y HL. </li><li>  A es un registro especial, muchas instrucciones funcionan con √©l. </li><li>  HL tambi√©n es un registro especial, se utiliza como una direcci√≥n para cada lectura y escritura de datos en la memoria. </li><li>  Sent√≠ curiosidad por el equipo "RST", as√≠ que le√≠ un poco la gu√≠a.  Not√© que ejecuta el c√≥digo en lugares fijos y la referencia menciona el manejo de interrupciones.  Tras una lectura adicional, result√≥ que todo este c√≥digo al comienzo de la ROM era interrumpir las rutinas de servicio (ISR).  Las interrupciones pueden generarse mediante programaci√≥n utilizando el comando RST, o generadas por fuentes de terceros (no el procesador 8080). </li></ol><br>  Para convertir todo esto en un programa de trabajo, acabo de preparar un procedimiento que realiza los siguientes pasos: <br><br><ol><li>  Abre un archivo lleno de c√≥digo compilado 8080 </li><li>  Lo lee en el b√∫fer de memoria </li><li>  Pasa a trav√©s del b√∫fer de memoria, causando Disassemble8080Op </li><li>  Aumenta la PC devuelta por Disassemble8080Op </li><li>  Salidas al final del b√∫fer. </li></ol><br>  Puede verse m√°s o menos as√≠: <br><br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">**argv)</span></span></span><span class="hljs-function"> </span></span>{ FILE *f= fopen(argv[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (f==<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"error: Couldn't open %s\n"</span></span>, argv[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-comment"><span class="hljs-comment">//         fseek(f, 0L, SEEK_END); int fsize = ftell(f); fseek(f, 0L, SEEK_SET); unsigned char *buffer=malloc(fsize); fread(buffer, fsize, 1, f); fclose(f); int pc = 0; while (pc &lt; fsize) { pc += Disassemble8080Op(buffer, pc); } return 0; }</span></span></code> </pre> <br>  En la segunda parte, examinaremos el resultado obtenido al desmontar los ROM Space Invaders. <br><br><h2>  Asignaci√≥n de memoria </h2><br>  Antes de comenzar a escribir un emulador de procesador, necesitamos estudiar otro aspecto.  Todas las CPU tienen la capacidad de comunicarse con un cierto n√∫mero de direcciones.  Los procesadores m√°s antiguos ten√≠an direcciones de 16, 24 o 32 bits.  El 8080 tiene 16 contactos de direcci√≥n, por lo que las direcciones est√°n en el rango de 0- $ FFFF. <br><br>  Para comprender la asignaci√≥n de memoria del juego, necesitamos realizar una peque√±a investigaci√≥n.  Despu√©s de recopilar la informaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> , descubr√≠ que la ROM se encuentra en la direcci√≥n 0, y el juego tiene 8 KB de RAM a partir de $ 2000. <br><br>  El autor de una de las p√°ginas descubri√≥ que el b√∫fer de video comienza en la RAM con una direcci√≥n de $ 2,400, y tambi√©n nos dijo c√≥mo se usan los puertos de E / S 8080 para comunicarse con los controles y el equipo de audio.  Genial <br><br>  Dentro del archivo ROM invaders.zip, que se puede encontrar en Internet, hay cuatro archivos: invaders.e, .f, .g y .h.  Despu√©s de buscar en Google, me encontr√© con un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo</a> informativo que dice c√≥mo guardar estos archivos en la memoria: <br><br> <code>Space Invaders, (C) Taito 1978, Midway 1979 <br> <br> : Intel 8080, 2  (     Zilog Z80) <br> <br> : $cf (RST 8)   vblank, $d7 (RST $10)   vblank. <br> <br> : 256(x)*224(y), 60 ,  .   <br>      . <br>   :   7168 , 1    (32    ). <br> <br> : SN76477  . <br> <br>  : <br> ROM <br> $0000-$07ff: invaders.h <br> $0800-$0fff: invaders.g <br> $1000-$17ff: invaders.f <br> $1800-$1fff: invaders.e <br> <br> RAM <br> $2000-$23ff:   <br> $2400-$3fff:  <br> <br> $4000-:  </code> <br> <br>  Todav√≠a hay informaci√≥n √∫til, pero a√∫n no estamos listos para usarla. <br><br><h2>  Detalles sangrientos </h2><br>  Si desea saber qu√© tama√±o del espacio de direcciones tiene el procesador, puede comprender esto al observar sus caracter√≠sticas.  La especificaci√≥n 8080 nos dice que el procesador tiene 16 contactos de direcci√≥n, es decir, usa direccionamiento de 16 bits.  (En lugar de las especificaciones, es suficiente leer el manual, Wikipedia, google, etc.) <br><br>  En Internet hay mucha informaci√≥n sobre el hardware de Space Invaders.  Si no pudo encontrar esta informaci√≥n, puede obtenerla de dos maneras: <br><br><ul><li>  Observe el c√≥digo que se ejecuta en el emulador y descubra lo que hace.  Toma notas y observa con cuidado.  Debe ser lo suficientemente simple como para comprender, por ejemplo, d√≥nde, en opini√≥n del juego, se debe ubicar la RAM.  Tambi√©n es f√°cil determinar el lugar donde est√° buscando memoria de video (pasaremos un tiempo estudiando esto). </li><li>  Encuentre el diagrama de circuito de la m√°quina arcade y rastree las se√±ales de los contactos de direcci√≥n de la CPU.  Mira a d√≥nde van.  Por ejemplo, A15 (direcci√≥n m√°s antigua) solo puede ir a ROM.  De esto podemos concluir que las direcciones de la ROM comienzan en $ 8000. </li></ul><br>  Puede ser muy interesante e informativo descubrirlo usted mismo observando la ejecuci√≥n del c√≥digo.  Alguien tuvo que lidiar con todo esto por primera vez. <br><br><h1>  Desarrollo de l√≠nea de comando </h1><br>  El objetivo de este tutorial no es ense√±arle a escribir c√≥digo para una plataforma espec√≠fica, aunque no podremos evitar el c√≥digo espec√≠fico de la plataforma.  Espero que antes del inicio del proyecto, ya supiera c√≥mo compilar para su plataforma de destino. <br><br>  Cuando trabaja con c√≥digo independiente, que simplemente lee archivos y muestra texto en la consola, no es necesario utilizar un sistema de desarrollo demasiado complicado.  De hecho, solo complica las cosas.  Todo lo que necesitas es un editor de texto y terminal. <br><br>  Creo que cualquiera que quiera programar en un nivel bajo deber√≠a saber c√≥mo crear programas simples desde la l√≠nea de comandos.  Puede considerar que lo molesto, pero sus habilidades de hacker de √©lite no valen mucho si no puede funcionar fuera de Visual Studio. <br><br>  En Mac, puede usar TextEdit y Terminal para compilar.  En Linux, puede usar gedit y Konsole.  En Windows, puede instalar cygwin y herramientas, y luego usar N ++ u otro editor de texto.  Si quieres ser realmente genial, entonces todas estas plataformas admiten vi y emacs para la edici√≥n de texto. <br><br>  Compilar programas de un solo archivo usando la l√≠nea de comandos es una tarea trivial.  Supongamos que guard√≥ su programa en un archivo llamado <code>8080dis.c</code> .  Vaya a la carpeta con este archivo de texto y <code>cc 8080dis.c</code> as√≠: <code>cc 8080dis.c</code> .  Si no especifica el nombre del archivo de salida, se llamar√° <code>a.out</code> y puede ejecutarlo escribiendo <code>./a.out</code> . <br><br>  Eso, de hecho, es todo. <br><br><h3>  Usando un depurador </h3><br>  Si est√° trabajando en uno de los sistemas basados ‚Äã‚Äãen Unix, aqu√≠ hay una breve introducci√≥n a la depuraci√≥n de programas de l√≠nea de comandos utilizando GDB.  Necesita compilar el programa as√≠: <code>cc -g -O0 8080dis.c</code> .  La <code>-g</code> genera informaci√≥n de depuraci√≥n (es decir, puede realizar la depuraci√≥n en funci√≥n del texto fuente), y la <code>-O0</code> deshabilita las optimizaciones para que cuando pase por el programa, el depurador pueda rastrear con precisi√≥n el c√≥digo de acuerdo con el texto fuente. <br><br>  Aqu√≠ est√° el registro anotado del inicio de una sesi√≥n de depuraci√≥n.  Mis comentarios est√°n en l√≠neas marcadas con un signo de n√∫mero (#). <br><br><pre> <code class="hljs vhdl"> $ gdb a.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> GNU gdb <span class="hljs-number"><span class="hljs-number">6.3</span></span>.<span class="hljs-number"><span class="hljs-number">50</span></span>-<span class="hljs-number"><span class="hljs-number">20050815</span></span> (Apple version gdb-<span class="hljs-number"><span class="hljs-number">1708</span></span>) (Mon Aug <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>:<span class="hljs-number"><span class="hljs-number">45</span></span> UTC <span class="hljs-number"><span class="hljs-number">2011</span></span>) Copyright <span class="hljs-number"><span class="hljs-number">2004</span></span> Free Software Foundation, Inc. GDB <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> free software, covered by the GNU General Public License, <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> you are welcome <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> change it <span class="hljs-keyword"><span class="hljs-keyword">and</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">or</span></span> distribute copies <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> it under certain conditions. <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-string"><span class="hljs-string">"show copying"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> see the conditions. There <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> absolutely no warranty <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GDB. <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-string"><span class="hljs-string">"show warranty"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> details. This GDB was configured as <span class="hljs-string"><span class="hljs-string">"x86_64-apple-darwin"</span></span>...Reading symbols <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shared</span></span> libraries .. done #  ,       (gdb) b Disassemble8080Op Breakpoint <span class="hljs-number"><span class="hljs-number">1</span></span> at <span class="hljs-number"><span class="hljs-number">0</span></span>x1000012ef: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-number"><span class="hljs-number">8080</span></span>dis.c, <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span>. #   <span class="hljs-string"><span class="hljs-string">"invaders.h"</span></span>    (gdb) run invaders.h Starting program: /Users/bob/Desktop/invaders/a.<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> invaders.h Reading symbols <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">shared</span></span> libraries +........................ done Breakpoint <span class="hljs-number"><span class="hljs-number">1</span></span>, Disassemble8080Op (codebuffer=<span class="hljs-number"><span class="hljs-number">0</span></span>x100801000 <span class="hljs-string"><span class="hljs-string">""</span></span>, pc=<span class="hljs-number"><span class="hljs-number">0</span></span>) at <span class="hljs-number"><span class="hljs-number">8080</span></span>dis.c:<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unsigned</span></span> char *code = &amp;codebuffer[pc]; #gdb  n  <span class="hljs-string"><span class="hljs-string">"next"</span></span>.    <span class="hljs-string"><span class="hljs-string">"next"</span></span> (gdb) n <span class="hljs-number"><span class="hljs-number">8</span></span> int opbytes = <span class="hljs-number"><span class="hljs-number">1</span></span>; #p -    <span class="hljs-string"><span class="hljs-string">"print"</span></span>,     *code (gdb) p *code $<span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> '\<span class="hljs-number"><span class="hljs-number">0</span></span>' (gdb) n <span class="hljs-number"><span class="hljs-number">9</span></span> printf(<span class="hljs-string"><span class="hljs-string">"%04x "</span></span>, pc); #    <span class="hljs-string"><span class="hljs-string">""</span></span>, gdb     ,    <span class="hljs-string"><span class="hljs-string">"next"</span></span> (gdb) <span class="hljs-number"><span class="hljs-number">10</span></span> switch (*code) (gdb) n #   ,    <span class="hljs-string"><span class="hljs-string">"NOP"</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>x00: printf(<span class="hljs-string"><span class="hljs-string">"NOP"</span></span>); break; (gdb) n <span class="hljs-number"><span class="hljs-number">285</span></span> printf(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); #c -  <span class="hljs-string"><span class="hljs-string">"continue"</span></span>,        (gdb) c Continuing. <span class="hljs-number"><span class="hljs-number">0000</span></span> NOP #     Disassemble8080Op.   *opcode, # ,      NOP,    . Breakpoint <span class="hljs-number"><span class="hljs-number">1</span></span>, Disassemble8080Op (codebuffer=<span class="hljs-number"><span class="hljs-number">0</span></span>x100801000 <span class="hljs-string"><span class="hljs-string">""</span></span>, pc=<span class="hljs-number"><span class="hljs-number">1</span></span>) at <span class="hljs-number"><span class="hljs-number">8080</span></span>dis.c:<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unsigned</span></span> char *code = &amp;codebuffer[pc]; (gdb) c Continuing. <span class="hljs-number"><span class="hljs-number">0001</span></span> NOP Breakpoint <span class="hljs-number"><span class="hljs-number">1</span></span>, Disassemble8080Op (codebuffer=<span class="hljs-number"><span class="hljs-number">0</span></span>x100801000 <span class="hljs-string"><span class="hljs-string">""</span></span>, pc=<span class="hljs-number"><span class="hljs-number">2</span></span>) at <span class="hljs-number"><span class="hljs-number">8080</span></span>dis.c:<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unsigned</span></span> char *code = &amp;codebuffer[pc]; (gdb) n <span class="hljs-number"><span class="hljs-number">8</span></span> int opbytes = <span class="hljs-number"><span class="hljs-number">1</span></span>; (gdb) p *code $<span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> '\<span class="hljs-number"><span class="hljs-number">0</span></span>' #  NOP,   (gdb) c Continuing. <span class="hljs-number"><span class="hljs-number">0002</span></span> NOP Breakpoint <span class="hljs-number"><span class="hljs-number">1</span></span>, Disassemble8080Op (codebuffer=<span class="hljs-number"><span class="hljs-number">0</span></span>x100801000 <span class="hljs-string"><span class="hljs-string">""</span></span>, pc=<span class="hljs-number"><span class="hljs-number">3</span></span>) at <span class="hljs-number"><span class="hljs-number">8080</span></span>dis.c:<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-built_in"><span class="hljs-built_in">unsigned</span></span> char *code = &amp;codebuffer[pc]; (gdb) n <span class="hljs-number"><span class="hljs-number">8</span></span> int opbytes = <span class="hljs-number"><span class="hljs-number">1</span></span>; #   ! (gdb) p *code $<span class="hljs-number"><span class="hljs-number">3</span></span> = <span class="hljs-number"><span class="hljs-number">195</span></span> '?' # print     ,    /x    (gdb) p /x *code $<span class="hljs-number"><span class="hljs-number">4</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>xc3 (gdb) n <span class="hljs-number"><span class="hljs-number">9</span></span> printf(<span class="hljs-string"><span class="hljs-string">"%04x "</span></span>, pc); (gdb) <span class="hljs-number"><span class="hljs-number">10</span></span> switch (*code) (gdb) # C3 -  JMP. . <span class="hljs-number"><span class="hljs-number">219</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>xc3: printf(<span class="hljs-string"><span class="hljs-string">"JMP $%02x%02x"</span></span>,code[<span class="hljs-number"><span class="hljs-number">2</span></span>],code[<span class="hljs-number"><span class="hljs-number">1</span></span>]); opbytes = <span class="hljs-number"><span class="hljs-number">3</span></span>; break; (gdb) <span class="hljs-number"><span class="hljs-number">285</span></span> printf(<span class="hljs-string"><span class="hljs-string">"\n"</span></span>);</code> </pre> <br><h1>  Desensamblador, Parte 2 </h1><br>  Ejecute el desensamblador para el archivo ROM invaders.h y observe la informaci√≥n que se muestra. <br><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">0000</span></span> NOP <span class="hljs-number"><span class="hljs-number">0001</span></span> NOP <span class="hljs-number"><span class="hljs-number">0002</span></span> NOP <span class="hljs-number"><span class="hljs-number">0003</span></span> JMP <span class="hljs-meta"><span class="hljs-meta">$18</span></span>d4 <span class="hljs-number"><span class="hljs-number">0006</span></span> NOP <span class="hljs-number"><span class="hljs-number">0007</span></span> NOP <span class="hljs-number"><span class="hljs-number">0008</span></span> PUSH PSW <span class="hljs-number"><span class="hljs-number">0009</span></span> PUSH B <span class="hljs-number"><span class="hljs-number">000</span></span>a PUSH D <span class="hljs-number"><span class="hljs-number">000</span></span>b PUSH H <span class="hljs-number"><span class="hljs-number">000</span></span>c JMP <span class="hljs-meta"><span class="hljs-meta">$008</span></span>c <span class="hljs-number"><span class="hljs-number">000</span></span>f NOP <span class="hljs-number"><span class="hljs-number">0010</span></span> PUSH PSW <span class="hljs-number"><span class="hljs-number">0011</span></span> PUSH B <span class="hljs-number"><span class="hljs-number">0012</span></span> PUSH D <span class="hljs-number"><span class="hljs-number">0013</span></span> PUSH H <span class="hljs-number"><span class="hljs-number">0014</span></span> MVI A,#<span class="hljs-meta"><span class="hljs-meta">$80</span></span> <span class="hljs-number"><span class="hljs-number">0016</span></span> STA <span class="hljs-meta"><span class="hljs-meta">$2072</span></span> <span class="hljs-number"><span class="hljs-number">0019</span></span> LXI H,#<span class="hljs-meta"><span class="hljs-meta">$20</span></span>c0 <span class="hljs-number"><span class="hljs-number">001</span></span>c DCR M <span class="hljs-number"><span class="hljs-number">001</span></span>d <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-meta"><span class="hljs-meta">$17</span></span>cd <span class="hljs-number"><span class="hljs-number">0020</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> #<span class="hljs-meta"><span class="hljs-meta">$01</span></span> <span class="hljs-number"><span class="hljs-number">0022</span></span> RRC <span class="hljs-number"><span class="hljs-number">0023</span></span> JC <span class="hljs-meta"><span class="hljs-meta">$0067</span></span> <span class="hljs-number"><span class="hljs-number">0026</span></span> LDA <span class="hljs-meta"><span class="hljs-meta">$20</span></span>ea <span class="hljs-number"><span class="hljs-number">0029</span></span> ANA A <span class="hljs-number"><span class="hljs-number">002</span></span>a JZ <span class="hljs-meta"><span class="hljs-meta">$0042</span></span> <span class="hljs-number"><span class="hljs-number">002</span></span>d LDA <span class="hljs-meta"><span class="hljs-meta">$20</span></span>eb <span class="hljs-number"><span class="hljs-number">0030</span></span> CPI #<span class="hljs-meta"><span class="hljs-meta">$99</span></span> <span class="hljs-number"><span class="hljs-number">0032</span></span> JZ <span class="hljs-meta"><span class="hljs-meta">$003</span></span>e <span class="hljs-number"><span class="hljs-number">0035</span></span> ADI #<span class="hljs-meta"><span class="hljs-meta">$01</span></span> <span class="hljs-number"><span class="hljs-number">0037</span></span> DAA <span class="hljs-number"><span class="hljs-number">0038</span></span> STA <span class="hljs-meta"><span class="hljs-meta">$20</span></span>eb <span class="hljs-number"><span class="hljs-number">003</span></span>b <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-meta"><span class="hljs-meta">$1947</span></span> <span class="hljs-number"><span class="hljs-number">003</span></span>e SRA A <span class="hljs-number"><span class="hljs-number">003</span></span>f STA <span class="hljs-meta"><span class="hljs-meta">$20</span></span>ea <span class="hljs-comment"><span class="hljs-comment">/* 0000000 00 00 00 c3 d4 18 00 00 f5 c5 d5 e5 c3 8c 00 00 0000010 f5 c5 d5 e5 3e 80 32 72 20 21 c0 20 35 cd cd 17 0000020 db 01 0f da 67 00 3a ea 20 a7 ca 42 00 3a eb 20 0000030 fe 99 ca 3e 00 c6 01 27 32 eb 20 cd 47 19 af 32 */</span></span></code> </pre> <br>  Las primeras instrucciones corresponden a las que escribimos manualmente anteriormente.  Despu√©s de ellos hay varias instrucciones nuevas.  A continuaci√≥n he insertado datos hexadecimales para referencia.  Tenga en cuenta que si compara la memoria con los comandos, las direcciones son como si estuvieran almacenadas en la memoria en el orden inverso.  As√≠ es  Esto se llama little endian: las m√°quinas con little endian, como el 8080, almacenan primero los bytes menos significativos de n√∫meros.  (M√°s sobre endian se describe a continuaci√≥n). <br><br>  Mencion√© anteriormente que este c√≥digo es el c√≥digo ISR para el juego Space Invaders.  El c√≥digo para las interrupciones 0, 1, 2, ... 7 comienza con la direcci√≥n $ 0, $ 8, $ 20, ... $ 38.  Parece que el 8080 solo da 8 bytes para cada ISR.  A veces, el programa Space Invaders pasa por alto este sistema simplemente movi√©ndose a otra direcci√≥n con m√°s espacio.  (Esto sucede a $ 000c). <br><br>  Adem√°s, ISR 2 parece ser m√°s largo que la memoria asignada para ello.  Su c√≥digo va a $ 0018 (este es el lugar para ISR 3).  Creo que los Space Invaders no esperan ver nada que use la interrupci√≥n 3. <br><br>  El archivo ROM de Space Invaders de Internet consta de cuatro partes.  Explicar√© esto a continuaci√≥n, pero por ahora, para pasar a la siguiente secci√≥n, necesitamos fusionar estos cuatro archivos en uno.  En Unix: <br><br><pre> <code class="hljs matlab"> <span class="hljs-built_in"><span class="hljs-built_in">cat</span></span> invaders.h &gt; invaders <span class="hljs-built_in"><span class="hljs-built_in">cat</span></span> invaders.g &gt;&gt; invaders <span class="hljs-built_in"><span class="hljs-built_in">cat</span></span> invaders.f &gt;&gt; invaders <span class="hljs-built_in"><span class="hljs-built_in">cat</span></span> invaders.e &gt;&gt; invaders</code> </pre> <br>  Ahora ejecute el desensamblador con el archivo resultante de "invasores".  Cuando un programa comienza en $ 0000, lo primero que hace es cambiar a $ 18d4.  Considerar√© esto como el comienzo del programa.  Echemos un vistazo r√°pido a este c√≥digo. <br><br><pre> <code class="hljs pgsql"> <span class="hljs-number"><span class="hljs-number">18</span></span>d4 LXI SP,#<span class="hljs-meta"><span class="hljs-meta">$2400</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>d7 MVI B,#<span class="hljs-meta"><span class="hljs-meta">$00</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>d9 <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> <span class="hljs-meta"><span class="hljs-meta">$01</span></span>e6</code> </pre> <br>  Entonces, realiza dos operaciones y llama $ 01e6.  Voy a insertar parte del c√≥digo con transiciones en este c√≥digo: <br><br><pre> <code class="hljs mel"> <span class="hljs-number"><span class="hljs-number">01e6</span></span> LXI D,#$1b00 <span class="hljs-number"><span class="hljs-number">01e9</span></span> LXI H,#$2000 <span class="hljs-number"><span class="hljs-number">01</span></span>ec JMP $1a32 ..... <span class="hljs-number"><span class="hljs-number">1</span></span>a32 LDAX D <span class="hljs-number"><span class="hljs-number">1</span></span>a33 MOV M,A <span class="hljs-number"><span class="hljs-number">1</span></span>a34 INX H <span class="hljs-number"><span class="hljs-number">1</span></span>a35 INX D <span class="hljs-number"><span class="hljs-number">1</span></span>a36 DCR B <span class="hljs-number"><span class="hljs-number">1</span></span>a37 JNZ $1a32 <span class="hljs-number"><span class="hljs-number">1</span></span>a3a RET</code> </pre> <br>  Como vimos en la asignaci√≥n de memoria de Space Invaders, algunas de estas direcciones son interesantes.  $ 2000 es el comienzo de un programa de "RAM en funcionamiento".  $ 2,400 es el comienzo de la memoria de video. <br><br>  Agreguemos comentarios al c√≥digo para explicar lo que hace directamente al inicio: <br><br><pre> <code class="hljs mel"> <span class="hljs-number"><span class="hljs-number">18</span></span>d4 LXI SP,#$2400 ; SP=$2400 -      <span class="hljs-number"><span class="hljs-number">18</span></span>d7 MVI B,#$00 ; B=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">18</span></span>d9 CALL $01e6 ..... <span class="hljs-number"><span class="hljs-number">01e6</span></span> LXI D,#$1b00 ; DE=$1B00 <span class="hljs-number"><span class="hljs-number">01e9</span></span> LXI H,#$2000 ; HL=$2000 <span class="hljs-number"><span class="hljs-number">01</span></span>ec JMP $1a32 ..... <span class="hljs-number"><span class="hljs-number">1</span></span>a32 LDAX D ; A = (DE),   ,       $1B00 <span class="hljs-number"><span class="hljs-number">1</span></span>a33 MOV M,A ;  A  (HL),     $2000 <span class="hljs-number"><span class="hljs-number">1</span></span>a34 INX H ; HL = HL + <span class="hljs-number"><span class="hljs-number">1</span></span> ( $2001) <span class="hljs-number"><span class="hljs-number">1</span></span>a35 INX D ; DE = DE + <span class="hljs-number"><span class="hljs-number">1</span></span> ( $1B01) <span class="hljs-number"><span class="hljs-number">1</span></span>a36 DCR B ; B = B - <span class="hljs-number"><span class="hljs-number">1</span></span> ( <span class="hljs-number"><span class="hljs-number">0xff</span></span>,      <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>a37 JNZ $1a32 ; ,   ,     b=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>a3a RET</code> </pre> <br>  Parece que este c√≥digo copiar√° 256 bytes de $ 1b00 a $ 2000.  Por qu√©  No lo se  Puede estudiar el programa con m√°s detalle y reflexionar sobre lo que hace. <br><br>  <strong>Hay un problema aqu√≠.</strong>  Si tenemos un fragmento de memoria arbitrario que contiene c√≥digo, entonces los datos probablemente se alternar√°n con √©l. <br><br>  Por ejemplo, los sprites para los personajes del juego pueden mezclarse con el c√≥digo.  Cuando un desensamblador cae en tal fragmento de memoria, pensar√° que se trata de c√≥digo y continuar√° "masticando".  Si no tiene suerte, cualquier c√≥digo desensamblado despu√©s de este dato puede ser incorrecto. <br><br>  Si bien casi no podemos hacer nada al respecto.  Solo tenga en cuenta que tal problema existe.  Si ves algo como esto: <br><br><ul><li>  transici√≥n de un c√≥digo exactamente bueno a un equipo que no est√° en la lista de desensambladores </li><li>  flujo de c√≥digo sin sentido (por ejemplo, POP B POP B POP B POP C XTHL XTHL XTHL) </li></ul><br>  Aqu√≠, probablemente, hay datos que arruinaron parte del c√≥digo desmontado.  Si esto sucede, debe comenzar de nuevo desde el desplazamiento. <br><br>  Resulta que los invasores del espacio peri√≥dicamente se encuentran con ceros.  Si nuestro desmontaje alguna vez se detiene, los ceros lo obligar√°n a realizar un reinicio. <br><br>  Un an√°lisis detallado del c√≥digo de Space Invaders se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><h4>  Endian </h4><br>  Los bytes se almacenan de manera diferente en diferentes modelos de procesador, y el almacenamiento depende del tama√±o de los datos.  Las m√°quinas big-endian almacenan datos de mayor a menor.  Little-endian los mantiene desde los m√°s peque√±os hasta los m√°s viejos.  Si se escribe un entero 0xAABBCCDD de 32 bits en la memoria de cada m√°quina, se ver√° as√≠: <br><br>  En little-endian: $ DD $ CC $ BB $ AA <br><br>  Big-endian: $ AA $ BB $ CC $ DD <br><br>  Comenc√© a programar en procesadores Motorola que usaban big-endian, as√≠ que me pareci√≥ m√°s "natural", pero luego tambi√©n me acostumbr√© a little-endian. <br><br>  Mi desensamblador y mi emulador evitan completamente el problema endian porque solo leen un byte a la vez.  Si desea, por ejemplo, utilizar un lector de 16 bits para leer la direcci√≥n desde la ROM, tenga en cuenta que este c√≥digo no es port√°til entre arquitecturas de CPU. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es418683/">https://habr.com/ru/post/es418683/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es418673/index.html">Por qu√© est√° creciendo el mercado ERP: estad√≠sticas y tendencias</a></li>
<li><a href="../es418675/index.html">C√≥mo fui a Droidcon Berlin</a></li>
<li><a href="../es418677/index.html">Toda la verdad sobre RTOS. Art√≠culo # 6. Otros servicios RTOS</a></li>
<li><a href="../es418679/index.html">Escribimos un componente con botones de "material" para Svelte</a></li>
<li><a href="../es418681/index.html">D√≠a de la amistad: 50% de descuento en todos los IDE de JetBrains para nuestros amigos</a></li>
<li><a href="../es418685/index.html">Generaci√≥n de nivel de procedimiento</a></li>
<li><a href="../es418687/index.html">Revoluci√≥n de 3.5 ": detalles de un peque√±o boom de disquetes con vapores</a></li>
<li><a href="../es418689/index.html">C√≥mo crear bibliotecas de componentes en Figma, ahorrando un presupuesto, usando el ejemplo de una subasta en l√≠nea</a></li>
<li><a href="../es418691/index.html">Ganadero: Kubernetes en 5 minutos sobre metal desnudo.</a></li>
<li><a href="../es418693/index.html">¬øPor qu√© es tan dif√≠cil detectar la felicidad en el cerebro?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>