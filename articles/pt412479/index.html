<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üñçÔ∏è üëµ ‚öìÔ∏è Scanner a laser 3D no telefone Android ‚èπÔ∏è üë®üèø‚Äçü§ù‚Äçüë®üèΩ ü§¥üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apresento a voc√™ um scanner DIY baseado em um smartphone Android. 

 Ao projetar e criar um scanner, antes de tudo, eu estava interessado em digitaliz...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Scanner a laser 3D no telefone Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412479/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mb/dd/op/mbddoptooexgtjkqnnpchqsfkiq.jpeg"></div><br>  Apresento a voc√™ um scanner DIY baseado em um smartphone Android. <br><br>  Ao projetar e criar um scanner, antes de tudo, eu estava interessado em digitalizar objetos grandes.  M√≠nimo - a figura de uma pessoa em pleno crescimento com precis√£o - pelo menos 1-2 mm. <br><br>  Esses crit√©rios foram alcan√ßados com sucesso.  Objetos digitalizados com sucesso sob luz natural (sem luz solar direta).  O campo de digitaliza√ß√£o √© determinado pelo √¢ngulo de captura da c√¢mera do smartphone e pela dist√¢ncia em que o raio laser mant√©m o brilho suficiente para a detec√ß√£o (durante o dia na sala).  Esta √© a figura de uma pessoa em altura total (1,8 metros) com uma largura de trabalho de 1,2 metros. <br><br>  O scanner foi feito com base em considera√ß√µes "e se √© necess√°rio fazer algo mais ou menos √∫til e interessante quando n√£o h√° nada a fazer".  Todas as ilustra√ß√µes s√£o baseadas no exemplo de um objeto de "teste" (o upload de varreduras humanas n√£o est√° correto). <br><br>  Como a experi√™ncia demonstrou, para um scanner desse tipo de software, ele √© secund√°rio e o menor tempo foi gasto com ele (para a vers√£o final. Al√©m de experimentos e op√ß√µes sem sa√≠da).  Portanto, n√£o abordarei os recursos do software no artigo (link para os c√≥digos-fonte no final do artigo). <br><br>  O objetivo do artigo √© falar sobre ramifica√ß√µes de impasse e problemas coletados no caminho para a cria√ß√£o da vers√£o final de trabalho. <br><a name="habracut"></a><br>  Para o scanner, a vers√£o final usa: <br><br><ol><li>  Telefone Samsung S5 </li><li>  Lasers vermelhos e verdes com lente para uma linha (linha de 90 graus) a 30 mW com √≥ptica de vidro (n√£o a mais barata). </li><li>  Motores de passo 35BYGHM302-06LA 0.3A, 0.9 ¬∞ </li><li>  Drivers para o motor de passo A4988 </li><li>  M√≥dulo Bluetooth HC-05 </li><li>  Placa STM32F103C8t </li></ol><br>  Os drivers do A4988 s√£o configurados na metade do passo, que com uma caixa de velocidades 15-&gt; 120 fornece 400 * 2 * 8 passos por PI. <br><br><h2>  A escolha da tecnologia de digitaliza√ß√£o. </h2><br>  As v√°rias op√ß√µes a seguir foram consideradas. <br><br><h4>  Projetor LED. </h4><br>  A op√ß√£o foi considerada e calculada.  Mesmo projetores caros n√£o t√™m a resolu√ß√£o correta para alcan√ßar a precis√£o necess√°ria.  E nem vale a pena falar sobre coisas baratas. <br><br><h4>  Varredura mec√¢nica de um raio laser em combina√ß√£o com uma grade de difra√ß√£o. </h4><br>  A ideia foi testada e considerada adequada.  Mas n√£o para o desempenho de bricolage, por raz√µes: <br><br><ol><li>  Precisamos de um laser suficientemente poderoso, para que, ap√≥s a difra√ß√£o, as marcas fiquem brilhantes o suficiente (a dist√¢ncia at√© a lente do smartphone √© de 1 a 2 metros).  E meus olhos est√£o arrependidos.  Um ponto de laser j√° com 30mW n√£o √© √∫til. </li><li>  Os requisitos para a digitaliza√ß√£o mec√¢nica de precis√£o em dois planos s√£o muito altos para o desempenho de bricolage. </li></ol><br><h3>  Varredura mec√¢nica padr√£o de uma linha de laser em um objeto estacion√°rio de varredura. </h3><br>  Por fim, a op√ß√£o foi escolhida com dois lasers de cores diferentes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2i/uf/ue/2iufuep6mdd8uemj582b1fkhpja.jpeg"></div><br><ol><li>  Diferentes cores dos lasers tornam poss√≠vel detect√°-los independentemente em um √∫nico quadro. </li><li>  A localiza√ß√£o dos lasers em lados opostos da c√¢mera permite que voc√™ fa√ßa duas digitaliza√ß√µes de uma s√≥ vez. </li><li>  Duas digitaliza√ß√µes por vez permitem avaliar objetivamente a qualidade do alinhamento do scanner (as digitaliza√ß√µes devem convergir e se sobrepor). </li></ol><br>  Como se viu, o √∫ltimo crit√©rio √© o mais importante.  A qualidade da digitaliza√ß√£o √© totalmente determinada pela precis√£o da medi√ß√£o das dimens√µes e √¢ngulos geom√©tricos do scanner.  E a presen√ßa de duas digitaliza√ß√µes de dois lasers permite avaliar imediatamente a qualidade da digitaliza√ß√£o: <br>  Nuvens de pontos convergiram.  I.e.  avi√µes capturados por dois lasers convergiram em toda a superf√≠cie. <br><br><h1>  Vers√£o sem sucesso da parte mec√¢nica no 28BYJ-48. </h1><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/f5/bd/d7/f5bdd7gj652kanczlquqybadyv8.jpeg"></div><br>  Embora desde o in√≠cio eu tenha assumido que essa √© uma op√ß√£o sem sa√≠da que n√£o fornece a precis√£o necess√°ria, eu ainda a verifiquei com v√°rios truques: <br><br><ol><li>  O eixo do motor √© fixado pelo rolamento. </li><li>  Adicionado elemento de atrito e rolha para amostragem de folga da caixa de velocidades </li><li>  Uma tentativa de determinar a "posi√ß√£o exata" de um fototransistor por exposi√ß√£o a laser </li></ol><br>  A repetibilidade de retornar ao mesmo local da linha de laser mostrou-se baixa - 2-3 mm a uma dist√¢ncia de 1,5 metros.  Durante a opera√ß√£o das engrenagens, apesar da suavidade aparente, os solavancos de 1-3 mm s√£o vis√≠veis a uma dist√¢ncia de 1,5 metros. <br><br>  I.e.  O 28BYJ-48 √© completamente inadequado para um scanner mais ou menos preciso de objetos grandes. <br><br><h2>  Requisitos de digitaliza√ß√£o com base na minha experi√™ncia </h2><br>  <u>Um elemento obrigat√≥rio da varredura deve ser uma caixa de velocidades.</u> <br><br>  N√£o se engane sobre o modo 1 / x etapas.  As experi√™ncias mostraram que, no modo 1/16, nas micro etapas do A4988, n√£o s√£o uniformes.  E em 1/8, essa irregularidade √© percept√≠vel nos olhos. <br><br>  A solu√ß√£o mais ideal para a caixa de c√¢mbio foi o uso de uma engrenagem de correia.  Embora tenha sido bastante complicado, √© f√°cil criar e preciso. <br>  A precis√£o de posicionamento (mais precisamente, a repetibilidade de posicionamento da posi√ß√£o inicial dos lasers para digitaliza√ß√£o) dos lasers revelou-se em cerca de 0,5 mm para uma linha de laser de 5 mm de largura por 4 metros de dist√¢ncia.  I.e.  a uma dist√¢ncia de varredura (1,2-1,8 metros), geralmente √© dif√≠cil de medir. <br><br>  Posicionamento - acopladores √≥pticos (noname chin√™s) nos slots no disco sob os lasers. <br><br><h2>  Problemas na transmiss√£o de sinais de controle do telefone para o m√≥dulo de controle de lasers e motores de passo </h2><br>  O canal de controle acabou sendo um gargalo em termos de velocidade de varredura.  Como se tratava de um desenvolvimento descontra√≠do, para seu pr√≥prio prazer, todos os m√©todos de comunica√ß√£o com um smartphone foram testados. <br><br><h4>  Transmiss√£o de sinais de controle via conector de √°udio (telefone conector de √°udio =&gt; oscilosc√≥pio) </h4><br>  A maneira mais inibit√≥ria de transmitir dados em tempo real.  Sim, mesmo com tempo flutuante.  At√© 500 ms (!) Desde a ativa√ß√£o do software de transmiss√£o de dados de √°udio at√© a apar√™ncia real do sinal na tomada de √°udio. <br><br>  Esse ex√≥tico foi checado, porque, no trabalho, eu tive que lidar com leitores de cart√£o com chip m√≥vel. <br><br><h4>  Fotodiodos na tela do smartphone (fatia da tela do telefone =&gt; fototransistores + STM32F103) </h4><br>  Por uma quest√£o de interesse, mesmo um m√©todo t√£o ex√≥tico foi testado como fototransistores com uma matriz 2x2 na forma de prendedores de roupa na tela. <br><br>  Embora esse m√©todo de transmiss√£o de informa√ß√µes pelo telefone tenha sido o mais r√°pido, mas n√£o t√£o fundamentalmente mais r√°pido (10 ms vs 50ms) do que o Bluetooth, o que suportaria suas defici√™ncias (prendedor de roupa na tela). <br><br><h4>  Canal IR (telefone =&gt; TSOP1736-&gt; STM32F103) </h4><br>  Praticamente verificado e o m√©todo de transmiss√£o via canal IR.  Mesmo alguma implementa√ß√£o do protocolo de transfer√™ncia de dados teve que ser feita. <br><br>  Mas o IR tamb√©m se mostrou n√£o muito conveniente (√© inconveniente montar o sensor fotogr√°fico no telefone) e n√£o muito mais r√°pido que o Bluetooth. <br><br><h4>  M√≥dulo WiFi (telefone =&gt; ESP8266-RS232-&gt; STM32F103) </h4><br>  Os resultados da verifica√ß√£o deste m√≥dulo foram completamente desencorajadores.  O tempo de execu√ß√£o da solicita√ß√£o-resposta (eco) acabou imprevisivelmente flutuando no intervalo de 20 a 300 ms (uma m√©dia de 150 ms).  Por que e o qu√™ - n√£o entendi.  Encontrei apenas um artigo que descreveu uma tentativa malsucedida de usar o ESP8266 para troca de dados em tempo real com requisitos rigorosos de tempo de solicita√ß√£o / resposta. <br><br>  I.e.  O ESP8266 com firmware "padr√£o" TCP -&gt; RS232 n√£o √© adequado para esses fins. <br><br><h3>  Op√ß√£o selecionada para m√≥dulo de controle e transmiss√£o de sinal </h3><br>  Por fim, ap√≥s todas as experi√™ncias, o canal Bluetooth (m√≥dulo HC-05) foi selecionado.  Ele fornece um tempo est√°vel (e este √© o mais importante) de solicita√ß√£o de resposta de transfer√™ncia de dados de 40ms. <br><br>  O tempo √© bastante grande e afeta muito o tempo de varredura (metade do tempo total). <br>  Mas a melhor op√ß√£o n√£o foi alcan√ßada. <br><br>  Como m√≥dulo de controle, uma placa generalizada com o SM32F103C8T. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zt/v4/h_/ztv4h_9yaihwssmvespqbnixnv8.jpeg"></div><br><h2>  M√©todos para detectar uma linha em um quadro. </h2><br>  A maneira mais f√°cil de isolar as linhas de laser no quadro √© usar a subtra√ß√£o do quadro com o laser desligado e o quadro com o laser. <br><br>  Em princ√≠pio, a busca por quadro tamb√©m funciona sem subtra√ß√£o.  Mas funciona muito pior √† luz do dia.  Embora esse modo tenha sido deixado no software para testes comparativos (foto do modo abaixo. Todas as outras fotos com o modo de subtra√ß√£o de quadro). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u8/ui/er/u8uieroxdwngl1vbhe8xqq_wxi4.jpeg"></div><br>  O valor pr√°tico da op√ß√£o sem subtrair quadros foi baixo. <br><br>  √â poss√≠vel e poss√≠vel extrair o sinal do laser desta informa√ß√£o barulhenta.  No entanto, ele n√£o se incomodou. <br><br>  A op√ß√£o com subtra√ß√£o de quadro funciona bem. <br><br>  Qualquer experimento com tentativas de aproximar a linha e processar todo o quadro mostrou que quanto mais complexo o algoritmo, mais frequentemente ele ‚Äúcomete erros‚Äù e at√© atrasa o processamento em tempo real.  O algoritmo mais r√°pido (e mais f√°cil) para encontrar um laser (ponto de laser) em uma linha horizontal foi: <br><br><ul><li>  Para cada ponto da linha, a soma dos quadrados do n√≠vel de cor do laser (RGB) na janela especificada na configura√ß√£o √© considerada (13 px - valor ideal experimentalmente para a janela) </li><li>  O ponto do laser √© o meio da janela com o valor m√°ximo das somas dos n√≠veis de "cor". </li></ul><br>  O tempo para processar um quadro pesquisando as linhas "verde" e "vermelha" √© de 3 ms. <br><br>  As nuvens de pontos para o laser vermelho e verde s√£o contadas separadamente.  Com o ajuste mec√¢nico adequado, eles s√£o reduzidos com uma precis√£o de &lt;1 mm. <br><br><h2>  Precis√£o e alinhamento </h2><br>  A precis√£o estava dentro de 1 mm a uma dist√¢ncia de 1,2 metros.  Principalmente devido √† resolu√ß√£o da c√¢mera do telefone (1920x1080) e √† largura do feixe de laser. <br><br>  √â muito importante obter as verifica√ß√µes corretas para configurar est√°tica e din√¢mica.  A precis√£o / imprecis√£o √© claramente vis√≠vel ao carregar as duas nuvens de pontos no MeshLab.  Idealmente, as nuvens de pontos devem convergir, complementando-se. <br><br>  Os par√¢metros est√°ticos s√£o definidos com a maior precis√£o poss√≠vel uma vez: <br><br><ol><li>  A tangente do √¢ngulo de vis√£o da c√¢mera. </li><li>  O comprimento dos "ombros" dos lasers (do centro da lente ao eixo de rota√ß√£o). </li></ol><br>  E, √© claro, o foco m√°ximo das lentes a laser em uma determinada dist√¢ncia de digitaliza√ß√£o e a "verticalidade" das linhas de laser. <br><br>  O par√¢metro din√¢mico do √¢ngulo real da posi√ß√£o dos lasers em rela√ß√£o ao plano virtual do quadro deve ser ajustado novamente sempre que misturar o telefone na montagem.  Para isso, √© feito o modo de configura√ß√£o no software.  Ao reduzir a tela do laser para o centro e ajustar o √¢ngulo, √© necess√°rio definir a dist√¢ncia calculada o mais pr√≥ximo poss√≠vel da dist√¢ncia real (medida) para ambos os lasers. <br><br>  Antes do ajuste fino: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/om/bi/zn/ombiznxwfxp9omvn9iykl7r2euk.jpeg"></div><br>  Ap√≥s o ajuste: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/4-/5y/jq/4-5yjqvqndfskpdqsqozgtjl6cs.jpeg"></div><br><h2>  Conclus√µes </h2><br>  Talvez esse design possa ser repetido por qualquer pessoa.  Cortei todos os detalhes da fibra de vidro ao CNC. <br><br>  Obviamente, sem uma fresadora CNC, √© dif√≠cil fabricar uma polia sob o laser.  Mas, levando em considera√ß√£o o fato de que voc√™ precisa de um √¢ngulo de rota√ß√£o de no m√°ximo 90 graus, com a devida paci√™ncia, a polia tamb√©m pode ser cortada com uma lima. <br><br>  Mas √© melhor faz√™-lo no CNC.  Os requisitos para folga axial do conjunto rotativo s√£o altos.  A qualidade das digitaliza√ß√µes √© 100% determinada pela precis√£o de fabrica√ß√£o e alinhamento. <br><br>  O scanner fez em segundo plano.  √Äs vezes, de forma intermitente por alguns meses.  Portanto, n√£o posso avaliar a complexidade total de sua cria√ß√£o. <br><br>  O custo total da estrutura n√£o √© muito alto.  Como meus experimentos mostraram, embora esteja longe de scanners industriais de objetos grandes, voc√™ pode obter digitaliza√ß√µes bastante decentes. <br>  A qualidade das digitaliza√ß√µes √© afetada principalmente pela precis√£o da parte mec√¢nica.  Nesse sentido, no DIY √© dif√≠cil lidar com a mec√¢nica criada para scanners industriais. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">C√≥digo fonte</a> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/86_ZMUdhrN4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt412479/">https://habr.com/ru/post/pt412479/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt412469/index.html">O EmDrive oferece tra√ß√£o devido a uma blindagem ruim</a></li>
<li><a href="../pt412471/index.html">Lidando com artigos: n√≠vel avan√ßado</a></li>
<li><a href="../pt412473/index.html">EW contra internet via sat√©lite</a></li>
<li><a href="../pt412475/index.html">Foi encontrada uma nova vulnerabilidade nos processadores</a></li>
<li><a href="../pt412477/index.html">Elon Musk: por enquanto, n√£o venderemos a vers√£o base do Modelo 3</a></li>
<li><a href="../pt412481/index.html">O que h√° de errado com o m√©todo Bates</a></li>
<li><a href="../pt412483/index.html">A falta de sono leva a uma queda radical na aten√ß√£o e no desempenho</a></li>
<li><a href="../pt412485/index.html">[GT-H]: Sobre problemas sist√™micos, o futuro e (um pouco) Tesla - onde estaria sem ela</a></li>
<li><a href="../pt412487/index.html">Chamadas √†s 5 da manh√£ e acordos com o Parlamento Europeu: como preparamos nossas confer√™ncias blockchain</a></li>
<li><a href="../pt412489/index.html">Uma Breve Hist√≥ria das Alternativas Qu√¢nticas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>