<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥄 👩🏽‍🌾 ✒️ 团队平衡器在《战车世界：闪击战》中的运作方式 👷 🧑‍🤝‍🧑 🔡</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="WoT Blitz是一款移动坦克射击游戏，玩家可以在7对7格式中进行战斗。 
 媒人或平衡者是一种机制，根据希望进入战斗的玩家阵容来形成团队的组成。 

 战车具有以下对接会重要的参数： 



- 等级 根据液位的不同，坦克的不同特性也会发生变化（例如，速度，装甲穿透力）。 在第1级-最弱的战车，...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>团队平衡器在《战车世界：闪击战》中的运作方式</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/wargaming/blog/458866/"><img src="https://habrastorage.org/getpro/habr/post_images/092/3c7/ad3/0923c7ad3574f10602c64ab860f185e0.jpg"><br><br>  WoT Blitz是一款移动坦克射击游戏，玩家可以在7对7格式中进行战斗。 <br> 媒人或平衡者是一种机制，根据希望进入战斗的玩家阵容来形成团队的组成。 <br><br> 战车具有以下对接会重要的参数： <br><br><ul><li> 等级 根据液位的不同，坦克的不同特性也会发生变化（例如，速度，装甲穿透力）。 在第1级-最弱的战车，在第10级-最强的战车。 <br></li><li> 型式  WoT Blitz有4种类型的坦克：轻型，中型，重型和坦克歼击车（反坦克自行火炮） <br></li></ul><br> 媒人的最简单实现是将玩家随机分组。 但是在这种情况下，处于低位的玩家将没有任何机会造成至少一些伤害，这将变得毫无意义。 <br><a name="habracut"></a><br><h2> 要求条件 </h2><br> 平衡器的要求列表是根据游戏社区的反馈而形成的，并定期更新到今天。 <br><br> 在撰写有关常规战斗的文章时，该列表包含以下各项： <br><br><div class="spoiler">  <b class="spoiler_title">平衡器要求清单</b> <div class="spoiler_text"><ul><li> 坦克的最大和最小水位之差不应超过一，排除外（也就是说，如果在战斗中遇到10秒，则不应有5秒或7秒，只有9秒和10秒）； <br></li><li> 团队人数应为7x7，但在线人数较少（在这种情况下，您可以进行较小的战斗，例如5x5或3x3）； <br></li><li> 球队应该根据现有技术进行镜像平衡（如果一个球队中有3个第十级别的战车和4个第九级别的战车，那么其他战队也应该有3个十和四个九）。 <br></li><li> 在两个团队中，排的现有技术都应该相同； <br></li><li> 每种类型的车队不得超过3个战车（例如，不超过3个子弹，不超过3个PT）。 该规则从5级及更高级别开始； <br></li><li> 两队之间相同类型的坦克数量之差不应超过一队（例如，如果一队拥有1 PT，则第二队最多可以有2 PT）； <br></li><li> 战队必须在相同战车的数量上保持平衡，每个战车的差异不得超过一个战车（如果一个战队中有1个IS-7，那么另一战队中则不得超过2个IS-7）； <br></li><li> 玩家只能进入自己选择的战斗模式（如果玩家仅打开了“即将来临的战斗”，则不应进入“优势”）； <br></li><li> 如果玩家购买了新坦克，则在新坦克的前N场战斗中，其他坦克的水平不会超过玩家新坦克的水平（也就是说，如果玩家拥有5级的坦克，则战斗中不应遇到6级的坦克）; <br></li><li> 玩家必须获得已经装好的那些卡。 游戏安装后，我们已经加载了一些内容； <br></li><li> 如果玩家打开了“单一控件类型”选项，则他只能与具有相同控件类型的玩家一起玩（如果他在平板电脑/手机上玩，则不应与鼠标接触，反之亦然）。 <br></li></ul><br></div></div><br> 开发一个媒人，特别是考虑到如此多的限制，是一项非常有趣的任务。 解决方案的方法可能很多。 <br><br><h2> 平衡器形成一对球员 </h2><br> 最初，在移动水箱中使用了平衡器，他从他的哥哥那里继承了这一平衡器-台式水箱。 总的来说，他工作得很好，但是他有几个问题：首先，他没有明确保证满足要​​求。 其次，增加新的要求非常困难。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/782/9fa/132/7829fa13252ab37dd365f4f995472ff6.jpg"><br>  <i>战斗开始</i> <br><br> 因此，编写了另一个平衡器，该平衡器根据以下算法工作： <br><br><ul><li> 我们根据设备的级别和类型将玩家分为几类； </li><li> 从产生的玩家中我们组成一对。 </li><li> 我们将不同的对子散布在不同的团队中：进行每对，将第一个玩家扔进第一队，第二个扔进第二个； </li><li> 在收到的球队中，我们进行最后的重新平衡：为了满足大多数要求，我们将一个球队的一些球员替换为另一球队的球员。 </li></ul><br> 最终的平衡器的工作速度比以前的版本快5到10倍，并且最初组建了满足当时所有要求的团队。 通过编写其他重新平衡通行证来添加新规则。 <br><br> 一开始，一切都很好。 但是随着时间的推移，添加的规则越多，编写重新平衡的难度就越大。 新的重新平衡不应因其工作而中断先前的工作。 显然，这是通往无处可去的道路。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54d/b66/d5e/54db66d5e4828ed61911b2f8f2a68e06.jpg"><br>  <i>媒人中的虫子-9对9的团队齐聚一堂</i> <br><br><h2> 模拟退火平衡器 </h2><br> 在最终版本中，我们选择了根据以下算法工作的平衡器。 所有单击“战斗”按钮的玩家都将进入常规队列。 无休止的循环平衡器执行以下操作： <br><br><ul><li> 选择随机战斗参数（随机战斗级别（从1到10），随机模式，随机地图）； <br></li><li> 在队列中找到所有符合以上所选条件的玩家（在合适水平的战车上战斗，打开所选模式，加载所选地图）； <br></li><li> 试图组成满足以上所有要求的团队（以下描述）； <br></li><li> 如果有可能组建一支队伍，则将这些球员赶出等候线，战斗就开始了。 <br></li></ul><br> 为了从合适的参与者列表中组成团队，使用了退火模拟方法。  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在此处</a>阅读有关该方法本身的更多信息。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/411/401/883/41140188357a3e3102bc709bb9b6418e.gif"><br>  <i>通过模拟退火搜索全局最大值</i> <br><br> 在应用到组建团队的上下文中，算法如下： <br><br><ul><li> 它从两个空团队开始。 <br></li><li> 在每次迭代时，它会随机更改命令状态。 为此，请执行以下操作之一： <br><br><ul><li> 从合适的球员列表中向第一或第二支球队添加一个随机球员（我们也选择一个随机球队）； <br></li><li> 从随机团队中移出随机玩家； <br></li><li> 用一，二队中现有的一名替换一名合适的球员中的一名； <br></li><li> 将第一支队伍的一名随机玩家更改为第二支队伍的一名随机玩家。 <br></li></ul><br></li><li> 获取结果状态的估计值。 为此，调用评估函数。 该功能遍历需求列表，对于每个项目的违反都会增加罚款。 违反分数越强，处罚越高。 例如，对2x2球队的罚款将高于对6x6球队的罚款； <br></li><li> 根据估计函数的值和当前温度的变化，我们确定过渡到新状态的可能性。 <br></li><li> 我们继续该过程，直到温度达到设定的最小值或评估函数的值达到零（在这种情况下，满足所有要求并且可以开始战斗）。 <br></li></ul><br> 这种方法的主要优点是：添加新的需求，足以修改评估功能。 无需编写代码来描述如何确切地获得我们想要的东西。 只需添加一条规则，以查看组建的团队并说明其是否平衡。 <br><br> 添加此类规则的一个很好的例子是评级战。 在媒人的评分战中，同时出现了几个新规则： <br><ul><li> 团队必须在评分方面保持平衡（团队之间的玩家总评分之差不应超过给定值）； <br></li><li> 玩家之间的评分差异应最小（青铜联赛的玩家不应与钻石的玩家进行战斗）。 <br></li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/253/682/c5a/253682c5a95b82a7d39ddde317f45e5d.jpg"><br>  <i>钻石联赛球员个人资料示例</i> <br><br> 第一条规则是通过修改评估函数来实现的：增加了超过额定值的最大允许差额的罚款。 第二条规则是通过更改将合适的玩家从队列中拉出的功能来实现的。 <br><br> 这种方法的缺点是速度慢。 与以前的版本相比，即使进行了许多优化，当前版本的运行速度也要慢大约10倍。 顺便说一下，关于优化。 游戏的大多数服务器（网络和物理服务器除外）都是用Python编写的。 平衡器用C ++重写，并并行化到许多线程。 在Python中，加号代码中包含了形成命令的请求。 此外，每个流独立地开始退火方法。 一旦某个线程找到了解决方案，其余线程就会停止搜索过程，并将找到的解决方案返回给Python。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/54d/0cf/407/54d0cf407524a78ec37c1d7ab70e025a.jpg"><br>  <i>RU服务器上的等待时间和队列大小（正常战斗中为5秒，评级战斗中为10秒）</i> <br><br> 随着在线增长的增长，平衡器的负载也随之增加。 今年秋天，当RU服务器上的在线服务器达到12万台（在“疯狂游戏”事件期间）时，平衡器便无法应对。 作为临时措施，我们禁用了一些规则，这使我们可以减少负载。 为避免将来出现此类问题，我们将媒人分发了。 <br><br><h2> 评分系统 </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/e8b/d46/0d8/e8bd460d86642b62b9ba8832bcaddf84.jpg"><br>  <i>钻石联赛最佳球员，2019年4月21日</i> <br><br> 在许多MMO游戏中，除了随机打架外，还存在评级/排名/等。 这种模式的主要思想是：对手不是随机搜索的，而是技巧合适的。 如果您是一名技能高手，那么您将与相同的技能高手一起玩，反之亦然，如果您不知道如何玩，那么您将面临同样的新手。 <br><br> 在赛季开始之初，玩家将进行一系列的标准比赛，其结果决定了他的起始位置。 然后，取决于游戏的进一步成功，玩家的排名上升或下降。 首先，创建Blitz中的评分系统以实现适当的平衡。 它提高了玩家的技能，并且实际上与玩的游戏次数无关。 <br><br> 要进行等级之战，必须立即解决两个问题。 首先，有必要选择一个评分系统（应该按照什么原则对玩家进行评分）。 其次，有必要对平衡器进行改进，使其在考虑到评级限制的情况下收集战斗信息。 <br><br> 评分系统的主要要求是能够准确确定玩家的水平。 为了评估一个或另一个评级系统的工作效率，创建了一个模拟器，在该模拟器的输入中提交了战斗历史和所选评级系统，在输出端，获得了系统的准确性。 <br><br> 准确性计算如下： <br><br><ul><li> 所有球员都被赋予了起始等级； <br></li><li> 根据每个战斗的结果，将根据所选系统重新计算参与该战斗的玩家的等级； <br></li><li> 在每次战斗之前，系统都会尝试预测哪支球队会获胜。 <br></li><li> 结果，计算出系统给出正确预测的战斗百分比。 <br></li></ul><br><br> 最受欢迎的评分计算系统： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">winrate</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Elo</a> ， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Glicko</a>和<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">TrueSkill</a> 。  Winrate是通常的胜利百分比。  Elo是一种评分系统，最初是为两个人（象棋等）的游戏创建的。 在该系统中，根据对手的等级，给玩家一个/赢得/失去一定数量的积分。  Glicko通常与Elo类似，但也要考虑玩家不活动了多长时间。  TrueSkill是Microsoft专有的分级系统，其中每个玩家都有两个参数：分级和系统对此分级的置信度。 <br><br> 在开发第一个版本的评分战时，我们考虑了winrate和Elo（适用于团队游戏的几种选择）以及简单的计分系统（在评分系统中，玩家始终获得固定数量的评分分以获得胜利，被带走以击败）。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f37/df8/817/f37df8817e83f29d780a0311f10ff28c.png"><br><br>  Elo系统显示了最好的结果，其中Ra是玩家评分，Rb是对战球队的总评分与该玩家团队的总评分之间的差额，但玩家本人除外。 <br><br> 发布后我们遇到的主要困难是： <br><br><ul><li> 玩家之间的排名差异太大； <br></li><li> 球员得分（进入联盟）的可预测速度差。 <br></li></ul><br> 第一个问题由于以下事实而无法完全解决：技能球员太少，他们必须等待很长一段时间才能开始战斗，而且经常看到团队中的球员实力下降。 为了减轻影响，我们仅在黄金时段（即在服务器上玩的人数最多的时候）提供分级战。 <br><br> 我们通过引入一个减慢因子解决了第二个问题（也就是说，玩家离平均评分越远，他升或降到其以下就越困难）。 <br><br> 我们还尝试了各种方法来提高评分系统的质量。 在第一个版本中，为了更改等级，我们仅使用有关胜利/失败的信息。 但是我们有团队合作的游戏，并非总是某个特定球员的好行为会导致整个团队的胜利。 也就是说，即使该球员打得很好并且球队输了，该球员的得分也要与其他所有球员相同。 为了防止这种情况，我们开始尝试考虑玩家在战斗中的个人行为。 <br><br> 为此，我们尝试使用机器学习：我们收集了各种因素，并尝试训练模型以根据玩家在战斗中的行动来预测球队的胜利/失败，然后使用该模型来确定等级奖励系数（即，如果球队输了，但玩家的行为是相似的有关获胜玩家的行为，请给此类玩家额外的奖励）。 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a2/b8e/062/1a2b8e062b5614ce7b5fef0ff940413c.jpg"><br>  <i>获胜球队中表现出色的球员获得+40评分。</i>  <i>+10不好</i> <br><br> 我们能够建立一个好的模型，其结果要比当前模型好得多，但是存在一个困难（这常常会破坏机器学习问题中的一切）。 该模型很好，但有时会出现人们容易看到的错误。 周期性地存在这样的情况，即从人的角度来看，玩家表现出良好的成绩，而从模型的角度来看，其获得的奖金却很少，反之亦然。 <br><br> 结果，我们放弃了ML模型，并采用了更简单的手动公式。 该公式仅考虑战斗经验，不考虑胜利，x2和其他奖励。 尽管它比ML模型的结果略低，但结果却非常不错。 <br><br><h2> 结论 </h2><br><ul><li> 基于退火模拟方法的平衡器使我们能够从解决方案的描述（如何组建团队）转移到需求的描述（不应违反哪些条件）； <br></li><li> 在团队等级战中，考虑到玩家在战斗中的个人动作，改进的Elo系统表现得很好。 <br></li><li> 不一定总是应用复杂的机器学习方法（特别是当人对结果的解释和理解很重要时）。 <br></li></ul><br> 我们将继续开发和改进平衡器。 我们几乎打败了阶级失衡的负面印象。 我们的球员要注意的主要问题是技巧，动荡和afk球员的失衡。 这是一个严峻的挑战，我们将继续在这些领域开发平衡器。 <br><br> 如果您对WoT Blitz中的平衡器有任何疑问/建议，请在评论中（或在我们的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">论坛上</a> ）退订。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN458866/">https://habr.com/ru/post/zh-CN458866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN458850/index.html">廉价而高效地学习英语。 第二部分</a></li>
<li><a href="../zh-CN458854/index.html">MotionLayout：动画效果更好，代码更少</a></li>
<li><a href="../zh-CN458856/index.html">便宜和昂贵的AAA电池</a></li>
<li><a href="../zh-CN458860/index.html">调整Linux内核参数以优化PostgreSQL</a></li>
<li><a href="../zh-CN458864/index.html">Bot开发人员争夺TamTam</a></li>
<li><a href="../zh-CN458868/index.html">大数据中的噪音。 熵分析</a></li>
<li><a href="../zh-CN458870/index.html">我们每天都面临的最流行的计算机问题</a></li>
<li><a href="../zh-CN458874/index.html">ASO清单：文本优化</a></li>
<li><a href="../zh-CN458876/index.html">星期五迷你周日</a></li>
<li><a href="../zh-CN458878/index.html">什么是GitOps？</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>