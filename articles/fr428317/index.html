<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöñ ü§πüèø üö£üèº React hooks - gagner ou perdre? üèÖ üë©üèø‚Äçü§ù‚Äçüë©üèº üéóÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Avec la sortie du nouveau React 16.6.0, HOOKS (PROPOSAL) est apparu dans la documentation. Ils sont maintenant disponibles dans react 17.0.0-alpha et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>React hooks - gagner ou perdre?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428317/"><p><img src="https://habrastorage.org/webt/qi/fs/qc/qifsqcglrtrastzefywxuzgnhfk.jpeg" alt="image"></p><br><p>  Avec la sortie du nouveau React 16.6.0, HOOKS <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(PROPOSAL)</a> est apparu dans la documentation.  Ils sont maintenant disponibles dans react 17.0.0-alpha et sont discut√©s dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC</a> ouvert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">: React Hooks</a> .  Voyons ce que c'est et pourquoi c'est n√©cessaire sous la coupe. </p><a name="habracut"></a><br><p>  Oui, c'est RFC et vous pouvez influencer la mise en ≈ìuvre finale en discutant avec les cr√©ateurs de r√©agir pourquoi ils ont choisi telle ou telle approche. </p><br><p>  Voyons √† quoi ressemble un crochet standard: </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Declare a new state variable, which we'll call "count" const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;/div&gt; ); }</span></span></code> </pre> <br><p>  Essayez de penser √† ce code, c'est un teaser et √† la fin de l'article, vous comprendrez d√©j√† ce que cela signifie.  La premi√®re chose que vous devez savoir est que cela ne rompt pas la compatibilit√© descendante et peut-√™tre qu'ils seront ajout√©s en 16.7 apr√®s avoir collect√© les commentaires et suggestions dans le RFC. </p><br><p>  Comme les gars l'assurent, ce n'est pas un plan pour couper les classes d'un r√©actif. </p><br><p>  De plus, les hooks ne remplacent pas les concepts actuels de la r√©action, tout est √† la place des accessoires / √©tat / contexte / r√©f√©rences.  C'est juste une autre fa√ßon d'utiliser leur pouvoir. </p><br><h3 id="motivaciya">  La motivation </h3><br><p>  Les crochets r√©solvent √† premi√®re vue les probl√®mes non connect√©s qui sont apparus avec le soutien de dizaines de milliers de composants sur 5 ans √† partir de Facebook. </p><br><p>  La chose la plus difficile est de r√©utiliser la logique dans les composants avec √©tat, la r√©action n'a aucun moyen d'attacher un comportement r√©utilisable au composant (par exemple, le connecter au r√©f√©rentiel).  Si vous avez travaill√© avec React, vous connaissez le concept de HOC (high-order-component) ou d'accessoires de rendu.  Ce sont des mod√®les assez bons, mais parfois ils sont utilis√©s de mani√®re excessive, ils n√©cessitent une restructuration des composants afin qu'ils puissent √™tre utilis√©s, ce qui rend g√©n√©ralement le code plus lourd.  Il vaut la peine de regarder une application React typique et il deviendra clair ce qui est en jeu. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/35f/c76/c98/35fc76c98f2288b4c2c46a45a2f4145c.gif" alt="image"></p><br><p>  C'est ce qu'on appelle l' <em>enfer</em> envelopp√© - l'enfer enveloppant. </p><br><p>  Une application de HOC seule est normale dans les r√©alit√©s actuelles, ils ont connect√© le composant au magasin / th√®me / localisation / jarret personnalis√©, je pense que tout le monde le sait. </p><br><p>  Il devient clair que la r√©action a besoin d'un autre m√©canisme primitif pour s√©parer la logique. </p><br><p>  √Ä l'aide de crochets, nous pouvons extraire l'√©tat d'un composant afin qu'il puisse √™tre test√© et r√©utilis√©.  Les crochets vous permettent de r√©utiliser la logique d'√©tat sans changer la hi√©rarchie des composants.  Cela facilite l'√©change de liens entre de nombreux composants ou l'ensemble du syst√®me.  En outre, les composants de classe semblent assez effrayants, nous d√©crivons les m√©thodes de cycle de vie de <code>componentDidMount</code> / <code>shouldComponentUpdate</code> / <code>componentDidUpdate</code> , l'√©tat du composant, cr√©ez des m√©thodes pour travailler avec l'√©tat / c√¥t√©, liez des m√©thodes pour l'instance de composant, et ainsi de suite.  En r√®gle g√©n√©rale, ces composants vont au-del√† de x lignes, o√π x est assez difficile √† comprendre. </p><br><p>  Les crochets vous permettent de faire de m√™me en brisant la logique entre les composants en petites fonctions et en les utilisant √† l'int√©rieur des composants. </p><br><h3 id="klassy-slozhny-dlya-lyudey-i-dlya-mashin">  Les cours sont difficiles pour les gens et pour les voitures </h3><br><p>  L'observation des cours Facebook est un gros obstacle lors de l'apprentissage de React.  Vous devez comprendre comment <code>this</code> fonctionne, et cela ne fonctionne pas comme dans d'autres langages de programmation, vous devez √©galement vous rappeler de lier les gestionnaires d'√©v√©nements.  Sans phrases de syntaxe stables, le code semble tr√®s verbeux.  Les gens comprennent les accessoires / mod√®les d'√©tat et le flux de donn√©es dit descendant, mais les classes sont assez difficiles √† comprendre. </p><br><p>  Surtout si ce n'est pas limit√© aux mod√®les, il n'y a pas si longtemps, les gars de la r√©action ont exp√©riment√© la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">disposition des composants</a> avec Prepack et ont vu des r√©sultats prometteurs, mais n√©anmoins, les composants de la classe vous permettent de cr√©er de mauvais mod√®les involontaires qui font dispara√Ætre ces optimisations, les classes ne migrent pas non plus tr√®s bien quand Les classes de rechargement √† chaud le rendent peu fiable.  Tout d'abord, les gars voulaient fournir une API qui prend en charge toutes les optimisations et fonctionne bien avec un red√©marrage √† chaud. </p><br><h3 id="glyanem-na-huki">  Jetez un ≈ìil aux crochets </h3><br><h4 id="state-hook">  Crochet d'√©tat </h4><br><p>  Le code ci-dessous rend un paragraphe et un bouton, et si nous cliquons sur le bouton, la valeur du paragraphe sera incr√©ment√©e. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Declare a new state variable, which we'll call "count" const [count, setCount] = useState(0); return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;/div&gt; ); }</span></span></code> </pre> <br><p>  De cela, nous pouvons conclure que ce crochet fonctionne de mani√®re similaire avec un concept tel que l' <code>state</code> . <br>  Une m√©thode <code>useState</code> un peu plus d√©taill√©e prend un argument, il s'agit de la valeur par d√©faut et retourne un tuple dans lequel se trouve la valeur elle-m√™me et la m√©thode pour la changer, contrairement √† setState, setCount ne <em>fusionnera</em> pas les valeurs, mais les mettra simplement √† jour.  Nous pouvons √©galement utiliser plusieurs d√©clarations d'√©tat, par exemple: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ExampleWithManyStates</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Declare multiple state variables! const [age, setAge] = useState(42); const [fruit, setFruit] = useState('banana'); const [todos, setTodos] = useState([{ text: 'Learn Hooks' }]); // ... }</span></span></code> </pre> <br><p>  Ainsi, nous cr√©ons plusieurs √©tats √† la fois et nous n'avons pas besoin de r√©fl√©chir √† la fa√ßon de les d√©composer d'une mani√®re ou d'une autre.  Ainsi, on peut distinguer que les hooks sont des fonctions qui vous permettent de "vous connecter" aux puces des composants de classe, tout comme les hooks ne fonctionnent pas √† l'int√©rieur des classes, il est important de s'en souvenir. </p><br><h4 id="effect-hook">  Crochet d'effet </h4><br><p>  Souvent dans les composants de classe, nous faisons des fonctions d'effets secondaires, par exemple, souscrivez √† des √©v√©nements ou faites des demandes de donn√©es, g√©n√©ralement pour cela, nous utilisons les m√©thodes <code>componentDidMount</code> / <code>componentDidUpdate</code> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">// Similar to componentDidMount and componentDidUpdate: useEffect(() =&gt; { // Update the document title using the browser API document.title = `You clicked ${count} times`; }); return ( &lt;div&gt; &lt;p&gt;You clicked {count} times&lt;/p&gt; &lt;button onClick={() =&gt; setCount(count + 1)}&gt; Click me &lt;/button&gt; &lt;/div&gt; ); }</span></span></code> </pre> <br><p>  Lorsque nous appelons <code>useEffect</code> nous disons √† la r√©action de faire un ¬´effet secondaire¬ª apr√®s la mise √† jour des modifications dans l'arborescence DOM.  Les effets sont d√©clar√©s √† l'int√©rieur du composant, ils ont donc acc√®s aux accessoires / √©tat.  Et nous pouvons les cr√©er exactement de la m√™me mani√®re que nous le souhaitons. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FriendStatusWithCounter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [count, setCount] = useState(<span class="hljs-number"><span class="hljs-number">0</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.title = <span class="hljs-string"><span class="hljs-string">`You clicked </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${count}</span></span></span><span class="hljs-string"> times`</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [isOnline, setIsOnline] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { ChatAPI.subscribeToFriendStatus(props.friend.id, handleStatusChange); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { ChatAPI.unsubscribeFromFriendStatus(props.friend.id, handleStatusChange); }; }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleStatusChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ setIsOnline(status.isOnline); } <span class="hljs-comment"><span class="hljs-comment">// ...</span></span></code> </pre> <br><p>  Imm√©diatement, il convient de pr√™ter attention au deuxi√®me effet secondaire, nous renvoyons la fonction, nous le faisons afin d'effectuer certaines actions apr√®s que le composant a effectu√© le d√©montage, dans la nouvelle API, cela s'appelle les effets avec le nettoyage.  D'autres effets peuvent renvoyer n'importe quoi. </p><br><h3 id="pravila-hukov">  R√®gles de crochet </h3><br><p>  Les crochets ne sont que des fonctions javascript, mais ils ne n√©cessitent que deux r√®gles: </p><br><ul><li>  Les hooks doivent √™tre ex√©cut√©s tout en haut de la hi√©rarchie des fonctions (cela signifie que vous ne devez pas appeler de hooks dans des conditions et des boucles, sinon la r√©action ne peut pas garantir l'ordre d'ex√©cution des hooks) </li><li>  Appeler les hooks uniquement dans les fonctions React ou les composants fonctionnels ou appeler les hooks √† partir de hooks personnalis√©s (ci-dessous). <br>  Pour suivre ces r√®gles, les gars de l'√©quipe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">React ont</a> cr√©√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plugin linter</a> qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">g√©n√©rera une</a> erreur si vous appelez des hooks dans des composants de classe ou dans des boucles et des conditions. </li></ul><br><h3 id="kastomnye-huki">  Crochets personnalis√©s </h3><br><p>  Dans le m√™me temps, nous voulons r√©utiliser la logique des composants avec √©tat, g√©n√©ralement des mod√®les HOC ou des accessoires de rendu sont utilis√©s pour cela, mais ils cr√©ent un volume suppl√©mentaire de notre application. <br>  Par exemple, nous d√©crivons la fonction suivante: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">useFriendStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">friendID</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [isOnline, setIsOnline] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleStatusChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">status</span></span></span><span class="hljs-function">) </span></span>{ setIsOnline(status.isOnline); } useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange); }; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isOnline; }</code> </pre> <br><p>  R√©alisez ce code, ce sera un hook personnalis√© que nous pourrons appeler dans diff√©rents composants.  Par exemple, comme ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FriendStatus</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isOnline = useFriendStatus(props.friend.id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isOnline === <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Loading...'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isOnline ? <span class="hljs-string"><span class="hljs-string">'Online'</span></span> : <span class="hljs-string"><span class="hljs-string">'Offline'</span></span>; }</code> </pre> <br><p>  ou alors </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FriendListItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> isOnline = useFriendStatus(props.friend.id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">color:</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">isOnline</span></span></span></span><span class="xml"><span class="hljs-tag"> ? '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">green</span></span></span></span><span class="xml"><span class="hljs-tag">' </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">:</span></span></span></span><span class="xml"><span class="hljs-tag"> '</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">black</span></span></span></span><span class="xml"><span class="hljs-tag">' }}&gt;</span></span></span><span class="xml"> {props.friend.name} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">li</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); }</code> </pre> <br><p>  Dans tous les cas, nous r√©utilisons l'√©tat du composant, chaque appel √† la fonction <code>useFriendStatus</code> cr√©e un √©tat isol√©.  Il convient √©galement de noter que le d√©but de cette fonction commence par l' <em>utilisation</em> du mot, ce qui signifie qu'il s'agit d'un crochet.  Nous vous recommandons de suivre ce format.  Vous pouvez √©crire des crochets personnalis√©s pour tout, des animations / abonnements / minuteurs et bien plus encore. </p><br><p>  Il y a encore quelques crochets. </p><br><h4 id="usecontext">  useContext </h4><br><p>  <code>useContext</code> vous permet d'utiliser la valeur de retour habituelle au lieu de renderProps, le contexte que nous voulons y r√©cup√©rer et il nous le rendra, afin que nous puissions nous d√©barrasser de tous les HOC qui ont pass√© le contexte aux accessoires. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Example</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> locale = useContext(LocaleContext); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> theme = useContext(ThemeContext); <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Et maintenant, nous pouvons simplement utiliser l'objet contextuel dans la valeur de retour. </p><br><h4 id="usecallback">  useCallback </h4><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> memoizedCallback = useCallback( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { doSomething(a, b); }, [a, b], );</code> </pre> <br><p>  √Ä quelle fr√©quence avez-vous d√ª cr√©er un composant d'une classe juste pour enregistrer une r√©f√©rence √† une m√©thode?  Cela n'a plus besoin d'√™tre fait, nous pouvons utiliser useCallback et nos composants ne seront pas redessin√©s car un nouveau lien vers onClick est arriv√©. </p><br><h4 id="usememo">  useMemo </h4><br><p>  Nous retournons la valeur m√©moris√©e, la valeur m√©moris√©e signifie qu'elle est calcul√©e uniquement lorsque l'un des arguments a chang√©, la deuxi√®me fois la m√™me chose ne sera pas calcul√©e. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> memoizedValue = useMemo(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> computeExpensiveValue(a, b), [a, b]);</code> </pre> <br><p>  Oui, ici, vous devez dupliquer les valeurs dans le tableau afin que le crochet comprenne qu'elles n'ont pas chang√©. </p><br><h4 id="useref">  useRef </h4><br><p>  <code>useRef</code> renvoie une valeur mut√©e, o√π le champ <code>.current</code> sera initialis√© avec le premier argument, l'objet existera tant que le composant existera. <br>  L'exemple le plus courant en se concentrant sur l'entr√©e </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TextInputWithFocusButton</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> inputEl = useRef(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onButtonClick = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">// `current` points to the mounted text input element inputEl.current.focus(); }; return ( &lt;&gt; &lt;input ref={inputEl} type="text" /&gt; &lt;button onClick={onButtonClick}&gt;Focus the input&lt;/button&gt; &lt;/&gt; ); }</span></span></code> </pre> <br><h4 id="useimperativemethods">  useImperativeMethods </h4><br><p>  <code>useImperativeMethods</code> personnalise la valeur de l'instance transmise par le parent et utilise ref directement.  Comme toujours, les liens directs doivent √™tre √©vit√©s et <code>forwardRef</code> doit √™tre utilis√© </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FancyInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props, ref</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> inputRef = useRef(); useImperativeMethods(ref, () =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ focus: (</span></span></span><span class="hljs-function">) =&gt;</span></span> { inputRef.current.focus(); } })); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">input</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{inputRef}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; } FancyInput = forwardRef(FancyInput);</span></span></code> </pre> <br><p>  Dans cet exemple, le composant qui <code>FancyInput</code> peut appeler <code>fancyInputRef.current.focus()</code> . </p><br><h4 id="usemutationeffect">  useMutationEffect </h4><br><p>  <code>useMutationEffect</code> tr√®s similaire √† <code>useEffect</code> sauf qu'il d√©marre de mani√®re synchrone au stade o√π la r√©action modifie les valeurs DOM avant la mise √† jour des composants voisins, ce hook doit √™tre utilis√© pour effectuer des mutations DOM. <br>  Il est pr√©f√©rable de pr√©f√©rer useEffect pour √©viter le blocage des changements visuels. </p><br><h4 id="uselayouteffect">  useLayoutEffect </h4><br><p>  <code>useLayoutEffect</code> est similaire √† <code>useEffect</code> sauf qu'il s'ex√©cute de mani√®re synchrone <em>apr√®s toutes les mises √† jour DOM</em> et le nouveau rendu synchrone.  Les mises √† jour pr√©vues dans <code>useLayoutEffect</code> sont appliqu√©es de mani√®re synchrone avant que le navigateur puisse dessiner des √©l√©ments.  Vous devez √©galement essayer d'utiliser le <code>useEffect</code> standard afin de ne pas bloquer les modifications visuelles. </p><br><h4 id="usereducer">  useReducer </h4><br><p>  <code>useReducer</code> est un crochet pour cr√©er un r√©ducteur qui renvoie l'√©tat et la possibilit√© de distribuer les modifications: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = useReducer(reducer, initialState);</code> </pre> <br><p>  Si vous comprenez comment fonctionne Redux, vous comprenez comment fonctionne <code>useReducer</code> .  Le m√™me exemple qui √©tait avec le compteur ci-dessus uniquement via <code>useReducer</code> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'reset'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> initialState; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'increment'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: state.count + <span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'decrement'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: state.count - <span class="hljs-number"><span class="hljs-number">1</span></span>}; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{initialCount}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = useReducer(reducer, initialState); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;&gt; Count: {state.count} &lt;button onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'reset'</span></span>})}&gt; Reset &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; &lt;button onClick={() =&gt; dispatch({type: 'increment'})}&gt;+&lt;/</span></span>button&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> dispatch({type: 'decrement'})}&gt;-</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/&gt; ); }</span></span></code> </pre> <br><p>  UseReducer prend √©galement 3 arguments, c'est l' <code>action</code> qui doit √™tre ex√©cut√©e lors de l'initialisation du r√©ducteur: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'reset'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: action.payload}; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'increment'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: state.count + <span class="hljs-number"><span class="hljs-number">1</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'decrement'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">count</span></span>: state.count - <span class="hljs-number"><span class="hljs-number">1</span></span>}; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Counter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{initialCount}</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = useReducer( reducer, initialState, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'reset'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: initialCount}, ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;&gt; Count: {state.count} &lt;button onClick={(</span></span></span><span class="hljs-function">) =&gt;</span></span> dispatch({<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'reset'</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: initialCount})}&gt; Reset &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; &lt;button onClick={() =&gt; dispatch({type: 'increment'})}&gt;+&lt;/</span></span>button&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">onClick</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{()</span></span></span></span><span class="xml"><span class="hljs-tag"> =&gt;</span></span></span><span class="xml"> dispatch({type: 'decrement'})}&gt;-</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">button</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/&gt; ); }</span></span></code> </pre> <br><p>  Nous pouvons √©galement cr√©er un contexte dans ce r√©ducteur et l'utiliser via le hook <code>useContext</code> utiliser tout au long de l'application, cela reste pour les devoirs. </p><br><h4 id="podvodya-itog">  Pour r√©sumer </h4><br><p>  Les crochets sont une approche assez puissante pour r√©soudre l'enfer et r√©soudre plusieurs probl√®mes, mais tous peuvent √™tre utilis√©s avec la m√™me d√©finition de <em>transfert</em> de <em>lien</em> .  D√©j√† maintenant commencent √† appara√Ætre des collections de crochets <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† utiliser</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">cette collection</a> .  Vous pouvez en savoir plus sur les hooks dans la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428317/">https://habr.com/ru/post/fr428317/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428305/index.html">√âtudiez-vous l'anglais? Des bandes dessin√©es √† la rescousse</a></li>
<li><a href="../fr428307/index.html">Java Challengers # 1: surcharge de m√©thode dans la machine virtuelle Java</a></li>
<li><a href="../fr428311/index.html">TrustZone: OS de confiance et ses applications</a></li>
<li><a href="../fr428313/index.html">Telegram sur MacOS [vraisemblablement] stocke √©galement localement la correspondance sous une forme accessible</a></li>
<li><a href="../fr428315/index.html">5 peurs des d√©veloppeurs que nous avons surmont√©es</a></li>
<li><a href="../fr428321/index.html">Analyse pr√©dictive des donn√©es - mod√©lisation et validation</a></li>
<li><a href="../fr428327/index.html">Que rechercher: R√®glement europ√©en sur l'identification √©lectronique eIDAS</a></li>
<li><a href="../fr428329/index.html">Formation de renforcement: analyse des jeux vid√©o</a></li>
<li><a href="../fr428333/index.html">R√©sultats du Hackathon AI RAIF Hackathon 2018</a></li>
<li><a href="../fr428335/index.html">Mise √† jour du raccourci Siri</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>