<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>â—€ï¸ ğŸ‘©â€ğŸ³ ğŸ‘¨ğŸ»â€ğŸŒ¾ å‡çº§IDA Proã€‚ æˆ‘ä»¬ä¿®å¤å¤„ç†å™¨æ¨¡å—çš„è¾¹æ¡† ğŸ˜‚ ğŸ¤›ğŸ½ ğŸ‘š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¤§å®¶å¥½ 


 è‡ªæ’°å†™ç¬¬ä¸€ç¯‡æ–‡ç« ä»¥æ¥å·²ç»æœ‰ç›¸å½“é•¿çš„æ—¶é—´äº†ï¼Œå°½ç®¡æœ‰ä¸€ç‚¹ç‚¹æˆ‘è¿˜æ˜¯å†³å®šå†™ä¸€äº›å…³äºä¿®æ”¹/æ”¹è¿›IDA Proçš„æ–‡ç«  ã€‚ 


 æœ¬æ–‡å°†è®¨è®ºå¦‚ä½•æ­£ç¡®ä¿®å¤é‚£äº›å¤„ç†å™¨æ¨¡å—ä¸­çš„è¾¹æ¡†ï¼Œè¿™äº›å¤„ç†å™¨æ¨¡å—çš„æ¥æºä¸å¤šï¼Œä½†è¿™äº›è¾¹æ¡†å´æ— æ³•è§£å†³ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå¹¶éä¸‹é¢åˆ—å‡ºçš„æ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥å½’å› äºå¤–æ¡†ï¼Œå› æ­¤å¼€å‘äººå‘˜ä¸å¤ªå¯èƒ½...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å‡çº§IDA Proã€‚ æˆ‘ä»¬ä¿®å¤å¤„ç†å™¨æ¨¡å—çš„è¾¹æ¡†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pt/blog/424263/"><p><img src="https://habrastorage.org/webt/ew/v2/2v/ewv22vcc4kkpbzrvgthcwqwbge4.png"></p><br><p> å¤§å®¶å¥½ </p><br><p> è‡ªæ’°å†™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬ä¸€ç¯‡æ–‡ç« </a>ä»¥æ¥å·²ç»æœ‰ç›¸å½“é•¿çš„æ—¶é—´äº†ï¼Œå°½ç®¡æœ‰ä¸€ç‚¹ç‚¹æˆ‘è¿˜æ˜¯å†³å®šå†™ä¸€äº›å…³äºä¿®æ”¹/æ”¹è¿›<strong>IDA Proçš„æ–‡ç« </strong> ã€‚ </p><br><p> æœ¬æ–‡å°†è®¨è®ºå¦‚ä½•æ­£ç¡®ä¿®å¤é‚£äº›å¤„ç†å™¨æ¨¡å—ä¸­çš„è¾¹æ¡†ï¼Œè¿™äº›å¤„ç†å™¨æ¨¡å—çš„æ¥æºä¸å¤šï¼Œä½†è¿™äº›è¾¹æ¡†å´æ— æ³•è§£å†³ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œå¹¶éä¸‹é¢åˆ—å‡ºçš„æ‰€æœ‰é—®é¢˜éƒ½å¯ä»¥å½’å› äºå¤–æ¡†ï¼Œå› æ­¤å¼€å‘äººå‘˜ä¸å¤ªå¯èƒ½å®ç°å®ƒä»¬ã€‚ <a name="habracut"></a></p><br><h2 id="lokalizuem-bagi"> æˆ‘ä»¬æœ¬åœ°åŒ–é”™è¯¯ </h2><br><p> æ³¨æ„ï¼šä»¥ä¸‹å°†è€ƒè™‘<em>Motorola M68000</em>æ¨¡å—ä¸­çš„é”™è¯¯ï¼ˆæˆ‘æœ€å–œæ¬¢å¹¶ä¸”ç»å¸¸ä½¿ç”¨ï¼‰ã€‚ </p><br><p>å› æ­¤ï¼Œç¬¬<u>ä¸€ä¸ªä¸èƒ½</u> ï¼šç›¸å¯¹äº<em>PC</em>å¯„å­˜å™¨çš„å¯»å€ã€‚ é”™è¯¯æ˜¯è¿™äº›è¯´æ˜çš„åæ±‡ç¼–æ¸…å•å¹¶ä¸æ€»æ˜¯æ­£ç¡®çš„ã€‚ çœ‹ä¸€ä¸‹å±å¹•æˆªå›¾ï¼š <br><img src="https://habrastorage.org/webt/ei/5j/rv/ei5jrvslehyigbplu8dpxxycxua.png"><br> è¿™é‡Œä¼¼ä¹æ²¡æœ‰é”™è¯¯ã€‚ è€Œä¸”ï¼Œå®ƒçš„å­˜åœ¨ä¸ä¼šå¹²æ‰°åˆ†æã€‚ ä½†æ˜¯ï¼Œæ“ä½œç æœªæ­£ç¡®æ±‡ç¼–ã€‚ è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¸€äº›åœ¨çº¿åæ±‡ç¼–ç¨‹åºä¸­çš„å¼‚å¸¸ï¼š <br><img src="https://habrastorage.org/webt/vm/dd/wn/vmddwnrstyww2lzjmuy3zmfppaa.png"><br> æˆ‘ä»¬çœ‹åˆ°å¯»å€åº”è¯¥ç›¸å¯¹äº<em>PC</em>å¯„å­˜å™¨ï¼Œå› ä¸º é“¾æ¥ç›®æ ‡åœ°å€åœ¨å¸¦<code>signed short</code>èŒƒå›´å†…ã€‚ </p><br><p>  <u>ç¬¬äºŒå¥</u> ï¼šRAMå’Œå…¶ä»–ä¸€äº›åŒºåŸŸçš„â€œé•œåƒâ€ã€‚ å› ä¸º ç”±äº<em>m68kä¸­</em>çš„å¯»å€<em>æ˜¯</em> 24ä½çš„ï¼Œå› æ­¤æ‰€æœ‰å¯¹è¾ƒé«˜åŒºåŸŸï¼ˆåä¹‹äº¦ç„¶ï¼Œè¾ƒä½åŒºåŸŸï¼‰çš„è°ƒç”¨éƒ½å¿…é¡»é‡å®šå‘åˆ°ä¸äº¤å‰å¼•ç”¨ç›¸åŒçš„èŒƒå›´ã€‚ </p><br><p>  <u>å…±æœ‰ä¸‰ç§æƒ…å†µ</u> ï¼ˆå®å¯ï¼Œç”šè‡³æ²¡æœ‰ï¼Œä½†ç¼ºä¹åŠŸèƒ½ï¼‰ï¼šæ‰€è°“çš„<strong>lineA</strong> ï¼ˆ <em>1010</em> ï¼‰å’Œ<strong>lineF</strong> ï¼ˆ <em>1111</em> ï¼‰ä»¿çœŸå™¨ã€‚ è¿™äº›æ“ä½œç æ²¡æœ‰åŸºæœ¬çš„å‘½ä»¤é›†ï¼Œå› æ­¤å¿…é¡»é€šè¿‡ä¸­æ–­å‘é‡ä»¥ç‰¹æ®Šæ–¹å¼å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚ æ“ä½œç çš„å¤§å°ä»…å–å†³äºå¤„ç†å™¨çº§åˆ«çš„å®ç°ã€‚ æˆ‘åªçœ‹åˆ°äº†ä¸¤ä¸ªå­—èŠ‚çš„å®ç°ã€‚ æˆ‘ä»¬å°†æ·»åŠ ã€‚ </p><br><p>  <u>å¡çº¸å››</u> ï¼š <strong>é™·é˜±#N</strong>æŒ‡ä»¤ä¸ç»™é’©å­æœ¬èº«æä¾›<em>å¼•ç”¨</em> ã€‚ </p><br><p>  <u>é—¨æ¡†äº”</u> ï¼š <strong>movea.w</strong>æŒ‡ä»¤åº”ä»<em>å­—</em>é“¾æ¥å¯¹åœ°å€è¿›è¡Œå®Œæ•´çš„<em>å¤–éƒ¨å‚ç…§</em> ï¼Œä½†æˆ‘ä»¬åªæœ‰<em>å­—å·</em> ã€‚ </p><br><h2 id="ispravlyaem-bagi-shablon"> æˆ‘ä»¬ä¿®å¤é”™è¯¯ï¼ˆæ¨¡æ¿ï¼‰ </h2><br><p> ä¸ºäº†äº†è§£å¦‚ä½•ä¿®å¤ç‰¹å®šçš„å¤„ç†å™¨æ¨¡å—ï¼Œæ‚¨éœ€è¦äº†è§£æˆ‘ä»¬åœ¨è¯¥ä¸»é¢˜ä¸ŠåŸåˆ™ä¸Šå…·æœ‰å“ªäº›å¯èƒ½æ€§ä»¥åŠä»€ä¹ˆæ„æˆâ€œä¿®å¤â€ã€‚ </p><br><p> å®é™…ä¸Šï¼Œâ€œä¿®å¤ç¨‹åºâ€æ˜¯ä¸€ä¸ªæ™®é€šçš„æ’ä»¶ã€‚ å®ƒæœ‰ç‚¹åƒå¯ä»¥ç”¨<em>Python</em>ç¼–å†™ï¼Œä½†æ˜¯æˆ‘åšäº†æ‰€æœ‰çš„â€œåŠ â€æ“ä½œã€‚ åªæœ‰å¯ç§»æ¤æ€§å—åˆ°å½±å“ï¼Œä½†æ˜¯å¦‚æœæœ‰äººæ‰¿è¯ºç”¨<em>Python</em>é‡å†™è¯¥æ’ä»¶ï¼Œæˆ‘å°†éå¸¸æ„Ÿæ¿€ã€‚ </p><br><p> é¦–å…ˆï¼Œåœ¨<em>Visual Studioä¸­</em>åˆ›å»ºä¸€ä¸ªç©ºçš„<em>DLL</em>é¡¹ç›®ï¼š <em>æ–‡ä»¶-&gt;æ–°å»º-&gt;é¡¹ç›®-&gt; Windowsæ¡Œé¢å‘å¯¼-&gt;åŠ¨æ€é“¾æ¥åº“</em> ï¼ˆ.dllï¼‰ï¼Œä¹Ÿé€šè¿‡é€‰ä¸­<em>ç©ºé¡¹ç›®</em> <em>å¤é€‰æ¡†å¹¶å–æ¶ˆé€‰ä¸­</em>å…¶ä½™éƒ¨åˆ†ï¼š <br><img src="https://habrastorage.org/webt/ni/eg/ak/niegakemj47gtfsgva9kldhywou.png"></p><br><p> è§£å‹ç¼©<em>IDA SDK</em>å¹¶å°†å…¶å†™å…¥<em>Visual Studio</em>å®ï¼ˆæˆ‘å°†ä½¿ç”¨<em>2017</em> ï¼‰ï¼Œä»¥ä¾¿å°†æ¥æ‚¨å¯ä»¥è½»æ¾å¼•ç”¨å®ƒã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬å°†ä¸º<em>IDA Pro</em>çš„è·¯å¾„æ·»åŠ ä¸€ä¸ªå®ã€‚ </p><br><p> è½¬åˆ°<em>æŸ¥çœ‹</em> -&gt; <em>å…¶ä»–Windows-</em> &gt; <em>åª’ä½“èµ„æºç®¡ç†å™¨</em> ï¼š <br><img src="https://habrastorage.org/webt/59/de/41/59de412a0dc50466086740.png"></p><br><p> å› ä¸º æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨<em>SDK</em>ç‰ˆæœ¬<em>7.0</em> ï¼Œå°†é€šè¿‡<em>x64-</em>ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ã€‚ å› æ­¤ï¼Œé€‰æ‹©<em>Debug |ã€‚</em>  <em>x64-</em> &gt; <em>Microsoft.Cpp.x64.user-</em> &gt; <em>å±æ€§</em> ï¼š <br><img src="https://habrastorage.org/webt/59/de/42/59de423c59c08942765331.png"></p><br><p> å•å‡»â€œ <em>ç”¨æˆ·å®â€</em>éƒ¨åˆ†ä¸­çš„â€œ <em>æ·»åŠ å®â€</em>æŒ‰é’®ï¼Œç„¶ååœ¨å…¶ä¸­å°†<strong>IDA_SDK</strong>å®ä¸è§£å‹ç¼©<em>SDK</em>çš„è·¯å¾„ä¸€èµ·å†™å…¥å…¶ä¸­ï¼š <br><img src="https://habrastorage.org/webt/59/de/43/59de43354eef5656763373.png"></p><br><p> æˆ‘ä»¬å¯¹<strong>IDA_DIR</strong> ï¼ˆæ‚¨çš„<em>IDA Pro</em>çš„è·¯å¾„ï¼‰æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼š <br><img src="https://habrastorage.org/webt/59/de/43/59de4393df765196799873.png"><br> æˆ‘æ³¨æ„åˆ°<em>IDA</em>é»˜è®¤è®¾ç½®ä¸º<em>ï¼…Program Filesï¼…</em> ï¼Œè¿™éœ€è¦ç®¡ç†å‘˜æƒé™ã€‚ </p><br><p> æˆ‘ä»¬è¿˜è¦åˆ é™¤<em>Win32</em>é…ç½®ï¼ˆåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä¸ä¼šå½±å“<em>x86</em>ç³»ç»Ÿçš„ç¼–è¯‘ï¼‰ï¼Œä»…ä¿ç•™<em>x64</em>é€‰é¡¹ã€‚ </p><br><p> åˆ›å»ºä¸€ä¸ªç©ºçš„<strong>ida_plugin.cpp</strong>æ–‡ä»¶ã€‚ æˆ‘ä»¬å°šæœªæ·»åŠ ä»£ç ã€‚ <br> ç°åœ¨å¯ä»¥è®¾ç½®<em>C ++</em>çš„ç¼–ç å’Œå…¶ä»–è®¾ç½®ï¼š <br><img src="https://habrastorage.org/webt/py/y5/hr/pyy5hrmaodnyg88lqx_nzdtnlfi.png"></p><br><p><img src="https://habrastorage.org/webt/fk/xc/hp/fkxchpgi2jaige5obcmrnupxtny.png"></p><br><p><img src="https://habrastorage.org/webt/_l/tk/wf/_ltkwfmoex1we-lss1o4z8b4bzy.png"></p><br><p> æˆ‘ä»¬ç¼–å†™åŒ…å«ï¼š <br><img src="https://habrastorage.org/webt/4j/wg/v1/4jwgv1u0h3-_tyy_jhzix5cevkk.png"></p><br><p> ä»¥åŠæ¥è‡ª<em>SDKçš„</em>åº“ï¼š <br><img src="https://habrastorage.org/webt/hl/yl/pl/hlylplttumswxacaiw7s8cgxnmg.png"></p><br><p><img src="https://habrastorage.org/webt/yv/vw/az/yvvwaz3lccmj-srbihmk7e3psq8.png"></p><br><p> ç°åœ¨æ·»åŠ ä»£ç æ¨¡æ¿ï¼š </p><br><div class="spoiler">  <b class="spoiler_title">Ida_plugin.cppä»£ç </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;ida.hpp&gt; #include &lt;idp.hpp&gt; #include &lt;ua.hpp&gt; #include &lt;bytes.hpp&gt; #include &lt;loader.hpp&gt; #include &lt;offset.hpp&gt; #define NAME "M68000 proc-fixer plugin" #define VERSION "1.0" static bool plugin_inited; static bool my_dbg; //-------------------------------------------------------------------------- static void print_version() { static const char format[] = NAME " v%s\n"; info(format, VERSION); msg(format, VERSION); } //-------------------------------------------------------------------------- static bool init_plugin(void) { if (ph.id != PLFM_68K) return false; return true; } #ifdef _DEBUG static const char* const optype_names[] = { "o_void", "o_reg", "o_mem", "o_phrase", "o_displ", "o_imm", "o_far", "o_near", "o_idpspec0", "o_idpspec1", "o_idpspec2", "o_idpspec3", "o_idpspec4", "o_idpspec5", }; static const char* const dtyp_names[] = { "dt_byte", "dt_word", "dt_dword", "dt_float", "dt_double", "dt_tbyte", "dt_packreal", "dt_qword", "dt_byte16", "dt_code", "dt_void", "dt_fword", "dt_bitfild", "dt_string", "dt_unicode", "dt_3byte", "dt_ldbl", "dt_byte32", "dt_byte64", }; static void print_insn(const insn_t *insn) { if (my_dbg) { msg("cs=%x, ", insn-&gt;cs); msg("ip=%x, ", insn-&gt;ip); msg("ea=%x, ", insn-&gt;ea); msg("itype=%x, ", insn-&gt;itype); msg("size=%x, ", insn-&gt;size); msg("auxpref=%x, ", insn-&gt;auxpref); msg("segpref=%x, ", insn-&gt;segpref); msg("insnpref=%x, ", insn-&gt;insnpref); msg("insnpref=%x, ", insn-&gt;insnpref); msg("flags["); if (insn-&gt;flags &amp; INSN_MACRO) msg("INSN_MACRO|"); if (insn-&gt;flags &amp; INSN_MODMAC) msg("OF_OUTER_DISP"); msg("]\n"); } } static void print_op(ea_t ea, const op_t *op) { if (my_dbg) { msg("type[%s], ", optype_names[op-&gt;type]); msg("flags["); if (op-&gt;flags &amp; OF_NO_BASE_DISP) msg("OF_NO_BASE_DISP|"); if (op-&gt;flags &amp; OF_OUTER_DISP) msg("OF_OUTER_DISP|"); if (op-&gt;flags &amp; PACK_FORM_DEF) msg("PACK_FORM_DEF|"); if (op-&gt;flags &amp; OF_NUMBER) msg("OF_NUMBER|"); if (op-&gt;flags &amp; OF_SHOW) msg("OF_SHOW"); msg("], "); msg("dtyp[%s], ", dtyp_names[op-&gt;dtype]); if (op-&gt;type == o_reg) msg("reg=%x, ", op-&gt;reg); else if (op-&gt;type == o_displ || op-&gt;type == o_phrase) msg("phrase=%x, ", op-&gt;phrase); else msg("reg_phrase=%x, ", op-&gt;phrase); msg("addr=%x, ", op-&gt;addr); msg("value=%x, ", op-&gt;value); msg("specval=%x, ", op-&gt;specval); msg("specflag1=%x, ", op-&gt;specflag1); msg("specflag2=%x, ", op-&gt;specflag2); msg("specflag3=%x, ", op-&gt;specflag3); msg("specflag4=%x, ", op-&gt;specflag4); msg("refinfo["); opinfo_t buf; if (get_opinfo(&amp;buf, ea, op-&gt;n, op-&gt;flags)) { msg("target=%x, ", buf.ri.target); msg("base=%x, ", buf.ri.base); msg("tdelta=%x, ", buf.ri.tdelta); msg("flags["); if (buf.ri.flags &amp; REFINFO_TYPE) msg("REFINFO_TYPE|"); if (buf.ri.flags &amp; REFINFO_RVAOFF) msg("REFINFO_RVAOFF|"); if (buf.ri.flags &amp; REFINFO_PASTEND) msg("REFINFO_PASTEND|"); if (buf.ri.flags &amp; REFINFO_CUSTOM) msg("REFINFO_CUSTOM|"); if (buf.ri.flags &amp; REFINFO_NOBASE) msg("REFINFO_NOBASE|"); if (buf.ri.flags &amp; REFINFO_SUBTRACT) msg("REFINFO_SUBTRACT|"); if (buf.ri.flags &amp; REFINFO_SIGNEDOP) msg("REFINFO_SIGNEDOP"); msg("]"); } msg("]\n"); } } #endif static bool ana_addr = 0; static ssize_t idaapi hook_idp(void *user_data, int notification_code, va_list va) { switch (notification_code) { case processor_t::ev_ana_insn: { insn_t *out = va_arg(va, insn_t*); if (ana_addr) break; ana_addr = 1; if (ph.ana_insn(out) &lt;= 0) { ana_addr = 0; break; } ana_addr = 0; #ifdef _DEBUG print_insn(out); #endif for (int i = 0; i &lt; UA_MAXOP; ++i) { op_t &amp;op = out-&gt;ops[i]; #ifdef _DEBUG print_op(out-&gt;ea, &amp;op); #endif } return out-&gt;size; } break; case processor_t::ev_emu_insn: { const insn_t *insn = va_arg(va, const insn_t*); } break; case processor_t::ev_out_mnem: { outctx_t *outbuffer = va_arg(va, outctx_t *); //outbuffer-&gt;out_custom_mnem(mnem); //return 1; } break; default: { #ifdef _DEBUG if (my_dbg) { msg("msg = %d\n", notification_code); } #endif } break; } return 0; } //-------------------------------------------------------------------------- static int idaapi init(void) { if (init_plugin()) { plugin_inited = true; my_dbg = false; hook_to_notification_point(HT_IDP, hook_idp, NULL); print_version(); return PLUGIN_KEEP; } return PLUGIN_SKIP; } //-------------------------------------------------------------------------- static void idaapi term(void) { if (plugin_inited) { unhook_from_notification_point(HT_IDP, hook_idp); plugin_inited = false; } } //-------------------------------------------------------------------------- static bool idaapi run(size_t /*arg*/) { return false; } //-------------------------------------------------------------------------- const char comment[] = NAME; const char help[] = NAME; //-------------------------------------------------------------------------- // // PLUGIN DESCRIPTION BLOCK // //-------------------------------------------------------------------------- plugin_t PLUGIN = { IDP_INTERFACE_VERSION, PLUGIN_PROC | PLUGIN_MOD, // plugin flags init, // initialize term, // terminate. this pointer may be NULL. run, // invoke plugin comment, // long comment about the plugin // it could appear in the status line // or as a hint help, // multiline help about the plugin NAME, // the preferred short name of the plugin "" // the preferred hotkey to run the plugin };</span></span></span></span></code> </pre> </div></div><br><h2 id="ispravlyaem-bagi-razbiraemsya-v-shablone"> æˆ‘ä»¬ä¿®å¤äº†é”™è¯¯ï¼ˆæˆ‘ä»¬äº†è§£äº†æ¨¡æ¿ï¼‰ </h2><br><p> éœ€è¦å‡½æ•°<code>print_op()</code>å’Œ<code>print_insn()</code>æ¥äº†è§£å½“å‰å¤„ç†å™¨æ¨¡å—ä¸ºæŸäº›æŒ‡ä»¤è®¾ç½®çš„æ ‡å¿—ã€‚ å¦‚æœæˆ‘ä»¬è¦ä¸ºç°æœ‰æ“ä½œç æ‰¾åˆ°ä¸€äº›æ ‡å¿—ï¼Œç„¶ååœ¨ä¿®å¤æ—¶ä½¿ç”¨å®ƒä»¬ï¼Œåˆ™è¿™æ˜¯å¿…éœ€çš„ã€‚ </p><br><p> å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„â€œä¿®å¤ç¨‹åºâ€çš„ä¸»ä½“æ˜¯<code>hook_idp()</code>å‡½æ•°ã€‚ åœ¨å…¶ä¸­ï¼Œæ ¹æ®æˆ‘ä»¬çš„éœ€è¦ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸‰ä¸ªå›è°ƒï¼š </p><br><ol><li>  <code>processor_t::ev_ana_insn</code> ï¼šå¦‚æœå¤„ç†å™¨æ¨¡å—ä¸­æœªå®ç°æŸäº›æ“ä½œç ï¼Œåˆ™éœ€è¦ </li><li>  <code>processor_t::ev_emu_insn</code> ï¼šåœ¨è¿™é‡Œæ‚¨å¯ä»¥åœ¨æ•°æ®/ä»£ç ä¸Šåˆ›å»ºäº¤å‰å¼•ç”¨ï¼Œè¿™äº›äº¤å‰å¼•ç”¨ç”±æ–°æ“ä½œç å¼•ç”¨ï¼ˆæˆ–ä¸å¼•ç”¨æ—§æ“ä½œç ï¼‰ </li><li>  <code>processor_t::ev_out_mnem</code> ï¼šå¿…é¡»ä»¥æŸç§æ–¹å¼è¾“å‡ºæ–°çš„æ“ä½œç ã€‚ éƒ½åœ¨è¿™é‡Œ </li></ol><br><p>  <code>init_plugin()</code>å‡½æ•°<code>init_plugin()</code>æˆ‘ä»¬çš„è¡¥ä¸ç¨‹åºåŠ è½½åˆ°å…¶ä»–å¤„ç†å™¨æ¨¡å—ä¸­ã€‚ <br> å¥½å§ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨å¤„ç†å™¨æ¨¡å—çš„äº‹ä»¶ä¸ŠæŒ‚èµ·äº†æ•´ä¸ªå›è°ƒï¼š </p><br><pre> <code class="cpp hljs">hook_to_notification_point(HT_IDP, hook_idp, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>);</code> </pre> <br><blockquote> éœ€è¦ä½¿ç”¨å…¨å±€å˜é‡<code>ana_addr</code>çš„æŠ€å·§ï¼Œä»¥ä¾¿åœ¨å°è¯•è·å–æœ‰å…³æˆ‘ä»¬ä¸æ‰‹åŠ¨è§£æçš„æŒ‡ä»¤çš„ä¿¡æ¯æ—¶ï¼Œ <code>ana_insn</code>ä¸ä¼šé€’å½’ã€‚ æ˜¯çš„ï¼Œaï¼Œè¿™ä¸ªâ€œæ‹æ–â€å³ä½¿åœ¨æ—§ç‰ˆæœ¬ä¸­ä¹Ÿèƒ½æŒç»­å¾ˆé•¿æ—¶é—´ã€‚ </blockquote><br><h3 id="ispravlenie-dlya-problemy-1"> æ›´æ­£é—®é¢˜ç¼–å·1 </h3><br><p> ä¸ºäº†æ­£ç¡®è§£å†³æ­¤é—®é¢˜ï¼Œæˆ‘ä¸å¾—ä¸å¯¹é¦–æ¬¡äº®ç›¸çš„ç»“è®ºè¿›è¡Œå¾ˆå¤šä¿®æ”¹ï¼Œè€Œæˆ‘åˆšåˆšä¸ºæ­¤ä»»åŠ¡å®ç°äº†è¿™ä¸€ç»“è®ºã€‚ æˆ‘çŸ¥é“åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ <em>IDAä¼š</em>æˆåŠŸæ˜¾ç¤ºæœ‰å…³<em>PCçš„</em>é“¾æ¥ï¼ˆåœ¨åç§»é‡è¡¨ä¸Šæœ‰è·³è½¬çš„æŒ‡ä»¤ä¸­ï¼Œè¯¥æŒ‡ä»¤ä¸å½“å‰æŒ‡ä»¤ç›¸è·ä¸è¿œï¼ŒåŠ ä¸Šcase-indexï¼‰ï¼Œä½†æ˜¯å¯¹äº<code>lea</code>æŒ‡ä»¤ï¼Œåœ°å€æ˜ å°„æœªæ­£ç¡®å®ç°ã€‚ ç»“æœï¼Œæˆ‘æ‰¾åˆ°äº†è¿™æ ·ä¸€æ¡è·³è½¬æŒ‡ä»¤ï¼Œå¹¶æ‰¾å‡ºäº†åº”è¯¥è®¾ç½®å“ªäº›æ ‡å¿—ä»¥ä¾¿æ˜¾ç¤ºå¸¦æ‹¬å·çš„<em>PC</em> ï¼š </p><br><p><img src="https://habrastorage.org/webt/gn/x3/uu/gnx3uu3rcfu50sk0avayghnpvgm.png"></p><br><div class="spoiler">  <b class="spoiler_title">è§£å†³é—®é¢˜ç¼–å·1</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_ana_insn: { <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span> *out = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ana_addr) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ana_addr = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ph.ana_insn(out) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { ana_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ana_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; UA_MAXOP; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">op_t</span></span> &amp;op = out-&gt;ops[i]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (op.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> o_near: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> o_mem: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (out-&gt;itype != <span class="hljs-number"><span class="hljs-number">0x76</span></span> || op.n != <span class="hljs-number"><span class="hljs-number">0</span></span> || (op.phrase != <span class="hljs-number"><span class="hljs-number">0x09</span></span> &amp;&amp; op.phrase != <span class="hljs-number"><span class="hljs-number">0x0A</span></span>) || (op.addr == <span class="hljs-number"><span class="hljs-number">0</span></span> || op.addr &gt;= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">23</span></span>)) || op.specflag1 != <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">// lea table(pc),Ax break; short diff = op.addr - out-&gt;ea; if (diff &gt;= SHRT_MIN &amp;&amp; diff &lt;= SHRT_MAX) { out-&gt;Op1.type = o_displ; out-&gt;Op1.offb = 2; out-&gt;Op1.dtype = dt_dword; out-&gt;Op1.phrase = 0x5B; out-&gt;Op1.specflag1 = 0x10; } } break; } } return out-&gt;size; } break;</span></span></code> </pre> </div></div><br><h3 id="ispravlenie-dlya-problemy-2"> æ›´æ­£é—®é¢˜ç¼–å·2 </h3><br><p> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ã€‚ åªéœ€å°†åœ°å€å±è”½åˆ°ç‰¹å®šèŒƒå›´å³å¯ï¼š <em>0xFF0000-0xFFFFFF</em> ï¼ˆç”¨äºRAMï¼‰å’Œ<em>0xC00000-0xC000FF</em> ï¼ˆç”¨äº<em>VDP</em>è§†é¢‘å­˜å‚¨å™¨ï¼‰ã€‚ è¿™é‡Œæœ€ä¸»è¦çš„æ˜¯æŒ‰æ“ä½œæ•°<code>o_near</code>å’Œ<code>o_mem</code>çš„ç±»å‹è¿›è¡Œè¿‡æ»¤ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">è§£å†³é—®é¢˜2</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_ana_insn: { <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span> *out = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ana_addr) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ana_addr = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ph.ana_insn(out) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { ana_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ana_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; UA_MAXOP; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">op_t</span></span> &amp;op = out-&gt;ops[i]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (op.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> o_near: <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> o_mem: { op.addr &amp;= <span class="hljs-number"><span class="hljs-number">0xFFFFFF</span></span>; <span class="hljs-comment"><span class="hljs-comment">// for any mirrors if ((op.addr &amp; 0xE00000) == 0xE00000) // RAM mirrors op.addr |= 0x1F0000; if ((op.addr &gt;= 0xC00000 &amp;&amp; op.addr &lt;= 0xC0001F) || (op.addr &gt;= 0xC00020 &amp;&amp; op.addr &lt;= 0xC0003F)) // VDP mirrors op.addr &amp;= 0xC000FF; } break; } } return out-&gt;size; } break;</span></span></code> </pre> </div></div><br><h3 id="ispravlenie-dlya-problemy-3"> æ›´æ­£é—®é¢˜ç¼–å·3 </h3><br><p> å®é™…ä¸Šï¼Œè¦æ·»åŠ æ‰€éœ€çš„æ“ä½œç ï¼Œæ‚¨å¿…é¡»ï¼š </p><br><ol><li> å®šä¹‰æ–°æ“ä½œç çš„ç´¢å¼•ã€‚ æ‰€æœ‰æ–°ç´¢å¼•éƒ½å¿…é¡»ä»¥<code>CUSTOM_INSN_ITYPE</code>å¼€å¤´ <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">m68k_insn_type_t</span></span> { M68K_linea = CUSTOM_INSN_ITYPE, M68K_linef, };</code> </pre> </li><li> å¦‚æœåœ¨ä»£ç <strong>0xA0</strong> / <strong>0xF0</strong>ä¸­æ‰¾åˆ°å­—èŠ‚ï¼Œåˆ™ä¼šè§¦å‘<strong>lineA</strong> / <strong>lineF</strong>æ“ä½œç ã€‚ æ‰€ä»¥æˆ‘ä»¬è¯»ä¸€ä¸ªå­—èŠ‚ </li><li> è·å–æŒ‡å‘å¤„ç†ç¨‹åºå‘é‡çš„é“¾æ¥ã€‚ åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œåœ¨æ ‡å¤´çš„å‰64ç ä¸­æœ‰ä¸­æ–­å‘é‡ã€‚ åœ¨ä½ç½®<strong>0x0A</strong>å’Œ<strong>0x0Bå¤„æœ‰</strong> <strong>lineA</strong> / <strong>lineFå¤„ç†ç¨‹åº</strong> ï¼š <br><pre> <code class="cpp hljs">value = get_dword(<span class="hljs-number"><span class="hljs-number">0x0A</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uint32)); <span class="hljs-comment"><span class="hljs-comment">// ... value = get_dword(0x0B * sizeof(uint32));</span></span></code> </pre> </li><li> åœ¨<code>ev_emu_insn</code>å°†<code>ev_emu_insn</code>æ·»åŠ åˆ°å¤„ç†ç¨‹åºå’Œä»¥ä¸‹è¯­å¥ä¸­ï¼Œä»¥ä½¿<em>ä»£ç æµ</em>ä¸ä¼šè¢«ä¸­æ–­ï¼š <br><pre> <code class="cpp hljs"> insn-&gt;add_cref(insn-&gt;Op1.addr, <span class="hljs-number"><span class="hljs-number">0</span></span>, fl_CN); <span class="hljs-comment"><span class="hljs-comment">// code ref insn-&gt;add_cref(insn-&gt;ea + insn-&gt;size, insn-&gt;Op1.offb, fl_F); // flow ref</span></span></code> </pre> </li><li> åœ¨<code>ev_out_mnem</code>æˆ‘ä»¬çš„è‡ªå®šä¹‰æ“ä½œç ï¼š <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *mnem = (outbuffer-&gt;insn.itype == M68K_linef) ? <span class="hljs-string"><span class="hljs-string">"line_f"</span></span> : <span class="hljs-string"><span class="hljs-string">"line_a"</span></span>; outbuffer-&gt;out_custom_mnem(mnem);</code> </pre> </li></ol><br><p><img src="https://habrastorage.org/webt/yf/uy/dz/yfuydznfymnf5sxkpz_bco9_szo.png"></p><br><div class="spoiler">  <b class="spoiler_title">é—®é¢˜3çš„è§£å†³æ–¹æ¡ˆ</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> <span class="hljs-keyword"><span class="hljs-keyword">m68k_insn_type_t</span></span> { M68K_linea = CUSTOM_INSN_ITYPE, M68K_linef, }; <span class="hljs-comment"><span class="hljs-comment">/* after includes */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_ana_insn: { <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span> *out = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ana_addr) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; uint16 itype = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">ea_t</span></span> value = out-&gt;ea; uchar b = get_byte(out-&gt;ea); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-number"><span class="hljs-number">0xA0</span></span> || b == <span class="hljs-number"><span class="hljs-number">0xF0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (b) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xA0</span></span>: itype = M68K_linea; value = get_dword(<span class="hljs-number"><span class="hljs-number">0x0A</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uint32)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xF0</span></span>: itype = M68K_linef; value = get_dword(<span class="hljs-number"><span class="hljs-number">0x0B</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uint32)); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } out-&gt;itype = itype; out-&gt;size = <span class="hljs-number"><span class="hljs-number">2</span></span>; out-&gt;Op1.type = o_near; out-&gt;Op1.offb = <span class="hljs-number"><span class="hljs-number">1</span></span>; out-&gt;Op1.dtype = dt_dword; out-&gt;Op1.addr = value; out-&gt;Op1.phrase = <span class="hljs-number"><span class="hljs-number">0x0A</span></span>; out-&gt;Op1.specflag1 = <span class="hljs-number"><span class="hljs-number">2</span></span>; out-&gt;Op2.type = o_imm; out-&gt;Op2.offb = <span class="hljs-number"><span class="hljs-number">1</span></span>; out-&gt;Op2.dtype = dt_byte; out-&gt;Op2.value = get_byte(out-&gt;ea + <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> out-&gt;size; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_emu_insn: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span> *insn = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (insn-&gt;itype == M68K_linea || insn-&gt;itype == M68K_linef) { insn-&gt;add_cref(insn-&gt;Op1.addr, <span class="hljs-number"><span class="hljs-number">0</span></span>, fl_CN); insn-&gt;add_cref(insn-&gt;ea + insn-&gt;size, insn-&gt;Op1.offb, fl_F); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_out_mnem: { <span class="hljs-keyword"><span class="hljs-keyword">outctx_t</span></span> *outbuffer = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">outctx_t</span></span> *); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (outbuffer-&gt;insn.itype != M68K_linea &amp;&amp; outbuffer-&gt;insn.itype != M68K_linef) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *mnem = (outbuffer-&gt;insn.itype == M68K_linef) ? <span class="hljs-string"><span class="hljs-string">"line_f"</span></span> : <span class="hljs-string"><span class="hljs-string">"line_a"</span></span>; outbuffer-&gt;out_custom_mnem(mnem); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;</code> </pre> </div></div><br><h3 id="ispravlenie-dlya-problemy-4"> è§£å†³é—®é¢˜4 </h3><br><p> å®ƒæ˜¯é€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³çš„ï¼šæ‰¾åˆ°<code>trap</code>æŒ‡ä»¤çš„æ“ä½œç ï¼Œä»æŒ‡ä»¤ä¸­è·å–ç´¢å¼•ï¼Œç„¶åä»è¯¥ç´¢å¼•ä¸­è·å–å¤„ç†ç¨‹åºå‘é‡ã€‚ æ‚¨å¾—åˆ°çš„æ˜¯è¿™æ ·çš„ï¼š </p><br><p><img src="https://habrastorage.org/webt/nx/kx/lp/nxkxlp9clt0duvzifv_sfuikk0y.png"></p><br><div class="spoiler">  <b class="spoiler_title">é—®é¢˜4çš„è§£å†³æ–¹æ¡ˆ</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_emu_insn: { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span> *insn = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (insn-&gt;itype == <span class="hljs-number"><span class="hljs-number">0xB6</span></span>) <span class="hljs-comment"><span class="hljs-comment">// trap #X { qstring name; ea_t trap_addr = get_dword((0x20 + (insn-&gt;Op1.value &amp; 0xF)) * sizeof(uint32)); get_func_name(&amp;name, trap_addr); set_cmt(insn-&gt;ea, name.c_str(), false); insn-&gt;add_cref(trap_addr, insn-&gt;Op1.offb, fl_CN); return 1; } } break;</span></span></code> </pre> </div></div><br><h3 id="ispravlenie-dlya-problemy-5"> æ›´æ­£é—®é¢˜ç¼–å·5 </h3><br><p> è¿™é‡Œçš„ä¸€åˆ‡ä¹Ÿå¾ˆç®€å•ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡<code>movea.w</code>æ“ä½œè¿›è¡Œè¿‡æ»¤ã€‚ ç„¶åï¼Œå¦‚æœæ“ä½œæ•°æ˜¯å•è¯ç±»å‹ï¼Œå¹¶ä¸”æŒ‡å‘RAMï¼Œåˆ™ç›¸å¯¹äºåŸºæ•°0xFF0000ï¼Œæˆ‘ä»¬ä»¥é™¡å³­çš„æ–¹å¼è¿›è¡Œå¼•ç”¨ã€‚ å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><p><img src="https://habrastorage.org/webt/m3/6f/m7/m36fm7jynpygy2m8gs61yi2owyo.png"></p><br><div class="spoiler">  <b class="spoiler_title">è§£å†³é—®é¢˜5</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-keyword"><span class="hljs-keyword">processor_t</span></span>::ev_ana_insn: { <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span> *out = va_arg(va, <span class="hljs-keyword"><span class="hljs-keyword">insn_t</span></span>*); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ana_addr) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; ana_addr = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ph.ana_insn(out) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { ana_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ana_addr = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; UA_MAXOP; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">op_t</span></span> &amp;op = out-&gt;ops[i]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (op.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> o_imm: { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (out-&gt;itype != <span class="hljs-number"><span class="hljs-number">0x7F</span></span> || op.n != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// movea break; if (op.value &amp; 0xFF0000 &amp;&amp; op.dtype == dt_word) { op.value &amp;= 0xFFFF; } } break; } } return out-&gt;size; } break; case processor_t::ev_emu_insn: { const insn_t *insn = va_arg(va, const insn_t*); for (int i = 0; i &lt; UA_MAXOP; ++i) { const op_t &amp;op = insn-&gt;ops[i]; switch (op.type) { case o_imm: { if (insn-&gt;itype != 0x7F || op.n != 0 || op.dtype != dt_word) // movea break; op_offset(insn-&gt;ea, op.n, REF_OFF32, BADADDR, 0xFF0000); } break; } } } break;</span></span></code> </pre> </div></div><br><h2 id="vyvody"> ç»“è®º </h2><br><p> å®é™…ä¸Šï¼Œå¦‚æœä¸ä»…æ¶‰åŠæœªçŸ¥æ“ä½œç çš„å®ç°ï¼Œè€Œä¸”æ¶‰åŠæ›´å¤æ‚çš„äº‹æƒ…ï¼Œåˆ™ä¿®å¤ç°æœ‰æ¨¡å—ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚ <br> è°ƒè¯•ç°æœ‰çš„å®ç°éœ€è¦èŠ±è´¹è®¸å¤šæ—¶é—´ï¼Œè¿™éœ€è¦äº†è§£å…¶ä¸­å‘ç”Ÿçš„äº‹æƒ…ï¼ˆæœ‰æ—¶ç”šè‡³æ˜¯ç™¾åˆ†æ¯”æ¨¡å—çš„åé¢ï¼‰ã€‚ ä½†æ˜¯ç»“æœå€¼å¾—ã€‚ </p><br><p> é“¾æ¥åˆ°æºä»£ç ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">//github.com/lab313ru/m68k_fixer</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN424263/">https://habr.com/ru/post/zh-CN424263/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN424251/index.html">æˆ‘ä»¬è€ƒè™‘hh.ruå®éªŒçš„ç»Ÿè®¡æ•°æ®</a></li>
<li><a href="../zh-CN424255/index.html">å¦‚ä½•æ­£ç¡®ä½¿ç”¨é™æ€åˆ†æ</a></li>
<li><a href="../zh-CN424257/index.html">Unityä¸­çš„å…­è¾¹å½¢å›¾ï¼šç¬¬1-3éƒ¨åˆ†</a></li>
<li><a href="../zh-CN424259/index.html">å®‰å…¨å‘¨36ï¼šTelnetåº”è¯¥å…³é—­</a></li>
<li><a href="../zh-CN424261/index.html">å¦‚ä½•è§£å†³ä»»ä½•ç¼–ç¨‹é—®é¢˜</a></li>
<li><a href="../zh-CN424265/index.html">å›é¡¾ç”µåŠ¨è‡ªè¡Œè½¦Twitter Mantis E-1</a></li>
<li><a href="../zh-CN424267/index.html">æˆ‘ä»¬å¦‚ä½•åœ¨æ¸¸æˆæœåŠ¡å™¨çš„æµè§ˆå™¨ä¸­è°ƒè¯•è‡ªå†™çš„ECS</a></li>
<li><a href="../zh-CN424271/index.html">æ•°æ®æŒ–æ˜Pubmedå’ŒPubchem-åŒ»å­¦å’Œç”ŸåŒ–ä¿¡æ¯æ•°æ®åº“</a></li>
<li><a href="../zh-CN424273/index.html">æ­¥è¿›ç”µæœºé©±åŠ¨çš„å•çº§å˜é€Ÿç®±</a></li>
<li><a href="../zh-CN424275/index.html">ç»†èƒä¸­çš„èƒ½é‡ã€‚ ä½¿ç”¨å’Œå‚¨å­˜</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>