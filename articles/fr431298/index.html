<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍🚒 🌖 👨🏿‍✈️ Validation de l'unicité véritable 🔍 🍠 👼🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chaque pirate informatique qui a travaillé avec Ruby On Rails est familier avec ORM ActiveRecord . Nous discuterons de l'une des validations proposées...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Validation de l'unicité véritable</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431298/"> Chaque pirate informatique qui a travaillé avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ruby On Rails est</a> familier avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ORM</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ActiveRecord</a> .  Nous discuterons de l'une des validations proposées hors de la boîte, à savoir, les validations pour l'unicité, et pourquoi la gem de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">database_validations</a> sauvera la cohérence de votre base de données. <br><a name="habracut"></a><br>  Supposons que vous ayez un modèle utilisateur unique dans le champ <i>e</i> - <i>mail</i> , c'est-à-dire <br><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> &lt; ApplicationRecord </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validates</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">email</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">uniqueness</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Vous savez peut-être déjà que cette validation effectue la demande suivante <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> email = $<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br>  chaque fois que nous essayons de sauvegarder un enregistrement dans la base de données. <br><br>  Cette approche présente plusieurs inconvénients: <br><br>  <b>Tout d'abord</b> , l'exécution d'une requête supplémentaire, et si plusieurs validations d'unicité sont initialisées dans le modèle, la requête sera exécutée pour chacune d'entre elles.  Ce n'est pas efficace et nécessite également des index si nous voulons que ces requêtes s'exécutent rapidement. <br><br>  <b>Deuxièmement</b> , cette solution ne garantit pas l'unicité en raison d'une éventuelle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">course aux données</a> .  Plusieurs opérations concurrentielles peuvent apprendre simultanément l'absence d'un enregistrement spécifique, ce qui permet de conserver les mêmes données. <br><br>  Bien sûr, de rares cas de course aux données peuvent être résolus en ajoutant une contrainte d'unicité au niveau de la base de données.  Mais dans ce cas, vous n'obtiendrez pas d'erreur de validation, la requête vers la base de données tombera simplement et toute la transaction sera annulée. <br><br>  Dans cette situation, gem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">database_validations vous</a> aidera, ce qui assure la compatibilité entre les restrictions de base de données et les validations. <br><br>  La signification principale de gem est présentée dans le code suivant: <br><br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(options = {})</span></span></span></span> ActiveRecord::Base.connection.transaction(<span class="hljs-symbol"><span class="hljs-symbol">requires_new:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">rescue</span></span> ActiveRecord::RecordNotUnique =&gt; e Helpers.handle_unique_error!(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, e) <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  Ainsi, nous essayons de sauvegarder les données, si toutes les autres validations sont réussies, si la transaction tombe et revient en arrière, nous analysons l'erreur et attribuons les valeurs correctes aux <code>errors</code> notre objet. <br><br>  Après avoir examiné la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation</a> et les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">références</a> , nous pouvons conclure que cette gemme accélérera le processus d'enregistrement des enregistrements dans la base de données au moins deux fois. <br><br>  Grâce à la prise en charge de bases de données telles que <i>PostgreSQL</i> , <i>SQLite</i> , <i>MySQL</i> et à la rétrocompatibilité avec <code>validates_uniqueness_of</code> , le processus de remplacement par <code>validates_db_uniqueness_of</code> prend quelques minutes. <br><br>  Un matcher pratique pour RSpec est également présent hors de la boîte: <br><br><pre> <code class="ruby hljs">specify <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> expect(described_class) .to validate_db_uniqueness_of(<span class="hljs-symbol"><span class="hljs-symbol">:field</span></span>) .with_message(<span class="hljs-string"><span class="hljs-string">'duplicate'</span></span>) .with_where(<span class="hljs-string"><span class="hljs-string">'(some_field IS NULL)'</span></span>) .scoped_to(<span class="hljs-symbol"><span class="hljs-symbol">:another_field</span></span>) .with_index(<span class="hljs-symbol"><span class="hljs-symbol">:unique_index</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Lorsque vous passez à une nouvelle validation, vous devez avoir des restrictions sur l'unicité dans la base de données, mais si elles ne sont pas déjà là, gem l'indiquera au démarrage de l'application. <br><br>  La gemme a été testée sur une application avec plus de 100 validations pour l'unicité parmi plus de 50 modèles. <br><br>  Utilisez gem et partagez votre opinion.  Toute contribution à un développement ultérieur est la bienvenue! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr431298/">https://habr.com/ru/post/fr431298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr431288/index.html">The Battle for Consumer Check: Walmart et Amazon Review</a></li>
<li><a href="../fr431290/index.html">Madrobots 2 Black Friday Week: trois jours</a></li>
<li><a href="../fr431292/index.html">Implémentation du système GTD basée sur les nouvelles fonctionnalités de Google Keep et Calendar</a></li>
<li><a href="../fr431294/index.html">Correspondance entre contraintes de base de données et validations</a></li>
<li><a href="../fr431296/index.html">Rôles émotionnels dans les jeux. Narration compétente et implication dans le flux</a></li>
<li><a href="../fr431300/index.html">Trois ans de certification sans dirigeants - vol normal</a></li>
<li><a href="../fr431302/index.html">Faire une simple antenne sonar à la poubelle</a></li>
<li><a href="../fr431304/index.html">À la recherche d'ombres prometteuses pour roguelike</a></li>
<li><a href="../fr431306/index.html">Comment créer une pyramide dans le tronc ou les applications de développement piloté par les tests sur Spring Boot</a></li>
<li><a href="../fr431308/index.html">Innotrans 2018: quel type de transport ferroviaire sera demain?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>