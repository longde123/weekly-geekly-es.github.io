<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì¶ ‚õìÔ∏è üßôüèª Legacy-Services in Ihrer Infrastruktur üñ±Ô∏è üë®üèø‚Äç‚öïÔ∏è ‚ôæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hallo! Mein Name ist Pasha Chernyak, ich bin ein f√ºhrender Entwickler bei QIWI und heute m√∂chte ich √ºber das Unvermeidliche sprechen. √úber Verm√§chtnis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Legacy-Services in Ihrer Infrastruktur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/qiwi/blog/477682/"> Hallo!  Mein Name ist Pasha Chernyak, ich bin ein f√ºhrender Entwickler bei QIWI und heute m√∂chte ich √ºber das Unvermeidliche sprechen.  √úber Verm√§chtnis. <br><br>  Beginnen wir mit der Frage: Was ist ein Legacy-Service?  Ist ein Legacy-Service ein Service, den der Entwickler eine Woche / einen Monat / ein Jahr lang nicht ber√ºhrt hat?  Oder ist es ein Dienst, der von einem weniger erfahrenen Programmierer geschrieben wurde, zum Beispiel speziell von Ihnen, aber vor einem Jahr?  Und jetzt bist du cooler und erfahrener.  Oder ist ein Legacy-Service ein Service, f√ºr den Sie sich entschlie√üen, ihn nie wieder bereitzustellen, und den Sie langsam ersetzen m√∂chten?  In jedem Fall ist es eine Zeitbombe, diesen Dienst unbeaufsichtigt zu lassen und nicht zu aktualisieren, was sp√§ter explodieren kann. <br><br> <a href="https://habr.com/ru/company/qiwi/blog/477682/"><img src="https://habrastorage.org/webt/p9/ln/rt/p9lnrt-etdgnk1bd6mkfrcsxoxk.jpeg"></a> <br><br>  Bevor wir uns mit der Arbeitsweise unserer Legacy-Services in QIWI befassen, erkl√§re ich Ihnen, wie wir die Services in der Brieftasche in Ordnung bringen.  Seit zwei Jahren bin ich f√ºr die Leistung verantwortlich.  Wenn es ein Problem gibt, rufen sie mich immer zuerst an.  Normalerweise habe ich nicht die K√ºhnheit, um um 23:00 Uhr jemanden anzurufen, daher musste ich mich hinsetzen und alle Dienste unserer Domain verstehen. <br><br>  Aber ich mag es, nachts zu schlafen, wie jeder andere auch, also versuchte ich, mich mit der Operation auseinanderzusetzen: "Leute, warum rufst du mich an?"  Auf diese Frage erhielt er eine ziemlich knappe Antwort mit der Aufschrift "Wer noch?".  Weil ich Reparaturdienste repariere und die Jungs einfach nicht wissen, wen sie anrufen sollen. <br><br>  Aus diesem Grund haben wir in einer der R√ºckblicke des Wallet-Backend-Teams beschlossen, ein Kennzeichen zu erstellen, auf dem eine Liste unserer Services, Mikrodienste und Monolithen des Wallets sowie der Verantwortlichen aufgef√ºhrt ist.  Tabletten sind im Allgemeinen in angemessenem Umfang n√ºtzlich. <br><a name="habracut"></a><br>  Neben Informationen dar√ºber, wer f√ºr was verantwortlich ist, wurden auch Fragen beantwortet: Wer ist der Eigent√ºmer des Dienstes, wer ist f√ºr dessen Entwicklung, f√ºr die Architektur und den Lebenszyklus verantwortlich.  Die Verantwortlichen f√ºr diesen Service sind Personen, die ihn reparieren k√∂nnen, wenn etwas passiert.  Der Eigent√ºmer des Dienstes hat das Recht, +2 in den Commits zu belassen. Die Verantwortlichen m√ºssen ebenfalls bei der √úberpr√ºfung anwesend sein, bevor dieser Dienst das neue Commit √ºbernimmt. <br><br>  Mit der Zeit kamen neue Methoden zum Einsatz, zum Beispiel die Migration auf Kubernetes, alle Arten von Checkstyles, Spotbugs, Ktlint, die Verf√ºgbarkeit von Protokollen in Kiban, Autodiscovery-Dienste, anstatt Adressen direkt und andere n√ºtzliche Dinge anzugeben.  Und √ºberall, wo unser Tisch es uns erm√∂glichte, die Relevanz unserer Dienstleistungen aufrechtzuerhalten.  F√ºr uns ist dies eine Checkliste, aus der hervorgeht, dass dieser Dienst wei√ü, wie dies zu tun ist, dies jedoch noch nicht. Wir sind jedoch weitergegangen und haben festgestellt, dass uns Informationen zu unseren Diensten fehlen, f√ºr die wir nachverfolgen, wo die Quellcodes des Dienstes liegen , wo die Montageaufgaben in TeamCity gestartet werden, wie sie bereitgestellt werden, wo die Quellcodes der End2end-Tests gespeichert werden, Fotos von der Architekturpflege, √ºber getroffene Entscheidungen.  Idealerweise wollte ich, dass all diese Informationen irgendwo liegen und zur Hand sind, wenn sie gebraucht werden.  Aus diesem Grund ist unser Schild ein Ausgangspunkt f√ºr die Suche nach Informationen geworden. <br><br>  Aber QIWI ist, obwohl es den Geist eines Startups beibeh√§lt, ein gro√ües Unternehmen.  Wir sind bereits 12 Jahre alt und die Teams √§ndern sich: Die Leute gehen, die Leute kommen, neue Teams werden gebildet.  Und wir haben auf unserer Domain mehrere Dienste gefunden, die wir geerbt haben.  Es kam etwas mit Entwicklern aus anderen Teams, etwas, das nur irgendwie indirekt mit dem Wallet zusammenh√§ngt, sodass der Service jetzt in unserer Bilanz steht.  Womit umgehen und wie es funktioniert - warum?  Der Service funktioniert und wir haben Produkteigenschaften, die abgewaschen werden m√ºssen. <br><br><h2>  Wie es passiert </h2><br>  Aber irgendwann stellen wir fest, dass der Dienst seine Funktion nicht mehr erf√ºllt, etwas ist kaputt - was ist in dieser Situation zu tun?  Der Service hat einfach aufgeh√∂rt zu funktionieren.  Absolut.  Dies erfuhren wir erstens zuf√§llig und zweitens sechs Monate sp√§ter.  Es passiert  Das einzige, was wir wussten, war, auf welchen virtuellen Maschinen der Service bereitgestellt wurde, wo seine Quellen liegen und das ist alles.  Wir lassen git klonen und tauchen in die Gedanken der Person ein, die dies vor einigen Jahren geschrieben hat, aber was sehen wir?  Wir kennen keinen Spring Boot, obwohl wir an alles gew√∂hnt sind, haben wir einen vollen Stack und all das.  Vielleicht gibt es ein Spring Framework?  Aber nein <br><br>  Der Typ, der das alles schrieb, war hart und schrieb alles in reinem Java.  Es gibt keine vertrauten Tools f√ºr den Entwickler, und die Idee entsteht - wir sollten das alles neu schreiben.  Wir haben auch Microservices und von jedem Toaster h√∂ren wir die bekannten "Jungs, Microservices sind das, was Sie brauchen!".  Wenn pl√∂tzlich etwas nicht mehr stimmt, nehmen Sie ruhig eine Sprache und alles wird gut. <br><br>  Die Sache ist, dass wir jetzt keinen Kunden haben, der f√ºr diesen Service verantwortlich ist.  Was waren seine gesch√§ftlichen Anforderungen, was sollte dieser Service im Allgemeinen tun?  Und der Service ist eng in Ihre Gesch√§ftsprozesse integriert. <br><br>  Sagen Sie mir jetzt, wie einfach es ist, einen Service umzuschreiben, ohne die gesch√§ftlichen Anforderungen zu kennen.  Dem Service ist nicht klar, wie er protokolliert wird, ob Metriken vorliegen, ist unbekannt.  Was sie sind, wenn √ºberhaupt, ist umso unbekannter.  Und w√§hrend sie im Dienst sind, gibt es eine gro√üe Anzahl von Klassen unklarer Gesch√§ftslogik.  Etwas ist in einer Art Datenbank enthalten, von der wir auch noch nichts wissen. <br><br><h2>  Wo soll ich anfangen? </h2><br>  Vom logischsten - mit der Verf√ºgbarkeit von Tests.  Zumindest wird dort normalerweise eine Art Logik geschrieben, und es k√∂nnen Schlussfolgerungen dar√ºber gezogen werden, was passiert.  Jetzt ist TDD in Mode, aber wir sehen, dass vor f√ºnf Jahren fast alles so war wie heute: Es gibt fast keine Komponententests, und sie werden uns absolut nichts sagen.  Nun, au√üer vielleicht einer Art von √úberpr√ºfung, wie XML mit einer Art benutzerdefiniertem Zertifikat signiert ist. <br><br>  Wir konnten unter dem Code nichts verstehen und haben einen Blick darauf geworfen, wo sich die virtuelle Maschine befand.  Wir haben die Serviceprotokolle ge√∂ffnet und dabei einen http-Client-Fehler festgestellt. Dabei handelt es sich um ein selbstsigniertes Zertifikat, das gewissenlos in die Ressourcen der Anwendung eingearbeitet wurde.  Wir haben unsere Analysten kontaktiert, sie haben um ein neues Zertifikat gebeten, sie haben es uns ausgestellt und der Service funktioniert wieder.  Das scheint alles zu sein.  Oder nicht?  Der Service funktioniert dennoch und erf√ºllt einige Funktionen, die unser Unternehmen ben√∂tigt.  Wir haben einige Standards f√ºr die Anwendungsentwicklung, die Sie h√∂chstwahrscheinlich haben.  Speichern Sie die Protokolle beispielsweise nicht auf dem Knoten im Ordner, sondern in einer Art Speicher, z. B. einem Gummiband, und betrachten Sie sie im Kiban.  Sie k√∂nnen sich an die goldenen Metriken erinnern.  Das hei√üt, die Belastung des Dienstes, die Anzahl der Anfragen f√ºr den Dienst, ob er lebt oder nicht, wie sein HealthCheck abl√§uft.  Zumindest helfen Ihnen diese Kennzahlen dabei, herauszufinden, wann sie wie ein b√∂ser Traum mit gutem Gewissen stillgelegt und vergessen werden k√∂nnen. <br><br><h2>  Was zu tun ist </h2><br>  Aus diesem Grund f√ºgen wir dem Tablet einen solchen alten Dienst hinzu, und dann suchen wir unter den Entwicklern nach Freiwilligen, die sich um den Dienst k√ºmmern und ihn in die richtige Reihenfolge bringen: Sie schreiben mindestens einige Informationen √ºber den Dienst, f√ºgen Verkn√ºpfungen zu Dashboards in Graphan hinzu, f√ºhren Assemblierungsaufgaben durch und verstehen, wie Stellen Sie die Anwendung bereit, laden Sie keine Dateien mit Ihren H√§nden √ºber FTP hoch. <br><br>  Die Hauptsache ist, wie viel diese n√ºtzliche Freiwilligenarbeit kosten wird.  Ein Sprint f√ºr einen mehr oder weniger erfahrenen Entwickler, zum Beispiel w√§hrend einer 20% igen technischen Verschuldung.  Und wie lange hat es gedauert, die tief verwurzelte Logik der Kommunikation mit einem bestimmten Staatssystem zu verstehen und auf neuere Technologien umzustellen?  Ich kann mich nicht daf√ºr verb√ºrgen, vielleicht einen Monat, oder vielleicht zwei Teamworks.  Dies sage ich aus der Erfahrung der Integration zum gegenw√§rtigen Zeitpunkt mit einigen neuen Diensten. <br><br>  Gleichzeitig wird der Gesch√§ftswert nicht ausgesch√∂pft.  Absolut.  Es ist normal, den Support-Service in Anspruch zu nehmen und ein wenig Zeit damit zu verbringen.  Aber nach unseren Standard-T√§nzen mit dem Service haben wir es der Tabelle hinzugef√ºgt, Informationen hinzugef√ºgt und vielleicht werden wir es eines Tages umschreiben.  Aber jetzt erf√ºllt es unsere Servicestandards. <br><br>  Aus diesem Grund m√∂chte ich einen Plan erstellen, was mit Legacy-Diensten geschehen soll. <br><br>  <b>Verm√§chtnis von Grund auf neu zu schreiben, ist eine schlechte Idee</b> <br>  Im Ernst, Sie m√ºssen nicht einmal dar√ºber nachdenken.  Es ist klar, dass wir m√∂chten, und einige Vorteile werden gesehen, aber in der Regel ist dies f√ºr niemanden erforderlich, auch f√ºr Sie. <br><br>  <b>Nachschlagewerk</b> <br>  Durchsuchen Sie die Quellcodes Ihrer Anwendungen, erstellen Sie ein Verzeichnis, in dem angegeben wird, woran und wo es liegt und wie es funktioniert, und geben Sie dort die Projektbeschreibung (bedingte readme.md) ein, um schnell zu verstehen, wo sich die Protokolle und Metriken befinden.  Ein Entwickler, der sich nach Ihnen darum k√ºmmert, wird Ihnen nur danken. <br><br>  <b>Verstehe die Domain</b> <br>  Wenn Sie eine Domain besitzen, versuchen Sie, immer am Puls der Zeit zu bleiben.  Es klingt kitschig, aber nicht jeder stellt sicher, dass sich die Dienste in einem einzigen Schl√ºssel befinden.  Das Arbeiten in einem Standard ist jedoch wesentlich einfacher. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de477682/">https://habr.com/ru/post/de477682/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de477670/index.html">Was gibt Testautomatisierung</a></li>
<li><a href="../de477672/index.html">Rechte und Pflichten der Teammitglieder: rechtliche und kulturelle Aspekte</a></li>
<li><a href="../de477674/index.html">Bedeutet KI Liebe?</a></li>
<li><a href="../de477678/index.html">Perspektiven f√ºr das digitale Fernsehen in Russland</a></li>
<li><a href="../de477680/index.html">Unsere H√§nde sind nicht f√ºr Langeweile: die Wiederherstellung des Turm-Clusters in K8s</a></li>
<li><a href="../de477684/index.html">Angular: Der beste Begleiter f√ºr interaktive Apps</a></li>
<li><a href="../de477686/index.html">Unsere auf der AI Journey Konferenz</a></li>
<li><a href="../de477688/index.html">Dezember IT Events Digest</a></li>
<li><a href="../de477692/index.html">Erfahrung mit ZGC und Shenandoah GC in der Produktion</a></li>
<li><a href="../de477694/index.html">JavaScript muss nicht durch irgendetwas ersetzt werden - auch andere Sprachen haben die gleichen Probleme</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>