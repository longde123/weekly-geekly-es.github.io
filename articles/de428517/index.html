<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚ù§Ô∏è‚Äçüë® ‚èπÔ∏è ü§≥üèª GraphQL - API auf neue Weise ‚úãüèæ ü§ü üï∫üèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Was ist die GraphQL-Abfragesprache? Welche Vorteile bietet diese Technologie und welche Probleme werden Entwickler bei ihrer Verwendung haben? Wie kan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>GraphQL - API auf neue Weise</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/428517/">  Was ist die GraphQL-Abfragesprache?  Welche Vorteile bietet diese Technologie und welche Probleme werden Entwickler bei ihrer Verwendung haben?  Wie kann man GraphQL effektiv nutzen?  √úber all das unter dem Schnitt. <br><br><img src="https://habrastorage.org/webt/d4/w4/cg/d4w4cgweq81ewi6vo51e1kbw9tu.jpeg"><br><br>  Der Artikel basiert auf dem Einf√ºhrungsbericht von <b>Vladimir Tsukur</b> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">volodymyrtsukur</a> ) von der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Joker 2017-</a> Konferenz. <br><a name="habracut"></a><br><iframe width="560" height="315" src="https://www.youtube.com/embed/YgRmgHPTXr4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Mein Name ist Vladimir, ich leite die Entwicklung einer der Abteilungen bei WIX.  Mehr als hundert Millionen WIX-Benutzer erstellen Websites in verschiedene Richtungen - von Visitenkarten-Websites und Gesch√§ften bis hin zu komplexen Webanwendungen, in denen Sie Code und beliebige Logik schreiben k√∂nnen.  Als lebendiges Beispiel f√ºr ein Projekt auf WIX m√∂chte ich Ihnen den erfolgreichen Site Store <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">unicornadoptions.com zeigen</a> , der die M√∂glichkeit bietet, ein Kit zum Z√§hmen eines Einhorns zu erwerben - ein gro√üartiges Geschenk f√ºr ein Kind. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a9/7ec/db8/2a97ecdb8542ecb4aff1213a5b8690b9.jpg"><br><br>  Ein Besucher dieser Website kann ein Kit ausw√§hlen, mit dem er ein Einhorn z√§hmen m√∂chte, z. B. Pink, und dann sehen, was genau in diesem Kit enthalten ist: Spielzeug, Zertifikat, Abzeichen.  Ferner hat der K√§ufer die M√∂glichkeit, Waren in den Warenkorb zu legen, deren Inhalt anzuzeigen und eine Bestellung aufzugeben.  Dies ist ein einfaches Beispiel f√ºr eine Store-Site, und wir haben viele solcher Sites, Hunderttausende.  Alle von ihnen basieren auf derselben Plattform mit einem Backend und einer Reihe von Clients, die wir mithilfe der API unterst√ºtzen.  Es geht um die API, die weiter diskutiert wird. <br><br><h2>  Einfache API und ihre Probleme </h2><br>  Stellen wir uns vor, welche Allzweck-API (dh eine API f√ºr alle Stores auf der Plattform) wir erstellen k√∂nnten, um Store-Funktionen bereitzustellen.  Konzentrieren wir uns ausschlie√ülich auf die Datenerfassung. <br><br>  F√ºr eine Produktseite auf einer solchen Website sollten der Produktname, der Preis, die Bilder, die Beschreibung, zus√§tzliche Informationen und vieles mehr zur√ºckgegeben werden.  In einer Komplettl√∂sung f√ºr Gesch√§fte unter WIX gibt es mehr als zwei Dutzend solcher Datenfelder.  Die Standardl√∂sung f√ºr eine solche Aufgabe zus√§tzlich zur HTTP-API besteht darin, die Ressource <code>/products/:id</code> zu beschreiben, die die Produktdaten f√ºr die <code>GET</code> Anforderung zur√ºckgibt.  Das Folgende ist ein Beispiel f√ºr Antwortdaten: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt today!"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sku"</span></span>:<span class="hljs-string"><span class="hljs-string">"010"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"images"</span></span>: [   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/dd55129473e04f489806db0dc6468dd9.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/5727549e9131440dbb3cd707dce45d0f.jpg"</span></span>,   <span class="hljs-string"><span class="hljs-string">"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</span></span> ] }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/5d6/4ac/ecf5d64acd1da66df56b6aa49f5eb6be.jpg"><br><br>  Schauen wir uns jetzt die Produktkatalogseite an.  F√ºr diese Seite ben√∂tigen Sie die Ressourcensammlung <i>/ products</i> .  Aber nur bei der Anzeige der Produktkollektion auf der Katalogseite werden nicht alle Produktdaten ben√∂tigt, sondern nur Preis, Name und Hauptbild.  Zum Beispiel sind die Beschreibung, zus√§tzliche Informationen, Hintergrundbilder usw. f√ºr uns nicht von Interesse. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/82b/0ed/aa482b0edf598fcc605eee75216e963b.png"><br><br>  Angenommen, wir verwenden der Einfachheit halber dasselbe Produktdatenmodell f√ºr die Ressourcen <code>/products</code> und <code>/products/:id</code> .  Im Falle einer Sammlung solcher Produkte wird es m√∂glicherweise mehrere geben.  Das Antwortschema kann wie folgt dargestellt werden: <br><br><pre> <code class="javascript hljs">GET /products [ {   title   price   images   description   info   ... } ]</code> </pre><br>  Schauen wir uns nun die ‚ÄûNutzdaten‚Äú der Antwort vom Server f√ºr die Produktsammlung an.  Folgendes wird vom Client in mehr als zwei Dutzend Feldern tats√§chlich verwendet: <br><br> <code>{ <br> <s>"id": "59eb83c0040fa80b29938e3f",</s> <br> "title": "Combo Pack with Dreamy Eyes 12\" (Pink) Soft Toy", <br> "price": 26.99, <br> <s>"info": "Spread Unicorn love amongst your friends and family by purchasing a Unicorn adoption combo pack today. You'll receive your very own fabulous adoption pack and a 12\" Dreamy Eyes (Pink) cuddly toy. It makes the perfect gift for loved ones. Go on, you know you want to, adopt todayl",</s> <br> " <s>description": "Your fabulous Unicorn adoption combo pack contains:\nA 12\" Dreamy Eyes (Pink) Unicorn Soft Toy\nA blank Unicorn adoption certificate ‚Äî name your Unicorn!\nA confirmation letter\nA Unicorn badge\nA Unicorn key ring\nA Unicorn face mask (self assembly)\nA Unicorn bookmark\nA Unicorn colouring in sheet\nA A4 Unicorn posters\n2 x Unicorn postcards\n3 x Unicorn stickers",</s> <br> "images": [ <br> "http://localhost:8080/img/918d8d4cc83d4e5f8680ca4edfd5b6b2.jpg", <br> <s>"http://localhost:8080/img/f343889c0bb94965845e65d3f39f8798.jpg",</s> <br> <s>"http://localhost:8080/img/dd55129473604f489806db0dC6468dd9.jpg",</s> <br> <s>"http://localhost:8080/img/64eba4524a1f4d5d9f1687a815795643.jpg",</s> <br> <s>"http://localhost:8080/img/5727549e9l3l440dbb3cd707dce45d0f.jpg",</s> <br> <s>"http://localhost:8080/img/28ae9369ec3c442dbfe6901434ad15af.jpg"</s> <br> ], <br> <s>...</s> <br> }</code> <br> <br>  Wenn ich das Produktmodell einfach halten m√∂chte, indem ich dieselben Daten zur√ºckgebe, habe ich nat√ºrlich ein Problem mit dem Abrufen von Daten, das in einigen F√§llen mehr Daten enth√§lt, als ich ben√∂tige.  In diesem Fall wurde dies auf der Produktkatalogseite angezeigt. Im Allgemeinen ben√∂tigen jedoch alle Benutzeroberfl√§chenbildschirme, die in irgendeiner Weise mit dem Produkt verbunden sind, m√∂glicherweise nur einen Teil (nicht alle) der Daten. <br><br>  Schauen wir uns jetzt die Warenkorbseite an.  Im Warenkorb befinden sich neben den Produkten selbst auch deren Menge (in diesem Warenkorb), Preis sowie die Gesamtkosten der gesamten Bestellung: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/653/da1/ad3/653da1ad36872dff8cda2d13b28b5f45.png"><br><br>  Wenn wir den Ansatz der einfachen Modellierung der HTTP-API fortsetzen, kann der Warenkorb durch die Ressource <i>/ carts /: id dargestellt werden</i> , deren Darstellung sich auf die Ressourcen der Produkte bezieht, die diesem Warenkorb hinzugef√ºgt wurden: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb83c0040fa80b29938e40"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">25.98</span></span>   },   {     <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: <span class="hljs-string"><span class="hljs-string">"/products/59eb88bd040fa8125aa9c400"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"quantity"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">"total"</span></span>: <span class="hljs-number"><span class="hljs-number">26.99</span></span>   } ], <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">79.96</span></span> }</code> </pre><br>  Um beispielsweise einen Warenkorb mit drei Produkten am Frontend zu zeichnen, m√ºssen Sie vier Anforderungen stellen: eine zum Laden des Warenkorbs selbst und drei Anforderungen zum Laden von Produktdaten (Name, Preis und Artikelnummer). <br><br>  Das zweite Problem, das wir hatten, ist das Unterholen.  Die Differenzierung der Verantwortlichkeiten zwischen dem Warenkorb und den Produktressourcen hat dazu gef√ºhrt, dass zus√§tzliche Anfragen gestellt werden m√ºssen.  Hier gibt es offensichtlich eine Reihe von Nachteilen: Aufgrund <i>einer</i> gr√∂√üeren Anzahl von Anfragen landen wir den Akku des Mobiltelefons schneller und erhalten die vollst√§ndige Antwort langsamer.  Auch die Skalierbarkeit unserer L√∂sung wirft Fragen auf. <br><br>  Nat√ºrlich ist diese L√∂sung nicht f√ºr die Produktion geeignet.  Eine M√∂glichkeit, das Problem zu beheben, besteht darin, Projektionsunterst√ºtzung f√ºr den Korb hinzuzuf√ºgen.  Eine dieser Projektionen k√∂nnte zus√§tzlich zu den Daten des Warenkorbs selbst Daten zu Produkten zur√ºckgeben.  Dar√ºber hinaus ist diese Projektion sehr spezifisch, da Sie auf der Warenkorbseite die Inventarnummer (SKU) des Produkts ben√∂tigen.  Nirgendwo sonst wurde eine SKU ben√∂tigt. <br><br><pre> <code class="plaintext hljs">GET /carts/1?projection=with-products</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a5f/3d7/901/a5f3d7901a3d60622575ae1fdf6787d1.png"><br><br>  Eine solche ‚ÄûAnpassung‚Äú von Ressourcen f√ºr eine bestimmte Benutzeroberfl√§che endet normalerweise nicht, und wir beginnen, andere Projektionen zu generieren: kurze Informationen zum Warenkorb, die Korbprojektion f√ºr das mobile Web und danach die Projektion f√ºr Einh√∂rner. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ff/6b5/dad/9ff6b5dad7ee3ec4e7d95790dcd2eb05.png"><br><br>  (Im Allgemeinen k√∂nnen Sie als Benutzer im WIX Designer konfigurieren, welche Produktdaten auf der Produktseite angezeigt werden sollen und welche Daten im Warenkorb angezeigt werden sollen.) <br><br>  Und hier erwarten uns Schwierigkeiten: Wir rahmen den Garten ein und suchen nach komplexen L√∂sungen.  Aus API-Sicht gibt es f√ºr eine solche Aufgabe nur wenige Standardl√∂sungen, die normalerweise stark vom Framework oder der HTTP-Ressourcenbeschreibungsbibliothek abh√§ngen. <br><br>  Was noch wichtiger ist, jetzt wird es schwieriger zu arbeiten, denn wenn sich die Anforderungen auf der Client-Seite √§ndern, muss das Backend sie st√§ndig ‚Äûeinholen‚Äú und befriedigen. <br><br>  Schauen wir uns als ‚ÄûKirsche auf dem Kuchen‚Äú ein weiteres wichtiges Thema an.  Bei einer einfachen HTTP-API hat der Serverentwickler keine Ahnung, welche Art von Daten der Client verwendet.  Wird der Preis verwendet?  Beschreibung?  Ein oder alle Bilder? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f1/943/2d4/1f19432d49f8577cc70197bdb74a7987.png"><br><br>  Dementsprechend stellen sich mehrere Fragen.  Wie arbeite ich mit veralteten / veralteten Daten?  Woher wei√ü ich, welche Daten nicht mehr verwendet werden?  Wie ist es relativ sicher, Daten aus der Antwort zu entfernen, ohne die meisten Clients zu besch√§digen?  Mit der √ºblichen HTTP-API gibt es keine Antwort auf diese Fragen.  Trotz der Tatsache, dass wir optimistisch sind und die API einfach zu sein scheint, sieht die Situation nicht so hei√ü aus.  Dieser Bereich von API-Problemen gilt nicht nur f√ºr WIX.  Eine gro√üe Anzahl von Unternehmen musste sich mit ihnen befassen.  Jetzt ist es interessant, eine m√∂gliche L√∂sung zu finden. <br><br><h2>  GraphQL.  Starten Sie </h2><br>  Im Jahr 2012 hatte Facebook bei der Entwicklung einer mobilen Anwendung ein √§hnliches Problem.  Die Ingenieure wollten die Mindestanzahl mobiler Anwendungsaufrufe an den Server erreichen, w√§hrend sie bei jedem Schritt nur die erforderlichen Daten und nur diese erhielten.  Das Ergebnis ihrer Bem√ºhungen war GraphQL, das auf der React Conf-Konferenz 2015 vorgestellt wurde.  GraphQL ist eine Abfragebeschreibungssprache sowie eine Laufzeitumgebung f√ºr diese Abfragen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/052/9fc/00c/0529fc00c59b43faf40c8cbd4064d1ac.png"><br><br>  Betrachten Sie einen typischen Ansatz f√ºr die Arbeit mit GraphQL-Servern. <br><br><h3>  Wir beschreiben das Schema </h3><br>  Das Datenschema in GraphQL definiert die Typen und Beziehungen zwischen ihnen und dies auf stark typisierte Weise.  Stellen Sie sich zum Beispiel ein einfaches Modell eines sozialen Netzwerks vor.  <code>User</code> kennt Freunde <code>friends</code> .  Benutzer leben in der Stadt, und die Stadt kennt ihre Einwohner √ºber das <code>citizens</code> .  Folgendes ist ein Graph eines solchen Modells in GraphQL: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/5e8/2e9/ae45e82e9610ff7abb7291fbe4671062.png"><br><br>  Damit das Diagramm n√ºtzlich ist, werden nat√ºrlich auch die sogenannten ‚ÄûEinstiegspunkte‚Äú ben√∂tigt.  Ein solcher Einstiegspunkt k√∂nnte beispielsweise darin bestehen, einen Benutzer mit Namen zu erhalten. <br><br><h3>  Daten anfordern </h3><br>  Mal sehen, was die GraphQL-Abfragesprache ausmacht.  Lassen Sie uns diese Frage in diese Sprache √ºbersetzen: <i>‚ÄûF√ºr einen Benutzer namens Vanya Unicorn m√∂chte ich die Namen seiner Freunde sowie den Namen und die Bev√∂lkerung der Stadt kennen, in der Vanya lebt.‚Äú</i> <br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vanya Unicorn"</span></span>) {   friends {     name   }   city {     name     population   } } }</code> </pre> <br>  Und hier kommt die Antwort vom GraphQL-Server: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"friends"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Lena"</span></span> },       { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Stas"</span></span> }     ]     <span class="hljs-string"><span class="hljs-string">"city"</span></span>: {       <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Kyiv"</span></span>,       <span class="hljs-attr"><span class="hljs-attr">"population"</span></span>: <span class="hljs-number"><span class="hljs-number">2928087</span></span>     }   } } }</code> </pre><br>  Beachten Sie, dass das Anforderungsformular mit dem Antwortformular √ºbereinstimmt.  Es besteht das Gef√ºhl, dass diese Abfragesprache f√ºr JSON erstellt wurde.  Mit starker Eingabe.  All dies geschieht in einer HTTP-POST-Anforderung - Sie m√ºssen nicht mehrere Anrufe beim Server t√§tigen. <br><br>  Mal sehen, wie es in der Praxis aussieht.  √ñffnen wir die Standardkonsole f√ºr den GraphQL-Server, der als Graph <i>i</i> QL ("graph") bezeichnet wird.  Um einen Warenkorb anzufordern, erf√ºlle ich die folgende Anfrage: <i>"Ich m√∂chte einen Warenkorb mit der Kennung 1 erhalten. Ich interessiere mich f√ºr alle Positionen dieses Warenkorbs und f√ºr Produktinformationen."</i>  <i>Aus den Informationen geht hervor, dass Name, Preis, Inventarnummer und Bilder wichtig sind (und nur die ersten).</i>  <i>Ich interessiere mich auch f√ºr die Menge dieser Produkte, ihren Preis und die Gesamtkosten im Warenkorb</i> . <i>"</i> <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br>  Nach erfolgreichem Abschluss der Anfrage erhalten wir genau das, was gefragt wurde: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf7/c04/a8e/cf7c04a8ef9d309387a6bcc935d40d10.png"><br><br><h2>  Hauptvorteile </h2><br><ul><li>  <b>Flexible Probenahme.</b>  Der Kunde kann eine Anfrage f√ºr seine spezifischen Anforderungen stellen. <br></li><li>  <b>Effektive Probenahme.</b>  Die Antwort gibt nur die angeforderten Daten zur√ºck. <br></li><li>  <b>Schnellere Entwicklung.</b>  Viele √Ñnderungen auf dem Client k√∂nnen auftreten, ohne dass auf der Serverseite √Ñnderungen vorgenommen werden m√ºssen.  Anhand unseres Beispiels k√∂nnen Sie beispielsweise ganz einfach eine andere Ansicht des Warenkorbs f√ºr das mobile Web anzeigen. <br></li><li>  <b>N√ºtzliche Analyse.</b>  Da der Client die Felder in der Anforderung explizit angeben muss, wei√ü der Server genau, welche Felder wirklich ben√∂tigt werden.  Und dies sind wichtige Informationen f√ºr die Abschreibungspolitik. <br></li><li>  <b>Funktioniert auf jeder Datenquelle und jedem Transport.</b>  Es ist wichtig, dass Sie mit GraphQL √ºber jede Datenquelle und jeden Transport hinweg arbeiten k√∂nnen.  In diesem Fall ist HTTP kein Allheilmittel, GraphQL kann auch √ºber WebSocket funktionieren, und wir werden diesen Punkt etwas sp√§ter ansprechen. <br></li></ul><br>  Heute kann ein GraphQL-Server in fast jeder Sprache erstellt werden.  Die vollst√§ndigste Version des GraphQL-Servers ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GraphQL.js</a> f√ºr die Node-Plattform.  In der Java-Community ist die Referenzimplementierung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GraphQL Java</a> . <br><br><h2>  Erstellen Sie die GraphQL-API </h2><br>  Lassen Sie uns sehen, wie Sie einen GraphQL-Server anhand eines konkreten Lebensbeispiels erstellen. <br><br>  Stellen Sie sich eine vereinfachte Version eines Online-Shops vor, die auf einer Microservice-Architektur mit zwei Komponenten basiert: <br><br><ul><li>  Warenkorbservice f√ºr die Arbeit mit einem benutzerdefinierten Warenkorb.  Speichert Daten in einer relationalen Datenbank und verwendet SQL f√ºr den Zugriff auf Daten.  Sehr einfacher Service, ohne zu viel Magie :) <br></li><li>  Produkt-Service, der den Zugriff auf den Produktkatalog erm√∂glicht, aus dem tats√§chlich der Warenkorb gef√ºllt wird.  Bietet eine HTTP-API f√ºr den Zugriff auf Produktdaten. <br></li></ul><br>  Beide Dienste werden zus√§tzlich zum klassischen Spring Boot implementiert und enthalten bereits die gesamte Grundlogik. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f0/1e9/560/5f01e95602be2c3d88178f1327f791c6.png"><br><br>  Wir beabsichtigen, die GraphQL-API zus√§tzlich zum Cart-Service zu erstellen.  Diese API bietet Zugriff auf Warenkorbdaten und hinzugef√ºgte Produkte. <br><br><h3>  Erste Version </h3><br>  Die bereits erw√§hnte GraphQL-Referenzimplementierung f√ºr das Java-√ñkosystem - GraphQL Java - wird uns dabei helfen. <br><br>  F√ºgen Sie <code>pom.xml:</code> einige Abh√§ngigkeiten hinzu <code>pom.xml:</code> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>9.3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-java-tools<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.2.4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.graphql-java<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>graphiql-spring-boot-starter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>5.0.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Zus√§tzlich zu dem zuvor erw√§hnten <code>graphql-java</code> ben√∂tigen wir eine <code>graphql-java-tools,</code> Bibliothek mit <code>graphql-java-tools,</code> sowie Spring Boot-Starter f√ºr GraphQL, die die ersten Schritte zum Erstellen eines GraphQL-Servers erheblich vereinfachen: <br><br><ul><li>  <i>graphql-spring-boot-Starter</i> bietet einen Mechanismus zum schnellen Verbinden von GraphQL Java mit Spring Boot. <br></li><li>  <i>graphiql-spring-boot-Starter</i> f√ºgt eine interaktive Graph <i>i</i> QL-Webkonsole hinzu, um GraphQL-Abfragen auszuf√ºhren. <br></li></ul><br>  Der n√§chste wichtige Schritt ist die Bestimmung des graphQL-Dienstschemas, unseres Graphen.  Die Knoten dieses Diagramms werden mithilfe von <i>Typen</i> und die Kanten mithilfe von <i>Feldern beschrieben</i> .  Eine leere Diagrammdefinition sieht folgenderma√üen aus: <br><br><pre> <code class="javascript hljs">schema { }</code> </pre> <br>  Wie Sie sich erinnern, gibt es in diesem Schema ‚ÄûEinstiegspunkte‚Äú oder Abfragen der obersten Ebene.  Sie werden √ºber das <i>Abfragefeld</i> im Schema definiert.  Rufen Sie unseren Typ f√ºr <i>EntryPoints-</i> Einstiegspunkte an: <br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints }</code> </pre><br>  Wir definieren darin eine Korbsuche nach Kennung als ersten Einstiegspunkt: <br><br><pre> <code class="javascript hljs">type EntryPoints { cart(id: Long!): Cart }</code> </pre><br>  <code>Cart</code> ist in GraphQL nichts anderes als ein <i>Feld</i> .  <code>id</code> ist ein Parameter dieses Feldes mit dem Skalartyp <code>Long</code> .  Ausrufezeichen <code>!</code>  Nach Angabe des Typs ist der Parameter erforderlich. <br><br>  Es ist Zeit, <code>Cart</code> zu identifizieren und <code>Cart</code> : <br><br><pre> <code class="javascript hljs">type Cart { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: Long! items: [CartItem!]! subTotal: BigDecimal! }</code> </pre><br>  Zus√§tzlich zur Standard- <code>id</code> der Warenkorb seine <code>subTotal</code> und den Betrag f√ºr alle <code>subTotal</code> .  Beachten Sie, dass <i>Elemente</i> als Liste definiert <i>sind</i> , wie in eckigen Klammern <code>[]</code> .  Elemente dieser Liste sind <code>CartItem</code> Typen.  Das Vorhandensein eines Ausrufezeichens nach dem Namen des Feldtyps <code>!</code>  zeigt an, dass das Feld erforderlich ist.  Dies bedeutet, dass der Server zustimmt, einen nicht leeren Wert f√ºr dieses Feld zur√ºckzugeben, wenn einer angefordert wurde. <br><br>  Es bleibt die Definition des <code>CartItem</code> Typs zu <code>CartItem</code> , die einen Link zum Produkt ( <i>productId</i> ) enth√§lt, wie oft es dem Warenkorb hinzugef√ºgt wird ( <code>quantity</code> ) und die Menge des Produkts, berechnet anhand der Anzahl ( <code>total</code> ): <br><br><pre> <code class="javascript hljs">type CartItem { <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! quantity: Int! total: BigDecimal! }</code> </pre><br>  Hier ist alles einfach - alle Felder von Skalartypen sind obligatorisch. <br><br>  Dieses Schema wurde nicht zuf√§llig gew√§hlt.  Der Cart-Service hat den Cart-Warenkorb und seine <code>CartItem</code> Elemente bereits mit genau denselben Feldnamen und -typen wie im GraphQL-Schema definiert.  Das Wagenmodell verwendet die Lombok-Bibliothek zum automatischen Generieren von Gettern / Setzern, Konstruktoren und anderen Methoden.  JPA wird f√ºr die Persistenz in der Datenbank verwendet. <br><br>  <code>Cart</code> : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Id</span></span>   <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id;   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;CartItem&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSubTotal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getItems().stream()               .map(Item::getTotal)               .reduce(BigDecimal.ZERO, BigDecimal::add);   } }</code> </pre><br>  <code>CartItem</code> Klasse: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.AllArgsConstructor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> lombok.Data; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Column; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.persistence.Embeddable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.math.BigDecimal; <span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  Der Korb ( <code>Cart</code> ) und die Basket-Elemente ( <code>CartItem</code> ) werden daher sowohl im GraphQL-Diagramm als auch im Code beschrieben und sind je nach Feldsatz und Typ ‚Äûmiteinander kompatibel‚Äú.  Dies reicht jedoch immer noch nicht aus, damit unser Service funktioniert. <br><br>  Wir m√ºssen genau kl√§ren, wie der Einstiegspunkt " <code>cart(id: Long!): Cart</code> " funktioniert.  Erstellen Sie dazu eine √§u√üerst einfache Java-Konfiguration f√ºr Spring mit einer Bean vom Typ GraphQLQueryResolver.  GraphQLQueryResolver beschreibt nur die "Einstiegspunkte" im Schema.  Wir definieren eine Methode mit einem Namen, der mit dem Feld am Einstiegspunkt ( <code>cart</code> ) identisch ist, machen sie nach Parametertyp kompatibel und verwenden <code>cartService</code> , um denselben Warenkorb anhand der Kennung zu finden: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLQueryResolver </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">queryResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLQueryResolver () {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);       }   } }</code> </pre><br>  Diese √Ñnderungen reichen aus, um eine funktionierende Anwendung zu erhalten.  Nach dem Neustart des Cart-Dienstes in der GraphiQL-Konsole wird die folgende Abfrage erfolgreich ausgef√ºhrt: <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     productId     quantity     total   }   subTotal } }</code> </pre> <br><h3>  Hinweis </h3><br><ul><li>  Wir verwenden die Skalartypen <code>Long</code> und <code>String</code> als eindeutige Kennungen f√ºr den Warenkorb und das Produkt.  GraphQL hat f√ºr solche Zwecke einen speziellen Typ - <code>ID</code> .  Semantisch ist dies eine bessere Wahl f√ºr eine echte API.  Werte vom Typ <code>ID</code> k√∂nnen als Schl√ºssel f√ºr das Caching verwendet werden. <br></li><li>  In dieser Phase der Entwicklung unserer Anwendung sind die internen und externen Dom√§nenmodelle vollst√§ndig identisch.  Wir sprechen √ºber die <code>CartItem</code> <code>Cart</code> und <code>CartItem</code> und ihre direkte Verwendung in GraphQL-Resolvern.  In Kampfanwendungen wird empfohlen, diese Modelle zu trennen.  F√ºr GraphQL-Resolver muss ein vom internen Themenbereich getrenntes Modell vorhanden sein. <br></li></ul><br><h3>  Die API n√ºtzlich machen </h3><br>  Wir haben also das erste Ergebnis erzielt, und das ist wunderbar.  Aber jetzt ist unsere API zu primitiv.  Bisher gibt es beispielsweise keine M√∂glichkeit, n√ºtzliche Daten zu einem Produkt anzufordern, z. B. Name, Preis, Artikel, Bilder usw.  Stattdessen gibt es nur eine <code>productId</code> .  Lassen Sie uns die API wirklich n√ºtzlich machen und das Produktkonzept vollst√§ndig unterst√ºtzen.  So sieht seine Definition im Diagramm aus: <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images: [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre><br>  F√ºgen Sie <code>CartItem</code> das erforderliche Feld <code>CartItem</code> , und <code>productId</code> Feld productId als veraltet: <br><br><pre> <code class="javascript hljs">type Item { <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: Int! product: Product! productId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! @deprecated(reason: <span class="hljs-string"><span class="hljs-string">"don't use it!"</span></span>) total: BigDecimal! }</code> </pre> <br>  Wir haben das Schema herausgefunden.  Und jetzt ist es Zeit zu beschreiben, wie die Auswahl f√ºr das <code>product</code> funktionieren wird.  Wir haben uns zuvor auf Getter in den <code>CartItem</code> <code>Cart</code> und <code>CartItem</code> , mit denen GraphQL Java Werte automatisch binden konnte.  An dieser Stelle sei jedoch daran erinnert, dass nur die <code>product</code> in der <code>CartItem</code> Klasse nicht: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Embeddable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-meta"><span class="hljs-meta">@AllArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartItem</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String productId;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quantity;   <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal total; }</code> </pre><br>  Wir haben die Wahl: <br><br><ol><li>  F√ºgen Sie die <i>Produkteigenschaft</i> zu <i>CartItem hinzu</i> und <i>lernen</i> Sie, wie Produktdaten empfangen werden. <br></li><li>  Bestimmen Sie, wie Sie das <i>Produkt erhalten,</i> ohne die <i>CartItem-</i> Klasse zu √§ndern. <br></li></ol><br>  Der zweite Weg ist vorzuziehen, da das Modell der Beschreibung der internen Dom√§ne ( <code>CartItem</code> Klasse) in diesem Fall nicht mit Details zur Implementierung der Graph <i>i</i> QL-API behandelt wird. <br><br>  Um dieses Ziel zu erreichen, hilft die GraphQLResolver-Markierungsoberfl√§che.  Durch die Implementierung k√∂nnen Sie festlegen (oder √ºberschreiben), wie die Feldwerte f√ºr Typ <code>T</code>  So sieht die entsprechende Bean in der Spring-Konfiguration aus: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;CartItem&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cartItemResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;CartItem&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartItem item)</span></span></span><span class="hljs-function"> </span></span>{           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(<span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,                   Product.class,                   item.getProductId());       }   }; }</code> </pre> <br>  Der Name der <code>product</code> wurde nicht zuf√§llig gew√§hlt.  GraphQL Java sucht nach Daten-Downloader-Methoden nach Feldnamen, und wir mussten nur einen Loader f√ºr das <code>product</code> definieren!  Ein als Parameter √ºbergebenes Objekt vom Typ <code>CartItem</code> definiert den Kontext, in dem das Produkt ausgew√§hlt wird.  Weiter ist eine Frage der Technologie.  Mit einem <code>http</code> Client wie <code>RestTemplate</code> wir eine GET-Anforderung an den Produktservice und konvertieren das Ergebnis in ein <code>Product</code> , das folgenderma√üen aussieht: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String id;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String title;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal price;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String description;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String sku;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;String&gt; images; }</code> </pre> <br>  Diese √Ñnderungen sollten ausreichen, um ein interessanteres Beispiel zu implementieren, das die tats√§chliche Beziehung zwischen dem Warenkorb und den hinzugef√ºgten Produkten enth√§lt. <br><br>  Nach dem Neustart der Anwendung k√∂nnen Sie eine neue Abfrage in der Graph <i>i</i> QL-Konsole versuchen. <br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images     }     quantity     total   }   subTotal } }</code> </pre><br>  Und hier ist das Ergebnis der Abfrageausf√ºhrung: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c8/778/3f4/0c87783f4f843696b9900771c2b2860e.png"><br><br>  Obwohl <code>productId</code> als <code>@deprecated</code> markiert wurde, <code>@deprecated</code> Abfragen, die dieses Feld <code>@deprecated</code> , weiterhin.  Die Graph <i>i</i> QL-Konsole bietet jedoch keine automatische Vervollst√§ndigung f√ºr solche Felder und hebt deren Verwendung auf besondere Weise hervor: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afc/96a/d45/afc96ad45f3f4372a8e86cf78b892acd.png"><br><br>  Es ist Zeit, den Dokument-Explorer anzuzeigen, der Teil der Graph <i>i</i> QL-Konsole ist, die auf der Grundlage des GraphQL-Schemas erstellt wurde und Informationen zu allen definierten Typen anzeigt.  So sieht der Dokument-Explorer f√ºr den <code>CartItem</code> Typ aus: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f83/c04/38b/f83c0438b2f906b34414b764182a37fc.png"><br><br>  Aber zur√ºck zum Beispiel.  Um die gleiche Funktionalit√§t wie in der ersten Demo zu erreichen, ist die Anzahl der zur√ºckgegebenen Bilder immer noch nicht ausreichend begrenzt.  F√ºr einen Warenkorb ben√∂tigen Sie beispielsweise nur ein Bild f√ºr jedes Produkt: <br><br><pre> <code class="javascript hljs">images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  √Ñndern Sie dazu das Schema und f√ºgen Sie dem <i>Produkttyp</i> einen neuen Parameter f√ºr das Bildfeld hinzu: <br><br><pre> <code class="javascript hljs">type Product { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: ID! title: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! price: BigDecimal! description: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> sku: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>! images(limit: Int = <span class="hljs-number"><span class="hljs-number">0</span></span>): [<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!]! }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Und im Anwendungscode werden wir ihn wieder verwenden </font></font><code>GraphQLResolver</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, nur diesmal nach Typ </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> GraphQLResolver&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">productResolver</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GraphQLResolver&lt;Product&gt;() {       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span><span class="hljs-function"> </span></span>{           List&lt;String&gt; images = product.getImages();           <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();           <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));       }   }; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich mache erneut darauf aufmerksam, dass der Name der Methode nicht zuf√§llig ist: Er stimmt mit dem Namen des Feldes √ºberein </font></font><code>images</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Das Kontextobjekt erm√∂glicht </font></font><code>Product</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">den Zugriff auf Bilder und </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ist ein Parameter des Felds selbst. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn der Kunde nichts als Wert f√ºr angegeben hat </font></font><code>limit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, gibt unser Service alle Bilder des Produkts zur√ºck. </font><font style="vertical-align: inherit;">Wenn der Client einen bestimmten Wert angegeben hat, gibt der Service genau so viel zur√ºck (jedoch nicht mehr als im Produkt enthalten). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir kompilieren das Projekt und warten, bis der Server neu gestartet wird. </font><font style="vertical-align: inherit;">Wenn Sie die Schaltung in der Konsole neu starten und die Anforderung ausf√ºhren, sehen Sie, dass eine vollst√§ndige Anforderung wirklich funktioniert.</font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title       price       sku       images(limit: <span class="hljs-number"><span class="hljs-number">1</span></span>)     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stimmen Sie zu, das alles ist sehr cool. </font><font style="vertical-align: inherit;">In kurzer Zeit haben wir nicht nur gelernt, was GraphQL ist, sondern auch ein einfaches Microservice-System √ºbertragen, um eine solche API zu unterst√ºtzen. </font><font style="vertical-align: inherit;">Und es war uns egal, woher die Daten stammten: Sowohl die SQL- als auch die HTTP-APIs passen gut unter ein Dach.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Code-First- und GraphQL SPQR-Ansatz </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√∂glicherweise haben Sie bemerkt, dass w√§hrend des Entwicklungsprozesses einige Unannehmlichkeiten aufgetreten sind, n√§mlich die Notwendigkeit, das GraphQL-Schema und den Code st√§ndig synchron zu halten. Typ√§nderungen mussten immer an zwei Stellen durchgef√ºhrt werden. In vielen F√§llen ist es bequemer, den Code-First-Ansatz zu verwenden. Das Wesentliche ist, dass das Schema f√ºr GraphQL automatisch aus dem Code generiert wird. In diesem Fall m√ºssen Sie die Schaltung nicht separat warten. Jetzt werde ich zeigen, wie es aussieht. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nur die Grundfunktionen von GraphQL Java reichen uns nicht aus, wir ben√∂tigen auch die GraphQL SPQR-Bibliothek. Die gute Nachricht ist, dass GraphQL SPQR ein Add-On f√ºr GraphQL Java ist und keine alternative Implementierung des GraphQL-Servers in Java. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie die gew√ºnschte Abh√§ngigkeit hinzu zu </font></font><code>pom.xml</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.leangen.graphql<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>spqr<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.9.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hier ist der Code, der dieselbe GraphQL SPQR-basierte Funktionalit√§t f√ºr den Warenkorb implementiert: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> CartService cartService;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CartGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CartService cartService)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cartService = cartService;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"cart"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id) </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.findCart(id);   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und f√ºr das Produkt: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RestTemplate http;   <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductGraph</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RestTemplate http)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.http = http;   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(               <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,               Product.class,               cartItem.getProductId()       );   }   <span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"images"</span></span>)   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext Product product,                              @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"limit"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> limit) </span></span>{       List&lt;String&gt; images = product.getImages();       <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> normalizedLimit = limit &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? limit : images.size();       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images.subList(<span class="hljs-number"><span class="hljs-number">0</span></span>, Math.min(normalizedLimit, images.size()));   } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Annotation @GraphQLQuery wird verwendet, um Feldlademethoden zu kennzeichnen. </font><font style="vertical-align: inherit;">Die Anmerkung </font></font><code>@GraphQLContext</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definiert die Art der Auswahl f√ºr das Feld. </font><font style="vertical-align: inherit;">Und die Anmerkung </font></font><code>@GraphQLArgument</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">markiert deutlich die Argumentparameter. </font><font style="vertical-align: inherit;">All dies sind Teile eines Mechanismus, mit dem GraphQL SPQR automatisch ein Schema generieren kann. </font><font style="vertical-align: inherit;">Wenn Sie nun die alte Java-Konfiguration und das alte Java-Schema l√∂schen und den Cart-Dienst mit den neuen Chips von GraphQL SPQR neu starten, k√∂nnen Sie sicherstellen, dass alles auf die gleiche Weise wie zuvor funktioniert.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir l√∂sen das Problem von N + 1 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist Zeit , </font><font style="vertical-align: inherit;">zu b sehen </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> lshih Detail , </font><font style="vertical-align: inherit;">wie die Umsetzung der gesamten Anfrage ‚Äûunter der Haube‚Äú. Wir haben die GraphQL-API schnell erstellt, aber funktioniert sie effizient? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Betrachten Sie das folgende Beispiel: Das </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/05c/626/303/05c62630323d9ad9eeb97999c19fcd04.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abrufen des Warenkorbs </font></font><code>cart</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erfolgt in einer SQL-Abfrage an die Datenbank. Daten auf </font></font><code>items</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und werden </font></font><code>subtotal</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dort zur√ºckgegeben, da die Warenkorbelemente mit der gesamten Sammlung geladen werden, basierend auf der eifrigen Abruf-JPA-Strategie:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Data</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cart</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-meta"><span class="hljs-meta">@ElementCollection</span></span>(fetch = FetchType.EAGER)   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Item&gt; items = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;();   ... }</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/674/0e4/863/6740e4863b4847f782f64588e52ecc36.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn es darum geht, Daten zu Produkten herunterzuladen, werden Anfragen nach einem Produktservice genauso ausgef√ºhrt wie in diesem Produktkorb. Wenn sich drei verschiedene Produkte im Warenkorb befinden, erhalten wir drei Anfragen an die HTTP-API des Produktservices. Wenn zehn davon vorhanden sind, muss derselbe Service zehn solcher Anfragen beantworten. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/92c/9c0/b1a/92c9c0b1a06c15f081c0eb9dc9ce8a1f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist die Kommunikation zwischen dem Cart-Service und dem Product-Service in Charles Proxy: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/8df/d08/c158dfd08badf133f49499baa43c1970.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dementsprechend kehren wir zum klassischen N + 1-Problem zur√ºck. Genau die, von der sie sich am Anfang des Berichts so sehr bem√ºht haben, wegzukommen. Zweifellos haben wir Fortschritte, da genau eine Anforderung zwischen dem Endclient und unserem System ausgef√ºhrt wird. Innerhalb des Server-√ñkosystems muss die Leistung jedoch deutlich verbessert werden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ich m√∂chte dieses Problem l√∂sen, indem ich alle richtigen Produkte in einer Anfrage erhalte. </font><font style="vertical-align: inherit;">Gl√ºcklicherweise unterst√ºtzt der Produktservice diese Funktion bereits √ºber einen Parameter </font></font><code>ids</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in der Erfassungsressource:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=:id1,:id2,...,:idn</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lassen Sie uns sehen, wie Sie den Beispielmethodencode f√ºr das </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Produktfeld</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √§ndern k√∂nnen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Vorherige Version:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext CartItem cartItem)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products/{id}"</span></span>,           Product.class,           cartItem.getProductId()   ); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ersetzen Sie durch eine effektivere: </font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}"</span></span>,           Products.class,           productIds   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Wir haben genau drei Dinge getan: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">markierte die Bootloader-Methode mit der Annotation </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@Batched</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , um GraphQL SPQR klar zu machen, dass das Laden mit einem Stapel erfolgen sollte;</font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der R√ºckgabetyp und der Kontextparameter wurden in eine Liste ge√§ndert, da bei der Arbeit mit dem Stapel davon ausgegangen wird, dass mehrere Objekte akzeptiert und zur√ºckgegeben werden. </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √§nderte den Hauptteil der Methode und implementierte eine Auswahl aller erforderlichen Produkte gleichzeitig. </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Diese √Ñnderungen reichen aus, um unser N + 1-Problem zu l√∂sen. </font><font style="vertical-align: inherit;">Das Charles Proxy-Anwendungsfenster zeigt jetzt eine Anforderung an den Produktservice an, der drei Produkte gleichzeitig zur√ºckgibt:</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/806/98d/5c280698dfbdf383cf44052f51a09ae8.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Effektive Feldproben </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben das Hauptproblem gel√∂st, aber Sie k√∂nnen die Auswahl noch schneller treffen! </font><font style="vertical-align: inherit;">Jetzt gibt der Produktservice alle Daten zur√ºck, unabh√§ngig davon, was der Endkunde ben√∂tigt. </font><font style="vertical-align: inherit;">Wir k√∂nnten die Abfrage verbessern und nur die angeforderten Felder zur√ºckgeben. </font><font style="vertical-align: inherit;">Wenn der Endkunde beispielsweise nicht nach dem Bild gefragt hat, warum m√ºssen wir sie dann an den Warenkorbservice √ºbertragen? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es ist gro√üartig, dass die HTTP-API des Produktservices diese Funktion bereits √ºber den Parameter </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">include</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> f√ºr dieselbe Erfassungsressource unterst√ºtzt:</font></font><br><br><pre> <code class="plaintext hljs">GET /products?ids=...?include=:field1,:field2,...,:fieldN</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºgen Sie f√ºr die Bootloader-Methode einen Parameter vom Typ Set with annotation hinzu </font></font><code>@GraphQLEnvironment</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">GraphQL SPQR versteht, dass der Code in diesem Fall eine Liste von Feldnamen "anfordert", die f√ºr das Produkt angefordert werden, und diese automatisch ausf√ºllt:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Batched</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@GraphQLContext List&lt;Item&gt; items,                             @GraphQLEnvironment Set&lt;String&gt; fields)</span></span></span><span class="hljs-function"> </span></span>{   String productIds = items.stream()           .map(Item::getProductId)           .collect(Collectors.joining(<span class="hljs-string"><span class="hljs-string">","</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> http.getForObject(           <span class="hljs-string"><span class="hljs-string">"http://localhost:9090/products?ids={ids}&amp;include={fields}"</span></span>,           Products.class,           productIds,           String.join(<span class="hljs-string"><span class="hljs-string">","</span></span>, fields)   ).getProducts(); }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Jetzt ist unsere Stichprobe wirklich effektiv, ohne das N + 1-Problem und verwendet nur die erforderlichen Daten: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/592/98f/24259298fe8acb19d21e04083689d5dd.png"><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "Schwere" Anfragen </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie sich vor, Sie arbeiten mit einem Benutzerdiagramm in einem klassischen sozialen Netzwerk wie Facebook. </font><font style="vertical-align: inherit;">Wenn ein solches System die GraphQL-API bereitstellt, hindert nichts den Client daran, eine Anforderung der folgenden Art zu senden:</font></font><br><br><pre> <code class="javascript hljs">{ user(name: <span class="hljs-string"><span class="hljs-string">"Vova Unicorn"</span></span>) {   friends {     name     friends {       name       friends {         name         friends {            name            ...         }       }     }   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Auf der Verschachtelungsebene 5-6 f√ºhrt die vollst√§ndige Implementierung einer solchen Anforderung zu einer Auswahl aller Benutzer auf der Welt. </font><font style="vertical-align: inherit;">Der Server wird eine solche Aufgabe sicherlich nicht in einer Sitzung bew√§ltigen k√∂nnen und h√∂chstwahrscheinlich einfach ‚Äûfallen‚Äú. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Es gibt eine Reihe von Ma√ünahmen, die ergriffen werden m√ºssen, um sich vor solchen Situationen zu sch√ºtzen:</font></font><br><br><ul><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Anfragetiefe begrenzen. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mit anderen Worten, Kunden sollten nicht die M√∂glichkeit haben, Daten einer beliebigen Verschachtelung anzufordern.</font></font><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Begrenzen Sie die Komplexit√§t der Anforderung. </font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Indem Sie jedem Feld eine Gewichtung zuweisen und die Summe der Gewichte aller Felder in der Anforderung berechnen, k√∂nnen Sie solche Anforderungen auf dem Server akzeptieren oder ablehnen.</font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Betrachten Sie beispielsweise die folgende Abfrage: </font></font><br><br><pre> <code class="javascript hljs">{ cart(id: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product {       title     }     quantity   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offensichtlich betr√§gt die Tiefe einer solchen Anforderung 4, da sich der l√§ngste Pfad darin befindet </font></font><code>cart -&gt; items -&gt; product -&gt; title</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wenn wir davon ausgehen, dass die Gewichtung jedes Felds 1 betr√§gt, betr√§gt die Komplexit√§t unter Ber√ºcksichtigung von 7 Feldern in der Abfrage ebenfalls 7. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In GraphQL Java wird die √úberlagerung von Pr√ºfungen durch Angabe zus√§tzlicher Instrumente beim Erstellen des Objekts erreicht </font></font><code>GraphQL</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs">GraphQL.newGraphQL(schema)       .instrumentation(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChainedInstrumentation(Arrays.asList(               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryComplexityInstrumentation(<span class="hljs-number"><span class="hljs-number">20</span></span>),               <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaxQueryDepthInstrumentation(<span class="hljs-number"><span class="hljs-number">3</span></span>)       )))       .build();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Instrumentierung </font></font><code>MaxQueryDepthInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ºberpr√ºft die Tiefe der Anforderung und l√§sst nicht zu, dass zu "tiefe" Anforderungen gestartet werden (in diesem Fall mit einer Tiefe von mehr als 3). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Instrumentierung </font></font><code>MaxQueryComplexityInstrumentation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vor der Ausf√ºhrung einer Abfrage z√§hlt und √ºberpr√ºft ihre Komplexit√§t. Wenn diese Zahl den angegebenen Wert (20) √ºberschreitet, wird eine solche Anforderung abgelehnt. Sie k√∂nnen das Gewicht f√ºr jedes Feld neu definieren, da einige von ihnen offensichtlich "h√§rter" werden als andere. Beispielsweise kann dem Produktfeld durch die </font></font><code>@GraphQLComplexity,</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in GraphQL SPQR unterst√ºtzte </font><font style="vertical-align: inherit;">Anmerkung </font><font style="vertical-align: inherit;">die </font><font style="vertical-align: inherit;">Komplexit√§t 10 zugewiesen werden </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLQuery</span></span>(name = <span class="hljs-string"><span class="hljs-string">"product"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@GraphQLComplexity</span></span>(<span class="hljs-string"><span class="hljs-string">"10"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">products</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...)</span></span></span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hier ist ein Beispiel f√ºr eine Tiefenpr√ºfung, wenn sie den angegebenen Wert deutlich √ºberschreitet: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/54c/c39/584/54cc39584792997b198370c40e8b2431.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√úbrigens ist der Instrumentierungsmechanismus nicht darauf beschr√§nkt, Einschr√§nkungen aufzuerlegen. </font><font style="vertical-align: inherit;">Es kann auch f√ºr andere Zwecke verwendet werden, z. B. zum Protokollieren oder Verfolgen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben die f√ºr GraphQL spezifischen Schutzma√ünahmen untersucht. </font><font style="vertical-align: inherit;">Es gibt jedoch eine Reihe von Tricks, die unabh√§ngig von der Art der API beachtet werden sollten:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Drosselung / Ratenbegrenzung - Begrenzen Sie die Anzahl der Anforderungen pro Zeiteinheit </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Zeit√ºberschreitungen - Zeitlimit f√ºr Operationen mit anderen Diensten, Datenbanken usw.; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Paginierung - Paginierungsunterst√ºtzung. </font></font><br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mutation von Daten </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bisher haben wir eine reine Datenerfassung in Betracht gezogen. </font><font style="vertical-align: inherit;">Mit GraphQL k√∂nnen Sie jedoch nicht nur den Empfang von Daten, sondern auch deren √Ñnderung organisch organisieren. </font><font style="vertical-align: inherit;">Daf√ºr gibt es einen Mechanismus </font></font><code></code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In dem Schema ist hierf√ºr ein besonderer Platz reserviert - das Feld </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: EntryPoints, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Das Hinzuf√ºgen eines Produkts zu einem Warenkorb kann beispielsweise durch die folgende Mutation organisiert werden: </font></font><br><br><pre> <code class="javascript hljs">type Mutations {   addProductToCart(cartId: Long!,                    <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!,                    <span class="hljs-attr"><span class="hljs-attr">count</span></span>: Int = <span class="hljs-number"><span class="hljs-number">1</span></span>): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies √§hnelt dem Definieren eines Felds, da eine Mutation auch Parameter und einen R√ºckgabewert enth√§lt. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Die Implementierung einer Mutation im Servercode mit GraphQL SPQR ist wie folgt:</font></font><br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@GraphQLMutation</span></span>(name = <span class="hljs-string"><span class="hljs-string">"addProductToCart"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Cart </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addProductToCart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(       @GraphQLArgument(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cartId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long cartId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"productId"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String productId,       @</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphQLArgument</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"quantity"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, defaultValue = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"1"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> quantity) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cartService.addProductToCart(cartId, productId, quantity); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nat√ºrlich wird der gr√∂√üte Teil der n√ºtzlichen Arbeit intern erledigt </font></font><code>cartService</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Die Aufgabe dieser Interlayer-Methode besteht darin, sie der API zuzuordnen. Wie bei der Datenerfassung ist dank Anmerkungen </font></font><code>@GraphQL*</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sehr leicht zu verstehen, welches GraphQL-Schema aus dieser Methodendefinition generiert wird. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der GraphQL-Konsole k√∂nnen Sie jetzt eine Mutationsanforderung ausf√ºhren, um ein bestimmtes Produkt in einer Menge von 2 in unseren Warenkorb zu legen:</font></font><br><br><pre> <code class="javascript hljs">mutation { addProductToCart(     cartId: <span class="hljs-number"><span class="hljs-number">1</span></span>,     <span class="hljs-attr"><span class="hljs-attr">productId</span></span>: <span class="hljs-string"><span class="hljs-string">"59eb83c0040fa80b29938e3f"</span></span>,     <span class="hljs-attr"><span class="hljs-attr">quantity</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>) {   items {     product {       title     }     quantity     total   }   subTotal } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Da die Mutation einen R√ºckgabewert hat, ist es m√∂glich, Felder nach denselben Regeln wie bei normalen Stichproben anzufordern. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mehrere WIX-Entwicklungsteams verwenden GraphQL aktiv mit Scala und der Sangria-Bibliothek, der Hauptimplementierung von GraphQL in dieser Sprache. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine der n√ºtzlichen Techniken in WIX ist die Unterst√ºtzung von GraphQL-Abfragen beim Rendern von HTML. </font><font style="vertical-align: inherit;">Wir tun dies, um JSON direkt im Seitencode zu generieren. </font><font style="vertical-align: inherit;">Hier ist ein Beispiel zum F√ºllen einer HTML-Vorlage:</font></font><br><br><pre> <code class="xml hljs">// Pre-rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-embedded-graphiql</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> {   product(productId: $productId)     title     description     price     ...   } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Und hier ist die Ausgabe: </font></font><br><br><pre> <code class="xml hljs">// Rendered <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.DATA = {   </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">product</span></span></span><span class="javascript">: {          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">title</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'GraphQL Sticker'</span></span></span><span class="javascript">,          </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">description</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'High quality sticker'</span></span></span><span class="javascript">,           </span><span class="hljs-attr"><span class="javascript"><span class="hljs-attr">price</span></span></span><span class="javascript">: </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">'$2'</span></span></span><span class="javascript">           ... } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eine solche Kombination aus HTML-Renderer und GraphQL-Server erm√∂glicht es uns, unsere API maximal wiederzuverwenden und keine zus√§tzliche Ebene von Controllern zu erstellen. </font><font style="vertical-align: inherit;">Dar√ºber hinaus erweist sich diese Technik h√§ufig als vorteilhaft f√ºr die Leistung, da die JavaScript-Anwendung nach dem Laden der Seite nicht f√ºr die ersten erforderlichen Daten zum Backend gehen muss - sie befindet sich bereits auf der Seite.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nachteile von GraphQL </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heute nutzt GraphQL eine gro√üe Anzahl von Unternehmen, darunter Giganten wie GitHub, Yelp, Facebook und viele andere. </font><font style="vertical-align: inherit;">Und wenn Sie sich entscheiden, sich ihrer Nummer anzuschlie√üen, sollten Sie nicht nur die Vorteile von GraphQL kennen, sondern auch die Nachteile, und es gibt viele davon:</font></font><br><br><ul><li> -,  GraphQL <b>     </b> .  GraphQL      ,   HTTP API.  <i>Cache-Control</i>  <i>Last-Modified</i>    HTTP      GraphQL API.         ,  proxy  gateways (Varnish, Fastly  ).   , GraphQL    ,    ,   . <br></li><li>   GraphQL ‚Äî <b>    </b> .    ,         API,    ,       . <br></li><li> <b> </b>  GraphQL       .        . <br></li><li>  <b>     </b> . GraphQL ‚Äî       .     JSON  XML, , ,          GraphQL,       . <br></li><li>  GraphQL <b>   </b> . ,       HTTP   <i>PUT</i>     <i>POST</i>  -.   ,       .    GraphQL       .        . <br></li><li> <b>   </b> . ,     -: ¬´delete¬ª  ¬´kill¬ª, ¬´annihilate¬ª  ¬´terminate¬ª,    .   GraphQL API    .   HTTP          <i>DELETE</i> . <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Joker 2016   </a>   .  GraphQL <b>      </b> .  API-   ,   ,    ,     HATEOAS,     ,   ¬´ REST¬ª. ,     ,  GraphQL     . <br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Denken Sie auch daran, dass Sie die GraphQL-API h√∂chstwahrscheinlich nicht entwickeln k√∂nnen, wenn es Ihnen nicht gelungen ist, die HTTP-API gut zu entwickeln. Was ist schlie√ülich bei der Entwicklung einer API am wichtigsten? Trennen Sie das interne Dom√§nenmodell vom externen API-Modell. Erstellen Sie eine API basierend auf Verwendungsszenarien, nicht auf dem internen Ger√§t der Anwendung. √ñffnen Sie nur die erforderlichen Mindestinformationen und nicht alle hintereinander. W√§hlen Sie die richtigen Namen. Beschreiben Sie das Diagramm richtig. In der HTTP-API gibt es ein Ressourcendiagramm und in der GraphQL-API ein Felddiagramm. In beiden F√§llen muss dieses Diagramm qualitativ erstellt werden.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In der HTTP-API-Welt gibt es Alternativen, und Sie m√ºssen GraphQL nicht immer verwenden, wenn Sie komplexe Auswahlen ben√∂tigen. </font><font style="vertical-align: inherit;">Zum Beispiel gibt es den OData-Standard, der teilweise und expandierende Auswahlen wie GraphQL unterst√ºtzt und auf HTTP aufbaut. </font><font style="vertical-align: inherit;">Es gibt eine Standard-JSON-API, die mit JSON zusammenarbeitet und Hypermedia- und komplexe Abruffunktionen unterst√ºtzt. </font><font style="vertical-align: inherit;">Es gibt auch LinkRest, √ºber das Sie mehr aus dem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://youtu.be/EsldBtrb1Qc "&gt; Bericht von Andrus Adamchik</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √ºber Joker 2017 </font><font style="vertical-align: inherit;">erfahren k√∂nnen </font><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F√ºr diejenigen, die GraphQL ausprobieren m√∂chten, empfehle ich dringend, Vergleichsartikel von Ingenieuren zu lesen, die sich gut auskennen REST und GraphQL aus praktischer und philosophischer Sicht:</font></font><br><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://philsturgeon.uk/api/2017/01/24/graphql-vs-rest-overview/</font></font></a> <br></li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://blog.runscope.com/posts/you-might-not-need-graphql</font></font></a> <br></li></ul><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zum Schluss √ºber Abonnements und </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aufschub</font></font></a> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GraphQL hat einen interessanten Vorteil gegen√ºber Standard-APIs. </font><font style="vertical-align: inherit;">In GraphQL k√∂nnen sowohl synchrone als auch asynchrone Anwendungsf√§lle unter einem Dach sitzen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wir haben √ºberlegt, Daten √ºber Sie zu empfangen </font></font><code>query</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">und den Status des Servers durch zu √§ndern </font></font><code>mutation</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, aber es gibt noch eine weitere G√ºte. </font><font style="vertical-align: inherit;">Zum Beispiel die M√∂glichkeit, Abonnements zu organisieren </font></font><code>subscriptions</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stellen Sie sich vor, ein Kunde m√∂chte Benachrichtigungen √ºber das asynchrone Hinzuf√ºgen eines Produkts zum Warenkorb erhalten. </font><font style="vertical-align: inherit;">√úber die GraphQL-API kann dies basierend auf einem solchen Schema erfolgen:</font></font><br><br><pre> <code class="javascript hljs">schema { <span class="hljs-attr"><span class="hljs-attr">query</span></span>: Queries, <span class="hljs-attr"><span class="hljs-attr">mutation</span></span>: Mutations, <span class="hljs-attr"><span class="hljs-attr">subscription</span></span>: Subscriptions } type Subscriptions { productAdded(cartId: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>!): Cart }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Kunde kann sich √ºber folgende Anfrage anmelden: </font></font><br><br><pre> <code class="javascript hljs">subscription { productAdded(cart: <span class="hljs-number"><span class="hljs-number">1</span></span>) {   items {     product ...   }   subTotal } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jedes Mal, wenn ein Produkt zum Warenkorb 1 hinzugef√ºgt wird, sendet der Server jedem abonnierten Client eine Nachricht in WebSocket mit den angeforderten Daten im Warenkorb. </font><font style="vertical-align: inherit;">Wenn Sie die GraphQL-Richtlinie fortsetzen, werden nur die Daten angezeigt, die der Client beim Abonnieren angefordert hat:</font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"productAdded"</span></span>: {     <span class="hljs-attr"><span class="hljs-attr">"items"</span></span>: [       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ },       { <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>: ‚Ä¶, <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: ‚Ä¶ }     ],     <span class="hljs-attr"><span class="hljs-attr">"subTotal"</span></span>: <span class="hljs-number"><span class="hljs-number">289.33</span></span>   } } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der Kunde kann jetzt den Warenkorb neu zeichnen, nicht unbedingt die gesamte Seite. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dies ist praktisch, da sowohl die synchrone API (HTTP) als auch die asynchrone API (WebSocket) √ºber GraphQL beschrieben werden k√∂nnen. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ein weiteres Beispiel f√ºr die Verwendung der asynchronen Kommunikation ist der </font></font><i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Verz√∂gerungsmechanismus</font></font></a></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Die Hauptidee ist, dass der Client ausw√§hlt, welche Daten er sofort (synchron) empfangen m√∂chte und welche er sp√§ter (asynchron) empfangen m√∂chte. </font><font style="vertical-align: inherit;">Zum Beispiel f√ºr eine solche Anfrage:</font></font><br><br><pre> <code class="javascript hljs">query { feedStories {   author { name }   message   comments @defer {     author { name }     message   } } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Der Server gibt zuerst den Autor und eine Nachricht f√ºr jede Geschichte zur√ºck: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"feedStories"</span></span>: [     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     },     {       <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,       <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶     }   ] } }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Danach sendet der Server, nachdem er Daten zu Kommentaren erhalten hat, diese asynchron √ºber WebSocket an den Client und gibt im Pfad an, f√ºr den Verlaufskommentare jetzt bereit sind: </font></font><br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"feedStories"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"comments"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: [   {     <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: ‚Ä¶,     <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: ‚Ä¶   } ] }</code> </pre> <br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Beispielquelle </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Der zur Erstellung dieses Berichts verwendete Code </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">befindet sich auf GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zuletzt haben wir </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JPoint 2019</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> angek√ºndigt </font><font style="vertical-align: inherit;">, das vom 5. bis 6. April 2019 stattfinden wird. </font><font style="vertical-align: inherit;">In unserem </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> erfahren Sie mehr dar√ºber, was Sie von der Konferenz erwarten k√∂nnen </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Bis zum 1. Dezember sind </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Early Bird-Tickets</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> noch </font><font style="vertical-align: inherit;">zum niedrigsten Preis erh√§ltlich.</font></font></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de428517/">https://habr.com/ru/post/de428517/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de428507/index.html">Wir schreiben einen Bot-Chat f√ºr VKontakte auf Python mit Longpoll</a></li>
<li><a href="../de428509/index.html">Wie H & M versucht, sich mit KI und Big Data zu retten</a></li>
<li><a href="../de428511/index.html">Wasserstoffenergie: Der Beginn eines langen Weges</a></li>
<li><a href="../de428513/index.html">500 Laserpointer an einem Ort</a></li>
<li><a href="../de428515/index.html">Top 3D Shop: Wie wir uns im Laufe des Jahres ver√§ndert haben - Ergebnisse f√ºr 2018</a></li>
<li><a href="../de428521/index.html">Warum gibt es keine Freunde auf GitHub. √úber Robbie Barrath, Offensichtlich und Copyright</a></li>
<li><a href="../de428523/index.html">ShadowCloud - universeller Cloud-Client</a></li>
<li><a href="../de428525/index.html">RecyclerView mit maximaler Geschwindigkeit: Analysieren von Bibliotheken</a></li>
<li><a href="../de428526/index.html">Google Steuer: 180 ¬∞ drehen</a></li>
<li><a href="../de428528/index.html">Warum Revolution√§re scharfes Essen m√∂gen oder wie Chili nach China kam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>