<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙌🏻 🦔 🐱 برنامج VMware NSX لأصغر الجزء 5. تكوين موازن الحمل 🥡 🎠 👨‍👧‍👧</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="الجزء الأول خلفية 
 الجزء الثاني تكوين جدار الحماية وقواعد NAT 
 الجزء الثالث. إعداد DHCP 
 الجزء الرابع إعداد التوجيه 

 آخر مرة تحدثنا فيها عن إمكان...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>برنامج VMware NSX لأصغر الجزء 5. تكوين موازن الحمل</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dataline/blog/448540/" style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/cs/bv/4v/csbv4vf7zldwjd6etj65xyw309o.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزء الأول</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">خلفية</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزء الثاني</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">تكوين جدار الحماية وقواعد NAT</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزء الثالث.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إعداد DHCP</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">الجزء الرابع</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">إعداد التوجيه</a> <br><br>  آخر مرة تحدثنا فيها عن إمكانيات NSX Edge من حيث التوجيه الثابت والديناميكي ، وسنتعامل اليوم مع الموازن. <br><br>  قبل متابعة الإعداد ، أود أن أذكر باختصار الأنواع الرئيسية للموازنة. <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  نظرية </h3><br>  غالبًا ما يتم تقسيم جميع حلول موازنة الحمولة الصافية الحالية إلى فئتين: الموازنة في المستويين الرابع (النقل) والسابع (المطبق) من <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">نموذج OSI</a> .  ليس نموذج OSI هو أفضل نقطة مرجعية عند وصف طرق الموازنة.  على سبيل المثال ، إذا كان موازن L4 يدعم أيضًا إنهاء TLS ، فهل يصبح موازن L7؟  ولكن هذا هو ، وهذا هو. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  غالبًا ما <b>يكون موازن L4 هو</b> الموقف الوحيد بين العميل ومجموعة من الوصلات الوسيطة للخادم الوكيل المتاح ، والذي ينهي اتصالات TCP (أي ، يستجيب بشكل مستقل لـ SYN) ، ويحدد الواجهة الخلفية ويبدأ جلسة TCP جديدة في اتجاهه ، ويرسل SYN نفسه.  هذا النوع هو واحد من الخيارات الأساسية الأخرى الممكنة. </li><li style=";text-align:right;direction:rtl">  يوزع <b>موازن L7</b> حركة المرور على الأسطح الخلفية المتاحة "أكثر تطوراً" من موازن L4.  يمكنه اتخاذ قرار بشأن الواجهة الخلفية ، على سبيل المثال ، محتويات رسالة HTTP (URL ، ملف تعريف الارتباط ، وما إلى ذلك). </li></ul><br>  بغض النظر عن النوع ، يمكن للموازن دعم الوظائف التالية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  اكتشاف الخدمة هو عملية تحديد مجموعة الخلفية المتاحة (ثابت ، DNS ، القنصل ، Etcd ، الخ). </li><li style=";text-align:right;direction:rtl">  التحقق من سلامة الخلفية المكتشفة ("ping" النشط للواجهة الخلفية باستخدام طلب HTTP ، والكشف السلبي للمشاكل في اتصالات TCP ، ووجود العديد من رموز HTTP 503 في الإجابات على التوالي ، وما إلى ذلك). </li><li style=";text-align:right;direction:rtl">  تحقيق التوازن بين نفسه (جولة روبن ، اختيار عشوائي ، مصدر IP التجزئة ، URI). </li><li style=";text-align:right;direction:rtl">  إنهاء TLS والتحقق من الشهادة. </li><li style=";text-align:right;direction:rtl">  الخيارات المتعلقة بالأمان (المصادقة ، منع هجمات حجب الخدمة ، الحد الأقصى للسرعة) وأكثر من ذلك بكثير. </li></ul><br>  يوفر NSX Edge دعمًا لوضعي نشر الموازن: <br><br>  <b>وضع الوكيل ، أو ذراع واحدة</b> .  في هذا الوضع ، عند إرسال طلب إلى أحد الخلفية ، يستخدم NSX Edge عنوان IP الخاص به كعنوان المصدر.  وبالتالي ، فإن الموازن ينفذ كل من وظائف NAT المصدر والوجهة.  ترى الواجهة الخلفية كل حركة المرور كما تم إرسالها من الموازن وتستجيب لها مباشرةً.  في هذا المخطط ، يجب أن يكون الموازن في نفس قطعة الشبكة مع الخوادم الداخلية. <br><br>  إليك كيف تسير الأمور: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يرسل المستخدم طلبًا إلى عنوان VIP (عنوان الموازن) الذي تم تكوينه على Edge. </li><li style=";text-align:right;direction:rtl">  تقوم Edge بتحديد أحد الواجهة الخلفية وتقوم بتنفيذ NAT الوجهة ، مع استبدال عنوان VIP بعنوان الواجهة الخلفية المحددة. </li><li style=";text-align:right;direction:rtl">  تقوم Edge بتشغيل مصدر NAT ، لتحل محل عنوان المستخدم الذي أرسل الطلب باسمه. </li><li style=";text-align:right;direction:rtl">  يتم إرسال الحزمة إلى الخلفية المحددة. </li><li style=";text-align:right;direction:rtl">  الواجهة الخلفية لا تستجيب مباشرة للمستخدم ، ولكن حافة ، حيث تم تغيير العنوان الأصلي للمستخدم إلى عنوان الموازن. </li><li style=";text-align:right;direction:rtl">  الحافة يرسل استجابة الخادم للمستخدم. </li></ol><br>  مخطط أدناه. <br><br><img src="https://habrastorage.org/webt/ta/jx/m5/tajxm5nceoc5z9oeea0_apjftvs.png"><br><br>  <b>وضع شفاف أو مضمّن.</b>  في هذا السيناريو ، يحتوي الموازن على واجهات في الشبكة الداخلية والخارجية.  ومع ذلك ، لا يوجد وصول مباشر إلى الشبكة الداخلية من الخارج.  يعمل موازن التحميل المدمج كبوابة NAT للأجهزة الافتراضية على الشبكة الداخلية. <br><br>  الآلية هي كما يلي: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  يرسل المستخدم طلبًا إلى عنوان VIP (عنوان الموازن) الذي تم تكوينه على Edge. </li><li style=";text-align:right;direction:rtl">  تقوم Edge بتحديد أحد الواجهة الخلفية وتقوم بتنفيذ NAT الوجهة ، مع استبدال عنوان VIP بعنوان الواجهة الخلفية المحددة. </li><li style=";text-align:right;direction:rtl">  يتم إرسال الحزمة إلى الخلفية المحددة. </li><li style=";text-align:right;direction:rtl">  تتلقى الواجهة الخلفية طلبًا بعنوان المستخدم الأصلي (لم يتم تنفيذ مصدر NAT) ويستجيب له مباشرةً. </li><li style=";text-align:right;direction:rtl">  يتم قبول حركة المرور مرة أخرى بواسطة موازن التحميل ، لأنه في المخطط المضمن ، عادة ما يكون بمثابة العبّارة الافتراضية لمزرعة الخوادم. </li><li style=";text-align:right;direction:rtl">  تقوم Edge بتشغيل مصدر NAT لإرسال حركة المرور إلى المستخدم ، باستخدام VIP الخاص به كعنوان IP المصدر. </li></ol><br>  مخطط أدناه. <br><br><img src="https://habrastorage.org/webt/w0/su/z0/w0suz0nii_gq5r4qcmibzge0zja.png"><br><br><h3 style=";text-align:right;direction:rtl">  ممارسة </h3><br>  في الاختبار الخاص بي ، تم تكوين 3 خوادم مع Apache ، والتي تم تكوينها للعمل على HTTPS.  ستعمل Edge على موازنة طلبات HTTPS باستخدام طريقة round robin ، مع إضافة كل طلب جديد إلى خادم جديد. <br><br>  لنبدأ. <br><br><h4 style=";text-align:right;direction:rtl">  توليد شهادة SSL التي ستستخدم NSX Edge </h4><br>  يمكنك استيراد شهادة المرجع المصدق صالحة أو استخدام شهادة موقعة ذاتياً.  في هذا الاختبار ، سأستخدم التوقيع الذاتي. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  في واجهة vCloud Director ، انتقل إلى إعدادات خدمات Edge. <br><br><img src="https://habrastorage.org/webt/i-/dq/th/i-dqthihewvxbuenqctf75z02nw.png"></li><li style=";text-align:right;direction:rtl">  انتقل إلى علامة التبويب الشهادات.  من قائمة الإجراءات ، حدد إضافة CSR جديدة. <br><br><img src="https://habrastorage.org/webt/zw/jz/zy/zwjzzymdjpgwylcdi93pus7wmrk.png"></li><li style=";text-align:right;direction:rtl">  املأ الحقول المطلوبة وانقر فوق الاحتفاظ. <br><br><img src="https://habrastorage.org/webt/c6/bj/zo/c6bjzodgmz0yepyhwdy00_dhoqg.png"></li><li style=";text-align:right;direction:rtl">  حدد CSR المنشأ حديثًا وحدد خيار CSR للتوقيع الذاتي. <br><br><img src="https://habrastorage.org/webt/z2/2k/sg/z22ksgjo22tjo1dpgfr-gvutbhu.png"></li><li style=";text-align:right;direction:rtl">  حدد فترة صلاحية الشهادة وانقر فوق الاحتفاظ <br><br><img src="https://habrastorage.org/webt/nl/wh/1w/nlwh1wu3amwefnuies4jxj0tiry.png"></li><li style=";text-align:right;direction:rtl">  ظهرت شهادة موقعة ذاتيا في قائمة المتاحة. <br><br><img src="https://habrastorage.org/webt/r9/u5/1q/r9u51qb5gt-rsf0ysyzx4byeezg.png"></li></ol><br><h4 style=";text-align:right;direction:rtl">  تكوين ملف تعريف التطبيق </h4><br>  تمنحك ملفات تعريف التطبيق مزيدًا من التحكم في حركة مرور الشبكة وتجعل إدارتها بسيطة وفعالة.  من خلال مساعدتهم ، يمكنك تحديد السلوك لأنواع محددة من حركة المرور. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  انتقل إلى علامة التبويب Load Balancer وتشغيل الموازن.  يسمح خيار التسريع هنا للموازن باستخدام موازنة L4 أسرع بدلاً من L7. <br><br><img src="https://habrastorage.org/webt/tr/gy/vb/trgyvbidsrd3xyyh-g6gis9igms.png"></li><li style=";text-align:right;direction:rtl">  انتقل إلى علامة تبويب ملف تعريف التطبيق لتعيين ملف تعريف التطبيق.  انقر فوق +. <br><br><img src="https://habrastorage.org/webt/nm/ng/aq/nmngaqjer2nwulb1mtrqttk0s0u.png"></li><li style=";text-align:right;direction:rtl">  قم بتعيين اسم ملف التعريف وحدد نوع حركة المرور التي سيتم تطبيق ملف التعريف عليها.  ساوضح بعض المعلمات. <br><br>  <b>الثبات</b> - يحفظ بيانات الجلسة ويتعقبها ، على سبيل المثال: أي خادم معين من المجموعة يخدم طلب مستخدم.  هذا يضمن أن يتم إرسال طلبات المستخدم إلى عضو التجمع نفسه طوال فترة الجلسة أو الجلسات اللاحقة. <br><br>  <b>تمكين عبور طبقة المقابس الآمنة</b> - عند تحديد هذا الخيار ، يتوقف NSX Edge عن إنهاء طبقة المقابس الآمنة.  بدلاً من ذلك ، يحدث الإنهاء مباشرة على الخوادم التي يتم إجراء موازنة لها. <br><br>  <b>إدراج رأس X-Forwarded-For HTTP</b> - يسمح لك بتحديد عنوان IP المصدر للعميل المتصل بخادم الويب من خلال الموازن. <br><br>  <b>تمكين Pool Side SSL</b> - يسمح لك بتحديد أن التجمع المختار يتكون من خوادم HTTPS. <br><br><img src="https://habrastorage.org/webt/ah/bm/i9/ahbmi974xepvaiwrqwtxy4uio6u.png"></li><li style=";text-align:right;direction:rtl">  نظرًا لأنني سأوازن حركة مرور HTTPS ، فأنا بحاجة إلى تمكين Pool Side SSL وتحديد الشهادة التي تم إنشاؤها مسبقًا في علامة تبويب شهادات الخادم الظاهري -&gt; شهادة الخدمة. <br><br><img src="https://habrastorage.org/webt/w2/ij/jn/w2ijjndohiaackavyj05iwjudpg.png"></li><li style=";text-align:right;direction:rtl">  وبالمثل لشهادات تجمع -&gt; شهادة الخدمة. <br><br><img src="https://habrastorage.org/webt/hn/5j/sy/hn5jsy5-tnudpfdcpome_wqwu0i.png"></li></ol><br><h4 style=";text-align:right;direction:rtl">  نقوم بإنشاء مجموعة من الخوادم ، وهي حركة المرور التي سيتم فيها توازن Pools </h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  انتقل إلى علامة التبويب تجمعات.  انقر فوق +. <br><br><img src="https://habrastorage.org/webt/1x/2c/e-/1x2ce--4asvoflplvlaiklfukhc.png"></li><li style=";text-align:right;direction:rtl">  عيّن اسم التجمع ، وحدد الخوارزمية (سأستخدم robin round) ونوع المراقبة للتحقق من صحة الواجهة الخلفية. يشير الخيار Transparent إلى ما إذا كانت عملاء IP المصدر الأولي مرئية للخوادم الداخلية. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  إذا تم تعطيل هذا الخيار ، فإن حركة المرور للخوادم الداخلية تأتي من مصدر IP للموازن. <br></li><li style=";text-align:right;direction:rtl">  إذا تم تمكين هذا الخيار ، ترى الخوادم الداخلية عملاء IP المصدر.  في هذا التكوين ، يجب أن تعمل NSX Edge كبوابة افتراضية لضمان مرور الحزم التي تم إرجاعها عبر NSX Edge. </li></ul><br>  يدعم NSX خوارزميات الموازنة التالية: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <b>IP_HASH</b> - اختيار الخادم استنادًا إلى نتائج وظيفة التجزئة لعنوان IP المصدر والوجهة لكل حزمة. </li><li style=";text-align:right;direction:rtl">  <b>LEASTCONN</b> - موازنة الاتصالات الواردة ، وهذا يتوقف على عدد من المتاحة بالفعل على خادم معين.  سيتم توجيه اتصالات جديدة إلى الخادم مع أقل عدد من الاتصالات. </li><li style=";text-align:right;direction:rtl">  <b>ROUND_ROBIN</b> - يتم إرسال اتصالات جديدة لكل خادم بدوره ، وفقًا للوزن المحدد. </li><li style=";text-align:right;direction:rtl">  <b>URI</b> - يتم تجزئة الجزء الأيسر من URI (قبل علامة الاستفهام) وتقسيمها على إجمالي وزن الخوادم في التجمع.  تشير النتيجة إلى الخادم الذي يتلقى الطلب ، مع ضمان توجيه الطلب دائمًا إلى نفس الخادم ، طالما بقيت جميع الخوادم متاحة. </li><li style=";text-align:right;direction:rtl">  <b>HTTPHEADER</b> - الموازنة بناءً على رأس HTTP محدد ، والذي يمكن تحديده كمعلمة.  إذا كان الرأس مفقودًا أو ليس له أي معنى ، فسيتم استخدام خوارزمية ROUND_ROBIN. </li><li style=";text-align:right;direction:rtl">  <b>عنوان URL</b> - يبحث كل طلب HTTP GET عن معلمة URL المحددة كوسيطة.  إذا كانت المعلمة متبوعة بعلامة وقيمة متساوية ، فسيتم تقسيم القيمة وتقسيمها على إجمالي وزن الخوادم قيد التشغيل.  تشير النتيجة إلى الخادم الذي يتلقى الطلب.  تُستخدم هذه العملية لتتبع معرفات المستخدم في الطلبات ولضمان إرسال معرف المستخدم نفسه دائمًا إلى نفس الخادم ، طالما بقيت جميع الخوادم متاحة. </li></ul><br><img src="https://habrastorage.org/webt/ru/a-/w1/rua-w1fjpzumfbu92ujeakfw0hm.png"></li><li style=";text-align:right;direction:rtl">  في كتلة الأعضاء ، انقر فوق + لإضافة خوادم إلى التجمع. <br><br><img src="https://habrastorage.org/webt/qd/io/cf/qdiocfo-f-kjw6aot0q9ekbd37i.png"><br><br>  هنا تحتاج إلى تحديد: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  اسم الخادم </li><li style=";text-align:right;direction:rtl">  عنوان IP للخادم ؛ </li><li style=";text-align:right;direction:rtl">  المنفذ الذي سيتلقى عليه الخادم المرور ؛ </li><li style=";text-align:right;direction:rtl">  ميناء لفحص الصحة (مراقبة healthcheck) ؛ </li><li style=";text-align:right;direction:rtl">  الوزن - باستخدام هذه المعلمة ، يمكنك ضبط المقدار النسبي لحركة المرور المستلمة لعضو معين في المجموعة ؛ </li><li style=";text-align:right;direction:rtl">  اتصالات ماكس - الحد الأقصى لعدد الاتصالات إلى الخادم. </li><li style=";text-align:right;direction:rtl">  اتصالات دقيقة - الحد الأدنى لعدد الاتصالات التي يجب على الخادم معالجتها قبل إعادة توجيه حركة المرور إلى عضو التجمع التالي. </li></ul><br><img src="https://habrastorage.org/webt/wi/re/hv/wirehvt2ivslsykeopxoeuvrhky.png"><br><br>  هذا هو الشكل النهائي للمجموعة المكونة من ثلاثة خوادم. <br><br><img src="https://habrastorage.org/webt/u1/t1/xs/u1t1xsnzgp9-zs4odzuklgark30.png"></li></ol><br><h4 style=";text-align:right;direction:rtl">  إضافة خادم الظاهري </h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  انتقل إلى علامة التبويب الخوادم الافتراضية.  انقر فوق +. <br><br><img src="https://habrastorage.org/webt/k5/pt/j0/k5ptj0t6ziwg25ec17vcjntpgzm.png"></li><li style=";text-align:right;direction:rtl">  نقوم بتنشيط الخادم الظاهري باستخدام تمكين الخادم الظاهري. <br><br>  نعطيها اسمًا ، وحدد "ملف تعريف التطبيق" الذي تم إنشاؤه مسبقًا ، "التجمع" وحدد عنوان IP الذي سيقبله "الملقم الظاهري" الطلبات من الخارج.  حدد بروتوكول HTTPS والمنفذ 443. <br>  المعلمات الاختيارية هنا: <br><br>  <b>حد الاتصال</b> - الحد الأقصى لعدد الاتصالات المتزامنة التي يمكن أن يتعامل معها الخادم الظاهري ؛ <br>  <b>حد معدل الاتصال (CPS)</b> - الحد الأقصى لعدد الطلبات الواردة الجديدة في الثانية. <br><br><img src="https://habrastorage.org/webt/xa/rp/xu/xarpxupxblhb_tt0qsatlfn5b-m.png"></li></ol><br><br>  هذا يكمل التكوين الموازن ، يمكنك التحقق من أدائها.  خوادم لديها أبسط التكوين ، والذي يسمح لك لفهم أي خادم من التجمع معالجة الطلب.  أثناء الإعداد ، اخترنا خوارزمية موازنة Round Robin ، ومعلمة Weight لكل خادم تساوي واحدة ، لذلك سيتم معالجة كل طلب تالي بواسطة الخادم التالي من التجمع. <br><br>  أدخل العنوان الخارجي للموازن في المتصفح وانظر: <br><br><img src="https://habrastorage.org/webt/nt/he/7u/nthe7uim5gmdqb9odzyub_hdkeq.png"><br><br>  بعد تحديث الصفحة ، سيتم معالجة الطلب بواسطة الخادم التالي: <br><br><img src="https://habrastorage.org/webt/ke/d1/xf/ked1xfdi_nmdye9ci5nswvgzjaq.png"><br><br>  ومرة أخرى - للتحقق من الخادم الثالث من البركة: <br><br><img src="https://habrastorage.org/webt/nu/uo/8u/nuuo8uvhb1dq2tozx2nrtjwfo68.png"><br><br>  عند التحقق ، يمكنك أن ترى أن الشهادة التي ترسلها لنا Edge هي نفس الشهادة التي أنشأناها في البداية. <br><br>  تحقق من حالة الموازن من وحدة التحكم في بوابة Edge.  للقيام بذلك ، أدخل <b>إظهار خدمة loadbalancer pool</b> . <br><br><img src="https://habrastorage.org/webt/ba/_6/jq/ba_6jqyhlyemoguhvwshmhgabbq.png"><br><br><h4 style=";text-align:right;direction:rtl">  تكوين مراقب الخدمة للتحقق من حالة الخوادم في التجمع </h4><br>  باستخدام Service Monitor ، يمكننا مراقبة حالة الخوادم في التجمع الخلفي.  إذا كانت استجابة الطلب لا تتطابق مع ما هو متوقع ، فيمكن سحب الخادم من التجمع بحيث لا يتلقى أي طلبات جديدة. <br><br>  بشكل افتراضي ، يتم تكوين ثلاث طرق تحقق: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  مراقب TCP </li><li style=";text-align:right;direction:rtl">  رصد HTTP </li><li style=";text-align:right;direction:rtl">  HTTPS رصد. </li></ul><br>  إنشاء واحدة جديدة. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  انتقل إلى علامة تبويب Service Service (مراقبة الخدمة) ، انقر فوق +. <br><br><img src="https://habrastorage.org/webt/i_/ca/e4/i_cae4kdihjj0ewts1v1d-yeeog.png"></li><li style=";text-align:right;direction:rtl">  اختيار: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  اسم للطريقة الجديدة ؛ </li><li style=";text-align:right;direction:rtl">  الفاصل الزمني الذي سيتم فيه إرسال الطلبات ، </li><li style=";text-align:right;direction:rtl">  مهلة الاستجابة </li><li style=";text-align:right;direction:rtl">  نوع المراقبة هو طلب HTTPS باستخدام طريقة GET ، كود الحالة المتوقع هو 200 (OK) وعنوان URL للطلب. </li></ul></li><li style=";text-align:right;direction:rtl">  هذا يكمل تكوين مراقب الخدمة الجديد ، والآن يمكننا استخدامه عند إنشاء تجمع. <br><br><img src="https://habrastorage.org/webt/by/vj/ea/byvjea2dm23pabgtmueiedehzhq.png"></li></ol><br><h4 style=";text-align:right;direction:rtl">  تكوين قواعد التطبيق </h4><br>  قواعد التطبيق هي وسيلة لمعالجة حركة المرور بناءً على مشغلات محددة.  باستخدام هذه الأداة ، يمكننا إنشاء قواعد موازنة تحميل متقدمة ، والتي قد لا يكون من الممكن التكوين من خلال ملفات تعريف التطبيق أو استخدام خدمات أخرى متوفرة على Edge Gateway. <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  لإنشاء قاعدة ، انتقل إلى علامة تبويب قواعد التطبيق الخاصة بالموازن. <br><br><img src="https://habrastorage.org/webt/lc/ff/uw/lcffuwfhhtf6nn1emi7_e-3cjdu.png"></li><li style=";text-align:right;direction:rtl">  اختر اسمًا ونصًا سيستخدم القاعدة ، ثم انقر فوق الاحتفاظ. <br><br><img src="https://habrastorage.org/webt/1y/a-/o0/1ya-o0rss2uga8gzuasij20yd70.png"></li><li style=";text-align:right;direction:rtl">  بعد إنشاء القاعدة ، نحتاج إلى تعديل الخادم الظاهري الذي تم تكوينه بالفعل. <br><br><img src="https://habrastorage.org/webt/xg/ha/jf/xghajfs-6ntwycerfn_nun0wvlq.png"></li><li style=";text-align:right;direction:rtl">  في علامة التبويب خيارات متقدمة ، أضف القاعدة التي أنشأناها. <br><br><img src="https://habrastorage.org/webt/le/zv/vs/lezvvste4xmuvdzj4l8jrp5trbq.png"></li></ol><br><br>  في المثال أعلاه ، قمنا بتضمين دعم tlsv1. <br><br>  بضعة أمثلة أخرى: <br><br>  إعادة توجيه حركة المرور إلى تجمع آخر. <br><br>  باستخدام هذا البرنامج النصي ، يمكننا إعادة توجيه حركة المرور إلى تجمع موازنة آخر إذا لم يعمل التجمع الرئيسي.  لكي تعمل القاعدة ، يجب تكوين عدة تجمعات على الموازن ويجب أن يكون جميع أعضاء التجمع الرئيسي في الحالة السفلية.  حدد اسم التجمع ، وليس معرفه. <br><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">acl pool_down nbsrv(PRIMARY_POOL_NAME) eq 0 use_backend SECONDARY_POOL_NAME if PRIMARY_POOL_NAME</code> </pre> <br>  إعادة توجيه حركة المرور إلى مورد خارجي. <br><br>  نقوم هنا بإعادة توجيه حركة المرور إلى موقع ويب خارجي إذا كان جميع أعضاء التجمع الرئيسي في حالة الهبوط. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">acl pool_down nbsrv(NAME_OF_POOL) eq 0 redirect location http://www.example.com if pool_down</code> </pre> <br>  المزيد من الأمثلة <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">هنا</a> . <br><br>  هذا كل شيء عن الموازن.  إذا كان لديك أي أسئلة ، اسأل ، أنا مستعد للإجابة. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar448540/">https://habr.com/ru/post/ar448540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar448530/index.html">كيف نمت مكبر الصوت على اشتراكات المحمول</a></li>
<li><a href="../ar448532/index.html">مركز بيانات الفضاء. تلخيص التجربة</a></li>
<li><a href="../ar448534/index.html">لماذا نحتاج مفاتيح الصناعية مع EMC المحسن؟</a></li>
<li><a href="../ar448536/index.html">الشفافية - دواء الجزارين</a></li>
<li><a href="../ar448538/index.html">قم بإنشاء حل تجاوز الفشل استنادًا إلى بنية Oracle RAC و AccelStor Shared-Nothing</a></li>
<li><a href="../ar448544/index.html">حزم في الصلب. كيف يتم تشكيلها</a></li>
<li><a href="../ar448546/index.html">أحجام رأس وتذييل UITableView التلقائي مع AutoLayout</a></li>
<li><a href="../ar448548/index.html">البناء في الفن: من Brueghel إلى Vasya Lozhkin</a></li>
<li><a href="../ar448550/index.html">مسابقة التقرير في #PAYMENTSECURITY 2019 افتتح</a></li>
<li><a href="../ar448552/index.html">سلسلة ProLiant 100 - الأخ الأصغر المفقود</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>