<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ¢Ô∏è ‚úä üåñ Comment AWS fabrique ses services r√©silients. Mise √† l'√©chelle du serveur et de la base de donn√©es üé∏ üòè üà≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les nuages ‚Äã‚Äãsont comme une bo√Æte magique - vous demandez ce dont vous avez besoin et les ressources apparaissent simplement de nulle part. Machines v...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment AWS fabrique ses services r√©silients. Mise √† l'√©chelle du serveur et de la base de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/471686/"> Les nuages ‚Äã‚Äãsont comme une bo√Æte magique - vous demandez ce dont vous avez besoin et les ressources apparaissent simplement de nulle part.  Machines virtuelles, bases de donn√©es, r√©seau - tout cela n'appartient qu'√† vous.  Il existe d'autres locataires du cloud, mais dans votre univers, vous √™tes le seul dirigeant.  Vous √™tes s√ªr que vous recevrez toujours les ressources n√©cessaires, vous ne comptez avec personne et vous d√©terminez de mani√®re ind√©pendante ce que sera le r√©seau.  Comment est cette magie qui fait que le cloud alloue √©lastiquement les ressources et isole compl√®tement les locataires les uns des autres? <br><br><img src="https://habrastorage.org/webt/95/t7/1o/95t71ogmxhqysjnhwbqd_nbj4tk.jpeg"><br><br>  AWS Cloud est un syst√®me m√©ga-sophistiqu√© qui √©volue depuis 2006.  Une partie de ce d√©veloppement a √©t√© trouv√©e par <strong>Vasily Pantyukhin</strong> , architecte d'Amazon Web Services.  En tant qu'architecte, il voit de l'int√©rieur non seulement le r√©sultat final, mais aussi les d√©fis qu'AWS surmonte.  Plus la compr√©hension du syst√®me est grande, plus la confiance est grande.  Par cons√©quent, Vasily partagera les secrets des services cloud AWS.  Sous la coupe se trouve l'appareil pour les serveurs physiques AWS, l'√©volutivit√© flexible des bases de donn√©es, une base de donn√©es Amazon personnalis√©e et des m√©thodes pour am√©liorer les performances des machines virtuelles tout en r√©duisant leur prix.  La connaissance des approches architecturales d'Amazon vous aidera √† mieux utiliser les services AWS et peut fournir de nouvelles id√©es pour cr√©er vos propres solutions. <br><a name="habracut"></a><br>  <i>√Ä propos du pr√©sident: Vasily Pantyukhin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Hen</a> ) a commenc√© en tant qu'administrateur Unix dans les soci√©t√©s in.ru, a pass√© 6 ans √† travailler dans de grandes glandes Sun Microsystem, et pendant 11 ans, il a pr√™ch√© la concentration des donn√©es du monde dans EMC.</i>  <i>Naturellement, il est devenu un cloud priv√© et, en 2017, il est devenu un cloud public.</i>  <i>Maintenant avec des conseils techniques, il aide √† vivre et √† se d√©velopper dans le cloud AWS.</i> <i><br><br></i>  <i>Avis de non-responsabilit√©: tout ce qui suit est l'opinion personnelle de Vasily et cela peut ne pas co√Øncider avec la position d'Amazon Web Services.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Une vid√©o du</a> reportage sur la base duquel l'article a √©t√© cr√©√© est disponible sur notre cha√Æne YouTube.</i> <br><br><h2>  Pourquoi je parle d'un appareil Amazon </h2><br>  Ma premi√®re voiture √©tait avec une ¬´poign√©e¬ª - sur une bo√Æte de vitesses manuelle.  C'√©tait g√©nial √† cause du sentiment que je pouvais contr√¥ler la machine et la contr√¥ler compl√®tement.  J'ai aussi aim√© que je comprenne au moins √† peu pr√®s le principe de son travail.  Naturellement, j'ai imagin√© le bo√Ætier de mani√®re tr√®s primitive - √† peu pr√®s comme une bo√Æte de vitesses sur un v√©lo. <br><br><img src="https://habrastorage.org/webt/t-/zx/uz/t-zxuzgpa2gj26bmpgbe1gj_zd0.jpeg"><br><br>  Tout √©tait merveilleux, sauf une chose - debout dans les embouteillages.  Il semble que vous soyez assis et ne faites rien, mais vous changez constamment de vitesse, appuyez sur l'embrayage, le gaz, le frein - vous en avez vraiment marre.  Le probl√®me des embouteillages a √©t√© partiellement r√©solu lorsqu'une machine est apparue sur la machine de la famille.  Au volant, il √©tait temps de penser √† quelque chose, d'√©couter un livre audio. <br><br>  Un myst√®re est apparu dans ma vie, car j'ai g√©n√©ralement cess√© de comprendre le fonctionnement de ma voiture.  Une voiture moderne est un appareil complexe.  La voiture s'adapte simultan√©ment √† des dizaines de param√®tres diff√©rents: pression du gaz, frein, style de conduite, qualit√© de la route.  Je ne comprends plus comment cela fonctionne. <br><br>  Quand j'ai commenc√© √† faire Amazon Cloud, c'√©tait aussi un myst√®re pour moi.  Seul ce secret est d'un ordre de grandeur plus √©lev√©, car il y a un conducteur dans la voiture et des millions dans AWS.  Tous les utilisateurs dirigent simultan√©ment, appuient sur le gaz et freinent.  C'est incroyable qu'ils aillent o√π ils veulent - pour moi, c'est un miracle!  Le syst√®me s'adapte automatiquement, √©volue et s'adapte de mani√®re flexible √† chaque utilisateur de sorte qu'il lui semble qu'il est seul dans cet univers. <br><br>  La magie s'est un peu dissip√©e lorsque je suis plus tard venu travailler comme architecte chez Amazon.  J'ai vu √† quels probl√®mes nous sommes confront√©s, comment nous les r√©solvons, comment nous d√©veloppons les services.  Avec une meilleure compr√©hension du syst√®me, il y a plus de confiance dans le service.  Je veux donc partager une image de ce qui se cache sous le capot du cloud AWS. <br><br><h2>  De quoi parlerons-nous </h2><br>  J'ai choisi une approche diversifi√©e - j'ai s√©lectionn√© 4 services int√©ressants qui m√©ritent d'√™tre √©voqu√©s. <br><br>  <strong>Optimisation du serveur</strong> .  Nuages ‚Äã‚Äã√©ph√©m√®res avec une incarnation physique: centres de donn√©es physiques, o√π il y a des serveurs physiques qui bourdonnent, se r√©chauffent et clignotent. <br><br>  <strong>Les fonctions sans serveur</strong> (Lambda) sont probablement le service le plus √©volutif du cloud. <br><br>  <strong>Mise √† l'√©chelle de la base de donn√©es</strong> .  Je vais parler de la fa√ßon dont nous construisons nos propres bases de donn√©es √©volutives. <br><br>  <strong>Mise √† l'√©chelle du r√©seau</strong> .  La derni√®re partie dans laquelle j'ouvrirai l'appareil de notre r√©seau.  C'est une chose merveilleuse - chaque utilisateur du cloud croit qu'il est seul dans le cloud et ne voit pas du tout les autres locataires. <br><br><blockquote>  <i>Remarque</i>  <i>Cet article se concentrera sur l'optimisation du serveur et la mise √† l'√©chelle de la base de donn√©es.</i>  <i>La mise √† l'√©chelle du r√©seau sera discut√©e dans le prochain article.</i>  <i>O√π sont les fonctions sans serveur?</i>  <i>Une transcription distincte en sortit: ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Mal, oui audacieux.</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Anboxing of Firecracker microvirtuals</a> . "</i>  <i>Il parle de plusieurs fa√ßons diff√©rentes de faire √©voluer, et la solution Firecracker est analys√©e en d√©tail - une symbiose des meilleures qualit√©s d'une machine virtuelle et de conteneurs.</i> </blockquote><br><h2>  Serveurs </h2><br>  Le nuage est √©ph√©m√®re.  Mais cette √©ph√©m√©ralit√© a toujours un mode de r√©alisation physique - les serveurs.  Au d√©part, leur architecture √©tait classique.  Chipset x86 standard, cartes r√©seau, Linux, hyperviseur Xen, qui ex√©cute des machines virtuelles. <br><br><img src="https://habrastorage.org/webt/hb/vt/ez/hbvtezxs1wc_ilzrlcorvx9qy4m.jpeg"><br><br>  En 2012, une telle architecture a bien fait son travail.  Xen est un excellent hyperviseur, mais avec un d√©faut majeur.  Il a une <strong>surcharge</strong> assez <strong>√©lev√©e pour √©muler des appareils</strong> .  Avec l'av√®nement de nouvelles cartes r√©seau ou SSD plus rapides, ces frais g√©n√©raux deviennent trop √©lev√©s.  Comment g√©rer ce probl√®me?  Nous avons d√©cid√© de travailler sur deux fronts √† la fois - pour <strong>optimiser √† la fois le mat√©riel et l'hyperviseur</strong> .  La t√¢che est tr√®s s√©rieuse. <br><br><h3>  Optimisation du fer et de l'hyperviseur </h3><br>  Tout faire en m√™me temps et bien ne fonctionnera pas.  Ce qui est ¬´bien¬ª √©tait initialement incompr√©hensible. <br><blockquote>  Nous avons d√©cid√© d'appliquer une approche √©volutive - nous changeons un √©l√©ment important de l'architecture et le mettons en production. </blockquote>  Nous marchons sur tous les r√¢teaux, √©coutons les plaintes et les suggestions.  Ensuite, nous changeons un autre composant.  Ainsi, par petits incr√©ments, nous changeons radicalement toute l'architecture en fonction des commentaires et du support des utilisateurs. <br><br>  La transformation a commenc√© en 2013 avec la chose la plus difficile - le r√©seau.  Dans <strong>les</strong> cas <strong>C3</strong> , une carte Network Accelerator sp√©ciale a √©t√© ajout√©e √† la carte r√©seau standard.  Il √©tait connect√© avec un c√¢ble de bouclage litt√©ralement court sur le panneau avant.  Moche, mais pas visible dans le nuage.  Mais l'interaction directe avec le mat√©riel a fondamentalement am√©lior√© la gigue et la bande passante du r√©seau. <br><br>  Ensuite, nous avons d√©cid√© de nous concentrer sur l'am√©lioration de l'acc√®s au stockage par blocs EBS - Elastic Block Storage.  Il s'agit d'une combinaison de r√©seau et de stockage.  La difficult√© est que si les cartes Network Accelerator existaient sur le march√©, il n'y avait aucun moyen d'acheter simplement du mat√©riel Storage Accelerator.  Par cons√©quent, nous nous sommes tourn√©s vers la startup <strong>Annapurna Labs</strong> , qui a d√©velopp√© pour nous des puces ASIC sp√©ciales.  Ils vous ont permis de connecter des volumes EBS distants en tant que p√©riph√©riques NVMe. <br><br>  Dans les instances <strong>C4</strong> , nous avons r√©solu deux probl√®mes.  Tout d'abord, nous avons mis en place les bases de l'avenir avec une technologie NVMe prometteuse, mais nouvelle √† l'√©poque.  Le second - a consid√©rablement d√©charg√© le processeur central en transf√©rant le traitement des demandes vers EBS sur une nouvelle carte.  Cela s'est bien pass√©, alors maintenant, Annapurna Labs fait partie d'Amazon. <br><br>  En novembre 2017, nous avons r√©alis√© qu'il √©tait temps de changer l'hyperviseur lui-m√™me. <br><blockquote>  Le nouvel hyperviseur a √©t√© d√©velopp√© sur la base de modules de noyau KVM modifi√©s. </blockquote>  Cela a permis de r√©duire fondamentalement les frais g√©n√©raux li√©s √† l'√©mulation des appareils et de travailler directement avec les nouveaux ASIC.  <strong>Les</strong> instances <strong>C5</strong> ont √©t√© les premi√®res machines virtuelles sous le capot desquelles tourne un nouvel hyperviseur.  Nous l'avons appel√© <strong>Nitro</strong> . <br><br><img src="https://habrastorage.org/webt/g6/x2/ri/g6x2rizybxczhu-ikt1pfulnpb0.jpeg">  <em>L'√©volution des instances sur la timeline.</em> <br><br>  Tous les nouveaux types de machines virtuelles apparus depuis novembre 2017 fonctionnent sur cet hyperviseur.  <strong>Les instances Iron Bare Metal n'ont pas d'hyperviseur</strong> , mais elles sont aussi appel√©es Nitro, car elles utilisent des cartes Nitro sp√©cialis√©es. <br><br>  Au cours des deux ann√©es suivantes, le nombre de types d'instances Nitro a d√©pass√© quelques dizaines: A1, C5, M5, T3 et autres. <br><br><img src="https://habrastorage.org/webt/vw/zf/as/vwzfasdjwxuuykoylco9bnmgqki.jpeg"><br>  <em>Types d'instances.</em> <br><br><h3>  Comment fonctionnent les voitures nitro modernes </h3><br>  Ils ont trois composants principaux: un hyperviseur Nitro (discut√© ci-dessus), une puce de s√©curit√© et des cartes Nitro. <br><br>  <strong>La puce de s√©curit√© est</strong> int√©gr√©e directement dans la carte m√®re.  Il contr√¥le de nombreuses fonctions importantes, par exemple, le contr√¥le du chargement du syst√®me d'exploitation h√¥te. <br><br>  <strong>Cartes Nitro</strong> - il en existe quatre types.  Tous sont d√©velopp√©s par Annapurna Labs et sont bas√©s sur des ASIC courants.  Une partie de leur firmware est √©galement courante. <br><br><img src="https://habrastorage.org/webt/fy/pf/pj/fypfpj1r-mpklkd-8ltiz-frjnc.jpeg"><br>  <em>Quatre types de cartes nitro.</em> <br><br>  L'une des cartes est con√ßue pour fonctionner avec <strong>un r√©seau</strong> <strong>VPC</strong> .  C'est elle qui est visible dans <strong>les machines virtuelles</strong> comme une carte r√©seau <strong>ENA - Elastic Network Adapter</strong> .  Il encapsule √©galement le trafic lorsqu'il est transmis via le r√©seau physique (nous en parlerons dans la deuxi√®me partie de l'article), contr√¥le le pare-feu des groupes de s√©curit√©, est responsable du routage et d'autres √©l√©ments du r√©seau. <br><br>  Des cartes distinctes fonctionnent avec le stockage de blocs <strong>EBS</strong> et les disques int√©gr√©s au serveur.  Ils sont pr√©sent√©s aux machines virtuelles invit√©es en tant <strong>qu'adaptateurs NVMe</strong> .  Ils sont √©galement responsables du chiffrement des donn√©es et de la surveillance du disque. <br><br>  Le syst√®me de cartes Nitro, un hyperviseur et une puce de s√©curit√© sont int√©gr√©s dans un <strong>r√©seau</strong> SDN ou <strong>Software Defined Network</strong> .  La <strong>carte de</strong> contr√¥le est responsable de la gestion de ce r√©seau (Control Plane). <br><br>  Bien s√ªr, nous continuons √† d√©velopper de nouveaux ASIC.  Par exemple, fin 2018, ils ont sorti la puce Inferentia, qui permet un travail plus efficace avec les t√¢ches d'apprentissage automatique. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i7/1w/7p/i71w7p7mu3pbl3ozaoczqmxirku.jpeg" width="500"></div><br>  <em>Puce de processeur d'apprentissage automatique Inferentia.</em> <br><br><h2>  Base de donn√©es √©volutive </h2><br>  La base de donn√©es traditionnelle a une structure en couches.  S'ils sont grandement simplifi√©s, les niveaux suivants sont distingu√©s. <br><br><ul><li>  <strong>SQL</strong> - les r√©partiteurs de clients et de requ√™tes y travaillent. </li><li>  S√©curiser les <strong>transactions</strong> - tout est clair ici, ACID et tout √ßa. </li><li>  <strong>Mise en cache</strong> fournie par les pools de m√©moire tampon. </li><li>  <strong>Journalisation</strong> - permet de travailler avec des fichiers de journalisation.  Dans MySQL, ils sont appel√©s Bin Logs, dans PosgreSQL, ils sont appel√©s Write Ahead Logs (WAL). </li><li>  <strong>Stockage</strong> - √©crire directement sur le disque. </li></ul><br><img src="https://habrastorage.org/webt/5x/xv/ay/5xxvay0jy9xyewxzi1py1q9rhei.jpeg"><br>  <em>Structure de base de donn√©es en couches.</em> <br><br>  Il existe diff√©rentes fa√ßons de faire √©voluer les bases de donn√©es: partitionnement, architecture Shared Nothing, lecteurs partag√©s. <br><br><img src="https://habrastorage.org/webt/ao/pq/sf/aopqsfjiytwkbunwwni-wia5mzu.jpeg"><br><br>  Cependant, toutes ces m√©thodes conservent la m√™me structure de base de donn√©es monolithique.  Cela limite consid√©rablement la mise √† l'√©chelle.  Pour r√©soudre ce probl√®me, nous avons d√©velopp√© notre propre base de donn√©es - <strong>Amazon Aurora</strong> .  Il est compatible avec MySQL et PostgreSQL. <br><br><h3>  Amazon aurora </h3><br>  L'id√©e architecturale principale est de s√©parer les niveaux de stockage et de journalisation de la base de donn√©es principale. <br><br>  Pour l'avenir, je dirai que nous avons √©galement rendu le niveau de cache ind√©pendant.  L'architecture cesse d'√™tre un monolithe et nous obtenons des degr√©s de libert√© suppl√©mentaires dans la mise √† l'√©chelle des blocs individuels. <br><br><img src="https://habrastorage.org/webt/31/a1/4_/31a14_4d4o0pvrk_23aj-obbiew.jpeg"><br>  <em>Les niveaux de journalisation et de stockage sont distincts de la base de donn√©es.</em> <br><br>  Un SGBD traditionnel √©crit des donn√©es dans le syst√®me de stockage sous forme de blocs.  Chez Amazon Aurora, nous avons cr√©√© un r√©f√©rentiel ¬´intelligent¬ª qui peut parler la langue des <strong>redo-logs</strong> .  √Ä l'int√©rieur, le r√©f√©rentiel transforme les journaux en blocs de donn√©es, surveille leur int√©grit√© et sauvegarde automatiquement. <br><br>  Cette approche vous permet de mettre en ≈ìuvre des choses int√©ressantes comme le <strong>clonage</strong> .  Il fonctionne de mani√®re fondamentalement plus rapide et plus √©conomique du fait qu'il ne n√©cessite pas la cr√©ation d'une copie compl√®te de toutes les donn√©es. <br><br>  Le niveau de stockage est impl√©ment√© comme un syst√®me distribu√©.  Il se compose d'un tr√®s grand nombre de serveurs physiques.  Chaque redo-log est trait√© et stock√© simultan√©ment par <strong>six n≈ìuds</strong> .  Cela fournit une protection des donn√©es et un √©quilibrage de charge. <br><br><img src="https://habrastorage.org/webt/uv/up/rg/uvuprghc30bpo190-fjgb3w5pm8.jpeg"><br><br>  La mise √† l'√©chelle de la lecture peut √™tre r√©alis√©e √† l'aide de r√©pliques appropri√©es.  Le stockage distribu√© √©limine le besoin de synchronisation entre l'instance de base de donn√©es principale √† travers laquelle nous √©crivons des donn√©es et d'autres r√©pliques.  Il est garanti que les donn√©es actuelles seront disponibles pour toutes les r√©pliques. <br><br>  Le seul probl√®me est la mise en cache des anciennes donn√©es sur les r√©plicas en lecture.  Mais ce probl√®me est r√©solu en <strong>transf√©rant tous les fichiers de journalisation</strong> vers des r√©pliques sur le r√©seau interne.  Si le journal est dans le cache, il est marqu√© comme non valide et est remplac√©.  S'il n'est pas dans le cache, il est simplement supprim√©. <br><br><img src="https://habrastorage.org/webt/8q/lt/hc/8qlthc7bqmxhqhja_ou4u3udjk4.jpeg"><br><br>  Nous avons compris le stockage. <br><br><h3>  Comment faire √©voluer les niveaux du SGBD </h3><br>  Ici, la mise √† l'√©chelle horizontale est beaucoup plus difficile √† faire.  Par cons√©quent, allons sur les sentiers battus de <strong>la mise √† l'√©chelle verticale classique</strong> . <br><br>  Supposons que nous ayons une application qui communique avec un SGBD via un n≈ìud ma√Ætre. <br><br>  Avec une mise √† l'√©chelle verticale, nous s√©lectionnons un nouveau n≈ìud qui aura plus de processeurs et de m√©moire. <br><br><img src="https://habrastorage.org/webt/ai/mn/if/aimnifftppplcs1mfg3n-zldlrk.jpeg"><br><br>  Ensuite, basculez l'application de l'ancien n≈ìud ma√Ætre vers le nouveau.  Il y a des probl√®mes. <br><br><ul><li>  Cela n√©cessitera un temps d'arr√™t notable de l'application. </li><li>  Le nouveau n≈ìud ma√Ætre aura un cache froid.  Les performances de la base de donn√©es ne seront maximales qu'apr√®s r√©chauffement du cache. </li></ul><br><img src="https://habrastorage.org/webt/k0/i-/jy/k0i-jy69brtsvclx0trwgjfuw0y.jpeg"><br><br>  Comment am√©liorer la situation?  Mettez un proxy entre l'application et le n≈ìud ma√Ætre. <br><br><img src="https://habrastorage.org/webt/ag/bk/c9/agbkc94ple_fti2xvyjinrb7mxu.jpeg"><br><br>  Que nous apportera-t-il?  D√©sormais, toutes les applications n'ont pas besoin d'√™tre redirig√©es manuellement vers un nouveau n≈ìud.  La commutation peut √™tre effectu√©e sous un proxy et en m√™me temps fondamentalement plus rapide. <br><br>  Le probl√®me semble r√©solu.  Mais non, nous souffrons toujours de la n√©cessit√© de r√©chauffer le cache.  De plus, un nouveau probl√®me est apparu - maintenant le proxy est un point d'√©chec potentiel. <br><br><h3>  Solution finale avec Amazon Aurora sans serveur </h3><br>  Comment avons-nous r√©solu ces probl√®mes? <br><br>  <strong>Laiss√© un proxy</strong> .  Il ne s'agit pas d'une instance distincte, mais d'un ensemble de parcs de proxy distribu√©s via lesquels les applications se connectent √† la base de donn√©es.  En cas de panne, n'importe lequel des n≈ìuds peut √™tre remplac√© presque instantan√©ment. <br><br>  <strong>Nous avons ajout√© un pool de n≈ìuds chauds de diff√©rentes tailles</strong> .  Par cons√©quent, si vous devez s√©lectionner un nouveau n≈ìud d'une taille plus grande ou plus petite, il est imm√©diatement disponible.  Pas besoin d'attendre qu'il se charge. <br><br>  <strong>L'ensemble du processus de mise √† l'√©chelle est contr√¥l√© par un syst√®me de surveillance sp√©cial.</strong>  La surveillance surveille en permanence l'√©tat du n≈ìud ma√Ætre actuel.  S'il d√©tecte, par exemple, que la charge du processeur a atteint une valeur critique, il informe le pool d'instances chaudes de la n√©cessit√© d'allouer un nouveau n≈ìud. <br><br><img src="https://habrastorage.org/webt/2r/ja/oq/2rjaoqe-tgjjv_nxbodwlibzkzc.jpeg"><br>  <em>Proxy distribu√©s, instances chaudes et surveillance.</em> <br><br>  Un n≈ìud de puissance requise est disponible.  Les pools de m√©moire tampon y sont copi√©s et le syst√®me commence √† attendre un moment s√ªr pour basculer. <br><br><img src="https://habrastorage.org/webt/hw/t4/nr/hwt4nruv3h9bdyyte_awfycnp1g.jpeg"><br><br>  Habituellement, le moment du changement arrive assez rapidement.  Ensuite, la communication entre le proxy et l'ancien n≈ìud ma√Ætre est suspendue, toutes les sessions basculent vers le nouveau n≈ìud. <br><br><img src="https://habrastorage.org/webt/pz/4f/cj/pz4fcjzipu0pep5pwwex6mb5kas.jpeg"><br><br>  Le travail avec la base de donn√©es reprend. <br><br><img src="https://habrastorage.org/webt/sv/dl/kf/svdlkfp7ve6gzlomvdxulhmyjsy.jpeg"><br><br>  Le graphique montre que la suspension est vraiment tr√®s courte.  Sur le graphique bleu, la charge et sur les marches rouges - les moments de mise √† l'√©chelle.  Les creux √† court terme dans le graphique bleu sont pr√©cis√©ment ce court d√©lai. <br><br><img src="https://habrastorage.org/webt/te/3p/4x/te3p4xzclr_3liuv-7gk2ocskey.jpeg"><br><br>  √Ä propos, Amazon Aurora vous permet d'enregistrer et de d√©sactiver compl√®tement la base de donn√©es lorsqu'elle n'est pas utilis√©e, par exemple le week-end.  Apr√®s l'arr√™t du chargement, la base de donn√©es diminue progressivement sa puissance et s'√©teint pendant un certain temps.  Lorsque la charge revient, elle augmentera √† nouveau en douceur. <br><br><blockquote>  Dans la prochaine partie de la discussion sur les appareils Amazon, nous parlerons de la mise √† l'√©chelle du r√©seau.  Abonnez-vous <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√† la newsletter</a> et restez √† l'√©coute pour ne pas manquer l'article. <br><br>  √Ä <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++,</a> Vasily Pantyukhin fera une pr√©sentation ¬´ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Houston, nous avons un probl√®me.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conception de syst√®mes de d√©faillance, mod√®les de d√©veloppement de services internes au cloud Amazon</a> . ¬ª  Ce que les d√©veloppeurs de conception d'Amazon utilisent des mod√®les de conception de syst√®mes distribu√©s, quelles sont les raisons des √©checs de service, quelle est l'architecture bas√©e sur les cellules, Constant Work, Shuffle Sharding - ce sera int√©ressant.  Moins d'un mois avant la conf√©rence - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">r√©servez vos billets</a> .  24 octobre, l'augmentation finale des prix. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr471686/">https://habr.com/ru/post/fr471686/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr471668/index.html">Analyse technique de l'exploit checkm8</a></li>
<li><a href="../fr471670/index.html">Essayer Jetpack Compose au combat?</a></li>
<li><a href="../fr471676/index.html">Escrocs au t√©l√©phone. La deuxi√®me action, dans laquelle je tombe en panne et me dirige vers le distributeur de billets le plus proche</a></li>
<li><a href="../fr471678/index.html">Services aux ours sur demande</a></li>
<li><a href="../fr471684/index.html">Pourquoi vous devez cr√©er des modules pour Nginx</a></li>
<li><a href="../fr471688/index.html">Comment AWS fabrique ses services r√©silients. Mise √† l'√©chelle du r√©seau</a></li>
<li><a href="../fr471700/index.html">Comment j'ai choisi une pile technologique avec une base pour l'avenir</a></li>
<li><a href="../fr471702/index.html">Applications Web cyber-am√©lior√©es</a></li>
<li><a href="../fr471704/index.html">Le livre ¬´Mitochondries √©go√Østes. Comment maintenir la sant√© et d√©placer la vieillesse "</a></li>
<li><a href="../fr471706/index.html">9 probl√®mes de r√©seau typiques qui peuvent √™tre d√©tect√©s en utilisant l'analyse NetFlow (en utilisant Flowmon comme exemple)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>