<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèª üà¥ üçÄ Por que o Kubernetes √© t√£o complicado com reposit√≥rios? üë©üèª‚Äçüöí üîì ü•®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando os orquestradores de cont√™ineres como o Kubernetes chegaram, a abordagem para desenvolver e implantar aplicativos mudou drasticamente. Aparecer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Por que o Kubernetes √© t√£o complicado com reposit√≥rios?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/441222/"><p><img src="https://habrastorage.org/webt/3w/v4/sh/3wv4sha9sfamx7elh4imtocvesm.jpeg"></p><br><p>  Quando os orquestradores de cont√™ineres como o Kubernetes chegaram, a abordagem para desenvolver e implantar aplicativos mudou drasticamente.  Apareceram microsservi√ßos e, para o desenvolvedor, a l√≥gica do aplicativo n√£o est√° mais conectada √† infraestrutura: crie aplicativos para voc√™ e ofere√ßa novas fun√ß√µes. </p><br><p>  O Kubernetes abstrai dos computadores f√≠sicos que controla.  Diga a ele quanta mem√≥ria e capacidade de processamento voc√™ precisa - e voc√™ obter√° tudo.  Infraestrutura?  N√£o, n√£o ouvi. </p><br><p>  Gerenciar imagens do Docker, Kubernetes e aplicativos o torna port√°til.  Tendo desenvolvido aplicativos de cont√™iner com o Kubernetes, voc√™ pode implant√°-los em qualquer lugar: em uma nuvem aberta, localmente ou em um ambiente h√≠brido - sem alterar o c√≥digo. </p><br><p>  Adoramos o Kubernetes por escalabilidade, portabilidade e capacidade de gerenciamento, mas ele n√£o armazena o estado.  Mas temos quase todos os aplicativos com estado, ou seja, eles precisam de armazenamento externo. </p><a name="habracut"></a><br><p>  Kubernetes tem uma arquitetura muito din√¢mica.  Os cont√™ineres s√£o criados e destru√≠dos, dependendo da carga e das instru√ß√µes dos desenvolvedores.  Vagens e recipientes s√£o auto-repar√°veis ‚Äã‚Äãe replic√°veis.  Eles s√£o essencialmente ef√™meros. </p><br><p>  <strong>O armazenamento externo √© muito dif√≠cil para essa variabilidade.</strong>  <strong>N√£o obedece √†s regras da cria√ß√£o e destrui√ß√£o din√¢micas.</strong> </p><br><p> S√≥ √© necess√°rio implantar um aplicativo com estado em outra infraestrutura: em outra nuvem, local ou em um modelo h√≠brido - como ele tem problemas de portabilidade.  O armazenamento externo pode ser vinculado a uma nuvem espec√≠fica. </p><br><p>  Mas somente nesses dep√≥sitos de aplicativos em nuvem o pr√≥prio diabo quebrar√° a perna.  E v√° entender os significados fict√≠cios e os significados da <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">terminologia</a></strong> de <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">armazenamento no Kubernetes</a></strong> .  E existem reposit√≥rios pr√≥prios da Kubernetes, plataformas de c√≥digo aberto, servi√ßos gerenciados ou pagos ... </p><br><p>  Aqui est√£o alguns exemplos <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de armazenamento em nuvem CNCF</a></strong> : </p><br><p><img src="https://habrastorage.org/webt/cm/wl/ov/cmwlovlr6qt3qcicg0sm5acufvw.png"></p><br><p>  Parece que implantou o banco de dados no Kubernetes - voc√™ s√≥ precisa selecionar a solu√ß√£o apropriada, empacot√°-lo em um cont√™iner para trabalhar no disco local e implant√°-lo no cluster como a pr√≥xima carga de trabalho.  Mas o banco de dados tem suas pr√≥prias peculiaridades, portanto, pensar n√£o √© um gelo. </p><br><p>  Cont√™ineres - eles s√£o t√£o pavimentados que n√£o preservam seu estado.  Por isso √© t√£o f√°cil come√ßar e parar.  E como n√£o h√° nada para salvar e transferir, o cluster n√£o se preocupa com as opera√ß√µes de leitura e c√≥pia. </p><br><p>  Voc√™ precisar√° armazenar o estado no banco de dados.  Se um banco de dados implantado em um cluster em um cont√™iner n√£o migra para lugar nenhum e n√£o inicia com muita frequ√™ncia, a f√≠sica do armazenamento de dados entra em jogo.  Idealmente, os cont√™ineres que usam dados devem estar no mesmo ambiente que o banco de dados. </p><br><p>  Em alguns casos, o banco de dados, √© claro, pode ser implantado em um cont√™iner.  Em um ambiente de teste ou em tarefas em que h√° poucos dados, os bancos de dados vivem confortavelmente em clusters. </p><br><p>  <strong>A produ√ß√£o geralmente requer armazenamento externo.</strong> </p><br><p>  O Kubernetes se comunica com o reposit√≥rio atrav√©s de interfaces do plano de controle.  Eles vinculam o Kubernetes ao armazenamento externo.  O armazenamento externo anexado ao Kubernetes √© chamado de plugins de volume.  Com eles, voc√™ pode abstrair o armazenamento e transferir o armazenamento. </p><br><p>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Os plug-ins de volume costumavam ser criados</a></strong> , vinculados, compilados e entregues usando a base de c√≥digo do Kubernetes.  Isso limitou muito os desenvolvedores e exigiu manuten√ß√£o adicional: se voc√™ deseja adicionar novos reposit√≥rios, altere a base de c√≥digo do Kubernetes. </p><br><p>  Agora implante plugins de volume no cluster - n√£o quero.  E voc√™ n√£o precisa se aprofundar na base de c√≥digo.  Agradecimentos a CSI e Flexvolume. </p><br><p><img src="https://habrastorage.org/webt/ug/r7/m4/ugr7m4uco1skczyasqf7xf3op3y.png"></p><br><h3 id="sobstvennoe-hranilische-kubernetes">  Armazenamento nativo do Kubernetes </h3><br><p>  Como o Kubernetes resolve problemas de armazenamento?  Existem v√°rias solu√ß√µes: op√ß√µes ef√™meras, armazenamento persistente em volumes persistentes, consultas de Reivindica√ß√£o de Volume Persistente, classes de armazenamento ou StatefulSets.  V√° descobrir isso, em geral. </p><br><p>  Volumes Persistentes (PV) s√£o unidades de armazenamento preparadas pelo administrador.  Eles n√£o dependem de lares e de suas vidas fugazes. </p><br><p>  Reivindica√ß√£o de volume persistente (PVC) s√£o solicita√ß√µes de armazenamento, ou seja, PV.  Com o PVC, voc√™ pode vincular o armazenamento a um n√≥, e este n√≥ o utilizar√°. </p><br><p>  Voc√™ pode trabalhar com armazenamento estaticamente ou dinamicamente. </p><br><p>  Com uma abordagem est√°tica, o administrador prepara PVs que devem ser veiculados antes, antes de solicita√ß√µes, e esses PVs s√£o vinculados manualmente a pods espec√≠ficos usando PVCs expl√≠citos. </p><br><p>  Na pr√°tica, PVs especialmente definidos n√£o s√£o compat√≠veis com a estrutura port√°til do Kubernetes - o armazenamento depende do ambiente, como o AWS EBS ou uma unidade permanente GCE.  Para ligar manualmente, voc√™ precisa apontar para um reposit√≥rio espec√≠fico no arquivo YAML. </p><br><p>  A abordagem est√°tica geralmente contradiz a filosofia do Kubernetes: CPUs e mem√≥ria n√£o s√£o alocadas antecipadamente e n√£o est√£o vinculadas a pods ou cont√™ineres.  Eles s√£o emitidos dinamicamente. </p><br><p>  Para provisionamento din√¢mico, usamos classes de armazenamento.  O administrador do cluster n√£o precisa criar o PV antecipadamente.  Ele cria v√°rios perfis de armazenamento, como modelos.  Quando um desenvolvedor faz uma solicita√ß√£o de PVC, no momento da solicita√ß√£o, um desses padr√µes √© criado e anexado √† lareira. </p><br><p><img src="https://habrastorage.org/webt/id/9q/mj/id9qmjxqf7tqnki0xc_1a710seg.png"></p><br><p>  Portanto, nos termos mais gerais, o Kubernetes trabalha com armazenamento externo.  Existem muitas outras op√ß√µes. </p><br><h3 id="csi--container-storage-interface">  CSI - Interface de armazenamento de cont√™ineres </h3><br><p>  Existe uma coisa - <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Interface de Armazenamento de Cont√™iner</a></strong> .  O CSI foi criado pelo grupo de trabalho do cofre do CNCF, que decidiu definir uma interface de armazenamento de cont√™iner padr√£o para que os drivers do cofre trabalhassem com qualquer orquestra. </p><br><p>  As especifica√ß√µes da CSI j√° est√£o adaptadas para o Kubernetes e existem v√°rios <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plugins de driver</a></strong> para implanta√ß√µes no cluster Kubernetes.  Voc√™ deve acessar o reposit√≥rio atrav√©s de um driver de volume compat√≠vel com CSI - use o <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tipo de</a></strong> volume <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">csi</a></strong> no Kubernetes. </p><br><p>  Com o CSI, o armazenamento pode ser considerado outra carga de trabalho para conteineriza√ß√£o e implanta√ß√£o no cluster Kubernetes. </p><br><p>  Para mais detalhes, ou√ßa <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Jie Yu falar sobre CSI em nosso podcast</a></strong> . </p><br><h3 id="opensors-proekty">  Projetos de c√≥digo aberto </h3><br><p>  As ferramentas e os projetos das tecnologias em nuvem se multiplicam rapidamente, e uma boa parte dos projetos de c√≥digo aberto - o que √© l√≥gico - resolve um dos principais problemas de produ√ß√£o: trabalhar com armazenamento na arquitetura em nuvem. </p><br><p>  Os mais populares deles s√£o Ceph e Rook. </p><br><p>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Ceph</a></strong> √© um cluster de armazenamento distribu√≠do gerenciado dinamicamente com escala horizontal.  O Ceph fornece uma abstra√ß√£o l√≥gica para recursos de armazenamento.  N√£o possui um √∫nico ponto de falha, gerencia a si pr√≥prio e trabalha com base em software.  O Ceph fornece interfaces para armazenar blocos, objetos e arquivos simultaneamente para um √∫nico cluster de armazenamento. </p><br><p>  O Ceph possui uma arquitetura muito complexa com os algoritmos RADOS, librados, RADOSGW, RDB, CRUSH e v√°rios componentes (monitores, OSD, MDS).  N√£o vamos nos aprofundar na arquitetura, basta entender que o Ceph √© um cluster de armazenamento distribu√≠do que simplifica a escalabilidade, elimina um √∫nico ponto de falha sem sacrificar o desempenho e fornece um √∫nico armazenamento com acesso a objetos, blocos e arquivos. </p><br><p>  Naturalmente, o Ceph √© adaptado para a nuvem.  Voc√™ pode implantar um cluster Ceph de maneiras diferentes, por exemplo, usando Ansible ou em um cluster Kubernetes por meio de CSI e PVC. </p><br><p><img src="https://habrastorage.org/webt/g9/kn/ft/g9knft3jj1y3hw8u2v-4jzoa26k.png"><br>  <em>Arquitetura Ceph</em> </p><br><p>  Rook √© outro projeto interessante e popular.  Ele combina o Kubernetes com sua computa√ß√£o e o Ceph com seus reposit√≥rios em um cluster. </p><br><p>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rook</a></strong> √© um orquestrador de armazenamento em nuvem que complementa o Kubernetes.  Eles empacotam o Ceph em cont√™ineres e usam a l√≥gica de gerenciamento de cluster para uma opera√ß√£o confi√°vel do Ceph no Kubernetes.  O Rook automatiza a implanta√ß√£o, autoinicializa√ß√£o, ajuste, dimensionamento, reequil√≠brio - em geral, tudo o que o administrador do cluster faz. </p><br><p>  Com o Rook, um cluster Ceph pode ser implantado no yaml, como o Kubernetes.  Neste arquivo, o administrador descreve o que ele precisa no cluster.  Rook inicia um cluster e come√ßa a monitorar ativamente.  Isso √© algo como um operador ou controlador - garante que todos os requisitos do yaml sejam atendidos.  Rook funciona com ciclos de sincroniza√ß√£o - ele v√™ o estado e executa uma a√ß√£o se houver desvios. </p><br><p>  Ele n√£o tem seu estado permanente e n√£o precisa ser controlado.  Est√° no esp√≠rito de Kubernetes. </p><br><p><img src="https://habrastorage.org/webt/ep/qx/qk/epqxqk5iecbwcekk88ac8tjxih4.png"></p><br><p>  Rook, combinando Ceph e Kubernetes, √© uma das solu√ß√µes de armazenamento em nuvem mais populares: 4.000 estrelas no Github, 16,3 milh√µes de downloads e mais de cem colaboradores. <br>  O projeto Rook j√° foi aceito no CNCF <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">e</a></strong> , <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recentemente, acabou em uma incubadora</a></strong> . </p><br><p>  <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Bassam Tabara</a></strong> lhe dir√° mais sobre Rook <strong><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em nosso epis√≥dio do reposit√≥rio Kubernetes</a></strong> . <br>  Se o aplicativo tiver um problema, voc√™ precisar√° descobrir os requisitos e criar um sistema ou usar as ferramentas necess√°rias.  Isso tamb√©m se aplica ao armazenamento em nuvem.  E embora o problema n√£o seja dos simples, as ferramentas e abordagens ficaram aqu√©m.  A tecnologia em nuvem continua a evoluir e novas solu√ß√µes certamente nos aguardam. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441222/">https://habr.com/ru/post/pt441222/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441212/index.html">Trabalhar com prote√ß√£o de informa√ß√µes criptogr√°ficas e portadores de chaves de hardware no Linux</a></li>
<li><a href="../pt441214/index.html">Guia do Usu√°rio Kibana. Visualiza√ß√£o. Parte 1</a></li>
<li><a href="../pt441216/index.html">Espelho preto ou an√∫ncio Picooc?</a></li>
<li><a href="../pt441218/index.html">OpenAI Gym + ROS + Gazebo: treinando um rob√¥ aut√¥nomo em casa. Parte 1</a></li>
<li><a href="../pt441220/index.html">An√°lise de recentes ataques em massa com captura de DNS</a></li>
<li><a href="../pt441224/index.html">Crie um exemplo do ARCore de faces aumentadas no Unity</a></li>
<li><a href="../pt441226/index.html">A Forbes publicou uma lista das empresas russas de Internet mais caras em 2019</a></li>
<li><a href="../pt441234/index.html">Efeitos de filtragem SVG. Parte 6. Criando texturas com feTurbulence</a></li>
<li><a href="../pt441236/index.html">Habraiting 2018: os melhores materiais para 2018</a></li>
<li><a href="../pt441238/index.html">Programa√ß√£o de ingl√™s</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>