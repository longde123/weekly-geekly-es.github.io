<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïö üèúÔ∏è üëâ Apprendre Rust: Comment j'ai fait le chat UDP avec Azul üéñÔ∏è üó°Ô∏è üâê</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue d'apprendre Rust. Je ne sais toujours pas grand-chose, donc je fais beaucoup d‚Äôerreurs. La derni√®re fois, j'ai essay√© de faire un jeu Snak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apprendre Rust: Comment j'ai fait le chat UDP avec Azul</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433624/"><img src="https://habrastorage.org/webt/zl/na/ih/zlnaihhfzb9dcso-bkwp_extqd4.jpeg"><br><br>  Je continue d'apprendre Rust.  Je ne sais toujours pas grand-chose, donc je fais beaucoup d‚Äôerreurs.  La derni√®re fois, j'ai essay√© de faire un jeu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Snake</a> .  J'ai essay√© des cycles, des collections, travailler avec 3D <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Three.rs</a> .  En savoir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus</a> sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ggez</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">am√©thyste</a> .  Cette fois, j'ai essay√© de cr√©er un client et un serveur pour le chat.  Pour GUI utilis√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Azul</a> .  A √©galement regard√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conrod</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Yew</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Orbtk</a> .  J'ai essay√© le multithreading, les canaux et le r√©seautage.  J'ai pris en compte les erreurs de l'article pr√©c√©dent et j'ai essay√© de rendre cela plus d√©taill√©.  Pour plus de d√©tails, bienvenue au chat. <a name="habracut"></a><br><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources, fonctionne sur Windows 10 x64</a> <br><br>  Pour le r√©seautage, j'ai utilis√© UDP parce que je veux faire mon prochain projet en utilisant ce protocole et je voulais m'entra√Æner avec lui ici.  Pour l'interface graphique, j'ai rapidement parcouru des projets Google sur Rust, regard√© les exemples de base pour eux, et Azul m'a accroch√© parce qu'il utilise un mod√®le d'objet de document et un moteur de style CSS, et j'√©tais engag√© dans le d√©veloppement Web depuis longtemps.  En g√©n√©ral, j'ai choisi le Cadre de mani√®re subjective.  Il est, jusqu'√† pr√©sent, en alpha profond: le d√©filement ne fonctionne pas, le focus d'entr√©e ne fonctionne pas, il n'y a pas de curseur.  Pour saisir des donn√©es dans un champ de texte, vous devez passer la souris dessus et la maintenir directement au-dessus pendant que vous tapez.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plus de d√©tails ...</a> <br><br>  En fait, la plupart de l'article sont des commentaires de code. <br><br><h2>  Azul </h2><br>  Framework GUI utilisant un style fonctionnel, DOM, CSS.  Votre interface se compose d'un √©l√©ment racine, qui a de nombreux descendants, qui peuvent avoir leurs propres descendants, comme en HTML et XML.  L'interface enti√®re est cr√©√©e √† partir des donn√©es d'un seul DataModel.  Dans ce document, toutes les donn√©es sont transf√©r√©es √† la pr√©sentation en g√©n√©ral.  Si quelqu'un conna√Æt ASP.NET, Azul et son DataModel sont comme Razor et son ViewModel.  Comme en HTML, vous pouvez lier des fonctions aux √©v√©nements des √©l√©ments DOM.  Vous pouvez styliser des √©l√©ments √† l'aide du cadre CSS.  Ce n'est pas le m√™me CSS que HTML, mais tr√®s similaire.  Il existe √©galement une liaison bidirectionnelle comme dans Angular ou MVVM dans WPF, UWP.  Plus d'informations <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site</a> . <br><br><h2>  Un bref aper√ßu du reste des cadres </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Orbtk</a> - Presque le m√™me que Azul et aussi en alpha profond </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Conrod</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Vid√©o</a> Vous pouvez cr√©er des applications de bureau multiplateforme. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Yew</a> est WebAssembly et similaire √† React.  Pour le d√©veloppement web. </li></ul><br><h2>  Client </h2><br><h3>  La structure dans laquelle les fonctions auxiliaires de lecture et d'√©criture sur un socket sont regroup√©es </h3><br><pre><code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatService</span></span></span></span> {} <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> ChatService { <span class="hljs-comment"><span class="hljs-comment">//1 fn read_data(socket: &amp;Option&lt;UdpSocket&gt;) -&gt; Option&lt;String&gt; { //2 let mut buf = [0u8; 4096]; match socket { Some(s) =&gt; { //3 match s.recv(&amp;mut buf) { //4 Ok(count) =&gt; Some(String::from_utf8(buf[..count].into()) .expect("can't parse to String")), Err(e) =&gt; { //5 println!("Error {}", e); None } } } _ =&gt; None, } } //6 fn send_to_socket(message: String, socket: &amp;Option&lt;UdpSocket&gt;) { match socket { //7 Some(s) =&gt; { s.send(message.as_bytes()).expect("can't send"); } _ =&gt; return, } } }</span></span></code> </pre> <br><ol><li>  Lire les donn√©es du socket </li><li>  Tampon pour les donn√©es √† lire √† partir du socket. </li><li>  Appel bloquant.  Ici, le flux d'ex√©cution s'arr√™te jusqu'√† ce que les donn√©es soient lues ou qu'un d√©lai d'attente se produise. </li><li>  Nous obtenons une cha√Æne d'un tableau d'octets dans le codage UTF8. </li><li>  Nous arrivons ici si la connexion a √©t√© interrompue par un timeout ou une autre erreur s'est produite. </li><li>  Envoie une cha√Æne √† une socket. </li><li>  Convertissez la cha√Æne en octets dans le codage UTF8 et envoyez les donn√©es au socket.  L'√©criture de donn√©es sur un socket n'est pas bloquante, c'est-√†-dire  le fil d'ex√©cution continuera son travail.  Si les donn√©es n'ont pas pu √™tre envoy√©es, nous interrompons le programme avec le message ¬´impossible d'envoyer¬ª. </li></ol><br><h3>  Une structure qui regroupe des fonctions pour g√©rer les √©v√©nements de l'utilisateur et modifier notre DataModel </h3><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span></span> {} <span class="hljs-comment"><span class="hljs-comment">//1 const TIMEOUT_IN_MILLIS: u64 = 2000; impl Controller { //2 fn send_pressed(app_state: &amp;mut azul::prelude::AppState&lt;ChatDataModel&gt;, _event: azul::prelude::WindowEvent&lt;ChatDataModel&gt;) -&gt; azul::prelude::UpdateScreen { //3 let data = app_state.data.lock().unwrap(); //4 let message = data.messaging_model.text_input_state.text.clone(); data.messaging_model.text_input_state.text = "".into(); //5 ChatService::send_to_socket(message, &amp;data.messaging_model.socket); //6 azul::prelude::UpdateScreen::Redraw } //7 fn login_pressed(app_state: &amp;mut azul::prelude::AppState&lt;ChatDataModel&gt;, _event: azul::prelude::WindowEvent&lt;ChatDataModel&gt;) -&gt; azul::prelude::UpdateScreen { //8 use std::time::Duration; //9 if let Some(ref _s) = app_state.data.clone().lock().unwrap().messaging_model.socket { return azul::prelude::UpdateScreen::DontRedraw; } //10 app_state.add_task(Controller::read_from_socket_async, &amp;[]); //11 app_state.add_daemon(azul::prelude::Daemon::unique(azul::prelude::DaemonCallback(Controller::redraw_daemon))); //12 let mut data = app_state.data.lock().unwrap(); //13 let local_address = format!("127.0.0.1:{}", data.login_model.port_input.text.clone().trim()); //14 let socket = UdpSocket::bind(&amp;local_address) .expect(format!("can't bind socket to {}", local_address).as_str()); //15 let remote_address = data.login_model.address_input.text.clone().trim().to_string(); //16 socket.connect(&amp;remote_address) .expect(format!("can't connect to {}", &amp;remote_address).as_str()); //17 socket.set_read_timeout(Some(Duration::from_millis(TIMEOUT_IN_MILLIS))) .expect("can't set time out to read"); // 18 data.logged_in = true; // 19 data.messaging_model.socket = Option::Some(socket); //20 azul::prelude::UpdateScreen::Redraw } //21 fn read_from_socket_async(app_data: Arc&lt;Mutex&lt;ChatDataModel&gt;&gt;, _: Arc&lt;()&gt;) { //22 let socket = Controller::get_socket(app_data.clone()); loop { //23 if let Some(message) = ChatService::read_data(&amp;socket) { //24 app_data.modify(|state| { //25 state.messaging_model.has_new_message = true; //26 state.messaging_model.messages.push(message); }); } } } //27 fn redraw_daemon(state: &amp;mut ChatDataModel, _repres: &amp;mut azul::prelude::Apprepres) -&gt; (azul::prelude::UpdateScreen, azul::prelude::TerminateDaemon) { //28 if state.messaging_model.has_new_message { state.messaging_model.has_new_message = false; (azul::prelude::UpdateScreen::Redraw, azul::prelude::TerminateDaemon::Continue) } else { (azul::prelude::UpdateScreen::DontRedraw, azul::prelude::TerminateDaemon::Continue) } } //29 fn get_socket(app_data: Arc&lt;Mutex&lt;ChatDataModel&gt;&gt;) -&gt; Option&lt;UdpSocket&gt; { //30 let ref_model = &amp;(app_data.lock().unwrap().messaging_model.socket); //31 match ref_model { Some(s) =&gt; Some(s.try_clone().unwrap()), _ =&gt; None } } }</span></span></code> </pre><br><ol><li>  D√©lai d'expiration en millisecondes apr√®s lequel l'op√©ration de blocage de la lecture √† partir du socket sera interrompue. </li><li>  La fonction est remplie lorsque l'utilisateur souhaite envoyer un nouveau message au serveur. </li><li>  Nous prenons possession du mutex avec notre mod√®le de donn√©es.  Cela bloque le thread de redessin d'interface jusqu'√† ce que le mutex soit lib√©r√©. </li><li>  Nous faisons une copie du texte entr√© par l'utilisateur pour le transf√©rer plus loin et effa√ßons le champ de saisie de texte. </li><li>  Nous envoyons un message. </li><li>  Nous informons le Framework qu'apr√®s avoir trait√© cet √©v√©nement, nous devons redessiner l'interface. </li><li>  La fonction fonctionne lorsque l'utilisateur souhaite se connecter au serveur. </li><li>  Nous connectons la structure pour repr√©senter la dur√©e de la biblioth√®que standard. </li><li>  Si nous sommes d√©j√† connect√©s au serveur, nous interrompons l'ex√©cution de la fonction et informons le Framework qu'il n'est pas n√©cessaire de redessiner l'interface. </li><li>  Ajoutez une t√¢che qui sera ex√©cut√©e de mani√®re asynchrone dans le thread √† partir du pool de threads du cadre Azul.  L'acc√®s au mutex avec le mod√®le de donn√©es bloque la mise √† jour de l'interface utilisateur jusqu'√† ce que le mutex soit lib√©r√©. </li><li>  Ajoutez une t√¢che r√©currente qui s'ex√©cute dans le thread principal.  Tous les calculs longs dans ce d√©mon sont bloqu√©s par la mise √† jour de l'interface. </li><li>  Nous entrons en possession du mutex. </li><li>  Nous lisons le port entr√© par l'utilisateur et cr√©ons une adresse locale en fonction de celui-ci, nous l'√©couterons. </li><li>  Cr√©ez un socket UDP qui lit les paquets arrivant √† l'adresse locale. </li><li>  Nous lisons l'adresse du serveur saisie par l'utilisateur. </li><li>  Nous demandons √† notre socket UDP de lire les paquets uniquement √† partir de ce serveur. </li><li>  D√©finissez le d√©lai d'expiration de l'op√©ration de lecture √† partir du socket.  L'√©criture dans le socket se produit sans attendre, c'est-√†-dire que nous √©crivons simplement des donn√©es et n'attendons rien, et l'op√©ration de lecture √† partir du socket bloque le flux et attend jusqu'√† ce que les donn√©es pouvant √™tre lues arrivent.  Si vous ne d√©finissez pas de d√©lai d'expiration, l'op√©ration de lecture √† partir du socket attendra ind√©finiment. </li><li>  D√©finissez un indicateur indiquant que l'utilisateur s'est d√©j√† connect√© au serveur. </li><li>  Nous passons le socket cr√©√© au mod√®le de donn√©es. </li><li>  Nous informons le Framework qu'apr√®s avoir trait√© cet √©v√©nement, nous devons redessiner l'interface. </li><li>  Une op√©ration asynchrone qui s'ex√©cute dans le pool de threads du cadre Azul. </li><li>  Obtenez une copie du socket √† partir de notre mod√®le de donn√©es. </li><li>  Essayer de lire des donn√©es √† partir d'un socket.  Si vous ne faites pas de copie du socket et attendez directement ici jusqu'√† ce qu'un message arrive du socket qui se trouve dans le mutex dans notre mod√®le de donn√©es, alors l'interface enti√®re cessera d'√™tre mise √† jour jusqu'√† ce que nous lib√©rions le mutex. </li><li>  Si nous obtenons une sorte de message, puis en modifiant notre mod√®le de donn√©es, modifier fait la m√™me chose que lock (). D√©baller () en passant le r√©sultat au lambda et en lib√©rant le mutex apr√®s la fin du code lambda. </li><li>  D√©finissez un indicateur pour indiquer que nous avons un nouveau message. </li><li>  Ajoutez un message √† la liste de tous les messages de discussion. </li><li>  Une op√©ration synchrone r√©p√©titive s'ex√©cutant dans le thread principal. </li><li>  Si nous avons un nouveau message, nous informons le Framework que nous devons redessiner l'interface √† partir de z√©ro et continuer √† travailler avec ce d√©mon; sinon, nous ne dessinerons pas l'interface depuis le d√©but, mais nous appellerons toujours cette fonction dans le cycle suivant. </li><li>  Cr√©e une copie de notre socket afin de ne pas verrouiller le mutex avec notre mod√®le de donn√©es. </li><li>  Nous obtenons le mutex et obtenons un lien vers la socket. </li><li>  Cr√©ez une copie du socket.  Mutex sera lib√©r√© automatiquement √† la sortie d'une fonction. </li></ol><br><h3>  Traitement des donn√©es et d√©mons asynchrones √† Azul </h3><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">// Problem - blocks UI :( fn start_connection(app_state: &amp;mut AppState&lt;MyDataModel&gt;, _event: WindowEvent&lt;MyDataModel&gt;) -&gt; UpdateScreen { //   app_state.add_task(start_async_task, &amp;[]); //  app_state.add_daemon(Daemon::unique(DaemonCallback(start_daemon))); UpdateScreen::Redraw } fn start_daemon(state: &amp;mut MyDataModel, _repres: &amp;mut Apprepres) -&gt; (UpdateScreen, TerminateDaemon) { // UI    thread::sleep(Duration::from_secs(10)); state.counter += 10000; (UpdateScreen::Redraw, TerminateDaemon::Continue) } fn start_async_task(app_data: Arc&lt;Mutex&lt;MyDataModel&gt;&gt;, _: Arc&lt;()&gt;) { // simulate slow load app_data.modify(|state| { // UI    thread::sleep(Duration::from_secs(10)); state.counter += 10000; }); }</span></span></code> </pre><br>  Le d√©mon est toujours ex√©cut√© dans le thread principal, donc le blocage y est in√©vitable.  Avec une t√¢che asynchrone, si vous le faites, par exemple, comme ceci, il n'y aura pas de verrouillage pendant 10 secondes. <br><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_async_task</span></span></span></span>(app_data: Arc&lt;Mutex&lt;MyDataModel&gt;&gt;, _: Arc&lt;()&gt;) { <span class="hljs-comment"><span class="hljs-comment">//  UI.  . thread::sleep(Duration::from_secs(10)); app_data.modify(|state| { state.counter += 10000; }); }</span></span></code> </pre><br>  La fonction de modification appelle lock () et le mutex avec le mod√®le de donn√©es bloque donc la mise √† jour de l'interface pendant la dur√©e de son ex√©cution. <br><br><h3>  Nos styles </h3><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CUSTOM_CSS: &amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span> = <span class="hljs-string"><span class="hljs-string">" .row { height: 50px; } .orange { background: linear-gradient(to bottom, #f69135, #f37335); font-color: white; border-bottom: 1px solid #8d8d8d; }"</span></span>;</code> </pre><br><h3>  En fait, Fonctions pour cr√©er notre DOM √† afficher √† son utilisateur </h3><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> azul::prelude::Layout <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ChatDataModel { <span class="hljs-comment"><span class="hljs-comment">//1 fn layout(&amp;self, info: azul::prelude::WindowInfo&lt;Self&gt;) -&gt; azul::prelude::Dom&lt;Self&gt; { //2 if self.logged_in { self.chat_form(info) } else { self.login_form(info) } } } impl ChatDataModel { //3 fn login_form(&amp;self, info: azul::prelude::WindowInfo&lt;Self&gt;) -&gt; azul::prelude::Dom&lt;Self&gt; { //4 let button = azul::widgets::button::Button::with_label("Login") //5 .dom() //6 .with_class("row") //7 .with_class("orange") //8 .with_callback( azul::prelude::On::MouseUp, azul::prelude::Callback(Controller::login_pressed)); //9 let port_label = azul::widgets::label::Label::new("Enter port to listen:") .dom() .with_class("row"); //10 let port = azul::widgets::text_input::TextInput::new() //11 .bind(info.window, &amp;self.login_model.port_input, &amp;self) .dom(&amp;self.login_model.port_input) .with_class("row"); // 9 let address_label = azul::widgets::label::Label::new("Enter server address:") .dom() .with_class("row"); //10 let address = azul::widgets::text_input::TextInput::new() //11 .bind(info.window, &amp;self.login_model.address_input, &amp;self) .dom(&amp;self.login_model.address_input) .with_class("row"); //12 azul::prelude::Dom::new(azul::prelude::NodeType::Div) .with_child(port_label) .with_child(port) .with_child(address_label) .with_child(address) .with_child(button) } //13 fn chat_form(&amp;self, info: azul::prelude::WindowInfo&lt;Self&gt;) -&gt; azul::prelude::Dom&lt;Self&gt; { //14 let button = azul::widgets::button::Button::with_label("Send") .dom() .with_class("row") .with_class("orange") .with_callback(azul::prelude::On::MouseUp, azul::prelude::Callback(Controller::send_pressed)); //15 let text = azul::widgets::text_input::TextInput::new() .bind(info.window, &amp;self.messaging_model.text_input_state, &amp;self) .dom(&amp;self.messaging_model.text_input_state) .with_class("row"); //12 let mut dom = azul::prelude::Dom::new(azul::prelude::NodeType::Div) .with_child(text) .with_child(button); //16 for i in &amp;self.messaging_model.messages { dom.add_child(azul::widgets::label::Label::new(i.clone()).dom().with_class("row")); } dom } }</span></span></code> </pre><br><ol><li>  La fonction qui cr√©e le DOM final et est appel√©e √† chaque fois que vous devez redessiner l'interface. </li><li>  Si nous sommes d√©j√† connect√©s au serveur, nous affichons alors le formulaire d'envoi et de lecture des messages, sinon nous affichons le formulaire de connexion au serveur. </li><li>  Cr√©e un formulaire pour entrer les donn√©es n√©cessaires pour se connecter au serveur. </li><li>  Cr√©ez un bouton avec l'inscription de texte Connexion. </li><li>  Convertissez-le en objet DOM. </li><li>  Ajoutez-y la classe de ligne. </li><li>  Ajoutez-y la classe css orange. </li><li>  Ajoutez un gestionnaire d'√©v√©nements pour cliquer sur le bouton. </li><li>  Cr√©ez une √©tiquette de texte avec du texte √† afficher sur la ligne utilisateur et la classe css. </li><li>  Nous cr√©ons une zone de texte pour saisir du texte avec du texte √† partir de la propri√©t√© de notre mod√®le et de la ligne de classe css. </li><li>  Liez le champ de texte √† la propri√©t√© de notre DataModel.  Il s'agit d'une liaison bidirectionnelle.  Maintenant, l'√©dition de TextInput modifie automatiquement le texte dans la propri√©t√© de notre mod√®le et l'inverse est √©galement vrai.  Si nous modifions le texte de notre mod√®le, le texte de TextInput changera. </li><li>  Nous cr√©ons un √©l√©ment DOM racine dans lequel nous pla√ßons nos √©l√©ments d'interface utilisateur. </li><li>  Cr√©e un formulaire pour envoyer et lire des messages. </li><li>  Cr√©ez un bouton avec le texte ¬´Envoyer¬ª et css avec les classes ¬´ligne¬ª, ¬´orange¬ª et un gestionnaire d'√©v√©nements lorsque vous cliquez dessus. </li><li>  Nous cr√©ons un champ de saisie de texte avec une liaison bidirectionnelle avec la propri√©t√© de mod√®le self.messaging_model.text_input_state et css avec la classe ¬´row¬ª. </li><li>  Ajoutez des √©tiquettes de texte qui affichent des messages √©crits dans le chat. </li></ol><br><h3>  Notre mod√®le qui stocke l'√©tat de notre interface </h3><br>  La documentation Azul indique qu'elle devrait stocker toutes les donn√©es d'application, y compris la connexion √† la base de donn√©es, donc j'ai mis un socket UDP dedans. <br><br><pre> <code class="rust hljs"><span class="hljs-comment"><span class="hljs-comment">//1 #[derive(Debug)] //2 struct ChatDataModel { //3 logged_in: bool, //4 messaging_model: MessagingDataModel, //5 login_model: LoginDataModel, } #[derive(Debug, Default)] struct LoginDataModel { //6 port_input: azul::widgets::text_input::TextInputState, //7 address_input: azul::widgets::text_input::TextInputState, } #[derive(Debug)] struct MessagingDataModel { //8 text_input_state: azul::widgets::text_input::TextInputState, //9 messages: Vec&lt;String&gt;, //10 socket: Option&lt;UdpSocket&gt;, //11 has_new_message: bool, }</span></span></code> </pre><br><ol><li>  Cela nous permettra d'afficher notre structure sous forme de cha√Æne dans un mod√®le de la forme {:?} </li><li>  Notre mod√®le de donn√©es.  Pour qu'il puisse √™tre utilis√© √† Azul.  Elle doit impl√©menter le trait Layout. </li><li>  Un drapeau pour v√©rifier si l'utilisateur est connect√© ou non au serveur. </li><li>  Un mod√®le pour afficher un formulaire pour envoyer des messages au serveur et enregistrer les messages re√ßus du serveur. </li><li>  Mod√®le d'affichage du formulaire de connexion au serveur. </li><li>  Le port que l'utilisateur a entr√©.  Nous allons l'√©couter avec notre socket. </li><li>  L'adresse du serveur que l'utilisateur a entr√©e.  Nous nous y connecterons. </li><li>  Message d'utilisateur.  Nous l'enverrons au serveur. </li><li>  Un tableau de messages provenant du serveur. </li><li>  La prise par laquelle nous communiquons avec le serveur. </li><li>  Un indicateur pour v√©rifier si un nouveau message est arriv√© du serveur. </li></ol><br><h3>  Et enfin, le principal point d'entr√©e de l'application.  D√©marre un cycle √† partir du dessin GUI et du traitement des entr√©es utilisateur </h3><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() { <span class="hljs-comment"><span class="hljs-comment">//1 let app = azul::prelude::App::new(ChatDataModel { logged_in: false, messaging_model: MessagingDataModel { text_input_state: azul::widgets::text_input::TextInputState::new(""), messages: Vec::new(), socket: None, has_new_message: false, }, login_model: LoginDataModel::default(), }, azul::prelude::AppConfig::default()); // 2 let mut style = azul::prelude::css::native(); //3 style.merge(azul::prelude::css::from_str(CUSTOM_CSS).unwrap()); //4 let window = azul::prelude::Window::new(azul::prelude::WindowCreateOptions::default(), style).unwrap(); //5 app.run(window).unwrap(); }</span></span></code> </pre><br><ol><li>  Nous cr√©ons une application avec des donn√©es de d√©marrage. </li><li>  Les styles utilis√©s par l'application par d√©faut. </li><li>  Ajoutez-y nos propres styles. </li><li>  Nous cr√©ons une fen√™tre dans laquelle notre application s'affichera. </li><li>  Lancez l'application dans cette fen√™tre. </li></ol><br><h2>  Serveur </h2><br><h3>  Le principal point d'entr√©e de l'application </h3><br>  Ici, nous avons g√©n√©ralement une application console. <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span></span>() { <span class="hljs-comment"><span class="hljs-comment">//1 let socket = create_socket(); //2 let (sx, rx) = mpsc::channel(); //3 start_sender_thread(rx, socket.try_clone().unwrap()); loop { //4 sx.send(read_data(&amp;socket)).unwrap(); } }</span></span></code> </pre><br><ol><li>  Cr√©ez un socket. </li><li>  Nous cr√©ons un canal √† sens unique avec un exp√©diteur de message sx et de nombreux destinataires rx. </li><li>  Nous commen√ßons √† envoyer des messages √† tous les destinataires dans un flux s√©par√©. </li><li>  Nous lisons les donn√©es du socket et les envoyons au flux, qui envoie des messages aux clients connect√©s au serveur. </li></ol><br><h3>  Fonction pour cr√©er un flux pour envoyer des messages aux clients </h3><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_sender_thread</span></span></span></span>(rx: mpsc::Receiver&lt;(<span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">u8</span></span>&gt;, SocketAddr)&gt;, socket: UdpSocket) { <span class="hljs-comment"><span class="hljs-comment">//1 thread::spawn(move || { //2 let mut addresses = Vec::&lt;SocketAddr&gt;::new(); //3 loop { //4 let (bytes, pre) = rx.recv().unwrap(); // 5 if !addresses.contains(&amp;pre) { println!(" {} connected to server", pre); addresses.push(pre.clone()); } //6 let result = String::from_utf8(bytes) .expect("can't parse to String") .trim() .to_string(); println!("received {} from {}", result, pre); //7 let message = format!("FROM: {} MESSAGE: {}", pre, result); let data_to_send = message.as_bytes(); //8 addresses .iter() .for_each(|s| { //9 socket.send_to(data_to_send, s) //10 .expect(format!("can't send to {}", pre).as_str()); }); } }); }</span></span></code> </pre><br><ol><li>  Commencez un nouveau fil.  d√©placer signifie que les variables prennent le lambda et le flux, respectivement.  Plus pr√©cis√©ment, notre nouveau thread ¬´absorbera¬ª les variables rx et socket. </li><li>  Une collection d'adresses qui nous sont connect√©es par les clients.  Nous leur enverrons tous nos messages.  En g√©n√©ral, dans un projet r√©el, il serait n√©cessaire de g√©rer la d√©connexion d'un client de nous et la suppression de son adresse de ce tableau. </li><li>  Nous commen√ßons une boucle infinie. </li><li>  Nous lisons les donn√©es du canal.  Ici, le flux sera bloqu√© jusqu'√† l'arriv√©e de nouvelles donn√©es. </li><li>  S'il n'y a pas une telle adresse dans notre tableau, ajoutez-la l√†. </li><li>  D√©codez une cha√Æne UTF8 √† partir d'un tableau d'octets. </li><li>  Nous cr√©ons un tableau d'octets que nous allons envoyer √† tous nos clients. </li><li>  Nous passons par la collecte d'adresses et envoyons des donn√©es √† tout le monde. </li><li>  L'op√©ration d'√©criture sur le socket UDP n'est pas bloquante, donc ici la fonction n'attendra pas que le message arrive au destinataire et s'ex√©cute presque instantan√©ment. </li><li>  attendre en cas d'erreur fera une sortie d'urgence du programme avec le message donn√©. </li></ol><br><h3>  La fonction cr√©e un socket bas√© sur l'entr√©e utilisateur </h3><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TIMEOUT_IN_MILLIS: <span class="hljs-built_in"><span class="hljs-built_in">u64</span></span> = <span class="hljs-number"><span class="hljs-number">2000</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_socket</span></span></span></span>() -&gt; UdpSocket { <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"Enter port to listen"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//1 let local_port: String = read!("{}\n"); let local_address = format!("127.0.0.1:{}", local_port.trim()); println!("server address {}", &amp;local_address); //2 let socket = UdpSocket::bind(&amp;local_address.trim()) .expect(format!("can't bind socket to {}", &amp;local_address).as_str()); //3 socket.set_read_timeout(Some(Duration::from_millis(TIMEOUT_IN_MILLIS))) .expect("can't set time out to read"); //4 socket }</span></span></code> </pre><br><ol><li>  Nous lisons le port que notre serveur √©coutera et cr√©ons une adresse de serveur local sur cette base. </li><li>  Cr√©ez un socket UDP en √©coutant cette adresse. </li><li>  D√©finissez le d√©lai d'expiration de l'op√©ration de lecture.  L'op√©ration de lecture bloque et bloquera le flux jusqu'√† l'arriv√©e de nouvelles donn√©es ou jusqu'√† l'expiration d'un d√©lai. </li><li>  Nous renvoyons le socket cr√©√© √† partir de la fonction. </li><li>  La fonction lit les donn√©es du socket et les renvoie avec l'adresse de l'exp√©diteur. </li></ol><br><h3>  Fonction pour lire les donn√©es d'une socket </h3><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_data</span></span></span></span>(socket: &amp;UdpSocket) -&gt; (<span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">u8</span></span>&gt;, SocketAddr) { <span class="hljs-comment"><span class="hljs-comment">//1 let mut buf = [0u8; 4096]; //2 loop { match socket.recv_from(&amp;mut buf) { //3 Ok((count, address)) =&gt; { //4 return (buf[..count].into(), address); } //5 Err(e) =&gt; { println!("Error {}", e); continue; } }; } }</span></span></code> </pre><br><ol><li>  Le tampon est l'endroit o√π nous lirons les donn√©es. </li><li>  D√©marre une boucle qui s'ex√©cutera jusqu'√† ce que des donn√©es valides soient lues. </li><li>  Nous obtenons le nombre d'octets lus et l'adresse de l'exp√©diteur. </li><li>  Nous coupons le tableau depuis son d√©but au nombre d'octets lus et le convertissons en un vecteur d'octets. </li><li>  Si un d√©lai d'attente ou une autre erreur se produit, passez √† l'it√©ration suivante de la boucle. </li></ol><br><h2>  √Ä propos des calques dans l'application </h2><br><div class="spoiler">  <b class="spoiler_title">Offtopic: Un petit programme √©ducatif pour deux juin au travail.</b>  <b class="spoiler_title">J'ai d√©cid√© de le mettre ici, peut-√™tre que quelqu'un vous sera utile.</b>  <b class="spoiler_title">Les po√®tes pointus de juin sont des exemples en C # et nous parlons d'ASP.NET</b> <div class="spoiler_text">  Donc, il n'y avait rien √† faire, c'√©tait le soir, et j'ai d√©cid√© d'√©crire un petit programme p√©dagogique sur l'architecture pour Artem et Victor.  Eh bien, allons-y. <br><br>  En fait, j'ai ajout√© ici parce que le mode est la reconnaissance et je ne peux √©crire des articles qu'une fois par semaine, et le mat√©riel est d√©j√† l√† et la semaine prochaine, je voulais t√©l√©charger autre chose sur Habr. <br><br>  En r√®gle g√©n√©rale, une application est en couches.  Dans chaque couche, il y a des objets qui impl√©mentent la caract√©ristique de comportement de la couche dans laquelle ils se trouvent.  Et ainsi.  Ce sont les couches. <br><br><ol><li>  Couche de pr√©sentation. </li><li>  Logique m√©tier en couches. </li><li>  Couche d'acc√®s aux donn√©es. </li><li>  Entit√©s (utilisateur, animal, etc.) </li></ol><br><br>  Chaque couche peut contenir son propre DTO et des classes compl√®tement arbitraires avec des m√©thodes arbitraires.  L'essentiel est qu'ils ex√©cutent les fonctionnalit√©s associ√©es √† la couche dans laquelle ils se trouvent.  Dans les applications simples, certaines couches peuvent √™tre manquantes.  Par exemple, une vue de couche peut √™tre impl√©ment√©e via le mod√®le MVC, MVP, MVVM.  Ce qui est compl√®tement facultatif.  L'essentiel est que les classes qui se trouvent dans cette couche impl√©mentent les fonctionnalit√©s assign√©es √† la couche.  N'oubliez pas que les motifs et l'architecture ne sont que des recommandations et non des directions.  Le motif et l'architecture ne sont pas une loi, c'est un conseil. <br><br>  Et donc, nous consid√©rerons chaque couche sur l'exemple d'une application ASP.NET standard utilisant le standard Entity Framework. <br><br><h3>  Couche de pr√©sentation </h3><br>  Nous avons MVC ici.  Il s'agit de la couche qui fournit une interaction avec l'utilisateur.  Les commandes viennent ici et les utilisateurs obtiennent des donn√©es d'ici.  Pas n√©cessairement des gens, si nous avons une API, alors notre utilisateur est un programme diff√©rent.  Les voitures communiquent avec les voitures. <br><br><h3>  Couche logique m√©tier </h3><br>  Ici, g√©n√©ralement, les classes sont appel√©es Service, par exemple, UserService, bien qu'il puisse s'agir de n'importe quoi.  Juste un ensemble de classes avec des m√©thodes.  L'essentiel est que les calculs et les calculs de notre application aient lieu ici.  Il s'agit de la couche la plus √©paisse et la plus volumineuse.  Il y a la plupart du code et diverses classes.  C'est en fait notre application. <br><br><h3>  Couche d'acc√®s aux donn√©es </h3><br>  Habituellement, ici EF impl√©mente les mod√®les d'unit√© de travail et de r√©f√©rentiel.  Donc oui, DbContext est, vous pouvez dire, Unit Of Work, et DB le d√©finit comme Repository.  En fait, c'est l'endroit o√π nous mettons les donn√©es et d'o√π nous les obtenons.  Que la source de donn√©es soit une base de donn√©es, une API d'une autre application, un cache en m√©moire ou simplement une sorte de g√©n√©rateur de nombres al√©atoires.  N'importe quelle source de donn√©es. <br><br><h3>  Entit√©s </h3><br>  Oui, juste toutes sortes d'utilisateurs, d'animaux et plus encore.  Un point important - ils peuvent avoir une sorte de comportement caract√©ristique seulement d'eux.  Par exemple: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">User</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FirstName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> LastName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FullName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FirstName + <span class="hljs-string"><span class="hljs-string">" "</span></span> + LastName; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">User user</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.FullName == user.FullName; } }</code> </pre> <br><h3>  Eh bien, et un exemple tr√®s simple.  Shoba √©tait </h3><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Text; <span class="hljs-comment"><span class="hljs-comment">//Entities class User { public int Id { get; set; } public string Name { get; set; } } //Data Access Layer class UserRepository { private readonly Dictionary&lt;int, User&gt; _db; public UserRepository() { _db = new Dictionary&lt;int, User&gt;(); } public User Get(int id) { return _db[id]; } public void Save(User user) { _db[user.Id] = user; } } //Business Logic Layer class UserService { private readonly UserRepository _repo; private int _currentId = 0; public UserService() { _repo = new UserRepository(); } public void AddNew() { _currentId++; var user = new User { Id = _currentId, Name = _currentId.ToString() }; _repo.Save(user); } public string GetAll() { StringBuilder sb = new StringBuilder(); for (int i = 1; i &lt;= _currentId; i++) { sb.AppendLine($"Id: {i} Name: {_repo.Get(i).Name}"); } return sb.ToString(); } } //presentation Layer aka Application Layer class UserController { private readonly UserService _service; public UserController() { _service = new UserService(); } public string RunExample() { _service.AddNew(); _service.AddNew(); return _service.GetAll(); } } namespace ConsoleApp1 { class Program { static void Main(string[] args) { var controller = new UserController(); Console.WriteLine(controller.RunExample()); Console.ReadLine(); } } }</span></span></code> </pre> <br></div></div><br><h2>  PS </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien sho, je veux dire merci √† mon Nastya pour avoir corrig√© les erreurs grammaticales dans l'article. </font><font style="vertical-align: inherit;">Alors oui, Nastya tu n'es pas en vain avec un dipl√¥me rouge et g√©n√©ralement cool. </font><font style="vertical-align: inherit;">Je t'aime &lt;3.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433624/">https://habr.com/ru/post/fr433624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr433610/index.html">Notes d'un phytochimiste. Kaki</a></li>
<li><a href="../fr433612/index.html">FCC: satellites SpaceX en orbite - une source de d√©bris dangereux pour les habitants de la Terre</a></li>
<li><a href="../fr433614/index.html">Comment prendre le contr√¥le de votre infrastructure r√©seau. Chapitre un R√©tention</a></li>
<li><a href="../fr433618/index.html">Son "tube chaud" de vos propres mains. Et si vous traversez un magasin, un club et un atelier?</a></li>
<li><a href="../fr433620/index.html">Comment fonctionne SystemUI dans Android</a></li>
<li><a href="../fr433628/index.html">Culture du feedback: comment ne pas glisser dans les accusations</a></li>
<li><a href="../fr433630/index.html">Un pas de plus vers le vaccin contre le VIH: titre de singe en anticorps neutralisants s√©riques</a></li>
<li><a href="../fr433632/index.html">Une autre application mobile a "divulgu√©" les donn√©es de ses utilisateurs</a></li>
<li><a href="../fr433634/index.html">Surveillance des ruches | Moi Dadan et demi-ukrainien | Redondance des donn√©es</a></li>
<li><a href="../fr433636/index.html">Lampe de poche-charge-kubotan: une bonne id√©e ou un mannequin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>