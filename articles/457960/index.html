<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•É üÜì üêñ Sala de reuniones LÃ∂iÃ∂tÃ∂tÃ∂lÃ∂eÃ∂ Helper v 2 üéΩ ‚å®Ô∏è üë©‚Äçüë©‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo describe en detalle las etapas de desarrollo de la aplicaci√≥n m√≥vil Meeting Room Helper: desde el inicio de la idea hasta el lanzamiento...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sala de reuniones LÃ∂iÃ∂tÃ∂tÃ∂lÃ∂eÃ∂ Helper v 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/arcadia/blog/457960/">  Este art√≠culo describe en detalle las etapas de desarrollo de la aplicaci√≥n m√≥vil Meeting Room Helper: desde el inicio de la idea hasta el lanzamiento.  La aplicaci√≥n est√° escrita en Kotlin y construida sobre una arquitectura MVVM simplificada, sin usar enlace de datos.  La parte de la interfaz de usuario se actualiza utilizando objetos LiveData.  Las razones para rechazar el enlace de datos se detallan y explican.  La arquitectura utiliza una serie de soluciones interesantes que permiten dividir l√≥gicamente el programa en archivos peque√±os, lo que en √∫ltima instancia simplifica el soporte de c√≥digo. <br><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><img src="https://habrastorage.org/webt/ii/at/pf/iiatpf_m3syq_8mzu08bkaqiy4u.jpeg"><br><a name="habracut"></a><br><h2>  Descripci√≥n del proyecto </h2><br>  Hace 3 a√±os en nuestra empresa surgi√≥ la idea de desarrollar un peque√±o proyecto para la reserva instant√°nea de salas de reuniones.  La mayor√≠a de los gerentes de recursos humanos y Arcadia prefieren usar el calendario de Outlook para tales fines, pero ¬øqu√© pasa con el resto? <br><br>  Dar√© 2 ejemplos de la vida del desarrollador. <br><br><ol><li>  <i>Cualquier equipo peri√≥dicamente tiene un deseo espont√°neo de realizar un rally r√°pido durante 5-10 minutos.</i>  <i>Este deseo puede superar a los desarrolladores en cualquier rinc√≥n de la oficina, y para no distraer a los colegas que los rodean, ellos (los desarrolladores y no solo) comienzan a buscar una conversaci√≥n gratuita.</i>  <i>Al migrar de una sala a otra (en nuestra oficina, las salas de reuniones est√°n dispuestas en una fila), los colegas "comprueban cuidadosamente" cu√°l de las salas est√° actualmente libre.</i>  <i>Como resultado, distraen a sus colegas dentro.</i>  <i>Esos tipos siempre lo han sido y siempre lo ser√°n, incluso si la ejecuci√≥n debe ser filmada en el estatuto corporativo por la interrupci√≥n del mitin.</i>  <i>Quien entendi√≥, √©l entender√°.</i> </li><li>  <i>Y aqu√≠ hay otro caso.</i>  <i>Acabas de salir del comedor y te diriges a ti mismo, pero aqu√≠ tu colega (o gerente) de otro departamento te intercepta.</i>  <i>Quiere decirte algo urgente, y para estos fines necesitas una sala de reuniones.</i>  <i>De acuerdo con las regulaciones, primero debe reservar una habitaci√≥n (desde su tel√©fono o computadora) y solo luego ocuparla.</i>  <i>Es bueno si tiene un tel√©fono m√≥vil con Outlook m√≥vil.</i>  <i>Y si no?</i>  <i>¬øVolver a la computadora y luego nuevamente para volver a la sala de reuniones?</i>  <i>¬øPara obligar a cada empleado a poner Outlook Express en el tel√©fono y asegurarse de que todos lleven los tel√©fonos con ellos?</i>  <i>Estos no son nuestros m√©todos.</i> </li></ol><br>  Es por eso que hace 2.5 a√±os cada una de las salas de reuniones estaba equipada con su propia tableta: <br><br><img src="https://habrastorage.org/webt/kp/2i/ao/kp2iao0nromcb1wa-iewgzxurw0.png"><br><br>  Para este proyecto, mi colega desarroll√≥ la primera versi√≥n de la aplicaci√≥n: Meeting Room Little Helper ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠ puede leer sobre esto</a> ).  MRLH permiti√≥ reservar, cancelar y renovar una reserva, mostr√≥ el estado de las conversaciones restantes.  Reconocer la identidad de un empleado (utilizando el servicio en la nube de Microsoft Face API y nuestros analizadores internos) se ha convertido en un "truco" innovador.  La aplicaci√≥n result√≥ ser s√≥lida y sirvi√≥ fielmente a la compa√±√≠a durante 2.5 a√±os. <br><br>  Pero el tiempo pas√≥ ... aparecieron nuevas ideas.  Quer√≠a algo nuevo y decidimos volver a escribir la aplicaci√≥n. <br><br><h3>  T√©rminos de referencia </h3><br>  Como suele suceder, pero desafortunadamente no siempre, el desarrollo comenz√≥ con la preparaci√≥n de especificaciones t√©cnicas.  En primer lugar, llamamos a los tipos que usan tabletas con m√°s frecuencia para hacer reservas.  Dio la casualidad de que, sobre todo, eran adictos a los recursos humanos y a los gerentes que anteriormente hab√≠an usado Outlook exclusivamente.  De ellos recibimos los siguientes comentarios (de los requisitos, queda claro de inmediato qu√© solicit√≥ RR.HH. y qu√© solicitaron los gerentes): <br><br><ul><li>  debe agregar la posibilidad de reservar cualquier sala de reuniones desde cualquier tableta (anteriormente, cada tableta le permit√≠a reservar solo su sala); </li><li>  ser√≠a genial mirar el calendario de manifestaciones para una reuni√≥n de todo el d√≠a (idealmente, para cualquier d√≠a); </li><li>  todo el ciclo de desarrollo debe llevarse a cabo en poco tiempo (durante 6-7 semanas). </li></ul><br>  Todo est√° claro con los deseos del cliente, pero ¬øqu√© pasa con los requisitos t√©cnicos y el futuro?  Agregue algunos requisitos para el proyecto del gremio de desarrolladores: <br><br><ul><li>  El sistema deber√≠a funcionar tanto con tabletas existentes como con tabletas nuevas; </li><li>  escalabilidad del sistema: desde 50 conversaciones y m√°s (esto deber√≠a ser suficiente con un margen para la mayor√≠a de los clientes si el sistema comienza a replicarse); </li><li>  mantener la funcionalidad anterior (la primera versi√≥n de la aplicaci√≥n utiliz√≥ la API de Java para comunicarse con los servicios de Outlook, y planeamos reemplazarla con una API especializada de Microsoft Graph, por lo que era importante no perder la funcionalidad); </li><li>  minimizaci√≥n del consumo de energ√≠a (las tabletas funcionan con una bater√≠a externa, porque el centro de negocios no permiti√≥ perforar sus paredes para tender nuestros cables); </li><li>  nuevo dise√±o UX / UI, que refleja ergon√≥micamente todas las innovaciones. </li></ul><br>  Total 8 puntos.  Los requisitos son bastante justos.  Adem√°s, estipulamos las reglas generales de desarrollo: <br><br><ul><li>  use solo tecnolog√≠as avanzadas (esto permitir√° que el equipo se desarrolle como especialistas y no se estanque en un solo lugar, al tiempo que simplificar√° el soporte del proyecto en el futuro previsible); </li><li>  siga las mejores pr√°cticas, pero no las d√© por sentado ciegamente, ya que  la regla principal de cualquier profesional (y un desarrollador que se esfuerza por esto) es evaluar todo cr√≠ticamente; </li><li>  Escribir c√≥digo limpio y ordenado (tal vez esto es lo m√°s dif√≠cil cuando intentas combinar innovaci√≥n y tiempo de desarrollo limitado). </li></ul><br>  Un comienzo ha sido hecho.  ¬°Como siempre, es entusiasta!  Veamos que pasa despu√©s. <br><br><h3>  Dise√±o </h3><br>  Dise√±o de aplicaci√≥n desarrollado por el dise√±ador UX: <br><br><img src="https://habrastorage.org/webt/gm/n9/eo/gmn9eox4exzhczkq0zdbkiwrgt8.png"><br><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><br>  Esta es la pantalla principal.  Se mostrar√° la mayor parte del tiempo.  Toda la informaci√≥n necesaria se encuentra ergon√≥micamente aqu√≠: <br><br><ul><li>  el nombre de la habitaci√≥n y su n√∫mero; </li><li>  estado actual; </li><li>  tiempo hasta la pr√≥xima reuni√≥n (o hasta su finalizaci√≥n); </li><li>  los estados de las habitaciones restantes en la parte inferior de la pantalla. </li></ul><br>  Tenga en cuenta: el dial solo muestra 12 horas, como  el sistema est√° configurado para las necesidades de la empresa (las tabletas Arcadia funcionan de 8 a.m. a 8 p.m., se encienden y apagan autom√°ticamente) <br><br><img src="https://habrastorage.org/webt/cg/r_/92/cgr_9220jaeqzpjtu4godm1vojw.gif"><br><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><br>  Para reservar una habitaci√≥n, simplemente llame a la ventana de reserva e indique la duraci√≥n del rally.  Los pasos para reservar las habitaciones restantes son similares, solo comienzan haciendo clic en el icono de la habitaci√≥n. <br><br><img src="https://habrastorage.org/webt/d7/qr/wm/d7qrwmogkdzvjtdea0y80vjlti4.jpeg"><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><br>  Si desea programar una reuni√≥n para un momento espec√≠fico, vaya a la siguiente pesta√±a, en la lista de reuniones que se celebrar√°n hoy en la sala de reuniones, y haga clic en tiempo libre.  Adem√°s, todo es como en el primer caso. <br><br>  El √°rbol de transici√≥n completo deber√≠a verse as√≠: <br><br><img src="https://habrastorage.org/webt/p8/ex/lb/p8exlbbiuflfbasflet3vsepzdu.png"><br><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><br>  Tratemos de implementarlo de manera competente. <br><br><h3>  Pila de tecnolog√≠a </h3><br>  Las t√©cnicas de desarrollo se desarrollan bastante r√°pido y cambian.  Durante otros 2 a√±os, Java fue el lenguaje oficial de desarrollo de Android.  Todos escribieron en Java y usaron enlace de datos.  Ahora, me parece, nos estamos moviendo hacia la programaci√≥n reactiva y Kotlin.  Java es un gran lenguaje, pero tiene algunas imperfecciones en comparaci√≥n con lo que Kotlin y AndroidX tienen para ofrecer.  Kotlin y AndroidX pueden reducir el uso de enlace de datos al m√≠nimo, si no lo excluyen por completo.  A continuaci√≥n intentar√© explicar mi punto de vista. <br><br><h4>  Kotlin </h4><br>  Creo que muchos desarrolladores de Android ya se han cambiado a Kotlin, y por lo tanto estar√°n de acuerdo conmigo en que escribir un nuevo proyecto de Android en 2019 en cualquier idioma que no sea Kotlin es como luchar contra el mar.  Por supuesto que puedes discutir, pero ¬øqu√© pasa con Flutter y Dart?  ¬øQu√© pasa con C ++, C # e incluso Cordova?  A lo que responder√©: la elecci√≥n es siempre suya. <br><br>  En 480 aC  el rey persa Jerjes orden√≥ a sus soldados cruzar el mar como castigo por destruir parte de su ej√©rcito durante una tormenta, y cinco siglos despu√©s, el emperador romano Cal√≠gula declar√≥ la guerra a Poseid√≥n.  Una cuesti√≥n de gustos.  Para 9 de cada 10, Kotlin es bueno, pero para 10 puede ser malo.  Todo depende de ti, de tus deseos y aspiraciones. <br><br>  Kotlin es mi elecci√≥n.  El lenguaje es simple y hermoso.  Escribir en √©l es f√°cil y agradable, y lo m√°s importante, no es necesario escribir demasiado: clase de datos, objeto, setter y getter opcional, expresiones lambda simples y funciones de extensi√≥n.  Esto es solo una peque√±a parte de lo que este lenguaje tiene para ofrecer.  Si a√∫n no te has cambiado a Kotlin, ¬°no dudes en irte!  En la secci√≥n con pr√°ctica, demostrar√© algunas de las ventajas del lenguaje (no es una oferta publicitaria). <br><br><h4>  Modelo-Vista-VistaModelo </h4><br>  MVVM es actualmente la arquitectura de aplicaci√≥n recomendada de Google.  Durante el desarrollo, nos adheriremos a este patr√≥n en particular, sin embargo, no lo cumpliremos por completo, ya que MVVM recomienda usar el enlace de datos, pero lo rechazamos. <br><br>  <i><b>Pros de MVVM</b></i> <br><br><ul><li>  <i>Diferenciaci√≥n de l√≥gica de negocios y UI.</i>  En la implementaci√≥n correcta de MVVM, no deber√≠a haber un solo androide de importaci√≥n en ViewModel, a excepci√≥n de los objetos LiveData de los paquetes AndroidX o Jetpack.  El uso adecuado deja autom√°ticamente todo el trabajo de la interfaz de usuario dentro de fragmentos y actividades.  ¬øNo es genial? </li><li>  <i>El nivel de encapsulaci√≥n se bombea.</i>  Ser√° m√°s f√°cil trabajar en equipo: ahora pueden trabajar todos juntos en una pantalla y no interferir entre s√≠.  Mientras un desarrollador trabaja con la pantalla, otro puede construir un ViewModel, y un tercero puede escribir consultas en el Repositorio. </li><li>  <i>MVVM tiene un efecto positivo en la escritura de pruebas unitarias.</i>  Este art√≠culo se sigue del anterior.  Si todas las clases y m√©todos est√°n encapsulados para que no funcionen con la interfaz de usuario, se pueden probar f√°cilmente. </li><li>  <i>Una soluci√≥n natural con rotaci√≥n de pantalla.</i>  No importa cu√°n extra√±o pueda sonar, pero esta caracter√≠stica se adquiere autom√°ticamente, con la transici√≥n a MVVM (porque los datos se almacenan en ViewModel).  Si verifica las aplicaciones bastante populares (VK, Telegram, Sberbank-Online y Aviasales), resulta que exactamente la mitad de ellas no pueden rotar la pantalla.  Lo que me causa cierta sorpresa y malentendido como usuario de estas aplicaciones. </li></ul><br>  <i><b>¬øPor qu√© es peligroso MVVM?</b></i> <br><br><ul><li>  <i>Fuga de memoria</i>  Este peligroso error ocurre si infringe las leyes de uso de LiveData y observador.  Examinaremos este error en detalle en la secci√≥n de pr√°ctica. </li><li>  <i>Amplia vista del modelo.</i>  Si intenta ajustar toda la l√≥gica empresarial en ViewModel, obtendr√° un c√≥digo ilegible.  La forma de salir de esta situaci√≥n puede ser dividir el ViewModel en una jerarqu√≠a o usar Presentadores.  Eso es exactamente lo que hice. </li></ul><br>  <i><b>Reglas para trabajar con MVVM</b></i> <br><br>  Comencemos con la mayor√≠a de los errores y pasemos a los menos errores: <br><br><ul><li>  el cuerpo de la solicitud no debe estar en ViewModel (solo en el Repositorio); </li><li>  Los objetos LiveData se definen en ViewModel, no se arrojan dentro del Repositorio, porque  las solicitudes en el Repositorio se procesan usando Rx-Java (o corutinas); </li><li>  todas las funciones de procesamiento deben trasladarse a clases y archivos de terceros ("Presentadores"), para no saturar ViewModel y no distraer de la esencia. </li></ul><br><h4>  Livedata </h4><br><blockquote>  LiveData es una clase de titular de datos observable.  A diferencia de un observable regular, LiveData es consciente del ciclo de vida, lo que significa que respeta el ciclo de vida de otros componentes de la aplicaci√≥n, como actividades, fragmentos o servicios.  Esta conciencia garantiza que LiveData solo actualiza los observadores de componentes de la aplicaci√≥n que se encuentran en un estado de ciclo de vida activo. </blockquote>  <i>Fuente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">developer.android.com/topic/libraries/architecture/livedata</a></i> <br><br>  Se puede sacar una conclusi√≥n simple de la definici√≥n: LiveData es una herramienta de programaci√≥n reactiva confiable.  Lo usaremos para actualizar la parte de la interfaz de usuario sin enlace de datos.  Por qu√© <br><br>  La estructura de los archivos XML no permite una distribuci√≥n concisa de los datos obtenidos de &lt;data&gt; ... &lt;/data&gt;.  Si todo est√° claro con archivos peque√±os, ¬øqu√© pasa con los archivos grandes?  ¬øQu√© hacer con pantallas complejas, m√∫ltiples incluidas y pasando m√∫ltiples campos?  ¬øUsar modelos en todas partes?  Obtener enlaces de campo r√≠gidos?  Y si el campo debe formatearse, ¬øllama a los m√©todos de los paquetes Java?  Esto hace que el c√≥digo sea irremediable y completamente espagueti.  Para nada lo que MVVM prometi√≥. <br><br>  Rechazar el enlace de datos har√° que los cambios en la parte de la IU sean transparentes.  Todas las actualizaciones ocurrir√°n directamente dentro del observador.  Porque  Como el c√≥digo de Kolin es conciso y claro, no tendremos problemas con el observador hinchado.  Escribir y mantener el c√≥digo ser√° m√°s f√°cil.  Los archivos XML se usar√°n solo para el dise√±o, sin ninguna propiedad dentro. <br><br>  El enlace de datos es una herramienta poderosa.  Es excelente para resolver algunos problemas, y armoniza bien con Java, pero con Kotlin ... Con Kotlin, en la mayor√≠a de los casos, el enlace de datos es simplemente rudimentario.  El enlace de datos solo complica el c√≥digo y no ofrece ventajas competitivas. <br><br>  En Java, ten√≠a una opci√≥n: usar el enlace de datos o escribir mucho c√≥digo feo.  En Kotlin, puede acceder a los elementos de vista directamente, omitiendo findViewById (), as√≠ como su propiedad.  Por ejemplo: <br><br><pre><code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// Instead of TextView textView = findViewById&lt;TextView&gt;(R.id.textView) textView.text = "Hello, world!" textView.visibility = View.VISIBLE</span></span></code> </pre> <br>  Surge una pregunta l√≥gica: ¬øpor qu√© molestarse con los modelos de jardiner√≠a en archivos XML, invocar m√©todos Java en archivos XML, sobrecargar la l√≥gica de la parte XML si se puede evitar todo esto? <br><br><h4>  Corutinas en lugar de Thread () y Rx-Java </h4><br>  Las corutinas son incre√≠blemente livianas y f√°ciles de usar.  Son ideales para la mayor√≠a de las tareas asincr√≥nicas simples: procesar resultados de consultas, actualizar la interfaz de usuario, etc. <br><br>  Las rutinas pueden reemplazar efectivamente Thread () y Rx-Java en casos donde no se requiere un alto rendimiento, porque  pagan ligereza con rapidez.  Rx-Java, sin duda, es m√°s funcional, sin embargo, para tareas simples no se requieren todos sus activos. <br><br><h4>  Microsoft y el resto </h4><br>  Para trabajar con los servicios de Outlook, se utilizar√° la API de Microsoft Graph.  Con los permisos apropiados, a trav√©s de √©l puede obtener toda la informaci√≥n necesaria sobre empleados, salas y eventos (reuniones).  Para el reconocimiento facial, se utilizar√° el servicio en la nube API de Microsoft Face. <br><br>  Mirando un poco m√°s adelante, dir√© que para resolver el problema de escalabilidad, se us√≥ el almacenamiento en la nube Firebase.  Esto se discutir√° a continuaci√≥n. <br><br><h2>  Arquitectura </h2><br><h3>  Problemas de escalabilidad </h3><br>  Es bastante dif√≠cil hacer que el sistema sea escalable total o parcialmente.  Esto es especialmente dif√≠cil de hacer si la primera versi√≥n de la aplicaci√≥n no era escalable, y la segunda deber√≠a ser.  La aplicaci√≥n v1 envi√≥ solicitudes a todas las habitaciones a la vez.  Cada una de las tabletas enviaba regularmente solicitudes al servidor para actualizar todos los datos.  Al mismo tiempo, los dispositivos no se sincronizaron entre s√≠, porque  el proyecto simplemente no tiene su propio servidor. <br><br>  Por supuesto, si seguimos el mismo camino y enviamos N solicitudes de cada una de las N tabletas, en alg√∫n momento volcaremos la API de Microsoft Graph o congelaremos nuestro sistema. <br><br>  Ser√≠a l√≥gico utilizar una soluci√≥n cliente-servidor en la que el servidor sondee el gr√°fico, acumule datos y, previa solicitud, brinde informaci√≥n a las tabletas, pero aqu√≠ nos encontramos con la realidad.  El equipo del proyecto consta de 2 personas (desarrollador y dise√±ador de Android).  Deben cumplir el plazo de 7 semanas y no se proporciona el backend, porque  escalar es un requisito del desarrollador.  ¬øPero esto no significa que la idea deba ser abandonada? <br><br>  Probablemente la √∫nica soluci√≥n correcta en esta situaci√≥n ser√° el uso del almacenamiento en la nube.  Firebase reemplazar√° el servidor y actuar√° como un b√∫fer.  Luego resulta lo siguiente: <i>cada tableta sondea solo su direcci√≥n de la API de Microsoft Graph y, si es necesario, sincroniza los datos en el almacenamiento en la nube, desde donde pueden ser le√≠dos por otros dispositivos.</i> <br><br>  La ventaja de esta implementaci√≥n ser√° una respuesta r√°pida, porque  Firebase funciona en modo de tiempo real.  Reduciremos la cantidad de solicitudes enviadas al servidor N veces, lo que significa que el dispositivo funcionar√° con bater√≠a un poco m√°s.  Desde un punto de vista financiero, el proyecto no subi√≥ de precio, porque  Para este proyecto, la versi√≥n gratuita de Firebase es suficiente con m√∫ltiples reservas: 1 GB de almacenamiento, 10 mil autorizaciones por mes y 100 conexiones a la vez.  Las desventajas podr√≠an incluir la dependencia de un marco de terceros, pero Firebase inspira confianza en nosotros, porque  Es un producto estable mantenido y desarrollado por Google. <br><br>  La idea general del nuevo sistema era la siguiente: N tabletas y una plataforma en la nube para la sincronizaci√≥n de datos en tiempo real.  Comencemos a dise√±ar la aplicaci√≥n en s√≠. <br><br><h4>  LiveData en el repositorio </h4><br>  Parece que recientemente establec√≠ las reglas de buena forma e inmediatamente viol√© una de ellas.  A diferencia del uso recomendado de LiveData dentro de ViewModel, en este proyecto los objetos LiveData se inicializan en el repositorio, y todos los repositorios se declaran como singleton.  Por qu√© <br><br>  Una soluci√≥n similar est√° asociada con el modo de aplicaci√≥n.  Las tabletas est√°n abiertas de 8 a.m. a 8 p.m.  Todo este tiempo, solo se ha lanzado el Meeting Room Helper.  Como resultado, muchos objetos pueden y deben ser de larga duraci√≥n (es por eso que todos los repositorios est√°n dise√±ados como singleton). <br><br>  En el curso del trabajo, el contenido de la interfaz de usuario se cambia regularmente, lo que a su vez implica la creaci√≥n y recreaci√≥n de objetos ViewModel.  Resulta que si usa LiveData dentro de ViewModel, entonces para cada fragmento creado se crear√° su propio ViewModel con un conjunto de objetos LiveData especificados.  Si 2 fragmentos similares se muestran simult√°neamente en la pantalla, con ViewModel diferente y un Base-ViewModel com√∫n, entonces durante la inicializaci√≥n habr√° una duplicaci√≥n de los objetos LiveData del Base-ViewModel.  En el futuro, estos duplicados ocupar√°n espacio en la memoria hasta que sean destruidos por el "recolector de basura".  Porque  Si ya tenemos un repositorio en forma de singleton y queremos minimizar el costo de volver a crear pantallas, ser√≠a conveniente transferir objetos LiveData a un repositorio de singleton, facilitando as√≠ los objetos ViewModel y acelerando la aplicaci√≥n. <br><br>  Por supuesto, esto no significa que deba transferir todos los LiveData del ViewModel al repositorio, pero debe abordar este problema con m√°s cuidado y hacer su elecci√≥n conscientemente.  La desventaja de este enfoque es el aumento en el n√∫mero de objetos de larga vida, porque  Todos los repositorios se definen como singleton y cada uno de ellos almacena objetos LiveData.  Pero en un caso espec√≠fico, Meeting Room Helper no es un punto negativo, porque  la aplicaci√≥n se ejecuta sin parar todo el d√≠a, sin cambiar el contexto a otras aplicaciones. <br><br><h4>  Arquitectura resultante </h4><br><img src="https://habrastorage.org/webt/yf/db/uo/yfdbuo8--ygtmrgxsybvuiuyeme.png"><br><br><ul><li>  Todas las solicitudes se ejecutan en repositorios.  Todos los repositorios (en Meeting Room Helper hay 11 de ellos) est√°n dise√±ados como singleton.  Se dividen por tipo de objetos devueltos y se ocultan detr√°s de las fachadas. </li><li>  La l√≥gica empresarial reside en ViewModel.  Gracias al uso de "Presentadores", el tama√±o total de todos los ViewModel (hay 6 en el proyecto) result√≥ ser inferior a 120 l√≠neas. </li><li>  La actividad y el fragmento solo est√°n involucrados en el cambio de la parte de la interfaz de usuario, utilizando el observador y LiveData devuelto por ViewModel. </li><li>  Las funciones para procesar y generar datos se almacenan en "presentador".  Utiliza activamente las funciones de permiso de Kotlin para el procesamiento de datos. </li></ul><br>  La l√≥gica de fondo se ha movido a Intent-Service: <br><br><ul><li>  Servicio de actualizaci√≥n de eventos.  Servicio responsable de sincronizar los datos de la sala actual en Firebase y Graph API. </li><li>  Servicio de reconocimiento de usuario.  Se ejecuta solo en la tableta maestra.  Responsable de agregar nuevo personal al sistema.  Comprueba una lista de personas ya capacitadas con una lista de Active Directory.  Si aparecen nuevas personas, el servicio las agrega a la API de Face y reentrena la red neuronal.  Al finalizar la operaci√≥n, se apaga.  Comienza cuando comienza la aplicaci√≥n. </li><li>  El servicio de notificaci√≥n en l√≠nea notifica a otras tabletas que esta tableta est√° funcionando, es decir  La bater√≠a externa no est√° agotada.  Funciona a trav√©s de Firebase. </li></ul><br>  El resultado fue una arquitectura bastante flexible y correcta desde el punto de vista de la distribuci√≥n de responsabilidades, que cumple con todos los requisitos del desarrollo moderno.  Si en el futuro abandonamos la API de Microsoft Graph, Firebase o cualquier otro m√≥dulo, pueden reemplazarse f√°cilmente por otros nuevos sin interferir con el resto de la aplicaci√≥n.  La presencia de un extenso sistema de "presentadores" hizo posible llevar todas las funciones de procesamiento de datos m√°s all√° del n√∫cleo.  Como resultado, la arquitectura se ha vuelto cristalina, lo cual es una gran ventaja.  El problema de un ViewModel descuidado ha desaparecido por completo. <br><br>  A continuaci√≥n dar√© un ejemplo del paquete de uso com√∫n en una aplicaci√≥n desarrollada. <br><br><h3>  Practica  Ver actualizaciones </h3><br>  Dependiendo del estado de la sala de reuniones, el dial muestra una de las siguientes condiciones: <br><br><img src="https://habrastorage.org/webt/sa/o2/to/sao2towzwxh0qqlp1gvxd_s2qjg.png"><br><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><br>  Adem√°s, los arcos temporales de las manifestaciones se ubican a lo largo del contorno de la esfera, y el centro realiza una cuenta regresiva hasta el final de la reuni√≥n o hasta el comienzo de la pr√≥xima concentraci√≥n.  Todo esto lo hace la biblioteca de lienzo que desarrollamos.  Si la cuadr√≠cula de reuniones ha cambiado, debemos actualizar los datos en la biblioteca. <br><br>  Dado que LiveData se anuncia en los repositorios, es m√°s l√≥gico comenzar con ellos. <br><br><h4>  Repositorios </h4><br>  <i>FirebaseRoomRepository</i> : una clase responsable de enviar y procesar solicitudes en Firebase relacionadas con el modelo de sala. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// 1. object FirebaseRoomRepository { private val database = FirebaseFactory.database val rooms: MutableList&lt;Room&gt; = ArrayList() // 2. var currentRoom: MutableLiveData&lt;Room?&gt; = MutableLiveData() val onlineStatus: MediatorLiveData&lt;HashMap&lt;String, Boolean&gt;&gt; = MediatorLiveData() var otherRooms: MutableLiveData&lt;List&lt;Room&gt;&gt; = MutableLiveData() var ownRoom: MutableLiveData&lt;Room&gt; = MutableLiveData() // 3. private val roomsListener = object : ValueEventListener { override fun onDataChange(dataSnapshot: DataSnapshot) { updateRooms(dataSnapshot) } override fun onCancelled(error: DatabaseError) {} } init { // 4. database.getReference(ROOMS_CURRENT_STATES) .addValueEventListener(roomsListener) } // 5. private fun updateRooms(dataSnapshot: DataSnapshot) { rooms.updateRooms(dataSnapshot) otherRooms.updateOtherRooms(rooms) ownRoom.updateOwnRoom(rooms) currentRoom.updateCurrentRoom(rooms, ownRoom) } }</span></span></code> </pre><br>  Para demostrarlo, el c√≥digo de inicializaci√≥n de firebase del oyente se simplific√≥ ligeramente (se elimin√≥ la funci√≥n de reconexi√≥n).  Echemos un vistazo a lo que sucede aqu√≠: <br><br><ol><li>  el repositorio est√° dise√±ado como un singleton (en Kotlin, es suficiente para reemplazar la palabra clave de clase con objeto); </li><li>  inicializaci√≥n de objetos LiveData; </li><li>  ValueEventListener se declara como una variable para evitar volver a crear una clase an√≥nima en caso de reconexi√≥n (recuerde, simplifiqu√© la inicializaci√≥n eliminando la reconexi√≥n en caso de desconexi√≥n); </li><li>  inicializaci√≥n de ValueEventListener (si los datos en Firebase cambian, el escucha ejecutar√° y actualizar√° de inmediato los datos en los objetos LiveData); </li><li>  Actualizaciones a objetos LiveData. </li></ol><br>  Las funciones mismas se mueven a un archivo separado FirebaseRoomRepositoryPresenter y se decoran como funciones de extensi√≥n. <br><br><pre> <code class="kotlin hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> MutableLiveData</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">&lt;List&lt;Room&gt;</span></span></span><span class="hljs-function">&gt;.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateOtherRooms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rooms: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">MutableList</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Room</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.postValue(rooms.filter { !it.isOwnRoom() }) }</code> </pre><br>  <i>Ejemplo de funci√≥n de extensi√≥n de FirebaseRoomRepositoryPresenter</i> <br><br>  Tambi√©n para una comprensi√≥n general de la imagen, dar√© una lista del objeto Room. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// 1. data class Room(var number: String = "", var nickName: String = "", var email: String? = null, var imgSmall: String? = null, var imgOffline: String? = null, var imgFree: String? = null, var imgWait: String? = null, var imgBusy: String? = null, var events: List&lt;Event.Short&gt; = emptyList()) // 2.</span></span></code> </pre><br><ol><li>  Clase de datos.  Este modificador genera y anula autom√°ticamente los m√©todos toString (), HashCode () e equal ().  Ya no hay necesidad de redefinirlos usted mismo. </li><li>  La lista de eventos del objeto Sala.  Es esta lista la que se requiere para actualizar los datos en la biblioteca de marcado. </li></ol><br>  Todas las clases de repositorios est√°n ocultas detr√°s de la clase de fachada. <br><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Repository { <span class="hljs-comment"><span class="hljs-comment">// 1. private val firebaseRoomRepository = FirebaseRoomRepository // ......... /** * Rooms queries */ fun getOtherRooms() = firebaseRoomRepository.otherRooms fun getOwnRoom() = firebaseRoomRepository.ownRoom fun getAllRooms() = firebaseRoomRepository.rooms // 2. fun getCurrentRoom() = firebaseRoomRepository.currentRoom //   // ....... }</span></span></code> </pre><br><ol><li>  Arriba puede ver una lista de todas las clases de repositorio usadas y fachadas de segundo nivel.  Esto simplifica la comprensi√≥n general del c√≥digo y muestra una lista de todas las clases de repositorio conectadas. </li><li>  Una lista de m√©todos que devuelven referencias a objetos LiveData desde FirebaseRoomRepository.  Los setters y getters de Kotlin son opcionales, por lo que no necesita escribirlos innecesariamente. </li></ol><br>  Dicha organizaci√≥n le permite ajustar c√≥modamente de 20 a 30 solicitudes en un repositorio ra√≠z.  Si su aplicaci√≥n tiene m√°s solicitudes, deber√° dividir la fachada ra√≠z en 2 o m√°s. <br><br><h4>  ViewModel </h4><br>  BaseViewModel es el ViewModel base del que se heredan todos los ViewModels.  Incluye un solo objeto currentRoom, usado universalmente. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// 1. open class BaseViewModel : ViewModel() { // 2. fun getCurrentRoom() = Repository.getCurrentRoom() }</span></span></code> </pre><br><ol><li>  El marcador abierto significa que puede heredar de la clase.  Por defecto en Kotlin, todas las clases y m√©todos son finales, es decir.  las clases no se pueden heredar y los m√©todos no se pueden redefinir.  Esto es para proteger contra cambios versionados incompatibles accidentales.  Dar√© un ejemplo. <br><br>  <i>Est√°s desarrollando una nueva versi√≥n de la biblioteca.</i>  <i>En alg√∫n momento, por una raz√≥n u otra, decide cambiar el nombre de la clase o cambiar la firma de alg√∫n m√©todo.</i>  <i>Al cambiarlo, accidentalmente creaste incompatibilidad de versi√≥n.</i>  <i>Vaya ... Si probablemente supieras que alguien podr√≠a anular el m√©todo y la clase fuera heredada, probablemente habr√≠as sido m√°s preciso y dif√≠cilmente te habr√≠as disparado en el pie.</i>  <i>Para hacer esto, en Kotlin, por defecto, todo se declara como final, y para la cancelaci√≥n hay un modificador "abierto".</i> <br></li><li>  El m√©todo getCurrentRoom () devuelve un enlace al objeto LiveData de la sala actual desde el Repositorio, que, a su vez, se toma del FirebaseRoomRepository.  Cuando se llama a este m√©todo, el objeto Room regresar√° con toda la informaci√≥n sobre la sala, incluida una lista de eventos. </li></ol><br>  Para convertir datos de un formato a otro, utilizaremos la transformaci√≥n.  Para hacer esto, cree un <i>MainFragmentViewModel</i> y <i>heredelo</i> de <i>BaseViewModel</i> . <br><br>  <i>MainFragmentViewModel</i> es una clase <i>derivada</i> de BaseViewModel.  Este ViewModel se usa solo en MainFragment. <br><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// 1. class MainFragmentViewModel: BaseViewModel () { // 2. var currentRoomEvents = Transformations.switchMap(getCurrentRoom()) { val events: MutableLiveData&lt;List&lt;Event.Short&gt;&gt; = MutableLiveData() // some business logic events.postValue(it?.eventsList) events } // 3. val currentRoomEvents2 = MediatorLiveData&lt;List&lt;Event.Short&gt;&gt;().apply { addSource(getCurrentRoom()) { room -&gt; // some business logic postValue(room?.eventsList) } } }</span></span></code> </pre><br><ol><li>  Tenga en cuenta la falta del modificador abierto.  Esto significa que nadie hereda de la clase. </li><li>  currentRoomEvents: un objeto obtenido mediante la transformaci√≥n.  Tan pronto como cambia el objeto de la sala actual, se realiza la transformaci√≥n y se actualiza el objeto currentRoomEvents. </li><li>  MediatorLiveData.  El resultado es id√©ntico a la transformaci√≥n (se muestra como referencia). </li></ol><br>  La primera opci√≥n se usa para convertir datos de un tipo a otro, que es lo que necesit√°bamos, y la segunda opci√≥n es necesaria para ejecutar cierta l√≥gica empresarial.  Sin embargo, la conversi√≥n de datos no ocurre.  Recuerde que la importaci√≥n de Android en ViewModel no es v√°lida.  Por lo tanto, inicio solicitudes adicionales desde aqu√≠ o reinicio los servicios seg√∫n sea necesario. <br><br>  <b>Aviso importante!</b>  Para que la transformaci√≥n o el mediador funcione, alguien debe estar suscrito a ellos desde un fragmento o actividad.  De lo contrario, el c√≥digo no se ejecutar√° porque  nadie esperar√° un resultado (estos son objetos de observaci√≥n). <br><br><h4>  Fragmento principal </h4><br>  El paso final en la conversi√≥n de datos a resultado.  MainFragment incluye una biblioteca de marcaci√≥n y un visor de p√°ginas en la parte inferior de la pantalla. <br><br><pre> <code class="kotlin hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainFragment</span></span></span><span class="hljs-class"> : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">BaseFragment</span></span></span></span>() { <span class="hljs-comment"><span class="hljs-comment">// 1. private lateinit var viewModel: MainFragmentViewModel // 2. private val currentRoomObserver = Observer&lt;List&lt;Event.Short&gt;&gt; { clockView.updateArcs(it) } override fun onAttach(context: Context?) { super.onAttach(context) // 3. viewModel = ViewModelProviders.of(this).get(MainFragmentViewModel::class.java) } override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? { return inflater.inflate(R.layout.fragment_main, container, false) } override fun onActivityCreated(savedInstanceState: Bundle?) { super.onActivityCreated(savedInstanceState) // 4. viewModel.currentRoomEvents.observe(viewLifecycleOwner, currentRoomObserver) } }</span></span></code> </pre><br><ol><li>  Inicializaci√≥n de MainFragmentViewModel.  El modificador lateinit indica que prometemos inicializar este objeto m√°s tarde, antes de usarlo.  Kotlin intenta proteger al programador de la escritura incorrecta del c√≥digo, por lo que debemos decir de inmediato que el objeto puede ser nulo o poner lateinit.  En este caso, ViewModel debe ser inicializado por el objeto. </li><li>  Observador-oyente para actualizar el dial. </li><li>  Inicializando el ViewModel.  Tenga en cuenta que esto sucede inmediatamente despu√©s de que el fragmento se haya unido a la actividad. </li><li>  Despu√©s de crear la actividad, nos suscribimos a los cambios en el objeto currentRoomEvents.  Tenga en cuenta que no me suscribo al ciclo de vida del fragmento (esto), sino al objeto viewLifecycleOwner.  El hecho es que en la biblioteca de soporte 28.0.0 y AndroidX 1.0.0 se detect√≥ un error cuando el observador estaba "desuscrito".  Para resolver este problema, se lanz√≥ un parche en forma de viewLifecycleOwner, y Google recomienda suscribirse a √©l.  Esto soluciona el problema del observador zombie cuando el fragmento muri√≥ y el observador contin√∫a trabajando.  Si todav√≠a est√° usando esto, aseg√∫rese de reemplazarlo con viewLifecycleOwner. </li></ol><br>  Por lo tanto, quiero demostrar la simplicidad y belleza de MVVM y LiveData sin usar el enlace de datos.  Tenga en cuenta que en este proyecto infringe la regla generalmente aceptada al colocar LiveData en el Repositorio debido a los detalles del proyecto.  Sin embargo, si los movi√©ramos al ViewModel, la imagen general permanecer√≠a sin cambios. <br><br>  Como guinda de un pastel, he preparado un breve video con una demostraci√≥n (los nombres est√°n manchados de acuerdo con los requisitos de seguridad, pido disculpas): <br><br><img src="https://habrastorage.org/webt/uk/fd/wc/ukfdwcj2495fl6bcdt0eplxu9x8.png"><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/E9zUc0vaGck" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3>  Resumen </h3><br>  Como resultado de la aplicaci√≥n en el primer mes, se revelaron algunos errores en la visualizaci√≥n de reuniones cruzadas (Outlook le permite crear varios eventos al mismo tiempo, mientras que nuestro sistema no lo hace).  Ahora el sistema ha estado funcionando durante 3 meses.  No se observan errores o fallas. <br><br>  PD: Gracias <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">jericho_code</a> por el comentario.  En Kotlin, puede y debe inicializar List &lt;&gt; en el modelo usando emptyList (), luego no se crea un objeto adicional. <br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> events: List&lt;Event.<span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>&gt; = emptyList() <span class="hljs-comment"><span class="hljs-comment">//      EmptyList var events: List&lt;Event.Short&gt; = ArrayList() //   </span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457960/">https://habr.com/ru/post/457960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457948/index.html">Juegos de mesa en los que tienes que aplastarte la cabeza</a></li>
<li><a href="../457952/index.html">C√≥mo se dise√±an y fabrican los procesadores: fabricaci√≥n de chips</a></li>
<li><a href="../457954/index.html">Por qu√© Swift puede convertirse en un gran evento en el aprendizaje profundo</a></li>
<li><a href="../457956/index.html">C√≥mo elegir el almacenamiento sin dispararte en el pie</a></li>
<li><a href="../457958/index.html">Vida cotidiana MT_FREE: varias historias sobre la influencia de los servicios de terceros en el trabajo de Wi-Fi p√∫blico</a></li>
<li><a href="../457962/index.html">Al igual que en la arquitectura thrash y la falta de habilidades en Scrum, creamos equipos de componentes cruzados</a></li>
<li><a href="../457964/index.html">Virtualidad real: estaciones de trabajo ++</a></li>
<li><a href="../457966/index.html">"Abrir√≠a una zona de TI especial en el sur de Rusia" - 10 preguntas al programador # 11. Nueva temporada</a></li>
<li><a href="../457968/index.html">Paralelos que se cruzan: el Ministerio de Comunicaciones quem√≥ durante la noche miles de millones en presupuestos</a></li>
<li><a href="../457970/index.html">Linter en Go. C√≥mo cocinarlos Denis Isaev</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>