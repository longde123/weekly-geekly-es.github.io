<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥘 🎍 🌫️ Menggunakan Liquibase untuk mengelola struktur database dalam aplikasi Spring Boot. Bagian 1 💴 🧕 🛬</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel ini, saya akan membahas penggunaan utilitas Liquibase dalam aplikasi Boot Spring untuk versi struktur database relasional dan memigrasik...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menggunakan Liquibase untuk mengelola struktur database dalam aplikasi Spring Boot. Bagian 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/460377/"> Dalam artikel ini, saya akan membahas penggunaan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Liquibase</a> dalam aplikasi Boot Spring untuk versi struktur database relasional dan memigrasikan struktur ini dari satu versi ke versi lain.  Pada bagian pertama, kita akan menganalisis contoh dasar, dan pada bagian kedua kita akan berbicara tentang menggunakan <i>liquibase-mave-plugin</i> untuk mengembalikan perubahan dan secara otomatis menghasilkan skrip dengan membandingkan struktur basis data. <br><br>  Mari kita mulai dengan membuat aplikasi paling sederhana di Spring Boot + JPA (Hibernate).  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Spring Initializr</a> akan membantu kami dengan ini.  Dari dependensi, pilih JPA, MySQL, dan Web.  Liquibase juga dapat dihubungkan pada langkah ini, tetapi untuk pemahaman yang lebih baik kita akan melakukannya nanti secara manual. <br><a name="habracut"></a><br><h4>  Buat dasar aplikasi </h4><br>  Kami menambahkan kelas entitas ke aplikasi kami, serta repositori dan pengontrol REST untuk bekerja dengannya.  Untuk konkret, kami akan menyimpan informasi tentang pengguna di entitas yang dibuat. <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(name = <span class="hljs-string"><span class="hljs-string">"users"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue</span></span>(strategy = GenerationType.IDENTITY) <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"username"</span></span>, unique = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String userName; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"password"</span></span>, nullable = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"first_name"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String firstName; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"last_name"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String lastName; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"email"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String email; <span class="hljs-comment"><span class="hljs-comment">//    ,    //    Lombok }</span></span></code> </pre> <br>  Spring Data membuat kode repositori sangat ringkas <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ }</code> </pre> <br>  Kontroler REST yang akan menampilkan seluruh isi tabel pengguna <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RestController</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> UserRepository userRepository; <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserRepository userRepository)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userRepository = userRepository; } <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/user/all"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;User&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">allUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> userRepository.findAll(); } }</code> </pre> <br>  Pengaturan dalam file <i>application.properties</i> <br><br><pre> <code class="plaintext hljs">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver spring.datasource.url=jdbc:mysql://localhost:3306/geek_db?createDatabaseIfNotExist=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=UTC spring.datasource.username=dbuser spring.datasource.password=dbpassword spring.jpa.show-sql=true spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5Dialect</code> </pre><br>  Diasumsikan bahwa komputer Anda menjalankan server MySQL pada port standar.  Jika perlu, sesuaikan URL server dalam string koneksi, serta nama pengguna dan kata sandi.  Perlu juga memperhatikan parameter <i>createDatabaseIfNotExist</i> .  Berkat itu, saat terhubung, kami akan membuat database bernama <i>geek_db</i> jika tidak ada di server. <br><br><h4>  Tambahkan Liquibase </h4><br>  Tentunya Anda memperhatikan bahwa satu pengaturan untuk Hibernate tidak <i>ada</i> , yaitu <i>spring.jpa.hibernate.ddl-auto</i> .  Di sebagian besar manual pemula, nilai <i>pembaruan</i> ditunjukkan untuk itu, karena Hibernate akan membuat dan menyesuaikan struktur tabel di server itu sendiri, berdasarkan kelas entitas yang ada dalam proyek.  Pendekatan ini dapat digunakan jika skema data sangat sederhana atau proyek adalah pelatihan, tetapi dengan skema yang agak rumit, masalah kemungkinan besar akan dimulai, jika hanya karena kita tidak dapat mengontrol proses pembuatan skrip DDL Hibernasi.  Masalah lain adalah bahwa dengan pendekatan ini tidak ada cara mudah untuk mengembalikan perubahan yang dibuat ke Hibernate dalam struktur database. <br><br>  Untuk menyelesaikan masalah di atas kita akan menggunakan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Liquibase</a> .  Untungnya bagi kami, ia dapat dengan sempurna diintegrasikan dengan aplikasi Spring Boot!  Untuk mulai menggunakannya, Anda harus melakukan langkah-langkah berikut <br><br>  Tambahkan pengaturan ke file <i>application.properties</i> <br><br><pre> <code class="plaintext hljs">spring.jpa.hibernate.ddl-auto=none</code> </pre> <br>  Ini untuk memastikan bahwa Hibernate tidak melakukan tindakan apa pun untuk memodifikasi sirkuit, seperti  Liquibase akan melakukannya sekarang.  Secara teoritis, di sini Anda juga dapat menggunakan nilai <i>validasi</i> untuk kontrol tambahan atas kebenaran struktur tabel. <br><br>  Tambahkan dependensi ke <i>pom.xml</i> <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.liquibase<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>liquibase-core<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Setelah menambahkannya, boot Spring akan secara otomatis membuat kacang khusus bernama liquibase, yang akan melakukan semua tindakan untuk mengkonfigurasi skema database berdasarkan skrip Liquibase setiap kali aplikasi dimulai. <br><br>  Sekarang Anda perlu menambahkan skrip Liquibase itu sendiri, yang akan membuat tabel yang kita butuhkan.  Di folder / src / main / resources / db / changelog, buat file bernama db.changelog-master.yaml dan tambahkan konten berikut ke dalamnya <br><br><pre> <code class="plaintext hljs">databaseChangeLog: - logicalFilePath: db/changelog/db.changelog-lesson1.yaml - changeSet: id: 1 author: your_liquibase_username changes: - createTable: tableName: users columns: - column: name: id type: BIGINT autoIncrement: true constraints: primaryKey: true nullable: false - column: name: username type: varchar(50) constraints: unique: true nullable: false - column: name: password type: varchar(512) constraints: nullable: false - column: name: first_name type: varchar(50) - column: name: last_name type: varchar(50) - column: name: email type: varchar(50)</code> </pre> <br>  Mari kita menganalisis isi skrip ini.  Pertama-tama, ini berisi satu set perubahan.  ChangeSet adalah analog dari komit dalam sistem kontrol versi seperti Git atau SVN.  Dengan analogi dengan komit, perubahan yang dibuat sebagai bagian dari satu changeSet dapat digulirkan atau digulirkan kembali ke server database.  Setiap changeSet harus memiliki pengidentifikasi unik yang Liquibase menentukan apakah perubahanSet yang diberikan telah dipompa ke database ini atau tidak. <br><br>  ChangeSet berisi perintah untuk membuat tabel, dan struktur tabel dijelaskan oleh Liquibase, dan bukan skrip SQL.  Berkat ini, file ini menjadi cross-platform.  Liquibase akan menghasilkan skrip SQL tergantung pada server database yang digunakan.  Selain itu, jika kita perlu mengembalikan setset yang diberikan, Liquibase akan dapat secara otomatis membuat skrip untuk menghapus tabel yang diberikan.  Jika kita menggunakan skrip SQL, maka kita harus menulis skrip secara manual untuk mengembalikan perubahan.  Di bagian <i>hanges</i> , kami hanya memiliki satu tim dan ini dianggap praktik yang baik, meskipun faktanya <i>ada</i> sejumlah tim dalam satu <i>perubahan</i> . <br><br>  Kode tertulis sudah cukup untuk menjalankan program, tetapi untuk lebih jelas melihat hasil kerjanya, mari kita tambahkan <i>setset</i> lain, yang akan mengisi tabel dengan data. <br><br><pre> <code class="plaintext hljs"> - changeSet: id: 2 author: your_liquibase_username comment: "Create admin user" changes: - insert: tableName: users columns: - column: name: username value: "admin" - column: name: password value: "admin" - column: name: email value: "admin@server.com" - insert: tableName: users columns: - column: name: username value: "guest" - column: name: password value: "guest" - column: name: email value: "guest@server.com" rollback: - delete: tableName: users where: username in ('admin', 'guest')</code> </pre> <br>  Dalam hal ini, kami harus menulis blok untuk operasi rollback secara manual, sebagai  Liquibase tidak dapat secara otomatis membuat rollback SQL saat bekerja dengan data.  Secara umum, bekerja dengan data dalam basis data tidak termasuk fitur utama Liquibase dan hanya terbatas pada operasi yang paling sederhana yaitu memasukkan, menghapus, atau mengubah.  Omong-omong, jika Anda membutuhkan lebih banyak, maka di sini Anda dapat menggunakan alat dari perusahaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Red Gate</a> . <br><br>  Jadi, mari kita jalankan aplikasi kita dan mencoba mengikuti tautan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">http: // localhost: 8080 / user / all</a> .  Jika aplikasi dimulai, maka Anda akan melihat respons JSON dengan informasi tentang dua pengguna yang ditambahkan ke tabel.  Penting juga melihat log peluncuran aplikasi, di mana Anda dapat melihat skrip yang dijalankan Liquibase untuk menginisialisasi basis data.  Perhatian khusus harus diberikan pada tabel <i>DATABASECHANGELOG</i> .  Di dalamnya Liquibase menyimpan log perubahan yang dibuat ke database. <br><br>  Itu saja untuk saat ini.  Setelah beberapa waktu, saya berencana untuk menerbitkan kelanjutan tentang penggunaan <i>liquibase-maven-plugin</i> untuk secara otomatis menghasilkan skrip dengan membandingkan struktur database dan mengembalikan perubahan yang dibuat. <br><br>  Saya akan berterima kasih atas penambahan dan komentar! <br><br>  PS Kode lengkap ditulis berdasarkan artikel ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/usharik/spring-liquibase-demo/tree/part-1</a> <br><br>  Dilanjutkan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">habr.com/en/post/460907</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id460377/">https://habr.com/ru/post/id460377/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id460363/index.html">7 faktor yang hilang dalam pendekatan 12 Factor App</a></li>
<li><a href="../id460365/index.html">Jejak terdistribusi: kami melakukan semua yang salah</a></li>
<li><a href="../id460367/index.html">Chaos Engineering: seni kehancuran yang disengaja. Bagian 1</a></li>
<li><a href="../id460373/index.html">Di Balik Terpal Halaman Turbo: Arsitektur Teknologi Unduhan Cepat Halaman Web</a></li>
<li><a href="../id460375/index.html">Buku "Pembelajaran Mesin untuk Bisnis dan Pemasaran"</a></li>
<li><a href="../id460381/index.html">Apa itu ketegasan dan mengapa itu dibutuhkan</a></li>
<li><a href="../id460383/index.html">Transisi layar di Legend of Zelda menggunakan fitur NES yang tidak berdokumen</a></li>
<li><a href="../id460387/index.html">Panduan SELinux Beginner</a></li>
<li><a href="../id460393/index.html">Latar belakang: apa yang diharapkan dari Fedora Silverblue</a></li>
<li><a href="../id460395/index.html">Analytics sebagai fitur: proses bekerja dengan data di Plesk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>