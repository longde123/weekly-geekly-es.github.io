<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ โบ๏ธ ๐๏ธ ุชุญููู ุจูุงูุงุช Scala - ุญุงุฌุฉ ููุญุฉ ุฃู ูุฑุตุฉ ููุชุนุฉุ ๐จโ๐จโ๐ฆ ๐ต ๐บ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุงูุฃุฏูุงุช ุงูุชูููุฏูุฉ ูู ูุฌุงู ุนููู ุงูุจูุงูุงุช ูู ูุบุงุช ูุซู R ู Python - ุตูุบุฉ ุจูุงุก ูุฑูุญุฉ ูุนุฏุฏ ูุจูุฑ ูู ุงูููุชุจุงุช ููุชุนูู ุงูุขูู ููุนุงูุฌุฉ ุงูุจูุงูุงุช ุชุชูุญ ูู ุงูุญุตูู ุจุณ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชุญููู ุจูุงูุงุช Scala - ุญุงุฌุฉ ููุญุฉ ุฃู ูุฑุตุฉ ููุชุนุฉุ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/442688/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/5q/1e/fr/5q1efrbkxbuk_ndqoensinfl80a.jpeg"></p><br><p style=";text-align:right;direction:rtl">  ุงูุฃุฏูุงุช ุงูุชูููุฏูุฉ ูู ูุฌุงู ุนููู ุงูุจูุงูุงุช ูู ูุบุงุช ูุซู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">R</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Python</a> - ุตูุบุฉ ุจูุงุก ูุฑูุญุฉ ูุนุฏุฏ ูุจูุฑ ูู ุงูููุชุจุงุช ููุชุนูู ุงูุขูู ููุนุงูุฌุฉ ุงูุจูุงูุงุช ุชุชูุญ ูู ุงูุญุตูู ุจุณุฑุนุฉ ุนูู ุจุนุถ ุญููู ุงูุนูู.  ููุน ุฐูู ุ ููุงู ุญุงูุงุช ุชุตุจุญ ูููุง ูููุฏ ูุฐู ุงูุฃุฏูุงุช ุนูุจุฉ ูุจูุฑุฉ - ุฃููุงู ููุจู ูู ุดูุก ุ ุฅุฐุง ูุงู ูู ุงูุถุฑูุฑู ุชุญููู ุฃุฏุงุก ุนุงูู ูู ุณุฑุนุฉ ุงููุนุงูุฌุฉ ู / ุฃู ุงูุนูู ูุน ูุฌููุนุงุช ุงูุจูุงูุงุช ุงููุจูุฑุฉ ุญููุง.  ูู ูุฐู ุงูุญุงูุฉ ุ ูุชุนูู ุนูู ุงูุฃุฎุตุงุฆู ุงูุฑุฌูุน ุนูู ูุถุถ ุฅูู ูุณุงุนุฏุฉ "ุงูุฌุงูุจ ุงููุธูู" ูุชูุตูู ุงูุฃุฏูุงุช ุจูุบุงุช ุงูุจุฑูุฌุฉ "ุงูุตูุงุนูุฉ": <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Scala</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Java</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">C ++</a> . </p><br><p style=";text-align:right;direction:rtl"> ููู ูู ูุฐุง ุงูุฌุงูุจ ูุธููุ  ุนูู ูุฏุงุฑ ุณููุงุช ุงูุชุทููุฑ ุ ูุทุนุช ุฃุฏูุงุช ุนูู ุงูุจูุงูุงุช "ุงูุตูุงุนู" ุดูุทูุง ุทููููุง ุ ููู ุงูููู ูุฎุชููุฉ ุชูุงููุง ุนู ุฅุตุฏุงุฑุงุชูุง ุงูุฎุงุตุฉ ูุจู 2-3 ุณููุงุช.  ุฏุนููุง ูุญุงูู ุงุณุชุฎุฏุงู ูุซุงู ูููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SNA Hackathon 2019</a> ููุนุฑูุฉ ูุฏู ุชูุงูู ุงููุธุงู ุงูุจูุฆู Scala + Spark ูุน Python Data Science. </p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ุถูู ุฅุทุงุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SNA Hackathon 2019 ุ</a> ูุญู ุงููุดุงุฑููู ูุดููุฉ ูุฑุฒ ููุฌุฒ ุงูุฃุฎุจุงุฑ ููุณุชุฎุฏู ุดุจูุฉ ุงุฌุชูุงุนูุฉ ูู ูุงุญุฏ ูู "ุงูุชุฎุตุตุงุช" ุงูุซูุงุซุฉ: ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ูู ุงููุตูุต ุฃู ุงูุตูุฑ ุฃู ุณุฌูุงุช ุงูููุฒุงุช.  ูู ูุฐุง ุงูููุดูุฑ ุ ุณููุธุฑ ูู ููููุฉ ุญู ูุดููุฉ ูู Spark ุนูู ุฃุณุงุณ ุณุฌู ูู ุงูุนูุงูุงุช ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช ุชุนูู ุงูุขูุฉ ุงูููุงุณูููุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูู ุญู ุงููุดููุฉ ุ ุณูุฐูุจ ุจุงูุทุฑููุฉ ุงูููุงุณูุฉ ุงูุชู ููุฑ ุจูุง ุฃู ูุชุฎุตุต ูู ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุชุทููุฑ ูููุฐุฌ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุณูููู ุจุชุญููู ุจูุงูุงุช ุงูุจุญุซ ุ ุจูุงุก ุงูุฑุณูู ุงูุจูุงููุฉ. </li><li style=";text-align:right;direction:rtl">  ูููู ุจุชุญููู ุงูุฎุตุงุฆุต ุงูุฅุญุตุงุฆูุฉ ููุนูุงูุงุช ูู ุงูุจูุงูุงุช ุ ูููุธุฑ ูู ุงุฎุชูุงูุงุชูู ุจูู ูุฌููุนุงุช ุงูุชุฏุฑูุจ ูุงูุงุฎุชุจุงุฑ. </li><li style=";text-align:right;direction:rtl">  ุณูููู ุจุฅุฌุฑุงุก ุงุฎุชูุงุฑ ูุจุฏุฆู ููููุฒุงุช ุจูุงุกู ุนูู ุงูุฎุตุงุฆุต ุงูุฅุญุตุงุฆูุฉ. </li><li style=";text-align:right;direction:rtl">  ูุญุณุจ ุงูุงุฑุชุจุงุทุงุช ุจูู ุงูุนูุงูุงุช ูุงููุชุบูุฑ ุงููุณุชูุฏู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุงุฑุชุจุงุท ุงููุชุจุงุฏู ุจูู ุงูุนูุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ุณูููู ุจุชุดููู ุงููุฌููุนุฉ ุงูููุงุฆูุฉ ูู ุงูููุฒุงุช ุ ูุชุฏุฑูุจ ุงููููุฐุฌ ูุงูุชุญูู ูู ุฌูุฏุชู. </li><li style=";text-align:right;direction:rtl">  ุฏุนููุง ูุญูู ุงููููู ุงูุฏุงุฎูู ูููููุฐุฌ ูุชุญุฏูุฏ ููุงุท ุงูููู. </li></ul><br><p style=";text-align:right;direction:rtl">  ุฎูุงู "ุฑุญูุชูุง" ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณูุชุนุฑู</a> ุนูู ุฃุฏูุงุช ูุซู ูููุฑุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zeppelin</a> ุงูุชูุงุนููุฉ ุ ูููุชุจุฉ ุชุนูู ุขูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Spark ML</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุญููุง PravdaML</a> ุ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุญุฒูุฉ GraphX โโุงูุฑุณูููุฉ</a> ุ ูููุชุจุฉ ุงูุชุตูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุบุงุณ</a> ุ ูุจุงูุทุจุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Apache Spark</a> ุจูู ูุฌุฏูุง: )  ุชุชููุฑ ุฌููุน ูุชุงุฆุฌ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุงูุชุฌุฑุจุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุตุฉ Zepl</a> ุฏูุชุฑ ุงูููุงุญุธุงุช ุงูุชุนุงูููุฉ. </p><br><h1 id="zagruzka-dannyh" style=";text-align:right;direction:rtl">  ุชุญููู ุงูุจูุงูุงุช </h1><br><p style=";text-align:right;direction:rtl">  ุฅู ุฎุตูุตูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุจูุงูุงุช</a> ุงูููุถูุนุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SNA Hackathon 2019</a> ูู ุฃูู ูู ุงููููู ูุนุงูุฌุชูุง ูุจุงุดุฑุฉ ุจุงุณุชุฎุฏุงู Python ุ ููููุง ุตุนุจุฉ: ุงูุจูุงูุงุช ุงูุฃุตููุฉ ูุนุจุฃุฉ ุจููุงุกุฉ ุนุงููุฉ ุจูุถู ุฅููุงููุงุช ุชูุณูู ุนููุฏ Apache Parquet ูุนูุฏ ูู ุถุบุทูุง ูู ุงูุฐุงูุฑุฉ "ุจูุงุณุทุฉ ุงูุฌุจูู" ุ ูุชู ูู ุถุบุทูุง ูู ุนุฏุฉ ุนุดุฑุงุช ูู ุงูุฌูุฌุงุจุงูุช.  ุนูุฏ ุงูุนูู ูุน Apache Spark ุ ููุณุช ููุงู ุญุงุฌุฉ ูุชุญููู ุงูุจูุงูุงุช ุจุดูู ูุงูู ูู ุงูุฐุงูุฑุฉ ุ ุชู ุชุตููู ุจููุฉ Spark ููุนุงูุฌุฉ ุงูุจูุงูุงุช ุนูู ุดูู ุฃุฌุฒุงุก ุ ูุงูุชุญููู ูู ุงููุฑุต ุญุณุจ ุงูุญุงุฌุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูุฅู ุงูุฎุทูุฉ ุงูุฃููู - ุงูุชุญูู ูู ุชูุฒูุน ุงูุจูุงูุงุช ุญุณุจ ุงูููู - ูุชู ุชูููุฐูุง ุจุณูููุฉ ุจูุงุณุทุฉ ุฃุฏูุงุช ูุญุงุตุฑ: </p><br><pre style=";text-align:right;direction:rtl"><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> train = sqlContext.read.parquet(<span class="hljs-string"><span class="hljs-string">"/events/hackatons/SNAHackathon/2019/collabTrain"</span></span>) z.show(train.groupBy($<span class="hljs-string"><span class="hljs-string">"date"</span></span>).agg( functions.count($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"count"</span></span>), functions.countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"users"</span></span>), functions.countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"objects"</span></span>), functions.countDistinct($<span class="hljs-string"><span class="hljs-string">"metadata_ownerId"</span></span>).as(<span class="hljs-string"><span class="hljs-string">"owners"</span></span>)) .orderBy(<span class="hljs-string"><span class="hljs-string">"date"</span></span>))</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงุฐุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุณูุนุฑุถ ุงูุฑุณู ุงูุจูุงูู</a> ุงูููุงุจู ูู ุฒูุจููู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/jp/lh/pw/jplhpwwz4tfgdtrs1u_u-tqsvzi.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุฃููู ุฃู ุจูุงุก ุฌููุฉ Scala ูุฑู ุฌุฏูุง ุ ููุฏ ูุจุฏู ุงูุฑูุฒ ููุณู ุ ุนูู ุณุจูู ุงููุซุงู ุ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> train = sqlContext.read.parquet(<span class="hljs-string"><span class="hljs-string">"/events/hackatons/SNAHackathon/2019/collabTrain"</span></span>) z.show( train groupBy $<span class="hljs-string"><span class="hljs-string">"date"</span></span> agg( count($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"count"</span></span>, countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"users"</span></span>, countDistinct($<span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"objects"</span></span>, countDistinct($<span class="hljs-string"><span class="hljs-string">"metadata_ownerId"</span></span>) as <span class="hljs-string"><span class="hljs-string">"owners"</span></span>) orderBy <span class="hljs-string"><span class="hljs-string">"date"</span></span> )</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุชูุฏูู ุชุญุฐูุฑ ูุงู ููุง: ุนูุฏ ุงูุนูู ูู ูุฑูู ูุจูุฑ ุ ุญูุซ ูุชุนุงูู ุงูุฌููุน ูุน ูุชุงุจุฉ ููุฏ Scala ุญุตุฑููุง ูู ูุฌูุฉ ูุธุฑูู ุงูุฎุงุตุฉ ุ ูููู ุงูุชูุงุตู ุฃูุซุฑ ุตุนูุจุฉ.  ูุฐูู ูู ุงูุฃูุถู ุชุทููุฑ ููููู ููุญุฏ ูุฃุณููุจ ุงูุดูุฑุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููู ุงูุนูุฏุฉ ุฅูู ูููุชูุง.  ุฃุธูุฑ ุชุญููู ุจุณูุท ูููููุง ูุฌูุฏ ููุงุท ุบูุฑ ุทุจูุนูุฉ ูููู 17 ู 18 ูุจุฑุงูุฑ.  ุฑุจูุง ูู ูุฐู ุงูุฃูุงู ูุฏ ุชู ุฌูุน ุจูุงูุงุช ุบูุฑ ูุงููุฉ ููุฏ ูููู ุชูุฒูุน ุงูุณูุงุช ูุชุญูุฒูุง.  ููุจุบู ุฃู ูุคุฎุฐ ูุฐุง ูู ุงูุงุนุชุจุงุฑ ูู ูุฒูุฏ ูู ุงูุชุญููู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูู ุงููุงูุช ูููุธุฑ ุฃู ุนุฏุฏ ุงููุณุชุฎุฏููู ุงููุฑูุฏูู ูุฑูุจ ุฌุฏูุง ูู ุนุฏุฏ ุงููุงุฆูุงุช ุ ูุฐูู ููู ุงูููุทูู ุฏุฑุงุณุฉ ุชูุฒูุน ุงููุณุชุฎุฏููู ุจุฃุนุฏุงุฏ ูุฎุชููุฉ ูู ุงููุงุฆูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs">z.show(filteredTrain .groupBy($<span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>).count .groupBy(<span class="hljs-string"><span class="hljs-string">"count"</span></span>).agg(functions.log(functions.count(<span class="hljs-string"><span class="hljs-string">"count"</span></span>)).as(<span class="hljs-string"><span class="hljs-string">"withCount"</span></span>)) .orderBy($<span class="hljs-string"><span class="hljs-string">"withCount"</span></span>.desc) .limit(<span class="hljs-number"><span class="hljs-number">100</span></span>) .orderBy($<span class="hljs-string"><span class="hljs-string">"count"</span></span>))</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/dh/i-/pp/dhi-ppdka19zurhimccpq7tij5w.png"></p><br><p style=";text-align:right;direction:rtl">  ูู ุงููุชููุน ุฃู ุชุฑู ุชูุฒูุนูุง ูุฑูุจูุง ูู ุงูุฃุณู ุ ูุฐูู ุทููู ุฌุฏูุง.  ูู ูุซู ูุฐู ุงูููุงู ุ ููุงุนุฏุฉ ุนุงูุฉ ุ ูู ุงููููู ุชุญููู ุชุญุณู ูู ุฌูุฏุฉ ุงูุนูู ูู ุฎูุงู ุชูุณูู ุงูููุงุฐุฌ ูููุณุชุฎุฏููู ุฐูู ูุณุชููุงุช ูุฎุชููุฉ ูู ุงููุดุงุท.  ููุชุญูู ููุง ุฅุฐุง ูุงู ุงูุฃูุฑ ูุณุชุญู ุงูููุงู ุจุฐูู ุ ูุงุฑู ุชูุฒูุน ุนุฏุฏ ุงููุงุฆูุงุช ุญุณุจ ุงููุณุชุฎุฏู ูู ูุฌููุนุฉ ุงูุงุฎุชุจุงุฑ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/du/sy/xt/dusyxten5shm24an736n7akolnm.png"></p><br><p style=";text-align:right;direction:rtl">  ุชุดูุฑ ุงูููุงุฑูุฉ ูุน ุงูุงุฎุชุจุงุฑ ุฅูู ุฃู ูุณุชุฎุฏูู ุงูุงุฎุชุจุงุฑ ูุฏููู ูุงุฆููู ุนูู ุงูุฃูู ูู ุงูุณุฌูุงุช (ูุธุฑูุง ูุฃู ูุดููุฉ ุงูุชุตููู ูุฏ ุชู ุญููุง ุนูู hackathon ุ ููุฐุง ุดุฑุท ุถุฑูุฑู ูุชูููู ุงูุฌูุฏุฉ).  ูู ุงููุณุชูุจู ุ ุฃูุตู ุจุงููุธุฑ ุนู ูุซุจ ุฅูู ุงููุณุชุฎุฏููู ูู ูุฌููุนุฉ ุงูุชุฏุฑูุจ ุ ูุงูุชู ูุนูู ุนู ูุธููุฉ ูุนุฑู ุงููุณุชุฎุฏู ุจูุง ูุน ุนุงูู ุชุตููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//  ,     "",   , //     val testSimilar = sc.broadcast(filteredTrain.groupBy($"instanceId_userId") .agg( functions.count("feedback").as("count"), functions.sum(functions.expr("IF(array_contains(feedback, 'Liked'), 1.0, 0.0)")).as("sum") ) .where("count &gt; sum AND sum &gt; 0") .select("instanceId_userId").rdd.map(_.getInt(0)).collect.sorted) //           // User Defined Function val isTestSimilar = sqlContext.udf.register("isTestSimilar", (x: Int) =&gt; java.util.Arrays.binarySearch(testSimilar.value, x) &gt;= 0)</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃูุถูุง ุชูุฏูู ููุงุญุธุฉ ูููุฉ: ูู ูุฌูุฉ ูุธุฑ ุชุนุฑูู UDF ุฃู ุงุณุชุฎุฏุงู Spark ูู ุชุญุช Scala / Java ููู ุชุญุช Python ูุฎุชูู ุชูุงููุง.  ุจูููุง ูุณุชุฎุฏู ุฑูุฒ PySpark ุงููุธููุฉ ุงูุฃุณุงุณูุฉ ุ ูุนูู ูู ุดูุก ุจุงูุณุฑุนุฉ ุชูุฑูุจูุง ุ ูููู ุนูุฏูุง ุชุธูุฑ ุงููุธุงุฆู ุงูููุฌูุฑุฉ ุ ูุฅู ุฃุฏุงุก PySpark ูุชุญูู ุจุชุฑุชูุจ ูู ุญูุซ ุงูุญุฌู. </p><br><h1 id="pervyy-ml-konveyer" style=";text-align:right;direction:rtl">  ุฃูู ุฎุท ุฃูุงุจูุจ ML </h1><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎุทูุฉ ุงูุชุงููุฉ ุ ุณูุญุงูู ุญุณุงุจ ุงูุฅุญุตุงุกุงุช ุงูุฃุณุงุณูุฉ ุนู ุงูุฅุฌุฑุงุกุงุช ูุงูุณูุงุช.  ููู ููุฐุง ูุญุชุงุฌ ุฅูู ูุฏุฑุงุช SparkML ุ ูุฐุง ุณููุธุฑ ุฃููุงู ูู ุจููุชูุง ุงูุนุงูุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/j7/ev/en/j7evenhyzzfvzouqfkbfq1j9hvu.png"></p><br><p style=";text-align:right;direction:rtl">  ุชู ุจูุงุก SparkML ุนูู ุฃุณุงุณ ุงูููุงููู ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงููุญูู - ูุฃุฎุฐ ูุฌููุนุฉ ุจูุงูุงุช ููุฏุฎูุงุช ููุนูุฏ ูุฌููุนุฉ ูุนุฏูุฉ (ุชุญููู).  ููุงุนุฏุฉ ุนุงูุฉ ุ ูุชู ุงุณุชุฎุฏุงูู ูุชูููุฐ ุฎูุงุฑุฒููุงุช ูุง ูุจู ููุง ุจุนุฏ ุงููุนุงูุฌุฉ ุ ูุงุณุชุฎุฑุงุฌ ุงููุนุงูู ุ ููููู ุฃู ุชูุซู ุฃูุถูุง ููุงุฐุฌ ML ุงููุงุชุฌุฉ. </li><li style=";text-align:right;direction:rtl">  ููุฏูุฑ - ูุฃุฎุฐ ูุฌููุนุฉ ุจูุงูุงุช ููุฏุฎูุงุช ุ ููุนูุฏ ุงููุญูู (ููุงุณุจ).  ุจุทุจูุนุฉ ุงูุญุงู ุ ูููู ุฃู ููุฏูุฑ ุชูุซู ุฎูุงุฑุฒููุฉ ML. </li><li style=";text-align:right;direction:rtl">  ุฎุท ุงูุฃูุงุจูุจ ูู ุญุงูุฉ ุฎุงุตุฉ ูู Estimator ุ ูุชุชููู ูู ุณูุณูุฉ ูู ุงููุญููุงุช ูุงูููุฏุฑุงุช.  ุนูุฏูุง ูุชู ุงุณุชุฏุนุงุก ุงูุฃุณููุจ ุ ููุฑ fit ุนุจุฑ ุงูุณูุณูุฉ ุ ูุฅุฐุง ุฑุฃู ูุญูููุง ุ ูุฅูู ูุทุจูู ุนูู ุงูุจูุงูุงุช ุ ูุฅุฐุง ุฑุฃู ููุฏุฑูุง ุ ูุฅูู ูุฏุฑุจ ุงููุญูู ููุทุจูู ุนูู ุงูุจูุงูุงุช ููุฐูุจ ุฃุจุนุฏ ูู ุฐูู. </li><li style=";text-align:right;direction:rtl">  PipelineModel - ูุชูุฌุฉ Pipeline ุชุญุชูู ุฃูุถูุง ุนูู ุณูุณูุฉ ูู ุงูุฏุงุฎู ุ ูููู ุชุชููู ุญุตุฑููุง ูู ูุญููุงุช.  ูููุง ูุฐูู ุ PipelineModel ููุณู ูู ุฃูุถุง ูุญูู. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุซู ูุฐุง ุงูููุฌ ูู ุชุดููู ุฎูุงุฑุฒููุงุช ML ูุณุงุนุฏ ุนูู ุชุญููู ูููู ูุญุฏุงุช ูุงุถุญ ูุงุณุชูุณุงุฎ ุฌูุฏ - ูููู ุญูุธ ูู ูู ุงูููุงุฐุฌ ูุฎุทูุท ุงูุฃูุงุจูุจ. </p><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุณูููู ุจุจูุงุก ุฎุท ุฃูุงุจูุจ ุจุณูุท ูุญุณุจ ุจู ุฅุญุตุงุกุงุช ุชูุฒูุน ุงูุฅุฌุฑุงุกุงุช (ุญูู ุงูููุงุญุธุงุช) ูููุณุชุฎุฏููู ูู ูุฌููุนุฉ ุงูุชุฏุฑูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> feedbackAggregator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//         (feedback)  one-hot  new MultinominalExtractor().setInputCol("feedback").setOutputCol("feedback"), //       new VectorStatCollector() .setGroupByColumns("date").setInputCol("feedback") .setPercentiles(Array(0.1,0.5,0.9)), //        new VectorExplode().setValueCol("feedback") )).fit(train) z.show(feedbackAggregator .transform(filteredTrain) .orderBy($"date", $"feedback"))</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุฎุท ุงูุฃูุงุจูุจ ูุฐุง ุ ูุชู ุงุณุชุฎุฏุงู ูุธููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a> ุจูุดุงุท - ุงูููุชุจุงุช ุงูุชู ุชุญุชูู ุนูู ูุชู ูููุฏุฉ ููุชุฏุฉ ูู SparkML ุ ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู MultinominalExtractor ูุชุดููุฑ ุญุฑู ูู ุงูููุน "ูุฌููุนุฉ ูู ุงูุณูุงุณู" ูู ูุชุฌู ููููุง ููุจุฏุฃ hot-one.  ูุฐุง ูู ุงูููุฏุฑ ุงููุญูุฏ ูู ุฎุท ุงูุฃูุงุจูุจ (ูุฅูุดุงุก ุชุดููุฑ ุ ูุฌุจ ุนููู ุฌูุน ุฎุทูุท ูุฑูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช). </li><li style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู VectorStatCollector ูุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงููุชุฌูุงุช. </li><li style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู VectorExplode ูุชุญููู ุงููุชูุฌุฉ ุฅูู ุชูุณูู ููุงุณุจ ููุชุตูุฑ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุณุชููู ูุชูุฌุฉ ุงูุนูู ุนุจุงุฑุฉ ุนู ุฑุณู ุจูุงูู ููุถุญ ุฃู ุงููุฆุงุช ุงูููุฌูุฏุฉ ูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชูุงุฒูุฉ ุ ููุน ุฐูู ุ ูุฅู ุนุฏู ุงูุชูุงุฒู ูููุฆุฉ ุงูุชู ุฃุนุฌุจุช ุจุงููุฏู ููุณ ูุชุทุฑููุง: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/aa/db/x4/aadbx4el5s5lhuyput_cj4ns9zo.png"></p><br><p style=";text-align:right;direction:rtl">  ููุถุญ ุชุญููู ุงูุชูุฒูุน ุงูููุงุซู ุจูู ุงููุณุชุฎุฏููู ุงููุดุงุจููู ููุงุฎุชุจุงุฑ (ูุฏููู "ููุฌุจ" ู "ุณูุจู" ูู ุงูุณุฌูุงุช) ุฃูู ูุชุญูุฒ ูููุฆุฉ ุงูููุฌุจุฉ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/x5/lu/px/x5lupxmayvvodo7lsb3meob1dou.png"></p><br><h1 id="statisticheskiy-analiz-priznakov" style=";text-align:right;direction:rtl">  ุงูุชุญููู ุงูุฅุญุตุงุฆู ููุนูุงูุงุช </h1><br><p style=";text-align:right;direction:rtl">  ูู ุงููุฑุญูุฉ ุงูุชุงููุฉ ุ ุณูููู ุจุฅุฌุฑุงุก ุชุญููู ููุตู ููุฎุตุงุฆุต ุงูุฅุญุตุงุฆูุฉ ููุณูุงุช.  ูุฐู ุงููุฑุฉ ูุญุชุงุฌ ุฅูู ูุงูู ุฃูุจุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> statsAggregator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-comment"><span class="hljs-comment">//          new AutoAssembler() .setColumnsToExclude( (Seq("date", "feedback") ++ train.schema.fieldNames.filter(_.endsWith("Id")) : _*)) .setOutputCol("features"), new VectorStatCollector() .setGroupByColumns("date").setInputCol("features") .setPercentiles(Array(0.1,0.5,0.9)), new VectorExplode().setValueCol("features") ))</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฐ ุงูุขู ูุญู ุจุญุงุฌุฉ ุฅูู ุงูุนูู ููุณ ูุน ุญูู ูููุตู ุ ูููู ูุน ูู ุงูุณูุงุช ูู ููุช ูุงุญุฏ ุ ุณูู ูุณุชุฎุฏู ุงุซููู ูู ุงูุฃุฏูุงุช ุงููุณุงุนุฏุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a> ุฃูุซุฑ ูุงุฆุฏุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุณูุญ ูู NullToDefaultReplacer ุจุงุณุชุจุฏุงู ุงูุนูุงุตุฑ ุงูููููุฏุฉ ูู ุงูุจูุงูุงุช ุจููููุง ุงูุงูุชุฑุงุถูุฉ (0 ููุฃุฑูุงู ุ ุฎุทุฃ ูููุชุบูุฑุงุช ุงูููุทููุฉ ุ ุฅูุฎ).  ุฅุฐุง ูู ุชูู ุจูุฐุง ุงูุชุญููู ุ ูุณุชุธูุฑ ููู NaN ูู ุงููุชุฌูุงุช ุงููุงุชุฌุฉ ุ ููู ุฃูุฑ ูููุช ุจุงููุณุจุฉ ููุนุฏูุฏ ูู ุงูุฎูุงุฑุฒููุงุช (ุนูู ุณุจูู ุงููุซุงู ุ ูููู ูู XGBoost ุงูุจูุงุก ุนูู ููุฏ ุงูุญูุงุฉ).  ุจุฏูู ุนู ุงุณุชุจุฏุงู ุงูุฃุตูุงุฑ ูููู ุงุณุชุจุฏุงูู ุจุงููุชูุณุทุงุช ุ ูุชู ุชุทุจูู ุฐูู ูู NaNToMeanReplacerEstimator. </li><li style=";text-align:right;direction:rtl">  AutoAssembler ุนุจุงุฑุฉ ุนู ุฃุฏุงุฉ ูุณุงุนุฏุฉ ูููุฉ ููุบุงูุฉ ุชููู ุจุชุญููู ุชุฎุทูุท ุงูุฌุฏูู ูููู ุนููุฏ ุชุญุฏูุฏ ูุธุงู vectorization ูุทุงุจู ููุน ุงูุนููุฏ. </li></ul><br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู ุฎุท ุงูุฃูุงุจูุจ ุงููุงุชุฌ ุ ูุญุณุจ ุงูุฅุญุตุงุฆูุงุช ูุซูุงุซ ูุฌููุนุงุช (ุงูุชุฏุฑูุจ ุ ุงูุชุฏุฑูุจ ุจุงุณุชุฎุฏุงู ููุชุฑ ุงููุณุชุฎุฏู ูุงูุงุฎุชุจุงุฑ) ูุญูุธูุง ูู ูููุงุช ูููุตูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//   (   AutoAssembler  ) val trained = statsAggregator.fit(filteredTrain) //       - ,     . trained .transform(filteredTrain .withColumn("date", //  ,      ,     , //        All   functions.explode(functions.array(functions.lit("All"), $"date")))) .coalesce(7).write.mode("overwrite").parquet("sna2019/featuresStat") trained .transform(filteredTrain .where(isTestSimilar($"instanceId_userId")) .withColumn("date", functions.explode(functions.array(functions.lit("All"), $"date")))) .coalesce(7).write.mode("overwrite").parquet("sna2019/filteredFeaturesStat") trained .transform(filteredTest.withColumn("date", functions.explode(functions.array(functions.lit("All"), $"date")))) .coalesce(3).write.mode("overwrite").parquet("sna2019/testFeaturesStat")</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชููู ุซูุงุซ ูุฌููุนุงุช ุจูุงูุงุช ูุน ุฅุญุตุงุฆูุงุช ุงูุณูุงุช ุ ูููู ุจุชุญููู ุงูุฃุดูุงุก ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ูุฏููุง ุนูุงูุงุช ุนูู ูุฌูุฏ ุงูุจุนุงุซุงุช ูุจูุฑุฉ. <br>  - ูุฌุจ ุฃู ุชููู ูุฐู ุงูุนูุงูุงุช ูุญุฏูุฏุฉ ุ ุฃู ูุฌุจ ุชุตููุฉ ุงูุณุฌูุงุช ุงูุฎุงุฑุฌูุฉ. </li><li style=";text-align:right;direction:rtl">  ูู ูุฏููุง ุนูุงูุงุช ูุน ูุฌูุฏ ุงูุญูุงุฒ ูุจูุฑ ูููุชูุณุท โโุจุงููุณุจุฉ ุฅูู ุงููุณูุท. <br>  - ูุญุฏุซ ูุซู ูุฐุง ุงูุชุญูู ูู ูุซูุฑ ูู ุงูุฃุญูุงู ูู ูุฌูุฏ ุชูุฒูุน ุงูุทุงูุฉ ุ ููู ุงูููุทูู ููุบุงุฑูุชู ูุฐู ุงูุนูุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ูู ููุงู ุชุญูู ูู ูุชูุณุท โโุงูุชูุฒูุนุงุช ุจูู ุงูุชุฏุฑูุจ ูุงุฎุชุจุงุฑ ูุฌููุนุงุช. </li><li style=";text-align:right;direction:rtl">  ููู ุชููุฃ ุจุฅุญูุงู ุงููุตูููุฉ ููุฒุฉ ูุฏููุง. </li></ul><br><p style=";text-align:right;direction:rtl">  ูุชูุถูุญ ูุฐู ุงูุฌูุงูุจ ุ ุณูุณุงุนุฏูุง ูุฐุง ุงูุทูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareWithTest</span></span></span></span>(data: <span class="hljs-type"><span class="hljs-type">DataFrame</span></span>) : <span class="hljs-type"><span class="hljs-type">DataFrame</span></span> = { data.where(<span class="hljs-string"><span class="hljs-string">"date = 'All'"</span></span>) .select( $<span class="hljs-string"><span class="hljs-string">"features"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//         // ( ) functions.log($"features_mean" / $"features_p50").as("skewenes"), //    90-      //    90-  โ    functions.log( ($"features_max" - $"features_p90") / ($"features_p90" - $"features_p50")).as("outlieres"), //       ,  //    ($"features_nonZeros" / $"features_count").as("train_fill"), $"features_mean".as("train_mean")) .join(testStat.where("date = 'All'") .select($"features", $"features_mean".as("test_mean"), ($"features_nonZeros" / $"features_count").as("test_fill")), Seq("features")) //          .withColumn("meanDrift", (($"train_mean" - $"test_mean" ) / ($"train_mean" + $"test_mean"))) //      .withColumn("fillDrift", ($"train_fill" - $"test_fill") / ($"train_fill" + $"test_fill")) } //         val comparison = compareWithTest(trainStat).withColumn("mode", functions.lit("raw")) .unionByName(compareWithTest(filteredStat).withColumn("mode", functions.lit("filtered")))</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฐู ุงููุฑุญูุฉ ุ ูููู ุงูุณุคุงู ุงููุฑุฆู ุฃูุฑูุง ููุญูุง: ูู ุงูุตุนุจ ุนุฑุถ ุฌููุน ุงูุฌูุงูุจ ุนูู ุงูููุฑ ุจุงุณุชุฎุฏุงู ุฃุฏูุงุช Zeppelin ุงูุนุงุฏูุฉ ุ ูุชุจุฏุฃ ุฃุฌูุฒุฉ ุงูููุจููุชุฑ ุงููุญูููุฉ ุงูุชู ุชุญุชูู ุนูู ุนุฏุฏ ูุจูุฑ ูู ุงูุฑุณูู ุงูุจูุงููุฉ ูู ุงูุชุจุงุทุค ุจุดูู ููุญูุธ ุจุณุจุจ DOM ุงููุชุถุฎูุฉ.  ูููู ูููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Vegas</a> - DSL ูู Scala ูุจูุงุก ููุงุตูุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">vega-lite</a> ุญู ูุฐู ุงููุดููุฉ.  ูุง ูููุฑ Vegas ุฅููุงููุงุช ุชุตููุฑ ุฃูุซุฑ ุซุฑุงุกู (ูุงุจูุฉ ููููุงุฑูุฉ ูุน matplotlib) ุ ุจู ูุฑุณููุง ุฃูุถูุง ุนูู Canvas ุฏูู ุชุถุฎูู DOM :). </p><br><p style=";text-align:right;direction:rtl">  ุณุชุจุฏู ููุงุตูุงุช ุงููุฎุทุท ุงูุฐู ูุญู ููุชููู ุจู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs">vegas.<span class="hljs-type"><span class="hljs-type">Vegas</span></span>(width = <span class="hljs-number"><span class="hljs-number">1024</span></span>, height = <span class="hljs-number"><span class="hljs-number">648</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   .withDataFrame(comparison.na.fill(0.0)) //           .encodeX("meanDrift", Quant, scale = Scale(domainValues = List(-1.0, 1.0), clamp = true)) //   -       .encodeY("train_fill", Quant) //       .encodeColor("outlieres", Quant, scale=Scale( rangeNominals=List("#00FF00", "#FF0000"), domainValues = List(0.0, 5), clamp = true)) //       .encodeSize("skewenes", Quant) //   -   (   ) .encodeShape("mode", Nom) .mark(vegas.Point) .show</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ูููู ุงููุฎุทุท ุฃุฏูุงู ููุง ููู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุธูุฑ ูุญูุฑ X ุชุญูู ูุฑุงูุฒ ุงูุชูุฒูุน ุจูู ูุฌููุนุงุช ุงูุงุฎุชุจุงุฑ ูุงูุชุฏุฑูุจ (ุฃูุฑุจ ุฅูู 0 ุ ูุงูุช ุงูุนูุงูุฉ ุฃูุซุฑ ุซุจุงุชูุง). </li><li style=";text-align:right;direction:rtl">  ูุชู ุฑุณู ุงููุณุจุฉ ุงููุฆููุฉ ููุนูุงุตุฑ ุบูุฑ ุงูุตูุฑูุฉ ุนูู ุทูู ุงููุญูุฑ ุต (ูููุง ุฒุงุฏ ุนุฏุฏ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ูู ุงูุนุฏุฏ ุงูุฃูุจุฑ ูู ุงูููุงุท ุญุณุจ ุงูุณูุฉ). </li><li style=";text-align:right;direction:rtl">  ููุถุญ ุงูุญุฌู ุฅุฒุงุญุฉ ุงููุชูุณุท โโุจุงููุณุจุฉ ุฅูู ุงููุณูุท (ูููุง ูุงูุช ุงูููุทุฉ ุฃูุจุฑ ุ ุฒุงุฏ ุชูุฒูุน ูุงููู ุงูุทุงูุฉ ุนูู ุงูุฃุฑุฌุญ). </li><li style=";text-align:right;direction:rtl">  ูุดูุฑ ุงูููู ุฅูู ุงูุงูุจุนุงุซุงุช (ุงูุฃูุซุฑ ุงุญูุฑุงุฑูุง ุ ูุงููุฒูุฏ ูู ุงูุงูุจุนุงุซุงุช). </li><li style=";text-align:right;direction:rtl">  ุญุณููุง ุ ูุชููุฒ ุงููููุฐุฌ ุจูุถุน ุงูููุงุฑูุฉ: ุจุงุณุชุฎุฏุงู ูุฑุดุญ ูุณุชุฎุฏู ูู ูุฌููุนุฉ ุงูุชุฏุฑูุจ ุฃู ุจุฏูู ูุฑุดุญ. </li></ul><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/op/hb/6g/ophb6gi3wa_uvsld9rre6ujzquu.png"></p><br><p style=";text-align:right;direction:rtl">  ูุฐูู ุ ูููููุง ุงุณุชุฎูุงุต ุงููุชุงุฆุฌ ุงูุชุงููุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุจุนุถ ุงูุนูุงูุงุช ุฅูู ูุฑุดุญ ููุงูุจุนุงุซุงุช - ุณูุญุฏุฏ ุงูุญุฏ ุงูุฃูุตู ููููู ุงููุฆููุฉ ุงูุชุณุนูู. </li><li style=";text-align:right;direction:rtl">  ุชุธูุฑ ุจุนุถ ุงูุนูุงูุงุช ุชูุฒูุนุฉ ูุฑูุจุฉ ูู ุงูุฃุณู - ุณูุชุฎุฐ ุงูููุบุงุฑูุชู. </li><li style=";text-align:right;direction:rtl">  ูุง ูุชู ุชูุฏูู ุจุนุถ ุงูููุฒุงุช ูู ุงูุงุฎุชุจุงุฑ - ุณูุณุชุจุนุฏูุง ูู ุงูุชุฏุฑูุจ. </li></ul><br><h1 id="korrelyacionnyy-analiz" style=";text-align:right;direction:rtl">  ุชุญููู ุงูุงุฑุชุจุงุท </h1><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุงูุญุตูู ุนูู ููุฑุฉ ุนุงูุฉ ุญูู ููููุฉ ุชูุฒูุน ุงูุณูุงุช ูููููุฉ ุงุฑุชุจุงุทูุง ุจูู ุงูุชุฏุฑูุจ ูุงุฎุชุจุงุฑ ูุฌููุนุงุช ุ ุฏุนููุง ูุญุงูู ุชุญููู ุงูุงุฑุชุจุงุทุงุช.  ููููุงู ุจุฐูู ุ ูู ุจุชูููู ูุณุชุฎุฑุฌ ุงูููุฒุฉ ุงุณุชูุงุฏูุง ุฅูู ุงูููุงุญุธุงุช ุงูุณุงุจูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//             val expressions = filteredTrain.schema.fieldNames //          .filterNot(x =&gt; x == "date" || x == "audit_experiment" || idsColumns(x) || x.contains("vd_")) .map(x =&gt; if(skewedFeautres(x)) { //      s"log($x) AS $x" } else { //     cappedFeatures.get(x).map(capping =&gt; s"IF($x &lt; $capping, $x, $capping) AS $x").getOrElse(x) }) val rawFeaturesExtractor = new Pipeline().setStages(Array( new SQLTransformer().setStatement(s"SELECT ${expressions.mkString(", ")} FROM __THIS__"), new NullToDefaultReplacer(), new AutoAssembler().setOutputCol("features") )) //       val raw = rawFeaturesExtractor.fit(filteredTrain).transform( filteredTrain.where(isTestSimilar($"instanceId_userId")))</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจูู ุงูุฃุฌูุฒุฉ ุงูุฌุฏูุฏุฉ ูู ุฎุท ุงูุฃูุงุจูุจ ูุฐุง ุ ุชุฌุฐุจ ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ SQLTransformer ุงูุงูุชุจุงู ุ ููุง ูุณูุญ ุจุชุญูููุงุช SQL ุงูุชุนุณููุฉ ูุฌุฏูู ุงูุฅุฏุฎุงู. </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุชุญููู ุงูุงุฑุชุจุงุทุงุช ุ ูู ุงูููู ุชุตููุฉ ุงูุถูุถุงุก ุงููุงุชุฌุฉ ุนู ุงูุงุฑุชุจุงุท ุงูุทุจูุนู ููููุฒุงุช ุงูุณุงุฎูุฉ.  ููููุงู ุจุฐูู ุ ุฃูุฏ ุฃู ุฃููู ูุง ูู ุนูุงุตุฑ ุงููุชุฌู ุงูุชู ุชุชูุงูู ูุน ุฃุนูุฏุฉ ุงููุตุฏุฑ.  ูุชู ุฅูุฌุงุฒ ูุฐู ุงููููุฉ ูู Spark ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุชุนุฑูู ุงูุนููุฏ (ุงููุฎุฒูุฉ ูุน ุงูุจูุงูุงุช) ููุฌููุนุงุช ุงูุณูุงุช.  ูุชู ุงุณุชุฎุฏุงู ูุชูุฉ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ุงูุชุงููุฉ ูุชุตููุฉ ุฃุฒูุงุฌ ูู ุฃุณูุงุก ุงูุณูุงุช ุงูุชู ุชุฃุชู ูู ููุณ ุงูุนููุฏ ูู ุงูููุน String: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> attributes = <span class="hljs-type"><span class="hljs-type">AttributeGroup</span></span>.fromStructField(raw.schema(<span class="hljs-string"><span class="hljs-string">"features"</span></span>)).attributes.get <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> originMap = filteredTrain .schema.filter(_.dataType == <span class="hljs-type"><span class="hljs-type">StringType</span></span>) .flatMap(x =&gt; attributes.map(_.name.get).filter(_.startsWith(x.name + <span class="hljs-string"><span class="hljs-string">"_"</span></span>)).map(_ -&gt; x.name)) .toMap <span class="hljs-comment"><span class="hljs-comment">//   ,          val isNonTrivialCorrelation = sqlContext.udf.register("isNonTrivialCorrelation", (x: String, y : String) =&gt; //    Scala-quiz   Option originMap.get(x).map(_ != originMap.getOrElse(y, "")).getOrElse(true))</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅู ูุฌูุฏ ูุฌููุนุฉ ุจูุงูุงุช ูุน ุนููุฏ ูุชุฌู ูู ูุชูุงูู ุงููุฏ ุ ูุนุฏ ุญุณุงุจ ุงูุงุฑุชุจุงุทุงุช ุงููุชูุงุทุนุฉ ุจุงุณุชุฎุฏุงู Spark ุฃูุฑูุง ุจุณูุทูุง ููุบุงูุฉ ุ ููู ุงููุชูุฌุฉ ูู ูุตูููุฉ ุ ุญูุซ ูุชุนูู ุนููู ูุดุฑูุง ููููุงู ูู ูุฌููุนุฉ ูู ุงูุฃุฒูุงุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pearsonCorrelation = <span class="hljs-comment"><span class="hljs-comment">//    Pearson  Spearman Correlation.corr(raw, "features", "pearson").rdd.flatMap( //           _.getAs[Matrix](0).rowIter.zipWithIndex.flatMap(x =&gt; { //   ,   (  , //  ) val name = attributes(x._2).name.get //    ,     x._1.toArray.zip(attributes).map(y =&gt; (name, y._2.name.get, y._1)) } //     DataFrame )).toDF("feature1", "feature2", "corr") .na.drop //   .where(isNonTrivialCorrelation($"feature1", $"feature2")) //    . pearsonCorrelation.coalesce(1).write.mode("overwrite") .parquet("sna2019/pearsonCorrelation")</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุงูุทุจุน ุ ุงูุชุตูุฑ: ุณูุญุชุงุฌ ูุฑุฉ ุฃุฎุฑู ุฅูู ูุณุงุนุฏุฉ ููุบุงุณ ูุฑุณู ุฎุฑูุทุฉ ุญุฑุงุฑุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs">vegas.<span class="hljs-type"><span class="hljs-type">Vegas</span></span>(<span class="hljs-string"><span class="hljs-string">"Pearson correlation heatmap"</span></span>) .withDataFrame(pearsonCorrelation .withColumn(<span class="hljs-string"><span class="hljs-string">"isPositive"</span></span>, $<span class="hljs-string"><span class="hljs-string">"corr"</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .withColumn(<span class="hljs-string"><span class="hljs-string">"abs_corr"</span></span>, functions.abs($<span class="hljs-string"><span class="hljs-string">"corr"</span></span>)) .where(<span class="hljs-string"><span class="hljs-string">"feature1 &lt; feature2 AND abs_corr &gt; 0.05"</span></span>) .orderBy(<span class="hljs-string"><span class="hljs-string">"feature1"</span></span>, <span class="hljs-string"><span class="hljs-string">"feature2"</span></span>)) .encodeX(<span class="hljs-string"><span class="hljs-string">"feature1"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>) .encodeY(<span class="hljs-string"><span class="hljs-string">"feature2"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>) .encodeColor(<span class="hljs-string"><span class="hljs-string">"abs_corr"</span></span>, <span class="hljs-type"><span class="hljs-type">Quant</span></span>, scale=<span class="hljs-type"><span class="hljs-type">Scale</span></span>(rangeNominals=<span class="hljs-type"><span class="hljs-type">List</span></span>(<span class="hljs-string"><span class="hljs-string">"#FFFFFF"</span></span>, <span class="hljs-string"><span class="hljs-string">"#FF0000"</span></span>))) .encodeShape(<span class="hljs-string"><span class="hljs-string">"isPositive"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>) .mark(vegas.<span class="hljs-type"><span class="hljs-type">Point</span></span>) .show</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงููุชูุฌุฉ ูู ุงูุฃูุถู ููุจุญุซ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zepl-e</a> .  ูููู ุนุงู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/nm/d9/bm/nmd9bmrion4goaov9_vgx5vbjoy.png"></p><br><p style=";text-align:right;direction:rtl">  ุชูุถุญ ุฎุฑูุทุฉ ุงูุญุฑุงุฑุฉ ุฃู ููุงู ุจุนุถ ุงูุงุฑุชุจุงุทุงุช ุจูุถูุญ.  ุฏุนูุง ูุญุงูู ุชุญุฏูุฏ ูุชู ุงูููุฒุงุช ุงูุฃูุซุฑ ุงุฑุชุจุงุทูุง ุ ูุฐูู ูุณุชุฎุฏู ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">GraphX</a> : ูุญูู ูุตูููุฉ ุงูุงุฑุชุจุงุท ุฅูู ุฑุณู ุจูุงูู ุ ูููู ุจุชุตููุฉ ุงูุญูุงู ุญุณุจ ุงููุฒู ุ ูุจุนุฏ ุฐูู ูุฌุฏ ุงูููููุงุช ุงููุชุตูุฉ ููุชุฑู ุงูููููุงุช ุบูุฑ ุงููุงุจูุฉ ููุชุญูู ููุท (ูู ุฃูุซุฑ ูู ุนูุตุฑ ูุงุญุฏ).  ูุดุจู ูุฐุง ุงูุฅุฌุฑุงุก ุฃุณุงุณูุง ุชุทุจูู ุฎูุงุฑุฒููุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DBSCAN</a> ููู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//   (GrpahX   ID) val featureIndexMap = spearmanCorrelation.select("feature1").distinct.rdd.map( _.getString(0)).collect.zipWithIndex.toMap val featureIndex = sqlContext.udf.register("featureIndex", (x: String) =&gt; featureIndexMap(x)) //    val vertices = sc.parallelize(featureIndexMap.map(x =&gt; x._2.toLong -&gt; x._1).toSeq, 1) //    val edges = spearmanCorrelation.select(featureIndex($"feature1"), featureIndex($"feature2"), $"corr") //     .where("ABS(corr) &gt; 0.7") .rdd.map(r =&gt; Edge(r.getInt(0), r.getInt(1), r.getDouble(2))) //       val components = Graph(vertices, edges).connectedComponents() val reversedMap = featureIndexMap.map(_.swap) //    ,    ,   //   val clusters = components .vertices.map(x =&gt; reversedMap(x._2.toInt) -&gt; reversedMap(x._1.toInt)) .groupByKey().map(x =&gt; x._2.toSeq) .filter(_.size &gt; 1) .sortBy(-_.size) .collect</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุชูุฏูู ุงููุชูุฌุฉ ูู ุดูู ุฌุฏูู: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/4b/t2/bl/4bt2blcjzmxbzucnm7zynpvpj-q.png"></p><br><p style=";text-align:right;direction:rtl">  ุงุณุชูุงุฏูุง ุฅูู ูุชุงุฆุฌ ุงูุชุฌููุน ุ ูููููุง ุฃู ูุณุชูุชุฌ ุฃู ุงููุฌููุนุงุช ุงูุฃูุซุฑ ุงุฑุชุจุงุทูุง ุชุชุดูู ุญูู ุงูุนูุงูุงุช ุงููุฑุชุจุทุฉ ุจุนุถููุฉ ุงููุณุชุฎุฏู ูู ุงููุฌููุนุฉ (membership_status_A) ุ ููุฐูู ุญูู ููุน ุงููุงุฆู (ูุซููId_objectType).  ููุญุตูู ุนูู ุฃูุถู ููุฐุฌุฉ ุชูุงุนู ุงูุฅุดุงุฑุงุช ุ ูู ุงูููุทูู ุชุทุจูู ุชุฌุฒุฆุฉ ุงููููุฐุฌ - ูุชุฏุฑูุจ ููุงุฐุฌ ูุฎุชููุฉ ูุฃููุงุน ูุฎุชููุฉ ูู ุงููุงุฆูุงุช ุ ุจุดูู ูููุตู ูููุฌููุนุงุช ุงูุชู ูููู ุงููุณุชุฎุฏู ูููุง ูููุณ ูุฐูู. </p><br><h1 id="mashinnoe-obuchenie" style=";text-align:right;direction:rtl">  ุชุนูู ุงูุขูุฉ </h1><br><p style=";text-align:right;direction:rtl">  ูุญู ููุชุฑุจ ูู ุงูุดูุก ุงูุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู - ุงูุชุนูู ุงูุขูู.  ุฎุท ุฃูุงุจูุจ ุงูุชุฏุฑูุจ ูุฃุจุณุท ูููุฐุฌ (ุงูุงูุญุฏุงุฑ ุงูููุฌุณุชู) ุจุงุณุชุฎุฏุงู ููุญูุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SparkML</a> ู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a> ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement( <span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"SELECT *, IF(array_contains(feedback, 'Liked'), 1.0, 0.0) AS label FROM __THIS__"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AutoAssembler</span></span>() .setColumnsToExclude(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>, <span class="hljs-string"><span class="hljs-string">"feedback"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>), <span class="hljs-type"><span class="hljs-type">Scaler</span></span>.scale(<span class="hljs-type"><span class="hljs-type">Interceptor</span></span>.intercept(<span class="hljs-type"><span class="hljs-type">UnwrappedStage</span></span>.repartition( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">LogisticRegressionLBFSG</span></span>(), numPartitions = <span class="hljs-number"><span class="hljs-number">127</span></span>)))</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูุฑู ููุณ ููุท ุงูุนุฏูุฏ ูู ุงูุนูุงุตุฑ ุงููุฃูููุฉ ุ ูููู ุฃูุถูุง ุงูุนุฏูุฏ ูู ุงูุนูุงุตุฑ ุงูุฌุฏูุฏุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  LogisticRegressionLBFSG ูู ููุฏุฑ ูุน ุงูุชุฏุฑูุจ ุงูููุฒุนุฉ ูู ุงูุงูุญุฏุงุฑ ุงูููุฌุณุชู. </li><li style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุชุญููู ุฃูุตู ูุฏุฑ ูู ุงูุฃุฏุงุก ูู ุฎูุงุฑุฒููุงุช ML ุงูููุฒุนุฉ.  ูุฌุจ ุชูุฒูุน ุงูุจูุงูุงุช ุนูู ุงููุญู ุงูุฃูุซู ุนุจุฑ ุงูุฃูุณุงู.  ุณูู ุชุณุงุนุฏ ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ UnwrappedStage.repartition ูู ูุฐุง ุงูุฃูุฑ ุ ุจุฅุถุงูุฉ ุนูููุฉ ุฅุนุงุฏุฉ ุชูุณูู ุฅูู ุฎุท ุงูุฃูุงุจูุจ ุจุทุฑููุฉ ูุง ูุชู ุงุณุชุฎุฏุงููุง ุฅูุง ูู ูุฑุญูุฉ ุงูุชุฏุฑูุจ (ุจุนุฏ ูู ุดูุก ุ ุนูุฏ ุจูุงุก ุงูุชููุนุงุช ุ ูู ุชุนุฏ ุถุฑูุฑูุฉ). </li><li style=";text-align:right;direction:rtl">  ุจุญูุซ ุงููููุฐุฌ ุงูุฎุทู ูููู ุฃู ูุนุทู ูุชูุฌุฉ ุฌูุฏุฉ.  ูุฌุจ ุชุบููุฑ ุญุฌู ุงูุจูุงูุงุช ุ ุญูุซ ุชููู ุงูุฃุฏุงุฉ ุงููุณุงุนุฏุฉ Scaler.scale ูุณุคููุฉ.  ููุน ุฐูู ุ ูุฅู ูุฌูุฏ ุชุญููููู ุฎุทููู ูุชุชุงูููู (ุงูุชูุณุน ูุงูุถุฑุจ ุจุฃูุฒุงู ุงูุงูุญุฏุงุฑ) ูุคุฏู ุฅูู ูููุงุช ุบูุฑ ุถุฑูุฑูุฉ ุ ููู ุงููุฑุบูุจ ููู ุงูููุงุฑ ูุฐู ุงูุนูููุงุช.  ุนูุฏ ุงุณุชุฎุฏุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML ุ</a> ุณูููู ุงูุฅุฎุฑุงุฌ ูููุฐุฌูุง ูุธูููุง ุจุงุณุชุฎุฏุงู ุชุญููู ูุงุญุฏ :). </li><li style=";text-align:right;direction:rtl">  ุญุณููุง ุ ุจุงูุทุจุน ุ ุจุงููุณุจุฉ ููุฐู ุงูุทุฑุฒ ุ ูุฅูู ุชุญุชุงุฌ ุฅูู ุนุถู ูุฌุงูู ุ ูุถููู ุจุงุณุชุฎุฏุงู ุนูููุฉ Interceptor.intercept. </li></ul><br><p style=";text-align:right;direction:rtl">  ูููุฑ ุฎุท ุงูุฃูุงุจูุจ ุงููุงุชุฌ ุ ุงููุทุจู ุนูู ุฌููุน ุงูุจูุงูุงุช ุ ููู ูุณุชุฎุฏู AUC 0.6889 (ูุชููุฑ ุฑูุฒ ุงูุชุญูู ูู ุงูุตุญุฉ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zepl</a> ).  ุงูุขู ูุจูู ุชุทุจูู ุฌููุน ุฃุจุญุงุซูุง: ุชุตููุฉ ุงูุจูุงูุงุช ุ ุชุญููู ุงูููุฒุงุช ุ ูููุงุฐุฌ ุงููุทุงุน.  ุณูุจุฏู ุฎุท ุงูุฃูุงุจูุจ ุงูููุงุฆู ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement(<span class="hljs-string"><span class="hljs-string">s"SELECT instanceId_userId, instanceId_objectId, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${expressions.mkString(", ")}</span></span></span><span class="hljs-string"> FROM __THIS__"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"SELECT *, IF(array_contains(feedback, 'Liked'), 1.0, 0.0) AS label, concat(IF(membership_status = 'A', 'OwnGroup_', 'NonUser_'), instanceId_objectType) AS type FROM __THIS__"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AutoAssembler</span></span>() .setColumnsToExclude(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>, <span class="hljs-string"><span class="hljs-string">"feedback"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>,<span class="hljs-string"><span class="hljs-string">"instanceId_objectType"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>), <span class="hljs-type"><span class="hljs-type">CombinedModel</span></span>.perType( <span class="hljs-type"><span class="hljs-type">Scaler</span></span>.scale(<span class="hljs-type"><span class="hljs-type">Interceptor</span></span>.intercept(<span class="hljs-type"><span class="hljs-type">UnwrappedStage</span></span>.repartition( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">LogisticRegressionLBFSG</span></span>(), numPartitions = <span class="hljs-number"><span class="hljs-number">127</span></span>))), numThreads = <span class="hljs-number"><span class="hljs-number">6</span></span>) ))</code> </pre> <br><p style=";text-align:right;direction:rtl">     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a> โ    CombinedModel.perType.       ,     numThreads = 6.             . </p><br><p style=";text-align:right;direction:rtl"> ,   ,  per-user AUC 0.7004.    ?  ,   " "    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">XGBoost</a> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Pipeline</span></span>().setStages(<span class="hljs-type"><span class="hljs-type">Array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">SQLTransformer</span></span>().setStatement(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">"SELECT *, IF(array_contains(feedback, 'Liked'), 1.0, 0.0) AS label FROM __THIS__"</span></span><span class="hljs-string"><span class="hljs-string">""</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">NullToDefaultReplacer</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">AutoAssembler</span></span>() .setColumnsToExclude(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_userId"</span></span>, <span class="hljs-string"><span class="hljs-string">"instanceId_objectId"</span></span>, <span class="hljs-string"><span class="hljs-string">"feedback"</span></span>, <span class="hljs-string"><span class="hljs-string">"label"</span></span>) .setOutputCol(<span class="hljs-string"><span class="hljs-string">"features"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">XGBoostRegressor</span></span>() .setNumRounds(<span class="hljs-number"><span class="hljs-number">100</span></span>) .setMaxDepth(<span class="hljs-number"><span class="hljs-number">15</span></span>) .setObjective(<span class="hljs-string"><span class="hljs-string">"reg:logistic"</span></span>) .setNumWorkers(<span class="hljs-number"><span class="hljs-number">17</span></span>) .setNthread(<span class="hljs-number"><span class="hljs-number">4</span></span>) .setTrackerConf(<span class="hljs-number"><span class="hljs-number">600000</span></span>L, <span class="hljs-string"><span class="hljs-string">"scala"</span></span>) ))</code> </pre> <br><p style=";text-align:right;direction:rtl"> ,     โ XGBoost  Spark !         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">DLMC</a> ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a> ,       (  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> ).  XGboost " "   10     per-user AUC 0.6981. </p><br><h1 id="analiz-rezultatov" style=";text-align:right;direction:rtl">   </h1><br><p style=";text-align:right;direction:rtl"> ,     ,  ,       .    SparkML     ,      .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a>  :      Parquet            Spark: </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//     val perTypeWeights = sqlContext.read.parquet("sna2019/perType/stages/*/weights") //     20    ( //  ) val topFeatures = new TopKTransformer[Double]() .setGroupByColumns("type") .setColumnToOrderGroupsBy("abs_weight") .setTopK(20) .transform(perTypeWeights.withColumn("abs_weight", functions.abs($"unscaled_weight"))) .orderBy("type", "unscaled_weight")</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">     Parquet,        <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">PravdaML</a> โ TopKTransformer,           . </p><br><p style=";text-align:right;direction:rtl">      Vegas (   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Zepl</a> ): </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/q7/_n/fn/q7_nfnto-hw-9nbdgjf3chhm0oc.png"></p><br><p style=";text-align:right;direction:rtl"> ,    -   .      XGBoost? </p><br><pre style=";text-align:right;direction:rtl"> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> significance = sqlContext.read.parquet( <span class="hljs-string"><span class="hljs-string">"sna2019/xgBoost15_100_raw/stages/*/featuresSignificance"</span></span> vegas.<span class="hljs-type"><span class="hljs-type">Vegas</span></span>() .withDataFrame(significance.na.drop.orderBy($<span class="hljs-string"><span class="hljs-string">"significance"</span></span>.desc).limit(<span class="hljs-number"><span class="hljs-number">40</span></span>)) .encodeX(<span class="hljs-string"><span class="hljs-string">"name"</span></span>, <span class="hljs-type"><span class="hljs-type">Nom</span></span>, sortField = <span class="hljs-type"><span class="hljs-type">Sort</span></span>(<span class="hljs-string"><span class="hljs-string">"significance"</span></span>, <span class="hljs-type"><span class="hljs-type">AggOps</span></span>.<span class="hljs-type"><span class="hljs-type">Mean</span></span>)) .encodeY(<span class="hljs-string"><span class="hljs-string">"significance"</span></span>, <span class="hljs-type"><span class="hljs-type">Quant</span></span>) .mark(vegas.<span class="hljs-type"><span class="hljs-type">Bar</span></span>) .show</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/i2/oy/zb/i2oyzbrjlo15x7u1uwadmeswocq.png"></p><br><p style=";text-align:right;direction:rtl">  ,   ,   XGBoost,         ,    .           <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> .   ,  XGBoost     ,    ,   . </p><br><h1 id="vyvody" style=";text-align:right;direction:rtl">  ุงููุชุงุฆุฌ </h1><br><p style=";text-align:right;direction:rtl">  ,       :).     : </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">    ,     Scala  Spark    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="></a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">  </a> ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="> </a> . </li><li style=";text-align:right;direction:rtl">    Scala  Spark        Python:    ETL  ML,    ,      ,     . </li><li style=";text-align:right;direction:rtl">  ,   ,   ,    (,  )    ,     ,      . </li><li style=";text-align:right;direction:rtl"> ,     ,       .          ,      ,     , -, . </li></ol><br><p style=";text-align:right;direction:rtl"> ,       ,    ,        ,    -.        , ,  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">   Scala</a> "  Newprolab. </p><br><p style=";text-align:right;direction:rtl"> ,  ,      โ   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">SNA Hackathon 2019</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar442688/">https://habr.com/ru/post/ar442688/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar442678/index.html">ุฃูุจุฑ ูุดุฑูุน ูู ุงูุทุจุงุนุฉ ุงูุญุฌุฑูุฉ ุงููุฌุณูุฉ: ูููู ุนุธูู ุถุฎู ูุทุจูุน ุนูู ุทุงุจุนุฉ ุซูุงุซูุฉ ุงูุฃุจุนุงุฏ</a></li>
<li><a href="../ar442680/index.html">ุชุชูุญ ูู ุชูููุงุช ุงูุงุณุชุจุฏุงู ุงูุญุณู ุฑุคูุฉ ุงูุนุงูู ุจูุณุงุนุฏุฉ ุงูุฃุตูุงุช: ููู ุชุนูู ุงููุฑููุฉ ุงูุนุตุจูุฉ ูู ุงูุฏูุงุบ ุงูุจุดุฑู</a></li>
<li><a href="../ar442682/index.html">ูุง ููุชุงุจุฉ ูููููุฉ ุชุฌููุน ูุดุฑูุน C ++</a></li>
<li><a href="../ar442684/index.html">ุฃุฏุงุก ูููุน ูุชูุงุฒู. ุงูุฌุฒุก 3: ุงููุญุชูู</a></li>
<li><a href="../ar442686/index.html">ุจุฑูุงูุฌ DataPower ุงูุชุนูููู</a></li>
<li><a href="../ar442690/index.html">ูููุฉ ุงูููุฑ "Bereshit" - ุตูุฑุฉ ุดุฎุตูุฉ ุนูู ุฎูููุฉ ุงูุฃุฑุถ</a></li>
<li><a href="../ar442692/index.html">Blockchain ุจุฏูู ูุณุทุงุก: ููู ุฃุฑุณููุง ุงูุฃูุฑุงู ุงููุงููุฉ ุฅูู ุณุฌู ููุฒุน</a></li>
<li><a href="../ar442694/index.html">ูุงุญุฏุฉ ูู ุนูุงููุฉ ุชุฏูู ุจุฏุฃุช ูู ุงูููุฏ ูุฌุฐุจุช ููููู ูุณุชุฎุฏู ูู ุงูุฃุณุจูุน</a></li>
<li><a href="../ar442696/index.html">S for Security: ุฃูุงู ุงูุฅูุชุฑูุช ููุฃุดูุงุก ูุงูุชูุงุฑูุฑ ูู InoThings ++ 2019</a></li>
<li><a href="../ar442698/index.html">ุชุทุจูู ูุชุฑู ููุณูู ููุชุฌุฑ ูููุฏูุฒ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>