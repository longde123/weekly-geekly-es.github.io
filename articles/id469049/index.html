<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>✉️ 🌅 💂🏼 Mengapa kami menulis logika bisnis di Lua 💽 👩🏿‍🏭 🎴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai, Habr. Dalam posting ini kami ingin berbicara tentang bagaimana dan mengapa kami menggunakan bahasa pemrograman dengan nama Lua yang indah di IPON...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengapa kami menulis logika bisnis di Lua</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iponweb/blog/469049/">  Hai, Habr.  Dalam posting ini kami ingin berbicara tentang bagaimana dan mengapa kami menggunakan bahasa pemrograman dengan nama Lua yang indah di IPONWEB. <br><br>  Lua adalah bahasa pemrograman tertanam berbasis naskah dengan juru bahasa gratis dan sumber terbuka di C. Bahasa ini dikembangkan pada tahun 1993 di Brasil, di divisi Tecgraf di Universitas Katolik Rio de Janeiro, dan nenek moyangnya adalah DEL (Data-Entry Language) dan SOL (Bahasa Obyek Sederhana) dikembangkan sebelumnya.  Salah satu leluhur, bahasa SOL, secara tidak langsung berpartisipasi dalam "baptisan" bayi yang baru lahir - "Sol" diterjemahkan dari bahasa Portugis sebagai "matahari", dan bahasa baru itu dinamai "Lua", "bulan". <br><br>  Kemudahan menanamkan Lua dalam mesin yang ditulis dalam bahasa "sistem" telah membuatnya menjadi bahasa scripting populer untuk video game.  Misalnya, skrip ditulis dalam Lua di Grim Fandango dan Gerbang Baldur.  Mereka yang bermain World of Warcraft juga mungkin pernah mendengar tentang Lua lebih dari sekali atau dua kali - di sanalah pengaya untuk game ditulis yang membuat hidup lebih mudah bagi pemain hardcore, penggemar kasual, penggemar untuk mengukur efektivitas mereka dan penduduk lain di dunia game.  Di luar gamedev, Lua digunakan sebagai bahasa scripting sistem tertanam (televisi, printer, panel mobil), serta aplikasi, misalnya, VLC Media Player.  Lua menggunakan alat seperti Tarantool, Redis, dan OpenResty sebagai bahasa yang disematkan.  Lua juga digunakan sebagai bahasa ekstensi untuk kode komputasi Fortran yang mensimulasikan perilaku termomekanis bahan bakar nuklir. <br><br><h3>  Kenapa Lua? </h3><br><a name="habracut"></a>  IPONWEB adalah pengembang platform yang sangat dimuat untuk perusahaan yang bekerja di bidang periklanan online: DSP, SSP, biro iklan dan pengiklan.  Kami berbicara <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">secara</a> rinci tentang pekerjaan kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">di artikel ini</a> .  Pada awalnya, kami mengembangkan logika bisnis platform kami di C ++, tetapi dengan cepat menyadari bahwa ini bukan pilihan terbaik.  Untuk meminimalkan biaya, kinerja platform adalah penting, serta kecepatan pengembangan, dan pengembangan C ++ ternyata terlalu lambat bagi kami, dan kompleksitas penambahan fungsi juga terpengaruh.  Kami memutuskan untuk mengisolasi interpretasi logika bisnis dari kode server tingkat rendah, mulai mencari bahasa yang cocok untuk ini, dan memutuskan untuk menggunakan Lua.  Itu pada tahun 2008, implementasi JavaScript yang cocok untuk kami belum ada, Perl, Python, dan Ruby terlalu lambat dan tidak mudah untuk diintegrasikan.  Dan ada bahasa Lua, tidak terlalu terkenal, tetapi populer di game dev, dan apa yang kami inginkan mirip dengan kebutuhan pengembang game - kami membutuhkan mesin cepat untuk operasi tingkat rendah dan bahasa cepat yang mudah dibangun untuk logika bisnis. <br><br>  Lua benar-benar bahasa yang sangat cepat.  Peningkatan kecepatan tambahan dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dicapai dengan</a> menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LuaJIT</a> , lingkungan runtime untuk Lua 5.1, yang mencakup kompiler JIT tracing (kami menggunakan garpu kami sendiri, yang sudah kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tulis sebelumnya</a> ).  Karena kami menulis logika bisnis untuk sistem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RTB</a> , kecepatan sangat penting bagi kami: dalam RTB, rata-rata, ada 120 milidetik untuk memproses setiap permintaan yang masuk.  Pada saat yang sama, hanya 10-15 milidetik yang dialokasikan untuk eksekusi kode, dan sisanya menunggu tanggapan dari layanan lain.  Jika, misalnya, pengguna bahkan tidak melihat penundaan setengah detik saat memuat situs di jaringan, maka untuk RTB 500 milidetik ini adalah periode waktu yang sangat lama.  Jawaban atas pertanyaan seberapa cepat bahasa Lua adalah: cukup cepat sehingga kita dapat menulis logika bisnis di atasnya selama bertahun-tahun dan tetap berada dalam bisnis RTB.  Jika bahasa yang kami pilih tidak cukup cepat, kami tidak akan memiliki siapa pun untuk menulis platform.  Apakah ini berarti bahwa RTB tidak dapat ditulis dalam bahasa lain?  Bukan berarti.  Tetapi kami menulis RTB di Lua dan berhasil mengatasi tugas bisnis kami dan klien.  Contoh yang baik dari kecepatan Lua di server adalah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tolok ukur</a> OpenResty ini. <br><br>  Lua sebagai bahasa yang disematkan memiliki banyak keunggulan: bahasa ini minimalis, kompak, dengan perpustakaan standar yang sangat kecil.  Fungsinya sepenuhnya digandakan dalam C, yang menyediakan interaksi yang mudah dan "mulus" antara Lua dan C. Lua memiliki ambang masuk yang agak rendah dibandingkan dengan banyak bahasa lain: sebagian besar programmer yang datang untuk bekerja di IPONWEB belum pernah menulis ke Lua sebelumnya, tetapi mereka memiliki cukup beberapa hari untuk sepenuhnya terlibat dalam pekerjaan. <br><br>  Berikut adalah contoh sederhana penargetan pemirsa iklan. <br><br><pre><code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">-- deal: ,  ,      --     ( ,    ..) -- imp:   (impression opportunity),  --       local function can_be_shown(deal, imp) local targeting = deal.targeting --    if not targeting then return true end --         -- (,    ,   ): if targeting.media_type then if not passes_targeting(targeting.media_type, imp.details.media_type) then return false end end --        : if targeting.size then if not passes_targeting(targeting.size, imp.details.sizes) then return false end end return true end</span></span></code> </pre> <br>  Dan ini adalah bagaimana penangan sederhana (event handler) terlihat seperti. <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> adm_cache = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> <span class="hljs-string"><span class="hljs-string">'modules.adm_cache'</span></span> <span class="hljs-comment"><span class="hljs-comment">-- adm = "ad markup" local config = require 'modules.config' local util = require 'modules.util' local AbstractHandler = require 'handlers.abstract' local ImpRenderHandler = AbstractHandler:new({is_server_request = false}) local IMP_RENDER_TEMPLATE = config.get('imp_render_template') local IMP_RENDER_BILLING = {name = 'free', type = 'in'} --   ,  . --   ( ,   ) . --          . function ImpRenderHandler:handle(params) local user_id = self.uuid local cache_id = get_param('id') if not cache_id or cache_id == '' then return self:process_bad_request({reason = '"id" parameter is expected', user_id = user_id}) end local adm = adm_cache.get(cache_id) if not adm then return self:process_bad_request({reason = 'No adm in cache', user_id = user_id}) end update_billing(IMP_RENDER_BILLING) self:log_request('imp_render', {adm = adm, user_id = user_id, cache_id = cache_id}) local content = util.expand_macro(IMP_RENDER_TEMPLATE, {ADM = adm}) return {200, content = content} end return ImpRenderHandler</span></span></code> </pre> <br>  Kesederhanaan Lua tidak hanya memberikan perkembangan yang cepat, tetapi juga memungkinkan Anda melakukan banyak pekerjaan dengan sedikit usaha.  Platform IPONWEB adalah solusi umum yang disesuaikan dengan kebutuhan klien tertentu, sementara satu pengembang dan satu manajer dapat melakukan proyek.  Baca kode pada Lua tidak hanya untuk pengembang itu sendiri, tetapi juga manajer proyek, dan kadang-kadang pelanggan.  Bersama-sama, kami dengan cepat menemukan masalah, menemukan penyebab dan solusinya.  Seringkali, manajer proyek memberi tahu pengembang tentang masalah dan segera menyarankan cara untuk menyelesaikannya. <br><br>  Pada saat yang sama, kesederhanaan Lua bisa menipu, sementara minimalis dan kekompakan memiliki kelemahan.  Jika kode ini ditulis, misalnya, dalam Perl atau Python, pengembang dapat menggunakan repositori besar modul siap pakai, Ruby memiliki RubyGems, dan banyak bahasa lain memiliki repositori yang kaya.  Dan Lua memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">LuaRocks</a> dan tiga ribu modul yang ada di sana.  Selain itu, bahkan jika LuaRocks memiliki modul yang tepat, sangat mungkin bahwa Anda harus bekerja keras untuk menggunakannya di perusahaan tertentu.  Lua menyediakan alat yang baik untuk menciptakan lingkungan yang aman untuk mengeksekusi kode (kotak pasir), dan ketika bekerja di kotak pasir, beberapa fungsi dapat dinonaktifkan.  Ini berarti bahwa modul LuaRocks mungkin tidak berfungsi jika mereka menggunakan fungsi yang diblokir oleh lingkungan aman perusahaan.  Ini adalah harga kekompakan dan kemampuan embeddability, tetapi sepadan dengan harganya - bahasa dengan baterai, seperti, misalnya, Python, dibuat tidak lebih rumit daripada Lua. <br><br><h3>  Bagaimana cara kerjanya? </h3><br>  Dasar dari platform kami adalah server HTTP yang dapat disesuaikan dengan API yang nyaman dan dapat dikembangkan yang menyediakan serangkaian fungsi untuk pengembang Lua dan dirancang untuk tugas-tugas pasar periklanan.  Server ini memproses ratusan juta permintaan dan menulis terabyte log per hari.  Permintaan yang masuk didistribusikan secara merata di seluruh utas sistem, dan di dalam utas sistem terdapat kotak pasir. <br><br><img src="https://habrastorage.org/webt/ee/bx/sn/eebxsntveokgzzaz2ffyplaconc.png" alt="gambar"><br><br>  Ketika permintaan tiba di server, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">coroutine</a> dibuat di dalam kotak pasir di mana permintaan ini jatuh, yang memproses permintaan.  Coroutine bekerja secara independen satu sama lain, masing-masing coroutine yang dibuat di antri untuk dieksekusi.  Masa pakai setiap coroutine (total waktu pemrosesan permintaan, dengan mempertimbangkan respons yang diharapkan dari layanan yang terlibat: database, metrik, server anggaran) tidak boleh melebihi 120 milidetik. <br><br><img src="https://habrastorage.org/webt/cz/sk/d3/czskd3si2n2k2mott6inf7f9qtk.png"><br><br>  Singkatnya, proses pemrosesan permintaan dapat dijelaskan sebagai berikut: <br><br><ol><li>  Setiap permintaan yang diterima diuraikan dan melewati pemeriksaan standar untuk kebenaran. </li><li>  Corutin diluncurkan, yang bertanggung jawab untuk memproses permintaan ini.  Di dalam setiap kotak pasir, ada banyak coroutine dalam status yang berbeda. </li><li>  Proses permintaan dimulai, yang dapat memiliki dua hasil: <br><ul><li>  Pemrosesan selesai dengan sukses. </li><li>  Corutin mentransfer kontrol ke server.  Ini biasanya terjadi ketika coroutine sedang menunggu tanggapan dari layanan lain.  Dalam kasus-kasus seperti itu, pekerjaan korutin ditunda sampai suatu tanggapan tiba atau waktu tunggu berakhir.  Saat mentransfer kontrol, server mulai memproses permintaan berikutnya.  Ini bisa berupa permintaan baru atau permintaan yang menerima respons dari semua layanan yang terlibat dan siap untuk melanjutkan mengeksekusi kode.  Urutan permintaan pemrosesan ditentukan oleh persyaratan logika bisnis. </li></ul></li></ol><br><img src="https://habrastorage.org/webt/bp/jv/gg/bpjvgg7pkb_394aojxgg2ykskqg.png"><br>  Penggunaan corutin adalah topik menarik lainnya yang perlu dibahas secara terperinci.  Sebagai contoh, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel ini</a> merinci bagaimana corutins dapat digunakan untuk membuat cutscene di video game.  Dan coroutine di server aplikasi harus menyediakan artikel terpisah, dan mungkin di masa depan kita akan melakukannya. <br><br><h3>  Apa selanjutnya </h3><br>  Dan kemudian, mungkin, penggunaan Lua di IPONWEB akan diperluas.  Kami memiliki ide tentang bagaimana Anda masih dapat menggunakan Lua dalam bisnis kami, dan ketika ide-ide ini diterapkan, kami pasti akan berbagi pengalaman baru.  Kenyamanan dan kemampuan Lua sebagai bahasa skrip tertanam dapat membantu kami, khususnya, mempercepat pemrosesan data klien.  Tetapi ini masih dari bidang rencana dan prospek. <br><br>  Kesimpulannya, kita dapat mengatakan bahwa pilihan kita terhadap bahasa logika bisnis, yang dibuat 11 tahun yang lalu, terus membenarkan dirinya sendiri, memungkinkan kita untuk berhasil mengatasi tugas bisnis kita sendiri dan membantu kita dalam memecahkan masalah pelanggan kita.  Mudah dibaca, mudah diintegrasikan, cepat dan mudah dipelajari, Lua telah dan tetap menjadi salah satu bahasa scripting terbaik, yang ruang lingkupnya tidak terbatas pada pengembangan game.  Logika bisnis IPONWEB yang tertulis di atasnya hanyalah salah satu contohnya. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id469049/">https://habr.com/ru/post/id469049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id469037/index.html">Pengontrol industri. Sistem pengumpulan data. ACS</a></li>
<li><a href="../id469039/index.html">Lebih dari sekedar permainan: Menguasai Mahjong dengan AI dan pembelajaran mesin</a></li>
<li><a href="../id469041/index.html">Bagaimana cara melindungi sistem ERP Anda?</a></li>
<li><a href="../id469043/index.html">C / C ++ dari Python (C API)</a></li>
<li><a href="../id469045/index.html">Python dalam Visual Studio Code - Rilis September 2019</a></li>
<li><a href="../id469051/index.html">Konektor Azure Cloud Shell di Terminal Windows</a></li>
<li><a href="../id469053/index.html">Serial video baru untuk pemula yang belajar pemrograman Python</a></li>
<li><a href="../id469059/index.html">Apa yang baru di ML.NET dan Model Builder</a></li>
<li><a href="../id469061/index.html">Rilis Rust 1.38.0: kompilasi pipelined, # [usang] untuk makro dan std :: any :: type_name</a></li>
<li><a href="../id469071/index.html">Inteligensi Buatan Microsoft menguasai mahjong</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>