<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óæÔ∏è üéí üóÉÔ∏è Brille toujours, brille partout. Partie 2 üîã üò® ü•ó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La version actuelle de la carte du module processeur
 
 La deuxi√®me partie du mat√©riel sur le syst√®me de contr√¥le d'√©clairage de v√©lo fait maison est ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Brille toujours, brille partout. Partie 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/381907/"><img src="https://habrastorage.org/files/5e2/2b5/dd1/5e22b5dd1e73455c8c72089c9fbcc16c.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La version actuelle de la carte du module processeur</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
La deuxi√®me partie du mat√©riel sur le syst√®me de contr√¥le d'√©clairage de v√©lo fait maison est arriv√©e. </font><font style="vertical-align: inherit;">Permettez-moi de vous rappeler que j'ai d√©cid√© de construire un r√©seau RS-485, dans lequel il y a des dispositifs de contr√¥le et de direction, et le ma√Ætre est un ordinateur sur lequel le programme qui impl√©mente la logique s'ex√©cute. </font><font style="vertical-align: inherit;">Avant de passer √† la description de la logique du syst√®me, je parlerai des am√©liorations et des changements de paradigme en termes de mat√©riel qui ont r√©sult√© de la discussion et des tests de prototypes de la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">premi√®re partie</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<a name="habracut"></a><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dopilirovanie</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Premi√®rement, il a √©t√© d√©cid√© de rendre les glandes modulaires, par analogie avec Arduino et un certain nombre d'autres projets. J'ai pens√© que mon module principal (processeur) contient plus de composants que de modules fonctionnels, donc ce sera la m√®re. Et des "boucliers" y seront ins√©r√©s. En termes de circuits, les modifications suivantes ont √©t√© apport√©es: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Un stabilisateur de puissance (AMS1117-5.0) a √©t√© ajout√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Le c√¢blage d'alimentation du microcontr√¥leur est modifi√©. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) La carte du module principal est divorc√©e en tenant compte de la fabrication industrielle, mais la deuxi√®me couche de cuivre est utilis√©e au minimum - vous pouvez fabriquer une carte monocouche √† la maison et installer des cavaliers. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Ajout d'un cavalier Endpoint pour terminer la ligne sur le dernier appareil.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Ajout d'un cavalier de verrouillage RST pour bloquer la r√©initialisation du microcontr√¥leur. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) De mani√®re similaire √† l'article 3, les cartes filles de l'encodeur et le pilote de bande LED sont divorc√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) J'attends la premi√®re commande d'essai de circuits imprim√©s, alors que seuls les modules principaux (ITEAD Studio). </font></font><br>
<br>
<img src="https://habrastorage.org/files/8b3/d44/5ba/8b3d445ba6f64dc88013d76349ace4b0.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La carte fille du pilote de bande LED </font></font></i><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vanity autour de RS-485</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Maintenant, je me tourne vers le ma√Ætre du r√©seau. En termes de fer, tout y est simple - enfin, du moins je le pensais. J'ai pris un adaptateur USB-UART, y ai connect√© une petite carte avec MAX485 et plusieurs r√©sistances et j'ai commenc√© √† travailler. Et il a march√© sur un excellent r√¢teau, bien document√©, mais pour un d√©butant ce n'√©tait absolument pas √©vident.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le MAX485 doit √™tre commut√© entre la r√©ception (faible sur les broches √©pingl√©es ~ RE et DE) et la transmission (√©lev√©e). Guid√© par une logique simple, j'ai utilis√© la sortie DTR du convertisseur (sur CP2102) pour contr√¥ler le mode, en le tirant par programmation. Et j'ai eu une honte. D'une mani√®re ou d'une autre, le syst√®me ne fonctionnait qu'avec des d√©lais trop longs entre la r√©ception et la transmission. Et tout cela parce que le DTR bascule lentement. Avec quelle lenteur, je n'avais rien √† mesurer, alors je viens de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fournir un lien</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vers une √©tude de r√¢teau plus saine en utilisant un oscilloscope.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Ä partir du m√™me mat√©riau, j'ai compris ce qui suit: l'utilisation du FT232 sera la moins douloureuse, car elle a une conclusion, lorsque la puce est configur√©e par d√©faut, elle est juste con√ßue pour commuter les modes RS-485. Autrement dit, un niveau √©lev√© appara√Æt dessus lors de la transmission via UART. Ainsi, le clone chinois Arduino Nano a √©t√© extrait des bacs, ~ RST est court-circuit√© √† la masse, le fil est soud√© √† la 13e √©tape du FT232, et tout cela est connect√© au MAX485. Cela fonctionne comme une horloge. Dans la version ¬´combat¬ª du syst√®me, bien s√ªr, une telle conception ne sera pas utilis√©e - l'industrie chinoise est heureuse d'offrir des planches pr√™tes √† l'emploi similaires. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Logique syst√®me</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Enfin, √† quoi ressemble l'ensemble du processus du point de vue du ma√Ætre. Il fonctionne avec des objets de p√©riph√©rique, qui peuvent √™tre contr√¥l√©s ou ex√©cutifs. Les gestionnaires sont divis√©s en r√©els ("fer"), virtuels et temporisateurs. L'ex√©cutif ne peut √™tre que r√©el. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Des dispositifs de contr√¥le virtuels seront n√©cessaires lors de la mise en ≈ìuvre d'une gestion de syst√®me plus complexe, en particulier lorsqu'une interface Web lui sera attach√©e. Ils seront √©galement utiles pour l'int√©gration avec quelque chose que je n'ai pas encore trouv√©. Oui, ici, probablement, je dois dire qu'en g√©n√©ral un tel ¬´appareil¬ª fait partie du syst√®me.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un p√©riph√©rique est un objet de la classe Device. L'ensemble minimal d'attributs est le nom, le type et l'indicateur d'utilisation. En outre, en fonction du type, l'adresse sur le bus, le nom du p√©riph√©rique esclave, la priorit√© de contr√¥le, les valeurs initiales des registres et certains autres attributs peuvent √™tre ajout√©s. Les principales m√©thodes de la classe concernent le travail avec des appareils r√©els - c'est la lecture et l'√©criture des registres. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Et maintenant, apr√®s avoir plus ou moins d√©cid√© de la structure du programme du syst√®me, nous pouvons commencer la mise en ≈ìuvre. Actuellement, il existe les √©l√©ments suivants: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Module Comm485 contenant une description de la classe Conn. Les m√©thodes de classe sont l'ouverture et la fermeture d'une connexion, l'envoi et la r√©ception d'un paquet et la v√©rification d'une somme de contr√¥le. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) le module Device485 contient la classe Device d√©crite ci-dessus. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) le module logiciel principal. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b91/569/3db/b915693dbb1f4dbd833aa59414837274.png"><br>
<i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Carte fille codeur</font></font></i><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, deux choses sont impl√©ment√©es dans le module principal. La premi√®re consiste √† cr√©er les objets n√©cessaires de la classe Device en fonction du fichier de configuration. Le second est directement la logique du syst√®me. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans le processus</font></font></b><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Actuellement, les travaux suivants: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Compilation d'une liste des actionneurs impliqu√©s. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Pour chaque artiste, une liste des dispositifs de contr√¥le impliqu√©s est compil√©e. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Les valeurs des registres du dispositif de commande avec la priorit√© la plus √©lev√©e sont enregistr√©es dans les registres de l'actionneur et de la commande, qui ont une priorit√© inf√©rieure.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Autrement dit, supposons que nous ayons un encodeur (fer) avec une faible priorit√© et un dispositif de contr√¥le virtuel avec une priorit√© √©lev√©e. En mode veille, le p√©riph√©rique virtuel est d√©sactiv√©. Lorsque vous devez r√©gler la lumi√®re sans soulever le cinqui√®me point du canap√©, un appareil virtuel est activ√© (pendant une courte p√©riode) pour donner de nouveaux param√®tres √† l'interpr√®te et √† l'encodeur. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais tr√®s probablement, apr√®s une petite modification du logiciel, le mode principal sera le suivant: il y a deux appareils de contr√¥le avec la m√™me priorit√©. Lors de la modification des registres de l'un d'entre eux, les valeurs sont √©crites dans les registres de l'ex√©cuteur testamentaire et de l'autre gestionnaire, qui n'ont subi aucune modification. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En fait, pour l'instant. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Le projet est disponible sur github.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, dans le dossier h√¥te, vous pouvez voir un code Python effrayant. </font><font style="vertical-align: inherit;">Il y a deux modules (Comm485, Device485), le programme principal (h√¥te) et le dossier cfg dans lequel se trouvent les fichiers de configuration: √©tablir une connexion UART et une liste de p√©riph√©riques. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La suite suivra certainement. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
PS √ätre victime de la migration de Habr, dans un certain nombre de possibilit√©s est limit√©e.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr381907/">https://habr.com/ru/post/fr381907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr381897/index.html">La furia roja. Test de la carte vid√©o AMD Radeon Fury X</a></li>
<li><a href="../fr381899/index.html">Notes de cours avec des gadgets. Le chemin vers Microsoft. Partie trois</a></li>
<li><a href="../fr381901/index.html">Mise √† jour photo ITER de juillet</a></li>
<li><a href="../fr381903/index.html">¬´Union¬ª et ¬´Apollo¬ª si similaires et si diff√©rents</a></li>
<li><a href="../fr381905/index.html">Un nouveau dispositif pour les neurochirurgiens aide √† naviguer dans le corps humain avec la r√©alit√© augment√©e</a></li>
<li><a href="../fr381909/index.html">Comment faire une maison intelligente d'une vieille maison</a></li>
<li><a href="../fr381911/index.html">Comment fonctionne la plus grande usine de disques vinyle?</a></li>
<li><a href="../fr381913/index.html">Les partisans des th√©ories du complot ont d√©j√† annonc√© une fausse exp√©dition √† Pluton</a></li>
<li><a href="../fr381915/index.html">Si vous avez appel√© Baidu √† votre malheur</a></li>
<li><a href="../fr381917/index.html">Culturisme pour un pigiste</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>