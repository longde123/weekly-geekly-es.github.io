<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฒ๐ฝ ๐ฐ๐ฝ ๐ฅ ุฃููุงู PostgreSQL: 2. ุฃููุงู ุงูุณูุณูุฉ ๐ค๐พ ๐ โคต๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุขุฎุฑ ูุฑุฉ ุ ุชุญุฏุซูุง ุนู ุชุฃููู ูุณุชูู ุงููุงุฆู ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ุนู ุชุฃููู ุงูุนูุงูุงุช. ุงูููู ุณูู ูุฑู ููู ูุชู ุชุฑุชูุจ ุฃููุงู ุงูุตู ูู PostgreSQL ูููู ูุชู ุงุณุชุฎุฏุงููุง ุฌ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุฃููุงู PostgreSQL: 2. ุฃููุงู ุงูุณูุณูุฉ</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/463819/" style=";text-align:right;direction:rtl">  ุขุฎุฑ ูุฑุฉ ุ ุชุญุฏุซูุง ุนู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุฃููู ูุณุชูู ุงููุงุฆู</a> ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ุนู ุชุฃููู ุงูุนูุงูุงุช.  ุงูููู ุณูู ูุฑู ููู ูุชู ุชุฑุชูุจ ุฃููุงู ุงูุตู ูู PostgreSQL ูููู ูุชู ุงุณุชุฎุฏุงููุง ุฌูุจุง ุฅูู ุฌูุจ ูุน ููู ุงููุงุฆูุงุช ุ ุฏุนููุง ูุชุญุฏุซ ุนู ุทูุงุจูุฑ ุงูุงูุชุธุงุฑ ูุฃููุฆู ุงูุฐูู ูุฎุฑุฌูู ูู ุงูุฏูุฑุงู. <br><br><img src="https://habrastorage.org/webt/6x/u5/jj/6xu5jj3edymfhel21v9obwhsxai.png"><br><br><h1 style=";text-align:right;direction:rtl">  ุฃููุงู ุงูุตู </h1><br><h2 style=";text-align:right;direction:rtl">  ุฌูุงุฒ </h2><br>  ุงุณูุญูุง ูู ุฃู ุฃุฐูุฑู ุจุงูุนุฏูุฏ ูู ุงูุงุณุชูุชุงุฌุงุช ุงููููุฉ ูู ุงูููุงู ุงูุฃุฎูุฑ. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ููุฌุฏ ููู ูู ููุงู ูุง ูู ุฐุงูุฑุฉ ุงูุฎุงุฏู ุงููุดุชุฑูุฉ. </li><li style=";text-align:right;direction:rtl">  ูููุง ุฒุงุฏุช ุฏูุฉ ุงูุฃููุงู ุ ูู ุงูุชูุงูุณ (ุงูุชูุงูุณ) ุจูู ุงูุนูููุงุช ุงูุฌุงุฑูุฉ ูู ููุช ูุงุญุฏ. </li><li style=";text-align:right;direction:rtl">  ูู ูุงุญูุฉ ุฃุฎุฑู ุ ูููุง ุฒุงุฏุช ุฏุฑุฌุฉ ุงูุชูุงุตูู ุ ุฒุงุฏุช ูุณุงุญุฉ ุงูุฐุงูุฑุฉ ุงูุชู ุชุดุบููุง ุงูุฃููุงู. </li></ul><br>  ูุญู ุจุงูุชุฃููุฏ ูุฑูุฏ ุชุบููุฑ ุตู ูุงุญุฏ ูููุน ุงูุตููู ุงูุฃุฎุฑู ูู ููุณ ุงูุฌุฏูู.  ููู ูุง ูููููุง ุฃู ูุจุฏุฃ ูู ูู ุณุทุฑ ุจููููุง ุงูุฎุงุต. <br><br>  ููุงู ุทุฑู ูุฎุชููุฉ ูุญู ูุฐู ุงููุดููุฉ.  ูู ุจุนุถ ูุธู ุฅุฏุงุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช ุ ููุงู ุฒูุงุฏุฉ ูู ูุณุชูู ุงูุฃููุงู: ุฅุฐุง ูุงู ููุงู ุนุฏุฏ ูุจูุฑ ุฌุฏูุง ูู ุฃููุงู ูุณุชูู ุงูุตู ุ ููุชู ุงุณุชุจุฏุงููุง ุจููู ุนุงู ูุงุญุฏ (ุนูู ุณุจูู ุงููุซุงู ุ ูุณุชูู ุงูุตูุญุฉ ุฃู ุงูุฌุฏูู ุจุฃูููู). <br><br>  ููุง ุณูุฑู ูุงุญููุง ุ ูุณุชุฎุฏู PostgreSQL ุฃูุถูุง ูุฐู ุงูุขููุฉ ุ ูููู ููุท ููุฃููุงู ุงูุฃุตููุฉ.  ุฃููุงู ุงูุฎุท ูุฎุชููุฉ. <br><a name="habracut"></a><br>  ูู PostgreSQL ุ ูุชู ุชุฎุฒูู ุงููุนูููุงุช ุงูุชู ูุชู ุชุฃููููุง ูู ุตู ููุท ูุญุตุฑููุง ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุตุฏุงุฑ ุงูุตู</a> ุฏุงุฎู ุตูุญุฉ ุงูุจูุงูุงุช (ูููุณ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู).  ููุฐุง ูุนูู ุฃู ูุฐู ููุณุช ูุชูุฉ ุนูู ุงูุฅุทูุงู ุจุงููุนูู ุงููุนุชุงุฏ ุ ูููู ูุฌุฑุฏ ุนูุงูุฉ.  ูุฐู ุงูุนูุงูุฉ ูู ูู ุงููุงูุน ุฑูู ูุนุงููุฉ xmax ุจุงูุงูุชุฑุงู ูุน ุจุชุงุช ูุนูููุงุช ุฅุถุงููุฉ ุ  ุจุนุฏ ูููู ุณูุฑู ุจุงูุชูุตูู ููู ูุนูู ูุฐุง. <br><br>  <strong>ุงูุฅูุฌุงุจูุงุช</strong> ูู ุฃูู ูููููุง ุญุธุฑ ุงูุนุฏูุฏ ูู ุงูุฃุณุทุฑ ุงูุชู ูุฑุบุจ ุฏูู ุงุณุชููุงู ุฃู ููุงุฑุฏ. <br><br>  ูููู ููุงู <strong>ูุงูุตูุง</strong> : ูุธุฑูุง ูุนุฏู ุชูุฏูู ูุนูููุงุช ุญูู ุงูููู ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุ ูุฅู ุงูุนูููุงุช ุงูุฃุฎุฑู ูุง ูููู ุฃู ุชุชูุงุดู.  ูููุณ ููุงู ุฅููุงููุฉ ูุฑุงูุจุฉ (ูุญุณุงุจ ุงูุฃููุงู ุ ุชุญุชุงุฌ ุฅูู ูุฑุงุกุฉ ุงูุฌุฏูู ุจุฃูููู). <br><br>  ุญุณููุง ุ ุงููุฑุงูุจุฉ ุฌูุฏุฉ ุ ููู ูุฌุจ ุงูููุงู ุจุดูุก ูุง ูุน ูุงุฆูุฉ ุงูุงูุชุธุงุฑ.  ููููุงู ุจุฐูู ุ ูุง ูุฒุงู ูุชุนูู ุนููู ุงุณุชุฎุฏุงู ุงูุฃููุงู "ุงูุนุงุฏูุฉ".  ุฅุฐุง ููุง ุจุญุงุฌุฉ ุฅูู ุงูุงูุชุธุงุฑ ุญุชู ูุชู ุฅุตุฏุงุฑ ุงูุตู ุ ูู ุงููุงูุน ุ ูุฌุจ ุนูููุง ุงูุงูุชุธุงุฑ ุญุชู ููุงูุฉ ูุนุงููุฉ ุงูุญุธุฑ - ูุชู ุชุญุฑูุฑ ุฌููุน ุงูุฃููุงู ุนูุฏ ุงุฑุชูุงุจูุง ุฃู ุฅุฑุฌุงุนูุง.  ูููุฐุง ุงูุบุฑุถ ุ ููููู ุทูุจ ุฑูู ุญุธุฑ ููุนุงููุฉ ุงูุญุธุฑ (ุนูู ูุง ุฃุฐูุฑ ุ ูุชู ุงูุงุญุชูุงุธ ุจูุง ุจูุงุณุทุฉ ุงููุนุงููุฉ ูู ูุถุน ุงุณุชุซูุงุฆู).  ูุจุงูุชุงูู ุ ูุฅู ุนุฏุฏ ุงูุฃููุงู ุงููุณุชุฎุฏูุฉ ูุชูุงุณุจ ูุน ุนุฏุฏ ุงูุนูููุงุช ููุฏ ุงูุชุดุบูู ูู ููุช ูุงุญุฏ ุ ูููุณ ูุน ุนุฏุฏ ุงูุตููู ุงูุชู ูุชู ุชุบููุฑูุง. <br><br><h2 style=";text-align:right;direction:rtl">  ุฃูุถุงุน ุงุณุชุซูุงุฆูุฉ </h2><br>  ูู ุงููุฌููุน ููุงู 4 ุทุฑู ููููู ูู ุฎูุงููุง ููู ุงูุฎุท.  ูู ุจูู ูุฐูู ุงููุถุนูู ุ ููุซู ูุถุนุงู ุงูุฃููุงู <em>ุงูุญุตุฑูุฉ</em> ุงูุชู ูููู ุฃู ุชุนูุฏูุง ูุนุงููุฉ ูุงุญุฏุฉ ูู ููุช ูุงุญุฏ. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุถุน UPDATE ููุทูู ุนูู ุชุบููุฑ ูุงูู (ุฃู ุญุฐู) ูู ุตู. </li><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ุฅูู ูุถุน ุนุฏู ุชุญุฏูุซ ููุชุงุญ - ุชุบููุฑ ููุท ุชูู ุงูุญููู ุงูุชู ูู ูุชู ุชุถููููุง ูู ููุงุฑุณ ูุฑูุฏุฉ (ุจูุนูู ุขุฎุฑ ุ ูุน ูุซู ูุฐุง ุงูุชุบููุฑ ุ ุชุธู ุฌููุน ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ ุจุฏูู ุชุบููุฑ). </li></ul><br>  ูุญุฏุฏ ุงูุฃูุฑ UPDATE ููุณู ูุถุน ุงูููู ุงูููุงุณุจ ุงูุฃุฏูู ุ  ุนุงุฏุฉู ูุชู ุชุฃููู ุงูุตููู ูู ูุถุน "ุนุฏู ุชุญุฏูุซ ููุชุงุญ". <br><br>  ููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุชุฐูุฑ</a> ุ ุนูุฏ ุญุฐู ุณุทุฑ ุฃู ุชุบููุฑู ุ ุชุชู ูุชุงุจุฉ ุฑูู ุฅุตุฏุงุฑ ุงููุนุงููุฉ ุงูุญุงูู ูู ุญูู xmax ูู ุงูุฅุตุฏุงุฑ ุงูุญุงูู ุงูุญุงูู.  ููุถุญ ุฃู ุฅุตุฏุงุฑ ุงูุตู ูุฏ ุชู ุญุฐูู ุจูุงุณุทุฉ ูุฐู ุงููุนุงููุฉ.  ูุฐูู ุ ูุชู ุงุณุชุฎุฏุงู ููุณ ุฑูู xmax ูุฏููู ุนูู ุงูุญุธุฑ.  ูู ุงููุงูุน ุ ุฅุฐุง ูุงูุช xmax ูู ุฅุตุฏุงุฑ ุงูุตู ุชุชูุงูู ูุน ูุนุงููุฉ ูุดุทุฉ (ูู ุชูุชูู ุจุนุฏ) ููุฑูุฏ ุชุญุฏูุซ ูุฐุง ุงูุตู ุงููุนูู ุ ููุฌุจ ุฃู ููุชุธุฑ ุญุชู ุชูุชูู ุงููุนุงููุฉ ุ ูุฐูู ููุณุช ููุงู ุญุงุฌุฉ ุฅูู ุนูุงูุฉ ุฅุถุงููุฉ. <br><br>  ููุฑู.  ูู ุจุฅูุดุงุก ุฌุฏูู ุญุณุงุจุงุช ุ ููุง ูู ุงูููุงูุฉ ุงูุณุงุจูุฉ. <br><br><pre style=";text-align:right;direction:rtl"><code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> accounts( acc_no <span class="hljs-type"><span class="hljs-type">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRIMARY KEY</span></span>, amount <span class="hljs-type"><span class="hljs-type">numeric</span></span> ); =&gt; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">200.00</span></span>), (<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">300.00</span></span>);</code> </pre> <br>  ูุฅููุงุก ูุธุฑุฉ ุนูู ุงูุตูุญุงุช ุ ุจุงูุทุจุน ุ ูุญู ุจุญุงุฌุฉ ุฅูู ููุญู pageinspect ุงููุฃููู ุจุงููุนู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTENSION</span></span> pageinspect;</code> </pre><br>  ููุฑุงุญุฉ ุ ูู ุจุฅูุดุงุก ุทุฑููุฉ ุนุฑุถ ุชูุธูุฑ ููุท ุงููุนูููุงุช ุงูุชู ููุชู ุจูุง: xmax ูุจุนุถ ูุญุฏุงุช ุงูุจุช ูู ุงููุนูููุงุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> accounts_v <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-string"><span class="hljs-string">'(0,'</span></span>||lp||<span class="hljs-string"><span class="hljs-string">')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ctid, t_xmax <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> xmax, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">128</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'t'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> lock_only, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">4096</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'t'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> is_multi, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (t_infomask2 &amp; <span class="hljs-number"><span class="hljs-number">8192</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'t'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> keys_upd, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">16</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'t'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> keyshr_lock, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> (t_infomask &amp; <span class="hljs-number"><span class="hljs-number">16</span></span>+<span class="hljs-number"><span class="hljs-number">64</span></span>) = <span class="hljs-number"><span class="hljs-number">16</span></span>+<span class="hljs-number"><span class="hljs-number">64</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">'t'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> shr_lock <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> heap_page_items(get_raw_page(<span class="hljs-string"><span class="hljs-string">'accounts'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> lp;</code> </pre><br>  ูุฐูู ุ ูุจุฏุฃ ุงููุนุงููุฉ ููุญุฏูุซ ูุจูุบ ุงูุญุณุงุจ ุงูุฃูู (ูุง ูุชุบูุฑ ุงูููุชุงุญ) ูุฑูู ุงูุญุณุงุจ ุงูุซุงูู (ูุชุบูุฑ ุงูููุชุงุญ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br>  ูุญู ููุธุฑ ุฅูู ุงูุฑุฃู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts_v <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | xmax | lock_only | is_multi | keys_upd | keyshr_lock | shr_lock -------+--------+-----------+----------+----------+-------------+---------- (0,1) | 530492 | | | | | (0,2) | 530492 | | | t | | (2 rows)</code> </pre><br>  ูุชู ุชุญุฏูุฏ ูุถุน ุงูููู ุจูุงุณุทุฉ ุจุช ุงููุนูููุงุช key_updated. <br><br>  ูุชู ุงุณุชุฎุฏุงู ููุณ ุญูู xmax ุฃูุถูุง ุนูุฏ ููู ุตู ุจุฃูุฑ SELECT FOR UPDATE ุ ูููู ูู ูุฐู ุงูุญุงูุฉ ุ ูุชู ูุถุน ุจุช ูุนูููุงุช ุฅุถุงููุฉ (xmax_lock_only) ุ ููุง ูุดูุฑ ุฅูู ุฃู ุฅุตุฏุงุฑ ุงูุตู ูููู ููุท ุ ูููู ูุง ูุชู ุญุฐูู ููุง ูุฒุงู ุตุงูุญูุง. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR NO KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts_v <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | xmax | lock_only | is_multi | keys_upd | keyshr_lock | shr_lock -------+--------+-----------+----------+----------+-------------+---------- (0,1) | 530493 | t | | | | (0,2) | 530493 | t | | t | | (2 rows)</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>;</code> </pre><br><br><h2 style=";text-align:right;direction:rtl">  ุฃูุถุงุน ูุดุชุฑูุฉ </h2><br>  ููุซู ูุถุนุงู ุขุฎุฑุงู ุงูุฃููุงู ุงููุดุชุฑูุฉ ุงูุชู ูููู ุฃู ุชุนูุฏูุง ุนุฏุฉ ูุนุงููุงุช. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฎุฏุงู ูุถุน SHARE ุนูุฏูุง ุชุญุชุงุฌ ุฅูู ูุฑุงุกุฉ ุณูุณูุฉ ุ ูููู ูุฌุจ ุฃูุง ุชุณูุญ ุจุชุบููุฑูุง ุจุฃู ุทุฑููุฉ ุจูุงุณุทุฉ ูุนุงููุฉ ุฃุฎุฑู. </li><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุถุน SHARE KEY ูุณูุญ ุจุชุบููุฑ ุงูุณูุณูุฉ ุ ูููู ููุท ุงูุญููู ุบูุฑ ุงูุฑุฆูุณูุฉ.  ูุฐุง ุงููุถุน ุ ุนูู ูุฌู ุงูุฎุตูุต ุ ูุชู ุงุณุชุฎุฏุงูู ุชููุงุฆููุง ุจูุงุณุทุฉ PostgreSQL ุนูุฏ ุงูุชุญูู ูู ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ. </li></ul><br>  ููุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR KEY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SHARE</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SHARE</span></span>;</code> </pre><br>  ูู ุฅุตุฏุงุฑุงุช ุงูุตู ูุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts_v <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | xmax | lock_only | is_multi | keys_upd | keyshr_lock | shr_lock -------+--------+-----------+----------+----------+-------------+---------- (0,1) | 530494 | t | | | t | (0,2) | 530494 | t | | | t | t (2 rows)</code> </pre><br>  ูู ููุชุง ุงูุญุงูุชูู ุ ูุชู ุชุนููู ุจุช keyshr_lock ุ ููููู ุงูุชุนุฑู ุนูู ูุถุน SHARE ูู ุฎูุงู ุงููุธุฑ ูู ูุงุญุฏ ุจุช ูุฒูุฏ ูู ุงููุนูููุงุช. <br><br>  ุฅููู ูุง ุชุจุฏู ุนููู ูุตูููุฉ ุชูุงูู ุงููุถุน ุงูุนุงู. <br><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><th>  ูุธุงู ุงูุญูู </th><th>  ููุณูู ุงูุฑุฆูุณู </th><th>  ููุณูู </th><th>  ูุง ููุฌุฏ ุชุญุฏูุซ ุฑุฆูุณู </th><th>  ููุชุญุฏูุซ </th></tr><tr><td>  ููุณูู ุงูุฑุฆูุณู </td><td></td><td></td><td></td><td>  X </td></tr><tr><td>  ููุณูู </td><td></td><td></td><td>  X </td><td>  X </td></tr><tr><td>  ูุง ููุฌุฏ ุชุญุฏูุซ ุฑุฆูุณู </td><td></td><td>  X </td><td>  X </td><td>  X </td></tr><tr><td>  ููุชุญุฏูุซ </td><td>  X </td><td>  X </td><td>  X </td><td>  X </td></tr></tbody></table></div><br>  ุฅูู ูุจูู ุฃู: <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฃูุถุงุน ุงุณุชุซูุงุฆูุฉ ุชุชุนุงุฑุถ ูุน ุจุนุถูุง ุงูุจุนุถ ุ </li><li style=";text-align:right;direction:rtl">  ุฃูุถุงุน ูุดุชุฑูุฉ ูุชูุงููุฉ ูุน ุจุนุถูุง ุงูุจุนุถ. </li><li style=";text-align:right;direction:rtl">  ูุชูุงูู ูุถุน FOR KEY SHARE ุงููุดุชุฑู ูุน ุงููุถุน FOR FOR KEY UPDATE ุงูุญุตุฑู (ุฃู ุ ููููู ุชุญุฏูุซ ุงูุญููู ุบูุฑ ุงูุฑุฆูุณูุฉ ูู ููุช ูุงุญุฏ ูุงูุชุฃูุฏ ูู ุฃู ุงูููุชุงุญ ูุง ูุชุบูุฑ). </li></ul><br><h2 style=";text-align:right;direction:rtl">  Multitranzaktsii </h2><br>  ุญุชู ุงูุขู ุ ููุง ูุธู ุฃู ุงูููู ููุซูู ุนุฏุฏ ุนูููุงุช ุงูุญุธุฑ ูู ุญูู xmax.  ูููู ูููู ุงูุงุญุชูุงุธ ุจุงูุฃููุงู ุงููุดุชุฑูุฉ ุจูุงุณุทุฉ ุนุฏุฉ ูุนุงููุงุช ุ ููุง ูููู ูุชุงุจุฉ ุฃุฑูุงู ูุชุนุฏุฏุฉ ูู ููุณ ุญูู xmax.  ููู ุชููู <br><br>  ุจุงููุณุจุฉ ููุฃููุงู ุงููุดุชุฑูุฉ ุ ูุชู ุงุณุชุฎุฏุงู ูุง ูุณูู ุจุงููุนุงููุงุช <em>ุงููุชุนุฏุฏุฉ</em> (MultiXact).  ูุฐู ูู ูุฌููุนุฉ ุงููุนุงููุงุช ุงูุชู ุชู ุชุนููู ุฑูู ูููุตู.  ูุฐุง ุงูุฑูู ูู ููุณ ุงูุจุนุฏ ูุฑูู ูุนุงููุฉ ุนุงุฏู ุ ูููู ูุชู ุชุฎุตูุต ุงูุฃุฑูุงู ุจุดูู ูุณุชูู (ุฃู ุ ูููู ุฃู ูุญุชูู ุงููุธุงู ุนูู ููุณ ุงููุนุงููุฉ ูุฃุฑูุงู ุงููุนุงููุงุช ุงููุชุนุฏุฏุฉ).  ูุชูููุฒ ุฃุญุฏููุง ุนู ุงูุขุฎุฑ ุ ูุชู ุงุณุชุฎุฏุงู ุจุช ูุนูููุงุช ุขุฎุฑ (xmax_is_multi) ุ ูุชูุฌุฏ ูุนูููุงุช ููุตูุฉ ุญูู ุฃุนุถุงุก ูุฐู ุงููุฌููุนุฉ ูุฃูุถุงุน ุงูููู ูู ุงููููุงุช ุงูููุฌูุฏุฉ ูู ุงูุฏููู $ PGDATA / pg_multixact /.  ุจุทุจูุนุฉ ุงูุญุงู ุ ูุชู ุชุฎุฒูู ุงูุจูุงูุงุช ุงูุฃุฎูุฑุฉ ุงููุณุชุฎุฏูุฉ ูู ุงููุฎุงุฒู ุงููุคูุชุฉ ูู ุงูุฐุงูุฑุฉ ุงููุดุชุฑูุฉ ููุฎุงุฏู ูููุตูู ุจุดูู ุฃุณุฑุน. <br><br>  ุฃุถู ุฅูู ุงูุฃููุงู ุงูุญุงููุฉ ูุงุญุฏุฉ ุงุณุชุซูุงุฆูุฉ ุฃุฎุฑู ุชููุฐูุง ูุนุงููุฉ ุฃุฎุฑู (ูููููุง ุงูููุงู ุจุฐูู ุ ูุฃู ุฃูุถุงุน FOR KEY SHARE ู FOR NO KEY UPDATE ูุชูุงููุฉ ูุน ุจุนุถูุง ุงูุจุนุถ): <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; | =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts_v <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> ctid | xmax | lock_only | is_multi | keys_upd | keyshr_lock | shr_lock -------+--------+-----------+----------+----------+-------------+---------- (0,1) | 61 | | t | | | (0,2) | 530494 | t | | | t | t (2 rows)</code> </pre><br>  ูู ุงูุณุทุฑ ุงูุฃูู ุ ูุฑู ุฃู ุงูุฑูู ุงููุนุชุงุฏ ูุฏ ุชู ุงุณุชุจุฏุงูู ุจุฑูู ูุชุนุฏุฏ ุงูููู - ุชุชู ุงูุฅุดุงุฑุฉ ุฅูู ุฐูู ุจูุงุณุทุฉ xmax_is_multi bit. <br><br>  ูู ุฃุฌู ุนุฏู ุงูุฎูุถ ูู ุงูุฃุฌุฒุงุก ุงูุฏุงุฎููุฉ ูุชุทุจูู multitransaction ุ ููููู ุงุณุชุฎุฏุงู ููุญู ุขุฎุฑ ูุชูุญ ูู ุฑุคูุฉ ุฌููุน ุงููุนูููุงุช ุญูู ุฌููุน ุฃููุงุน ุฃููุงู ุงูุตููู ุจุทุฑููุฉ ูุฑูุญุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXTENSION</span></span> pgrowlocks; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pgrowlocks(<span class="hljs-string"><span class="hljs-string">'accounts'</span></span>) \gx</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-[ RECORD 1 ]----------------------------- locked_row | (0,1) locker | 61 multi | t xids | {530494,530495} modes | {"Key Share","No Key Update"} pids | {5892,5928} -[ RECORD 2 ]----------------------------- locked_row | (0,2) locker | 530494 multi | f xids | {530494} modes | {"For Share"} pids | {5892}</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>;</code> </pre><br><h2 style=";text-align:right;direction:rtl">  ุชุฌููุฏ ุงูุฅุนุฏุงุฏ </h2><br>  ูุธุฑูุง ูุฃูู ูุชู ุชุฎุตูุต ุฃุฑูุงู ูููุตูุฉ ููุนูููุงุช ุงููุชุนุฏุฏุฉ ุ ูุงูุชู ุชุชู ูุชุงุจุชูุง ูู ุญูู xmax ุงูุฎุงุต ุจุฅุตุฏุงุฑุงุช ุงูุตู ุ ูุธุฑูุง ููุฌูุฏ ุงูุญุฏ ุงูุฃูุตู ูุณุนุฉ ุงูุฃุฑูุงู ูู ุงูุนุฏุงุฏ ุ ูุฅููุง ุชูุงุฌู ููุณ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุดููุฉ</a> ุงูุชูุงู ููู ุงูุชุนุฑูู xid ููุง ูู ุงูุญุงู ูุน ุงูุฑูู ุงูุนุงุฏู. <br><br>  ูุฐูู ุ ุจุงููุณุจุฉ ูุฃุฑูุงู ุงููุนุงููุงุช ุงููุชุนุฏุฏุฉ ุ ูู ุงูุถุฑูุฑู ุฃูุถูุง ุฅุฌุฑุงุก ุชูุงุซู ููุชุฌููุฏ - ุงุณุชุจุฏุงู ุงูุฃุฑูุงู ุงููุฏููุฉ ุจุฃุฑูุงู ุฌุฏูุฏุฉ (ุฃู ุจุฑูู ูุนุงููุฉ ููุชุธู ุ ุฅุฐุง ูุงู ููุช ุงูุชุฌููุฏ ูุญุชูุธ ุจูุนุงููุฉ ูุงุญุฏุฉ ููุท). <br><br>  ูุงุญุธ ุฃูู ูุชู ุชูููุฐ ุชุฌููุฏ ุฃุฑูุงู ุงููุนุงููุฉ ุงูุนุงุฏูุฉ ููุท ูุญูู xmin (ูุฃูู ุฅุฐุง ูุงู ุฅุตุฏุงุฑ ุงูุณุทุฑ ูุญุชูู ุนูู ุญูู xmax ุบูุฑ ูุงุฑุบ ุ ูุณูููู ุฅูุง ุฅุตุฏุงุฑูุง ุบูุฑ ููุงุฆู ูุณูุชู ูุณุญู ุ ุฃู ูุชู ุฅูุบุงุก ูุนุงููุฉ xmax ููุง ูุฑูู ููุง ุฑูููุง).  ูููู ุจุงููุณุจุฉ ูููุนุงููุงุช ุงููุชุนุฏุฏุฉ ุ ูุฅููุง ูุชุญุฏุซ ุนู ุญูู xmax ุงูุฎุงุต ุจุงูุฅุตุฏุงุฑ ุงูุญุงูู ูู ุงูุฎุท ุ ูุงูุฐู ูููู ุฃู ูุธู ุฐุง ุตูุฉ ุ ูููู ูุชู ุญุธุฑู ุจุงุณุชูุฑุงุฑ ุจูุงุณุทุฉ ุงููุนุงููุงุช ุงููุฎุชููุฉ ูู ูุถุน ูุดุชุฑู. <br><br>  ุจุงููุณุจุฉ ูุชุฌููุฏ ุงููุนุงููุงุช ุงููุชุนุฏุฏุฉ ุ ุชููู ุงููุนููุงุช ุงููุดุงุจูุฉ ููุนููุงุช ุงูุชุฌููุฏ ุงููุนุชุงุฏุฉ <em>ูุณุคููุฉ</em> : <em>vacuum_multixact_freeze_min_age</em> ุ <em>vacuum_multixact_freeze_table_age</em> ุ <em>autov Vacuum_multixact_freeze_max_age</em> . <br><br><h1 style=";text-align:right;direction:rtl">  ูู ูู ุงููุชุทุฑูุ </h1><br>  ููุฌ ุชุฏุฑูุฌูุง ุงูุญูู.  ุฏุนููุง ูุฑู ูุง ูู ุตูุฑุฉ ุงูุฃููุงู ุนูุฏูุง ุชููู ุนุฏุฉ ูุนุงููุงุช ุจุชุญุฏูุซ ููุณ ุงูุตู. <br><br>  ููุจุฏุฃ ุจุฅูุดุงุก ููุธุฑ ุนูู pg_locks.  ุฃููุงู ุ ุณูุฌุนู ุงูุงุณุชูุชุงุฌ ุฃูุซุฑ ุฅุญูุงูุง ููููุงู ุ ูุซุงููุงู ุ ุณููุตุฑ ุฃููุณูุง ุนูู ุงูุฃููุงู ุงููุซูุฑุฉ ููุงูุชูุงู (ูู ุงููุงูุน ุ ูุญู ูุชุฌุงูู ุฃููุงู ุฃุฑูุงู ุงููุนุงููุงุช ุงูุงูุชุฑุงุถูุฉ ุ ูุงูููุฑุณ ุนูู ุฌุฏูู ุงูุญุณุงุจุงุช ุ ู pg_locks ุ ูุงูุนุฑุถ ููุณู - ุจุดูู ุนุงู ุ ูู ูุง ูู ุบูุฑ ุฐู ุตูุฉ ู ุชุดุชูุช ููุท). <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pid, locktype, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> locktype <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'relation'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> relation::<span class="hljs-type"><span class="hljs-type">regclass</span></span>::<span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'transactionid'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> transactionid::<span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-string"><span class="hljs-string">'tuple'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> relation::<span class="hljs-type"><span class="hljs-type">regclass</span></span>::<span class="hljs-type"><span class="hljs-type">text</span></span>||<span class="hljs-string"><span class="hljs-string">':'</span></span>||tuple::<span class="hljs-type"><span class="hljs-type">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> lockid, mode, granted <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_locks <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> locktype <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'relation'</span></span>,<span class="hljs-string"><span class="hljs-string">'transactionid'</span></span>,<span class="hljs-string"><span class="hljs-string">'tuple'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (locktype != <span class="hljs-string"><span class="hljs-string">'relation'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> relation = <span class="hljs-string"><span class="hljs-string">'accounts'</span></span>::<span class="hljs-type"><span class="hljs-type">regclass</span></span>);</code> </pre><br>  ุงูุขู ุงุจุฏุฃ ุงููุนุงููุฉ ุงูุฃููู ููู ุจุชุญุฏูุซ ุงูุตู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current | pg_backend_pid --------------+---------------- 530497 | 5892 (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">UPDATE 1</code> </pre><br>  ูุงุฐุง ุนู ุงูุฃููุงูุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5892</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+----------+------------------+--------- 5892 | relation | accounts | RowExclusiveLock | t 5892 | transactionid | 530497 | ExclusiveLock | t (2 rows)</code> </pre><br>  ุงูุตููุฉ ุชุญูู ุงูุฌุฏูู ูุฃููุงู ุนุฏุฏ ุงูุฎุงุตุฉ.  ุญุชู ุงูุขู ุ ูู ุดูุก ูุชููุน. <br><br>  ูุจุฏุฃ ุงููุนุงููุฉ ุงูุซุงููุฉ ููุญุงูู ุชุญุฏูุซ ููุณ ุงูุณุทุฑ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; | =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| txid_current | pg_backend_pid | --------------+---------------- | 530498 | 5928 | (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  ูุงุฐุง ุนู ุฃููุงู ุงููุนุงููุฉ ุงูุซุงููุฉุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5928</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+------------+------------------+--------- 5928 | relation | accounts | RowExclusiveLock | t 5928 | transactionid | 530498 | ExclusiveLock | t 5928 | transactionid | 530497 | ShareLock | f 5928 | tuple | accounts:1 | ExclusiveLock | t (4 rows)</code> </pre><br>  ูููุง ูู ุฃูุซุฑ ุฅุซุงุฑุฉ ููุงูุชูุงู.  ุจุงูุฅุถุงูุฉ ุฅูู ููู ุงูุฌุฏูู ูุงูุฑูู ุงูุฎุงุต ุ ูุฑู ููููู ุขุฎุฑูู.  ูุฌุฏุช ุงููุนุงููุฉ ุงูุซุงููุฉ ุฃูู ุชู ููู ุงูุตู ุฃููุงู ู "ุชุนูููู" ูู ุงูุชุธุงุฑ ุฑููู (ุงูููููุญ = f).  ูููู ูู ุฃูู ูููุงุฐุง ุฃุชู ููู ุฅุตุฏุงุฑ ุงูุณุทุฑ (locktype = tuple)ุ <br><br><blockquote style=";text-align:right;direction:rtl">  ูุง ุชุฎูุท ุจูู ููู ุฅุตุฏุงุฑ ุงูุตู (ููู ุงูุตููู) ูููู ุงูุตู (ููู ุงูุตู).  ุงูุฃูู ูู ููู ููุน tuple ููุชุธู ุ ููู ูุฑุฆู ูู pg_locks.  ูุงูุซุงูู ูู ุนูุงูุฉ ูู ุตูุญุฉ ุงูุจูุงูุงุช: xmax ูุจุชุงุช ุงููุนูููุงุช. <br></blockquote><br>  ุนูุฏูุง ุชูุดู ุฅุญุฏู ุงููุนุงููุงุช ุนูู ุชุบููุฑ ุตู ูุง ุ ูุฅููุง ุชููุฐ ุชุณูุณู ุงูุฅุฌุฑุงุกุงุช ุงูุชุงูู: <br><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุชูุท ููููุง ุญุตุฑููุง ุนูู ูุณุฎุฉ ูุงุจูุฉ ููุชุบููุฑ ูู ุงูุณูุณูุฉ (tuple). </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุฃุดุงุฑุช xmax ูุจุชุงุช ุงููุนูููุงุช ุฅูู ุฃู ุงูุฎุท ูุคูู ุ ูุณูุทูุจ ููู ุชุฃููู ุฑูู ุงููุนุงููุฉ xmax. </li><li style=";text-align:right;direction:rtl">  ูุตู xmax ูุจุชุงุช ุงููุนูููุงุช ุงูุถุฑูุฑูุฉ. </li><li style=";text-align:right;direction:rtl">  ุฅุตุฏุงุฑุงุช ููู ูุณุฎุฉ ุงูุตู. </li></ol><br>  ุนูุฏูุง ุชู ุชุญุฏูุซ ุงูุตููู ุนู ุทุฑูู ุงููุนุงููุฉ ุงูุฃููู ุ ุฃูุณู ุฃูุถูุง ุจุฅุตุฏุงุฑ ููู ุงูุตู (ุงูุฎุทูุฉ 1) ุ ูููู ุชู ุฅุตุฏุงุฑู ุนูู ุงูููุฑ (ุงูุฎุทูุฉ 4). <br><br>  ุนูุฏูุง ูุตูุช ุงููุนุงููุฉ ุงูุซุงููุฉ ุ ุฃููุช ุงููุจุถ ุนูู ููู ุฅุตุฏุงุฑ ุงูุตู (ุงูุจูุฏ 1) ุ ููููุง ุงุถุทุฑุช ุฅูู ุทูุจ ููู ุนูู ุฑูู ุงููุนุงููุฉ ุงูุฃููู (ุงูุจูุฏ 2) ูุนููุชูุง. <br><br>  ูุงุฐุง ูุญุฏุซ ุฅุฐุง ุธูุฑุช ูุนุงููุฉ ููุงุซูุฉ ุซุงูุซุฉุ  ุณุชุญุงูู ุงูุชูุงุท ููู ุฅุตุฏุงุฑ ุงูุณุทุฑ (ุงูุจูุฏ 1) ูุณุชุนูู ุจุงููุนู ูู ูุฐู ุงูุฎุทูุฉ.  ุงูุชุญูู ูู ุฐูู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">|| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; || =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">|| txid_current | pg_backend_pid || --------------+---------------- || 530499 | 5964 || (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">|| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5964</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+------------+------------------+--------- 5964 | relation | accounts | RowExclusiveLock | t 5964 | tuple | accounts:1 | ExclusiveLock | f 5964 | transactionid | 530499 | ExclusiveLock | t (3 rows)</code> </pre><br>  ุงููุนุงููุงุช ุงูุฑุงุจุนุฉ ูุงูุฎุงูุณุฉ ููุง ุฅูู ุฐูู ุ ุงูุชู ุชุฑุบุจ ูู ุชุญุฏูุซ ููุณ ุงูุตู ุ ูู ุชุฎุชูู ุจุฃู ุดูู ูู ุงูุฃุดูุงู ุนู ุงููุนุงููุฉ 3 - ุณุชุนูู ุฌููุนูุง ุนูู ููุณ ููู ุฅุตุฏุงุฑ ุงูุตู. <br><br>  ุฅุถุงูุฉ ูุนุงููุฉ ุฃุฎุฑู ุฅูู ุงููููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">||| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; ||| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">||| txid_current | pg_backend_pid ||| --------------+---------------- ||| 530500 | 6000 ||| (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">||| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount - <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">6000</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+------------+------------------+--------- 6000 | relation | accounts | RowExclusiveLock | t 6000 | transactionid | 530500 | ExclusiveLock | t 6000 | tuple | accounts:1 | ExclusiveLock | f (3 rows)</code> </pre><br>  ูููู ุฑุคูุฉ ุตูุฑุฉ ุนุงูุฉ ููุชููุนุงุช ุงูุญุงููุฉ ูู ุทุฑููุฉ ุงูุนุฑุถ pg_stat_activity ุ ูุน ุฅุถุงูุฉ ูุนูููุงุช ุญูู ุนูููุงุช ุงูุญุธุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pid, wait_event_type, wait_event, pg_blocking_pids(pid) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_activity <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> backend_type = <span class="hljs-string"><span class="hljs-string">'client backend'</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | wait_event_type | wait_event | pg_blocking_pids ------+-----------------+---------------+------------------ 5892 | | | {} 5928 | Lock | transactionid | {5892} 5964 | Lock | tuple | {5928} 6000 | Lock | tuple | {5928,5964} (4 rows)</code> </pre><br>  ุงุชุถุญ ููุนูุง ูู "ูุงุฆูุฉ ุงูุงูุชุธุงุฑ" ุ ุญูุซ ููุฌุฏ ุงูุฃูู (ุงูุดุฎุต ุงูุฐู ูุญูู ุฅุตุฏุงุฑ ููู ุงูุณูุณูุฉ) ูุฌููุน ุงูุขุฎุฑูู ุงูุฐูู ูุตุทููู ุฎูู ุงูุฃูู. <br><br>  ููุงุฐุง ูุญุชุงุฌ ุฅูู ูุซู ูุฐุง ุงูุชุตููู ุงููุชุทูุฑุ  ูููุชุฑุถ ุฃููุง ูู ูููู ูุฏููุง ููู ุฅุตุฏุงุฑ ููุณูุณูุฉ.  ุซู ุชูุชุธุฑ ุงููุนุงููุงุช ุงูุซุงููุฉ ูุงูุซุงูุซุฉ (ููุง ุฅูู ุฐูู) ุญุธุฑ ุนุฏุฏ ุงููุนุงููุฉ ุงูุฃููู.  ูู ูุญุธุฉ ุฅุชูุงู ุงูุตููุฉ ุงูุฃููู ุ ูุฎุชูู ุงูููุฑุฏ ุงููุญุธูุฑ ( <em>ููุง ุงูุฐู ุชูุนูู ููุง ุ ุฅููุ ุงูุชูุช ุงููุนุงููุฉ</em> ) ูุงูุขู ูู ูุฐุง ูุชููู ุนูู ุฃู ูู ุนูููุงุช ุงูุงูุชุธุงุฑ ุณูุชู ุฅููุงุธูุง ุฃููุงู ุจูุงุณุทุฉ ูุธุงู ุงูุชุดุบูู ุ ูุจุงูุชุงูู ุ ุณูููู ูุฏูู ููุช ูููู ุงูุฎุท.  ุณูุชู ุฅููุงุธ ุฌููุน ุงูุนูููุงุช ุงูุฃุฎุฑู ุฃูุถูุง ุ ููู ุณูุชุนูู ุนูููุง ุงูุงูุชุธุงุฑ ูุฑุฉ ุฃุฎุฑู - ุงูุขู ุจุนุฏ ุนูููุฉ ุฃุฎุฑู. <br><br>  ูุฐุง ูุญููู ุจุญูููุฉ ุฃู ุจุนุถ ุงููุนุงููุงุช ูููู ุฃู ุชูุชุธุฑ ุฅูู ุฃุฌู ุบูุฑ ูุณูู ูุฏูุฑูุง ุ ุฅุฐุง ูุงู ุฐูู ุจุณุจุจ ูุตุงุฏูุฉ ูุคุณูุฉ ููุธุฑูู ูุฅูู "ุฏุงุฆููุง" ูุฏูุฑ ุงููุนุงููุงุช ุงูุฃุฎุฑู.  ูู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ุ ูุณูู ูุฐุง ุงููููู ููู ุงูุฌูุน. <br><br>  ูู ุญุงูุชูุง ุ ุงุชุถุญ ุงูุฃูุฑ ููุณู ุ ูููู ูุง ูุฒุงู ุฃูุถู ููููุงู: ุงููุนุงููุฉ ุงููุถูููุฉ ูู ุงูุซุงููุฉ ูุถูููุฉ ุฃููุง ุณุชุชููู ูู ุงููุตูู ุฅูู ุงูููุฑุฏ ุงูุชุงูู.  ูููู ูุงุฐุง ูุญุฏุซ ููุง ููู (ุงูุซุงูุซ ูุงูุฑุงุจุน)ุ <br><br>  ุฅุฐุง ุงูุชูุช ุงููุนุงููุฉ ุงูุฃููู ุจุงูุชุฑุงุฌุน ุ ูุณูุตุจุญ ูู ุดูุก ุนูู ูุง ูุฑุงู: ุณุชุฐูุจ ุงููุนุงููุงุช ุงููุงุฑุฏุฉ ุจุงูุชุฑุชูุจ ุงูุฐู ุชู ููู ุงุตุทูุงููุง. <br><br>  ููู - ูุฐุง ุณูุก ุงูุญุธ - ุฅุฐุง ุงูุชููุช ุงููุนุงููุฉ ุงูุฃููู ุจุงูุชุฒุงู ุ ููุง ูุฎุชูู ุฑูู ุงููุนุงููุฉ ููุท ุ ูููู ุฃูุถูุง ุฅุตุฏุงุฑ ุงูุณุทุฑ!  ูุฐุง ูู ุ ุงูุฅุตุฏุงุฑ ุ ุจุงูุทุจุน ุ ูุง ูุฒุงู ูุงุฆูุงู ุ ูููู ูู ูุนุฏ ุฐุง ุตูุฉ ุ ูุณูููู ูู ุงูุถุฑูุฑู ุชุญุฏูุซ ุฅุตุฏุงุฑ ุฃุญุฏุซ ูุฎุชูู ุชูุงููุง (ูู ููุณ ุงูุณุทุฑ).  ุงูููุฑุฏ ุ ุงูุฐู ูุงู ุจุฏูุฑู ุ ูุฎุชูู ุ ููุฑุชุจ ุงูุฌููุน ุณุจุงููุง ูุญูุงุฒุฉ ููุฑุฏ ุฌุฏูุฏ. <br><br>  ุงูุณูุงุญ ูููุนุงููุฉ ุงูุฃููู ูุงููุฉ ูุน ุงูุงูุชุฒุงู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br>  ุณูุชู ุฅููุงุธ ุงููุนุงููุฉ ุงูุซุงููุฉ ูุชูููุฐ ุงูููุฑุงุช.  3 ู 4. <br><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| UPDATE 1</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5928</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+----------+------------------+--------- 5928 | relation | accounts | RowExclusiveLock | t 5928 | transactionid | 530498 | ExclusiveLock | t (2 rows)</code> </pre><br>  ูุงุฐุง ุนู ุงูุตููุฉ ุงูุซุงูุซุฉุ  ุชุชุฎุทู ุงูุฎุทูุฉ 1 (ูุฃู ุงูููุฑุฏ ูุฏ ุงุฎุชูู) ูุชุนุทูุช ูู ุงูุฎุทูุฉ 2: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5964</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+----------+------------------+--------- 5964 | relation | accounts | RowExclusiveLock | t 5964 | transactionid | 530498 | ShareLock | f 5964 | transactionid | 530499 | ExclusiveLock | t (3 rows)</code> </pre><br>  ูููุณ ุงูุดูุก ูุญุฏุซ ูุน ุงูุตููุฉ ุงูุฑุงุจุนุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">6000</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+----------+------------------+--------- 6000 | relation | accounts | RowExclusiveLock | t 6000 | transactionid | 530498 | ShareLock | f 6000 | transactionid | 530500 | ExclusiveLock | t (3 rows)</code> </pre><br>  ููุฐุง ูู ุ ูู ูู ุงููุนุงููุงุช ุงูุซุงูุซุฉ ูุงูุฑุงุจุนุฉ ุชูุชุธุฑ ุงูุงูุชูุงุก ูู ุงูุซุงููุฉ.  ุชุญูู ุงูุฎุท ุฅูู ุญุดุฏ <strike>ุงูููุทูู</strike> . <br><br>  ูููู ุฌููุน ุงููุนุงููุงุช ุงูุชู ุจุฏุฃุช. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">|| UPDATE 1</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">|| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">||| UPDATE 1</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">||| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><blockquote style=";text-align:right;direction:rtl">  ูููู ุงูุนุซูุฑ ุนูู ูุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ุญุธุฑ ุงูุณูุงุณู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">README.tuplock</a> . <br></blockquote><br><h1 style=";text-align:right;direction:rtl">  ูู ุชูู ุชูู ููุง </h1><br>  ูุฐุง ุ ูุฅู ููุฑุฉ ูุฌูุฏ ูุธุงู ููุญุฌุจ ุนูู ูุณุชูููู ูู ุชูููู ุงุญุชูุงููุฉ ุงูุงูุชุธุงุฑ ุงูุฃุจุฏู ููุนุงููุฉ "ุงูุญุธ ุงูุณูุฆ".  ููุน ุฐูู ุ ููุง ุฑุฃููุง ุจุงููุนู ุ ูุฅู ูุฐุง ุงููุถุน ูููู ุชูุงููุง.  ูุฅุฐุง ูุงู ุงูุชุทุจูู ูุณุชุฎุฏู ุงูุฃููุงู ุงููุดุชุฑูุฉ ุ ููุฏ ูุตุจุญ ูู ุดูุก ุฃูุซุฑ ุญุฒููุง. <br><br>  ุฏุน ุงููุนุงููุฉ ุงูุฃููู ุชุบูู ุงูุตู ูู ุงููุถุน ุงููุดุชุฑู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> txid_current | pg_backend_pid --------------+---------------- 530501 | 5892 (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SHARE</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> acc_no | amount --------+-------- 1 | 100.00 (1 row)</code> </pre><br>  ุชุญุงูู ุงููุนุงููุฉ ุงูุซุงููุฉ ุชุญุฏูุซ ููุณ ุงูุตู ุ ููู ูุง ูููููุง - ุฃูุถุงุน SHARE ู NO KEY UPDATE ุบูุฑ ูุชูุงููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; | =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| txid_current | pg_backend_pid | --------------+---------------- | 530502 | 5928 | (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br>  ุงููุนุงููุฉ ุงูุซุงููุฉ ุชูุชุธุฑ ุงูุงูุชูุงุก ูู ุงูุฃููู ูุชุญูู ููู ุฅุตุฏุงุฑ ุงูุตู - ูู ุงูููุช ุงูุญุงูู ุ ูู ุดูุก ูุดุจู ุขุฎุฑ ูุฑุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5928</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+-------------+------------------+--------- 5928 | relation | accounts | RowExclusiveLock | t 5928 | tuple | accounts:10 | ExclusiveLock | t 5928 | transactionid | 530501 | ShareLock | f 5928 | transactionid | 530502 | ExclusiveLock | t (4 rows)</code> </pre><br>  ูุจุนุฏ ุฐูู ุชุธูุฑ ูุนุงููุฉ ุซุงูุซุฉ ุชุฑูุฏ ููููุง ูุดุชุฑููุง.  ุชููู ุงููุดููุฉ ูู ุฃููุง ูุง ุชุญุงูู ุงูุชูุงุท ุงูููู ุนูู ุฅุตุฏุงุฑ ุงูุฎุท (ูุฃูู ูู ูุบูุฑ ุงูุฎุท) ุ ูููู ุจุจุณุงุทุฉ ูุฒุญู ุฅูู ุงูุฎุงุฑุฌ - ุฅูู ูุชูุงูู ูุน ุงููุนุงููุฉ ุงูุฃููู. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">|| <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> || =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> txid_current(), pg_backend_pid();</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">|| txid_current | pg_backend_pid || --------------+---------------- || 530503 | 5964 || (1 row)</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">|| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SHARE</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">|| acc_no | amount || --------+-------- || 1 | 100.00 || (1 row)</code> </pre><br>  ูุงูุขู ููุงู ูุนุงููุงุช ุชููุน ุงูุตู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pgrowlocks(<span class="hljs-string"><span class="hljs-string">'accounts'</span></span>) \gx</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">-[ RECORD 1 ]--------------- locked_row | (0,10) locker | 62 multi | t xids | {530501,530503} modes | {Share,Share} pids | {5892,5964}</code> </pre><br>  ูุงุฐุง ูุญุฏุซ ุงูุขู ุนูุฏ ุงูุชูุงู ุงููุนุงููุฉ ุงูุฃูููุ  ุณูุชู ุฅููุงุธ ุงููุนุงููุฉ ุงูุซุงููุฉ ุ ูููู ุณุชุฑู ุฃู ููู ุงูุตู ูู ูุฎุชู ูู ุฃู ููุงู ุ ูุณูู ููู ูุฑุฉ ุฃุฎุฑู ูู "ูุงุฆูุฉ ุงูุงูุชุธุงุฑ" - ูุฐู ุงููุฑุฉ ูููุนุงููุฉ ุงูุซุงูุซุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> locks_v <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> pid = <span class="hljs-number"><span class="hljs-number">5928</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> pid | locktype | lockid | mode | granted ------+---------------+-------------+------------------+--------- 5928 | relation | accounts | RowExclusiveLock | t 5928 | tuple | accounts:10 | ExclusiveLock | t 5928 | transactionid | 530503 | ShareLock | f 5928 | transactionid | 530502 | ExclusiveLock | t (4 rows)</code> </pre><br>  ูููุท ุนูุฏ ุงูุชูุงู ุงููุนุงููุฉ ุงูุซุงูุซุฉ (ููู ุญุงูุฉ ุนุฏู ุธููุฑ ุฃููุงู ูุดุชุฑูุฉ ุฃุฎุฑู ุฎูุงู ูุฐุง ุงูููุช) ุ ุณุชููู ุงูุซุงููุฉ ูุงุฏุฑุฉ ุนูู ุฅุฌุฑุงุก ุงูุชุญุฏูุซ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">|| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">COMMIT</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| UPDATE 1</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>;</code> </pre><br>  ุฑุจูุง ุญุงู ุงูููุช ูุงุณุชุฎูุงุต ุจุนุถ ุงูุงุณุชูุชุงุฌุงุช ุงูุนูููุฉ. <br><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ูุนุฏ ุชุญุฏูุซ ููุณ ุงูุตู ูู ุฌุฏูู ูู ููุณ ุงูููุช ูู ุงูุนุฏูุฏ ูู ุงูุนูููุงุช ุงููุชูุงุฒูุฉ ููุฑุฉ ุฌูุฏุฉ. </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุณุชุฎุฏู ุงูุฃููุงู ุงููุดุชุฑูุฉ ูู ุงูููุน SHARE ูู ุงูุชุทุจูู ุ ูุณุฑููุง. </li><li style=";text-align:right;direction:rtl">  ูุฌุจ ุฃูุง ูุชุฏุฎู ุงูุชุญูู ูู ุงูููุงุชูุญ ุงูุฎุงุฑุฌูุฉ ุ ูุธุฑูุง ูุฃู ุญููู ุงูููุงุชูุญ ูุง ุชุชุบูุฑ ุนุงุฏุฉ ุ ูุฃู ุฃูุถุงุน KEY SHARE ู NO KEY UPDATE ูุชูุงููุฉ. </li></ul><br><br><h1 style=";text-align:right;direction:rtl">  ุทูุจ ุนุฏู ุงูุงูุชุฑุงุถ </h1><br>  ุนุงุฏุฉู ูุง ุชุชููุน ุฃูุงูุฑ SQL ุชุญุฑูุฑ ุงูููุงุฑุฏ ุงูุชู ูุญุชุงุฌูู ุฅูููุง.  ููู ูู ุจุนุถ ุงูุฃุญูุงู ุชุฑูุฏ ุฑูุถ ุชูููุฐ ุงูุฃูุฑ ุฅุฐุง ุชุนุฐุฑ ุงูุญุตูู ุนูู ุงูููู ุนูู ุงูููุฑ.  ููููุงู ุจุฐูู ุ ุชุชูุญ ูู ุงูุฃูุงูุฑ ูุซู SELECT ู LOCK ู ALTER ุงุณุชุฎุฏุงู ุนุจุงุฑุฉ NOWAIT. <br><br>  ุนูู ุณุจูู ุงููุซุงู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; =&gt; <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> amount = amount + <span class="hljs-number"><span class="hljs-number">100.00</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> acc_no = <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOWAIT</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| ERROR: could not obtain lock on row in relation "accounts"</code> </pre><br>  ููุดู ุงูุฃูุฑ ุนูู ุงูููุฑ ุฅุฐุง ูุงู ุงูููุฑุฏ ูุดุบููุงู.  ูู ุฑูุฒ ุงูุชุทุจูู ุ ูููู ุงุนุชุฑุงุถ ูุซู ูุฐุง ุงูุฎุทุฃ ููุนุงูุฌุชู. <br><br>  ูุง ููููู ุชุญุฏูุฏ ุนุจุงุฑุฉ NOWAIT ูุฃูุฑุชู UPDATE ู DELETE ุ ูููู ููููู ุฃููุงู ุชูููุฐ SELECT FOR UPDATE NOWAIT ุ ุซู ุ ุฅุฐุง ุฃููู ุ ูู ุจุชุญุฏูุซ ุฃู ุญุฐู ุงูุณุทุฑ. <br><br>  ููุงู ุฎูุงุฑ ุขุฎุฑ ูู ุนุฏู ุงูุงูุชุธุงุฑ - ุงุณุชุฎุฏู ุงูุฃูุฑ SELECT FOR ูุน ุนุจุงุฑุฉ SKIP LOCKED.  ูุซู ูุฐุง ุงูุฃูุฑ ุณูุชุฎุทู ุงูุฎุทูุท ุงูููููุฉ ุ ููู ูุนุงูุฌ ุงูุฎุทูุท ุงููุฌุงููุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">| =&gt; <span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span>; | =&gt; <span class="hljs-keyword"><span class="hljs-keyword">DECLARE</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">CURSOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> accounts <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> acc_no <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SKIP LOCKED</span></span>; | =&gt; <span class="hljs-keyword"><span class="hljs-keyword">FETCH</span></span> c;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| acc_no | amount | --------+-------- | 2 | 200.00 | (1 row)</code> </pre><br>  ูู ูุฐุง ุงููุซุงู ุ ุชู ุชุฎุทู ุงูุณุทุฑ ุงูุฃูู ุงููุญุธูุฑ ูุชููููุง ุนูู ุงูููุฑ (ูุญุธุฑู) ุงูุซุงูู. <br><br>  ูู ุงูููุงุฑุณุฉ ุงูุนูููุฉ ุ ูุณูุญ ูู ูุฐุง ุจุชูุธูู ูุนุงูุฌุฉ ููุงุฆู ูุชุนุฏุฏุฉ ุงูุฎููุท.  ูุฌุจ ุฃูุง ุชุชูุตู ุฅูู ุชุทุจูู ุขุฎุฑ ููุฐุง ุงูุฃูุฑ - ุฅุฐุง ููุช ุชุฑุบุจ ูู ุงุณุชุฎุฏุงูู ุ ููู ุงููุฑุฌุญ ุฃูู ุณุชููุฏ ุจุนุถ ุงูุญููู ุงูุจุณูุทุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="pgsql hljs">=&gt; <span class="hljs-keyword"><span class="hljs-keyword">ROLLBACK</span></span>;</code> </pre><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">| =&gt; ROLLBACK;</code> </pre><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฃู ุชุณุชูุฑ</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar463819/">https://habr.com/ru/post/ar463819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar463805/index.html">ุณุจุนุฉ ูุชุจ ูุฃููุฆู ุงูุฐูู ูุฑูุฏูู ุฃู ูุตุจุญูุง ูุตูู ุฃูุนุงุจ</a></li>
<li><a href="../ar463811/index.html">ุชุญุถูุฑ ุงูุชุทุจูู ููุธุงู Android Q. ุงูุฌุฒุก 1</a></li>
<li><a href="../ar463813/index.html">ูููููุงู ูุงูุชูุฌูู ุนูู Mikrotik RouterOS</a></li>
<li><a href="../ar463815/index.html">ููุงุฐุง ููุชู ุจูู ุฃุฌูุจู ุจูุตุฏุฑ ุฃููุงููุ</a></li>
<li><a href="../ar463817/index.html">20 ูุฏูุฑ ููุชุฌ ูุจููุฉ ูุตูููุฉ ูุชุนุฏุฏุฉ ุงูุฃุจุนุงุฏ ุนูู ุงูุฅุทูุงู. ูุญุงุฏุซุฉ ูุน Skyeng</a></li>
<li><a href="../ar463821/index.html">AMO ุ Bitrix ุ 1C ูุบูุฑูุง: ููู ุชุฎุชุงุฑ ูู ุฃูู ุชุจุฏุฃุ</a></li>
<li><a href="../ar463823/index.html">ุงูุฅุตุฏุงุฑ 1.37.0 ูู ุงูุตุฏุฃ: ุชุญุณูู ููู ุชุนุฑูู ุงูุชูุฌูู ุ ูุงูุซูุงุจุช ุบูุฑ ุงููุณูุงุฉ ูููุฑุฏ ุงูุจุถุงุฆุน</a></li>
<li><a href="../ar463825/index.html">ุฌูุฌู ุฃุฏุงุฉ ุฅุฏุงุฑุฉ ุงููุดุงุฑูุน ูุฑูุฉ</a></li>
<li><a href="../ar463829/index.html">FreePBX. ุชูููู ุงูุนูุงูุฉ ุงููุฌููุฉ ูุฅุดุนุงุฑุงุช ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ููููุงููุงุช ุงููุงุฑุฏุฉ ุงููุงุฆุชุฉ ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ</a></li>
<li><a href="../ar463831/index.html">ูุง ูู ุงูุฎุทุฃ ูู ุชุนููู ุชูููููุฌูุง ุงููุนูููุงุช ูู ุฑูุณูุง</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>