<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚉 🏆 🙌🏻 Clicker DIY 🐛 🤹🏾 👋🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Baru-baru ini, seorang teman meminta saya untuk membantu dengan satu tugas: untuk mengontrol komputer dengan pemutar audio yang diinstal pada laptop W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Clicker DIY</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422203/"><p>  Baru-baru ini, seorang teman meminta saya untuk membantu dengan satu tugas: untuk mengontrol komputer dengan pemutar audio yang diinstal pada laptop Windows menggunakan remote perangkat keras kecil.  Saya meminta segala macam remote IR untuk tidak menawarkan.  Dan untuk membuat AVR-e, di mana ia memiliki sejumlah besar yang tersisa, perlu untuk melampirkan perlahan. </p><a name="habracut"></a><br><h2 id="postanovka-zadachi">  Pernyataan masalah </h2><br><p>  Tugas, jelas, dibagi menjadi dua bagian: </p><br><ul><li>  Perangkat keras mikrokontroler, dan </li><li>  Perangkat lunak yang berjalan di komputer dan mengontrol apa yang ada di dalamnya. </li></ul><br><p>  Karena kami bekerja dengan AVR, lalu mengapa tidak Arduino? </p><br><p>  Kami menimbulkan masalah. <br>  Platform perangkat keras: <br>  HW1.  Manajemen dilakukan oleh tombol tanpa memperbaiki; <br>  HW2.  Kami melayani 3 tombol (secara umum, berapa banyak yang tidak keberatan); <br>  HW3.  Menekan dianggap menahan tombol setidaknya 100 milidetik; <br>  HW4.  Penekanan yang lebih lama diabaikan.  Memproses lebih dari 1 tombol pada satu waktu tidak dilakukan; <br>  HW5.  Saat tombol ditekan, tindakan tertentu diluncurkan pada komputer; <br>  HW6.  Menyediakan antarmuka komunikasi dengan komputer melalui Serial / USB-converter bawaan; <br>  Platform perangkat lunak: <br>  SW1.  Menyediakan antarmuka komunikasi dengan komputer melalui port serial yang dapat dipilih; <br>  SW2.  Ubah perintah yang datang melalui antarmuka komunikasi ke acara-acara sistem operasi yang dikirimkan ke pemutar audio yang diinginkan. <br>  SW3.  Jeda pemrosesan perintah.  Termasuk perintah dari remote control. </p><br><p>  Nah, ada persyaratan tambahan: jika ini tidak menimbulkan investasi waktu yang serius, buat solusinya senyaman mungkin. </p><br><h2 id="proektirovanie-i-reshenie">  Desain dan Solusi </h2><br><h3 id="hw1">  Hw1 </h3><br><p>  Tombol-tombol tombol tetap pada posisi "ditekan" untuk waktu yang singkat.  Selain itu, tombol dapat berdetak (yaitu, menghasilkan banyak pemicu dalam waktu singkat karena kontak yang tidak stabil). <br>  Tidak masuk akal untuk menghubungkan mereka ke interupsi - waktu respons yang salah diperlukan untuk mengganggunya.  Kami akan membaca status mereka dari pin digital.  Untuk memastikan pembacaan yang stabil dari tombol dalam kondisi tidak tertekan, perlu menghubungkan pin input ke ground (pull-down) atau ke power (pull-up) melalui resistor pull-up.  Menggunakan resistor pull-up bawaan, kami tidak akan membuat elemen diskrit tambahan di sirkuit.  Di satu sisi kami menghubungkan tombol ke input kami, yang lain - ke tanah.  Inilah hasilnya: <br><img src="https://habrastorage.org/webt/7p/_o/so/7p_osowau3spzfyc9oob6bi4gku.png" alt="Diagram koneksi tombol"><br>  Dan - untuk setiap tombol. </p><br><h3 id="hw2">  Hw2 </h3><br><p> Ada beberapa tombol, jadi kita perlu sejumlah catatan seragam tentang cara polling tombol dan apa yang harus dilakukan jika ditekan.  Kami melihat ke arah enkapsulasi dan membuat kelas <code>Button</code> dari <code>Button</code> , yang berisi jumlah pin dari mana survei sedang dilakukan (dan itu sendiri menginisialisasi itu), dan perintah yang harus dikirim ke port.  Kami akan membahas seperti apa tim nanti. </p><br><p>  Kelas tombol akan terlihat seperti ini: </p><br><div class="spoiler">  <b class="spoiler_title">Kode Kelas Tombol</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Button</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Button(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pin, ::Command command) : pin(pin), command(command) {} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Begin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ pinMode(pin, INPUT); digitalWrite(pin, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !digitalRead(pin); } ::<span class="hljs-function"><span class="hljs-function">Command </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> command; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> pin; ::Command command; };</code> </pre> </div></div><br><p>  Setelah langkah ini, tombol kami menjadi universal dan tanpa wajah, tetapi Anda dapat bekerja dengan mereka dengan cara yang sama. </p><br><p>  Letakkan tombol bersama dan berikan pin: </p><br><pre> <code class="cpp hljs">Button buttons[] = { Button(A0, Command::Previous), Button(A1, Command::PauseResume), Button(A2, Command::Next), };</code> </pre> <br><p>  Inisialisasi semua tombol dilakukan dengan memanggil metode <code>Begin()</code> untuk setiap tombol: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> &amp;button : buttons) { button.Begin(); }</code> </pre> <br><p>  Untuk menentukan tombol mana yang ditekan, kami akan beralih di atas tombol dan memeriksa apakah ada yang ditekan.  Kami mengembalikan indeks tombol, atau salah satu nilai khusus: "tidak ada yang ditekan" dan "lebih dari satu tombol ditekan."  Nilai khusus, tentu saja, tidak bisa tumpang tindih dengan nomor tombol yang valid. </p><br><div class="spoiler">  <b class="spoiler_title">GetPressed ()</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = PressedNothing; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; ButtonsCount; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buttons[i].IsPressed()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index == PressedNothing) { index = i; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PressedMultiple; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index; }</code> </pre> </div></div><br><h3 id="hw3">  Hw3 </h3><br><p>  Tombol-tombol akan disurvei dengan periode tertentu (katakanlah, 10 ms), dan kami akan menganggap bahwa penekanan terjadi jika tombol yang sama (dan tepat satu) ditahan untuk sejumlah siklus polling tertentu.  Membagi waktu fiksasi (100 ms) dengan periode pemungutan suara (10 ms), kita dapatkan 10. <br>  Kami akan memulai penghitung penurunan, di mana kami menulis 10 pada fiksasi pertama penekanan, dan pengurangan pada setiap periode.  Begitu mulai dari 1 hingga 0, kami mulai memproses (lihat HW5) </p><br><h3 id="hw4">  Hw4 </h3><br><p>  Jika penghitung sudah 0, tidak ada tindakan yang diambil. </p><br><h3 id="hw5">  Hw5 </h3><br><p>  Seperti disebutkan di atas, perintah yang dapat dieksekusi dikaitkan dengan setiap tombol.  Itu harus ditransmisikan melalui antarmuka komunikasi. </p><br><p>  Pada tahap ini, Anda dapat menerapkan strategi keyboard. </p><br><div class="spoiler">  <b class="spoiler_title">Implementasi loop utama</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleButtons</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CurrentButton = PressedNothing; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> byte counter; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> button = GetPressed(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button == PressedMultiple || button == PressedNothing) { CurrentButton = button; counter = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button == CurrentButton) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (counter &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (--counter == <span class="hljs-number"><span class="hljs-number">0</span></span>) { InvokeCommand(buttons[button]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { CurrentButton = button; counter = PressInterval / TickPeriod; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ HandleButtons(); delay(TickPeriod); }</code> </pre> </div></div><br><h3 id="hw6">  Hw6 </h3><br><p>  Antarmuka komunikasi harus jelas untuk pengirim dan penerima.  Karena antarmuka serial memiliki unit transfer data 1 byte dan sinkronisasi byte, tidak masuk akal untuk memagari sesuatu yang rumit dan membatasi diri untuk mentransmisikan satu byte per perintah.  Untuk kenyamanan debugging, kami akan mentransfer satu karakter ASCII per perintah. </p><br><h3 id="realizaciya-na-arduino">  Implementasi Arduino </h3><br><p>  Sekarang kita kumpulkan.  Kode implementasi lengkap ditunjukkan di bawah ini di bawah spoiler.  Untuk meluaskannya, cukup menentukan kode ASCII dari perintah baru dan melampirkan sebuah tombol padanya. <br>  Tentu saja, akan mungkin hanya untuk secara eksplisit menunjukkan kode simbol untuk setiap tombol, tetapi kami tidak akan melakukan ini: penamaan perintah akan berguna bagi kami ketika mengimplementasikan klien untuk PC. </p><br><div class="spoiler">  <b class="spoiler_title">Implementasi penuh</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> TickPeriod = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">//ms const int PressInterval = 100; //ms enum class Command : char { None = 0, Previous = 'P', Next = 'N', PauseResume = 'C', SuspendResumeCommands = '/', }; class Button { public: Button(uint8_t pin, Command command) : pin(pin), command(command) {} void Begin() { pinMode(pin, INPUT); digitalWrite(pin, 1); } bool IsPressed() { return !digitalRead(pin); } Command GetCommand() const { return command; } private: uint8_t pin; Command command; }; Button buttons[] = { Button(A0, Command::Previous), Button(A1, Command::PauseResume), Button(A2, Command::Next), Button(12, Command::SuspendResumeCommands), }; const byte ButtonsCount = sizeof(buttons) / sizeof(buttons[0]); void setup() { for (auto &amp;button : buttons) { button.Begin(); } Serial.begin(9600); } enum { PressedNothing = -1, PressedMultiple = -2, }; int GetPressed() { int index = PressedNothing; for (byte i = 0; i &lt; ButtonsCount; ++i) { if (buttons[i].IsPressed()) { if (index == PressedNothing) { index = i; } else { return PressedMultiple; } } } return index; } void InvokeCommand(const class Button&amp; button) { Serial.write((char)button.GetCommand()); } void HandleButtons() { static int CurrentButton = PressedNothing; static byte counter; int button = GetPressed(); if (button == PressedMultiple || button == PressedNothing) { CurrentButton = button; counter = -1; return; } if (button == CurrentButton) { if (counter &gt; 0) { if (--counter == 0) { InvokeCommand(buttons[button]); return; } } } else { CurrentButton = button; counter = PressInterval / TickPeriod; } } void loop() { HandleButtons(); delay(TickPeriod); }</span></span></code> </pre> </div></div><br><p>  Dan ya, saya membuat tombol lain untuk dapat menghentikan sementara transfer perintah ke klien. </p><br><h3 id="klient-dlya-pk">  Klien untuk PC </h3><br><p>  Kami lolos ke bagian kedua. <br>  Karena kami tidak memerlukan antarmuka yang kompleks, dan mengikat ke Windows, kami dapat pergi dengan cara yang berbeda, seperti yang Anda suka: WinAPI, MFC, Delphi, .NET (Windows Forms, WPF, dll.), Atau konsol pada platform yang sama ( baik, kecuali untuk MFC). </p><br><h3 id="sw1">  SW1 </h3><br><p>  Persyaratan ini ditutup melalui komunikasi dengan port serial pada platform perangkat lunak yang dipilih: sambungkan ke port, baca byte, byte proses. </p><br><h3 id="sw2">  SW2 </h3><br><p>  Mungkin semua orang melihat keyboard dengan tombol multimedia.  Setiap tombol pada keyboard, termasuk yang multimedia, memiliki kode sendiri.  Solusi paling sederhana untuk masalah kami adalah mensimulasikan penekanan tombol multimedia pada keyboard.  Kode kunci dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sumber asli - MSDN</a> .  Masih mempelajari cara mengirim mereka ke sistem.  Ini juga tidak sulit: ada fungsi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SendInput</a> di WinAPI. <br>  Setiap keystroke adalah dua peristiwa: menekan dan melepaskan. <br>  Jika kita menggunakan C / C ++, maka kita cukup memasukkan file header.  Dalam bahasa lain, penerusan panggilan harus dilakukan.  Jadi, misalnya, ketika mengembangkan .NET Anda harus mengimpor fungsi yang ditentukan dan menjelaskan argumen.  Saya memilih .NET untuk kenyamanan mengembangkan antarmuka. <br>  Saya memilih dari proyek hanya bagian substantif, yang bermuara pada satu kelas: <code>Internals</code> . <br>  Ini kodenya: </p><br><div class="spoiler">  <b class="spoiler_title">Kode internal kelas</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Internals</span></span> { [StructLayout(LayoutKind.Sequential)] [DebuggerDisplay(<span class="hljs-string"><span class="hljs-string">"{Type} {Data}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> INPUT { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Type; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> KEYBDINPUT Data; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Keyboard = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Size = Marshal.SizeOf(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(INPUT)); } [StructLayout(LayoutKind.Sequential)] [DebuggerDisplay(<span class="hljs-string"><span class="hljs-string">"Vk={Vk} Scan={Scan} Flags={Flags} Time={Time} ExtraInfo={ExtraInfo}"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> KEYBDINPUT { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Vk; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ushort</span></span> Scan; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Flags; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint</span></span> Time; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IntPtr ExtraInfo; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> spare; } [DllImport(<span class="hljs-string"><span class="hljs-string">"user32.dll"</span></span>, SetLastError = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">uint</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SendInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint</span></span></span></span><span class="hljs-function"><span class="hljs-params"> numberOfInputs, INPUT[] inputs, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sizeOfInputStructure</span></span></span><span class="hljs-function">)</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> INPUT[] inputs = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> INPUT { Type = INPUT.Keyboard, Data = { Flags = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">// Push } }, new INPUT { Type = INPUT.Keyboard, Data = { Flags = 2 // Release } } }; public static void SendKey(Keys key) { inputs[0].Data.Vk = (ushort) key; inputs[1].Data.Vk = (ushort) key; SendInput(2, inputs, INPUT.Size); } }</span></span></code> </pre> </div></div><br><p>  Pertama, ini menggambarkan struktur data (hanya yang terkait dengan input keyboard terputus, karena kami mensimulasikannya), dan <code>SendInput</code> mengimpor <code>SendInput</code> . <br>  Bidang <code>inputs</code> adalah array dari dua elemen yang akan digunakan untuk menghasilkan acara keyboard.  Tidak masuk akal untuk mengalokasikannya secara dinamis jika arsitektur aplikasi berasumsi bahwa <code>SendKey</code> tidak akan <code>SendKey</code> dalam banyak utas. <br>  Sebenarnya, masalah teknis lebih lanjut: kita mengisi bidang struktur yang sesuai dengan kode kunci virtual dan mengirimkannya ke antrian masukan sistem operasi. </p><br><h3 id="sw3">  SW3 </h3><br><p>  Persyaratan ditutup sangat sederhana.  Bendera dinaikkan dan perintah lain diproses dengan cara khusus: bendera beralih ke keadaan logis yang berlawanan.  Jika diatur, maka perintah yang tersisa diabaikan. </p><br><h2 id="vmesto-zaklyucheniya">  Alih-alih sebuah kesimpulan </h2><br><p>  Peningkatan bisa dilakukan tanpa akhir, tapi itu cerita lain.  Saya tidak menyajikan proyek klien Windows di sini, karena ini memberikan imajinasi yang luas. <br>  Untuk mengontrol pemutar media, kami mengirim satu set “penekanan tombol” tombol, jika Anda perlu mengelola presentasi, yang lain.  Anda dapat membuat modul kontrol, merakitnya baik secara statis atau sebagai plug-in.  Secara umum, banyak hal yang mungkin.  Yang utama adalah keinginan. </p><br><p>  Terima kasih atas perhatian anda </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id422203/">https://habr.com/ru/post/id422203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id422191/index.html">Bagaimana saya membuat aplikasi pengenalan teks Android yang menguntungkan</a></li>
<li><a href="../id422195/index.html">Penggunaan ACS dalam penambangan</a></li>
<li><a href="../id422197/index.html">Kami mengatakan sepatah kata pun tentang estafet</a></li>
<li><a href="../id422199/index.html">Security Week 33: oleh siapa monitor berosilasi?</a></li>
<li><a href="../id422201/index.html">China, izinkan saya menulis?</a></li>
<li><a href="../id422205/index.html">Richard Hamming: Bab 13. Teori Informasi</a></li>
<li><a href="../id422207/index.html">Monster setelah liburan: AMD Threadripper 2990WX 32-Core dan 2950X 16-Core (bagian 4)</a></li>
<li><a href="../id422209/index.html">Monster setelah liburan: AMD Threadripper 2990WX 32-Core dan 2950X 16-Core (bagian 5)</a></li>
<li><a href="../id422211/index.html">Struktur komponen yang indah di cloud Microsoft Azure</a></li>
<li><a href="../id422213/index.html">Suatu hari tanpa JavaScript: apa yang bisa salah?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>