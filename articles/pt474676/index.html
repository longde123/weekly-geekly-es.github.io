<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíè üñ≤Ô∏è üìû O algoritmo de intera√ß√£o de centenas de milhares de part√≠culas √∫nicas na GPU, no GLES3 e WebGL2 ‚úåüèº üôé üë®üèø‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Descri√ß√£o do algoritmo l√≥gico e an√°lise de um exemplo de trabalho na forma de um jogo de demo tecno 


 Vers√£o WebGL2 desta demonstra√ß√£o https://danil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O algoritmo de intera√ß√£o de centenas de milhares de part√≠culas √∫nicas na GPU, no GLES3 e WebGL2</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/474676/"><h1 id="opisanie-algoritma-logiki-i-razbor-rabochego-primera-v-vide-tehno-demki-igry">  Descri√ß√£o do algoritmo l√≥gico e an√°lise de um exemplo de trabalho na forma de um jogo de demo tecno </h1><br><p>  Vers√£o WebGL2 desta demonstra√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://danilw.itch.io/flat-maze-web para</a> outros links, consulte o artigo. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HawWnuMn1mc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h3 id="statya-razbita-na-dve-chasti-snachala-pro-logiku-i-vtoraya-chast-pro-primenenie-v-igre-pervaya-chast">  O artigo est√° dividido em duas partes, primeiro sobre l√≥gica e a segunda parte sobre a aplica√ß√£o no jogo, a <em>primeira parte</em> : </h3><br><ul><li>  Principais Funcionalidades </li><li>  Links e uma breve descri√ß√£o. </li><li>  O algoritmo da l√≥gica. </li><li> As limita√ß√µes da l√≥gica.  Erros / recursos e erros de √¢ngulo. </li><li>  Acesso aos dados do √≠ndice. </li></ul><br><h3 id="dalshe-opisanie-igrovoy-demki-vtoraya-chast">  Mais descri√ß√£o da demo do jogo, a <em>segunda parte</em> : </h3><br><ul><li>  Recursos usados ‚Äã‚Äãdessa l√≥gica.  E renderiza√ß√£o r√°pida de um milh√£o de part√≠culas de pixel. </li><li>  Implementa√ß√£o, alguns coment√°rios sobre o c√≥digo, descri√ß√£o da colis√£o em duas dire√ß√µes.  E intera√ß√£o com o jogador. </li><li>  Links para gr√°ficos usados ‚Äã‚Äãcom opengameart e um shader para sombras.  E o link do artigo para cyberleninka.ru </li></ul><a name="habracut"></a><br><h1 id="chast-1">  Parte 1 </h1><br><h1 id="1-klyuchevye-osobennosti">  1. Principais Recursos </h1><br><p> <strong>A id√©ia</strong> √© uma colis√£o / f√≠sica de centenas de milhares de part√≠culas entre si, em tempo real, onde cada part√≠cula tem um identificador √∫nico. </p><br><p>  Quando cada part√≠cula √© indexada, <strong>√© poss√≠vel controlar quaisquer par√¢metros de qualquer part√≠cula</strong> , por exemplo, massa, sua sa√∫de (hp) ou dano, acelera√ß√£o, desacelera√ß√£o, que objetos encontram e reagem ao evento dependendo do tipo / √≠ndice da part√≠cula, tamb√©m temporizadores exclusivos para cada part√≠cula e assim por diante, conforme necess√°rio. </p><br><p>  <strong>Toda a l√≥gica no GLSL √© totalmente port√°til para qualquer mecanismo de jogo</strong> e qualquer sistema operacional com suporte ao GLES3. </p><br><p>  <em>O n√∫mero m√°ximo de part√≠culas</em> √© igual ao tamanho do buffer de estrutura (fbo, todos os pixels). </p><br><p>  <em>Um n√∫mero confort√°vel de part√≠culas</em> (quando h√° espa√ßo para as part√≠culas interagirem) √© <code>(Resolution.x*Resolution.y/2)/2</code> √© cada segundo pixel em <code>x</code> cada segundo pixel em <code>y</code> , e √© por isso que a descri√ß√£o l√≥gica diz isso. </p><br><p>  Na primeira parte do artigo, a l√≥gica m√≠nima √© mostrada, na segunda no exemplo do jogo, l√≥gica com um grande n√∫mero de condi√ß√µes de intera√ß√£o. </p><br><h1 id="2-ssylki-i-kratkoe-opisanie">  2. Links e breve descri√ß√£o </h1><br><p>  Eu fiz tr√™s demos sobre essa l√≥gica: </p><br><p>  <strong>1. No GLSL fragment-shader</strong> , no shadertoy <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.shadertoy.com/view/tstSz7</a> , consulte o c√≥digo BufferC em toda a l√≥gica.  Esse c√≥digo tamb√©m permite exibir centenas de milhares de part√≠culas com seus UV, em uma posi√ß√£o arbitr√°ria, em um shader de fragmentos sem usar part√≠culas instanciadas. </p><br><p><img src="https://habrastorage.org/webt/8a/-w/l7/8a-wl7z8v954zwdyxqaph8eusao.png"></p><br><p>  <strong>2. Portando a l√≥gica para part√≠culas instanciadas</strong> (usadas por Godot como um motor) </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/fRu9PA4XHPQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Links <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vers√£o da Web</a> , <a href="">exe (win)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fontes de</a> projeto de <em>part√≠culas_2D_self_collision</em> . </p><br><p>  Breve descri√ß√£o: <strong>Esta √© uma p√©ssima demonstra√ß√£o de part√≠culas instanciadas</strong> , devido ao fato de eu fazer o aumento m√°ximo em que todo o mapa √© vis√≠vel, part√≠culas de 640x360 (230k) s√£o sempre processadas, isso √© muito.  <strong>Veja abaixo na descri√ß√£o do jogo, l√° fiz o certo, sem part√≠culas extras.</strong>  (h√° um erro no √≠ndice de part√≠culas no v√≠deo, isso √© corrigido no c√≥digo) </p><br><p>  <strong>3. O jogo, sobre isso abaixo na descri√ß√£o do jogo.</strong>  Links <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vers√£o Web</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exe (vit√≥ria)</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fontes</a> </p><br><h1 id="3-algoritm-raboty-logiki">  3. O algoritmo da l√≥gica </h1><br><p>  Resumidamente: </p><br><p>  A l√≥gica √© semelhante √† areia caindo, cada pixel preserva o valor fracion√°rio da posi√ß√£o (alterna dentro do pixel) e a acelera√ß√£o atual. </p><br><p>  A l√≥gica verifica os pixels no raio 1, se sua pr√≥xima posi√ß√£o deseja ir para esse pixel <em>(por causa dessa restri√ß√£o, veja as restri√ß√µes abaixo)</em> , tamb√©m os pixels no raio 2 para repuls√£o (colis√£o). </p><br><p>  O √≠ndice exclusivo √© salvo convertendo a l√≥gica em int-float e reduzindo o tamanho da posi√ß√£o <code>pos</code> e velocidade <code>pos</code> . </p><br><p>  Os dados s√£o armazenados desta maneira: <em>(devido a esse bug, consulte restri√ß√µes)</em> </p><br><pre> <code class="plaintext hljs">pixel.rgba r=[0xfffff-posx, 0xf-data] g=[0xfffff-posy, 0xf-data] b=[0xffff-velx, 0xff-data] a=[0xffff-vely, 0xff-data]</code> </pre> <br><p><img src="https://habrastorage.org/webt/46/ad/io/46adionlolw3vm5zfry5javhgxk.png"></p><br><p>  <strong>No c√≥digo</strong> , os n√∫meros de linha do BufC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.shadertoy.com/view/tstSz7</a> , 115 verifica√ß√£o de transi√ß√£o, 139 verifica√ß√µes de colis√£o. </p><br><p>  Estes s√£o loops simples para obter valores adjacentes.  E a condi√ß√£o √© que, se a posi√ß√£o for tomada igual √† posi√ß√£o do pixel atual, moveremos esses dados para esse pixel <em>(por causa dessa restri√ß√£o)</em> , e o valor de <code>vel</code> mudar√° dependendo dos pixels vizinhos, se houver. </p><br><p>  <em>Isso tudo √© l√≥gica de part√≠culas.</em> </p><br><p>  <strong>√â melhor colocar part√≠culas a uma dist√¢ncia de 1 pixel uma da outra,</strong> se estiverem mais pr√≥ximas de 1 pixel, haver√° repulsa, como um exemplo de mapa com um labirinto no jogo, as part√≠culas ficam em seus lugares sem se moverem por causa da dist√¢ncia de 1 pixel entre elas. </p><br><p>  Em seguida, vem a renderiza√ß√£o (renderiza√ß√£o), <em>no caso do fragment-shader, os</em> pixels s√£o tirados no raio de 1 para exibir as √°reas que se cruzam.  <em>No caso de part√≠culas instanciadas, um</em> pixel √© obtido no endere√ßo <code>INSTANCE_ID</code> convertido de uma visualiza√ß√£o linear em uma matriz bidimensional. </p><br><h1 id="4-ogranicheniya-logiki-bagiosobennosti-i-bagi-angle">  4. Limita√ß√µes da l√≥gica.  Bugs / recursos e ANGLE bugs </h1><br><ol><li>  <strong>O tamanho do pixel</strong> , <code>BALL_SIZE</code> no c√≥digo, deve estar dentro dos limites de c√°lculo, maiores que <code>sqrt(2)/2</code> e menores que <code>1</code> .  Quanto mais pr√≥ximo de 1, menos espa√ßo para caminhar dentro do pixel (o pr√≥prio pixel), menor √© o espa√ßo.  Esse tamanho √© necess√°rio para que os pixels n√£o caiam um no outro, menos de 1 pode ser definido quando voc√™ tiver objetos pequenos; √© criada uma ilus√£o de objetos com menos de 1 pixel (calculado). </li><li>  <strong>A velocidade</strong> n√£o pode ser superior a <code>1</code> pixel, caso contr√°rio, os pixels desaparecer√£o.  Mas voc√™ pode ter uma velocidade superior a <code>1</code> por quadro - se voc√™ fizer v√°rios <em>framebuffer (fbo / viewport)</em> e processar v√°rias etapas l√≥gicas ao mesmo tempo, a velocidade do quadro aumentar√° pelo n√∫mero de vezes igual ao n√∫mero de fbo adicionais.  Foi o que fiz na demonstra√ß√£o de frutas e usando o link para shadertoy (o bufC copiou para o bufD). </li><li>  <strong>Limita√ß√£o de press√£o</strong> (como gravidade ou outro mapa de for√ßa normal).  Se v√°rios pixels vizinhos tomarem a posi√ß√£o disso (veja a imagem acima), apenas um ser√° salvo, os pixels restantes desaparecer√£o.  <em>Isso √© f√°cil de notar na demonstra√ß√£o do shadertoy,</em> defina o mouse para For√ßar, altere o valor de <code>MOUSE_F</code> em <em>Comum</em> para <code>10</code> e direcione as part√≠culas para o canto da tela, elas desaparecer√£o uma na outra.  Ou o mesmo com o valor da gravidade <code>maxG</code> em <em>Comum</em> . </li><li>  <strong>Bug em √¢ngulo.</strong>  Para que essa l√≥gica funcione nas part√≠culas da GPU (instanciadas), √© melhor (mais barato, mais r√°pido) calcular a posi√ß√£o e todos os outros par√¢metros de part√≠culas para exibi√ß√£o no <em>shader de inst√¢ncia</em> .  Como Angle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">n√£o permite o</a> uso de mais de uma textura fbo para um shader, portanto, o c√°lculo de parte da l√≥gica deve ser transferido para o <em>Vertex-shader,</em> para onde transferir o n√∫mero de √≠ndice do shader da inst√¢ncia.  Foi o que fiz nas duas demos com part√≠culas de GPU. </li><li>  <strong>Um bug s√©rio</strong> nas duas demos (exceto no jogo), o valor da posi√ß√£o ser√° perdido se n√£o for m√∫ltiplo de <code>1/0xfffff</code> teste de bug est√° aqui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.shadertoy.com/view/WdtSWS</a> <br>  Mais precisamente, isso n√£o √© um bug, e deve ser assim, por simplicidade, como parte desse algoritmo, chamei de bug. </li></ol><br><p>  <strong>Corrigir bug:</strong> <br>  <em>N√£o converta o valor da posi√ß√£o em int-float</em> , pois esse <code>0xff</code> desaparecer√°, 8 bits dispon√≠veis para dados, mas o valor <code>0xffff</code> para dados permanecer√°, o que pode ser suficiente para muitas coisas. <br>  <em>Fiz exatamente isso na demo do jogo</em> , uso apenas <code>0xffff</code> para os dados em que o tipo de part√≠cula, o cron√¥metro de anima√ß√£o e a sa√∫de est√£o armazenados e ainda h√° espa√ßo livre. </p><br><h1 id="5-dostup-k-dannym-po-indeksu">  5. Acesso aos dados do √≠ndice </h1><br><p>  part√≠cula instanciada tem seu pr√≥prio <code>INSTANCE_ID</code> , pega um pixel da textura do buffer de estrutura com l√≥gica de part√≠culas (bufC, exemplo para sombreador), se descompactarmos a part√≠cula (consulte o armazenamento de dados) <em>ID dessa part√≠cula</em> , por <em>esse ID</em> , lemos a textura com dados para part√≠culas (bufB , um exemplo em um sombreador). </p><br><p>  No exemplo shadertoy, o bufB armazena apenas a cor de cada part√≠cula, mas √© √≥bvio que pode haver dados, como massa, acelera√ß√£o, desacelera√ß√£o escritos anteriormente, bem como quaisquer a√ß√µes l√≥gicas (por exemplo, voc√™ pode mover qualquer part√≠cula para qualquer posi√ß√£o (teleporte), se isso for feito. a√ß√£o l√≥gica correspondente no c√≥digo), voc√™ tamb√©m pode controlar o movimento de qualquer part√≠cula ou grupo do teclado ... </p><br><p>  <strong>Quero dizer que voc√™ pode fazer qualquer coisa com cada uma das part√≠culas como se fossem part√≠culas comuns em uma matriz no processador; o acesso bidirecional da part√≠cula da GPU pode mudar seu estado, mas tamb√©m da CPU voc√™ pode alterar o estado da part√≠cula por √≠ndice (usando a√ß√µes e textura l√≥gicas buffer de dados).</strong> </p><br><h1 id="chast-2">  Parte 2 </h1><br><h1 id="1-ispolzuemye-vozmozhnosti-etoy-logiki-i-bystryy-rendering-milliona-chastic-pikseley">  1. Recursos usados ‚Äã‚Äãdessa l√≥gica.  E renderiza√ß√£o r√°pida de um milh√£o de part√≠culas de pixel </h1><br><p>  O tamanho do buffer de estrutura (fbo / viewport) para part√≠culas √© 1280x720, as pe√ßas est√£o localizadas ap√≥s 1; s√£o 230 mil part√≠culas ativas (elementos ativos no labirinto). <br>  <em>Sempre h√° no m√°ximo 12 mil part√≠culas instanciadas na GPU na tela.</em> </p><br><p>  <strong>Usos l√≥gicos:</strong> </p><br><ul><li>  A l√≥gica do player √© separada da l√≥gica de part√≠culas e somente l√™ dados do buffer de part√≠culas. </li><li>  O jogador diminui a velocidade ao colidir com objetos. </li><li>  Objetos do tipo monstro causam dano ao jogador. </li><li>  O jogador tem 2 ataques, um repele tudo ao redor, o segundo cria part√≠culas como <em>bola de fogo</em> (a imagem √© assim) </li><li>  O tipo <em>bola de fogo</em> tem sua pr√≥pria massa, e o rastreamento bilateral de colis√µes com outras part√≠culas funciona. </li><li>  outras part√≠culas como <em>elenco</em> e <em>zumbis</em> (um tipo de elenco √© invulner√°vel) s√£o destru√≠das em uma colis√£o com uma <em>bola de fogo</em> </li><li>  <em>bola de fogo</em> apaga ap√≥s uma colis√£o </li><li>  n√≠veis de <em>f√≠sica</em> - √°rvores e quadrados s√£o repelidos pelo jogador, outras part√≠culas n√£o interagem, nenhuma acelera√ß√£o atua na <em>bola de fogo</em> </li><li>  temporizadores de anima√ß√£o s√£o exclusivos para cada part√≠cula </li></ul><br><p>  Comparado √† demonstra√ß√£o de frutas, onde h√° sobrecarga, <strong>neste jogo o n√∫mero de part√≠culas instanciadas por GPU √© de apenas 12 mil.</strong> </p><br><p>  √â assim: </p><br><p><img src="https://habrastorage.org/webt/lk/kt/9-/lkkt9-59aoftj47pqbpy4q5anfk.png"></p><br><p>  Seu n√∫mero depende do zoom atual ( <em>zoom</em> ) do mapa e o aumento √© limitado a um determinado valor; portanto, apenas aqueles que s√£o vis√≠veis na tela s√£o considerados. <br>  A tela muda com o player, a l√≥gica para calcular os turnos √© um pouco complexa e muito situacional, duvido que ela encontre aplica√ß√£o em outro projeto. </p><br><h1 id="2-realizaciya-nemnogo-kommentariev-k-kodu">  2. Implementa√ß√£o, alguns coment√°rios sobre o c√≥digo. </h1><br><p>  Todo o c√≥digo do jogo est√° na GPU. </p><br><p>  <strong>A l√≥gica para calcular o deslocamento de part√≠culas</strong> na tela com um aumento na fun√ß√£o de <em>v√©rtice</em> no arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/shaders/scene2/particle_logic2.shader</a> √© um arquivo de sombreador de part√≠culas (v√©rtice e fragmento), n√£o um sombreador instanciado, o sombreador instanciado n√£o faz nada, apenas passa seu √≠ndice devido a bug descrito acima. </p><br><p>  <strong>part√≠culas por tipo</strong> e toda a l√≥gica da intera√ß√£o de part√≠culas em um arquivo, este √© um arquivo de um arquivo shader <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">/ frame2 particle / shader / particle_fbo_logic.shader</a> shader </p><br><pre> <code class="plaintext hljs">// 1-2 ghost // 3-zombi // 4-18 blocks // +20 is on fire // 40 is bullet(right) 41 left 42 top 43 down</code> </pre> <br><p>  pixel de <strong>armazenamento de dados</strong> <code>[pos.x, pos.y, [0xffff-vel.x, 0xff-data1],[0xffff-vel.y, 0xff-data2]]</code> <br>  data1 √© um tipo, data2 √© um HP ou timer. </p><br><p>  <em>O cron√¥metro entra em quadros em cada part√≠cula</em> , o valor m√°ximo do cron√¥metro √© 255, n√£o preciso muito, uso apenas 1-16 no m√°ximo ( <code>0xf</code> ) e <code>0xf</code> permanece sem uso, onde, por exemplo, voc√™ pode armazenar o valor real da HP, n√£o √© usado para mim.  (ou seja, sim, <strong>eu uso <code>0xff</code> para o timer</strong> , mas na verdade s√≥ tenho menos de 16 quadros de anima√ß√£o e <code>0xf</code> suficiente, mas n√£o <code>0xf</code> dados adicionais) <br>  Na verdade, <code>0xff</code> usado apenas no cron√¥metro de queima de √°rvores, elas se transformam em zumbis ap√≥s 255 quadros.  A l√≥gica do timer est√° parcialmente no <code>type_hp_logic</code> no shader de framebuffer de part√≠culas (link acima). </p><br><h1 id="primer-raboty-kollizii-v-dve-storony-kogda-fireball-gasnet-pri-pervom-udare-i-obekt-s-kotorym-byl-udar-tozhe-vypolnyaet-svoe-deystvie">  <strong>Um exemplo de opera√ß√£o de colis√£o bidirecional</strong> quando uma <em>bola de fogo</em> dispara no primeiro golpe, e o objeto com o qual ele foi atingido tamb√©m executa sua a√ß√£o. </h1><br><p>  Arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">shaders / scene2 / particulas_fbo_logic.shader</a> linha 438: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((real_index == <span class="hljs-number"><span class="hljs-number">40</span></span>) || (real_index == <span class="hljs-number"><span class="hljs-number">41</span></span>) || (real_index == <span class="hljs-number"><span class="hljs-number">42</span></span>) || (real_index == <span class="hljs-number"><span class="hljs-number">43</span></span>)) &amp;&amp; (type_hp.y &gt; <span class="hljs-number"><span class="hljs-number">22</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h_id = get_id(fragCoord + vec2(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(x), <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(y))); ivec2 htype_hp = unpack_type_hp(h_id); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hreal_index = htype_hp.x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((hreal_index != <span class="hljs-number"><span class="hljs-number">40</span></span>) &amp;&amp; (hreal_index != <span class="hljs-number"><span class="hljs-number">41</span></span>) &amp;&amp; (hreal_index != <span class="hljs-number"><span class="hljs-number">42</span></span>) &amp;&amp; (hreal_index != <span class="hljs-number"><span class="hljs-number">43</span></span>)) type_hp.y = <span class="hljs-number"><span class="hljs-number">22</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!need_upd) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> h_id = get_id(fragCoord + vec2(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(x), <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(y))); ivec2 htype_hp = unpack_type_hp(h_id); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hreal_index = htype_hp.x; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((hreal_index == <span class="hljs-number"><span class="hljs-number">40</span></span>) || (hreal_index == <span class="hljs-number"><span class="hljs-number">41</span></span>) || (hreal_index == <span class="hljs-number"><span class="hljs-number">42</span></span>) || (hreal_index == <span class="hljs-number"><span class="hljs-number">43</span></span>)) &amp;&amp; (htype_hp.y &gt; <span class="hljs-number"><span class="hljs-number">22</span></span>)) { need_upd = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } } }</code> </pre> <br><p>  <code>real_index</code> √© um tipo, os tipos est√£o listados acima, 40-43 √© uma <em>bola de fogo</em> . <br>  <code>type_hp.y &gt; 22</code> √© o valor do timer, se for maior que 22, a <em>bola de fogo</em> n√£o encontrou nada. <br>  <code>h_id = get_id(...</code> pega o valor do tipo e HP (timer) da part√≠cula encontrada <br>  <code>hreal_index != 40...</code> tipo ignorado (outra <em>bola de fogo</em> ) <br>  <code>type_hp.y = 22</code> um timer est√° definido como 22, este √© um indicador de que esta <em>bola de fogo</em> colidiu com um objeto. <br>  <code>else { if (!need_upd)</code> vari√°vel need_upd verifica se n√£o h√° colis√µes repetidas, j√° que a fun√ß√£o est√° em loop, encontramos uma <em>bola de fogo</em> . <br>  <code>h_id = get_id(...</code> se ainda n√£o houve uma colis√£o, pegamos um objeto de tipo e timer. <br>  <code>hreal_index == 40...htype_hp.y &gt; 22</code> que o objeto de colis√£o √© <em>bola de fogo</em> e n√£o sai. <br>  <code>need_upd = true</code> sinalizador de que √© necess√°rio atualizar o tipo, pois encontrou uma <em>bola de fogo</em> . </p><br><p>  linha adicional 481 <br>  <code>if((need_upd)&amp;&amp;(real_index&lt;24)){</code> real_index &lt;24 por tipo menor que 24, existem √°rvores zumbis e fantasmas que n√£o queimam e, nessa condi√ß√£o, atualizamos o tipo, dependendo do tipo atual. </p><br><p>  Assim, quase qualquer intera√ß√£o de objetos pode ser feita. </p><br><h1 id="vzaimodeystvie-s-igrokom">  <strong>Intera√ß√£o com o jogador:</strong> </h1><br><p>  Arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">shaders / scene2 / logic.shader</a> linha 143 function <code>player_collision</code> </p><br><p>  Essa l√≥gica l√™ os pixels ao redor do player em um raio de 4x4 pixels, toma a posi√ß√£o de cada um dos pixels e a compara com a posi√ß√£o do jogador; se um elemento for encontrado, a verifica√ß√£o de tipo ser√° a pr√≥xima; se este for um monstro, tiraremos HP do player. </p><br><p>  <em>Isso funciona um pouco impreciso e eu n√£o queria corrigi-lo</em> , essa fun√ß√£o pode ser mais precisa. </p><br><p>  <strong>Part√≠culas se afastam do jogador e o efeito repulsivo durante um ataque:</strong> </p><br><p>  Um framebuffer (viewport) √© usado para escrever o normal das a√ß√µes atuais, e as part√≠culas ( <em>particulas_fbo_logic.shader</em> ) tomam essa textura (do normal) em sua posi√ß√£o e aplicam o valor √† sua velocidade e posi√ß√£o.  Todo o c√≥digo dessa l√≥gica √© literalmente apenas algumas linhas, arquivo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">force_collision.shader</a> </p><br><p>  <strong>Com o clique do bot√£o esquerdo do mouse, os proj√©teis de</strong> <em>bola de fogo</em> <strong>voam;</strong> sua apar√™ncia <em>n√£o</em> √© <em>muito natural</em> , eles n√£o corrigiram e sa√≠ram desta forma. </p><br><p>  Voc√™ pode criar uma zona (forma) normal para gerar part√≠culas com um turno aparecendo em rela√ß√£o ao jogador (isso n√£o √© feito). <br>  Ou voc√™ pode transformar a <em>bola de fogo em um</em> objeto separado como jogador e atrair o normal para um buffer para afastar as part√≠culas da <em>bola de fogo</em> , ou seja, por analogia com o jogador ... <br>  Quem precisa pensar que descobrir√° por si mesmo. </p><br><h1 id="3-ssylki-na-ispolzuemuyu-grafiku-s-opengameart-i-sheyder-teney">  3. Links para os gr√°ficos usados ‚Äã‚Äãcom opengameart e o shadow shader </h1><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><strong>Recebi um link para um artigo sobre cyberleninka.ru</strong></a> <br>  Na qual a descri√ß√£o do algoritmo que eu usei, talvez <em>haja uma descri√ß√£o mais detalhada e correta do</em> que neste, meu artigo. </p><br><p>  <strong>O sombreador de sombra</strong> funciona de maneira muito simples, com base nesse sombreador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://www.shadertoy.com/view/XsK3RR</a> (eu tenho um c√≥digo modificado) <br>  Shader cria <em>mapa de luz radial 1D</em> </p><br><p><img src="https://habrastorage.org/webt/e2/rh/op/e2rhopezigurqa3rkvhrb44vxxw.png"></p><br><p>  e sombreamento no c√≥digo de pintura do piso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">shaders / scene2 / mainImage.shader</a> </p><br><p>  <strong>Links para os gr√°ficos utilizados</strong> , todos os gr√°ficos do jogo no site <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://opengameart.org</a> <br>  <em>bola de fogo</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://opengameart.org/content/animated-traps-and-obstacles</a> <br>  personagem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://opengameart.org/content/legend-of-faune</a> <br>  √°rvores e blocos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://opengameart.org/content/lolly-set-01</a> <br>  (e mais algumas fotos com opengameart) </p><br><p>  <strong>Os gr√°ficos no menu foram</strong> obtidos pelo sombreador 2D_GI, um utilit√°rio para criar esses menus: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/HTuG5UOMC74" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  Quem leu at√© o fim - muito bem :) <br>  Se voc√™ tiver alguma d√∫vida, pergunte, eu posso complementar a descri√ß√£o mediante solicita√ß√£o. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt474676/">https://habr.com/ru/post/pt474676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt474664/index.html">Para aumentar a aten√ß√£o, nosso c√©rebro n√£o aumenta a concentra√ß√£o, mas usa filtros de informa√ß√£o</a></li>
<li><a href="../pt474666/index.html">Como n√£o reescrever um projeto no Rust</a></li>
<li><a href="../pt474668/index.html">A√ß√µes do GitHub como um IC / CD para um site em um gerador est√°tico e nas p√°ginas do GitHub</a></li>
<li><a href="../pt474672/index.html">Reagir, JSX, importa√ß√£o de m√≥dulos ES (incluindo din√¢mico) em um navegador sem Webpack</a></li>
<li><a href="../pt474674/index.html">Vis√£o de m√°quina e medicina</a></li>
<li><a href="../pt474678/index.html">O Khronos Group criou um reposit√≥rio unificado com exemplos do Vulkan</a></li>
<li><a href="../pt474680/index.html">AI e 2048. Parte 2: Recorte Minimax + alfa beta</a></li>
<li><a href="../pt474686/index.html">Hist√≥ria fant√°stica "Salva√ß√£o" (10 min.)</a></li>
<li><a href="../pt474688/index.html">Trem retr√¥ com uma locomotiva a vapor</a></li>
<li><a href="../pt474690/index.html">Criando um console com altura vari√°vel para um trabalho mais conveniente em um computador</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>