<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🌍 ♦️ 🖕🏻 Acceso seguro para registrar campos en C ++ sin sacrificar la eficiencia (utilizando CortexM como ejemplo) 🎤 🉑 🧔🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fig. tomado de www.extremetech.com/wp-content/uploads/2016/07/MegaProcessor-Feature.jpg 

 Buena salud a todos! 

 En un artículo anterior, examiné la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Acceso seguro para registrar campos en C ++ sin sacrificar la eficiencia (utilizando CortexM como ejemplo)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459642/"><img src="https://habrastorage.org/webt/et/ni/fl/etnifl3hcinjjsqt8skfvv6km5q.png" alt="imagen"><br>  <sub>Fig.</sub>  <sub>tomado de <a href="">www.extremetech.com/wp-content/uploads/2016/07/MegaProcessor-Feature.jpg</a></sub> <br><br>  Buena salud a todos! <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">En un artículo anterior,</a> examiné la cuestión del acceso a los registros de un microcontrolador con un núcleo CortexM en C ++ y mostré soluciones simples a algunos de los problemas. <br><br>  Hoy quiero mostrar la idea de cómo hacer que el acceso al registro y sus campos sea seguro sin sacrificar la eficiencia, usando clases C ++ generadas a partir de archivos SVD. <br><br>  Todos los que te interesan, bienvenidos a cat.  Habrá mucho código. <br><a name="habracut"></a><br><h3>  Introduccion </h3><br>  En un artículo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">C ++ Hardware Register Access Redux</a> , Ken Smith mostró cómo trabajar de manera segura y eficiente con los registros, e incluso lo mostró con <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/kensmith/cppmmio</a> como ejemplo. <br>  Luego, varias personas desarrollaron esta idea, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Niklas Hauser hizo una revisión maravillosa</a> y sugirió varias formas más de acceder de forma segura a los registros. <br><br>  Algunas de estas ideas ya se han implementado en varias bibliotecas, en particular en <a href="">modm</a> .  Para bien, puedes usar todas estas oraciones en la vida real.  Pero en el momento del desarrollo de estas bibliotecas, las descripciones de periféricos y registros acababan de comenzar a estandarizarse y, por lo tanto, algunas cosas se hicieron con el objetivo de que el trabajo principal en la descripción de los registros fuera con el programador.  Además, algunas soluciones no son efectivas en términos de código y recursos de microcontroladores. <br><br>  Hoy, cada fabricante de un microcontrolador ARM proporciona una descripción de todos los registros en formato SVD.  Los archivos de encabezado se pueden generar a partir de estas descripciones; por lo tanto, es posible crear no una descripción simple de los registros, sino una descripción más compleja, pero al mismo tiempo, lo que aumentará la confiabilidad de su código.  Y es genial que el archivo de salida pueda estar en cualquier lenguaje, C, C ++ o incluso <a href="">D</a> <br><br>  Pero tomemos en orden lo que generalmente es un acceso seguro a los registros y por qué es necesario.  La explicación puede mostrarse en ejemplos sintéticos simples, muy probablemente improbables, pero bastante posibles: <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      GPIOA //,    AHB1ENR RCC-&gt;APB1ENR |= RCC_AHB1ENR_GPIOAEN ; //    ,      RCC-&gt;AHB1ENR = RCC_AHB1ENR_GPIOAEN; //,  TIM1    APB2 RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM2EN | RCC_APB2ENR_TIM1EN; // - ,        . auto result = GPIOA-&gt;BSRR ; if (result &amp; GPIO_BSRR_BS1) { //do something } //-     .   ... GPIOA-&gt;IDR = GPIO_IDR_ID5 ; }</span></span></code> </pre> <br>  Todos estos casos son posibles en la práctica, y definitivamente vi algo así de mis alumnos.  Sería genial si pudieras prohibir cometer tales errores. <br><br>  También me parece que es mucho más agradable cuando el código se ve bien y no necesita comentarios.  Por ejemplo, incluso si conoce bien el microcontrolador STM32F411, no siempre es posible comprender lo que sucede en este código: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ uint32 temp = GPIOA-&gt;OSPEEDR ; temp &amp;=~ GPIO_OSPEEDR_OSPEED0_Msk ; temp = (GPIO_OSPEEDR_OSPEED0_0 | GPIO_OSPEEDR_OSPEED0_1) ; GPIOA-&gt;OSPEEDR = temp; }</code> </pre><br>  Ningún comentario aquí no puede hacer.  El código establece la frecuencia de funcionamiento del puerto GPIOA.0 al máximo (aclaración de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">mctMaks</a> : de hecho, este parámetro afecta el tiempo de subida del frente (es decir, su inclinación) y significa que el puerto puede procesar una señal digital normalmente en un determinado (Muy bajo \ Bajo \ Medio \ Alta) frecuencia). <br><br>  Tratemos de deshacernos de estas deficiencias. <br><br><h3>  Registrar abstracción </h3><br>  En primer lugar, debe averiguar cuál es el registro desde el punto de vista del programador y el programa. <br><br>  El registro tiene una dirección, longitud o tamaño, modo de acceso: algunos registros pueden escribirse, otros solo pueden leerse y la mayoría pueden leerse y escribirse. <br><br>  Además, el registro se puede representar como un conjunto de campos.  Un campo puede constar de uno o varios bits y está ubicado en cualquier parte del registro. <br><br>  Por lo tanto, las siguientes características de campo son importantes para nosotros: longitud o tamaño ( <b>ancho</b> o <b>tamaño</b> ), desplazamiento desde el comienzo del registro ( <b>desplazamiento</b> ) y valor. <br><br>  Los valores de campo son el espacio de todas las cantidades posibles que el campo puede tomar y depende de la longitud del campo.  Es decir  si el campo tiene una longitud de 2, entonces hay 4 valores de campo posibles (0,1,2,3).  Al igual que el registro, los campos y los valores de campo tienen un modo de acceso (lectura, escritura, lectura y escritura) <br><br>  Para hacerlo más claro, tomemos el registro TIM1 CR1 del microcontrolador STM32F411.  Esquemáticamente, se ve así: <br><br><img src="https://habrastorage.org/webt/sr/da/i4/srdai4a4hmphkmhrulcvdcx9r3u.png" alt="imagen"><br><br><ul><li>  Bit 0 CEN: Habilitar contador <br>  0: Contador habilitado: <b>Deshabilitar</b> <br>  1: Contador apagado: <b>Habilitar</b> <br></li><li>  UDIS Bit 1: Activar / Desactivar evento UEV <br>  0: Evento UEV habilitado: <b>Habilitar</b> <br>  1: evento UEV desactivado: <b>deshabilitado</b> <br></li><li>  Bit 2 de URS: Seleccione fuentes de generación de eventos UEV <br>  0: UEV se genera al desbordarse o al configurar el UG: <b>cualquier</b> bit <br>  1: UEV se genera solo en desbordamiento: <b>desbordamiento</b> <br></li><li>  Bit 3 OPM: Operación única <br>  0: el temporizador continúa contando más después del evento UEV: <b>ContinueAfterUEV</b> <br>  1: el temporizador se detiene después del <b>evento</b> UEV: <b>StopAfterUEV</b> <br></li><li>  Bit 4 DIR: Dirección de conteo <br>  0: Cuenta directa: <b>Upcounter</b> <br>  1: <b>Cuenta atrás</b> : cuenta <b>atrás</b> <br></li><li>  Bit 6: 5 CMS: Modo de alineación <br>  0: Modo de alineación 0: <b>CenterAlignedMode0</b> <br>  1: Modo de alineación 1: <b>CenterAlignedMode1</b> <br>  2: Modo de alineación 2: <b>CenterAlignedMode2</b> <br>  3: Modo de alineación 3: <b>CenterAlignedMode3</b> <br></li><li>  Bit 7 APRE: Modo de precarga para registro ARR <br>  0: el registro TIMx_ARR no está protegido: <b>ARRNotBuffered</b> <br>  1: el registro TIMx_ARR no está protegido: <b>ARRBuffered</b> <br></li><li>  Bit 8: 9 CKD: divisor de reloj <br>  0: tDTS = tCK_INT: <b>ClockDevidedBy1</b> <br>  1: tDTS = 2 * tCK_INT: <b>ClockDevidedBy2</b> <br>  2: tDTS = 4 * tCK_INT: <b>ClockDevidedBy4</b> <br>  3: Reservado: <b>Reservado</b> <br></li></ul><br>  Aquí, por ejemplo, CEN es un campo de 1 bit con un desplazamiento de 0 relativo al comienzo del registro.  Y <b>Enable</b> (1) y <b>Disable</b> (0) son sus posibles valores. <br><br>  No nos concentraremos en lo que cada campo de este registro es específicamente responsable, es importante para nosotros que cada campo y valor de campo tenga un nombre que lleve una carga semántica y desde el cual podamos entender en principio lo que hace. <br><br>  Debemos tener acceso tanto al registro como al campo y su valor.  Por lo tanto, en una forma muy aproximada, la abstracción de registros se puede representar mediante las siguientes clases: <br><br><img src="https://habrastorage.org/webt/pi/kr/-s/pikr-sq7lnpo9c6uilrmghdzd5a.png" alt="imagen"><br><br>  Además de las clases, también es importante para nosotros que los registros y los campos individuales tengan ciertas propiedades, el registro tiene una dirección, tamaño, modo de acceso (solo lectura, solo escritura o ambos). <br>  El campo tiene tamaño, desplazamiento y también modo de acceso.  Además, el campo debe contener un enlace al registro al que pertenece. <br><br>  El valor del campo debe tener un enlace al campo y un atributo adicional: el valor. <br><br>  Por lo tanto, en una versión más detallada, nuestra abstracción se verá así: <br><br><img src="https://habrastorage.org/webt/m4/3u/mb/m43umbc8vceiuila8_komovib38.png"><br><br>  Además de los atributos, nuestra abstracción debe tener métodos de modificación y acceso.  Por simplicidad, nos limitamos a los métodos de instalación / escritura y lectura. <br><br><img src="https://habrastorage.org/webt/uy/d7/sb/uyd7sb-z-tggllnj4knjf_rfhi4.png" alt="imagen"><br><br>  Cuando decidimos la abstracción de casos, debemos verificar cómo esta abstracción corresponde a lo que se describe en el archivo SVD. <br><br><h3>  Archivo de descripción de vista del sistema (SVD) </h3><br>  El formato de descripción de presentación del sistema CMSIS (CMSIS-SVD) es una descripción formal de los registros de microcontroladores basados ​​en el procesador ARM Cortex-M.  La información contenida en las descripciones de la representación del sistema, prácticamente corresponde a los datos en los manuales de referencia para dispositivos.  La descripción de los registros en dicho archivo puede contener información de alto nivel y el propósito de un solo bit del campo en el registro. <br><br>  Esquemáticamente, los niveles de detalle en dicho archivo se pueden describir mediante el siguiente esquema, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tomado en el sitio web de Keil</a> : <br><br><img src="https://habrastorage.org/webt/1s/oq/6d/1soq6disxizzaj8hvyaovxs9_pm.png" alt="imagen"><br><br>  Descripción Los archivos SVD son suministrados por los fabricantes y se utilizan durante la depuración para mostrar información sobre el microcontrolador y los registros.  Por ejemplo, el IAR los usa para mostrar información en el panel Ver-&gt; Registros.  Los archivos mismos están en la carpeta Archivos de programa (x86) \ IAR Systems \ Embedded Workbench 8.3 \ arm \ config \ debugger. <br><br>  Clion de JetBrains también usa archivos svd para mostrar información de registro durante la depuración. <br><br>  Siempre puede descargar descripciones de los sitios del fabricante.  <a href="">Aquí puede tomar el archivo SVD para el microcontrolador STM32F411</a> <br><br>  En general, el formato SVD es un estándar que admiten los fabricantes.  Veamos cuáles son los niveles de descripción en SVD. <br><br>  En total, se distinguen 5 niveles, nivel de dispositivo, nivel de microcontrolador, nivel de registro, nivel de campo, nivel de valores enumerados. <br><br><ul><li>  <b>Nivel del dispositivo</b> : la descripción del nivel superior de la vista del sistema es el dispositivo.  En este nivel, se describen las propiedades relacionadas con el dispositivo en su conjunto.  Por ejemplo, el nombre, la descripción o la versión del dispositivo.  La unidad mínima direccionable, así como la profundidad de bits del bus de datos.  Los valores predeterminados para los atributos del registro, como el tamaño del registro, el valor de reinicio y los permisos de acceso, se pueden establecer para todo el dispositivo en este nivel y se heredan implícitamente en los niveles inferiores de descripción. </li><li>  <b>Nivel de microcontrolador:</b> la sección CPU describe el núcleo del microcontrolador y sus características.  Esta sección es obligatoria si el archivo SVD se usa para crear el archivo de encabezado del dispositivo. </li><li>  <b>Capa periférica</b> : un dispositivo periférico es una colección con nombre de registros.  Un dispositivo periférico se asigna a una dirección base específica en el espacio de direcciones del dispositivo. </li><li>  <b>Nivel de registro</b> : un registro es un recurso programable con nombre que pertenece a un dispositivo periférico.  Los registros se asignan a una dirección específica en el espacio de direcciones del dispositivo.  La dirección es relativa a la dirección periférica base.  Además, para el registro, se indica el modo de acceso (lectura / escritura). </li><li>  <b>Nivel de campo</b> : como se mencionó anteriormente, los registros se pueden dividir en partes de bits de diferente funcionalidad: campos.  Este nivel contiene los nombres de los campos que son únicos dentro del mismo registro, su tamaño, las compensaciones relativas al comienzo del registro, así como el modo de acceso. </li><li>  <b>El nivel de los valores de campo enumerados</b> : de hecho, estos son valores de campo con nombre que se pueden usar por conveniencia en C, C ++, D, etc. </li></ul><br>  De hecho, los archivos SVD son archivos xml normales con una descripción completa del sistema.  Hay convertidores de archivos svd a código C, por ejemplo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aquí</a> , que generan encabezados y estructuras compatibles con C para cada periferia y registro. <br><br>  También hay un analizador de archivos SVD <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cmsis-svd</a> escrito en Phyton que hace algo así como deserializar datos de un archivo en objetos de clase Phython, que luego se usan convenientemente en su programa de generación de código. <br><br>  Un ejemplo de la descripción del registro del microcontrolador STM32F411 se puede ver debajo del spoiler: <br><br><div class="spoiler">  <b class="spoiler_title">Ejemplo de registro CR1 temporizador TIM1</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">peripheral</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>TIM1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Advanced-timers<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupName</span></span></span><span class="hljs-tag">&gt;</span></span>TIM<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">baseAddress</span></span></span><span class="hljs-tag">&gt;</span></span>0x40010000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">baseAddress</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressBlock</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">offset</span></span></span><span class="hljs-tag">&gt;</span></span>0x0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">offset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">size</span></span></span><span class="hljs-tag">&gt;</span></span>0x400<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">size</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">usage</span></span></span><span class="hljs-tag">&gt;</span></span>registers<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">usage</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressBlock</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">registers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">register</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>CR1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">displayName</span></span></span><span class="hljs-tag">&gt;</span></span>CR1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">displayName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>control register 1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressOffset</span></span></span><span class="hljs-tag">&gt;</span></span>0x0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">addressOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">size</span></span></span><span class="hljs-tag">&gt;</span></span>0x20<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">size</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">access</span></span></span><span class="hljs-tag">&gt;</span></span>read-write<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">access</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resetValue</span></span></span><span class="hljs-tag">&gt;</span></span>0x0000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resetValue</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>CKD<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Clock division<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>ARPE<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Auto-reload preload enable<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>CMS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Center-aligned mode selection<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>5<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>DIR<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Direction<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>4<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>OPM<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>One-pulse mode<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>3<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>URS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Update request source<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>UDIS<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Update disable<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>CEN<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Counter enable<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span>0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitOffset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bitWidth</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fields</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">register</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">register</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Como puede ver, existe toda la información necesaria para nuestra abstracción, excepto la descripción de los valores de bits específicos de los campos. <br><br>  No todos los fabricantes quieren dedicar tiempo a una descripción completa de su sistema, por lo tanto, como puede ver, ST no quería describir los valores de campo y transfirió esta carga a los programadores de los clientes.  Pero TI se ocupa de sus clientes y describe el sistema por completo, incluidas las descripciones de los valores de campo. <br><br>  Lo anterior muestra que el formato de la descripción SVD es muy consistente con nuestra abstracción de casos.  El archivo contiene toda la información necesaria para describir completamente el registro. <br><br><h3>  Implementación </h3><br><h4>  Registrarse </h4><br>  Ahora que hemos hecho una abstracción del registro y tenemos una descripción de los registros en forma de svd de los fabricantes que es ideal para esta abstracción, podemos ir directamente a la implementación. <br><br>  Nuestra implementación debe ser tan efectiva como el código C y fácil de usar.  Me gustaría que el acceso a los registros se vea lo más claro posible, por ejemplo, así: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TIM1::CR1::CKD::DividedBy2::IsSet()) { TIM1::ARR::Set(<span class="hljs-number"><span class="hljs-number">10</span></span>_ms) ; TIM1::CR1::CEN::Enable::Set() ; }</code> </pre><br>  Recuerde que para acceder a la dirección de registro de enteros, debe usar reinterpret_cast: <br><br><pre> <code class="cpp hljs">*<span class="hljs-keyword"><span class="hljs-keyword">reinterpret_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *&gt;(<span class="hljs-number"><span class="hljs-number">0x40010000</span></span>) = (<span class="hljs-number"><span class="hljs-number">1U</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5U</span></span>) ;</code> </pre> <br>  La clase de registro ya se ha descrito anteriormente, debe tener una dirección, tamaño y modo de acceso, así como dos métodos <code>Get()</code> y <code>Set()</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      template&lt;uint32_t address, size_t size, typename AccessMode&gt; struct RegisterBase { static constexpr auto Addr = address ; using Type = typename RegisterType&lt;size&gt;::Type ; // Set     , //     __forceinline template&lt;typename T = AccessMode, class = typename std::enable_if_t&lt;std::is_base_of&lt;WriteMode, T&gt;::value&gt;&gt; inline static void Set(Type value) { *reinterpret_cast&lt;volatile Type *&gt;(address) = value ; } // Get    , //    ,    __forceinline template&lt;typename T = AccessMode, class = typename std::enable_if_t&lt;std::is_base_of&lt;ReadMode, T&gt;::value&gt;&gt; inline static Type Get() { return *reinterpret_cast&lt;volatile Type *&gt;(address) ; } } ;</span></span></code> </pre> <br>  Pasamos la dirección, la longitud del registro y el modo de acceso a los parámetros de la plantilla (también es una clase).  Usando el mecanismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SFINAE</a> , es decir, la <code>enable_if</code> enable_if, "desecharemos" las funciones de acceso <code>Set()</code> u <code>Get()</code> para los registros que no deberían admitirlas.  Por ejemplo, si el registro es de solo lectura, entonces pasaremos <code>ReadMode</code> tipo <code>ReadMode</code> al parámetro de plantilla, <code>enable_if</code> verificará si el acceso es el sucesor de <code>ReadMode</code> y, de lo contrario, creará un error controlado (no se puede mostrar el tipo T), y el compilador no incluirá el método <code>Set()</code> para tal registro.  Lo mismo ocurre con un registro destinado a escritura únicamente. <br><br>  Para el control de acceso usaremos las clases: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    struct WriteMode {}; struct ReadMode {}; struct ReadWriteMode: public WriteMode, public ReadMode {};</span></span></code> </pre> <br>  Los registros vienen en diferentes tamaños: 8, 16, 32, 64 bits. Para cada uno de ellos, establecemos nuestro tipo: <br><br><div class="spoiler">  <b class="spoiler_title">Tipo de registros según tamaño</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> size&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterType</span></span></span><span class="hljs-class"> {</span></span>} ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterType</span></span></span><span class="hljs-class">&lt;8&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterType</span></span></span><span class="hljs-class">&lt;16&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterType</span></span></span><span class="hljs-class">&lt;32&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterType</span></span></span><span class="hljs-class">&lt;64&gt; {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Type = <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> ; } ;</code> </pre> <br></div></div><br>  Después de eso, para el temporizador TIM1, puede definir el registro CR1 y, por ejemplo, el registro EGR de esta manera: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM1</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CR1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterBase&lt;<span class="hljs-number"><span class="hljs-number">0x40010000</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, ReadWriteMode&gt; { } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EGR</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterBase&lt;<span class="hljs-number"><span class="hljs-number">0x40010014</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, WriteMode&gt; { } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ TIM1::CR1::Set(<span class="hljs-number"><span class="hljs-number">10</span></span>) ; <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> reg = TIM1::CR1::Get() ; <span class="hljs-comment"><span class="hljs-comment">// ,     reg = TIM1::EGR::Get() }</span></span></code> </pre><br>  Como el compilador muestra el método <code>Get()</code> solo para los registros en los que el modo de acceso se hereda de <code>ReadMode</code> , y los métodos <code>Set()</code> para los registros en los que el modo de acceso se hereda de <code>WriteMode</code> , en caso de uso incorrecto de los métodos de acceso, recibirá un error en la etapa de compilación.  Y si utiliza herramientas de desarrollo modernas, como Clion, incluso en la etapa de codificación verá una advertencia del analizador de código: <br><br><img src="https://habrastorage.org/webt/vc/we/gu/vcwegu6a0vulgfcvzjkaum9ac4a.png" alt="imagen"><br><br>  Bueno, el acceso a los registros ahora se ha vuelto más seguro, nuestro código no le permite hacer cosas que son inaceptables para este registro, pero queremos ir más allá y referirnos no a todo el registro, sino a sus campos. <br><br><h4>  Campos </h4><br>  El campo en lugar de la dirección tiene un valor de desplazamiento relativo al comienzo del registro.  Además, para conocer la dirección o el tipo al que debe llevarse el valor del campo, debe tener un enlace al registro: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//        template&lt;typename Reg, size_t offset, size_t size, typename AccessMode&gt; struct RegisterField { using RegType = typename Reg::Type ; using Register = Reg ; static constexpr RegType Offset = offset ; static constexpr RegType Size = size ; using Access = AccessMode ; template&lt;typename T = AccessMode, class = typename std::enable_if_t&lt;std::is_base_of&lt;WriteMode, T&gt;::value&gt;&gt; static void Set(RegType value) { assert(value &lt; (1U &lt;&lt; size)) ; //CriticalSection cs ; //    RegType newRegValue = *reinterpret_cast&lt;RegType *&gt;(Register::Address) ; //       newRegValue &amp;= ~ (((1U &lt;&lt; size) - 1U) &lt;&lt; offset); //    newRegValue |= (value &lt;&lt; offset) ; //      *reinterpret_cast&lt;RegType *&gt;(Reg::Address) = newRegValue ; } __forceinline template&lt;typename T = AccessMode, class = typename std::enable_if_t&lt;std::is_base_of&lt;ReadMode, T&gt;::value&gt;&gt; inline static RegType Get() { return ((*reinterpret_cast&lt;RegType *&gt;(Reg::Address)) &amp; (((1U &lt;&lt; size) - 1U) &lt;&lt; offset)) &gt;&gt; offset ; } };</span></span></code> </pre> <br>  Después de eso, ya es posible hacer lo siguiente: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM1</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CR1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterBase&lt;<span class="hljs-number"><span class="hljs-number">0x40010000</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, ReadWriteMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CKD = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ARPE = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CMS = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DIR = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> OPM = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> URS = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UDIS = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CEN = RegisterField&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   CR1  9   1,  8  0 TIM1::CR1::CKD::Set(2U) ; auto reg = TIM1::CR1::CEN::Get() ; }</span></span></code> </pre><br>  Aunque todo se ve bastante bien en general, todavía no está del todo claro qué <code>TIM1::CR1::CKD::Set(2)</code> , ¿qué significan los dos mágicos pasados ​​a la función <code>Set()</code> ?  ¿Y qué significa el número devuelto por el <code>TIM1::CR1::CEN::Get()</code> ? <br><br>  Pase sin problemas a los valores de campo. <br><br><h4>  Valor del campo </h4><br>  La abstracción de un valor de campo es esencialmente también un campo, pero capaz de aceptar solo un estado.  Los atributos se agregan a la abstracción del campo: el valor real y un enlace al campo.  El método <code>Set()</code> para establecer el valor del campo es idéntico al método <code>Set()</code> para establecer el campo, excepto que el valor en sí no necesita pasar al método, se conoce de antemano, solo necesita establecerse.  Pero el método <code>Get()</code> no tiene ningún sentido; en cambio, es mejor verificar si este valor está establecido o no, reemplazar este método con el método <code>IsSet()</code> . <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//        template&lt;typename Field, typename Field::Register::Type value&gt; struct FieldValueBase { using RegType = typename Field::Register::Type ; template&lt;typename T = typename Field::Access, class = typename std::enable_if_t&lt;std::is_base_of&lt;WriteMode, T&gt;::value&gt;&gt; static void Set() { RegType newRegValue = *reinterpret_cast&lt;RegType *&gt;(Field::Register::Address) ; newRegValue &amp;= ~ (((1U &lt;&lt; Field::Size) - 1U) &lt;&lt; Field::Offset); newRegValue |= (value &lt;&lt; Field::Offset) ; *reinterpret_cast&lt;RegType *&gt;(Field::Register::Address) = newRegValue ; } __forceinline template&lt;typename T = typename Field::Access, class = typename std::enable_if_t&lt;std::is_base_of&lt;ReadMode, T&gt;::value&gt;&gt; inline static bool IsSet() { return ((*reinterpret_cast&lt;RegType *&gt;(Field::Register::Address)) &amp; static_cast&lt;RegType&gt;(((1U &lt;&lt; Field::Size) - 1U) &lt;&lt; Field::Offset)) == (value &lt;&lt; Field::Offset) ; } };</span></span></code> </pre> <br>  El campo de registro ahora se puede describir mediante un conjunto de sus valores: <br><br><div class="spoiler">  <b class="spoiler_title">Valores de los campos de registro CR1 del temporizador TIM1</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_CKD_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DividedBy1 = FieldValue&lt;TIM_CR_CKD_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DividedBy2 = FieldValue&lt;TIM_CR_CKD_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DividedBy4 = FieldValue&lt;TIM_CR_CKD_Values, <span class="hljs-number"><span class="hljs-number">2U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Reserved = FieldValue&lt;TIM_CR_CKD_Values, <span class="hljs-number"><span class="hljs-number">3U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_ARPE_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ARRNotBuffered = FieldValue&lt;TIM_CR_ARPE_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ARRBuffered = FieldValue&lt;TIM_CR_ARPE_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_CMS_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CenterAlignedMode0 = FieldValue&lt;TIM_CR_CMS_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CenterAlignedMode1 = FieldValue&lt;TIM_CR_CMS_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CenterAlignedMode2 = FieldValue&lt;TIM_CR_CMS_Values, <span class="hljs-number"><span class="hljs-number">2U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CenterAlignedMode3 = FieldValue&lt;TIM_CR_CMS_Values, <span class="hljs-number"><span class="hljs-number">3U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_DIR_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Upcounter = FieldValue&lt;TIM_CR_DIR_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Downcounter = FieldValue&lt;TIM_CR_DIR_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_OPM_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ContinueAfterUEV = FieldValue&lt;TIM_CR_OPM_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> StopAfterUEV = FieldValue&lt;TIM_CR_OPM_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_URS_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Any = FieldValue&lt;TIM_CR_URS_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Overflow = FieldValue&lt;TIM_CR_URS_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_UDIS_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Enable = FieldValue&lt;TIM_CR_UDIS_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Disable = FieldValue&lt;TIM_CR_UDIS_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; } ; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM_CR_CEN_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Disable = FieldValue&lt;TIM_CR_CEN_Values, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Enable = FieldValue&lt;TIM_CR_CEN_Values, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; } ;</code> </pre><br></div></div><br>  Entonces el registro CR1 ya se describirá de la siguiente manera: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM1</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CR1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterBase&lt;<span class="hljs-number"><span class="hljs-number">0x40010000</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, ReadWriteMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CKD = TIM_CR1_CKD_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ARPE = TIM_CR1_ARPE_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CMS = TIM_CR1_CMS_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DIR = TIM_CR1_DIR_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> OPM = TIM_CR1_OPM_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> URS = TIM_CR1_URS_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UDIS = TIM_CR1_UDIS_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CEN = TIM_CR1_CEN_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode&gt; ; } ; }</code> </pre><br>  Ahora puede establecer y leer directamente el valor del campo de registro: por ejemplo, si desea habilitar el temporizador en la cuenta, simplemente llame al método <code>Set()</code> en el valor <code>Enable</code> del campo CEN del registro CR1 del temporizador TIM1: <code>TIM1::CR1::CEN::Enable::Set() ;</code>  .  En el código, se verá así: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TIM1::CR1::CKD::DividedBy2::IsSet()) { TIM1::ARR::Set(<span class="hljs-number"><span class="hljs-number">100U</span></span>) ; TIM1::CR1::CEN::Enable::Set() ; } }</code> </pre><br><div class="spoiler">  <b class="spoiler_title">A modo de comparación, lo mismo con el encabezado C:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((TIM1-&gt;CR1 &amp; TIM_CR1_CKD_Msk) == TIM_CR1_CKD_0) { TIM1-&gt;ARR = <span class="hljs-number"><span class="hljs-number">100U</span></span> ; regValue = TIM1-&gt;CR1 ; regValue &amp;=~(TIM_CR1_CEN_Msk) ; regValue |= TIM_CR1_CEN ; TIM1-&gt;CR1 = regValue ; } }</code> </pre><br></div></div><br>  Entonces, se realizan las principales mejoras, podemos tener acceso simple y comprensible al registro, sus campos y valores.     ,   ,        ,      ,     . <br><br>      ,        . ,    : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> regValue = TIM1-&gt;CR1 ; regValue &amp;=~(TIM_CR1_CKD_Msk | TIM_CR1_DIR) ; regValue |= (TIM_CR1_CEN | TIM_CR1_CKD_0 | TIM_CR1_CKD_0) ; TIM1-&gt;CR1 = regValue ; }</code> </pre><br>          <code>Set(...)</code>    ,     ,     .  Es decir     : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// 1,      Set() TIM1::CR1::Set(TIM1::CR1::DIR::Upcounter, TIM1::CR1::CKD::DividedBy4, TIM1::CR1::CEN::Enable) ; // 2,     TIM1::CR1&lt;TIM1::CR1::DIR::Upcounter, TIM1::CR1::CKD::DividedBy4, TIM1::CR1::CEN::Enable&gt;::Set() ; }</span></span></code> </pre><br>                        ,        ,    ,    ,       . <br><br>      .      : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,          template&lt;uint32_t address, size_t size, typename AccessMode, typename ...Args&gt; class Register { private: ...</span></span></code> </pre><br>  ,        : <br><br><ol><li>       ,      . </li><li>           . </li></ol><br>    constexpr ,        : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,          template&lt;uint32_t address, size_t size, typename AccessMode, typename ...Args&gt; class Register { private: // ,    //     . __forceinline template&lt;typename T&gt; static constexpr auto GetIndividualMask() { Type result = T::Mask &lt;&lt; T::Offset ; return result ; } // ,    //       . static constexpr auto GetMask() { //       const auto values = {GetIndividualMask&lt;Args&gt;()...} ; Type result = 0UL; for (auto const v: values) { //       result |= v ; } return result ; } //    __forceinline template&lt;typename T&gt; static constexpr auto GetIndividualValue() { Type result = T::Value &lt;&lt; T::Offset ; return result ; } static constexpr auto GetValue() { const auto values = {GetIndividualValue&lt;Args&gt;()...}; Type result = 0UL; for (const auto v: values) { result |= v ; } return result ; } };</span></span></code> </pre><br>      <code>Set()</code>  <code>IsSet()</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,          template&lt;uint32_t address, size_t size, typename AccessMode, typename ...Args&gt; class Register { public: using Type = typename RegisterType&lt;size&gt;::Type; template&lt;typename T = AccessMode, class = typename std::enable_if_t&lt;std::is_base_of&lt;WriteMode, T&gt;::value&gt;&gt; static void Set() { Type newRegValue = *reinterpret_cast&lt;Type *&gt;(address) ; //GetMask()    ,     newRegValue &amp;= ~GetMask() ; //GetValue()    ,     newRegValue |= GetValue() ; //     *reinterpret_cast&lt;Type *&gt;(address) = newRegValue ; } template&lt;typename T = AccessMode, class = typename std::enable_if_t&lt;std::is_base_of&lt;ReadMode, T&gt;::value&gt;&gt; static bool IsSet() { Type newRegValue = *reinterpret_cast&lt;Type *&gt;(address) ; return ((newRegValue &amp; GetMask()) == GetValue()) ; } private: ...</span></span></code> </pre><br>  ,         : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,     TIM1::CR1 TIM1::CR1&lt;TIM2::CR1::Enabled, TIM1::CR2::OIS1::OC1OutputIs0&gt;::Set() ; }</span></span></code> </pre> <br> ,   - ,      ,    ,       ,   <code>FieldValueBaseType</code> .      ,          <code>FieldValueBaseType</code> : <br><br><div class="spoiler"> <b class="spoiler_title">       </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> address, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> FieldValueBaseType, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> ...Args&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Register</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-comment"><span class="hljs-comment">//     BaseType     FieldValueBaseType,    . __forceinline template&lt;typename T, class = typename std::enable_if_t&lt;std::is_same&lt;FieldValueBaseType, typename T::BaseType&gt;::value&gt;&gt; static constexpr auto GetIndividualMask() { Type result = T::Mask &lt;&lt; T::Offset ; return result ; } static constexpr auto GetMask() { const auto values = {GetIndividualMask&lt;Args&gt;()...} ; Type result = 0UL; for (auto const v: values) { result |= v ; } return result ; } //     BaseType     FieldValueBaseType,    . __forceinline template&lt;typename T, class = typename std::enable_if_t&lt;std::is_same&lt;FieldValueBaseType, typename T::BaseType&gt;::value&gt;&gt; static constexpr auto GetIndividualValue() { Type result = T::Value &lt;&lt; T::Offset ; return result ; } static constexpr auto GetValue() { const auto values = {GetIndividualValue&lt;Args&gt;()...}; Type result = 0UL; for (const auto v: values) { result |= v ; } return result ; } };</span></span></code> </pre><br></div></div><br>     ,  SFINAE         ,       ,  ,    ,  ,      . <br><br>    CR1  TIM1,   : <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM1</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TIM1CR1Base</span></span></span><span class="hljs-class"> {</span></span>} ; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CR1</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterBase&lt;<span class="hljs-number"><span class="hljs-number">0x40010000</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, ReadWriteMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CKD = TIM_CR_CKD_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ARPE = TIM_CR_ARPE_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CMS = TIM_CR_CMS_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> DIR = TIM_CR_DIR_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> OPM = TIM_CR_OPM_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> URS = TIM_CR_URS_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UDIS = TIM_CR_UDIS_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> CEN = TIM_CR_CEN_Values&lt;TIM1::CR1, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, ReadWriteMode, TIM1CR1Base&gt; ; } ; }</code> </pre> <br> ,          ,        .      ,        ,           ,        . <br><br>        ,     : <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     GPIOA //,    AHB1ENR RCC-&gt;APB1ENR |= RCC_AHB1ENR_GPIOAEN ; //    ,      RCC-&gt;AHB1ENR = RCC_AHB1ENR_GPIOAEN; //,  TIM1    APB2 RCC-&gt;APB1ENR |= RCC_APB1ENR_TIM2EN | RCC_APB2ENR_TIM1EN; // - ,        . auto result = GPIOA-&gt;BSRR ; if (result &amp; GPIO_BSRR_BS1) { //do something } //-     .   ... GPIOA-&gt;IDR = GPIO_IDR_ID5 ;</span></span></code> </pre></div></div><br>        : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     GPIOA // ,   APB1ENR   GPIOAEN RCC::APB1ENR::GPIOAEN::Enable::Set() ; // ,     GPIOA RCC::AHB1ENR::GPIOAEN::Enable::Set() ; // , RCC::APB2ENR::TIM1EN::Enable  //   APB1ENR RCC::APB1ENRPack&lt;RCC::APB1ENR::TIM2EN::Enable, RCC::APB2ENR::TIM1EN::Enable&gt;::Set(); // ,  BSRR    auto result = GPIOA::BSRR::Get() ; // ,  Reset    if (GPIOA::BSRR::BS1::Reset::IsSet()) { //do something } // ,       GPIOA::IDR::IDR5::On::Set() }</span></span></code> </pre><br>           ,    ,    . <br><br> ,   ,       ,     ? <br><br><h3>  </h3><br>      ,       ++,       ,             1  : <br><br><div class="spoiler"> <b class="spoiler_title">  :</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> res = RCC-&gt;AHB2ENR; res &amp;=~ RCC_AHB1ENR_GPIOAEN_Msk ; res |= RCC_AHB1ENR_GPIOAEN ; RCC-&gt;AHB2ENR = res ; res = GPIOA-&gt;MODER ; res &amp;=~ (GPIO_MODER_MODER5 | GPIO_MODER_MODER4 | GPIO_MODER_MODER1) ; res |= (GPIO_MODER_MODER5_0 | GPIO_MODER_MODER4_0 | GPIO_MODER_MODER1_0) ; GPIOA-&gt;MODER = res ; GPIOA-&gt;BSRR = (GPIO_BSRR_BS5 | GPIO_BSRR_BS4 | GPIO_BSRR_BS1) ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title">  ++:</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ RCC::AHB1ENR::GPIOAEN::Enable::Set() ; GPIOA::MODERPack&lt; GPIOA::MODER::MODER5::Output, GPIOA::MODER::MODER4::Output, GPIOA::MODER::MODER1::Output&gt;::Set() ; GPIOA::BSRRPack&lt; GPIOA::BSRR::BS5::Set, GPIOA::BSRR::BS4::Set, GPIOA::BSRR::BS1::Set&gt;::Write() ; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ; }</code> </pre><br></div></div><br>    IAR.    :      : <br><br>        : <br><br><img src="https://habrastorage.org/webt/w-/wu/ln/w-wulnrmu5wg5pdby7qzzkxfdl8.png" alt="imagen"><br><br>   C++     : <br><br><img src="https://habrastorage.org/webt/wz/da/sf/wzdasflo3-fmkqsiq4lbtsbgf6g.png" alt="imagen"><br><br> 18         ,     ,       . <br><br>    ,   : <br><br><img src="https://habrastorage.org/webt/xm/m2/ac/xmm2actwv_1w6m_hqnbhsccg6xe.png" alt="imagen"><br><br>      13  . <br><br>    ++   : <br><br><img src="https://habrastorage.org/webt/qa/ic/a-/qaica-alj0danc4ffbmhyc2livs.png" alt="imagen"><br><br>    :  ,      . <br><br>      ,   .      ,       ? <br><br><h3>     </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tenemos acceso confiable, conveniente y rápido a los registros. </font><font style="vertical-align: inherit;">Queda una pregunta. </font><font style="vertical-align: inherit;">Cómo describir todos los registros, también hay menos de cien para el microcontrolador. </font><font style="vertical-align: inherit;">Este es el tiempo que lleva describir todos los registros, porque puede cometer muchos errores en un trabajo tan rutinario. </font><font style="vertical-align: inherit;">Sí, no necesita hacer esto manualmente. </font><font style="vertical-align: inherit;">En su lugar, utilizaremos el generador de código del archivo SVD, que, como indiqué anteriormente al principio del artículo, cubre completamente la abstracción de registro que acepté. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finalicé el guión de un colega, que, en base a esta idea, hizo casi lo mismo, pero un poco más fácil usando enum en lugar de clases para valores de campo. </font><font style="vertical-align: inherit;">El script está hecho solo para probar y verificar ideas, por lo tanto, no es óptimo, pero le permite generar algo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">como esto. </font></font></a> <br><img src="https://habrastorage.org/webt/jq/0h/kj/jq0hkj-s5u4jyou1-luv7bhlasy.png" alt="imagen"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A quién le importa el guión está </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aquí</font></font></a> <br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Resumen </font></font></h3><br>  ,      ,     .      ,   gpioa  rcc,       : <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"gpioaregisters.hpp"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//for GPIOA #include "rccregisters.hpp" //for RCC int main() { RCC::AHB1ENR::GPIOAEN::Enable::Set() ; GPIOA::MODER::MODER15::Output::Set() ; GPIOA::MODERPack&lt; GPIOA::MODER::MODER12::Output, GPIOA::MODER::MODER14::Analog &gt;::Set() ; }</span></span></span></span></code> </pre><br> , SVD      ,     ,        . <br><br> ,     ,       ,       SVD  , -   ST   ,     : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> BaseType&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GPIOA_MODER_MODER_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Value0 = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Value1 = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Value2 = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">2U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Value3 = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">3U</span></span>&gt; ; } ;</code> </pre> <br>       ,        Value,  -  : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Reg, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> offset, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> size, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> AccessMode, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> BaseType&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GPIOA_MODER_MODER_Values</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> RegisterField&lt;Reg, offset, size, AccessMode&gt; { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Input = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">0U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Output = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">1U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Alternate = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">2U</span></span>&gt; ; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Analog = FieldValue&lt;GPIOA_MODER_MODER_Values, BaseType, <span class="hljs-number"><span class="hljs-number">3U</span></span>&gt; ; } ;</code> </pre> <br>           . <br><br>  ,  ST         ,      0. <br><br>  ,  ,            enum . <br><br>  ,     . <br><br>   IAR 8.40.1  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> <br>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">« Online GDB»</a> <br><br> PS:  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">putyavka</a>      <code>RegisterField::Get()</code> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">Ryppka</a>     assert. <br><br><h3>       </h3><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Typesafe Register Access in C++</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">One Approach to Using Hardware Registers in C++</a> <br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SVD Description (*.svd) Format</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/459642/">https://habr.com/ru/post/459642/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459626/index.html">Windows Notification Facility: la superficie de ataque más indocumentada</a></li>
<li><a href="../459628/index.html">La Red de Invención Abierta tiene más de tres mil licenciatarios, ¿qué significa para el software de código abierto?</a></li>
<li><a href="../459630/index.html">Tic Tac Toe Parte 2: Deshacer / Rehacer sin estado</a></li>
<li><a href="../459638/index.html">Crear una base de conocimiento global sobre baterías</a></li>
<li><a href="../459640/index.html">Documentos como código. Parte 1: automatizar la actualización</a></li>
<li><a href="../459644/index.html">Atenuadores LED</a></li>
<li><a href="../459648/index.html">Todo debería estar bien en el analizador: tanto la funcionalidad como la interfaz ... Estamos explorando la nueva interfaz Solar appScreener 3.1</a></li>
<li><a href="../459650/index.html">Cómo no perder dinero en la caja negra: métodos de prueba de facturación</a></li>
<li><a href="../459652/index.html">Enfoque de prueba de regresión automatizada</a></li>
<li><a href="../459656/index.html">Servicio OData sin escribir código</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>