<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¥ üå°Ô∏è ü•© Usamos o Node.js para trabalhar com arquivos grandes e conjuntos de dados brutos. ‚úåüèº ü§±üèº üåæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta postagem √© uma tradu√ß√£o do artigo original de Paid Nidrinhouse, engenheiro de software de pilha completa. Sua principal especialidade √© o JavaScr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Usamos o Node.js para trabalhar com arquivos grandes e conjuntos de dados brutos.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/skillbox/blog/427415/"><img src="https://cdn.lynda.com/course/612195/612195-636458390742664213-16x9.jpg"><br><br>  Esta postagem √© uma tradu√ß√£o do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo</a> original <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">de</a> Paid Nidrinhouse, engenheiro de software de pilha completa.  Sua principal especialidade √© o JavaScript, mas Paige tamb√©m estuda outras linguagens e estruturas.  E ele compartilha sua experi√™ncia com seus leitores.  A prop√≥sito, o artigo ser√° interessante para iniciantes. <br><br>  Recentemente, me deparei com uma tarefa que me interessava - era necess√°rio extrair certos dados do enorme volume de arquivos n√£o estruturados da Comiss√£o Federal de Elei√ß√µes dos EUA.  Como n√£o trabalhei muito com dados brutos, decidi aceitar o desafio e assumir essa tarefa.  Como ferramenta para resolv√™-lo, escolhi o Node.js. <br><a name="habracut"></a><br><blockquote>  <b>A Skillbox recomenda:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O</a> curso on-line <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Profiss√£o Frontend Developer</a> . <br><br>  <b>Lembramos que:</b> <i>para todos os leitores de "Habr" - um desconto de 10.000 rublos ao se inscrever em qualquer curso Skillbox usando o c√≥digo promocional "Habr".</i> </blockquote><br>  A tarefa foi descrita em quatro pontos: <br><ul><li>  O programa deve calcular o n√∫mero total de linhas no arquivo. </li><li>  Cada oitava coluna cont√©m o nome de uma pessoa.  Voc√™ precisa carregar esses dados e criar uma matriz com todos os nomes contidos no arquivo.  √â necess√°rio exibir o nome 432¬∫ e 43,243¬∫. </li><li>  Cada quinta coluna cont√©m a data da doa√ß√£o pelos volunt√°rios.  Conte quantas doa√ß√µes totais s√£o feitas a cada m√™s e imprima o resultado total. </li><li>  Cada oitava coluna cont√©m o nome de uma pessoa.  Crie uma matriz selecionando apenas o primeiro nome, sem o sobrenome.  Descubra qual nome √© encontrado com mais frequ√™ncia e quantas vezes? </li></ul><br>  (A tarefa original pode ser <a href="">visualizada aqui neste link</a> .) <br><br>  O arquivo com o qual voc√™ precisa trabalhar √© um .txt regular de 2,55 GB.  H√° tamb√©m uma pasta que cont√©m partes do arquivo principal (voc√™ pode depurar o programa nelas sem precisar analisar toda a enorme variedade). <br><br><h3>  Duas solu√ß√µes poss√≠veis no Node.js </h3><br>  Em princ√≠pio, trabalhar com arquivos grandes n√£o assusta um especialista em JavaScript.  Al√©m disso, esta √© uma das principais fun√ß√µes do Node.js.  Existem v√°rias solu√ß√µes poss√≠veis para ler e gravar em arquivos. <br><br>  O familiar √© fs.readFile ().  Ele permite que voc√™ leia o arquivo inteiro, coloque-o na mem√≥ria e use o Node. <br><br>  Uma alternativa √© fs.createReadStream (), uma fun√ß√£o que transmite dados semelhantes √† forma como s√£o organizados em outras linguagens - por exemplo, em Python ou Java. <br><br><h3>  A solu√ß√£o que eu escolhi </h3><br>  Como eu precisava calcular o n√∫mero total de linhas e analisar os dados para analisar nomes e datas, decidi parar na segunda op√ß√£o.  Aqui eu poderia usar a fun√ß√£o rl.on ('line', ...) para obter os dados necess√°rios a partir das linhas. <br><br>  C√≥digo Node.js CreateReadStream () e ReadFile () <br><br>  Abaixo est√° o c√≥digo que escrevi usando o Node.js e a fun√ß√£o fs.createReadStream (). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abf/204/974/abf204974b1bef6c81c2c6eca0422810.png"><br><br>  Inicialmente, eu precisava configurar tudo, percebendo que a importa√ß√£o de dados requer fun√ß√µes do Node.js. como fs (sistema de arquivos), linha de leitura e fluxo.  Em seguida, consegui criar um fluxo interno e um fluxo externo junto com readLine.createInterface ().  O c√≥digo resultante tornou poss√≠vel analisar o arquivo linha por linha, levando os dados necess√°rios. <br><br>  Al√©m disso, adicionei v√°rias vari√°veis ‚Äã‚Äãe coment√°rios para trabalhar com dados espec√≠ficos.  Estes s√£o lineCount, dupeNames e matrizes de nomes, doa√ß√£o e firstNames. <br><br>  Na fun√ß√£o rl.on ('line', ...), consegui definir a an√°lise de arquivos linha por linha.  Ent√£o, entrei na vari√°vel lineCount para cada linha.  Usei o m√©todo JavaScript split () para analisar nomes adicionando-os √† minha matriz de nomes.  Em seguida, separei apenas nomes sem sobrenome, destacando exce√ß√µes, como a presen√ßa de nomes duplos, iniciais no meio do nome etc.  Em seguida, separei o ano e a data da coluna de dados, convertendo tudo isso no formato AAAA-MM e adicionando o dateDonationCount √† matriz. <br><br>  Na fun√ß√£o rl.on ('close', ...), realizei todas as transforma√ß√µes dos dados adicionados √†s matrizes, com as informa√ß√µes recebidas no console.log. <br><br>  lineCount e nomes s√£o necess√°rios para determinar os nomes 432 e 43 433; n√£o s√£o necess√°rias convers√µes aqui.  Mas a identifica√ß√£o do nome mais comum na matriz e a determina√ß√£o do n√∫mero de doa√ß√µes s√£o tarefas mais complicadas. <br><br>  Para identificar o nome mais comum, tive que criar um objeto de pares de valores para cada nome (chave) e o n√∫mero de refer√™ncias a Object.entries ().  (valor) e depois converta tudo isso em uma matriz de matrizes usando a fun√ß√£o ES6.  Depois disso, a tarefa de classificar nomes e identificar os mais duplicados n√£o era mais dif√≠cil. <br><br>  Com as doa√ß√µes, fiz o mesmo truque: criei um objeto de pares de valores e a fun√ß√£o logDateElements (), que me permitiu, usando a interpola√ß√£o ES6, exibir as chaves e os valores de cada m√™s.  Em seguida, criei o novo Map (), convertendo o objeto dateDonations em um metamarray e passei por cada matriz usando logDateElements ().  (Acabou n√£o sendo t√£o simples como parecia no come√ßo.) <br><br>  Mas funcionou, consegui ler um arquivo relativamente pequeno de 400 MB, destacando as informa√ß√µes necess√°rias. <br><br>  Depois disso, tentei fs.createReadStream () - implementei a tarefa em fs.readFile () para ver a diferen√ßa.  Aqui est√° o c√≥digo: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/a88/bb4/7ada88bb45dccc0c25dbb1b68c395954.png"><br><br>  Voc√™ pode ver toda a solu√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br><br><h3>  Resultados do trabalho com Node.js </h3><br>  A solu√ß√£o acabou funcionando.  Adicionei o caminho ao arquivo readFileStream.js e ... assisti o servidor Node travar com um erro de falta de mem√≥ria na pilha do JavaScript. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/068/398/a34/068398a34e2711c9741e7cddd12cc360.png"><br><br>  Aconteceu que, embora tudo funcionasse, mas essa solu√ß√£o tentou transferir todo o conte√∫do do arquivo para a mem√≥ria, o que era imposs√≠vel com uma capacidade de 2,55 GB.  O Node pode trabalhar simultaneamente com 1,5 GB de mem√≥ria, n√£o mais. <br><br>  Portanto, nenhuma das minhas decis√µes surgiu.  Foi preciso um novo que pudesse funcionar mesmo com esses arquivos volumosos. <br><br><h3>  Nova solu√ß√£o </h3><br>  Como se viu, era necess√°rio usar o popular m√≥dulo NPM EventStream. <br><br>  Tendo estudado a documenta√ß√£o, pude entender o que precisa ser feito.  Aqui est√° a terceira vers√£o do c√≥digo do programa. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f4f/66f/007/f4f66f007743c8fcf4d31f3699839419.png"><br><br>  A documenta√ß√£o do m√≥dulo indicava que o fluxo de dados deve ser dividido em elementos separados usando o caractere \ n no final de cada linha do arquivo txt. <br><br>  Basicamente, a √∫nica coisa que tive que mudar foi a resposta dos nomes.  N√£o pude colocar 130 milh√µes de nomes na matriz - o erro de falta de mem√≥ria apareceu novamente.  Resolvi o problema calculando os nomes 432 e 43 433 e os adicionando √† minha pr√≥pria matriz.  Um pouco, n√£o o que foi pedido nas condi√ß√µes, mas quem disse que voc√™ n√£o pode ser criativo? <br><br><h3>  Rodada 2. Tentamos o programa no trabalho </h3><br>  Sim, todo o mesmo arquivo com um volume de 2,55 GB, cruzamos os dedos e seguimos o resultado. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e80/665/c38/e80665c386ede41e173fd684b731999e.png"><br><br>  Sucesso! <br><br>  Como se viu, apenas o Node.js n√£o √© adequado para resolver esses problemas, seus recursos s√£o um pouco limitados.  Mas expandindo-os usando m√≥dulos, voc√™ pode trabalhar com arquivos t√£o grandes. <br><br><blockquote>  <b>A Skillbox recomenda:</b> <br><br><ul><li>  Curso pr√°tico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Profiss√£o de desenvolvedor web"</a> . </li><li>  Curso pr√°tico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"Mobile Developer PRO"</a> . </li><li>  Curso anual pr√°tico <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"PHP-developer from scratch to PRO"</a> . </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt427415/">https://habr.com/ru/post/pt427415/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt427403/index.html">API ReportingObserver: uma an√°lise do c√≥digo das p√°ginas da web sob uma nova perspectiva</a></li>
<li><a href="../pt427405/index.html">ES2018 - finalmente promete m√©todo</a></li>
<li><a href="../pt427407/index.html">Meta-agrupamento com minimiza√ß√£o de erros e por que acho que o c√©rebro funciona dessa maneira</a></li>
<li><a href="../pt427409/index.html">O livro "O brilhante √°gil. Gerenciamento flex√≠vel de projetos com Agile, Scrum e Kanban ¬ª</a></li>
<li><a href="../pt427413/index.html">Lutando por recursos, parte 4: √ìtimo</a></li>
<li><a href="../pt427417/index.html">Com humor, cerca de disquetes de 20 cm (nos anos 70 existiam apenas)</a></li>
<li><a href="../pt427419/index.html">O que fazer quando o processador n√£o tem nada para fazer?</a></li>
<li><a href="../pt427421/index.html">Como os sites de genealogia facilitam a captura de assassinos</a></li>
<li><a href="../pt427423/index.html">City2Share: carros e- e aut√¥nomos nos centros log√≠sticos de Munique</a></li>
<li><a href="../pt427427/index.html">Como eles chegam √† TI: sobre estagi√°rios e vendedores (o resultado da pesquisa ‚ÄúMy Circle‚Äù)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>