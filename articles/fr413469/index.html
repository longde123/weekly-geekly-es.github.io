<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úä üßëüèø‚Äçü§ù‚Äçüßëüèª ü§ôüèª Un test de m√©moire tuant des ordinateurs portables est presque une histoire de d√©tective üë©üèΩ‚Äçü§ù‚Äçüë©üèª üñïüèæ üìñ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="(UPD: en plus des sch√©mas, une photo de la planche est ajout√©e) 
 (UPD2: informations du canal IRC libreboot) 


- RINKAN a une protection de courant ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un test de m√©moire tuant des ordinateurs portables est presque une histoire de d√©tective</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/413469/"><p>  <strong>(UPD: en plus des sch√©mas, une photo de la planche est ajout√©e)</strong> <br>  <strong>(UPD2: informations du canal IRC libreboot)</strong> </p><br><ul><li>  RINKAN a une protection de courant de 55mA, la fonctionnalit√© peut √™tre trouv√©e dans la description sur TB62501F. </li><li>  PMH7 est un ensemble de portes ("la m√™me chose que FPGA vient d'√™tre programm√© avec jusqu'√† 3 couches m√©talliques, un peu comme maskrom"), pour Toshiba, il s'appelait TC-200G </li><li>  Le PMH7 est connect√© non seulement √† l'EC, mais √©galement √† l'ICH via le bus LPC et ressemble du point de vue de l'h√¥te √† un extenseur GPIO. </li><li>  Ils sont s√ªrs que les broches PMH inutilis√©es pendent vraiment dans l'air, et une fermeture de broche ne br√ªlera probablement que les sorties PMH, mais pas LDO </li><li>  Ils sugg√®rent une panne spontan√©e de deux RINKAN pour des raisons ind√©pendantes l'une de l'autre (√©ventuellement provoqu√©e par le chauffage de la carte m√®re lors du memtest) </li><li>  Ils recommandent de changer RINKAN pour la m√™me puce de ROHM: BD4175KVT-BD4176KVT-BD41760KVT, co√ªte environ 2 $ </li><li>  Nous convenons que vous devez effectuer une exp√©rience pour ex√©cuter memtest avec une limite actuelle </li></ul><br><p>  R√©cemment, nous avons eu une histoire d√©chirante - deux ordinateurs portables Lenovo T500 sont morts en une matin√©e.  L'un serait mort - personne n'a m√™me commenc√© √† comprendre.  Mais deux en un matin - c'est trop!  De plus, au moins l'un d'entre eux (et cela est confirm√© par trois utilisateurs!) A fonctionn√© normalement jusqu'√† la derni√®re minute, a √©t√© √©teint par le bouton d'alimentation, transf√©r√© √† 100 m√®tres de la salle de conversation et ... ne s'est pas allum√©. </p><br><p>  Naturellement, en premier lieu, toutes les m√©thodes de r√©animation artisanales ont √©t√© test√©es: remplacer la batterie, remplacer l'adaptateur secteur ... Retirer la batterie et d√©brancher l'alimentation, r√©initialiser le CMOS et ainsi de suite ... R√©sultat?  Exactement z√©ro - les ordinateurs portables √©taient toujours en briques. </p><br><p>  Ils ont commenc√© √† reconstituer l'image des √©v√©nements afin de trouver au moins un indice.  Il s'est av√©r√© ce qui suit: </p><a name="habracut"></a><br><ul><li>  √Ä J-1, de la m√©moire a √©t√© ajout√©e aux deux ordinateurs portables.  Apr√®s avoir remplac√© les lattes de m√©moire, les deux se sont allum√©es et ont fonctionn√© correctement jusqu'au soir </li><li>  La nuit du jour J, memtest a √©t√© lanc√© sur les deux ordinateurs (plus pr√©cis√©ment, memtest86 + 5.01-3 de la distribution Debian) </li><li>  Dans la matin√©e du jour "D", les deux ordinateurs ont √©t√© √©teints par le bouton d'alimentation et ne se sont pas allum√©s </li><li>  De plus, ils ont √©t√© bri√®vement connect√©s via le connecteur VGA au m√™me projecteur et au m√™me adaptateur secteur dans la pi√®ce </li></ul><br><p>  √âvidemment, la mort des ordinateurs portables doit √™tre li√©e √† l'une des trois choses: un adaptateur secteur, un projecteur ou un memtest.  Mais avec quoi exactement? </p><br><p>  Tout d'abord, nous avons v√©rifi√© le projecteur.  Ils n'ont pas trouv√© le crime, mais ont √©galement d√©couvert que ce jour-l√† (mais plus tard) d'autres ordinateurs portables y √©taient connect√©s, qui sont rest√©s en vie.  En second lieu, nous avons v√©rifi√© l'adaptateur secteur - il semblait sous-estimer la tension et il √©tait mis en quarantaine. </p><br><p>  Les ordinateurs portables ont √©t√© remis au service qui les a retourn√©s avec le r√©sultat suivant: "panne de la carte m√®re, pi√®ces d√©tach√©es manquantes!".  J'ai d√ª ouvrir la carcasse nous-m√™mes (l'avantage sur le r√©seau peut √™tre trouv√© √† la fois des sch√©mas et des manuels de service pour l'ancienne s√©rie Thinkpad). </p><br><p>  √Ä ce stade, tout le monde a commenc√© (√† titre d'exception) √† soup√ßonner la mort d'ordinateurs portables memtest.  Mais ce n'√©tait pas du tout √©vident - comment exactement?  En fin de compte, il y avait une chance que la mort des ordinateurs portables soit rare, d√©sagr√©able, mais reste une co√Øncidence.  Mais non!  Ou oui ... En g√©n√©ral, nous ne savons pas encore exactement. </p><br><p>  Ici, vous devriez faire une digression sur la construction du syst√®me de gestion de l'√©nergie sur le h√™tre IBM / Lenovo (au moins les anciennes s√©ries).  Dans les appareils plus simples, la gestion de l'alimentation est confi√©e soit au processeur / chipset, soit √† un contr√¥leur de carte m√®re sp√©cialis√© (contr√¥leur syst√®me, √©galement appel√© contr√¥leur int√©gr√©).  Relativement parlant, cette chose est responsable des fonctions r√©flexes et vert√©brales de l'ordinateur portable: commutation des sources de courant, alimentation par batterie, identification de la batterie / verrouillage du fournisseur, etc.  Mais pas chez IBM / Lenovo! </p><br><p>  Apparemment, les ing√©nieurs d'IBM pensaient que le micrologiciel EC pourrait contenir des erreurs ou que le contr√¥leur lui-m√™me se bloquerait soudainement.  Bien s√ªr, la CE a son propre chien de garde, mais ce n'est pas non plus une panac√©e.  Par cons√©quent, la responsabilit√© de la CE est uniquement de g√©n√©rer des signaux de commande de puissance de haut niveau.  Les touches de puissance d√©verrouillent et verrouillent deux microcircuits sp√©cialis√©s (et non sans r√©fl√©chir, mais en comparant les souhaits de la CE avec les lectures des capteurs de temp√©rature, la pr√©sence de la tension requise pour la prochaine √©tape sur les pneus, etc.).  Ces puces sont: RINKAN (d√©chiffrement inconnu) et PMH_7 (Power Management Hub rev7) </p><br><div class="spoiler">  <b class="spoiler_title">RINKAN √† l'int√©rieur</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/nu/bg/ox/nubgoxpbrihy0iguhtguefcnu44.png" alt="image"></p></div></div><br><p>  Veuillez noter que RINKAN n'a pas de sorties vers les bus CPU - en principe, il est inaccessible pour le processeur.  L'une des fonctions importantes (et non √©videntes) de RINKAN est la g√©n√©ration d'une tension stable de 3,3 V vers le bus VCC3SW (appelons-le le bus de d√©marrage).  Puisqu'il n'y a pas de self √† proximit√© - on peut supposer que ce r√©gulateur est construit dans un sch√©ma lin√©aire simple.  Autrement dit, quelque part √† l'int√©rieur se trouve un transistor avec un cerclage et avec sa r√©sistance active, il plante la puissance, ne laissant que 3,3 V.  Ce r√©gulateur est aliment√© par le pied VREGIN20, sur lequel toutes les sources d'alimentation de l'ordinateur portable (station d'accueil, adaptateur secteur, batterie principale et batterie ultrabay) sont connect√©es via des diodes.  Autrement dit, cela fonctionne toujours en g√©n√©ral (par cons√©quent, faible puissance - vous avez besoin d'un tr√®s petit courant de votre propre consommation!) </p><br><div class="spoiler">  <b class="spoiler_title">PMH_7 dans l'environnement de travail</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ne/rz/03/nerz03znxcvwq7q6fvmhm7ig5qm.png" alt="image"></p></div></div><br><p>  PMH est une puce plus intelligente.  Au minimum, elle a une connexion √† la CE via le bus SPI.  De plus, il active ou d√©sactive tout un tas de tensions et de signaux d'horloge sur la carte m√®re de l'ordinateur portable.  Les deux puces sont fabriqu√©es sur mesure, sans fiche technique.  √âtant donn√© que Lenovo / IBM utilise les m√™mes puces personnalis√©es pour diff√©rentes gammes de produits, certaines branches PMH ne sont pas utilis√©es dans le T500.  Cependant, il est peu probable qu'ils soient suspendus en l'air.  Les recommandations typiques sugg√®rent de tirer les fils inutilis√©s vers le circuit d'alimentation ou vers la terre.  N'oubliez pas cela. </p><br><p>  Malgr√© le manque de documentation, l'√©quipe du projet Coreboot (comparant les circuits portables des T60, T40 et des anciennes s√©ries d'ordinateurs portables - o√π les fonctions RINKAN / PMH √©taient encore r√©parties entre les microcircuits d'un degr√© d'int√©gration moindre) a accumul√© quelque chose d'int√©ressant.  PMH est disponible dans l'espace d'adressage de la CPU. <del>  Pas directement, bien s√ªr, mais via la CE - mais toujours disponibles! </del>  <strong>UPD: connect√© √† l'ICH via le bus LPC (Low pin count - analog of ISA).</strong>  Pour lever ou abaisser la jambe PMH, ils utilisent la s√©quence d'op√©rations suivante ( <a href="">pmh7.c</a> ): </p><br><pre><code class="cpp hljs">outb(reg, EC_LENOVO_PMH7_ADDR); val = inb(EC_LENOVO_PMH7_DATA); outb(reg, EC_LENOVO_PMH7_ADDR); outb(val | (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; bit), EC_LENOVO_PMH7_DATA);</code> </pre> <br><p>  Autrement dit, nous √©crivons d'abord le code de registre PMH dans le registre EC (mapp√© √† l'espace d'adressage CPU), puis nous pouvons lire ou √©crire son contenu.  Par exemple, nous voulons activer le r√©tro-√©clairage (55 PMH pied): nous √©crivons dans le registre 0x55 bit 2 - tout est simple. </p><br><p>  <strong>UPD: des coll√®gues du projet Libreboot consid√®rent le sc√©nario de court-circuit d√©crit par PMH improbable, en outre - la protection actuelle dans RINKAN aurait d√ª fonctionner √† 55mA</strong> </p><br><p>  Malheureusement, memtest fait √† peu pr√®s la m√™me chose - il lit et √©crit diff√©rentes valeurs dans diff√©rentes zones de la m√©moire.  Th√©oriquement, le BIOS doit d√©crire les zones de m√©moire r√©serv√©es aux p√©riph√©riques d'E / S.  Et memtest ne devrait rien √©crire l√†-bas - mais ... √©crit!  Et, apparemment, √† un moment donn√©, il a lev√© ou abaiss√© sa jambe PMH infructueuse.  En cons√©quence, via le transistor de pied de sortie PMH, le bus d'alimentation VCC3SW a √©t√© court-circuit√© √† la masse ... </p><br><p>  Que s'est-il pass√© ensuite?  Puis RINKAN a commenc√© √† se pr√©lasser.  Parce que le courant augmentait, le PMH en mode cl√© l'a tra√Æn√© sans aucun probl√®me, et le transistor semi-ouvert du LDO RINKAN empirait.  Mais ext√©rieurement, cela ne s'est manifest√© en aucune fa√ßon: dans un ordinateur portable allum√©, personne ne mange √† partir d'une source de faible puissance de 3,3 V, et l'alimentation est fournie par un puissant DC / DC sp√©cial alimentant les bus principaux 3,3 et 5 volts, respectivement. </p><br><p>  Eh bien, lorsque le bouton d'alimentation a √©t√© enfonc√©, les bus principaux ont √©t√© mis hors tension.  Il n'y avait plus de courant sur le bus de d√©marrage 3,3 V!  Et l'ordinateur portable s'est transform√© en <del>  citrouille </del>  brique. </p><br><p>  <strong>UPD: th√©orie alternative (omz + libreboot)</strong> </p><br><p>  Dans les centres de service, la tendance au crash de RINKAN est connue.  Les coll√®gues de Libreboot soutiennent en outre que cela est particuli√®rement vrai pour les contr√¥leurs Toshiba (et ROHM sera meilleur).  En cons√©quence, memtest √©tait compl√®tement innocent et une panne presque simultan√©e de deux ordinateurs portables s'est produite: </p><br><ul><li><p>  Ou pour des raisons ind√©pendantes les unes des autres (√©ventuellement provoqu√©es par le chauffage de la carte m√®re sous un long memtest) </p><br></li><li>  Ou un dysfonctionnement (bruit) dans la puissance de sortie de l'adaptateur, auquel (bien que pendant une courte p√©riode) les deux ordinateurs portables ont √©t√© connect√©s. </li></ul><br><p>  R√©sultats diagnostiques: </p><br><p>  Le premier ordinateur portable est une carte graphique double COR5SOPV3.  Sur le bus VCC3SW au lieu de 3,3, seulement 1,2 volts.  La r√©sistance √† la terre est d'environ 400 ohms.  Souder doucement et augmenter la sortie du convertisseur de tension RINKAN.  La r√©sistance du bus a imm√©diatement augment√© √† des centaines de kilo-ohms.  Ils ont appliqu√© une tension de 3,3 V √† partir d'une source externe - le h√™tre a pris vie. </p><br><div class="spoiler">  <b class="spoiler_title">Carte en cours de r√©paration</b> <div class="spoiler_text"><p>  La puce avec un autocollant blanc est un contr√¥leur int√©gr√©, au milieu avec des fils - RINKAN, le dernier sans autocollants - PMH. </p><br><p><img src="https://habrastorage.org/webt/1e/pl/j8/1eplj83_3g7qj5diwndcnm4hawq.jpeg" alt="image"></p></div></div><br><p>  En cons√©quence, nous avons s√©lectionn√© un LDO externe de faible puissance (LP2930-3.3), qui alimente le bus de d√©marrage au lieu de RINKAN.  Selon les r√©sultats du test, il a √©t√© constat√© que la mort clinique report√©e a laiss√© une empreinte sur la nature de l'appareil - l'ordinateur portable refuse de s'allumer si la batterie est ins√©r√©e mais l'adaptateur n'est pas ins√©r√©.  Si vous voulez l'allumer - retirez la batterie, allumez l'adaptateur secteur et ensuite la batterie peut √™tre r√©ins√©r√©e.  Toutes les autres fonctions (charge, autonomie de la batterie, veille, etc.) ne posent aucun probl√®me et c'est la seule fa√ßon de l'activer.  Ils n'ont pas pris la peine - ils ont d√©cid√© la question administrativement: utilisez le sommeil ou red√©marrez au lieu de fermer.  La premi√®re victime a eu de la chance! </p><br><p>  Et le second - non ... Il y a une carte C5ISOVP avec carte graphique int√©gr√©e - il n'y a aucune tension sur le bus et la r√©sistance √† la terre est de dizaines d'ohms.  Apr√®s avoir arrach√© la jambe, le VCC3SW ne s'est pas am√©lior√© - la m√™me faible r√©sistance selon VREGIN20.  Ils l'ont √©galement arrach√©, allum√© l'alimentation externe du bus de d√©marrage - ils ont vu 3,3 et 5 volts sur le principal.  Cependant, malgr√© un d√©marrage encourageant, les signaux Power-good ne sont pas apparus sur la sortie PMH / RINKAN et le syst√®me n'a pas pu d√©marrer.  Apparemment, la logique interne des microcircuits est endommag√©e, et cela n'est pas trait√© ... </p><br><p><del>  Il est tr√®s probable que memtest puisse tuer les ordinateurs portables de cette fa√ßon de la s√©rie T6x √† la s√©rie T420 / 520 inclus.  √Ä partir de T430 / 530, le mode de communication avec la CE a √©t√© modifi√© et l'√©criture dans les registres PMH est en principe impossible.  Peut-√™tre que seules certaines versions du micrologiciel BIOS ou EC sont affect√©es.  Un rapport de bogue a √©t√© √©crit pour les mainteneurs de paquets debian, peut-√™tre qu'ils peuvent trouver quelque chose en amont ... </del></p><br><p>  La raison exacte de l'√©chec des deux ordinateurs portables apr√®s le d√©marrage de memtest est inconnue.  Une exp√©rience qui peut √©tablir si memtest provoque une consommation de courant hors conception √† partir du bus d'alimentation de d√©marrage est pr√©vue, mais la date n'a pas encore √©t√© d√©termin√©e.  Nous rendrons √©galement compte des r√©sultats. </p><br><p>  Lorsque vous lancez memtest sur les ordinateurs portables de la s√©rie Lenovo T6x jusqu'au T420 / 520 inclus, vous devez consid√©rer les risques et avantages potentiels de cet √©v√©nement.  Dans le cas o√π vous ex√©cutez le test et qu'il n'a pas (ou n'a pas) caus√© le blocage ou le blocage de l'ordinateur portable - veuillez √©crire un commentaire dans le commentaire indiquant le mod√®le d'ordinateur portable et la dur√©e d'ex√©cution du test. </p><br><p>  C'est tout - bonne chance! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr413469/">https://habr.com/ru/post/fr413469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr413459/index.html">Le talent d'un recruteur informatique - en quoi les cr√©ateurs se distinguent-ils des artisans?</a></li>
<li><a href="../fr413461/index.html">ReactOS est devenu autosuffisant l'ann√©e de son 21e anniversaire</a></li>
<li><a href="../fr413463/index.html">API REST Magento 2 utilisant un module simple comme exemple</a></li>
<li><a href="../fr413465/index.html">AMD annonce Threadripper 2 √† 32 c≈ìurs</a></li>
<li><a href="../fr413467/index.html">Sauvegarde rapide et fiable des donn√©es dans le cloud</a></li>
<li><a href="../fr413471/index.html">Vendredi Mini Tomy Fancy Toy Retrospective</a></li>
<li><a href="../fr413473/index.html">D√©veloppement d'un interrupteur tactile Z-Wave sur la batterie avec boutons lumineux</a></li>
<li><a href="../fr413479/index.html">Nous √©crivons notre protocole sur UDP</a></li>
<li><a href="../fr413481/index.html">Exporter l'arbre de test de JMeter vers le texte</a></li>
<li><a href="../fr413485/index.html">Sortie de GitLab 10.8: mise en miroir push open source et d√©ploiement incr√©mentiel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>