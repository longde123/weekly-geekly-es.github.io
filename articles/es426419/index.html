<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéå ‚õΩÔ∏è üåßÔ∏è M√©todos de sobrecarga o puente prohibidos en Java üïö üëêüèΩ üíß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="La mayor√≠a de mis entrevistas sobre puestos t√©cnicos tienen una tarea en la que el candidato necesita implementar 2 interfaces muy similares en la mis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>M√©todos de sobrecarga o puente prohibidos en Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/haulmont/blog/426419/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ih/hs/hb/ihhshbtkwuq00zlpb7envgpgkk0.jpeg"></div><br><p>  La mayor√≠a de mis entrevistas sobre puestos t√©cnicos tienen una tarea en la que el candidato necesita implementar 2 interfaces muy similares en la misma clase: </p><br><p>  <em>Implemente ambas interfaces en una clase, si es posible.</em>  <em>Explica por qu√© esto es posible o no.</em> </p><br><pre><code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithPrimitiveInt</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WithInteger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer i)</span></span></span></span>; }</code> </pre> <br><p>  <em>De un traductor:</em> este art√≠culo no lo alienta a hacer las mismas preguntas en una entrevista.  Pero si desea estar completamente preparado cuando se le haga esta pregunta, entonces bienvenido a cat. </p><a name="habracut"></a><br><p>  A veces, los solicitantes que no est√°n muy seguros de la respuesta, prefieren resolver en lugar de este problema con la siguiente condici√≥n (m√°s tarde, en cualquier caso, le pido que la resuelva): </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span></span>; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span></span>; }</code> </pre> <br><p>  De hecho, la segunda tarea parece mucho m√°s simple, y la mayor√≠a de los candidatos responden que es imposible incluir ambos m√©todos en la misma clase, porque las firmas <code>Sm(int)</code> y <code>Vm(int)</code> mismas, mientras que el tipo del valor de retorno es diferente.  Y esto es absolutamente cierto. </p><br><p>  Sin embargo, a veces hago otra pregunta relacionada con este tema: </p><br><p>  <em>¬øCrees que tiene sentido permitir la implementaci√≥n de m√©todos con la misma firma pero diferentes tipos en la misma clase?</em>  <em>Por ejemplo, en alg√∫n lenguaje hipot√©tico basado en la JVM, o al menos en el nivel de la JVM?</em> </p><br><p>  Esta es una pregunta cuya respuesta es ambigua.  Pero, a pesar del hecho de que no espero una respuesta, existe la respuesta correcta.  Una persona que a menudo trata con la API de reflexi√≥n, manipula bytecode o est√° familiarizada con la especificaci√≥n JVM podr√≠a responderla. </p><br><h2 id="signatura-metoda-java-i-deskriptor-metoda-jvm">  Firma del m√©todo Java y manejador del m√©todo JVM </h2><br><p>  La firma del m√©todo Java (es decir, el nombre del m√©todo y los tipos de par√°metros) solo la utiliza el compilador Java en el momento de la compilaci√≥n.  A su vez, la JVM separa los m√©todos en la clase utilizando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nombre de m√©todo no calificado</a> (es decir, solo un nombre de m√©todo) y un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">identificador de m√©todo</a> , es decir, una lista de par√°metros de descriptor y un descriptor de retorno. </p><br><p>  Por ejemplo, si queremos llamar al m√©todo <code>String m(int i)</code> directamente en la clase <code>foo.Bar</code> , se requiere el siguiente <code>foo.Bar</code> : </p><br><pre> <code class="hljs julia">INVOKEVIRTUAL foo/Bar.m (<span class="hljs-literal"><span class="hljs-literal">I</span></span>)Ljava/lang/<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>;</code> </pre> <br><p>  y para nulo <code>m(int i)</code> siguiente: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">INVOKEVIRTUAL</span></span> foo/Bar.m (I)V</code> </pre> <br><p>  Por lo tanto, la JVM se siente bastante c√≥moda con <code>String m(int i)</code> y <code>void m(int i)</code> en la misma clase.  Todo lo que se necesita es generar el bytecode correspondiente. </p><br><h2 id="kung-fu-s-bayt-kodom">  Kung fu con bytecode </h2><br><p>  Tenemos interfaces S y V, ahora crearemos una clase SV que incluye ambas interfaces.  En Java, si se permitiera, deber√≠a verse as√≠: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SV</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">S</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">V</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"void m(int i)"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"String m(int i)"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }</code> </pre> <br><p>  Para generar el bytecode, usamos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca Objectweb ASM</a> , una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">biblioteca de</a> bajo nivel suficiente para tener una idea del bytecode JVM. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El c√≥digo fuente completo se</a> carga en GitHub, aqu√≠ dar√© y explicar√© solo los fragmentos m√°s importantes. </p><br><pre> <code class="java hljs">ClassWriter cw = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassWriter(ClassWriter.COMPUTE_FRAMES); <span class="hljs-comment"><span class="hljs-comment">// package edio.java.experiments // public class SV implements S, V cw.visit(V1_7, ACC_PUBLIC, "edio/java/experiments/SV", null, "java/lang/Object", new String[]{ "edio/java/experiments/S", "edio/java/experiments/V" }); // constructor MethodVisitor constructor = cw.visitMethod(ACC_PUBLIC, "&lt;init&gt;", "()V", null, null); constructor.visitCode(); constructor.visitVarInsn(Opcodes.ALOAD, 0); constructor.visitMethodInsn(Opcodes.INVOKESPECIAL, "java/lang/Object", "&lt;init&gt;", "()V"); constructor.visitInsn(Opcodes.RETURN); constructor.visitMaxs(1, 1); constructor.visitEnd(); // public String m(int i) MethodVisitor mString = cw.visitMethod(ACC_PUBLIC, "m", "(I)Ljava/lang/String;", null, null); mString.visitCode(); mString.visitFieldInsn(Opcodes.GETSTATIC, "java/lang/System", "out", "Ljava/io/PrintStream;"); mString.visitLdcInsn("String"); mString.visitMethodInsn(Opcodes.INVOKEVIRTUAL, "java/io/PrintStream", "println", "(Ljava/lang/String;)V"); mString.visitInsn(Opcodes.ACONST_NULL); mString.visitInsn(Opcodes.ARETURN); mString.visitMaxs(2, 2); mString.visitEnd(); // public void m(int i) MethodVisitor mVoid = cw.visitMethod(ACC_PUBLIC, "m", "(I)V", null, null); mVoid.visitFieldInsn(Opcodes.GETSTATIC, "java/lang/System", "out", "Ljava/io/PrintStream;"); mVoid.visitLdcInsn("void"); mVoid.visitMethodInsn(Opcodes.INVOKEVIRTUAL, "java/io/PrintStream", "println", "(Ljava/lang/String;)V"); mVoid.visitInsn(Opcodes.RETURN); mVoid.visitMaxs(2, 2); mVoid.visitEnd(); cw.visitEnd();</span></span></code> </pre> <br><p>  Comencemos creando un <code>ClassWriter</code> para generar bytecode. </p><br><p>  Ahora declararemos una clase que incluye las interfaces S y V. </p><br><p>  Aunque nuestro c√≥digo de pseudo-java de referencia para SV no tiene constructores, a√∫n necesitamos generar c√≥digo para √©l.  Si no describimos constructores en Java, el compilador genera impl√≠citamente un constructor vac√≠o. </p><br><p>  En el cuerpo de los m√©todos, comenzamos obteniendo el campo <code>System.out</code> del tipo <code>java.io.PrintStream</code> y agreg√°ndolo a la pila de operandos.  Luego cargamos la constante ( <code>String</code> o <code>void</code> ) en la pila y llamamos al comando <code>println</code> en la variable resultante con una constante de cadena como argumento. </p><br><p>  Finalmente, para <code>String m(int i)</code> agregamos la constante del tipo de referencia con el valor <code>null</code> a la pila y usamos la <code>return</code> tipo correspondiente, es decir, <code>ARETURN</code> , para devolver el valor al iniciador de la llamada al m√©todo.  Para <code>void m(int i)</code> debe usar <code>RETURN</code> tipo solo para volver al iniciador de la llamada al m√©todo sin devolver un valor.  Para asegurarnos de que el c√≥digo de bytes sea correcto (lo cual hago constantemente, corrigiendo errores muchas veces), escribimos la clase generada en el disco. </p><br><pre> <code class="java hljs">Files.write(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(<span class="hljs-string"><span class="hljs-string">"/tmp/SV.class"</span></span>).toPath(), cw.toByteArray());</code> </pre> <br><p>  y use <code>jad</code> (descompilador de Java) para traducir el bytecode nuevamente al c√≥digo fuente de Java: </p><br><pre> <code class="java hljs">$ jad -p /tmp/SV.class The <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">file</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">version</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is</span></span></span><span class="hljs-class"> 51.0 (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">only</span></span></span><span class="hljs-class"> 45.3, 46.0 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">and</span></span></span><span class="hljs-class"> 47.0 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">are</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">supported</span></span></span><span class="hljs-class">) // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decompiled</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">by</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jad</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">v1</span></span></span><span class="hljs-class">.5.8</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class">. </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Copyright</span></span></span><span class="hljs-class"> 2001 </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pavel</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Kouznetsov</span></span></span><span class="hljs-class">. // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Jad</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">home</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">page</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">www</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">geocities</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">kpdus</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jad</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class"> // </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decompiler</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">options</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">packimports</span></span></span><span class="hljs-class">(3) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">edio</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">experiments</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.PrintStream; <span class="hljs-comment"><span class="hljs-comment">// Referenced classes of package edio.java.experiments: // S, V public class SV implements S, V { public SV() { } public String m(int i) { System.out.println("String"); return null; } public void m(int i) { System.out.println("void"); } }</span></span></code> </pre> <br><p>  No est√° mal en mi opini√≥n. </p><br><h2 id="ispolzovanie-sgenerirovannogo-klassa">  Usando la clase generada </h2><br><p>  La descompilaci√≥n exitosa de <code>jad</code> esencialmente no nos garantiza nada.  La utilidad <code>jad</code> solo le alerta sobre problemas comunes en el c√≥digo de bytes, desde el tama√±o de trama hasta los desajustes de las variables locales o las declaraciones de retorno faltantes. </p><br><p>  Para usar la clase generada en tiempo de ejecuci√≥n, necesitamos cargarla de alguna manera en la JVM y luego instanciarla. </p><br><p>  Implementemos nuestro propio <code>AsmClassLoader</code> .  Esto es solo un √∫til contenedor para <code>ClassLoader.defineClass</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AsmClassLoader</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassLoader</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Class </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">defineAsmClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, ClassWriter classWriter)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] bytes = classWriter.toByteArray(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defineClass(name, bytes, <span class="hljs-number"><span class="hljs-number">0</span></span>, bytes.length); } }</code> </pre> <br><p>  Ahora use este cargador de clases e instancia la clase: </p><br><pre> <code class="java hljs">ClassWriter cw = SVGenerator.generateClass(); AsmClassLoader classLoader = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AsmClassLoader(); Class&lt;?&gt; generatedClazz = classLoader.defineAsmClass(SVGenerator.SV_FQCN, cw); Object o = generatedClazz.newInstance();</code> </pre> <br><p>  Como nuestra clase se genera en tiempo de ejecuci√≥n, no podemos usarla en el c√≥digo fuente.  Pero podemos emitir su tipo a interfaces implementadas.  Una llamada sin reflexi√≥n se puede hacer as√≠: </p><br><pre> <code class="java hljs">((S)o).m(<span class="hljs-number"><span class="hljs-number">1</span></span>); ((V)o).m(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><p>  Al ejecutar el c√≥digo, obtenemos el siguiente resultado: </p><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span></code> </pre> <br><p>  Para algunos, esta conclusi√≥n puede parecer inesperada: nos referimos al mismo m√©todo (desde el punto de vista de Java) en la clase, pero los resultados difieren dependiendo de la interfaz a la que llevamos el objeto.  Impresionante, ¬øverdad? </p><br><p>  Todo quedar√° claro si tenemos en cuenta el bytecode subyacente.  Para nuestra llamada, el compilador genera una instrucci√≥n INVOKEINTERFACE, y el identificador del m√©todo no proviene de la clase, sino de la interfaz. </p><br><p>  Por lo tanto, la primera llamada que recibimos: </p><br><pre> <code class="hljs lisp">INVOKEINTERFACE edio/java/experiments/Sm (<span class="hljs-name"><span class="hljs-name">I</span></span>)Ljava/lang/String<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br><p>  y en el segundo: </p><br><pre> <code class="hljs lisp">INVOKEINTERFACE edio/java/experiments/Vm (<span class="hljs-name"><span class="hljs-name">I</span></span>)V</code> </pre> <br><p>  El objeto en el que realizamos la llamada se puede obtener de la pila.  Este es el poder del polimorfismo inherente a Java. </p><br><h2 id="imya-emu---bridge-metod">  Su nombre es el m√©todo del puente. </h2><br><p>  Alguien preguntar√°: "Entonces, ¬øcu√°l es el punto de todo esto? ¬øSer√° √∫til alguna vez?" </p><br><p>  El punto es que usamos lo mismo (impl√≠citamente) cuando escribimos c√≥digo Java normal.  Por ejemplo, los tipos de retorno covariantes, los gen√©ricos y el acceso a campos privados desde clases internas se implementan utilizando la misma <em>magia del</em> c√≥digo <em>de</em> bytes. </p><br><p>  Echa un vistazo a esta interfaz: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Number </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  y su implementaci√≥n con el retorno del tipo covariante: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntegerZero</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } }</code> </pre> <br><p>  Ahora pensemos en este c√≥digo: </p><br><pre> <code class="java hljs">IntegerZero iz = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntegerZero(); iz.getZero(); ZeroProvider zp = iz; zp.getZero();</code> </pre> <br><p>  Para <code>iz.getZero()</code> , el compilador de llamadas generar√° <code>INVOKEVIRTUAL</code> con el m√©todo de manejo <code>()Ljava/lang/Integer;</code>  , mientras que para <code>zp.getZero()</code> generar√° INVOKEINTERFACE con el descriptor de m√©todo <code>()Ljava/lang/Number;</code>  .  Ya sabemos que la JVM despacha una llamada a un objeto utilizando el nombre y el descriptor del m√©todo.  Como los descriptores son diferentes, estas 2 llamadas no se pueden enrutar al mismo m√©todo en una instancia de <code>IntegerZero</code> . </p><br><p>  De hecho, el compilador genera un m√©todo adicional que act√∫a como un puente entre el m√©todo real especificado en la clase y el m√©todo utilizado al llamar a trav√©s de la interfaz.  Por lo tanto, el nombre es el m√©todo del puente.  Si esto fuera posible en Java, el c√≥digo final se ver√≠a as√≠: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntegerZero</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZero</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// This is a synthetic bridge method, which is present only in bytecode. // Java compiler wouldn't permit it. public Number getZero() { return this.getZero(); } }</span></span></code> </pre> <br><h2 id="posleslovie">  Ep√≠logo </h2><br><p>  El lenguaje de programaci√≥n Java y la m√°quina virtual Java no son lo mismo: aunque tienen una palabra com√∫n en el nombre y Java es el lenguaje principal para la JVM, sus capacidades y limitaciones distan mucho de ser siempre las mismas.  Conocer JVM le ayuda a comprender mejor Java o cualquier otro lenguaje basado en JVM, pero, por otro lado, conocer Java y su historia ayuda a comprender ciertas decisiones en el dise√±o de JVM. </p><br><h3 id="ot-perevodchika">  Del traductor </h3><br><p>  Los problemas de compatibilidad tarde o temprano comienzan a preocupar a cualquier desarrollador.  El art√≠culo original tocaba la importante cuesti√≥n del comportamiento impl√≠cito del compilador de Java y el efecto de su magia en las aplicaciones, lo que nos preocupa, como desarrolladores del marco de la plataforma CUBA, esto afecta directamente la compatibilidad de las bibliotecas.  M√°s recientemente, hablamos sobre la compatibilidad en aplicaciones de la vida real en JUG en Ekaterimburgo en el informe "Las API no cambian en el cruce: c√≥mo construir una API estable", el video de la reuni√≥n se puede encontrar aqu√≠. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/JLGh08KXN08" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426419/">https://habr.com/ru/post/es426419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426409/index.html">El hacker Alexei, que protege los enrutadores MikroTik sin el permiso de los propietarios, se ha hecho famoso.</a></li>
<li><a href="../es426411/index.html">Desarrollo de clases de descriptor C ++ / CLI</a></li>
<li><a href="../es426413/index.html">Principios S√ìLIDOS que todo desarrollador debe conocer</a></li>
<li><a href="../es426415/index.html">Fintech-digest: control de digitalizaci√≥n por parte del Banco Central, salario de criptomonedas, tarjeta Mir en forma de pulseras y llaveros</a></li>
<li><a href="../es426417/index.html">Pavel 2.0: consultor reptiloide en JS, node.js con sockets y telefon√≠a</a></li>
<li><a href="../es426421/index.html">EHCI humanamente en ruso</a></li>
<li><a href="../es426423/index.html">mmWave en tel√©fonos inteligentes: c√≥mo Qualcomm hizo posible lo imposible</a></li>
<li><a href="../es426425/index.html">Toda la verdad sobre RTOS. Art√≠culo # 14. Secciones de memoria: introducci√≥n y servicios b√°sicos.</a></li>
<li><a href="../es426427/index.html">Cosas √∫tiles para "cosas": una peque√±a selecci√≥n con precios bajos</a></li>
<li><a href="../es426429/index.html">Instalaci√≥n de FreeSWITCH 1.8 en Debian 9 (Raspbian Stretch, la imagen b√°sica del sistema MajorDoMo Smart Home en Rasbperri Pi)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>