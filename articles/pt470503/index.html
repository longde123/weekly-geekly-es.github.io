<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏇🏾 👈🏽 👧🏾 Usuários e autorização do Kubernetes RBAC 🥊 🕑 💅🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nota perev. : Continuando o tópico de segurança recentemente discutido para o Kubernetes em geral e o RBAC, em particular, estamos publicando uma trad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Usuários e autorização do Kubernetes RBAC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/470503/">  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: Continuando o tópico de segurança <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recentemente discutido</a> para o Kubernetes em geral e o RBAC, em particular, estamos publicando uma tradução desse material de um consultor francês da empresa Adaltas Big Data.</i>  <i>O autor mostra em detalhes como criar usuários, conceder direitos e continuar a servir.</i> <br><br>  Configurar e iniciar um cluster Kubernetes é apenas o começo: ele também precisa ser explorado.  Para proteger o acesso ao cluster, você precisa definir credenciais do usuário e gerenciar corretamente as configurações de autenticação e autorização. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m5/y9/az/m5y9azz-gbidcxue2_eesz-gvxo.png"></div>  <i>(Ilustração tirada do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">blog do CNCF</a> - aprox. Transl.)</i> <br><br>  Este artigo é sobre como criar usuários usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">certificados de</a> cliente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">X.509</a> e como gerenciar a autorização usando as APIs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RBAC</a> básicas no Kubernetes.  Também falaremos sobre alguns projetos de código aberto que simplificam a administração de cluster: rakkess, kubectl-who-can, rbac-lookup e RBAC Manager. <a name="habracut"></a><br><h2>  Condições prévias e premissas </h2><br>  Primeiro de tudo, é necessário fazer várias suposições: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pelo</a> menos você pode imaginar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">como o Kubernetes funciona</a> . </li><li>  Você tem um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cluster Kubernetes</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Minikube em funcionamento</a> . </li><li>  Você tem o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">utilitário da CLI kubectl instalado</a> . </li><li>  Você tem o pacote <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenSSL</a> instalado. </li></ul><cut></cut><br>  Se você não possui um cluster Kubernetes pronto, recomendo que você consulte o artigo de um colega (Arthur BUSSER) no qual ele fala sobre a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">instalação do Kubernetes no CentOS 7</a> usando o Vagrant. <br><br>  Existem 4 nós em nosso cluster: um mestre e três trabalhadores.  O assistente também será usado como um nó de borda para interagir com o cluster. <br><br><h2>  APIs RBAC </h2><br>  O controle de acesso baseado em função (RBAC) é um método para controlar o acesso a computadores e recursos de rede, com base nas funções de usuários individuais em uma empresa.  O RBAC pode ser usado com todos os recursos do Kubernetes compatíveis com CRUD (Criar, Ler, Atualizar, Excluir).  Exemplos de tais recursos: <br><br><ul><li>  namespaces </li><li>  Pods </li><li>  Implantações </li><li>  volumes persistentes (PersistentVolumes); </li><li>  ConfigMaps </li></ul><br>  E aqui estão exemplos de operações possíveis com eles: <br><br><ul><li>  <code>create</code> ; </li><li>  <code>get</code> </li><li>  <code>delete</code> <i>(excluir)</i> ; </li><li>  <code>list</code> <i>(exibição de</i> <code>list</code> <i>)</i> ; </li><li>  <code>update</code> . </li></ul><br>  Para gerenciar o RBAC no Kubernetes, precisamos declarar: <br><br><ul><li>  <b><code>Role</code> e <code>ClusterRole</code></b> .  Estes são simplesmente conjuntos de regras que representam um conjunto de permissões.  <code>Role</code> pode ser usada apenas para fornecer acesso aos recursos nos espaços para nome.  <code>ClusterRole</code> pode fornecer as mesmas permissões que o <code>Role</code> e também fornecer acesso aos recursos disponíveis em todo o cluster e aos chamados pontos de extremidade sem recurso <i>(como <code>/healthz</code> - aprox. Transl.)</i> . </li><li>  <b><code>Subjects</code></b>  Subject é uma entidade que executará operações em um cluster.  Pode ser usuários, serviços ou até grupos. </li><li>  <b><code>RoleBinding</code> e <code>ClusterRoleBinding</code></b> .  Como o nome indica, isso é simplesmente uma ligação do sujeito a Função ou ClusterRole. </li></ul><br>  O Kubernetes tem as seguintes funções padrão: <br><br><ul><li>  <code>view</code> : acesso somente leitura, exclui segredos; </li><li>  <code>edit</code> : o acima + a capacidade de editar a maioria dos recursos, exclui papéis e ligações de papéis; </li><li>  <code>admin</code> : acima + a capacidade de gerenciar funções e mapeamentos de funções no nível do espaço para nome; </li><li>  <code>cluster-admin</code> : todos os privilégios possíveis. </li></ul><br>  Obviamente, você pode criar suas próprias <code>Roles</code> e <code>ClusterRoles</code> , mas recomendamos que você use as funções padrão o máximo possível, sempre que a situação permitir.  Caso contrário, você pode rapidamente se confundir com tudo isso. <br><br><h2>  Exemplo de uso </h2><br>  Criaremos dois namespaces: <code>my-project-dev</code> e <code>my-project-prod</code> , - assim como dois usuários: <code>jean</code> e <code>sarah</code> - com funções diferentes nesses namespaces: <br><br><ul><li>  my-project-dev: <br><ul><li>  jean: editar </li></ul></li><li>  my-project-prod: <br><ul><li>  jean: visualizar </li><li>  sarah: editar </li></ul></li></ul><br><h3>  Criar e autenticar usuários usando certificados de cliente X.509 </h3><br>  Normalmente, existem dois tipos de usuários: <i>contas de serviço</i> gerenciadas pelo Kubernetes e usuários regulares.  Vamos nos concentrar no último.  Veja como eles são descritos na documentação oficial: <br><br><blockquote>  Supõe-se que usuários regulares sejam gerenciados por um serviço externo independente.  O papel pode ser desempenhado por um administrador que distribui chaves privadas, um repositório de usuários como Keystone ou Contas do Google ou mesmo um arquivo com uma lista de nomes de usuário e senhas.  Nesse sentido, o Kubernetes não possui objetos que representam usuários comuns.  Usuários comuns não podem ser adicionados ao cluster por meio de uma chamada de API. </blockquote><br>  Existem várias maneiras de gerenciar usuários regulares: <br><br><ul><li>  <i>Autenticação</i> básica: <ul><li>  transferir a configuração para o servidor API com o seguinte conteúdo (ou similar): senha, nome de usuário, uid, grupo; </li></ul></li><li>  Certificado de Cliente X.509: <ul><li>  criação da chave secreta de um usuário e solicitação de assinatura de certificado; </li><li>  certificação em uma autoridade de certificação (Kubernetes CA) para obter um certificado de usuário; </li></ul></li><li>  Tokens de portador (JSON Web Tokens, JWT): <ul><li>  OpenID Connect </li><li>  camada de autenticação sobre o OAuth 2.0; </li><li>  webhooks </li></ul></li></ul><br>  Neste artigo, usaremos os certificados X.509 e OpenSSL devido à sua simplicidade.  A criação de usuários ocorre em várias etapas - passaremos por todas elas.  As operações devem ser executadas na conta do usuário com privilégios de administrador do cluster (cluster-admin).  Aqui estão todas as etapas para criar um usuário (usando o <code>jean</code> como exemplo): <br><br><ul><li>  Crie um usuário no assistente e vá para o diretório inicial para concluir as etapas restantes: <br><br><pre> <code class="bash hljs">useradd jean &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/jean</code> </pre> </li><li>  Crie uma chave privada: <br><br><pre> <code class="bash hljs">openssl genrsa -out jean.key 2048</code> </pre> </li><li>  Crie uma solicitação de assinatura de certificado (CSR).  <code>CN</code> é o nome de usuário, <code>O</code> é o grupo.  Você pode definir permissões por grupo.  Isso simplificará o trabalho se, por exemplo, você tiver muitos usuários com as mesmas permissões: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#   openssl req -new -key jean.key \ -out jean.csr \ -subj "/CN=jean" #     $group openssl req -new -key jean.key \ -out jean.csr \ -subj "/CN=jean/O=$group" #       openssl req -new -key jean.key \ -out jean.csr \ -subj "/CN=jean/O=$group1/O=$group2/O=$group3"</span></span></code> </pre> </li><li>  Assine CSR em Kubernetes CA.  Devemos usar o certificado e a chave da CA, geralmente encontrados em <code>/etc/kubernetes/pki</code> .  O certificado será válido por 500 dias: <br><br><pre> <code class="bash hljs">openssl x509 -req -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jean.csr \ -CA /etc/kubernetes/pki/ca.crt \ -CAkey /etc/kubernetes/pki/ca.key \ -CAcreateserial \ -out jean.crt -days 500</code> </pre> </li><li>  Crie o diretório <code>.certs</code> .  Nele, armazenaremos as chaves públicas e privadas do usuário: <br><br><pre> <code class="bash hljs">mkdir .certs &amp;&amp; mv jean.crt jean.key .certs</code> </pre> </li><li>  Crie um usuário dentro do Kubernetes: <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-credentials jean \ --client-certificate=/home/jean/.certs/jean.crt \ --client-key=/home/jean/.certs/jean.key</code> </pre> </li><li>  Defina o contexto para o usuário: <br><br><pre> <code class="bash hljs">kubectl config <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>-context jean-context \ --cluster=kubernetes --user=jean</code> </pre> </li><li>  Edite o arquivo de configuração do usuário.  Ele contém as informações necessárias para autenticação em um cluster.  Você pode usar o arquivo de configuração do cluster, que geralmente está em <code>/etc/kubernetes</code> : as variáveis ​​de <code>certificate-authority-data</code> <code>server</code> devem ser as mesmas do arquivo mencionado: <br><br><pre> <code class="plaintext hljs">apiVersion: v1 clusters: - cluster: certificate-authority-data: {  } server: {  } name: kubernetes contexts: - context: cluster: kubernetes user: jean name: jean-context current-context: jean-context kind: Config preferences: {} users: - name: jean user: client-certificate: /home/jean/.certs/jean.cert client-key: /home/jean/.certs/jean.key</code> </pre> <br>  Agora você precisa copiar a configuração acima para o diretório <code>.kube</code> : <br><br><pre> <code class="bash hljs">mkdir .kube &amp;&amp; vi .kube/config</code> </pre> </li><li>  Resta tornar o usuário o proprietário de todos os arquivos e diretórios criados: <br><br><pre> <code class="bash hljs">chown -R jean: /home/jean/</code> </pre> </li></ul><br>  O usuário <code>jean</code> criado com sucesso.  Faremos o mesmo pelo <code>sarah</code> .  Existem algumas etapas e a criação de um grande número de usuários pode levar um longo tempo.  Portanto, escrevi scripts Bash que automatizam o processo: eles podem ser encontrados no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">repositório no GitHub</a> . <br><br>  <i><b>Nota</b></i>  <i><b>perev.</b></i>  <i>: Como escrevemos em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nosso artigo recente</a> , esse procedimento pode ser simplificado de uma maneira mais "nativa" para o Kubernetes - por meio de novos recursos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">utilitário do console kubeadm</a> .</i>  <i>No entanto, lembre-se de que, no momento da publicação desta tradução, eles estavam disponíveis em formato alfa.</i>  <i>Um exemplo de comando para criar um usuário é o usuário <code>kubeadm alpha kubeconfig user</code> .</i> <br><br>  Agora temos usuários e podemos criar dois namespaces: <br><br><pre> <code class="bash hljs">kubectl create namespace my-project-dev kubectl create namespace my-project-prod</code> </pre> <br>  Como ainda não determinamos a autorização do usuário, eles não devem ter acesso aos recursos do cluster: <br><br><pre> <code class="bash hljs">User: Jean kubectl get nodes Error from server (Forbidden): nodes is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"nodes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> at the cluster scope kubectl get pods -n default Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"default"</span></span> kubectl get pods -n my-project-prod Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-prod"</span></span> kubectl get pods -n my-project-dev Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span></code> </pre> <br><pre> <code class="bash hljs">User: Sarah kubectl get nodes Error from server (Forbidden): nodes is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"nodes"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> at the cluster scope kubectl get pods -n default Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"default"</span></span> kubectl get pods -n my-project-prod Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-prod"</span></span> kubectl get pods -n my-project-dev Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span></code> </pre> <br><h3>  Criação de Função e ClusterRole </h3><br>  Usaremos o <code>ClusterRole</code> , disponível por padrão.  No entanto, também mostramos como criar suas próprias <code>Role</code> e <code>Role</code> <code>ClusterRole</code> .  Em essência, <code>Role</code> e <code>ClusterRole</code> são apenas um conjunto de ações <i>(chamadas <code>verbs</code> , ou seja, verbos verbais)</i> que são permitidas para determinados recursos e espaços de nomes.  Aqui está um exemplo de arquivo YAML: <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1beta1 kind: Role metadata: name: list-deployments namespace: my-project-dev rules: - apiGroups: [ apps ] resources: [ deployments ] verbs: [ get, list ] --------------------------------- apiVersion: rbac.authorization.k8s.io/v1beta1 kind: ClusterRole metadata: name: list-deployments rules: - apiGroups: [ apps ] resources: [ deployments ] verbs: [ get, list ]</code> </pre> <br>  Para criá-los, execute o comando: <br><br><pre> <code class="bash hljs">kubectl create -f /path/to/your/yaml/file</code> </pre> <br><h3>  Função de ligação ou função de cluster a usuários </h3><br>  Agora vincule o <code>ClusterRole</code> padrão ( <code>edit</code> e <code>view</code> ) aos nossos usuários da seguinte maneira: <br><br><ul><li>  <code>jean</code> : <ul><li>  <code>edit</code> - no espaço de nomes <code>my-project-dev</code> ; </li><li>  <code>view</code> - no espaço para nome <code>my-project-prod</code> ; </li></ul></li><li>  <code>sarah</code> : <ul><li>  <code>edit</code> - no espaço para nome <code>my-project-prod</code> . </li></ul></li></ul><br>  RoleBindings deve ser especificado por namespaces, não por usuários.  Em outras palavras, para autorizar o <code>jean</code> , criaremos duas RoleBindings.  Um exemplo de um arquivo YAML que define RoleBindings para <code>jean</code> : <br><br><pre> <code class="plaintext hljs">apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jean namespace: my-project-dev subjects: - kind: User name: jean apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: edit apiGroup: rbac.authorization.k8s.io --------------------------------- apiVersion: rbac.authorization.k8s.io/v1 kind: RoleBinding metadata: name: jean namespace: my-project-prod subjects: - kind: User name: jean apiGroup: rbac.authorization.k8s.io roleRef: kind: ClusterRole name: view apiGroup: rbac.authorization.k8s.io</code> </pre> <br>  <code>jean</code> que o <code>jean</code> <code>view</code> <code>my-project-prod</code> e edite <code>my-project-dev</code> .  O mesmo precisa ser feito com autorizações para <code>sarah</code> .  Para ativá-los, execute o comando: <br><br><pre> <code class="bash hljs">kubectl apply -f /path/to/your/yaml/file</code> </pre> <br>  Nesse caso, o <code>kubectl apply</code> foi usado em vez da <code>kubectl create</code> do <code>kubectl create</code> .  A diferença entre os dois é que <code>create</code> cria o objeto e não faz mais nada, além de <code>apply</code> - não apenas cria o objeto (se ele não existir), mas também atualiza, se necessário. <br><br>  Vamos verificar se nossos usuários receberam as permissões necessárias. <br><br><ul><li>  Usuário: <code>sarah</code> ( <code>edit</code> em <code>my-project-prod</code> ) <ul><li> <code>my-project-prod</code> <ul> <li>  pode listar pods (1); </li><li>  pode criar implantações (2). </li></ul></li><li> <code>my-project-dev</code> <ul> <li>  não pode listar pods (4); </li><li>  não pode criar implantações (5). </li></ul></li></ul></li></ul><br><pre> <code class="bash hljs">(1) kubectl get pods -n my-project-prod No resources found. (2) kubectl run nginx --image=nginx --replicas=1 -n my-project-prod deployment.apps/nginx created (3) kubectl get pods -n my-project-prod NAME READY STATUS RESTARTS AGE nginx-7db9fccd9b-t14qw 1/1 Running 0 4s (4) kubectl get pods -n my-project-dev Error from server (Forbidden): pods is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot list resource <span class="hljs-string"><span class="hljs-string">"pods"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span> (5) kubectl run nginx --image=nginx --replicas=1 -n my-project-dev Error from server (Forbidden): deployments.apps is forbidden: User <span class="hljs-string"><span class="hljs-string">"sarah"</span></span> cannot create resource <span class="hljs-string"><span class="hljs-string">"deployments"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">"apps"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-dev"</span></span></code> </pre> <br><ul><li>  Usuário: <code>jean</code> ( <code>view</code> em <code>my-project-prod</code> e <code>edit</code> em <code>my-project-dev</code> ) <ul><li> <code>my-project-prod</code> <ul> <li>  pode listar pods (1); </li><li>  pode listar deployment'ov (2); </li><li>  não pode excluir implantações (3). </li></ul></li><li>  my-project-dev: <ul><li>  pode listar pods (4); </li><li>  pode criar implantações (5); </li><li>  pode listar deployment'ov (6); </li><li>  pode remover implantações (7). </li></ul></li></ul></li></ul><br><pre> <code class="bash hljs">(1) kubectl get pods -n my-project-prod NAME READY STATUS RESTARTS AGE nginx-7db9fccd9b-t14qw 1/1 Running 0 101s (2) kubectl get deploy -n my-project-prod NAME READY UP-TO-DATE AVAILABLE AGE nginx 1/1 1 1 110s (3) kubectl delete deploy/nginx -n my-project-prod Error from server (Forbidden): deployments.extensions <span class="hljs-string"><span class="hljs-string">"nginx"</span></span> is forbidden: User <span class="hljs-string"><span class="hljs-string">"jean"</span></span> cannot delete resource <span class="hljs-string"><span class="hljs-string">"deployments"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> API group <span class="hljs-string"><span class="hljs-string">"extensions"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the namespace <span class="hljs-string"><span class="hljs-string">"my-project-prod"</span></span> (4) kubectl get pods -n my-project-dev No resources found. (5) kubectl run nginx --image=nginx --replicas=1 -n my-project-dev deployment.apps/nginx created (6) kubectl get deploy -n my-project-dev NAME READY UP-TO-DATE AVAILABLE AGE nginx 0/1 1 0 13s (7) kubectl delete deploy/nginx -n my-project-dev deployment.extensions <span class="hljs-string"><span class="hljs-string">"nginx"</span></span> deleted (8) kubectl get deploy -n my-project-dev No resources found.</code> </pre> <br><h2>  Gerenciamento e autorização de usuário </h2><br>  Portanto, definimos com êxito várias funções e autorizações de usuário.  Surge a questão: como agora gerenciar tudo isso?  Como sei se as permissões para um usuário específico estão definidas corretamente?  Como sei quem tem autoridade para executar uma ação específica?  Como obter uma imagem geral das permissões do usuário? <br><br>  Precisamos de respostas para todas essas perguntas para garantir a segurança do cluster.  O <code>kubectl auth can-i</code> permite descobrir se um usuário pode executar uma ação específica: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># kubectl auth can-i $action $resource --as $subject (1) kubectl auth can-i list pods (2) kubectl auth can-i list pods --as jean</span></span></code> </pre> <br>  O primeiro comando (1) permite ao usuário descobrir se ele pode executar alguma ação.  O segundo (2) - permite que o administrador represente o usuário para descobrir se ele pode executar uma determinada ação.  Essa "reencarnação" é permitida apenas para usuários com privilégios de administrador de cluster. <br><br>  Isso é praticamente tudo o que pode ser feito com o kit de ferramentas interno.  É por isso que apresentarei alguns projetos de código aberto que expandem os recursos oferecidos pela equipe kubectl auth can-i.  Antes de apresentá-los, vamos estabelecer as dependências: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Go</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Krew</a> . <br><br><h2>  Ir instalação </h2><br>  Go é uma linguagem de programação de código aberto que permite criar software simples, confiável e eficiente.  Foi desenvolvido pelo Google sob a inspiração de C e Pascal, com base nos conceitos originais de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Robert Griesemer</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Rob Pike</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ken Thompson</a> . <br><br><pre> <code class="bash hljs">wget https://dl.google.com/go/go1.12.5.linux-amd64.tar.gz sudo tar -C /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> -xzf go1.12.5.linux-amd64.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span>:/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/go/bin</code> </pre> <br><h2>  Instalação Krew </h2><br>  Krew é uma ferramenta que simplifica o uso de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plugins kubectl</a> .  O Krew ajuda a encontrar, instalar e gerenciar plugins.  Em termos de funções, assemelha-se a ferramentas como apt, dnf ou brew.  O Krew é compatível apenas com o kubectl versão 1.12 e superior. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> -x; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(mktemp -d)</span></span></span><span class="hljs-string">"</span></span> &amp;&amp; curl -fsSLO <span class="hljs-string"><span class="hljs-string">"https://storage.googleapis.com/krew/v0.2.1/krew.{tar.gz,yaml}"</span></span> &amp;&amp; tar zxvf krew.tar.gz &amp;&amp; ./krew-<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(uname | tr '[:upper:]' '[:lower:]')</span></span></span><span class="hljs-string">_amd64"</span></span> install \ --manifest=krew.yaml --archive=krew.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${KREW_ROOT:-$HOME/.krew}</span></span></span><span class="hljs-string">/bin:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br><h2>  rakkess </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este projeto</a> permite visualizar todas as permissões que foram concedidas ao usuário.  Por exemplo, ajuda a responder à pergunta sobre o que o <code>jean</code> pode fazer.  Primeiro de tudo, vamos instalá-lo: <br><br><pre> <code class="bash hljs">kubectl krew install access-matrix</code> </pre> <br>  A documentação do projeto pode ser encontrada no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">repositório no GitHub</a> .  Aqui está um exemplo de seu trabalho: <br><br><pre> <code class="bash hljs">kubectl access-matrix -n my-project-dev --as jean</code> </pre> <br><img src="https://habrastorage.org/webt/0g/sq/b6/0gsqb6cw-paqkn6yxbuozzccgpq.png"><br><br><h2>  kubect-who-can </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este projeto</a> nos permite descobrir quais usuários podem executar uma ação específica.  Ajuda a responder à pergunta: "Quem pode fazer isso?"  Instalação: <br><br><pre> <code class="bash hljs">go get -v github.com/aquasecurity/kubectl-who-can</code> </pre> <br>  A documentação está no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">repositório</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> .  Exemplo de trabalho: <br><br><pre> <code class="bash hljs">kubectl-who-can list pods -n default No subjects found with permissions to list pods assigned through RoleBindings CLUSTERROLEBINDING SUBJECT TYPE SA-NAMESPACE cluster-admin system:masters Group rbac-manager rbac-manager ServiceAccount rbac-manager system:controller:attachdetach-controller attachdetach-controller ServiceAccount kube-system system:controller:clusterrole-aggregation-controller clusterrole-aggregation-controller ServiceAccount kube-system system:controller:cronjob-controller cronjob-controller ServiceAccount kube-system system:controller:daemon-set-controller daemon-set-controller ServiceAccount kube-system system:controller:deployment-controller deployment-controller ServiceAccount kube-system system:controller:endpoint-controller endpoint-controller ServiceAccount kube-system system:controller:generic-garbage-collector generic-garbage-collector ServiceAccount kube-system system:controller:horizontal-pod-autoscaler horizontal-pod-autoscaler ServiceAccount kube-system system:controller:job-controller job-controller ServiceAccount kube-system system:controller:namespace-controller namespace-controller ServiceAccount kube-system system:controller:node-controller node-controller ServiceAccount kube-system system:controller:persistent-volume-binder persistent-volume-binder ServiceAccount kube-system system:controller:pod-garbage-collector pod-garbage-collector ServiceAccount kube-system system:controller:pvc-protection-controller pvc-protection-controller ServiceAccount kube-system system:controller:replicaset-controller replicaset-controller ServiceAccount kube-system system:controller:replication-controller replication-controller ServiceAccount kube-system system:controller:resourcequota-controller resourcequota-controller ServiceAccount kube-system system:controller:statefulset-controller statefulset-controller ServiceAccount kube-system system:coredns coredns ServiceAccount kube-system system:kube-controller-manager system:kube-controller-manager User system:kube-scheduler system:kube-scheduler User</code> </pre> <br><h2>  rbac-lookup </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Este projeto</a> fornece uma visão geral das regras do RBAC.  Ajuda a responder às perguntas: “A que papel <code>jean</code> e <code>sarah</code> pertencem?”, “A que papel pertencem todos os usuários?”, “A que papel pertence todo o grupo?”.  Para instalar, execute o comando: <br><br><pre> <code class="bash hljs">kubectl krew install rbac-lookup</code> </pre> <br>  A documentação está no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">repositório</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> .  Aqui está um exemplo de trabalho: <br><br><pre> <code class="bash hljs">kubectl-rbac_lookup jean SUBJECT SCOPE ROLE jean my-project-dev ClusterRole/edit jean my-project-prod ClusterRole/view kubectl-rbac_lookup sarah SUBJECT SCOPE ROLE sarah my-project-prod ClusterRole/edit kubectl-rbac_lookup --kind user SUBJECT SCOPE ROLE jean my-project-dev ClusterRole/edit jean my-project-prod ClusterRole/view sarah my-project-prod ClusterRole/edit system:anonymous kube-public Role/kubeadm:bootstrap-signer-clusterinfo system:kube-controller-manager kube-system Role/extension-apiserver-authentication-reader system:kube-controller-manager kube-system Role/system::leader-locking-kube-controller-manager system:kube-controller-manager cluster-wide ClusterRole/system:kube-controller-manager system:kube-proxy cluster-wide ClusterRole/system:node-proxier system:kube-scheduler kube-system Role/extension-apiserver-authentication-reader system:kube-scheduler kube-system Role/system::leader-locking-kube-scheduler system:kube-scheduler cluster-wide ClusterRole/system:kube-scheduler system:kube-scheduler cluster-wide ClusterRole/system:volume-scheduler kubectl-rbac_lookup --kind group SUBJECT SCOPE ROLE system:authenticated cluster-wide ClusterRole/system:basic-user system:authenticated cluster-wide ClusterRole/system:discovery system:authenticated cluster-wide ClusterRole/system:public-info-viewer system:bootstrappers:kubeadm:default-node-token cluster-wide ClusterRole/system:node-bootstrapper system:bootstrappers:kubeadm:default-node-token cluster-wide ClusterRole/system:certificates.k8s.io:certificatesigningrequests:nodeclient system:bootstrappers:kubeadm:default-node-token kube-system Role/kube-proxy system:bootstrappers:kubeadm:default-node-token kube-system Role/kubeadm:kubelet-config-1.14 system:bootstrappers:kubeadm:default-node-token kube-system Role/kubeadm:nodes-kubeadm-config system:masters cluster-wide ClusterRole/cluster-admin system:nodes kube-system Role/kubeadm:kubelet-config-1.14 system:nodes kube-system Role/kubeadm:nodes-kubeadm-config system:nodes cluster-wide ClusterRole/system:certificates.k8s.io:certificatesigningrequests:selfnodeclient system:unauthenticated cluster-wide ClusterRole/system:public-info-viewer</code> </pre> <br><h2>  Gerente RBAC </h2><br>  Como o nome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">deste projeto</a> obviamente implica, ele é o gerente do RBAC.  Simplifica as muitas manipulações necessárias.  Talvez o mais importante seja a criação de RoleBindings.  Vimos anteriormente que, ao criar funções diferentes para um usuário, é necessário criar RoleBindings diferentes.  O RBAC Manager ajuda, permitindo que você faça apenas um RoleBinding com toda a autorização de uma só vez.  Para instalar, você deve baixar o arquivo YAML do repositório no GitHub: <br><br><pre> <code class="bash hljs">kubectl apply -f /path/to/rbac/manager/yaml/file</code> </pre> <br>  A documentação oficial está no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">repositório</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> .  Exemplo de trabalho: <br><br><pre> <code class="plaintext hljs">apiVersion: rbacmanager.reactiveops.io/v1beta1 kind: RBACDefinition metadata: name: jose rbacBindings: - name: jose subjects: - kind: User name: jose roleBindings: - namespace: my-project-prod clusterRole: edit - namespace: my-project-dev clusterRole: edit</code> </pre> <br><h2>  Conclusão </h2><br>  Criamos usuários no cluster Kubernetes usando o certificado de cliente X.509 com OpenSSL e os capacitamos.  Para facilitar a criação do usuário, você pode usar o script disponível no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">meu repositório no GitHub</a> <i>(ou os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">comandos</a> experimentais do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kubeadm</a> - aprox. Transl.)</i> .  Quanto à administração de cluster, você pode usar os projetos de código aberto apresentados no artigo: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kubectl auth can-i</a> : descubra se o usuário pode executar alguma ação; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rakkess</a> : descubra todas as ações que o usuário pode executar; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">kubectl-who-can</a> : determina quais usuários podem executar alguma ação; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rbac-lookup</a> : obtenha uma visão geral do RBAC; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Gerenciador RBAC</a> : simplifique a configuração combinando ligações de direitos, automatizando alterações no RBAC, usando rótulos como seletores para atribuir direitos. </li></ul><br>  Criar usuários pode se transformar em uma tarefa muito demorada, especialmente se você precisar definir um grande número de usuários por vez (ou criá-los com frequência).  Para aliviar a situação, é possível conectar o LDAP corporativo ao cluster Kubernetes.  Alguns projetos de código aberto ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kismatic</a> <i>[</i> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Object</a> <i>parece abandonado]</i> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ObjectifLibre</a> ) oferecem webhooks do Kubernetes que permitem autenticação direta através do LDAP.  Outra solução possível é configurar um servidor OpenID com o LDAP corporativo como back-end. <br><br><h2>  PS do tradutor </h2><br>  Leia também em nosso blog: <br><br><ul><li>  “Os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ABCs de segurança no Kubernetes: autenticação, autorização, auditoria</a> ”; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Entendendo o RBAC no Kubernetes</a> ”; </li><li>  “ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">33+ Ferramentas de segurança Kubernetes</a> ”; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">9 Práticas recomendadas de segurança do Kubernetes</a> ." </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt470503/">https://habr.com/ru/post/pt470503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt470487/index.html">Competições tecnológicas Radiofest-2019</a></li>
<li><a href="../pt470489/index.html">Semana de Segurança 41: Mais vulnerabilidades em cartões SIM, descriptografia de PDF</a></li>
<li><a href="../pt470497/index.html">Como usar systemd-nspawn para restaurar um sistema Linux</a></li>
<li><a href="../pt470499/index.html">Como usar interrupções no Unity Animator ao máximo</a></li>
<li><a href="../pt470501/index.html">Mônada "Reader" via assíncrono / aguardar em C #</a></li>
<li><a href="../pt470511/index.html">TI na Armênia: setores estratégicos e esferas tecnológicas do país</a></li>
<li><a href="../pt470513/index.html">Como encontrei uma casa inteligente dominada por uma botnet</a></li>
<li><a href="../pt470515/index.html">Um pequeno passo para o testador: os 10 principais relatórios do Heisenbug 2019 Piter</a></li>
<li><a href="../pt470519/index.html">Experiência na criação de assemblies Linux para atualizações de placa única com suporte</a></li>
<li><a href="../pt470521/index.html">Lançamento do 3CX V16 Update 3 e o novo aplicativo móvel 3CX para Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>