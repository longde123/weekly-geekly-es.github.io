<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üà∫ üëÇüèΩ üë∂üèª Mi implementaci√≥n de buffer de anillo en flash NOR üë©üèº‚Äçüé® ‚ìÇÔ∏è üé≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Antecedentes 


 Hay m√°quinas expendedoras de nuestro propio dise√±o. Dentro de la Raspberry Pi y un poco de flejes en una placa separada. Un aceptador...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mi implementaci√≥n de buffer de anillo en flash NOR</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/479044/"><h1 id="predystoriya">  Antecedentes </h1><br><p>  Hay m√°quinas expendedoras de nuestro propio dise√±o.  Dentro de la Raspberry Pi y un poco de flejes en una placa separada.  Un aceptador de monedas, un aceptador de billetes, una terminal bancaria est√°n conectados ... Un programa autoescrito maneja todo.  Toda la historia del trabajo se escribe en la revista en una unidad flash USB (MicroSD), que luego se transmite a trav√©s de Internet (utilizando un m√≥dem USB) al servidor, donde se agrega a la base de datos.  La informaci√≥n de ventas se carga en 1s, tambi√©n hay una interfaz web simple para monitoreo, etc. </p><br><p>  Es decir, la revista es vital: para la contabilidad (hay ingresos, ventas, etc.), monitoreo (todo tipo de fallas y otras circunstancias de fuerza mayor);  Esto, se puede decir, toda la informaci√≥n que tenemos sobre esta m√°quina. </p><br><h1 id="problema">  El problema </h1><br><p>  Las unidades flash se muestran como dispositivos muy poco confiables.  Fallan con envidiable regularidad.  Esto conduce al tiempo de inactividad de la m√°quina y (si por alguna raz√≥n el diario no se pudo transmitir en l√≠nea) a la p√©rdida de datos. </p><br><p>  <em>Esta no es la primera experiencia de usar unidades flash, antes de que hubiera otro proyecto con m√°s de cien dispositivos donde la revista se almacenaba en unidades flash USB, tambi√©n hubo problemas de confiabilidad, a veces la cantidad de fallas por mes era decenas.</em>  <em>Probamos diferentes unidades flash, incluidas las de marca en la memoria SLC, y algunos modelos son m√°s confiables que otros, pero reemplazar las unidades flash no resolvi√≥ el problema radicalmente.</em> </p><a name="habracut"></a><br><p>  <strong>Atencion</strong>  Longrid!  Si no est√° interesado en ‚Äúpor qu√©‚Äù, sino solo en ‚Äúc√≥mo‚Äù, puede ir inmediatamente <a href="https://habr.com/ru/post/479044/">al final del</a> art√≠culo. </p><br><h1 id="reshenie">  Soluci√≥n </h1><br><p>  Lo primero que viene a la mente: abandonar MicroSD, poner, por ejemplo, SSD, y arrancar desde all√≠.  Es te√≥ricamente posible, probablemente, pero relativamente costoso y no tan confiable (se agrega un adaptador USB-SATA; en los SSD de presupuesto, las estad√≠sticas de fallas tampoco son satisfactorias). </p><br><p>  USB HDD tampoco parece una soluci√≥n particularmente atractiva. </p><br><p>  Por lo tanto, llegamos a esta opci√≥n: deje la descarga desde MicroSD, pero √∫sela en modo de solo lectura y almacene el registro de operaciones (y otra informaci√≥n exclusiva de una pieza espec√≠fica de hardware: n√∫mero de serie, calibraciones de sensores, etc.) en otro lugar. </p><br><p>  El tema de FS de solo lectura para frambuesas ya se ha estudiado a lo largo y ancho, no me detendr√© en los detalles de la implementaci√≥n en este art√≠culo <em>(pero si hay inter√©s, tal vez escribir√© un mini art√≠culo sobre este tema)</em> .  El √∫nico punto que quiero se√±alar: tanto por experiencia personal como por revisiones que ya han implementado una ganancia en confiabilidad, es.  S√≠, es imposible deshacerse por completo de las aver√≠as, pero es bastante posible reducir significativamente su frecuencia.  S√≠, y las tarjetas se unifican, lo que simplifica enormemente el reemplazo del personal de mantenimiento. </p><br><h2 id="apparatnaya-chast">  Hardware </h2><br><p>  No hab√≠a dudas sobre la elecci√≥n del tipo de memoria: NOR Flash. <br>  Argumentos: </p><br><ul><li>  conexi√≥n simple (m√°s a menudo el bus SPI, la experiencia de uso que ya est√° all√≠, por lo que no se esperan problemas "de hierro"); </li><li>  precio rid√≠culo; </li><li>  protocolo operativo est√°ndar (la implementaci√≥n ya est√° en el kernel de Linux, si lo desea, puede tomar un tercero, que tambi√©n est√° presente, o incluso escribir el suyo, el beneficio es simple); </li><li>  fiabilidad y recursos: <br>  de una hoja de datos t√≠pica: los datos se almacenan durante 20 a√±os, 100,000 ciclos de borrado para cada bloque; <br>  de fuentes de terceros: BER extremadamente bajo, se postula que no hay necesidad de c√≥digos de correcci√≥n de errores <em>(en algunos documentos se considera ECC para NOR, pero generalmente MLC NOR se entiende all√≠, sucede)</em> . </li></ul><br><p>  Perm√≠tanos estimar los requisitos de volumen y recursos. </p><br><p>  Quiero tener la garant√≠a de guardar datos durante varios d√≠as.  Esto es necesario para que en caso de problemas con la conexi√≥n no se pierda el historial de ventas.  Nos centraremos en 5 d√≠as, durante este per√≠odo <em>(incluso teniendo en cuenta los fines de semana y d√≠as festivos),</em> podemos resolver el problema. </p><br><p>  Ahora estamos escribiendo alrededor de 100kb de revistas por d√≠a (3-4 mil registros), pero gradualmente esta cifra est√° creciendo: los detalles est√°n aumentando, se est√°n agregando nuevos eventos.  Adem√°s, a veces hay r√°fagas (algunos sensores comienzan a enviar spam con falsos positivos, por ejemplo).  Calcularemos 10 mil registros de 100 bytes - megabytes por d√≠a. </p><br><p>  Sale un total de 5 MB de datos limpios (bien comprimibles).  Tambi√©n <em>(estimaci√≥n aproximada)</em> 1 MB de datos de servicio. </p><br><p>  Es decir, necesitamos un microchip de 8 MB si no usa compresi√≥n, o 4 MB si lo usa.  N√∫meros bastante reales para este tipo de memoria. </p><br><p>  En cuanto al recurso: si planeamos reescribir toda la memoria no m√°s de una vez cada 5 d√≠as, en 10 a√±os de servicio obtendremos menos de mil ciclos de reescritura. <br>  Recuerdo que el fabricante promete cien mil. </p><br><div class="spoiler">  <b class="spoiler_title">Un poco sobre NOR vs NAND</b> <div class="spoiler_text"><p>  Hoy, por supuesto, la memoria NAND es mucho m√°s popular, pero para este proyecto no la usar√≠a: NAND, a diferencia de NOR, necesariamente requiere el uso de c√≥digos de correcci√≥n de errores, una tabla de bloques defectuosos, etc., y las patas de los chips NAND Por lo general, mucho m√°s. </p><br><p>  Las desventajas de NOR incluyen: </p><br><ul><li>  peque√±o volumen (y, en consecuencia, alto precio por megabyte); </li><li>  bajo tipo de cambio (en gran parte debido al hecho de que se utiliza una interfaz en serie, generalmente SPI o I2C); </li><li>  borrado lento (dependiendo del tama√±o del bloque, toma de fracciones de un segundo a varios segundos). </li></ul><br><p>  Parece que no es nada cr√≠tico para nosotros, as√≠ que contin√∫e. </p></div></div><br><p>  Si los detalles son interesantes, se <a href="https://www.adestotech.com/wp-content/uploads/doc3686.pdf" rel="nofollow">eligi√≥ el</a> chip <a href="https://www.adestotech.com/wp-content/uploads/doc3686.pdf" rel="nofollow">at25df321a</a> <em>(sin embargo, esto es insignificante, hay muchos an√°logos en el mercado que son compatibles con el pinout y el sistema de comando; incluso si queremos colocar el chip de otro fabricante y / u otro volumen, todo funcionar√° sin cambiar el c√≥digo)</em> . </p><br><p>  Utilizo el controlador integrado en el kernel de Linux, en Raspberry, gracias al soporte de superposici√≥n del √°rbol de dispositivos, todo es muy simple: debe colocar la superposici√≥n compilada en / boot / overlays y modificar /boot/config.txt un poco. </p><br><div class="spoiler">  <b class="spoiler_title">Archivo dts de ejemplo</b> <div class="spoiler_text"><p>  Honestamente, no estoy seguro de lo que est√° escrito sin errores, pero funciona. </p><br><pre><code class="plaintext hljs">/* * Device tree overlay for at25 at spi0.1 */ /dts-v1/; /plugin/; / { compatible = "brcm,bcm2835", "brcm,bcm2836", "brcm,bcm2708", "brcm,bcm2709"; /* disable spi-dev for spi0.1 */ fragment@0 { target = &lt;&amp;spi0&gt;; __overlay__ { status = "okay"; spidev@1{ status = "disabled"; }; }; }; /* the spi config of the at25 */ fragment@1 { target = &lt;&amp;spi0&gt;; __overlay__ { #address-cells = &lt;1&gt;; #size-cells = &lt;0&gt;; flash: m25p80@1 { compatible = "atmel,at25df321a"; reg = &lt;1&gt;; spi-max-frequency = &lt;50000000&gt;; /* default to false: m25p,fast-read ; */ }; }; }; __overrides__ { spimaxfrequency = &lt;&amp;flash&gt;,"spi-max-frequency:0"; fastread = &lt;&amp;flash&gt;,"m25p,fast-read?"; }; };</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Y otra l√≠nea en config.txt</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">dtoverlay=at25:spimaxfrequency=50000000</code> </pre> </div></div><br><p>  Omitir√© la descripci√≥n de conectar el chip a la Raspberry Pi.  Por un lado, no soy un experto en electr√≥nica, por otro lado, todo es trivial incluso para m√≠: el microcircuito tiene solo 8 patas, de las cuales necesitamos tierra, potencia, SPI (CS, SI, SO, SCK);  los niveles coinciden con los de Raspberry Pi, no se requiere enlace adicional, solo conecte los 6 contactos especificados. </p><br><h2 id="postanovka-zadachi">  Declaraci√≥n del problema. </h2><br><p>  Como de costumbre, la formulaci√≥n del problema pasa por varias iteraciones, me parece que ha llegado el momento de la pr√≥xima.  Entonces deteng√°monos, juntemos lo que ya se ha escrito y aclaremos los detalles que quedan en las sombras. </p><br><p>  Por lo tanto, decidimos que el registro se almacenar√° en SPI NOR Flash. </p><br><div class="spoiler">  <b class="spoiler_title">¬øQu√© es NOR Flash para quienes no lo saben?</b> <div class="spoiler_text"><p>  Esta es una memoria no vol√°til con la que puede realizar tres operaciones: </p><br><ol><li>  Lectura: <br>  La lectura m√°s com√∫n: pasamos la direcci√≥n y leemos todos los bytes que necesitamos; </li><li>  Registro: <br>  Escribir en flash NOR parece normal, pero tiene una peculiaridad: solo puede cambiar de 1 a 0, pero no al rev√©s.  Por ejemplo, si ten√≠amos 0x55 en la celda de memoria, luego de escribirle 0x0f, 0x05 ya estar√° almacenado all√≠ <em>(consulte la tabla a continuaci√≥n)</em> ; </li><li>  Borrar: <br>  Por supuesto, tambi√©n debemos ser capaces de hacer la operaci√≥n inversa: cambiar de 0 a 1, raz√≥n por la cual existe la operaci√≥n de borrado.  A diferencia de los dos primeros, funciona no en bytes, sino en bloques (el bloque de borrado m√≠nimo en el microcircuito seleccionado es 4kb).  Borrar destruye todo el bloque y esta es la √∫nica forma de cambiar de 0 a 1. Por lo tanto, cuando se trabaja con memoria flash, a menudo tiene que alinear las estructuras de datos con el borde del bloque de borrado. <br>  Grabar en NOR Flash: </li></ol><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Datos binarios </th></tr></thead><tbody><tr><td>  <strong>Era</strong> </td><td> <code>01010101</code> </td> </tr><tr><td>  <strong>Grabado</strong> </td><td> <code>00001111</code> </td> </tr><tr><td>  <strong>Se ha convertido</strong> </td><td> <code>00000101</code> </td> </tr></tbody></table></div></div></div><br><p>  El diario en s√≠ representa una secuencia de registros de longitud variable.  Una longitud de grabaci√≥n t√≠pica es de aproximadamente 30 bytes (aunque a veces ocurren grabaciones de varios kilobytes de longitud).  <em>En este caso, trabajamos con ellos como un conjunto de bytes, pero, si le interesa, CBOR se usa dentro de los registros.</em> </p><br><p>  Adem√°s del diario, necesitamos almacenar cierta informaci√≥n de "ajuste", ya sea actualizada o no: una determinada identificaci√≥n del dispositivo, calibraci√≥n del sensor, el indicador "dispositivo est√° temporalmente desactivado", etc. <br>  Esta informaci√≥n es un conjunto de registros de valores clave, tambi√©n almacenados en CBOR. No tenemos mucha de esta informaci√≥n (unos pocos kilobytes como m√°ximo), se actualiza con poca frecuencia. <br>  En el futuro, lo llamaremos contexto. </p><br><p>  Si recuerda d√≥nde comenz√≥ este art√≠culo, es muy importante garantizar la fiabilidad del almacenamiento de datos y, si es posible, la operaci√≥n continua incluso en caso de fallas de hardware / corrupci√≥n de datos. </p><br><p>  ¬øQu√© fuentes de problemas pueden considerarse? </p><br><ul><li>  Apague durante las operaciones de escritura / borrado.  Esto es de la categor√≠a de "contra la chatarra sin recepci√≥n". <br>  Informaci√≥n de la <a href="https://electronics.stackexchange.com/questions/225956/what-would-happen-in-case-of-power-outage-during-nor-flash-erase-or-programming" rel="nofollow">discusi√≥n</a> sobre stackexchange: cuando apaga la alimentaci√≥n mientras trabaja con flash, eso borra (configuraci√≥n a 1), esa escritura (configuraci√≥n a 0) conduce a un comportamiento indefinido: los datos se pueden escribir, escribir parcialmente (por ejemplo, transferimos 10 bytes / 80 bits , y solo se lograron grabar 45 bits), tambi√©n es posible que algunos de los bits est√©n en el estado "intermedio" (la lectura puede producir 0 o 1); </li><li>  Errores de la memoria flash en s√≠. <br>  BER, aunque muy bajo, no puede ser igual a cero; </li><li>  Errores de bus <br>  Los datos transmitidos a trav√©s de SPI no est√°n protegidos de ninguna manera, bien pueden ocurrir como errores de un solo bit o errores de sincronizaci√≥n: p√©rdida o inserci√≥n de bits (lo que conduce a una distorsi√≥n masiva de datos); </li><li>  Otros errores / fallas <br>  Errores en el c√≥digo, fracasos de frambuesa, intervenci√≥n alien√≠gena ... </li></ul><br><p>  Formul√© requisitos, cuyo cumplimiento, en mi opini√≥n, es necesario para garantizar la confiabilidad: </p><br><ul><li>  Los registros deben escribirse en la memoria flash de inmediato, no se considera la grabaci√≥n pendiente; si se produce un error, debe detectarse y procesarse lo antes posible; el sistema debe, si es posible, recuperarse de los errores. <br>  <em>(un ejemplo de la vida "como no deber√≠a ser", que, creo, todos se encontraron: despu√©s de un reinicio de emergencia, el sistema de archivos "se rompi√≥" y el sistema operativo no se inicia)</em> </li></ul><br><h2 id="idei-podhody-razmyshleniya">  Ideas, enfoques, pensamientos </h2><br><p>  Cuando comenc√© a pensar en esta tarea, un mont√≥n de ideas pasaron por mi cabeza, por ejemplo: </p><br><ul><li>  Usar compresi√≥n de datos </li><li>  Utilice estructuras de datos complicadas, por ejemplo, almacene encabezados de registro por separado de los registros mismos, de modo que si se produce un error en un registro, puede leer el resto sin ning√∫n problema; </li><li>  use campos de bits para controlar la integridad de la grabaci√≥n cuando se apaga la alimentaci√≥n; </li><li>  almacenar sumas de comprobaci√≥n para todo y para todo; </li><li>  use alg√∫n tipo de codificaci√≥n de correcci√≥n de errores. </li></ul><br><p>  Se utilizaron algunas de estas ideas, se decidi√≥ rechazar algunas.  Vamos en orden. </p><br><h3 id="szhatie-dannyh">  Compresi√≥n de datos </h3><br><p>  Los eventos que registramos en el diario en s√≠ son bastante iguales y repetibles ("arroj√≥ una moneda de 5 rublos", "hizo clic en el bot√≥n de cambio de entrega", ...).  Por lo tanto, la compresi√≥n deber√≠a ser bastante efectiva. </p><br><p>  La sobrecarga para la compresi√≥n es insignificante (el procesador que tenemos es bastante potente, incluso en el primer Pi hab√≠a un n√∫cleo con una frecuencia de 700 MHz, en los modelos actuales hab√≠a varios n√∫cleos con una frecuencia de m√°s de un gigahercio), la velocidad de intercambio con el almacenamiento es baja (varios megabytes por segundo), el tama√±o del registro es peque√±o.  En general, si la compresi√≥n afectar√° el rendimiento, entonces solo es positivo <em>(absolutamente no cr√≠tico, solo afirmativo)</em> .  Adem√°s, no tenemos un Linux real incrustado, sino ordinario, por lo que la implementaci√≥n no deber√≠a requerir mucho esfuerzo (solo vincula la biblioteca y usa varias funciones de ella). </p><br><p>  Se tom√≥ una parte del registro del dispositivo de trabajo (1.7 MB, 70 mil registros) y, para empezar, se verific√≥ la compresibilidad utilizando gzip, lz4, lzop, bzip2, xz, zstd disponibles en la computadora. </p><br><ul><li>  gzip, xz, zstd mostraron resultados similares (40Kb). <br>  Me sorprendi√≥ que la moda xz se mostrara aqu√≠ en el nivel gzip o zstd; </li><li>  lzip con la configuraci√≥n predeterminada dio un resultado ligeramente peor; </li><li>  lz4 y lzop mostraron resultados no muy buenos (150Kb); </li><li>  bzip2 mostr√≥ resultados sorprendentemente buenos (18Kb). </li></ul><br><p>  Entonces los datos se comprimen muy bien. <br>  Entonces (si no encontramos fallas fatales) ¬°deber√≠a haber compresi√≥n!  Solo porque caben m√°s datos en la misma unidad flash. </p><br><p>  Pensemos en los defectos. </p><br><p>  El primer problema: ya hemos acordado que cada registro debe comenzar de inmediato.  Por lo general, el archivador recopila datos de la secuencia de entrada hasta que decide que es hora de escribir en la salida.  Necesitamos obtener inmediatamente un bloque de datos comprimido y guardarlo en una memoria no vol√°til. </p><br><p>  Veo tres formas: </p><br><ol><li>  Comprima cada entrada usando la compresi√≥n del diccionario en lugar de los algoritmos discutidos anteriormente. <br>  Es una opci√≥n de trabajo, pero no me gusta.  Para garantizar un nivel de compresi√≥n m√°s o menos decente, el diccionario debe ser "afilado" para datos espec√≠ficos, cualquier cambio conducir√° al hecho de que el nivel de compresi√≥n cae catastr√≥ficamente.  S√≠, el problema se resuelve creando una nueva versi√≥n del diccionario, pero esto es un dolor de cabeza: necesitaremos almacenar todas las versiones del diccionario;  en cada entrada necesitaremos indicar con qu√© versi√≥n del diccionario fue comprimido ... </li><li>  Comprima cada entrada con algoritmos "cl√°sicos", pero independientemente de los dem√°s. <br>  Los algoritmos de compresi√≥n considerados no est√°n dise√±ados para trabajar con registros de este tama√±o (decenas de bytes), el coeficiente de compresi√≥n ser√° claramente menor que 1 (es decir, un aumento en la cantidad de datos en lugar de compresi√≥n); </li><li>  ENJUAGUE despu√©s de cada grabaci√≥n. <br>  Muchas bibliotecas de compresi√≥n tienen soporte para FLUSH.  Este es un comando (o par√°metro para el procedimiento de compresi√≥n), al recibir el cual el archivador genera una secuencia comprimida para que, sobre la base, <strong>todos</strong> los datos no comprimidos que ya se hayan recibido puedan restaurarse.  Tal an√°logo de <code>sync</code> en sistemas de archivos o <code>commit</code> en sql. <br>  Lo que es importante, las operaciones de compresi√≥n posteriores podr√°n usar el diccionario acumulado y la relaci√≥n de compresi√≥n no sufrir√° tanto como en la versi√≥n anterior. </li></ol><br><p>  Creo que es obvio que eleg√≠ la tercera opci√≥n, analicemos con m√°s detalle. </p><br><p>  Hubo un <a href="https://www.bolet.org/~pornin/deflate-flush.html" rel="nofollow">gran art√≠culo</a> sobre FLUSH en zlib. </p><br><p>  Hice una prueba motivada basada en el art√≠culo, tom√© 70 mil entradas de diario de un dispositivo real, con un tama√±o de p√°gina de 60Kb <em>(volveremos al tama√±o de la p√°gina)</em> : </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Datos de origen </th><th>  Compresi√≥n Gzip -9 (sin FLUSH) </th><th>  zlib con Z_PARTIAL_FLUSH </th><th>  zlib con Z_SYNC_FLUSH </th></tr></thead><tbody><tr><td>  <strong>Volumen, Kb</strong> </td><td>  1692 </td><td>  40 </td><td>  352 </td><td>  604 </td></tr></tbody></table></div><br><p>  A primera vista, el precio introducido por FLUSH es excesivamente alto, pero en realidad tenemos una mala elecci√≥n, ya sea no comprimir en absoluto o comprimir (y de manera muy eficiente) con FLUSH.  No olvide que tenemos 70 mil registros, la redundancia introducida por Z_PARTIAL_FLUSH es de solo 4-5 bytes por registro.  Y la relaci√≥n de compresi√≥n result√≥ ser casi 5: 1, lo cual es m√°s que un excelente resultado. </p><br><div class="spoiler">  <b class="spoiler_title">Puede parecer inesperado, pero en realidad Z_SYNC_FLUSH es una forma m√°s eficiente de hacer FLUSH</b> <div class="spoiler_text"><p>  En el caso de usar Z_SYNC_FLUSH, los √∫ltimos 4 bytes de cada registro siempre ser√°n 0x00, 0x00, 0xff, 0xff.  Y si los conocemos, entonces no podemos almacenarlos, por lo que el tama√±o total es de solo 324Kb. </p><br><p>  El art√≠culo al que me refiero tiene una explicaci√≥n: </p><br><blockquote>  Se agrega un nuevo bloque de tipo 0 con contenido vac√≠o. <br><br>  Un bloque de tipo 0 con contenido vac√≠o consta de: <br><ul><li>  el encabezado de bloque de tres bits; </li><li>  0 a 7 bits iguales a cero, para lograr la alineaci√≥n de bytes; </li><li>  la secuencia de cuatro bytes 00 00 FF FF. </li></ul><br></blockquote><p>  Como puede ver, en el √∫ltimo bloque antes de estos 4 bytes viene de 3 a 10 bits cero.  Sin embargo, la pr√°ctica ha demostrado que cero bits son en realidad al menos 10. </p><br><p>  Resulta que tales bloques de datos cortos generalmente se codifican (¬øsiempre?) Usando un bloque de tipo 1 (bloque fijo), que necesariamente termina con 7 bits cero, por lo que obtenemos 10-17 bits cero garantizados (y el resto ser√° cero con una probabilidad de aproximadamente 50%). </p><br><p>  Entonces, en los datos de prueba, en el 100% de los casos, antes de 0x00, 0x00, 0xff, 0xff hay un byte cero, y m√°s que en el tercer caso hay dos bytes cero <em>(tal vez el hecho es que uso CBOR binario, y cuando uso texto CBOR Es m√°s probable que JSON cumpla con bloques de tipo 2: bloque din√°mico, respectivamente, los bloques se producir√≠an sin bytes cero adicionales antes de 0x00, 0x00, 0xff, 0xff)</em> . </p><br><p>  El total de los datos de prueba disponibles puede caber en menos de 250 Kb de datos comprimidos. </p><br><p>  Puede ahorrar un poco m√°s haciendo malabares con los bits: ahora ignoramos la presencia de varios bits cero al final del bloque, varios bits al comienzo del bloque tampoco cambian ... <br>  Pero luego tom√© una decisi√≥n decidida de detenerme, de lo contrario a tal ritmo puede alcanzar el desarrollo de su archivador. </p></div></div><br><p>  En total, obtuve 3-4 bytes por registro de mis datos de prueba, la relaci√≥n de compresi√≥n fue m√°s de 6: 1.  Honestamente, no cont√© con ese resultado, en mi opini√≥n, todo lo que es mejor que 2: 1 ya es un resultado que justifica el uso de la compresi√≥n. </p><br><p>  Todo est√° bien, pero zlib (desinflar) todav√≠a est√° <del>  arcaico </del>  Algoritmo de compresi√≥n bien merecido y ligeramente anticuado.  El mero hecho de que los √∫ltimos 32Kb del flujo de datos sin comprimir se usen como diccionario parece extra√±o hoy (es decir, si alg√∫n bloque de datos es muy similar a lo que estaba en el flujo de entrada 40Kb atr√°s, comenzar√° a archivarse nuevamente, pero no consulte la entrada anterior).  En <del>  de moda </del>  El diccionario de tama√±o de los archivadores modernos a menudo se mide en megabytes en lugar de kilobytes. </p><br><p>  Entonces continuamos nuestro mini estudio de archivadores. </p><br><p>  Luego se prob√≥ bzip2 (recuerdo, sin FLUSH mostr√≥ una relaci√≥n de compresi√≥n fant√°stica, casi 100: 1).  Por desgracia, con FLUSH se mostr√≥ muy mal, el tama√±o de los datos comprimidos fue mayor que el no comprimido. </p><br><div class="spoiler">  <b class="spoiler_title">Mis suposiciones sobre las razones del fracaso</b> <div class="spoiler_text"><p>  Libbz2 ofrece solo una opci√≥n de descarga, que parece borrar el diccionario (similar a Z_FULL_FLUSH en zlib), no hay raz√≥n para hablar de alg√∫n tipo de compresi√≥n efectiva. </p></div></div><br><p>  Y zstd fue el √∫ltimo en ser probado.  Dependiendo de los par√°metros, se comprime a nivel gzip, pero mucho m√°s r√°pido, o gzip es mejor. </p><br><p>  Por desgracia, con FLUSH demostr√≥ ser "no muy": el tama√±o de los datos comprimidos fue de aproximadamente 700Kb. </p><br><p>  Hice <a href="https://github.com/facebook/zstd/issues/900" rel="nofollow">una pregunta</a> en la p√°gina del proyecto en github, recib√≠ una respuesta de que vale la pena contar con hasta 10 bytes de datos de servicio para cada bloque de datos comprimidos, que est√° cerca de los resultados, la captura de desinflado no funciona. </p><br><p>  Decid√≠ detener esto en experimentos con archivadores (les recuerdo que xz, lzip, lzo, lz4 no se mostraron incluso en la etapa de prueba sin FLUSH, pero no consider√© algoritmos de compresi√≥n m√°s ex√≥ticos). </p><br><p>  Volvemos a los problemas de archivo. </p><br><p>  El segundo problema (como se dice en orden, pero no en valor): los datos comprimidos son un flujo √∫nico en el que se env√≠an constantemente a secciones anteriores.  Por lo tanto, cuando una secci√≥n de datos comprimidos est√° da√±ada, perdemos no solo el bloque de datos sin comprimir asociado con ellos, sino tambi√©n todos los subsiguientes. </p><br><p>  Hay un enfoque para resolver este problema: </p><br><ol><li>  Evite la aparici√≥n de un problema: agregue redundancia a los datos comprimidos, lo que permitir√° identificar y corregir errores;  hablaremos de esto m√°s tarde; </li><li>  Minimice las consecuencias en caso de un problema. <br>  Ya dijimos anteriormente que es posible comprimir cada bloque de datos de forma independiente, y el problema desaparecer√° por s√≠ solo (la corrupci√≥n de datos de un bloque conducir√° a la p√©rdida de datos de solo este bloque).  Sin embargo, este es un caso extremo en el que la compresi√≥n de datos ser√° ineficiente.  El extremo opuesto: use los 4 MB de nuestro microcircuito como un archivo √∫nico, lo que nos dar√° una excelente compresi√≥n, pero consecuencias catastr√≥ficas en caso de corrupci√≥n de datos. <br>  <em>S√≠, se necesita un compromiso en t√©rminos de confiabilidad.</em>  <em>Pero debemos recordar que estamos desarrollando un formato de almacenamiento de datos para memoria no vol√°til con un BER extremadamente bajo y un per√≠odo de almacenamiento de datos declarado de 20 a√±os.</em> </li></ol><br><p>  En el curso de los experimentos, descubr√≠ que las p√©rdidas m√°s o menos notables en el nivel de compresi√≥n comienzan en bloques de datos comprimidos con un tama√±o de menos de 10Kb. <br>  Se mencion√≥ anteriormente que la memoria utilizada tiene una organizaci√≥n de p√°gina, no veo ninguna raz√≥n por la que no deba usar la correspondencia de "una p√°gina: un bloque de datos comprimidos". </p><br><p>  Es decir, el tama√±o m√≠nimo de p√°gina razonable es de 16Kb (con un margen para la informaci√≥n de servicio).  Sin embargo, un tama√±o de p√°gina tan peque√±o impone restricciones significativas en el tama√±o m√°ximo de grabaci√≥n. </p><br><p>  Aunque todav√≠a no espero registros de m√°s unidades de kilobytes en forma comprimida, decid√≠ usar p√°ginas de 32 KB (un total de 128 p√°ginas por chip). </p><br><p>  <strong>Resumen:</strong> </p><br><ul><li>  Almacenamos datos comprimidos usando zlib (deflate); </li><li>  Para cada registro, establezca Z_SYNC_FLUSH; </li><li>  Para cada registro comprimido, recortamos los bytes finales <em>(por ejemplo, 0x00, 0x00, 0xff, 0xff)</em> ;  en el encabezado indica cu√°ntos bytes cortamos; </li><li>  Almacenamos datos en p√°ginas de 32Kb;  dentro de la p√°gina hay una sola secuencia de datos comprimidos;  En cada p√°gina, comenzamos la compresi√≥n nuevamente. </li></ul><br><p>  Y, antes de terminar con la compresi√≥n, me gustar√≠a llamar la atenci√≥n sobre el hecho de que solo obtenemos unos pocos bytes de datos de escritura, por lo que es extremadamente importante no inflar la informaci√≥n del servicio, cada byte se cuenta. </p><br><h3 id="hranenie-zagolovkov-dannyh">  Almacenar encabezados de datos </h3><br><p>  Como tenemos registros de longitud variable, necesitamos determinar de alguna manera la ubicaci√≥n / l√≠mites de los registros. </p><br><p>  Conozco tres enfoques: </p><br><ol><li>  Todos los registros se almacenan en una secuencia continua, primero viene el encabezado del registro que contiene la longitud y luego el registro en s√≠. <br>  En esta realizaci√≥n, tanto los encabezados como los datos pueden tener una longitud variable. <br>  De hecho, obtenemos una lista de enlaces √∫nicos que se usa todo el tiempo; </li><li>  Los encabezados y registros se almacenan en secuencias separadas. <br>  Al usar encabezados de longitud constante, nos aseguramos de que el da√±o a un encabezado no afecte al resto. <br>  Se utiliza un enfoque similar, por ejemplo, en muchos sistemas de archivos; </li><li>  Los registros se almacenan en una secuencia continua, el l√≠mite del registro est√° determinado por alg√∫n marcador (s√≠mbolo / secuencia de caracteres, que est√° / est√° prohibido dentro de los bloques de datos).  Si se encuentra un marcador dentro del registro, lo reemplazamos con una secuencia determinada (escapar de √©l). <br>  Se utiliza un enfoque similar, por ejemplo, en el protocolo PPP. </li></ol><br><p>  Voy a ilustrar </p><br><p>  Opcion 1: <br><img src="https://habrastorage.org/webt/b3/yu/q8/b3yuq8z6elbufkrice2g_vjtuhe.png" alt="Opcion 1"><br>  Aqu√≠ todo es muy simple: conociendo la longitud del registro, podemos calcular la direcci√≥n del pr√≥ximo encabezado.  Entonces nos movemos a trav√©s de los encabezados hasta encontrar una regi√≥n llena de 0xff (regi√≥n libre) o el final de la p√°gina. </p><br><p>  Opcion 2: <br><img src="https://habrastorage.org/webt/kf/qy/_7/kfqy_7qzi7pzmk-g5cqa4r6s75q.png" alt="Opci√≥n 2"><br>  Debido a la longitud variable del registro, no podemos decir de antemano cu√°ntos registros (y, por lo tanto, los encabezados) por p√°gina necesitamos.  Puede distribuir los encabezados y los datos en p√°ginas diferentes, pero prefiero un enfoque diferente: colocamos los encabezados y los datos en la misma p√°gina, sin embargo, los encabezados (de tama√±o constante) provienen del principio de la p√°gina y los datos (de longitud variable) desde el final.  Tan pronto como se "encuentren" (no hay suficiente espacio libre para un nuevo registro), consideramos que esta p√°gina est√° llena. </p><br><p>  Opcion 3: <br><img src="https://habrastorage.org/webt/-q/u1/qj/-qu1qjmqlcvfi570ovsdy_nzzny.png" alt="Opci√≥n 3"><br>  No es necesario almacenar en el encabezado la longitud u otra informaci√≥n sobre la ubicaci√≥n de los datos, hay suficientes marcadores que indican los l√≠mites de los registros.  Sin embargo, los datos deben procesarse mientras se escribe / lee. <br>  Como marcador, usar√≠a 0xff (que la p√°gina se llena despu√©s de borrar), por lo que el √°rea libre definitivamente no se tratar√° como datos. </p><br><p>  Tabla de comparaci√≥n: </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Opcion 1 </th><th>  Opci√≥n 2 </th><th>  Opci√≥n 3 </th></tr></thead><tbody><tr><td>  <strong>Tolerancia a errores</strong> </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  <strong>Compacidad</strong> </td><td>  + </td><td>  - </td><td>  + </td></tr><tr><td>  <strong>Complejidad de implementaci√≥n</strong> </td><td>  * * </td><td>  ** ** </td><td>  ** ** </td></tr></tbody></table></div><br><p>  La opci√≥n 1 tiene un defecto fatal: si alguno de los encabezados est√° da√±ado, se destruye toda nuestra cadena posterior.  Otras opciones le permiten recuperar parte de los datos incluso con da√±os masivos. <br>  Pero aqu√≠ es apropiado recordar que decidimos almacenar los datos en forma comprimida, por lo que perdemos todos los datos en la p√°gina despu√©s del registro "roto", por lo que, aunque hay un signo negativo en la tabla, no lo tenemos en cuenta. </p><br><p>  Compacidad: </p><br><ul><li>  en la primera versi√≥n, necesitamos almacenar solo la longitud en el encabezado, si se usan enteros de longitud variable, en la mayor√≠a de los casos podemos hacerlo con un byte; </li><li>  en la segunda opci√≥n, necesitamos almacenar la direcci√≥n de inicio y la longitud;  el registro debe tener un tama√±o constante, calculo 4 bytes por registro (dos bytes por desplazamiento y dos bytes por longitud); </li><li>          ,    -    1-2%.       . </li></ul><br><p>        (   ).      ,     . </p><br><p> <em>, -  -    . ,        ,      ‚Äî     ,  , ...</em> </p><br><p>     :          ,      ,      .. , , ,      ‚Äî     ,   . </p><br><p> <strong>:</strong>       "   ‚Äî   " -    . </p><br><h3 id="ispolzovanie-bitovyh-poley-dlya-kontrolya-uspeshnosti-operaciy-zapisi">         </h3><br><p>    ,    ,     : <br>         . <br> <em>   ,  erase    1,     1  0,   .</em>    "  "  1,  " " ‚Äî 0. </p><br><p>          flash: </p><br><ol><li>   ‚Äú  ‚Äù; </li><li>  ; </li><li>   ‚Äú  ‚Äù; </li><li>  ; </li><li>   ‚Äú ‚Äù. </li></ol><br><p>  ,     ‚Äú ‚Äù,  4  . </p><br><p>          ‚Äú1111‚Äù ‚Äî     ‚Äú1000‚Äù ‚Äî   ;         ,        . </p><br><p>  ,           , , , ,      (   )   . </p><br><p> <strong>:</strong>      . </p><br><h3 id="kontrolnye-summy">   </h3><br><p>       (  )     ,     . ,       ,   . </p><br><p>      ,     ,           <em>( , ,   ‚Äî       )</em> . </p><br><p>  ,    ,   ,   ‚Äî  . </p><br><p>         ‚Äî CRC.   ,     100%    ,   ‚Äî               <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x2212;</mo><mi>n</mi></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.659ex" height="2.298ex" viewBox="0 -883.9 1575.6 989.6" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-6E" x="778" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mo>‚àí</mo><mi>n</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-1">2^{-n}</script>  .      ,      ,       :       ,      .  ‚Äî      . </p><br><p>   : <a href="http://amsoftware.narod.ru/algo.html" rel="nofollow"> 1</a> , <a href="http://amsoftware.narod.ru/algo2.html" rel="nofollow"> 2</a> <em>(  narod.ru, )</em> . </p><br><p>       , CRC ‚Äî     .    ,    . </p><br><p>        ,     . </p><br><p> : <br>         <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>10</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#x2212;</mo><mn>3</mn></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.658ex" height="2.419ex" viewBox="0 -935.7 2005.4 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-30" x="500" y="0"></use><g transform="translate(1001,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-2212" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-33" x="778" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>10</mn><mrow class="MJX-TeXAtom-ORD"><mo>‚àí</mo><mn>3</mn></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-2">10^{-3}</script>    ,       : </p><br><div class="scrollable-table"><table><thead><tr><th> ,  </th><th>  ,  </th><th>   </th><th>    </th><th>    </th></tr></thead><tbody><tr><td>  1 </td><td>  0 0 </td><td>  1000 </td><td>  0 0 </td><td>  1000 </td></tr><tr><td>  1 </td><td>  1 </td><td>  4 4 </td><td>  999 </td><td> 1003 </td></tr><tr><td>  1 </td><td>  2 </td><td> ‚âà0 </td><td> 1997 </td><td> 1997 </td></tr><tr><td>  1 </td><td>  4 4 </td><td> ‚âà0 </td><td> 3990 </td><td> 3990 </td></tr><tr><td>  10 </td><td>  0 0 </td><td> 9955 </td><td>  0 0 </td><td> 9955 </td></tr><tr><td>  10 </td><td>  1 </td><td>  39 </td><td> 990 </td><td> 1029 </td></tr><tr><td>  10 </td><td>  2 </td><td> ‚âà0 </td><td> 1979 </td><td> 1979 </td></tr><tr><td>  10 </td><td>  4 4 </td><td> ‚âà0 </td><td> 3954 </td><td> 3954 </td></tr><tr><td>  1000 </td><td>  0 0 </td><td> 632305 </td><td>  0 0 </td><td> 632305 </td></tr><tr><td>  1000 </td><td>  1 </td><td> 2470 </td><td> 368 </td><td> 2838 </td></tr><tr><td>  1000 </td><td>  2 </td><td>  10 </td><td> 735 </td><td> 745 </td></tr><tr><td>  1000 </td><td>  4 4 </td><td> ‚âà0 </td><td> 1469 </td><td> 1469 </td></tr></tbody></table></div><br><p>  ,   ‚Äî               ‚Äî    . </p><br><p> ,      : ,       ,           .     ,  <a href="https://habr.com/ru/post/428746/">   </a> . </p><br><p> ,        ,      32    <em>(   64     -)</em> . </p><br><p>   ,    ,      , -   32-   (16  ,    0.01%;  24 ,  ,     ). </p><br><p>    :          ,    4  ?           ?  ,   <em> </em> ,      . </p><br><p>       ,     CRC-32C. <br>    6      22  (,     c), 4      655  (    ), 2           . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><p> <a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check" rel="nofollow"> </a>  CRC. </p><br><p> <a href="https://users.ece.cmu.edu/~koopman/crc/c32/0x8f6e37a0_len.txt" rel="nofollow">  crc-32c</a>  <a href="http://users.ece.cmu.edu/~koopman/crc/notes.html" rel="nofollow"> </a> ‚Äî ,    CRC  . </p><br><p>  <a href="http://users.ece.cmu.edu/~koopman/networks/dsn02/dsn02_koopman.pdf" rel="nofollow"> </a>  <a href="https://users.ece.cmu.edu/~koopman/crc/c32/0xfa567d89_len.txt" rel="nofollow">   </a> ,          ,      ,    ,         . </p></div></div><br><p> ,      ,  :       ? </p><br><p>  ""     : </p><br><ul><li>          ‚Äî       (         /, ,     ..); </li><li>  deflate  zlib      <em> </em>   ""  ,  ,         ,      (        , zlib      ). </li></ul><br><p>  ""     : </p><br><ul><li> CRC ""     ,    - (          ,  ,  ,   "" ); </li><li>          , <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-72/product_id-1820/GNU-Zlib.html" rel="nofollow">  </a> ,   . </li></ul><br><p>              . </p><br><p> <strong>:</strong>  CRC-32C,        ,      flash ( ). </p><br><h3 id="izbytochnost">  </h3><br><p>     , ,   , ,    (   )     . </p><br><p>        ,   . <br>       ,  - ,           RAID-6         . <br>         ,   ,           ,     . </p><br><p>   ,       .        ? </p><br><ol><li>   ( -      ,  Raspberry, ...) <br> ,             ; </li><li>   ( -   flash-   ,  ) <br>      ,         ; </li><li>       ; </li><li>   <br>            . </li></ol><br><p>       (    )       . ,   -  . </p><br><p> <strong>:</strong>      , ,      ,      (     ,      ). </p><br><h3 id="prochee">  </h3><br><p> ,          <em>(      )</em> ,      ,   . </p><br><ul><li>     "" <br>     -    ,    ..,    ,      . <br>     ,    ,    ; </li><li>     . <br>       ‚Äî ! <br>         Magic Number (),        <em>( ,       )</em> ; </li><li>    (  )   ,         1 ; </li><li>               . </li></ul><br><p>   <a href="https://planetcalc.com/2481/" rel="nofollow">-</a>  .          . </p><br><h1 id="anchorformatanchoropisanie-formata-hraneniya-dannyh"><a name="format"></a>     </h1><br><h2 id="byte-order"> Byte order </h2><br><p> ,    ,   big-endian  (network byte order),   0x1234   0x12, 0x34. </p><br><h2 id="delenie-na-stranicy">    </h2><br><p>  -     . </p><br><p>     32,   ,  1/4      (   4  128 ). </p><br><p>        (          ). </p><br><p>       (   ),    0 (     0,  ‚Äî  32,  ‚Äî  64  ..) </p><br><p>       (ring buffer),          0,    1, ...,     ,          . </p><br><h2 id="vnutri-stranicy">   </h2><br><p><img src="https://habrastorage.org/webt/7r/sr/fa/7rsrfafqrc263dsu8zd5ptceqga.png" alt=""><br>     4-  ,     (CRC-32C),      ", ,  ". </p><br><p>   (  -)  : </p><br><ul><li>   Magic Number (  ‚Äî   ) <br>        <code>0xed00 ‚äï  </code> ; </li><li>   " " (   ). </li></ul><br><p>        (  deflate).          (  ),       .              (   ). </p><br><p>      Z_SYNC_FLUSH,        4  0x00, 0x00, 0xff, 0xff, , ,      . <br>   ( 4, 5  6 )      -. </p><br><p>      1, 2  3 , : </p><br><ul><li>   (T),   : 0 ‚Äî , 1 ‚Äî ; </li><li>    (S)  1  7 ,     "",       ; </li><li>   (L). </li></ul><br><p>   S: </p><br><div class="scrollable-table"><table><thead><tr><th> S </th><th>  ,  </th><th>   ,  </th></tr></thead><tbody><tr><td> <code>0</code> </td> <td>  1 </td><td> 5 ( <code>00 00 00 ff ff</code> ) </td></tr><tr><td> <code>10</code> </td> <td>  1 </td><td> 6 ( <code>00 00 00 00 ff ff</code> ) </td></tr><tr><td> <code>110</code> </td> <td>  2 </td><td> 4 ( <code>00 00 ff ff</code> ) </td></tr><tr><td> <code>1110</code> </td> <td>  2 </td><td> 5 ( <code>00 00 00 ff ff</code> ) </td></tr><tr><td> <code>11110</code> </td> <td>  2 </td><td> 6 ( <code>00 00 00 00 ff ff</code> ) </td></tr><tr><td> <code>1111100</code> </td> <td>  3 </td><td> 4 ( <code>00 00 ff ff</code> ) </td></tr><tr><td> <code>1111101</code> </td> <td>  3 </td><td> 5 ( <code>00 00 00 ff ff</code> ) </td></tr><tr><td> <code>1111110</code> </td> <td>  3 </td><td> 6 ( <code>00 00 00 00 ff ff</code> ) </td></tr></tbody></table></div><br><p>  ,  ,   : <br><img src="https://habrastorage.org/webt/iu/fu/bp/iufubpdgxnpv9czd45tomt-0vtc.png" alt="  "><br>     T,  ‚Äî  S,  L (    ),  ‚Äî  ,  ‚Äî    ,     -. </p><br><p>  ,      ( 63+5    )     . </p><br><p>       CRC-32C,       (init)      . </p><br><p> <em>CRC   "",  (-    )  :</em> <math> </math><em><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy=&quot;false&quot;>(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>B</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy=&quot;false&quot;>(</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy=&quot;false&quot;>(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mo stretchy=&quot;false&quot;>)</mo><mo>,</mo><mi>B</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.505ex" height="2.66ex" viewBox="0 -832 18731.1 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-43" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-52" x="760" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-43" x="1520" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-28" x="2280" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-69" x="2670" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-6E" x="3015" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-69" x="3616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-74" x="3961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-2C" x="4323" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-41" x="4768" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-7C" x="5518" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-7C" x="5797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-42" x="6075" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-29" x="6835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-3D" x="7502" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-43" x="8558" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-52" x="9319" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-43" x="10078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-28" x="10839" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-43" x="11228" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-52" x="11989" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-43" x="12748" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-28" x="13509" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-69" x="13898" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-6E" x="14244" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-69" x="14844" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-74" x="15190" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-2C" x="15551" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-41" x="15996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-29" x="16747" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-2C" x="17136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMATHI-42" x="17582" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/post/479044/&amp;xid=17259,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhgo3yFG9O6kEy_MrK0Fo5neifvqxA#MJMAIN-29" x="18341" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>B</mi><mo stretchy="false">)</mo><mo>=</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy="false">(</mo><mi>C</mi><mi>R</mi><mi>C</mi><mo stretchy="false">(</mo><mi>i</mi><mi>n</mi><mi>i</mi><mi>t</mi><mo>,</mo><mi>A</mi><mo stretchy="false">)</mo><mo>,</mo><mi>B</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-3">CRC(init, A || B) = CRC(CRC(init, A), B)</script></em>   <em>.</em> <em><br>      CRC         .</em> </p><br><p>        . </p><br><p>    ,         0x00  0xff (       0xff,      ; 0x00    ). </p><br><h2 id="primernye-algoritmy">   </h2><br><h3 id="chtenie-iz-flesh-pamyati">   - </h3><br><p>       . <br>      ‚Äî       -  . </p><br><p> <em>(  , Linux     NOR Flash, )</em> </p><br><h3 id="zapis-v-flesh-pamyat">   - </h3><br><p>  . <br>  . </p><br><p>        ‚Äî       . </p><br><h3 id="podgotovka-novoy-mikroshemy-k-rabote">      </h3><br><p>     ( )      1. <br>         ( UUID    ). </p><br><p> , -   . </p><br><h3 id="zagruzka-avtomata">   </h3><br><p>     8    ( + CRC),    Magic Number   CRC . <br>  ""      ,    ,   . <br>   ,   CRC,   "".    ‚Äî    .   ‚Äî   ,    "" . <br>      , ,    "" . <br>   zlib (      ). </p><br><p> ,  ,  ,  . </p><br><h3 id="dobavlenie-zapisi-v-zhurnal">     </h3><br><p>     ,  Z_SYNC_FLUSH.,       . <br>    (     CRC) ‚Äî    (. ). <br>    CRC.    ‚Äî   . </p><br><h3 id="novaya-stranica">   </h3><br><p>       (              ).     ‚Äî       ,     . <br>    erase.    0xff.  -   ‚Äî    ,  .. <br>     ,     ,  ‚Äî    (  ). </p><br><h1 id="primenimost-formata">   </h1><br><p>   ,       -    ( , JSON, MessagePack, CBOR, , protobuf)  NOR Flash. </p><br><p> ,  ""  SLC NOR Flash. </p><br><p>         BER,  NAND  MLC NOR <em>(      ?        )</em> . </p><br><p>  ,      ,   FTL: USB flash, SD, MicroSD, etc <em>(          512 ,          ‚Äî   ""        )</em> . </p><br><p>             128 (16)  1 (128).         , , ,     <em>(      ,   NOR Flash    )</em> . </p><br><p>  -   ,         ‚Äî ,   ,      github. </p><br><h1 id="zaklyuchenie">  Conclusi√≥n </h1><br><p>  ,      <em>  </em> . </p><br><p>        ,  :     - , ,         . ,  () -         . </p><br><p>    ,   ?  Si por supuesto.   , ,      .   -        . </p><br><p>        ?  ,       ,   .    . </p><br><p>    ,       ,   " ". </p><br><p>        ,       <em>()</em>   , ,    ""  (, ,     ;      ).        <em>(    ‚Äî   )</em> . </p><br><p>          ,      . </p><br><h1 id="literatura">  </h1><br><p>        ,       . </p><br><p>      ,     ,        ,      : </p><br><ol><li>  <a href="https://github.com/madler/infgen/" rel="nofollow">infgen</a>   zlib.        deflate/zlib/gzip.         deflate ( gzip) ‚Äî  . </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/479044/">https://habr.com/ru/post/479044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../479034/index.html">C√≥mo conectarse a una VPN corporativa en Linux usando openconnect y vpn-slice</a></li>
<li><a href="../479036/index.html">Intel no puede hacer frente a la demanda de procesadores. HP y Dell sufren como resultado</a></li>
<li><a href="../479038/index.html">Transformaci√≥n digital Leroy Merlin: dise√±o de una interfaz para trabajar con llamadas de clientes</a></li>
<li><a href="../479040/index.html">Pruebas de regresi√≥n visual. Reiniciar</a></li>
<li><a href="../479042/index.html">El m√©todo Y es una forma realmente f√°cil de construir un cubo de Rubik</a></li>
<li><a href="../479048/index.html">Node.js Streams para dummies o c√≥mo trabajar con streams</a></li>
<li><a href="../479050/index.html">Investigaci√≥n de patentes en TI. El curso del joven luchador. Parte II Fuentes de informaci√≥n para la investigaci√≥n de patentes.</a></li>
<li><a href="../479052/index.html">[Supercomputaci√≥n 2019]. Almacenamiento en m√∫ltiples nubes como una aplicaci√≥n para los nuevos discos Kingston DC1000M</a></li>
<li><a href="../479054/index.html">Encuesta m√≥vil del viernes</a></li>
<li><a href="../479056/index.html">Hablar de la vida? DREAM Team en Alexa Prize Socialbot Challenge 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>