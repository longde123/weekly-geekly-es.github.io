<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüç≥ üåò ü§üüèø Menonaktifkan keadaan runtime memeriksa dalam aplikasi Android üöÇ üì® üî¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam artikel sebelumnya, saya melakukan review pada OWASP Mobile TOP 10 dan kemudian saya tidak memiliki case yang cocok untuk menunjukkan perlunya m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menonaktifkan keadaan runtime memeriksa dalam aplikasi Android</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419171/"><img src="https://habrastorage.org/webt/vu/ba/yu/vubayulqcdivrhtxrke325n6c_m.png"><br><br>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel sebelumnya,</a> saya melakukan review pada OWASP Mobile TOP 10 dan kemudian saya tidak memiliki case yang cocok untuk menunjukkan perlunya melindungi kode sumber.  Sebuah kasus yang menarik untuk demonstrasi muncul hanya baru-baru ini dan yang tertarik untuk melihat pengalaman kami menghindari pemeriksaan lingkungan, mari kita pergi di bawah kucing. <br><a name="habracut"></a><br>  Ketika menilai kinerja salah satu proyek, tim kami segera menyadari bahwa kasusnya tidak mudah.  Pengembang mendekati masalah keamanan informasi dalam program dengan baik dan mengimplementasikan pemeriksaan pada keadaan lingkungan eksekusi.  Aplikasi tidak memulai dalam kondisi berikut: <br><br><ul><li>  perangkat itu rusak; </li><li>  sebuah emulator digunakan; </li><li>  ketersediaan koneksi melalui USB; </li><li>  menggunakan mode pengembang. </li></ul><br>  Pengembang tidak mengaburkan kode sumber dan tidak ada pemeriksaan bawaan untuk modifikasi kode, yang memungkinkan saya untuk menganalisis metode yang digunakan pemeriksaan dan melakukan manipulasi yang diperlukan dengan mereka. <br><br>  Jadi mari kita mulai.  Menurut OWASP Mobile TOP 10, yang kami gunakan sebagai metodologi pengujian dasar di Hacken, Reverse Engineering - kerentanan ini mencakup analisis file biner untuk menentukan kode sumber, pustaka, algoritma, dll.  Perangkat lunak seperti IDA Pro, Hopper, otool, dan alat rekayasa balik lainnya dapat memberikan gambaran tentang operasi internal aplikasi.  Ini dapat digunakan untuk mencari kerentanan aplikasi, mengekstrak informasi penting seperti server backend, kunci enkripsi atau properti intelektual. <br><br>  Untuk melakukan analisis statis dasar, saya menggunakan alat yang menarik seperti MobSF, yang melakukan dekompilasi dan analisis statis dasar.  Setelah dekompilasi, saya tertarik pada kode java dan smali dari program ini.  Kode Java diperlukan untuk analisis, dan kami akan membuat perubahan pada kode smali.  Rincian lebih lanjut tentang bagaimana smali dan java berhubungan dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">sini</a> . <br><br>  Setelah melihat daftar kelas, saya menemukan file yang bertanggung jawab untuk memeriksa rutin telepon (lihat Gambar 1) - rootingcheck / RootBeerNative.java. <br><br><img src="https://habrastorage.org/webt/lj/cq/yf/ljcqyfp57lz0gbhcv85r-ylkhri.png"><br>  <i>Fig.</i>  <i>1. Daftar kelas aplikasi</i> <br><br>  Setelah menganalisis kelas, menjadi jelas bahwa kita perlu melihat lebih jauh untuk panggilan ke fungsi checkForRoot () dan setLogDebugMessage () (lihat Gambar 2). <br><br><img src="https://habrastorage.org/webt/yj/zn/hl/yjznhlyfzbl4tnsjwsanusdf8gs.png"><br>  <i>Fig.</i>  <i>2. Kode sumber kelas untuk memeriksa rutovanost</i> <br><br>  Menggunakan perintah grep, kita mendapatkan hasil berikut, yang memperlihatkan kepada kita file mana yang berisi panggilan ke metode checkForRoot () dan setLogDebugMessage (). <br><br>  <u>Hasil Pencarian:</u> <br>  <i>root @ kali: ~ / Desktop # grep -nr 'RootBeerNative' ******** _ v_0.9.2</i> / <br><br><pre><code class="bash hljs">********_v_0.9.2/smali/rootingcheck/RootBeerNative.smali:1:.class public Lrootingcheck/RootBeerNative; ********_v_0.9.2/smali/rootingcheck/RootBeerNative.smali:17: sput-boolean v0, Lrootingcheck/RootBeerNative;-&gt;?:Z ********_v_0.9.2/smali/rootingcheck/RootBeerNative.smali:28: sput-boolean v0, Lrootingcheck/RootBeerNative;-&gt;?:Z ********_v_0.9.2/smali/rootingcheck/RootBeerNative.smali:57: sget-boolean v0, Lrootingcheck/RootBeerNative;-&gt;?:Z ********_v_0.9.2/smali/o/CM.smali:591: new-instance v1, Lrootingcheck/RootBeerNative; ********_v_0.9.2/smali/o/CM.smali:593: invoke-direct {v1}, Lrootingcheck/RootBeerNative;-&gt;&lt;init&gt;()V ********_v_0.9.2/smali/o/CM.smali:685: new-instance v0, Lrootingcheck/RootBeerNative; ********_v_0.9.2/smali/o/CM.smali:687: invoke-direct {v0}, Lrootingcheck/RootBeerNative;-&gt;&lt;init&gt;()V ********_v_0.9.2/smali/o/CM.smali:689: invoke-static {}, Lrootingcheck/RootBeerNative;-&gt;?()Z ********_v_0.9.2/smali/o/CM.smali:753: new-instance v4, Lrootingcheck/RootBeerNative; ********_v_0.9.2/smali/o/CM.smali:755: invoke-direct {v4}, Lrootingcheck/RootBeerNative;-&gt;&lt;init&gt;()V ********_v_0.9.2/smali/o/CM.smali:764: invoke-virtual {v4, v3}, Lrootingcheck/RootBeerNative;-&gt;checkForRoot([Ljava/lang/Object;)I ********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:257: new-instance v1, Lrootingcheck/RootBeerNative; ********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:259: invoke-direct {v1}, Lrootingcheck/RootBeerNative;-&gt;&lt;init&gt;()V ********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:261: invoke-static {}, Lrootingcheck/RootBeerNative;-&gt;?()Z</code> </pre> <br>  <i>root @ kali: ~ / Desktop # grep -nr 'setLogDebugMessages' ******** _ v_0.9.2 /</i> <br><pre> <code class="bash hljs">********_v_0.9.2/smali/o/CM.smali:599: invoke-virtual {v1, v0}, Lrootingcheck/RootBeerNative;-&gt;setLogDebugMessages(Z)I ********_v_0.9.2/smali/o/CM.smali:761: invoke-virtual {v4, v0}, Lrootingcheck/RootBeerNative;-&gt;setLogDebugMessages(Z)I</code> </pre> <br>  Tapi ini tidak semua cek.  Setelah menganalisis kelas MainActivity.java, kami menemukan pemanggilan fungsi di mana string "su", "kunci-uji" dan "yang" dilewati, dengan bantuan yang melakukan pemeriksaan (lihat Gambar 3). <br><br><img src="https://habrastorage.org/webt/am/vx/qv/amvxqvlelfl6wecuixndj6r4hmk.png"><br>  <i>Fig. 3.</i>  <i>Pemeriksaan rutin</i> <br><br>  Dan lagi, dengan perintah grep, kita melihat file smali untuk memeriksa rutin: <br><br>  <u>Hasil Pencarian:</u> <br>  <i>root @ kali: ~ / Desktop # grep -nr 'su' ******** _ v_0.9.2 /</i> <br><br><pre> <code class="bash hljs">********_v_0.9.2/smali/o/CM.smali:443: const-string v2, <span class="hljs-string"><span class="hljs-string">"su"</span></span> ********_v_0.9.2/smali/o/CM.smali:706: const-string v2, <span class="hljs-string"><span class="hljs-string">"su"</span></span> ********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:172: const-string v1, <span class="hljs-string"><span class="hljs-string">"su"</span></span> ********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:347: const-string v0, <span class="hljs-string"><span class="hljs-string">"su"</span></span></code> </pre><br>  <i>root @ kali: ~ / Desktop # grep -nr 'test-keys' ******** _ v_0.9.2 /</i> <br><br><pre> <code class="bash hljs">********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:141: const-string v1, <span class="hljs-string"><span class="hljs-string">"test-keys"</span></span> ********_v_0.9.2/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$5</span></span>.smali:374: const-string v0, <span class="hljs-string"><span class="hljs-string">"test-keys"</span></span></code> </pre> <br><br>  <i>root @ kali: ~ / Desktop # grep -nr 'yang' ******** _ v_0.9.2 /</i> <br><br><pre> <code class="bash hljs">********_v_0.9.2/smali/o/CM.smali:437: const-string v2, <span class="hljs-string"><span class="hljs-string">"which"</span></span></code> </pre> <br>  Dalam artikel ini saya hanya akan menunjukkan salah satu modifikasi yang ditemukan dari pemeriksaan rutin.  Setelah sedikit manipulasi, yaitu mengubah 1 menjadi 0, pemeriksaan rutin dihapus. <br><br><img src="https://habrastorage.org/webt/t2/oc/qm/t2ocqm5oetsz9a0bit7ei6tmolg.png"><br>  <i>Fig.</i>  <i>4. Nilai variabel sama dengan satu jika ponsel di-root</i> <br><br><img src="https://habrastorage.org/webt/xb/pm/jd/xbpmjdm7-htqmdlszks4ymoo44s.png"><br>  <i>Fig.</i>  <i>5. Sekarang nilai variabel adalah nol jika ponsel di-root</i> <br><br>  Setelah itu - program dapat dirakit, ditandatangani dengan kunci rilis Anda dan dijalankan di ponsel.  Tetapi jika tidak untuk dua TAPI!  Yaitu: <br><br><ol><li>  Pemeriksaan koneksi USB; </li><li>  memeriksa dimasukkannya mode Pengembang - koneksi USB dan mode Pengembang yang disertakan memungkinkan analisis dinamis. </li></ol><br>  Pemeriksaan mode Pengembang dimatikan dengan cara yang sama seperti pemeriksaan rutin - dengan mengubah unit menjadi nol dalam pemeriksaan <br><br>  Di kelas MainActivity.java, kami menemukan garis yang bertanggung jawab untuk memeriksa mode Pengembang (lihat Gambar 6).  Setelah itu, cari file di mana string "development_settings_enabled" hadir dan modifikasi tanda centang - ubah 1 ke 0 (lihat Gambar 7 dan 8). <br><br><img src="https://habrastorage.org/webt/ke/v7/km/kev7kmndmvwfmpfgl57p6itbtdo.png"><br>  <i>Fig.</i>  <i>6. Periksa apakah mode Pengembang diaktifkan di telepon</i> <br><br>  <u>Hasil Pencarian:</u> <br>  <i>grep -nr "development_settings_enabled" ******** _ v_0.9.2 \</i> <br><br><pre> <code class="bash hljs">Binary file ********_v_0.9.2\/build/apk/classes.dex matches ********_v_0.9.2\/smali/o/xZ<span class="hljs-variable"><span class="hljs-variable">$1</span></span>.smali:49: const-string v1, <span class="hljs-string"><span class="hljs-string">"development_settings_enabled"</span></span></code> </pre><br><img src="https://habrastorage.org/webt/jt/dl/b8/jtdlb85gkvlul9wlvgvvy9mlvtc.png"><br>  <i>Fig.</i>  <i>7. Tempat di mana Anda perlu melakukan modifikasi</i> <br><br><img src="https://habrastorage.org/webt/xb/th/kg/xbthkgkeo-d2qzu5cmuzl1wy6w8.png"><br>  <i>Fig.</i>  <i>8. Modifikasi</i> <br><br>  Setelah semua manipulasi, Anda dapat menjalankan program dalam mode Pengembang. <br><br>  Selanjutnya, matikan cek koneksi USB.  Pemeriksaan ini ada di kelas MainActivity.java (lihat Gambar 9).  Tanpa grep, kami menemukan garis di MainActivity.smali, kami menemukan garis yang berisi garis dengan cek USB - android.hardware.usb.action.USB_STATE.  Setelah itu, dalam kode smali, kami memodifikasi baris ke izin lain yang mengembalikan "false" (lihat Gambar 10). <br><br><img src="https://habrastorage.org/webt/xf/sv/iw/xfsviw8hgyp8yojf5iq86lft5rs.png"><br>  <i>Fig.</i>  <i>9. Periksa koneksi USB dalam kode MainActivity.java</i> <br><br><img src="https://habrastorage.org/webt/ih/4s/z9/ih4sz9-ms5xcowpjioz5fazkf5i.png"><br>  <i>Fig.</i>  <i>10. Baris kode yang akan dihapus di MainActivity.smali</i> <br><br>  Sekarang tinggal menghasilkan kunci rilis Anda dan menandatangani aplikasi dengan itu.  Ini dilakukan sebagai berikut: <br><br><ol><li>  Anda perlu menginstal dua aplikasi: Keytool dan Jarsinger. </li><li>  Jalankan perintah untuk merakit aplikasi: </li><li>  apktool b C: \ Users \ User \ Desktop \ ******** </li><li>  Berikutnya: cd ******** \ dist \ </li><li>  Berikutnya: Keytool.exe -genkey -alias key.keystore -keyalg RSA-validitas 20000 -keystore key.keystore </li><li>  Berikutnya: Jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore key.keystore ********. Apk key.keystore </li><li>  Berikutnya: jarsigner -verify -verbose -certs ********. Apk </li></ol><br>  Di sini, pada prinsipnya, semua manipulasi selesai.  Sekarang kami memasang aplikasi di telepon menggunakan adb install atau dari direktori smartphone dan Anda dapat melakukan pengujian kerentanan dinamis. <br><br>  Setelah menginstal aplikasi, jalankan (lihat Gambar. 11 dan Gambar. 12). <br><br><div class="scrollable-table"><table><tbody><tr><td><img src="https://habrastorage.org/webt/8u/vu/dp/8uvudpp63auy8mj4e5pqflh5uhg.png"></td><td><img src="https://habrastorage.org/webt/9w/6a/zs/9w6azsxbds70ezl-sajh64xnqk8.png"></td></tr><tr><td>  Fig.  11. Aktifkan mode Pengembang dan hubungkan USB </td><td>  Fig.  12. Meluncurkan aplikasi </td></tr></tbody></table></div><br>  <b>Kesimpulan</b> <br><br>  Dalam contoh praktis, saya menunjukkan bagaimana Anda dapat menonaktifkan beberapa pemeriksaan pada kondisi runtime.  Selanjutnya, dengan bantuan alat-alat lain, kami melakukan analisis kerentanan, tetapi ini adalah cerita yang berbeda ... <br><br>  Sikap yang lalai terhadap perlindungan kode dapat menyebabkan: <br><br><ul><li>  ini adalah pengelakan dari cek tertentu yang tertanam dalam program </li><li>  implementasi kode pihak ketiga, setelah itu program dapat dipublikasikan dan digunakan sebagai berbahaya </li></ul><br>  Bagaimana saya bisa melindungi diri saya sendiri?  Di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">ByteCode, kami</a> memutuskan untuk tidak menemukan kembali roda dan menyarankan agar klien mengaburkan kode sumber dan menggunakan fungsi yang memeriksa modifikasi kode sumber. <br><br>  PS <br><br>  Anda dapat menggunakan metode analisis yang lebih maju - ini adalah debugging smali.  Anda dapat membaca lebih lanjut tentang ini di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" rel="nofollow">manual</a> . <br><br>  Sedikit referensi, saya merumuskan daftar garis yang digunakan untuk memeriksa rutin: <br><br><ul><li>  "Kunci-uji"; </li><li>  "/system/app/Superuser.apk"; </li><li>  "/ sbin / su"; </li><li>  "/ system / bin / su"; </li><li>  "/ system / xbin / su"; </li><li>  "/ data / lokal / xbin / su"; </li><li>  "/ data / lokal / bin / su"; </li><li>  "/ system / sd / xbin / su"; </li><li>  "/ system / bin /ailsafe / su"; </li><li>  "/ data / lokal / su"; </li><li>  "/ su / bin / su"; </li><li>  "/ system / xbin / that"; </li><li>  "Su"; </li><li>  "Yang". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id419171/">https://habr.com/ru/post/id419171/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id419155/index.html">Porting JS ke Elbrus</a></li>
<li><a href="../id419159/index.html">Kode JS, angka Romawi, teka-teki geometris: bagaimana kita mengenkripsi zaman kita</a></li>
<li><a href="../id419161/index.html">Pemodelan permukaan air menggunakan prosesor FFT dan NeuroMatrix DSP</a></li>
<li><a href="../id419165/index.html">Kami mengirim SMS "anonim" dari Konsol ke nomor yang diinginkan menggunakan layanan bytehand dan C ++</a></li>
<li><a href="../id419169/index.html">"Dunia Wild West" melalui mata pengembang</a></li>
<li><a href="../id419173/index.html">Arsitektur bersih dalam konteks pengembangan lintas platform</a></li>
<li><a href="../id419177/index.html">Pola Cahaya Amazon</a></li>
<li><a href="../id419179/index.html">Arsitektur pragmatis murni. Brainstorming</a></li>
<li><a href="../id419181/index.html">Pemrograman Mouse: Bagaimana Kami Lari Dari Rutin CRM</a></li>
<li><a href="../id419183/index.html">Demopati di Helsinki "Majelis 2018", laporan foto, hari pertama</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>