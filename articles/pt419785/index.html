<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüé® ü§º üî¥ Como o MSTP funciona üêÄ üßïüèª ‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoje vamos falar sobre o MSTP. Antes de lidar com o MSTP, voc√™ precisa se familiarizar com os protocolos STP e RSTP . MSTP √© uma modifica√ß√£o do RSTP e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como o MSTP funciona</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419785/"> Hoje vamos falar sobre o MSTP.  Antes de lidar com o MSTP, voc√™ precisa se familiarizar com os protocolos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">STP</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">RSTP</a> .  MSTP √© uma modifica√ß√£o do RSTP e, portanto, STP.  Se o RSTP √© o mesmo STP, apenas com o envio mais otimizado de BPDUs e STP funcione em geral, por que devemos criar um MSTP que funcione com base no RSTP?  A principal caracter√≠stica do MSTP √© a capacidade de trabalhar com VLANs.  Alguns leitores podem dizer: "Espere, o Cisco pvst + e o rpvst + n√£o podem trabalhar com vlan?"  O RPVST + e o PVST + simplesmente executam inst√¢ncias independentes de RSTP ou STP dentro de um √∫nico limite de vlan.  Mas aqui h√° problemas: <br><br><ul><li>  O RPVST + e o PVST + est√£o dispon√≠veis apenas nos equipamentos da Cisco, e na Cisco n√£o h√° STP e RSTP cl√°ssicos.  O que devemos fazer se outros fornecedores participarem da topologia? </li><li>  Cada inst√¢ncia do STP e RSTP envia BPDUs a cada dois segundos.  Se 100 vlanes forem puladas para a porta do tronco, isso significa que 100 mensagens ser√£o enviadas em 2 segundos.  O que n√£o √© muito bom. </li><li>  A Cisco tem um limite no n√∫mero de inst√¢ncias STP ou RSTP em um √∫nico switch, dependendo do modelo.  Ou seja, adicionando 128 vlans em algum switch, enfrentaremos essa restri√ß√£o.  Link <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">aqui</a> </li></ul><a name="habracut"></a><br>  Todos esses problemas s√£o resolvidos com sucesso pelo protocolo MSTP de v√°rios fornecedores.  Vamos tentar lidar com o trabalho dele.  O esquema para construir uma topologia sem loop no RSTP √© construir um gr√°fico sem interse√ß√µes, independentemente da topologia l√≥gica, sem considerar onde e como as vlans est√£o configuradas.  No MSTP, temos a oportunidade de combinar determinadas vlans em um grupo e criar uma topologia separada para cada grupo.  Por exemplo, d√™ uma olhada nessa topologia: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/893/ec7/7a1/893ec77a1fc1abfe79a50798cbd67141.jpg" alt="Minha imagem"></a> <br><br>  PCs atuam como segmentos de rede.  PC1, PC3 √© um segmento de rede em que as vlans s√£o usadas de 10 a 50 e PC2 e PC4 s√£o vlans de 50 a 100. Nos comutadores Sw1-4, s√£o criadas vlans de 10 a 100. Se usarmos o protocolo RSTP, segmentos PC1 e PC2 para chegar aos segmentos PC3 e PC4, respectivamente, voc√™ deve usar um caminho comum, escolhendo-o entre dois poss√≠veis: <b>Sw1-Sw2-Sw4</b> ou <b>Sw1-Sw3-Sw4</b> .  Infelizmente, n√£o funcionar√° para construir um circuito com distribui√ß√£o de carga e um desses caminhos estar√° bloqueado e vazio.  Com a ajuda do PVST + e RPVST +, ser√° poss√≠vel fazer isso, mas existem os problemas mencionados acima.  O MSTP ajuda-nos nesta quest√£o, criando inst√¢ncias RSTP para um grupo de vlans 10-50 e 50-100.  Pode-se configurar que o switch raiz da Vlan 10-50 seja Sw3 e para 50-100 - Sw2.  O <b>caminho Sw1-Sw3-Sw4</b> ser√° usado pela vlan 10-50, o <b>caminho Sw1-Sw2-Sw4</b> ser√° usado pela vlan 50-100.  A id√©ia √© criar inst√¢ncias que combinem vlans e construam uma √°rvore RSTP separadamente para cada inst√¢ncia.  Assim, combinando o vlana 10-50 e 51-100 em diferentes inst√¢ncias, o protocolo MSTP permitir√° criar √°rvores independentes para cada inst√¢ncia.  A configura√ß√£o ter√° a seguinte apar√™ncia: <br><blockquote>  configura√ß√£o mst de Spanning Tree <br>  nota de nome <br>  inst√¢ncia 1 vlan 10-50 <br>  inst√¢ncia 2 vlan 51-100 <br></blockquote>  Ser√° id√™ntico em todos os 4 switches.  Switches com configura√ß√£o id√™ntica desses par√¢metros criam uma regi√£o.  Em rela√ß√£o √†s regi√µes, falaremos com mais detalhes abaixo, enquanto consideramos a topologia em uma regi√£o.  Para cada inst√¢ncia, sua pr√≥pria ponte raiz √© selecionada.  No Sw3, inserimos <b>o</b> comando <b>principal de extens√£o da √°rvore mst 1</b> para que Sw3 seja a ponte raiz para 10-50 vlans, e no Sw2 <b>extens√£o de raiz da mst 2 raiz</b> para 51-100 vlans.  Resumindo, cada inst√¢ncia - <b>v√°rias</b> inst√¢ncias de <b>Spanning Tree (MSTI)</b> - combina vlana.  E cada regi√£o combina switches que possuem o mesmo MSTI.  A rigor, na regi√£o o comutador deve ter os seguintes par√¢metros: <br><br><ul><li>  nome da regi√£o - o nome da regi√£o.  Definido pelo comando name. </li><li>  n√≠vel de revis√£o - par√¢metro de altera√ß√£o de configura√ß√£o. </li><li>  MSTI. </li></ul><br>  Em cada regi√£o, h√° uma inst√¢ncia do MSTI 0 (inst√¢ncia 0), que √© criada por padr√£o e inclui todas as vlans que n√£o foram inclu√≠das em outras inst√¢ncias.  A inst√¢ncia 0 √© chamada IST: <br>  <b>A √°rvore</b> de expans√£o <b>interna (IST)</b> √© uma c√≥pia especial da √°rvore de expans√£o que, por padr√£o, existe em cada regi√£o do MST.  N√∫mero 0 atribu√≠do pelo IST (inst√¢ncia 0).  Ele pode enviar e receber quadros BPDU e serve para gerenciar a topologia em uma regi√£o.  Todas as VLANs configuradas nos comutadores nesta regi√£o MST s√£o vinculadas ao IST por padr√£o. <br>  O Root Bridge para IST √© chamado de Regional Root Bridge.  √â atrav√©s do IST que os quadros BPDU s√£o transmitidos atrav√©s dos quais a √°rvore de cada inst√¢ncia √© instalada.  Vejamos como √© o BDPU nesta regi√£o: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/603/7e8/9b6/6037e89b6888f6219b2bd82c2271c761.jpg" alt="Minha imagem"></a> <br><br>  Antes do in√≠cio da extens√£o MST, o BPDU MSTP √© muito dif√≠cil de separar do BPDU RSTP e, grosso modo, o IST √© um RSTP cl√°ssico.  O MSTP adiciona apenas dados no MSTI.  BPDU armazena informa√ß√µes de ponte raiz para a inst√¢ncia 0-2.  Assim, para todas as vlans e autoridades, apenas um BPDU √© enviado, que cont√©m todas as informa√ß√µes necess√°rias.  Isso representa uma enorme economia em rela√ß√£o ao PVST + e RPVST +.  Vamos ver a sa√≠da do comando show spanning-tree mst no switch Sw2: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/211/365/372/2113653723bfbe70f327a68a1ea4f27d.jpg" alt="Minha imagem"></a> <br><br>  Por exemplo 0, h√° um campo especial - Raiz Regional.  Raiz regional, selecionamos Sw3 usando o <b>comando principal spanning-tree mst 0 root</b> .  Raiz regional √© a op√ß√£o de raiz para MSTI 0 na mesma regi√£o.  Para MSTI1, a raiz tamb√©m √© Sw3 e, para MSTI2, √© Sw2.  Em termos de bloqueio de portas e converg√™ncia, o MSTP repete os princ√≠pios do RSTP com base nos quais ele trabalha, ent√£o acho que o trabalho do MSTP em uma regi√£o √© bastante compreens√≠vel.  Considere uma topologia com duas regi√µes: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/501/c74/f20/501c74f206c089449ca1238133fa5dd8.jpg" alt="Minha imagem"></a> <br><br>  Sobre a Regi√£o A, como foi dito acima, agora vamos tentar descobrir como as regi√µes interagem umas com as outras.  Na regi√£o B, os comutadores t√™m a seguinte configura√ß√£o: <br><blockquote>  configura√ß√£o mst de Spanning Tree <br>  nome RegionB <br>  inst√¢ncia 1 vlan 10-30 <br>  inst√¢ncia 2 vlan 31-60 <br></blockquote>  Ao mesmo tempo, Sw9 √© o <b>principal raiz</b> do <b>spanning tree mst 1</b> √© o comutador raiz da Vlan 10-30 e Sw10 √© o <b>principal raiz spanning tree do mst 2</b> √© o comutador raiz da Vlan 31-60. <br><br>  A constru√ß√£o da √°rvore STP na Regi√£o B √© semelhante √† Regi√£o A e foi descrita acima.  Basta dizer, como n√£o definimos a Bridge Raiz para o MSTI 0 na Regi√£o B, ela ser√° selecionada pelo menor endere√ßo MAC entre o Sw9-12.  O menor endere√ßo MAC √© Sw9.  Sa√≠da de comando com Sw10: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7f4/52a/bbd7f452a27ace3d97fc9b714bfed31a.jpg" alt="Minha imagem"></a> <br><br>  Para MSTI 0 Raiz Regional 5000.0009.0000 (Sw9).  A seguir, discutiremos por que o Sw9 e por que o endere√ßo priorit√°rio ou papoula n√£o tem nada a ver com isso.  Agora, estamos mais interessados ‚Äã‚Äãna quest√£o do que acontecer√° na fronteira.  Para que a √°rvore STP seja criada corretamente entre regi√µes, uma √°rvore comum √© criada para todas as regi√µes usando MST0 (IST).  Essa √°rvore √© chamada CIST.  Vamos apresentar o conceito tamb√©m CST.  Ent√£o, primeiro lembre-se do IST: <br><br><ul><li>  <b>A √°rvore</b> de expans√£o <b>interna (IST)</b> √© uma c√≥pia especial da √°rvore de expans√£o que existe por padr√£o em cada regi√£o do MST.  N√∫mero 0 atribu√≠do pelo IST (inst√¢ncia 0).  O IST pode enviar e receber quadros BPDU e serve para gerenciar a topologia em uma regi√£o.  Por padr√£o, todas as VLANs na mesma regi√£o est√£o vinculadas ao IST.  Se v√°rios MSTIs forem criados em uma regi√£o, as VLANs n√£o associadas a eles permanecer√£o vinculadas ao IST.  Em nossas regi√µes A e B, uma √°rvore STP independente est√° sendo constru√≠da para vlans que n√£o se enquadram nas autoridades 1 e 2. A Root Bridge no IST √© denominada Regional Root. </li><li>  <b>Common Spanning Tree (CST)</b> - uma √°rvore que conecta regi√µes e todos os switches STP, RSTP, PVST +, RPVST + (n√£o switches MST). </li><li>  <b>√Årvore de expans√£o comum e interna (CIST)</b> - uma √∫nica √°rvore de expans√£o que combina o CST e o IST de cada regi√£o do MST. </li></ul><br>  Para entender os limites de cada √°rvore, sugiro o seguinte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">artigo</a> . <br><br>  IST √© uma √°rvore dentro de uma regi√£o, CIST √© uma √°rvore entre regi√µes, CST √© uma √°rvore que combina √°rvores dentro de uma regi√£o e uma √°rvore para conectar regi√µes. <br><br>  Desde que introduzimos o comando <b>principal</b> do <b>spanning-tree mst 0</b> no Sw3, a ponte raiz do CIST para ambas as regi√µes ser√° Sw3.  Se houver apenas uma regi√£o na topologia inteira, a Ponte Raiz Regional e a Ponte Raiz CIST coincidir√£o.  Se houver muitas regi√µes, a melhor raiz regional entre todas as regi√µes ser√° selecionada.  Al√©m disso, os comutadores que usam protocolos diferentes do MSTP podem ser usados ‚Äã‚Äãnas elei√ß√µes para a fun√ß√£o de CIST Root Bridge.  Se voc√™ tentar criar uma imagem geral, poder√° explicar a intera√ß√£o das regi√µes da seguinte maneira: Cada regi√£o parece ser uma combina√ß√£o de v√°rios comutadores e √© apresentada a outros comutadores como um comutador virtual grande.  Ou seja, se considerarmos nossa topologia pelos olhos da regi√£o B, obteremos a seguinte imagem: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/1d9/115/6f5/1d91156f550268ff06521adfff7a4136.jpg" alt="Minha imagem"></a> <br><br>  Ser√° semelhante para a regi√£o A, regi√£o B ser√° representada por um comutador.  Em cada regi√£o, cada switch possui uma porta raiz conectando-a √† raiz regional.  Cada regi√£o tamb√©m seleciona uma porta raiz para o MSTI 0, o que leva a uma ponte raiz CIST comum.  Essas portas podem ser as portas Gi1 / 1 no Sw9 e Sw10, pois conectam regi√µes.  Em nossa topologia, o Sw9 possui o melhor ID da ponte, a porta raiz √© selecionada e, no Sw10, a porta Gi1 / 1 √© bloqueada.  No Sw9, para MSTI 0, a porta Gi1 / 1 √© a Porta Raiz, mas, por exemplo, para MSTI 1 e 2, h√° uma Porta Raiz para a Ponte Raiz da Inst√¢ncia e a porta que leva √† Ponte Raiz CIST recebe uma nova fun√ß√£o - Mestre.  De uma regi√£o para outra, pode haver apenas um canal de trabalho ou, em outras palavras, apenas uma porta Mestre e apenas em um comutador.  Aqui est√£o as informa√ß√µes sobre o MST no switch Sw9, no qual a porta Master ser√° selecionada, preste aten√ß√£o √† porta Gi1 / 1: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/bbd/7f4/52a/bbd7f452a27ace3d97fc9b714bfed31a.jpg" alt="Minha imagem"></a> <br><br>  Essa porta para o MSTI 0, como dissemos, tem o papel de Raiz e para o MSTI 1-2 Master.  Tamb√©m introduziu um novo tipo de canal - P2p Bound (RSTP).  O tipo de limite √© atribu√≠do √†s portas que fazem fronteira com a outra regi√£o ou outra variante do protocolo STP.  As informa√ß√µes sobre a ponte raiz CIST s√£o transmitidas para a regi√£o atrav√©s da porta mestre, uma caracter√≠stica distintiva √© que essa porta n√£o envia BPDUs por si s√≥, mas apenas recebe, diferentemente do tipo de porta P2P no RSTP.  A exce√ß√£o √© apenas BPDU com o sinalizador TC (altera√ß√£o de topologia).  Vamos ver como um switch em uma regi√£o processa BPDUs de outra regi√£o.  Como dissemos na porta Mestre Gi1 / 1 Sw9, as BPDUs do Sw1 ser√£o recebidas, enquanto o pr√≥prio Sw9 n√£o ser√° enviado, considere-o novamente: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/4d8/35e/f5a/4d835ef5a9fdc2514075fab810cf5cb9.jpg" alt="Minha imagem"></a> <br><br>  Sw1 envia o mesmo BPDU, independentemente de o switch enviar BPDUs dentro da regi√£o ou fora da regi√£o.  Depois de aceitar esse BPDU, o Sw9 processar√° as informa√ß√µes apenas antes do in√≠cio do campo Extens√£o MST, apenas essas informa√ß√µes s√£o usadas para construir uma √°rvore na inst√¢ncia 0. Aqui voc√™ pode notar um fato interessante - o Identificador Raiz (50: 00: 00: 03: 00: 00) corresponde ao Identificador da Ponte (50: 00: 00: 03: 00: 00), embora ele envie o pacote Sw1 com o Identificador de ponte - 50: 00: 00: 01: 00: 00.  Isso confirma nossa teoria de que cada regi√£o para outra √© representada por um grande comutador virtual.  Voc√™ tamb√©m pode dizer que, entre as regi√µes, temos o RSTP cl√°ssico.  Mas vamos falar sobre o custo do caminho raiz.  Existem dois tipos de custo de caminho - interno e externo.  O custo do caminho raiz, que aponta para MSTI 0, √© externo.  E, apesar do fato de haver mais um canal do Sw1 para o Root Bridge (Sw3), ele ainda √© indicado como zero.  Era como se o pr√≥prio Root Bridge o tivesse enviado.  Os custos internos do caminho raiz est√£o listados nos campos abaixo da extens√£o MST.  Custo do caminho da raiz interna do CIST indica o custo do caminho para a ponte raiz regional para o MSTI 0 e os campos abaixo do MSTID 1 e 2 indicam Custo do caminho da raiz interna para a ponte raiz para cada inst√¢ncia, respectivamente.  O custo do caminho raiz externo tem um papel especial e muito importante, ele determinar√° a ponte raiz regional, e n√£o o endere√ßo priorit√°rio e de papoula, fizemos uma observa√ß√£o sobre isso acima.  O comutador que tem o menor custo do caminho raiz at√© a ponte raiz CIST se tornar√° a ponte raiz regional!  Por exemplo, Sw9 e Sw10 t√™m um custo de caminho raiz de 20.000, igual ao custo da porta Gi1 / 1.  E somente depois disso eles come√ßam a comparar seus IDs de ponte.  Vamos verificar isso, altere o custo do link para Sw10 e, ao mesmo tempo, aumente sua prioridade ao m√°ximo para excluir sua op√ß√£o de selecionar Raiz regional por prioridade.  Introduzimos os seguintes comandos: <br><blockquote>  Sw10 (config-if) # spanning-tree mst 0 prioridade 61440 <br>  Gigabit de interface Sw10 (config-if) # <br>  Sw10 (config-if) # spanning-tree mst 0 custam 10000 <br></blockquote>  E entendemos que o Sw10, apesar de sua terr√≠vel prioridade, tornou-se Regional Root Bridge: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/e5b/abd/51c/e5babd51cd3a12bfbe4e0ab94d9b474a.jpg" alt="Minha imagem"></a> <br><br>  Assim, a sele√ß√£o da ponte raiz regional ocorre nesta sequ√™ncia e a ponte raiz regional nunca pode ser um comutador sem portas de limite: <br><br><ul><li>  Menor custo de caminho externo para a ponte raiz do CIST. </li><li>  Identificador de ponte regional mais baixo. </li><li>  Identificador de ponte CIST do BPDU da regi√£o com ponte raiz do CIST. </li></ul><br>  Se, por exemplo, adicionarmos um link entre Sw9 e Sw4 e pensarmos em qual link se tornar√° Master, com todos os par√¢metros iguais, o campo Identificador de Ponte CIST, que √© menor que a Extens√£o MST, se tornar√° o campo determinante.  Mentimos um pouco quando dissemos que o Sw9 n√£o analisa os dados abaixo da Extens√£o MST.  Nesse caso, o identificador de ponte CIST da extens√£o MST ser√° contado. <br>  Agora vamos ver o comportamento do MST quando adicionamos op√ß√µes RPVST: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/d40/eff/45b/d40eff45b3025e0e1b47b6a352199390.jpg" alt="Minha imagem"></a> <br><br>  Dois casos s√£o poss√≠veis: <br><br><ol><li>  O Root Bridge √© de propriedade do RPVST. </li><li>  O Root Bridge √© de propriedade do MSTP. </li></ol><br>  Considere primeiro o caso em que o Sw3 continua sendo uma ponte raiz CIST (ou seja, o caso 2).  Nesse caso, Sw10 e Sw12 assim que receberem BPDU de RSTP1 e RSTP2 para cada vlan, eles mudar√£o o tipo de porta Gi1 / 0 para <b>P2p Bound (PVST)</b> .  Esse tipo significa que Sw10 e Sw12 nesta porta est√£o conectados aos comutadores RPVST e come√ßar√£o a enviar c√≥pias de BPDUs para MSTI0 (ou seja, sem campos abaixo da extens√£o MST) a todas as vlanes permitidas nessa porta.  Assim, o RSTP1 e o RSTP2 n√£o notar√£o que o Sw10 e o Sw12 usam um protocolo diferente.  Essa tecnologia no MSTP √© chamada <b>Simula√ß√£o PVST</b> e <b>,</b> com ela, obtemos coordena√ß√£o entre diferentes switches. <br><br>  O caso em que o Root Bridge est√° entre os comutadores RPVST √© mais complexo e n√£o recomendado.  Suponha que temos RSTP1 √© a ponte raiz para todas as vlan.  Para simplificar, assumimos que as vlans 1-3 s√£o criadas e o comando <b>spanning-tree vlan 1-3 priority 12288</b> √© introduzido, a menor prioridade entre os switches RSTP e MSTP.  Sw10 come√ßar√° a receber BPDU para cada vlana.  √â muito importante entender que apenas as BPDUs para Vlan 1. ser√£o processadas pelo switch MSTP. Como isso acontece? <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/d40/eff/45b/d40eff45b3025e0e1b47b6a352199390.jpg" alt="Minha imagem"></a> <br><br>  Dependendo de quantas vlans est√£o configuradas, muitos pacotes RPVST + BPDU ser√£o enviados, mas, al√©m disso, tamb√©m ser√£o enviados via BPDU da vlan nativa com o endere√ßo mac de destino - 01: 80: c2: 00: 00: 00.  √â esse endere√ßo de papoula que o MSTP usa, os comutadores PVST e RPVST usam um endere√ßo de papoula diferente - 01: 00: 0c: cc: cc: cd.  Independentemente de qual vlan estiver configurada como nativa, as informa√ß√µes da primeira vlan ser√£o transmitidas neste BPDU.  Somente este pacote ser√° processado para criar a √°rvore pelos comutadores MSTP.  As BPDUs restantes para determinadas vlanes ser√£o usadas para verificar a prote√ß√£o do n√≥ raiz durante as simula√ß√µes de PVST (verifica√ß√£o de consist√™ncia baseada em guarda de raiz de simula√ß√µes de PVST).  Que tipo de cheque?  Assim que configurarmos o RSTP1 usando esse comando <b>spanning-tree vlan 1-3 priority 12288</b> , o Sw10 obter√° imediatamente um erro: <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/7a0/098/25f/7a009825fc7dd326bc5e426493500385.jpg" alt="Minha imagem"></a> <br><br>  Vamos tentar explicar.  O Sw10 adotou uma BPDU de vlan nativa para a vlan 1 com prioridade 12288 + 1.  Processado e decidido que Gi1 / 0 √© sua porta raiz.  Depois veio o PVST BPDU para o restante da vlan (1-3), ele os estudou para verificar a integridade do switch raiz e havia prioridades 12288 + 2, 12288 + 3 para a vlan 2-3, que s√£o mais de 12288 + 1.  A integridade entra em colapso - por um lado, deve ser a porta raiz e a obten√ß√£o de outras prioridades mais altas for√ßa a porta a mudar para a fun√ß√£o designada.  Essa ambiguidade n√£o √© permitida para esses protocolos e o MST bloqueia essa porta, transformando-a no estado BKN, relatando um erro - <b>Bloqueando a porta raiz Gi1 / 0: PVST BPDU inferior inconsistente recebido</b> .  Para evitar isso, √© necess√°rio que nem uma √∫nica vlan cujos BPDUs sejam transmitidos nessa porta tenha uma prioridade mais baixa (mais) que a vlan 1. Ou seja, se reduzirmos a prioridade da vlan 2‚Äì3 para 4096, √© obviamente menor que vlana 1, corrija esse problema. <br><br> <a href="" rel="nofollow"><img src="https://habrastorage.org/getpro/habr/post_images/0f6/4a6/c6d/0f64a6c6d9b21ae127cb5572c7ade92d.jpg" alt="Minha imagem"></a> <br><br>  Como voc√™ pode ver, apareceu uma mensagem que restaura a opera√ß√£o correta da porta - <b>inconsist√™ncia do PVST Simulation limpa na porta GigabitEhternet 0/1</b> . <br><br>  Penso nisso, para concluir a conversa sobre o MSTP.  Links √∫teis abaixo: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">www.cisco.com/c/en/us/support/docs/lan-switching/multiple-instance-stp-mistp-8021s/116464-configure-pvst-00.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">habrahabr.ru/post/128172</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">www.cisco.com/c/ru_s/support/docs/lan-switching/multiple-instance-stp-mistp-8021s/116464-configure-pvst-00.pdf</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">www.cisco.com/c/en/us/td/docs/switches/datacenter/nexus5000/sw/configuration/guide/cli_rel_4_0_1a/CLIConfigurationGuide/MST.html</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">networkengineering.stackexchange.com/questions/28716/multiple-spanning-tree-terminology-cst-ist-cist-and-exact-behavior</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">blog.sbolshakov.ru/11-3-mstp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">blog.ine.com/2010/02/22/understanding-mstp</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" rel="nofollow">networklessons.com/spanning-tree/multiple-spanning-tree-mst</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419785/">https://habr.com/ru/post/pt419785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419775/index.html">Minha vers√£o do "dispositivo para sonhos l√∫cidos" √© uma breve hist√≥ria e descri√ß√£o da primeira vers√£o</a></li>
<li><a href="../pt419777/index.html">Como vender servidores NNN na Holanda e n√£o ficar com puro entusiasmo: segredos de vendas</a></li>
<li><a href="../pt419779/index.html">Os pulm√µes crescidos foram transplantados com sucesso para um porco; ap√≥s 5 anos, testes em humanos s√£o poss√≠veis</a></li>
<li><a href="../pt419781/index.html">A SpaceX realizou o primeiro Workshop de Marte</a></li>
<li><a href="../pt419783/index.html">Homem versus m√°quina: uma nova √©tica para a seguran√ßa cibern√©tica</a></li>
<li><a href="../pt419787/index.html">Relat√≥rio de Clubes 2018, Cap√≠tulo 3.9: ‚ÄúDesempenho em cinco vezes os recursos‚Äù</a></li>
<li><a href="../pt419789/index.html">Jimmy Wales Pensamentos: "A Wikipedia √© como uma salsicha ..."</a></li>
<li><a href="../pt419791/index.html">Apple recusa programa de afiliados para promover aplicativos da App Store</a></li>
<li><a href="../pt419795/index.html">Tesla relatou uma perda recorde. As a√ß√µes da empresa ainda subiram devido √†s previs√µes para o pr√≥ximo trimestre</a></li>
<li><a href="../pt419797/index.html">Engenharia reversa do protocolo do painel do ar condicionado do inversor Electrolux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>