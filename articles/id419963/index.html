<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ½â€ğŸ¨ ğŸ‘µ ğŸ» Kami membuat pengontrol "pintar" untuk AC di ESP8266 ğŸ”¬ ğŸ‘¨ğŸ¼â€âš–ï¸ ğŸ¤œğŸ¿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Musim panas telah tiba, dengan panas, dan juga waktu untuk menyalakan pendingin udara. Dan jika Anda menyukai teknologi modern dan rumah pintar, maka ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami membuat pengontrol "pintar" untuk AC di ESP8266</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419963/">  Musim panas telah tiba, dengan panas, dan juga waktu untuk menyalakan pendingin udara.  Dan jika Anda menyukai teknologi modern dan rumah pintar, maka Anda ingin melakukan kontrol AC entah bagaimana dengan cerdas (atau setidaknya dengan cara modern).  Di bawah ini adalah serangkaian catatan tentang upaya saya untuk mengintegrasikan cuaca di rumah dengan kontrol suara dan antarmuka lintas platform. <br><br><h2>  Tantangan </h2><br>  Ada empat pendingin ruangan di apartemen, Anda perlu belajar cara mengelolanya: <br><br><ul><li>  Dari antarmuka web (saya memilikinya Home Assistant, berputar pada Raspberry Pi terpisah, tetapi idealnya saya ingin koneksi sederhana ke sistem apa pun); </li><li>  Suara (Google Assistant akan melakukannya, lalu pikirkan Alice); </li><li>  Skrip; </li><li>  Murah ... </li></ul><br><a name="habracut"></a><h2>  Riset pasar </h2><br><h3>  Solusi asli </h3><br>  Mungkin saya bahkan tidak akan memberi tahu.  Keputusan dari produsen AC saya melibatkan banyak kabel, setidaknya dua modul tambahan untuk setiap unit, dan harga sekitar $ 200 per kamar.  Ditambah protokol berpemilik, aplikasi kuno, dan semua itu.  Coret. <br><br><h3>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Sensibo sky</a> </h3><br>  Sekitar $ 100 per kamar, asli bekerja dengan Google Assistant dan IFTTT, terlihat cantik, tetapi masih sedikit mahal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gw/yk/1c/gwyk1cvd9ukjhx9swiorxomydaw.jpeg"></div><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tado Â°</a> - sama (dan bahkan lebih mahal). <br><br><h3>  Xiaomi Aqara / Mi Home, Broadlink RM Pro / Mini </h3><br>  Pemancar IR universal, beberapa secara teoritis mendukung pendingin udara yang diperlukan "di luar kotak", berintegrasi dengan Home Assistant menjadi dua, tetapi secara umum - solusi yang sangat-begitu, meskipun label harga sudah jauh lebih dekat dengan yang terjangkau ($ 20-35 per kamar, tergantung pada kemampuan )  Ya, dan aplikasi dalam bahasa Cina (dalam beberapa kasus) bukan yang saya inginkan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/5e/jy/ox/5ejyoxdz-way61igy_qqt1xk1n8.jpeg"></div><br><h3>  DIY </h3><br>  Cara termurah dan paling fleksibel, yang akan saya bicarakan lebih lanjut. <br><br><h2>  Pemilihan Komponen </h2><br>  Ada sesuatu untuk dipikirkan, tetapi secara umum kita perlu: <br><br><h3>  Besi </h3><br><h4>  Pengendali </h4><br>  Kami dengan bodohnya menggunakan ESP8266, dan untuk kesederhanaan firmware dan catu daya, kami akan menggunakan D1 mini.  Kami jelas akan mengelola sistem melalui WiFi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lj/ky/l1/ljkyl1s6uubm_thvjuhnj6zggoi.jpeg"></div><br><h4>  Pemancar IR </h4><br>  Untuk prototipe, kita akan menggunakan LED IR sederhana, resistansi dan transistor, maka kita akan memikirkan bagaimana ini dapat ditingkatkan. <br><br><h4>  Sensor suhu </h4><br>  Lebih asyik dengan itu, Anda dapat mengatur suhu target, dan melakukan on / off otomatis.  Untuk memulai, ambil DHT22 dengan bodoh. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cc/qb/tm/ccqbtm6-pkoe1xnxzetkaj8by98.jpeg"></div><br><h4>  Layar </h4><br>  Kami akan menampilkan kondisi sistem saat ini (untuk debugging), dan mungkin alamat ip saat ini (akankah ini berguna?). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/br/ha/gd/brhagdvncv5xxv8dos3nk_c9saw.jpeg"></div><br><h3>  Perangkat lunak </h3><br><h4>  IDE </h4><br>  Kami akan mengimplementasikan semua yang ada di IDE Arduino (yang belum pernah saya kerjakan sebelumnya) menggunakan perpustakaan terbuka. <br>  Jauh kemudian, ketika proyek sudah bekerja, saya beralih ke Visual Studio Code dengan plugin <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PlatformIO</a> . <br><br><h4>  Protokol </h4><br>  Kami akan berkomunikasi dengan Home Assistant melalui MQTT (perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PubSubClient</a> ), karena  ini adalah protokol terbuka, dan ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">komponen</a> khusus untuknya. <br><br>  Konfigurasi akan terlihat, misalnya, seperti ini: <br><br><pre><code class="hljs pgsql">climate: - platform: mqtt <span class="hljs-type"><span class="hljs-type">name</span></span>: Living Room HVAC modes: - "off" - "auto" - "heat" - "cool" - "dry" - "fan" swing_modes: - "auto" - "off" fan_modes: - "auto" - "low" - "medium" - "high" mode_command_topic: "livingroom/meteo/mode/set" mode_state_topic: "livingroom/meteo/mode" temperature_command_topic: "livingroom/meteo/target/set" temperature_state_topic: "livingroom/meteo/target" fan_mode_command_topic: "livingroom/meteo/fan/set" fan_mode_state_topic: "livingroom/meteo/fan" swing_mode_command_topic: "livingroom/meteo/swing/set" swing_mode_state_topic: "livingroom/meteo/swing" current_temperature_topic: "livingroom/meteo/temperature"</code> </pre> <br><h4>  Manajemen </h4><br>  Perpustakaan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">HeatpumpIR</a> akan membantu kami mengirim sinyal ke AC (model AC masih hardcoded). <br><br><h4>  Lain-lain </h4><br>  Anda akan membutuhkan lebih banyak perpustakaan untuk pengatur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">waktu</a> , untuk bekerja dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sensor suhu</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">layar</a> , tetapi ini adalah hal-hal sepele.  Kami akan menambahkan WiFiManager dan ArduinoOTA dengan gerakan biasa untuk memperbarui firmware melalui antarmuka web, dan bukan USB. <br><br><h2>  Prototipe (00) </h2><br>  Kami membeli komponen acak di aliexpress, menempatkannya di papan khayalan, menguji idenya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n2/ve/_3/n2ve_3e4xbgeselooxb_z34j2zq.jpeg"></div><br>  Kami memahami bahwa: <br><br><ul><li>  Layar diperintahkan terlalu besar dan memiliki kaki terlalu banyak. </li><li>  Satu LED tidak menekan terlalu jauh, dan tidak terlalu dapat diandalkan. </li></ul><br>  Tapi secara keseluruhan idenya berhasil!  Komponen "asli" HVAC muncul di antarmuka Home Assistant, yang berarti bahwa kendali dari mana saja di dunia sudah ada di saku kami.  Integrasi asli Asisten Rumah dengan Google Asisten menambahkan perintah suara dan umpan balik: Anda dapat bertanya kepada asisten tentang suhu di dalam ruangan, dan dia akan menjawab target dan suhu saat ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sy/wv/zh/sywvzhrpxflr_8k7izcu-gkwfms.png"></div><br>  Mengubah suhu target, kecepatan hembusan, dan mode AC di antarmuka web juga tersedia (dan, yang paling penting, ini berhasil!). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/zv/ly/4k/zvly4k9nokvr_n_x0gc0knfurfk.png"></div><br><h2>  Sampel Uji (01) </h2><br>  Mari kita ubah beberapa komponen: pesan layar yang lebih kecil, dan untuk bekerja melalui I2C (dan kami akan menggunakan pustaka yang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berbeda</a> ). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9c/ld/zp/9cldzpkypgzfejdxaqujwm17qkq.jpeg"></div><br>  Kami juga mengganti LED IR dengan modul yang sudah jadi. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pu/ob/ml/puobml0kneoraufy6fft9x9vt1g.jpeg"></div><br>  Ternyata itu tidak layak memesan modul dengan satu LED (di foto di sebelah kiri) di aliexpress: mereka tidak mengandung transistor, dan salah satu kaki (VCC) yang mereka miliki pada dasarnya adalah palsu. <br><br>  Tetapi jika Anda memesan modul dengan dua LED (di foto di sebelah kanan), maka semua komponen yang diperlukan sudah ada di tempatnya, dan modul semacam itu terhubung dengan mudah dan alami, dan selesai sedikit lebih jauh. <br><br>  Ini juga saatnya untuk menempatkan semuanya pada papan sirkuit cetak saya ... Itu adalah salah satu momen paling sulit bagi seseorang yang tidak pernah mendesain papan sirkuit cetak, dan tentu saja saya melakukan semuanya dengan salah. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/z3/ea/sc/z3eascuagsayu7zqhb7_shrp0ia.png"></div><br>  Untuk desain, saya menggunakan EasyEDA, saya memesan produk jadi untuk OSHPark (sekali lagi, pasti, Anda bisa menemukan opsi yang lebih murah), dan sebagai hasilnya saya mendapat sesuatu seperti ini: <br><table><tbody><tr><td><div style="text-align:center;"><img src="https://habrastorage.org/webt/bs/cf/jr/bscfjrgse7belqqio_hc-3zmdwi.jpeg"></div></td><td><div style="text-align:center;"><img src="https://habrastorage.org/webt/l8/-q/dd/l8-qddx1ifl49weei8ic6wbrntm.jpeg"></div></td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rb/3l/iv/rb3liv9-vm-pnsaueafbpendiui.jpeg"></div><br>  Tombol ditambahkan pada saat terakhir, dan tempat untuk itu ditemukan sepenuhnya secara tidak sengaja.  Ternyata dengan tombol semuanya sedikit lebih menyenangkan, Anda tidak dapat menjaga layar menyala sepanjang waktu (yang buruk untuk OLED), tetapi tunjukkan statusnya dengan menekan. <br><br>  Yah, sudah bagus, masih harus menambahkan kasing.  Untuk melakukan ini, jalankan Blender, lakukan banyak parallelepipeds, terapkan sejumlah operasi Boolean ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fl/ig/h_/fligh_cx6xgegg5lrsoydl2azji.png"></div><br>  Dan kirim ke printer 3D. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/au/b8/ck/aub8ck2fywfbds1ytgiwbc5ia6s.jpeg"></div><br>  Secara total, ternyata murah (kurang dari $ 10 per salinan), fleksibel (ini akan bekerja dengan hampir semua AC), mudah diintegrasikan, dikendalikan oleh suara dan melalui web, secara konsisten selesai dari lima meter.  Secara umum, tentang apa yang saya inginkan. <br><br>  Bagaimana semua ini dilakukan sedikit lebih baik? .. <br><br><h2>  Model Seri (02) </h2><br>  Ada sejumlah arahan untuk meningkatkan produk yang dihasilkan (lebih tepatnya, peluang peningkatan yang memungkinkan untuk mengubah eksperimen menjadi produk): <br><br><ol><li>  Sensor suhu dapat diambil lebih kecil dan lebih akurat, misalnya, BME280, HTU21D atau Si7021, yang akan memungkinkan Anda untuk menggantungnya pada kaki yang sama dengan layar (I2C), secara signifikan mengurangi ukuran perangkat jadi dan menyederhanakan tata letak PCB.  Dalam praktiknya, ternyata BME280 yang sama mulai sangat dipengaruhi oleh pemanasan ESP8266 itu sendiri, dan bacaan yang dikeluarkan perlu disesuaikan. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sr/ws/wo/srwswovbxfecsxk0nre5sjqjm3m.jpeg"></div></li><li>  (Ini mengikuti dari paragraf pertama) Menjaga agar ESP8266 terus berjalan tidak aman, Anda perlu secara berkala pergi ke Tidur Nyenyak, hanya sesekali bangun untuk mengirim kesaksian dan menerima perintah; </li><li>  (mengikuti dari poin kedua) MQTT normal tidak lagi sangat cocok, Anda perlu menggunakan MQTT-SN sehingga perintah kontrol diingat dan dikirim ke controller pada saat bangun; </li><li>  Penerapan item-item di atas akan memungkinkan Anda untuk mengubah daya "kabel" ke baterai; </li><li>  Metode pemasangan komponen saat ini ke papan sirkuit tercetak (penyolderan konvensional) sulit untuk diterapkan dan tidak cukup fleksibel: masuk akal untuk menyolder header sehingga sensor suhu yang sama dapat diubah seperti sarung tangan; </li><li>  Akhirnya (bertentangan dengan paragraf sebelumnya), semua sama, modul jadi baik dan sederhana, tetapi sedikit rumit, idealnya bukannya D1 mini akan ada ESP8266 telanjang, dan sensor suhu, tombol dan LED IR akan disolder pada satu papan ( seperti yang mereka lakukan dalam produk serial), yang akan mengurangi ukuran perangkat dan harga seri; </li><li>  Bagaimanapun, akan lebih baik untuk memasukkan dalam firmware kemampuan untuk dengan mudah memilih model AC Anda dengan satu klik ... </li></ol><br><h2>  Kesimpulan </h2><br>  Itu adalah petualangan yang luar biasa, dan saya mengerti banyak hal.  Sebagai contoh, saya mengerti mengapa perangkat serial begitu mahal, dan berapa banyak usaha yang harus diterapkan untuk mendapatkan tingkat yang sama dengan mereka.  Di sisi lain, saya melakukan banyak hal untuk pertama kalinya dalam proyek ini (bekerja di Arduino IDE, memesan papan sirkuit cetak, membuat model untuk printer 3D), dan mendapatkan pengalaman ini sangat berharga.  Kode sumber, bagaimanapun, tidak akan menunjukkan: Saya malu pada mereka :) <br><br>  Tetapi saya masih mencapai tujuan saya, dan kontrol AC yang murah dan fleksibel ternyata cukup dapat dicapai. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id419963/">https://habr.com/ru/post/id419963/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id419949/index.html">Codec video mana (tidak) yang digunakan browser untuk panggilan video?</a></li>
<li><a href="../id419951/index.html">Pengalaman menggunakan WebRTC. Kuliah Yandex</a></li>
<li><a href="../id419953/index.html">Saya menulis buku tentang startup â€œkamiâ€ pertama yang menaklukkan dunia: bantuan</a></li>
<li><a href="../id419955/index.html">Fitur buffer FIFO UART di ESP32</a></li>
<li><a href="../id419961/index.html">Intisari materi menarik untuk pengembang seluler # 265 (6 Agustus - 12 Agustus)</a></li>
<li><a href="../id419965/index.html">Fitur Konfigurasi Sakelar ExtremeXOS</a></li>
<li><a href="../id419969/index.html">Penyembunyian di Ruby. Juga sembunyikan kelas dari Top-Level</a></li>
<li><a href="../id419971/index.html">Laboratorium roket memperbaiki, memperluas, dan mempercepat</a></li>
<li><a href="../id419973/index.html">Acara digital di Moskow dari 13 hingga 19 Agustus</a></li>
<li><a href="../id419975/index.html">Bagaimana kami lari dari perusahaan Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>