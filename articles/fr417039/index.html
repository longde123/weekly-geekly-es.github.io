<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗞️ 🛀🏽 👨🏿‍🚀 Apprenez wordpress (et plus) pour rendre les joueurs Youtube rapidement 🤚🏾 🧜🏼 👩🏻‍⚖️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je me suis souvenu du site d'un vieil ami-programmeur qui avait un hip-hop dans le fil du site, il y a environ 6 ans, il a craché sur la vitesse de ch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Apprenez wordpress (et plus) pour rendre les joueurs Youtube rapidement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/417039/"><img align="right" src="https://habrastorage.org/webt/us/rm/ow/usrmowkg03gobdp7nh575a04qfm.gif" alt="youtube-speedload"><br><br>  Je me suis souvenu du site d'un vieil ami-programmeur qui avait un hip-hop dans le fil du site, il y a environ 6 ans, il a craché sur la vitesse de chargement des pages: "oui, oui, oui, je dois le refaire, mais il n'y a rien de compliqué là-bas ..." arrêté maintenant - tout est comme avant :-) Malgré les solutions techniques simples, j'avoue que non seulement j'ai un tel ami.  Par conséquent, cette petite note technique. <br><br>  Pour comprendre de quel problème nous parlons: <br><img src="https://habrastorage.org/webt/fa/zo/ua/fazouap0ncvp7umicdrwjzf5zpi.png" alt="image"><br><br>  <b>400kb de script base.js?</b> <br><br>  Je ne regarde même pas le reste. <br>  Après optimisation, même sans compression, le gain sera des dizaines de fois et sera: <br><a name="habracut"></a><br>  html - 0,5 ko <br>  css - 1,4 ko <br>  js - 0,2 ko <br><br>  J'ai moi-même souvent dû publier des conférences de notre chaîne YouTube dans le flux du site, elles étaient beaucoup chauffées sur une seule page.  Et lorsque vous consultez des blogs personnels, il existe des collections d'étrangers ou de vos vidéos.  Et ce qui m'a dérangé, c'est la façon dont YouTube met les performances sur l'intégration.  Ce qu'il n'y a tout simplement pas chargé à travers iframe pour le bien de la même image en un clic.  Et le plus drôle, c'est que je ne veux peut-être pas regarder la vidéo, pourquoi dois-je télécharger du contenu? <br><br>  Ce problème est depuis longtemps résolu depuis longtemps sur les réseaux sociaux et de nombreuses autres ressources à fort trafic.  Oui, et dans les navigateurs mobiles.  Ce n'est un secret pour personne que l'utilisateur passe plus de temps sur le site s'il reçoit le contenu le plus rapidement possible. <br><br>  Voici le même hubr, il n'obtient pas grand-chose dans la bande vidéo, donc ce n'est pas si demandé.  Cependant, si vous popularisez cette approche? <br><br>  Essayons de l'implémenter en utilisant l'exemple de plugin pour WordPress. <br><br>  En tant que détenteur de quelques sites sur wordpress, je sais très bien comment les auteurs de plugins peuvent chier dans la base de données.  Par conséquent, j'ai définitivement décidé que le plugin utiliserait le mécanisme de mise en cache natif et ne nécessiterait rien et romprait la compatibilité s'il était supprimé. <br><br><h3>  Que peut-on retirer de Youtube </h3><br>  Youtube utilise oembed pour intégrer du contenu.  Plus en détail, ma réponse à SO sur ce qui peut être retiré sans avoir recours à l'API officielle. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stackoverflow.com/questions/10066638/get-youtube-information-via-json-for-single-video-not-feed-in-javascript/23253789#23253789</a> <br><br>  Réponse JSON <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://www.youtube.com/oembed%3Furl%3D">www.youtube.com/oembed?url=http</a> : //www.youtube.com/watch? v = ojCkgU5XGdg &amp; format = json <br><br>  Ou xml <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=http://www.youtube.com/oembed%3Furl%3D">www.youtube.com/oembed?url=http</a> : //www.youtube.com/watch? v = ojCkgU5XGdg &amp; format = xml <br><br>  Types d'aperçus de différentes tailles hq, sd, maxres <br>  <a href="">img.youtube.com/vi/ojCkgU5XGdg/hqdefault.jpg</a> <br>  <a href="">img.youtube.com/vi/ojCkgU5XGdg/sddefault.jpg</a> <br>  <a href="">i.ytimg.com/vi/ojCkgU5XGdg/maxresdefault.jpg</a> <br>  <a href="">img.youtube.com/vi/ojCkgU5XGdg/0.jpg</a> <br>  <a href="">img.youtube.com/vi/ojCkgU5XGdg/1.jpg</a> <br>  <a href="">img.youtube.com/vi/ojCkgU5XGdg/2.jpg</a> <br>  <a href="">img.youtube.com/vi/ojCkgU5XGdg/3.jpg</a> <br><br>  Annotations vidéo <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/annotations_invideo?cap_hist=1&amp;video_id=ojCkgU5XGdg</a> <br><br>  Un autre lien <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/get_video_info?html5=1&amp;video_id=ojCkgU5XGdg</a> <br><br>  Et cela vous est utile si vous créez des flux. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">www.youtube.com/embed/live_stream?channel=UCkA21M22vGK9GtAvq3DvSlA</a> <br><br>  Aperçus en direct <br>  <a href="">i.ytimg.com/vi/W-fSCPrYSL8/hqdefault_live.jpg</a> <br><br>  Dommage que YT ne supporte pas jsonp.  Par conséquent, nous ne pouvons pas complètement refuser d'enregistrer des données. <br><br><h3>  Fonctionnement des caches WordPress </h3><br>  WordPress prend en charge l'intégration automatique lors de la recherche de liens dans l'éditeur de liste blanche.  Lorsque cet événement est déclenché, il crée un méta-champ pour la publication avec le préfixe _oembed_, et lors de la sortie, il remplace le code du cache par html. <br><br>  Si nous avons décidé d'afficher la mise en page avec la substitution iframe par clic, nous devons stocker cet état quelque part, mieux dans le même cache. <br><br>  Filtre <code>add_filter('embed_oembed_html');</code>  permet de remplacer le cache avant que la publication ne soit affichée.  C'est un iframe bien connu. <br><br><pre> <code class="php hljs">&lt;iframe width=<span class="hljs-string"><span class="hljs-string">""</span></span> height=<span class="hljs-string"><span class="hljs-string">""</span></span> src=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt;&lt;/iframe&gt;</code> </pre> <br><br>  Puisque nous cherchons toujours pourquoi Google ne forme pas de titre pour son iframe ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ticket # 4024</a> ), hélas, nous sommes obligés de faire une demande unique au serveur pour capturer le titre dans le cache. <br><br><h3>  Comment mettre à jour le cache avec vos données </h3><br><pre> <code class="php hljs">add_filter(<span class="hljs-string"><span class="hljs-string">'embed_oembed_html'</span></span>, <span class="hljs-string"><span class="hljs-string">'ytsl_oembed_html'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); ytsl_oembed_html($cache, $url, $attr){};</code> </pre> <br><br>  Au moment où le filtre est déclenché, je recherche dans la variable $ cache la présence de ma balise data-ytsl.  Si ce n'est pas le cas, je fais une demande de <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">http</span></span>://<span class="hljs-selector-tag"><span class="hljs-selector-tag">www</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.youtube</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">oembed</span></span>?<span class="hljs-selector-tag"><span class="hljs-selector-tag">url</span></span>=<span class="hljs-selector-tag"><span class="hljs-selector-tag">http</span></span>://<span class="hljs-selector-tag"><span class="hljs-selector-tag">www</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.youtube</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.com</span></span>/<span class="hljs-selector-tag"><span class="hljs-selector-tag">watch</span></span>?<span class="hljs-selector-tag"><span class="hljs-selector-tag">v</span></span>=<span class="hljs-selector-tag"><span class="hljs-selector-tag">ojCkgU5XGdg</span></span>&amp;<span class="hljs-selector-tag"><span class="hljs-selector-tag">format</span></span>=<span class="hljs-selector-tag"><span class="hljs-selector-tag">json</span></span></code> </pre> <br><br>  et former le contenu de la nouvelle balise.  Par conséquent, le cache ressemble à ceci: <br><br><pre> <code class="php hljs">&lt;iframe width=<span class="hljs-string"><span class="hljs-string">""</span></span> height=<span class="hljs-string"><span class="hljs-string">""</span></span> src=<span class="hljs-string"><span class="hljs-string">" "</span></span> data-ytsl=<span class="hljs-string"><span class="hljs-string">" "</span></span>&gt;&lt;/iframe&gt;</code> </pre> <br><br>  La mise à jour du cache se fait comme ceci.  Tout d'abord, considérez la clé <br><pre> <code class="php hljs">$cachekey = <span class="hljs-string"><span class="hljs-string">'_oembed_'</span></span> . md5( $url . serialize( $attr ) );</code> </pre> <br>  Et puis nous mettons à jour. <br><pre> <code class="php hljs">update_post_meta( get_the_ID(), $cachekey, $cache );</code> </pre> <br><br>  Si ma <b>balise data-ytsl est</b> détectée, j'en retire le titre et l'identifiant et génère du html. <br>  Dans le <b>data-iframe,</b> j'insère le code de cache déjà propre sans ma balise, afin de remplacer la mise en page par ce contenu en cliquant. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ytsl-click_div'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-iframe</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'$ytsl'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'$fixed position:relative;background: url($thumb_url) no-repeat scroll center center / cover'</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ytsl-title_grad'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ytsl-title_text'</span></span></span><span class="hljs-tag">&gt;</span></span>{$json['title']}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ytsl-play_b'</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>"</code> </pre> <br>  Css sur github, il n'y a aucune raison de le montrer. <br><br>  En conséquence, le joueur ressemble à ceci. <br><img src="https://habrastorage.org/webt/51/38/jg/5138jg1grzueotu0f5jyy5vivfy.png"><br><br>  Par différence, j'ai fait du bouton de lecture une couleur différente.  Mais le fait que le titre ait été écrit par Arial, et non par une police personnalisée, qui est également chargée via un iframe, à mon avis, n'affecte pas beaucoup la reconnaissance. <br><br>  La solution finale de traitement à la volée est très rapide, et à en juger par le plugin, le profileur P3 de goDaddy est complètement indolore.  Il a donc été possible de trouver un équilibre entre commodité et rapidité.  Le plugin ne nécessite aucune action de la part de l'utilisateur.  Il montre simplement les images au lieu des iframes lorsqu'il est activé. <br><br>  <b>À l'avant.</b> <br><br>  Connectez simplement le script.  Tout est scandaleusement élémentaire: <br><br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> f = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelectorAll(<span class="hljs-string"><span class="hljs-string">".ytsl-click_div"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; f.length; ++i) { f[i].onclick = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.parentElement.innerHTML = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getAttribute(<span class="hljs-string"><span class="hljs-string">"data-iframe"</span></span>); } } })();</code> </pre><br><br>  Inconvénients - sur les appareils mobiles, les navigateurs sont très intelligents et ils peuvent le faire par eux-mêmes.  Par conséquent, si vous ne définissez pas d'appareils mobiles, vous devrez faire deux clics pour jouer. <br><br>  Total: <br>  html - 0,5 ko <br>  css - 1,4 ko <br>  js - 0,2 ko <br>  police - 0 ko <br>  img - 50 ko (dépend de l'image d'arrière-plan) <br><br>  Je n'ai pas remarqué le reste des inconvénients pendant une période assez longue. <br><br>  Eh bien, il a peint le chat en charge pendant une histoire pas si longue et pas si intéressante techniquement. <br><br>  Le code est ici <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/Alexufo/youtube-speedload</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr417039/">https://habr.com/ru/post/fr417039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr417029/index.html">Profilage de code avec LLVM</a></li>
<li><a href="../fr417031/index.html">Sécurité Mobile OAuth 2.0</a></li>
<li><a href="../fr417033/index.html">QIWI Kitchen le 7 juin - vidéo des discours de nos intervenants</a></li>
<li><a href="../fr417035/index.html">UnnyWorld: post-mortem</a></li>
<li><a href="../fr417037/index.html">BEERBRAZZERS. Contrôle de la lumière. Vixen Lights 3. Démarrage rapide (1/4)</a></li>
<li><a href="../fr417041/index.html">eslint-scope v3.7.2 vole des jetons NPM</a></li>
<li><a href="../fr417043/index.html">Une fable sur Burger King et les données des utilisateurs. Commentaires des développeurs</a></li>
<li><a href="../fr417045/index.html">Essais cliniques de la première thérapie anti-âge</a></li>
<li><a href="../fr417047/index.html">Créateur Python: je suis fatigué, je pars</a></li>
<li><a href="../fr417049/index.html">Une norme préliminaire pour les applications mobiles avec 87 exigences pour leur fonctionnalité est apparue dans la Fédération de Russie</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>