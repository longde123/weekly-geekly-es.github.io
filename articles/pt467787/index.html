<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï£ üëêüèΩ üïê Como configurar a pesquisa de endere√ßos por coordenadas (e onde obter o diret√≥rio necess√°rio) üèÇüèª üñ§ ü§òüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Na primavera, adicionamos o recurso "Geocodifica√ß√£o reversa" √† API DaData.ru, tamb√©m chamada de " Endere√ßo por coordenadas ". O nome sugere: o m√©todo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como configurar a pesquisa de endere√ßos por coordenadas (e onde obter o diret√≥rio necess√°rio)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/hflabs/blog/467787/"><img src="https://habrastorage.org/webt/_w/mf/y5/_wmfy5eag0qfwexxhm4qerr0-64.jpeg"><br><br>  Na primavera, adicionamos o recurso "Geocodifica√ß√£o reversa" √† API DaData.ru, tamb√©m chamada de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Endere√ßo por coordenadas</a> ".  O nome sugere: o m√©todo pega geocoordenadas e fornece dados sobre o endere√ßo. <br><br>  Um produto s√≥lido com a mesma funcionalidade oferece o Yandex - √© chamado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">geocoder</a> .  Mas o servi√ßo Yandex √© gratuito apenas para projetos n√£o comerciais abertos.  A tarifa padr√£o - de 120.000 ‚ÇΩ por ano - n√£o √© adequada para todos. <br><br>  N√≥s pensamos - se voc√™ fizer uma alternativa gratuita ou barata ao "Geocoder", os desenvolvedores provavelmente agradecer√£o.  E eles fizeram.  No artigo, mostrarei como a estrutura "Endere√ßo por coordenadas" funciona: como configuramos a pesquisa, reunimos um diret√≥rio e o empacotamos em um m√©todo pronto. <br><a name="habracut"></a><br><h2>  Onde obtemos os dados e como procuramos o endere√ßo </h2><br>  Ao abordar a tarefa, estudamos solu√ß√µes prontas: onde obter o diret√≥rio de coordenadas com endere√ßos e como procurar objetos geogr√°ficos nesse diret√≥rio.  Aconteceu que voc√™ nem precisa ir muito longe pelas ferramentas certas. <br><br>  <b>Pegamos os objetos de endere√ßo no FIAS</b> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Federal Information Address System</a> .  Este √© o mais abrangente dos diret√≥rios de endere√ßos abertos e oficiais.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">J√° escrevemos</a> sobre isso em detalhes em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Habr√©</a> , e agora quatro fatos s√£o importantes: <br><br><ul><li>  O FIAS armazena todos os objetos endere√ß√°veis ‚Äã‚Äãdo pa√≠s, de regi√µes e abaixo - a edif√≠cios e territ√≥rios adicionais; </li><li>  o diret√≥rio est√° dispon√≠vel gratuitamente nos formatos DBF e XML; </li><li>  O FIAS n√£o √© perfeito - falta dezenas de milhares de casas e muitas ruas, especialmente novas; </li><li>  Cada objeto de endere√ßo no diret√≥rio corresponde a um c√≥digo ID - FIAS exclusivo.  √Äs vezes, o c√≥digo do objeto √© alterado, mas para o nosso artigo isso n√£o √© t√£o importante. </li></ul><br>  Objetos de endere√ßo baixados do FIAS juntamente com o ID s√£o a base do nosso diret√≥rio para geocodifica√ß√£o reversa. <br><br>  <b>Fa√ßa o download das coordenadas do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenStreetMap</a> (OSM).</b>  OSM √© um projeto com uma licen√ßa gratuita: entusiastas coletam as coordenadas de v√°rios objetos e as publicam para todos. <br><br>  Em termos simples, o OSM √© um conjunto de pontos, linhas e pol√≠gonos em um mapa.  Cada objeto tem sua pr√≥pria descri√ß√£o, tipo e conjunto de coordenadas.  Os dados do OSM para a R√∫ssia est√£o localizados em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">needgeo.com</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">osm.sbin.ru/osm_dump/</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">osmosis.svimik.com/latest/</a> . <br><br><img src="https://habrastorage.org/webt/ws/p6/hy/wsp6hyjy8brd4qmc11clfyoulic.png"><br>  <sub>A lista de fontes √© publicada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">em uma p√°gina especial no ‚ÄúWiki‚Äù do projeto</a></sub> <br><br>  O descarregamento consiste em arquivos PBF - esse formato √© usado em vez de XML como um formato mais compacto.  Transformar PBF em XML OSM n√£o custa nada, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">muitos utilit√°rios aprovados pela comunidade podem</a> lidar com isso. <br><br>  Para nosso pr√≥prio diret√≥rio, pegamos os objetos de endere√ßo do FIAS e, em seguida, procuramos suas coordenadas no OSM.  Se encontrado, salve os dados combinados.  Acontece uma interse√ß√£o entre FIAS e OSM. <br><br>  E tudo isso √© maravilhoso, mas h√° um problema: as coisas n√£o s√£o f√°ceis com a qualidade dos dados no OSM.  As coordenadas dos objetos geralmente n√£o correspondem √† realidade.  Por exemplo, pol√≠gonos para regi√µes e distritos s√£o adequados.  Mas para cidades e abaixo - nem tanto. <br><br><img src="https://habrastorage.org/webt/dc/hn/uh/dchnuhisbetq44m1uyd8sniuy20.png"><br>  <sub>Pol√≠gonos s√£o pol√≠gonos que delimitam √°reas em um mapa.</sub>  <sub>Eles consistem em um conjunto de pontos vinculados com coordenadas.</sub>  <sub>Os pol√≠gonos indicam os limites de regi√µes, distritos, cidades e at√© edif√≠cios</sub> <br><br>  O trabalho principal, e por uma ampla margem, √© coletar dados adequados do OSM e eliminar o casamento.  A tarefa √© t√£o volumosa que dediquei uma se√ß√£o separada a ela no artigo. <br><br>  <b>Tamb√©m baixamos casas que n√£o est√£o no FIAS do OSM.</b>  Como eu disse acima, existem dezenas de milhares de casas no FIAS.  Isso nem √© um problema, mas simplesmente uma realidade, um pano de fundo.  Portanto, reabastecemos nosso diret√≥rio com casas do OSM.  Mas apenas aqueles para os quais existe uma rua no FIAS.  Os edif√≠cios que vieram do OSM n√£o t√™m um ID FIAS, portanto, identificamos-os como o <i>c√≥digo FIAS</i> dos <i>pais + n√∫mero da casa</i> . <br><br>  <b>No diret√≥rio que procuramos, com a ajuda da bela <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lucene</a></b> - nossa assistente de longo prazo.  Obrigado pela dica, a um indiano versado que escreveu o post <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Indexando dados geogr√°ficos com Lucene</a> (uma boa adi√ß√£o √© o material <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">An√∫ncio espacial em algoritmos de pesquisa espacial</a> - sobre as √°rvores-kd nas quais o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">algoritmo de pesquisa</a> √© constru√≠do). <br><br>  Assim que descobrimos sobre Lucene, o problema de pesquisa foi resolvido quase por si s√≥.  Restos de neg√≥cios - escolha uma lixa. <br><br><ol><li>  Carregamos no Lucene seu diret√≥rio de coordenadas e endere√ßos, obtivemos um √≠ndice de pesquisa.  Para facilitar, quase tudo foi removido, deixando apenas os IDs de endere√ßo e coordenadas. </li><li>  Montamos uma pesquisa por √≠ndice: entrada - coordenadas, sa√≠da - ID dos objetos de endere√ßo encontrados.  A pesquisa n√£o retorna outras informa√ß√µes, pois o √≠ndice foi totalmente reduzido. </li><li>  Satisfez a emiss√£o, carregando dados do FIAS "grande" pelos IDs encontrados.  Adicionamos muito de tudo, desde o endere√ßo que todos precisam em uma linha at√© o sinal da capital regional das cidades. </li><li>  N√≥s descobrimos como classificar e fornecer os objetos recebidos. </li></ol><br>  At√© agora, tudo parece simples, mas isso √© apenas uma pequena parte do trabalho.  Nenhuma pesquisa pelo endere√ßo por coordenadas teria funcionado se n√£o tiv√©ssemos compilado um diret√≥rio decente. <br><br><h2>  Como coletar a base de coordenadas e endere√ßos </h2><br>  Para come√ßar, vou arrumar a bagagem: depois de ler o artigo, rapidamente fazer um manual desse tipo n√£o funciona.  N√≥s o colecionamos desde 2014, complementando-o constantemente.  Eu vou falar sobre esse maldito longo caminho. <br><br>  A parte mais dif√≠cil ao compilar um diret√≥rio √© classificar as coordenadas que vieram do OSM.  No in√≠cio, as verificamos da melhor maneira poss√≠vel, inclusive com as m√£os.  O objetivo principal era obter pontos de refer√™ncia nas grandes cidades e fazer deles um guia de refer√™ncia.  Agora que existem muitos desses pontos, quase n√£o h√° necessidade de verificar manualmente se h√° novos dados.  Por vez, adicionamos 200.000 a 300.000 endere√ßos com coordenadas ao diret√≥rio de refer√™ncia, e aqui est√° como o fazemos. <br><br>  <b>Formamos endere√ßos completos de tags OSM.</b>  Nos uploads do OSM, as partes componentes dos endere√ßos s√£o espalhadas por diferentes tags: <br><br><ul><li>  <i>endere√ßo: cidade - vila Bulatnikovo</i> ; </li><li>  <i>endere√ßo: rua - rua central</i> ; </li><li>  <i>addr: housenumber - 103</i> . </li></ul><br>  Percorremos as etiquetas e coletamos o endere√ßo completo delas: <i>vila Bulatnikovo, 103 Central Street</i> . <br><br>  <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Executamos</a> cada novo endere√ßo por meio da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API de padroniza√ß√£o Dadat</a> .</b>  O servi√ßo converte endere√ßos em um √∫nico formato "Like in FIAS": <br><br><ul><li>  corrige erros de digita√ß√£o; </li><li>  decodifica abrevia√ß√µes como "NiNo" e "Msk"; </li><li>  altera nomes antigos para novos; </li><li>  encontra a cidade ausente no endere√ßo por √≠ndice; </li><li>  define um c√≥digo FIAS. </li></ul><br>  Os endere√ßos da API est√£o limpos, embora agora eles estejam enviando uma carta ou um pacote. <br><div class="scrollable-table"><table><tbody><tr><th>  Antes da padroniza√ß√£o </th><th>  Depois </th></tr><tr><td>  <i>Aldeia Bulatnikovo, Rua Central, 103</i> </td><td><p>  <i>142718, regi√£o de Moscou, distrito de Leninsky, com Bulatnikovo, Central St., 103.</i> </p><br><p>  C√≥digo FIAS - <i>a8b6a52f-e96d-4ec3-a0ff-641013ab0445</i> </p></td></tr></tbody></table></div>  Armazenamos casas, ruas e assentamentos padronizados como um ponto.  Para a rua e a vila, este ponto √© o centro.  Como resultado, todos os objetos de endere√ßo est√£o na mesma tabela, dentro - o endere√ßo, ID do FIAS, latitude e longitude. <br><div class="scrollable-table"><table><tbody><tr><th>  O endere√ßo </th><th>  ID FIAS </th><th>  Latitude </th><th>  Longitude </th></tr><tr><td>  <i>142718, regi√£o de Moscou, distrito de Leninsky, com Bulatnikovo, Central St., 103</i> </td><td>  <i>a8b6a52f-e96d-4ec3-a0ff-641013ab0445</i> </td><td>  <i>55.558773</i> </td><td>  <i>37.667103</i> </td></tr><tr><td>  <i>119034, Moscou, faixa Turchaninov, d 6 bldg.2</i> </td><td>  <i>8c925e61-9173-48b3-999e-dc85c86d89e7</i> </td><td>  <i>55.737096</i> </td><td>  <i>37.597190</i> </td></tr></tbody></table></div>  <b>Analisamos endere√ßos que o Dadata n√£o padronizou.</b>  Os endere√ßos que n√£o puderam ser correspondidos com o FIAS est√£o marcados com um sinalizador pelo servi√ßo.  N√≥s os verificamos manualmente, existem v√°rias op√ß√µes. <br><br><ol><li>  O endere√ßo n√£o veio nas tags de upload adequadas do OSM, mas o diabo sabe onde.  Etiquetas de endere√ßo preenchidas e n√£o preenchidas, cidade na rua e muito mais. </li><li>  No OSM, encontra-se um objeto ex√≥tico, como um playground, campo de futebol da faculdade ou mesmo um cemit√©rio.  N√£o existe nada parecido no FIAS e, para nossos prop√≥sitos, esses resultados n√£o s√£o adequados.  Tais objetos s√£o simplesmente filtrados. </li><li>  Um erro - e n√£o um erro.  Por exemplo, um distrito de uma cidade que n√£o existe no FIAS veio do OSM.  Ou no OSM, o objeto est√° localizado em um assentamento, mas no FIAS esse assentamento foi anexado √† cidade e removido.  Em seguida, finalizamos o algoritmo para os dados carregados e os executamos novamente. </li></ol><br><img src="https://habrastorage.org/webt/_u/yc/1u/_uyc1uds-xef7yiwtpu01vgk7ju.png"><br>  <sub>Analisar descarga, e a√≠ - confus√£o em tags</sub> <br><br>  <b>Verificamos qu√£o adequadas s√£o as coordenadas carregadas.</b>  Para fazer isso, examinamos com um utilit√°rio especial se as coordenadas do novo objeto se enquadram no pol√≠gono da regi√£o ou distrito pai.  Se o endere√ßo informar que o objeto est√° localizado na regi√£o de Omsk, tenha a gentileza de entrar no aterro.  A entrada na cidade n√£o √© necess√°ria - nem todas as cidades s√£o cobertas com precis√£o no OSM; para muitos, os dados n√£o s√£o atualizados. <br><br>  Carregamos pol√≠gonos de refer√™ncia do OSM e os armazenamos como est√£o - no formato <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GeoJSON</a> .  Para escolher qual pol√≠gono tentar em um ponto, procure em uma tabela separada.  Nele, comparamos os prefixos dos c√≥digos CLADR e os IDs dos pol√≠gonos: voc√™ encontra o c√≥digo CLADR para o endere√ßo e v√™ qual pol√≠gono escolher. <br><br><img src="https://habrastorage.org/webt/f_/ud/tt/f_udtt5i_rael-f2i8exqc-4k0g.png"><br>  <sub>O c√≥digo KLADR √© um identificador exclusivo usado antes do FIAS.</sub>  <sub>Um milh√£o de servi√ßos pode encontrar esse c√≥digo para um endere√ßo</sub> <br><br>  O utilit√°rio permite que o objeto fique a 1.700 metros do aterro.  Essa regra foi adicionada por causa das rodovias que frequentemente ultrapassam as fronteiras da regi√£o.  Mas uma dist√¢ncia superior a 1.700 metros √© um sinal de erro, dizem as estat√≠sticas. <br><br>  Neste caso para cidades e ruas, a verifica√ß√£o termina. <br><br>  <b>Mais uma vez, mais rigorosamente, verificamos as coordenadas carregadas das casas.</b>  O utilit√°rio mencionado novamente entra em jogo, e √© isso que ele faz. <br><br><ol><li>  Ele pega o endere√ßo da nova casa e encontra vizinhos para ele no diret√≥rio de refer√™ncia. </li><li>  Segundo as coordenadas, considera a dist√¢ncia entre a nova casa n√£o verificada e os vizinhos confi√°veis. </li></ol><br><img src="https://habrastorage.org/webt/sx/vx/y-/sxvxy-u2l54hlaggzda0zx8u-tw.jpeg"><br>  <sub>√â f√°cil encontrar vizinhos: 1. Tomamos uma nova casa e encontramos o ID do FIAS dos pais.</sub>  <sub>2. Selecionamos no diret√≥rio de refer√™ncia casas cujos pais t√™m o mesmo ID FIAS</sub> <br><br>  A inspe√ß√£o √© realizada apenas em casa, a menos de 150 metros de colegas confi√°veis.  Al√©m disso, consideramos cada nova casa aprovada ao analisar o seguinte.  Aqui est√° como isso funciona. <br><br>  Suponha que, no guia de refer√™ncia, as casas <i>n¬∫s 1, 2 e 3</i> sejam armazenadas <i>na rua Kommunarov</i> .  Nos novos dados vieram as casas <i>5, 6 e 7</i> na mesma rua.  A julgar pelas coordenadas, as novas casas est√£o pr√≥ximas.  O utilit√°rio v√™ que o <i>n√∫mero da</i> casa <i>5</i> fica ao lado dos <i>n√∫meros 1, 2 e 3</i> e o adiciona ao diret√≥rio de refer√™ncia.  Assim, as casas <i>n√∫mero 6 e 7</i> tamb√©m <i>est√£o</i> sendo testadas. <br><br>  E ent√£o o destino dos dados que vieram do OSM √© decidido: <br><br><ul><li>  casas que passaram nas duas verifica√ß√µes: para aterros e para vizinhos, adicionamos ao diret√≥rio de refer√™ncia; </li><li>  se o objeto n√£o cair no pol√≠gono, os novos dados n√£o ser√£o adequados.  O mesmo se a dist√¢ncia entre a casa e os vizinhos for muito grande; </li><li>  casas que n√£o t√™m vizinhos, estamos adiando.  Eles est√£o em um banco de dados separado, um dia iremos analisar. </li></ul><br>  <b>Dividimos os objetos testados em duas partes.</b>  Eles ir√£o para diferentes placas do nosso manual de refer√™ncia. <br><br><img src="https://habrastorage.org/webt/60/mh/30/60mh30nzsamn2rv_gegjgooqusy.png"><br>  <sub>Na primeira tabela - todos os objetos com FIAS ID para casas: regi√µes, assentamentos, ruas.</sub>  <sub>No segundo - em casa e um link para o pai da primeira tabela</sub> <br><br>  S√£o necess√°rias duas tabelas para atribuir chaves √†s resid√™ncias ausentes do FIAS.  Eles n√£o t√™m seu pr√≥prio c√≥digo FIAS, ent√£o veja como: <br><br><ul><li>  coletamos objetos de endere√ßo para a casa em uma tabela, cada um deles com seu pr√≥prio c√≥digo FIAS; </li><li>  no segundo - apenas em casa, enquanto se refere ao pai na primeira tabela. </li></ul><br>  Como resultado de um edif√≠cio sem um c√≥digo FIAS, identificamos o <i>ID pai + n√∫mero da casa pela</i> chave <i>FIAS</i> . <br><br>  <b>A refer√™ncia est√° pronta, resta testar.</b>  Executamos um servi√ßo de teste funcional durante a noite e testamos o desempenho.  Verificamos a velocidade em Moscou, solicitando todas as casas em um raio de tr√™s quil√¥metros.  Para ter certeza.  Claro, eles cobriram tudo com autotestes. <br><br>  O principal ap√≥s a atualiza√ß√£o √© n√£o piorar. <br><br><h2>  Geocodifica√ß√£o reversa atrav√©s dos olhos do usu√°rio </h2><br>  O m√©todo de entrada usa tr√™s par√¢metros: coordenadas, n√∫mero de resultados e raio da pesquisa.  O raio padr√£o √© 100 metros, o m√°ximo √© um quil√¥metro.  O valor exato √© definido nas configura√ß√µes. <br><br><pre><code class="java hljs">curl -X POST \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: Token ${API_KEY}"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">'{ "lat": 55.878, "lon": 37.653, "radius_meters": 50 }'</span></span> \ https:<span class="hljs-comment"><span class="hljs-comment">//suggestions.dadata.ru/suggestions/api/4_1/rs/geolocate/address</span></span></code> </pre> <br>  O m√©todo retorna os objetos encontrados: casas, ruas e assentamentos.  Classifica-os em ordem decrescente de precis√£o. <br><br><ol><li>  Em casa </li><li>  As ruas. </li><li>  Assentamentos. </li><li>  Cidades </li></ol><br>  Ent√£o ele classifica novamente - pela dist√¢ncia das coordenadas fornecidas.  Se o m√©todo encontrou quatro casas e uma rua, as casas ficar√£o primeiro na ordem da dist√¢ncia de um determinado ponto.  Atr√°s deles √© a rua. <br><br>  Depois de todos esses castelos, o m√©todo finalmente retorna os objetos que encontrou. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"suggestions"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,  ,  11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"unrestricted_value"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,  ,  11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {...} }, { <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,  ,  11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"unrestricted_value"</span></span>: <span class="hljs-string"><span class="hljs-string">" ,  ,  11"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"data"</span></span>: {...} } ] }</code> </pre> <br>  Dentro - muitas coisas diferentes sobre os objetos encontrados: linhas com o endere√ßo completo e abreviado, nomes atuais e desatualizados, CEP, c√≥digo FIAS do objeto pai e assim por diante. <br><br><img src="https://habrastorage.org/webt/c5/_4/8i/c5_48iyueonoygc22saytynllr4.png"><br>  <sub>Todos os dados que o m√©todo fornece est√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">na documenta√ß√£o</a></sub> <br><br>  A cobertura por coordenadas para diferentes regi√µes √© diferente, assim com casas: <br><br><ul><li>  Moscou - 96%, </li><li>  S√£o Petersburgo - 88%, </li><li>  outras milh√µes de cidades - 74%, </li><li>  o resto da R√∫ssia √© de 47%. </li></ul><br>  E aqui est√° - cobrindo as ruas: <br><br><ul><li>  Moscovo - 92% </li><li>  S√£o Petersburgo - 79%, </li><li>  outras cidades milion√°rias - 75%, </li><li>  o resto da R√∫ssia √© de 67%. </li></ul><br>  Eles n√£o consideravam as cidades - na escala da R√∫ssia, at√© o fato de pertencer ao orgulhoso t√≠tulo da cidade era inst√°vel.  Por exemplo, a <i>regi√£o de Yaroslavl, distrito de Poshekhonsky, s / o Fedorkovsky</i> √© uma cidade, de acordo com o diret√≥rio oficial do FIAS.  Mas, de fato, e no endere√ßo - o distrito rural.  Fisicamente, o distrito rural se assemelha √† uni√£o de v√°rias aldeias em uma grande mancha.  √â dif√≠cil n√£o apenas determinar o centro, mas at√© encontrar o assentamento no mapa. <br><br>  J√° estamos pensando no que adicionar ao m√©todo: permita a filtragem por tipo de objeto, retorne a dist√¢ncia a um determinado ponto, outra coisa.  Monitoramos a demanda e decidimos se devemos investir. <br><br>  Caso contr√°rio, tudo j√° est√° no prod.  At√© 10.000 solicita√ß√µes por dia - gratuitamente, mais - por assinatura, a partir de 5.000 ‚ÇΩ por ano.  Se voc√™ precisar de endere√ßos por coordenadas para um projeto comercial e o geocoder for muito caro, tente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">a API do Dadati</a> . <br><br>  <i>O artigo original √© publicado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no blog HFLabs</a> .</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt467787/">https://habr.com/ru/post/pt467787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt467775/index.html">5 mitos sobre neg√≥cios: por que o cliente est√° errado e como superar a Apple</a></li>
<li><a href="../pt467779/index.html">Sobre Godot, GLSL e WebGL, shaders usados ‚Äã‚Äãno minijogo</a></li>
<li><a href="../pt467781/index.html">Curso de C ++ no CS Center, primeira parte</a></li>
<li><a href="../pt467783/index.html">Como um profissional de TI pode trabalhar e viver na Su√≠√ßa</a></li>
<li><a href="../pt467785/index.html">Como otimizar pandas ao trabalhar com grandes conjuntos de dados (ensaio)</a></li>
<li><a href="../pt467789/index.html">Acabou de chegar o Java 13. O ZGC come√ßou a compartilhar mem√≥ria, o pr√≥prio CDS se lembra de classes e outras maravilhas t√©cnicas</a></li>
<li><a href="../pt467791/index.html">An√°lise de rolagem de p√°gina no Google Data Studio</a></li>
<li><a href="../pt467793/index.html">Pilha de tecnologia chata da empresa de internet one-man</a></li>
<li><a href="../pt467795/index.html">Nota sobre criptomoedas e regulamenta√ß√£o estadual</a></li>
<li><a href="../pt467797/index.html">"Ria por uma quest√£o de": por que voc√™ pode precisar de ferramentas de software que n√£o possuem um aplicativo de "combate"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>