<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😜 🧑🏽‍🤝‍🧑🏼 🧙🏻 Conseils nature - Veilleuse nuageuse 🚱 🧝🏿 👨‍🍳</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, communauté! 

 Je présente ma propre mise en œuvre d'une lampe de nuit sous forme de nuage. L'idée principale est de faire une veilleuse avec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Conseils nature - Veilleuse nuageuse</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428988/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/mr/66/st/mr66stql1kimlmtxmkt2ycjyfue.jpeg" alt="image" width="75%"></div><br><br>  Bonjour, communauté! <br><br>  Je présente ma propre mise en œuvre d'une lampe de nuit sous forme de nuage.  L'idée principale est de faire une veilleuse avec des simulations de processus naturels et une sorte d'interactivité.  La nature est le meilleur inspirateur! <br><br>  Basé sur le microcontrôleur bon marché ATmega8-16PU.  Le code est écrit en C sans Arduino et implémente plusieurs effets d'éclairage avec contrôle depuis l'éclairage général de l'espace et avec contrôle sonore. <br><br>  Détails et photos - plus ... <br><a name="habracut"></a><br><h3>  Détails électroniques </h3><br>  Le circuit, en plus du microcontrôleur, dispose de 6 LED unicolores, une LED RGB, un capteur de lumière (photorésistance) et un microphone avec un amplificateur et un filtre RF. <br><br>  Pour modifier en douceur la luminosité des LED, <abbr title="Modulation de largeur d'impulsion">PWM est</abbr> utilisé.  La fréquence PWM est de 244 Hz à 64 niveaux, il arrive que certaines personnes la voient.  Il est impossible d'augmenter la fréquence - vous avez encore besoin de temps processeur pour fonctionner.  Par conséquent, pour lisser les impulsions PWM, un circuit répéteur à transistor avec un condensateur de lissage est utilisé.  Le transistor est pris avec un grand gain pour augmenter la résistance d'entrée et réduire la capacité requise.  En conséquence, 1 microfarad était suffisant, les impulsions ont été lissées presque complètement.  Les avantages sont moins chers que le DAC et ont un courant de sortie important.  L'inconvénient de ce schéma est la dépendance non linéaire de la luminosité au niveau PWM à de faibles niveaux (jusqu'à 15%). <br><br><div class="spoiler">  <b class="spoiler_title">Circuit Micro-Cap 9</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/9h/jx/m-/9hjxm-paag2rkjz7osorqlr_8ke.png" alt="image"><br>  <i>Schéma de lissage PWM.</i>  <i>4 diodes environ = 1 LED blanche selon la caractéristique I-V</i> <br><br><img src="https://habrastorage.org/webt/af/6f/g4/af6fg4lbpq8fxaenzaepivxw-ps.png" alt="image"><br>  <i>Graphique du courant et de la tension sur la LED à 56% PWM.</i> <br></div></div><br>  Un microphone à électret miniature à travers un amplificateur sur deux transistors avec extraction d'impulsions (filtre passe-haut) est connecté à l'entrée discrète du MK, capte en toute confiance des sons aigus - applaudissements. <br><br>  Il a dessiné et étalé la planche dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">DipTrace</a> , l'a fait LUT, les détails sont principalement smd.  La gravure a été réalisée dans le «tueur de chlorure ferrique»: peroxyde d'hydrogène + sel + acide citrique, il s'est avéré la première fois, je le recommande.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Toutes les voies amateurs sont écrites ici.</a> <br><br><img src="https://habrastorage.org/webt/6g/m-/05/6gm-05vizzaj1ew1l63b-b6kh5o.jpeg" alt="image"><br>  <i>Les frais de LUT</i> <br><br>  J'ai fait le pouvoir via un connecteur USB, qui vous permet de vous connecter à n'importe quel port USB.  Consommation maximale 78 mA. <br><br>  Dans les versions précédentes, le câble avait un micro bouton pour régler les modes, mais il a ensuite été retiré, car il ne pouvait pas être atteint si le nuage était sous le plafond. <br><br>  Il n'y a pas de connexion USB, le MK n'a pas d'USB, et il semble que ce ne soit pas nécessaire dans le produit fini.  Pour le débogage, j'ai utilisé le contrôleur UART, le code implémente un échange avec un ordinateur, mais là c'est bébête <s>écrit sur le genou</s> . <br><br><img src="https://habrastorage.org/webt/7u/fy/h5/7ufyh5cpydbcvzj50ojtwibyeik.jpeg" width="75%"><br>  <i>En cours de soudure</i> <br><br>  La LUT, le soudage, l'écriture d'un programme, les tests et modifications, l'ajustement des minuteries et des coefficients ont pris 3 semaines. <br><br><img src="https://habrastorage.org/webt/zk/t8/g9/zkt8g9wjyn7ujuyihfg32mn-bc0.jpeg" alt="image"><br>  <i>Vue générale</i> <br><br>  En conséquence, il a réalisé 3 modes d'effets de lueur et d'éclairage.  J'ai essayé de la rendre plus intéressante qu'une lampe à lave, mais je ne suis pas non plus devenue une musique de couleur disco avec des sifflets de poing. <br><br><h3>  Modes: </h3><br>  <b>La principale</b> est une lampe de nuit en forme de nuage.  Différentes parties du nuage changent la luminosité de manière aléatoire, la période de changement est également aléatoire (4 ... 25 sec), le type de changement est un lissage exponentiel de la tâche (je peux vous en dire plus dans les commentaires).  Il ressemble à un tout, avec une fraction de l'imagination, comme des débordements de lumière dans un vrai nuage lorsqu'il recouvre le Soleil.  Le niveau de luminosité maximum dépend du niveau d'éclairage selon le programme.  J'ai choisi différentes dépendances, il y avait une option avec le choix des dépendances sur le bouton, mais je me suis contenté de celle-ci seule. <br><br><img src="https://habrastorage.org/webt/hw/hp/xo/hwhpxotfo5gyf9njb_64kkvdtps.png" alt="image"><br>  <i>Le graphique de la dépendance de la luminosité du nuage de l'éclairage extérieur.</i> <br><br>  Étant donné que le nuage ne brille presque pas pendant l'obscurité extérieure (nuit) et qu'une lumière vive à court terme peut être nécessaire (par exemple, pour se lever la nuit), j'ai créé le sous-mode Bright Cloud.  Il s'allume avec deux applaudissements, ici et utilise un microphone, car les boutons sont généralement hors de portée.  Le nuage brille à pleine luminosité pendant une minute, également avec débordement, puis revient en douceur au mode cloud principal en fonction de l'éclairage. <br><br><img src="https://habrastorage.org/webt/cg/ha/dx/cghadxfnhu9zgmk0x-u3rx9xsp8.gif" alt="image"><br>  <i>Mode cloud, premiers échantillons.</i>  <i>Vidéo accélérée 5 fois</i> <br><br>  <b>Orage</b> - s'allume avec une forte diminution de la lumière ambiante (mais pas avant l'obscurité complète, afin de ne pas toucher les yeux dans l'obscurité) ou trois pops.  Les LED aléatoires clignotent (de 1 à 4x), avec une pause aléatoire entre les flashs.  Je me suis un peu embrouillé et j'ai fait des «éclairs» de foudre dans le nuage lorsque les LED clignotent le long de la chaîne de temps.  Il ressemble également à un orage.  En raison du régime orageux, un compromis de filtrage PWM a dû être trouvé pour que les flashs soient nets (77 ms).  La durée de l '«orage» dépend de la lumière ambiante - le plus sombre, le plus long, de 4 à 12 flashs. <br><br>  <b>Dawn</b> - s'allume avec une forte augmentation de la lumière ambiante.  Le mode le plus difficile à mettre en place, obtenir «un changement naturel des couleurs du soleil à l'aube dans une brume légère» n'a pas été facile.  Il était nécessaire d'équilibrer manuellement la LED RVB à presque tous les niveaux PWM et de sélectionner les dépendances.  Mais au final, j'ai reçu une formule d'interpolation plus ou moins.  L'aube dure 40 secondes, puis passe en mode normal. <br><br><img src="https://habrastorage.org/webt/c_/fl/6b/c_fl6baslbfbbxsagw5bpnou39c.jpeg" alt="image" width="75%"><br>  <i>Aube</i> <br><br>  Electronique et logiciels pour les personnes intéressées: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Archiver avec la source</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Schéma en pdf</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Disposition de la carte, un côté</a> <br><br><h3>  Constructif </h3><br>  La conception du cloud est assez simple, je suis en sintepuha (un oreiller 40x40 cm), la planche est située à l'intérieur sur les suspensions de fils.  Les LED sont disposées aussi uniformément que possible en volume, eh bien, la LED RGB est en bas et le capteur photo est en haut. <br><br><img src="https://habrastorage.org/webt/n8/yf/qm/n8yfqmg3dbmhm9oqpelqvnt4xxa.jpeg" width="75%"><br>  <i>En cours de fuzzing</i> <br><br>  Il y a eu des difficultés à fixer le synthech, car il est recouvert de silicone pour éviter l'agglutination.  La partie inférieure du nuage est soutenue par des bandes étroites de ruban adhésif sur le cadre métallique. <br><br>  Questions, commentaires, suggestions écrivent dans les commentaires. <br><br>  Bon temps! <br><br><img src="https://habrastorage.org/webt/k2/jp/ia/k2jpiamrczanxcsod6-l-rh-nmi.jpeg"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr428988/">https://habr.com/ru/post/fr428988/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr428976/index.html">Colline de fourmis ou forteresse? Je construis une maison pour le prix d'un appartement. Partie 2: Chauffage</a></li>
<li><a href="../fr428980/index.html">Broker JavaScript hors ligne</a></li>
<li><a href="../fr428982/index.html">Comment écrire D sur ARM</a></li>
<li><a href="../fr428984/index.html">Julia et portraits de phases de systèmes dynamiques</a></li>
<li><a href="../fr428986/index.html">Conférence ThinkJava n ° 8 à Kharkov</a></li>
<li><a href="../fr428990/index.html">Exemples de configuration d'UIViewControllers utilisant RouteComposer</a></li>
<li><a href="../fr428992/index.html">Contournement sélectif des verrous sur les routeurs avec le firmware Padavan et Keenetic OS</a></li>
<li><a href="../fr428994/index.html">Mise en réseau sous Android avec Corutin et Retrofit</a></li>
<li><a href="../fr428996/index.html">Club de Santa Clauses anonymes 2018-2019 sur Habrahabr</a></li>
<li><a href="../fr428998/index.html">Comment utiliser la nouvelle fonctionnalité Profiler expérimentale dans React</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>