<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèª‚Äçü§ù‚Äçüë®üèø üßìüèæ üêá Aufz√§hlbar: So erzielen Sie einen Gesch√§ftswert üßñüèæ üï° üßòüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel ist eine kurze Erkl√§rung dar√ºber, wie die Verwendung von Schl√ºsselw√∂rtern in einer gemeinsamen Sprache das Budget der IT-Infrastruktur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aufz√§hlbar: So erzielen Sie einen Gesch√§ftswert</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444358/">  Dieser Artikel ist eine kurze Erkl√§rung dar√ºber, wie die Verwendung von Schl√ºsselw√∂rtern in einer gemeinsamen Sprache das Budget der IT-Infrastruktur eines Projekts beeinflussen oder dazu beitragen kann, einige Einschr√§nkungen / Einschr√§nkungen der Hosting-Infrastruktur zu erreichen, und dar√ºber hinaus die Qualit√§t positiv beeinflusst und Reife des Quellcodes. <br><a name="habracut"></a><br>  F√ºr die Demonstration von Ideen wird in dem Artikel die Sprache C # verwendet, aber die meisten Ideen k√∂nnen in andere Sprachen √ºbersetzt werden. <br><br>  Aus der Sicht der Sprachfunktionen ist 'Yield' aus meiner Sicht das am meisten unterbewertete Schl√ºsselwort.  Sie k√∂nnen die Dokumentation lesen und im Internet eine Vielzahl von Beispielen finden.  Um es kurz zu machen, nehmen wir an, dass 'Yield' das implizite Erstellen von 'Iteratoren' erm√∂glicht.  Ein Iterator sollte standardm√§√üig eine IEnumerable-Quelle f√ºr die √∂ffentliche Verwendung verf√ºgbar machen.  Und hier beginnt das Knifflige.  Weil wir viele Implementierungen von IEnumerable in der Sprache haben: Liste, W√∂rterbuch, Hashset, Warteschlange usw.  Und meiner Erfahrung nach ist die Wahl eines davon f√ºr die Zufriedenheitsanforderungen einer Gesch√§ftsaufgabe falsch.  Dar√ºber hinaus wird all dies durch die gew√§hlte Implementierung noch versch√§rft. Das Programm funktioniert einfach - das ist es, was wirklich f√ºr das Gesch√§ft ben√∂tigt wird, nicht wahr?  Im Allgemeinen funktioniert es, jedoch nur, bis der Dienst in einer Produktionsumgebung bereitgestellt wird. <br><br>  Zur Demonstration des Problems schlage ich vor, f√ºr die meisten Unternehmensprojekte einen sehr h√§ufigen Business Case / Flow zu w√§hlen, den wir w√§hrend des Artikels erweitern k√∂nnen, und einen Teil dieses Ablaufs zu ersetzen, um das Ausma√ü des Einflusses dieses Ansatzes auf Unternehmensprojekte zu verstehen.  Und es sollte Ihnen helfen, Ihren eigenen Fall in diesem Set zu finden, um das Problem zu beheben. <br><br>  Beispiel f√ºr die Aufgabe: <br><br><ol><li>  Laden Sie eine Reihe von Datens√§tzen aus einer Datei oder Datenbank in den Speicher. </li><li>  √Ñndern Sie f√ºr jede Spalte des Datensatzes den Wert in einen anderen Wert. </li><li>  Speichern Sie die Ergebnisse der Umwandlung in eine Datei oder eine Datenbank. </li></ol><br>  Nehmen wir mehrere F√§lle an, in denen diese Logik anwendbar sein kann.  In diesem Moment sehe ich zwei F√§lle: <br><br><ol><li>  Dies ist m√∂glicherweise ein Teil des Ablaufs f√ºr eine Konsolen-ETL-Anwendung. </li><li>  Es ist m√∂glicherweise eine Logik innerhalb der Aktion in Controller der MVC-Anwendung. </li></ol><br>  Wenn wir die Aufgabe auf eine technischere Art und Weise umschreiben, kann dies folgenderma√üen klingen: "(1) Zuweisen einer Speichermenge, (2) Laden von Informationen aus dem Persistenzspeicher in den Speicher, (3) √Ñndern und (4) L√∂schen von Datens√§tzen √Ñnderungen im Speicher des Persistenzspeichers. "  Hier kann der erste Satz in der Beschreibung "(1) Zuweisen einer Speichermenge" eine echte Korrelation zu Ihren nicht funktionalen Anforderungen haben.  Da Ihr Job / Service in einer Hosting-Umgebung "leben" sollte, die einige Einschr√§nkungen / Einschr√§nkungen aufweisen kann (z. B. 150 MB pro Mikrodienst), und um die Ausgaben f√ºr Ihren Service im Budget vorherzusagen, sollten wir in unserem Fall die Speichermenge vorhersagen Welcher Dienst wird verwendet (√ºblicherweise sagen wir √ºber maximale Speichermengen).  Mit anderen Worten, wir sollten einen Speicher-Footprint f√ºr Ihren Service ermitteln. <br><br>  Betrachten wir einen Speicherbedarf f√ºr eine wirklich h√§ufige Implementierung, den ich von Zeit zu Zeit in verschiedenen Codebasen von Unternehmensprojekten beobachte.  Sie k√∂nnen auch versuchen, es in Ihren Projekten zu finden, z. B. "unter der Haube" der Implementierung von "Repository" -Mustern. Versuchen Sie einfach, die folgenden W√∂rter zu finden: "ToList", "ToArray", "ToReadonlyCollection" usw.  All diese Implementierung bedeutet, dass: <br><br>  1. Weist f√ºr jede Zeile / jeden Datensatz in Datei / Datenbank Speicher zu, um die Eigenschaften des Datensatzes aus Datei / Datenbank zu speichern (dh var user = new User () {Vorname = 'Test', Nachname = 'Test2'}) <br><br>  2. Als n√§chstes werden mithilfe von beispielsweise 'ToArray' oder manuell die Objektreferenzen in einer Sammlung gespeichert (dh var users = new List (); users.Add (user)).  Daher wird jedem Datensatz aus einer Datei eine bestimmte Menge an Speicher zugewiesen. Um dies nicht zu vergessen, wird die Referenz in einer Sammlung gespeichert. <br><br>  Hier ist ein Beispiel: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;User&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadUsers2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> list = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;User&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> File.ReadLines(<span class="hljs-string"><span class="hljs-string">"text.txt"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> splittedLine = line.Split(<span class="hljs-string"><span class="hljs-string">';'</span></span>); list.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User() { FirstName = splittedLine[<span class="hljs-number"><span class="hljs-number">0</span></span>], LastName = splittedLine[<span class="hljs-number"><span class="hljs-number">1</span></span>] }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; <span class="hljs-comment"><span class="hljs-comment">// or return File.ReadLines("text.txt") .Select(line =&gt; line.Split(';')) .Select(splittedLine =&gt; new User() { FirstName = splittedLine[0], LastName = splittedLine[1] }).ToArray(); }</span></span></code> </pre> <br>  Speicherprofilergebnisse: <br><br><img src="https://habrastorage.org/webt/du/i2/bx/dui2bxcfqb1tvgzfeyvwsj6mfba.jpeg" alt="Bild"><br><br>  Genau dieses Bild habe ich jedes Mal in der Produktumgebung gesehen, bevor der Container aufgrund der Ressourcenbeschr√§nkung des Hostings pro Container gestoppt / neu geladen wurde. <br><br>  Ein Footprint f√ºr diesen Fall h√§ngt also ungef√§hr von der Anzahl der Datens√§tze in einer Datei ab.  Weil der Speicher pro Datensatz in der Datei zugewiesen wird.  Und die Summe dieser kleinen Speicherverluste gibt uns eine maximale Speichermenge, die von unserem Dienst verbraucht werden kann - es ist der Fu√üabdruck des Dienstes.  Aber ist dieser Fu√üabdruck vorhersehbar?  Anscheinend nein.  Weil wir eine Anzahl von Datens√§tzen in der Datei nicht vorhersagen k√∂nnen.  In den meisten F√§llen √ºberschreitet die Dateigr√∂√üe die beim Hosting zul√§ssige Speichermenge mehrmals.  Dies bedeutet, dass es schwierig ist, eine solche Implementierung in der Produktionsumgebung zu verwenden. <br><br>  Es scheint der Moment zu sein, eine solche Implementierung zu √ºberdenken.  Die n√§chste Annahme bietet uns m√∂glicherweise mehr M√∂glichkeiten zur Berechnung eines Footprints f√ºr den Service: "Ein Footprint sollte von der Gr√∂√üe nur eines Datensatzes in der Datei abh√§ngen."  In diesem Fall k√∂nnen wir ungef√§hr die maximale Gr√∂√üe jeder Spalte von nur einem Datensatz berechnen und summieren.  Es ist ziemlich einfach, die Gr√∂√üe eines Datensatzes vorherzusagen, anstatt die Anzahl der Datens√§tze in der Datei vorherzusagen. <br><br>  <b>Und es ist wirklich verwunderlich, dass wir einen Dienst implementieren k√∂nnen, der eine unvorhersehbare Menge von Datens√§tzen verarbeitet und st√§ndig nur ein paar Megabyte verbraucht, mit Hilfe nur eines Schl√ºsselworts - "Yield" *.</b> <br><br>  Die Zeit f√ºr ein Beispiel: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1. Load byline a set of records from a file or DB into memory. var users = LoadUsers(); // 2. For each column of the record change the value to someone other value. users = ModifyFirstName(users); // 3. Save the results of transformation into a file or DB. SaveUsers(users); } private static IEnumerable&lt;User&gt; LoadUsers() { foreach(var line in File.ReadLines("text.txt")) { var splitedLine = line.Split(';'); yield return new User() { FirstName = splitedLine[0], LastName = splitedLine[1] }; } } private static IEnumerable&lt;User&gt; ModifyFirstName(IEnumerable&lt;User&gt; users) { foreach (var user in users) { user.FirstName += "_1"; yield return user; } } private static void SaveUsers(IEnumerable&lt;User&gt; users) { foreach(var user in users) { File.AppendAllLines("results.txt", new string []{ user.FirstName + ';' + user.LastName }); } } private class User { public string FirstName { get; set; } public string LastName { get; set; } } }</span></span></code> </pre><br>  Wie Sie im obigen Beispiel sehen k√∂nnen, wird jeweils nur f√ºr ein Objekt Speicher zugewiesen:'ield return new User () ', anstatt eine Sammlung zu erstellen und diese mit Objekten zu f√ºllen.  Dies ist der Hauptpunkt der Optimierung, mit dem wir einen besser vorhersehbaren Speicherbedarf f√ºr den Dienst berechnen k√∂nnen.  Weil wir nur die Gr√∂√üe von zwei Feldern kennen m√ºssen, in unserem Fall Vorname und Nachname.  Wenn ein ge√§nderter Benutzer in einer Datei gespeichert wird (siehe File.AppendAllLines), steht die Instanz des Benutzerobjekts f√ºr die Speicherbereinigung zur Verf√ºgung.  Und der Speicher, der von dem Objekt belegt wird, wird freigegeben (d. H. Die n√§chste Iteration der 'foreach'-Anweisung in LoadUsers), so dass die n√§chste Instanz des Benutzerobjekts erstellt werden kann.  Mit anderen Worten, ungef√§hr wird dieselbe Speichermenge bei jeder Iteration durch dieselbe Speichermenge ersetzt.  Aus diesem Grund ben√∂tigen wir nicht mehr Speicher als die Gr√∂√üe eines einzelnen Datensatzes in der Datei. <br><br>  Ergebnisse des Speicherprofilers nach der Optimierung: <br><br><img src="https://habrastorage.org/webt/6k/gy/y6/6kgyy6wiwpafktukdwq2lsh_vx0.jpeg" alt="Bild"><br><br>  Aus einer anderen Perspektive, wenn wir einige Methoden in der obigen Implementierung leicht umbenennen, damit die Verwendung eine sinnvolle Logik f√ºr Controller in MVC-Anwendungen erkennen kann: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUsersAction</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1. Load byline a set of records from a file or DB into memory. var users = LoadUsers(); // 2. For each column of the record change the value to someone other value. var usersDTOs = MapToDTO(users); // 3. Save the results of transformation into a file or DB. OkResult(usersDTOs); }</span></span></code> </pre><br>  Ein wichtiger Hinweis vor der Codeliste: Die meisten wichtigen Bibliotheken wie EntityFramework, ASP.net MVC, AutoMapper, Dapper, NHibernate, ADO.net usw. legen IEnumerables-Quellen offen / verbrauchen sie.  Im obigen Beispiel bedeutet dies, dass LoadUsers durch eine Implementierung ersetzt werden k√∂nnen, die beispielsweise EntityFramework verwendet.  Womit Daten zeilenweise aus der DB-Tabelle anstelle einer Datei geladen werden.  MapToDTO kann durch Automapper ersetzt werden und OkResult kann durch eine "echte" Implementierung von IActionResult in einem MVC-Framework oder unserer eigenen Implementierungsbasis im Netzwerkstrom ersetzt werden, zum Beispiel: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OkResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;User&gt; users</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// you can use a networksteam implementation using(StreamWriter sw = new StreamWriter("result.txt")) { foreach(var user in users) { sw.WriteLine(user.FirstName + ';' + user.LastName); } } }</span></span></code> </pre><br>  Dieses 'mvc-√§hnliche' Beispiel zeigt uns, dass wir auch f√ºr Webanwendungen einen Speicherbedarf vorhersagen und berechnen k√∂nnen.  In diesem Fall h√§ngt dies jedoch auch von der Anzahl der Anfragen ab.  Beispielsweise k√∂nnen die nicht funktionalen Anforderungen folgenderma√üen klingen: "Maximale Speichermenge f√ºr 1000 Anforderungen nicht mehr als: 200 KB pro Benutzerobjekt x 1000 Anforderungen ~ 200 MB." <br><br>  Solche Berechnungen sind sehr n√ºtzlich f√ºr die Leistungsoptimierung bei der Skalierung der Webanwendung.  Beispielsweise m√ºssen Sie Ihre Webanwendung auf 100 Container / VMs skalieren.  Um in diesem Fall eine Entscheidung dar√ºber zu treffen, wie viele Ressourcen Sie vom Hosting-Anbieter zuweisen sollten, k√∂nnen Sie die Formel wie folgt anpassen: 200 KB pro Benutzerobjekt x 1000 Anforderungen x 100 VM ~ 20 GB.  Dar√ºber hinaus ist dies die maximale Speichermenge, die unter der Kontrolle des Projektbudgets steht. <br><br>  Ich hoffe, dass die Informationen aus diesem Artikel hilfreich sind und viel Geld und Zeit in Ihren Projekten sparen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de444358/">https://habr.com/ru/post/de444358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de444346/index.html">GraphQL und Golang</a></li>
<li><a href="../de444348/index.html">Wie unterscheiden sich funktionale React-Komponenten von klassenbasierten Komponenten?</a></li>
<li><a href="../de444350/index.html">Aus irgendeinem Grund startet MVP (Minimum Viable Product) nicht</a></li>
<li><a href="../de444352/index.html">Kontur.Kampus: Wir laden Sie zu einem kostenlosen Studentenlager f√ºr industrielle Entwicklung in der N√§he von St. Petersburg ein</a></li>
<li><a href="../de444356/index.html">React Tutorial Teil 24: Lektion f√ºr zweite Formen</a></li>
<li><a href="../de444360/index.html">Ungerechtigkeit Google Play als eine gute Lebenserfahrung</a></li>
<li><a href="../de444362/index.html">Unity und Havok arbeiten an einer neuen Physik-Engine</a></li>
<li><a href="../de444364/index.html">24 Stunden Rostspiel: Erfahrung in der pers√∂nlichen Entwicklung</a></li>
<li><a href="../de444366/index.html">Seminar "Anforderungen an die Informationssicherheit: Wie Unternehmen mit ihnen leben k√∂nnen"</a></li>
<li><a href="../de444368/index.html">Wir haben das Mikrofon gerade auf einem 3D-Drucker im Labor gedruckt - und dann wird es eine vollst√§ndige Science-Fiction geben</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>