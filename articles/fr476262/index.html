<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🙍🏾 🎪 👍🏿 À propos des miroirs du référentiel Centos et choisir le meilleur ⏭️ ☝🏻 👼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'année dernière, nous avons hébergé des miroirs en ligne pour plusieurs distributions Linux. Ce n'est pas un processus compliqué et pour les grands p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>À propos des miroirs du référentiel Centos et choisir le meilleur</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476262/">  L'année dernière, nous avons hébergé des miroirs en ligne pour plusieurs distributions Linux.  Ce n'est pas un processus compliqué et pour les grands projets comme Ubuntu, il est presque entièrement automatisé.  Dans d'autres cas, il est nécessaire d'une manière ou d'une autre de contacter le projet, par exemple, sur la liste de diffusion et d'exprimer clairement votre désir. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/i5/vh/_l/i5vh_lmncsc_yjc6woir34ypw8o.png" alt="miam repolist"></div><br>  Techniquement, c'est <code>rsync</code> , généralement selon un horaire.  Quelqu'un pour cela fournit un ensemble de scripts prêt à l'emploi, comme Fedora, et quelqu'un dit simplement que vous devez synchroniser ici à partir de ce serveur et l'ensemble de paramètres recommandé.  La ressource la plus chère est l'endroit, on est récemment arrivé à 4 téraoctets et c'est cher dans notre cas car cela ne génère aucun profit.  En retour, nous avons reçu une disponibilité locale des distributions que nous utilisons, ce qui a permis de simplifier la configuration initiale des serveurs en en supprimant l'accès Internet obligatoire.  Et bien sûr, nous sommes heureux d'avoir rejoint quelque chose de grand, même si notre participation à ce projet n'est pas très perceptible. <br><br>  Notre miroir est public, tout le monde peut en recevoir des mises à jour, ce qui se produit en fait s'il est jugé par les statistiques des appels.  C'est principalement la Russie, mais pas seulement.  A propos de la façon dont cela se passe et comment le serveur général est sélectionné pour les mises à jour sur l'exemple de la septième version de Centos de ce message. <a name="habracut"></a><br><br>  Nous parlerons du gestionnaire de paquets <code>yum</code> avec le <code>fastestmirror</code> le plus <code>fastestmirror</code> installé par défaut et nous ne serons intéressés que par le processus de sélection d'un miroir spécifique. <br><br><h2>  Liste des miroirs </h2><br>  Il est connu que la liste des référentiels est spécifiée dans les fichiers du répertoire <code>/etc/yum.repos.d/</code> sauf indication contraire.  Voici à quoi ressemblent les paramètres du référentiel de <code>Base</code> dans le fichier <code>/etc/yum.repos.d/Centos-Base.repo</code> : <br><br><pre> <code class="bash hljs">[base] name=CentOS-<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span> - Base mirrorlist=http://mirrorlist.centos.org/?release=<span class="hljs-variable"><span class="hljs-variable">$releasever</span></span>&amp;arch=<span class="hljs-variable"><span class="hljs-variable">$basearch</span></span>&amp;repo=os&amp;infra=<span class="hljs-variable"><span class="hljs-variable">$infra</span></span> <span class="hljs-comment"><span class="hljs-comment">#baseurl=http://mirror.centos.org/centos/$releasever/os/$basearch/ gpgcheck=1 gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span></span></code> </pre> <br>  Ici, vous pouvez voir deux options qui spécifient l'endroit où vous pouvez obtenir des données.  Le premier <b>baseurl</b> pointe directement vers le miroir, aucun choix n'est nécessaire ici.  La deuxième liste de miroirs indique un lien par lequel une liste de 10 miroirs sera renvoyée à partir de laquelle le choix sera fait, c'est cette option qui est active.  Nous voyons également plusieurs variables à l'intérieur du lien, toutes reflétant finalement une place spécifique dans l'arborescence de répertoires du référentiel: <br><br><ul><li>  <b>version</b> - version: <code>6</code> , <code>7</code> , <code>8</code> , <code>8-stream</code> .  Les anciennes versions sont retirées de l'infrastructure existante, mais des instantanés de leurs référentiels peuvent être trouvés sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://vault.centos.org/</a> </li><li>  <b>arch</b> est une architecture telle que <code>i386</code> ou <code>x86_64</code> .  Pour certaines versions, certaines architectures feront référence à des référentiels alternatifs et à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un autre système miroir</a> , mais en même temps, l'infrastructure de sélection de miroir reste courante.  Pour la version 7, le seul miroir de base pris en charge est <code>x86_64</code> , une alternative à <code>i386</code> .  Pour le premier, une liste sera formée dans la structure de base des miroirs, pour le second de l'alternative </li><li>  <b>repo</b> - dans notre cas, <code>os</code> , mais il peut s'agir de <code>updates</code> à <code>updates</code> ou autre, en fait le type de référentiel reflète les données dont nous avons besoin.  Pour la version 8, l'équivalent de <code>os</code> sera <code>baseos</code> </li><li>  <b>infra</b> - Je peux soigneusement supposer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">qu'il n'est toujours pas utilisé</a> , au moins je n'ai pas pu trouver son traitement lors de la formation d'une liste de miroirs.  Il est égal au <code>stock</code> , mais si vous omettez ce paramètre, aucun changement visible ne suivra </li><li>  <b>cc</b> est le code du pays; pour les États-Unis et le Canada, c'est aussi le code de l'État.  Ce n'est pas dans l'exemple du fichier ci-dessus, puisque le pays est calculé lorsqu'il est demandé par l'adresse IP du demandé.  Cette variable peut être utilisée pour éliminer les erreurs de géolocalisation.  Pour la Russie, <code>cc=ru</code> </li></ul><br>  Pour la 7e version de Centos, nous obtenons la ligne suivante: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock</a> , qui produira une liste de 10 miroirs du type suivant: <br><br><pre> <code class="bash hljs">http://&lt;   1&gt;/7.xxx/os/x86_64/ http://&lt;   2&gt;/7.xxx/os/x86_64/ ... http://&lt;   10&gt;/7.xxx/os/x86_64/</code> </pre> <br>  Notez que le chemin spécifique de chaque miroir correspond exactement aux variables de la requête.  La version complète est indiquée à la place de l'ancienne, bien que vous puissiez également l'utiliser: <code>http://&lt;  &gt;/7/os/x86_64/</code> existe également, implémenté à l'aide d'un lien symbolique vers la dernière version. <br><br><div class="spoiler">  <b class="spoiler_title">Et tout cela correspond à la hiérarchie des répertoires directement sur le serveur.</b> <div class="spoiler_text"><pre>  ./centos
 ├── 6
 │ ├── centosplus
 │ │ ├── i386
 ... │ └── x86_64
     ...
 │
 ├── 7
 │ ├── atomique
 │ │ └── x86_64
 │ ├── centosplus
 │ │ └── x86_64
 │ ├── cr
 │ │ └── x86_64
 │ ├── dotnet
 │ │ └── x86_64
 │ ├── extras
 │ │ └── x86_64
 │ ├── opstools
 │ │ └── x86_64
 │ ├── os
 │ │ └── x86_64
 │ │ └── repodata
 │ │ └── [repomd.xml]
 │ ├── rt
 │ │ └── x86_64
 │ ├── mises à jour
 │ │ └── x86_64
 │ ...
 │
 ├── 7.0.1406
 ├── 7.1.1503
 ├── 7.2.1511
 ├── 7.3.1611
 ├── 7.4.1708
 ├── 7.5.1804
 ├── 7.6.1810
 ├── 7.7.1908
 ├── 8
 ├── 8 flux
 ├── 8.0.1905 
 ... </pre></div></div><br><h3>  Implémentation </h3><br>  Maintenant pour l'implémentation, qui peut être trouvée sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/CentOS/mirrorlists-code</a> , nous sommes intéressés par la façon dont la liste des miroirs est formée.  Le script perle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">makemirrorlists-combined.pl le fait</a> .  Sa tâche principale est de vérifier la vitalité du miroir en comparant le hachage du <code>repodata/repomd.xml</code> avec la référence de la version et de l'architecture données.  Par conséquent, le fichier doit exister pour toutes les combinaisons disponibles de versions, types de référentiels et architecture. <br><br>  La vérification s'effectue selon la liste dans l'ordre suivant (je cite le code): <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment"># phase 1 -- this US state or Canada province # phase 2 -- this country # phase 3 -- other nearby countries # phase 4 -- mirrors from the same continent # phase 5 -- a random mirror from each continent (for fallback only) # note: phase 5 will be executed once for each continent (with "redo") # phase 6 -- random mirrors from any continent (for fallback only) # phase 7 -- centos servers from the same continent # phase 8 -- centos servers from other continents (used also for fallback)</span></span></code> </pre><br>  Les articles 1 et 2 fonctionnent soit pour vérifier non seulement le code du pays, mais aussi le code de l'État.  En substance, une tentative est effectuée pour sélectionner les serveurs géographiquement les plus proches.  Pour chaque étape, une requête est faite à partir de la base de données, par exemple: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">columns</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mirrors <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-string"><span class="hljs-string">'Direct'</span></span>, <span class="hljs-string"><span class="hljs-string">'Indirect'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">status</span></span> = <span class="hljs-string"><span class="hljs-string">'Active'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> cc = <span class="hljs-string"><span class="hljs-string">'$cc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> $commonqueryparams $skipregion $altarch_where <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">RAND</span></span>();</code> </pre><br>  Ensuite, il y a une vérification de la vitalité des miroirs sur cette liste en comparant les hachages, comme décrit ci-dessus.  Si 10 personnes sont recrutées, la tâche requise est terminée, le travail est terminé.  Si vous ne tapez pas, passez à l'étape suivante pour obtenir la liste générale à 10 ou jusqu'à ce que nous ayons épuisé toutes les options.  Le résultat est enregistré dans un fichier et transféré à la partie frontale de la pièce présentée par Python avec le script <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ml.py</a> , dont la tâche est de sélectionner et de donner le fichier souhaité, après avoir d'abord découvert le pays de la source de la requête par adresse IP.  Le type de protocole IPv4 ou IPv6, pour lequel différentes listes sont formées, est également pris en compte. <br><br>  Retour à la requête qui utilise <code>ORDER BY RAND()</code> , cela signifie-t-il que la liste sera aléatoire?  Oui, à quel point l'implémentation est aléatoire dans le SGBD, mais cela ne s'applique qu'à l'ordre dans chaque étape.  Autrement dit, si pour un pays particulier plus de 10 miroirs du type de référentiel et d'architecture requis sont typés (pour la Russie, il n'y en a que 17), à la fin, chaque fois, nous obtiendrons une liste mélangée de 10 miroirs différents dans un pays.  S'il y en a moins, en haut de la liste, <b>il y</b> aura <b>toujours des</b> référentiels mélangés d'un pays, d'autres référentiels mélangés des pays les plus proches, et ainsi de suite par étapes.  En conséquence, nous obtenons une liste non entièrement aléatoire composée de plusieurs parties aléatoires.  Cela compte quand il n'y a pas autant de miroirs fonctionnels dans un pays, par exemple, les miroirs IPv6 en Russie ne sont que 7 et ils seront toujours en tête de liste: <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=en (la demande doit être effectuée à partir de l'adresse IPv6)</b> <div class="spoiler_text"> <code>http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ <br> http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ <br> http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ <br> http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ <br> http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ <br> http://dedic.sh/centos/7.7.1908/os/x86_64/ <br> <br> http://ftp.funet.fi/pub/mirrors/centos.org/7.7.1908/os/x86_64/ <br> http://centos.mirror.far.fi/7.7.1908/os/x86_64/ <br> http://mirrors.glesys.net/CentOS/7.7.1908/os/x86_64/ <br></code> </div></div><br>  Pire encore, l'architecture <code>i386</code> est une architecture alternative pour Centos 7 et un système de miroir séparé.  En Russie, il n'y a qu'un seul serveur de ce type qui prend en charge des architectures alternatives; ce sera toujours en premier lieu: <br><br><div class="spoiler">  <b class="spoiler_title">http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=en</b> <div class="spoiler_text"> <code>http://mirrors.powernet.com.ru/centos-altarch/7.7.1908/os/i386/ <br> <br> http://mirror.vpsnet.com/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.huaweicloud.com/centos-altarch/7.7.1908/os/i386/ <br> http://linux.darkpenguin.net/distros/CentOS-AltArch/7.7.1908/os/i386/ <br> http://ftp.agdsn.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror1.hs-esslingen.de/pub/Mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://mirror.infonline.de/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.rz.uni-frankfurt.de/pub/mirrors/centos-altarch/7.7.1908/os/i386/ <br> http://ftp.yz.yamagata-u.ac.jp/pub/linux/centos-altarch/7.7.1908/os/i386/ <br> http://mirrors.daticum.com/centos-altarch/7.7.1908/os/i386/ <br></code> </div></div><br>  La liste n'est plus aléatoire, si vous vous concentrez sur la première ligne, le choix est prédéterminé.  La prise en charge des référentiels pour les architectures Centos alternatives est une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">question de</a> principe, mais pour beaucoup, l'altruisme pur est là. <br><br>  Les référentiels sont analysés en continu et sans tenir compte des mécanismes de mise en cache, le résultat est mis à jour toutes les 3 heures environ.  Citation de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mirrorlist_crawler_deployment_notes.txt</a> : <br><blockquote> <code>- A full scan of all repos and all versions without any cached data is going to take close to 3 hours, but typically altarch is &lt;10min, C6 &lt;25min, C7 &lt;25min with all the repos enabled</code> </blockquote> <br>  En pratique, j'ai commencé à obtenir des options de liste miroir en Russie pour IPv4 et IPv6 une fois par minute pour le référentiel Base Centos 7 - <code>http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock&amp;cc=ru</code> et cela s'est avéré comme ceci pour quelques jours d'observation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fx/qh/sn/fxqhsn08lhen5mke-jlprhlgjxa.png" alt="nombre de mises à jour de la liste des miroirs"></div><br>  liste IPv4 bleue, IPv6 rouge.  Le changement ne se produit pas toutes les 25 minutes, mais pas une fois toutes les 3 heures - tout tient dans l'intervalle d'une demi-heure à deux.  L'image avec l'architecture <code>i386</code> et les miroirs alternatifs est radicalement différente - <code>http://mirrorlist.centos.org/?release=7&amp;arch=i386&amp;repo=os&amp;infra=stock&amp;cc=ru</code> environ une semaine d'observation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/os/xy/wb/osxywbdutbktiud6-scyrul_lok.png" alt="altmirrors liste des mises à jour comptent"></div><br>  Nous pouvons nous attendre à ce que toutes les 15 minutes, nous aurons une nouvelle liste, dans 30 minutes, des changements seront apportés.  Mais!  N'oubliez pas que moins les miroirs sont actifs, moins l'ordre est aléatoire et, en premier lieu, maintenant en Russie, c'est toujours le même miroir. <br><br><h2>  Le plus rapide des miroirs </h2><br>  Au total, la liste des miroirs se forme au mieux par hasard, ce qui n'est sans doute pas mauvais pour l'équilibrage de charge.  Au pire, nous pouvons nous attendre à ne choisir que le premier miroir de la liste, nous n'aurons pas le choix en tant que tel.  De plus, la division territoriale des pays dans le cas d'un grand pays comme le nôtre peut jouer un tour en plaçant en tête de liste un miroir de Petropavlovsk-Kamchatsky <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://mirror.vilkam.ru</a> pour le client de Sotchi.  Par conséquent, il serait bon d'évaluer la disponibilité des miroirs de cette liste.  Cela se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fait par le</a> plugin de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">miroir le plus rapide</a> .  Dont l'essence se résume à une simple action: <br><br><pre> <code class="python hljs">time_before = time.time() sock.connect((self.host, self.port)) result = time.time() - time_before</code> </pre><br>  Pas de <code>HTTP</code> ou <code>ICMP</code> , ouvrez le socket pour le nœud, considérez combien de temps cela a pris, appliquez <code>sort()</code> aux résultats.  Tous les 10 miroirs obtenus à l'étape précédente sont envoyés en tant que paramètres, sous la forme de l' <code>URL</code> complète à partir de laquelle seul le nom d'hôte est utilisé.  Le plugin est facile à faire fonctionner séparément de <code>yum</code> , il vous suffit de commenter les lignes 52 et 55: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># from yum.plugins import TYPE_CORE requires_api_version = '2.5' # plugin_type = (TYPE_CORE,)</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">et peut être utilisé.</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ./fastestmirror.py http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/ http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/ http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/ http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/ http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/ http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/ http://dedic.sh/centos/7.7.1908/os/x86_64/ http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/ http://mirror.awanti.com/centos/7.7.1908/os/x86_64/ http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/repodata/repodm.xml http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/ http://mirror.docker.ru/centos/7.7.1908/os/x86_64/ http://mirror.logol.ru/centos/7.7.1908/os/x86_64/ http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/ http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/ http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/ http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/ * mirror.corbina.net : 0.085000 secs * mirrors.powernet.com.ru : 0.097000 secs * mirror.sale-dedic.com : 0.117000 secs * ftp.nsc.ru : 0.181000 secs * mirror.reconn.ru : 0.184000 secs * mirror.yandex.ru : 0.222000 secs * dedic.sh : 0.261000 secs * mirror.tversu.ru : 0.295000 secs * mirror.awanti.com : 0.345000 secs * mirror.linux-ia64.org : 0.386000 secs * mirrors.datahouse.ru : 0.403000 secs * mirror.docker.ru : 0.435000 secs * mirror.logol.ru : 0.474000 secs * centos-mirror.rbc.ru : 0.519000 secs * mirror.truenetwork.ru : 0.587000 secs * mirror.axelname.ru : 0.528000 secs * mirror.vilkam.ru : 0.709000 secs Result: [<span class="hljs-string"><span class="hljs-string">'http://mirror.corbina.net/pub/Linux/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.powernet.com.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.sale-dedic.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://ftp.nsc.ru/pub/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.reconn.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.yandex.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://dedic.sh/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.tversu.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.awanti.com/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.linux-ia64.org/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirrors.datahouse.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.docker.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.logol.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://centos-mirror.rbc.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.axelname.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.truenetwork.ru/centos/7.7.1908/os/x86_64/'</span></span>, <span class="hljs-string"><span class="hljs-string">'http://mirror.vilkam.ru/centos/7.7.1908/os/x86_64/'</span></span>]</code> </pre></div></div><br>  Le traitement se déroule en plusieurs threads, vous n'avez donc pas à attendre longtemps, même pour les 17 miroirs répertoriés en Russie.  Le résultat d'un travail sous forme de deux listes, la première dans laquelle le temps d'exécution est indiqué, est le débogage et il n'est pas trié, même si cela peut sembler le cas.  La seconde après le mot <code>Result</code> triée d'une réponse plus petite à une réponse plus grande, c'est lui qui est utilisé pour d'autres travaux dans l'ordre reçu. <br><br>  <code>dnf</code> utilise également le <code>dnf</code> plus <a href="">rapide</a> de l'ensemble des bibliothèques RPM, mais là, il est résolu via <code>libcurl</code> et en général tout est plus compliqué. <br><br>  En fin de compte, tout dépend de la rapidité avec laquelle la réponse du miroir est reçue, tandis que la mise en cache doit être prise en compte, c'est-à-dire que le calcul direct du retard n'est pas toujours effectué.  Les intervalles de temps sont grandement affectés par les performances internes de la machine locale et sa charge de travail.  Les nœuds proches montrant des résultats similaires changeront probablement fréquemment de place.  Mais ici c'est fait, il me semble que l'objectif principal n'est pas d'envoyer un nœud de Sotchi pour renouvellement à Petropavlovsk-Kamchatsky, se rendre à Moscou ou Volgograd est tout à fait acceptable.  À quoi d'autre faisons-nous attention, le choix est fait à partir de la liste qui a été reçue à la première étape avant le <code>fastestmirror</code> , si ces données ne sont pas encore dans le cache, alors le miroir le plus proche au premier essai peut ne pas être le meilleur, simplement parce qu'il ne sera même pas analysé sans entrer dans le top dix. <br><br>  Dans la pratique, les résultats suivants ont été obtenus lors d'une enquête hebdomadaire toutes les 10 minutes.  Chiffres - le nombre de fois combien de nœuds ont gagné au cours de la comparaison, pour un <code>fastestmirror</code> et un <code>fastestmirror</code> : <br><blockquote> <code>1422,1013 mirror.logol.ru <br> 534,986 mirror.docker.ru <br> 28,8 mirrors.datahouse.ru <br> 16 centos-mirror.rbc.ru <br> 6 mirror.sale-dedic.com <br> 5,7 mirror.reconn.ru <br> 2 dedic.sh <br> 1 mirror.corbina.net</code> </blockquote> <br>  Et version IPv6 de la liste: <br><blockquote> <code>1989,1980 mirror.reconn.ru <br> 18,34 mirror.sale-dedic.com <br> 7 dedic.sh <br></code> </blockquote><br>  On peut voir que le choix n'est pas directement sans ambiguïté, mais ici la proximité du point à partir duquel j'ai effectué l'enquête joue probablement un rôle - jusqu'à plusieurs miroirs, la différence est inférieure à une milliseconde.  Le deuxième point, la liste IPv6 est différente et c'est pire - l'hôte IPv6 le plus proche est plus loin que l'IPv4 le plus proche et le choix est moins.  Étant donné la priorité d'IPv6, ce n'est pas très bon.  Les résultats de <code>fping</code> concis, moins de nœuds gagnants, mais sont généralement les mêmes avec le <code>fastestmirror</code> . <br><br><h2>  Atlas mûr </h2><br>  Avec un choix local, tout est plus ou moins clair, voyons maintenant comment les choses se passent dans tout le pays.  Pourquoi utilisons-nous les services <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://atlas.ripe.net/</a> - un ensemble de sondes (sondes) et d'outils pour travailler avec eux sous les auspices de RIPE NCC, je vous avertis immédiatement, ce n'est pas le site le plus rapide et le plus agile.  Tout le monde peut obtenir une sonde et utiliser ce réseau.  Mais pour exécuter les tests, vous avez besoin d'une devise interne qui s'accumule à partir des appareils enregistrés et actifs après vous.  J'ai choisi tous les appareils en Russie qui prennent en charge IPv6 et IPv4 en même temps, 82 d'entre eux se sont révélés. Selon les résultats des mesures, une partie devait être éliminée, il en restait donc 67 sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">plus de 400</a> . <br><br>  Il existe plusieurs options de test que vous pouvez exécuter, bien sûr, il n'y a pas ce qui est utilisé dans le <code>fastestmirror</code> , mais il y a un <code>ping</code> régulier.  Pour tous les miroirs, à l'exception de <code>mirror.linux-ia64.org</code> pour lequel <code>ICMP</code> filtré et <code>mirror.axelname.ru</code> qui est apparu après les tests, à partir de tous les périphériques sélectionnés, séparément pour IPv6 et IPv4, toutes les 3 heures pendant une semaine 10 demandes chacune.  Le temps de réponse moyen a été enregistré.  Sur l'ensemble des mesures, environ 50 pour chaque miroir, la médiane a été prise et comparée à d'autres miroirs sur cette sonde.  Le miroir avec le temps de réponse le plus court a gagné. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cg/ap/gf/cgapgfond47sh3phyalhc30s0na.jpeg" alt="carte des miroirs et sondes"></div><br>  Les sondes (marqueurs bleus) et les miroirs (marqueurs rouges) sont distribués de manière trop inégale et gravitent vers les capitales, de sorte que les résultats ne doivent pas être considérés comme quelque chose de significatif.  Les données brutes sont disponibles à partir du numéro de mesure <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">23159879</a> à <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">23159901</a> , si vous le souhaitez, elles peuvent être analysées plus strictement.  Nombre total résumé de premières places pour IPv4: <br><blockquote> <code>22 mirror.docker.ru <br> 12 mirror.awanti.com <br> 10 centos-mirror.rbc.ru <br> 6 dedic.sh <br> 4 mirror.truenetwork.ru <br> 3 mirror.corbina.net <br> 3 mirrors.powernet.com.ru <br> 2 ftp.nsc.ru <br> 2 mirrors.datahouse.ru <br> 1 mirror.reconn.ru <br> 1 mirror.vilkam.ru <br> 1 mirror.yandex.ru <br></code> </blockquote><br>  et IPv6: <br><blockquote> <code>20 dedic.sh <br> 20 mirror.reconn.ru <br> 10 mirror.yandex.ru <br> 8 mirror.sale-dedic.com <br> 5 ftp.nsc.ru <br> 3 mirror.corbina.net <br> 1 mirrors.powernet.com.ru <br></code> </blockquote><br>  On peut dire que pour presque tous les miroirs, je leur rappelle 17, il y a des consommateurs.  Il est intéressant de <code>mirror.yandex.ru</code> que <code>mirror.yandex.ru</code> dernière place avec <code>mirror.vilkam.ru</code> de Petropavlovsk-Kamchatsky.  En même temps, Yandex est disponible presque partout, il perd un peu plus de réactivité à chaque fois, mais <code>mirror.vilkam.ru</code> gagne une fois, mais plus <code>mirror.vilkam.ru</code> par rapport aux autres sur la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sonde 6606</a> de Khabarovsk (RTT en millisecondes): <br><blockquote> <code>centos-mirror.rbc.ru,105.4163369 <br> dedic.sh,109.2160474 <br> ftp.nsc.ru,106.4012836 <br> mirror.awanti.com,107.0802782 <br> mirror.corbina.net,98.5339837 <br> mirror.docker.ru,102.7883347 <br> mirror.logol.ru,105.9588192 <br> mirror.reconn.ru,106.5717624 <br> mirror.sale-dedic.com,106.1676841 <br> mirror.truenetwork.ru,110.9780753 <br> mirror.tversu.ru,107.9966083 <br> mirror.vilkam.ru,25.1486164 <br> mirror.yandex.ru,99.7320257 <br> mirrors.datahouse.ru,103.6546383 <br> mirrors.powernet.com.ru,116.4087614 <br></code> </blockquote><br>  Les meilleurs résultats dans la région d'une ou plusieurs millisecondes, et le pire résultat en réponse à Salekhard, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sonde 22767</a> : <br><blockquote> <code>centos-mirror.rbc.ru,59.9632155 <br> dedic.sh,63.765421 <br> ftp.nsc.ru,59.349309 <br> mirror.awanti.com,75.8998928571 <br> mirror.corbina.net,59.906047 <br> mirror.docker.ru,65.8720585 <br> mirror.logol.ru,63.2041255 <br> mirror.reconn.ru,63.7120505 <br> mirror.sale-dedic.com,63.052342 <br> mirror.truenetwork.ru,61.2567465 <br> mirror.tversu.ru,66.2593372222 <br> mirror.vilkam.ru,138.3730595 <br> mirror.yandex.ru,63.4150445 <br> mirrors.datahouse.ru,59.304435 <br> mirrors.powernet.com.ru,78.7411795 <br></code> </blockquote><br><h2>  Postface </h2><br>  Pour ceux qui sont arrivés à cet endroit, je répondrai à la question qui sera posée - notre miroir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">http://mirrors.powernet.com.ru</a> et voici comment il est utilisé: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nl/rm/nb/nlrmnbe9g8tnuvym2u6jlyurnzc.png" alt="trafic de données mirrors.powernet.com.ru"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/tk/99/rn/tk99rnmoigycgl4ataoygkhs100.png" alt="trafic de la bande passante mirrors.powernet.com.ru"></div><br>  De plus, la part de ce trafic provenant de notre réseau est négligeable. <br><br>  Voici comment se termine l'endroit: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ap/qk/zc/apqkzcw2htintu4idmjk5sixyfk.png" alt="disque mirrors.powernet.com.ru"></div><br>  Les étapes bien distinctes sont des moments où nous ajoutons une nouvelle distribution.  Au début, VirtualBox fonctionnait sous Windows sur un ordinateur de bureau sur lequel étaient stockées les archives vidéo de notre service de publicité.  Ensuite, nous sommes passés au système de virtualisation de combat et c'est devenu un peu plus facile: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/po/nl/hq/ponlhqp1327wrr6hmvpczednm8q.png" alt="image"></div><br>  À titre de comparaison, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">mirror.truenetwork.ru</a> renvoie un trafic de 3 Gb / s à partir de deux serveurs.  Tout est beaucoup plus modeste avec nous et, en général, il nous suffit largement d'apprécier le processus, ainsi que les rares critiques enthousiastes d'amis et d'abonnés lorsque quelqu'un remarque des lignes soudainement familières lors de la mise à jour de leur système.  Et aussi, scintillant parfois en arrière-plan dans divers articles et manuels, où les liens vers notre miroir sont visibles dans les journaux ou les captures d'écran. <br><br>  Vous pouvez voir l'état de tous les miroirs connus dans Centos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , et lire comment rejoindre le projet <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> , c'est à la fois simple et responsable à la fois, mais certainement pas inutile. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr476262/">https://habr.com/ru/post/fr476262/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr476252/index.html">Migration de messagerie: comment passer facilement d'un serveur à un autre</a></li>
<li><a href="../fr476254/index.html">Des étudiants aux incidents ou comment entrer dans une entreprise informatique sans connaissances ni expérience</a></li>
<li><a href="../fr476256/index.html">Sur les traces du mouvement russe Scala. 3e partie</a></li>
<li><a href="../fr476258/index.html">Migration de la base de données GitLab vers PostgreSQL externe</a></li>
<li><a href="../fr476260/index.html">Nous collectons dans rpm WireMock - un utilitaire pour créer des talons sur les services Web dans Fedora COPR analogique de PPA dans Ubuntu</a></li>
<li><a href="../fr476264/index.html">Bot télégramme pour l'apprentissage des langues étrangères: du bourrage de mots à la parole</a></li>
<li><a href="../fr476266/index.html">Stage chez Mars Digital Technologies. Comment nous avons appliqué le deep learning chez M&M's</a></li>
<li><a href="../fr476268/index.html">Solutions aux défis de détection de bugs proposés par l'équipe PVS-Studio lors de conférences en 2018-2019</a></li>
<li><a href="../fr476270/index.html">Notre victoire: TopCoder Open 2019</a></li>
<li><a href="../fr476272/index.html">Réponses aux tâches du stand PVS-Studio lors des conférences 2018-2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>