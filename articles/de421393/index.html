<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👌🏾 🔮 🔡 Verlassener Mailchimp Basket: Ein Leitfaden für die Faulen ☀️ 👨🏼‍🎓 👨🏼‍💼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zuerst ein bisschen schimpfen :) Früher oder später hat jeder Online-Shop die Frage, einen verlassenen Korb einzurichten. Statistiken und das Gefühl, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Verlassener Mailchimp Basket: Ein Leitfaden für die Faulen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/421393/">  Zuerst ein bisschen schimpfen :) Früher oder später hat jeder Online-Shop die Frage, einen verlassenen Korb einzurichten.  Statistiken und das Gefühl, dass verlorenes Geld im Magen saugt, verschonen niemanden. <br><br><h4>  Prozentsatz der verlassenen Körbe von 2006 bis 2017 </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/a39/77d/91a/a3977d91a0ebd3217886009fec230985.jpg" alt="Prozentsatz der verlassenen Körbe von 2006 bis 2017"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quelle</a></i> <br><br>  Prozentsatz der verlassenen Körbe für das erste Quartal 2018 nach Branchen: <br><img src="https://habrastorage.org/getpro/habr/post_images/633/2b5/be6/6332b5be64d04bbd4ca0d1defe9e7b14.jpg" alt="Prozentsatz der verlassenen Körbe für das erste Quartal 2018 nach Branchen"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quelle</a></i> <br><br>  Gleichzeitig nutzen die meisten Online-Shops trotz der allgemein verfügbaren Statistiken die verfügbaren Funktionen nicht und verbinden keinen verlassenen Warenkorb.  Eine kürzlich von EmailSoldiers durchgeführte "Home" -Studie zeigt deutlich, dass sich die meisten Geschäfte überhaupt nicht darum kümmern. <br><a name="habracut"></a><br><h4>  Aktuelle Statistiken für verbundene verlassene Körbe </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/fd4/b56/83f/fd4b5683f724d5004046e14523b95f69.jpg" alt="EmailSoldiers Research"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quelle</a></i> <br><br>  Gleichzeitig holen alle (und auch wir sind keine Heiligen) den Verkehr auf, schalten Anzeigen und Motive, versuchen aber nicht einmal, die Person zurückzugeben, die im letzten Moment pleite war. <br><br>  In der ersten Iteration können Sie jedoch eine Erhöhung der Bestellungen mit einem Brief ohne dynamischen Inhalt erzielen. Sie müssen ihn nur konfigurieren.  Bemühen Sie sich nur einmal, damit es im Hintergrund Geld bringt - ist das nicht ein Märchen? <br><br>  Natürlich kann ein Brief mit dynamischem Inhalt, in den Waren aus dem Warenkorb gezogen werden, besser funktionieren.  Oder vielleicht hat ein anderes Kätzchen mit traurigen Augen mehr Einfluss auf Ihr Publikum.  Oder Sie ziehen die empfohlenen Waren zu den Waren im Warenkorb und stellen fest, dass sie häufiger aus Briefen gekauft werden, und erhöhen den durchschnittlichen Scheck.  Oder Sie können eine Reihe von Buchstaben erstellen, aus denen die Konvertierung noch größer wird. <br><br>  Sie können Briefe von einem verlassenen Korb zu einem unerreichbaren Ideal verbessern und testen, aber jeder einmal konfigurierte Brief ist bereits unvergleichlich besser als nichts. <br><br><h4>  Umrechnung für einen verlassenen Warenkorb nach RetailRocket </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/df2/2f9/684/df22f968450761e23695591fcd2931af.jpg" alt="RetailRocket hat die Korbkonvertierung aufgegeben"><br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quelle</a></i> <br><br>  Und so begannen Genosse <a href="">Artem Aleksandrov und ich,</a> den Korb von zwei Seiten einzuführen. <br><br><h2>  Technische Umsetzung </h2><br><h4>  TOR für die Integration </h4><br>  Beschreiben Sie kurz das Wesentliche der Aufgabe. <br><br>  Aufgabe: Verbinden Sie einen verlassenen Warenkorb für die Site xxx.xx mit dem Mailchimp-Mailingdienst <br><br>  Wir geben alle notwendigen Materialien aus. <br><br>  API-Schlüssel: XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX-usXX <br><br>  Woher bekomme ich den Schlüssel? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/511/fc0/f9f511fc0d1ff7d44d41d19463cd362e.jpg" alt="Woher bekomme ich den Schlüssel?"><br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Wir geben einen Link zur Dokumentation</a> <br><br>  ID des Blattes, mit dem wir den Store verbinden: XXXXXXXXXX <br><br>  Wo kann ich die Blatt-ID bekommen? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/215/996/6cb/2159966cb62dc60e25079b86c5905aca.jpg" alt="Wo kann ich die Blatt-ID bekommen?"><br><br>  Ein Mail-Service muss im Voraus erstellt werden.  Sobald die API-Anfrage beim Mailing-Service eingeht, wird die Nachricht automatisch generiert und der Adressat zum Senden in die Warteschlange gestellt. <br><br>  Für unseren Fall haben wir die folgende Logik zum Senden eines verlassenen Warenkorbs gewählt: <br>  Ein autorisierter Benutzer auf der Website fügt dem Warenkorb Waren hinzu, schließt die Transaktion nicht ab und schließt die Bestellung nicht ab. Der Warenkorb bleibt 1 Stunde lang unverändert.  Danach wird eine Anfrage an Mailchimp gesendet, in der E-Mail, Zusammensetzung der Bestellung des Benutzers, Produktbilder, Warenpreis und ein Link zum Warenkorb des Benutzers übertragen werden. <br><br><h4>  Layoutvorlage </h4><br>  Beim Erstellen einer Automatisierung für einen verlassenen Warenkorb fragt der Mailchim sofort, ob ein oder mehrere Buchstaben vorhanden sind, und schlägt vor, ein verbundenes Geschäft auszuwählen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12d/288/b80/12d288b80aed84cc9ac1b3b81b4d3d6d.jpg" alt="Erstellen Sie in Mailchimp eine Automatisierung für einen verlassenen Warenkorb"><br><br>  In den Grundvorlagen bietet mch eine Auswahl von drei Teilen: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f2/402/d62/7f2402d625f7174f3a18f42849080bea.jpg" alt="Wählen Sie Buchstaben für einen verlassenen Mailchimp-Korb aus"><br><ol><li>  Verlassener Korb mit dynamischer Ware </li><li>  Verlassener Korb mit Lebensmittelempfehlungen (muss separat konfiguriert werden) </li><li>  Verlassener Korb ohne Waren (nur ein Textbrief) </li></ol><br>  In den besten Traditionen können Sie, wenn Sie Zeit haben, den Korb selbst zusammenstellen. <br><br>  Dynamische Produkte ohne Stile sehen ungefähr so ​​aus (Einrückung vergessen, sie werden hier hässlich angezeigt): <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> *|ABANDONED_CART:[$total=3]|* <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|CART:URL|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:TITLE|*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_blank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*|PRODUCT:IMAGE_URL|*"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> *|PRODUCT:TITLE|* — *|PRODUCT:PRICE|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> *|END:ABANDONED_CART|* <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Es scheint, dass, wenn Sie die Nummer in der Variablen <b>* | ABANDONED_CART: [$ total = 3] | *</b> ändern, der Brief eine andere Warenmenge anzeigt, aber nein, mindestens 5, mindestens 100, der mch weigert sich, eine andere Menge anzuzeigen. <br><br>  Und was auch ein wenig seltsam ist, die Variable <b>* | PRODUCT: PRICE | *</b> wird durch RUB288-Formatwerte ersetzt, und aus irgendeinem Grund ist es auch unmöglich, dies zu ändern, aber dazu später mehr. <br><br>  Zur Abwechslung haben wir versucht, Variablen durch die Anzahl der Spiele und die Gesamtkosten der Bestellung zu ersetzen, die wir per API übermitteln, aber der Mailchimp sagte hier nein.  Nun, so sei es. <br><br><h4>  Ein Wort an den Programmierer :) </h4><br>  Bei Mailchimp gab es eine historische Erfahrung mit der Integration in den Service-Mandrill von Drittanbietern. Dort ist alles einfach und klar.  Sehr freundliche Dokumentation (natürlich auf Englisch), aber es gab keine Ecken und Kanten und es funktionierte vom ersten Kick an. <br><br>  Außerdem wurde auf unserer Website ein Abonnementmechanismus über spezielle Formulare eingeführt.  Hier haben wir die Untertreibung und Mehrdeutigkeit der Mailchimp-Dokumentation voll gespürt.  Englisch ist für einen erfahrenen Entwickler kein Problem, aber die Kenntnis des klingonischen Dialekts ist standardmäßig nicht impliziert. <br><br>  Die ersten Daten sind: die PHP7-Sprache und das YII2-Framework, das mit seinem Ökosystem bereits überwältigend gewachsen ist.  Das heißt,  Wir haben bereits 6 kleine Projekte, die versuchen, gemeinsame Komponenten sowohl im Backend als auch im Frontend zu verwenden.  Dementsprechend erfordert die Umsetzung einer Aufgabe die unabhängige Lösung ihres Projekts, dies bedeutet jedoch keine Rahmenunabhängigkeit, da  man muss dafür mit menschlichen Stunden bezahlen, von denen es immer einen Mangel gibt. <br><br>  Nachdem wir die Aufgabe der Integration erhalten haben, müssen wir uns zuerst umschauen.  Was ist uns gegeben?  Erstens den Mailchimp-Service, mit dem Sie sich anfreunden müssen.  Wir gehen zum Github und sehen, dass es ziemlich viele Implementierungen gibt.  Aber die Wahl ist einfach - das beliebteste Paket mit 1,5.000 Sternen ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">drawm / mailchimp-api</a> ). <br><br>  Das Paket bietet einen einfachen Wrapper für die Interaktion mit einem Mailchimp.  Das können wir nur mit unserer Logik erreichen. <br><br>  Zweitens erhalten wir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dokumentation</a> .  Basierend auf der Dokumentation verfügen wir über eine Store-Ressource mit verschachtelten Ressourcen: Warenkorb, Kunde, Bestellung, Produkt, Promo-Regel.  Für einen verlassenen Warenkorb ohne empfohlene Produkte benötigen wir nur Produkt, Warenkorb und Kunde.  Der Warenkorb besteht wiederum aus dem Warenkorbsatz, und das Produkt enthält Produktvarianten. <br><br>  Wir haben die Aufgabe wie folgt zerlegt: <br><br><ol><li>  Laden Sie die Speicherdaten in die Speicher hoch </li><li>  Laden Sie alle käuflichen Produkte unter Produkte herunter </li><li>  Richten Sie das Laden von Körben mit Benutzern nach einem Zeitplan ein </li></ol><br>  Ok, lass uns gehen.  Zunächst übernehmen wir die Essenz des "Ladens".  Wir haben uns entschlossen, sofort die Test- und Kampfversion des Geschäfts zu verwenden, und je nach Umgebungsvariable, die für den Jungfern- / Produktmodus verantwortlich ist, haben wir entweder mit einem Geschäft oder mit einem anderen gearbeitet. <br><br>  Um Geschäftsdaten herunterzuladen, klopfen wir auf eine Post-Anfrage unter / ecommerce / store mit den folgenden Parametern: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'list_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'****'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'*** - test'</span></span>, <span class="hljs-string"><span class="hljs-string">'domain'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'dev.***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'admin@***.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'primary_locale'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'money_format'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'₽'</span></span>, ]</code> </pre> <br>  Es gibt mehrere weitere Optionen, aber alles hängt von den Anforderungen ab.  Weil  Wir wollten die Kontaktdaten des Geschäfts nicht in Briefen verwenden. Wir haben die Felder Telefon, Adresse, Zeitzone usw. nicht ausgefüllt. <br>  Aber eine kleine Überraschung erwartete uns.  Das Feld money_format scheint speziell für die Darstellung des Preises in einem für uns geeigneten Format erstellt worden zu sein.  Beim Erstellen einer verlassenen Korbvorlage ersetzt der Mailchip jedoch hartnäckig RUB vor der Nummer.  Mailchimp, hör auf! <br><br>  Nach dem Download können wir die Daten mithilfe der Get-Anfrage unter der Adresse / E-Commerce / Stores überprüfen, um alle geladenen Stores anzuzeigen, oder / E-Commerce / Stores / {id}, um Daten zu einem bestimmten Store abzurufen. <br><br>  Jetzt können Sie alle anderen Daten hinzufügen, da der Store der Stammpunkt in unserem Datenbaum ist, weil  Wir werden alle anderen Daten in ein bestimmtes Geschäft hochladen. <br><br>  Damit der MCH Waren in einem verlassenen Korb ersetzen kann, muss er diese Waren füttern.  Dazu haben wir die Adresse / ecommerce / store / {store_id} / products, an die wir Post-Requests zum Erstellen von Produkten im System senden. <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'handle'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'kastrulya'</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'description'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' —    .  ,       .  ,        !           !'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vendor'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'variants'</span></span> =&gt; [ [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'742'</span></span>, <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/catalog/kastrulya/'</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">890</span></span>, <span class="hljs-string"><span class="hljs-string">'sku'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'KA453'</span></span>, <span class="hljs-string"><span class="hljs-string">'inventory_quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">'image_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/images/742/product.png'</span></span>, <span class="hljs-string"><span class="hljs-string">'visibility'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'visible'</span></span>, ], ], ]</code> </pre><br>  Was ist so bemerkenswert?  Zunächst muss jedes Produkt aus mindestens einem Produktangebot bestehen.  Im Wesentlichen ist Produkt ein Container zum Laden von Produktangeboten.  Darüber hinaus kann sich die ID des Produkts und des Produktangebots überschneiden, da dies unterschiedliche Ressourcen in der MCH-API sind. <br><br>  Und hier begann die Untertreibung der MCH-Dokumentation.  Ich musste raten, auch wenn es nicht schwierig war, aber man konnte es normal machen und nicht wie immer. <br><br>  Das Handle-Feld wurde als "Handle eines Produkts" beschrieben.  Ok, nach Rücksprache haben wir entschieden, dass dies Teil der URL ist, die sich auf das Produkt selbst bezieht (cnc).  Dies wurde jedoch nur während der Tests bestätigt. <br><br>  Sie können dem Produkt auch eine Reihe von Bildern hinzufügen. Wir haben jedoch entschieden, dass dies für uns nicht nützlich ist. Daher wurde nur das Hauptbild sowohl in das Produkt als auch in jedes Produktangebot geladen. <br><br>  Und hier hatten wir ein Problem, aus irgendeinem Grund erschien die Ware nicht in den Mailchart-Vorlagen. <br><br>  Wir begannen, in das Dock für Produkt zu graben.  Und sie fanden ein Sichtfeld mit einer luxuriösen Beschreibung: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/525/123/aae/525123aae8eff2a8a1a595072d92b2f6.jpg" alt="Sichtbarkeitsfeldbeschreibung"><br><br>  Geben Sie String ein!  Und was kann dort übertragen werden?  Warum ist es unmöglich, alle möglichen Bedeutungen zu beschreiben ?!  Ich kann dort zum Beispiel "zeig mir bitte!" Senden. <br><br>  Zum Glück gibt es eine Beispielanfrage! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57b/e08/dbe/57be08dbe97502fc302cc4de5dc0e4bf.jpg" alt="Beispiel anfordern"><br><br>  Nun, dies hebt das Problem nicht auf.  Ich weiß nicht, welche anderen Werte nützlich sein könnten. <br><br>  Jeder hat das geschafft!  Jetzt kann der E-Mail-Vermarkter die Verfügbarkeit von Waren im System überprüfen, indem er eine Vorlage unter Beteiligung von Waren oder alle über dieselben Abrufanforderungen über die Konsole erstellt. <br><br>  Als nächstes stehen wir vor der Aufgabe, verlassene Körbe in den MCH zu laden.  Zunächst kamen 2 Optionen in den Sinn: <br><br><ol><li>  Jedes Mal, wenn Sie den Warenkorb wechseln (Waren hinzufügen / entfernen), wiederholen wir diese Aktion in MCH.  Von den Minuspunkten bietet sich sofort eine Vielzahl von Anfragen an einen externen Dienst an. </li><li>  Beobachten Sie alle n Minuten Körbe, die sich vor nicht mehr als einer Stunde geändert haben.  Dann schicken wir sie zum MCH.  Es gibt nur ein Problem - den Überblick über die Körbe zu behalten, die nach dem Besuch des MCH wieder aufgenommen wurden. </li></ol><br>  Zuerst fordern wir in unserer Datenbank (im Folgenden als DB bezeichnet) unsere Daten in einem Fenster von 1 Stunde bis 3 an. Warum 3?  Eine Stunde nach der letzten Änderung senden wir den Warenkorb an das System.  Im MCH beträgt das minimal mögliche Intervall für den Versand des Warenkorbs 1 Stunde.  Daher wird theoretisch nach 2 Stunden ± 5 Minuten ein Brief gesendet.  3 Stunden sind also auch mit einem Spielraum ein Wert. <br><br>  Nachdem wir die Daten aus der Datenbank erhalten haben, stellen wir eine Abrufanforderung an die Adresse / ecommerce / store / {store_id} / carts.  Auf diese Weise erhalten wir alle Körbe, die sich im E-Commerce-System befinden und darauf warten, dass sie an die Reihe kommen (oder bereits gesendet wurden).  Warum brauchen wir das?  Es ist für die Synchronisation mit unseren Daten notwendig.  Wir senden alle aus der Datenbank empfangenen Körbe, müssen jedoch diejenigen löschen, die nicht mehr im Bereich von 1 bis 3 Stunden liegen.  Nach 3x - schon irrelevante Daten.  Bis zu einer Stunde - Körbe, die erneut erneuert oder bestellt werden können. <br><br>  Zum Löschen müssen wir nur den Unterschied zwischen den beiden Arrays / Sammlungen von Körben finden. <br>  Nach Erhalt der Körbe, die gelöscht werden müssen, senden wir eine Löschanforderung / ecommerce / store / {store_id} / carts / {cart_id}. <br><br>  Als nächstes nehmen wir die Körbe zum Download und senden sie per Post-Anfragen in einem Zyklus an das System. <br><br>  Die Korbparameter sehen ungefähr so ​​aus: <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> ? //***.Ru/cart/abandoned/ Warenkorb = eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0% 253D', <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1207'</span></span>, <span class="hljs-string"><span class="hljs-string">'customer'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'25'</span></span>, <span class="hljs-string"><span class="hljs-string">'email_address'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'email@example.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'opt_in_status'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, ], <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'RUB'</span></span>, <span class="hljs-string"><span class="hljs-string">'order_total'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1597</span></span>, <span class="hljs-string"><span class="hljs-string">'checkout_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'http://***.ru/cart/abandoned/?cart=eyJpdGVtcyI6eyI1OTgwIjoxLCIzNDA0IjoxLCI3NzMiOjEsIjkwNTgiOjEsIjkwOTEiOjEsIjE4ODciOjEsIjc4NCI6MSwiNTExMSI6MSwiODA1MyI6MSwiMTk0MSI6MSwiNTQ0NSI6MSwiNzk1NCI6MywiOTA2NyI6NCwiOTA2NSI6NCwiNzg0MyI6MSwiOTA2NiI6M30sInByb21vY29kZSI6bnVsbH0%253D'</span></span>, <span class="hljs-string"><span class="hljs-string">'lines'</span></span> =&gt; [ <span class="hljs-number"><span class="hljs-number">0</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'5980'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">841</span></span>, ], <span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'124'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'product_variant_id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3404'</span></span>, <span class="hljs-string"><span class="hljs-string">'quantity'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">756</span></span>, ], ], ]</code> </pre><br>  Und wieder ist unsere Lieblingsrubrik "rate mal, wie diese Felder funktionieren".  Beispielsweise wurde durch die Methode des wissenschaftlichen Stocherns festgestellt, dass Sie keinen Käufer mit einer separaten Anfrage erstellen können.  Es ist erforderlich, den minimal erforderlichen Satz von Feldern zu übertragen, und dieser wird automatisch erstellt, wenn er nicht im System vorhanden war.  In unserem Fall haben wir uns auf id, email, opt_in_status beschränkt.  Der letzte Parameter ist für den Status des Benutzerabonnements in unserem Blatt verantwortlich.  Wenn es wahr ist, bedeutet dies, dass der Status abonniert ist, andernfalls transaktional. <br><br>  Die Produktliste wird problemlos über das Cart Lines-Array geladen, das wiederum eine Ressource der Cart-Entität ist.  Das heißt,  Wir können dieses Set separat mit Restanfragen verwalten. <br><br>  Nun, das ist alles, wie es scheint?  Aber nein. <br><br>  Beim Testen haben wir festgestellt, dass derselbe Warenkorb nur einmal gesendet wird.  Obwohl wir es aus dem System entfernt und erneut heruntergeladen haben.  Nichts wird irgendwo gesagt, kein einziges Wort!  Infolgedessen haben wir empirisch mit Hilfe einer Mutter die Hypothese zugrunde gelegt, dass ein Korb mit derselben ID nur einmal gesendet werden kann. <br><br>  Hier stimme ich den Erstellern voll und ganz zu, dass diese Einschränkung uns vor Spam-Nutzern bewahrt.  Aber schreib darüber!  Wir brauchen keine Quests, wir haben genug von unseren mystischen Fehlern in dem Code, den wir schreiben. <br><br>  Nachdem wir das alles getan hatten, begann der MCH, uns schöne Briefe über den verlassenen Korb zu schicken.  Und dann erschien eine zweite Frage.  Wenn der Benutzer den Warenkorb geworfen und vom Brief auf sein eigenes Konto zurückgekehrt ist, dh zum Zeitpunkt des Klickens auf den Link autorisiert wurde, wird er problemlos in seinen Warenkorb gelegt.  Und so stellt sich heraus, dass der Brief „on!  Nimm deinen Korb zurück! “und als wir ihn überqueren, sagen wir:„ Ups, etwas ist verloren gegangen!  Wir haben nichts angefasst!  Es ist selbst! " <br><br>  Es wurde beschlossen, die Zusammensetzung des Warenkorbs in eine Zeichenfolge zu kodieren und beim Senden des Warenkorbs an den MCH an checkout_url zu übergeben.  Und wenn Sie auf die Website gehen, fangen Sie diese Zeile, dekodieren Sie und werfen Sie alle Waren in den Warenkorb, ohne zu vergessen, sie vorher vollständig zurückzusetzen. <br><br>  Unabhängig davon, an welchen Browser wir den Benutzer senden, erhält er seinen Warenkorb, wie wir es versprochen haben.  Das einzig Negative ist, dass er sich nur einloggen kann.  Die Autorisierung über einen Link ist jedoch ein schlechtes Benehmen und in der Tat ein gefährliches Geschäft, vor allem für unsere Kunden. <br>  Was ist das Ergebnis?  Grundsätzlich gab es während der Implementierung keine besonderen Probleme, da die MCH-Antworten sehr oft bei Fehlern im Zusammenhang mit der Validierung der übertragenen Felder hilfreich waren.  Aber es würde noch weniger von ihnen geben, wenn sie normalerweise alle diese Feinheiten der Arbeit des MCH menschlich beschreiben und die Felder detaillierter beschreiben würden. <br><br><h2>  Berichtseinrichtung in Google.Analytics </h2><br>  Um den Erfolg des gesamten Vorgangs zu verfolgen, müssen Sie den Bericht in Analytics konfigurieren und regelmäßig anzeigen.  Stellen Sie sich vor, jeder hat wie Erwachsene E-Commerce verbunden, sonst funktioniert ein Wunder nicht :) <br><br>  Um einen neuen Bericht für einen verlassenen Warenkorb zu sammeln, gehen Sie zu "Meine Berichte": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/afe/749/f87/afe749f87d1c6bd4e5a0810dab40b4ef.jpg" alt="Meine Berichte"><br><br>  Weiter "Bericht hinzufügen": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/288/8bd/ba2/2888bdba2a5749ccc90c88c3f5c80f49.jpg" alt="Bericht hinzufügen"><br><br>  Danach fügen wir die Parameter hinzu, die wir verfolgen werden.  Wir haben beschlossen, den verlassenen Korb im Kontext von Städten zu betrachten. Vielleicht haben Sie eine andere Vision. <br><br>  Für einen Mailchamp lautet die Standardkampagne für einen verlassenen Warenkorb ABANDONED_CART_EMAIL. Wir ersetzen ihn im Filter und erhalten einen Bericht. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ca0/a77/b25/ca0a77b256b42242851ceaed308e02c7.jpg" alt="Bild"><br><br>  Das sind alles Gabeln! <br><br>  Jetzt sind Sie so konfiguriert, dass Sie den verlassenen Korb und einen Bericht senden, anhand dessen Sie den Auspuff von dort aus beobachten können.  Und testen, testen, testen!  ;) </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de421393/">https://habr.com/ru/post/de421393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de421383/index.html">Epic Growth Conference Herbst 2018 - Produktmarketingkonferenz in Moskau</a></li>
<li><a href="../de421385/index.html">Lerne OpenGL. Lektion 5.10 - Umgebungsokklusion des Bildschirmbereichs</a></li>
<li><a href="../de421387/index.html">Interview mit Lennart Pottering über Linux Piter über Änderungen in Linux, über systemd und warum Sie an Konferenzen teilnehmen</a></li>
<li><a href="../de421389/index.html">Gewaltenteilung in Zimbra</a></li>
<li><a href="../de421391/index.html">HackThings - ein großer Hackathon im Internet der Dinge vom 7. bis 9. September in Skoltech</a></li>
<li><a href="../de421395/index.html">Bericht des Club of Rome 2018, Kapitel 3.7: „Klima: gute Nachrichten, aber große Probleme“</a></li>
<li><a href="../de421397/index.html">Starten Sie den Mini AI Cup # 3. Maschinenkampf auf engstem Raum</a></li>
<li><a href="../de421399/index.html">Turla Cybergroup Outlook Backdoor-Analyse</a></li>
<li><a href="../de421401/index.html">Anatomie von Empfehlungssystemen. Teil zwei</a></li>
<li><a href="../de421403/index.html">Sicherheitswoche 32: Fortnite-Android-Drama</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>