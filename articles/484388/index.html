<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💽 🙅🏿 💃 VVVVVV ??? VVVVVV !!! :) 🤦🏼 ☸️ 👍🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Si estás leyendo este texto, has pensado que algo andaba mal con el titular o has visto el nombre de un juego de computadora familiar. VVVVVV es un ju...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>VVVVVV ??? VVVVVV !!! :)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/484388/">  Si estás leyendo este texto, has pensado que algo andaba mal con el titular o has visto el nombre de un juego de computadora familiar.  VVVVVV es un juego de plataformas independiente que ha robado los corazones de muchos jugadores por su simplicidad externa agradable y complejidad interna no menos agradable.  Hace unos días, VVVVVV cumplió 10 años, y el autor del juego, Terry Cavanagh, celebró estas vacaciones publicando su código fuente.  ¿Qué cosas alucinantes esconde?  Lee la respuesta en este artículo. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0c8/fdf/72a/0c8fdf72ab45ed2077f8ea957e6b7ea5.png" alt="Figura 1"></div><a name="habracut"></a><br><h2>  Introduccion </h2><br>  Oh, VVVVVV ... Recuerdo haberlo encontrado poco después del lanzamiento y ser un gran fanático de los juegos retro de píxeles, estaba tan emocionado de instalarlo en mi computadora.  Recuerdo mis primeras impresiones: "¿Eso es todo?  ¿Solo corriendo por las habitaciones cuadradas? Pensé después de unos minutos de jugar.  No sabía lo que me esperaba en ese momento.  Tan pronto como salí de la ubicación inicial, me encontré en un mundo bidimensional pequeño pero confuso y florido lleno de paisajes inusuales y artefactos de píxeles desconocidos para mí. <br><br>  Me dejé llevar por el juego.  Eventualmente, vencí por completo el juego a pesar de algunos desafíos, como la alta complejidad con el control del juego aplicado hábilmente, por ejemplo: el personaje principal no puede saltar, pero puede invertir la dirección del vector de gravedad sobre sí mismo.  No tengo idea de cuántas veces murió mi personaje, pero estoy seguro de que la cantidad de muertes se mide en decenas de cientos.  Después de todo, cada juego tiene su propio entusiasmo único :) <br><br>  De todos modos, volvamos al código fuente, publicado <a href="http://distractionware.com/blog/2020/01/vvvvvv-is-now-open-source/">en honor del aniversario del juego</a> . <br><br>  Por el momento, soy desarrollador del PVS-Studio, que es un analizador de código estático para C, C ++, C # y Java.  Además de desarrollar directamente, también estamos comprometidos con nuestra promoción de productos.  Para nosotros, una de las mejores formas de hacerlo es escribir artículos sobre la verificación de proyectos de código abierto.  Nuestros lectores obtienen artículos interesantes sobre temas de programación, y tenemos la oportunidad de demostrar las capacidades de PVS-Studio.  Entonces, cuando escuché sobre la apertura del código fuente VVVVVV, simplemente no pude pasarlo. <br><br>  En este artículo, veremos algunos errores interesantes encontrados por el analizador PVS-Studio en el código VVVVVV, y veremos en detalle estos errores.  Apunte el vector de gravedad hacia abajo y póngase cómodo: ¡estamos a punto de comenzar! <br><br><h2>  Descripción general de las advertencias del analizador </h2><br><h3>  Advertencia 1 </h3><br>  <a href="https://www.viva64.com/en/w/v512/">V512</a> Una llamada de la función 'sprintf' provocará el desbordamiento del búfer 'fileSearch'.  FileSystemUtils.cpp 307 <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_PATH 260 .... void PLATFORM_migrateSaveData(char *output) { char oldLocation[MAX_PATH]; char newLocation[MAX_PATH]; char oldDirectory[MAX_PATH]; char fileSearch[MAX_PATH]; .... </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Same place, different layout. */</span></span></span><span class="hljs-meta"> strcpy(oldDirectory, output); sprintf(fileSearch, </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"%s\\*.vvvvvv"</span></span></span><span class="hljs-meta">, oldDirectory); .... }</span></span></code> </pre> <br>  Como puede ver, las cadenas <i>fileSearch</i> y <i>oldDirectory</i> son del mismo tamaño: 260 caracteres.  Después de escribir el contenido de la cadena <i>oldDirectory</i> en la cadena de formato (el tercer argumento <i>sprintf</i> ), se verá así: <br><pre> <code class="cpp hljs">&lt;i&gt;contents_oldDirectory\*.vvvvvv&lt;/i&gt;</code> </pre> <br>  Esta línea es 9 caracteres más larga que el valor original de <i>oldDirectory</i> .  Es esta secuencia de caracteres que se escribirá en <i>fileSearch</i> .  ¿Qué sucede si la longitud de la cadena <i>oldDirectory</i> es superior a 251?  La cadena resultante será más larga de lo que podría contener <i>fileSearch</i> , lo que conducirá a violar los límites de la matriz.  Los datos en la RAM pueden dañarse y el resultado al que dará lugar es una cuestión retórica :) <br><br><h3>  Advertencia 2 </h3><br>  <a href="https://www.viva64.com/en/w/v519/">V519</a> La variable 'fondo' tiene valores asignados dos veces seguidas.  Quizás esto sea un error.  Líneas de verificación: 1367, 1373. Map.cpp 1373 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> mapclass::loadlevel(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>: <span class="hljs-comment"><span class="hljs-comment">//The Warpzone tmap = warplevel.loadlevel(rx, ry, game, obj); fillcontent(tmap); roomname = warplevel.roomname; tileset = 1; background = 3; // &lt;= dwgfx.rcol = warplevel.rcol; dwgfx.backgrounddrawn = false; warpx = warplevel.warpx; warpy = warplevel.warpy; background = 5; // &lt;= if (warpy) background = 4; if (warpx) background = 3; if (warpx &amp;&amp; warpy) background = 5; break; .... }</span></span></code> </pre> <br>  A la misma variable se le asigna un valor dos veces seguidas.  Sin embargo, esta variable no se usa en ningún lugar entre asignaciones.  Lo cual es extraño ... Esta secuencia puede no violar la lógica del programa, pero tales asignaciones en sí mismas indican cierta confusión al escribir código.  Si esto es un error de hecho, solo el autor podrá decirlo con certeza.  Aunque hay ejemplos más vívidos de este error en el código: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Game::loadquick(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"frames"</span></span>) { frames = atoi(pText); frames = <span class="hljs-number"><span class="hljs-number">0</span></span>; } .... }</code> </pre> <br>  En este caso, está claro que un error se esconde en algún lugar, ya sea en lógica o en una asignación redundante.  Tal vez, la segunda línea fue escrita temporalmente para la depuración, y luego quedó olvidada.  En total, PVS-Studio emitió 8 advertencias sobre tales casos. <br><br><h3>  Advertencia 3 </h3><br>  <a href="https://www.viva64.com/en/w/v808/">Se</a> creó el objeto V808 'pKey' del tipo 'basic_string' pero no se utilizó.  editor.cpp 1866 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> editorclass::load(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;_path) { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pElem-&gt;Value())</span></span></span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"edEntities"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (TiXmlElement *edEntityEl = pElem-&gt;FirstChildElement(); edEntityEl; edEntityEl = edEntityEl-&gt;NextSiblingElement()) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pKey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(edEntityEl-&gt;Value())</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= //const char* pText = edEntityEl-&gt;GetText() ; if (edEntityEl-&gt;GetText() != NULL) { edentity[i].scriptname = std::string(edEntityEl-&gt;GetText()); } edEntityEl-&gt;QueryIntAttribute("x", &amp;edentity[i].x); edEntityEl-&gt;QueryIntAttribute("y", &amp;edentity[i].y); edEntityEl-&gt;QueryIntAttribute("t", &amp;edentity[i].t); edEntityEl-&gt;QueryIntAttribute("p1", &amp;edentity[i].p1); edEntityEl-&gt;QueryIntAttribute("p2", &amp;edentity[i].p2); edEntityEl-&gt;QueryIntAttribute("p3", &amp;edentity[i].p3); edEntityEl-&gt;QueryIntAttribute("p4", &amp;edentity[i].p4); edEntityEl-&gt;QueryIntAttribute("p5", &amp;edentity[i].p5); edEntityEl-&gt;QueryIntAttribute("p6", &amp;edentity[i].p6); i++; } EditorData::GetInstance().numedentities = i; } .... }</span></span></code> </pre> <br>  Este código es muy extraño.  El analizador advierte sobre la variable creada pero no utilizada <i>pKey</i> , pero en realidad, el problema era más interesante.  Destaqué intencionalmente que la línea activó la advertencia con una flecha, ya que esta función contiene más de una definición de cadena con el nombre <i>pKey</i> .  Así es, otra de esas variables se declara dentro del ciclo <i>for</i> .  Se superpone al que se declara fuera del bucle. <br><br>  Por lo tanto, si hace referencia al valor de la cadena <i>pKey</i> fuera del bucle <i>for</i> , obtendrá el valor igual a <i>pElem-&gt; Value ()</i> , pero al hacer lo mismo dentro del bucle, obtendrá el valor igual a <i>edEntityEl -&gt; Valor ()</i> .  La superposición de nombres es un error bastante aproximado, que puede ser muy difícil de encontrar por su cuenta durante la revisión del código. <br><br><h3>  Advertencia 4 </h3><br>  <a href="https://www.viva64.com/en/w/v805/">V805</a> Disminución del rendimiento.  Es ineficiente identificar una cadena vacía usando la construcción 'strlen (str)&gt; 0'.  Una forma más eficiente es verificar: str [0]! = '\ 0'.  physfs.c 1604 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *prefDir = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PHYSFS_getPrefDir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *org, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *app)</span></span></span><span class="hljs-function"> </span></span>{ .... assert(<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(prefDir) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); ... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prefDir; } <span class="hljs-comment"><span class="hljs-comment">/* PHYSFS_getPrefDir */</span></span></code> </pre> <br>  El analizador encontró un fragmento para una potencial micro optimización.  Utiliza la función <i>strlen</i> para verificar si la cadena está vacía.  Esta función atraviesa todos los elementos de cadena y comprueba cada uno de ellos para un terminador nulo ('\ 0').  Si obtenemos una cadena larga, cada carácter se comparará con un terminador nulo. <br><br>  ¡Pero solo necesitamos verificar que la cadena esté vacía!  Todo lo que necesita hacer es averiguar si el primer carácter de cadena es un terminal nulo.  Por lo tanto, para optimizar esta verificación dentro de la afirmación, vale la pena escribir: <br><br><pre> <code class="cpp hljs">str[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-string"><span class="hljs-string">'\0'</span></span></code> </pre> <br>  Esa es la recomendación que nos da el analizador.  Claro, la llamada de la función strlen está en condición de la macro de aserción, por lo tanto, solo se ejecutará en la versión de depuración, donde la velocidad no es tan importante.  En la versión de lanzamiento, la llamada de la función y el código se ejecutarán rápidamente.  A pesar de esto, quería demostrar lo que nuestro analizador puede sugerir en términos de micro optimizaciones. <br><br><h3>  Advertencia 5 </h3><br>  Para demostrar la esencia de otro error, tengo que citar dos fragmentos de código aquí: la declaración de clase <i>entclass</i> y su constructor.  Comencemos con la declaración: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entclass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: entclass(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">outside</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-comment"><span class="hljs-comment">//Fundamentals bool active, invis; int type, size, tile, rule; int state, statedelay; int behave, animate; float para; int life, colour; //Position and velocity int oldxp, oldyp; float ax, ay, vx, vy; int cx, cy, w, h; float newxp, newyp; bool isplatform; int x1, y1, x2, y2; //Collision Rules int onentity; bool harmful; int onwall, onxwall, onywall; //Platforming specific bool jumping; bool gravity; int onground, onroof; int jumpframe; //Animation int framedelay, drawframe, walkingframe, dir, actionframe; int yp; int xp; };</span></span></code> </pre> <br>  Este constructor de clase tiene el siguiente aspecto: <br><br><pre> <code class="cpp hljs">entclass::entclass() { clear(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> entclass::clear() { <span class="hljs-comment"><span class="hljs-comment">// Set all values to a default, // required for creating a new entity active = false; invis = false; type = 0; size = 0; tile = 0; rule = 0; state = 0; statedelay = 0; life = 0; colour = 0; para = 0; behave = 0; animate = 0; xp = 0; yp = 0; ax = 0; ay = 0; vx = 0; vy = 0; w = 16; h = 16; cx = 0; cy = 0; newxp = 0; newyp = 0; x1 = 0; y1 = 0; x2 = 320; y2 = 240; jumping = false; gravity = false; onground = 0; onroof = 0; jumpframe = 0; onentity = 0; harmful = false; onwall = 0; onxwall = 0; onywall = 0; isplatform = false; framedelay = 0; drawframe = 0; walkingframe = 0; dir = 0; actionframe = 0; }</span></span></code> </pre> <br>  Muchos campos, ¿no dirías?  No es de extrañar, PVS-Studio emitió una advertencia por un error, escondiéndose aquí: <br><br>  <a href="https://www.viva64.com/en/w/v730/">V730</a> Es posible que no todos los miembros de una clase se inicialicen dentro del constructor.  Considere inspeccionar: oldxp, oldyp.  Ent.cpp 3 <br><br>  Como puede ver, las inicializaciones de dos campos de clase se perdieron en una lista tan larga.  Como resultado, sus valores permanecieron indefinidos, por lo que pueden leerse incorrectamente y usarse en otro lugar del programa.  Es muy difícil detectar tal error simplemente revisando. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/983/5f3/1be/9835f31be343f47654d9dd80fc159472.png" alt="Figura 4"></div><br><br><h3>  Advertencia 6 </h3><br>  Mira este código: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> mapclass::loadlevel(....) { .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; tmap; .... tmap = otherlevel.loadlevel(rx, ry, game, obj); fillcontent(tmap); .... <span class="hljs-comment"><span class="hljs-comment">// The tmap vector gets changed again many times. }</span></span></code> </pre> <br>  Advertencia de PVS-Studio: <a href="https://www.viva64.com/en/w/v688/">V688</a> La variable local 'tmap' posee el mismo nombre que uno de los miembros de la clase, lo que puede generar confusión.  Map.cpp 1192 <br><br>  De hecho, mirando dentro de la clase <i>mapclass</i> , puede encontrar el mismo vector con el mismo nombre allí: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mapclass</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; roomdeaths; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; roomdeathsfinal; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; areamap; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; contents; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; explored; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; vmult; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span> &lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; tmap; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... };</span></span></code> </pre> <br>  Desafortunadamente, la misma declaración de vector de nombre dentro de la función hace que el vector declarado en la clase sea invisible.  Resulta que el vector <i>tmap</i> se cambia solo dentro de la función de nivel de <i>carga</i> .  ¡El vector declarado en la clase sigue siendo el mismo! <br><br>  Curiosamente, PVS-Studio ha encontrado 20 de esos fragmentos de código.  En su mayor parte, se relacionan con variables temporales que se han declarado "por conveniencia" como miembros de la clase.  El autor del juego (y su único desarrollador) escribió sobre sí mismo que solía tener este mal hábito.  Puede leer sobre esto en la publicación: el enlace se encuentra al comienzo del artículo. <br><br>  También señaló que tales nombres condujeron a errores dañinos que eran difíciles de detectar.  Bueno, tales errores pueden ser realmente destructivos, pero atraparlos se vuelve menos difícil si usa análisis estático :) <br><br><h3>  Advertencia 7 </h3><br>  <a href="https://www.viva64.com/en/w/v601/">V601</a> El tipo entero se <a href="https://www.viva64.com/en/w/v601/">convierte</a> implícitamente en el tipo char.  Game.cpp 4997 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Game::loadquick(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"totalflips"</span></span>) { totalflips = atoi(pText); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pKey == <span class="hljs-string"><span class="hljs-string">"hardestroom"</span></span>) { hardestroom = atoi(pText); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } else if (pKey == "hardestroomdeaths") { hardestroomdeaths = atoi(pText); } .... }</span></span></code> </pre> <br>  Para comprender lo que está sucediendo, echemos un vistazo a las definiciones de las variables de la parte del código dada: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//Some stats: int totalflips; std::string hardestroom; int hardestroomdeaths;</span></span></code> </pre> <br>  <i>Las</i> variables <i>totalflips</i> y <i>hardestroomdeaths</i> son enteras, por lo que es perfectamente normal asignarles el resultado de la función <i>atoi</i> .  Pero, ¿qué sucede si asigna un valor entero a <i>std :: string</i> ?  Tal asignación resulta ser válida desde la perspectiva del lenguaje.  Como resultado, ¡se escribirá un valor poco claro en la variable <i>hardestroom</i> ! <br><br><h3>  Advertencia 8 </h3><br>  <a href="https://www.viva64.com/en/w/v1004/">V1004</a> El puntero 'pElem' se usó de forma insegura después de que se verificó contra nullptr.  Líneas de verificación: 1739, 1744. editor.cpp 1744 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> editorclass::load(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;_path) { .... <span class="hljs-function"><span class="hljs-function">TiXmlHandle </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hDoc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;doc)</span></span></span></span>; TiXmlElement *pElem; <span class="hljs-function"><span class="hljs-function">TiXmlHandle </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hRoot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; version = <span class="hljs-number"><span class="hljs-number">0</span></span>; { pElem = hDoc.FirstChildElement().Element(); <span class="hljs-comment"><span class="hljs-comment">// should always have a valid root // but handle gracefully if it does if (!pElem) { printf("No valid root! Corrupt level file?\n"); } pElem-&gt;QueryIntAttribute("version", &amp;version); // &lt;= // save this for later hRoot = TiXmlHandle(pElem); } .... }</span></span></code> </pre> <br>  El analizador advierte que el puntero <i>pElem</i> se usa de forma insegura justo después de verificar <i>nullptr</i> .  Para asegurarnos de que el analizador es correcto, <i>revisemos</i> la definición de la función <i>Element ()</i> que devuelve el valor que, a su vez, inicializa el <i>puntero</i> pElem: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/** @deprecated use ToElement. Return the handle as a TiXmlElement. This may return null. */</span></span> <span class="hljs-function"><span class="hljs-function">TiXmlElement *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Element</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ToElement(); }</code> </pre> <br>  Como podemos ver en el comentario, esta función podría devolver <i>nulo</i> . <br><br>  Ahora imagine que realmente sucedió.  ¿Qué pasará en este caso?  El hecho es que esta situación no se manejará de ninguna manera.  Sí, habrá un mensaje de que algo salió mal, pero el puntero incorrecto se desreferenciará solo una línea debajo.  Dicha desreferencia dará como resultado el bloqueo del programa o un comportamiento indefinido.  Este es un error bastante grave. <br><br><h3>  Advertencia 9 </h3><br>  Este fragmento de código activó cuatro advertencias del analizador PVS-Studio: <br><br><ul><li>  <a href="https://www.viva64.com/en/w/v560/">V560</a> Una parte de la expresión condicional siempre es verdadera: x&gt; = 0. editor.cpp 1137 </li><li>  <a href="https://www.viva64.com/en/w/v560/">V560</a> Una parte de la expresión condicional siempre es verdadera: y&gt; = 0. editor.cpp 1137 </li><li>  <a href="https://www.viva64.com/en/w/v560/">V560</a> Una parte de la expresión condicional siempre es verdadera: x &lt;40. Editor.cpp 1137 </li><li>  <a href="https://www.viva64.com/en/w/v560/">V560</a> Una parte de la expresión condicional siempre es verdadera: y &lt;30. Editor.cpp 1137 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> editorclass::at( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(<span class="hljs-number"><span class="hljs-number">0</span></span>,y); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(y&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(x,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&gt;=<span class="hljs-number"><span class="hljs-number">40</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(<span class="hljs-number"><span class="hljs-number">39</span></span>,y); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(y&gt;=<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> at(x,<span class="hljs-number"><span class="hljs-number">29</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(x&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; y&gt;=<span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; x&lt;<span class="hljs-number"><span class="hljs-number">40</span></span> &amp;&amp; y&lt;<span class="hljs-number"><span class="hljs-number">30</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> contents[x+(levx*<span class="hljs-number"><span class="hljs-number">40</span></span>)+vmult[y+(levy*<span class="hljs-number"><span class="hljs-number">30</span></span>)]]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  Todas las advertencias se refieren a la última declaración <i>if</i> .  El problema es que las cuatro comprobaciones, realizadas en él, siempre devolverán <i>verdadero</i> .  No diría que es un error grave, pero es bastante divertido.  El autor decidió tomar esta función en serio y, por si acaso, volvió a verificar cada variable :) <br><br>  Podría haber eliminado esta verificación, ya que el flujo de ejecución no llegará a la expresión " <i>return 0;</i> " de todos modos.  No cambiará la lógica del programa, pero ayudará a eliminar las verificaciones redundantes y el código muerto. <br><br><h3>  Advertencia 10 </h3><br>  En su artículo sobre el aniversario del juego, Terry notó irónicamente que uno de los elementos que controlaba la lógica del juego era el gran cambio de la función <i>Game :: updatestate ()</i> , responsable de una gran cantidad de estados diferentes del juego al mismo tiempo. .  Y era bastante esperado que encontrara la siguiente advertencia: <br><br>  <a href="https://www.viva64.com/en/w/v2008/">V2008</a> Complejidad ciclomática: 548. Considere refactorizar la función 'Game :: updatestate'.  Game.cpp 612 <br><br>  Sí, lo entendiste bien: PVS-Studio le dio a la función la siguiente calificación de complejidad: 548. ¡Quinientos cuarenta y ocho!  Así es como se ve el "código ordenado".  Y esto a pesar del hecho de que, a excepción de la instrucción switch, no hay casi nada más en la función.  En el cambio en sí, conté más de 300 expresiones de caso. <br><br>  Ya sabes, en nuestra empresa tenemos una pequeña competencia por el artículo más largo.  Me encantaría traer el código de función completo (3,450 líneas) aquí, pero tal victoria sería injusta, por lo que me limitaré al <a href="">enlace</a> al interruptor gigante.  ¡Recomiendo que sigas el enlace y veas su longitud por ti mismo!  Para el caso, además de <i>Game :: updatestate ()</i> , PVS-Studio también ha encontrado 44 funciones con complejidad ciclomática inflada, 10 de las cuales tenían un número de complejidad de más de 200. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ddb/a63/bac/ddba63bac1b88d806adea03d73b70888.png" alt="Figura 5"></div><br><br><h2>  Conclusión </h2><br>  Creo que los errores anteriores son suficientes para este artículo.  Sí, hubo muchos errores en el proyecto, pero es una especie de característica.  Al abrir su código, Terry Cavanagh demostró que no tienes que ser un programador perfecto para escribir un gran juego.  Ahora, 10 años después, Terry recuerda esos momentos con ironía.  Es importante aprender de sus errores, y practicar es la mejor manera de hacerlo.  Y si tu práctica puede dar lugar a un juego como VVVVVV, ¡es simplemente magnífico!  Bueno ... ya es hora de jugarlo una vez más :) <br><br>  Estos no fueron todos los errores encontrados en el código del juego.  Si desea ver por sí mismo qué más se puede encontrar, le sugiero que <a href="https://www.viva64.com/en/pvs-studio-download/">descargue y pruebe PVS-Studio</a> .  Además, no olvide que <a href="https://www.viva64.com/en/b/0614/">ofrecemos</a> proyectos de código abierto con licencias gratuitas. </div></div><p>Source: <a href="https://habr.com/ru/post/484388/">https://habr.com/ru/post/484388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../484376/index.html">Samsung Moscow Center for Artificial Intelligence en historias de empleados</a></li>
<li><a href="../484378/index.html">SwayWM - UnixPorn usted mismo</a></li>
<li><a href="../484380/index.html">Mudanza - el siglo pasado! Alternativas a std :: mover en "C ++ del futuro"</a></li>
<li><a href="../484382/index.html">Algoritmo de Bellman-Ford</a></li>
<li><a href="../484386/index.html">AWS_Ru Meetup en Raiffeisenbank</a></li>
<li><a href="../484390/index.html">Glean Insights acerca de los 18 mejores marcos de Java para usar en 2020</a></li>
<li><a href="../484392/index.html">Convulsiones</a></li>
<li><a href="../484394/index.html">Siete misiones espaciales más emocionantes del próximo año</a></li>
<li><a href="../484396/index.html">Hacer que Windows Server sea más seguro</a></li>
<li><a href="../484402/index.html">Código limpio para TypeScript - Parte 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>