<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöµüèø üíé üë©üèæ‚ÄçüöÄ Arbeiten mit cron f√ºr Android und Hinzuf√ºgen eines Shell-Skripts zum automatischen Ausf√ºhren, wenn das Ger√§t gestartet wird üßîüèª ‚ò£Ô∏è üõ¢Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Aufgrund der Tatsache, dass mobile Ger√§te seit langem √ºber umfangreiche Funktionen verf√ºgen, k√∂nnen Automatisierungsaufgaben problemlos auf diese √ºber...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arbeiten mit cron f√ºr Android und Hinzuf√ºgen eines Shell-Skripts zum automatischen Ausf√ºhren, wenn das Ger√§t gestartet wird</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468337/"><img src="https://habrastorage.org/webt/t2/ia/uo/t2iauogb45suwvzulewv9wbktr8.jpeg"><br><br>  Aufgrund der Tatsache, dass mobile Ger√§te seit langem √ºber umfangreiche Funktionen verf√ºgen, k√∂nnen Automatisierungsaufgaben problemlos auf diese √ºbertragen werden.  Und so gut wie m√∂glich ist cron genauso gut, um sie auszuf√ºhren.  Wenn cron in "normalen" Linux-Systemen etwas Zeit ben√∂tigt, erfordert die Konfiguration eines Android-Ger√§ts kompliziertere Arbeiten. <br><br>  Wenn Sie sich f√ºr das Thema Automatisierung interessieren und m√∂chten, dass Ihre Shell-Skripte sofort nach dem Start des Ger√§ts ausgef√ºhrt werden und sogar mit einem Timer gestartet werden k√∂nnen - willkommen bei der Katze! <br><a name="habracut"></a><br><h2>  Vorwort </h2><br>  Ich besch√§ftige mich mit der Automatisierung von Mobilger√§ten f√ºr Android.  Und w√§hrend der Ausf√ºhrung von automatischen Skripten treten viele unvorhergesehene Situationen auf, selbst wenn dieselben Ger√§te zum Testen verwendet werden. <br><br>  Die beliebtesten Probleme: <br><br>  0. Das Automatisierungsskript macht nicht das, was Sie wollten. <br>  1. Die mobile Anwendung wird automatisch heruntergeladen <br>  2. Automatischer Neustart des Telefons <br>  3. Die mobile Anwendung wird nach einem Neustart nicht automatisch gestartet <br>  4. Das Wi-Fi-Modul wird zuf√§llig ausgeschaltet, findet das Netzwerk nicht und stellt keine Verbindung zum Netzwerk her <br>  5. Das Mobilfunknetz verschwand pl√∂tzlich <br>  6. Das Telefon ging in den Ruhemodus <br>  7. Der Proxy wurde gel√∂scht oder der Server selbst oder der Server hat eine seltsame Antwort zur√ºckgegeben <br><br>  Aus diesem Grund m√ºssen Sie das Ger√§t st√§ndig √ºberwachen und diese unvorhergesehenen Situationen erfassen. <br><br><img src="https://habrastorage.org/webt/93/fb/-1/93fb-1wjpwjs3tcpvv4jzg9b2zw.png"><br><br>  Daher bin ich zu dem Schluss gekommen, dass Sie mit cron mit den "richtigen" Skripten Softwarefehler verfolgen und das Automatisierungsskript wiederherstellen oder erneut ausf√ºhren k√∂nnen.  Aber wie sich herausstellte, gab es, obwohl Android den Linux-Kernel enth√§lt, spezielle Nuancen, mit denen ich mich befassen musste.  Beginnen wir also mit dem Einrichten! <br><br><h2>  Cron-Setup </h2><br><h3>  Passen Sie die Umgebung an </h3><br><ol><li>  Installieren Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">adb</a> , um √ºber die Shell mit einem USB- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kabel</a> auf das Ger√§t zuzugreifen. </li><li>  Wir √∂ffnen den Bereich <b>F√ºr Entwickler</b> .  Gehen Sie dazu zum Abschnitt " <b>√úber Telefon</b> " und klicken Sie ein paar Mal auf die <b>Build-Nummer</b> oder √§hnliches. </li><li>  Wir gehen zum Abschnitt <b>F√ºr Entwickler</b> und aktivieren ihn.  Wir verbinden das Ger√§t mit dem Computer und erlauben auf diesem Computer den Zugriff auf dieses Ger√§t. </li><li>  F√ºgen Sie <b>root</b> f√ºr Ihr Ger√§t hinzu.  Die h√§ufigsten Optionen sind <b>SuperSu</b> , <b>Magisk</b> und <b>Kingroot</b> .  Gehen Sie zu w3bsit3-dns.com und suchen Sie die Root-Option f√ºr Ihr Ger√§t.  Leider gibt es keine universelle Wurzel. </li><li>  Wir installieren <b>BusyBox</b> (es ist zum Beispiel auch auf w3bsit3-dns.com), da es nur ein Cron-Programm enth√§lt. </li></ol><br><h3>  Manuelle Starteinstellung </h3><br><ol><li>  Wir stellen √ºber die <b>ADB-Shell eine</b> Verbindung zum Telefon her (wenn ADB nicht in Ihrer Umgebungsvariablen registriert ist, f√ºgen Sie den vollst√§ndigen Pfad hinzu. </li><li>  Wechseln Sie mit dem Befehl <b>su</b> in den Root-Modus </li><li>  Wir √ºberpr√ºfen das Vorhandensein des Cron-Programms und sehen die Einstellungen mit dem Befehl <b>crond -h</b> </li></ol><br><div class="spoiler">  <b class="spoiler_title">Ausf√ºhrungsergebnis</b> <div class="spoiler_text"><pre><code class="bash hljs">crond: invalid option -- h BusyBox v1.29.2-Stericson (2018-08-12 11:19:12 EDT) multi-call binary. Usage: crond -fbS -l N -d N -L LOGFILE -c DIR -f Foreground -b Background (default) -S Log to syslog (default) -l N Set <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level. Most verbose 0, default 8 -d N Set <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> to stderr -L FILE Log to FILE -c DIR Cron dir. Default:/var/spool/cron/crontabs</code> </pre> <br></div></div><br>  Wie Sie in der letzten Zeile sehen k√∂nnen, sollten die Standardanweisungen im Verzeichnis <b>/ var / spool / cron / crontabs gespeichert werden</b> , das nicht automatisch erstellt wird und wenn wir den Befehl ausf√ºhren <pre> <code class="bash hljs">crond -b</code> </pre>  und √ºberpr√ºfen Sie dann, ob der Prozess gestartet wurde <pre> <code class="bash hljs">ps | grep crond</code> </pre>  , dann kann es nicht da sein, weil  er konnte keine Anweisungen bekommen.  F√ºhren wir also den Befehl aus <pre> <code class="bash hljs">crond -b -fd0</code> </pre>  und sehen, was der Grund ist.  H√∂chstwahrscheinlich haben Sie einen √§hnlichen Fehler: <br>  <code>crond: can't change directory to '/var/spool/cron/crontabs': No such file or directory</code> .  In diesem Fall ist dies normal, weil  In Zukunft werden wir selbst den Pfad zur ausf√ºhrbaren Datei von crontab angeben. <br><br>  4. Erstellen Sie eine einfache Crontab-Datei: <br><br><pre> <code class="bash hljs">mkdir /data/crontab <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*/1 * * * * echo 'text' &gt;&gt; /sdcard/test.txt"</span></span> &gt; /data/crontab/root</code> </pre> <br>  Jetzt haben wir eine Aufgabe, bei der jede Minute das Wort <i>Text</i> zur Datei <b>/sdcard/test.txt hinzugef√ºgt wird</b> <br>  Wir starten: <pre> <code class="bash hljs">crond -b -fd0 -c /data/crontab</code> </pre>  und erhalten Sie das folgende Protokoll: <br><br><pre> <code class="bash hljs">crond: crond (busybox 1.29.2-Stericson) started, <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> level 0 crond: ignoring file <span class="hljs-string"><span class="hljs-string">'root'</span></span> (no such user) ...</code> </pre> <br>  Es ist nat√ºrlich ein wenig √ºberraschend, denn wenn wir den <b>whoami-Befehl</b> ausf√ºhren <b>,</b> wird als Ergebnis <b>root zur√ºckgegeben</b> . <br><br>  5. F√ºgen Sie den Root-Benutzer hinzu, da crond fragt: <br><br><pre> <code class="bash hljs">mount -o remount,rw /system; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"root:x:0:0::/system/etc/crontabs:/system/bin/sh"</span></span> &gt;&gt; /system/etc/passwd; mount -o remount,ro /system;</code> </pre> <br>  Aufgrund des Fehlens dieser Datei wurde mir klar, dass sie im Android-System √ºberhaupt nicht beteiligt ist.  Wenn Sie sicher sind, wo Sie Ihre Crontab-Dateien speichern werden, k√∂nnen Sie die Zeile <b>/ system / etc / crontabs</b> durch die ben√∂tigte ersetzen.  F√ºhren Sie den Befehl erneut aus <br><br><pre> <code class="bash hljs">crond -b -fd0 -c /data/crontab</code> </pre> <br>  Und wir bekommen folgendes: <br><br><pre> <code class="bash hljs">crond: user:root entry:*/1 * * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt 111111111111111111111111111111111111111111111111111111111111 111111111111111111111111 11111111111111111111111111111111 111111111111 1111111 crond: wakeup dt=16 crond: file root: crond: line <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: job: 0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: can<span class="hljs-string"><span class="hljs-string">'t change directory to '</span></span>/system/etc/crontabs<span class="hljs-string"><span class="hljs-string">' crond: can'</span></span>t change directory to <span class="hljs-string"><span class="hljs-string">'/var/spool/cron'</span></span>: No such file or directory crond: USER root pid 12849 cmd <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt</code> </pre> <br>  Laut Protokoll wurde die Aufgabe zwar in crond registriert, aber in meinem Fall wurde die Datei nicht erstellt.  Das Problem kann sehr einfach gel√∂st werden: <br><br><pre> <code class="bash hljs">mkdir -p /system/etc/crontabs</code> </pre> <br>  Nun, er m√∂chte, dass dort ein Verzeichnis existiert. Wen sollen wir ihm verbieten?  Wir fangen wieder an und sehen: <br><br><pre> <code class="bash hljs">crond: user:root entry:*/1 * * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt 111111111111111111111111111111111111111111111111111111111111 111111111111111111111111 11111111111111111111111111111111 111111111111 1111111 crond: wakeup dt=12 crond: file root: crond: line <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: job: 0 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt crond: child running /system/bin/sh crond: USER root pid 13033 cmd <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'text'</span></span> &gt;&gt; /sdcard/test.txt</code> </pre> <br>  Die Fehler gingen weg und die Zeile <b>crond: child running / system / bin / sh erschien</b> .  Schlie√ülich wurde cron erfolgreich abgewickelt und Sie k√∂nnen mit dem zweiten Teil fortfahren! <br><br><h2>  Automatischer Shell-Skript-Download </h2><br>  Das Linux-System verf√ºgt √ºber ein Verzeichnis <b>init.d</b> , das unmittelbar nach dem Systemstart f√ºr den Autostart verantwortlich ist. Versuchen wir es also auf diese Weise! <br><br>  1. √úberpr√ºfen Sie, ob dieses Verzeichnis auf Ihrem Ger√§t vorhanden ist (dies ist <b>/etc/init.d</b> oder <b>/system/etc/init.d</b> - dies ist dieselbe gemountete Partition usw.).  In meinem Fall ist es nicht.  Nun, dann erstellen Sie: <br><br><pre> <code class="bash hljs">mount -o remount,rw /system mkdir /system/etc/init.d chmod 0755 /system/etc/init.d mount -o remount,ro /system</code> </pre> <br>  F√ºgen Sie dort nun ein einfaches Skript hinzu, zum Beispiel: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"echo 'Init.d is working !!!' &gt;&gt; /sdcard/init_test.log"</span></span> &gt; /system/etc/init.d/90my_script chmod 777 /system/etc/init.d/90my_script</code> </pre> <br>  Wir starten das Ger√§t neu und sehen, ob ein Wunder passiert ist ... Leider wurde meine Datei nicht angezeigt. <br><br>  Wir untersuchen das System weiter und suchen nach einer Init-Datei, die nach dem Start Skripte ausf√ºhren kann.  Ich hatte eine Datei in <b>/init.rc</b> auf meinem Ger√§t.  Versuchen wir es zu √§ndern und das Ger√§t neu zu starten: <br><br><pre> <code class="bash hljs">mount -o remount,rw / <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"echo 'Init.d is working !!!' &gt;&gt; /sdcard/init_test.log"</span></span> &gt;&gt; /init.rc mount -o remount,ro / reboot</code> </pre> <br>  Die Datei wurde jedoch nicht erneut erstellt.  Wir schauen uns die Datei <b>/init.rc an</b> und unser Datensatz ist verschwunden und die Datei schien sich nicht zu √§ndern, weil  Das Erstellungsdatum ist ziemlich seltsam (in meinem Fall 1. Januar 70, 05:00:00 Uhr). <br><br>  Wir verstehen weiterhin, und es stellt sich heraus, dass diese Datei in <b>boot.img</b> gespeichert ist und jedes Mal, wenn sie herauskommt.  Und um die Funktionalit√§t der Datei <b>init.rc</b> zu √§ndern, <b>m√ºssen Sie</b> dies alles tun. <br><br>  Es gibt jedoch einen einfacheren Weg, um dieses Problem zu l√∂sen.  F√ºr diese Methode k√∂nnen wir das folgende Shell-Skript verwenden (sagen wir danke an Ryuinferno): <br><br><div class="spoiler">  <b class="spoiler_title">Shell-Skript</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/system/bin/sh #Script to enable init.d by Ryuinferno @ XDA error_msg(){ echo "You do not need this mod..." sleep 1 echo "If you are reapplying, please delete these files if present:" echo "/system/bin/sysinit" sleep 1 echo "/system/etc/install-recovery.sh" sleep 1 echo "/system/etc/install-recovery-2.sh" sleep 1 echo "And run again..." sleep 1 echo "If init.d is still not working, read the FAQ part in my thread..." sleep 1 echo "Aborting..." mount -o remount,ro -t auto /system echo "" echo "Ryuinferno @ XDA" exit 1 } echo "Init.d Enabler by Ryuinferno @ XDA" echo "" sleep 1 id=`id`; id=`echo ${id#*=}`; id=`echo ${id%%\(*}`; id=`echo ${id%% *}` if [ "$id" != "0" ] &amp;&amp; [ "$id" != "root" ]; then echo "Script NOT running as root!" sleep 1 echo "Superuser access not granted!" sleep 1 echo "Please type 'su' first before running this script..." exit 1 else echo "Hello Supaa User! :P" echo "" sleep 1 fi if [ ! "'which busybox'" ]; then echo "busybox NOT INSTALLED!" sleep 1 echo "Please install busybox first!" exit 1 else echo "busybox found!" sleep 1 fi bbb=0 if [ ! "`which grep`" ]; then bbb=1 echo "grep applet NOT FOUND!" sleep 1 else echo "Awesome! grep found! :D" sleep 1 fi if [ ! "`which run-parts`" ]; then bbb=1 echo "run-parts applet NOT FOUND!" sleep 1 else echo "Good! run-parts found! :)" echo "" sleep 1 fi if [ $bbb -eq 1 ] ; then echo "" echo "Required applets are NOT FOUND!" echo "" sleep 1 echo "Please reinstall busybox!" exit 1 fi echo "Great! Let's proceed..." echo "" sleep 1 echo "Press enter to continue..." read enterKey clear sleep 1 echo "Mounting system as rewritable..." mount -o remount,rw -t auto /system sleep 1 echo "Removing old sysinit file" rm /system/bin/sysinit sleep 1 echo "" echo "Checking for the presence of sysinit in /system/bin..." sleep 1 if [ -e /system/bin/sysinit ]; then echo "sysinit found..." if [ -z "`cat /system/bin/sysinit | grep "init.d"`" ]; then echo "Adding lines to sysinit..." echo "" &gt;&gt; /system/bin/sysinit echo "# init.d support" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit echo "export PATH=/sbin:/system/sbin:/system/bin:/system/xbin" &gt;&gt; /system/bin/sysinit echo "run-parts /system/etc/init.d" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit else echo "" echo "Your sysinit should already be running the scripts in init.d folder at boot..." error_msg fi else echo "sysinit not found, creating file..." echo "#!/system/bin/sh" &gt; /system/bin/sysinit echo "# init.d support" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit echo "export PATH=/sbin:/system/sbin:/system/bin:/system/xbin" &gt;&gt; /system/bin/sysinit echo "run-parts /system/etc/init.d" &gt;&gt; /system/bin/sysinit echo "" &gt;&gt; /system/bin/sysinit fi sleep 1 echo "Setting correct permissions and ownership for sysinit..." chmod 755 /system/bin/sysinit chown 0.2000 /system/bin/sysinit sleep 1 echo "" echo "Checking for the presence of install-recovery.sh..." sleep 1 if [ -f /system/etc/install-recovery.sh ] &amp;&amp; [ -z "`cat /system/etc/install-recovery.sh | grep "daemon"`" ]; then if [ ! -z "`cat /system/etc/install-recovery.sh | grep "init.d"`" ];then echo "Your install-recovery.sh seems to be already modified for init.d..." error_msg fi echo "install-recovery.sh found, renaming it as install-recovery-2.sh..." mv /system/etc/install-recovery.sh /system/etc/install-recovery-2.sh echo "Recreating install-recovery.sh..." echo "#!/system/bin/sh" &gt; /system/etc/install-recovery.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "# excecuting extra commands" &gt;&gt; /system/etc/install-recovery.sh echo "/system/etc/install-recovery-2.sh" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh elif [ -f /system/etc/install-recovery.sh ] &amp;&amp; [ ! -z "`cat /system/etc/install-recovery.sh | grep "daemon"`" ]; then if [ -f /system/etc/install-recovery-2.sh ] &amp;&amp; [ ! -z "`cat /system/etc/install-recovery-2.sh | grep "init.d"`" ];then echo "Your install-recovery-2.sh seems to be already modified for init.d..." error_msg fi echo "install-recovery.sh is used for superuser, using install-recovery-2.sh instead..." if [ -f /system/etc/install-recovery-2.sh ]; then echo "" &gt;&gt; /system/etc/install-recovery-2.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery-2.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh else echo "#!/system/bin/sh" &gt; /system/etc/install-recovery-2.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery-2.sh echo "" &gt;&gt; /system/etc/install-recovery-2.sh fi if [ -z "`cat /system/etc/install-recovery.sh | grep "install-recovery-2.sh"`" ]; then echo "" &gt;&gt; /system/etc/install-recovery.sh echo "# extra commands" &gt;&gt; /system/etc/install-recovery.sh echo "/system/etc/install-recovery-2.sh" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh fi else echo "install-recovery.sh not found, creating it..." echo "#!/system/bin/sh" &gt; /system/etc/install-recovery.sh echo "# init.d support" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh echo "/system/bin/sysinit" &gt;&gt; /system/etc/install-recovery.sh echo "" &gt;&gt; /system/etc/install-recovery.sh fi sleep 1 echo "Setting the correct permissions and ownership for install-recovery.sh..." echo "Also for install-recovery-2.sh if it exists..." chmod 755 /system/etc/install-recovery.sh chown 0.0 /system/etc/install-recovery.sh if [ -f /system/etc/install-recovery-2.sh ]; then chmod 755 /system/etc/install-recovery-2.sh chown 0.0 /system/etc/install-recovery-2.sh fi sleep 1 echo "" echo "Checking for the presence of the init.d folder..." sleep 1 if [ -d /system/etc/init.d ]; then echo "init.d folder found..." else echo "init.d folder not found, creating the folder..." mkdir /system/etc/init.d fi sleep 1 echo "" echo "Creating basic init.d scripts..." echo "#!/system/bin/sh" &gt; /system/etc/init.d/08setperm echo "#set correct permissions to /system/etc/init.d folder" &gt;&gt; /system/etc/init.d/08setperm echo "" &gt;&gt; /system/etc/init.d/08setperm echo "mount -o remount,rw -t auto /system" &gt;&gt; /system/etc/init.d/08setperm echo "chmod -R 777 /system/etc/init.d" &gt;&gt; /system/etc/init.d/08setperm echo "mount -o remount,ro -t auto /system" &gt;&gt; /system/etc/init.d/08setperm echo "" &gt;&gt; /system/etc/init.d/08setperm echo "#!/system/bin/sh" &gt; /system/etc/init.d/00test echo "#init.d test" &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test echo "if [ -f /data/Test.log ]; then" &gt;&gt; /system/etc/init.d/00test echo "rm /data/Test.log" &gt;&gt; /system/etc/init.d/00test echo "fi" &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test echo 'echo "Init.d is working !!!" &gt;&gt; /data/Test.log' &gt;&gt; /system/etc/init.d/00test echo 'echo "excecuted on $(date +"%d-%m-%Y %r" )" &gt;&gt; /data/Test.log' &gt;&gt; /system/etc/init.d/00test echo "" &gt;&gt; /system/etc/init.d/00test sleep 1 echo "Creating permissive SELinux script..." sleep 1 echo "#!/system/bin/sh" &gt;&gt; /system/etc/init.d/01permissive echo "#Init.d Permissive SELinux" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive echo "busybox mount -o remount,rw -t auto /system" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive echo "setenforce 0" &gt;&gt; /system/etc/init.d/01permissive echo "SELINUX=permissive" &gt;&gt; /system/etc/init.d/01permissive echo "" &gt;&gt; /system/etc/init.d/01permissive sleep 1 echo "Setting correct permissions and ownership for init.d folder and scipts..." chmod 777 /system/etc/init.d chmod 777 /system/etc/init.d/08setperm chmod 777 /system/etc/init.d/00test chmod 777 /system/etc/init.d/01permissive chown 0.0 /system/etc/init.d chown 0.0 /system/etc/init.d/08setperm chown 0.0 /system/etc/init.d/00test chown 0.0 /system/etc/init.d/01permissive sleep 1 echo "" echo "Mounting system as read-only..." mount -o remount,ro -t auto /system sleep 1 echo "" echo "Done!!!" sleep 1 echo "Please reboot at least twice before checking /data..." sleep 1 echo "If init.d is working, you will see a Test.log in /data..." sleep 1 echo "" echo "Enjoy!!! =)" echo "Ryuinferno @ XDA 2013" exit</span></span></code> </pre><br></div></div><br>  Erste Schritte mit dem Skript!  In meinem Fall hei√üt es init.sh. <br>  1. Laden Sie die Datei auf die SD-Karte des Mobilger√§ts herunter: <br><pre> <code class="bash hljs">adb push /tmp/init.sh /sdcard</code> </pre> <br>  2. Kopieren Sie in den Speicher des Mobilger√§ts und legen Sie die erforderlichen Rechte fest: <br><pre> <code class="bash hljs">adb shell su cp /sdcard/init.sh /data/init.sh chmod 777 /data/init.sh</code> </pre> <br>  3. Zur Ausf√ºhrung ausf√ºhren: <br><pre> <code class="bash hljs">/data/init.sh</code> </pre> <br>  Und achten Sie auf das angezeigte Protokoll.  Hier ist mein Log: <br><div class="spoiler">  <b class="spoiler_title">F√ºhren Sie das Protokoll aus</b> <div class="spoiler_text"><pre> <code class="bash hljs">Init.d Enabler by Ryuinferno @ XDA Hello Supaa User! :P busybox found! Awesome! grep found! :D Good! run-parts found! :) Great! Let<span class="hljs-string"><span class="hljs-string">'s proceed... Press enter to continue... Mounting system as rewritable... Removing old sysinit file rm: /system/bin/sysinit: No such file or directory Checking for the presence of sysinit in /system/bin... sysinit not found, creating file... Setting correct permissions and ownership for sysinit... Checking for the presence of install-recovery.sh... install-recovery.sh not found, creating it... Setting the correct permissions and ownership for install-recovery.sh... Also for install-recovery-2.sh if it exists... Checking for the presence of the init.d folder... init.d folder found... Creating basic init.d scripts... Creating permissive SELinux script... Setting correct permissions and ownership for init.d folder and scipts... Mounting system as read-only... Done!!! Please reboot at least twice before checking /data... If init.d is working, you will see a Test.log in /data... Enjoy!!! =) Ryuinferno @ XDA 2013</span></span></code> </pre> <br></div></div><br>  Wie Sie dem Protokoll entnehmen k√∂nnen, gibt es keine Fehler. Sie k√∂nnen das Ger√§t also neu starten!  Vielleicht hat bereits jemand gearbeitet und Sie konnten die Datei <b>/data/Test.log</b> finden, aber ich habe sie nicht.  √úberpr√ºfen Sie das Verzeichnis <b>/system/etc/init.d</b> mit dem <b>Befehl ls</b> : <br><br><pre> <code class="bash hljs">00test 01permissive 08setperm</code> </pre> <br>  Wie Sie sehen, wurden die Aufgaben erfolgreich erstellt.  M√∂glicherweise m√ºssen Sie noch <b>boot.img</b> √§ndern, aber lassen Sie uns am Anfang √ºberpr√ºfen, wo sich die Datei <b>install-recovery.sh</b> mit dem Befehl befindet <br><br><pre> <code class="bash hljs">find / -name <span class="hljs-string"><span class="hljs-string">"install-recovery.sh"</span></span> ... /system/bin/install-recovery.sh /system/etc/install-recovery.sh ...</code> </pre> <br>  Wie wir sehen k√∂nnen, haben wir 2 Dateien, die an verschiedenen Orten liegen.  Zum Zeitpunkt der Erstellung k√∂nnen wir feststellen, dass das Skript die Datei im Verzeichnis <b>/system/etc/install-recovery.sh erstellt hat</b> , obwohl es in einigen F√§llen m√∂glicherweise in <b>/ system / usw. erstellt werden sollte.</b>  Lassen Sie uns die Datei in bin umbenennen und die Datei von etc kopieren: <br><br><pre> <code class="bash hljs">mount -o remount,rw /system mv /install-recovery.sh /system/bin/install-recovery2.sh cp /install-recovery.sh /system/bin/</code> </pre> <br><br>  <b>UPD</b> : Bitte beachten Sie, dass der Sicherheitskontext f√ºr beide Dateien √ºbereinstimmen muss.  Und wenn Sie beim Kopieren pl√∂tzlich verloren gegangen sind (obwohl dies theoretisch nicht der Fall sein sollte), m√ºssen Sie es wiederherstellen (z. B. √ºber das Dienstprogramm <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">chcon</a> ).  Siehe die vollst√§ndigen <b>Dateiinformationen</b> mit <b>ls -lZ</b> : <br><pre> <code class="bash hljs">ls -lZ /system/etc/install-recovery.sh <span class="hljs-comment"><span class="hljs-comment"># -rwxr-xr-x root root u:object_r:system_file:s0 install-recovery.sh</span></span></code> </pre><br>  Hier ist <b>u: object_r: system_file: s0</b> Sicherheitskontexte. <br><br>  Und wieder starten wir das Ger√§t neu ... Und nun endlich der lang erwartete ERFOLG!  Die Datei <b>/data/Test.log ist</b> erschienen! <br><br>  Wenn alles funktioniert, gehen Sie zu <b>/system/etc/init.d</b> und erstellen Sie ein Shell-Skript.  Und darin f√ºhren Sie einfach unsere Crond aus, um Folgendes auszuf√ºhren: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#!/system/bin/sh crond -b -L /sdcard/error.log -c /data/crontab"</span></span> &gt; /system/etc/init.d/99cronstart chmod 777 /system/etc/init.d/99cronstart reboot</code> </pre> <br>  √úberpr√ºfen Sie nach dem Herunterladen, ob crond gestartet wurde: <br><br><pre> <code class="bash hljs">ps | grep crond root 414 1 9532 236 hrtimer_na 000dcf90 S crond</code> </pre> <br>  Und wir k√∂nnten jetzt enden, aber lassen Sie uns eine Minute warten und sehen, ob unsere Akte eine Aufzeichnung enth√§lt ... Nun, wie Sie bereits verstanden haben, hat wieder nichts funktioniert.  Tatsache ist, dass dieser Prozess von einem Superuser ausgef√ºhrt werden muss.  √Ñndern Sie das Skript in der <b>99cronstart-</b> Datei: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"#!/system/bin/sh /su/bin/su -c crond -b -L /sdcard/error.log -c /data/crontab"</span></span> &gt; /system/etc/init.d/99cronstart reboot</code> </pre> <br><br>  <b>UPD</b> : Vielleicht hat <b>su</b> in Ihrem Fall einen anderen Pfad. Verwenden Sie dann den Befehl <b>su</b> und ersetzen Sie den Pfad durch Ihren. <br><br>  Jetzt unterst√ºtzt unser Android-Ger√§t Cron-Aufgaben und enth√§lt m√∂glicherweise Shell-Skripte f√ºr den automatischen Start! <br><br>  Und schlie√ülich das Skript, mit dem unsere Anwendung ausgef√ºhrt wird, wenn es sich nicht in den Prozessen befindet, und Informationen dar√ºber zu speichern, was vor dem Starten unserer Anwendung auf dem Hauptbildschirm angezeigt wurde: <br><br><pre> <code class="bash hljs">proc=$(ps | grep <span class="hljs-string"><span class="hljs-string">"com.test.app"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$proc</span></span></span><span class="hljs-string">"</span></span> == <span class="hljs-string"><span class="hljs-string">""</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> dumpsys window | grep CurrentFocus &gt; /sdcard/current_focus.dump sleep 1 am start -n com.test.app/com.test.app.activities.MainActivity <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de468337/">https://habr.com/ru/post/de468337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de468323/index.html">Welches Ger√§usch hilft, sich zu konzentrieren und zu entspannen, und verhindert auch H√∂rverlust bei schweren Unf√§llen</a></li>
<li><a href="../de468327/index.html">L√ºcke - eine gl√§nzende Zukunft f√ºr Einr√ºckungen in Flexbox (wie in Grid)</a></li>
<li><a href="../de468329/index.html">A / B-Test ist nicht genug</a></li>
<li><a href="../de468331/index.html">Momente des Lebens von Stephen Wolfram - Sch√∂pfer von Mathematica, Wolfram | Alpha, einer neuen Art von Wissenschaft und vielem mehr</a></li>
<li><a href="../de468333/index.html">So debuggen und profilieren Sie exe-Dateien mit Visual Studio</a></li>
<li><a href="../de468339/index.html">Einf√ºhrung in das Dark Theme f√ºr Visual Studio App Center</a></li>
<li><a href="../de468341/index.html">Azure Cloud Shell auf dem Windows-Terminal</a></li>
<li><a href="../de468343/index.html">Jeff Bezos: "Zum Wohl der Erde in den Weltraum gehen"</a></li>
<li><a href="../de468345/index.html">GitHub startet seine Tentakel im CI / CD- und Artefaktmanagement</a></li>
<li><a href="../de468347/index.html">MetricKit. Leistungsanalyse von iOS-Anwendungen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>