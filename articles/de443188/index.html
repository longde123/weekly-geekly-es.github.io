<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚óºÔ∏è üëµüèª üë©üèø Drei Augen h√§ngen an einer S√§ule oder die Geschichte, dass f√ºnf Beine von ATtiny13 ausreichen ü¶ã üèéÔ∏è üëâüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="KDPV "Oh, das ist es." 


 Es besteht kaum eine Chance, dass dieses Longrid zu einer lebensspendenden Quelle der Weisheit f√ºr Intellektuelle wird, die...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Drei Augen h√§ngen an einer S√§ule oder die Geschichte, dass f√ºnf Beine von ATtiny13 ausreichen</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443188/"><p><img src="https://habrastorage.org/webt/51/tw/-p/51tw-pewtw_nf5txookeohz5qga.jpeg"><br>  <em>KDPV "Oh, das ist es."</em> </p><br><p>  Es besteht kaum eine Chance, dass dieses Longrid zu einer lebensspendenden Quelle der Weisheit f√ºr Intellektuelle wird, die die Geheimnisse der Wahrsagerei auf Carnot-Karten kennen und die geheime Bedeutung der dritten Normalform kennen.  Aber wenn Sie aus irgendeinem Grund Ihr Arduino mit Ihren H√§nden ber√ºhrt haben, ein L√∂tkolben Staub in der Speisekammer sammelt, Sie verstehen, warum die Batterie ein Plus hat und C ++ zwei, dann werden Sie wirklich magische und erstaunliche Wunder nicht gleichg√ºltig lassen.  Daher freue ich mich, Ihnen die Zahlen der heutigen Auff√ºhrung des Vagabundzirkus <abbr title="Dies sind keine Namen von K√ºnstlern, Lehmziegeln aus Zweigen, Ton und anderen Dingen, sondern Buchsbaum - eine Art kostbarer B√§ume.">‚ÄûSaman with Boxwood‚Äú</abbr> empfehlen zu k√∂nnen: </p><br><ul><li>  Hinzuf√ºgen von RAM und ROM zu ATtiny13! </li><li>  K√ºnstliche Intelligenz in einem Mikroprozessor - Pro und Contra oder Dornr√∂schen - ist sie nicht ein Dummkopf? </li><li>  Oder ist es immer noch Dura Lex Sed Lex? </li><li>  Wie f√ºge ich ATtiny13 Beine hinzu? </li><li>  Ein paar Worte zur f√ºnften Dimension: Wie kann man das Unertr√§gliche stopfen? </li><li>  Die H√§lfte der Nicht-Jungfrauen unter Mischen des Inhalts der H√§lften s√§gen (mit der Garantie der Wiederfindung). </li><li>  "F√ºtterung der Betroffenen" (siehe fr√ºheren Fall von f√ºnftausend Menschen, die mit f√ºnf Gerstenbroten und zwei Fischen ges√§ttigt sind). </li></ul><br><p>  Wenn in Zukunft mindestens einer der Tricks f√ºr jeden zwanzigsten Leser n√ºtzlich ist, bin ich zufrieden, der Artikel wurde nicht umsonst geschrieben. </p><a name="habracut"></a><br><h2 id="svetofor-pervyy-ili-kaa-prinimaet-boy">  Die erste Ampel oder Kaa nimmt den Kampf. </h2><br><p>  Die Geschichte begann wie in einem klassischen Weihnachtsvideo vor Weihnachten, als die Kamera durch ein gefrostetes Fenster in einen kleinen gem√ºtlichen Raum blickte: einen Weihnachtsbaum aus Lametta, Watte und Spielzeug, den Geruch von Mandarine und Gl√ºhwein, den warmen Schauer von Schatten aus dem Kerzenlicht.  Auf dem gro√üen Sofa streckt sie das Plaid und dr√ºckt sanft ihre Wange gegen seine Schulter, w√§hrend sie geistesabwesend dem enthusiastisch gestikulierenden engelhaften kleinen M√§dchen zuh√∂rt ... </p><br><p>  Diejenigen mit elterlicher Erfahrung wissen genau, was genau Sie in einem solchen Moment h√∂ren k√∂nnen.  Ich werde es denen erkl√§ren, die eine solche F√§higkeit noch nicht erworben haben - mit hoher Wahrscheinlichkeit sind Eltern jetzt verbl√ºfft √ºber etwas wie: ‚ÄûPapa!  Uns morgen!  Zum Kindergarten!  Ich muss!  Bringen Sie Kunsthandwerk zum Weihnachtsbaumwettbewerb!  Und ich will den ersten Platz! " </p><br><p>  Es ist notwendig.  Morgen.  F√ºr uns.  Basteln.  Das Beste. </p><br><p>  Das Interview mit dem Kunden zeigt die Konturen der Arbeitsaufstellung: Wir brauchen eine Ampel.  Und sch√∂n zu sein und wie ein echter zu leuchten.  Bereits zu diesem Zeitpunkt sind die Kandidaten f√ºr das ISU-Projekt dramatisch d√ºnner geworden: Papa kann die Idee nicht begr√ºnden, dass eine h√ºbsche, weiche, aus Patchwork gen√§hte oder gestrickte oder geh√§kelte Ampel eine verk√∂rperte Darstellung der Tr√§ume des Kunden ist: Die Ampel muss an sein - was ist unklar? </p><br><p>  Die Nacht rollte √ºber das Land, und die Arbeit in unserem Land begann zu kochen. </p><br><p>  Das Karosseriematerial der Ampel ist eine Toilettenpapierh√ºlle, die zu einer Schachtel zusammengedr√ºckt wird.  Die Zehn-Rubel-M√ºnze wurde mit einem Bleistift eingekreist, und dann wurden mit einem Schreibmesser unter den Lichtern des Lichtalarms L√∂cher ausgeschnitten (Kindern wird traumatische Arbeit nicht anvertraut). </p><br><p><img src="https://habrastorage.org/webt/op/0f/az/op0fazb4pjg1z5mtam3hvudxve4.jpeg"></p><br><p>  Die Abdeckungen der Ober- und Unterseite der Ampel sind an Ort und Stelle aus Pappe geschnitten.  Spitzen √ºber den Lampen gem√§√ü dem hergestellten Muster wurden auf gew√∂hnlichem 80-Gramm-Papier eingekreist und manuell ausgeschnitten. </p><br><p><img src="https://habrastorage.org/webt/rm/ga/5u/rmga5uloolpi1di2umlqxn9lzmw.jpeg"></p><br><p>  Dann wurden sie auf PVA geklebt. </p><br><p><img src="https://habrastorage.org/webt/9x/ql/ff/9xqlfftsq_fphcorsj7nimjlqo8.jpeg"></p><br><p>  Die zusammengebauten Strukturen wurden in den Innenhof gezogen und mit Acrylspr√ºhfarben bemalt: gro√üz√ºgig silber, dann leicht schwarz oben. </p><br><p><img src="https://habrastorage.org/webt/hh/bm/ha/hhbmhaz7bod1ntgplrtyfeu3bgq.jpeg"></p><br><p>  Im Falle einer Besch√§digung wurden zu jedem Zeitpunkt drei Kopien gleichzeitig angefertigt.  Drei Streifen farbiges Papier - rot, gelb und gr√ºn - wurden mit Lichtfiltern in die erfolgreichsten geklebt. </p><br><p>  Die Hervorhebung von innen wurde durch ein Paar superheller wei√üer LEDs aus den gro√üz√ºgigen Beh√§ltern des Heimatlandes (SHZR) entschieden.  Die Kaptershchitskaya-Kr√∂te weigerte sich rundweg, dem Vater der Anwesenheit von SCHR sogar drei Tabletten-Lithiumbatterien zu geben, und die LEDs stimmten nicht zu, von einer zu leuchten, und gaben an, dass sie wei√ü und hell waren und der Spannungsabfall an ihnen 2,8 bis 3,9 Volt betrug.  Das Maximum, das wir mit der Kr√∂te verhandeln konnten, war f√ºr eine AA-Batterie, einen Ferritring von der Drosselklappe des verbrannten Motherboards und den KT315-Transistor.  Papa dachte nach und googelte und musste das Angebot annehmen.  Und angesichts der Anzahl der verspielten Stifte in jeder Gruppe des Kindergartens sah die Idee mit Lithiumbatterien nicht besonders attraktiv aus. </p><br><p>  Die R√ºmpfe der Ampeln an der Batterie ersetzten die Aromen von Nadeln und Mandarinen durch einen harten Farbgeruch, mein Vater steckte nachdenklich einen L√∂tkolben auf das Kolophonium, die Kinder wickelten Transformatoren zum Blockieren von Generatoren (Vervielf√§ltigung von Kopien), alles verlief nach Plan ... </p><br><p>  Und nein, ‚Äûpl√∂tzlich‚Äú ist diese Nacht nicht passiert: Alle Tricks beim Wickeln eines Transformators bestehen darin, die maximal m√∂gliche Anzahl von Windungen sofort mit einem doppelten Draht aufzuwickeln.  Verwechseln Sie nicht die Anode und Kathode der LED und die Anschl√ºsse des KT315-Transistors und schlie√üen Sie die Enden der Wicklungen gem√§√ü Schaltplan korrekt an (oder tauschen Sie sie aus, wenn sie nicht leuchten).  J1 - Netzschalter von einem Computer-Jumper, der sp√§ter "auf dem Dach" einer Ampel angezeigt wird. </p><br><p>  Eine v√∂llig einfache Schaltung zur Erzeugung von Wechselspannung mit Spitzen von 3 bis 7 V aus einer 1,5 V G1-Batterie ist seit langem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">weithin bekannt</a> . </p><br><p><img src="https://habrastorage.org/webt/fx/on/h5/fxonh57exbpayjclrpo3k05sazg.png"></p><br><p>  Physikalisch ist der Schaltplan wie folgt dargestellt: </p><br><p><img src="https://habrastorage.org/webt/tt/aq/4u/ttaq4unttq55rdeg-f0tr0ti3zq.png"></p><br><p>  Die B√ºrokratie hat eine AA-Alkalibatterie. </p><br><p>  Und die Ampel selbst ist so. </p><br><p><img src="https://habrastorage.org/webt/2s/5w/dd/2s5wddfdxjkcl34w1mgj_neduyg.jpeg"></p><br><p>  Am Morgen schleppte das stolze Kind das Produkt in den Kindergarten, wo das Spielzeug f√ºr Furore sorgte und auf dem Weihnachtsbaum im Mittelpunkt stand. </p><br><p><img src="https://habrastorage.org/webt/zz/fy/yc/zzfyyckk-i-jdncvaangd1cee8u.jpeg"></p><br><p>  Zwar hat es mit dem ersten Platz im Wettbewerb nicht geklappt - die Frist f√ºr die Einreichung von Einsendungen war, wie sich herausstellte, bereits vor einigen Tagen. </p><br><p>  Zu Hause gab es zwei Geb√§ude auf der Fensterbank und die juckende Unzufriedenheit meines Vaters mit der L√∂sung der Aufgabe ‚ÄûIch m√∂chte, dass es wie eine echte Ampel ist‚Äú.  Und die Idee drehte sich: " <abbr title="Gro√üz√ºgige M√ºlleimer des Mutterlandes oder nach den Worten seiner Frau Plyushkin-Reserven.">Ist</abbr> es m√∂glich, eine vollst√§ndige L√∂sung zu finden, beispielsweise in der 13. Sache, dass die Kr√∂te schon lange im <abbr title="Gro√üz√ºgige M√ºlleimer des Mutterlandes oder nach den Worten seiner Frau Plyushkin-Reserven.">ShchZR liegt</abbr> ? Wird es genug f√ºnf Beine geben, ein Kilobyte f√ºr den Code und 64 Bytes RAM und das, wie bestellt, wie eine echte?" </p><br><p>  Das alles war also nur ein Sprichwort, ein M√§rchen √ºber die endg√ºltige L√∂sung des bevorstehenden Ampelproblems. </p><br><h2 id="svetofor-vtoroy-kak-nastoyaschiy">  Die zweite Ampel, wie eine echte </h2><br><h3 id="ispolzuemyy-instrumentariy-materialy-i-dokumentaciya">  Gebrauchte Werkzeuge, Materialien und Dokumentation </h3><br><p>  <em>Sprache / Framework</em> : C / Arduino 1.6 / 1.8. <br>  <em>IDE</em> : MS Visual Studio 2012 + Visual Micro-Plugin + Git. <br>  <em>CAD</em> : DipTrace. <br>  <em>HW</em> : ATtiny13 MK, Arduino Nano-Klon auf ATmega328, USB-UART auf FT232R, USBISP-Programmierer ohne Namen. <br>  <em><abbr title="Leiterplatte.">PP-</abbr> Technologie</em> : <abbr title="Laser- und Eisentechnologie.">LUT</abbr> . <br>  <em>Werkzeuge</em> : L√∂tkolben, Klebepistole, K√ºchenofen, Messer, Schere, Drahtschneider. <br>  <em>Materialien</em> : Von <abbr title="Aufbewahrungsort f√ºr elektronische Komponenten mit schwierigem Schicksal - gel√∂tet, gebraucht, einmal bei Aliexpress gekauft usw.">SHCHZR</abbr> - 4 rote, gelbe, gr√ºne Ausgangs-LEDs von Nicht-Marken, SMD-Tantalkondensator und ein Paar Widerst√§nde 0805 je 10k, ein halbes Dutzend Ausgangs-0,25-W-Strombegrenzungswiderst√§nde MF-25, chinesischer Boost-DC-DC-5-V-Wandler, Aerosoldosen mit silberner und schwarzer Farbe, A4-Papier, Fimo aus dem Verkauf. </p><br><p>  <em>Quellen und Dokumente sind auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a> unter der MIT-Lizenz verf√ºgbar. Quellcode-Commits fallen mit der Iteration der unten beschriebenen Firmware zusammen. Alle genannten Dateipfade beziehen sich auf das Stammverzeichnis des Repositorys.</em> </p><br><p>  <em>Dokumentation</em> : <br>  ./docs/ATtiny13A Datenblatt.pdf [Spezifikation f√ºr MK Atmel ATtiny13A] <br>  ./docs/ATmega328 Datenblatt.pdf [Atmel ATmega328 MK Spezifikation] <br>  ./docs/AVR4027 - Tipps und Tricks zur Optimierung Ihres C-Codes.pdf [Atmel AVR4027: Tipps und Tricks zur Optimierung Ihres C-Codes f√ºr 8-Bit-AVR-Mikrocontroller] <br>  ./docs/AVR4013 - PicoPower-Grundlagen.pdf [Hinweise zu Energiesparmodi] </p><br><p>  Aus der Arduino <abbr title="Englisch Integrierte Entwicklungsumgebung">IDE</abbr> , wie eine Decke aus der Wolke.  Ihr Zauberer ist der subtile Spott der Jesuiten √ºber alles, was unter Einbettungsprogrammierern heilig sein kann.  Aber Arduino als √ñkosystem hat gelebt, wird leben und wird leben, und aufgrund der Einfachheit der Installation der Umgebung auf Computern unter verschiedenen Betriebssystemen und weil sie als erste ohne besondere Kosten f√ºr einen Hardware-Debugger die Verwendung eines Penny-UART und eines propriet√§ren Bootloaders erm√∂glichten, Entwicklung in einer ziemlich ernsthaften F√ºllung MK.  Und hier ist Onkel Liao, der bereit ist, eine Handvoll Klone zum Preis eines Originals zu verkaufen.  Die Tatsache, dass Sie in √§lteren Atmegs die Logik und den Betrieb des Programms debuggen und dann mit minimalen √Ñnderungen auf dieselbe Tinka √ºbertragen k√∂nnen - dies ist auch ein Argument. </p><br><p>  Es ist normal und bequem f√ºr mich, in <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MS VisualStudio zu arbeiten</a> . Ich habe nicht zu viel Platz f√ºr AtmelStudio oder WinAVR und ich m√∂chte es nicht finden. Ohne einen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Hardware-Debugger</a> verf√ºgen sie nicht √ºber die ultimativen Annehmlichkeiten.  √úber das VisualMicro-Plugin, das MS VisualStudio um Arduino-Unterst√ºtzung erweitert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">, wurde es bereits</a> ausreichend detailliert und intelligent im Haber geschrieben. <br>  Der Fokus von "Arduino on ATtiny13" auf den Hub wurde ebenfalls vor langer Zeit und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wiederholt in</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Betracht gezogen</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">F√ºgen Sie</a> kurz das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">MicroCore-</a> Modul zur installierten Installation der Arduino-Umgebung hinzu. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Anschlie√üend</a> k√∂nnen Sie ATtiny13 MK-Ziele ausw√§hlen. </p><br><p><img src="https://habrastorage.org/webt/9f/rm/fe/9frmfek8wvpfsphvtyhedqiiuoy.png"></p><br><p>  Git - keine Alternative f√ºr die meisten Heimprojekte.  Die Gewohnheit ist einfach, aber richtig: Wenn Sie mit der Arbeit an einem Programm beginnen, geben Sie einfach "git init" in das Verzeichnis in der Befehlszeile ein.  Die integrierte Unterst√ºtzung von MS Visual Studio f√ºr Commits im lokalen Repository spart mehr als einmal Zeit und Zeit. </p><br><p>  DipTrace ist wie CAD f√ºr Schaltkreise und eine Leiterplatte praktisch, inl√§ndisch, die Schaltkreise und Verkabelung sind benutzerfreundlich, es ist einfach, benutzerdefinierte Komponenten (UGO, Kontakte) hinzuzuf√ºgen. Falls gew√ºnscht, kann eine Leiterplatte mit Komponenten in 3D gedreht werden, hochwertige Hilfe und Schulungen sind enthalten.  Dar√ºber hinaus beeindruckt mich die Lizenzpolitik: Die Einschr√§nkungen der f√ºr Russland, die Ukraine und die Republik Belarus kostenlosen Non-Profit-Standardlizenz (1000 Pins, 4 Signalschichten) reichen in 99% der F√§lle f√ºr das Heimhandwerk aus. </p><br><p>  Ich konnte es nicht schaffen, dass Arduino Nano als kleiner Programmierer richtig funktioniert, aber mit einem USB-ISP-Programmierer ist das Problem leicht zu l√∂sen.  Schnell skizzierte Batchdateien f√ºr Kompilierung / Firmware - im Verzeichnis ./gcc im Projekt. </p><br><p>  Die .ino-Datei (eigentlich ist es C / C ++) kann im Studio "unter arduino unter ATtiny13" korrekt kompiliert werden. Sie wird einfach durch den Parameter dieser Batch-Datei in der Befehlszeile bereitgestellt: </p><br><pre><code class="plaintext">&gt;"./gcc/0_MAKE &amp; upload.cmd" MyArduinoFile.ino</code></pre><br>
<p>     ISP ,     ,      .</p><br>
<pre><code class="plaintext">&gt;"./gcc/0_MAKE &amp; asm.cmd" MyArduinoFile.ino</code></pre><br>
<p>   , ,     ‚Äî   ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  AVR</a>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> . <strong></strong>: <em>         ,  </em>.</p><br>
<h3 id="dusha-svetofora"> </h3><br>
<h4 id="upgrade-romram-pod-arduino-dlya-attiny13">Upgrade ROM&amp;RAM  Arduino  ATtiny13</h4><br>
<p> Arduino  ( setup(){...}; loop(){...};)       ""   - int main(){setup(); loop();}, <em></em>        by Arduino. </p><br>
<pre><code class="cpp">uint8_t cnt;
void setup() {
    cnt=0;
}
void loop() {
  cnt++;
}
//Program size: 164 bytes (used 16% of a 1 024 byte maximum) (0,57 secs)
//Minimum Memory Usage: 5 bytes (8% of a 64 byte maximum)</code></pre><br>
<p>    ,       :</p><br>
<pre><code class="cpp">uint8_t cnt;
int main(){
    cnt=0;      // &lt; setup()
    while(1){
        cnt++;  // &lt; loop()
    }
}
//Program size: 60 bytes (used 6% of a 1 024 byte maximum) (1,23 secs)
//Minimum Memory Usage: 1 bytes (2% of a 64 byte maximum)</code></pre><br>
<p>   16%  6%   ,  ,  6%     .                   ,   ‚Äî      64  . </p><br>
<h4 id="intellekt-spyaschey-krasavicy">  </h4><br>
<p>  , ,  :       .         ,     ,   ,    ,     .   , ,   ,     .         ,       :  <abbr title="   = -  +      +   + ">CPU</abbr>     ,       .    ‚Äî   ,     N  .      ""-CPU     ,       (9.6     /    1024 = 9370 ,      ) 1/9370 = 0.0001067 .      8-   .  ,   ,    ,     " ".      ,   ,  ,           "".      37    (256  0.0001067 = 0.027315; 0.027315  37 = 1.01065 ~= 1s). </p><br>
<p>  :     - (HW ,     1024 ),   8   ‚Äî    ,         ,    .</p><br>
<p><strong></strong>: <em> globalTimer   volatile,  ,         ,  ,     CPU        ,           </em>.</p><br>
<pre><code class="cpp">#include &lt;avr/io.h&gt;         //     IDE -  
#include &lt;avr/sleep.h&gt;      // ,  
#include &lt;avr/interrupt.h&gt;          //   
volatile uint16_t  globalTimer;     //     64   
//  -    globalTimer  1/37 
ISR(TIM0_OVF_vect){
    globalTimer++;  //       . , ,  while(1)   .
}
int main() {
    //     "  -". 
    set_sleep_mode(SLEEP_MODE_IDLE);    //   - .
    sleep_enable();                 //    
    TCCR0B = _BV(CS02) | _BV(CS00); //  0 - clock frequency / 1024
    TIMSK0 |= _BV(TOIE0);           //      overflow interrupt
    sei();                          //    
    while(1){
        //.........   
        sleep_cpu();    //     -   .
    }
}
//Program size: 128 bytes (used 13% of a 1 024 byte maximum) (0,86 secs)
//Minimum Memory Usage: 2 bytes (3% of a 64 byte maximum)</code></pre><br>
<h4 id="u-koshki-4-nogi-vhod-vyhod-zemlya-i-pitanies-zhalostlivaya-studencheskaya-pesnya">"  4 : , ,   "()   </h4><br>
<p> , ,       .<br>
   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> </a>,   ,    CPU,   /  /    .     <abbr title="General-Purpose Input/Output,  / (I/O)  ">GPIO</abbr>.</p><br>
<p>      Arduino   :     Arduino  pin_number      ( ):</p><br>
<pre><code class="cpp">pinMode(pin_number, OUTPUT); //   INPUT -   </code></pre><br>
<p>    /     ,   ‚Äî       .</p><br>
<pre><code class="cpp">Value = digitalRead(pin_input_number);  //Value -  HIGH  LOW (1  0)
digitalWrite(pin_outpit_number, Value);       //   pin_outpit_number - HIGH  LOW</code></pre><br>
<p> ""  ,   Wiring    ,  ,    Arduino (        )     (  )     (  ) (    ).</p><br>
<p><img src="https://habrastorage.org/webt/fp/di/ni/fpdiniruiiujuodrtyzrcfyljr8.png"></p><br>
<p>..   Arduino 7    11  PD7 ‚Äî    D.<br>
  digitalRead, digitalWrite, pinMode  ..,             ,   , ,      Wiring-      ,       .</p><br>
<p>   ‚Äî   ,    . ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">DIHALT</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>          .</p><br>
<p><img src="https://habrastorage.org/webt/rk/y8/sj/rky8sjzln3u1k3lndv0inksdxjm.jpeg"></p><br>
<p>   -    (<abbr title=" -  ">GPIO</abbr>)     ,  8-   ‚Äî  8    .     ,   6     (. ATtiny13 pinout,   ),  PB0  PB5,      PB5 ‚Äî     MK    .    -    : (     "B") <abbr title="Data Direction Register B,   -   ">DDRB</abbr>, <abbr title="Port B Input Pins Register,    0  1  ,  ">PINB</abbr>  <abbr title="Port B Data Register,      ">PORTB</abbr>.    ‚Äî  ,    ,   .  PB0, PB1, PB2, PB3, PB4, PB5 ‚Äî       B.      #include &lt;avr/io.h&gt; (   iotn13.h  ),      (PB0  0,..., PB5 ‚Äî 5)      IDE,        Arduino. </p><br>
<p><strong></strong>: <em>      ,    ,       .  ,  -      , , ,   DDRx GPIO ,   ‚Äî .       PORTx ‚Äî    ,  "-    ",   ,      ‚Äî   ,    PINx.       ,  50       0  1.        ,      </em>.</p><br>
<div class="spoiler"><b class="spoiler_title">, </b><div class="spoiler_text"><p>  PB2   HIGH, +5,   PB3  LOW, 0,    PB0 ,  ‚Äî      .<br>
DDRB   ,    PB0,   ( ) = 0 (PB0   ),     = 1 (PB2, PB3 ‚Äî ), ..     110,   ‚Äî  ,  1  0 ‚Äî    . </p><br>
<pre><code class="cpp">DDRB = 12;  //  000001100    - 12
//        (!)
//        pinMode().</code></pre><br>
<p>      ‚Äî  PORTB ,    =1 (PB2  HIGH),   ‚Äî  (PB3  LOW),  ‚Äî  , 01</p><br>
<pre><code class="cpp">PORTB = 8;  //(dec)8 === (bin)000001000
//  -        .</code></pre><br>
<p>             PINB,   ,    ‚Äî      .<br>
  ,          ‚Äî  .<br>
    3 (PB3)  :   1   ,    3  .<br>
3&lt;&lt;00000001 === PB3&lt;&lt;1 //  ‚Äî 00001000<br>
     , _BV(x),      (x&lt;&lt;1), .. _BV(PB3) ‚Äî     1.<br>
 _BV(PB3) | _BV(PB2)      00001100 (| ‚Äî   ).<br>
<strong></strong>: <em>      ,       ,     </em>.</p><br>
<pre><code class="cpp">PORTB |= _BV(PB3) | _BV(PB2); // 2  3   == 1,     PB2  PB3  HIGH,   PORTB  </code></pre><br>
<p>  0    ,          ,    .     0     1  .       ,  ,  1     ,   0 ‚Äî   0 .</p><br>
<pre><code class="cpp">PORTB &amp;= ~(_BV(PB3) | _BV(PB2)); //   PORTB 2  3  -  , LOW,   .</code></pre></div></div><br>
<p>     HW , - 0, Timer0.   GPIO,    ,   ,      datasheet ATtiny13,  -     -,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a> <abbr title="     328,     .">Ilya Ananev</abbr>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">- 0</a>   ATmega328. </p><br>
<p>   ,    ,   .</p><br>
<pre><code class="cpp">TCCR0B = _BV(CS02) | _BV(CS00);    //    CS02  CS00  1 -   0 = clock frequency / 1024
TIMSK0 |= _BV(TOIE0);           //   TOIE0  1 -     TIM0_OVF
//      TIMSK0 = _BV(TOIE0);</code></pre><br>
<h4 id="gost-ili-zakon-est-zakon">    .</h4><br>
<p>      ,       .    ,    ,          .    -  ,        ,      ,    (!)   . </p><br>
<p>    ,       .           "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">   27.02.13</a>"  7    52289-2004     ,          .<br>
     (  ): ,   , ,  , , .</p><br>
<p>"*    "  "     2 ,    ‚Äî 3 . </p><br>
<p>               3        1 /.*"</p><br>
<p>   ,      (    ,      /  ‚Äî PERIOD_0  PERIOD_4,    ‚Äî  ).</p><br>
<pre><code class="cpp">#define ONE_SECOND  37      //     1 
#define QT_SECOND   9       //  

#define PERIOD_FLASH_GREEN  QT_SECOND           //    ( ) -    
#define PERIOD_FLASH_YELLOW ONE_SECOND * 1      //    -    - 
                                                        //  --- 
#define PERIOD_0    ONE_SECOND * 10 //R G R G   0.  ---   (10 )
#define PERIOD_1    ONE_SECOND * 3  //R g R g   1.  ---   (3 )     
#define PERIOD_2    ONE_SECOND * 1  //R Y R Y   2.  ---  (1 )
#define PERIOD_3    ONE_SECOND * 2  //RY Y RY Y 3. + ---  (2 ) 
#define PERIOD_4    ONE_SECOND * 7  //G R G R   4.  ---   (7 )
#define PERIOD_5    ONE_SECOND * 3  //g R g R   5.   --- (3 )
#define PERIOD_6    ONE_SECOND * 1  //Y R Y R   6.  ---  (1 )
#define PERIOD_7    ONE_SECOND * 2  //Y RY Y RY 7.  --- + (2 )</code></pre><br>
<p>  ,      ,    .</p><br>
<pre><code class="cpp">typedef struct{
    const uint8_t ddr_val_0;    // DDRB value -   
    const uint8_t port_val_0;   // PORTB value   -   
    const uint8_t ddr_val_1;    // DDRB value  -   "",   
    const uint8_t port_val_1;   // PORTB value - 
    const uint16_t flash_period;    // period of flashing -   _val_1  _val_0
    const uint16_t signal_period;   // period of this lighting state
}lightSignalization;            //   , _0  _1 -   , flash_long -   
// flash_period == 0,   ,   _val_0.
// signal_period == 0,         .</code></pre><br>
<p>  ,        128  ‚Äî     ,      .</p><br>
<h4 id="kak-nayti-v-attiny13-vosem-ili-devyat-pinov-vvoda-vyvoda">   ATtiny13  ( ?)  -</h4><br>
<p>   ,  ,   -  -     ,  :       6  . -  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">denvo</a>   "<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="> ?  RESET</a>"       5-     ,     ,      ,      ,   -   .</p><br>
<p>   -     :    --, ..      ,  7  .</p><br>
<p>     ‚Äî   , ,  ,   8,  ? </p><br>
<p> ,  -,      "reset", PB5,      . </p><br>
<p>   ,  ? , ,   ,    . , , ,  ,   ,  .</p><br>
<p> ,  , 8  9  -  ,    8  ‚Äî       .    ,    -,   , , ,   . </p><br>
<p>   ‚Äî    .</p><br>
<p>   :           ‚Äî         .           .</p><br>
<p>        :</p><br>
<p><img src="https://habrastorage.org/webt/hw/6_/6a/hw6_6aeekqqdlt7a0cqnk9kf2pa.png"></p><br>
<p> 1    PORTB |= _BV(GREEN_PIN) ‚Äî    (  ) ,   0 .. PORTB &amp;= ~(_BV(GREEN_PIN)) ‚Äî  (  ).<br>
  ,     ,      ?<br>
     (DDRB |= _BV(GREEN_PIN))   , DDRB &amp;= ~(_BV(GREEN_PIN)), GREEN_PIN   Hi-Z      .      (2.2 * 4)    5,   <abbr title=".  ,       ,        .">   </abbr>.</p><br>
<p>          .<br>
            ‚Äî ..    ,     ,    .</p><br>
<div class="spoiler"><b class="spoiler_title">, ,      </b><div class="spoiler_text"><p>,               .   ,    ‚Äî     ,   37/2=18      ,          ,    . :<br>
)   ,     ,  ,  ,     ;<br>
)   ‚Äî        ,      " "       4  ;<br>
)  ,       4 ( PERIOD_2-&gt;PERIOD_3  PERIOD_6-&gt;PERIOD_7);<br>
)  4                 .</p></div></div><br>
<p>  .</p><br>
<p><img src="https://habrastorage.org/webt/35/in/ym/35inymyguij4kl6qnsuckgz_ukq.png"></p><br>
<pre><code class="cpp">// PINB === 0 0 0 g r y0 btt y1
#define RED_PIN     PB3     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 
#define YELLOW0_PIN PB2     // OUT: 1 -  "-" 
#define YELLOW1_PIN PB0     // OUT: 1 -  "-" 
#define GREEN_PIN   PB4     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 

#define RED     _BV(RED_PIN)        // _BV -     (), 1&lt;&lt;VALUE
#define YELL0   _BV(YELLOW0_PIN)        //    -
#define YELL1   _BV(YELLOW1_PIN)
#define GREEN   _BV(GREEN_PIN)      //    - (  0 -   -)  DDRB.GreenPin=1</code></pre><br>
<p> ‚Äî  <abbr title=" ,      reset,     ISP "> </abbr> .    ,            ,   ‚Äî      ,    .</p><br>
<pre><code class="cpp">#define BUTTON_PIN      PB1
#define BUTTON_ON  !(PINB &amp; _BV(BUTTON_PIN))    //( (PINB &amp; _BV(BUTTON_PIN)) == 0)  //  " " -   LOW
#define BUTTON_OFF (PINB &amp; _BV(BUTTON_PIN))     //  " " -    HIGH, (     )</code></pre><br>
<p><strong><em>       ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u="></a>,   n   ( ) n(n‚àí1) = n¬≤‚àín .  4   12  ,         .   <abbr title=" +  + ">¬´ , ¬ª</abbr>  <abbr title=" + ">¬´ ,   ¬ª</abbr>        .</em></strong></p><br>
<div class="spoiler"><b class="spoiler_title">    12 LED</b><div class="spoiler_text"><p><img src="https://habrastorage.org/webt/oq/sn/le/oqsnlertvho7jlbhqt5ehp_fcks.png"></p></div></div><br>
<p>*** ‚Äî   ,         DDRx|PORTx,       , ..       .          ‚Äî   ,        ,         . </p><br>
<p>                     .***</p><br>
<h4 id="paru-slov-o-pyatom-izmerenii-kak-vpihnut-nevpihuemoe">    :   ?</h4><br>
<p>         lightSignalization.    lightSignalization        .    0  7  , 8 ‚Äî  ,  9 ‚Äî ,   ""   .     ,         0  7,      . ,  ,      .     3    ( 0  7)  8   --             .   if-   ,    .     ,   .</p><br>
<pre><code class="cpp">lightSignalization traffic_signals[] = {//   
 // {DDRB0, PORTB0,   DDRB_when_flashingif, PORTB_when_flasingif (if flashing),   continous of half-period flashing,   continous curr mode runing}
    {RED|GREEN, RED,   0, 0,   0, PERIOD_0},                    // R G R G
    {RED, RED,  RED|GREEN, RED,   QT_SECOND, PERIOD_1},     // R g R g - flash east green
    {RED|YELL1, RED|YELL1,   0, 0,   0, PERIOD_2 },         // R Y1 R Y1
    {RED|YELL0|YELL1, RED|YELL0|YELL1,  0, 0,   0, PERIOD_3 },  // RY0 Y1 RY0 Y1
    {RED|GREEN, GREEN,   0, 0,   0, PERIOD_4},              // G R G R
    {RED|GREEN, GREEN,   RED, 0,    QT_SECOND, PERIOD_5 },  // g R g R - flash nord green
    {RED|YELL0, YELL0,   0, 0,   0, PERIOD_6},                  // Y0 R Y0 R
    {RED|YELL0|YELL1,  YELL0|YELL1,   0, 0,   0, PERIOD_7  },       // Y0 RY1 Y0 RY1

    {YELL0|YELL1, YELL0|YELL1,   YELL0|YELL1, 0,  ONE_SECOND, 0},   // y0 y1 y0 y1 - flash yellows lights 
    {0, 0,   0, 0,   0, 0}          // traffic lights off, DDR in, Hi-Z
};

//       lightSignalization traffic_signals[]
#define LIGHT_NUM_YELLOW_FLASH  8       //       -  - flash yellows lights
#define LIGHT_NUM_STD_START     0       //       
#define LIGHT_NUM_LIGHTS_OFF    9       //      -   - traffic lights off</code></pre><br>
<p>  lightSignalization  8   . ..     traffic_signals[]  10     80  (,  64  ,  2     ).  ,        .</p><br>
<p> ,  , ,          ‚Äî    ROM,  ,    RAM   ,     .</p><br>
<p>-     </p><br>
<pre><code class="plaintext">const lightSignalization traffic_signals[] PROGMEM= {...</code></pre><br>
<p> ,           </p><br>
<pre><code class="plaintext">&lt;avr/pgmspace.h&gt; pgm_read_byte_near()  pgm_read_word_near()</code></pre><br>
<p> char  shortint .</p><br>
<p>     3   . </p><br>
<ol>
<li><p> ,   .<br>
   traffic_signals[] ‚Äî <strong>LIGHT_NUM_LIGHTS_OFF</strong><br>
{0, 0, 0, 0, 0, 0} // traffic lights off<br>
   ‚Äî  lightSignalization  ,     ‚Äî ,   lightSignalization.signal_period==0 (.. ),   lightSignalization.flash_period==0, ..   . </p><br>
</li>
<li><p> ,  .<br>
   traffic_signals[] ‚Äî <strong>LIGHT_NUM_YELLOW_FLASH</strong><br>
{YELL0|YELL1, YELL0|YELL1, YELL0|YELL1, 0, ONE_SECOND, 0}, // y0 y1 y0 y1 ‚Äî flash yellows lights<br>
   : lightSignalization.signal_period==0.      lightSignalization.flash_period=ONE_SECOND,    :</p><br>
<pre><code class="cpp">DDRB = YELL0|YELL1;     // YELL0, YELL1 - 
PORTB = YELL0|YELL1;    // YELL0, YELL1 = HIGH -  </code></pre><br>
<p></p><br>
<pre><code class="cpp">DDRB = YELL0|YELL1;     // // YELL0, YELL1 -   
PORTB = 0;              // YELL0, YELL1 = LOW -  </code></pre><br>
</li>
<li><p> , --.</p><br>
</li>
</ol><br>
<p> ,   . </p><br>
<p>  traffic_signals[]     ‚Äî <strong>LIGHT_NUM_STD_START</strong><br>
{RED|GREEN, RED, 0, 0, 0, PERIOD_0}, // R G R G<br>
   : lightSignalization.flash_period==0.<br>
DDRB = RED|GREEN; //RED  GREEN ‚Äî  ,  .<br>
PORTB = RED; //  RED ‚Äî HIGH (-      )<br>
//   GREEN ‚Äî LOW (  ,  - ‚Äî  )<br>
      lightSignalization.signal_period==PERIOD_0,       . </p><br>
<p>        current_signal.   2   ‚Äî        ,     lightSignalization.</p><br>
<pre><code class="cpp">uint8_t current_signal;     // 1    ,   traffic_signals
uint16_t tl_flash_end;      // 2       ( !0), 
uint16_t tl_signal_end;     // 2            ( !0)</code></pre><br>
<p> tl_signal_end != 0,   globalTimer&gt;tl_signal_end  current_signal.     0   current_signal,  3, .<br>
current_signal = current_signal &amp; B00000111;<br>
  </p><br>
<pre><code class="plaintext">current_signal &amp;= LIGHT_NUM_STD_MASK ;   //current_signal &amp; B00000111;</code></pre><br>
<p>  current_signal  ,       0  7.<br>
   globalTimer ‚Äî       . </p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><pre><code class="cpp">#include &lt;limits.h&gt;         // USHRT_MAX
#include &lt;avr/sleep.h&gt;      // ,  
#include &lt;avr/interrupt.h&gt;  //   
#include &lt;avr/pgmspace.h&gt;   //    

#define ONE_SECOND  37      //     1 
#define QT_SECOND   9       //  
#define MAX_GLOBAL_TIMER_VALUE  (USHRT_MAX / 2)     // uint16_t globalTimer -   . 65535 /2 
//     ,  MAX_GLOBAL_TIMER_VALUE - 1
#define PERIOD_FLASH_GREEN  QT_SECOND           //    ( ) -    
#define PERIOD_FLASH_YELLOW ONE_SECOND * 1      //    -    - 
                                                        //  --- 
#define PERIOD_0        ONE_SECOND * 10     //R G R G   0.  ---   (15 )
#define PERIOD_1        ONE_SECOND * 3      //R g R g   1.  ---   (3 )     
#define PERIOD_2        ONE_SECOND * 1      //R Y R Y   2.  ---  (1 )
#define PERIOD_3        ONE_SECOND * 2      //RY Y RY Y 3. + ---  (2 ) 
#define PERIOD_4        ONE_SECOND * 7      //G R G R   4.  ---   (10 )
#define PERIOD_5        ONE_SECOND * 3      //g R g R   5.   --- (3 )
#define PERIOD_6        ONE_SECOND * 1      //Y R Y R   6.  ---  (1 )
#define PERIOD_7        ONE_SECOND * 2      //Y RY Y RY 7.  --- + (2 )

typedef struct{
    const uint8_t ddr_val_0;    // DDRB value    
    const uint8_t port_val_0;   // PORTB value  
    const uint8_t ddr_val_1;    // DDRB value    
    const uint8_t port_val_1;   // PORTB value
    const uint16_t flash_period;    // period of flashing -   _val_1  _val_0
    const uint16_t signal_period;   // period of this lighting state
}lightSignalization;            //   , _0  _1 -   , flash_long -   

//    (PINS === 0 0 0 g r y0 btt y1):
 //     ""     
#define BUTTON      PB1
#define RED_PIN     PB3     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 
#define YELLOW0_PIN PB2     // OUT: 1 -  "-" 
#define YELLOW1_PIN PB0     // OUT: 1 -  "-" 
#define GREEN_PIN   PB4     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 

#define BUTTON_ON  !(PINB &amp; _BV(BUTTON))    //( (PINB &amp; _BV(BUTTON)) == 0)  //  " "
#define BUTTON_OFF  (PINB &amp; _BV(BUTTON))    // ~(PINB &amp; _BV(BUTTON)) -\\- " "

#define RED     _BV(RED_PIN)            // _BV -     (), 1&lt;&lt;VALUE
#define YELL0   _BV(YELLOW0_PIN)        //
#define YELL1   _BV(YELLOW1_PIN)
#define GREEN   _BV(GREEN_PIN)

//       lightSignalization traffic_signals[]
#define LIGHT_NUM_YELLOW_FLASH  8       //       -  - flash yellows lights
#define LIGHT_NUM_STD_START     0       //       
#define LIGHT_NUM_LIGHTS_OFF    9       //      -   - traffic lights off
#define LIGHT_NUM_STD_MASK      7       // ___++ &amp;LIGHT_NUM_STD_MASK -    0  7   

//....................................  
// 
const lightSignalization traffic_signals[] PROGMEM= {   //   ,  ,   -, PINS === 0 0 0 g r y0 btt y1
 // {DDRB0, PORTB0,   DDRB_flashing, PORTB_flasinf (if flashing),   continuous of half-period flashing,   continuous id mode running}
    {RED|GREEN, RED,   0, 0,   0, PERIOD_0},                    // R G R G
    {RED, RED,  RED|GREEN, RED,   QT_SECOND, PERIOD_1},     // R g R g - flash east green
    {RED|YELL1, RED|YELL1,   0, 0,   0, PERIOD_2 },             // R Y1 R Y1
    {RED|YELL0|YELL1, RED|YELL0|YELL1,  0, 0,   0, PERIOD_3 },  // RY0 Y1 RY0 Y1
    {RED|GREEN, GREEN,   0, 0,   0, PERIOD_4},                  // G R G R
    {RED|GREEN, GREEN,   RED, 0,    QT_SECOND, PERIOD_5 },      // g R g R - flash nord green
    {RED|YELL0, YELL0,   0, 0,   0, PERIOD_6},                  // Y0 R Y0 R
    {RED|YELL0|YELL1,  YELL0|YELL1,   0, 0,   0, PERIOD_7  },   // Y0 RY1 Y0 RY1

    {YELL0|YELL1, YELL0|YELL1,   YELL0|YELL1, 0,  ONE_SECOND, 0},   // y0 y1 y0 y1 - flash yellows lights 
    {0, 0,   0, 0,   0, 0}              //  traffic lights off, 
};

volatile uint16_t  globalTimer;     //     64   
uint8_t current_signal;     // 1    ,   traffic_signals
uint16_t tl_flash_end;      // 2       ( !0), 
uint16_t tl_signal_end;     // 2            ( !0)

//....................................  
void setPeriods(uint8_t num, bool set_both_flash_and_signal);   //  tl_flash_end, tl_signal_end
void setPorts(uint8_t num, bool use_main_values);               //    

//....................................  
//
//  -    globalTimer  1/37 
ISR(TIM0_OVF_vect){
    globalTimer++;  //       . ,   while(1)   .
}

int main() {
//
bool use_main_values = true;            // lightSignalization._val_0 (1)  lightSignalization._val_1 (0)? -  
current_signal = LIGHT_NUM_STD_START;   //   .     .

    //     "  -". 
    set_sleep_mode(SLEEP_MODE_IDLE);    //   - .
    sleep_enable();                 //    

    TCCR0B = _BV(CS02) | _BV(CS00); //  0 - clock frequency / 1024
    TIMSK0 |= _BV(TOIE0);           //      overflow interrupt

    sei();      //    
    while(1){
        //   ? 
        if(globalTimer &gt; MAX_GLOBAL_TIMER_VALUE){
            globalTimer -= MAX_GLOBAL_TIMER_VALUE;          //   
            // 
            if(tl_flash_end){
                tl_flash_end -= MAX_GLOBAL_TIMER_VALUE;     //   ,  
            }
            if(tl_signal_end){
                tl_signal_end -= MAX_GLOBAL_TIMER_VALUE;    // //   ,  
            }
            // setPeriods(currentMode, false); //   12  ,  tl_.._end   ,     
        }

                //      (tl_flash_end !=0 )
        if(tl_flash_end){
            //     
            if(globalTimer &gt; tl_flash_end){
                use_main_values = !use_main_values;             // !use_main_values -      ))
                setPorts(current_signal, use_main_values);      //      
                setPeriods(current_signal, false);              //     ,   
            }
        }

        //         -    operating_std     - --
        if(tl_signal_end){
            //       (use_main_values -       -  )
            if((globalTimer &gt; tl_signal_end)  &amp;&amp; use_main_values){
                current_signal ++;                          //   
                current_signal &amp;= LIGHT_NUM_STD_MASK;       //    3-,        0  7
                use_main_values = true;                     //  -    
                setPorts(current_signal, use_main_values);  //        
                setPeriods(current_signal, true);           //       
            }
        }

        sleep_cpu();    //      -   .
    }
}

    //   
 void setPorts(uint8_t num, bool use_main_values){
    uint8_t val;
    DDRB = 0; PORTB = 0;
    //    () - ddr_val_0, else = ddr_val_1
//  val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0))
//                          : pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_1));

    //   ,  , ,  ,   ,   14 (!!!)   .
    val = pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0)+( (use_main_values) ? 0 : 2) ); 
    val &amp;= ~_BV(BUTTON);    //     - 
    DDRB = val;             //    

    val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].port_val_0)) 
                            : pgm_read_byte_near(&amp;(traffic_signals[num].port_val_1));
    val|= _BV(BUTTON);  //     -  -    
    PORTB = val;        //      
}

 //     ( 
void setPeriods(uint8_t num, bool set_both_flash_and_signal){
//  
    tl_flash_end = pgm_read_word_near (&amp;(traffic_signals[num].flash_period));   //  
    tl_flash_end = (tl_flash_end)? tl_flash_end + globalTimer : 0;  //    -      
    //if(tl_flash_end){         tl_flash_end += globalTimer;    } &lt;-     8  

    //     -    
    if(set_both_flash_and_signal){
        tl_signal_end = pgm_read_word_near(&amp;(traffic_signals[num].signal_period));  
        tl_signal_end = (tl_signal_end)? tl_signal_end + globalTimer : 0;           //     ,    
    }
}

//Program size: 610 bytes (used 60% of a 1 024 byte maximum) (0,58 secs)
//Minimum Memory Usage: 7 bytes (11% of a 64 byte maximum)</code></pre></div></div><br>
<h4 id="slozhnaya-logika-prostoy-knopki">   </h4><br>
<p>     ,          .         ‚Äî   btn_cnt (     ),    (        )               .</p><br>
<pre><code class="cpp">#define PERIOD_PRESS_BUTTON_SHORT   QT_SECOND           //      -  
#define PERIOD_PRESS_BUTTON_LONG    QT_SECOND*6         //      - /
uint8_t scan_button_cnt;    //    
        //  
        if(BUTTON_ON){
            if(scan_button_cnt&lt;USHRT_MAX){
                scan_button_cnt++;      //   1/37     
            }
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_SHORT){
                    // ,     
            }
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_LONG){
                    //     
            }
        }
</code></pre><br>
<p>    ‚Äî      .</p><br>
<p><img src="https://habrastorage.org/webt/fe/k6/6_/fek66_j4lcziqglnpmyudph1ujc.jpeg"></p><br>
<p>     SLEEP_MODE_IDLE (     CPU),   PwrDown    SLEEP_MODE_PWR_DOWN ‚Äî         <del>  </del>   watchdog     INT0,   ,     ‚Äî      INT0.</p><br>
<p><img src="https://habrastorage.org/webt/0w/82/0k/0w820klrlwg0enib-pznejydfp0.png"></p><br>
<p> <abbr title=""></abbr>      .   7.Power management and sleep modes   ATtiny13  ,      5-10 ,          . </p><br>
<p>             8- ,    ‚Äî 2        . </p><br>
<pre><code class="cpp">//  uint8_t f_button_state_flags;       //        

//      MODES:  wakeup 11 -&gt; work 00 -&gt; tosleep 01 -&gt; pwrdown 11 -&gt; wakeup 11
#define MODE_LBIT 0
#define MODE_HBIT 1
#define FORCE_SET_NEW_SIGNAL_BIT        2   //             current_signal
//    3
#define LIGHT_SIGNAL_ALT_MODE_BIT       4   // =0 (--)  =1 ( )   
#define USE_FIRST_VALUES_LIGHT_BIT      5   //     -  lightSignalization  
#define SHORT_PRESS_FLAG_BIT    6   // , 1       
#define LONG_PRESS_FLAG_BIT     7 // , 1       </code></pre><br>
<p> ,       ‚Äî    ,    ‚Äî   CPU     .          ,         if-.</p><br>
<div class="spoiler"><b class="spoiler_title">   </b><div class="spoiler_text"><pre><code class="cpp">#include &lt;limits.h&gt;         // USHRT_MAX
#include &lt;avr/io.h&gt;         //     IDE
#include &lt;avr/sleep.h&gt;      // ,     
#include &lt;avr/interrupt.h&gt;  //   
#include &lt;avr/pgmspace.h&gt;   //    

#ifdef GIMSK    //  ATtiny13 -       
#define F_CPU 9600000UL     //      ,   
#define ONE_SECOND  37      //     1 
#define QT_SECOND   9       //  
// GIMSK &amp;= ~_BV(INT0); -   INT0  
#define DISABLE_EXTERNAL_INT0   GIMSK &amp;= ~(_BV(INT0)); GIFR  &amp;= ~(_BV(INTF0))   //EIMSK/EIFR  
//GIMSK |= _BV(INT0) -   INT0
#define ENABLE_EXTERNAL_INT0    GIMSK |= _BV(INT0)  ; GIFR  &amp;= ~(_BV(INTF0))
#else           // 328 -   
#define F_CPU 16000000UL
#define ONE_SECOND  64      //     1  - .   
#define QT_SECOND   16      //  
// 328 INT0 -  PD2...     ,       (,  ),            
#define DISABLE_EXTERNAL_INT0   EIMSK &amp;= ~(_BV(INT0)); EIFR  &amp;= ~(_BV(INTF0)) 
// ,   -  EICRA - ISC00-ISC01 == 00, lo level, EIMSK - INT0, EIFR-INTF0  
#define ENABLE_EXTERNAL_INT0    EIMSK |= _BV(INT0)  ; EIFR  &amp;= ~(_BV(INTF0))
#endif

#define MAX_GLOBAL_TIMER_VALUE  (USHRT_MAX / 2)     // uint16_t globalTimer -   . 65535 /2 
//     ,  MAX_GLOBAL_TIMER_VALUE - 1
#define PERIOD_PRESS_BUTTON_SHORT   QT_SECOND/2         //      ( - ) -  
#define PERIOD_PRESS_BUTTON_LONG    QT_SECOND*4         //      - /
#define PERIOD_FLASH_GREEN          QT_SECOND           //     ( ) -    
#define PERIOD_FLASH_YELLOW         ONE_SECOND * 1      //     -    - 

                                            //  --- 
#define PERIOD_0        ONE_SECOND * 5      // R G R G  0.  ---   (5 )
#define PERIOD_1        ONE_SECOND * 3      //R g R g   1.  ---   (3 )     
#define PERIOD_2        ONE_SECOND * 1      //R Y R Y   2.  ---  (1 )
#define PERIOD_3        ONE_SECOND * 2      //RY Y RY Y 3. + ---  (2 ) 
#define PERIOD_4        ONE_SECOND * 7      // G R G R  4.  ---   (7 )
#define PERIOD_5        ONE_SECOND * 3      //g R g R   5.   --- (3 )
#define PERIOD_6        ONE_SECOND * 1      //Y R Y R   6.  ---  (1 )
#define PERIOD_7        ONE_SECOND * 2      //Y RY Y RY 7.  --- + (2 )

//  /  .     -     
typedef struct{
    const uint8_t ddr_val_0;    // DDRB value    
    const uint8_t port_val_0;   // PORTB value  
    const uint8_t ddr_val_1;    // DDRB value    
    const uint8_t port_val_1;   // PORTB value
    const uint16_t flash_period;    // period of flashing -   _val_1  _val_0 ( =0,  )
    const uint16_t signal_period;   // period of this lighting state ( =0,       )
}lightSignalization;            //   , _0  _1 -   , flash_long -   

//    (PINS === 0 0 0 g r y0 btt y1):
 //     ""     
#define BUTTON_PIN  PB1     // ,   INT0. ,   ,  = LOW
#define RED_PIN     PB3     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 
#define YELLOW0_PIN PB2     // OUT: 1 -  "-" 
#define YELLOW1_PIN PB0     // OUT: 1 -  "-" 
#define GREEN_PIN   PB4     // OUT: 1 - "-" , 0 - "-" , IN -  , ,  (!) 

#define BUTTON_ON  !(PINB &amp; _BV(BUTTON_PIN))    //( (PINB &amp; _BV(BUTTON)) == 0)  //  " "
#define BUTTON_OFF  (PINB &amp; _BV(BUTTON_PIN))    // ~(PINB &amp; _BV(BUTTON)) -\\- " "

#define RED     _BV(RED_PIN)            // _BV -     (), 1&lt;&lt;VALUE
#define YELL0   _BV(YELLOW0_PIN)        //    -
#define YELL1   _BV(YELLOW1_PIN)
#define GREEN   _BV(GREEN_PIN)          //    - (  0 -   -)  DDR=1

//      lightSignalization traffic_signals[]
#define LIGHT_NUM_YELLOW_FLASH  8       //       ( ) -  - flash yellows lights
#define LIGHT_NUM_STD_START     0       //        (--)
#define LIGHT_NUM_LIGHTS_OFF    9       //      -   - traffic lights off
#define LIGHT_NUM_START_SHOW    10      //         
#define LIGHT_NUM_ERR           11      //   -     

#define MASK_LIGHT_NUM_STD      7       // ___++ &amp;= LIGHT_NUM_STD_MASK -    0  7   

//....................................  
// 
const lightSignalization traffic_signals[] PROGMEM= {   //   ,  ,   -, PINS === 0 0 0 g r y0 btt y1
 // {DDRB0, PORTB0,   DDRB_flashing, PORTB_flasinf (if flashing),   continuous of half-period flashing,   continuous id mode running}
    {RED|GREEN, RED,   0, 0,   0, PERIOD_0},                    // R G R G
    {RED, RED,  RED|GREEN, RED,   QT_SECOND, PERIOD_1},         // R g R g - flash east green
    {RED|YELL1, RED|YELL1,   0, 0,   0, PERIOD_2 },             // R Y1 R Y1
    {RED|YELL0|YELL1, RED|YELL0|YELL1,  0, 0,   0, PERIOD_3 },  // RY0 Y1 RY0 Y1
    {RED|GREEN, GREEN,   0, 0,   0, PERIOD_4},                  // G R G R
    {RED|GREEN, GREEN,   RED, 0,    QT_SECOND, PERIOD_5 },      // g R g R - flash nord green
    {RED|YELL0, YELL0,   0, 0,   0, PERIOD_6},                  // Y0 R Y0 R
    {RED|YELL0|YELL1,  YELL0|YELL1,   0, 0,   0, PERIOD_7  },   // Y0 RY1 Y0 RY1

    {YELL0|YELL1, YELL0|YELL1,   YELL0|YELL1, 0,  ONE_SECOND, 0},   // y0 y1 y0 y1 - flash yellows lights 
    {0, 0,   0, 0,   0, 0},             //  traffic lights off, 
    {RED|GREEN|YELL0, RED|YELL0,   RED|GREEN|YELL1, GREEN|YELL1,   1, PERIOD_2},        //  PERIOD_2  -      ,     

    {YELL0|GREEN, YELL0,   YELL1|GREEN, YELL1|GREEN,  1, 0}     //  -     
};

volatile uint16_t  globalTimer; //      64   
uint8_t scan_button_cnt;        //      
uint16_t tl_flash_end;          // 2       ( !0), 
uint16_t tl_signal_end;         // 2            ( !0) 
uint8_t f_button_state_flags;   // 1,        
// , 8    

#pragma region bits_of_f_button_state_flags 
    //      MODES:  wakeup 11 -&gt; work 00 -&gt; tosleep 01 -&gt; pwrdown 11 -&gt; wakeup 11
#define MODE_LBIT 0
#define MODE_HBIT 1
#define MODE_VALUE          ( f_button_state_flags &amp; 3 )    //  -   MODE_
#define SET_MODE_WORK       f_button_state_flags &amp;= ~(_BV(MODE_HBIT) );  f_button_state_flags &amp;= ~(_BV(MODE_LBIT) );// 00 - work
//  f_button_state_flags &amp;= ~( _BV(MODE_HBIT) | _BV(MODE_LBIT) ) -    ,  
#define MODE_WORK_VALUE     0
#define SET_MODE_TOSLEEP    f_button_state_flags &amp;= ~(_BV(MODE_HBIT)); f_button_state_flags |= _BV(MODE_LBIT)   // 01 - tosleep
#define MODE_TOSLEEP_VALUE  1
#define SET_MODE_PWRDOWN    f_button_state_flags |= _BV(MODE_HBIT); f_button_state_flags &amp;= ~(_BV(MODE_LBIT))   // 10 - pwrdown 
#define MODE_PWRDOWN_VALUE  2
#define SET_MODE_WAKEUP     f_button_state_flags |= _BV(MODE_HBIT); f_button_state_flags |= _BV(MODE_LBIT)      // 11 - wakeup  
#define MODE_WAKEUP_VALUE   3

#define FORCE_SET_NEW_SIGNAL_BIT        2   //             current_signal
#define IF_FORCE_SET_SIGNAL_FLAG        ( f_button_state_flags &amp; _BV(FORCE_SET_NEW_SIGNAL_BIT) )    // IF_ -    
#define SET_FORCE_SET_SIGNAL_FLAG       f_button_state_flags |=  _BV(FORCE_SET_NEW_SIGNAL_BIT)      // SET_ -    1
#define RES_FORCE_SET_SIGNAL_FLAG       f_button_state_flags &amp;= ~( _BV(FORCE_SET_NEW_SIGNAL_BIT) )  // RES_ -    0

//  3   

#define LIGHT_SIGNAL_ALT_MODE_BIT       4   // =0 (--)  =1 ( )   
#define IF_LIGHT_SIGNAL_ALT_MODE_FLAG   ( f_button_state_flags &amp; _BV(LIGHT_SIGNAL_ALT_MODE_BIT) )   //1( )  0(--)   ?
#define SET_LIGHT_SIGNAL_ALT_MODE_FLAG  f_button_state_flags |=  _BV(LIGHT_SIGNAL_ALT_MODE_BIT)
#define RES_LIGHT_SIGNAL_ALT_MODE_FLAG  f_button_state_flags &amp;= ~( _BV(LIGHT_SIGNAL_ALT_MODE_BIT) )
#define FLIP_LIGHT_SIGNAL_ALT_MODE_FLAG f_button_state_flags ^= _BV(LIGHT_SIGNAL_ALT_MODE_BIT)

#define USE_FIRST_VALUES_LIGHT_BIT      5   //     -  lightSignalization  
#define IF_USE_FIRST_VALUES_LIGHT_FLAG  (f_button_state_flags &amp; _BV(USE_FIRST_VALUES_LIGHT_BIT)) // lightSignalization._val_0 (1)  lightSignalization._val_1 (0)? -  
#define SET_USE_FIRST_VALUES_LIGHT_FLAG     f_button_state_flags |= _BV(USE_FIRST_VALUES_LIGHT_BIT)
#define RES_USE_FIRST_VALUES_LIGHT_FLAG     f_button_state_flags &amp;= ~( _BV(USE_FIRST_VALUES_LIGHT_BIT))
#define FLIP_USE_FIRST_VALUES_LIGHT_FLAG    f_button_state_flags ^= _BV(USE_FIRST_VALUES_LIGHT_BIT)     //  

#define SHORT_PRESS_FLAG_BIT    6   // , 1       
#define IF_SHORT_PRESS_FLAG     ( f_button_state_flags &amp; _BV(SHORT_PRESS_FLAG_BIT) )        // -   == 1
#define SET_SHORT_PRESS_FLAG    f_button_state_flags |= _BV(SHORT_PRESS_FLAG_BIT)
#define RES_SHORT_PRESS_FLAG    f_button_state_flags &amp;= ~(_BV(SHORT_PRESS_FLAG_BIT))

#define LONG_PRESS_FLAG_BIT     7 // , 1       
#define IF_LONG_PRESS_FLAG      ( f_button_state_flags &amp; _BV(LONG_PRESS_FLAG_BIT) )     // -   == 1
#define SET_LONG_PRESS_FLAG     f_button_state_flags |= _BV(LONG_PRESS_FLAG_BIT)
#define RES_LONG_PRESS_FLAG     f_button_state_flags &amp;= ~(_BV(LONG_PRESS_FLAG_BIT))
#pragma endregion

//....................................  
void setPeriods(uint8_t num, bool set_both_flash_and_signal);   //  tl_flash_end, tl_signal_end
void setPorts(uint8_t num, bool use_main_values);               //    
void inline init_timer_clock(){     //     
#ifdef GIMSK    //  ATtiny13 - 
    TCCR0B = _BV(CS02) | _BV(CS00); //  0 - clock frequency / 1024
    TIMSK0 |= _BV(TOIE0);           //      overflow interrupt
#else           //   , 328/16
    // 100 - prescaler 64; Foverflow = 16M/64*256 ~=976.56Hz,
    TCCR2B = (1&lt;&lt;CS22) | (1&lt;&lt;CS21) | (1&lt;&lt;CS20) ;  // 111 - CLK/1024, 16M/1024*254 - 1/64 
    TIMSK2 |=(1&lt;&lt;TOIE0);  // interrupt ovfl enable
    //Serial.begin(115200);
#endif
}

//....................................  
//
//  -  -    globalTimer  1/37 
#ifdef GIMSK    //  ATtiny13
ISR(TIM0_OVF_vect){
    globalTimer++;  //       . ,   while(1)   .
}
#else
//   0 -     , -   - -     2
ISR(TIMER2_OVF_vect){
    globalTimer++;
}
#endif
//   -    (,  ,    0)
ISR(INT0_vect){
    DISABLE_EXTERNAL_INT0;
    SET_MODE_WAKEUP;        //      POWER DOWN
    globalTimer = 0;        //  -  
    scan_button_cnt = 0;    //   
    RES_SHORT_PRESS_FLAG;   //
    RES_LONG_PRESS_FLAG;    //  
}

/*
//   - 
void inline dbg(){
    DDRB |= YELL0; PORTB ^= YELL0;
}
*/

//....................................  
//
int main() {
    uint8_t current_signal;             // 1    ,   traffic_signals

#pragma region Initialisation&amp;setup
    //     "  -". 
    set_sleep_mode(SLEEP_MODE_IDLE);    //   - .
    sleep_enable();             //    

    init_timer_clock();         //     

    globalTimer = 0;            //  -  
    SET_MODE_WORK;              //    
    SET_USE_FIRST_VALUES_LIGHT_FLAG;    //  
    scan_button_cnt = 0;        //   

    //       
    current_signal = LIGHT_NUM_START_SHOW;  //     -   /
    SET_FORCE_SET_SIGNAL_FLAG;              //    current_signal

    sei();      //    

#pragma endregion
    while(1){

#pragma region TimerOVF
        //   ? 
        if(globalTimer &gt; MAX_GLOBAL_TIMER_VALUE){
            globalTimer -= MAX_GLOBAL_TIMER_VALUE;          //   
            // 
            if(tl_flash_end){
                tl_flash_end -= MAX_GLOBAL_TIMER_VALUE;     //   ,  
            }
            if(tl_signal_end){
                tl_signal_end -= MAX_GLOBAL_TIMER_VALUE;    // //   ,  
            }
            // setPeriods(currentMode, false); //   12  ,  tl_.._end   ,     
        }
#pragma endregion

#pragma region ButtonState
        //  
        if(BUTTON_ON){
            if(scan_button_cnt &lt; USHRT_MAX){
                scan_button_cnt++;              //   1/37     
            }
            //   -  ,    
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_SHORT){
                SET_SHORT_PRESS_FLAG;       // ,     , 
            }
            if(scan_button_cnt &gt; PERIOD_PRESS_BUTTON_LONG){
                SET_LONG_PRESS_FLAG;        //     
            }
        }
#pragma endregion
#pragma region LightWorkLogic
        //      (tl_flash_end !=0 )
        if(tl_flash_end){
            //     
            if(globalTimer &gt; tl_flash_end){
                FLIP_USE_FIRST_VALUES_LIGHT_FLAG;               // !use_main_values -      ))
                setPorts(current_signal, IF_USE_FIRST_VALUES_LIGHT_FLAG);       //      
                setPeriods(current_signal, false);          //     ,   
            }
        }

        //         
        // -    operating_std     - -- 
        //    ,   +1   7
        if(tl_signal_end){
            //       (use_main_values -       -  )
            if((globalTimer &gt; tl_signal_end)  &amp;&amp; IF_USE_FIRST_VALUES_LIGHT_FLAG){
                current_signal ++;                          //   
                current_signal &amp;= MASK_LIGHT_NUM_STD;       //    3-,        0  7
                SET_FORCE_SET_SIGNAL_FLAG;      //    current_signal
            }
        }
#pragma endregion

#pragma region MODE_VALUELogic
        //   , 2  f_button_state_flags
        //? MODE_VALUE === pwrdown -&gt; wakeup -&gt; work -&gt; tosleep -&gt; pwrdown
        switch (MODE_VALUE){
        case (MODE_WAKEUP_VALUE):
            set_sleep_mode(SLEEP_MODE_IDLE);        //  !
            //   ,       - IF_BUTTON_LONG_FLAG
            if(IF_LONG_PRESS_FLAG){
                //      ?   !
                if(current_signal == LIGHT_NUM_LIGHTS_OFF){
                    //          ? LIGHT_NUM_ERR
                    current_signal = (IF_LIGHT_SIGNAL_ALT_MODE_FLAG) ? LIGHT_NUM_YELLOW_FLASH : LIGHT_NUM_STD_START;
                    SET_FORCE_SET_SIGNAL_FLAG;      //    current_signal
                }
            }
            //,  ...
            if(BUTTON_OFF){
                //      ,   
                if(IF_LONG_PRESS_FLAG){
                    SET_MODE_WORK;
                }else{  
                    //  , ,   ,  
                    SET_MODE_PWRDOWN;   //        
                }
                scan_button_cnt = 0;    //       
                RES_SHORT_PRESS_FLAG;   //   , 
                RES_LONG_PRESS_FLAG;
            }
            break;

        case (MODE_WORK_VALUE):
            //  ?
            if(scan_button_cnt &gt; 0){
                //   ?
                if(IF_LONG_PRESS_FLAG){
                    current_signal = LIGHT_NUM_LIGHTS_OFF;      //  
                    SET_FORCE_SET_SIGNAL_FLAG;                  //   -   " "
                    SET_MODE_TOSLEEP;                           //   !
                }
                // ? 
                if(BUTTON_OFF){
                    //     ?
                    if(IF_SHORT_PRESS_FLAG){
                        FLIP_LIGHT_SIGNAL_ALT_MODE_FLAG;    //     
                        current_signal = (IF_LIGHT_SIGNAL_ALT_MODE_FLAG) ? LIGHT_NUM_YELLOW_FLASH : LIGHT_NUM_STD_START; //    . 
                        SET_FORCE_SET_SIGNAL_FLAG;          //      current_signal
                    }
                    scan_button_cnt=0;
                    RES_SHORT_PRESS_FLAG; //    
                    RES_LONG_PRESS_FLAG;
                }
            }
            break;

        case (MODE_TOSLEEP_VALUE):
            //    -    .
            if(BUTTON_OFF){
                SET_MODE_PWRDOWN;       //    
            }
            break;

        case (MODE_PWRDOWN_VALUE):
            // !  , !  ?
            if(BUTTON_ON){
                set_sleep_mode(SLEEP_MODE_IDLE);
                SET_MODE_WAKEUP;
            }else{  
                //  ?  .
                scan_button_cnt = 0;
                RES_LONG_PRESS_FLAG;
                RES_SHORT_PRESS_FLAG;
                current_signal = LIGHT_NUM_LIGHTS_OFF;      // 
                SET_FORCE_SET_SIGNAL_FLAG;
                set_sleep_mode(SLEEP_MODE_PWR_DOWN);    //    -   while(1)
                ENABLE_EXTERNAL_INT0;                   //     
            }
            break;

        default:
            //!       -    .  -      
            current_signal = LIGHT_NUM_ERR;
            SET_FORCE_SET_SIGNAL_FLAG;
            //setPorts(current_signal,true);
            //setPeriods(current_signal,true);
            break;
        }
#pragma endregion

        //   ,      - ?
        if(IF_FORCE_SET_SIGNAL_FLAG){       //       current_signal
            RES_FORCE_SET_SIGNAL_FLAG;      //  
            SET_USE_FIRST_VALUES_LIGHT_FLAG;    //   -   0-   -
            setPorts(current_signal, IF_USE_FIRST_VALUES_LIGHT_FLAG);   //      #current_signal  
            setPeriods(current_signal, true);
        }

        //    1/37 . , ,  .
        sleep_cpu();    //       -   .
        }
}

//.................................... 
//
//    
 void setPorts(uint8_t num, bool  use_main_values){
    uint8_t val;
    DDRB = 0; PORTB = 0;
    //    () - ddr_val_0, else = ddr_val_1
//  val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0))
//                          : pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_1));

    //   ,    ,  ,   ,   14 (!!!)   .
    val = pgm_read_byte_near(&amp;(traffic_signals[num].ddr_val_0)+( (use_main_values) ? 0 : sizeof(uint8_t)*2 ) ); 

    val &amp;= ~_BV(BUTTON_PIN);    //    ,    - 
    DDRB = val;                 //    

    val = (use_main_values) ? pgm_read_byte_near(&amp;(traffic_signals[num].port_val_0)) 
                            : pgm_read_byte_near(&amp;(traffic_signals[num].port_val_1));
    val|= _BV(BUTTON_PIN);  //     -  -    
    PORTB = val;        //      
}

 //     (    )
void setPeriods(uint8_t num, bool set_both_flash_and_signal){
//  
    tl_flash_end = pgm_read_word_near (&amp;(traffic_signals[num].flash_period));   //  
    tl_flash_end = (tl_flash_end)? tl_flash_end + globalTimer : 0;  //    -      
    //if(tl_flash_end){         tl_flash_end += globalTimer;    } &lt;-     8  

    //     -    
    if(set_both_flash_and_signal){
        tl_signal_end = pgm_read_word_near(&amp;(traffic_signals[num].signal_period));  
        tl_signal_end = (tl_signal_end)? tl_signal_end + globalTimer : 0;           //     ,    
    }
}
//Program size: 976 bytes (used 95% of a 1 024 byte maximum) (0,83 secs)
//Minimum Memory Usage: 8 bytes (13% of a 64 byte maximum)</code></pre></div></div><br>
<p><em>Program size: 976 bytes (used 95% of a 1 024 byte maximum) (0,83 secs)<br>
Minimum Memory Usage: 8 bytes (13% of a 64 byte maximum)</em></p><br>
<p>.</p><br>
<p>    <del>  </del>      ATtiny13 .</p><br>
<h3 id="anatomiya--samshitovo-samannogo-svetofora"> - </h3><br>
<p>  (    ?)   .   ‚Äî   .           ,    ,  ,   .  ,     ,    .</p><br>
<div class="spoiler"><b class="spoiler_title">,  </b><div class="spoiler_text"><h4 id="mozgi"></h4><br>
<p> DipTrace       ¬´¬ª      ¬´PCB Layout¬ª,     .        ,    . </p><br>
<p><img src="https://habrastorage.org/webt/0j/vq/ag/0jvqagommqperqd6t4vsqpuywbg.png"></p><br>
<p>   ‚Äî       .</p><br>
<p><img src="https://habrastorage.org/webt/ye/zr/b0/yezrb07pnfknal2yrkkkt8z24ew.jpeg"></p><br>
<p>,           ,    .</p><br>
<p>              (      ,      80-    ).</p><br>
<p><img src="https://habrastorage.org/webt/a-/vw/zq/a-vwzqrzc8ttmxfyidyx5gku_e0.jpeg"></p><br>
<p>       CD .</p><br>
<p><img src="https://habrastorage.org/webt/be/84/yr/be84yr9lcf5qr9xmhfubcc0xi-q.jpeg"></p><br>
<p>  , ,  ,  .</p><br>
<p><img src="https://habrastorage.org/webt/4w/4p/ed/4w4pedh-im9ttbm6uhngc24vpge.jpeg"></p><br>
<p>  ‚Äî    .</p><br>
<p><strong></strong>: <em>        ,                 </em>.</p><br>
<p> ,  ,             .    ‚Äî   ,    .</p><br>
<p><img src="https://habrastorage.org/webt/wd/mv/p_/wdmvp_puf54uysk-0og-9lhogvk.jpeg"></p><br>
<h4 id="vnutrennosti"></h4><br>
<p>       ‚Äî  .  -  - "Craft&amp;Clay" 50-     70.    ,        .</p><br>
<p><img src="https://habrastorage.org/webt/v2/jw/q6/v2jwq6mmb4gvxkpljgamjqavhj4.jpeg"></p><br>
<p>          .</p><br>
<p><img src="https://habrastorage.org/webt/w9/jf/8f/w9jf8f1ze2h5lytg9rgy0c4yy8s.jpeg"></p><br>
<p>       15     130   .</p><br>
<p><img src="https://habrastorage.org/webt/a4/uf/n-/a4ufn-djsbpg3386o4pvqqcpjua.jpeg"></p><br>
<p>      ‚Äî    .</p><br>
<p><img src="https://habrastorage.org/webt/ud/tf/nz/udtfnznphbnuq_wmaap31rafnuq.jpeg"></p><br>
<p><img src="https://habrastorage.org/webt/ex/7j/xb/ex7jxbgh1bhqsmzbep9t9fnrije.jpeg"></p><br>
<p>   ‚Äî    .</p><br>
<p><img src="https://habrastorage.org/webt/5i/qs/1v/5iqs1v1pa6jqhnmjjfyuxmcqhgy.jpeg"></p><br>
<p>  ‚Äî     .</p><br>
<p><img src="https://habrastorage.org/webt/8l/hs/8x/8lhs8xpxud7pcd-w9ixy-qg-9a0.jpeg"></p><br>
<p>     .</p><br>
<p><img src="https://habrastorage.org/webt/xj/se/tn/xjsetne6jay2dlqlk_3mgsq4ica.jpeg"></p><br>
<p>  4     ,   2-3  , <br>
  ,      .</p><br>
<p><img src="https://habrastorage.org/webt/xu/6y/pl/xu6yplqtnq8o2yhdtj2cyjcbd3e.jpeg"></p><br>
<p>  .  , ,   ,  "   ". </p><br>
<p><img src="https://habrastorage.org/webt/ck/w7/id/ckw7idpowfs9zlrxpok7gqrhsso.jpeg"></p><br>
<p>,          . </p><br>
<p><img src="https://habrastorage.org/webt/wo/jn/rj/wojnrj1diuqw5hf8h56sxjdxyzs.jpeg"></p><br>
<p>       KSP.        ‚Äî    4  LED     5     .</p><br>
<p><img src="https://habrastorage.org/webt/kg/f7/qy/kgf7qyhiebdqb5seavzrvekyqaq.jpeg"></p><br>
<p>                ,    ,   DC-DC 0.9-5  ,     .</p><br>
<p><img src="https://habrastorage.org/webt/ol/5v/bz/ol5vbz1tlc-lmcmuczwf77obixc.jpeg"></p><br>
<p>     .  ,    ,         .</p><br>
<p><img src="https://habrastorage.org/webt/fb/jf/8-/fbjf8-u-p8gjm2u3ccnwfk9wzdk.jpeg"></p><br>
<h4 id="ozhivlenie"></h4><br>
<p>, ,  ,   .</p><br>
<p><img src="https://habrastorage.org/webt/wm/8v/ej/wm8vejbxienobpdzeretpbxp3yi.jpeg"></p><br>
<p>      ISP     10-   .</p><br>
<p><img src="https://habrastorage.org/webt/tn/eu/7u/tneu7uxc7bewhl9g_lfsajgx9ra.png"></p></div></div><br>
<h3 id="izuchenie-zhiznedeyatelnosti-svetofora">  </h3><br>
<p>     , ,  ,  -   .        ,     ,      "  ".      1.5 ,         ‚Äî   .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a>     ,      .</p><br>
<table>
<thead>
<tr>
<th> </th>
<th>, </th>
<th>, %/</th>
<th> , </th>
</tr>
</thead>
<tbody>
<tr>
<td>CR1212</td>
<td>18</td>
<td>1</td>
<td>0.250</td>
</tr>
<tr>
<td>CR1620</td>
<td>68</td>
<td>1</td>
<td>0.950</td>
</tr>
<tr>
<td>CR2032</td>
<td>210</td>
<td>1</td>
<td>3</td>
</tr>
<tr>
<td>NiCD AAA</td>
<td>350</td>
<td>20</td>
<td>98</td>
</tr>
<tr>
<td>NiMH AAA</td>
<td>900</td>
<td>30</td>
<td>375</td>
</tr>
<tr>
<td>NiCd AA</td>
<td>1000</td>
<td>20</td>
<td>270</td>
</tr>
<tr>
<td>Alkaline AAA</td>
<td>1250</td>
<td>2</td>
<td>35</td>
</tr>
<tr>
<td>NiMH AA</td>
<td>2400</td>
<td>30</td>
<td>1000</td>
</tr>
<tr>
<td><strong>Alkaline AA</strong></td>
<td><strong>2890</strong></td>
<td><strong>2</strong></td>
<td><strong>80</strong></td>
</tr>
<tr>
<td>Li-Ion</td>
<td>4400</td>
<td>10</td>
<td>600</td>
</tr>
</tbody>
</table><br>
<p>     ,      . ,    ,     (2/100)<em>2890/(24</em>30) = 80 .  ,    2    ,  32      ATtiny13.</p><br>
<p>         :       ,    GPIO,      .    ‚Äî ,        ( 4   14   ""),      ,        40 . </p><br>
<p>,        ‚Äî    .      ,      .  ,      :      5      DC-DC ,   ,          DC-DC      1.5  -&gt; 5 .        , -       +-20%,   .</p><br>
<p><img src="https://habrastorage.org/webt/ab/3v/sb/ab3vsbnwkhp2rc9tvyzv6ltyypy.png"></p><br>
<p>  ,     ""   4-5 (5 ) ,    , 25 (1.5 ),    </p><br>
<p><img src="https://habrastorage.org/webt/wx/nl/q5/wxnlq5fnsspt1cpgsdpwngtbwos.png"></p><br>
<p>.. 2890       116 ,    .   ATtiny13    POWER DOWN        . ,       ‚Äî       .         20-50 ,    , Hi-Z,   1 .  ,   DC-DC      .</p><br>
<p>         2  5 . :         .</p><br>
<h2 id="nekotorye-processy-mozhno-tolko-prekratit-no-ne-zakonchit">    ,   </h2><br>
<p>  ,      :</p><br>
<ul>
<li>   ,   ‚Äî ,      R2,       ,    .     .</li>
<li>   .           ‚Äî         1/37 ,          .</li>
<li>               ,      ,  .    POWER_DOWN     30 ,      ,     ,         .</li>
<li>  traffic_signals   8   4,   .   4 pin ‚Äî  1     DDR  PORTB</li>
<li>  uint16_t  signal_period  flash_period ‚Äî  ,     ,   1    .</li>
<li>   ‚Äî  ROM    2 ,    ‚Äî     -      .</li>
<li>             /UART.</li>
<li>   main   ‚Äî      ‚Äî  +50   ROM.</li>
<li>       9,6    128 ,       .</li>
</ul><br>
<p>.</p><br>
<p>       :    " ", ,  8 ,   ,    ¬´¬ª    .</p><br>
<p>         .</p><br>
<h2 id="video-raboty"> </h2><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/23ju4JVKMeA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<p>   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Github</a>,   MIT.</p></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de443188/">https://habr.com/ru/post/de443188/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de443178/index.html">Crystal Blockchain Analytics: Untersuchung der Hacks und Diebstahlsf√§lle</a></li>
<li><a href="../de443180/index.html">Crew Dragon Landung und Asteroiden Videoaufnahme</a></li>
<li><a href="../de443182/index.html">Ziehen Sie YPbPr vom Commodore 64</a></li>
<li><a href="../de443184/index.html">Von der Liebe zur Kontrolle einen Schritt</a></li>
<li><a href="../de443186/index.html">3CX Technical Support antwortet - 5 IP PBX-Sicherheitsregeln</a></li>
<li><a href="../de443190/index.html">Einf√ºhrung in die Kubernetes-Netzwerkrichtlinien f√ºr Sicherheitsexperten</a></li>
<li><a href="../de443192/index.html">Private Methoden ohne Unterstriche und Schnittstellen in Python</a></li>
<li><a href="../de443194/index.html">Die WFIRM-Ingenieure haben einen Bioprinter erfunden, der die Haut direkt auf eine Wunde druckt</a></li>
<li><a href="../de443196/index.html">Keine Minute offline - Auswahl eines industriellen LTE-Routers</a></li>
<li><a href="../de443198/index.html">Laut Mark Zuckerberg arbeitet Facebook an einer neuronalen Schnittstelle zum Lesen von Gedanken</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>