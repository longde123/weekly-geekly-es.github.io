<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòà ‚õ∞Ô∏è üë®üèº‚Äçüî¨ Greedy Gnome: mientras escrib√≠a an√°lisis de mercado en Lineage 2 üè∫ üö∂üèΩ üîû</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Entonces ha llegado el tiempo de oto√±o-invierno. Fuera de la ventana, las lluvias y el deseo de pasar tiempo al aire libre son cada vez menos. Y luego...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Greedy Gnome: mientras escrib√≠a an√°lisis de mercado en Lineage 2</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/429244/"><p>  Entonces ha llegado el tiempo de oto√±o-invierno.  Fuera de la ventana, las lluvias y el deseo de pasar tiempo al aire libre son cada vez menos.  Y luego llega un mensaje de un amigo m√≠o: "¬ø <em>Juguemos a <strong>Lineage 2</strong></em> ?"  Y nuevamente, cediendo a la nostalgia, acept√©.  Elegimos un servidor nuevo en la ru y los personajes creados. </p><br><img src="https://habrastorage.org/webt/gd/jh/t1/gdjht1oa4v3ooibwdzyoxptvenc.jpeg"><br><p><br>  A diferencia de World of Warcraft, Lineage 2 tiene un sistema de miner√≠a de monedas de juego completamente diferente.  Necesitas cazar monstruos durante todo el d√≠a con el fin de obtener ganancias.  Incluso fue un descubrimiento para m√≠ que para algunas personas el RMT (comercio con dinero real) es un poco de trabajo.  Adem√°s, el juego tiene una econom√≠a que los jugadores forman.  En otras palabras, puede ganar dinero comprando y vendiendo o comprando recursos baratos, sacar provecho de ellos y vender con una prima.  Dado que para nosotros el juego sigue siendo una especie de relajaci√≥n, fue esta forma de obtener la divisa del juego la que elegimos. </p><br><p>  Para comprar y vender art√≠culos, el jugador debe estar en l√≠nea (Captura de pantalla anterior).  En consecuencia, alguien quiere vender m√°s r√°pido (m√°s barato) y alguien compra r√°pidamente (m√°s caro).  Pero, ¬øqu√© pasa si la diferencia es vender - comprar positivo?  Solo este ejemplo ser√° considerado en el art√≠culo como resultado. </p><br><p>  Sin embargo, los precios de mercado son bastante inestables y a menudo cambian.  Por lo tanto, es probable que compre algo "barato" y luego incluso m√°s barato para vender con un beneficio negativo.  Esto es lo que estamos tratando de evitar.  En general, se decidi√≥ escribir un <em>sistema de an√°lisis de mercado</em> y tratar con un par de tecnolog√≠as que me interesan. </p><br><p>  <strong>Spoiler</strong> <br>  Las siguientes tecnolog√≠as se utilizar√°n en el art√≠culo. <br>  Notificaci√≥n de bot de Docker, DigitalOcean, NodeJs, Ktor, Prometheus, Grafana, Telegram </p><a name="habracut"></a><br><h1>  Primero fueron los datos </h1><br><p>  Para analizar algo, primero necesitamos obtener esto.  Se consideraron 2 opciones para obtener informaci√≥n. </p><br><p>  <u>Sniffing</u> : escriba una aplicaci√≥n que escuche el tr√°fico y lo analice.  Las desventajas de este enfoque son muy simples.  Debe estar constantemente en l√≠nea y observar el mercado, y de acuerdo con la pol√≠tica del servidor, pueden prohibirlo.  Sin embargo, me gustar√≠a una acci√≥n m√≠nima por parte del usuario y es deseable automatizar todo lo m√°s posible. </p><br><p>  <u>An√°lisis</u> : hay un sitio que se especializa en oler este juego: l2on.net.  Justo lo que necesitamos!  Le damos el papel de un recopilador de datos sin procesar a este servicio.  Solo queda obtener de alguna manera los datos y comenzar a experimentar con ellos. <br></p><br><img src="https://habrastorage.org/webt/xt/wc/1k/xtwc1kiirfrvwnv_epcueloqk0m.png"><br><p></p><br><p>  Seg√∫n la cadena de consulta, entendemos que necesitamos pasar la identificaci√≥n del recurso para obtener informaci√≥n sobre ella.  Sin embargo, si automatizamos esto, tambi√©n es necesario transferir la identificaci√≥n del servidor del juego.  Despu√©s de cavar un minuto en el c√≥digo fuente de la p√°gina, se encontr√≥ lo siguiente: <br></p><br><img src="https://habrastorage.org/webt/_j/zd/em/_jzdemfcobutgb4cgyh9s5w7gcy.png"><br><p><br>  Intentando ... ¬°Genial!  Obtenemos una lista de precios de compra y venta. <br>  Ahora debe pensar en c√≥mo analizar el sitio. </p><br><p>  La elecci√≥n recay√≥ en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Titiritero</a> para NodeJs. <br>  Sobre esta base <strong>,</strong> se cre√≥ el primer m√≥dulo del subsistema, <strong>Scrapper</strong> .  Su tarea principal es ir al sitio, abrir, analizar y devolver datos en forma de JSON.  Tomamos una muestra de los √∫ltimos N elementos, consideramos los precios promedio, m√≠nimo y m√°ximo.  (Mirando hacia el futuro, dir√© que necesita refinar el percentil para editar el ruido si alg√∫n jugador pone un precio demasiado alto en la venta o bajo en la compra) Obtenemos la respuesta de acuerdo con los datos: <br></p><br><img src="https://habrastorage.org/webt/um/v0/qh/umv0qhmk3b1zlorvoauwx9-warq.png"><br><p><br>  Ahora podemos pasar a la siguiente parte: <em>almacenamiento de datos</em> . </p><br><p>  Supongamos que tenemos 2-3 consumidores de nuestros datos y queremos darles una matriz.  Tambi√©n queremos evitar las frecuentes solicitudes de l2on para no ser incluido en la lista negra.  Por lo tanto, necesitamos crear un segundo m√≥dulo que act√∫e como intermediario entre l2on y nuestros agentes. </p><br><p>  La metodolog√≠a de la encuesta fue elegida simple.  Una vez cada 5 minutos, el m√≥dulo debe solicitar todos los elementos de la lista establecida y proporcionar resultados como datos para un recurso, as√≠ como resultados para an√°lisis. </p><br><p>  Para este sistema, quer√≠a probar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ktor</a> , una soluci√≥n de servidor en Kotlin. <br>  No utilic√© la base de datos, pero decid√≠ almacenar los √∫ltimos datos en Singleton.  S√≠, la soluci√≥n no es la m√°s elegante, pero se ajusta r√°pidamente y siempre podremos optimizarla. </p><br><p>  Entonces apareci√≥ el segundo m√≥dulo del sistema: <strong>Harvester</strong> . <br>  Harvester proporciona al usuario dos puntos finales / item / {id} y / metrics <br>  Si todo est√° claro con el primero, el √∫ltimo devuelve datos en el formato para el pr√≥ximo sistema: <strong>Prometheus</strong> </p><br><img src="https://habrastorage.org/webt/sw/kw/cd/swkwcdgzed4wpz8id7sdnp7ceqy.png"><br><img src="https://habrastorage.org/webt/hi/jf/h8/hijfh82bupsk2kdksroqxf_ppsy.png"><br><h1>  Almacenamiento de datos para an√°lisis </h1><br><p>  El enlace intermedio fue seleccionado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Prometheus</a> , una base de datos de c√≥digo abierto para an√°lisis que funciona a trav√©s del enfoque Pull.  En otras palabras, al configurar, debe especificar en el archivo yaml el conjunto de proveedores de datos y la frecuencia de sondeo.  En nuestro caso, este es exactamente el mismo punto final / metrics. </p><br><p>  Intentamos ejecutar Prometheus (por defecto es el puerto 9090) y si vemos algo similar a Target: <br></p><br><img src="https://habrastorage.org/webt/vq/1f/_9/vq1f_9rh_3fy5h6na8gogngdtww.png"><br><p><br>  Entonces estamos en el camino correcto.  Esto significa que cada 30 segundos, Prometheus va a Harvester y recoge el √∫ltimo estado de todos los productos que nos interesan. </p><br><h1>  Visualizaci√≥n de datos </h1><br><p>  La siguiente etapa es una hermosa pantalla gr√°fica. </p><br><p>  Para la representaci√≥n, se seleccion√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Grafana,</a> que tambi√©n es de c√≥digo abierto. <br>  Adem√°s de Grafana y Prometheus, est√°n disponibles en forma de contenedores Docker que requieren un m√≠nimo de acci√≥n del usuario. </p><br><p>  Cuando inicie por primera vez Grafana (puerto est√°ndar 3000), le pedir√° que especifique una base de datos disponible.  Seleccionamos Prometheus como base y prescribimos la direcci√≥n.  Si todo va bien, entonces veremos: <br></p><br><img src="https://habrastorage.org/webt/cf/h_/cn/cfh_cnonbcdyolueoyqustssjac.png"><br><p><br>  El siguiente paso es dibujar gr√°ficos. </p><br><p>  Un ejemplo de una solicitud para dibujar un gr√°fico de ventas: <br></p><br><img src="https://habrastorage.org/webt/vc/m5/3r/vcm53ri4w_zrynpcp7fezm7dw3a.png"><br><p><br>  Por lo tanto, en cualquier momento vemos el precio promedio de la compra y venta, as√≠ como la din√°mica de los precios. <br></p><br><img src="https://habrastorage.org/webt/be/hf/_w/behf_wpfl8f_mfvqjv6upqe1yxi.png"><br><p><br>  Sin embargo, hay momentos en que el precio m√≠nimo de venta es m√°s alto que el precio m√°ximo de compra.  Esto significa que podemos obtener ganancias f√°ciles en forma de "comprar y vender".  Para el canal de env√≠o, Telegram seleccion√≥ la notificaci√≥n.  Cree un bot y agregue su token a Grafana (s√≠, s√≠, admite notificaciones) <br></p><br><img src="https://habrastorage.org/webt/3c/zc/cb/3czccb4qcvsney3oszcuk5kctaq.png"><br><p><br>  Es suficiente simplemente establecer la condici√≥n bajo la cual nos llegar√° esta notificaci√≥n. <br></p><br><img src="https://habrastorage.org/webt/rg/xw/d5/rgxwd5zjonbwwdf3vnbryywbxdu.png"><br><p><br>  Como podemos ver en el gr√°fico, tales situaciones ocurren en el mercado. <br></p><br><img src="https://habrastorage.org/webt/di/mp/ql/dimpqln0oq39ou9jn2qnbxwu4vq.jpeg"><br><p></p><br><h1>  Nube </h1><br><p>  Empacamos cada subsistema en el contenedor Docker y lo cargamos en DigitalOcean u otros servicios a su gusto.  Pero esto no nos impide iniciar todo este sistema sin una IP dedicada.  Ahora el contenedor m√≠nimo para DO cuesta $ 5 por mes. </p><br><p>  Comience Scrapper Primero <br>  docker run -d -p 6661: 6661 --name scrapper l2 / scrapper: latest </p><br><p>  Detr√°s de √©l Harvester <br>  docker run -d -p 6662: 6662 -v / root / harvester: / res --link scrapper: scrapper l2harvester: latest <br>  El archivo ids.txt con el formato debe estar en la carpeta / harvester </p><br><p>  id1 nombre1 <br>  id2 nombre2 </p><br><h1>  Conclusi√≥n </h1><br><p>  En definitiva, el sistema es el siguiente: </p><br><img src="https://habrastorage.org/webt/yc/mc/ab/ycmcabimfltt1nakqxjfwfgmu3i.png"><br><p>  Est√° previsto agregar en el futuro un agente para actualizar Google Docs y calcular el costo de la creaci√≥n sobre la marcha. </p><br><p>  No s√© si este tiempo de operaci√≥n traer√° alg√∫n beneficio, pero para m√≠ personalmente fue una buena experiencia actualizar mis conocimientos en el campo aplicado.  Mi especificidad principal son las aplicaciones m√≥viles.  El desarrollo del lado del servidor es una habilidad y curiosidad adicionales. </p><br><p>  Como suplemento, adjunto enlaces para familiarizarme con el c√≥digo: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Scrapper</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cosechadora</a> <br>  (Puedes recoger contenedores por equipos <br>  Docker build -t scrapper. <br>  Docker build -t cosechadora.) </p><br><p>  Realmente espero que este art√≠culo haya inspirado a alguien con sentimientos nost√°lgicos, o haya inspirado alguna idea nueva.  ¬°Gracias por leer el art√≠culo hasta el final! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es429244/">https://habr.com/ru/post/es429244/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es429234/index.html">Creaci√≥n del juego "Me gusta las monedas" en Godot Engine. Parte 1</a></li>
<li><a href="../es429236/index.html">¬øCu√°ntos cient√≠ficos de datos necesita para encender una bombilla (o qu√© equipo har√° que los datos funcionen para el negocio)</a></li>
<li><a href="../es429238/index.html">Una vez m√°s sobre los niveles</a></li>
<li><a href="../es429240/index.html">C√≥mo intent√© arreglar un mapa de b√∫squeda de controladores</a></li>
<li><a href="../es429242/index.html">‚ÄúNo seas t√≠mido. ¬°Pru√©balo! Entrevistas sobre la vida, compiladores y la vida en compiladores con Unity Alexandre Mutel</a></li>
<li><a href="../es429246/index.html">Pr√°cticas de verano en Mars IS: una mirada al interior</a></li>
<li><a href="../es429248/index.html">Consejos pol√≠glotas: c√≥mo aprender cualquier idioma sin l√°grimas y maldiciones</a></li>
<li><a href="../es429250/index.html">Cien recetas de contabilidad digital</a></li>
<li><a href="../es429252/index.html">An√°lisis est√°tico de aplicaciones m√≥viles.</a></li>
<li><a href="../es429254/index.html">Sobre las curvas de Bezier y la velocidad de Arduino, segunda parte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>