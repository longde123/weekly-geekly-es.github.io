<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí≥ üò∑ ü§¶üèæ La historia de la creaci√≥n de una nube dom√©stica. Parte 3. Crear una nube personal: instalar y configurar Nextcloud üëÆ ‚òùüèæ ü§∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En el camino a la creaci√≥n de nuestro propio servicio en la nube, mientras nos acostumbramos al sistema Debian y creamos un servidor web . Ahora es el...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La historia de la creaci√≥n de una nube dom√©stica. Parte 3. Crear una nube personal: instalar y configurar Nextcloud</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/410011/">  En el camino a la creaci√≥n de nuestro propio servicio en la nube, mientras nos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">acostumbramos al sistema Debian</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">creamos un servidor web</a> .  Ahora es el momento del paso final: crear y configurar una nube personal basada en el servidor de Nextcloud. <br><br><img src="https://habrastorage.org/webt/hd/zf/np/hdzfnpy3coj3pu5hr6xs8ssjop8.jpeg"><br><a name="habracut"></a><br><hr><a name="chap0"></a><br><h3>  Tabla de contenidos </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Parte 1. Configurar su entorno Debian para el uso diario</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Parte 2. Crear un servidor - configurar LAMP en Debian</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Parte 3. Crear una nube personal: instalar y configurar Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">Parte 4. Actualizaci√≥n 2018 - Debian 9 y Nextcloud 13</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 5. Actualizaci√≥n 2019 - PHP 7.2, MariaDB 10.4 y Nextcloud 17</a> <br><br><hr><br><h3>  Navegaci√≥n r√°pida de cap√≠tulos </h3><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pr√≥logo</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Preparando un servidor para instalar Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Instalar Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Organizando el almacenamiento de Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configure el acceso a la m√°quina virtual de Nextcloud desde la red de √°rea local</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Configuraci√≥n de Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ajuste avanzado de Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Protecci√≥n para Nextcloud</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Smartphone Cloud Sync</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sincronizaci√≥n en la nube de computadora personal</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ep√≠logo</a> <br><br><hr><a name="chap1"></a><br><h3>  Pr√≥logo </h3><br>  Entonces llegamos a la cosa para la cual todo comenz√≥ y hacia la cual no avanzamos r√°pidamente.  Esta parte describir√° la instalaci√≥n y algunos puntos en la configuraci√≥n del servidor Nextcloud en la m√°quina virtual VMWare, as√≠ como una peque√±a experiencia trabajando con √©l en la forma de sincronizar el contenido de un par de tel√©fonos inteligentes y carpetas basados ‚Äã‚Äãen Windows en una computadora de escritorio.  Las siguientes instrucciones de instalaci√≥n para Nextcloud implican que el servicio se implementa en un servidor que se cre√≥ de acuerdo con las instrucciones de la parte anterior de mi historia. <br><br>  Inicialmente, este cap√≠tulo fue planeado para ser peque√±o, ya que quer√≠a limitarme a describir la instalaci√≥n y configuraci√≥n de Nextcloud, esencialmente terminando esta historia sobre "simplemente ingresar a Linux para una tarea espec√≠fica".  Pero, pensando que esto podr√≠a parecer interesante para alguien, decidi√≥ mostrar c√≥mo resolv√≠ el problema de sincronizar las carpetas de la computadora de mi casa, por lo que este cap√≠tulo final fluy√≥ sin problemas de las instrucciones claras sobre qu√© y c√≥mo hacer en la programaci√≥n.  Esto explica algunas "vinagretas" en esta parte: comienza con el trabajo y la configuraci√≥n en Linux, fluye al nivel de la red y la configuraci√≥n de software virtual, y termina con muletas de planeo en Windows.  Por otro lado, esta serie de art√≠culos tiene el t√≠tulo "Historia de la creaci√≥n ..." y decid√≠ contarlo hasta el final. <br><br>  <b>Nota</b> <br>  Al seguir leyendo en las construcciones del formulario http: // 127.0.0.1 (https: // 127.0.0.1), el espacio despu√©s de http: // (https: //) debe eliminarse al ingresar a la barra de direcciones del navegador.  Se insert√≥ un espacio al publicar este art√≠culo para evitar que el motor convierta autom√°ticamente el texto en enlaces. <br><br><hr><a name="chap2"></a><br><h3>  Preparando un servidor para instalar Nextcloud </h3><br>  Nextcloud es una aplicaci√≥n web que tiene un conjunto de archivos y funciona con una determinada base de datos MySQL.  La aplicaci√≥n web se instala como un sitio normal, para cuya instalaci√≥n debe cargar los archivos del "motor" en el servidor, ejecutar el archivo de instalaci√≥n y especificar los detalles de acceso a la base de datos creada previamente para este sitio durante la instalaci√≥n. <br><br>  Cree un directorio en el que se colocar√°n los archivos de Nextcloud: <br>  <b># mkdir / var / www / nextcloud</b> <br><br>  Decid√≠ rechazar HTTP, dejando el acceso solo a trav√©s de HTTPS.  Para hacer esto, necesita configurar apache. <br><br>  Abre el archivo: <br>  <b># nano /etc/apache2/sites-available/default-ssl.conf</b> <br>  Y antes de la etiqueta, agregue el siguiente contenido: <br><br><pre><code class="apache hljs"><span class="hljs-section"><span class="hljs-section">&lt;Directory /var/www/nextcloud&gt;</span></span> <span class="hljs-attribute"><span class="hljs-nomarkup"><span class="hljs-attribute"><span class="hljs-nomarkup">Options</span></span></span></span> FollowSymLinks AllowOverride <span class="hljs-literal"><span class="hljs-literal">All</span></span> Require <span class="hljs-literal"><span class="hljs-literal">all</span></span> granted &lt;/Directory&gt;</code> </pre> <br><br>  Deshabilitar configuraci√≥n HTTP: <br>  <b># a2dissite 000-default.conf</b> <br><br>  Cerrar puerto 80: <br>  <b># ufw delete allow 80</b> <br><br>  Y reinicie el servidor web: <br>  <b># service apache2 restart</b> <br><br>  Ahora necesita crear una base de datos para nextcloud.  Ingresamos mysql ingresando la contrase√±a del superusuario mysql: <br>  <b># mysql -u root -p</b> <br><br>  Crea una base de datos llamada nextcloud: <br>  <b>mysql&gt; CREAR BASE DE DATOS `nextcloud`;</b> <br><br>  Cree un usuario con el nombre nextcloud y la contrase√±a trivial nc123: <br>  <b>mysql&gt; CREAR USUARIO 'nextcloud' @ 'localhost' IDENTIFICADO POR 'nc123';</b> <br><br>  Le damos acceso completo al usuario de nextcloud a la base de datos de nextcloud: <br>  <b>mysql&gt; OTORGA TODOS LOS PRIVILEGIOS EN `nextcloud`. * A 'nextcloud' @ 'localhost';</b> <br><br>  Actualizar tabla de privilegios: <br>  <b>mysql&gt; PRIVILEGIOS DE LAVADO;</b> <br><br>  Salga de mysql: <br>  <b>mysql: mysql&gt; salir</b> <br><br>  Adem√°s, necesita instalar m√≥dulos adicionales para PHP: <br>  <b># apt-get install curl libcurl3 libcurl3-dev php5-curl</b> <b><br></b>  <b># a2enmod reescribir</b> <br><br>  En la primera parte de esta historia, abrimos puertos para la interacci√≥n de la red y el correo, pero para nuestro objetivo no son necesarios y es mejor cerrarlos.  Eliminar las reglas: <br>  <b># ufw delete allow 138 / udp</b> <b><br></b>  <b># ufw delete allow 139 / udp</b> <b><br></b>  <b># ufw delete allow 139 / tcp</b> <b><br></b>  <b># ufw delete allow 445 / tcp</b> <b><br></b>  <b># ufw delete permite 25</b> <b><br></b>  <b># ufw delete allow 465</b> <b><br></b>  <b># ufw delete allow 110</b> <b><br></b>  <b># ufw delete allow 143</b> <b><br></b>  <b># ufw delete allow 993</b> <br><br><hr><a name="chap3"></a><br><h3>  Instalar Nextcloud </h3><br>  Descargue los archivos y descompr√≠malos en el directorio deseado: <br>  <b># wget <a href="" rel="nofollow">download.nextcloud.com/server/releases/nextcloud-11.0.2.tar.bz2</a></b> <b><br></b>  <b># tar xjf nextcloud-11.0.2.tar.bz2 -C / var / www</b> <br><br>  Cambiar permisos de carpeta: <br>  <b># chmod 755 / var / www / nextcloud</b> <br><br>  Y asignamos al propietario de esta carpeta un servidor web para que no haya problemas al escribir en ella: <br>  <b># chown -R www-data: www-data / var / www / nextcloud</b> <br><br>  Eso es todo!  El servicio est√° instalado, si escribe en el navegador https: // 127.0.0.1/nextcloud, se abre el asistente de instalaci√≥n.  Pero esperemos con esto, habiendo preparado previamente un lugar para almacenar datos de usuario. <br><br>  Vale la pena mencionar que Nextcloud versi√≥n 11.0.2 actualmente est√° bastante desactualizada y contiene vulnerabilidades que no est√°n presentes en las versiones m√°s nuevas y m√°s actuales, por lo que si instala la rama 11.x, entonces es mejor instalar una versi√≥n m√°s reciente (a principios de 2018 - esto versi√≥n 11.0.7). <br><br><hr><a name="chap4"></a><br><h3>  Organizando el almacenamiento de Nextcloud </h3><br>  Esta parte es opcional y se puede omitir sin problemas: todo funcionar√° sin ella.  Sin embargo, si va a crear un directorio de datos fuera de la m√°quina virtual, le recomiendo que se familiarice con √©l. <br><br>  Por defecto, el contenido sincronizado se almacenar√° en el directorio / var / www / nextcloud / nxcdata.  Esta opci√≥n no me conven√≠a de inmediato por varias razones.  Por un lado, no quisiera aumentar constantemente el tama√±o del archivo de un disco virtual.  Por otro lado, me gustar√≠a tener una soluci√≥n de almacenamiento de datos de m√°quina virtual separada e independiente.  Lo m√°s simple que viene a la mente de inmediato es el uso de una unidad USB.  Si no hay suficiente espacio, la unidad simplemente se puede reemplazar.  Si es necesario, se puede conectar a otra computadora y descargar los archivos necesarios.  M√≥vil y conveniente.  Sin embargo, no quer√≠a usar USB 2.0 debido al ancho de banda relativamente peque√±o para los est√°ndares modernos, y no tuve √©xito con USB 3.0: el software de virtualizaci√≥n (WMVare y VirtualBox) no quer√≠a reenviar normalmente los dispositivos conectados a trav√©s de un controlador USB 3.0. <br><br>  Mi apetito en el proceso de creaci√≥n de la nube ha aumentado y ya no ten√≠a menos de un terabyte, as√≠ que al final decid√≠ conectar un disco duro normal de dos terabytes a la m√°quina virtual, que ya estaba ubicada y conectada dentro de la computadora.  Si es necesario, puede extraerse sin problemas y conectarse a trav√©s del adaptador SATA &lt;-&gt; USB 3.0 existente. <br><br>  Por lo tanto, la idea principal es organizar un punto permanente para conectar un directorio con contenido de usuario fuera del directorio / var / www / nextcloud, en el que se crea un enlace simb√≥lico llamado nxcdata que se refiere al directorio de datos real, que se puede conectar de varias maneras en diferentes medios. <br><br>  Crea un directorio: <br>  <b># mkdir / mnt / nxcdata</b> <br><br>  Cambiamos los derechos: <br>  <b># chmod 770 / mnt / nxcdata</b> <br><br>  Hacemos que el propietario del servidor web: <br>  <b># chown www-data: www-data / mnt / nxcdata</b> <br><br>  Puedo colocar los datos en cualquier lugar y en cualquier lugar, lo principal es colocar un enlace simb√≥lico a este directorio en el directorio / mnt / nxcdata y nombrarlo nxcdata, es decir  la ruta completa se ver√° como / mnt / nxcdata / nxcdata. <br><br>  Primero, prob√© la soluci√≥n para la carpeta local que cre√© en el directorio de inicio. <br><br>  Cre√≥ una carpeta en el lugar correcto: <br>  <b>$ mkdir / inicio / usuario / nxcdata</b> <br><br>  Cambi√≥ los derechos: <br>  <b># chmod 755 / home / user / nxcdata</b> <br><br>  Propiedad del servidor web: <br>  <b># chown -R www-data: www-data / home / user / nxcdata</b> <br><br>  Cre√≥ un enlace simb√≥lico: <br>  <b># ln -s / home / user / nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  Esta soluci√≥n fue viable, por lo que puede seguir adelante.  El directorio de datos externo se puede conectar de dos maneras: a trav√©s del servicio VMWare Shared o directamente como un disco f√≠sico o partici√≥n.  Debe entenderse que la primera soluci√≥n es posible solo si se instalan las herramientas de vmware, que se instalan sin problemas solo si hay una interfaz gr√°fica del sistema operativo (de lo contrario, tendr√° que editar los scripts de instalaci√≥n de las herramientas de vmware).  Si abandonamos la interfaz gr√°fica, solo queda la opci√≥n de conectar el disco directamente a la m√°quina virtual, pero con esta soluci√≥n tuve que sufrir mucho.  Despu√©s de alg√∫n tiempo, todav√≠a encontr√© una versi√≥n de trabajo estable, teniendo en cuenta que se invent√≥ un script universal, que incorporaba ambas opciones de conexi√≥n. <br><br>  Para una carpeta conectada mediante VMWare Shared Folders en la secci√≥n Carpetas compartidas de la configuraci√≥n de la m√°quina virtual, debe conectar la carpeta necesaria desde el sistema host y asignarle el nombre vmw-nxcdata.  Esta carpeta puede hacer referencia a alg√∫n directorio en el disco duro o directamente al directorio ra√≠z de alg√∫n disco en el sistema host. <br><br>  La carpeta montada aparecer√° en el sistema virtual autom√°ticamente a lo largo de la ruta / mnt / hgfs / vmw-nxcdata.  Sin embargo, el problema es que el servidor web no tendr√° suficientes derechos para escribir archivos a lo largo de esta ruta y los medios est√°ndar del sistema no pueden reasignar los derechos a este directorio.  Por lo tanto, tuve que descubrir c√≥mo montar manualmente dichos recursos. <br><br>  Crea una carpeta: <br>  <b># mkdir / mnt / vmw-nxcdata</b> <br><br>  Montamos utilizando el m√≥dulo vmhgfs, que se instal√≥ con vmware-tools: <br>  <b># mount -t vmhgfs -o uid = www-data, gid = www-data, fmask = 007, dmask = 007 .host: / vmw-nxcdata / mnt / vmw-nxcdata</b> <br><br>  El montaje debe realizarse exactamente con estos par√°metros para un funcionamiento sin problemas del servidor web en el futuro.  Inicialmente, mont√© sin especificar uid / gid y m√°scaras, pero luego no condujo a nada bueno, ya que ya no era posible cambiar los derechos despu√©s del montaje.  Despu√©s de completar el montaje, puede mostrar: "No se pudo agregar la entrada a mtab, continuando", pero se montar√° y funcionar√°. <br><br>  Genial, montamos el directorio.  Ahora puede colocar un enlace simb√≥lico a este directorio en / mnt / nxcdata.  Pero no me gustar√≠a hacer esto manualmente cada vez que inicio o reinicie el servidor.  La forma m√°s f√°cil es ingresar el comando anterior en el archivo /etc/rc.local para montarlo en la l√≠nea "exit 0".  Sin embargo, quer√≠a que el desmontaje autom√°tico se llevara a cabo cuando la m√°quina virtual se apaga para una seguridad de datos confiable.  Y decid√≠ hacer todo a nivel de servicio y lidiar un poco con los mecanismos init / update-rc, m√°s a√∫n ten√≠a curiosidad y result√≥ ser bastante interesante. <br><br>  El significado de las siguientes acciones es crear un servicio del sistema que se llamar√≠a y ejecutar√≠a comandos predefinidos cuando el sistema se enciende o apaga.  El servicio se describe mediante un script compilado de acuerdo con ciertas reglas y se encuentra en /etc/init.d.  El bloque INIT INFO se encuentra al comienzo del script y contiene informaci√≥n de servicio en la que me gustar√≠a mencionar las directivas Default-Start y Default-Stop: especifican los niveles de ejecuci√≥n en los que el script debe iniciarse o detenerse de manera predeterminada. <br><br>  Niveles de ejecuci√≥n: <br><br>  0: ejecuci√≥n del script cuando el sistema est√° apagado <br>  1 - ejecuci√≥n del script al inicio del sistema en modo de usuario √∫nico <br>  2 - ejecuci√≥n del script al inicio del sistema en modo multiusuario <br>  3 - 5 - reservado <br>  6 - ejecuci√≥n del script al reiniciar el sistema <br><br>  Despu√©s de escribir el script, se activa utilizando el mecanismo update-rc, que, de hecho, crea enlaces al script en los directorios necesarios /etc/rc0.d - /etc/rc6.d, cuyo contenido corresponde a las tareas realizadas por los niveles de ejecuci√≥n.  Los enlaces se pueden crear de forma independiente, pero, a diferencia de habilitar o deshabilitar las configuraciones del servidor web apache, debe tener en cuenta muchos matices aqu√≠, por lo que debe habilitar o deshabilitar el servicio a trav√©s de update-rc. <br><br>  Entonces, crea un archivo: <br>  <b># nano /etc/init.d/nxcdata_automount.sh</b> <br><br>  Y escriba los siguientes contenidos en √©l: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # nxcdata_automount.sh 1.0 ### BEGIN INIT INFO # Provides: myscript # Required-Start: # Required-Stop: # Default-Start: 1 2 3 4 5 # Default-Stop: 0 6 # Short-Description: nxcdata_automount.sh 1.0 # Description: nxcdata_automount.sh 1.0 ### END INIT INFO . /lib/lsb/init-functions # Start actions perform_start() { log_daemon_msg ¬´Start nxcdata_automount¬ª sleep 30 mount -t vmhgfs -o uid=www-data,gid=www-data,fmask=007,dmask=007 .host:/vmw-nxcdata /mnt/vmw-nxcdata #mount -t ntfs-3g -o uid=www-data,gid=www-data,fmask=007,dmask=007 /dev/sdb1 /mnt/sdb1 #mount -t ext4 /dev/sdb1 /mnt/sdb1 sleep 5 service fail2ban restart log_end_msg 0 return 0 } # Stop actions perform_stop() { log_daemon_msg ¬´Stop nxcdata_automount¬ª umount /mnt/nxcdata log_end_msg 0 return 0 } case $1 in start) perform_start ;; stop) perform_stop ;; *) echo ‚ÄúUsage: /etc/init.d/myscript {start|stop}‚Äù exit 3 ;; esac</span></span></code> </pre><br><br>  Preste atenci√≥n a un par de equipos comentados en la secci√≥n perform_start: esta es nuestra base para el futuro.  Adem√°s, despu√©s del montaje, se reinicia el servicio fail2ban. <br><br>  La paradoja es que despu√©s de un a√±o ya no recuerdo por qu√© hice esto, pero dudo mucho que se haya hecho as√≠.  Obviamente, despu√©s de montar el servicio, por alguna raz√≥n, el servicio se bloque√≥ o no pudo iniciarse inicialmente y tuvo que reiniciarse manualmente. <br><br>  Despu√©s de tal distracci√≥n, continuamos configurando m√°s.  Crea un enlace simb√≥lico: <br>  <b># ln -s / mnt / vmw-nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  Hacemos que nuestro script sea ejecutable: <br>  <b># chmod + x /etc/init.d/nxcdata_automount.sh</b> <br><br>  Agregue el script al inicio: <br>  <b># update-rc.d nxcdata_automount.sh por defecto</b> <br><br>  Reiniciamos el sistema y nos aseguramos de que el montaje autom√°tico haya sido exitoso y de que todo sea accesible de la manera correcta. <br><br>  Para eliminar el script, deber√° ejecutar un par de comandos: <br>  <b># update-rc.d -f nxcdata_automount.sh eliminar</b> <b><br></b>  <b># rm -f /etc/init.d/nxcdata_automount.sh</b> <br><br>  En el caso de montar una unidad no a trav√©s de VMWare Shared Folders, debe seguir directamente los mismos pasos que cuando se monta a trav√©s de VMWare Shared Folders, pero teniendo en cuenta el hecho de que aparece una segunda unidad completa en el sistema.  ¬øC√≥mo encontrar la letra de unidad? <br><br>  La mayor√≠a de los dispositivos de bloque de Linux est√°n conectados a trav√©s de la interfaz SCSI, por lo que en la mayor√≠a de los casos los discos comenzar√°n con las letras sd.  La tercera letra en el nombre del disco significa su n√∫mero de serie en el sistema y se indica alfab√©ticamente: sda - el primer disco, sdb - el segundo disco, sdc - el tercero y as√≠ sucesivamente.  Luego viene el n√∫mero que define el n√∫mero de partici√≥n en el disco: sda1, sda2, etc.  La manera m√°s f√°cil de ver todas las unidades asignadas es mirar el contenido del directorio / dev / y filtrar los dispositivos SD: <br><br>  <b>$ ls -l / dev / |</b>  <b>grep sd</b> <br><br>  Por ejemplo, necesitamos conectar una unidad sdb1 con un sistema de archivos NTFS. <br><br>  Cree un directorio y monte el disco en √©l: <br>  <b># mkdir / mnt / sdb1</b> <b><br></b>  <b># mount -t ext4 / dev / sdb1 / mnt / sdb1</b> <br><br>  Cree un directorio para los datos, establezca los derechos y el usuario para ellos: <br>  <b># mkdir / mnt / sdb1 / nxcdata &amp; chmod 770 / mnt / sdb1 / nxcdata &amp; chown -R www-data: www-data / mnt / sdb1 / nxcdata</b> <br><br>  A continuaci√≥n, tambi√©n debe crear un script para el montaje autom√°tico y ajustar el comando de montaje en el script (los ejemplos de conexi√≥n de una unidad con NTFS y EXT4 ya est√°n en el script y comentados) y agregar el script al inicio. <br><br>  B crea un enlace simb√≥lico al directorio de datos: <br>  <b># ln -s / mnt / sdb1 / nxcdata / mnt / nxcdata / nxcdata</b> <br><br>  De hecho, todos estos problemas con un mont√≥n de directorios nxcdata est√°n dise√±ados para una cosa: para proporcionar una transferencia simple del directorio de datos en el futuro: no necesitar√° editar la configuraci√≥n en el motor de Nextcloud y, en general, acceder a ella: todo lo que necesita hacer es conectar un nuevo disco, copiar a le datos y recrear un enlace simb√≥lico que conduce a un nuevo directorio con datos.  Al mismo tiempo, todas las acciones no van m√°s all√° del directorio / mnt.  As√≠ que todo result√≥ ser complicado evolutivamente, simplemente no quer√≠a perder las soluciones que ten√≠a. <br><br>  ¬øCu√°l es la mejor manera de transferir datos fuera de la m√°quina virtual?  Compartir√© mi experiencia sobre qu√© opci√≥n dej√© y por qu√©. <br><br>  Las unidades USB se capturaron autom√°ticamente cuando la m√°quina virtual se encendi√≥, se arrojaron correcta y completamente dentro, y todo funcion√≥ siempre, pero solo hasta que la unidad se desconect√≥ del sistema por alguna raz√≥n.  El reinicio o la desconexi√≥n f√≠sica y la conexi√≥n de un disco ayudaron.  La decisi√≥n result√≥ ser poco confiable.  No hubo tal problema con las unidades flash, pero su volumen y velocidad de trabajo categ√≥ricamente no me conven√≠an.  Quiz√°s vali√≥ la pena probar un disco externo con energ√≠a aut√≥noma. <br><br>  El reenv√≠o de directorios a trav√©s de VMWare Shared Folders funcion√≥ de manera estable y perfecta.  Esta soluci√≥n satisfizo completamente la tarea de sincronizar dos tel√©fonos inteligentes.  Todo funcion√≥ durante varios d√≠as, se bombearon decenas de gigabytes de datos.  Sin embargo, cuando decid√≠ agregar datos de la computadora a la nube, de repente encontr√© un problema con rutas largas y nombres de archivos.  En teor√≠a, el l√≠mite de nombre de archivo / carpeta NTFS es de 255 caracteres, pero en la pr√°ctica la API de Windows lo limita a 244 caracteres.  En teor√≠a, el l√≠mite en la longitud de la ruta a un archivo o carpeta en NTFS es de 32.767 caracteres, pero en la pr√°ctica, la API de Windows lo limita a 245 caracteres.  Dado que soy un gran admirador de la estructuraci√≥n de la informaci√≥n, la longitud de mi camino puede ser muy grande.  El t√≠tulo no abreviado de los libros tambi√©n puede ser f√°cilmente de 100 a 150 caracteres, incluidos los espacios.  Esta restricci√≥n es un problema conocido de VMWare Shared Folders, que no se pudo curar incluso cuando se usa Windows 10 con todo tipo de claves inteligentes en el registro para eliminar el l√≠mite de 255 caracteres.  Una posible raz√≥n son las limitaciones de vmhgfs.  Esta forma conveniente de conectarse tuvo que ser abandonada.  La raz√≥n es segura: el problema est√° en el sistema de archivos virtual, que se utiliza en el mecanismo de carpetas compartidas VMWare. <br><br>  La siguiente soluci√≥n es conectar el disco duro directamente a la m√°quina virtual.  Tampoco funcion√≥ sin problemas.  La estructura de datos (o sistema de archivos, y esto era evidente tanto para NTFS como para EXT2 / 3/4) se descompuso constantemente cuando el disco o su partici√≥n fue "capturada" por el software de la m√°quina virtual, o cuando fue devuelta al sistema host incluso si transfir√≠ todo Conduzca sin conexi√≥n en el sistema host.  En algunos modos, no escribo ni leo datos; ni siquiera pude formatear correctamente el disco duro o la partici√≥n reenviados.  Sin embargo, logramos encontrar un modo de trabajo: un disco duro f√≠sico con una partici√≥n, formateado en NTFS, estaba conectado a la m√°quina virtual en un cierto modo de conexi√≥n: SATA / Independiente / Persistente / Usar partici√≥n individual.  La carpeta nxcdata que contiene los datos debe estar en el disco duro. <br><br><hr><a name="chap5"></a><br><h3>  Configure el acceso a la m√°quina virtual de Nextcloud desde la red de √°rea local </h3><br>  No tenemos problemas para abrir sitios web dentro de una m√°quina virtual o desde un sistema host.  Pero, ¬øc√≥mo abrir el sitio creado desde otra computadora en la red local?  Veamos la estructura de nuestra red, que se muestra a continuaci√≥n. <br><br><img src="https://habrastorage.org/webt/vt/ge/zt/vtgeztmrqy5y22zje4pgdn-40ro.png"><br><br>  La imagen muestra que el enrutador est√° conectado directamente a Internet y configurado para que distribuya autom√°ticamente las direcciones IP a los dispositivos conectados en el rango 192.168.0.2-192.168.0.254.  La direcci√≥n 192.168.0.2 fue recibida por nuestra computadora y 192.168.0.3, la segunda computadora en la que hacemos el servidor.  Sin embargo, el software de virtualizaci√≥n est√° instalado en la segunda computadora, que cre√≥ su propio enrutador virtual y configur√≥ su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">DHCP</a> en la subred 192.168.233.0/24.  Nuestro servidor virtual recibi√≥ IP 192.168.133.138. <br><br>  Puedo abrir f√°cilmente el sitio dentro de la m√°quina virtual 192.168.233.138.  Puedo abrir f√°cilmente el sitio desde la m√°quina 192.168.0.3 simplemente ingresando la direcci√≥n IP deseada en el navegador: el software de virtualizaci√≥n ya se ha encargado de la configuraci√≥n correcta del entorno de red en la m√°quina host.  Pero, ¬øc√≥mo llego al sitio desde la computadora 192.168.0.2?  Si ingreso la direcci√≥n IP 192.168.233.138, no se abrir√° nada para m√≠, ya que ni mi computadora ni el enrutador real saben nada sobre esta subred.  Si ingreso la direcci√≥n 192.168.0.3, tampoco se abrir√° nada para m√≠, ya que realmente no hay un sitio en esta computadora, est√° dentro de su m√°quina virtual. <br><br>  Para resolver este problema, debe configurar el enrutador virtual de la computadora 192.168.0.3.  Ya sabemos que el acceso a los sitios va por los puertos 80 y 443. Cuando accedemos a estos puertos a una m√°quina 192.168.0.3, necesitamos construir un enrutamiento para que las solicitudes se env√≠en a la m√°quina virtual 192.168.233.138.  Afortunadamente para esto tenemos las herramientas disponibles.  VMWare Workstation tiene una herramienta Virtual Network Editor que se puede abrir desde el men√∫ de la m√°quina virtual (Editar -&gt; Virtual Network Editor). <br><br><img src="https://habrastorage.org/webt/07/-x/ml/07-xmlj7novkph4sr6e0yrmabnw.jpeg"><br><br>  Esta herramienta le permite administrar con bastante flexibilidad la configuraci√≥n de la red.  Necesitamos seleccionar la tarjeta de red virtual VMNet8 y hacer clic en el bot√≥n "Configuraci√≥n de NAT ..." que est√° disponible.  En la ventana que se abre, debe agregar reglas para crear la ruta que necesitamos. <br><br><img src="https://habrastorage.org/webt/uc/jh/dp/ucjhdp0cif4azermsxbwfra4v-o.jpeg"><br><br>  Especifique el puerto del sistema host y luego especifique la direcci√≥n IP y el puerto de la m√°quina virtual donde se deben redirigir las solicitudes.  Para reenviar tr√°fico HTTPS, debe especificar el puerto del sistema host 443 y el puerto 443 y la direcci√≥n de la m√°quina virtual 192.168.233.138.  Despu√©s de crear las reglas, haga clic en "Aceptar" en todas las ventanas: el entorno de red virtual se reconfigura autom√°ticamente. <br><br>  Despu√©s de estos cambios, nuestros sitios comenzar√°n a abrirse desde la m√°quina 192.168.0.2 al acceder a la direcci√≥n 192.168.0.3. <br><br>  Configuraciones similares para el reenv√≠o de puertos est√°n disponibles no solo para VMWare, sino tambi√©n para VirtualBox (Configuraciones ‚Üí Red ‚Üí seleccione el adaptador requerido ‚Üí Avanzado ‚Üí Reenv√≠o de puertos).  Sin embargo, durante los experimentos para conectar el disco duro a esta etapa, encontr√© el VMWare Player gratuito instalado, en el que no estaba el Virtual Network Editor.  No encontr√© nada sobre el reenv√≠o de puertos para VMWare Player en Internet y tuve que usar una versi√≥n de prueba de VMWare Workstation; al instalar el producto, me da 30 d√≠as de uso gratuito.  Despu√©s de 30 d√≠as, el producto se puede quitar, limpiar e instalar nuevamente, pero esa atenci√≥n al servidor es de alguna manera redundante y claramente indeseable.       ( ) .    VMWare Workstation   vmnetcfg,        Virtual Network Editor.     VMWare Player   .    VMWare Player -     ?           VMWare Player,   . ,   . ,      VMWare Player   ,    ,      . <br><br>             ,    .        Port Forwarding,      ,       IP   .    .      IP       ,      ‚Äì         IP ,         ,          .     ,       IP          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">NAT</a> ,  ¬´¬ª IP ?      ,       ¬´¬ª IP. ,             .       dyndns  freedns.afraid.org    ,    VDS   -  ,           IP     . <br><br>      IP   192.168.0.3  192.168.233.138,           ,     . <br><br><hr><a name="chap6"></a><br><h3>  Nextcloud </h3><br>       https:// 127.0.0.1/nextcloud   , https:// 192.168.233.138/nextcloud    ,     , https:// 192.168.0.3/nextcloud      . <br><br>   /  ,     ,           nxcdata: /mnt/nxcdata/nxcdata.         - . <br><br>        : <br><br> ‚Äî Personal ‚Üí      e-mail   user@localhost <br> ‚Äî  ‚Üí   ‚Üí    <br> ‚Äî  ‚Üí Usage survey ‚Üí    <br> ‚Äî  ‚Üí   ‚Üí  : ¬´   ¬ª   25 GB <br> ‚Äî  ‚Üí   users       user <br><br>     . <br><br>  : <br> <b># nano /var/www/nextcloud/config/config.php</b> <br><br>    ,  ¬´);¬ª  : <br><br> <code>'memcache.local' =&gt; '\OC\Memcache\Memcached', <br> 'memcache.distributed' =&gt; '\OC\Memcache\Memcached', <br> 'memcached_servers' =&gt; array( <br> array('localhost', 11211), <br> ), <br></code> <br><br>           ¬´¬ª. <br><br>  : <br> <b># nano /var/www/nextcloud/config/config.php</b> <br><br>   trusted_domains    IP  ,  ,    Nexcloud.  trusted_domains       : <br><br> <code>'trusted_domains' =&gt; <br> array ( <br> 0 =&gt; '127.0.0.1', <br> 1 =&gt; '192.168.233.138', <br> ), <br></code> <br><br>      ‚Äì       user.    ,       ‚Äì         ,    IP  192.168.0.3    ,    . <br>     ,        ,                   subversion,           .     ,       ,    -    . <br><br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">wtigga</a>   2017     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">¬´  VPS:  ¬´¬ª Nextcloud¬ª</a> .  ,    ,      Nextcloud, 12- . <br><br><hr><a name="chap7"></a><br><h3>  ¬´¬ª  Nextcloud </h3><br>            ,         .  ,             .                ‚Äì    .  ,       . <br><br>    ,      ,          11.0.2,      .   12.  -    ,             ,       11.x    . <br><br> <b> 1</b> <br><br>      ¬´file is locked¬ª.  .   ‚Äî     oc_file_locks    mysql (   nextcloud)    : <br> <b>mysql &gt; DELETE FROM oc_file_locks WHERE 1</b> <br><br>     ,      ,          : <br> <b># nano /root/empty_oc_file_locks</b> <br><br>  : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash mysql -unextcloud &gt; -pnc123 -D nextcloud &lt;&lt;MY_QUERY DELETE FROM oc_file_locks WHERE 1 MY_QUERY</span></span></code> </pre><br><br>    ,      .       15   cron (https://ru.wikipedia.org/wiki/Cron ). <br>     : <br> <b># nano /root/crontab</b> <br><br>   : <br><br> <code>*/15 * * * * root bash /root/empty_oc_file_locks <br></code> <br><br>      : <br> <b># crontab /root/crontab</b> <br><br>     : <br> <b># crontab -l</b> <br><br> <b> 2</b> <br><br>    webDAV   (   ,  )    : <br><br> <code>Error PHP reset() expects parameter 1 to be array, null given at /var/www/nextcloud/apps/files_versions/lib/Storage.php#783 <br> Error PHP ksort() expects parameter 1 to be array, null given at /var/www/nextcloud/apps/files_versions/lib/Storage.php#782 <br> Error PHP Invalid argument supplied for foreach() at /var/www/nextcloud/apps/files_versions/lib/Storage.php#759 <br> Error PHP Undefined index: by_file at /var/www/nextcloud/apps/files_versions/lib/Storage.php#759 <br> Error PHP Undefined index: all at /var/www/nextcloud/apps/files_versions/lib/Storage.php#757 <br></code> <br><br>             .     ¬´Undefined index‚Ä¶ Storage.php#757¬ª,      .     .     .      (Storage.php#757)        . -     ,    ¬´¬ª.         ¬´,  ¬ª    , , 100TB. <br><br> <b> 3</b> <br><br>     .htaccess ‚Äì    !     ,      .      .    .   ,  ,      ,     nextcloud. <br>   /var/www/nextcloud/lib/private/Files/filesystem.php   : <br><br> <code>$blacklist = \OC::$server-&gt;getConfig()-&gt;getSystemValue('blacklisted_files', array('.htaccess')); <br></code> <br><br>      : <br><br> <code>$blacklist = \OC::$server-&gt;getConfig()-&gt;getSystemValue('blacklisted_files', array('')); <br></code> <br><br><hr><a name="chap8"></a><br><h3>   Nextcloud </h3><br>            fail2ban.      ,    nextcloud   ,      . <br><br>  : <br> <b># nano /etc/fail2ban/filter.d/nextcloud.conf</b> <br><br>   : <br><br> [Definition] <br> failregex={¬´reqId¬ª:".*",¬´remoteAddr¬ª:".*",¬´app¬ª:¬´core¬ª,¬´message¬ª:¬´Login failed: '.*' \(Remote IP: ''\)¬ª,¬´level¬ª:2,¬´time¬ª:".*"} <br> ignoreregex = <br><br>  : <br> <b># nano /etc/fail2ban/jail.local</b> <br><br>      : <br><br> <code>#       nextcloud <br> [nextcloud] <br> enabled = true <br> port = http,https <br> protocol = tcp <br> filter = nextcloud <br> logpath = /var/log/nextcloud.log <br></code> <br><br>  : <br> <b># service fail2ban restart</b> <br><br>    : <br> <b># fail2ban-client status nextcloud</b> <br><br>  ,      fail2ban             12   IP       30 .  -    -       ,         . <br><br><hr><a name="chap9"></a><br><h3>     </h3><br>    ,   Android,    FolderSync.      . <br><br>       ,        https:// 192.168.0.3/nextcloud,             .   ¬´¬ª  ,      . <br><br>    .            ‚Äì ¬´  ¬ª.    (     ¬ª      .     2    .        ¬´ ¬ª  ¬´  ¬ª,                   .   ¬´¬ª      Wi-Fi,   SSID   Wi-Fi    ¬´ WiFi SSID'¬ª ‚Äî                 .      .     .     ¬´  ¬ª    [nosync].  ,           ,       ¬´[nosync]¬ª. <br><br>          DCIM, Download, Telegram, viber, WhatsApp.         .          ,        ,      .             -  . <br><br><hr><a name="chap10"></a><br><h3>      </h3><br>      .         ,         .  ,      15     /++,  -     ,        BAT/CMD     Sign 0f Mistery  xStarter. -       AutoIt          . <br><br>               ,          .  Nextcloud     Windows , ,      .       ,       .   : , , ,  , ,       .           , ,   ,           . <br><br>      ,        ,       .             VMWare Shared Folders       ,           ,  ,   ‚Äì   . ,     ,           VMWare Shared Folders,   .   ,        ,             .              ,         .  ,            Nextcloud     .  ,    Nextcloud   ,        ,     . <br><br> -     ,      ,     .                 .          BAT   ,     FreeFileSync   .            ¬´\\?\D:\Info¬ª, ..         . ,   webdav FreeFileSync  .   FolderSync  Windows,  ,  ,         GoodSync ,     ,    .  , GoodSync    ,    15$     ,  ,  .    ,         . <br><br> GoodSync    .    ,   GoodSync2Go.     .              GoodSync.    Sync    ,  D,      GoodSync   . <br><br> <sup>[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow"> </a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">geektimes.ru</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">AlexanderS</a> . <br>    ,     ! ]</sup> <br><br>       :        .            ¬´ ¬ª  ¬´   / ¬ª.       ¬´ ¬ª  ¬´   _gsdata_¬ª,   ‚Äî ¬´ ¬ª  ¬´    ¬ª.  ,      .        Info    ¬´bck_Info¬ª. <br>    D:\Sync   bck_Info.bat   : <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 @%dir%GoodSync\GoodSync2Go-v10.exe /miniwin /<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> sync <span class="hljs-string"><span class="hljs-string">"%~n0"</span></span></code> </pre><br><br>    BAT.            .         GoodSync  GoodSync2Go-v10.exe,           (bck_Info),    ,       .       ,             GoodSync.  ,    Enter  BAT         . <br><br>      FreeFileSync     xml      , ..       .  GoodSync       D:\Sync\GoodSync\GoodSync\Profile\jobs.tic            , ..            . <br>          bck_all.bat: <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_Info.bat call %dir%bck_Info2.bat call %dir%bck_Info3.bat call %dir%bck_Info4.bat</code> </pre><br>        ,   . <br><br>       ,       . ,    ,     ,  ,   ,  ,    .    ,       D:\Sync\GoodSync\GoodSync\Profile\*.log.          ¬´¬ª ‚Äì -         .             ,        .     log_analayser      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">AutoIt</a> .  - ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" rel="nofollow">   </a>     AutoIt,    ,   SciTE ‚Äì          . <br><br>         ,     log_analayser.au3   : <br><br><pre> <code class="plaintext hljs">; LOG Analyser 1.0 ;      - #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|LOG Analyser #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|log_analyser.exe #AutoIt3Wrapper_Res_Comment=     - #AutoIt3Wrapper_Res_Description= - ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) #include &lt;Array.au3&gt; #include &lt;_FileDirList.au3&gt; ;  Local $msg_title = "LOG Analyser 1.0" Local $path = @ScriptDir Local $soft_open_log = "notepad.exe" Local $path, $dir_mode, $word, $file_analyse_name, $file_analyse_ext, $log_path, $log_msg_on Local $file_log, $word_detect, $file_analyse, $cnt_files, $i ;    if ($CmdLine[0] &lt; 6) then MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit else if (StringCompare($CmdLine[1], "file") = 0) then $dir_mode = 0 elseif (StringCompare($CmdLine[1], "dir") = 0) then $dir_mode = 1 else MsgBox(0x10, $msg_title, "     'file'  'dir'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif $word = $CmdLine[2] if ($dir_mode = 0) then $file_analyse_name = $CmdLine[3] else $dir_analyse = $CmdLine[3] endif $file_analyse_ext = $CmdLine[4] $log_path = $CmdLine[5] if (StringCompare($CmdLine[6], "err_msg_on") = 0) then $log_msg_on = 1 elseif (StringCompare($CmdLine[6], "err_msg_off") = 0) then $log_msg_on = 0 else MsgBox(0x10, $msg_title, "     'log_msg_on'  'log_msg_off'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif endIf ;   $file_log = $log_path &amp; "\" &amp; "log_analyser" &amp; "-" &amp; @YEAR &amp; "-" &amp; @MON &amp; "-" &amp; @MDAY &amp; "-" &amp; @HOUR &amp; "-" &amp; @MIN &amp; "-" &amp; @SEC &amp; ".log" $word_detect = 0 ;    if ($dir_mode = 0) then $file_analyse = $file_analyse_name &amp; "." &amp; $file_analyse_ext if (_file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) = 1) then $word_detect = 1 endif else ;     $dir_arr = _FileDirList($dir_analyse, "*."&amp;$file_analyse_ext, 1, 1, 0) ;_ArrayDisplay($dir_arr) ;    -       if ($dir_arr = 0) then MsgBox(0x10, $msg_title, "       !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif $cnt_files = $dir_arr[0] ;    $i = 0 While $i &lt;&gt; $cnt_files $i = $i + 1 $file_analyse = $dir_arr[$i] if (_file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) = 1) then $word_detect = 1 endif WEnd endif ;    if ($word_detect = 1) and ($log_msg_on = 1) then if (MsgBox (0x41034, $msg_title, " !" &amp; @CRLF &amp; "      : " &amp; $file_log &amp; @CRLF &amp; @CRLF &amp; "   ?")) = 6 then ShellExecuteWait($soft_open_log, $file_log) endif endif Exit ;                    ;   ,   ,     Func _file_analyser($file_analyse, $msg_title, $word, $file_log, $word_detect) Local $file1, $file2, $file_line, $write_once $word_detect = 0 $write_once = 0 $file1 = FileOpen($file_analyse, 0) ;     If $file1 = -1 Then FileClose($file1) MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit EndIf ;       While 1 $file_line = FileReadLine($file1) If @error = -1 Then ExitLoop if (StringInStr($file_line, $word) &lt;&gt; 0) then $word_detect = 1 ;            if (FileExists($file_log) = 0) then $file2 = FileOpen($file_log, 1) FileClose($file2) endif ;        if ($write_once = 0) then $write_once = 1 $file2 = FileOpen($file_log, 1) FileWriteLine($file2, " : " &amp; $file_analyse) FileClose($file2) endif ;       $file2 = FileOpen($file_log, 1) FileWriteLine($file2, $file_line) FileClose($file2) endif WEnd ;     ,          if ($word_detect = 1) then $file2 = FileOpen($file_log, 1) FileWriteLine($file2, @CRLF) FileClose($file2) endif FileClose($file1) Return $word_detect EndFunc</code> </pre><br>      F7   SciTE      log_analayser.exe. <br><br>      - ,     ,     ,   . <br><br>      : <br><br> ‚Äî    <br> ‚Äî  ,     (     ) <br><br>         : <br><br> 1 ‚Äî   [file =  ; dir =  ,  ] <br> 2 ‚Äî     <br> 3 ‚Äî        <br> 4 ‚Äî         <br> 5 ‚Äî    ,      <br> 6 ‚Äî            [err_msg_on = ; err_msg_off =  ] <br><br>  ,    bck_auto.bat: <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_all.bat log_analyser.exe dir  %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>   ,             ,      ,              ,            .      -   D:\Sync\LOG. <br>      .    . ,      ,        .        ,      :  ,          ¬´¬ª,       ‚Äì Macintosh!      Siber Systems   ,     -    .    ,     ? <br><br>              : <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>    :  GoodSync    ,        .   -    ,             .          D:\Sync     .      clean_logs.bat: <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> off <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 For /R %dir% %%i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (*.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>) Do ( Del /q <span class="hljs-string"><span class="hljs-string">"%%i"</span></span>) @<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> on</code> </pre><br>    - ,    ,    (    )           log.      . <br>  bck_auto.bat : <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 @call clean_logs.bat call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>    ,       .           ,       ,   ? <br><br>    bck_auto.bat: <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> Start Backup &amp; PCOFF @<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0 start MonitorOnOff.exe 0 @call clean_logs.bat call %dir%bck_all.bat log_analyser.exe dir –ãÀú‚Ç¨–É–â–Ç %dir%GoodSync\Profile <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> %dir%LOG err_msg_off shutdown /s /t 0 <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>      .  MonitorOnOff    (    ,             ),   shutdown  .  log_analyser  ,        ‚Äì          ,      . <br><br>  MonitorOnOff     AutoIt. <br><br><pre> <code class="plaintext hljs">; Monitor On Off 1.0 ;   /  #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|Monitor On Off #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|MonitorOnOff.exe #AutoIt3Wrapper_Res_Comment=  /  #AutoIt3Wrapper_Res_Description=  /  ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) HotKeySet("{F10}", "_Monitor_ON") HotKeySet("{F11}", "_Monitor_OFF") HotKeySet("{Esc}", "_Quit") Global Const $lciWM_SYSCommand = 274 Global Const $lciSC_MonitorPower = 61808 Global Const $lciPower_Off = 2 Global Const $lciPower_On = -1 Global $MonitorIsOff = False if ($CmdLine[0] &lt;&gt; 0) then _Monitor_OFF() endif While 1 Sleep(10) WEnd Func _Monitor_ON() $MonitorIsOff = False Local $Progman_hwnd = WinGetHandle('[CLASS:Progman]') DllCall('user32.dll', 'int', 'SendMessage', _ 'hwnd', $Progman_hwnd, _ 'int', $lciWM_SYSCommand, _ 'int', $lciSC_MonitorPower, _ 'int', $lciPower_On) EndFunc Func _Monitor_OFF() $MonitorIsOff = True Local $Progman_hwnd = WinGetHandle('[CLASS:Progman]') While $MonitorIsOff = True DllCall('user32.dll', 'int', 'SendMessage', _ 'hwnd', $Progman_hwnd, _ 'int', $lciWM_SYSCommand, _ 'int', $lciSC_MonitorPower, _ 'int', $lciPower_Off) _IdleWaitCommit(0) Sleep(20) WEnd EndFunc Func _IdleWaitCommit($idlesec) Local $iSave, $LastInputInfo = DllStructCreate ("uint;dword") DllStructSetData ($LastInputInfo, 1, DllStructGetSize ($LastInputInfo)) DllCall ("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr ($LastInputInfo)) Do $iSave = DllStructGetData ($LastInputInfo, 2) Sleep(60) DllCall ("user32.dll", "int", "GetLastInputInfo", "ptr", DllStructGetPtr ($LastInputInfo)) Until (DllStructGetData ($LastInputInfo, 2)-$iSave) &gt; $idlesec Or $MonitorIsOff = False Return DllStructGetData ($LastInputInfo, 2)-$iSave EndFunc Func _Quit() _Monitor_ON() Exit EndFunc</code> </pre><br>     : F10  , F11 ‚Äì ,   ESC        .            . <br><br>     ‚Äì      bck_all.bat,  ¬´ ¬ª   .     ,        .        D:\Sync\GoodSync\LOG\    - .       ‚Äì      ?            ,                 .    check_file_exist. <br><br><pre> <code class="plaintext hljs">; Check File Exist 1.0 ;        #Region ;**** Directives created by AutoIt3Wrapper_GUI **** #AutoIt3Wrapper_Res_Field=ProductName|Check File Exist #AutoIt3Wrapper_Res_Fileversion=1.0.0.0 #AutoIt3Wrapper_Res_Field=OriginalFilename|check_file_exist.exe #AutoIt3Wrapper_Res_Comment=       #AutoIt3Wrapper_Res_Description=   ;**** #AutoIt3Wrapper_Res_Language=1049 #AutoIt3Wrapper_Res_ProductVersion=1.0 #AutoIt3Wrapper_Compile_Both=y #EndRegion ;**** Directives created by AutoIt3Wrapper_GUI **** ;AutoItSetOption ("WinTitleMatchMode", 2) ;       ;#NoTrayIcon ;         If WinExists('[CLASS:AutoIt v3;TITLE:' &amp; @ScriptName &amp; ']') Then MsgBox(48, @ScriptName, "     !"); ;             ;WinActivate('  ') Exit EndIf AutoItWinSetTitle(@ScriptName) #include &lt;Array.au3&gt; #include &lt;_FileDirList.au3&gt; ;  Local $msg_title = "Check File Exist 1.0" Local $path = @ScriptDir Local $soft_open_dir = "explorer.exe" Local $path, $dir_analyse, $words, $msg_open ;    if ($CmdLine[0] &lt; 5) then MsgBox(0x10, $msg_title, "   !" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit else $dir_analyse = $CmdLine[1] $file = $CmdLine[2] $words0 = $CmdLine[3] $words1 = $CmdLine[4] if (StringCompare($CmdLine[5], "msg_on") = 0) then $msg_open = 1 elseif (StringCompare($CmdLine[5], "msg_off") = 0) then $msg_open = 0 else MsgBox(0x10, $msg_title, "     'msg_on'  'msg_off'!" &amp; @CRLF &amp; @CRLF &amp; "  ") Exit endif endIf ;      $dir_arr = _FileDirList($dir_analyse, "*"&amp;$file&amp;"*", 1, 0, 0) ;_ArrayDisplay($dir_arr) ;      if ($dir_arr = 0) then if (StringCompare($words0, "0") &lt;&gt; 0) then if ($msg_open = 0) then MsgBox(0x41030, $msg_title, $words0) else if (MsgBox(0x41034, $msg_title, $words0 &amp; @CRLF &amp; @CRLF &amp; "     ?")) = 6 then ShellExecuteWait($soft_open_dir, $dir_analyse) endif endif endif else if (StringCompare($words1, "0") &lt;&gt; 0) then if ($msg_open = 0) then MsgBox(0x41030, $msg_title, $words1) else if (MsgBox(0x41034, $msg_title, $words1 &amp; @CRLF &amp; @CRLF &amp; "    ?")) = 6 then ShellExecuteWait($soft_open_dir, $dir_analyse) endif endif endif endif Exit</code> </pre><br>     ‚Äì    log_analyser.     (  )                    . <br><br>  : <br><br> 1 ‚Äî     (   ‚Äî /) <br> 2 ‚Äî       ,     <br> 3 ‚Äî  ,    ,  =0 ‚Äî    <br> 4 ‚Äî  ,    ,  =0 ‚Äî    <br> 5 ‚Äî  : msg_off ‚Äî     / , msg_on ‚Äî        ,       <br><br> ,       Check_LOG_from_log_analyser.bat,       Windows: <br><br><pre> <code class="bash hljs">@<span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dir=%~dp0LOG start check_file_exist.exe %dir% .<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> 0 <span class="hljs-string"><span class="hljs-string">"     !"</span></span> msg_on <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br>  ,       ,       Sync        .    ,    ‚Äì  Windows 7 64             . <br><br>       ,      .      AutoIt,       if-then-else-end,     ,         AutoIt,      .   BAT    ,           .      ,      . <br><br><div class="spoiler"> <b class="spoiler_title">   Dark Dragon</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mt/oe/bi/mtoebi7ufvsfmzqjs52tihnxwiy.jpeg"><br></div></div><br><hr><a name="chap11"></a><br><h3>  </h3><br>  ,  ,       ,       .  ,         : ¬´,  -   ¬ª.   ‚Äì  .            .       .           ,     .   ,   .  ,            .     ‚Äì    ,             .   ,      -          . <br><br><hr><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> ,  </a> . <br><br><hr><br>    .  3.    ‚Äî    Nextcloud. <br>  : 1.2.1. <br>   : 08.02.2018. <br>   : 15.01.2020. <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"> 1.2.1 [15-01-2020] <br>  . <br><br> 1.2.0 [08-02-2018] <br>  . <br><br> 1.1.0 [08-02-2018] <br>  . <br><br> 1.0.0 [08-02-2018] <br>  . <br>     Nextcloud 11.0.2    VMWare,    VMWare     ,     Nextcloud. <br></div></div><br><hr><a name="bug"></a><br><div class="spoiler"> <b class="spoiler_title">    (  )</b> <div class="spoiler_text">   -  (, code  blockquote) <b>  </b>   : <br><blockquote> [Definition] <br> failregex={¬´reqId¬ª:".*",¬´remoteAddr¬ª:".*",¬´app¬ª:¬´core¬ª,¬´message¬ª:¬´Login failed: '.*' \(Remote IP: ''\)¬ª,¬´level¬ª:2,¬´time¬ª:".*"} <br> ignoreregex = <br></blockquote><br>          !       , ..      .    (/)  ‚Äî    .  : <br> ‚Äî   <br> ‚Äî          <br> ‚Äî  ,   ¬´  Nextcloud¬ª   , ,  <br> ‚Äî  ,         <br><br></div></div><br><hr></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es410011/">https://habr.com/ru/post/es410011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es410001/index.html">¬øC√≥mo se desarroll√≥ la percepci√≥n humana del espacio y por qu√© necesitamos mediciones?</a></li>
<li><a href="../es410003/index.html">Resultados de la investigaci√≥n: la pirater√≠a ayuda a mejorar las ventas de muchos artistas</a></li>
<li><a href="../es410005/index.html">Exprimir la electricidad</a></li>
<li><a href="../es410007/index.html">Distr. Revisi√≥n de programas √∫tiles tarde por 16 a√±os</a></li>
<li><a href="../es410009/index.html">¬øEs blockchain la seguridad personal o el peligro personal?</a></li>
<li><a href="../es410013/index.html">8 reglas de comunicaci√≥n en un entorno multiling√ºe: instrucciones para empleados de empresas internacionales</a></li>
<li><a href="../es410017/index.html">UNICEF alienta a los jugadores a emitir minas para ni√±os sirios</a></li>
<li><a href="../es410019/index.html">Lo que necesita saber sobre los ojos de los ni√±os.</a></li>
<li><a href="../es410023/index.html">Dell Precision 5720 All-in-One Review: potente todo en uno todo en uno</a></li>
<li><a href="../es410025/index.html">Lo que cambiar√° en SSD y RAM en 2018: los nuevos Kingston e HyperX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>