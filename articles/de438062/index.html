<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∑üèº üë©üèª‚Äçü§ù‚Äçüë®üèæ üë©üèª‚Äçüéì Meine Adresse ist kein Haus oder eine Stra√üe, meine Adresse ist die Sowjetunion? üë®üèº‚Äçüî¨ üë©üèæ‚Äçüç≥ üë®‚Äçüë®‚Äçüëß‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="microBIGDATA oder FIAS in der Tasche 


 Peter Brueghel der J√ºngere, Steuerzahlung , 1640 

 Der letzte Eintrag auf dem Rasierer auf den Objekten ging...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meine Adresse ist kein Haus oder eine Stra√üe, meine Adresse ist die Sowjetunion?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438062/"> <b>microBIGDATA oder FIAS in der Tasche</b> <br><br><img src="https://habrastorage.org/webt/gq/le/vh/gqlevhij14f0jkubb4pmbjwvb5u.jpeg"><br>  <i>Peter Brueghel der J√ºngere, <b>Steuerzahlung</b> , 1640</i> <br><br>  Der letzte Eintrag auf dem Rasierer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf den Objekten</a> ging.  Wir werden die Aufkl√§rung im Kampf fortsetzen.  Heute werden wir √ºber das Schwierige sprechen.  Es geht noch nicht um GROSSE DATEN, aber es ist bereits unpraktisch zu arbeiten - gro√üe Datenmengen.  Nicht jeder passt in den gesamten Arbeitsspeicher, aber einige passen nicht einmal auf die Festplatte (es gibt nicht gen√ºgend Speicherplatz, aber viel M√ºll).  Der Name unserer vertrauensw√ºrdigen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">FIAS-Datenbank</a> ist die Datenbank des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Bundesadressinformationssystems</a> .  5,5 GB Archiv.  Und es wird in ein XML-Archiv komprimiert.  Nach dem Auspacken stehen volle 53 GB zur Verf√ºgung (110 GB zum Auspacken aufbewahren).  Und wenn Sie anfangen, es zu analysieren und zu konvertieren, reichen 110 GB nicht aus.  √úber die erforderliche Menge an RAM wird auch sein. <br><a name="habracut"></a><br>  Alles w√§re gut, aber Sie k√∂nnen weiter graben.  Es gibt ein solches internationales Open-Source-Projekt zur Datenerfassung und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">-systematisierung</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenAddresses</a> .  Es wird also mehr Datenbanken geben.  Die aktuelle Abdeckung des Planeten hat viele wei√üe Flecken, zum Beispiel fehlt Russland fast.  Die Archivgr√∂√üe betr√§gt 10 GB. <br><br>  Oder eine Datenbank eines ziemlich bekannten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">OpenStreetMaps-Projekts</a> .  Es wird von Freiwilligen auf Basis von Wikipedia gebaut.  Ziemlich detailliert und mehrsprachig.  Jetzt ein komplettes Archiv komprimierten XML mit einer Gr√∂√üe von 74 GB. <br><blockquote>  Wenn sie anfingen, √ºber Adressen zu sprechen, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">kamen rechtzeitig</a> unerwartete <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nachrichten von DuckDuckGo</a> , der besten sicheren Suchmaschine f√ºr heute, √ºber den √úbergang zu Apple-Karten.  Genauer gesagt auf Apple MapKit JS.  Das interessanteste Merkmal in unserem Kontext ist die ‚Äûverbesserte Adressensuche‚Äú.  Ist Apple das beste Unternehmen, das unsere Daten sorgf√§ltig sammelt und sch√ºtzt?  Es wird notwendig sein, ... </blockquote>  Also die Herausforderung.  Wie Sie all diesen Adressreichtum in ein angenehmes Repository stellen, damit Sie von einer kostenlosen API tr√§umen k√∂nnen (nat√ºrlich in Python) und Ihr liebes Eisen nicht an einer ungelesenen Ladung ersticken darf.  Nennen wir es MicroBigData - mcBD oder ŒºBG auf Englisch :-) <br><br>  In der Wirtschaft eines jeden zweiten (oder sogar des ersten) Entwicklers ist dieses Ding ein Adressverzeichnis, es ist auch ein Verzeichnis von Toponymen, eine Sache, die sehr notwendig ist.  Und wenn es auch normativ, vorbereitet, gereinigt und vom richtigen K√∂rper gut dokumentiert ist, ist es nur ein M√§rchen.  Wir m√ºssen Tribut zollen, der russische Steuerdienst macht seine digitale Produktion gut.  So weit wie m√∂glich.  Es gibt wahrscheinlich einige Fehler im Inneren und die Datenbereinigung wird fortgesetzt.  Lassen Sie die Staatsoberh√§upter nachdenken, wie Sie dieses Problem l√∂sen k√∂nnen.  Sie entscheiden f√ºr uns und zum Nutzen von uns allen.  √úbrigens wurde im folgenden Beispiel ein Tippfehler von FIAS gefunden.  Das Ergebnis ist nicht betroffen.  Ich habe es nicht repariert.  Wirst du finden? <br><br>  Ich wei√ü nicht, wie spezifisch die Adressdaten in Ihren Projekten relevant sind - dies sind alles Regionen, St√§dte, Stra√üen.  Aber es scheint, dass kein einziges Projekt f√ºr Menschen ohne sie auskommen kann.  Dies ist die Adresse, an der eine Person gesucht oder Pakete an sie gesendet werden sollen.  Diese Details des Passes oder eines anderen Dokuments m√ºssen gespeichert werden.  Oder vielleicht ist es die Adresse des Arbeitsb√ºros oder der Sehensw√ºrdigkeiten, die zu besuchen empfohlen werden.  Und was machen?  Wo zu bekommen <br><br>  Die einfachste L√∂sung, ohne R√ºcksicht auf Fehler und Duplikate, sind primitive Objekte, die einfache Zeichenfolgenliterale enthalten (sie sind Zeichenfolgenkonstanten, sie sind auch Zeichenfolgen).  Lassen Sie Benutzer die n√§chsten empfangenen Eintr√§ge eingeben.  Und die Objekte k√∂nnen sich selbst retten - das haben wir bereits <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">bestanden</a> . <br><br>  Solche Objekte sind beispielsweise wie in der folgenden Klasse beschrieben.  <a href="">Direkt aus dem Lehrbuch</a> , wenn auch amerikanisch, aber angepasst an unsere russische Realit√§t - anstelle ihrer Postleitzahl wird es unseren Postleitzahl geben.  Ich w√ºrde auch die Postleitzahl durch eine Nummer ersetzen, aber aus Gr√ºnden der Monotonie hinterlasse ich eine Zeichenfolge.  Jeder, der eine Sprache sofort erkennt und dies ist ObjectScript, hat Anspruch auf ein ermutigendes Like. <br><br><pre><code class="plaintext hljs">Class Soviet.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  Nat√ºrlich werden viele emp√∂rt sein, sie sagen, dass alles aus den Taschen des Objekts ragt (Literale).  Wo wurde es gesehen, damit das Objekt seine Felder √∂ffentlich beleuchtet?!  Lassen wir es so, es tut auch einem beredten Beispiel weh und ist f√ºr jeden Sch√ºler verst√§ndlich. <br><br>  Das ist eigentlich alles was ben√∂tigt wird.  In den Feldern ausgef√ºllt.  Einlagern.  Zur Arbeit auf andere Objekte √ºbertragen.  Weiter an jemanden vererbt.  Alles arbeitet.  Und gespeichert! <br><blockquote>  Aber ein paar Worte, warum dies nicht wert ist, m√ºssen gesagt werden.  Wie lautet unsere Objektadresse?  Warum kann es nicht einfach eine Gruppe von Textzeichenfolgen sein?  Die offensichtlichsten Einw√§nde, die mir in den Sinn kommen, kommen aus dem Kontext - wer verwendet diese Adresse in welcher Form und zu welchem ‚Äã‚ÄãZweck?  Versuchen Sie, Ihr Programmierdenken beiseite zu legen und stellen Sie sich vor, wie ein ‚Äûausl√§ndischer Tourist‚Äú, ein ‚ÄûHistoriker‚Äú, ein ‚ÄûSteuerinspektor‚Äú, ein ‚ÄûAnwalt‚Äú usw. denken. <br><br>  Ich glaube, dass sich sofort eine Reihe zus√§tzlicher Fragen und Klarstellungen ergeben: Welche Sprache muss verwendet werden, in welcher Codierung muss gespeichert und gegeben werden, in welcher Zeit muss klassifiziert werden, welche Dokumente werden in Kraft gesetzt, legal oder postalisch?  Ist eine Stadt eine benannte Siedlung oder was?  Sogar eine Stra√üe kann sich als Boulevard, Seitenstra√üe, Allee oder etwas anderes herausstellen.  Was tun mit all diesen wichtigen Implementierungsdetails? <br><br>  Nehmen Sie ein lebendiges Beispiel.  Google wird jetzt von Sundar Pichai betrieben.  Er selbst kommt aus Indien.  Geboren in der Stadt Chennai (auch bekannt als Chennai).  Oder in Madras?  1996 entschieden die Indianer, dass der Name der Stadt sehr portugiesisch war und benannten die Hauptstadt von Tamil Nadu von Madras nach Chennai um.  Und was sollen Sundar und 72 Millionen seiner Landsleute in seine elektronischen Dokumente schreiben? <br><br>  Im Allgemeinen befasst sich die gesamte Wissenschaft mit dieser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">angewandten Toponymie</a> . </blockquote>  Also betteln Fragen.  Wie gehe ich mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Uhrzeit und Datum um</a> ?  Ist <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Geld</a> so <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">offensichtlich</a> ?  Sind geografische Koordinaten so einfach?  Und wie ist das in Ihrem Code implementiert?  K√∂nnen Sie auf das ausgew√§hlte DBMS √ºbertragen, ohne die Abstraktionsebene zu verringern?  Wie kann man nicht in atomare Arten von Maschinendaten schl√ºpfen und st√§ndig √ºber deren Rekonstruktion nachdenken?  Hier lohnt es sich, nach der Quelle einer primitiven oder umgekehrt soliden API zu suchen.  Denken Sie nach Belieben dar√ºber nach. <br><br>  Kurz gesagt, der Kontext ist das Wichtigste.  Und das Objektmodell erm√∂glicht es uns, es direkt durch die Kapselung von ‚ÄûMaschinendaten‚Äú und die Implementierung von kontextsensitivem ‚ÄûLive‚Äú -Verhalten zu verwenden.  √úberhaupt nicht die niedrigen Tupel, die in Tabellen angeordnet sind ;-) <br><br>  Kehren wir in der Zwischenzeit zur "primitiven" Implementierung zur√ºck und verkomplizieren wir unser Leben.  Beseitigen Sie zun√§chst Fehler und Duplikate.  Das hei√üt, wir werden nach einer M√∂glichkeit suchen, Adressen sofort zu schreiben.  Gleichzeitig helfen wir den Entwicklern der Benutzeroberfl√§che, Tipps f√ºr Benutzer beim Ausf√ºllen von Dateneingabefeldern zu organisieren. <br><blockquote>  Wenn sich zwei Personen an einem Ort versammeln - Texte und die InterSystems IRIS-Datenplattform - hat der Entwickler die echte M√∂glichkeit, die Bereitstellung vollst√§ndig durchzuf√ºhren, ohne die Maschine zu verlassen.  Verwenden Sie beispielsweise die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">integrierten Objektkomponenten iKnow und iFind</a> .  Dies sind Komponenten f√ºr die Arbeit mit unstrukturierten Daten bzw. f√ºr die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Volltextsuche</a> .  Russisch wird "out of the box" unterst√ºtzt. </blockquote>  Als erstes werden wir der Adresse beibringen, die erforderlichen Daten aus der Originalquelle zu lesen.  Gl√ºcklicherweise enth√§lt der Datensatz des Bundessteuerdienstes vorgefertigte Beschreibungen der Struktur von XML-Dokumenten.  Gem√§√ü der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beschreibung</a> , die den Daten <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">von der FIAS-Website</a> beigef√ºgt ist, ben√∂tigen wir den ADDROBJ-Datensatz, der in meinem Fall der Datei AS_ADDROBJ_2_250_01_04_01_01.xsd entspricht <br><br>  Als N√§chstes verwenden wir den Systemkonverter der XSD-Vorlage f√ºr die entsprechende Feldstruktur der% XML.Adaptor-Klasse, die freundlicherweise von den IRIS-Entwicklern f√ºr uns vorbereitet wurde.  Das Prozentzeichen am Anfang bedeutet nur, dass dies eine Klasse aus der Systembibliothek ist.  <a href="">Einzelheiten zur Verwendung finden Sie in der Dokumentation</a> .  Wir werden Operationen im Terminal durchf√ºhren. <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("http://localhost/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre> <br>  Dasselbe kann in der <a href="">Atelier-IDE</a> (im Men√º Extras&gt; Add-Ins&gt; XML-Schema-Assistent) oder durch √§hnliche Anforderungen an Objekte direkt aus dem Programmcode abgerufen werden. <br><br><img src="https://habrastorage.org/webt/ed/3k/8c/ed3k8cfd9t_jc8gklg_euthhihy.png"><br><br>  Da wir den Konstruktor verwendet haben, ohne die Parameter anzugeben, n√§mlich den Namen des Pakets zum Platzieren der resultierenden Klassen, sind sie im Testpaket gelandet.  Wie Sie dem zweiten Befehl entnehmen k√∂nnen, habe ich die Schemadatei √ºber meinen lokalen Webserver in Python √ºbergeben: <br><br><pre> <code class="bash hljs">python3 -m http.server 80</code> </pre> <br>  Sie k√∂nnen jeden anderen http-Server verwenden, den Sie m√∂gen.  Oder laden Sie die Datei auf Ihren IRIS-Server hoch und geben Sie den direkten Pfad dazu an. <br><br>  Daher haben wir zwei Klassen, die die Struktur unseres adressierbaren XML vollst√§ndig widerspiegeln: <br><br><div class="spoiler">  <b class="spoiler_title">Test.AddressObjects</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///            Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; ///    Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">Testobjekt</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///  : http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// OKATO Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// OKTMO Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); ///    Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///        Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); ///        Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); ///           4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); ///      4.0      (  ) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); ///     .     .      . /// 0 ‚Äì   /// 1 -  Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///   Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     ‚Äì    (.   OperationStatus): /// 01 ‚Äì ; /// 10 ‚Äì ; /// 20 ‚Äì ; /// 21 ‚Äì  ; /// 30 ‚Äì ; /// 31 -     ; /// 40 ‚Äì    (); /// 41 ‚Äì     ; /// 42 -        ; /// 43 -         ; /// 50 ‚Äì ; /// 51 ‚Äì     ; /// 60 ‚Äì    ; /// 61 ‚Äì        Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    4 (    ) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); ///     Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///  : /// 0 -   /// 1 - ; /// 2 - - Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre> <br></div></div><br>  Aus der gesamten Liste der XML-Dateien in FIAS verwenden wir nur eine Datei mit den Namen von Regionen, St√§dten und Stra√üen.  Zum Zeitpunkt der Vorbereitung der Ver√∂ffentlichung hatte ich Folgendes: <br>  AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML <br><br>  Die Dateigr√∂√üe ist weder gro√ü noch klein, sondern fast 3 GB.  Sie werden es nicht mit normalen Textwerkzeugen √∂ffnen - sie verdauen diese Gr√∂√üe nicht. <br><blockquote>  Die maximale L√§nge eines String-Literal (String-Typ) in InterSystems IRIS betr√§gt √ºbrigens nicht mehr als 3.641.144 Zeichen.  Das hei√üt, das direkte Herunterladen der Datei oder der URL schl√§gt fehl.  Weitere Einschr√§nkungen finden Sie <a href="">in der Dokumentation</a> .  Um mit gro√üen Datenmengen zu arbeiten, k√∂nnen Sie Datenstr√∂me (Streams) verwenden, f√ºr die es keine solche L√§ngenbeschr√§nkung gibt. </blockquote>  Mal sehen, was wir bekommen? <br><br>  FIAS gef√ºllter Pfeffer kochen.  Dies ist nur eine Vorbereitung auf eine wunderbare Zukunft.  Zuerst erhalten wir den anf√§nglichen Mindestsatz.  Wir brauchen nur diese Zutaten: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ];</code> </pre><br>  Als n√§chstes <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">schreiben Sie</a> .  Wir erstellen ein Objekt, das XML als nativ versteht. Wir verwenden eine Klasse aus der Systembibliothek% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  Und wir geben ihm Anweisungen, wen er nehmen soll, und ignorieren den Rest.  Wir nehmen eine Portion: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject")</code> </pre> <br>  Dann gibt es Variationen, wie man die urspr√ºngliche microbd-Datei erh√§lt.  Wenn es Ihnen passt, k√∂nnen Sie es neben das Repository stellen - lokal im Dateisystem des IRIS-Servers.  Oder fragen Sie wie in meinem Beispiel nach dem Senden √ºber HTTP.  Es gibt eine noch universellere Option, die im Folgenden einige Worte enth√§lt. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre> <br><blockquote>  Wichtig!  In diesem Moment wird die Mehrheit, die dieses Beispiel an sich selbst weitergeben wird, eine schreckliche Sache haben.  Das System kehrt anstelle der freudigen ‚Äû1‚Äú zur√ºck (alles ist in Ordnung), was mit ‚Äû0 ¬∏ STORE ...‚Äú beginnt.  Und es wird nicht gefallen.  Das hei√üt, die Datei mit einer scheinbar mikrobasierten Basis ist nicht ganz mikro und passt nicht in unser Objekt.  Der ihm zugewiesene Speicher reichte nicht aus.  L√∂sbar?  Nat√ºrlich.  Mit der IRIS-Datenplattform k√∂nnen Sie Objekte mit bis zu 4 TB im RAM erstellen.  Was ist dann schief gelaufen?  Standardm√§√üig sind die Systemeinstellungen auf 256 MB pro Objekt festgelegt.  Und wir w√ºrden viel mehr brauchen.  Und denken Sie daran, dies sind RAM-Anforderungen.  Ist auf Ihrem Computer / Server gen√ºgend Vorrat vorhanden? </blockquote>  Welche Speichergr√∂√üe wir ben√∂tigen, um diesen Riesen zu installieren, haben wir empirisch installiert - fast 10 GB.  Was m√ºssen Sie in den Einstellungen (Men√º&gt; Speicher konfigurieren&gt; Maximaler Speicher pro Prozess (KB)) oder √ºber die <a href="">Systemvariable $ ZSTORAGE</a> (in Kilobyte) <a href="">angeben</a> : <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=10000000</code> </pre> <br>  Einen neuen Prozess mit den erforderlichen Speichereinstellungen gestartet?  Dann ist alles einfach weiter - wir lesen und speichern. <br><br>  Es gibt eine alternative (und wahrscheinlich bevorzugte) Option: <a href="">Verwenden Sie die UsePPGHandler-Eigenschaft</a> der% XML.Reader-Klasse, mit der Sie XML nicht im Speicher speichern k√∂nnen und die mit den Standardspeichereinstellungen arbeitet. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre> <br>  mehr ... Korrelieren / Lesen usw.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre> <br>  Und so 3.722.548 mal f√ºr jede Operation :-) <br><br>  Das ist anstrengend.  Daher erg√§nzen wir unsere FIAS.AddressObject-Klasse mit einer Importmethode, die auf den gerade gezeigten Befehlen basiert: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { //     XML Set reader = ##class(%XML.Reader).%New() //   XML   Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} //       Do reader.Correlate("Object","FIAS.AddressObject") //       While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } //      ,   If $$$ISERR(status) {Do $System.Status.DisplayError(status)} }</code> </pre> <br>  Lassen Sie uns die Leistung unseres Computer-Exokortex nutzen - nur ein Befehl <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">im Terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre> <br><img src="https://habrastorage.org/webt/bd/mh/t7/bdmht7k0urpyo07qcdcmkj5_nym.gif"><br><br>  Ich bitte alle an den Tisch.  Es gab MCD, und jetzt ist das fertige Gericht in Form eines Global mit den verifizierten Namen der russischen St√§dte und Gewichten fertig. <br><br><img src="https://habrastorage.org/webt/1u/he/a6/1uhea6bdexgrpwlfpmtn2b2gdyy.png"><br><br>  Und zum Schluss noch ein paar Worte dar√ºber, wann 4 TB nicht ausreichen.  In diesem Fall <a href="">folgen wir den Streams</a> (oder Streams, wenn Sie m√∂chten).  Die Dokumentation ist in Regalen ausgelegt.  Sie k√∂nnen bin√§r, Sie k√∂nnen symbolisch.  Das Speichern im globalen Bereich ist ebenfalls nicht verboten.  Das Rezept lautet: Wir nehmen einen Strom, schneiden ihn in Teile und geben ihn den Gegenst√§nden, die wir zum Verzehr ben√∂tigen. <br><br>  Dar√ºber hinaus passten sch√∂ne adressierbare ObjectScript-Objekte und APIs in Python nicht.  Es wird eine separate Geschichte geben. <br><blockquote>  Angenehm: Gartner hat gerade die j√§hrliche Sammlung realer Benutzerbewertungen und -bewertungen in der Kategorie DBMS abgeschlossen und auf dieser Grundlage seine Bewertung des besten DBMS von 2019 ver√∂ffentlicht.  Die Produkte von InterSystems Cach√© und InterSystems IRIS Data Platform haben die h√∂chste Kundenauswahlbewertung erhalten.  Von wem Sie gew√§hlt haben und wie Sie bewertet haben, k√∂nnen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sie selbst nachsehen</a> . </blockquote>  Beste Software f√ºr betriebliche Datenbankverwaltungssysteme von 2019, wie von Kunden bewertet <br><br><img src="https://habrastorage.org/webt/gw/jg/dd/gwjgdd1segqlvnnpfzgo9buww4y.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438062/">https://habr.com/ru/post/de438062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438046/index.html">Wie kann man schnell eine Million Punkte auf Spark geocodieren?</a></li>
<li><a href="../de438050/index.html">Kalman-Filter zur Minimierung des Entropiewertes eines zuf√§lligen Fehlers mit einer nicht-Gau√üschen Verteilung</a></li>
<li><a href="../de438052/index.html">Interaktor, Betriebsmuster</a></li>
<li><a href="../de438058/index.html">"Datenanalyse in Python" in zwei Teilen</a></li>
<li><a href="../de438060/index.html">Einsch√§tzung der r√§umlichen Ausrichtung oder Wie man keine Angst vor Mahoney- und Majwik-Filtern hat</a></li>
<li><a href="../de438064/index.html">Checkliste: Was musste vor dem Start von Microservices in Prod getan werden?</a></li>
<li><a href="../de438066/index.html">10 lehrreiche YouTube-Kan√§le auf Englisch, von denen Sie noch nie geh√∂rt haben</a></li>
<li><a href="../de438070/index.html">Wie wurde aus der Generation Y eine ausgebrannte Generation?</a></li>
<li><a href="../de438074/index.html">[Ank√ºndigung f√ºr Jekaterinburg, Nowosibirsk, St. Petersburg] QAutomationstestsitzung: Wir werden alles von der Newa bis zum Ob mit Tests abdecken</a></li>
<li><a href="../de438078/index.html">Facebook zahlt 20 US-Dollar pro Monat f√ºr die Einrichtung seines Pseudo-VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>