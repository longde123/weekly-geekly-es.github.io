<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩‍👦‍👦 🚵 ✋🏼 Office 365 Outlook找到未记录的API，其中包含详细的用户活动日志 👨🏾‍🔧 😷 🏴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Magic-Unicorn-Tool提取的详细Office 365 Outlook日志：攻击者正在寻找付款发票。 搜索查询的第一个字母输入于10：42：44.548，最后一个字母输入于10：43：07.214。 活动信息在日志中存储六个月。 

 长期以来，有传言称Office 365具有用于记录用...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Office 365 Outlook找到未记录的API，其中包含详细的用户活动日志</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/415899/"><img src="https://habrastorage.org/webt/ss/4n/1h/ss4n1hztnfofodcmqntzih5xmee.png"><br><br>  <i><font color="gray"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Magic-Unicorn-Tool</a>提取的详细Office 365 Outlook日志：攻击者正在寻找付款发票。</font></i>  <i><font color="gray">搜索查询的第一个字母输入于10：42：44.548，最后一个字母输入于10：43：07.214。</font></i>  <i><font color="gray">活动信息在日志中存储六个月。</font></i> <br><br> 长期以来，有传言称Office 365具有用于记录用户活动的内置秘密工具。 这些谣言在2018年6月得到了充分证实。 这一切都始于<i>Anonymous</i>发布的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">视频</a> ，然后CrowdSrtike专家上传了<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">详细的报告</a> 。 <br><br>  Microsoft将Activity API引入电子邮件客户端不是出于任何恶意目的，而是出于数字取证的任务，即调查涉及黑客攻击公司邮件和其他数据泄漏的事件。 为此， <i>即使用户已禁用日志记录</i> ， <i>也要</i>保留六个月的详细活动日志。 <br><a name="habracut"></a><br><h1> 电子邮件帐户骇客流行 </h1><br> 在全球范围内，黑客攻击企业电子邮件帐户已经变得非常普遍，以至于一些专家<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">将此称为流行病</a> 。 攻击者可以访问带有社会保险号，有关金融发票的详细信息和商业秘密的电子表格。 他们利用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">文件上</a>缺乏<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">数字签名的</a>优势，寻找有关银行转账的信息并窃取资金。 通过<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">CrowdStrike手册</a>描述了通过破坏商业邮件造成的各种欺诈。 <br><br> 例如，6月初，FBI进行了一次<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">国际行动，</a>并在涉及该业务的几个国家拘留了74人。 <br><br> 当知道黑客的事实时，重要的是要了解：黑客可以访问哪些数据，他看到了什么以及他复制了什么信息。 机密数据泄漏了吗？ 由于默认情况下Office 365的登录处于关闭状态，因此调查事件变得更加困难。 在没有任何真实信息的情况下，公司有义务依法公开宣布数据泄漏，并承担所有随之而来的后果-声誉成本，罚款等。 <br><br> 但是现在众所周知，Office 365中有带有详细日志记录的“活动” API，并且如果公司知道此丑闻，则可以避免许多此类丑闻。 也许，只有某些特权客户端才可以访问这些秘密日志。 有些<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">信息</a> ，一些专门从事数字取证的公司去年甚至更早就知道了秘密的Office 365审核工具。 有人认为他们的言论是行销虚张声势，但事实证明这是事实。 令人惊讶的是，存在Activity API，Microsoft确实隐藏了这样一个重要且有用的工具的存在，即所谓的专业Magic Unicorn，因此，用于日志自我分析的程序的名称如下所述。 <br><br> <a href=""><img src="https://habrastorage.org/webt/ji/-f/e0/ji-fe0abu-a7c-v-x6xnh6cbogc.png"></a> <br><br>  <i><font color="gray">攻击者扫描包含付款发票和W-9表格的邮件。</font></i>  <i><font color="gray"><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Magic-Unicorn-Tool</a>提取的详细日志</font></i> <br><br><h1> 人群罢工调查 </h1><br>  CrowdStrike <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">详细描述</a>了默认情况下Office 365日记如何对所有用户起作用。 该功能包含一个Web API，该API通过Exchange Web服务（EWS）检索Office 365 Outlook活动信息。 知道端点和特定HTTP标头的任何人都可以访问API。 <br><br> 未记录的活动API是<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Outlook REST API</a>的所有三个版本（1.0、2.0和Beta）的子集。 与其余子集一样，必须使用OAuth 2.0或基本身份验证对API调用进行身份验证。 <br><br> 终点如下： <br><br><pre><code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/</span></span>{user_context}/Activities</code> </pre> <br> 所有请求均以HTTP GET数据包的形式发送，其中必须包含以下HTTP标头： <br><br><pre> <code class="hljs objectivec">Prefer: exchange.behavior=<span class="hljs-string"><span class="hljs-string">"ActivityAccess"</span></span></code> </pre> <br> 没有此标头的请求将返回<code>HTTP 400 Bad Request</code> 。 <br><br> 还<code>Authorization</code>标头： <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Authorization</span></span>: Bearer &lt;<span class="hljs-keyword"><span class="hljs-keyword">access</span></span> token&gt;</code> </pre> <br> 没有此标头的请求将返回<code>HTTP 403 Unauthorized</code>响应。 <br><br> 为了进行测试，可以在<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Oauth沙箱中</a>生成OAuth 2.0访问令牌。 有效期为60分钟。 <br><br> 对API的最简单调用是请求其活动的最后十个。 <br><br><pre> <code class="hljs ruby">GET <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/me</span></span><span class="hljs-regexp"><span class="hljs-regexp">/Activities</span></span></code> </pre> <br> 来自JSON格式的API响应示例显示了标准活动属性： <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"Id"</span></span>:<span class="hljs-string"><span class="hljs-string">"WOGVSAiPKrfJ4apAPcBksT2en7whzDz4NIbUs3=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityCreationTime"</span></span>:<span class="hljs-string"><span class="hljs-string">"2010-04-01T12:34:56.789Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityIdType"</span></span>:<span class="hljs-string"><span class="hljs-string">"ReadingPaneDisplayStart"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"AppIdType"</span></span>:<span class="hljs-string"><span class="hljs-string">"Outlook"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ClientVersion"</span></span>:<span class="hljs-string"><span class="hljs-string">"15.00.0000.000"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ClientSessionId"</span></span>:<span class="hljs-string"><span class="hljs-string">"679126f3-02de-3513-e336-0eac1294b120"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ActivityItemId"</span></span>:<span class="hljs-string"><span class="hljs-string">"NjKG5m6OmaCjGKq6WlbjIzvp94czUDg30qGopD=="</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TimeStamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"2010-04-01T12:34:56.789Z"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"TenantId"</span></span>:<span class="hljs-string"><span class="hljs-string">"679126f3-02de-3513-e336-0eac1294b120"</span></span>, } ] }</code> </pre> <br> 如果通过共享邮箱或应用程序许可获得许可，则通过API，您不仅可以为自己请求活动，还可以为其他用户请求活动： <br><br><pre> <code class="hljs ruby">GET <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/outlook.office.com/api</span></span><span class="hljs-regexp"><span class="hljs-regexp">/v2.0/</span></span>Users(<span class="hljs-string"><span class="hljs-string">'victim@contoso.com'</span></span>)/Activities</code> </pre> <br> 活动API支持多个查询参数： <br><br><ul><li>  <code>$orderby</code> ：按给定表达式对结果进行排序 </li><li>  <code>$filter</code> ：按日期和/或活动类型过滤结果 </li><li>  <code>$select</code> ：选择返回属性 </li><li>  <code>$top</code> ：返回的最大活动数 </li><li>  <code>$skip</code> ：结果中被跳过的活动数 </li></ul><br> 目前，CrowdStrike已经确定了30种活动类型，但实际上可能更多。 以下是最有用的： <br><br><ul><li>  <code>Delete</code> ：删除字母 </li><li>  <code>Forward</code> ：电子邮件转发 </li><li>  <code>LinkClicked</code> ：单击电子邮件中的链接 </li><li>  <code>MarkAsRead</code> ：标记为已读的消息 </li><li>  <code>MarkAsUnread</code> ：标记为未读的消息 </li><li>  <code>MessageDelivered</code> ：信件已传递到邮箱 </li><li>  <code>MessageSent</code> ：从邮箱发送的电子邮件 </li><li>  <code>Move</code> ：电子邮件已重新安排 </li><li>  <code>OpenedAnAttachment</code> ：打开应用程序 </li><li>  <code>ReadingPaneDisplayEnd</code> ：在视图窗格中<code>ReadingPaneDisplayEnd</code>字母 </li><li>  <code>ReadingPaneDisplayStart</code> ：在视图窗格中选择要写入的突出显示。 </li><li>  <code>Reply</code> ：回信 </li><li>  <code>SearchResult</code> ：生成搜索结果 </li><li>  <code>ServerLogon</code> ：授权事件 </li></ul><br> 还有其他有趣的活动类型可用于调查事件： <code>SenderSmtpAddress</code> ， <code>Recipients</code> ， <code>Subject</code> ， <code>SentTime</code> ， <code>InternetMessageId</code> ， <code>ClientIP</code> ， <code>UserAgent</code>等。 <br><br>  CrowdStrike专家已经发布<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">了一个Python模块</a> ，该<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">模块</a>从Office 365 Outlook Activities API中提取信息，并将接收到的数据写入CSV文件。 <br><br><h1> 魔术独角兽工具 </h1><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Magic-Unicorn-Tool</a>程序解析由上述Python模块获得的Activity API日志。 目前，它能够解析和显示以下信息： <br><br><ul><li> 搜索邮箱中的查询，查看消息和/或授权会话的时间。 </li><li> 授权事件（登录和ServerLogon），日期，时间，IP地址和浏览器类型。 </li><li> 所有已发送邮件并标记为已读信件的活动。 </li><li> 参照上一个授权事件从会话ID中记录的搜索事件。 </li><li> 阅读面板。 </li><li> 查看附件。 </li></ul><br><img src="https://habrastorage.org/webt/fj/xw/n9/fjxwn9xwhiceprwy0hk8whevtu4.png"><br>  <i><font color="gray">从其他IP地址登录到您的帐户</font></i> <br><br>  Magic-Unicorn-Tool的发布没有<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">代码签名</a> ，但是带有开源代码。 <br><br> 在用户不知情的情况下实施诸如Activity API之类的工具会给整个数字取证行业带来许多实际和道德问题。 默认情况下，在Office 365帐户上禁用日记功能，它不是标准ProPlus和E1计划的一部分。 公司必须为账目审计支付额外的费用，并且由于缺乏日志（如他们所想），许多公司蒙受了损失。 同时，Activity API日志的粒度远远超过已记录的日志记录方法（例如<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Unified Audit Log）</a>的粒度。 <br><br>  LMG Security的数字取证专家<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">呼吁</a>采用活动日志记录标准，并将其作为云提供商的强制性负担，因为现在强制性负载已成为数据中心的火灾报警系统。 <br><br> 需要采用标准，以便提供商不仅保留日志，而且还以标准格式为客户和审计公司提供日志，并且不会作为更昂贵的关税计划的一部分或作为单独的有偿服务为选定的客户保密。 <br><br><hr><br>  <b>GMO GlobalSign俄罗斯针对Habr订户的行动</b> <b><br><img src="https://habrastorage.org/webt/u3/my/b4/u3myb4ifqihiox-vpuqxbx4kij0.jpeg"></b> <br><br> 您可以通过致电+7（499）678 2210与GlobalSign经理联系来获取更多信息，或<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在网站上</a>填写促销代码CS002HBFR的表格。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN415899/">https://habr.com/ru/post/zh-CN415899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN415887/index.html">什么样的蜘蛛机器人飞越体育场并射击足球。 采访Robycam的创造者</a></li>
<li><a href="../zh-CN415891/index.html">有哪些续集游戏很棒？</a></li>
<li><a href="../zh-CN415893/index.html">如何使在Linux / Docker上运行的Java流程简单明了</a></li>
<li><a href="../zh-CN415895/index.html">编程中最重要的模式</a></li>
<li><a href="../zh-CN415897/index.html">记录PostgreSQL数据库的功能。 第二部分</a></li>
<li><a href="../zh-CN415901/index.html">联邦委员会委员会支持为所有白色电话创建IMEI基地的想法</a></li>
<li><a href="../zh-CN415903/index.html">欢迎参加7月7日夏季的DIYorDIE聚会</a></li>
<li><a href="../zh-CN415905/index.html">如何种植健康的产品（Juno示例）</a></li>
<li><a href="../zh-CN415907/index.html">如何在不冒公司形象风险的前提下解雇员工</a></li>
<li><a href="../zh-CN415909/index.html">用于自定义脚本的跨浏览器Web扩展第2部分</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>