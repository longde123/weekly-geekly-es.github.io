<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêº ‚õ≤Ô∏è ‚ú¥Ô∏è O livro "Linux em a√ß√£o" üï∫üèæ ‚úâÔ∏è üë©üèø‚Äçü§ù‚Äçüë©üèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi, habrozhiteli! No livro, David Clinton descreve 12 projetos do mundo real, incluindo automatizar um sistema de backup e recupera√ß√£o, configurar uma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O livro "Linux em a√ß√£o"</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/piter/blog/461879/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><img src="https://habrastorage.org/webt/d4/en/xh/d4enxhes8pqnlk78urqxopa7ley.jpeg" align="left" alt="imagem"></a>  Oi, habrozhiteli!  No livro, David Clinton descreve 12 projetos do mundo real, incluindo automatizar um sistema de backup e recupera√ß√£o, configurar uma nuvem de arquivos pessoal no estilo Dropbox e criar seu pr√≥prio servidor MediaWiki.  Com exemplos interessantes, voc√™ aprender√° sobre virtualiza√ß√£o, recupera√ß√£o de desastres, seguran√ßa, backup, implanta√ß√£o do DevOps e solu√ß√£o de problemas do sistema.  Cada cap√≠tulo termina com uma revis√£o de recomenda√ß√µes pr√°ticas, um gloss√°rio de novos termos e exerc√≠cios. <br><br><h3>  Trecho "10.1.  Criando um t√∫nel OpenVPN ¬ª </h3><br><a name="habracut"></a>  Neste livro, eu j√° falei muito sobre criptografia.  O SSH e o SCP podem proteger os dados transmitidos por conex√µes remotas (cap√≠tulo 3), a criptografia de arquivos permite proteger os dados quando armazenados no servidor (cap√≠tulo 8), e os certificados TLS / SSL podem proteger os dados durante a transmiss√£o entre sites e navegadores clientes (cap√≠tulo 9).  Mas, √†s vezes, seus dados exigem prote√ß√£o em uma ampla variedade de conex√µes.  Por exemplo, √© poss√≠vel que alguns membros da sua equipe trabalhem na estrada, conectando-se √† rede via Wi-Fi atrav√©s de pontos de acesso p√∫blico.  Definitivamente, voc√™ n√£o deve assumir que todos esses pontos de acesso s√£o seguros, mas seu pessoal realmente precisa de uma maneira de se conectar aos recursos da empresa - nesse caso, uma VPN ajudar√°. <br><br>  Um t√∫nel VPN projetado corretamente fornece uma conex√£o direta entre clientes remotos e o servidor de forma a ocultar os dados quando eles s√£o transmitidos por uma rede insegura.  E da√≠?  Voc√™ j√° viu muitas ferramentas que podem fazer isso com criptografia.  O valor real das VPNs √© que, ao abrir o t√∫nel, voc√™ pode conectar redes remotas, como se todas estivessem juntas localmente.  Em certo sentido, voc√™ est√° usando uma solu√ß√£o alternativa. <br><br>  Usando uma rede estendida, os administradores podem trabalhar em seus servidores de qualquer lugar.  Mas, mais importante, uma empresa com recursos distribu√≠dos por v√°rias filiais pode torn√°-las vis√≠veis e acess√≠veis a todos os grupos que precisam deles, onde quer que estejam (Fig. 10.1). <br><br>  O pr√≥prio t√∫nel n√£o garante seguran√ßa.  Mas um dos padr√µes de criptografia pode ser inclu√≠do na estrutura da rede, o que aumenta significativamente o n√≠vel de seguran√ßa.  Os t√∫neis criados usando o pacote OpenVPN de c√≥digo aberto usam a mesma criptografia TLS / SSL que voc√™ j√° leu.  O OpenVPN n√£o √© a √∫nica op√ß√£o dispon√≠vel para tunelamento, mas uma das mais famosas.  Acredita-se que seja um pouco mais r√°pido e seguro do que um protocolo de encapsulamento de camada 2 alternativo que usa criptografia IPsec. <br><br>  Deseja que todos na sua equipe se comuniquem com seguran√ßa enquanto est√£o na estrada ou trabalhando em pr√©dios diferentes?  Para fazer isso, voc√™ deve criar um servidor OpenVPN para permitir o compartilhamento de aplicativos e acesso ao ambiente de rede local do servidor.  Para isso funcionar, basta iniciar duas m√°quinas virtuais ou dois cont√™ineres: um para atuar como servidor / host e outro para o cliente.  Criar uma VPN n√£o √© um processo f√°cil, por isso provavelmente vale a pena levar alguns minutos para obter uma vis√£o geral. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vg/gc/o1/vggco1j4npzsjj4rqo8r-5bzmz8.png" alt="imagem"></div><br><h3>  10.1.1  Configurando o servidor OpenVPN </h3><br>  Antes de come√ßar, darei conselhos √∫teis.  Se voc√™ vai fazer tudo sozinho (e eu recomendo isso para voc√™), provavelmente descobrir√° que est√° trabalhando com v√°rias janelas de terminal abertas na √°rea de trabalho, cada uma conectada √† sua m√°quina.  Existe o risco de que em algum momento voc√™ digite o comando errado na janela.  Para evitar isso, voc√™ pode usar o comando hostname para alterar o nome da m√°quina exibido na linha de comando para algo que indique claramente onde voc√™ est√°.  Assim que voc√™ fizer isso, ser√° necess√°rio sair do servidor e efetuar login novamente para que as novas configura√ß√µes entrem em vigor.  Aqui est√° o que parece: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b8/d9/o9/b8d9o9pzt2-m5-rtirtr46hl1lu.png" alt="imagem"></div><br>  Seguindo essa abordagem e atribuindo os nomes correspondentes a cada uma das m√°quinas com as quais trabalha, voc√™ pode acompanhar facilmente onde est√°. <br><br><blockquote>  Depois de usar o nome do host, voc√™ pode encontrar mensagens irritantes de Incapaz de resolver o host OpenVPN-Server ao executar os seguintes comandos.  A atualiza√ß√£o do arquivo / etc / hosts com o novo nome de host correspondente deve corrigir o problema. </blockquote><br><h3>  Preparando seu servidor para OpenVPN </h3><br>  A instala√ß√£o do OpenVPN no seu servidor requer dois pacotes: openvpn e easy-rsa (para controlar o processo de gera√ß√£o da chave de criptografia).  Se necess√°rio, os usu√°rios do CentOS devem primeiro instalar o reposit√≥rio epel-release, como voc√™ fez no cap√≠tulo 2. Para poder verificar o acesso ao aplicativo do servidor, voc√™ tamb√©m pode instalar o servidor da web Apache (apache2 para Ubuntu e httpd no CentOS). <br><br>  Enquanto voc√™ estiver configurando o servidor, aconselho a ativar um firewall que bloqueie todas as portas, exceto 22 (SSH) e 1194 (a porta OpenVPN padr√£o).  Este exemplo ilustra como o ufw funcionar√° no Ubuntu, mas tenho certeza que voc√™ ainda se lembra do programa CentOS do firewall do cap√≠tulo 9: <br><br><pre><code class="javascript hljs"># ufw enable # ufw allow <span class="hljs-number"><span class="hljs-number">22</span></span> # ufw allow <span class="hljs-number"><span class="hljs-number">1194</span></span></code> </pre> <br>  Para permitir o roteamento interno entre interfaces de rede no servidor, √© necess√°rio descomentar uma linha (net.ipv4.ip_forward = 1) no arquivo /etc/sysctl.conf.  Isso permitir√° que voc√™ redirecione clientes remotos conforme necess√°rio ap√≥s a conex√£o.  Para fazer o novo par√¢metro funcionar, execute sysctl -p: <br><br><pre> <code class="javascript hljs"># nano /etc/sysctl.conf # sysctl -p</code> </pre> <br>  Agora o ambiente do servidor est√° totalmente configurado, mas h√° outra coisa a ser feita antes de voc√™ estar pronto: voc√™ precisar√° seguir estas etapas (as consideraremos em mais detalhes abaixo). <br><br><ol><li>  Crie um conjunto de chaves no servidor para criptografar a infraestrutura de chave p√∫blica (PKI) usando os scripts que acompanham o pacote easy-rsa.  Em ess√™ncia, o servidor OpenVPN tamb√©m atua como sua pr√≥pria autoridade de certifica√ß√£o (CA). </li><li>  Prepare as chaves apropriadas para o cliente </li><li>  Configure o arquivo server.conf para o servidor </li><li>  Configure seu cliente OpenVPN </li><li>  Verifique sua VPN </li></ol><br><h3>  Gera√ß√£o de chave de criptografia </h3><br>  Para n√£o complicar sua vida, voc√™ pode configurar sua infraestrutura de chave na mesma m√°quina em que o servidor OpenVPN est√° em execu√ß√£o.  No entanto, as recomenda√ß√µes de seguran√ßa geralmente sugerem o uso de um servidor CA separado para implanta√ß√µes em um ambiente de produ√ß√£o.  O processo de gera√ß√£o e aloca√ß√£o de recursos da chave de criptografia para uso no OpenVPN √© ilustrado na Fig.  10.2 <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/rw/vl/a0/rwvla0o86yzylrzsytcf--7bnms.png" alt="imagem"></div><br>  Quando voc√™ instalou o OpenVPN, o diret√≥rio / etc / openvpn / foi criado automaticamente, mas ainda n√£o h√° nada nele.  Os pacotes openvpn e easy-rsa v√™m com arquivos de modelo de amostra que voc√™ pode usar como base para sua configura√ß√£o.  Para iniciar o processo de certifica√ß√£o, copie o diret√≥rio de modelos easy-rsa de / usr / share / para / etc / openvpn e mude para o diret√≥rio easy-rsa /: <br><br><pre> <code class="javascript hljs"># cp -r /usr/share/easy-rsa/ <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn $ cd /etc/openvpn/easy-rsa</code> </pre> <br>  O diret√≥rio easy-rsa agora conter√° alguns scripts.  Na mesa  10.1 lista as ferramentas que voc√™ usar√° para criar chaves. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ih/zx/zt/ihzxztprk0hm0gr9ozc8sz9qsgs.png" alt="imagem"></div><br><blockquote>  Essas opera√ß√µes requerem privil√©gios de root; portanto, atrav√©s do sudo su, voc√™ precisa se tornar root. </blockquote><br>  O primeiro arquivo com o qual voc√™ trabalhar√° √© chamado vars e cont√©m as vari√°veis ‚Äã‚Äãde ambiente que o easy-rsa usa ao gerar chaves.  Voc√™ precisa editar o arquivo para usar seus pr√≥prios valores, em vez dos valores padr√£o que j√° existem.  √â assim que meu arquivo ser√° (Listagem 10.1). <br><br>  Listagem 10.1.  Os principais fragmentos do arquivo / etc / openvpn / easy-rsa / vars <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_COUNTRY=<span class="hljs-string"><span class="hljs-string">"CA"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_PROVINCE=<span class="hljs-string"><span class="hljs-string">"ON"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_CITY=<span class="hljs-string"><span class="hljs-string">"Toronto"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_ORG=<span class="hljs-string"><span class="hljs-string">"Bootstrap IT"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_EMAIL=<span class="hljs-string"><span class="hljs-string">"info@bootstrap-it.com"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> KEY_OU=<span class="hljs-string"><span class="hljs-string">"IT"</span></span></code> </pre> <br>  A execu√ß√£o do arquivo vars permitir√° transferir seus valores para o ambiente shell, de onde eles ser√£o inclu√≠dos no conte√∫do de suas novas chaves.  Por que o comando sudo n√£o funciona sozinho?  Porque, no primeiro est√°gio, editamos o script chamado vars e o aplicamos.  Aplicativo e significa que o arquivo vars transfere seus valores para o ambiente shell, de onde eles ser√£o inclu√≠dos no conte√∫do de suas novas chaves. <br><br>  Certifique-se de executar novamente o arquivo usando o novo shell para concluir o processo inacabado.  Quando isso for feito, o script solicitar√° que voc√™ execute outro script, clean-all, para remover qualquer conte√∫do do diret√≥rio / etc / openvpn / easy-rsa / keys /: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2v/b4/ot/2vb4otncxyedhork8j0cs29s_64.png" alt="imagem"></div><br>  Naturalmente, a pr√≥xima etapa √© executar o script clean-all, seguido de build-ca, que usa o script pkitool para criar o certificado raiz.  Voc√™ ser√° solicitado a confirmar as configura√ß√µes de autentica√ß√£o fornecidas pelo vars: <br><br><pre> <code class="javascript hljs"># ./clean-all # ./build-ca Generating a <span class="hljs-number"><span class="hljs-number">2048</span></span> bit RSA private key</code> </pre> <br>  Em seguida, vem o script build-key-server.  Como ele usa o mesmo script pkitool junto com o novo certificado raiz, voc√™ ver√° as mesmas perguntas para confirmar a cria√ß√£o do par de chaves.  As chaves receber√£o nomes com base nos argumentos que voc√™ passar, que, a menos que voc√™ inicie v√°rias VPNs neste computador, geralmente ser√° servidor, como no exemplo: <br><br><pre> <code class="javascript hljs"># ./build-key-server server [...] Certificate is to be certified until Aug <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">52</span></span>:<span class="hljs-number"><span class="hljs-number">34</span></span> <span class="hljs-number"><span class="hljs-number">2027</span></span> GMT (<span class="hljs-number"><span class="hljs-number">3650</span></span> days) Sign the certificate? [y/n]:y <span class="hljs-number"><span class="hljs-number">1</span></span> out <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> certificate requests certified, commit? [y/n]y Write out database <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> entries Data Base Updated</code> </pre> <br>  O OpenVPN usa os par√¢metros gerados pelo algoritmo Diffie-Hellman (usando build-dh) para negociar autentica√ß√£o para novas conex√µes.  O arquivo criado aqui n√£o deve ser secreto, mas deve ser gerado usando o script build-dh para as chaves RSA atualmente ativas.  Se voc√™ criar novas chaves RSA no futuro, tamb√©m precisar√° atualizar o arquivo com base no algoritmo Diffie-Hellman: <br><br><pre> <code class="javascript hljs"># ./build-dh</code> </pre> <br>  Suas chaves do lado do servidor agora estar√£o no diret√≥rio / etc / openvpn / easy-rsa / keys /, mas o OpenVPN n√£o sabe disso.  Por padr√£o, o OpenVPN procurar√° as chaves em / etc / openvpn /, portanto, copie-as: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/server* <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn # cp /etc/openvpn/easy-rsa/keys/dh2048.pem /etc/openvpn # cp /etc/openvpn/easy-rsa/keys/ca.crt /etc/openvpn</code> </pre> <br><h3>  Preparando Chaves de Criptografia do Cliente </h3><br>  Como voc√™ j√° viu, a criptografia TLS usa pares de chaves correspondentes: uma est√° instalada no servidor e a outra no cliente remoto.  Isso significa que voc√™ precisar√° de chaves do cliente.  Nosso velho amigo pkitool √© exatamente o que voc√™ precisa para isso.  Neste exemplo, executando o programa no diret√≥rio / etc / openvpn / easy-rsa /, passamos o argumento do cliente para ele para gerar arquivos chamados client.crt e client.key: <br><br><pre> <code class="javascript hljs"># ./pkitool client</code> </pre> <br>  Os dois arquivos do cliente, juntamente com o arquivo ca.crt original, que ainda est√° no diret√≥rio keys /, agora devem ser transferidos com seguran√ßa para o seu cliente.  Devido √† sua afilia√ß√£o e direitos de acesso, isso pode n√£o ser t√£o f√°cil.  A abordagem mais f√°cil √© copiar manualmente o conte√∫do do arquivo de origem (e nada al√©m deste conte√∫do) para o terminal em execu√ß√£o na √°rea de trabalho do seu PC (selecione o texto, clique com o bot√£o direito do mouse e selecione Copiar no menu).  Em seguida, cole isso em um novo arquivo com o mesmo nome que voc√™ cria no segundo terminal conectado ao seu cliente. <br><br>  Mas qualquer um pode cortar e colar.  Em vez disso, pense como administrador, porque voc√™ nem sempre ter√° acesso √† GUI, onde √© poss√≠vel uma opera√ß√£o de recortar / colar.  Copie os arquivos para o diret√≥rio inicial do usu√°rio (para que a opera√ß√£o scp remota possa acess√°-los) e use chown para alterar o propriet√°rio dos arquivos da raiz para um usu√°rio n√£o raiz regular, para que a a√ß√£o scp remota possa ser executada.  Verifique se todos os seus arquivos est√£o atualmente instalados e acess√≠veis.  Voc√™ os mover√° para o cliente um pouco mais tarde: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/client.key /home/ubuntu/ # cp /etc/openvpn/easy-rsa/keys/ca.crt /home/ubuntu/ # cp /etc/openvpn/easy-rsa/keys/client.crt /home/ubuntu/ # chown ubuntu:ubuntu /home/ubuntu/client.key # chown ubuntu:ubuntu /home/ubuntu/client.crt # chown ubuntu:ubuntu /home/ubuntu/ca.crt</code> </pre> <br>  Com um conjunto completo de chaves de criptografia prontas para a a√ß√£o, voc√™ precisa informar ao servidor como deseja criar uma VPN.  Isso √© feito usando o arquivo server.conf. <br><br><blockquote>  <b>Reduza o n√∫mero de pressionamentos de tecla</b> <br><br>  Demais para imprimir?  Uma extens√£o entre par√™nteses ajudar√° a reduzir esses seis comandos para dois.  Estou certo de que voc√™ pode estudar esses dois exemplos e entender o que est√° acontecendo.  Mais importante, voc√™ pode entender como aplicar esses princ√≠pios a opera√ß√µes que envolvem dezenas ou at√© centenas de elementos: <br><br><pre> <code class="javascript hljs"># cp /etc/openvpn/easy-rsa/keys/{ca.crt,client.{key,crt}} /home/ubuntu/ # chown ubuntu:ubuntu /home/ubuntu/{ca.crt,client.{key,crt}}</code> </pre> <br></blockquote><br><h3>  Configurando o arquivo server.conf </h3><br>  Como voc√™ pode saber como deve ser o arquivo server.conf?  Lembre-se do modelo de diret√≥rio easy-rsa que voc√™ copiou de / usr / share /?  Durante a instala√ß√£o do OpenVPN, um arquivo de modelo de configura√ß√£o compactado permaneceu, o qual voc√™ pode copiar para / etc / openvpn /.  Vou aproveitar o fato de o modelo ter sido arquivado e apresent√°-lo a uma ferramenta √∫til: zcat. <br><br>  Voc√™ j√° sabe como exibir o conte√∫do do texto de um arquivo usando o comando cat, mas e se o arquivo for compactado usando o gzip?  Voc√™ sempre pode descompactar o arquivo e o gato exibir√° com prazer, mas este √© um ou dois passos mais do que o necess√°rio.  Em vez disso, como voc√™ provavelmente j√° adivinhou, √© poss√≠vel inserir o comando zcat para carregar o texto descompactado na mem√≥ria em uma etapa.  No exemplo a seguir, em vez de imprimir texto na tela, voc√™ o redireciona para um novo arquivo chamado server.conf: <br><br><pre> <code class="javascript hljs"># zcat \ /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz \ &gt; <span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>openvpn/server.conf $ cd /etc/openvpn</code> </pre> <br>  Deixamos de lado a documenta√ß√£o extensa e √∫til que acompanha o arquivo e vemos como ele pode parecer quando voc√™ terminar de editar.  Observe que o ponto-e-v√≠rgula (;) diz ao OpenVPN para n√£o ler ou executar a pr√≥xima linha (Listagem 10.2). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ft/en/4r/ften4rayxj99stxecmfjb9mx8eg.png" alt="imagem"></div><br>  Vamos passar por algumas dessas configura√ß√µes. <br><br><ul><li>  Por padr√£o, o OpenVPN funciona atrav√©s da porta 1194. Voc√™ pode alterar isso, por exemplo, para ocultar ainda mais suas a√ß√µes ou evitar conflitos com outros t√∫neis ativos.  Como o 1194 requer uma coordena√ß√£o m√≠nima com os clientes, √© melhor fazer isso. </li><li>  O OpenVPN usa o TCP (Transmission Control Protocol) ou o UDP (User Datagram Protocol) para transfer√™ncia de dados.  O TCP pode ser um pouco mais lento, mas √© mais confi√°vel e mais prov√°vel de ser entendido pelos aplicativos em execu√ß√£o nas duas extremidades do t√∫nel. </li><li>  Voc√™ pode dizer ao dev tun quando quiser criar um t√∫nel IP mais simples e eficiente que transmita o conte√∫do dos dados e nada mais.  Se, por outro lado, voc√™ precisar conectar v√°rias interfaces de rede (e as redes que elas representam) criando uma ponte Ethernet, ter√° que selecionar dev tap.  Se voc√™ n√£o entender o que tudo isso significa, use o argumento tun. </li><li>  As pr√≥ximas quatro linhas passam os nomes OpenVPN dos tr√™s arquivos de autentica√ß√£o no servidor e o arquivo de configura√ß√µes dh2048 que voc√™ criou anteriormente. </li><li>  A linha do servidor define o intervalo e a m√°scara de sub-rede que ser√£o usados ‚Äã‚Äãpara atribuir endere√ßos IP aos clientes no login. </li><li>  O par√¢metro push opcional "route 10.0.3.0 255.255.255.0" permite que clientes remotos acessem sub-redes privadas atr√°s do servidor.  Para executar este trabalho, voc√™ tamb√©m precisa configurar a rede no pr√≥prio servidor, para que a sub-rede privada conhe√ßa a sub-rede OpenVPN (10.8.0.0). </li><li>  A linha localhost de compartilhamento de porta 80 permite redirecionar o tr√°fego do cliente que passa pela porta 1194 para o servidor da web local que escuta na porta 80. (Ser√° √∫til se voc√™ pretende usar o servidor da web para testar sua VPN.) Isso s√≥ funciona se quando o protocolo tcp estiver selecionado. </li><li>  O usu√°rio ningu√©m e as linhas de grupo nogroup devem estar ativos - para isso, exclua o ponto e v√≠rgula (;).  For√ßar os clientes remotos a trabalharem sob ningu√©m e nogroup garante que as sess√µes no servidor n√£o sejam privilegiadas. </li><li>  log indica que as entradas de log atuais substituir√£o as entradas antigas toda vez que o OpenVPN for iniciado, enquanto o log-append adicionar√° novas entradas a um arquivo de log existente.  O pr√≥prio arquivo openvpn.log √© gravado no diret√≥rio / etc / openvpn /. </li></ul><br>  Al√©m disso, o valor de cliente para cliente tamb√©m √© frequentemente adicionado ao arquivo de configura√ß√£o, para que v√°rios clientes possam se ver al√©m do servidor OpenVPN.  Se voc√™ estiver satisfeito com sua configura√ß√£o, poder√° iniciar o servidor OpenVPN: <br><br><pre> <code class="javascript hljs"># systemctl start openvpn</code> </pre> <br><blockquote>  Devido √† natureza mut√°vel do relacionamento entre o OpenVPN e o systemd, √†s vezes pode ser necess√°ria a seguinte sintaxe para iniciar um servi√ßo: systemctl start openvpn @ server. </blockquote><br>  A execu√ß√£o de ip addr para exibir a lista de interfaces de rede do seu servidor agora deve exibir um link para uma nova interface denominada tun0.  O OpenVPN o criar√° para atender os clientes que chegam: <br><br><pre> <code class="javascript hljs">$ ip addr [...] <span class="hljs-number"><span class="hljs-number">4</span></span>: tun0: mtu <span class="hljs-number"><span class="hljs-number">1500</span></span> qdisc [...] link/none inet <span class="hljs-number"><span class="hljs-number">10.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> peer <span class="hljs-number"><span class="hljs-number">10.8</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span>/<span class="hljs-number"><span class="hljs-number">32</span></span> scope global tun0 valid_lft forever preferred_lft forever</code> </pre> <br>  Pode ser necess√°rio reiniciar o servidor antes que tudo comece a funcionar completamente.  A pr√≥xima parada √© o computador cliente. <br><br><h3>  10.1.2  Configura√ß√£o do cliente OpenVPN </h3><br>  Tradicionalmente, os t√∫neis s√£o constru√≠dos com pelo menos duas sa√≠das (caso contr√°rio, n√≥s os chamar√≠amos de cavernas).  Um OpenVPN configurado corretamente no servidor direciona o tr√°fego de e para o t√∫nel, por um lado.  Mas voc√™ tamb√©m precisa de algum tipo de software do lado do cliente, ou seja, do outro lado do t√∫nel. <br><br>  Nesta se√ß√£o, vou focar na configura√ß√£o manual de um computador Linux de um tipo ou de outro para funcionar como um cliente OpenVPN.  Mas essa n√£o √© a √∫nica maneira de disponibilizar esta oportunidade.  O OpenVPN suporta aplicativos clientes que podem ser instalados e usados ‚Äã‚Äãem computadores e laptops com Windows ou macOS, bem como em smartphones e tablets baseados no Android e iOS.  Veja openvpn.net para detalhes. <br><br>  O pacote OpenVPN precisar√° ser instalado no computador cliente, como foi instalado no servidor, embora n√£o seja necess√°rio o easy-rsa, pois as chaves que voc√™ usa j√° existem.  Voc√™ precisa copiar o arquivo de modelo client.conf para o diret√≥rio / etc / openvpn / que voc√™ acabou de criar.  Desta vez, o arquivo n√£o ser√° arquivado, portanto, o comando cp regular executar√° essa tarefa perfeitamente: <br><br><pre> <code class="javascript hljs"># apt install openvpn # cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf \ /etc/openvpn/</code> </pre> <br>  A maioria das configura√ß√µes no seu arquivo client.conf ser√° bem direta: elas devem corresponder aos valores no servidor.  Como voc√™ pode ver no exemplo de arquivo a seguir, o par√¢metro exclusivo √© 192.168.1.23 1194 remoto, que informa ao cliente o endere√ßo IP do servidor.  Novamente, verifique se esse √© o endere√ßo do seu servidor.  Voc√™ tamb√©m deve for√ßar o computador cliente a autenticar o certificado do servidor para evitar um poss√≠vel ataque man-in-the-middle.  Uma maneira de fazer isso √© adicionar o servidor remote-cert-tls da linha (Listagem 10.3). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m1/nw/2w/m1nw2wwrhwag7fct4mr4ggng5n4.png" alt="imagem"></div><br>  Agora voc√™ pode ir para o diret√≥rio / etc / openvpn / e extrair as chaves de certifica√ß√£o do servidor.  Substitua o endere√ßo IP do servidor ou o nome de dom√≠nio no exemplo pelos seus valores: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ng/u1/rm/ngu1rmk8tyxrntuepummte1wxuo.png" alt="imagem"></div><br>  Provavelmente nada de emocionante acontecer√° at√© voc√™ executar o OpenVPN no cliente.  Como voc√™ precisa passar alguns argumentos, voc√™ far√° isso na linha de comando.  O argumento --tls-client diz ao OpenVPN que voc√™ atuar√° como cliente e se conectar√° usando a criptografia TLS, e --config aponta para o seu arquivo de configura√ß√£o: <br><br><pre> <code class="javascript hljs"># openvpn --tls-client --config /etc/openvpn/client.conf</code> </pre> <br>  Leia a sa√≠da do comando com aten√ß√£o para garantir que voc√™ esteja conectado corretamente.  Se pela primeira vez algo der errado, isso pode ser devido a uma incompatibilidade entre as configura√ß√µes entre os arquivos de configura√ß√£o do servidor e do cliente ou a um problema de conex√£o / firewall de rede.  Aqui est√£o algumas dicas para solu√ß√£o de problemas. <br><br><ul><li>  Leia com aten√ß√£o a sa√≠da da opera√ß√£o OpenVPN no cliente.  Muitas vezes, cont√©m conselhos valiosos sobre o que exatamente n√£o pode ser executado e por qu√™. </li><li>  Verifique as mensagens de erro nos arquivos openvpn.log e openvpn-status.log no diret√≥rio / etc / openvpn / no servidor. </li><li>  Verifique as mensagens relacionadas ao OpenVPN e apropriadas √† hora nos logs do sistema no servidor e no cliente.  (journalctl -ce exibir√° as entradas mais recentes.) </li><li>  Verifique se voc√™ possui uma conex√£o de rede ativa entre o servidor e o cliente (para obter mais detalhes, consulte o cap√≠tulo 14). </li></ul><br><h3>  Sobre o autor </h3><br>  <b>David Clinton</b> √© um administrador de sistemas, professor e escritor.  Ele administrou, escreveu sobre ele e criou materiais de treinamento para muitas disciplinas t√©cnicas importantes, incluindo sistemas Linux, computa√ß√£o em nuvem (em particular a AWS) e tecnologias de cont√™ineres, como o Docker.  Ele escreveu o livro Learn Amazon Web Services em um m√™s de almo√ßos (Manning, 2017).  Muitos de seus tutoriais em v√≠deo podem ser encontrados no Pluralsight.com, e links para outros livros (sobre administra√ß√£o do Linux e virtualiza√ß√£o de servidores) est√£o dispon√≠veis em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bootstrap-it.com</a> . <br><br>  ¬ªMais informa√ß√µes sobre o livro podem ser encontradas no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">site do editor</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Conte√∫do</a> <br>  ¬ª <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Trecho</a> <br><br>  Cupom de 25% de desconto para vendedores ambulantes - <b>Linux</b> <br>  Ap√≥s o pagamento da vers√£o impressa do livro, um livro eletr√¥nico √© enviado por e-mail. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt461879/">https://habr.com/ru/post/pt461879/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt461867/index.html">Como reconhecer imagens e textos no seu telefone usando o ML Kit</a></li>
<li><a href="../pt461871/index.html">101 dicas para se tornar um bom programador (e humano)</a></li>
<li><a href="../pt461873/index.html">ViewPager 2 - nova funcionalidade no antigo inv√≥lucro</a></li>
<li><a href="../pt461875/index.html">5 nm vs 3 nm</a></li>
<li><a href="../pt461877/index.html">Java vs Kotlin para Android: opini√µes dos desenvolvedores</a></li>
<li><a href="../pt461881/index.html">Guia de registro do Node.js.</a></li>
<li><a href="../pt461885/index.html">EDS √© outro tipo de fraude</a></li>
<li><a href="../pt461887/index.html">Entrando no Aeronet Epis√≥dio 2: Homing Drone</a></li>
<li><a href="../pt461891/index.html">Como fizemos amigos na infraestrutura banc√°ria usando o ManageIQ</a></li>
<li><a href="../pt461895/index.html">Aprenda enquanto viaja - como dirigimos no 1¬∫ Dia Europeu da An√°lise de Neg√≥cios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>