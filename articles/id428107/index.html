<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚öñÔ∏è üíÉ üõåüèø Kontainerisasi aplikasi Angular 6 SPA Template ASP .NET Core 2.1 ü•ü üëä ‚ò™Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PEMBARUAN dari 07.24.2019 lihat di akhir artikel. 

 UPDATE dari 11/01/2018 { 
 Berkat bantuan dalam komentar, di bawah ini adalah versi yang lebih be...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kontainerisasi aplikasi Angular 6 SPA Template ASP .NET Core 2.1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428107/">  PEMBARUAN dari 07.24.2019 lihat di akhir artikel. <br><br>  UPDATE dari 11/01/2018 { <br>  Berkat bantuan dalam komentar, di bawah ini adalah versi yang lebih benar secara ideologis dari file buruh pelabuhan. <br><br>  Templat proyek Template Angular SPA standar berisi kesalahan.  Pengembang di versi net .core 2.1.  dihapus dari microsoft / dotnet: gambar 2.1-sdk yang digunakan untuk membangun nodejs, tetapi kode yang menggunakannya tetap dalam file proyek.  Baca lebih lanjut di sini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github.com/aspnet/Announcements/issues/298</a> <br>  Anda harus mengedit file proyek * .csproj secara manual dengan menghapus kode berikut <br><div class="spoiler">  <b class="spoiler_title">Kode untuk dihapus dari * .csproj</b> <div class="spoiler_text"><pre><code class="cs hljs">&lt;Target Name=<span class="hljs-string"><span class="hljs-string">"PublishRunWebpack"</span></span> AfterTargets=<span class="hljs-string"><span class="hljs-string">"ComputeFilesToPublish"</span></span>&gt; &lt;!-- As part of publishing, ensure the JS resources are freshly built <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> production mode --&gt; &lt;Exec WorkingDirectory=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"npm install"</span></span> /&gt; &lt;Exec WorkingDirectory=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"npm run build -- --prod"</span></span> /&gt; &lt;Exec WorkingDirectory=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)"</span></span> Command=<span class="hljs-string"><span class="hljs-string">"npm run build:ssr -- --prod"</span></span> Condition=<span class="hljs-string"><span class="hljs-string">" '$(BuildServerSideRenderer)' == 'true' "</span></span> /&gt; &lt;!-- Include the newly-built files <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the publish output --&gt; &lt;ItemGroup&gt; &lt;DistFiles Include=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)dist\**; $(SpaRoot)dist-server\**"</span></span> /&gt; &lt;DistFiles Include=<span class="hljs-string"><span class="hljs-string">"$(SpaRoot)node_modules\**"</span></span> Condition=<span class="hljs-string"><span class="hljs-string">"'$(BuildServerSideRenderer)' == 'true'"</span></span> /&gt; &lt;ResolvedFileToPublish Include=<span class="hljs-string"><span class="hljs-string">"@(DistFiles-&gt;'%(FullPath)')"</span></span> Exclude=<span class="hljs-string"><span class="hljs-string">"@(ResolvedFileToPublish)"</span></span>&gt; &lt;RelativePath&gt;%(DistFiles.Identity)&lt;/RelativePath&gt; &lt;CopyToPublishDirectory&gt;PreserveNewest&lt;/CopyToPublishDirectory&gt; &lt;/ResolvedFileToPublish&gt; &lt;/ItemGroup&gt; &lt;/Target&gt;</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Dockerfile benar</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">ARG NODE_IMAGE=node:8.12 FROM microsoft/dotnet:2.1-aspnetcore-runtime AS base WORKDIR /app EXPOSE 80 FROM microsoft/dotnet:2.1-sdk AS build WORKDIR /src COPY ["AngularWebApp/AngularWebApp.csproj", "AngularWebApp/"] RUN dotnet restore "AngularWebApp/AngularWebApp.csproj" COPY . . WORKDIR "/src/AngularWebApp" FROM ${NODE_IMAGE} as node-build WORKDIR /src COPY AngularWebApp/ClientApp . RUN npm install RUN npm run build -- --prod FROM build AS publish RUN dotnet publish "AngularWebApp.csproj" -c Release -o /app FROM base AS final WORKDIR /app COPY --from=publish /app . COPY --from=node-build /src/dist ./ClientApp/dist ENTRYPOINT ["dotnet", "AngularWebApp.dll"]</code> </pre> <br></div></div><br>  } <br><br>  Sayangnya, saya belum menemukan solusi siap pakai di mana saja.  Saya harus mengumpulkan informasi dari beberapa sumber.  Untuk meluncurkan aplikasi di galangan Angular 6/7 sebagai proyek pada ASP .NET Core. <br><br>  Jika kami mengaktifkan dukungan buruh pelabuhan untuk proyek dengan aplikasi Angular menggunakan alat standar, file buruh pelabuhan akan membuat gambar aplikasi berdasarkan pada microsoft / dotnet: gambar 2.1-aspnetcore-runtime.  Tidak ada server node.js yang disertakan dalam gambar dasar ini  Dan hasil eksekusi akan menjadi kesalahan .NET Core <br><a name="habracut"></a><br><br><pre> <code class="plaintext hljs">An unhandled exception occurred while processing the request. The NPM script 'start' exited without indicating that the Angular CLI was listening for requests</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/a86/95a/1e6/a8695a1e647a8c8fe2649fe373ead513.jpg" alt="gambar"><br><br>  Untuk mengatasi kesalahan ini, Anda perlu memperbarui file Docker dengan menambahkan node.js instalasi dan sudut. <br>  Selain itu, karena pengembangan berada di bawah Windows, dan semuanya dimulai dalam wadah Docker berdasarkan Ubunty, jika file gaya scss atau sass digunakan, mereka dikompilasi oleh CLI Angular menggunakan node-sass, dan ketika memulai, ia memberikan kesalahan ‚ÄúNode Sass tidak belum mendukung lingkungan Anda saat ini: Windows 64-bit dengan runtime yang tidak didukung. "  Anda harus menjalankan perintah: <br><br><pre> <code class="plaintext hljs">npm rebuild node-sass</code> </pre> <br>  npm akan mengunduh skrip yang diperlukan untuk platform saat ini dan membangun kembali file css. <br><br>  File Docker terakhir untuk aplikasi Angular berdasarkan proyek ASP .NET Core 2.1 adalah sebagai berikut <br><br><pre> <code class="plaintext hljs">FROM microsoft/dotnet:2.1-aspnetcore-runtime AS base # Setup NodeJs RUN apt-get update &amp;&amp; \ apt-get install -y wget &amp;&amp; \ apt-get install -y gnupg2 &amp;&amp; \ wget -qO- https://deb.nodesource.com/setup_8.x | bash - &amp;&amp; \ apt-get install -y build-essential nodejs RUN npm install @angular/cli -g # End setup WORKDIR /app EXPOSE 80 FROM microsoft/dotnet:2.1-sdk AS build WORKDIR /src COPY ["AngularWebApp/AngularWebApp.csproj", "AngularWebApp/"] RUN dotnet restore "AngularWebApp/AngularWebApp.csproj" COPY . . WORKDIR "/src/AngularWebApp" RUN dotnet build "AngularWebApp.csproj" -c Release -o /app FROM build AS publish RUN dotnet publish "AngularWebApp.csproj" -c Release -o /app FROM base AS final WORKDIR /app COPY --from=publish /app . WORKDIR /app/ClientApp RUN npm install RUN npm rebuild node-sass WORKDIR /app ENTRYPOINT ["dotnet", "AngularWebApp.dll"]</code> </pre> <br>  Saya menggunakan rilis stabil LTS dari Node.js, saat ini 8.x, tetapi dapat diubah menjadi lebih relevan. <br><br>  Selain itu, saya juga mencatat bahwa Windows memaafkan kesalahan yang terkait dengan karakter kasus yang berbeda, tetapi Linux tidak memaafkan ini.  Dan proyek yang berhasil selama pengembangan akan menolak untuk dikompilasi dalam wadah, memberikan kesalahan <br><br><pre> <code class="plaintext hljs">docker ERROR in error TS1149: File name 'filename.ts' differs from already included file name 'FileNames.ts' only in casing</code> </pre> <br>  Untuk menghindari kesalahan seperti itu bahkan pada tahap kompilasi, saya sarankan menambahkan opsi yang sesuai "forceConsistentCasingInFileNames": benar ke file tsconfig.json di bagian compilerOptions <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"compilerOptions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"forceConsistentCasingInFileNames"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } }</code> </pre><br><br>  UPDATE dari 07.24.2019 { <br>  Sekali lagi, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">berkat bantuan</a> dalam komentar, versi yang dioptimalkan dari file buruh pelabuhan disajikan di bawah ini. <br><div class="spoiler">  <b class="spoiler_title">Dockerfile dioptimalkan</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">ARG NODE_IMAGE=node:10.16.0 FROM mcr.microsoft.com/dotnet/core/sdk:2.2-stretch AS build WORKDIR /src COPY ["AngularWebApp/AngularWebApp.csproj", "AngularWebApp/"] RUN dotnet restore "AngularWebApp/AngularWebApp.csproj" COPY . . WORKDIR "/src/AngularWebApp" RUN dotnet build "AngularWebApp.csproj" -c Release -o /app RUN dotnet publish "AngularWebApp.csproj" -c Release -o /app FROM ${NODE_IMAGE} as node-build WORKDIR /src COPY AngularWebApp/ClientApp . RUN npm install RUN npm rebuild node-sass RUN npm run build -- --prod FROM mcr.microsoft.com/dotnet/core/aspnet:2.2-stretch-slim AS base WORKDIR /app EXPOSE 80 COPY --from=build /app . COPY --from=node-build /src/dist ./ClientApp/dist ENTRYPOINT ["dotnet", "AngularWebApp.dll"]</code> </pre><br></div></div><br>  } <br><br>  angular, angular6 / 7, asp .net core 2.1, buruh pelabuhan </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428107/">https://habr.com/ru/post/id428107/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428097/index.html">Routing rekursif dalam MikroTik melalui gateway yang ditetapkan oleh DHCP</a></li>
<li><a href="../id428099/index.html">Apa kesamaan dari gaun biasa dan era 5G yang akan datang?</a></li>
<li><a href="../id428101/index.html">Cara mengotomatisasi dengan bangunan Jenkins dan menggulirkan artefak model artadak metadata untuk tabel dalam repositori</a></li>
<li><a href="../id428103/index.html">Mitap di St. Petersburg: Teknik Data dan banyak lagi</a></li>
<li><a href="../id428105/index.html">Blogger merekomendasikan: memengaruhi pemasaran</a></li>
<li><a href="../id428109/index.html">Tembok perusahaan</a></li>
<li><a href="../id428111/index.html">Aritmatika presisi sewenang-wenang di Erlang</a></li>
<li><a href="../id428113/index.html">Untuk pertanyaan tentang kurva Bezier, kecepatan Arduino dan satu situs menarik, atau bagaimana saya menghabiskan akhir pekan</a></li>
<li><a href="../id428115/index.html">Pengembangan web untuk e-niaga: 5 tren teknologi untuk 2019</a></li>
<li><a href="../id428117/index.html">Prosesor tensor gratis dari Google di Colaboratory Cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>