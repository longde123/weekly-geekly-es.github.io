<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçÜ üëá üë®üèæ‚Äç‚öñÔ∏è Aplica√ß√£o pr√°tica da transforma√ß√£o de √°rvore AST usando Putout como exemplo üëô üßëüèº üõåüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introdu√ß√£o 


 Todos os dias, ao trabalhar no c√≥digo, no caminho para implementar uma funcionalidade √∫til para o usu√°rio, tornam-se mudan√ßas for√ßad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Aplica√ß√£o pr√°tica da transforma√ß√£o de √°rvore AST usando Putout como exemplo</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439564/"><h2 id="vvedenie">  1. Introdu√ß√£o </h2><br><p>  Todos os dias, ao trabalhar no c√≥digo, no caminho para implementar uma funcionalidade √∫til para o usu√°rio, tornam-se mudan√ßas for√ßadas (inevit√°veis ‚Äã‚Äãou simplesmente desej√°veis) no c√≥digo.  Isso pode ser refatora√ß√£o, atualiza√ß√£o de uma biblioteca ou estrutura para uma nova vers√£o principal, atualiza√ß√£o da sintaxe JavaScript (o que n√£o √© incomum recentemente).  Mesmo que a biblioteca fa√ßa parte de um projeto em funcionamento, a mudan√ßa √© inevit√°vel.  A maioria dessas mudan√ßas √© rotineira.  N√£o h√° nada de interessante para o desenvolvedor neles, por um lado, por outro lado, n√£o traz nada para os neg√≥cios e, por outro lado, durante o processo de atualiza√ß√£o, voc√™ precisa ter muito cuidado para n√£o quebrar a lenha e n√£o quebrar a funcionalidade.  Assim, chegamos √† conclus√£o de que √© melhor mudar essa rotina para os ombros dos programas para que eles fa√ßam tudo sozinhos e a pessoa, por sua vez, controle se tudo foi feito corretamente.  Isso √© o que ser√° discutido no artigo de hoje. </p><a name="habracut"></a><br><h2 id="ast">  AST </h2><br><p> Para o processamento do c√≥digo do programa, √© necess√°rio convert√™-lo em uma representa√ß√£o especial, com a qual seria conveniente que os programas funcionassem.  Essa representa√ß√£o existe, √© chamada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√Årvore de sintaxe abstrata</a> (AST). <br>  Para obt√™-lo, use analisadores.  O AST resultante pode ser transformado como voc√™ quiser e, para salvar o resultado, voc√™ precisa de um gerador de c√≥digo.  Vamos considerar com mais detalhes cada uma das etapas.  Vamos come√ßar com o analisador. </p><br><h3 id="parser">  Analisador </h3><br><p>  E assim temos o c√≥digo: </p><br><pre><code class="javascript hljs">a + b</code> </pre> <br><p>  Os analisadores geralmente s√£o divididos em duas partes: </p><br><ul><li>  An√°lise lexical </li></ul><br><p>  Divide o c√≥digo em tokens, cada um dos quais descreve uma parte do c√≥digo: </p><br><pre> <code class="json hljs">[{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Punctuator"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, }, { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> }]</code> </pre> <br><ul><li>  An√°lise </li></ul><br><p>  Constr√≥i uma √°rvore de sintaxe a partir de tokens: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"BinaryExpression"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"left"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"a"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"operator"</span></span>: <span class="hljs-string"><span class="hljs-string">"+"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"right"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"Identifier"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"b"</span></span> } }</code> </pre> <br><p>  E agora j√° temos essa ideia, com a qual voc√™ pode trabalhar programaticamente.  Vale esclarecer que h√° um grande n√∫mero de analisadores de <code>JavaScript</code> , eis alguns deles: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">babel-parser</a> - um analisador que usa <code>babel</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">espree</a> - um analisador que usa <code>eslint</code> ; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">bolota</a> - o analisador no qual as duas anteriores se baseiam; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esprima</a> - um analisador popular que suporta JavaScript at√© o EcmaScript 2017; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">cherow</a> √© um novo player entre os analisadores JavaScript que afirma ser o mais r√°pido; </li></ul><br><p>  Existe um analisador JavaScript padr√£o, chamado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ESTree</a> e define quais n√≥s devem ser analisados. <br>  Para uma an√°lise mais detalhada do processo de implementa√ß√£o do analisador (assim como do transformador e gerador), voc√™ pode ler o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">compilador super min√∫sculo</a> . </p><br><h3 id="transformator">  Transformador </h3><br><p>  Para transformar a √°rvore AST, voc√™ pode usar o padr√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Visitor</a> , por exemplo, usando a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@ babel / traverse</a> .  O c√≥digo a seguir exibir√° os nomes de todos os identificadores de c√≥digo JavaScript da vari√°vel de <code>code</code> . </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> parser <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/parser"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> traverse <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">"@babel/traverse"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">`function square(n) { return n * n; }`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parser.parse(code); traverse(ast, { Identifier(path) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(path.node.name); } });</code> </pre> <br><h3 id="generator">  Gerador </h3><br><p>  Voc√™ pode gerar c√≥digo, por exemplo, usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@ babel / generator</a> , desta maneira: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {parse} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/parser'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> generate <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@babel/generator'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> code = <span class="hljs-string"><span class="hljs-string">'class Example {}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ast = parse(code); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> output = generate(ast, code);</code> </pre> <br><p>  Portanto, nesse est√°gio, o leitor deve ter uma id√©ia b√°sica do que √© necess√°rio para transformar o c√≥digo JavaScript e com quais ferramentas ele √© implementado. </p><br><p>  Tamb√©m vale a pena adicionar uma ferramenta on-line, como o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">astexplorer</a> , que combina um grande n√∫mero de analisadores, transformadores e geradores. </p><br><h2 id="putout">  Putout </h2><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Putout</a> √© um transformador de c√≥digo ativado por plug-in.  De fato, √© um cruzamento entre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">eslint</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">babel</a> , combinando as vantagens de ambas as ferramentas. </p><br><p>  Como o <code>eslint</code> <code>putout</code> mostra √°reas problem√°ticas no c√≥digo, mas diferente do <code>eslint</code> <code>putout</code> altera o comportamento do c√≥digo, ou seja, ele √© capaz de corrigir todos os erros que pode encontrar. </p><br><p>  Como o <code>babel</code> <code>putout</code> converte o c√≥digo, mas tenta alter√°-lo minimamente, para que possa ser usado para trabalhar com o c√≥digo armazenado no reposit√≥rio. </p><br><p>  Vale ressaltar tamb√©m que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√© mais bonito</a> , √© uma ferramenta de formata√ß√£o e difere radicalmente. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O Jscodeshift</a> n√£o est√° muito longe do <code>putout</code> , mas n√£o suporta plugins, n√£o mostra mensagens de erro e tamb√©m usa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ast-types em</a> vez de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@ babel / types</a> . </p><br><h3 id="istoriya-poyavleniya">  Hist√≥ria de apar√™ncia </h3><br><p>  No processo, o <code>eslint</code> me ajuda muito com minhas dicas.  Mas √†s vezes eu quero mais dele.  Por exemplo, para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">remover o depurador</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">corrija test.only</a> e tamb√©m exclua vari√°veis ‚Äã‚Äãn√£o utilizadas.  O √∫ltimo ponto formou a base da <code>putout</code> , durante o processo de desenvolvimento, ficou claro que √© muito dif√≠cil e muitas outras transforma√ß√µes s√£o muito mais f√°ceis de implementar.  Assim, a <code>putout</code> cresceu suavemente de uma fun√ß√£o para o sistema de plugins.  Remover vari√°veis ‚Äã‚Äãn√£o utilizadas agora √© o processo mais dif√≠cil, mas isso n√£o nos impede de desenvolver e apoiar muitas outras transforma√ß√µes igualmente √∫teis. </p><br><h3 id="kak-putout-ustroen-iznutri">  Como o Putout funciona por dentro </h3><br><p>  <code>putout</code> trabalho de <code>putout</code> pode ser dividido em duas partes: motor e plugins.  Essa arquitetura permite que voc√™ n√£o se distraia com as transforma√ß√µes ao trabalhar com o mecanismo e, ao trabalhar em plug-ins, voc√™ se concentrar√° o m√°ximo poss√≠vel em sua finalidade. </p><br><h4 id="vstroennye-plaginy">  Plugins incorporados </h4><br><p>  <code>putout</code> √© constru√≠do em um sistema de plugins.  Cada plug-in representa uma regra.  Usando as regras internas, voc√™ pode fazer o seguinte: </p><br><ul><li><p>  Encontre e exclua: </p><br><ul><li>  vari√°veis ‚Äã‚Äãn√£o utilizadas </li><li> <code>debugger</code> </li> <li>  chamar <code>test.only</code> </li><li>  chamar <code>test.skip</code> </li><li>  chamar <code>console.log</code> </li><li>  chamar <code>process.exit</code> </li><li>  blocos vazios </li><li>  padr√µes vazios </li></ul><br></li><li><p>  Encontre e divida a declara√ß√£o de vari√°vel: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var one, two; //  var one; var two;</span></span></code> </pre> <br></li><li><p>  Converta <code>esm</code> em <code>commonjs</code> : </p><br></li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//  import one from 'one'; //  const one = require('one');</span></span></code> </pre> <br><ul><li>  Aplique a desestrutura√ß√£o: </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const name = user.name; //  const {name} = user;</span></span></code> </pre> <br><ol><li>  Combine propriedades de desestrutura√ß√£o: </li></ol><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const {name} = user; const {password} = user; //  const { name, password } = user;</span></span></code> </pre> <br><p>  Cada plugin √© constru√≠do de acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Filosofia Unix</a> , ou seja, √© o mais simples poss√≠vel, cada um executa uma a√ß√£o, facilitando sua combina√ß√£o, porque s√£o, em ess√™ncia, filtros. </p><br><p>  Por exemplo, com o seguinte c√≥digo: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password;</code> </pre> <br><p>  √â primeiro convertido usando a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aplica√ß√£o de destrui√ß√£o</a> para: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {name} = user; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {password} = user;</code> </pre> <br><p>  Em seguida, usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">as propriedades de destrui√ß√£o da destrui√ß√£o, ele √©</a> convertido em: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { name, password } = user;</code> </pre> <br><p>  Assim, os plugins podem funcionar separadamente e juntos.  Ao criar seus pr√≥prios plug-ins, √© recomend√°vel aderir a esta regra e implementar um plug-in com funcionalidade m√≠nima que fa√ßa apenas o que voc√™ precisa, e os plug-ins internos e personalizados cuidar√£o do resto. </p><br><h4 id="primer-ispolzovaniya">  Exemplo de uso </h4><br><p>  Depois de nos familiarizarmos com as regras internas, podemos considerar um exemplo usando o <code>putout</code> . <br>  Crie um arquivo <code>example.js</code> com o seguinte conte√∫do: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> x = <span class="hljs-number"><span class="hljs-number">1</span></span>, y = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> name = user.name; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> password = user.password; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(name, password);</code> </pre> <br><p>  Agora execute o <code>putout</code> passando o <code>example.js</code> como argumento: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js /home/coderaiser/example/example.js 1:6 error "x" is defined but never used remove-unused-variables 1:13 error "y" is defined but never used remove-unused-variables 6:0 error Unexpected "console" call remove-console 1:0 error variables should be declared separately split-variable-declarations 3:6 error Object destructuring should be used apply-destructuring 4:6 error Object destructuring should be used apply-destructuring 6 errors in 1 files fixable with the `--fix` option</code> </pre> <br><p>  Receberemos informa√ß√µes contendo 6 erros, considerados com mais detalhes acima, agora iremos corrigi-los e ver o que aconteceu: </p><br><pre> <code class="plaintext hljs">coderaiser@cloudcmd:~/example$ putout example.js --fix coderaiser@cloudcmd:~/example$ cat example.js const { name, password } = user;</code> </pre> <br><p>  Como resultado da corre√ß√£o, as vari√°veis ‚Äã‚Äãn√£o utilizadas e as chamadas <code>console.log</code> foram exclu√≠das e a desestrutura√ß√£o tamb√©m foi aplicada. </p><br><h4 id="nastroyki">  Configura√ß√µes </h4><br><p>  As configura√ß√µes padr√£o podem nem sempre e nem para todos; portanto, o <code>putout</code> suporta o arquivo de configura√ß√£o <code>.putout.json</code> , que consiste nas seguintes se√ß√µes: </p><br><ul><li>  Regras </li><li>  Ignorar </li><li>  Correspond√™ncia </li><li>  Plugins </li></ul><br><h5 id="rules">  Regras </h5><br><p>  A se√ß√£o de <code>rules</code> cont√©m um sistema de regras.  As regras, por padr√£o, s√£o definidas da seguinte maneira: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-unused-variables"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-debugger"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-only"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-skip"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-console"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"split-variable-declarations"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"remove-empty-pattern"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"convert-esm-to-commonjs"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">"apply-destructuring"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"merge-destructuring-properties"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Para habilitar <code>remove-process-exit</code> defina-o como <code>true</code> no arquivo <code>.putout.json</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }</code> </pre> <br><p>  Isso ser√° suficiente para relatar todas as chamadas <code>process.exit</code> encontradas no c√≥digo e exclu√≠-las se a op√ß√£o <code>--fix</code> for <code>--fix</code> . </p><br><h5 id="ignore">  Ignorar </h5><br><p>  Se voc√™ precisar adicionar algumas pastas √† lista de exce√ß√µes, basta adicionar a se√ß√£o <code>ignore</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"ignore"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"test/fixture"</span></span> ] }</code> </pre> <br><h5 id="match">  Correspond√™ncia </h5><br><p>  Se voc√™ precisar de um sistema de regras ramificado, por exemplo, habilite <code>process.exit</code> para o diret√≥rio <code>bin</code> , basta usar a se√ß√£o de <code>match</code> : </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"match"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"bin"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"remove-process-exit"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, } } }</code> </pre> <br><h5 id="plugins">  Plugins </h5><br><p>  Se voc√™ usa plug-ins que n√£o est√£o embutidos e tem o prefixo <code>putout-plugin-</code> , inclua-os na se√ß√£o de <code>plugins</code> - <code>plugins</code> antes de ativ√°-los na se√ß√£o de <code>rules</code> .  Por exemplo, para conectar o <code>putout-plugin-add-hello-world</code> e ativar a regra <code>add-hello-world</code> , basta especificar: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"rules"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"add-hello-world"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"add-hello-world"</span></span> ] }</code> </pre> <br><h4 id="dvizhok-putout">  Motor de retirada </h4><br><p>  O mecanismo de <code>putout</code> √© uma ferramenta de linha de comando que l√™ configura√ß√µes, analisa arquivos, carrega e executa plugins e depois grava o resultado dos plugins. </p><br><p>  Ele usa a biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">reformula√ß√£o</a> , que ajuda a executar uma tarefa muito importante: ap√≥s a an√°lise e transforma√ß√£o, colete o c√≥digo em um estado o mais semelhante poss√≠vel ao anterior. </p><br><p>  Para a an√°lise, √© usado um analisador compat√≠vel com <code>ESTree</code> (o <code>babel</code> est√° atualmente com o <code>estree</code> in <code>estree</code> , mas s√£o poss√≠veis altera√ß√µes no futuro) e as ferramentas do <code>babel</code> s√£o usadas para transforma√ß√£o.  Por que exatamente <code>babel</code> ?  Tudo √© simples.  O fato √© que este √© um produto muito popular, muito mais popular que outras ferramentas similares, e est√° se desenvolvendo muito mais rapidamente.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Cada nova proposta no padr√£o EcmaScript n√£o √© completa sem um plug-in babel</a> .  <a href="">Babel tamb√©m</a> possui um livro, <a href="">Babel Handbook</a> , que descreve muito bem todos os recursos e ferramentas para atravessar e transformar uma √°rvore AST. </p><br><h4 id="svoy-plagin-dlya-putout">  Plug-in personalizado para Putout </h4><br><p>  O sistema de plug- <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ins de distribui√ß√£o</a> √© bastante simples e muito semelhante aos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plugins eslint</a> , bem como aos <a href="">plugins babel</a> .  √â verdade que, em vez de uma fun√ß√£o, o <code>putout</code> plugin deve exportar 3. Isso √© feito para aumentar a reutiliza√ß√£o do c√≥digo, porque duplicar a funcionalidade em 3 fun√ß√µes n√£o √© muito conveniente, √© muito mais f√°cil coloc√°-lo em fun√ß√µes separadas e simplesmente cham√°-lo nos lugares certos. </p><br><h5 id="struktura-plagina">  Estrutura de plugins </h5><br><p>  O plugin <code>Putout</code> consiste em 3 fun√ß√µes: </p><br><ul><li>  <code>report</code> - retorna uma mensagem; </li><li>  <code>find</code> - procura por lugares com erros e os retorna; </li><li>  <code>fix</code> - conserta esses locais; </li></ul><br><p>  O ponto principal a ser lembrado ao criar um plug-in para o <code>putout</code> √© seu nome, ele deve come√ßar com <code>putout-plugin-</code> .  Em seguida, pode ser o nome da opera√ß√£o que o plug-in executa, por exemplo, o plug <code>remove-wrong</code> in <code>remove-wrong</code> deve ser chamado assim: <code>putout-plugin-remove-wrong</code> . </p><br><p>  Voc√™ tamb√©m deve adicionar as palavras: <code>putout</code> e <code>putout-plugin</code> √† se√ß√£o <code>package.json</code> na se√ß√£o <code>keywords</code> , e especificar <code>"putout": "&gt;=3.10"</code> em <code>peerDependencies</code> <code>"putout": "&gt;=3.10"</code> ou a vers√£o que ser√° a √∫ltima no momento da cria√ß√£o do plug-in. </p><br><h5 id="primer-plagina-dlya-putout">  Exemplo de plugin para Putout </h5><br><p>  Vamos escrever um exemplo de plug-in que remover√° a palavra <code>debugger</code> do c√≥digo.  Esse plug-in j√° existe, √© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@ putout / plugin-remove-debugger</a> e √© simples o suficiente para consider√°-lo agora. </p><br><p>  √â assim: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//        module.exports.report = () =&gt; 'Unexpected "debugger" statement'; //     ,  debugger    Visitor module.exports.find = (ast, {traverse}) =&gt; { const places = []; traverse(ast, { DebuggerStatement(path) { places.push(path); } }); return places; }; //  ,     module.exports.fix = (path) =&gt; { path.remove(); };</span></span></code> </pre> <br><p>  Se a regra <code>remove-debugger</code> estiver inclu√≠da em <code>.putout.json</code> , o <code>@putout/plugin-remove-debugger</code> ser√° carregado.  Primeiro, a fun√ß√£o <code>find</code> √© chamada, que, usando a fun√ß√£o <code>traverse</code> , ir√° ignorar os n√≥s da √°rvore AST e salvar todos os locais necess√°rios. </p><br><p>  O pr√≥ximo passo da apresenta√ß√£o ser√° <code>report</code> para obter a mensagem desejada. </p><br><p>  Se o sinalizador <code>--fix</code> for usado, a fun√ß√£o de <code>fix</code> do plug-in ser√° chamada e a transforma√ß√£o ser√° executada; nesse caso, o n√≥ ser√° exclu√≠do. </p><br><h5 id="primer-testa-plagina">  Exemplo de teste de plug-in </h5><br><p>  Para simplificar o teste de plug-ins, a ferramenta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">@ putout / test</a> foi escrita.  Na sua ess√™ncia, nada mais √© do que um inv√≥lucro sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">fita</a> , com v√°rios m√©todos para a conveni√™ncia e simplifica√ß√£o dos testes. </p><br><p>  O teste para o plug <code>remove-debugger</code> in <code>remove-debugger</code> pode ser assim: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> removeDebugger = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'..'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> test = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@putout/test'</span></span>)(__dirname, { <span class="hljs-string"><span class="hljs-string">'remove-debugger'</span></span>: removeDebugger, }); <span class="hljs-comment"><span class="hljs-comment">//        test('remove debugger: report', (t) =&gt; { t.reportCode('debugger', 'Unexpected "debugger" statement'); t.end(); }); //    test('remove debugger: transformCode', (t) =&gt; { t.transformCode('debugger', ''); t.end(); });</span></span></code> </pre> <br><h5 id="codemods">  Codemods </h5><br><p>  Nem todas as transforma√ß√µes precisam ser usadas todos os dias; para transforma√ß√µes <code>npm</code> basta fazer a mesma coisa, mas, em vez de publicar para <code>npm</code> coloque-a na <code>~/.putout</code> .  Na inicializa√ß√£o, o <code>putout</code> procurar√° nesta pasta, pegar√° e iniciar√° a transforma√ß√£o. </p><br><p>  Aqui est√° um exemplo de transforma√ß√£o que substitui a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conex√£o de</a> <code>tape</code> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">tentativa de fita</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">por uma</a> chamada de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">supertape</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">convert-tape-to-supertape</a> . </p><br><h3 id="eslint-plugin-putout">  eslint-plugin-putout </h3><br><p>  No final, vale acrescentar um ponto: o <code>putout</code> tenta alterar o c√≥digo minimamente, mas se acontecer a um amigo que algumas regras de formata√ß√£o quebram, o eslint --fix est√° sempre pronto para <code>eslint --fix</code> e, para esse fim, existe um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-in eslint-plugin-putout especial</a> .  Ele pode alegrar muitos erros de formata√ß√£o e, √© claro, pode ser personalizado de acordo com as prefer√™ncias dos desenvolvedores em um projeto espec√≠fico.  Conectar √© f√°cil: </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"extends"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"plugin:putout/recommended"</span></span>, ], <span class="hljs-attr"><span class="hljs-attr">"plugins"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"putout"</span></span> ] }</code> </pre> <br><p>  At√© o momento, existe apenas uma regra: <code>one-line-destructuring</code> , faz o seguinte: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  const { one } = hello; //  const {one} = hello;</span></span></code> </pre> <br><p>  Existem muitas outras regras de <code>eslint</code> inclu√≠das, com as quais voc√™ pode se familiarizar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">com mais detalhes</a> . </p><br><h2 id="zaklyuchenie">  Conclus√£o </h2><br><p>  Quero agradecer ao leitor pela aten√ß√£o prestada a este texto.  Espero sinceramente que o t√≥pico das transforma√ß√µes AST se torne mais popular e os artigos sobre esse fascinante processo apare√ßam com mais frequ√™ncia.  Eu ficaria muito grato por quaisquer coment√°rios e sugest√µes relacionados ao desenvolvimento posterior da <code>putout</code> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Crie um problema</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">envie um pool de solicita√ß√µes</a> , teste, escreva quais regras voc√™ gostaria de ver e como programar seu c√≥digo programaticamente, trabalharemos juntos para melhorar a ferramenta de transforma√ß√£o AST. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt439564/">https://habr.com/ru/post/pt439564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt439552/index.html">Extens√µes maliciosas do Chrome</a></li>
<li><a href="../pt439556/index.html">TDMS Fairway. Metodologias do PMBOK e organiza√ß√µes de design russas</a></li>
<li><a href="../pt439558/index.html">Novo telefone antigo. Reinvente o telefone PSTN</a></li>
<li><a href="../pt439560/index.html">Adaptador blockchain Ethereum para a plataforma de dados InterSystems IRIS</a></li>
<li><a href="../pt439562/index.html">Configure o cluster de alta disponibilidade do Kubernetes no bare metal com o kubeadm. Parte 1/3</a></li>
<li><a href="../pt439566/index.html">Por que a documenta√ß√£o do SRE √© importante. Parte 3</a></li>
<li><a href="../pt439568/index.html">SSDs baseados em QLC - um assassino de disco r√≠gido? Realmente n√£o</a></li>
<li><a href="../pt439570/index.html">Magia IPython para editar tags de c√©lulas Jupyter</a></li>
<li><a href="../pt439572/index.html">Projeto assistido por computador de equipamentos eletr√¥nicos</a></li>
<li><a href="../pt439574/index.html">Protocolo SmartCard I2C. Comandos do Exchange APDU via interface I2C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>