<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüè´ üï¶ üë©üèΩ‚Äçü§ù‚Äçüë®üèø Criando um gancho para gatos no Unity. Parte 1 üë®üèø‚Äçüíª üë®‚Äçüåæ üàØÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os ganchos para gatos acrescentam mec√¢nicas divertidas e interessantes ao jogo. Voc√™ pode us√°-los para percorrer n√≠veis, lutar em arenas e obter itens...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um gancho para gatos no Unity. Parte 1</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414887/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/a3e/e5d/348a3ee5d95a10273c8bc644e3dbc7d9.gif" alt="imagem"></div><br>  Os ganchos para gatos acrescentam mec√¢nicas divertidas e interessantes ao jogo.  Voc√™ pode us√°-los para percorrer n√≠veis, lutar em arenas e obter itens.  Mas, apesar da aparente simplicidade, a f√≠sica do gerenciamento de cordas e a cria√ß√£o de comportamentos realistas podem ser desafiadoras! <br><br>  Na primeira parte deste tutorial, implementamos nosso pr√≥prio sistema gancho-gato bidimensional e aprendemos o seguinte: <br><br><ul><li>  Crie um sistema de mira. </li><li>  Use o renderizador de linha e a junta de dist√¢ncia para criar a corda. </li><li>  Ensinaremos a corda a envolver objetos do jogo. </li><li>  Calcule o √¢ngulo de giro na corda e adicione for√ßa nessa dire√ß√£o. </li></ul><br><blockquote>  <em>Nota</em> : este tutorial √© destinado a usu√°rios avan√ßados e experientes e n√£o abrange t√≥picos como adi√ß√£o de componentes, cria√ß√£o de novos scripts GameObject e sintaxe C #.  Se voc√™ precisar aprimorar suas habilidades no Unity, consulte nossos tutoriais <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Introdu√ß√£o ao Unity</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Introdu√ß√£o ao script de unidade</a> .  Como <em>DistanceJoint2D √©</em> usado neste tutorial, voc√™ tamb√©m deve examinar as <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Articula√ß√µes de F√≠sica no Unity 2D</a> e s√≥ depois retornar a este tutorial. </blockquote><a name="habracut"></a><br><h2>  Come√ßando a trabalhar </h2><br>  Fa√ßa o download do <a href="">rascunho</a> deste tutorial e abra-o no editor do Unity.  O Unity 2017.1 ou superior √© necess√°rio para a opera√ß√£o. <br><br>  Abra a cena do <em>jogo</em> na pasta <em>Scenes</em> e veja por onde come√ßar: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/973/819/22f/97381922f527deb0b338346d13083c13.png"></div><br>  Por enquanto, temos um personagem de jogador simples (lesma) e pedras penduradas no ar. <br><br>  At√© agora, os componentes importantes do GameObject <em>Player</em> s√£o o colisor de c√°psulas e o corpo r√≠gido, que permitem a intera√ß√£o com objetos f√≠sicos no n√≠vel.  Al√©m disso, um script de movimento simples ( <em>PlayerMovement</em> ) √© anexado ao personagem, permitindo que ele deslize no ch√£o e realize saltos simples. <br><br>  Pressione o bot√£o <em>Play</em> para iniciar o jogo e tente controlar o personagem.  <em>A</em> e <em>D</em> movem-na para a esquerda / direita e, quando voc√™ pressiona a <em>barra de espa√ßo,</em> ela salta.  Tente n√£o escorregar e cair do penhasco, sen√£o voc√™ morrer√°! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/69a/8b5/841/69a8b58415940671c3519ceccfcf6ed7.png"></div><br>  J√° temos o b√°sico de gerenciamento, mas o maior problema agora √© a falta de ganchos para gatos. <br><br><h2>  Criando ganchos e cordas </h2><br>  A princ√≠pio, o sistema cat-hook parece bastante simples, mas para sua implementa√ß√£o de alta qualidade √© necess√°rio levar em considera√ß√£o muitos aspectos.  Aqui est√£o alguns dos requisitos para a mec√¢nica bidimensional de gancho de gato: <br><br><ul><li>  Renderizador de linha para exibir a corda.  Quando a corda envolve objetos, podemos adicionar mais segmentos ao renderizador de linhas e colocar os v√©rtices nos pontos correspondentes √†s quebras da corda. </li><li>  DistanceJoint2D.  Ele pode ser usado para conectar o ponto de ancoragem atual do gancho de gato, para que nossa lesma possa balan√ßar.  Tamb√©m nos permite ajustar a dist√¢ncia que pode ser usada para aumentar e reduzir o cabo. </li><li>  Filho de GameObject com RigidBody2D, que pode ser movido dependendo da localiza√ß√£o atual do ponto de ancoragem do gancho.  Em ess√™ncia, ser√° o ponto de suspens√£o / √¢ncora da corda. </li><li>  Raycast para jogar um gancho e anexar a objetos. </li></ul><br>  Selecione o objeto <em>Player</em> na Hierarquia e adicione um novo <em>GameObject</em> filho chamado <em>RopeHingeAnchor</em> .  Este GameObject ser√° usado para posicionar o ponto de suspens√£o / ancoragem do gancho de gato. <br><br>  Adicione os componentes <em>SpriteRenderer</em> e <em>RigidBody2D</em> ao <em>RopeHingeAnchor</em> . <br><br>  Para SpriteRenderer, defina a propriedade <em>Sprite</em> para usar o valor <em>UISprite</em> e altere <em>Order in Layer</em> para <em>2</em> .  Desative o componente <em>desmarcando a caixa</em> ao lado de seu nome. <br><br>  Para o componente <em>RigidBody2D,</em> defina a propriedade Tipo de corpo como <em>Cinem√°tico</em> .  Este ponto ser√° movido n√£o pelo mecanismo f√≠sico, mas pelo c√≥digo. <br><br>  Selecione a camada <em>Corda</em> e defina os valores de escala X e Y do componente Transform como <em>4</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e18/4aa/8e4/e184aa8e457a1e1d3928966b2ae3bca7.png"></div><br>  Selecione <em>Player</em> novamente e conecte o novo componente <em>DistanceJoint2D</em> . <br><br>  Arraste o <em>RopeHingeAnchor</em> da Hierarquia para a propriedade <em>Corpo R√≠gido Conectado</em> do componente <em>DistanceJoint2D</em> e desative a <em>Dist√¢ncia de Configura√ß√£o Autom√°tica</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e46/25b/b80/e4625bb804bb2ed2a0c5bee2aed0eade.gif"></div><br>  Crie um novo script C # chamado <em>RopeSystem</em> na pasta do projeto <em>Scripts</em> e abra-o no editor de c√≥digo. <br><br>  Remova o m√©todo <code>Update</code> . <br><br>  Na parte superior do script dentro da <code>RopeSystem</code> classe <code>RopeSystem</code> adicione novas vari√°veis, o m√©todo <code>Awake()</code> e o novo m√©todo <code>Update</code> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 public GameObject ropeHingeAnchor; public DistanceJoint2D ropeJoint; public Transform crosshair; public SpriteRenderer crosshairSprite; public PlayerMovement playerMovement; private bool ropeAttached; private Vector2 playerPosition; private Rigidbody2D ropeHingeAnchorRb; private SpriteRenderer ropeHingeAnchorSprite; void Awake() { // 2 ropeJoint.enabled = false; playerPosition = transform.position; ropeHingeAnchorRb = ropeHingeAnchor.GetComponent&lt;Rigidbody2D&gt;(); ropeHingeAnchorSprite = ropeHingeAnchor.GetComponent&lt;SpriteRenderer&gt;(); } void Update() { // 3 var worldMousePosition = Camera.main.ScreenToWorldPoint(new Vector3(Input.mousePosition.x, Input.mousePosition.y, 0f)); var facingDirection = worldMousePosition - transform.position; var aimAngle = Mathf.Atan2(facingDirection.y, facingDirection.x); if (aimAngle &lt; 0f) { aimAngle = Mathf.PI * 2 + aimAngle; } // 4 var aimDirection = Quaternion.Euler(0, 0, aimAngle * Mathf.Rad2Deg) * Vector2.right; // 5 playerPosition = transform.position; // 6 if (!ropeAttached) { } else { } }</span></span></code> </pre> <br>  Vamos analisar cada parte em ordem: <br><br><ol><li>  Usamos essas vari√°veis ‚Äã‚Äãpara rastrear os v√°rios componentes com os quais o script RopeSystem ir√° interagir. </li><li>  O m√©todo <code>Awake</code> inicia no in√≠cio do jogo e desativa o <code>ropeJoint</code> (o componente DistanceJoint2D).  Ele tamb√©m define <code>playerPosition</code> na posi√ß√£o atual do Player. </li><li>  Essa √© a parte mais importante do loop principal <code>Update()</code> .  Primeiro, obtemos a posi√ß√£o do cursor do mouse no mundo usando o <code>ScreenToWorldPoint</code> c√¢mera <code>ScreenToWorldPoint</code> .  Em seguida, calculamos a dire√ß√£o do nosso olhar subtraindo a posi√ß√£o do jogador da posi√ß√£o do mouse no mundo.  Em seguida, usamos para criar <code>aimAngle</code> , que √© uma representa√ß√£o do √¢ngulo de mira do cursor.  O valor armazena um valor positivo na constru√ß√£o if. </li><li>  <code>aimDirection</code> √© uma reviravolta que ser√° √∫til mais tarde.  Estamos interessados ‚Äã‚Äãapenas no valor Z, pois estamos usando uma c√¢mera 2D, e este √© o √∫nico SO correspondente.  Passamos <code>aimAngle * Mathf.Rad2Deg</code> , que converte o √¢ngulo do radiano em um √¢ngulo em graus. </li><li>  A posi√ß√£o do jogador √© monitorada usando uma vari√°vel conveniente que permite que voc√™ n√£o se refira constantemente a <code>transform.Position</code> . </li><li>  Finalmente, temos a constru√ß√£o <code>if..else</code> , que usaremos em breve para determinar se a corda est√° presa ao ponto de ancoragem. </li></ol><br>  Salve o script e retorne ao editor. <br><br>  Anexe o componente <em>RopeSystem</em> ao objeto Player e pendure os v√°rios componentes nos campos p√∫blicos que criamos no script <em>RopeSystem</em> .  Arraste <em>Player</em> , <em>Crosshair</em> e <em>RopeHingeAnchor</em> para os campos apropriados: <br><br><ul><li>  <em>√Çncora de dobradi√ßa de corda</em> : RopeHingeAnchor </li><li>  <em>Articula√ß√£o de corda</em> : Jogador </li><li>  <em>Crosshair</em> : Crosshair </li><li>  <em>Sprite de</em> mira: Crosshair </li><li>  <em>Movimento do</em> Jogador: Player </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e97/9ca/d2e/e979cad2e2690cc65e9fe237a9f6c47a.gif"></div><br>  Agora, estamos apenas fazendo todos esses c√°lculos complexos, mas at√© agora n√£o h√° visualiza√ß√£o que possa mostr√°-los em a√ß√£o.  Mas n√£o se preocupe, faremos isso em breve. <br><br>  Abra o script <em>RopeSystem</em> e adicione um novo m√©todo a ele: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetCrosshairPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aimAngle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!crosshairSprite.enabled) { crosshairSprite.enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> x = transform.position.x + <span class="hljs-number"><span class="hljs-number">1f</span></span> * Mathf.Cos(aimAngle); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y = transform.position.y + <span class="hljs-number"><span class="hljs-number">1f</span></span> * Mathf.Sin(aimAngle); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> crossHairPosition = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector3(x, y, <span class="hljs-number"><span class="hljs-number">0</span></span>); crosshair.transform.position = crossHairPosition; }</code> </pre> <br>  Este m√©todo posiciona a mira com base no <code>aimAngle</code> transmitido (o valor flutuante que calculamos em <code>Update()</code> ) para que ele gire em torno do player com um raio de 1 unidade.  Tamb√©m inclu√≠mos um escopo de sprite, caso ainda n√£o esteja pronto. <br><p>  Em <code>Update()</code> <code>!ropeAttached</code> a constru√ß√£o <code>!ropeAttached</code> para verificar <code>!ropeAttached</code> para que fique assim: <br><br></p><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ropeAttached) { SetCrosshairPosition(aimAngle); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { crosshairSprite.enabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Salve o script e execute o jogo.  Agora nossa lesma deve ser capaz de mirar com uma vis√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ffe/b1f/8ca/ffeb1f8ca53fbc0463aad677677fb837.gif"></div><br>  A pr√≥xima pe√ßa de l√≥gica que precisa ser implementada √© a de um gancho de gato.  J√° determinamos a dire√ß√£o da mira, por isso precisamos de um m√©todo que a receba como par√¢metro. <br><br>  Adicione as seguintes vari√°veis ‚Äã‚Äãabaixo das vari√°veis ‚Äã‚Äãno script <em>RopeSystem</em> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LineRenderer ropeRenderer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> LayerMask ropeLayerMask; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ropeMaxCastDistance = <span class="hljs-number"><span class="hljs-number">20f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Vector2&gt; ropePositions = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Vector2&gt;();</code> </pre> <br>  <em>O LineRenderer</em> conter√° um link para um renderizador de linha que desenha a corda.  <em>O LayerMask</em> permite que voc√™ personalize as camadas f√≠sicas com as quais o gancho pode interagir.  O valor <code>ropeMaxCastDistance</code> define a dist√¢ncia m√°xima que o raycast pode "disparar". <br><br>  Finalmente, a lista de posi√ß√µes do Vector2 ser√° usada para rastrear os pontos de enrolamento de corda, os quais discutiremos mais adiante. <br><br>  Adicione os seguintes novos m√©todos: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 private void HandleInput(Vector2 aimDirection) { if (Input.GetMouseButton(0)) { // 2 if (ropeAttached) return; ropeRenderer.enabled = true; var hit = Physics2D.Raycast(playerPosition, aimDirection, ropeMaxCastDistance, ropeLayerMask); // 3 if (hit.collider != null) { ropeAttached = true; if (!ropePositions.Contains(hit.point)) { // 4 //    ,    -  . transform.GetComponent&lt;Rigidbody2D&gt;().AddForce(new Vector2(0f, 2f), ForceMode2D.Impulse); ropePositions.Add(hit.point); ropeJoint.distance = Vector2.Distance(playerPosition, hit.point); ropeJoint.enabled = true; ropeHingeAnchorSprite.enabled = true; } } // 5 else { ropeRenderer.enabled = false; ropeAttached = false; ropeJoint.enabled = false; } } if (Input.GetMouseButton(1)) { ResetRope(); } } // 6 private void ResetRope() { ropeJoint.enabled = false; ropeAttached = false; playerMovement.isSwinging = false; ropeRenderer.positionCount = 2; ropeRenderer.SetPosition(0, transform.position); ropeRenderer.SetPosition(1, transform.position); ropePositions.Clear(); ropeHingeAnchorSprite.enabled = false; }</span></span></code> </pre> <br>  Aqui est√° o que o c√≥digo acima faz: <br><br><ol><li>  HandleInput √© chamado no loop <code>Update()</code> e simplesmente pesquisa a entrada dos bot√µes esquerdo e direito do mouse. </li><li>  Quando um clique esquerdo √© registrado, a linha da corda √© ativada e um radiodifus√£o 2D √© disparado da posi√ß√£o do jogador na dire√ß√£o da mira.  A dist√¢ncia m√°xima √© definida para que o gancho n√£o possa ser disparado a uma dist√¢ncia infinita, e uma m√°scara √© aplicada para que seja poss√≠vel selecionar as camadas da f√≠sica com as quais o raycast pode colidir. </li><li>  Se um hit de raycast for detectado, o <code>ropeAttached</code> ser√° <code>true</code> e uma lista das posi√ß√µes dos v√©rtices da corda ser√° verificada para garantir que n√£o haja nenhum ponto l√°. </li><li>  Se o teste retornar verdadeiro, um pequeno impulso de for√ßa ser√° adicionado √† lesma para que ela salte acima do solo, a <code>ropeJoint</code> (DistanceJoint2D) √© ativada, que √© definida para a dist√¢ncia igual √† dist√¢ncia entre a lesma e o ponto de impacto do raio.  Um sprite de ponto de ancoragem tamb√©m est√° inclu√≠do. </li><li>  Se o raycast n√£o atingir nada, o renderizador de linha e o ropeJoint ser√£o desativados e o sinalizador <code>ropeAttached</code> ser√° falso. </li><li>  Se o bot√£o direito do mouse for pressionado, o m√©todo <code>ResetRope()</code> √© <code>ResetRope()</code> , que desativa e redefine todos os par√¢metros relacionados √† corda / gancho aos valores que deveriam ser se o gancho n√£o for usado. </li></ol><br>  Na parte inferior do nosso m√©todo <code>Update</code> , adicione uma chamada ao novo m√©todo <code>HandleInput()</code> e passe o valor <code>aimDirection</code> para <code>aimDirection</code> : <br><br><pre> <code class="cs hljs">HandleInput(aimDirection);</code> </pre> <br>  Salve as altera√ß√µes em <em>RopeSystem.cs</em> e retorne ao editor. <br><br><h2>  Adicionando uma corda </h2><br>  Nossa lesma n√£o ser√° capaz de voar pelo ar sem uma corda; portanto, √© hora de fornecer algo que seja uma representa√ß√£o visual da corda e que tenha a capacidade de "virar" nos cantos. <br><br>  O renderizador de linha √© ideal para isso, pois permite transferir o n√∫mero de pontos e sua posi√ß√£o no espa√ßo do mundo. <br><br>  A id√©ia aqui √© que sempre armazenemos o primeiro v√©rtice da corda (0) na posi√ß√£o do jogador, e todos os outros v√©rtices s√£o posicionados dinamicamente quando a corda deve envolver algo, incluindo a posi√ß√£o atual da dobradi√ßa, que √© o pr√≥ximo ponto ao longo da corda do jogador. <br><br>  Selecione <em>Player</em> e adicione o componente <em>LineRenderer</em> a ele.  Defina <em>Largura</em> como <em>0,075</em> .  Expanda a lista <em>Materiais</em> e, como <em>Elemento 0,</em> selecione o material <em>RopeMaterial</em> localizado na pasta <em>Materiais</em> do projeto.  Por fim, para Renderizador de linha, para <em>Modo de textura,</em> selecione <em>Distribuir por segmento</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c80/6aa/59f/c806aa59f875ac106babef5a8b57a6fc.png"></div><br>  Arraste o componente Renderizador de linhas para o campo <em>Renderizador</em> de <em>cordas do</em> componente <em>Sistema de cordas</em> . <br><br>  Clique na lista suspensa de <em>M√°scara de camada</em> de <em>corda</em> e selecione como camadas com as quais o raycast <em>Default, Rope e Pivot</em> podem interagir.  Devido a isso, ao ‚Äúfilmar‚Äù um raycast, ele colidir√° apenas com essas camadas, mas n√£o com outros objetos, como um jogador. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9f/eab/2c3/f9feab2c30cc84b83c94d39ce74acdea.gif"></div><br>  Se voc√™ iniciar o jogo agora, notar√° um comportamento estranho.  Quando apontamos para uma pedra acima da cabe√ßa da lesma e disparamos com um gancho, fazemos um pequeno salto para cima, ap√≥s o qual nosso amigo come√ßa a se comportar de maneira aleat√≥ria. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/815/abd/ae6/815abdae693911ed0ba56f14775e5488.gif"></div><br>  Ainda n√£o definimos a dist√¢ncia para a junta de dist√¢ncia, al√©m disso, os v√©rtices da renderiza√ß√£o da linha n√£o est√£o configurados.  Portanto, n√£o vemos a corda e, como a junta de dist√¢ncia est√° diretamente acima da posi√ß√£o da lesma, o valor atual da dist√¢ncia da junta de dist√¢ncia a empurra para as pedras abaixo dela. <br><br>  Mas n√£o se preocupe, agora vamos resolver esse problema. <br><br>  No script <em>RopeSystem.cs,</em> adicione um novo operador no in√≠cio da classe: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq;</code> </pre> <br>  Isso nos permite usar consultas LINQ, que no nosso caso simplesmente nos permitem encontrar convenientemente o primeiro ou o √∫ltimo elemento da lista <code>ropePositions</code> . <br><br><blockquote>  <em>Nota</em> : LINQ (Consulta Integrada √† Linguagem) √© o nome de um conjunto de tecnologias baseadas na incorpora√ß√£o de recursos de consulta diretamente em C #.  Voc√™ pode ler mais sobre isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . </blockquote><br>  Adicione uma nova vari√°vel privada bool chamada <code>distanceSet</code> sob as outras vari√°veis: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> distanceSet;</code> </pre> <br>  Usaremos essa vari√°vel como uma bandeira para que o script reconhe√ßa que a dist√¢ncia da corda (para o ponto entre o jogador e o ponto de refer√™ncia atual em que o gancho de gato est√° conectado) est√° definida corretamente. <br><br>  Agora adicione um novo m√©todo que usaremos para definir as posi√ß√µes dos v√©rtices da corda para renderizar a linha e definir a dist√¢ncia da junta de dist√¢ncia na lista armazenada de posi√ß√µes com a corda ( <code>ropePositions</code> ): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateRopePositions</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if (!ropeAttached) { return; } // 2 ropeRenderer.positionCount = ropePositions.Count + 1; // 3 for (var i = ropeRenderer.positionCount - 1; i &gt;= 0; i--) { if (i != ropeRenderer.positionCount - 1) // if not the Last point of line renderer { ropeRenderer.SetPosition(i, ropePositions[i]); // 4 if (i == ropePositions.Count - 1 || ropePositions.Count == 1) { var ropePosition = ropePositions[ropePositions.Count - 1]; if (ropePositions.Count == 1) { ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } else { ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } } // 5 else if (i - 1 == ropePositions.IndexOf(ropePositions.Last())) { var ropePosition = ropePositions.Last(); ropeHingeAnchorRb.transform.position = ropePosition; if (!distanceSet) { ropeJoint.distance = Vector2.Distance(transform.position, ropePosition); distanceSet = true; } } } else { // 6 ropeRenderer.SetPosition(i, transform.position); } } }</span></span></code> </pre> <br>  Explique o c√≥digo mostrado acima: <br><br><ol><li>  Saia do m√©todo se a corda n√£o estiver presa. </li><li>  Atribu√≠mos o valor dos pontos de renderiza√ß√£o da linha da corda ao n√∫mero de posi√ß√µes armazenadas <code>ropePositions</code> da <code>ropePositions</code> , mais 1 a mais (para a posi√ß√£o do jogador). </li><li>  Fazemos um loop em torno da lista <code>ropePositions</code> e em <code>ropePositions</code> para cada posi√ß√£o (exceto a √∫ltima), atribu√≠mos a posi√ß√£o do v√©rtice do renderizador de linha ao valor da posi√ß√£o Vector2 armazenada pelo √≠ndice de loop na lista <code>ropePositions</code> . </li><li>  Atribua ao ponto de ancoragem da corda o segundo da posi√ß√£o final da corda, na qual o atual ponto de dobradi√ßa / √¢ncora deve estar, ou se tivermos apenas uma posi√ß√£o da corda, fa√ßa dele o ponto de ancoragem.  Ent√£o, definimos a dist√¢ncia da <code>ropeJoint</code> igual √† dist√¢ncia entre o jogador e a posi√ß√£o atual da corda, que <code>ropeJoint</code> no loop. </li><li>  A constru√ß√£o if lida com o caso em que a posi√ß√£o atual da corda no loop √© a segunda do final;  ou seja, o ponto em que a corda se conecta ao objeto, ou seja  ponto atual da dobradi√ßa / √¢ncora. </li><li>  Esse <code>else</code> bloco lida com a atribui√ß√£o da posi√ß√£o do √∫ltimo v√©rtice da corda ao valor da posi√ß√£o atual do jogador. </li></ol><br>  Lembre-se de adicionar a chamada <code>UpdateRopePositions()</code> no final de <code>Update()</code> <code>UpdateRopePositions()</code> : <br><br><pre> <code class="cs hljs">UpdateRopePositions();</code> </pre> <br>  Salve as altera√ß√µes no script e execute o jogo novamente.  Fa√ßa um ‚Äúpequeno espa√ßo‚Äù um pequeno salto, mirando e atirando em um gancho em uma pedra acima do personagem.  Agora voc√™ pode apreciar os frutos de seu trabalho - a lesma balan√ßa calmamente sobre as pedras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b94/f87/d7c/b94f87d7c533fdae336e3818f7cf3908.gif"></div><br>  Agora voc√™ pode ir para a janela de cena, selecionar Player, usar a ferramenta Move (por padr√£o, a tecla <em>W</em> ) para mov√™-la e observar como os dois v√©rtices da linha da corda renderizam seguem a posi√ß√£o do gancho e a posi√ß√£o do jogador para puxar a corda.  Depois de liberarmos o player, o DistanceJoint2D calcula corretamente a dist√¢ncia e a lesma continuar√° balan√ßando na dobradi√ßa conectada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5e1/66e/18c/5e166e18ca7ff821025a920b1eaf849a.gif"></div><br><h2>  Manipula√ß√£o de pontos de quebra autom√°tica </h2><br>  At√© agora, brincar com uma lesma balan√ßando n√£o √© mais √∫til do que uma toalha que repele a √°gua; portanto, precisamos definitivamente complement√°-la. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e9/3bd/43e/6e93bd43eb1ebff2241cb89af3b09f0a.png"></div><br>  A boa not√≠cia √© que o m√©todo rec√©m-adicionado para processar posi√ß√µes de corda pode ser usado no futuro.  At√© agora, estamos usando apenas duas posi√ß√µes de corda.  Um √© conectado √† posi√ß√£o do jogador e o segundo √† posi√ß√£o atual do ponto de ancoragem do gancho ao atirar nele. <br><br>  O √∫nico problema √© que, enquanto n√£o rastreamos todas as posi√ß√µes potenciais da corda, isso precisa de um pouco de trabalho. <br><br>  Para reconhecer as posi√ß√µes nas pedras em torno das quais a corda deve ser enrolada, adicionando uma nova posi√ß√£o de v√©rtice ao renderizador de linhas, precisamos de um sistema que determine se o ponto de v√©rtice do colisor est√° entre a linha reta entre a posi√ß√£o atual da lesma e o atual ponto de dobradi√ßa / √¢ncora da corda. <br><br>  Parece que isso √© trabalho novamente para o bom e velho raycast! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47a/52b/abe/47a52babe8fb16ef57a365b287dceb12.png"></div><br>  Primeiro, precisamos criar um m√©todo que possa encontrar o ponto mais pr√≥ximo no colisor com base no ponto de impacto do raycast e nas bordas do colisor. <br><br>  Adicione um novo m√©todo ao script <em>RopeSystem.cs</em> : <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 private Vector2 GetClosestColliderPointFromRaycastHit(RaycastHit2D hit, PolygonCollider2D polyCollider) { // 2 var distanceDictionary = polyCollider.points.ToDictionary&lt;Vector2, float, Vector2&gt;( position =&gt; Vector2.Distance(hit.point, polyCollider.transform.TransformPoint(position)), position =&gt; polyCollider.transform.TransformPoint(position)); // 3 var orderedDictionary = distanceDictionary.OrderBy(e =&gt; e.Key); return orderedDictionary.Any() ? orderedDictionary.First().Value : Vector2.zero; }</span></span></code> </pre><br>  Se voc√™ n√£o estiver familiarizado com as consultas LINQ, esse c√≥digo pode parecer algum tipo de m√°gica em C # complicada. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e8/0d6/c88/9e80d6c88df7182190a87a8ca54dcb70.png"></div><br>  Se sim, ent√£o n√£o tenha medo.  O LINQ trabalha muito para n√≥s: <br><br><ol><li>  Este m√©todo usa dois par√¢metros - o objeto <em>RaycastHit2D</em> e o <em>objeto PolygonCollider2D</em> .  Todas as pedras no n√≠vel t√™m coletores PolygonCollider2D; portanto, se sempre usarmos formas PolygonCollider2D, funcionar√° bem. </li><li>  √â aqui que a m√°gica da consulta LINQ come√ßa!  Aqui, transformamos a cole√ß√£o de pontos do colisor poligonal em um dicion√°rio de posi√ß√µes <em>Vector2</em> (o valor de cada elemento do dicion√°rio √© a pr√≥pria posi√ß√£o), e a chave de cada elemento recebe o valor da dist√¢ncia desse ponto no jogador de posi√ß√£o do jogador (valor flutuante).  √Äs vezes, algo mais acontece aqui: a posi√ß√£o resultante √© convertida em espa√ßo do mundo (por padr√£o, as posi√ß√µes dos v√©rtices do colisor s√£o armazenadas no espa√ßo local, isto √©, local em rela√ß√£o ao objeto ao qual o colisor pertence e precisamos de posi√ß√µes no espa√ßo do mundo). </li><li>  O dicion√°rio √© classificado por chave.  Em outras palavras, pela dist√¢ncia mais pr√≥xima da posi√ß√£o atual do jogador.  A dist√¢ncia mais pr√≥xima √© retornada, ou seja, qualquer ponto retornado por esse m√©todo √© o ponto de colis√£o entre o jogador e o ponto atual da dobradi√ßa do cabo! </li></ol><br>  Vamos voltar ao script <em>RopeSystem.cs</em> e adicionar uma nova vari√°vel de campo privado na parte superior: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Dictionary&lt;Vector2, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; wrapPointsLookup = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Vector2, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;();</code> </pre> <br>  Vamos us√°-lo para rastrear as posi√ß√µes em torno das quais a corda pode enrolar. <br><br>  No final do m√©todo <code>Update()</code> , localize a constru√ß√£o <code>else</code> que cont√©m <code>crosshairSprite.enabled = false;</code>  e adicione o seguinte: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// 1 if (ropePositions.Count &gt; 0) { // 2 var lastRopePoint = ropePositions.Last(); var playerToCurrentNextHit = Physics2D.Raycast(playerPosition, (lastRopePoint - playerPosition).normalized, Vector2.Distance(playerPosition, lastRopePoint) - 0.1f, ropeLayerMask); // 3 if (playerToCurrentNextHit) { var colliderWithVertices = playerToCurrentNextHit.collider as PolygonCollider2D; if (colliderWithVertices != null) { var closestPointToHit = GetClosestColliderPointFromRaycastHit(playerToCurrentNextHit, colliderWithVertices); // 4 if (wrapPointsLookup.ContainsKey(closestPointToHit)) { ResetRope(); return; } // 5 ropePositions.Add(closestPointToHit); wrapPointsLookup.Add(closestPointToHit, 0); distanceSet = false; } } }</span></span></code> </pre> <br>  Explique este trecho de c√≥digo: <br><br><ol><li>  Se algumas posi√ß√µes forem armazenadas na lista <code>ropePositions</code> , ent√£o ... </li><li>  Filmamos a partir da posi√ß√£o do jogador na dire√ß√£o do jogador que olha a √∫ltima posi√ß√£o da corda da lista - o ponto de refer√™ncia no qual o gancho do gato se conectou √† pedra - com uma dist√¢ncia de raio igual √† dist√¢ncia entre o jogador e a posi√ß√£o do ponto de refer√™ncia da corda. </li><li>  Se o raycast colidir com algo, o colisor deste objeto ser√° <em>convertido</em> com seguran√ßa para o tipo <em>PolygonCollider2D</em> .  Embora seja um PolygonCollider2D verdadeiro, a posi√ß√£o do v√©rtice mais pr√≥ximo desse colisor √© retornada usando o m√©todo que escrevemos anteriormente como <em>Vector2</em> . </li><li>  Ele √© verificado pelo <code>wrapPointsLookup</code> para garantir que a mesma posi√ß√£o n√£o seja verificada novamente.  Se estiver marcado, descartamos a corda e a cortamos, deixando o jogador cair. </li><li>  Em seguida, a lista <code>ropePositions</code> √© <code>ropePositions</code> : a posi√ß√£o √© adicionada em torno da qual a corda deve ser enrolada.  O dicion√°rio <code>wrapPointsLookup</code> tamb√©m √© atualizado.  Finalmente, o sinalizador <code>distanceSet</code> √© redefinido para que o m√©todo <code>UpdateRopePositions()</code> possa redefinir a dist√¢ncia da corda com o novo comprimento da corda e segmentos. </li></ol><br>  Em <code>ResetRope()</code> adicione a seguinte linha para que o dicion√°rio <code>wrapPointsLookup</code> limpo toda vez que um jogador desconectar uma corda: <br><br><pre> <code class="cs hljs">wrapPointsLookup.Clear();</code> </pre> <br>  Salve e inicie o jogo.  Atire o gancho do gato na pedra acima da lesma e use a ferramenta Mover na janela Cena para mover a lesma sobre v√°rias bordas da pedra. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c62/999/f50/c62999f50094252b3850b8b4c54e2cdc.gif"></div><br>  Foi assim que ensinamos a corda a envolver objetos! <br><br><h2>  Adicionar capacidade de balan√ßo </h2><br>  A lesma pendurada na corda √© bem est√°tica.  Para corrigir isso, podemos adicionar a capacidade de oscila√ß√£o. <br><br>  Para fazer isso, precisamos obter uma posi√ß√£o perpendicular √† posi√ß√£o de balan√ßar para a frente (lateralmente), independentemente do √¢ngulo em que ele est√° olhando. <br><br>  Abra <em>PlayerMovement.cs</em> e adicione as duas vari√°veis ‚Äã‚Äãp√∫blicas a seguir na parte superior do script: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector2 ropeHook; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> swingForce = <span class="hljs-number"><span class="hljs-number">4f</span></span>;</code> </pre> <br>  A vari√°vel <code>ropeHook</code> receber√° uma posi√ß√£o em que o gancho da corda est√° localizado no momento, e <code>swingForce</code> √© o valor que usamos para adicionar o movimento de giro. <br><br>  Substitua o m√©todo <code>FixedUpdate()</code> novo: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FixedUpdate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (horizontalInput &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span> || horizontalInput &gt; <span class="hljs-number"><span class="hljs-number">0f</span></span>) { animator.SetFloat(<span class="hljs-string"><span class="hljs-string">"Speed"</span></span>, Mathf.Abs(horizontalInput)); playerSprite.flipX = horizontalInput &lt; <span class="hljs-number"><span class="hljs-number">0f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isSwinging) { animator.SetBool(<span class="hljs-string"><span class="hljs-string">"IsSwinging"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1 -          var playerToHookDirection = (ropeHook - (Vector2)transform.position).normalized; // 2 -  ,     Vector2 perpendicularDirection; if (horizontalInput &lt; 0) { perpendicularDirection = new Vector2(-playerToHookDirection.y, playerToHookDirection.x); var leftPerpPos = (Vector2)transform.position - perpendicularDirection * -2f; Debug.DrawLine(transform.position, leftPerpPos, Color.green, 0f); } else { perpendicularDirection = new Vector2(playerToHookDirection.y, -playerToHookDirection.x); var rightPerpPos = (Vector2)transform.position + perpendicularDirection * 2f; Debug.DrawLine(transform.position, rightPerpPos, Color.green, 0f); } var force = perpendicularDirection * swingForce; rBody.AddForce(force, ForceMode2D.Force); } else { animator.SetBool("IsSwinging", false); if (groundCheck) { var groundForce = speed * 2f; rBody.AddForce(new Vector2((horizontalInput * groundForce - rBody.velocity.x) * groundForce, 0)); rBody.velocity = new Vector2(rBody.velocity.x, rBody.velocity.y); } } } else { animator.SetBool("IsSwinging", false); animator.SetFloat("Speed", 0f); } if (!isSwinging) { if (!groundCheck) return; isJumping = jumpInput &gt; 0f; if (isJumping) { rBody.velocity = new Vector2(rBody.velocity.x, jumpSpeed); } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As principais mudan√ßas aqui s√£o que a bandeira √© verificada primeiro </font></font><code>isSwinging</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para que as a√ß√µes sejam executadas apenas quando a lesma est√° pendurada na corda, e tamb√©m adicionamos uma perpendicular ao canto da lesma, indicando seu ponto de ancoragem atual na parte superior da corda, mas perpendicular √† dire√ß√£o de seu balan√ßo.</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Obtemos o vetor de dire√ß√£o normalizado do player para o ponto de conex√£o do gancho. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dependendo se a lesma balan√ßa para a esquerda ou para a direita, a dire√ß√£o perpendicular √© calculada usando </font></font><code>playerToHookDirection</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Uma chamada de depura√ß√£o tamb√©m foi adicionada para que voc√™ possa v√™-la no editor, se desejar.</font></font></li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Abra o </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RopeSystem.cs</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font><font style="vertical-align: inherit;">adicione o seguinte </font><font style="vertical-align: inherit;">na parte superior do </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloco else,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dentro do </font></font><code>if(!ropeAttached)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√©todo </font></font><code>Update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cs hljs">playerMovement.isSwinging = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; playerMovement.ropeHook = ropePositions.Last();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bloco if do</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mesmo design, </font></font><code>if(!ropeAttached)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adicione o seguinte:</font></font><br><br><pre> <code class="cs hljs">playerMovement.isSwinging = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Assim, informamos ao script PlayerMovement que o jogador est√° oscilando e tamb√©m determinamos a √∫ltima (exceto a posi√ß√£o do jogador) da corda - em outras palavras, o ponto de ancoragem da corda. </font><font style="vertical-align: inherit;">Isso √© necess√°rio para calcular o √¢ngulo perpendicular que acabamos de adicionar ao script PlayerMovement. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui est√° como √© que voc√™ liga os aparelhos em um jogo de corrida e pressiona A ou D para girar para a esquerda / direita:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5bd/6a5/4ed/5bd6a54ed3c8661e61b3bf765e50acfb.png"></div><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Adicionando descida de corda </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Embora n√£o tenhamos a capacidade de subir e descer a corda. </font><font style="vertical-align: inherit;">Embora na vida real a lesma n√£o possa subir e cair facilmente ao longo da corda, mas este √© um jogo no qual tudo pode acontecer, certo? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na parte superior do script </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RopeSystem,</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> adicione duas novas vari√°veis ‚Äã‚Äãde campo:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> climbSpeed = <span class="hljs-number"><span class="hljs-number">3f</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isColliding;</code> </pre> <br> <code>climbSpeed</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir√° a velocidade na qual a lesma pode subir e descer a corda e </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ser√° usado como uma bandeira para determinar se a propriedade da junta de dist√¢ncia da corda da junta de dist√¢ncia pode ser aumentada ou diminu√≠da. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione este novo m√©todo:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleRopeLength</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// 1 if (Input.GetAxis("Vertical") &gt;= 1f &amp;&amp; ropeAttached &amp;&amp; !isColliding) { ropeJoint.distance -= Time.deltaTime * climbSpeed; } else if (Input.GetAxis("Vertical") &lt; 0f &amp;&amp; ropeAttached) { ropeJoint.distance += Time.deltaTime * climbSpeed; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Este bloco </font></font><code>if..elseif</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l√™ a entrada ao longo do eixo vertical (para cima / baixo ou W / S no teclado) e, levando em considera√ß√£o as bandeiras, </font></font><code>ropeAttached iscColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aumenta ou diminui a dist√¢ncia </font></font><code>ropeJoint</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, criando o efeito de alongar ou encurtar o cabo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectamos esse m√©todo, adicionando sua chamada ao final </font></font><code>Update()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cs hljs">HandleRopeLength();</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m precisamos de uma maneira de definir a bandeira </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione os dois m√©todos a seguir na parte inferior do script:</font></font><br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerStay2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider2D colliderStay</span></span></span><span class="hljs-function">)</span></span> { isColliding = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnTriggerExit2D</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Collider2D colliderOnExit</span></span></span><span class="hljs-function">)</span></span> { isColliding = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esses dois m√©todos s√£o nativos da classe base dos scripts MonoBehaviour. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Se atualmente o Collider tocar em outro objeto f√≠sico no jogo, o m√©todo ser√° acionado constantemente </font></font><code>OnTriggerStay2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, atribuindo um </font></font><code>isColliding</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valor </font><font style="vertical-align: inherit;">√† bandeira </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Isso significa que quando a lesma toca a pedra, √© atribu√≠do um valor √† bandeira isColliding </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo √© </font></font><code>OnTriggerExit2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">acionado quando um colisor sai da √°rea de outro colisor, configurando o sinalizador como falso. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lembre-se: o m√©todo </font></font><code>OnTriggerStay2D</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pode ser muito computacionalmente caro, portanto, use-o com cuidado.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Para onde ir a seguir? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Inicie o jogo novamente e desta vez pressione as teclas de seta ou W / S para mover para cima e para baixo na corda. </font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/348/a3e/e5d/348a3ee5d95a10273c8bc644e3dbc7d9.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O projeto final desta parte do tutorial pode ser baixado </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Percorremos um longo caminho - desde a lesma que n√£o balan√ßa at√© o molusco gastr√≥pode acrob√°tico sem casca! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Voc√™ aprendeu a criar um sistema de mira capaz de disparar um gancho de gato em qualquer objeto que tenha um colisor, agarrar-se a ele e balan√ßar simultaneamente nele, girando em uma corda din√¢mica em torno das bordas dos objetos! </font><font style="vertical-align: inherit;">Bom trabalho.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dd/bb5/29d/4ddbb529d88b62441d7b2d91424bf906.gif"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No entanto, uma fun√ß√£o importante est√° faltando aqui - a corda n√£o pode "desenrolar" quando necess√°rio. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Na </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">segunda parte do</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tutorial, resolveremos esse problema. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mas se voc√™ estiver disposto a arriscar, por que n√£o tentar fazer isso sozinho? </font><font style="vertical-align: inherit;">Voc√™ pode usar um dicion√°rio para isso </font></font><code>wrapPointsLookup</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414887/">https://habr.com/ru/post/pt414887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414877/index.html">Uma lente incomum para uma c√¢mera comum ou como parar de pensar em foco</a></li>
<li><a href="../pt414879/index.html">Por que 2 extrusoras em uma impressora 3D?</a></li>
<li><a href="../pt414881/index.html">Um pouco de VK nos bastidores</a></li>
<li><a href="../pt414883/index.html">As mem√≥rias soaram de uma nova maneira: a BBC atualizou o arquivo de som do projeto RemArc</a></li>
<li><a href="../pt414885/index.html">Lidamos com erros e ‚Äúmuletas‚Äù no Registro Estadual Unificado de Pessoas Jur√≠dicas - o registro estadual de pessoas jur√≠dicas</a></li>
<li><a href="../pt414889/index.html">Quando as ag√™ncias digitais precisam de IaaS</a></li>
<li><a href="../pt414891/index.html">H√°bitos do desenvolvedor</a></li>
<li><a href="../pt414893/index.html">Viber, WhatsApp, Telegram - o que √© melhor?</a></li>
<li><a href="../pt414895/index.html">E para n√≥s tudo √© "vertical" - DBMS Vertica</a></li>
<li><a href="../pt414897/index.html">Acesso a dados em aplicativos multiusu√°rios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>