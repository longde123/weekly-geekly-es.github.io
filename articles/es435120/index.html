<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôèüèæ üêà ü§ôüèª Funciones Lambda en SQL ... pensemos üöç üñêüèΩ üêù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De qu√© se tratar√° el art√≠culo, y as√≠ lo implica el nombre. 

 Adem√°s, el autor explicar√° por qu√© esto es necesario desde su punto de vista, y dir√° que...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Funciones Lambda en SQL ... pensemos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435120/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/sl/ch/fp/slchfpm_a-deoh62fqiazjgdc5k.png" alt="imagen"></div><br>  De qu√© se tratar√° el art√≠culo, y as√≠ lo implica el nombre. <br><br>  Adem√°s, el autor explicar√° por qu√© esto es necesario desde su punto de vista, y dir√° que SUBJ no es solo una tecnolog√≠a de moda, sino tambi√©n "un negocio doblemente necesario, tanto agradable como √∫til". <br><a name="habracut"></a><br>  Siempre es interesante ver c√≥mo varias personas talentosas hacen algo (un lenguaje de programaci√≥n, por qu√© no), sabiendo exactamente qu√© problema est√°n resolviendo y qu√© tareas se asignaron.  Y tambi√©n probar su creaci√≥n en s√≠ mismos.  No se puede comparar con las creaciones monumentales de los comit√©s gigantes, que ponen el mantenimiento de la armon√≠a del universo en primer plano, qui√©n entiende c√≥mo. <br><br>  Compare, por ejemplo, el destino de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FORTRAN</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PL / 1</a> .  ¬øQui√©n recordar√° ahora sobre este PL / 1? <br><br>  Desde este punto de vista, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AWK</a> , por ejemplo, tiene mucho √©xito.  Vale la pena decir que en su nombre A es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Alfred Aho</a> , uno de los autores de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dragon Book</a> , W es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Peter Weinberger</a> , que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">intervino</a> en Fortran-77, K es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Brian Kernigan</a> , ¬ød√≥nde estar√≠a sin √©l?  El lenguaje est√° destinado a procesar secuencias de texto sobre la marcha en canalizaciones entre procesos. <br><br>  El lenguaje no tiene tipo ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esto no es del todo cierto</a> ), su sintaxis es muy similar a la de C, tiene capacidades de filtrado, matrices asociativas, eventos de inicio / final de flujo, evento de nueva l√≠nea ... <br><br>  El autor siempre ha estado impresionado por este lenguaje tambi√©n por el hecho de que su int√©rprete no necesita ser instalado, en sistemas similares a UNIX siempre est√° ah√≠, y en Windows es suficiente simplemente copiar el archivo ejecutable y todo funciona.  Sin embargo, este no es el caso. <br><br>  En el proceso, el autor tiene que usar el paquete SQL + AWK con bastante frecuencia, y es por eso.  SQL sigue siendo un lenguaje inicialmente declarativo dise√±ado para controlar los flujos de datos.  Ofrece oportunidades muy limitadas para trabajar con el contexto de ejecuci√≥n de consultas en forma de funciones agregadas. <br><br>  ¬øC√≥mo, por ejemplo, construir un histograma bidimensional usando SQL? <br><br><pre><code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--   100 x 100 SELECT count(), round(x, -2) AS cx, round(y, -2) AS cy FROM samples GROUP BY cx, xy</span></span></code> </pre> <br>  Pero digamos, usar GROUP BY implica ordenar, y no es un placer barato si tienes cientos de millones (o incluso m√°s) filas. <br><div class="spoiler">  <b class="spoiler_title">UPD: en los comentarios me corrigieron que esto no es del todo cierto (o nada)</b> <div class="spoiler_text">  El procesador SQL tiene la capacidad de realizar funciones agregadas en el proceso de construcci√≥n de un hash de acuerdo con el criterio de agrupaci√≥n.  Para esto, es necesario que posea la cantidad de memoria libre suficiente para colocar el mapa hash en la memoria. <br><br>  Luego, los contextos de los grupos se actualizar√°n a medida que se lea la tabla y al final de esta lectura ya tendremos el resultado calculado. <br>  La misma t√©cnica se puede extender a las funciones de ventana (abajo), solo el contexto ser√° "m√°s grueso". <br><br>  En el caso de que el n√∫mero de grupos sea desconocido de antemano o muy grande, el procesador SQL se ve obligado a crear un √≠ndice temporal y ejecutarlo en un segundo paso. <br><br>  En casos simples, por ejemplo, como aqu√≠, un COUNT simple, una opci√≥n universal es posible, un √≠ndice temporal (cx, cy, count), luego con un peque√±o n√∫mero de grupos, todo estar√° en la memoria en las p√°ginas en cach√©.  En casos complejos, las funciones de ventana, el estado del grupo se vuelve no trivial y constantemente (des) serializarlo no es en absoluto lo que orden√≥ el m√©dico. <br></div></div>  Resumen: el procesador SQL recurre a la clasificaci√≥n cuando no puede estimar el n√∫mero de grupos despu√©s de GROUP BY.  Sin embargo, la agrupaci√≥n por valores calculados es (a menudo) solo el caso. <br><br>  Por lo tanto, tienes que hacer algo como: <br><br><pre> <code class="bash hljs">psql -t -q -c <span class="hljs-string"><span class="hljs-string">'select x, y from samples'</span></span> | gawk -f mk_hist2d.awk</code> </pre> <br>  donde mk_hist2d.awk acumula estad√≠sticas en la matriz asociativa y las muestra al finalizar el trabajo <br><br><pre> <code class="cpp hljs"># mk_hist2d.awk { bucket[<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>($<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">0.01</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>($<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">0.01</span></span>)]+=$<span class="hljs-number"><span class="hljs-number">1</span></span>; } END { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">500</span></span>; i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; <span class="hljs-number"><span class="hljs-number">500</span></span>; j++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((i, j) in bucket) print i*<span class="hljs-number"><span class="hljs-number">100.</span></span><span class="hljs-string"><span class="hljs-string">" "</span></span>j*<span class="hljs-number"><span class="hljs-number">100.</span></span><span class="hljs-string"><span class="hljs-string">" "</span></span>bucket[i, j]; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> print i*<span class="hljs-number"><span class="hljs-number">100.</span></span><span class="hljs-string"><span class="hljs-string">" "</span></span>j*<span class="hljs-number"><span class="hljs-number">100.</span></span><span class="hljs-string"><span class="hljs-string">" 0"</span></span>; } }</code> </pre><br>  Hay una PERO: el flujo de datos completo debe enviarse desde el servidor a la m√°quina de trabajo, y esto no es tan barato. <br><br>  ¬øEs posible combinar de alguna manera lo agradable con lo √∫til: acumular estad√≠sticas durante la ejecuci√≥n de la consulta SQL, pero sin recurrir a la clasificaci√≥n?  S√≠, por ejemplo, usando funciones de agregado personalizadas. <br><br><h4>  Funciones agregadas personalizadas </h4><br>  Subj est√° presente en diferentes sistemas, en todas partes se hace un poco a su manera. <br><br><ol><li>  <b>PostgreSQL</b>  La documentaci√≥n est√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  M√°s detalles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br>  Aqu√≠ es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">donde se</a> calcula el saldo m√°ximo de la cuenta. <br>  Y este es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un ejemplo</a> que calcula qu√© hay m√°s en la columna booleana: verdadero o falso. <br><br>  Se ve as√≠: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AGGREGATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mode</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">boolean</span></span>) ( SFUNC = mode_bool_state, STYPE = <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>[], FINALFUNC = mode_bool_final, INITCOND = <span class="hljs-string"><span class="hljs-string">'{0,0}'</span></span> );</code> </pre><br>  Aqu√≠ <b>SFUNC</b> es una funci√≥n que se llama para cada l√≠nea en la secuencia, <br>  El primer argumento es de tipo <b>STYPE</b> . <br><br>  <b>FINALFUNC</b> se utiliza para finalizar los c√°lculos y devuelve el valor del agregado. <br>  <b>INITCOND</b> : inicializaci√≥n del valor inicial del estado interno ( <b>STYPE</b> ), pasado como primer argumento. <br>  Dado que las funciones se pueden escribir en C (lo que significa que para el estado interno puede usar la memoria que se libera autom√°ticamente cuando cierra la solicitud), esta es una herramienta muy poderosa.  Fuera del alcance de su uso, uno todav√≠a debe poder ir. </li><li>  <b>MS SQL</b> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Anteriormente</a> (2000), antes de la solicitud, era necesario crear un objeto ActiveX, para hacer la agregaci√≥n usando este objeto. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ahora</a> (2016+) esto se hace en el entorno CLR.  Deber√° crear una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funci√≥n</a> personalizada, crear y registrar un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ensamblaje</a> .  Entonces puedes crear un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">agregado</a> . <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Un ejemplo de</a> c√°lculo de la media geom√©trica, as√≠ como la combinaci√≥n de cadenas: con par√°metros adicionales y un tipo definido por el usuario para almacenar un estado intermedio. </li><li>  <b>Or√°culo</b> <br>  En Oracle, esto se hace utilizando el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cartucho de datos</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ODCIAggregate</a> (interfaz). <br>  Para crear su propio agregado, debe escribir un tipo personalizado que implemente 4 m√©todos <br>  - la inicializaci√≥n (ODCIAggregateInitialize), est√°tica, debe crear una instancia del tipo deseado y volver a trav√©s del par√°metro <br>  - iteraciones (ODCIAggregateIterate), llamadas en cada fila de datos <br>  - merge (ODCIAggregateMerge), usado para combinar agregados ejecutados en paralelo <br>  - terminar (ODCIAggregateTerminate) - salida de resultados <br>  Ejemplos: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">1</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">2</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">3</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">4</a> . </li><li>  <b>DB2</b> <br>  No hay una forma expl√≠cita de utilizar agregados personalizados en DB2. <br>  Pero <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puede</a> deslizar una funci√≥n est√°ndar (aunque MAX) en un tipo definido por el usuario (en Java) y hacer que el sistema ejecute consultas del formulario <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> Complex <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ( <span class="hljs-built_in"><span class="hljs-built_in">real</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DOUBLE</span></span>, i <span class="hljs-keyword"><span class="hljs-keyword">DOUBLE</span></span> ) ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> complexNumbers ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">number</span></span> Complex ) ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> sum..real, sum..i <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> GetAggrResult(<span class="hljs-keyword"><span class="hljs-keyword">MAX</span></span>(BuildComplexSum(<span class="hljs-built_in"><span class="hljs-built_in">number</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> complexNumbers ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> t(<span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>)</code> </pre></li></ol><br>  ¬øQu√© es digno de menci√≥n en todos estos sistemas? <br><br><ul><li>  De una forma u otra, deber√° crear algunos objetos en la base de datos.  Ya sea AGREGADO o TIPO.  Como m√≠nimo, se requieren derechos apropiados.  <i>Y solo quiero agregar algunos n√∫meros en su rodilla.</i> <br></li><li>  Puede que tenga que escribir algo en otro idioma, ya sea C, C # o Java. <br>  Para integrar lo que est√° escrito en el sistema, nuevamente, se requieren derechos.  <i>Pero todo lo que quiero ...</i> <br></li><li>  Dificultad para inicializar.  Suponga que desea leer histogramas con diferentes tama√±os de canasta.  Parece que es m√°s f√°cil: indicaremos el INITCOND deseado al declarar el agregado (PostgreSQL) y todo el negocio.  Pero luego, para cada tama√±o de la cesta, necesitar√° su propio agregado, y para esto nuevamente se necesitan los derechos. <br><br>  Aqu√≠ puede recurrir a un truco sucio y deslizar el procesador de uni√≥n desde la l√≠nea de inicializaci√≥n (hacia adelante) y los datos, construir el contexto no en el constructor, sino cuando se recibe la primera l√≠nea. <br></li><li>  Sin embargo, incluso con las limitaciones descritas, los agregados personalizados le permiten calcular cualquier cosa. <br></li><li>  Es importante que los <u>agregados se puedan paralelizar</u> , al menos PostgreSQL, y Oracle (Enterprise Edition) puede hacer esto.  Para esto, la verdad tendr√° que aprender a serializar / deserializar estados intermedios y tambi√©n congelarlos recibidos de diferentes flujos. </li></ul><br><h4>  Funciones de ventana </h4><br>  Las funciones de ventana aparecieron en el est√°ndar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SQL: 2003</a> .  Por el momento, son compatibles con todos los sistemas anteriores.  En esencia, las funciones de ventana son una extensi√≥n del trabajo con unidades.  Y, por supuesto, las funciones agregadas personalizadas tambi√©n funcionan en un contexto de ventana. <br><br>  La extensi√≥n es esta.  Y antes de SQL: 2003, las funciones agregadas funcionaban en una determinada ventana, que era el conjunto de resultados completo o su parte, correspondiente a la combinaci√≥n de valores de campo de la expresi√≥n GROUP BY.  El usuario ahora tiene cierta libertad para manipular esta ventana. <br><br>  La diferencia es que los valores calculados usando las ventanas se agregan a la salida en una columna separada, y no requieren que toda la secuencia se colapse usando funciones agregadas.  Entonces, en una solicitud, puede usar varios agregados de ventana, cada uno en su propio contexto (ventana).  Podr√≠a haber varias funciones agregadas antes, pero todas funcionaron en una ventana. <br><br>  Grandes trazos <br><br><ul><li>  <b>Sobre ()</b> <br>  la ventana es todo el conjunto de resultados.  Digamos que la consulta ' <i>select count (1) from Samples</i> ' devuelve 169. En este caso, al ejecutar ' <i>select count (1) over () from Samples</i> ', obtenemos una columna que se escribe 169 veces 169 veces. </li><li>  <b>SOBRE (PARTICI√ìN POR)</b> <br>  es un an√°logo de GROUP BY, para cada combinaci√≥n de valores se crea una ventana en la que se realizan funciones agregadas.  Digamos que en la tabla Muestras una columna entera es val, los datos son n√∫meros del 1 al 169. <br>  Luego, la consulta ' <i>seleccionar recuento (1) sobre (partici√≥n por (12 + val) / 13) de Muestras</i> ' devolver√° una columna en la que el valor 13 se escribe 169 veces. <br></li><li>  <b>SOBRE (ORDENAR POR)</b> <br>  se puede combinar con PARTITION BY, le permite cambiar din√°micamente el tama√±o de la ventana durante el cursor, en este caso, la ventana se extiende desde el comienzo del grupo hasta la posici√≥n actual del cursor.  Como resultado, para el grupo, no resulta el mismo valor en la columna agregada, sino el propio.  Conveniente para calcular cantidades acumuladas.  Resultado de la consulta <br>  <i>'seleccionar sum (val) sobre (ordenar por val) de Muestras</i> ' ser√° una columna en la que el en√©simo elemento contendr√° la suma de n√∫meros naturales del 1 al n. </li><li>  <b>SOBRE (FILAS)</b> <br>  le permite definir los marcos de las ventanas, comenzando desde la posici√≥n del cursor o el comienzo / final del rango ORDER BY. <br><br>  Por ejemplo, ' <i>... ROWS 1 PRECEDING ...</i> ' significa que la ventana consiste en la l√≠nea actual y 1 antes.  A ' <i>... FILAS ENTRE 1 SIGUIENTE Y 2 SIGUIENTES ...</i> ' - la ventana consta de dos l√≠neas inmediatamente despu√©s del cursor. <br><br>  FILA ACTUAL en este modo indica la posici√≥n actual del cursor.  Por ejemplo, ' <i>FILAS ENTRE FILA ACTUAL Y SIGUIENTE SIN L√çMITES</i> ' significa desde la l√≠nea actual hasta el final del rango. </li><li>  <b>SOBRE (RANGO)</b> <br>  difiere de las FILAS en que la FILA ACTUAL aqu√≠ significa como el comienzo de la ventana el comienzo del rango de ORDER BY, y como el final de la ventana, la √∫ltima l√≠nea del rango de ORDER BY. </li></ul><br>  La sintaxis para usar funciones de ventana en diferentes sistemas es ligeramente diferente. <br><br>  Para resumir lo anterior, sigue habiendo una sensaci√≥n ligeramente dolorosa de que los desarrolladores, despu√©s de analizar la construcci√≥n de varios informes en SQL, destacaron los casos m√°s comunes y los concretaron en la sintaxis. <br><br><h4>  Funciones de devoluci√≥n de registros </h4><br>  En la salida de las funciones de agregado / ventana, cada fila resultante corresponde a un cierto rango de filas del flujo de datos entrantes.  En la vida, tal correspondencia no siempre existe. <br><br>  Por ejemplo, se requiere construir una matriz de covarianza 10X10 (para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">esto,</a> tomar√≠a 672X672).  Esto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">se puede</a> hacer de una vez, para esto ejecutamos la funci√≥n agregada escrita por nosotros con 10 par√°metros num√©ricos.  El resultado de su trabajo es un conjunto de registros de 10 filas de 10 valores, cada elemento de la matriz se refiere a todas las filas de la secuencia de entrada (no importa cu√°ntas haya). <br><br>  Podemos decir, entonces, qu√©, en PostgreSQl, por ejemplo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">puede</a> devolver una matriz bidimensional de una funci√≥n (Ej: 'ARRAY [[1,2], [3,4]').  O simplemente serialice la matriz en una fila. <br><br>  Es bueno, pero no siempre es posible mantener el tama√±o del resultado dentro del marco aceptable para este enfoque. <br><br><div class="spoiler">  <b class="spoiler_title">Digresi√≥n l√≠rica</b> <div class="spoiler_text">  Por ejemplo, nuestra tarea es generalizar la geometr√≠a. <br><br>  El tama√±o de las geometr√≠as es desconocido para nosotros, tambi√©n puede ser la costa de Eurasia desde decenas de millones de puntos.  O viceversa, hay una geometr√≠a muy rugosa, debe suavizarla con splines.  Me gustar√≠a pasar los par√°metros al agregado y obtener el flujo de datos en lugar de un vector o una cadena. <br><br>  Por supuesto, puede decir que el problema es exagerado, que nadie lo hace, las geometr√≠as en el DBMS se almacenan de una manera especial, hay programas especiales para procesar geometr√≠as, ... <br><br>  De hecho, es bastante conveniente almacenar geometr√≠as en tablas regulares de manera puntual, aunque solo sea porque, al mover un punto, no hay necesidad de reescribir todo el blob.  Antes de que los datos espaciales se filtraran en todas partes en el DBMS, era, por ejemplo, en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ArcSDE</a> . <br><br>  Tan pronto como el tama√±o promedio del blob de geometr√≠a excede el tama√±o de la p√°gina, se vuelve m√°s rentable trabajar directamente con puntos.  Si hubiera una oportunidad f√≠sica para operar con flujo de puntos, tal vez la rueda de la historia volver√≠a a girar. <br></div></div><br>  La matriz de covarianza todav√≠a no es un muy buen ejemplo de la desincronizaci√≥n entre los flujos de entrada y salida, ya que todo el resultado se obtiene simult√°neamente al final.  Suponga que desea procesar / comprimir una secuencia de datos de origen.  Al mismo tiempo <br><br><ul><li>  hay muchos datos, est√°n en el "mont√≥n" sin √≠ndices, de hecho, simplemente se escribieron "r√°pidamente" en el disco </li><li>  necesita clasificarlos en diferentes categor√≠as, que son relativamente pocas </li><li>  dentro de las categor√≠as, promedio en intervalos de tiempo, solo almacenamiento promedio, n√∫mero de mediciones y varianza </li><li>  todo esto debe hacerse r√°pidamente </li></ul><br>  Cuales son las opciones? <br><br><ol><li>  Dentro de SQL, se requiere ordenar por intervalo de tiempo / categor√≠a, lo que contradice el √∫ltimo punto. </li><li>  Si los datos ya est√°n ordenados por tiempo (lo que, de hecho, no est√° garantizado), y ser√° posible transmitir este hecho al procesador SQL, puede hacerlo con funciones de ventana y una pasada. </li><li>  Escriba una aplicaci√≥n separada que haga todo esto.  En PL / SQL o, m√°s probablemente, dado que hay muchos datos, en C / C ++. </li><li>  Funciones que devuelven registros.  Quiz√°s nos puedan ayudar. </li></ol><br>  M√°s detalles sobre A.4.  Hay dos mecanismos para esto: tablas temporales y funciones de canalizaci√≥n. <br><br><ol><li>  Funciones del transportador. <br>  Este mecanismo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">apareci√≥</a> en Oracle (a partir del 9i, 2001) y permite que la funci√≥n que devolvi√≥ el conjunto de registros no acumule datos, sino que los calcule seg√∫n sea necesario (por analog√≠a con la sincronizaci√≥n de stdout y stdin de dos procesos conectados a trav√©s de una tuber√≠a). <br>  Es decir  Los resultados de las funciones canalizadas pueden comenzar a procesarse antes de salir de esta funci√≥n.  Para hacer esto, es suficiente decir en la definici√≥n de la funci√≥n <br><br><pre> <code class="sql hljs"> FUNCTION f_trans(p refcur_t) RETURN outrecset PIPELINED IS ‚Ä¶</code> </pre> <br>  y registrar l√≠neas de resultado en el cuerpo <br><br><pre> <code class="sql hljs">LOOP ‚Ä¶ out_rec.var_char1 := in_rec.email; out_rec.var_char2 := in_rec.phone_number; PIPE ROW(out_rec); ‚Ä¶ <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LOOP</span></span>;</code> </pre> <br>  Como resultado, tenemos <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span>( refcur_pkg.f_trans( <span class="hljs-keyword"><span class="hljs-keyword">CURSOR</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> employees <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> department_id = <span class="hljs-number"><span class="hljs-number">60</span></span>)));</code> </pre><br>  Los agregados personalizados simplemente no son necesarios cuando hay funciones de canalizaci√≥n. <br><br>  Bravo, Oracle! <br><br>  No hace mucho tiempo (2014), las funciones de canalizaci√≥n tambi√©n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aparecieron</a> en DB2 (IBM i 7.1 TR9, i 7.2 TR1). </li><li>  Tablas temporales. <br>  Para empezar, parece que ni MS SQL ni PostgreSQL pueden devolver un cursor desde una funci√≥n agregada. <br><br>  Bueno, por analog√≠a con las funciones de canalizaci√≥n, obtengamos el cursor como par√°metro, lo procesemos, lo agreguemos a una tabla temporal y le devolvamos el cursor. <br><br>  Sin embargo, en MS SQL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">no es posible</a> pasar el cursor a un procedimiento almacenado por un par√°metro, solo es posible crear un cursor en el procedimiento y devolver el par√°metro a trav√©s de la salida.  Lo mismo puede <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">decirse de</a> PostgreSQL. <br><br>  Bueno, est√° bien, simplemente abra el cursor, reste, procese los valores, calcule el resultado, agr√©guelo a la tabla temporal y renderice el cursor. <br><br>  O incluso m√°s simple, agregamos los resultados de la consulta a una tabla temporal, la procesamos y devolvemos los resultados a trav√©s del cursor a otra tabla temporal. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Que</a> puedo decir  Primero, y lo m√°s importante, la lectura de datos a trav√©s del cursor es m√°s lenta que el procesamiento en la secuencia.  En segundo lugar, ¬øpor qu√© necesita un procesador de SQL? Vamos a leer tablas con cursores, crear tablas temporales con nuestras manos, escribir l√≥gica de uni√≥n en bucles ... Es como insertos de ensamblador en C / C ++, a veces puede tratarse a s√≠ mismo, pero es mejor no abusar de √©l. </li></ol><br>  Entonces, despu√©s de considerar una pregunta con funciones que devuelven un conjunto de registros, llegamos a conclusiones: <br><br><ul><li>  Los agregados personalizados realmente no nos ayudar√°n aqu√≠. </li><li>  En cualquier caso, deber√° crear algunos objetos en la base de datos.  Ya sea funciones o tablas temporales.  Como m√≠nimo, se requieren derechos apropiados.  <i>Y solo quiero procesar algunos n√∫meros.</i> <br></li><li>  Sin embargo, incluso con las limitaciones descritas, a veces no es muy elegante, pero con este m√©todo puede resolver el problema. </li></ul><br><h4>  Que mas </h4><br>  De hecho, si ya tenemos la oportunidad de resolver problemas, ¬øqu√© m√°s necesita el autor? <br>  En realidad, la m√°quina Turing tambi√©n puede calcular cualquier cosa, simplemente no lo hace muy r√°pido y no es muy conveniente. <br><br>  Formulamos los requisitos de la siguiente manera: <br><br><ol><li>  debe ser un operador relacional que pueda usarse a la par del resto (selecci√≥n, proyecci√≥n, ...) </li><li>  debe ser un operador que convierta un flujo de datos en otro </li><li>  no hay sincronizaci√≥n entre flujos de entrada y salida </li><li>  La declaraci√≥n del operador define la estructura del flujo de salida </li><li>  el operador tiene la capacidad de inicializar din√°micamente (en forma de una funci√≥n, m√°s precisamente su cuerpo, especificado directamente en la definici√≥n del operador) </li><li>  as√≠ como un destructor en forma de funci√≥n (...) </li><li>  as√≠ como una funci√≥n (...) que se llama cada vez que se recibe una nueva l√≠nea del flujo de entrada </li><li>  el operador tiene un contexto de ejecuci√≥n: un conjunto de variables y / o colecciones definidas por el usuario que son necesarias para el trabajo </li><li>  para ejecutar este operador, no necesita crear objetos de base de datos, no necesita derechos adicionales </li><li>  todo lo que se requiere para el trabajo se define en un lugar, en un idioma </li></ol><br>  √ârase una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">vez, el</a> autor cre√≥ un operador de este tipo que ampl√≠a el procesador de fabricaci√≥n propia del subconjunto implementado de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">TTM / Tutorial D.</a>  Ahora se propone la misma idea para SQL. <br><br>  Vale la pena advertir, aqu√≠ termina SQL y comienza la improvisaci√≥n.  La sintaxis se deja como estaba en el original, al final, el az√∫car sint√°ctico puede ser cualquier cosa, no cambia la esencia. <br><br>  Entonces, el operador de <b>masticaci√≥n</b> consiste en <br><br><ol><li>  Un encabezado que contiene una lista de campos de salida y sus tipos. <br>  Cada campo de salida (y entrada) es una variable local. <br>  Ejemplo: <i>"masticar {" var1 "flotante," var2 "entero}"</i> significa que habr√° dos columnas en la secuencia de salida: un punto flotante y un entero </li><li>  Cuerpos: una lista de devoluciones de llamada para eventos, en este momento, el inicio de la transmisi√≥n, el final de la transmisi√≥n, la l√≠nea.  Por sintaxis, las funciones est√°n cerca de PL / SQL.  La funci√≥n predefinida <i>__interrupt</i> () es un an√°logo de PIPE, toma valores de las variables correspondientes a las columnas de salida y lo coloca en la secuencia de salida.  Si el b√∫fer del flujo de salida est√° lleno, el trabajo del controlador se detendr√° y comenzar√° el trabajo del lado receptor del flujo. <br>  Ej: "hook" init "{var1: = 0;  var2: = -1;  } " </li></ol><br>  La forma m√°s f√°cil de mostrar ejemplos. <br><br><ul><li>  Un an√°logo de la funci√≥n agregada SUM. <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  'select sum(val) from samples' -- select * from samples chew {‚Äúsum(val)‚Äù float} --    hook ‚Äúinit‚Äù { ‚Äúsum(val)‚Äù := 0; --      } hook ‚Äúrow‚Äù { if (not isnull("val")) then "sum(val)" := "sum(val)" + "val"; end if; } hook ‚Äúfinit‚Äù { call __interrupt(); --  PIPE }</span></span></code> </pre><br>  Parece voluminoso, pero es solo un ejemplo, <br>  no es necesario escribir un programa en C para agregar un par de n√∫meros. </li><li>  SUMA + AVG <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  'select sum(val), avg(val) from samples' -- select * from samples chew { ‚Äúsum(val)‚Äù float, ‚Äúavg(val)‚Äù float --       } hook ‚Äúinit‚Äù { ‚Äúsum(val)‚Äù := 0; ‚Äúavg(val)‚Äù := 0; var num integer; num := 0; --    ,       } hook ‚Äúrow‚Äù { if (not isnull("val")) then "sum(val)" := "sum(val)" + "val"; num := num + 1; end if; } hook ‚Äúfinit‚Äù { if (num &gt; 0) then ‚Äúavg(val)‚Äù := ‚Äúsum(val)‚Äù / num; end if; call __interrupt(); }</span></span></code> </pre><br>  Aqu√≠ llamamos la atenci√≥n sobre el hecho de que la suma se produce solo una vez. </li><li>  SUM + GROUP BY <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">--  'select sum(val) from samples group by type' -- select * from --     ( samples val, type from samples order by type ) chew { ‚Äúsum(val)‚Äù float } hook ‚Äúinit‚Äù { ‚Äúsum(val)‚Äù := 0; var gtype integer; gtype := NULL; var num integer; --   num := 0; } hook ‚Äúrow‚Äù { if (gtype &lt;&gt; ‚Äútype‚Äù) then __interrupt(); ‚Äúgtype‚Äù := type; "sum(val)" := 0; num := 0; end if; if (not isnull("val")) then "sum(val)" := "sum(val)" + "val"; num := num + 1; end if; } hook ‚Äúfinit‚Äù { if (num &gt; 0) then call __interrupt(); end if; }</span></span></code> </pre></li><li>  ROW_NUMBER () OVER () <br><br><pre> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">-- select row_number() over() as num, * from samples -- select * from samples chew { ‚Äúnum‚Äù integer, * --        --   '* except val1, ...valX',   TTM } hook ‚Äúinit‚Äù { num := 0; } hook ‚Äúrow‚Äù { num := num + 1; call __interrupt(); }</span></span></code> </pre></li></ul><br>  ¬øEs posible ofrecer un ejemplo en el que este enfoque d√© resultados que son fundamentalmente inalcanzables de la manera habitual?  Los tenemos <br><br>  A veces sucede que los datos est√°n casi ordenados.  Incluso pueden estar completamente ordenados, pero no se sabe con certeza. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Suponga que en el ejemplo anterior (compresi√≥n de flujo de datos) los datos provienen de diferentes fuentes y, por diversas razones, pueden mezclarse ligeramente.</font></font> Es decir<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">una l√≠nea de una fuente con una marca de tiempo T1 puede estar en la base de datos despu√©s de una l√≠nea de otra fuente con la hora T2, mientras que T1 &lt;T2. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Incluso si garantizamos que la diferencia entre T1 y T2 nunca exceder√° una cierta (escasa) constante, no podemos hacerlo sin ordenar aqu√≠ (de la manera tradicional). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sin embargo, utilizando el enfoque propuesto, es posible almacenar en b√∫fer el flujo de entrada y procesar los datos del intervalo de tiempo actual solo despu√©s de que la entrada haya recibido l√≠neas con una marca de tiempo que exceda al menos una constante dada por el l√≠mite derecho del intervalo. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hay un punto muy importante aqu√≠. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo nosotros sabemos que los datos est√°n casi ordenados. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Solo nosotros sabemos el valor de esa constante.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta constante es caracter√≠stica solo para este problema, y ‚Äã‚Äãtal vez solo para este experimento. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y usamos este truco bajo nuestra propia responsabilidad para evitar la clasificaci√≥n. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nuestro conocimiento est√°ndar de la tarea no existe de manera est√°ndar para decirle al procesador SQL, y es dif√≠cil de imaginar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Y el uso de funciones lambda proporciona una forma universal de forzar al procesador SQL a hacer exactamente lo que necesitamos exactamente donde lo necesitamos.</font></font><br><br><h4>  Conclusi√≥n </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">El dise√±o propuesto no parece muy dif√≠cil de implementar. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En cualquier caso, con PL / SQL v√°lido. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La idea en s√≠ misma es simple e intuitiva y no agrega nuevas entidades al lenguaje. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Esta es una sola unidad, que, si es necesario, reemplaza las funciones de agregado y ventana, GROUP BY. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un mecanismo que le permite prescindir de clasificaciones donde no hay forma con un procesador SQL tradicional. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pero lo m√°s importante, es un mecanismo que le da la libertad de hacer lo que quiera con la forma m√°s imperativa con los datos. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PD:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gracias a Dorofei Proleskovsky por participar en la preparaci√≥n del art√≠culo.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435120/">https://habr.com/ru/post/es435120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435106/index.html">Una vez m√°s sobre passport.js</a></li>
<li><a href="../es435108/index.html">Usando Prolog</a></li>
<li><a href="../es435112/index.html">Entrevista corporativa</a></li>
<li><a href="../es435114/index.html">Spring data jpa</a></li>
<li><a href="../es435118/index.html">Save File Me: un servicio de copia de seguridad gratuito con cifrado del lado del cliente</a></li>
<li><a href="../es435122/index.html">C√≥mo se implement√≥ la llama en Doom en Playstation</a></li>
<li><a href="../es435124/index.html">Obras maestras de la construcci√≥n de columnas mundiales: un monitor-transformador de estudio con un n√∫mero variable de bandas</a></li>
<li><a href="../es435126/index.html">Experiencia en la organizaci√≥n y realizaci√≥n de conferencias corporativas para analistas.</a></li>
<li><a href="../es435128/index.html">Pi-Sonos: un pasatiempo fuera de control</a></li>
<li><a href="../es435132/index.html">N√≥mada: problemas y soluciones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>