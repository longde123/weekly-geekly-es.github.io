<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚öôÔ∏è ü§öüèª ‚ôãÔ∏è Ofuscaci√≥n de datos para pruebas de rendimiento üßöüèª ü•á üíΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Los usuarios de ClickHouse saben que su principal ventaja es la alta velocidad de procesamiento de consultas anal√≠ticas. Pero, ¬øc√≥mo podemos hacer tal...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ofuscaci√≥n de datos para pruebas de rendimiento</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/457354/">  Los usuarios de ClickHouse saben que su principal ventaja es la alta velocidad de procesamiento de consultas anal√≠ticas.  Pero, ¬øc√≥mo podemos hacer tales declaraciones?  Esto deber√≠a estar respaldado por pruebas de rendimiento confiables.  Hablaremos de ellos hoy. <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><img src="https://habrastorage.org/webt/ds/2m/sd/ds2msd5-4zeahpzlzptlqz8wgs8.png"></a> <br><br>  Comenzamos a realizar tales pruebas en 2013, mucho antes de que el producto estuviera disponible en c√≥digo abierto.  Como ahora, est√°bamos m√°s interesados ‚Äã‚Äãen la velocidad del servicio de datos Yandex.Metrica.  Ya hemos almacenado datos en ClickHouse desde enero de 2009.  Parte de los datos se ha escrito en la base de datos desde 2012, y parte, se ha <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">convertido</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">OLAPServer y Metrage</a> , estructuras de datos que se utilizaron en Yandex.Metrica antes.  Por lo tanto, para las pruebas, tomamos el primer subconjunto disponible de mil millones de datos de p√°ginas vistas.  Todav√≠a no hab√≠a consultas en Metric, y se nos ocurrieron consultas que nos resultaron m√°s interesantes (todo tipo de filtrado, agregaci√≥n y clasificaci√≥n). <br><br>  ClickHouse se prob√≥ en comparaci√≥n con sistemas similares, por ejemplo, Vertica y MonetDB.  Para ser sincero, fue realizado por un empleado que no hab√≠a sido previamente desarrollador de ClickHouse, y los casos particulares en el c√≥digo no fueron optimizados para obtener resultados.  Del mismo modo, obtuvimos un conjunto de datos para pruebas funcionales. <br><br>  Despu√©s de que ClickHouse se uniera al c√≥digo abierto en 2016, hubo m√°s preguntas para las pruebas. <br><br><a name="habracut"></a><h2>  Desventajas de las pruebas en datos propietarios </h2><br>  Pruebas de rendimiento: <br><br><ol><li> No son reproducibles desde el exterior, porque su lanzamiento requiere datos cerrados que no se pueden publicar.  Por la misma raz√≥n, algunas pruebas funcionales no est√°n disponibles para usuarios externos. </li><li>  No te desarrolles.  Existe la necesidad de una expansi√≥n significativa de su conjunto, de modo que sea posible verificar de manera aislada los cambios en la velocidad de las partes individuales del sistema. </li><li>  No se ejecutan de manera comprometida para solicitudes de grupo, los desarrolladores externos no pueden verificar su c√≥digo para la regresi√≥n del rendimiento. </li></ol><br>  Puede resolver estos problemas: descarte las pruebas antiguas y cree otras nuevas basadas en datos abiertos.  Entre los datos abiertos, puede tomar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">datos sobre vuelos a los EE</a> . <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">UU.</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Viajes en taxi en Nueva York</a> o utilizar puntos de referencia TPC-H, TPC-DS, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Star Schema Benchmark</a> .  El inconveniente es que estos datos est√°n lejos de los datos de Yandex.Metrica, y me gustar√≠a guardar las solicitudes de prueba. <br><br><h2>  Es importante utilizar datos reales. </h2><br>  Debe probar el rendimiento del servicio solo en datos reales de producci√≥n.  Veamos algunos ejemplos. <br><br>  <strong>Ejemplo 1</strong> <br><br>  Suponga que llena una base de datos con n√∫meros pseudoaleatorios distribuidos uniformemente.  En este caso, la compresi√≥n de datos no funcionar√°.  Pero la compresi√≥n de datos es una propiedad importante para los DBMS anal√≠ticos.  Elegir el algoritmo de compresi√≥n correcto y la forma correcta de integrarlo en el sistema es una tarea no trivial en la que no hay una soluci√≥n correcta, porque la compresi√≥n de datos requiere un compromiso entre la velocidad de compresi√≥n y descompresi√≥n y la relaci√≥n de compresi√≥n potencial.  Los sistemas que no saben c√≥mo comprimir datos pierden garant√≠a.  Pero si usamos n√∫meros pseudoaleatorios distribuidos uniformemente para las pruebas, este factor no se considera y todos los dem√°s resultados se distorsionar√°n. <br><br>  Conclusi√≥n: los datos de prueba deben tener una relaci√≥n de compresi√≥n realista. <br><br>  Sobre la optimizaci√≥n de los algoritmos de compresi√≥n de datos en ClickHouse, habl√© en una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">publicaci√≥n anterior</a> . <br><br>  <strong>Ejemplo 2</strong> <br><br>  Interes√©monos en la velocidad de la consulta SQL: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RegionID, uniq(UserID) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> visitors     <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test.hits     <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> RegionID     <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> visitors <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br>  Esta es una solicitud t√≠pica para Yandex.Metrica.  ¬øQu√© es importante para su velocidad? <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øC√≥mo se realiza GROUP BY</a> ? </li><li>  Qu√© estructura de datos se utiliza para calcular la funci√≥n agregada uniq. </li><li>  Cu√°ntos RegionID diferentes son y cu√°nta RAM requiere cada estado de la funci√≥n uniq. </li></ul><br>  Pero tambi√©n es muy importante que la cantidad de datos para diferentes regiones se distribuya de manera desigual.  (Probablemente, se distribuye de acuerdo con la ley de potencia. Constru√≠ un gr√°fico en la escala log-log, pero no estoy seguro). Y si es as√≠, es importante para nosotros que los estados de la funci√≥n agregada uniq con un peque√±o n√∫mero de valores usen poca memoria.  Cuando hay muchas claves de agregaci√≥n diferentes, el recuento va a unidades de bytes.  ¬øC√≥mo obtener los datos generados que tienen todas estas propiedades?  Por supuesto, es mejor usar datos reales. <br><br>  Muchos DBMS implementan una estructura de datos HyperLogLog para el c√°lculo aproximado de COUNT (DISTINCT), pero todos funcionan relativamente mal porque esta estructura de datos utiliza una cantidad fija de memoria.  Y ClickHouse tiene una funci√≥n que utiliza una <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">combinaci√≥n de tres estructuras de datos diferentes</a> , dependiendo del tama√±o del conjunto. <br><br>  Conclusi√≥n: los datos de prueba deben representar las propiedades de la distribuci√≥n de valores en los datos: cardinalidad (el n√∫mero de valores en las columnas) y cardinalidad mutua de varias columnas diferentes. <br><br>  <strong>Ejemplo 3</strong> <br><br>  Bueno, probemos el rendimiento no del DBMS anal√≠tico ClickHouse, sino de algo m√°s simple, por ejemplo, tablas hash.  Para las tablas hash, elegir la funci√≥n hash correcta es muy importante.  Para std :: unordered_map, es un poco menos importante, porque es una tabla hash basada en cadena y se utiliza un n√∫mero primo como el tama√±o de la matriz.  En la implementaci√≥n est√°ndar de la biblioteca en gcc y clang, se utiliza una funci√≥n hash trivial como la funci√≥n hash predeterminada para los tipos num√©ricos.  Pero std :: unordered_map no es la mejor opci√≥n cuando queremos obtener la m√°xima velocidad.  Cuando se usan tablas hash de direccionamiento abierto, la elecci√≥n correcta de la funci√≥n hash se convierte en un factor decisivo, y no podemos usar la funci√≥n hash trivial. <br><br>  Es f√°cil encontrar pruebas de rendimiento de tablas hash en datos aleatorios, sin tener en cuenta las funciones hash utilizadas.  Tambi√©n es f√°cil encontrar pruebas de funci√≥n hash con √©nfasis en la velocidad de c√°lculo y algunos criterios de calidad, sin embargo, de forma aislada de las estructuras de datos utilizadas.  Pero el hecho es que las tablas hash y HyperLogLog requieren diferentes criterios de calidad para las funciones hash. <br><br><img src="https://habrastorage.org/webt/bp/3h/32/bp3h320eztrirqzhm-lexeuhmbq.png"><br><br>  Lea m√°s sobre esto en el informe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">"C√≥mo se organizan las tablas hash en ClickHouse"</a> .  Est√° un poco desactualizado ya que no considera las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tablas suizas</a> . <br><br><h2>  Desaf√≠o </h2><br>  Queremos obtener los datos para las pruebas de rendimiento por estructura, igual que los datos de Yandex.Metrica, para los que se almacenan todas las propiedades importantes para los puntos de referencia, pero para que no queden rastros de visitantes reales del sitio en estos datos.  Es decir, los datos deben ser anonimizados y se debe almacenar lo siguiente: <br><br><ul><li>  relaciones de compresi√≥n </li><li>  cardinalidad (n√∫mero de valores diferentes), </li><li>  cardinalidades mutuas de varias columnas diferentes, </li><li>  propiedades de las distribuciones de probabilidad con las que puede simular datos (por ejemplo, si creemos que las regiones se distribuyen de acuerdo con una ley de potencia, entonces el exponente - par√°metro de distribuci√≥n - para datos artificiales deber√≠a ser casi igual que para los reales). </li></ul><br>  ¬øY qu√© se necesita para que los datos tengan una relaci√≥n de compresi√≥n similar?  Por ejemplo, si se usa LZ4, entonces las subcadenas en los datos binarios deben repetirse aproximadamente a las mismas distancias y las repeticiones deben tener aproximadamente la misma longitud.  Para ZSTD, se agrega una coincidencia de entrop√≠a de bytes. <br><br>  El objetivo m√°ximo: hacer que una herramienta est√© disponible para personas externas, con la que todos puedan anonimizar su conjunto de datos para su publicaci√≥n.  Para que podamos depurar y probar el rendimiento en los datos de otras personas de forma similar a los datos de producci√≥n.  Y me gustar√≠a que fuera interesante ver los datos generados. <br><br>  Esta es una declaraci√≥n informal del problema.  Sin embargo, nadie iba a dar una declaraci√≥n formal. <br><br><h2>  Intentos de resolver </h2><br>  La importancia de esta tarea no debe exagerarse para nosotros.  De hecho, nunca estuvo en los planes y nadie lo iba a hacer.  Simplemente no perd√≠ la esperanza de que algo surgir√≠a solo, y de repente tendr√≠a un buen humor y muchas cosas que podr√≠an posponerse hasta m√°s tarde. <br><br><h2>  Modelos probabil√≠sticos expl√≠citos </h2><br>  La primera idea es seleccionar una familia de distribuciones de probabilidad que la modele para cada columna de la tabla.  Luego, en funci√≥n de las estad√≠sticas de los datos, seleccione los par√°metros de ajuste del modelo y genere nuevos datos utilizando la distribuci√≥n seleccionada.  Puede usar un generador de n√∫meros pseudoaleatorio con una semilla predefinida para obtener un resultado reproducible. <br><br>  Para los campos de texto, puede usar las cadenas de Markov, un modelo comprensible para el que puede realizar una implementaci√≥n efectiva. <br><br>  Es cierto que se requieren algunos trucos: <br><br><ul><li>  Queremos preservar la continuidad de las series de tiempo, lo que significa que para algunos tipos de datos es necesario modelar no el valor en s√≠, sino la diferencia entre los vecinos. </li><li>  Para simular la cardinalidad condicional de las columnas (por ejemplo, que generalmente hay pocas direcciones IP por identificador de visitante), tambi√©n deber√° anotar expl√≠citamente las dependencias entre las columnas (por ejemplo, para generar una direcci√≥n IP, se utiliza un hash del identificador de visitante, pero tambi√©n se agregan algunos otros datos pseudoaleatorios). </li><li>  No est√° claro c√≥mo expresar la dependencia de que un visitante aproximadamente al mismo tiempo a menudo visita URL con dominios coincidentes. </li></ul><br>  Todo esto se presenta en forma de un programa en el que todas las distribuciones y dependencias est√°n codificadas, el llamado "script C ++".  Sin embargo, los modelos de Markov todav√≠a se calculan a partir de la suma de estad√≠sticas, suavizado y rugosidad con ruido.  Comenc√© a escribir este script, pero por alguna raz√≥n, despu√©s de escribir expl√≠citamente el modelo para diez columnas, de repente se volvi√≥ insoportablemente aburrido.  Y en la tabla de √©xitos en Yandex. M√©trica en 2012 hab√≠a m√°s de 100 columnas. <br><br><pre> <code class="cpp hljs">EventTime.day(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::discrete_distribution&lt;&gt;({    <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, ...})(random)); EventTime.hour(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::discrete_distribution&lt;&gt;({    <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, ...})(random)); EventTime.minute(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uniform_int_distribution&lt;UInt8&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>)(random)); EventTime.second(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uniform_int_distribution&lt;UInt8&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>)(random)); UInt64 UserID = hash(<span class="hljs-number"><span class="hljs-number">4</span></span>, powerLaw(<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>)); UserID = UserID / <span class="hljs-number"><span class="hljs-number">10000000000U</span></span>LL * <span class="hljs-number"><span class="hljs-number">10000000000U</span></span>LL    + <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span>&gt;(EventTime) + UserID % <span class="hljs-number"><span class="hljs-number">1000000</span></span>; random_with_seed.seed(powerLaw(<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> get_random_with_seed = [&amp;]{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random_with_seed(); };</code> </pre><br>  Este enfoque de la tarea fue un fracaso.  Si me acercara a ella m√°s diligentemente, seguro que el gui√≥n habr√≠a sido escrito. <br><br>  Ventajas: <br><br><ul><li>  simplicidad ideol√≥gica </li></ul><br>  Desventajas <br><br><ul><li>  la complejidad de la implementaci√≥n, </li><li>  La soluci√≥n implementada es adecuada para un solo tipo de datos. </li></ul><br>  Y me gustar√≠a una soluci√≥n m√°s general, para que pueda aplicarse no solo a los datos de Yandex.Metrica, sino tambi√©n para ofuscar cualquier otro dato. <br><br>  Sin embargo, las mejoras son posibles aqu√≠.  No puede seleccionar modelos manualmente, sino implementar un cat√°logo de modelos y elegir el mejor entre ellos (mejor ajuste + alg√∫n tipo de regularizaci√≥n).  O tal vez pueda usar los modelos de Markov para todo tipo de campos, y no solo para el texto.  Las dependencias entre los datos tambi√©n se pueden entender autom√°ticamente.  Para hacer esto, debe calcular las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">entrop√≠as relativas</a> (cantidad relativa de informaci√≥n) entre las columnas, o m√°s simplemente, las cardinalidades relativas (algo as√≠ como ‚Äúcu√°ntos valores A diferentes en promedio para un valor B fijo‚Äù) para cada par de columnas.  Esto dejar√° en claro, por ejemplo, que URLDomain depende completamente de la URL, y no al rev√©s. <br><br>  Pero tambi√©n rechac√© esta idea, porque hay demasiadas opciones para lo que debe tenerse en cuenta, y tomar√° mucho tiempo escribirlo. <br><br><h2>  Redes neuronales </h2><br>  Ya dije lo importante que es esta tarea para nosotros.  Nadie pens√≥ siquiera en detenerse en su implementaci√≥n.  Afortunadamente, el colega Ivan Puzyrevsky luego trabaj√≥ como maestro en HSE y al mismo tiempo estaba desarrollando el n√∫cleo de YT.  Me pregunt√≥ si ten√≠a alguna tarea interesante que pudiera ofrecerse a los estudiantes como tema de diploma.  Le ofrec√≠ este y me asegur√≥ que era adecuado.  Entonces le di esta tarea a una buena persona "de la calle": Sharif Anvardinov (la NDA est√° firmada para trabajar con datos). <br><br>  Le cont√≥ todas sus ideas, pero lo m√°s importante, explic√≥ que el problema se puede resolver de cualquier manera.  Y una buena opci√≥n ser√≠a usar esos enfoques que no entiendo en absoluto: por ejemplo, generar un volcado de datos de texto usando LSTM.  Parec√≠a alentador gracias al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art√≠culo La efectividad irracional de las redes neuronales recurrentes</a> , que luego me llam√≥ la atenci√≥n. <br><br>  La primera caracter√≠stica de la tarea es que necesita generar datos estructurados, no solo texto.  No era obvio si una red neuronal recurrente podr√≠a generar datos con la estructura deseada.  Hay dos formas de resolver esto.  El primero es usar modelos separados para generar la estructura y para el "relleno": la red neuronal solo debe generar valores.  Pero esta opci√≥n fue pospuesta hasta m√°s tarde, despu√©s de lo cual nunca lo hicieron.  La segunda forma es simplemente generar un volcado de TSV como texto.  La pr√°ctica ha demostrado que en el texto parte de las l√≠neas no se corresponder√° con la estructura, pero estas l√≠neas se pueden tirar al cargar. <br><br>  La segunda caracter√≠stica: una red neuronal recurrente genera una secuencia de datos, y las dependencias en los datos solo pueden seguir en el orden de esta secuencia.  Pero en nuestros datos, tal vez el orden de las columnas se invierte con respecto a las dependencias entre ellas.  No hicimos nada con esta funci√≥n. <br><br>  Hacia el verano, apareci√≥ el primer script de Python que generaba datos.  A primera vista, la calidad de los datos es decente: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6f4/816/f70/6f4816f70912c3fb348f505d3073eded.jpg"><br><br>  Es cierto que se revelaron dificultades: <br><br><ol><li>  El tama√±o del modelo es de aproximadamente un gigabyte.  Y tratamos de crear un modelo para datos cuyo tama√±o era del orden de varios gigabytes (para empezar).  El hecho de que el modelo resultante sea tan grande suscita inquietud: de repente ser√° posible obtener datos reales del mismo en el que se form√≥.  Lo m√°s probable es que no.  Pero no entiendo el aprendizaje autom√°tico y las redes neuronales y no he le√≠do el c√≥digo Python de esta persona, entonces, ¬øc√≥mo puedo estar seguro?  Luego hubo art√≠culos sobre c√≥mo comprimir redes neuronales sin perder calidad, pero esto se dej√≥ sin implementaci√≥n.  Por un lado, esto no parece un problema: puede negarse a publicar el modelo y publicar solo los datos generados.  Por otro lado, en el caso del reciclaje, los datos generados pueden contener alguna parte de los datos de origen. </li><li>  En una sola m√°quina con una CPU, la tasa de generaci√≥n de datos es de aproximadamente 100 l√≠neas por segundo.  Ten√≠amos una tarea: generar al menos mil millones de l√≠neas.  El c√°lculo mostr√≥ que esto no pod√≠a hacerse antes de la defensa del diploma.  Y usar otro hardware no es pr√°ctico, porque ten√≠a un objetivo: hacer que la herramienta de generaci√≥n de datos est√© disponible para un uso amplio. </li></ol><br>  Sharif trat√≥ de estudiar la calidad de los datos mediante la comparaci√≥n de estad√≠sticas.  Por ejemplo, calcul√© la frecuencia con la que aparecen diferentes s√≠mbolos en la fuente y en los datos generados.  El resultado fue sorprendente: los personajes m√°s comunes son √ê y √ë. <br><br>  No se preocupe, defendi√≥ su diploma perfectamente, despu√©s de lo cual nos olvidamos de este trabajo. <br><br><h2>  Mutaci√≥n de datos comprimidos </h2><br>  Suponga que la declaraci√≥n del problema se reduce a un punto: necesita generar datos para los cuales las relaciones de compresi√≥n ser√°n exactamente las mismas que los datos originales, mientras que los datos deben expandirse exactamente a la misma velocidad.  Como hacerlo  ¬°Necesita editar bytes de datos comprimidos directamente!  Entonces, el tama√±o de los datos comprimidos no cambiar√°, pero los datos en s√≠ lo har√°n.  S√≠, y todo funcionar√° r√°pidamente.  Cuando apareci√≥ esta idea, inmediatamente quise implementarla, a pesar del hecho de que resuelve alg√∫n otro problema en lugar del original.  Siempre pasa. <br><br>  ¬øC√≥mo editar un archivo comprimido directamente?  Supongamos que solo estamos interesados ‚Äã‚Äãen LZ4.  Los datos comprimidos con LZ4 constan de dos tipos de instrucciones: <br><br><ol><li>  Literales: copie los siguientes N bytes tal como est√°n. </li><li>  Coincidencia (coincidencia, la longitud m√≠nima de repetici√≥n es 4): repita N bytes que estaban en el archivo a una distancia de M. </li></ol><br>  Datos de origen: <br>  <code>Hello world Hello</code> <br><br>  Datos comprimidos (condicionalmente): <br>  <code>literals 12 "Hello world " match 5 12</code> . <br><br>  En el archivo comprimido, deje la coincidencia como est√°, y en literales cambiaremos los valores de bytes.  Como resultado, despu√©s de la descompresi√≥n, obtenemos un archivo en el que todas las secuencias repetidas de al menos 4 tambi√©n se repiten, y se repiten a las mismas distancias, pero al mismo tiempo consisten en un conjunto diferente de bytes (en sentido figurado, no se tom√≥ un solo byte del archivo original en el archivo modificado ) <br><br>  ¬øPero c√≥mo cambiar los bytes?  Esto no es obvio porque, adem√°s de los tipos de columna, los datos tambi√©n tienen su propia estructura interna impl√≠cita, que nos gustar√≠a preservar.  Por ejemplo, el texto a menudo se almacena en codificaci√≥n UTF-8, y tambi√©n queremos UTF-8 v√°lido en los datos generados.  Hice una simple heur√≠stica para satisfacer varias condiciones: <br><br><ul><li>  bytes nulos y caracteres de control ASCII se almacenaron tal cual, </li><li>  persisti√≥ alguna puntuaci√≥n, </li><li>  ASCII se tradujo a ASCII y, por lo dem√°s, se guard√≥ el bit m√°s significativo (o puede escribir expl√≠citamente un conjunto if para diferentes longitudes UTF-8).  Entre una clase de bytes, se selecciona un nuevo valor de manera uniforme al azar; </li><li>  y tambi√©n para guardar fragmentos de <code>https://</code> y similares, de lo contrario todo parece demasiado tonto. </li></ul><br>  La peculiaridad de este enfoque es que los datos iniciales en s√≠ mismos act√∫an como un modelo para los datos, lo que significa que el modelo no se puede publicar.  Le permite generar la cantidad de datos no m√°s que el original.  A modo de comparaci√≥n, en enfoques anteriores era posible crear un modelo y generar una cantidad ilimitada de datos sobre la base. <br><br>  Ejemplo para URL: <br><br> <code>http://ljc.she/kdoqdqwpgafe/klwlpm&amp;qw=962788775I0E7bs7OXeAyAx <br> http://ljc.she/kdoqdqwdffhant.am/wcpoyodjit/cbytjgeoocvdtclac <br> http://ljc.she/kdoqdqwpgafe/klwlpm&amp;qw=962788775I0E7bs7OXe <br> http://ljc.she/kdoqdqwdffhant.am/wcpoyodjit/cbytjgeoocvdtclac <br> http://ljc.she/kdoqdqwdbknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu_qxht <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu_qxht <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu-702130 <br></code> <br>  El resultado me gust√≥: fue interesante mirar los datos.  Pero a√∫n as√≠, algo estaba mal.  Las URL todav√≠a est√°n estructuradas, pero en algunos lugares fue demasiado f√°cil adivinar yandex o avito.  Hizo una heur√≠stica que a veces reorganiza algunos bytes en algunos lugares. <br><br>  Otras consideraciones preocupadas.  Por ejemplo, la informaci√≥n confidencial se puede representar en una columna de tipo FixedString en forma binaria y, por alguna raz√≥n, consiste en caracteres de control ASCII y puntuaci√≥n, que decid√≠ guardar.  Y no considero los tipos de datos. <br><br>  Otro problema: si los datos del tipo "longitud, valor" se almacenan en una columna (as√≠ es como se almacenan las columnas del tipo Cadena), ¬øc√≥mo garantizar que la longitud siga siendo correcta despu√©s de la mutaci√≥n?  Cuando trat√© de arreglarlo, la tarea inmediatamente se volvi√≥ poco interesante. <br><br><h2>  Permutaciones aleatorias </h2><br>  Pero el problema no est√° resuelto.  Llevamos a cabo varios experimentos, y solo empeor√≥.  Solo queda no hacer nada y leer p√°ginas aleatorias en Internet, porque el estado de √°nimo ya est√° echado a perder.  Afortunadamente, en una de estas p√°ginas hab√≠a un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">an√°lisis del algoritmo para</a> representar la escena de la muerte del protagonista en el juego Wolfenstein 3D. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a5d/8a2/291/a5d8a229119786bc45f48fb74cfb956d.gif" width="640" height="480"><br><br>  Hermosa animaci√≥n: la pantalla se llena de sangre.  El art√≠culo explica que esto es en realidad una permutaci√≥n pseudoaleatoria.  Permutaci√≥n aleatoria: una transformaci√≥n uno a uno de un conjunto seleccionada al azar.  Es decir, la visualizaci√≥n de todo el conjunto en el que no se repiten los resultados para diferentes argumentos.  En otras palabras, esta es una forma de iterar sobre todos los elementos de un conjunto en un orden aleatorio.  Es un proceso que se muestra en la imagen: pintamos sobre cada p√≠xel, seleccionados al azar de todos, sin repetici√≥n.  Si solo escogi√©ramos un p√≠xel aleatorio en cada paso, nos llevar√≠a mucho tiempo pintar sobre el √∫ltimo. <br><br>  El juego utiliza un algoritmo muy simple para la permutaci√≥n pseudoaleatoria: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LFSR</a> (registro de desplazamiento de retroalimentaci√≥n lineal).  Al igual que los generadores de n√∫meros pseudoaleatorios, las permutaciones aleatorias, o m√°s bien sus familias, parametrizadas por la clave, pueden ser criptogr√°ficamente fuertes; esto es exactamente lo que necesitamos para convertir los datos.  Aunque puede haber detalles obvios.  Por ejemplo, parece que el cifrado criptogr√°ficamente fuerte de N bytes a N bytes con una clave prefijada y un vector de inicializaci√≥n puede usarse como una permutaci√≥n pseudoaleatoria de muchas cadenas de N bytes.  De hecho, tal transformaci√≥n es uno a uno y parece aleatoria.  Pero si usamos la misma transformaci√≥n para todos nuestros datos, entonces el resultado puede estar sujeto a an√°lisis, porque el mismo vector de inicializaci√≥n y los valores clave se usan varias veces.  Esto es similar al modo de cifrado de bloque del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Libro de c√≥digos electr√≥nico</a> . <br><br>  ¬øCu√°les son las formas de obtener una permutaci√≥n pseudoaleatoria?  Puede tomar transformaciones simples uno a uno y ensamblar una funci√≥n bastante compleja a partir de ellas que se ver√° aleatoria.  Perm√≠teme darte un ejemplo de algunas de mis transformaciones individuales favoritas: <br><br><ul><li>  multiplicaci√≥n por un n√∫mero impar (por ejemplo, un primo grande) en aritm√©tica del complemento a dos, </li><li>  xor-shift: <code>x ^= x &gt;&gt; N</code> , </li><li>  CRC-N, donde N es el n√∫mero de bits del argumento. </li></ul><br>  Entonces, por ejemplo, a partir de tres multiplicaciones y dos operaciones xor-shift, se <a href="">ensambla el</a> finalizador <a href="">murmurhash</a> .  Esta operaci√≥n es una permutaci√≥n pseudoaleatoria.  Pero por si acaso, observo que las funciones hash, incluso N bits en N bits, no tienen que ser mutuamente √∫nicas. <br><br>  O aqu√≠ hay otro <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ejemplo</a> interesante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">de la teor√≠a de n√∫meros elementales</a> del sitio de Jeff Preshing. <br><br>  ¬øC√≥mo podemos usar permutaciones pseudoaleatorias para nuestra tarea?  Puede convertir todos los campos num√©ricos us√°ndolos.  Entonces ser√° posible preservar todas las cardinalidades y cardinalidades mutuas de todas las combinaciones de campos.  Es decir, COUNT (DISTINCT) devolver√° el mismo valor que antes de la conversi√≥n, y con cualquier GROUP BY. <br><br>  Vale la pena se√±alar que la preservaci√≥n de todas las cardinalidades es ligeramente contraria a la declaraci√≥n del problema del anonimato de datos. ,  ,         ,      10  ,        .           10   ‚Äî   ,    .    ,    ,     ,         ‚Äî ,    ,    .       . ,    ,         ,     Google,       ,  -          Google.       ‚Äî ,      ,          ( )     ( ).  ,        ,   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> . <br><br>           ,      . ,       10,        .   ? <br><br> ,       size classes         (  ).       size class        ,    .  0  1    .  2  3   1/2        1/2      .   1024..2047     1024! () .  Y as√≠ sucesivamente.        . <br><br>  ,     . ,      -.    ,      . <br><br>       ,     ,      ,             . <br><br>    ‚Äî             ,       .   .            .   Fabien Sanglard   c <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Hackers News</a> ,      .      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    Redis</a> ‚Äî  .    ,            <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> </a> . <br><br>     .   ‚Äî  ,        . ,   . <br><br><ol><li>      : <br> <code>arg: xxxxyyyy <br> <font color="#0fc000">arg_l</font> : xxxx <br> <font color="#0000ff">arg_r</font> : yyyy</code> </li> <li>      .      xor        : <br> <code>res: yyyyzzzz <br> <font color="#0000ff">res_l</font> = yyyy = <font color="#0000ff">arg_r</font> <br> <font color="#FF6600">res_r</font> = zzzz = <font color="#0fc000">arg_l</font> ^ F( <font color="#0000ff">arg_r</font> )</code> </li> </ol><br>   ,     F            4 ,      . <br><br>   :  ,       ,      ‚Äî      ,       ,     ! <br><br>         .  ,    ,      ,    .     : <br><br><ul><li>     ,  ,  Electronic Codebook mode of operation; </li><li>        (  )   ,     ,      . </li></ul><br>           . ,     LZ4     ,             ,        . <br><br><h2>   </h2><br>    ,  ,  ,         .   ‚Äî     .  , ,      ,    .                ( ,    ).          ? <br><br> -,         : ,  256^10     10 ,      ,          . -,      ,     . <br><br>        ,      . ,    ,       .    ,       .    ,   -   . <br><br>             ,       ‚Äî  ,     N   . N ‚Äî   . , N = 5,       ¬´¬ª   ¬´¬ª.       Order-N. <br><br> <code>P( <font color="#ff0000"></font> | ) = 0.9 <br> P( <font color="#ff0000"></font> | ) = 0.05 <br> P( <font color="#ff0000"></font> | ) = 0.01 <br> ...</code> <br> <br>         <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">.</a> ( vesna.yandex.ru).      LSTM,           N,    ,  .          ‚Äî           ,    .  :      ,  ,      . <br><br>   Title: <br><br><blockquote>   ‚Äî . ‚Äî     ,   .   ,   ,      ‚Äî .@Mail.Ru ‚Äî   ‚Äî -    . ) ‚Äî AUTO.ria.ua        </blockquote><br> ,       ,          .       () ,           ‚Äî   .        0  N,         N    N ‚àí 1). <br><br>       . ,      123456   URL,          .                    .      -.       .      ,    . <br><br>   :         URL,        ,   -. : <code>https://www.yandex.ru/images/cats/?id=xxxxxx</code> .  ,      URL,      ,   . : <code>http://ftp.google.kz/cgi-bin/index.phtml?item=xxxxxx</code> .                  -     ,      8    . <br><br> <code>https://www.yandex.ru/ <font color="#0fc000">images/c</font> ats/?id=12345 <br> ^^^^^^^^ <br> <br> distribution: [aaaa][b][cc][dddd][e][ff][g <font color="#ff0000">g</font> ggg][h]... <br> hash(" <font color="#0fc000">images/c</font> ") % total_count:           ^ <br> <br></code> <code>http://ftp.google.kz/c <font color="#ff0000">g</font> ...</code> <br> <br>    ,  .     : <br><br><blockquote><pre> -        | . -    <font></font>
-  ‚Äî .:      Lore - dfghf ‚Äî . -   )  473682  -  <font></font>
- !   ¬ª  -  ‚Äî      <font></font>
- !   ¬ª , <font></font>
-  .  c      @Mail.Ru - <font></font>
-     ,  2010 |  . <font></font>
- !    : 820 0000 .,    -<font></font>
-   - DoramaTv.ru -   . -  ..    <font></font>
-  .  2013 ,       -&gt;  80 .<font></font>
-  -    (.    , ,  <font></font>
-   . 5, 69,  W* - ., ,      World of Tanks<font></font>
- ,     . 2     @Mail.Ru<font></font>
-      ,  .   <font></font>
</pre></blockquote><br><h2>  Resultado </h2><br>        ,     - ,        -   .          ,  .      clickhouse obfuscator,     :          (, CSV, JSONEachRow),        (   )    ( ,       ).         . <br><br>     clickhouse-client,         Linux.        ,   ClickHouse. ,         MySQL  PostgreSQL ,        . <br><br> <code>clickhouse obfuscator \ <br> --seed "$(head -c16 /dev/urandom | base64)" \ <br> --input-format TSV --output-format TSV \ <br> --structure 'CounterID UInt32, URLDomain String, \ <br> URL String, SearchPhrase String, Title String' \ <br> &lt; table.tsv &gt; result.tsv <br> <br> clickhouse obfuscator --help <br></code> <br>    ,        .     ,   ?      ,        ,    .        ,    ,      .   ,     (  <code>--help</code> )   . <br><br>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   </a> ,        . <br><br> <a href="">clickhouse-datasets.s3.yandex.net/hits/tsv/hits_v1.tsv.xz</a> <br> <a href="">clickhouse-datasets.s3.yandex.net/visits/tsv/visits_v1.tsv.xz</a> <br><br>                ClickHouse.          ,       ClickHouse  . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457354/">https://habr.com/ru/post/457354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457340/index.html">10 complementos PostCSS que le ahorrar√°n tiempo de dise√±o</a></li>
<li><a href="../457342/index.html">Se√±ales desde arriba: c√≥mo salvamos a los cart√≥grafos del trabajo innecesario y los ojos rojos</a></li>
<li><a href="../457348/index.html">Implementaci√≥n en PythonAnywhere desde GitHub</a></li>
<li><a href="../457350/index.html">¬øPor qu√© el osciloscopio necesita soporte de criptograf√≠a?</a></li>
<li><a href="../457352/index.html">Conclusi√≥n de la informaci√≥n en la pantalla del comprador.</a></li>
<li><a href="../457362/index.html">Promoci√≥n de RUVDS: prepara el servidor en verano</a></li>
<li><a href="../457366/index.html">Un fan√°tico, una pieza de hierro o un espectador: ¬øqu√© tipo de jugador eres?</a></li>
<li><a href="../457374/index.html">Reduce el tiempo de construcci√≥n de tus proyectos de Android</a></li>
<li><a href="../457378/index.html">C√≥mo id Software cre√≥ Wolfenstein 3D basado en tecnolog√≠a de Commander Keen</a></li>
<li><a href="../457380/index.html">OpenGL ultramoderno. Parte 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>