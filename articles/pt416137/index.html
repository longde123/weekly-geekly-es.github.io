<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÜîÔ∏è üëº ü¶Å Zabbix como um scanner de seguran√ßa ‚òòÔ∏è üå∞ ‚è≤Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Todos conhecemos e adoramos produtos para processos de avalia√ß√£o de vulnerabilidades, como Nessus , Qualys , Max Patrol e todos os tipos de outros ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zabbix como um scanner de seguran√ßa</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/vulners/blog/416137/"><p>  Oi  Todos conhecemos e adoramos produtos para processos de avalia√ß√£o de vulnerabilidades, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Nessus</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Qualys</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Max Patrol</a> e todos os tipos de outros <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenVAS</a> .  Uma das principais tarefas que eles resolvem √© fornecer controle sobre vulnerabilidades com vers√£o. </p><br><p>  Esse √© um processo bastante simples de comparar as vers√µes de software instaladas com o intervalo "n√£o cont√©m vulnerabilidades conhecidas".  Bem, os respons√°veis ‚Äã‚Äãpela seguran√ßa da informa√ß√£o, juntamente com o desenvolvimento e os administradores, decidem quais riscos podem ser tomados e quais precisam ser corrigidos hoje. </p><br><p>  Existem muitas ferramentas diferentes para resolver esse problema, mas, do nosso ponto de vista, todas elas t√™m um problema comum - elas exigem uma implanta√ß√£o problem√°tica separada e geram outra ferramenta com uma conta raiz em sua infraestrutura.  Afinal, para uma a√ß√£o t√£o simples como coletar informa√ß√µes sobre pacotes raiz instalados, n√£o √© necess√°rio!  E geralmente na infraestrutura j√° existem sistemas implantados com a capacidade de consolidar dados, colabora√ß√£o e execu√ß√£o remota de comandos nos servidores.  Portanto, decidimos criar uma ferramenta que permitiria alguns cliques para implantar um sistema de monitoramento de vulnerabilidades do Linux em nosso ambiente com altera√ß√µes m√≠nimas na produ√ß√£o. </p><br><p>  O que √© implantado na maioria dos sistemas alimentares?  Claro, monitorando.  E muitas vezes √© o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zabbix</a> .  Ent√£o vamos l√° e apertar! </p><a name="habracut"></a><br><h1 id="v-odnoy-ruke-zabbix">  Em uma m√£o Zabbix </h1><br><p>  Tudo √© simples: um sistema de agente distribu√≠do, pain√©is para visualiza√ß√£o, um sistema de acesso para v√°rios usu√°rios e a√ß√µes de acordo com os crit√©rios especificados j√° foram realizadas sem n√≥s.  N√£o precisamos reinventar a roda e fazer tudo do zero. </p><br><p>  O Zabbix tem direitos suficientes para receber informa√ß√µes sobre pacotes, onde coloc√°-los tamb√©m.  Resta combin√°-los e envi√°-los para an√°lise √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API Vulners</a> .  E ent√£o processe o conhecimento adquirido sobre vulnerabilidades. </p><br><p>  Mas vamos come√ßar com uma breve introdu√ß√£o sobre o que o Zabbix pode fazer e o que precisamos fazer. </p><br><p>  <strong>Os agentes Zabbix</strong> s√£o instalados no servidor e permitem: </p><br><ul><li>  Obtenha uma ampla variedade de m√©tricas do sistema operacional </li><li>  executar scripts e programas e obter o resultado de sua execu√ß√£o; </li><li>  executar qualquer comando em um processo separado (fork), independente dos processos do agente Zabbix; </li><li>  trabalhe com v√°rios servidores Zabbix de uma s√≥ vez; </li><li>  trabalhe atr√°s de um firewall, iniciando uma conex√£o com o servidor ou vice-versa, aguardando as conex√µes de entrada. </li></ul><br><p>  <strong>O servidor Zabbix</strong> recebe as m√©tricas de monitoramento como uma entrada e as grava no banco de dados e conduz o processamento adicional. </p><br>  Analisando os dados obtidos e com base em uma l√≥gica bastante flex√≠vel, ele pode executar v√°rias a√ß√µes: <br><br><ul><li>  Envie alertas em v√°rios canais (correio, sms, mensagens instant√¢neas, etc.); </li><li>  Conecte-se aos servidores via SSH ou IPMI e execute v√°rios comandos neles; </li><li>  Ou execute v√°rios comandos corretivos nos servidores usando as conex√µes do agente Zabbix com eles; </li></ul><br><p>  <strong>A interface da web √©</strong> escrita em PHP e permitir√° exibir m√©tricas coletadas pelo Zabbix, gr√°ficos, alertas acionados sobre problemas e comandos e a√ß√µes executadas pelo sistema de monitoramento. </p><br><p>  A administra√ß√£o do Zabbix tamb√©m √© realizada atrav√©s da interface da web. </p><br><p>  <strong>A API do Zabbix</strong> √© uma API baseada na Web e faz parte da interface da Web.  Ele usa o protocolo JSON-RPC. </p><br><ul><li>  Permite receber, criar, configurar e excluir qualquer objeto no sistema de monitoramento. </li><li>  Usando a API, voc√™ pode integrar facilmente o sistema de monitoramento a v√°rios sistemas externos. </li></ul><br><p>  No entanto, o Zabbix n√£o sabe nada sobre vulnerabilidades!  Mas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vulners</a> sabe sobre eles :) </p><br><h2 id="v-drugoy-ruke-vulners">  Por outro lado, os Vulners </h2><br><ul><li>  Agregador de dados de vulnerabilidade de mais de 115 fontes </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API conveniente para v√°rios m√©todos de digitaliza√ß√£o</a> </li><li>  Fornece dados de forma normalizada e leg√≠vel por m√°quina </li><li>  Muito r√°pido </li><li>  Permite a correla√ß√£o de dados de v√°rias fontes </li></ul><br><p>  Tentamos integr√°-los um ao outro e foi isso que aconteceu. </p><br><h1 id="zabbix-threat-control">  Controle de amea√ßas do Zabbix </h1><br><p>  Este √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug-in</a> Zabbix de c√≥digo aberto escrito em Python que: </p><br><ul><li>  Exibe informa√ß√µes sobre vulnerabilidades encontradas em sua infraestrutura na interface da web do Zabbix. </li><li>  Mostra o n√≠vel de amea√ßa de cada vulnerabilidade de acordo com o padr√£o CVSS. </li><li>  E oferece m√©todos facilmente aplic√°veis ‚Äã‚Äãpara eliminar as vulnerabilidades encontradas. </li></ul><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">O CVSS</a> √© um padr√£o aberto do setor para avaliar a criticidade da vulnerabilidade.  De fato - escala de 10 pontos. </p><br>  O uso dessa t√©cnica permite trazer vulnerabilidades encontradas em diferentes sistemas e com propriedades diferentes para um √∫nico denominador, o que simplifica a prioriza√ß√£o dos problemas detectados. <br><br>  N√≥s conversamos sobre esse plugin no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zabbix Moscow Meetup</a> .  Para quem n√£o gosta de ler, mas gosta de assistir - h√° uma reportagem em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">v√≠deo</a> . <br><br><h2 id="konsolidiruyte-informaciyu-ob-uyazvimostyah">  Consolidar informa√ß√µes de vulnerabilidade </h2><br><p>  O resultado do plug-in no Zabbix √© o seguinte: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/70c/a22/394/70ca22394ca3092373bf8529d0c69025.png" alt="Dashboard"><br>  Este √© um painel no Zabbix.  Na qual, da esquerda para a direita, as seguintes informa√ß√µes s√£o exibidas: </p><br><ul><li>  Distribui√ß√£o da pontua√ß√£o CVSS pelos servidores.  O gr√°fico mostra o relacionamento - quantos servidores possu√≠mos com vulnerabilidades cr√≠ticas, quantas vulnerabilidades n√£o cr√≠ticas possuem ou n√£o possuem vulnerabilidades conhecidas. </li><li>  A pontua√ß√£o m√©dia do CVSS de toda a infraestrutura.  √â exibido na forma de um gr√°fico, o que permite observar a din√¢mica de sua altera√ß√£o. </li><li>  Lista de pacotes vulner√°veis ‚Äã‚Äãcom um √≠ndice do impacto da vulnerabilidade na infraestrutura. </li><li>  Uma lista completa de servidores vulner√°veis ‚Äã‚Äãcom um n√≠vel de amea√ßa para cada um deles. </li><li>  Lista de boletins de seguran√ßa que foram "encontrados" na infraestrutura. </li></ul><br><p>  Abaixo em mais detalhes sobre o mais interessante: </p><br><p>  <strong>Informa√ß√µes sobre servidores vulner√°veis:</strong> </p><br><p><img src="https://habrastorage.org/webt/hb/nm/5m/hbnm5mgchmq1yfj9mxfzkdepwxu.gif" alt="Anfitri√µes"></p><br><p>  O painel exibe uma lista de todos os servidores com um n√≠vel de vulnerabilidade acima do cr√≠tico.  O n√≠vel m√≠nimo aceit√°vel de criticidade, ap√≥s o qual o servidor come√ßa a parecer vulner√°vel, √© especificado nas configura√ß√µes do plug-in. </p><br><p>  As seguintes informa√ß√µes est√£o dispon√≠veis para cada servidor: </p><br><ol><li>  Na verdade, o nome do servidor vulner√°vel. </li><li>  Pontua√ß√£o m√°xima do servidor CVSS.  A pontua√ß√£o mais alta de todas as vulnerabilidades encontradas para este servidor √© exibida. </li><li>  Um comando para eliminar todas as vulnerabilidades detectadas neste servidor.  Depois de concluir qual, obtemos um servidor no qual n√£o existem vulnerabilidades versionadas conhecidas. </li></ol><br><p>  Os dados s√£o apresentados com a classifica√ß√£o CVSS, do m√°ximo ao m√≠nimo.  Isso permite que voc√™ mantenha os servidores que exigem mais aten√ß√£o, sempre no topo da lista, diante de seus olhos. </p><br><p>  <strong>O painel a seguir mostra os pacotes vulner√°veis:</strong> </p><br><p><img src="https://habrastorage.org/webt/0q/75/em/0q75emnx6roeuhvz3ltalvwrbio.gif" alt="Pacotes"></p><br><p>  Aqui para cada pacote vulner√°vel em nossa infraestrutura, temos um breve resumo: </p><br><ol><li>  O nome do pacote vulner√°vel. </li><li>  <em>Vers√£o</em> vulner√°vel <em>do</em> pacote. </li><li>  O n√∫mero de servidores nos quais a vers√£o vulner√°vel do pacote est√° instalada. </li><li>  Pontua√ß√£o do CVSS para esta vers√£o do pacote. </li><li>  √çndice do impacto dessa vulnerabilidade na infraestrutura. </li><li>  Uma lista de todos os servidores nos quais uma vers√£o vulner√°vel do pacote √© detectada. </li><li>  Link para o Boletim de Seguran√ßa.  Permite que voc√™ leia e entenda o qu√£o cr√≠tica √© essa vulnerabilidade em nossa situa√ß√£o. </li><li>  A equipe que corrigiu a vulnerabilidade neste pacote. </li></ol><br><p>  Os dados s√£o apresentados classificados pelo <em>√çndice de Impacto</em> , do m√°ximo ao m√≠nimo. </p><br><p>  <em>√çndice de impacto</em> √© o n√∫mero de servidores afetados multiplicado pela pontua√ß√£o de vulnerabilidade do CVSS.  Muitas vezes acontece que uma vulnerabilidade com uma pontua√ß√£o n√£o t√£o alta √© muito mais difundida na infraestrutura e, portanto, potencialmente mais perigosa. </p><br><h2 id="vybirayte-strategii-ustraneniya-uyazvimostey">  Escolha estrat√©gias de gerenciamento de vulnerabilidades </h2><br><p>  No entanto, voc√™ n√£o pode simplesmente pegar e atualizar todos os pacotes em todos os servidores para a vers√£o mais recente, o que elimina as vulnerabilidades existentes. </p><br><p>  Em qualquer infraestrutura composta por mais de v√°rios servidores, existem muitas restri√ß√µes: a depend√™ncia de um software da vers√£o de outro, os riscos de funcionalidade prejudicada e assim por diante. </p><br><p>  Portanto, sempre h√° uma escolha - quais pacotes podemos atualizar sem problemas.  Quais pacotes requerem um plano de trabalho separado para a implementa√ß√£o de medidas compensat√≥rias.  E pelo que podemos aceitar riscos. </p><br><p>  A abordagem proposta no plug-in permite que voc√™ escolha a estrat√©gia para eliminar vulnerabilidades mais adequadas para voc√™: </p><br><ul><li>  <strong>Uma vulnerabilidade em toda a infraestrutura:</strong> se uma vulnerabilidade espec√≠fica √© cr√≠tica para voc√™, o plug-in fornece informa√ß√µes sobre onde essa vulnerabilidade existe em sua infraestrutura e como ela pode ser corrigida imediatamente em toda a infraestrutura. </li><li>  <strong>Todas as vulnerabilidades em um servidor espec√≠fico:</strong> se voc√™ precisa de um servidor completamente seguro, por exemplo, localizado na DMZ ou atr√°s do per√≠metro da empresa, usando o plug-in, voc√™ obt√©m informa√ß√µes sobre como eliminar todas as vulnerabilidades encontradas nele. </li></ul><br><h2 id="ustranyayte-naydennye-uyazvimosti">  Corrigir vulnerabilidades encontradas </h2><br><p>  Mas n√£o basta saber quais vulnerabilidades temos e determinar como e quais podem ser corrigidas.  Tamb√©m √© necess√°rio fazer isso! </p><br><p>  Sistemas como Puppet ou Ansible s√£o amplamente usados ‚Äã‚Äãpara gerenciamento centralizado de configura√ß√µes e atualiza√ß√µes de software.  Voc√™ pode usar o comando fix que corrige a vulnerabilidade e execut√°-lo centralmente usando esses sistemas. </p><br><p>  Se sua infraestrutura n√£o usa esses sistemas, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zabbix Threat Control</a> permite eliminar vulnerabilidades diretamente da interface da web do Zabbix. </p><br><p><img src="https://habrastorage.org/webt/f5/i7/pj/f5i7pjelugjzoildcxmb-qkttfc.png"></p><br><p>  Para isso, o plugin usa a funcionalidade padr√£o do Zabbix: confirma√ß√£o de eventos e execu√ß√£o de comandos remotos: </p><br><ol><li>  Assim que o problema for confirmado atrav√©s da interface da web por um usu√°rio autorizado; </li><li>  √â iniciado um comando remoto que executa no servidor de destino ou na lista de servidores, um comando de corre√ß√£o que corrige a vulnerabilidade. </li></ol><br><h2 id="kak-eto-rabotaet">  Como isso funciona </h2><br><p><img src="https://habrastorage.org/webt/io/mf/li/iomflipmyk5lxwmn8qbntuswufs.gif"></p><br><ol><li>  O servidor Zabbix recebe informa√ß√µes sobre pacotes e o sistema operacional de todos os servidores na infraestrutura por meio de agentes zabbix. </li><li>  O plug-in (usando a API do Zabbix) recebe um relat√≥rio do SO previamente compilado pelo servidor Zabbix.  O plug-in n√£o recebe nada diretamente dos servidores.  E nesta fase n√£o requer contato direto com eles. </li><li>  Depois de processar as informa√ß√µes recebidas do Zabbix, o plug-in as passa para o Vulners.  Da qual ele recebe uma lista de vulnerabilidades encontradas, sua criticidade e uma maneira de elimin√°-las. </li><li>  O plug-in processa os dados recebidos, os agrega para gerar estat√≠sticas e gera pacotes de dados para transmiss√£o ao Zabbix. </li><li>  O plug-in envia os dados do Zabbix no formato de sistema de monitoramento necess√°rio.  Ele faz isso usando o utilit√°rio zabbix-sender.  Depois disso, voc√™ j√° monitora tudo sobre as vulnerabilidades encontradas, que s√£o exibidas no painel mostrado anteriormente. </li><li>  Depois de confirmar o problema, um comando remoto √© executado, que passa para o plugin: <br><ul><li>  O nome da pessoa que o iniciou </li><li>  Equipe de corre√ß√£o de vulnerabilidade </li><li>  Lista de servidores </li></ul></li><li>  Tendo recebido todo esse Zabbix Threat Control: <br><ul><li>  Verifica se o comando de corre√ß√£o √© iniciado por quem precisa dele.  Daquele que n√£o √© necess√°rio - ele n√£o aceita o comando :) </li><li>  Executa o comando transferido para ele no n√∫mero necess√°rio de servidores. </li></ul></li></ol><br><p> Por padr√£o, o plug-in envia um comando de corre√ß√£o para servidores vulner√°veis ‚Äã‚Äãusando o utilit√°rio zabbix-get, acessando o agente Zabbix no servidor de destino com o par√¢metro <code>nowait</code> .  Este m√©todo de conex√£o permite que o processo de atualiza√ß√£o de pacotes seja executado em segundo plano sem estar vinculado aos processos do agente zabbix.  Tamb√©m √© poss√≠vel executar o comando no servidor de destino por meio de uma conex√£o SSH simples.  A maneira de executar comandos de corre√ß√£o √© selecionada como uma op√ß√£o no arquivo de configura√ß√£o do plug-in. </p><br><p>  E como resultado do trabalho - a aus√™ncia de servidores vulner√°veis, seu bom sono e bom humor :) </p><br><h2 id="ustanovka">  Instala√ß√£o </h2><br><p>  Falamos sobre o que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√©</a> o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Zabbix Threat Control</a> , por que √© necess√°rio e como funciona.  Agora vamos dizer como instalar e configur√°-lo! </p><br><h3 id="zavisimosti">  Depend√™ncias </h3><br><p>  Para funcionar, o plug-in n√£o requer nada sobrenatural.  √â necess√°rio que no <strong>servidor Zabbix</strong> no qual definimos o plano, seja o seguinte: </p><br><ul><li>  <strong>zabbix v3.4</strong> por usar pain√©is personalizados (eles apareceram apenas nesta vers√£o). </li><li>  <strong>O zabbix-sender √©</strong> necess√°rio para enviar dados de vulnerabilidade ao sistema de monitoramento. </li><li>  <strong>O zabbix-get</strong> envia comandos de corre√ß√£o que corrigem vulnerabilidades aos servidores. </li><li>  <strong>python v3</strong> com m√≥dulos: <strong>pyzabbix, jpath, solicita√ß√µes</strong> para executar os principais scripts de plug-in. </li></ul><br><p>  Em todos os <strong>servidores para os quais</strong> √© necess√°ria a <strong>verifica√ß√£o</strong> de vulnerabilidades, apenas: </p><br><ul><li>  <strong>zabbix-agent</strong> para coletar dados e executar scripts. </li><li>  <strong>python v2</strong> para executar o script que coleta o relat√≥rio do SO. </li></ul><br><h3 id="ustanovka-plagina-iz-paketov">  Instalando o plugin a partir de pacotes </h3><br><p>  Para come√ßar, conecte o reposit√≥rio aos pacotes: </p><br><p>  Distribui√ß√µes <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> rpm -Uhv https://repo.vulners.com/redhat/vulners-repo.rpm</code> </pre> <br><p>  Distribui√ß√µes <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> wget https://repo.vulners.com/debian/vulners-repo.deb dpkg -i vulners-repo.deb</code> </pre> <br><p>  Depois disso, no servidor Zabbix, instalamos o pacote principal que fornece toda a l√≥gica do plug-in e o pacote que reporta no sistema operacional: </p><br><p>  Distribui√ß√µes <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  Distribui√ß√µes <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-main zabbix-threat-control-host</code> </pre> <br><p>  E em todos os outros servidores que exigem verifica√ß√£o de vulnerabilidades, instalamos um pacote que gera relat√≥rios do SO: </p><br><p>  Distribui√ß√µes <strong>RPM</strong> </p><br><pre> <code class="bash hljs"> yum install zabbix-threat-control-host</code> </pre> <br><p>  Distribui√ß√µes <strong>DEB</strong> </p><br><pre> <code class="bash hljs"> apt-get update &amp;&amp; apt-get install zabbix-threat-control-host</code> </pre> <br><h3 id="ustanovka-iz-ishodnikov">  Instala√ß√£o da fonte </h3><br><p>  Se voc√™ preferir a instala√ß√£o a partir do c√≥digo-fonte, isso tamb√©m √© muito simples: </p><br><p>  No servidor Zabbix, instalamos os principais scripts que fornecem toda a l√≥gica do plug-in e o script que reporta no sistema operacional: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># main mkdir -p /opt/monitoring/zabbix-threat-control cp zabbix-threat-control/ztc* /opt/monitoring/zabbix-threat-control/ chown -R zabbix:zabbix /opt/monitoring/zabbix-threat-control chmod 640 /opt/monitoring/zabbix-threat-control/ztc_config.py touch /var/log/zabbix-threat-control.log chown zabbix:zabbix /var/log/zabbix-threat-control.log chmod 664 /var/log/zabbix-threat-control.log # host cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><p>  Em todos os outros servidores que exigem verifica√ß√£o de vulnerabilidades, instalamos apenas um script que relata no sistema operacional: </p><br><pre> <code class="bash hljs"> git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/vulnersCom/zabbix-threat-control.git <span class="hljs-comment"><span class="hljs-comment"># host mkdir -p /opt/monitoring/ cp -R zabbix-threat-control/os-report /opt/monitoring/ chown -R zabbix:zabbix /opt/monitoring/os-report</span></span></code> </pre> <br><h2 id="nastroyka">  Personaliza√ß√£o </h2><br><p>  Ap√≥s a instala√ß√£o, voc√™ deve configurar o plug-in e preparar um sistema de monitoramento para sua opera√ß√£o.  A seguir, √© apresentada uma descri√ß√£o passo a passo de todas as a√ß√µes necess√°rias. </p><br><h3 id="nastraivaem-servera-trebuyuschie-skanirovaniya">  Configurando servidores que requerem varredura </h3><br><p>  Voc√™ deve habilitar o agente Zabbix para executar comandos remotos.  Para fazer isso, em todos os servidores para os quais a verifica√ß√£o √© necess√°ria, altere os par√¢metros no arquivo de configura√ß√£o do zabbix-agent, conforme mostrado abaixo: </p><br><pre> <code class="hljs">EnableRemoteCommands=1 LogRemoteCommands=1</code> </pre> <br><p>  O arquivo de configura√ß√£o do agente zabbix geralmente est√° localizado aqui: <code>/etc/zabbix/zabbix_agentd.conf</code> </p><br><p>  Se voc√™ deseja usar a funcionalidade para eliminar vulnerabilidades encontradas usando o <em>Zabbix Threat Control</em> , √© necess√°rio permitir que o usu√°rio do zabbix <strong>atualize os</strong> pacotes (mas n√£o os instale ou desinstale). </p><br>  Para fazer isso, adicione a seguinte linha ao arquivo <code>/etc/sudoers</code> : <br><p>  Para distribui√ß√µes <strong>RPM</strong> , a linha √© assim: </p><br><pre> <code class="hljs pgsql">zabbix <span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>=(<span class="hljs-keyword"><span class="hljs-keyword">ALL</span></span>) NOPASSWD: /usr/bin/yum -y <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> *</code> </pre> <br><p>  Para distribui√ß√µes <strong>DEB</strong> um pouco diferente: </p><br><pre> <code class="hljs powershell">zabbix ALL=(ALL) NOPASSWD: /usr/bin/apt<span class="hljs-literal"><span class="hljs-literal">-get</span></span> -<span class="hljs-literal"><span class="hljs-literal">-assume</span></span><span class="hljs-literal"><span class="hljs-literal">-yes</span></span> install -<span class="hljs-literal"><span class="hljs-literal">-only</span></span><span class="hljs-literal"><span class="hljs-literal">-upgrade</span></span> *</code> </pre> <br><h3 id="podklyuchaemsya-k-vulners">  Conectar-se a Vulners </h3><br><p>  Para usar a API Vulners, voc√™ precisa de uma chave API.  Para obt√™-lo: </p><br><ul><li>  Inscreva-se no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">vulners.com</a> </li><li>  Na sua conta, v√° para a guia API KEYS </li><li>  Selecione "Scan" na √°rea Scope e pressione "GENERATE NEW KEY". </li></ul><br><p>  Voc√™ receber√° uma chave API semelhante a esta: RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K9269B0K86K6XQQQR32O6007NUK </p><br><p><img src="https://habrastorage.org/webt/bu/r1/_8/bur1_85domk9m6gkzoaxsghzoqa.png"></p><br><p>  Agora voc√™ precisa adicionar a chave API do Vulners ao arquivo de configura√ß√£o do plugin <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><p>  Um exemplo: </p><br><pre> <code class="hljs 1c">vuln_api_key = 'RGB9YPJG7CFAXP35PMDVYFFJPGZ9ZIRO1VGO9K<span class="hljs-number"><span class="hljs-number">9269</span></span>B0K86K6XQQQR32O<span class="hljs-number"><span class="hljs-number">6007</span></span>NUK'</code> </pre> <br><h3 id="podklyuchaemsya-k-zabbix">  Conecte-se ao Zabbix </h3><br><p>  Para que o plug-in possa conectar-se ao Zabbix, voc√™ precisa especificar os seguintes dados no arquivo de configura√ß√£o: <code>/opt/monitoring/zabbix-threat-control/ztc_config.py</code> </p><br><ul><li>  Endere√ßo da interface web do Zabbix para trabalhar com o Zabbix-API; </li><li>  nome de usu√°rio e senha sob os quais nos conectaremos √† API do Zabbix. </li></ul><br>  Nome de dom√≠nio e porta do servidor Zabbix para enviar dados usando o utilit√°rio zabbix-sender. <br><br><p>  Um exemplo: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">zbx_pass</span></span> = <span class="hljs-string"><span class="hljs-string">'yourpassword'</span></span> zbx_user = <span class="hljs-string"><span class="hljs-string">'yourlogin'</span></span> zbx_url = <span class="hljs-string"><span class="hljs-string">'https://zabbixfront.yourdomain.com'</span></span> zbx_server_fqdn = <span class="hljs-string"><span class="hljs-string">'zabbixserver.yourdomain.com'</span></span> zbx_server_port = <span class="hljs-string"><span class="hljs-string">'10051'</span></span></code> </pre> <br><h3 id="podgotavlivaem-zabbix">  Preparando o Zabbix </h3><br><p>  Voc√™ deve criar objetos no Zabbix que forne√ßam o plug-in.  Para fazer isso, execute o script <code>/opt/monitoring/zabbix-threat-control/ztc_create.py</code> .  O script verificar√° se o plug-in est√° configurado corretamente e, usando a API, ele ser√° criado no Zabbix: </p><br><ol><li>  <strong>Grupo</strong> de hosts ao qual os hosts que exibem vulnerabilidades s√£o adicionados. </li><li>  <strong>O modelo</strong> pelo qual o relat√≥rio do sistema operacional √© coletado de todos os servidores. </li><li>  <strong>Hosts</strong> para exibir vulnerabilidades por pacotes, servidores, boletins e estat√≠sticas gerais. </li><li>  <strong>Uma a√ß√£o</strong> para executar comandos de corre√ß√£o de vulnerabilidade remota. </li><li>  <strong>Painel</strong> para f√°cil exibi√ß√£o de todas essas informa√ß√µes. </li></ol><br><p><img src="https://habrastorage.org/webt/mh/p1/qe/mhp1qeyu_r-c-zvxhtrthl0bzyg.gif"></p><br><p>  Ap√≥s criar todos os objetos no Zabbix, o script mostrar√°: </p><br><ul><li>  Link para o painel criado no Zabbix, no qual as vulnerabilidades ser√£o exibidas. </li><li>  A hora em que a verifica√ß√£o da infraestrutura em busca de vulnerabilidades ser√° iniciada. </li></ul><br><p>  Ap√≥s a cria√ß√£o de todos os objetos necess√°rios no Zabbix, voc√™ precisa acessar a interface da Web do Zabbix e vincular o modelo "Relat√≥rio de SO do Vulner" rec√©m criado pelo script a todos os servidores que exigem verifica√ß√£o de vulnerabilidades. </p><br><p><img src="https://habrastorage.org/webt/0h/px/im/0hpxim3eoxm9zxk-_isvvvkpycu.png"></p><br><p>  Depois disso, resta aguardar o in√≠cio do plug-in no hor√°rio especificado durante a instala√ß√£o. </p><br><h2 id="skaniruem">  Scan! </h2><br><p>  O principal script de processamento de dados ( <code>ztc.py</code> ) √© <code>ztc.py</code> automaticamente, uma vez por dia, atrav√©s do "Item de Servi√ßo ..." no host "Vulner - Statistics" no hor√°rio especificado pelo script. </p><br><p>  Voc√™ pode alterar a hora de in√≠cio do plug-in para qualquer conveniente, alterando o "Intervalo de agendamento" neste elemento de dados.  Nesse caso, tamb√©m √© necess√°rio ajustar o tempo de coleta das estat√≠sticas nos tr√™s elementos de dados do modelo "Vulner OS-Report" - as m√©tricas no modelo devem funcionar 10 a 15 minutos antes da principal m√©trica "Item de servi√ßo ..." no host "Vulner - Statistics". </p><br><p>  O tempo durante o qual todos os dados de vulnerabilidade ser√£o processados ‚Äã‚Äãdepende do n√∫mero de servidores na infraestrutura e do n√∫mero de pacotes instalados neles.  Aproximadamente 30 minutos s√£o gastos no processamento de mil servidores. </p><br><h1 id="plany">  Planos </h1><br><p>  Esta √© apenas a primeira vers√£o do plugin Zabbix Threat Control.  E continuamos a desenvolv√™-lo. </p><br>  Os planos: <br><br><ul><li>  Adicione informa√ß√µes nos pain√©is encontrados na infraestrutura do CVE. </li><li>  Recuse instalar quaisquer scripts nos agentes e coletar todas as informa√ß√µes necess√°rias sobre o SO e os pacotes usando as chaves do elemento de dados incorporadas ao agente Zabbix. </li></ul><br><p>  E como √© de c√≥digo aberto - junte-se a n√≥s!  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Solicita√ß√µes pull bem-vindas :)</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt416137/">https://habr.com/ru/post/pt416137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt416127/index.html">CUDA e GPU remota</a></li>
<li><a href="../pt416129/index.html">Como a IA aprende a gerar imagens de gatos</a></li>
<li><a href="../pt416131/index.html">Como lidar com a DP na Federa√ß√£o Russa e n√£o violar a lei</a></li>
<li><a href="../pt416133/index.html">Data Center no exterior: Equinix LD8</a></li>
<li><a href="../pt416135/index.html">Aplicativo GUI menor que 1 kb</a></li>
<li><a href="../pt416139/index.html">Autentica√ß√£o forte como parte da estrat√©gia GDPR</a></li>
<li><a href="../pt416143/index.html">O livro "Uma aut√≥psia ser√° exibida!" An√°lise pr√°tica de malware ¬ª</a></li>
<li><a href="../pt416147/index.html">Organiza√ß√£o da navega√ß√£o em aplicativos iOS usando o Controlador Raiz</a></li>
<li><a href="../pt416149/index.html">Perguntas e respostas sobre energia renov√°vel, parte 1</a></li>
<li><a href="../pt416151/index.html">Bal√£o sem dimens√£o. An√°lise utilit√°ria de dimens√£o m√°gica</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>