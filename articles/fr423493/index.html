<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöï üóÉÔ∏è üéì Android Go est le futur milliard d'appareils et une limite de 50 Mo. Conf√©rence Yandex üéÜ üë©üèæ‚Äçüöí ‚õ≥Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De nouvelles directions pour le d√©veloppement d'une plateforme d√©j√† famili√®re - c'est toujours int√©ressant. D'une part, vous √©largissez la client√®le, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Android Go est le futur milliard d'appareils et une limite de 50 Mo. Conf√©rence Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/423493/">  De nouvelles directions pour le d√©veloppement d'une plateforme d√©j√† famili√®re - c'est toujours int√©ressant.  D'une part, vous √©largissez la client√®le, d'autre part, vous n'investissez pas dans la cr√©ation de logiciels √† partir de z√©ro, mais en utilisant les d√©veloppements existants.  Mais si la direction est vraiment nouvelle, avec ses sp√©cificit√©s, alors il ne sera pas possible de g√©rer avec tr√®s peu de sang.  Lors de la prochaine r√©union de la communaut√© Mosdroid dans notre bureau, le d√©veloppeur Arthur Vasilov <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" class="user_link">Arturka a</a> parl√© de l'adaptation de l'application Yandex au syst√®me Android Go. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/VYcLRPoA4Bk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><blockquote>  En moyenne, si vous n'√©crivez pas de calculatrice, de r√©veil, etc., alors soit vous √™tes tr√®s cool, bien fait et avez tout bien fait, soit votre application prend 150-170 m√©gaoctets. </blockquote><br><a name="habracut"></a>  - Je m'appelle Arthur, je suis d√©veloppeur Android, je travaille sur l'application Yandex.  Aujourd'hui, je vais partager avec vous une histoire sur la fa√ßon dont nous nous sommes adapt√©s √† Android Go.  Je vais vous dire sur quel type de r√¢teau nous sommes tomb√©s, ce qui n'a pas fonctionn√© pour nous et comment tout cela fonctionne, pourquoi il est n√©cessaire. <br><br>  Une petite digression sur ce dont il s'agit.  Android Go est une version sp√©ciale d'Android con√ßue pour les appareils √† bas prix.  Ils co√ªtent de 60 √† 100 dollars et sont donc tr√®s faibles, lents, ralentis.  Google a donc d√©cid√© pour eux de cr√©er leur propre syst√®me afin qu'ils fonctionnent au moins normalement.  Il a √©t√© annonc√© sur Google I / O en 2017, soit un an et plusieurs mois se sont √©coul√©s.  Par cons√©quent, lorsque le mitap a √©t√© annonc√©, une question logique a √©t√© soulev√©e: "√ätes-vous toujours en vie, ou quoi?"  J'ai alors dit que tout va bien, tout va bien, je vais le dire.  Et maintenant, en tant que h√©ros Internet typique, je r√©pondrai a posteriori pourquoi cela s'est produit. <br><br><img src="https://habrastorage.org/webt/h2/qw/6g/h2qw6gttth_hx-niydwklvvcb8u.jpeg"><br>  Que s'est-il pass√© exactement?  Google a d√©clar√©: "Nous cr√©ons un tel syst√®me."  Puis il a dit: "D'accord, nous avons besoin de temps pour finaliser" et tout √ßa.  Apr√®s cela, les fournisseurs ont toujours un certain retard dans l'adaptation de cette version pour eux-m√™mes.  Et la nouvelle version avec nous est d√©j√† sortie au plus t√¥t un an plus tard, il n'y a donc rien de surprenant ici.  De plus, ils devaient d√©cider de faire une telle chose: ils parlent d'appareils bon march√© et il n'est pas clair s'ils en profiteront ou non.  De plus, cet appareil doit √™tre neuf, il faut le faire, apprendre √† vendre, comprendre comment il fonctionnera. <br><br>  Le premier smartphone avec Android Go est apparu il n'y a pas si longtemps.  Quelque part en avril, les ventes ont probablement commenc√©, ou peut-√™tre en mai.  C'est Nokia 1, il est vendu partout.  Je tra√Æne ici.  Maintenant, √† mon avis, il n'y a que neuf de ces smartphones sur le march√©, mais √† la fin de l'ann√©e, ils promettent plus d'une centaine.  Et en principe, aucun des principaux acteurs tels que Huawei, Samsung et d'autres n'ont dit leur mot, alors ils ajouteront autre chose, ils ne pourront pas rester √† l'√©cart d'un march√© aussi important. <br><br>  Avant le rapport, je suis all√© sur la page Android Go et j'ai vu qu'ils faisaient l'√©dition Android Pie Go.  Mais ils n'y ont rien fait, ils ont simplement r√©duit √† l'avance le nombre d'applications install√©es et leur poids.  Ils ont dit: - "Vous avez maintenant deux fois plus d'espace libre."  Et les excuses standard: correction de bugs, am√©lioration des performances, tout.  Mais au moins, ils ont appel√©, ce qui signifie qu'ils n'ont pas oubli√©. <br><br>  Quelles sont les limites de ces appareils, en particulier?  Premi√®rement, ils ont 512 m√©gaoctets ou 1 gigaoctet de RAM, 8 ou 16 gigaoctets de stockage.  Il est clair que dans de telles conditions, ils sont extr√™mement inhib√©s et toutes les applications normales sur eux fonctionneront approximativement de la m√™me mani√®re.  Pour que les applications fonctionnent avec une ad√©quation minimale, Google a d√©clar√©: ¬´Introduisons les exigences suivantes.¬ª  Ils sont assez logiques, d√©coulent de ce qui √©tait sur la diapositive pr√©c√©dente. <br><br><img src="https://habrastorage.org/webt/ci/xm/ht/cixmhtwrdwbu_gkczbo0vk3-k8e.jpeg"><br><br>  Tout d'abord, c'est une bonne performance abstraite.  Votre application doit fonctionner correctement et rapidement sur un tel appareil.  Nous sommes: ¬´G√©nial.  Nous travaillons. " <br><br>  De plus, il existe d√©j√† des num√©ros sp√©cifiques auxquels nous devons correspondre.  L'espace occup√© apr√®s le d√©ballage et l'installation de l'APK ne d√©passe pas 40 m√©gaoctets.  Parfois, c'est un probl√®me car quelqu'un et l'APK p√®sent tous les 80 m√©gaoctets.  √áa va faire mal.  De plus, cela ne peut pas √™tre correctement pris et mesur√©.  Autrement dit, vous ne pouvez pas dire: "Je sais que mon APK p√®se tellement, donc apr√®s l'installation, l'application prendra tellement."  Tout cela d√©pend beaucoup du fournisseur, de la version de l'appareil, d'Android, etc. Mais si votre APK prend 10 m√©gaoctets, alors, en principe, tout va bien et vous ne d√©passerez jamais ce nombre. <br><br>  Et maintenant, l'exigence la plus amusante et la plus cool: la RAM consomm√©e lors du travail avec l'application ne doit pas d√©passer 50 m√©gaoctets. <br><br>  Qui sait combien de RAM sa demande prend en moyenne pendant le fonctionnement?  Qui s'est jamais interrog√© sur cette question?  Y a-t-il quelqu'un avec moins de 100 m√©gaoctets?  Beau.  Mais peut-√™tre que vous mentez.  En g√©n√©ral, en moyenne, si vous n'√©crivez pas de calculatrice, de r√©veil et ainsi de suite, alors soit vous √™tes tr√®s cool, bien fait et vous avez tout bien fait, soit votre application prend 150-170 m√©gaoctets.  Le mettre dans 50 m√©gaoctets est tr√®s difficile.  Par cons√©quent, le reste du temps, nous en parlerons, nous discuterons de la fa√ßon de mettre le globe en hibou, etc. <br><br><img src="https://habrastorage.org/webt/6k/el/g1/6kelg1qxjmzqgltficsia2dk1p0.jpeg"><br>  Que comprend notre conversation sur la m√©moire?  Il est directement n√©cessaire de comprendre ce que nous mesurons exactement, puis quelle est la meilleure fa√ßon de le mesurer.  Aussi pour les appareils Android Go, il y a une sp√©cificit√© qui doit √™tre prise en compte, et nous en parlerons √©galement.  Et je vais √©galement vous dire des choses g√©n√©rales, des conseils g√©n√©raux que vous n'auriez peut-√™tre pas devin√©s, mais ils peuvent vraiment vous manger beaucoup de m√©moire. <br><br>  En 2018, apr√®s le passage des E / S Google, vous devez commencer l'histoire de la m√©moire en faisant r√©f√©rence √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ce rapport</a> .  Qui l'a regard√©? <br><br>  Super.  Les 180 personnes restantes savent quoi faire dans un avenir proche.  √Ä mon avis, c'est l'un des meilleurs rapports sur Google I / O.  Mec a dit des choses incroyablement cool.  Il a tout racont√© sur les √©tag√®res, enfin, et avec beaucoup de d√©tails profonds.  Ceux qui l'ont regard√© et qui s'en souviennent bien remarqueront probablement que j'ai copi√© certaines choses √† partir de l√†, car c'est impossible autrement, il a tout dit, alors je vais le r√©p√©ter. <br><br>  Que mesurons-nous?  Il y avait une telle chose appel√©e PSS (Proportional Set Size).  Autrement dit, la RAM dans Android est repr√©sent√©e par environ 40 blocs de kilo-octets, et ces blocs peuvent appartenir enti√®rement √† l'application ou fouiller entre les processus et les applications. <br><br>  Et la question est: comment comprendre exactement √† quelle application relier cette m√©moire partag√©e?  Il existe plusieurs approches, elles sont assez logiques.  PSS dit que si la m√©moire tente entre N processus, nous supposerons que votre application poss√®de 1 / N de cette m√©moire.  Et exactement de la m√™me mani√®re, il y a la taille de l'ensemble r√©sidentiel et la taille de l'ensemble unique, qui disent que ¬´Aucune de la m√©moire partag√©e ne m'appartient¬ª et ¬´Tout appartient¬ª.  En principe, PSS est le plus logique ici. <br><br>  Comment pouvez-vous mesurer exactement la m√©moire consomm√©e?  Ici, tout est simple.  Soit c'est un profileur dans Android Studio, soit c'est dumpsys.  Il existe bien s√ªr d'autres outils.  Ils peuvent vous donner des r√©sultats plus d√©taill√©s, quelque chose de plus compliqu√©, mais le probl√®me est que pour comprendre leurs r√©sultats, les utiliser tout cela est tr√®s, tr√®s difficile.  Souvent, vous avez besoin de root ou d'une version personnalis√©e d'Android.  Et en gros vous n'en avez pas besoin, les deux premiers outils suffisent. <br><br><img src="https://habrastorage.org/webt/0r/--/pr/0r--prgyak0-hltivshg-dxeuqc.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Je ne parlerai pas du profileur dans Android Studio, je pense que beaucoup de gens l'ont utilis√©.  Qui n'a pas utilis√©, assurez-vous de pousser.  En particulier, j'ai fourni le lien ci-dessous - juste un bon article de la documentation avec vid√©o, comment l'utiliser, avec des d√©mos.  Et, en principe, tout est clair.  Il montre o√π va votre m√©moire, le montre en temps r√©el.  La seule chose √† retenir est qu'elle impose n√©anmoins certaines erreurs qui d√©coulent du fait que nous mesurons constamment cette m√©moire.  Mais ils sont dans des limites acceptables. <br><br><img src="https://habrastorage.org/webt/gb/fv/wn/gbfvwnjxm6fcggr66eoyzmcvnni.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Dumpsys est une console simple qui ne n√©cessite rien de vous, juste un t√©l√©phone connect√© et un adb.  Et vous pouvez ex√©cuter cette commande: appelez dumpsys meminfo, passez-lui le paquet et il vous renverra quelque chose comme √ßa.  Et si nous sommes int√©ress√©s par la consommation de notre application, nous pouvons examiner sp√©cifiquement TOTAL, qui indique que "votre application consomme environ 168 m√©gaoctets".  Beaucoup, mais que faire? <br><br><img src="https://habrastorage.org/webt/lm/yo/xw/lmyoxwiahsbeey_ru-3zvdtd8y0.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Il vous montre √©galement une ventilation exacte de la quantit√© de m√©moire n√©cessaire dans cette m√©moire consomm√©e.  Il y a diff√©rentes sections ici, elles sont complexes, nous en parlerons plus loin, mais pour l'instant nous pouvons remarquer l'essentiel - ce sont Java Heap, nos objets Java, et tout est plus compliqu√©. <br><br>  Quoi d'autre est important?  La m√©moire est une chose tr√®s sensible √† toutes sortes de tests et √† toutes sortes de conditions externes.  Autrement dit, tous les tests que vous devez effectuer autant que possible dans les m√™mes conditions.  Il est clair que cela devrait id√©alement √™tre un seul appareil, car la m√©moire d√©pend de la version d'Android.  Il suffit de rappeler les diff√©rences entre les quatre et les cinq.  Cela d√©pend de la taille ou de la r√©solution de l'√©cran, car plus la taille de l'√©cran est grande, plus le contenu s'introduit, plus vous avez besoin de m√©moire pour tout dessiner.  Plus la r√©solution est √©lev√©e, plus votre bitmap occupe de pixels et plus de m√©moire est n√©cessaire pour les stocker. <br><br>  Le sc√©nario d'application affecte √©galement les tests.  Vous pouvez lire le texte ou faire d√©filer la galerie avec un tas d'images.  Et il est clair o√π il y aura plus de m√©moire. <br><br>  Une autre chose importante est la charge sur l'appareil.  Autrement dit, vous pouvez tout avoir de la m√™me fa√ßon, mais dans un cas, votre application est la seule qui fonctionne pour vous, et dans l'autre cas, vous avez un tas d'applications qui font quelque chose en arri√®re-plan, t√©l√©chargent quelque chose, le suppriment, travaillent au premier plan , et en m√™me temps, votre m√©moire est simplement √©puis√©e, car vous devez la donner √† d'autres applications.  Par cons√©quent, id√©alement, il est pr√©f√©rable de prendre et de tuer d'abord toutes les autres applications qui fonctionnent, pas la v√¥tre.  Tout ce que vous pouvez atteindre, puis tuer.  Juste dans ce cas, et PSS vous remerciera certainement, car il ne sera pas n√©cessaire de t√¢tonner la m√©moire entre les processus. <br><br><img src="https://habrastorage.org/webt/lm/yo/xw/lmyoxwiahsbeey_ru-3zvdtd8y0.jpeg"><br>  Vous pouvez, par exemple, prendre et voir les informations actuelles sur la m√©moire libre, sur la m√©moire occup√©e.  Il vous apportera quelque chose comme un signe qui dit: ¬´Ici, j'ai tellement de m√©moire libre, tellement de m√©moire en cache, tellement de m√©moire occup√©e.¬ª  Et si vous avez 200 √† 250 m√©gaoctets de m√©moire libre pour votre bien-aim√© l√†-bas, alors c'est bien, tr√®s probablement, alors rien n'affectera vos tests. <br><br>  Peut-√™tre que quelqu'un a maintenant la question "Pourquoi ai-je besoin de tout cela?"  C'est un tel casse-t√™te dans lequel je dirai en outre la motivation de tout cela. <br><br>  Premi√®rement, m√™me si vous ne faites rien sous Android Go maintenant et pensez qu'il est mort, il pourrait bien se d√©velopper, venir √† vous, et √† un moment donn√©, vous devrez faire face √† tout cela. <br><br>  La deuxi√®me chose que je consid√®re tr√®s importante est que vous pouvez simplement faire des tests de r√©gression √† partir de la m√©moire.  Autrement dit, vous pouvez simplement √©crire un script qui ex√©cutera l'application, fera des vidages, prendra de telles mesures et observera comment ces indicateurs changent entre les versions.  Un tel script peut √™tre √©crit en quelques heures, l'infrastructure peut √™tre configur√©e plus longtemps, mais il me semble que c'est une bonne chose. <br><br>  Si nous parlons des sp√©cificit√©s d'Android Go - notre troisi√®me point dans la lutte contre la m√©moire - alors il y a de bonnes nouvelles.  Tout d'abord, personne ne vous oblige vraiment √† respecter ces restrictions.  Autrement dit, vous pouvez utiliser l'application telle quelle, la mettre sur l'appareil avec Android Go, et tout va bien.  Le probl√®me est que l'utilisateur est tr√®s susceptible de vous retirer car vous prenez beaucoup de place.  Votre application peut √©galement s'ex√©cuter lentement et avoir beaucoup de m√©moire, oui.  Mais jusqu'√† pr√©sent, personne ne l'a interdit, car sinon il n'y aurait eu aucune application autre que les applications Google sur Android Go.  Mais si cette chose se d√©veloppe, beaucoup s'adapteront √† de telles conditions, puis, au final, votre application peut simplement √™tre r√©duite dans l'√©mission Android Go, ou dire comment l'utilisateur installe l'application sur son smartphone Android Go, ils peuvent lui montrer Alert : "Mec, l'application ne fonctionne pas bien avec Android Go.  Peut-√™tre que vous ne le mettrez pas? " <br><br>  Il y a un autre point - vous pouvez exclure manuellement les appareils Android Go de Google Play, c'est-√†-dire que l'application ne peut pas √™tre install√©e sur les appareils Android Go.  Il est apparu il n'y a pas si longtemps. <br><br>  Et Google est √©galement assez intelligent, et les 50 m√©gaoctets qui sonnaient dans le titre du rapport ne sont pas un nombre fixe, cela d√©pend de la r√©solution de l'appareil, de la taille de l'√©cran et, en outre, du type d'application.  Par exemple, les jeux sont allou√©s plus, √† mon avis, 115 m√©gaoctets.  En principe, cela est compr√©hensible. <br><br><img src="https://habrastorage.org/webt/gu/yj/0s/guyj0sbre79wfwrlzgupt009xn0.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Lien depuis la diapositive</a></sup></sub> </h5><br>  Et si nous parlons directement de ce test?  Il y a un autre point, qui nous pr√©occupe beaucoup en particulier: travailler avec des pr√©r√©glages.  Lorsque les fournisseurs fabriquent un nouveau t√©l√©phone, ils y mettent souvent un ensemble d'applications pr√©install√©es.  En particulier, nous y sommes tr√®s impliqu√©s, et le probl√®me est qu'ils y ex√©cutent des choses comme Compatibility Test Suite.  Ce sont des tests google, ils les ex√©cutent.  Et l√†, si votre application ne correspond pas √† ces 50 m√©gaoctets, alors tout est mauvais, et votre application ne peut pas √™tre pr√©install√©e sur un tel appareil. <br><br>  Malheureusement, les tests que Google fait ne sont pas open source, je ne peux pas leur dire, ils sont sous le NDA, mais de bons d√©veloppeurs de Google ont √©crit un tel article sur Android Go, et l√†, en principe, il y a des recommandations qui sont assez bonnes <br><br>  Autrement dit, tout est banal.  Nous lan√ßons l'application.  Nous attendons 5 secondes pour que tout se charge.  Nous faisons dumpsys, √©crivons la valeur TOTALE, ex√©cutons un tas de fois, nous obtenons le r√©sultat.  Tout est tr√®s simple et banal. <br><br><img src="https://habrastorage.org/webt/zq/ma/de/zqmadexusg3whja0-dsz0d4w7gk.jpeg"><br>  La seule chose est qu'ils n'ont pas pris en compte une si petite fonctionnalit√© dans leur article, ou, peut-√™tre, n'en ont pas parl√© - il existe une chose telle que travailler dans un autre processus, et ils le font souvent afin de lutter contre la consommation de m√©moire. <br><br>  Qui pense que c'est bon pour Android Go?  Et qui pense que c'est mauvais?  Bravement. <br><br><img src="https://habrastorage.org/webt/_c/4p/h5/_c4ph5f7gcnhakefypwspum8d_y.jpeg"><br>  Le probl√®me est que, oui, c'est mauvais, car au final, la m√©moire de votre application consomm√©e est compt√©e dans tous les processus.  Si nous faisons un tel processus vide sans rien et prenons des vidages de ce processus particulier, nous verrons qu'il faut 7 m√©gaoctets.  5-8 m√©gaoctets - c'est une telle surcharge de la cr√©ation du processus.  Par cons√©quent, lorsque nous nous battons pour que chaque m√©gaoctet comprenne tout en 50, une telle chose nous est tr√®s mal donn√©e.  En particulier, supposons que Yandex poss√®de la biblioth√®que Yandex.Metrica la plus populaire, elle fonctionne √©galement dans un processus diff√©rent, ce qui peut √©galement nous faire mal. <br><br><img src="https://habrastorage.org/webt/qu/os/fu/quosfu3kccdztjv7cp6ujn4rxhg.jpeg"><br>  Par cons√©quent, si certaines biblioth√®ques externes viennent √† vous, par exemple, vous pouvez simplement dire: ¬´Mec, veuillez travailler dans le processus principal.  Je suis d'accord que cela peut √™tre plus lent, mais cela ne consommera pas de m√©moire inutile. ¬ª  C'est donc aussi un point subtil. <br><br><img src="https://habrastorage.org/webt/ci/6b/9c/ci6b9cbpebgounzlbc87xids-xi.jpeg"><br><br>  Si nous parlons de consommation de m√©moire, passons √† cette plaque, qui est l√†.  Nous prenons un projet vide, et ex√©cutons ce dumpsys, d√©marrons cette entreprise, et nous voyons que 23 m√©gaoctets de 50 sont d√©j√† pris.  Vide "Bonjour, monde!"  sans rien, il suffit d'activer avec le texte.  √áa devient assez triste.  Il devient encore plus triste de constater que nous pouvons influencer directement un param√®tre tel que Java Heap, c'est-√†-dire que ce sont directement nos objets Java que nous pouvons suivre explicitement, que nous pouvons supprimer, r√©duire et au moins interagir d'une mani√®re ou d'une autre. <br><br>  Et il est difficile d'interagir normalement avec tout cela, car il s'agit de tout code cadre et directement √† partir de Java, vous n'avez tout simplement pas d'outils normaux pour comprendre comment tout cela est utilis√©.  Mais la bonne nouvelle est que nous pouvons influencer tout cela indirectement, alors parlons de ce qui existe. <br><br><img src="https://habrastorage.org/webt/pa/p_/qp/pap_qprhxuqhr59pnjx8kxrqwos.jpeg"><br>  Qu'est-ce que Java Heap est compr√©hensible.  Ce qui est Native Heap est √©galement assez logique √† assumer.  Ce sont les m√™mes allocations, seulement positives.  Ils proviennent du framework et de vos biblioth√®ques natives, des fichiers .so, etc. <br><br>  Le code est directement li√© au stockage de code.  C'est la taille de votre .dex, c'est votre .so, ce sont les ressources, les fichiers mmap et tout √ßa.  Autrement dit, moins il y a de code, mieux c'est.  La v√©rit√© la plus simple qui fonctionne en g√©n√©ral sur tout. <br><br>  Stack est une pile de threads Java / C ++.  C'est-√†-dire que chaque thread a sa propre pile d'appels, donc chaque thread cr√©e une zone de m√©moire sp√©cifique pour stocker tout cela. <br><br>  Les graphiques sont un rendu d'interface utilisateur.  Il y a des bitmaps partiellement stock√©s qui sont dessin√©s et ce qui y est li√©. <br><br>  Autre priv√©, Syst√®me - c'est quelque chose que nous ne pouvons pas influencer du tout, et, en fait, tout le reste qui n'est pas tr√®s cat√©gorisable. <br><br><img src="https://habrastorage.org/webt/ut/mv/ft/utmvfteatf-vvzdda5_a8f-iyvi.jpeg"><br><br>  Si nous parlons de biblioth√®ques natives, alors, disons que vous pouvez prendre une application vide ... vous pouvez prendre l'application habituelle que nous avons et en prendre des dumpsys, voir que cela prend 146 m√©gaoctets.  Et si vous allez couper quelque chose ... en particulier, j'ai pris et sci√© les deux plus grandes biblioth√®ques natives, dont nous avons un total de 15 m√©gaoctets, et prenez dumpsys apr√®s cela, vous pouvez facilement voir que nous avons perdu la consommation du tas natif et du code.  Autrement dit, avec un geste si simple, nous nous sommes √©conomis√©s environ 35 m√©gaoctets.  Pas assez mal. <br><br><img src="https://habrastorage.org/webt/zn/9r/9v/zn9r9v35dja5ndfyz4nwinzshys.jpeg"><br><br>  Streams.  Faisons le test le plus simple.  Il y a une application vide, et il y a la m√™me application vide, o√π nous prenons et faisons une boucle qui fera le nouveau Thread (), dormira dedans pendant cinq secondes et d√©marrera ce thread.  Vous pouvez voir que dans ce cas, la pile est consid√©rablement reconstitu√©e.  Autrement dit, nous pouvons influencer tout cela, mais indirectement, en r√©duisant le nombre de threads dans le code Java.  Autrement dit, gr√¢ce √† des objets Java, y compris influencer tous ces emplacements qui se trouvent dans d'autres √©l√©ments. <br><br><img src="https://habrastorage.org/webt/4i/ed/mo/4iedmo77bys7vs6hv-f65oiuta0.jpeg"><br><br>  Si vous continuez √† parler des threads, vous pouvez facilement voir ce que vous avez pour les threads, ce qu'ils font dans l'application.  Il existe diff√©rents outils.  Vous pouvez utiliser le m√™me systrace, vous pouvez simplement utiliser la console pour trouver l'id de votre processus et saisir ps par quels threads se trouvent dans le syst√®me. <br><br>  Si vous vous d√©brouillez bien et utilisez toutes sortes de ThreadFactory pour nommer vos threads, alors vous pouvez comprendre ce que vous devriez avoir, ce qui ne devrait pas l'√™tre, et ainsi r√©duire le tout, car avoir 100 threads dans l'application n'a pas de sens. <br><br>  Que peut-on faire d'autre?  Il existe un ensemble bien connu de conseils sur l'accord√©on: surveillez les fuites, utilisez des pools, ne cr√©ez pas d'objets lorsque vous n'en avez pas besoin, et toutes ces b√™tises, tout cela s'applique.  Super. <br><br>  Il existe une bonne corr√©lation entre la quantit√© de m√©moire utilis√©e par votre application et sa taille.  Autrement dit, plus votre application est grande, plus elle consommera de m√©moire, donc, d'une mani√®re simple, r√©duisez le poids de l'APK, r√©duisez le poids de .dex, r√©duisez .so, supprimez tout ce qui peut √™tre supprim√©. <br><br>       . ,      ,     ,    .      ,     ?   ‚Äî         ‚Äî    ,      .   ,     ,        .       .   ‚Äî   . <br><br><img src="https://habrastorage.org/webt/3s/mv/wk/3smvwkzryvrsm1klctrsmnxtx4i.jpeg"><br>    dumpsys,   ,      ,    . ,   ,   View,  WebView,  Assets,    . <br><br><img src="https://habrastorage.org/webt/yd/m_/92/ydm_92wzagxi-1a9zpwzkeqbe8o.jpeg"><br>  ,      , , ,     ,    SharedPreference  SQLite  - , , ,   . <br><br><img src="https://habrastorage.org/webt/1f/fs/ct/1ffsctcvhhohxpwiysekmopqwzk.jpeg"><br><br> , ,      Assets.  ,  ,    ‚Äì .     1,5 . -,      ,         .    . <br><br><img src="https://habrastorage.org/webt/q5/7g/ki/q57gkiv47412jj1q9_aye3k_4e8.jpeg"><br>    ‚Äî  WebView.    ,  WebView,   ,  dumpsys,  100 ,  .  , , - ,   ,  300  ‚Äî .    ,  WebView ,    . -. <br><br><img src="https://habrastorage.org/webt/o9/pj/z8/o9pjz8exyayhtg1varn-wtsmw8i.jpeg"><br><br> Google   .    .      WebView,     Google,    - .     WebView.  D'accord. <br><br><img src="https://habrastorage.org/webt/nt/lp/-q/ntlp-qwbjnysaljhmmahewkcdeq.jpeg"><br><br>    Google Go,    Android Go-.       ,     - layout    ,      .  ,      ,      ,   Chrome Tabs,  Chrome    .   . <br><br>       Android Go,    ?    ,      Android Go,      . <br><br><img src="https://habrastorage.org/webt/rm/jz/cf/rmjzcfwjkfponuuzuljvu0r088q.jpeg"><br>  Il y a plusieurs fa√ßons. -,      ,    ,       Android Go   .     ,    , .         ,   , ,  - build ,  - ,    ,  - .        APK,       ,  ‚Äî  uses-feature ¬´low-memory¬ª,      APK. <br><br>       ,     ,      Android Go.   Google. ,  ,  Go-   . <br><br>   ,   ?  ,      ,      -       ,   : ¬´,  -  .   ¬ª.           .   ,     ,    ,      ,   ,    - ,      ,  -    .     , ,  ,    ,    Google,    Google     ,      .        ,      ,  ,   Android Go  ,       ,       . <br><br>   ,       ,       ,  -.   . <br><br><img src="https://habrastorage.org/webt/6r/wd/i-/6rwdi-8mzeuwfvvw00dh0nmdf48.jpeg"><br><h5> <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">  </a></sup></sub> </h5><br>       ,    Google I/O:   ,          -    . ,      ,    ,  ,   ,    - ,        .    ,  ¬´       ,      .  ¬ª.     .        ,  .    ,  . <br><br>    ? ,      .  ‚Äî  ,    ,     98% .  ,         , ,    . .       -    Android Go-.  ,  YouTube Go       .    YouTube   , ,  ,   .  .   ,    Android Go    , , ,     ‚Äî    .     ‚Äî Facebook Lite, Twitter Lite,   . Lite,      -   . -,  ,      .    Facebook,    .       ,      ,    . ,    ‚Äî   ,     Android Go. <br><br>    ?  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  Stack Overflow,    1000 .      .  ,    ,    ,     . ,  ,    ‚Äî  dumpsys. <br><br>      ,  Android    ,   512   ,    Android 4.4.      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> API</a>     ,     . <br><br>     ,    .    ,        .   ‚Äî   ,    . <br><br>     , : ¬´ ¬ª.  : ¬´¬ª.  .  ‚Äî  ,  .  - 170 .  .  -  .    ?      , ,  ,     ,    - .     -  ‚Äî   .  105 .  . <br><br><img src="https://habrastorage.org/webt/mv/qk/gj/mvqkgjfuippyzhhhcv0tmkosqzw.jpeg"><br>     .   build-   -.  densitySplit,     , resConfig,       .   ,  ,    ‚Äî . ProGuard   .  ,  ProGuard  ,     ,  , ,  ,       stacktraces. <br><br>      .     ,      ,      Android Go-       . <br><br>    - 64 .  : ¬´,   ¬ª.  14 ,  4 ,  60 .     ,   .  .  ,     .         ‚Äî    ,  ,  ,     ,    .     , ,  ,     Android Go,    . 10 , APK     ,  , .   ,    ,      . <br><br>  ,    ‚Äî   .        ,    . ,      ,     - ,    ,     .    .     , ,   .  . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423493/">https://habr.com/ru/post/fr423493/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423483/index.html">Trouver la bonne fa√ßon de s√©parer le contenu d'un site Web √† l'aide de Webpack</a></li>
<li><a href="../fr423485/index.html">Chargement d'images paresseuses √† l'aide d'IntersectionObserver</a></li>
<li><a href="../fr423487/index.html">Node.js sans node_modules</a></li>
<li><a href="../fr423489/index.html">Je suis m√©decin urgentiste et je veux parler du nouvel √©lectrocardiogramme Apple Watch</a></li>
<li><a href="../fr423491/index.html">PHP Digest n ¬∞ 139 (du 3 au 17 septembre 2018)</a></li>
<li><a href="../fr423495/index.html">Que contient XGBoost et qu'est-ce que Go a √† voir avec cela?</a></li>
<li><a href="../fr423497/index.html">Essayons de parler des machines √† √©tats hi√©rarchiques en g√©n√©ral et de leur support dans SObjectizer-5 en particulier</a></li>
<li><a href="../fr423499/index.html">DevBoy - comment j'ai cr√©√© un projet d'appareil open source et lanc√© un projet sur Kickstarter</a></li>
<li><a href="../fr423501/index.html">Recherche et cr√©ation de style visuel pour un projet de design</a></li>
<li><a href="../fr423503/index.html">Mon exp√©rience de d√©m√©nagement, de vie et d'√©tudes en Allemagne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>