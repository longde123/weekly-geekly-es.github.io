<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§‘ğŸ¾â€ğŸ¤â€ğŸ§‘ğŸ¼ ğŸ›¥ï¸ ğŸ¡ Merekam suara JS dari mikrofon atau komentar suara ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘© ğŸ›¤ï¸ ğŸ˜†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Merekam suara JS dari mikrofon atau komentar suara 
 Belum lama ini, ketika mengembangkan satu aplikasi web perusahaan, pelanggan ingin dapat meningga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Merekam suara JS dari mikrofon atau komentar suara</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484196/"><h2>  Merekam suara JS dari mikrofon atau komentar suara </h2><br>  Belum lama ini, ketika mengembangkan satu aplikasi web perusahaan, pelanggan ingin dapat meninggalkan komentar suara.  Sebelumnya, saya tidak datang untuk menemukan konten media dan saya mulai mempelajari topik ini dengan penuh minat. <br><br>  Jaringan menyediakan informasi latar belakang yang cukup tentang topik membuat dan memproses konten semacam ini, tetapi saya tidak menemukan contoh sederhana yang berfungsi penuh.  Setelah pelaksanaan tugas oleh pelanggan, saya memutuskan untuk menerbitkan contoh paling sederhana untuk merekam dan menyimpan komentar suara dan menulis artikel.  Mungkin materi ini akan bermanfaat bagi seseorang dan membantu dalam penelitian. <br><br><h3>  Pernyataan masalah </h3><br>  Kami mengatur sendiri tugas mengembangkan aplikasi mini yang berjalan di browser yang akan memungkinkan Anda merekam komentar suara, mengirim rekaman ke server, server akan menyimpan rekaman, jika berhasil, itu akan mengembalikan respons dengan nama file yang dibuat dan menampilkan objek pada halaman sehingga rekaman dapat didengarkan. <br><a name="habracut"></a><br><h3>  Rekam suara di browser </h3><br>  Rekaman suara diputuskan untuk diimplementasikan menggunakan API web MediaStream Recording.  Untuk merekam, kami menggunakan antarmuka MediaRecorder ().  Tapi pertama-tama, buat antarmuka.  Biarkan kami memiliki index.html yang hanya berisi tag paling dasar, dan di dalam tubuh tag kami akan menyertakan file dengan JavaScript voice.js mendatang: <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Voice comments<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"voice.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Buat file voice.js, tentukan URL konstan di dalamnya yang akan berisi tautan ke skrip yang menerima rekaman suara.  Selanjutnya, buat tombol Start dan Stop untuk memulai dan menghentikan rekaman suara, serta blok div di mana catatan yang disimpan akan ditampilkan.  Pada antarmuka kami siap, Anda dapat melanjutkan langsung ke rekaman suara. <br><br>  Seperti yang telah disebutkan untuk merekam, kita akan menggunakan antarmuka MediaRecorder () (untuk informasi lebih lanjut tentang antarmuka, lihat dokumentasi), untuk operasinya perlu menentukan aliran media dari mana kita akan mengambil suara, inisialisasi hanya bahwa kita hanya memerlukan trek audio. <br><br><pre> <code class="javascript hljs">navigator.mediaDevices.getUserMedia({ <span class="hljs-attr"><span class="hljs-attr">audio</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mediaRecorder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaRecorder(stream)});</code> </pre><br>  Sekarang kami memiliki mediaRecorder konstan, yang berisi instance dari antarmuka, dan kami akan terus bekerja dengannya. <br><br>  Untuk mulai merekam, kita perlu memanggil metode MediaRecorder.start (), untuk berhenti merekam, metode MediaRecorder.stop ().  Dalam hal ini, MediaRecorder.stop () menghasilkan peristiwa yang tersedia data di mana kami mendapatkan akses ke rekaman suara digital dalam bentuk array biner. <br><br>  Maka kami akan menjelaskan peristiwa di atas, mendeklarasikan array suara [] dan menulis data yang diterima ke dalamnya: <br><br><pre> <code class="javascript hljs">navigator.mediaDevices.getUserMedia({ <span class="hljs-attr"><span class="hljs-attr">audio</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">stream</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mediaRecorder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaRecorder(stream); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> voice = []; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#start'</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ mediaRecorder.start(); }); mediaRecorder.addEventListener(<span class="hljs-string"><span class="hljs-string">"dataavailable"</span></span>,<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ voice.push(event.data); }); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">'#stop'</span></span>).addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ mediaRecorder.stop(); }); });</code> </pre><br>  Sekarang kami akan menyiapkan data yang diterima untuk dikirim.  Untuk melakukan ini, dengan menghentikan acara, buat instance BLOB, masukkan data yang diterima ke dalamnya dan tentukan tipe data MIME.  Dalam kasus kami, itu akan menjadi audio / wav. <br><br><pre> <code class="javascript hljs">mediaRecorder.addEventListener(<span class="hljs-string"><span class="hljs-string">"stop"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> voiceBlob = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Blob(voice, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'audio/wav'</span></span> });</code> </pre><br>  Akibatnya, kami memiliki konstanta voiceBlob yang merupakan konten dari file wav masa depan kami dengan merekam pesan suara. <br><br><h3>  Mengirim catatan ke server </h3><br>  Untuk mengirim catatan ke server, saya memutuskan untuk menggunakan metode fetch ().  Karena metode ini adalah yang paling modern dan menyediakan antarmuka yang ditingkatkan untuk membuat permintaan ke server.  Sebagai bagian dari tugas kami, kami perlu menginisiasi permintaan POST untuk mengirim isi file masa depan kami untuk disimpan di server (bagaimana metode fetch () bekerja dan kemampuan apa yang dapat ditemukan dalam dokumentasi secara rinci).  Buat formulir baru dengan bidang suara dan masukkan konten catatan kami ke dalamnya. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormData(); fd.append(<span class="hljs-string"><span class="hljs-string">'voice'</span></span>, voiceBlob);</code> </pre><br>  Kami membuat fungsi asinkron untuk mengirim pesan ke server untuk menerima respons dan menampilkan objek audio untuk memutar file yang sudah disimpan.  Sebagai argumen, fungsi akan mengambil bentuk yang dibuat di atas. <br><br>  Kami memulai permintaan server: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> promise = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> fetch(URL, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: form});</code> </pre><br>  Jika respons HTTP dari server tidak mengandung kode kesalahan (kode respons berada dalam kisaran 200-299), maka tetap bagi kami untuk menguraikan kode respons, membuat objek audio baru pada halaman, menentukan propertinya dan menampilkannya.  Bagaimana jawabannya terbentuk akan dibahas di bawah ini. <br><br><h3>  Menyimpan file di server </h3><br>  Mari kita buat skrip di server yang akan menerima permintaan POST kami dengan pesan suara.  Karena rekaman suara yang kami kirim pada dasarnya sudah berupa file dalam bentuk, kami akan menerimanya di server sesuai: <br><br><pre> <code class="php hljs">$uploadDir = <span class="hljs-string"><span class="hljs-string">'voice/'</span></span>; $typeFile = explode(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, $_FILES[<span class="hljs-string"><span class="hljs-string">'voice'</span></span>][<span class="hljs-string"><span class="hljs-string">'type'</span></span>]); $uploadFile = $uploadDir . basename(md5($_FILES[<span class="hljs-string"><span class="hljs-string">'voice'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>].time()).<span class="hljs-string"><span class="hljs-string">'.'</span></span>.$typeFile[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (move_uploaded_file($_FILES[<span class="hljs-string"><span class="hljs-string">'voice'</span></span>][<span class="hljs-string"><span class="hljs-string">'tmp_name'</span></span>], $uploadFile)) { $response = [<span class="hljs-string"><span class="hljs-string">'result'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'OK'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'../'</span></span>.$uploadFile]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $response = [<span class="hljs-string"><span class="hljs-string">'result'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'ERROR'</span></span>, <span class="hljs-string"><span class="hljs-string">'data'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($response);</code> </pre><br>  Anda dapat menemukan banyak contoh kode PHP yang mirip, memproses file yang diterima di jaringan.  Pertama, inisialisasi variabel, $ uploadDir - direktori di mana file yang diterima akan disimpan, jenis file &amp; typeFile dalam kasus kami akan sama dengan wav dan nama lengkap file, termasuk direktori.  Nama file dalam hal ini dibentuk dengan menggabungkan nama file "sementara" dan nilai string dari waktu saat ini dienkripsi menggunakan metode md5.  Jika Anda berhasil menyimpan file dengan pesan suara di direktori yang ditentukan, kami membentuk respons dalam bentuk array yang berisi bidang hasil sama dengan "OK" atau "ERROR" tergantung pada hasil dan bidang "data" yang, jika berhasil diproses, berisi tautan ke file yang disimpan. <br><br>  Untuk kenyamanan, kami mengubah array menjadi objek JSON dan mengirimkannya sebagai respons. <br><br>  Kode sampel lengkap tersedia di <a href="https://github.com/Krivodanov/Voice-comments">GitHub</a> . <br><br>  PS Browser memungkinkan Anda untuk merekam konten media hanya dengan koneksi HTTPS yang aman. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id484196/">https://habr.com/ru/post/id484196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id484182/index.html">Xenobots: nanorobots hidup dari sel katak</a></li>
<li><a href="../id484186/index.html">LDAP - "otentikasi" adalah antipattern</a></li>
<li><a href="../id484188/index.html">Standar Desain Basis Data</a></li>
<li><a href="../id484192/index.html">Mudah dan mudah untuk menerapkan aplikasi pada Tarantool Cartridge (bagian 2)</a></li>
<li><a href="../id484194/index.html">Kubernet diterjemahkan menjadi anak-anak</a></li>
<li><a href="../id484198/index.html">Sisi sebaliknya dari koin: siapa yang menang dan kalah pada pertumbuhan saham Tesla</a></li>
<li><a href="../id484200/index.html">Cara menetapkan tujuan untuk mencapainya</a></li>
<li><a href="../id484202/index.html">Pembelajaran Mesin dalam Analisis Statis Kode Sumber Program</a></li>
<li><a href="../id484204/index.html">FTCODE ransomware tanpa fileless sekarang mencuri akun</a></li>
<li><a href="../id484206/index.html">Penggunaan mixin di Dart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>