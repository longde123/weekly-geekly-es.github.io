<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîÜ üïí ‚≠ïÔ∏è Termometer dua digit ü§§ ‚ñ∂Ô∏è üë©üèº‚Äç‚öñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Penulis membuat termometer LED dua digit ini sebagai hadiah ulang tahun untuk putra temannya. Dia baru berusia dua tahun, dan dia sudah membaca angka-...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Termometer dua digit</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/454220/"><img src="https://habrastorage.org/webt/i0/jr/au/i0jrauutpm6rrsutydyvv7hxb_c.jpeg"><br><br>  Penulis membuat termometer LED dua digit ini sebagai hadiah ulang tahun untuk putra temannya.  Dia baru berusia dua tahun, dan dia sudah membaca angka-angka, tetapi surat-suratnya tidak.  Sekarang dia bisa mengetahui sendiri suhu di luar jendela.  Sensor dalam termometer adalah chip DS18B20 yang beroperasi di bawah protokol 1-Wire, dan mikrokontroler adalah tipe ATtiny84.  Papan berbentuk bujur sangkar dengan sisi 25 mm, ukurannya sebanding dengan koin 50 pence.  Penulis berencana untuk meletakkan papan di kotak tahan air dan menempatkannya di luar jendela.  Indikasi menyala secara singkat setiap 24 detik, dan baterai CR2032 bertahan selama sekitar satu tahun. <a name="habracut"></a><br>  Termometer beroperasi pada kisaran -19 hingga +99 ¬∞ C.  Jika perlu, minus dan satu ditampilkan secara bersamaan dalam urutan tinggi.  Di luar jangkauan, huruf Lo atau Hi ditampilkan.  Anda dapat "mengajar" perangkat untuk menampilkan suhu di bawah -19 ¬∞ C dengan menggunakan segmen dengan titik sebagai minus. <br><br>  Menurut skema ini, perangkat tersebut sebelumnya dipasang di papan tempat memotong roti: <br><br><img src="https://habrastorage.org/webt/1u/e7/aj/1ue7aju6otdv_qjhwdjabjxejf8.gif"><br><br>  Semua output mikrokontroler terlibat, generator clock 8 MHz yang digunakan.  Prototipe adalah sebagai berikut: <br><br><img src="https://habrastorage.org/webt/qf/91/nd/qf91ndinrn_16xfcxellk_lxzuq.jpeg"><br><br>  Prototipe yang digunakan DS18B20 dalam paket TO-92, ATtiny84 dalam paket PDIP dan indikator 3621AS 3,6 inci.  Kemudian penulis mengembangkan papan di Eagle dan memesannya di PCBway.  Di sini mikrokontroler sudah ada dalam kasing SOIC, sensor ada dalam kasing ¬µSOP, dan resistor, kapasitor, dan layar berukuran 0805. Segala sesuatu kecuali layar disolder oleh pengering rambut Youyue 858D + pada suhu 250 ¬∞ C. <br><br>  Baik prototipe dan papan sirkuit cetak memiliki indikator dengan anoda umum.  Perangkat ini dibuat dalam dua versi, dengan indikator warna merah dan kuning.  Merah - di KDPV, kuning - di sini: <br><br><img src="https://habrastorage.org/webt/qc/i9/wv/qci9wvs7mdqulra36wldskfg6sc.jpeg"><br><br>  Dudukan untuk sel lithium 20 mm (siapa pun dengan sebutan yang dimulai dengan 20, mis., 2016, 2025 atau 2032) disolder di sisi belakang: <br><br><img src="https://habrastorage.org/webt/3i/ic/kx/3iickx0nahv0rh325lvawiebzdq.jpeg"><br><br>  Firmware ditulis sehingga mikrokontroler dalam mode tidur sebagian besar waktu dan bangun setelah gangguan dari pengawas waktu.  Dalam implementasi antarmuka 1-Wire, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">waktu pengoperasian</a> penulis yang sama ini terlibat.  Penghitung waktu 16-bit dari mikrokontroler yang beroperasi pada frekuensi 1 MHz memakan waktu: <br><br><pre><code class="plaintext hljs">void OneWireSetup () { TCCR1A = 0&lt;&lt;WGM10; // Normal mode TCCR1B = 0&lt;&lt;WGM12 | 2&lt;&lt;CS10; // Normal mode, divide clock by 8 }</code> </pre> <br>  Subroutine DelayMicros () menyediakan penundaan jumlah mikrodetik yang ditentukan, berdasarkan register perbandingan keluaran OCR0A: <br><br><pre> <code class="plaintext hljs">void DelayMicros (unsigned int micro) { TCNT1 = 0; TIFR1 = 1&lt;&lt;OCF1A; OCR1A = micro; while ((TIFR1 &amp; 1&lt;&lt;OCF1A) == 0); }</code> </pre> <br>  Rutin DisplayTemperature () membaca nilai suhu dari sensor dan menampilkannya.  Karena hanya ada satu sensor di bus, Anda dapat mengabaikan nomor seri dan hanya memberikan perintah Lewati ROM, setelah itu semua perintah berikut dikirim ke perangkat apa pun: <br><br><pre> <code class="plaintext hljs">void DisplayTemperature () { cli(); // No interrupts if (OneWireReset() != 0) { sei(); DisplayError(0); // Device not found } else { OneWireWrite(SkipROM); OneWireWrite(ConvertT); while (OneWireRead() != 0xFF); OneWireReset(); OneWireWrite(SkipROM); OneWireWrite(ReadScratchpad); OneWireReadBytes(9); sei(); // Interrupts if (OneWireCRC(9) == 0) { int temp = DataWords[0]; Display((temp+8)&gt;&gt;4); // Round to nearest degree } else DisplayError(1); // CRC error } }</code> </pre> <br>  Menanggapi permintaan tersebut, sensor mengembalikan nilai suhu dalam bentuk integer bertanda 16-bit dalam satuan yang setara dengan 1/16 derajat.  Angka dibulatkan ke derajat integer terdekat dan ditampilkan dengan memanggil rutin Display (). <br><br>  Subroutine DisplayError () menampilkan kesalahan dalam interaksi mikrokontroler dengan sensor pada bus 1-Wire: <br><br><pre> <code class="plaintext hljs">void DisplayError (int no) { Buffer[0] = Error; Buffer[1] = no; }</code> </pre> <br>  E0 - sensor tidak terdeteksi, E1 - CRC error. <br><br>  Data untuk indikasi dinamis diambil dari array Buffer [].  Misalnya, untuk menampilkan angka 20, Anda harus melakukan: <br><br><pre> <code class="plaintext hljs">Buffer[0]=2; Buffer[1]=0;</code> </pre> <br>  Penghitung waktu 0 menghasilkan interupsi pada frekuensi 125 Hz, yang cukup untuk menghilangkan flicker.  Pertama, timer dikonfigurasikan dalam pengaturan () " <br><br><pre> <code class="plaintext hljs">TCCR0A = 2&lt;&lt;WGM00; // CTC mode; count up to OCR0A TCCR0B = 0&lt;&lt;WGM02 | 4&lt;&lt;CS00; // Divide by 256 OCR0A = 250-1; // Compare match at 125Hz TIMSK0 = 0; // Interrupts initially off</code> </pre> <br>  Rutin penanganan interupsi yang cocok selama perbandingan memanggil rutin DisplayNextDigit () dan kemudian dihitung dengan arah yang berlawanan: <br><br><pre> <code class="plaintext hljs">ISR(TIM0_COMPA_vect) { DisplayNextDigit(); Ticks--; }</code> </pre> <br>  Subrutin DisplayNextDigit () membaca data dari sel yang sesuai dalam array Buffer [] dan termasuk segmen yang diinginkan dalam bit tampilan yang sesuai.  Program ini menggunakan #define untuk memilih antara indikator dengan katoda umum atau anoda.  Jika semua segmen langsung menyala saat dinyalakan, maka jenis tampilan tidak cocok dengan yang ditentukan dalam firmware.  Untuk katoda umum, subrutin harus diganti dengan yang berikut: <br><br><pre> <code class="plaintext hljs">void DisplayNextDigit () { PORTB = PORTB | 1&lt;&lt;digit; // Turn old digit off digit = digit ^ 1; // Toggle between 0 and 1 char segs = charArray[Buffer[digit]]; PORTA = segs; // Lit segments high PORTB = PORTB &amp; ~(1&lt;&lt;digit); // Turn new digit on }</code> </pre> <br>  Akhirnya, rutinitas Display () menghasilkan angka dua digit untuk ditulis ke larik Buffer []: <br><br><pre> <code class="plaintext hljs">void Display (int n) { int units = n % 10; int tens = n / 10; int temp0 = tens; int temp1 = abs(units); if (tens &lt; -1) {temp0 = Lo; temp1 = Lo+1; } else if (tens &gt; 9) {temp0 = Hi; temp1 = Hi+1; } else if (tens == -1) temp0 = Minus1; else if ((tens == 0) &amp;&amp; (units &gt;= 0)) temp0 = Blank; else if ((tens == 0) &amp;&amp; (units &lt; 0)) temp0 = Minus; Buffer[0] = temp0; Buffer[1] = temp1; }</code> </pre> <br>  Ini juga memperhitungkan kasus menampilkan minus bersama-sama dengan unit dalam urutan tinggi, serta pesan tentang suhu di luar kisaran. <br><br>  Untuk penghematan energi semaksimal mungkin, generator jam ADC, USI, dan ADC dinonaktifkan, dan mode tidur PWR_DOWN diaktifkan: <br><br><pre> <code class="plaintext hljs"> ADCSRA &amp;= ~(1&lt;&lt;ADEN); // Disable ADC to save power PRR = 1&lt;&lt;PRUSI | 1&lt;&lt;PRADC; // Turn off clocks to USI &amp; ADC to save power set_sleep_mode(SLEEP_MODE_PWR_DOWN);</code> </pre> <br>  Program utama menampilkan suhu selama sepersepuluh detik, kemudian menyalakan mode tidur.  Ternyata ini adalah waktu indikasi minimum, nyaman untuk membaca.  Dua detik sebelum suhu ditampilkan, titik berkedip sebentar: <br><br><pre> <code class="plaintext hljs">void loop () { Buffer[0] = DP; Buffer[1] = Blank; DisplayOn(12); WDDelay(6); // Sleep for 1 second Buffer[0] = Blank; Buffer[1] = DP; DisplayOn(12); WDDelay(6); // Sleep for 1 second DisplayTemperature(); DisplayOn(12); WDDelay(9); // Sleep for 8 seconds WDDelay(9); // Sleep for 16 seconds WDDelay(9); // Sleep for 24 seconds }</code> </pre> <br>  Layar tetap tidak aktif selama 24 detik karena masing-masing dari tiga panggilan pengawas selama 8 detik.  Dengan indikator berjalan, konsumsi saat ini adalah 6.6 mA, dalam mode tidur - 4.7 ŒºA, konsumsi arus rata-rata adalah 1/240 * 6.6 mA.  Kapasitas tipikal sel CR2032 adalah 225 mAh, sehingga cukup untuk (225 / 6.6) x 240/24 = 340 hari - sedikit kurang dari setahun. <br><br>  Kisaran suhu komponen adalah sebagai berikut: mikrokontroler dan indikator - dari -40 hingga + 85 ¬∞ C, resistor dan kapasitor - dari -55 hingga +125 ¬∞ C, baterai - dari -20 hingga +70 ¬∞ C.  Suatu elemen dengan rentang suhu yang diperluas BR2032 akan beroperasi dalam kisaran dari -30 hingga +85 ¬∞ C. <br><br>  Mikrokontroler dibuat kompatibel dengan Arduino dengan pengembangan Spence Konde ini.  Di IDE, pilih ATtiny24 / 44/84 di bagian ATTinyCore pada menu Board.  Maka Anda perlu mengatur opsi berikut, tidak memperhatikan sisanya: <br><br><pre> <code class="plaintext hljs">Chip: "ATtiny84" Clock: "8 MHz (internal)" BOD: "BOD Disabled" Pin Mapping: "Clockwise (like damellis core)"</code> </pre> <br>  Program ini diunggah menggunakan klip uji Pomona, ditempatkan di atas mikrokontroler dan terhubung ke Programmer AVR SparkFun Tiny.  Pertama, Anda harus memilih Burn Bootloader, lalu Unggah. <br><br>  Tautan: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">teks lengkap dari program</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">board dan program di GitHub</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">board di OSHpark</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id454220/">https://habr.com/ru/post/id454220/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id454206/index.html">PHDays 9: Parsing AI CTF</a></li>
<li><a href="../id454208/index.html">RISC-V dari awal</a></li>
<li><a href="../id454210/index.html">Enchantjs terlupakan + 1C-Bitrix baru = Game untuk motivasi pelanggan</a></li>
<li><a href="../id454214/index.html">Saya benci hampir semua perangkat lunak</a></li>
<li><a href="../id454216/index.html">Bukti yang ditemukan bahwa semua perubahan adalah campuran urutan dan peluang</a></li>
<li><a href="../id454222/index.html">Mutakhirkan subsistem disk server lama dengan bus PCIe 1.0 - 2.0</a></li>
<li><a href="../id454224/index.html">Rekomendasi di Okko: cara mendapatkan ratusan juta dengan mengalikan beberapa matriks</a></li>
<li><a href="../id454226/index.html">Memori pada domain magnetik silindris. Bagian 1. Prinsip kerja</a></li>
<li><a href="../id454232/index.html">OOP dalam bahasa pemrograman grafis. Bagian 2 MOS dan OOP</a></li>
<li><a href="../id454240/index.html">Analisis wavelet. Bagian 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>