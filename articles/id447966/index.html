<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚵🏻 🚉 👨🏼‍🏭 Bagaimana menghubungkan GitLab dan Pantheon dan mengoptimalkan alur kerja Drupal dan WordPress 🗂️ 🏸 🛠️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tamu kami, pembuat alat pengembang Pantheon, berbicara tentang cara mengotomatiskan penerapan WordPress menggunakan GitLab CI / CD. 


 Di Pantheon, s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bagaimana menghubungkan GitLab dan Pantheon dan mengoptimalkan alur kerja Drupal dan WordPress</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/447966/"><p><img src="https://habrastorage.org/webt/ja/h2/ef/jah2efouevm2la2v9vkt3vuojm8.png"></p><br><p>  Tamu kami, pembuat alat pengembang Pantheon, berbicara tentang cara mengotomatiskan penerapan WordPress menggunakan GitLab CI / CD. </p><br><p>  Di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pantheon,</a> saya berurusan dengan hubungan pengembang, jadi saya selalu mencari cara baru untuk membantu pengembang WordPress dan Drupal memecahkan masalah otomatisasi dalam alur kerja mereka.  Untuk melakukan ini, saya suka bereksperimen dengan alat baru dan menggabungkannya satu sama lain untuk pekerjaan yang efektif. </p><br><p>  <strong>Saya sering melihat pengembang tersiksa dengan satu server pengembangan.</strong> </p><br><p> Sangat-sangat menyenangkan - untuk menunggu giliran Anda menggunakan server atau mengirim URL kepada klien dengan catatan: "Lihat di sini, tapi jangan lihat di sini." </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lingkungan multidev</a> - salah satu alat keren Pantheon - menyelesaikan masalah ini, karena dengan itu Anda dapat membuat lingkungan untuk cabang Git berdasarkan permintaan.  Setiap lingkungan multidev memiliki URL dan basis datanya sendiri, sehingga pengembang bekerja dengan tenang, memeriksa kualitasnya dan mendapatkan persetujuan tanpa saling bertabrakan. </p><br><p>  Tetapi Pantheon tidak memiliki alat untuk kontrol versi atau integrasi dan penyebaran berkelanjutan (CI / CD).  Tapi ini adalah platform yang fleksibel untuk mengintegrasikan alat apa pun. </p><br><p>  <strong>Saya juga memperhatikan bahwa untuk pengembangan tim mereka menggunakan satu alat, dan untuk perakitan dan penempatan - lainnya.</strong> </p><br><p>  Misalnya, mereka memiliki alat yang berbeda untuk kontrol versi dan CI / CD.  Anda harus main-main dan beralih di antara alat untuk mengedit kode dan mendiagnosis masalah. </p><a name="habracut"></a><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitLab</a> memiliki seperangkat alat pengembangan lengkap: untuk kontrol versi, tiket, permintaan gabungan, pipa CI / CD terbaik di kelas, daftar kontainer dan semua hal lainnya.  Saya belum menemukan aplikasi di mana akan ada begitu banyak untuk mengelola alur kerja pengembangan. </p><br><p>  Saya suka otomatisasi, jadi saya belajar cara menghubungkan Pantheon ke GitLab sehingga berkomitmen untuk cabang utama di GitLab dikerahkan ke lingkungan pengembangan utama di Pantheon.  Dan menggabungkan permintaan di GitLab dapat membuat dan menggunakan kode ke lingkungan multidev di Pantheon. </p><br><p>  Dalam panduan ini, saya akan menunjukkan kepada Anda cara mengatur koneksi antara GitLab dan Pantheon dan mengoptimalkan alur kerja WordPress dan Drupal Anda. </p><br><p>  Anda tentu saja dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mencerminkan repositori GitLab</a> , tetapi kami akan melakukan segalanya dengan pena untuk menggali <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitLab CI</a> dan menggunakan alat ini tidak hanya untuk penyebaran di masa depan. </p><br><h3 id="vvedenie">  Pendahuluan </h3><br><p>  Untuk posting ini Anda perlu memahami bahwa Pantheon memecah setiap situs menjadi tiga elemen: kode, basis data dan file. </p><br><p>  Kode ini mencakup file CMS, seperti kernel, plugin, dan tema WordPress.  File-file ini dikelola di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori Git yang</a> di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">-</a> host oleh Pantheon, yaitu, kita dapat menggunakan kode dari GitLab ke Pantheon dengan Git. <br>  File di Pantheon disebut file media, yaitu gambar untuk situs tersebut.  Biasanya mereka diunduh oleh pengguna, dan Git mengabaikannya. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Buat akun gratis</a> , pelajari lebih lanjut tentang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">alur kerja Pantheon,</a> atau <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">daftar untuk demo</a> di pantheon.io. </p><br><h3 id="predpolozheniya">  Asumsi </h3><br><p> Proyek saya di Pantheon dan GitLab disebut <code>pantheon-gitlab-blog-demo</code> .  Nama proyek harus unik.  Di sini kita akan bekerja dengan situs WordPress.  Anda dapat menggunakan Drupal, tetapi Anda harus mengubah sesuatu. </p><br><p>  Saya akan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">baris perintah Git</a> , dan Anda dapat bekerja di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GUI</a> jika mau. </p><br><h3 id="sozdaem-proekt">  Buat proyek </h3><br><p>  Untuk memulai, buat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proyek GitLab</a> (kami akan kembali ke sana). </p><br><p>  Sekarang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">buat situs WordPress di Pantheon</a> .  Kemudian instal WordPress untuk situs dasbor. </p><br><blockquote>  Jika tangan Anda gatal, ubah sesuatu, misalnya, lepaskan dan tambahkan plugin, bersabarlah.  Situs ini belum terhubung ke GitLab, dan kami ingin semua perubahan kode melalui GitLab. </blockquote><p>  Ketika kami menginstal WordPress, kami kembali ke dasbor situs web Pantheon dan mengubah mode pengembangan ke Git. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/up/zf/50/upzf50ocuma107rer9uxiybvjnc.png"></a> </p><br><h3 id="nachalnyy-kommit-na-gitlab">  Komit Awal GitLab </h3><br><p>  Sekarang Anda perlu mentransfer kode WordPress awal dari situs web Pantheon ke GitLab.  Untuk melakukan ini, kami mengkloning kode dari repositori situs Git Pantheon secara lokal, dan kemudian mengirimkannya ke repositori GitLab. </p><br><p>  Untuk membuatnya lebih sederhana dan lebih aman, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kami akan menambahkan kunci SSH ke Pantheon</a> dan kami tidak akan memasukkan kata sandi setiap kali kami mengkloning repositori Pantheon Git.  Pada saat yang sama, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kami</a> akan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menambahkan kunci SSH ke GitLab</a> . </p><br><p>  Untuk melakukan ini, kami mengkloning situs Pantheon secara lokal dengan menyalin perintah dari bidang Clone with Git di dasbor situs. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/em/qz/ga/emqzgamloafdlzbj3xp0ssrt2o0.png"></a> <br>  <em>Jika Anda butuh bantuan, baca dokumentasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Git Getting Started untuk Pantheon</a> .</em> </p><br><p>  Sekarang ganti <code>git remote origin</code> untuk menunjuk ke GitLab bukan Pantheon.  Ini bisa dilakukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><code> git remote</code></a> . </p><br><p>  Mari kita pergi ke proyek GitLab dan menyalin URL repositori dari daftar drop-down Clone di halaman detail proyek.  Kami akan memilih opsi Klon dengan SSH, karena kami telah mengonfigurasi kunci SSH. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/6m/4o/ea/6m4oeailmhmcggywg27uptq7aio.png"></a> </p><br><p>  Secara default, <code>git remote</code> untuk salinan lokal dari repositori kode adalah <code>origin</code> .  Ini dapat diubah dengan <code>git remote set-url origin [URL  GitLab]</code> , di mana kita tidak memasukkan tanda kurung, melainkan memasukkan URL yang sebenarnya. </p><br><p>  Terakhir, jalankan <code>git push origin master --force</code> untuk mengirimkan kode WordPress Anda dari Pantheon ke GitLab. </p><br><blockquote>  Opsi – Angkatan hanya diperlukan sekali.  Maka dalam perintah <code>git push</code> pada GitLab tidak akan. </blockquote><br><h3 id="nastraivaem-uchetnye-dannye-i-peremennye">  Konfigurasikan kredensial dan variabel </h3><br><p>  Ingat bagaimana kami menambahkan kunci SSH secara lokal untuk masuk ke Pantheon dan GitLab?  Token SSH dapat digunakan untuk mengotorisasi GitLab dan Pantheon. </p><br><p>  GitLab memiliki beberapa dokumentasi yang bagus.  Mari kita lihat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">bagian tentang kunci SSH ketika menggunakan pelaksana Docker dalam dokumen tentang menggunakan kunci SSH dengan GitLab CI / CD</a> . </p><br><p>  Sekarang kita akan menyelesaikan dua langkah pertama: <em>membuat sepasang kunci SSH baru secara lokal dengan ssh-keygen dan menambahkan kunci pribadi sebagai variabel ke proyek</em> . </p><br><p>  Kemudian kita menetapkan <code>SSH_PRIVATE_KEY</code> sebagai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">variabel lingkungan GitLab CI / CD</a> dalam pengaturan proyek. <br>  Pada langkah ketiga dan keempat, buat file <code>.gitlab-ci.yml</code> dengan konten berikut: </p><br><pre> <code class="plaintext hljs">before_script: # See https://docs.gitlab.com/ee/ci/ssh_keys/README.html - eval $(ssh-agent -s) - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add - &gt; /dev/null - mkdir -p $HOME/.ssh &amp;&amp; echo "StrictHostKeyChecking no" &gt;&gt; "$HOME/.ssh/config" - git config --global user.email "$GITLAB_USER_EMAIL" - git config --global user.name "Gitlab CI"</code> </pre> <br><p>  Sampai kita mengkomit file <code>.gitlab-ci.yml</code> , maka sesuatu yang lain perlu ditambahkan padanya. </p><br><p>  Sekarang kami melakukan langkah kelima dan <em>menambahkan kunci publik yang kami buat di langkah pertama ke layanan yang Anda perlukan akses di lingkungan build</em> . </p><br><p>  Dalam kasus kami, kami ingin mendapatkan akses ke Pantheon dari GitLab.  Ikuti instruksi dalam dokumen Pantheon untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menambahkan kunci SSH ke Pantheon</a> dan selesaikan langkah ini. </p><br><blockquote>  Ingat: tutup SSH di GitLab, buka di Pantheon. </blockquote><p>  Siapkan beberapa variabel lingkungan lagi.  Yang pertama disebut PANTHEON_SITE.  Artinya adalah nama situs Pantheon di mesin Anda. </p><br><p>  Nama pada mesin ditunjukkan di akhir Klon dengan perintah Git.  Anda telah mengkloning situs tersebut secara lokal, jadi ini akan menjadi nama direktori penyimpanan lokal. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/rf/3p/gb/rf3pgbmo_2u0xsri8d1hq5f-xxw.png"></a> </p><br><p>  Selanjutnya, siapkan <code>PANTHEON_GIT_URL</code> lingkungan <code>PANTHEON_GIT_URL</code> .  Ini adalah URL repositori Git untuk situs Pantheon yang telah kami gunakan. </p><br><blockquote>  Kami hanya memasukkan URL repositori SSH, tanpa <code>git clone</code> dan nama situs pada mesin di akhir. </blockquote><p>  Fuh.  Ini selesai, sekarang kita bisa menyelesaikan <code>.gitlab-ci.yml</code> . </p><br><h3 id="sozdaem-zadachu-deploya">  Buat tugas penempatan </h3><br><p>  Apa yang awalnya akan kita lakukan dengan GitLab CI sangat mirip dengan apa yang kita lakukan dengan repositori Git sebelumnya.  Tapi kali ini, tambahkan repositori Pantheon sebagai sumber Git jarak jauh kedua, dan kemudian kirim kode dari GitLab ke Pantheon. </p><br><p>  Untuk melakukan ini, konfigurasikan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tahap</a> <code>deploy</code> dan <code>deploy:dev</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tugas</a> <code>deploy:dev</code> , karena kami akan menyebarkan ke lingkungan pengembangan di Pantheon.  Akibatnya, file <code>.gitlab-ci.yml</code> akan terlihat seperti ini: </p><br><pre> <code class="plaintext hljs">stages: - deploy before_script: # See https://docs.gitlab.com/ee/ci/ssh_keys/README.html - eval $(ssh-agent -s) - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add - &gt; /dev/null - mkdir -p $HOME/.ssh &amp;&amp; echo "StrictHostKeyChecking no" &gt;&gt; "$HOME/.ssh/config" - git config --global user.email "$GITLAB_USER_EMAIL" - git config --global user.name "Gitlab CI" deploy:dev: stage: deploy environment: name: dev url: https://dev-$PANTHEON_SITE.pantheonsite.io/ script: - git remote add pantheon $PANTHEON_GIT_URL - git push pantheon master --force only: - master</code> </pre> <br><p>  Variabel <code>SSH_PRIVATE_KEY, PANTHEON_SITE</code> dan <code>PANTHEON_GIT_URL</code> seharusnya terlihat familier - kami menyiapkan variabel lingkungan ini sebelumnya.  Dengan variabel-variabel ini, kita dapat menggunakan nilai dalam file <code>.gitlab-ci.yml</code> berkali-kali, dan kita hanya perlu memperbaruinya di satu tempat. </p><br><p>  Terakhir, tambahkan, komit, dan <code>.gitlab-ci.yml</code> ke GitLab. </p><br><h3 id="proveryaem-deploy">  Periksa Menyebarkan </h3><br><p>  Jika kami melakukan semuanya dengan benar, tugas <code>deploy:dev</code> akan berhasil di GitLab CI / CD dan mengirimkan <code>.gitlab-ci.yml</code> ke Pantheon.  Ayo lihat. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ex/pu/to/exputo8aihdn0sxv1aavrpa-rg4.png"></a> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/2w/4_/zs/2w4_zszf0r6dxu8jvgo-ogfzzqi.png"></a> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/6z/tk/ir/6ztkirsm-22bbcegra12_lyx3zg.png"></a> </p><br><h3 id="otpravlyaem-vetki-merzh-rekvestov-v-pantheon">  Kami mengirim cabang permintaan penggabungan ke Pantheon </h3><br><p>  Di sini kita akan menggunakan fitur Pantheon favorit saya - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">multidev</a> , di mana Anda dapat membuat lingkungan Pantheon tambahan untuk cabang Git berdasarkan permintaan. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Akses ke multidev terbatas</a> , jadi bagian ini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">opsional</a> .  Tetapi jika Anda memiliki akses, Anda dapat secara serius meningkatkan produktivitas dengan menyiapkan pembuatan otomatis lingkungan multidev di Pantheon dari permintaan gabungan GitLab. </p><br><p>  Pertama, buat cabang Git baru secara lokal menggunakan <code>git checkout -b multidev-support</code> .  Sekarang, sekali lagi, sesuatu akan berubah di <code>.gitlab-ci.yml</code> . </p><br><p>  Saya ingin menunjukkan nomor permintaan gabungan dalam nama lingkungan Pantheon.  Misalnya, permintaan gabungan pertama adalah <code>mr-1</code> , yang kedua adalah <code>mr-2</code> , dll. </p><br><p>  Permintaan penggabungan berubah, jadi kita perlu mengidentifikasi secara dinamis nama cabang Pantheon.  Di GitLab, ini sederhana - Anda perlu menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">variabel lingkungan yang telah ditentukan</a> . </p><br><p>  Kami dapat mengambil <code>$CI_MERGE_REQUEST_IID</code> untuk menunjukkan nomor permintaan penggabungan.  Mari kita terapkan semua ini bersama dengan variabel lingkungan global yang telah kita tentukan sebelumnya, dan tambahkan tugas penyebaran baru: multidev di akhir <code>.gitlab-ci.yml</code> . </p><br><pre> <code class="plaintext hljs">deploy:multidev: stage: deploy environment: name: multidev/mr-$CI_MERGE_REQUEST_IID url: https://mr-$CI_MERGE_REQUEST_IID-$PANTHEON_SITE.pantheonsite.io/ script: # Checkout the merge request source branch - git checkout $CI_COMMIT_REF_NAME # Add the Pantheon git repository as an additional remote - git remote add pantheon $PANTHEON_GIT_URL # Push the merge request source branch to Pantheon - git push pantheon $CI_COMMIT_REF_NAME:mr-$CI_MERGE_REQUEST_IID --force only: - merge_requests</code> </pre> <br><p>  Ini akan mirip dengan <code>deploy:dev</code> kami <code>deploy:dev</code> tugas <code>deploy:dev</code> , hanya cabang yang dikirim ke Pantheon, dan bukan untuk <code>master</code> . </p><br><p>  Kami menambahkan dan melakukan <code>.gitlab-ci.yml</code> diperbarui, dan sekarang kami akan mengirim cabang baru ke GitLab dengan <code>git push -u origin multidev-support</code> . </p><br><p>  Sekarang buat <em>permintaan menggabungkan</em> baru dari cabang <code>multidev-support</code> dengan mengklik <em>Buat permintaan menggabungkan</em> . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/bi/bv/gt/bibvgthkwykacqew-cswygjdmig.png"></a> </p><br><p>  Setelah membuat permintaan penggabungan, kami melihat bagaimana CI / CD <code>deploy:multidev</code> . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ck/ev/lq/ckevlqnrfbfanoj0dlmjt26wxpw.png"></a> </p><br><p>  Lihat - cabang baru telah dikirim ke Pantheon.  Tetapi jika kita pergi ke bagian multidev di dasbor situs Pantheon, kita tidak akan melihat lingkungan baru di sana. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/yy/yy/bz/yyyybzmedtphnsj-6humcyu2hmu.png"></a> </p><br><p>  Lihatlah bagian Cabang Git. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/hp/_o/bl/hp_obl6r7pv4ihuot7i6gx4rqwm.png"></a> </p><br><p>  Hasilnya, cabang <code>mr-1</code> mencapai Pantheon.  Buat lingkungan dari cabang <code>mr-1</code> . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/2v/xg/ez/2vxgez9ugraihe2bdyn-5cxevjm.png"></a> </p><br><p>  Kami menciptakan lingkungan multidev, dan sekarang kembali ke GitLab dan lihat bagian <em>Operations&gt; Environments</em> .  Kita akan melihat entri untuk <code>dev</code> dan <code>mr-1</code> . </p><br><p>  Ini karena kami menambahkan entri <code>environment</code> bernama <code>name</code> dan <code>url</code> ke tugas CI / CD.  Jika kita mengklik ikon lingkungan terbuka, kita akan pergi ke URL lingkungan multidev Pantheon. </p><br><h3 id="avtomatiziruem-sozdanie-multidev">  Otomatis pembuatan multidev </h3><br><p>  Pada prinsipnya, Anda bisa berhenti di sini dan hanya ingat untuk membuat lingkungan multidev untuk setiap permintaan penggabungan, tetapi proses ini bisa otomatis. </p><br><p>  Pantheon memiliki alat baris perintah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Terminus di</a> mana Anda dapat bekerja dengan platform secara otomatis.  Di Terminus, Anda dapat membuat lingkungan multidev dari baris perintah - ideal untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitLab CI</a> . </p><br><p>  Kami membutuhkan permintaan gabungan baru untuk mengujinya.  Buat cabang baru menggunakan <code>git checkout -b auto-multidev-creation</code> . </p><br><p>  Untuk menggunakan Terminus dalam tugas-tugas GitLab CI / CD, Anda memerlukan token mesin untuk otentikasi dalam Terminus dan gambar kontainer dengan Terminus. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Buat token mesin Pantheon</a> , simpan di tempat yang aman, dan tambahkan sebagai variabel lingkungan global di GitLab dengan nama <code>PANTHEON_MACHINE_TOKEN</code> . </p><br><blockquote>  Jika Anda lupa cara menambahkan variabel lingkungan GitLab, kembali ke tempat kami mendefinisikan <code>PANTHEON_SITE</code> . </blockquote><br><h3 id="sozdaem-dockerfile-s-terminus">  Buat Dockerfile dengan Terminus </h3><br><p>  Jika Anda tidak menggunakan Docker atau tidak suka <code>Dockerfile</code> , ambil my <code>registry.gitlab.com/ataylorme/pantheon-gitlab-blog-demo:latest</code> gambar terbaru dan lewati bagian ini. </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GitLab memiliki registry kontainer di</a> mana Anda dapat membangun dan meng-host Dockerfile untuk proyek kami.  Mari kita membuat Dockerfile dengan Terminus untuk bekerja dengan Pantheon. </p><br><p>  Terminus adalah alat baris perintah dalam PHP, jadi mari kita mulai dengan gambar PHP.  Saya menginstal Terminus melalui Composer, jadi saya akan mengambil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">gambar Docker Composer resmi</a> sebagai basisnya.  Buat <code>Dockerfile</code> di direktori repositori lokal dengan konten berikut: </p><br><pre> <code class="plaintext hljs"># Use the official Composer image as a parent image FROM composer:1.8 # Update/upgrade apk RUN apk update RUN apk upgrade # Make the Terminus directory RUN mkdir -p /usr/local/share/terminus # Install Terminus 2.x with Composer RUN /usr/bin/env COMPOSER_BIN_DIR=/usr/local/bin composer -n --working-dir=/usr/local/share/terminus require pantheon-systems/terminus:"^2"</code> </pre> <br><p>  Ikuti instruksi untuk merakit dan mengirim gambar dari bagian <em>Bangun dan dorong gambar</em> dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi registrasi kontainer</a> untuk mengumpulkan gambar dari <code>Dockerfile</code> dan mengirimkannya ke GitLab. </p><br><p>  Buka bagian <em>Registry</em> di proyek GitLab.  Jika semuanya berjalan sesuai rencana, akan ada citra kita.  Rekam tautan ke tag gambar - kami membutuhkannya untuk file <code>.gitlab-ci.yml</code> . </p><br><p> <a href=""><img src="https://habrastorage.org/webt/_x/ta/yn/_xtayn5xz10hq5kuv7abvqvskgq.png"></a> </p><br><p>  Bagian <code>script</code> dalam <code>deploy:multidev</code> mulai tumbuh, jadi mari kita pindahkan ke file terpisah.  Buat file <code>private/multidev-deploy.sh:</code> </p><br><pre> <code class="plaintext hljs">#!/bin/bash # Store the mr- environment name export PANTHEON_ENV=mr-$CI_MERGE_REQUEST_IID # Authenticate with Terminus terminus auth:login --machine-token=$PANTHEON_MACHINE_TOKEN # Checkout the merge request source branch git checkout $CI_COMMIT_REF_NAME # Add the Pantheon Git repository as an additional remote git remote add pantheon $PANTHEON_GIT_URL # Push the merge request source branch to Pantheon git push pantheon $CI_COMMIT_REF_NAME:$PANTHEON_ENV --force # Create a function for determining if a multidev exists TERMINUS_DOES_MULTIDEV_EXIST() { # Stash a list of Pantheon multidev environments PANTHEON_MULTIDEV_LIST="$(terminus multidev:list ${PANTHEON_SITE} --format=list --field=id)" while read -r multiDev; do if [[ "${multiDev}" == "$1" ]] then return 0; fi done &lt;&lt;&lt; "$PANTHEON_MULTIDEV_LIST" return 1; } # If the mutltidev doesn't exist if ! TERMINUS_DOES_MULTIDEV_EXIST $PANTHEON_ENV then # Create it with Terminus echo "No multidev for $PANTHEON_ENV found, creating one..." terminus multidev:create $PANTHEON_SITE.dev $PANTHEON_ENV else echo "The multidev $PANTHEON_ENV already exists, skipping creating it..." fi</code> </pre> <br><p>  Script terletak di direktori pribadi dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak menyediakan akses web di Pantheon</a> .  Kami memiliki skrip untuk logika multidev kami.  Sekarang mari kita perbarui <code>deploy:multidev</code> file <code>.gitlab-ci.yml</code> untuk mendapatkan ini: </p><br><pre> <code class="plaintext hljs">deploy:multidev: stage: deploy environment: name: multidev/mr-$CI_MERGE_REQUEST_IID url: https://mr-$CI_MERGE_REQUEST_IID-$PANTHEON_SITE.pantheonsite.io/ script: # Run the multidev deploy script - "/bin/bash ./private/multidev-deploy.sh" only: - merge_requests</code> </pre> <br><p>  Kami perlu memastikan bahwa tugas kami dilakukan dalam gambar khusus yang dibuat, jadi kami menambahkan <code>image</code> definisi dengan URL registri di <code>.gitlab-ci.yml</code> .  Hasilnya, kami mendapat <code>.gitlab-ci.yml</code> berikut: </p><br><pre> <code class="plaintext hljs">image: registry.gitlab.com/ataylorme/pantheon-gitlab-blog-demo:latest stages: - deploy before_script: # See https://docs.gitlab.com/ee/ci/ssh_keys/README.html - eval $(ssh-agent -s) - echo "$SSH_PRIVATE_KEY" | tr -d '\r' | ssh-add - &gt; /dev/null - mkdir -p $HOME/.ssh &amp;&amp; echo "StrictHostKeyChecking no" &gt;&gt; "$HOME/.ssh/config" - git config --global user.email "$GITLAB_USER_EMAIL" - git config --global user.name "Gitlab CI" deploy:dev: stage: deploy environment: name: dev url: https://dev-$PANTHEON_SITE.pantheonsite.io/ script: - git remote add pantheon $PANTHEON_GIT_URL - git push pantheon master --force only: - master deploy:multidev: stage: deploy environment: name: multidev/mr-$CI_MERGE_REQUEST_IID url: https://mr-$CI_MERGE_REQUEST_IID-$PANTHEON_SITE.pantheonsite.io/ script: # Run the multidev deploy script - "/bin/bash ./private/multidev-deploy.sh" only: - merge_requests</code> </pre> <br><p>  Tambahkan, komit, dan kirim <code>private/multidev-deploy.sh</code> dan <code>.gitlab-ci.yml</code> .  Sekarang kembali ke GitLab dan tunggu tugas CI / CD selesai.  Bersabarlah: multidev dapat memakan waktu beberapa menit. </p><br><p>  Lalu kita pergi menonton daftar multidev di Pantheon.  Astaga!  Lingkungan multidev <code>mr-2</code> sudah ada di sini. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/gx/jf/ab/gxjfabnawlvvtncrg268q7nwkiw.png"></a> </p><br><h3 id="zaklyuchenie">  Kesimpulan </h3><br><p>  Tim saya mendapatkan lebih banyak kesenangan ketika kami mulai membuka permintaan penggabungan dan membuat lingkungan secara otomatis. </p><br><p>  Dengan alat GitLab dan Pantheon yang kuat, Anda dapat menghubungkan GitLab ke Pantheon secara otomatis. </p><br><p>  Setelah kami menggunakan GitLab CI / CD, alur kerja kami adalah tempat untuk tumbuh.  Berikut adalah beberapa ide untuk memulai: </p><br><ul><li>  Tambahkan langkah pembangunan. </li><li>  Tambahkan pengujian otomatis. </li><li>  Tambahkan tugas untuk memastikan kepatuhan dengan standar kode. </li><li>  Tambahkan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pengujian keamanan aplikasi dinamis</a> . </li></ul><br><p>  Tulis pendapat Anda tentang GitLab, Pantheon, dan otomatisasi. </p><br><p>  PS Tahukah Anda bahwa Terminus, alat baris perintah Pantheon, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dapat diperluas melalui plugin</a> ? </p><br><p>  Kami di Pantheon bekerja keras pada versi 2 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">plugin</a> kami <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">untuk alat bantu pembangunan Terminus yang</a> diaktifkan GitLab.  Jika Anda tidak ingin mengotak-atik pengaturan untuk setiap proyek, coba plugin ini dan bantu kami menguji beta v2.  Untuk Terminus <code>build:project:create</code> perintah, Anda hanya perlu token Pantheon dan token GitLab.  Dia akan menggunakan satu contoh proyek dengan Komposer dan pengujian otomatis, membuat proyek baru di GitLab, situs Pantheon baru, dan menghubungkannya menggunakan variabel lingkungan dan kunci SSH. </p><br><h3 id="ob-avtore">  Tentang penulis </h3><br><p>  Andrew Taylor menciptakan alat pengembang di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pantheon</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id447966/">https://habr.com/ru/post/id447966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id447956/index.html">Komunikasi kuantum di Universitas ITMO - proyek sistem transfer data yang tidak dapat dipecahkan</a></li>
<li><a href="../id447958/index.html">CJM untuk pemicu palsu antivirus DrWeb</a></li>
<li><a href="../id447960/index.html">Veeam Linux Backup pada Elbrus OS. Substitusi Impor ['?' | '.' | '!']</a></li>
<li><a href="../id447962/index.html">Peretas dapat mengontrol Tesla Model S dari jarak jauh menggunakan sistem autopilot</a></li>
<li><a href="../id447964/index.html">Pengujian Komputer Mikro untuk IoT</a></li>
<li><a href="../id447968/index.html">Menulis di Rust + CUDA C</a></li>
<li><a href="../id447970/index.html">Logging Javascript Super Sederhana - Dua Dekorator, dan Selesai</a></li>
<li><a href="../id447976/index.html">Pengembangan dan perakitan lampu foto</a></li>
<li><a href="../id447980/index.html">Mengapa sangat penting untuk Berinvestasi dan Mengembangkan aplikasi Taksi bermerek untuk usaha Anda?</a></li>
<li><a href="../id447982/index.html">Intisari: 10 materi tentang layar dan proyektor untuk home theater</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>