<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üññüèø üêÅ üìÉ Demande d'API avec React Hooks, HOC ou Render Prop üï¥üèª ‚òïÔ∏è üëì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Consid√©rez la mise en ≈ìuvre de la demande de donn√©es √† l'API en utilisant le nouvel ami React Hooks et les bons vieux amis Render Prop et HOC (Higher ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Demande d'API avec React Hooks, HOC ou Render Prop</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453866/"><p><img src="https://habrastorage.org/webt/s8/xs/sy/s8xssyovbjdd26lj5n-4sbi5obu.jpeg"></p><br><p>  Consid√©rez la mise en ≈ìuvre de la demande de donn√©es √† l'API en utilisant le nouvel ami React Hooks et les bons vieux amis Render Prop et HOC (Higher Order Component).  D√©couvrez si un nouvel ami est vraiment meilleur que les deux anciens. </p><a name="habracut"></a><br><p>  La vie ne s'arr√™te pas, React √©volue pour le mieux.  En f√©vrier 2019, React Hooks est apparu dans React 16.8.0.  Maintenant, dans les composants fonctionnels, vous pouvez travailler avec l'√©tat local et effectuer des effets secondaires.  Personne ne croyait que c'√©tait possible, mais tout le monde l'a toujours voulu.  Si vous n'√™tes pas √† jour avec les d√©tails, cliquez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> pour plus de d√©tails. </p><br><p>  React Hooks permet d'abandonner enfin les mod√®les tels que HOC et Render Prop.  Parce que pendant l'utilisation, un certain nombre de r√©clamations se sont accumul√©es contre eux: </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  RProp </th><th>  Hoc </th></tr></thead><tbody><tr><td>  1. Nombreux composants wrapper difficiles √† comprendre dans React DevTools et dans le code. </td><td>  (‚óïÔ∏µ‚óï) </td><td>  (‚óïÔ∏µ‚óï) </td></tr><tr><td>  2. Il est difficile de taper (Flow, TypeScript). </td><td></td><td>  (‚óïÔ∏µ‚óï) </td></tr><tr><td>  3. Il n'est pas √©vident de savoir de quel HOC les accessoires du composant re√ßoivent, ce qui complique le processus de d√©bogage et la compr√©hension du fonctionnement du composant. </td><td></td><td>  (‚óïÔ∏µ‚óï) </td></tr><tr><td>  4. Le plus souvent, Render Prop n'ajoute pas de mises en page, bien qu'il soit utilis√© en interne par JSX. </td><td>  (‚óïÔ∏µ‚óï) </td><td></td></tr><tr><td>  5. Accessoires de collision cl√©s.  Lors de la transmission d'accessoires des parents, les m√™mes cl√©s peuvent √™tre remplac√©es par des valeurs du HOC. </td><td></td><td>  (‚óïÔ∏µ‚óï) </td></tr><tr><td>  6. Il est difficile de lire git diff, car toute l'indentation dans JSX est d√©cal√©e lors de l'encapsulation de JSX dans Render Prop. </td><td>  (‚óïÔ∏µ‚óï) </td><td></td></tr><tr><td>  7. S'il y a plusieurs HOC, vous pouvez faire une erreur avec la s√©quence de la composition.  L'ordre correct n'est pas toujours √©vident, car la logique est cach√©e √† l'int√©rieur du HOC.  Par exemple, lorsque nous v√©rifions pour la premi√®re fois si l'utilisateur est autoris√©, et seulement ensuite, nous demandons des donn√©es personnelles. </td><td></td><td>  (‚óïÔ∏µ‚óï) </td></tr></tbody></table></div><br><p>  Afin de ne pas √™tre infond√©, regardons un exemple de la fa√ßon dont React Hooks est meilleur (ou peut-√™tre pire) Render Prop.  Nous consid√©rerons Render Prop, pas HOC, car dans la mise en ≈ìuvre, ils sont tr√®s similaires et HOC a plus d'inconv√©nients.  Essayons d'√©crire un utilitaire qui traite la demande de donn√©es vers l'API.  Je suis s√ªr que beaucoup ont √©crit cela dans leur vie des centaines de fois, eh bien, voyons si c'est encore mieux et plus facile. </p><br><p>  Pour cela, nous utiliserons la biblioth√®que axios populaire.  Dans le sc√©nario le plus simple, vous devez traiter les √©tats suivants: </p><br><ul><li>  processus d'acquisition de donn√©es (isFetching) </li><li>  donn√©es re√ßues avec succ√®s (responseData) </li><li>  erreur de r√©ception des donn√©es (erreur) </li><li>  l'annulation de la demande, si au cours de son ex√©cution les param√®tres de la demande ont chang√©, et un nouveau </li><li>  annulation d'une demande si ce composant n'est plus dans le DOM </li></ul><br><p>  <strong>1. Sc√©nario simple</strong> </p><br><p>  Nous √©crirons l'√©tat par d√©faut et une fonction (r√©ducteur) qui change d'√©tat en fonction du r√©sultat de la requ√™te: succ√®s / erreur. </p><br><div class="spoiler">  <b class="spoiler_title">Qu'est-ce que le r√©ducteur?</b> <div class="spoiler_text"><p>  Pour r√©f√©rence.  Reducer nous est venu de la programmation fonctionnelle, et pour la plupart des d√©veloppeurs JS de Redux.  Il s'agit d'une fonction qui prend un √©tat et une action pr√©c√©dents et renvoie l'√©tat suivant. </p></div></div><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = { <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"fetched"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: action.payload }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"error"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload }; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br><p>  Nous r√©utilisons cette fonction dans deux approches. </p><br><p>  <strong>Accessoire de rendu</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderProp1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = defaultState; axiosSource = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; tryToCancel() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource.cancel(); } } dispatch(action) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prevState</span></span></span><span class="hljs-function"> =&gt;</span></span> reducer(prevState, action)); } fetch = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tryToCancel(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource = axios.CancelToken.source(); axios .get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url, { <span class="hljs-attr"><span class="hljs-attr">cancelToken</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource.token }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"fetched"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: response.data }); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: error }); }); }; componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } componentDidUpdate(prevProps) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevProps.url !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } } componentWillUnmount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tryToCancel(); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }</code> </pre><br><p>  <strong>Crochets React</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useRequest1 = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, defaultState); React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> source = axios.CancelToken.source(); axios .get(url, { <span class="hljs-attr"><span class="hljs-attr">cancelToken</span></span>: source.token }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"fetched"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: response.data }); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: error }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source.cancel; }, [url]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state]; };</code> </pre> <br><p>  Par url, √† partir du composant utilis√©, nous obtenons les donn√©es - axios.get ().  Nous traitons le succ√®s et l'erreur, en changeant d'√©tat par l'envoi (action).  Retourne l'√©tat au composant.  Et n'oubliez pas d'annuler la demande si l'url change ou si le composant est supprim√© du DOM.  C'est simple, mais vous pouvez √©crire de diff√©rentes mani√®res.  Nous mettons en √©vidence les avantages et les inconv√©nients des deux approches: </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  Crochets </th><th>  RProp </th></tr></thead><tbody><tr><td>  1. Moins de code. </td><td>  (‚óë‚Äø‚óê) </td><td></td></tr><tr><td>  2. L'appel de l'effet secondaire (demande de donn√©es dans l'API) est plus facile √† lire, car il est √©crit de fa√ßon lin√©aire, et non r√©parti sur les cycles de vie du composant. </td><td>  (‚óë‚Äø‚óê) </td><td></td></tr><tr><td>  3. L'annulation de la demande est √©crite imm√©diatement apr√®s l'appel de la demande.  Tout en un seul endroit. </td><td>  (‚óë‚Äø‚óê) </td><td></td></tr><tr><td>  4. Code simple qui d√©crit les param√®tres de suivi pour d√©clencher des effets secondaires. </td><td>  (‚óë‚Äø‚óê) </td><td></td></tr><tr><td>  5. √âvidemment, dans quel cycle de vie des composants notre code sera ex√©cut√©. </td><td></td><td>  (‚óë‚Äø‚óê) </td></tr></tbody></table></div><br><p>  React Hooks vous permet d'√©crire moins de code, et c'est un fait incontestable.  Cela signifie que votre efficacit√© en tant que d√©veloppeur augmente.  Mais vous devez ma√Ætriser un nouveau paradigme. </p><br><p>  Lorsqu'il y a des noms de cycles de vie des composants, tout est tr√®s clair.  Tout d'abord, nous obtenons les donn√©es apr√®s que le composant est apparu √† l'√©cran (componentDidMount), puis nous les obtenons √† nouveau si props.url a chang√© et avant cela, nous n'oublions pas d'annuler la demande pr√©c√©dente (componentDidUpdate), si le composant a √©t√© supprim√© du DOM, puis annuler la demande (componentWillUnmount) . </p><br><p>  Mais maintenant, nous provoquons un effet secondaire directement dans le rendu, on nous a appris que ce n'est pas possible.  Bien que stop, pas vraiment dans le rendu.  Et √† l'int√©rieur de la fonction useEffect, qui effectuera quelque chose de mani√®re asynchrone apr√®s chaque rendu, ou plut√¥t validera et rendra le nouveau DOM. </p><br><p>  Mais nous n'avons pas besoin apr√®s chaque rendu, mais uniquement lors du premier rendu et en cas de modification de l'URL, que nous indiquons comme deuxi√®me argument √† utiliserEffet. </p><br><div class="spoiler">  <b class="spoiler_title">Nouveau paradigme</b> <div class="spoiler_text"><p>  Comprendre le fonctionnement de React Hooks n√©cessite de prendre conscience de nouvelles choses.  Par exemple, la diff√©rence entre les phases: commit et render.  Dans la phase de rendu, React calcule les modifications √† appliquer dans le DOM en les comparant avec le r√©sultat du rendu pr√©c√©dent.  Et dans la phase de validation, React applique ces modifications au DOM.  C'est dans la phase de validation que les m√©thodes sont appel√©es: componentDidMount et componentDidUpdate.  Mais ce qui est √©crit dans useEffect sera appel√© apr√®s la validation de mani√®re asynchrone et, par cons√©quent, ne bloquera pas le rendu DOM si vous d√©cidez soudainement accidentellement de synchroniser beaucoup de choses dans l'effet secondaire. </p><br><p>  Conclusion - utilisez useEffect.  Ecrire moins et plus en s√©curit√©. </p><br><p>  Et une autre grande fonctionnalit√©: useEffect peut nettoyer apr√®s l'effet pr√©c√©dent et apr√®s avoir supprim√© le composant du DOM.  Merci √† Rx qui a inspir√© l'√©quipe React pour cette approche. </p></div></div><br><p>  L'utilisation de notre utilitaire avec React Hooks est √©galement beaucoup plus pratique. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarRenderProp1 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">RenderProp</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">https:</span></span></span></span><span class="xml"><span class="hljs-tag">//</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">api.github.com</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">users</span></span></span></span><span class="xml"><span class="hljs-tag">/${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag">}`}&gt;</span></span></span><span class="xml"> {state =&gt; { if (state.isFetching) { return "Loading"; } if (state.error) { return "Error"; } return </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{state.responseData.avatar_url}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; }} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">RenderProp</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> );</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarWithHook1 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state] = useRequest(<span class="hljs-string"><span class="hljs-string">`https://api.github.com/users/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${username}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.isFetching) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Loading"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.error) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Error"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{state.responseData.avatar_url}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; };</span></span></code> </pre> <br><p>  L'option React Hooks semble √† nouveau plus compacte et plus √©vidente. </p><br><p>  Prop Render Prop: </p><br><p>  1) on ne sait pas si la mise en page est ajout√©e ou seulement la logique <br>  2) si vous devez traiter l'√©tat de Render Prop dans l'√©tat local ou dans les cycles de vie du composant enfant, vous devrez cr√©er un nouveau composant </p><br><p>  Ajoutez une nouvelle fonctionnalit√© - recevoir des donn√©es avec de nouveaux param√®tres par action de l'utilisateur.  Je voulais, par exemple, un bouton qui obtienne un avatar de votre d√©veloppeur pr√©f√©r√©. </p><br><p>  <strong>2) Mise √† jour des donn√©es d'action de l'utilisateur</strong> </p><br><p>  Ajoutez un bouton qui envoie une demande avec un nouveau nom d'utilisateur.  La solution la plus simple consiste √† stocker le nom d'utilisateur dans l'√©tat local du composant et √† transf√©rer le nouveau nom d'utilisateur de l'√©tat, et non les accessoires comme il l'est maintenant.  Mais nous aurons ensuite un copier-coller partout o√π nous aurons besoin de fonctionnalit√©s similaires.  Nous avons donc mis cette fonctionnalit√© dans notre utilitaire. </p><br><p>  Nous allons l'utiliser comme ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Avatar2 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> { ... &lt;button onClick={() =&gt; update(<span class="hljs-string"><span class="hljs-string">"https://api.github.com/users/NewUsername"</span></span>)} &gt; Update avatar <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> New Username &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; ... };</span></span></code> </pre> <br><p>  √âcrivons une impl√©mentation.  Ci-dessous sont √©crits uniquement les changements par rapport √† la version originale. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { ... case <span class="hljs-string"><span class="hljs-string">"update url"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: action.payload }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"update url manually"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: state.defaultUrl }; ... } }</code> </pre> <br><p>  <strong>Accessoire de rendu</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderProp2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = { <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> getDerivedStateFromProps(props, state) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.defaultUrl !== props.url) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reducer(state, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: props.url }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } ... componentDidUpdate(prevProps, prevState) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevState.url !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.url) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } } ... update = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url manually"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: url }); }; render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update); } }</code> </pre> <br><p>  <strong>Crochets React</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useRequest2 = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, { url, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url !== state.defaultUrl) { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: url }); } React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { ‚Ä¶(fetch data); }, [state.url]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> update = React.useCallback( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url manually"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: url }); }, [dispatch] ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state, update]; };</code> </pre> <br><p>  Si vous avez regard√© attentivement le code, vous avez remarqu√©: </p><br><ul><li>  l'url a commenc√© √† √™tre stock√©e dans notre utilitaire; </li><li>  defaultUrl semble identifier que l'url a √©t√© mise √† jour via des accessoires.  Nous devons surveiller le changement de props.url, sinon une nouvelle demande ne sera pas envoy√©e; </li><li>  ajout de la fonction de mise √† jour, que nous renvoyons au composant pour envoyer une nouvelle demande en cliquant sur le bouton. </li></ul><br><p>  Notez qu'avec Render Prop, nous avons d√ª utiliser getDerivedStateFromProps pour mettre √† jour l'√©tat local en cas de changement de props.url.  Et avec React Hooks aucune nouvelle abstraction, vous pouvez imm√©diatement appeler la mise √† jour de l'√©tat dans le rendu - hourra, camarades, enfin! </p><br><p>  La seule complication avec React Hooks √©tait de m√©moriser la fonction de mise √† jour afin qu'elle ne change pas entre les mises √† jour des composants.  Lorsque, comme dans Render Prop, la fonction de mise √† jour est une m√©thode de classe. </p><br><p>  <strong>3) Interrogation de l'API au m√™me intervalle ou Interrogation</strong> </p><br><p>  Ajoutons une autre fonctionnalit√© populaire.  Parfois, vous devez constamment interroger l'API.  Vous ne savez jamais que votre d√©veloppeur pr√©f√©r√© a chang√© la photo de profil et vous n'√™tes pas au courant.  Ajoutez le param√®tre d'intervalle. </p><br><p>  Utilisation: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarRenderProp3 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">RenderProp</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">https:</span></span></span></span><span class="xml"><span class="hljs-tag">//</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">api.github.com</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">users</span></span></span></span><span class="xml"><span class="hljs-tag">/${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pollInterval</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{1000}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ...</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarWithHook3 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, update] = useRequest( <span class="hljs-string"><span class="hljs-string">`https://api.github.com/users/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${username}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span> ); ...</code> </pre> <br><p>  R√©alisation: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer3</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { ... case <span class="hljs-string"><span class="hljs-string">"poll"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">requestId</span></span>: state.requestId + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; ... } }</code> </pre> <br><p>  <strong>Accessoire de rendu</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderProp3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = { ... requestId: <span class="hljs-number"><span class="hljs-number">1</span></span>, } ... timeoutId = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; ... tryToClearTimeout() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timeoutId) { clearTimeout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timeoutId); } } poll = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tryToClearTimeout(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timeoutId = setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'poll'</span></span> }); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pollInterval); }; ... componentDidUpdate(prevProps, prevState) { ... if (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pollInterval) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( prevState.isFetching !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.isFetching &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.isFetching ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.poll(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevState.requestId !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.requestId) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } } } componentWillUnmount() { ... this.tryToClearTimeout(); } ...</code> </pre><br><p>  <strong>Crochets React</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useRequest3 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, pollInterval</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, { ... requestId: <span class="hljs-number"><span class="hljs-number">1</span></span>, }); React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { ‚Ä¶(fetch data) }, [state.url, state.requestId]); React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pollInterval || state.isFetching) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> timeoutId = setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"poll"</span></span> }); }, pollInterval); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { clearTimeout(timeoutId); }; }, [pollInterval, state.isFetching]); ... }</code> </pre> <br><p>  Un nouvel accessoire est apparu - pollInterval.  √Ä la fin de la demande pr√©c√©dente via setTimeout, nous incr√©mentons requestId.  Avec les hooks, nous avons un autre useEffect, dans lequel nous appelons setTimeout.  Et notre ancien useEffect, qui envoie une demande, a commenc√© √† surveiller une autre variable - requestId, qui nous dit que setTimeout a fonctionn√©, et il est temps d'envoyer la demande d'un nouvel avatar. </p><br><p>  Dans Render Prop, j'ai d√ª √©crire: </p><br><ol><li>  comparaison des valeurs requestId et isFetching pr√©c√©dentes et nouvelles </li><li>  clear timeoutId √† deux endroits </li><li>  ajoutez la propri√©t√© timeoutId √† la classe </li></ol><br><p>  React Hooks vous permet d'√©crire bri√®vement et clairement ce que nous avons utilis√© pour d√©crire plus en d√©tail et n'est pas toujours clair. </p><br><p>  <strong>4) Et ensuite?</strong> <br>  Nous pouvons continuer √† √©tendre les fonctionnalit√©s de notre utilitaire: accepter diff√©rentes configurations de param√®tres de requ√™te, mettre en cache les donn√©es, convertir une r√©ponse et des erreurs, mettre √† jour de force les donn√©es avec les m√™mes param√®tres - op√©rations de routine dans toute grande application Web.  Sur notre projet, nous avons depuis longtemps int√©gr√© ceci dans un composant s√©par√© (attention!).  Oui, car il s'agissait d'un accessoire de rendu.  Mais avec la sortie de Hooks, nous avons r√©√©crit la fonction (useAxiosRequest) et m√™me trouv√© quelques bugs dans l'ancienne impl√©mentation.  Vous pouvez voir et essayer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr453866/">https://habr.com/ru/post/fr453866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr453850/index.html">Syst√®me de cr√©dit social chinois - le diable est-il si terrible?</a></li>
<li><a href="../fr453852/index.html">Microbiota. Comment prendre soin des bact√©ries intestinales</a></li>
<li><a href="../fr453860/index.html">AMD pr√©sente ses nouveaux processeurs 7 nm personnalis√©s Ryzen de troisi√®me g√©n√©ration</a></li>
<li><a href="../fr453862/index.html">Pourquoi vous devriez utiliser pathlib</a></li>
<li><a href="../fr453864/index.html">Utiliser une souris et un clavier sur des consoles, c'est tricher?</a></li>
<li><a href="../fr453868/index.html">Mini interrupteur tactile avec panneau en verre sur nRF52832</a></li>
<li><a href="../fr453870/index.html">Nous √©crivons le proxy Reverse socks5 sur PowerShell. Partie 1</a></li>
<li><a href="../fr453872/index.html">Restauration de photos √† l'aide de r√©seaux de neurones</a></li>
<li><a href="../fr453874/index.html">De la roulette russe au LOTO s√©curis√©: comment prot√©ger le personnel du centre de donn√©es</a></li>
<li><a href="../fr453876/index.html">Comme dans Yandex.Practicum, le front desync a gagn√©: un num√©ro acrobatique avec Redux-Saga, postMessage et Jupyter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>