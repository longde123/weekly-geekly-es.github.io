<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§™ ğŸŒœ ğŸ—£ï¸ å…·æœ‰React Hooksï¼ŒHOCæˆ–Render Propçš„APIè¯·æ±‚ ğŸ†’ ğŸ‘— ğŸ¦’</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è®©æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨æ–°æœ‹å‹React Hookså’Œå¥½æœ‹å‹Render Propå’ŒHOCï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰å¯¹APIçš„æ•°æ®è¯·æ±‚çš„å®ç°ã€‚ æ‰¾å‡ºæ–°æœ‹å‹æ˜¯å¦çœŸçš„æ¯”æ—§æœ‹å‹å¥½ã€‚ 


 ç”Ÿæ´»ä¸ä¼šåœæ»ä¸å‰ï¼ŒReactå˜å¾—è¶Šæ¥è¶Šå¥½ã€‚ åœ¨2019å¹´2æœˆï¼ŒReact Hookså‡ºç°åœ¨React 16.8.0ä¸­ã€‚ ç°åœ¨ï¼Œåœ¨åŠŸèƒ½ç»„ä»¶ä¸­ï¼Œ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>å…·æœ‰React Hooksï¼ŒHOCæˆ–Render Propçš„APIè¯·æ±‚</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453866/"><p><img src="https://habrastorage.org/webt/s8/xs/sy/s8xssyovbjdd26lj5n-4sbi5obu.jpeg"></p><br><p> è®©æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨æ–°æœ‹å‹React Hookså’Œå¥½æœ‹å‹Render Propå’ŒHOCï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰å¯¹APIçš„æ•°æ®è¯·æ±‚çš„å®ç°ã€‚ æ‰¾å‡ºæ–°æœ‹å‹æ˜¯å¦çœŸçš„æ¯”æ—§æœ‹å‹å¥½ã€‚ </p><a name="habracut"></a><br><p> ç”Ÿæ´»ä¸ä¼šåœæ»ä¸å‰ï¼ŒReactå˜å¾—è¶Šæ¥è¶Šå¥½ã€‚ åœ¨2019å¹´2æœˆï¼ŒReact Hookså‡ºç°åœ¨React 16.8.0ä¸­ã€‚ ç°åœ¨ï¼Œåœ¨åŠŸèƒ½ç»„ä»¶ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å±€éƒ¨çŠ¶æ€å¹¶æ‰§è¡Œå‰¯ä½œç”¨ã€‚ æ²¡æœ‰äººç›¸ä¿¡è¿™æ˜¯å¯èƒ½çš„ï¼Œä½†æ˜¯æ¯ä¸ªäººéƒ½ä¸€ç›´å¸Œæœ›ã€‚ å¦‚æœæ‚¨ä¸äº†è§£æœ€æ–°ä¿¡æ¯ï¼Œè¯·å•å‡»<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤å¤„</a>è·å–è¯¦ç»†ä¿¡æ¯ã€‚ </p><br><p>  React Hooksä½¿å¾—æœ€ç»ˆæ”¾å¼ƒè¯¸å¦‚HOCå’ŒRender Propä¹‹ç±»çš„æ¨¡å¼æˆä¸ºå¯èƒ½ã€‚ å› ä¸ºåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹å®ƒä»¬ç§¯ç´¯äº†è®¸å¤šä¸»å¼ ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  RProp </th><th> ç‰¹è®¾ </th></tr></thead><tbody><tr><td>  1.è®¸å¤šåŒ…è£…ç»„ä»¶åœ¨React DevToolså’Œä»£ç ä¸­å¾ˆéš¾ç†è§£ã€‚ </td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td></tr><tr><td>  2.å¾ˆéš¾é”®å…¥ï¼ˆFlowï¼ŒTypeScriptï¼‰ã€‚ </td><td></td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td></tr><tr><td>  3.å“ªä¸ªç»„ä»¶æ”¯æŒå“ªä¸ªHOCå¹¶ä¸æ˜æ˜¾ï¼Œè¿™ä½¿è°ƒè¯•è¿‡ç¨‹å’Œç†è§£ç»„ä»¶å¦‚ä½•å·¥ä½œå˜å¾—å¤æ‚ã€‚ </td><td></td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td></tr><tr><td>  4.å°½ç®¡JSXå†…éƒ¨ä½¿ç”¨Render Propï¼Œä½†é€šå¸¸ä¸æ·»åŠ å¸ƒå±€ã€‚ </td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td><td></td></tr><tr><td>  5.æŒ‰é”®ç¢°æ’é“å…·ã€‚ ä»çˆ¶æ¯é‚£é‡Œä¼ é€’é“å…·æ—¶ï¼Œç›¸åŒçš„é”®å¯ä»¥è¢«HOCä¸­çš„å€¼è¦†ç›–ã€‚ </td><td></td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td></tr><tr><td>  6.è¯»å–git difféå¸¸å›°éš¾ï¼Œå› ä¸ºå°†JSXåŒ…è£…åœ¨Render Propä¸­æ—¶ï¼ŒJSXä¸­çš„æ‰€æœ‰ç¼©è¿›éƒ½ä¼šç§»åŠ¨ã€‚ </td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td><td></td></tr><tr><td>  7.å¦‚æœæœ‰å¤šä¸ªHOCï¼Œåˆ™æ‚¨å¯èƒ½ä¼šè¯¯è®¤ä¸ºåˆæˆé¡ºåºã€‚ æ­£ç¡®çš„é¡ºåºå¹¶ä¸æ€»æ˜¯å¾ˆæ˜æ˜¾ï¼Œå› ä¸ºé€»è¾‘éšè—åœ¨HOCå†…éƒ¨ã€‚ ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¢«æˆæƒï¼Œç„¶åæ‰è¯·æ±‚ä¸ªäººæ•°æ®ã€‚ </td><td></td><td>  ï¼ˆâ—•ï¸µâ—•ï¼‰ </td></tr></tbody></table></div><br><p> ä¸ºäº†æ²¡æœ‰æ ¹æ®ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹è¯´æ˜React Hookså¦‚ä½•æ›´å¥½ï¼ˆæˆ–æ›´ç³Ÿï¼‰Render Propã€‚ æˆ‘ä»¬å°†è€ƒè™‘Render Propï¼Œè€Œä¸æ˜¯HOCï¼Œå› ä¸ºåœ¨å®ç°ä¸Šå®ƒä»¬éå¸¸ç›¸ä¼¼ï¼Œå¹¶ä¸”HOCå…·æœ‰æ›´å¤šç¼ºç‚¹ã€‚ è®©æˆ‘ä»¬å°è¯•ç¼–å†™ä¸€ä¸ªå®ç”¨ç¨‹åºæ¥å¤„ç†å¯¹APIçš„æ•°æ®è¯·æ±‚ã€‚ æˆ‘æ•¢è‚¯å®šï¼Œè®¸å¤šäººå·²ç»åœ¨ç”Ÿæ´»ä¸­å†™ä¸‹äº†æ•°ç™¾éï¼Œå¥½å§ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦æœ‰å¯èƒ½å˜å¾—è¶Šæ¥è¶Šå¥½ã€‚ </p><br><p> ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æµè¡Œçš„axiosåº“ã€‚ åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦å¤„ç†ä»¥ä¸‹çŠ¶æ€ï¼š </p><br><ul><li> æ•°æ®é‡‡é›†â€‹â€‹è¿‡ç¨‹ï¼ˆisFetchingï¼‰ </li><li> æ•°æ®æˆåŠŸæ¥æ”¶ï¼ˆresponseDataï¼‰ </li><li> æ¥æ”¶æ•°æ®æ—¶å‡ºé”™ï¼ˆé”™è¯¯ï¼‰ </li><li> å–æ¶ˆè¯·æ±‚ï¼Œå¦‚æœåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¯·æ±‚å‚æ•°å·²æ›´æ”¹ï¼Œå¹¶ä¸”æ‚¨éœ€è¦å‘é€æ–°çš„ </li><li> å¦‚æœæ­¤ç»„ä»¶ä¸å†åœ¨DOMä¸­ï¼Œåˆ™å–æ¶ˆè¯·æ±‚ </li></ul><br><p>  <strong>1.ç®€å•åœºæ™¯</strong> </p><br><p> æˆ‘ä»¬å°†ç¼–å†™é»˜è®¤çŠ¶æ€å’Œä¸€ä¸ªæ ¹æ®è¯·æ±‚ç»“æœæ›´æ”¹çŠ¶æ€çš„å‡½æ•°ï¼ˆç¼©å‡å™¨ï¼‰ï¼šæˆåŠŸ/é”™è¯¯ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ä»€ä¹ˆæ˜¯Reducerï¼Ÿ</b> <div class="spoiler_text"><p> ä¾›å‚è€ƒã€‚  Reduceræ¥è‡ªå‡½æ•°ç¼–ç¨‹ï¼Œå¯¹äºReduxçš„å¤§å¤šæ•°JSå¼€å‘äººå‘˜æ¥è¯´éƒ½æ˜¯å¦‚æ­¤ã€‚ æ­¤å‡½æ•°é‡‡ç”¨ä¸Šä¸€ä¸ªçŠ¶æ€å’Œæ“ä½œå¹¶è¿”å›ä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚ </p></div></div><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = { <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"fetched"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: action.payload }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"error"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: action.payload }; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre> <br><p> æˆ‘ä»¬é€šè¿‡ä¸¤ç§æ–¹æ³•é‡ç”¨æ­¤åŠŸèƒ½ã€‚ </p><br><p>  <strong>æ¸²æŸ“é“å…·</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderProp1</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = defaultState; axiosSource = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; tryToCancel() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource.cancel(); } } dispatch(action) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prevState</span></span></span><span class="hljs-function"> =&gt;</span></span> reducer(prevState, action)); } fetch = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tryToCancel(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource = axios.CancelToken.source(); axios .get(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url, { <span class="hljs-attr"><span class="hljs-attr">cancelToken</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.axiosSource.token }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"fetched"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: response.data }); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: error }); }); }; componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } componentDidUpdate(prevProps) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevProps.url !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } } componentWillUnmount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tryToCancel(); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state); }</code> </pre><br><p>  <strong>ååº”é’©</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useRequest1 = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, defaultState); React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> source = axios.CancelToken.source(); axios .get(url, { <span class="hljs-attr"><span class="hljs-attr">cancelToken</span></span>: source.token }) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"fetched"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: response.data }); }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"error"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: error }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source.cancel; }, [url]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state]; };</code> </pre> <br><p> é€šè¿‡ä½¿ç”¨çš„ç»„ä»¶çš„urlï¼Œæˆ‘ä»¬è·å¾—æ•°æ®-axios.getï¼ˆï¼‰ã€‚ æˆ‘ä»¬å¤„ç†æˆåŠŸå’Œé”™è¯¯ï¼Œé€šè¿‡è°ƒåº¦ï¼ˆæ“ä½œï¼‰æ›´æ”¹çŠ¶æ€ã€‚ å°†çŠ¶æ€è¿”å›åˆ°ç»„ä»¶ã€‚ å¹¶ä¸”ï¼Œå¦‚æœURLå‘ç”Ÿæ›´æ”¹æˆ–ä»DOMä¸­åˆ é™¤äº†ç»„ä»¶ï¼Œè¯·ä¸è¦å¿˜è®°å–æ¶ˆè¯·æ±‚ã€‚ è¿™å¾ˆç®€å•ï¼Œä½†æ˜¯æ‚¨å¯ä»¥ç”¨ä¸åŒçš„æ–¹å¼ç¼–å†™ã€‚ æˆ‘ä»¬é‡ç‚¹ä»‹ç»ä¸¤ç§æ–¹æ³•çš„ä¼˜ç¼ºç‚¹ï¼š </p><br><div class="scrollable-table"><table><thead><tr><th></th><th> é’©å­ </th><th>  RProp </th></tr></thead><tbody><tr><td>  1.æ›´å°‘çš„ä»£ç ã€‚ </td><td>  ï¼ˆâ—‘â€¿â—ï¼‰ </td><td></td></tr><tr><td>  2.è°ƒç”¨å‰¯ä½œç”¨ï¼ˆåœ¨APIä¸­è¯·æ±‚æ•°æ®ï¼‰æ›´å®¹æ˜“é˜…è¯»ï¼Œå› ä¸ºå®ƒæ˜¯çº¿æ€§ç¼–å†™çš„ï¼Œä¸ä¼šæ•£å¸ƒåœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ã€‚ </td><td>  ï¼ˆâ—‘â€¿â—ï¼‰ </td><td></td></tr><tr><td>  3.è¯·æ±‚å–æ¶ˆåç«‹å³å†™å…¥è¯·æ±‚å–æ¶ˆã€‚ å…¨éƒ¨é›†ä¸­åœ¨ä¸€å¤„ã€‚ </td><td>  ï¼ˆâ—‘â€¿â—ï¼‰ </td><td></td></tr><tr><td>  4.ç®€å•çš„ä»£ç ï¼Œæè¿°äº†ç”¨äºè§¦å‘å‰¯ä½œç”¨çš„è·Ÿè¸ªå‚æ•°ã€‚ </td><td>  ï¼ˆâ—‘â€¿â—ï¼‰ </td><td></td></tr><tr><td>  5.æ˜¾ç„¶ï¼Œæˆ‘ä»¬çš„ä»£ç å°†åœ¨å“ªä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­æ‰§è¡Œã€‚ </td><td></td><td>  ï¼ˆâ—‘â€¿â—ï¼‰ </td></tr></tbody></table></div><br><p>  React Hookså…è®¸æ‚¨ç¼–å†™æ›´å°‘çš„ä»£ç ï¼Œè¿™æ˜¯ä¸äº‰çš„äº‹å®ã€‚ è¿™æ„å‘³ç€æ‚¨ä½œä¸ºå¼€å‘äººå‘˜çš„æ•ˆç‡æ­£åœ¨æé«˜ã€‚ ä½†æ˜¯æ‚¨å¿…é¡»æŒæ¡ä¸€ä¸ªæ–°çš„èŒƒä¾‹ã€‚ </p><br><p> å½“æœ‰ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„åç§°æ—¶ï¼Œä¸€åˆ‡éƒ½éå¸¸æ¸…æ¥šã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ç»„ä»¶å‡ºç°åœ¨å±å¹•ä¸Šä¹‹åè·å–æ•°æ®ï¼ˆcomponentDidMountï¼‰ï¼Œç„¶åï¼Œå¦‚æœprops.urlå‘ç”Ÿäº†æ›´æ”¹ï¼Œæˆ‘ä»¬å°†å†æ¬¡è·å–æ•°æ®ï¼›åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸è¦å¿˜è®°å–æ¶ˆå…ˆå‰çš„è¯·æ±‚ï¼ˆcomponentDidUpdateï¼‰ï¼Œå¦‚æœå·²å°†ç»„ä»¶ä»DOMä¸­åˆ é™¤ï¼Œåˆ™å–æ¶ˆè¯·æ±‚ï¼ˆcomponentWillUnmountï¼‰ ã€‚ </p><br><p> ä½†æ˜¯ç°åœ¨æˆ‘ä»¬ç›´æ¥åœ¨æ¸²æŸ“ä¸­å¼•èµ·äº†å‰¯ä½œç”¨ï¼Œæˆ‘ä»¬è¢«å‘ŠçŸ¥è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚ å°½ç®¡åœæ­¢ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡æœ‰åœ¨æ¸²æŸ“ä¸­ã€‚ åœ¨useEffectå‡½æ•°å†…éƒ¨ï¼Œè¯¥å‡½æ•°å°†åœ¨æ¯æ¬¡æ¸²æŸ“åå¼‚æ­¥æ‰§è¡ŒæŸäº›æ“ä½œï¼Œæˆ–è€…æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæäº¤å¹¶æ¸²æŸ“æ–°çš„DOMã€‚ </p><br><p> ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨æ¯æ¬¡æ¸²æŸ“ä¹‹åï¼Œä»…åœ¨ç¬¬ä¸€ä¸ªæ¸²æŸ“æ—¶ä½¿ç”¨ï¼Œå¹¶ä¸”åœ¨æ›´æ”¹urlçš„æƒ…å†µä¸‹ï¼ˆæˆ‘ä»¬å°†å…¶è¡¨ç¤ºä¸ºuseEffectçš„ç¬¬äºŒä¸ªå‚æ•°ï¼‰ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">æ–°èŒƒå¼</b> <div class="spoiler_text"><p> äº†è§£React Hooksçš„å·¥ä½œæ–¹å¼éœ€è¦å¯¹æ–°äº‹ç‰©æœ‰æ‰€äº†è§£ã€‚ ä¾‹å¦‚ï¼Œé˜¶æ®µä¹‹é—´çš„å·®å¼‚ï¼šæäº¤å’Œæ¸²æŸ“ã€‚ åœ¨æ¸²æŸ“é˜¶æ®µï¼ŒReacté€šè¿‡ä¸ä¹‹å‰æ¸²æŸ“çš„ç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œè®¡ç®—å‡ºå“ªäº›æ›´æ”¹è¦åº”ç”¨åˆ°DOMä¸­ã€‚ åœ¨æäº¤é˜¶æ®µï¼ŒReactå°†è¿™äº›æ›´æ”¹åº”ç”¨äºDOMã€‚ æ–¹æ³•åœ¨æäº¤é˜¶æ®µè¢«è°ƒç”¨ï¼šcomponentDidMountå’ŒcomponentDidUpdateã€‚ ä½†æ˜¯useEffectä¸­ç¼–å†™çš„å†…å®¹å°†åœ¨æäº¤åå¼‚æ­¥è°ƒç”¨ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨çªç„¶æ— æ„ä¸­å†³å®šè¦åŒæ­¥è®¸å¤šå‰¯ä½œç”¨ï¼Œåˆ™ä¸ä¼šé˜»å¡DOMå‘ˆç°ã€‚ </p><br><p> ç»“è®º-ä½¿ç”¨useEffectã€‚ å†™å¾—æ›´å°‘ï¼Œæ›´å®‰å…¨ã€‚ </p><br><p> è¿˜æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½ï¼šuseEffectå¯ä»¥åœ¨ä¸Šä¸€ä¸ªæ•ˆæœä¹‹åä»¥åŠä»DOMä¸­åˆ é™¤è¯¥ç»„ä»¶ä¹‹åè¿›è¡Œæ¸…ç†ã€‚ æ„Ÿè°¢Rxå¯å‘äº†Reactå›¢é˜Ÿé‡‡ç”¨è¿™ç§æ–¹æ³•ã€‚ </p></div></div><br><p> å°†æˆ‘ä»¬çš„å®ç”¨ç¨‹åºä¸React Hooksä¸€èµ·ä½¿ç”¨ä¹Ÿæ›´åŠ æ–¹ä¾¿ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarRenderProp1 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">RenderProp</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">https:</span></span></span></span><span class="xml"><span class="hljs-tag">//</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">api.github.com</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">users</span></span></span></span><span class="xml"><span class="hljs-tag">/${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag">}`}&gt;</span></span></span><span class="xml"> {state =&gt; { if (state.isFetching) { return "Loading"; } if (state.error) { return "Error"; } return </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{state.responseData.avatar_url}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; }} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">RenderProp</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> );</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarWithHook1 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state] = useRequest(<span class="hljs-string"><span class="hljs-string">`https://api.github.com/users/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${username}</span></span></span><span class="hljs-string">`</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.isFetching) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Loading"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.error) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"Error"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{state.responseData.avatar_url}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"avatar"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">; };</span></span></code> </pre> <br><p>  React Hooksé€‰é¡¹å†æ¬¡æ˜¾å¾—æ›´åŠ ç´§å‡‘å’Œæ˜æ˜¾ã€‚ </p><br><p> ç¼ºç‚¹æ¸²æŸ“é“å…·ï¼š </p><br><p>  1ï¼‰ä¸æ¸…æ¥šæ˜¯æ·»åŠ å¸ƒå±€è¿˜æ˜¯ä»…æ·»åŠ é€»è¾‘ <br>  2ï¼‰å¦‚æœæ‚¨éœ€è¦åœ¨æœ¬åœ°çŠ¶æ€æˆ–å­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­å¤„ç†æ¥è‡ªRender Propçš„çŠ¶æ€ï¼Œåˆ™å¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°ç»„ä»¶ </p><br><p> æ·»åŠ æ–°åŠŸèƒ½-é€šè¿‡ç”¨æˆ·æ“ä½œæ¥æ”¶å¸¦æœ‰æ–°å‚æ•°çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œæˆ‘æƒ³è¦ä¸€ä¸ªæŒ‰é’®æ¥è·å–æ‚¨æœ€å–œæ¬¢çš„å¼€å‘äººå‘˜çš„å¤´åƒã€‚ </p><br><p>  <strong>2ï¼‰æ›´æ–°ç”¨æˆ·åŠ¨ä½œæ•°æ®</strong> </p><br><p> æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œä½¿ç”¨æ–°çš„ç”¨æˆ·åå‘é€è¯·æ±‚ã€‚ æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†ç”¨æˆ·åå­˜å‚¨åœ¨ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ä¸­ï¼Œç„¶åä»çŠ¶æ€ï¼ˆè€Œä¸æ˜¯ç°åœ¨çš„propsï¼‰ä¸­è½¬ç§»æ–°çš„ç”¨æˆ·åã€‚ ä½†æ˜¯ï¼Œåœ¨éœ€è¦ç±»ä¼¼åŠŸèƒ½çš„ä»»ä½•åœ°æ–¹ï¼Œæˆ‘ä»¬éƒ½ä¼šè¿›è¡Œå¤åˆ¶ç²˜è´´ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†æ­¤åŠŸèƒ½æ”¾å…¥äº†æˆ‘ä»¬çš„å®ç”¨ç¨‹åºã€‚ </p><br><p> æˆ‘ä»¬å°†åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Avatar2 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> { ... &lt;button onClick={() =&gt; update(<span class="hljs-string"><span class="hljs-string">"https://api.github.com/users/NewUsername"</span></span>)} &gt; Update avatar <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> New Username &lt;<span class="hljs-regexp"><span class="hljs-regexp">/button&gt; ... };</span></span></code> </pre> <br><p> è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªå®ç°ã€‚ ä¸‹é¢åªå†™äº†ä¸åŸå§‹ç‰ˆæœ¬ç›¸æ¯”çš„æ›´æ”¹ã€‚ </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { ... case <span class="hljs-string"><span class="hljs-string">"update url"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: action.payload }; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"update url manually"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: action.payload, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: state.defaultUrl }; ... } }</code> </pre> <br><p>  <strong>æ¸²æŸ“é“å…·</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderProp2</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = { <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.url, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> getDerivedStateFromProps(props, state) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (state.defaultUrl !== props.url) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> reducer(state, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: props.url }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } ... componentDidUpdate(prevProps, prevState) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevState.url !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.url) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } } ... update = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url manually"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: url }); }; render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.update); } }</code> </pre> <br><p>  <strong>ååº”é’©</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useRequest2 = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, { url, <span class="hljs-attr"><span class="hljs-attr">defaultUrl</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">responseData</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url !== state.defaultUrl) { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: url }); } React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { â€¦(fetch data); }, [state.url]); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> update = React.useCallback( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"update url manually"</span></span>, <span class="hljs-attr"><span class="hljs-attr">payload</span></span>: url }); }, [dispatch] ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [state, update]; };</code> </pre> <br><p> å¦‚æœæ‚¨ä»”ç»†æŸ¥çœ‹è¯¥ä»£ç ï¼Œåˆ™ä¼šå‘ç°ï¼š </p><br><ul><li>  urlå¼€å§‹å­˜å‚¨åœ¨æˆ‘ä»¬çš„å®ç”¨ç¨‹åºä¸­ï¼› </li><li>  defaultUrlä¼¼ä¹æ ‡è¯†è¯¥URLæ˜¯é€šè¿‡propsæ›´æ–°çš„ã€‚ æˆ‘ä»¬éœ€è¦ç›‘è§†props.urlçš„æ›´æ”¹ï¼Œå¦åˆ™å°†ä¸ä¼šå‘é€æ–°è¯·æ±‚ï¼› </li><li> æ·»åŠ äº†æ›´æ–°åŠŸèƒ½ï¼Œå•å‡»æŒ‰é’®ï¼Œæˆ‘ä»¬å°†è¿”å›åˆ°ç»„ä»¶ä»¥å‘é€æ–°è¯·æ±‚ã€‚ </li></ul><br><p> è¯·æ³¨æ„ï¼Œå¯¹äºæ¸²æŸ“é“å…·ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨getDerivedStateFromPropsæ¥æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼Œä»¥é˜²props.urlå‘ç”Ÿæ›´æ”¹ã€‚ ä½¿ç”¨React Hooksæ²¡æœ‰æ–°çš„æŠ½è±¡ï¼Œæ‚¨å¯ä»¥ç«‹å³åœ¨æ¸²æŸ“å™¨ä¸­è°ƒç”¨çŠ¶æ€æ›´æ–°-æ¬¢å‘¼ï¼ŒåŒå¿—ä»¬ï¼Œç»ˆäºï¼ </p><br><p> ä½¿ç”¨React Hooksçš„å”¯ä¸€éº»çƒ¦æ˜¯è®°ä½æ›´æ–°åŠŸèƒ½ï¼Œä»¥ä¾¿å®ƒä¸ä¼šåœ¨ç»„ä»¶æ›´æ–°ä¹‹é—´æ›´æ”¹ã€‚ å¦‚Render Propä¸­æ‰€è¿°ï¼Œæ›´æ–°åŠŸèƒ½æ˜¯ç±»æ–¹æ³•æ—¶ã€‚ </p><br><p>  <strong>3ï¼‰ä»¥ç›¸åŒçš„æ—¶é—´é—´éš”è½®è¯¢APIæˆ–è½®è¯¢</strong> </p><br><p> è®©æˆ‘ä»¬æ·»åŠ å¦ä¸€ä¸ªå—æ¬¢è¿çš„åŠŸèƒ½ã€‚ æœ‰æ—¶æ‚¨éœ€è¦ä¸æ–­æŸ¥è¯¢APIã€‚ æ‚¨æ°¸è¿œä¸ä¼šçŸ¥é“æ‚¨æœ€å–œæ¬¢çš„å¼€å‘äººå‘˜æ˜¯å¦æ›´æ”¹äº†ä¸ªäººèµ„æ–™å›¾ç‰‡ï¼Œè€Œä¸”æ‚¨ä¹Ÿä¸çŸ¥é“ã€‚ æ·»åŠ intervalå‚æ•°ã€‚ </p><br><p> ç”¨æ³•ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarRenderProp3 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">RenderProp</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag">`</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">https:</span></span></span></span><span class="xml"><span class="hljs-tag">//</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">api.github.com</span></span></span></span><span class="xml"><span class="hljs-tag">/</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">users</span></span></span></span><span class="xml"><span class="hljs-tag">/${</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag">}`} </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">pollInterval</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{1000}</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ...</span></span></code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> AvatarWithHook3 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ username }</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, update] = useRequest( <span class="hljs-string"><span class="hljs-string">`https://api.github.com/users/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${username}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-number"><span class="hljs-number">1000</span></span> ); ...</code> </pre> <br><p> å®ç°æ–¹å¼ï¼š </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reducer3</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { ... case <span class="hljs-string"><span class="hljs-string">"poll"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { ...state, <span class="hljs-attr"><span class="hljs-attr">requestId</span></span>: state.requestId + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">isFetching</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; ... } }</code> </pre> <br><p>  <strong>æ¸²æŸ“é“å…·</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderProp3</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ state = { ... requestId: <span class="hljs-number"><span class="hljs-number">1</span></span>, } ... timeoutId = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; ... tryToClearTimeout() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timeoutId) { clearTimeout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timeoutId); } } poll = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.tryToClearTimeout(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.timeoutId = setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'poll'</span></span> }); }, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pollInterval); }; ... componentDidUpdate(prevProps, prevState) { ... if (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.pollInterval) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( prevState.isFetching !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.isFetching &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.isFetching ) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.poll(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevState.requestId !== <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.requestId) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fetch(); } } } componentWillUnmount() { ... this.tryToClearTimeout(); } ...</code> </pre><br><p>  <strong>ååº”é’©</strong> </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> useRequest3 = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url, pollInterval</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [state, dispatch] = React.useReducer(reducer, { ... requestId: <span class="hljs-number"><span class="hljs-number">1</span></span>, }); React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { â€¦(fetch data) }, [state.url, state.requestId]); React.useEffect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pollInterval || state.isFetching) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> timeoutId = setTimeout(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch({ <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">"poll"</span></span> }); }, pollInterval); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { clearTimeout(timeoutId); }; }, [pollInterval, state.isFetching]); ... }</code> </pre> <br><p> å‡ºç°äº†ä¸€ä¸ªæ–°çš„é“å…·-pollIntervalã€‚ é€šè¿‡setTimeoutå®Œæˆä¸Šä¸€ä¸ªè¯·æ±‚åï¼Œæˆ‘ä»¬å¢åŠ requestIdã€‚ å¯¹äºé’©å­ï¼Œæˆ‘ä»¬è¿˜æœ‰å¦ä¸€ä¸ªuseEffectï¼Œåœ¨å…¶ä¸­è°ƒç”¨setTimeoutã€‚ æˆ‘ä»¬å‘é€è¯·æ±‚çš„æ—§useEffectå¼€å§‹ç›‘è§†å¦ä¸€ä¸ªå˜é‡-requestIdï¼Œè¯¥å˜é‡å‘Šè¯‰æˆ‘ä»¬setTimeoutæœ‰æ•ˆï¼Œç°åœ¨è¯¥å‘æ–°çš„åŒ–èº«å‘é€è¯·æ±‚äº†ã€‚ </p><br><p> åœ¨Render Propä¸­ï¼Œæˆ‘å¿…é¡»ç¼–å†™ï¼š </p><br><ol><li> æ¯”è¾ƒå…ˆå‰å’Œæ–°çš„requestIdå’ŒisFetchingå€¼ </li><li> åœ¨ä¸¤ä¸ªåœ°æ–¹æ¸…é™¤timeoutId </li><li> å°†timeoutIdå±æ€§æ·»åŠ åˆ°ç±»ä¸­ </li></ol><br><p>  React Hookså¯ä»¥è®©æ‚¨ç®€æ´æ˜äº†åœ°å†™å‡ºæˆ‘ä»¬ä»¥å‰æ‰€æè¿°çš„å†…å®¹ï¼Œä½†å¹¶ä¸æ€»æ˜¯å¾ˆæ¸…æ¥šã€‚ </p><br><p>  <strong>4ï¼‰æ¥ä¸‹æ¥å‘¢ï¼Ÿ</strong> <br> æˆ‘ä»¬å¯ä»¥ç»§ç»­æ‰©å±•å®ç”¨ç¨‹åºçš„åŠŸèƒ½ï¼šæ¥å—ä¸åŒçš„æŸ¥è¯¢å‚æ•°é…ç½®ï¼Œç¼“å­˜æ•°æ®ï¼Œè½¬æ¢å“åº”å’Œé”™è¯¯ï¼Œä½¿ç”¨ç›¸åŒå‚æ•°å¼ºåˆ¶æ›´æ–°æ•°æ®-åœ¨ä»»ä½•å¤§å‹Webåº”ç”¨ç¨‹åºä¸­çš„å¸¸è§„æ“ä½œã€‚ åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå¾ˆä¹…ä»¥å‰æˆ‘ä»¬å·²ç»å°†å…¶å¸¦å…¥ä¸€ä¸ªå•ç‹¬çš„ï¼ˆæ³¨æ„ï¼ï¼‰ç»„ä»¶ã€‚ æ˜¯çš„ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ¸²æŸ“é“å…·ã€‚ ä½†æ˜¯éšç€Hooksçš„å‘å¸ƒï¼Œæˆ‘ä»¬é‡å†™äº†å‡½æ•°ï¼ˆuseAxiosRequestï¼‰ï¼Œç”šè‡³åœ¨æ—§çš„å®ç°ä¸­å‘ç°äº†ä¸€äº›é”™è¯¯ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>æŸ¥çœ‹å¹¶å°è¯•ã€‚ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN453866/">https://habr.com/ru/post/zh-CN453866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN453850/index.html">ä¸­å›½ç¤¾ä¼šä¿¡ç”¨ä½“ç³»-é­”é¬¼æ˜¯å¦‚æ­¤å¯æ€•å—ï¼Ÿ</a></li>
<li><a href="../zh-CN453852/index.html">å¾®ç”Ÿç‰©ç¾¤ã€‚ å¦‚ä½•ä¿å…»è‚ é“ç»†èŒ</a></li>
<li><a href="../zh-CN453860/index.html">AMDæ¨å‡ºäº†å…¶æ–°çš„å®šåˆ¶7çº³ç±³å¤„ç†å™¨ç¬¬ä¸‰ä»£Ryzen</a></li>
<li><a href="../zh-CN453862/index.html">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨pathlib</a></li>
<li><a href="../zh-CN453864/index.html">åœ¨æ§åˆ¶å°ä¸Šä½¿ç”¨é¼ æ ‡å’Œé”®ç›˜ä¼šæ¬ºéª—å—ï¼Ÿ</a></li>
<li><a href="../zh-CN453868/index.html">å¸¦nRF52832ç»ç’ƒé¢æ¿çš„è§¦æ‘¸å¼è¿·ä½ å¼€å…³</a></li>
<li><a href="../zh-CN453870/index.html">æˆ‘ä»¬åœ¨powershellä¸Šç¼–å†™Reverse socks5ä»£ç†ã€‚ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN453872/index.html">ä½¿ç”¨ç¥ç»ç½‘ç»œè¿˜åŸç…§ç‰‡</a></li>
<li><a href="../zh-CN453874/index.html">ä»ä¿„ç½—æ–¯è½®ç›˜èµŒåˆ°å®‰å…¨LOTOï¼šå¦‚ä½•ä¿æŠ¤æ•°æ®ä¸­å¿ƒäººå‘˜</a></li>
<li><a href="../zh-CN453876/index.html">å°±åƒYandex.Practicumä¸­ä¸€æ ·ï¼Œå‰ç«¯ä¸åŒæ­¥è·èƒœï¼šRedux-Sagaï¼ŒpostMessageå’ŒJupyterçš„æ‚æŠ€æ•°å­—</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>