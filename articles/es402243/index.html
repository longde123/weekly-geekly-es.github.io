<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüë¶ ‚ùé ü§± Ionistores Micro-UPS üì• üì® üî¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Buen d√≠a a toda la comunidad respetada. Tengo el honor de ofrecer a los Hubrovites interesados ‚Äã‚Äãen la electr√≥nica de radio algunas consideraciones y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ionistores Micro-UPS</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/402243/">  Buen d√≠a a toda la comunidad respetada.  Tengo el honor de ofrecer a los Hubrovites interesados ‚Äã‚Äãen la electr√≥nica de radio algunas consideraciones y una implementaci√≥n espec√≠fica de la fuente de alimentaci√≥n de respaldo en los ionistores (son supercondensadores con una doble capa el√©ctrica), dise√±ada para garantizar la finalizaci√≥n correcta del m√≥dulo del procesador en un microcontrolador ARM que se ejecuta bajo Linux Debian est√°ndar. <br><a name="habracut"></a><br>  El problema surgi√≥ frente a su humilde servidor de la siguiente manera: debe apagar correctamente el sistema operativo Linux (que se ejecuta en la soluci√≥n integrada) cuando se apaga la alimentaci√≥n externa.  Esta energ√≠a se suministr√≥ desde un puerto USB 2.0 est√°ndar a un dispositivo de caja previamente hecho a trav√©s de al menos un conector USB-B est√°ndar.  El usuario inexperto de este dispositivo prefiri√≥ extraer el cable USB curny, siguiendo el principio de "UnPlug-NoPlay-NoProblem".  Est√° claro que una soluci√≥n integrada sin discos duros y con memoria virtual puesta a cero durante la configuraci√≥n es resistente a tal fuerza mayor, sin embargo, un par de miles de horas de uso han demostrado que no siempre funciona "sin problemas". <br><br>  Tuve que arrugar mi cerebro y entrar en un trance creativo.  Al salir del trance, se materializ√≥ la primera forma posible de resolver el problema: la psicol√≥gica, que al principio parec√≠a la m√°s atractiva.  La l√≠nea de pensamiento fue aproximadamente la siguiente: ¬øpor qu√© el usuario com√∫n tira de un palo pegado en el puerto USB con una mano inquebrantable?  Probablemente porque ni √©l mismo ni sus conocidos m√°s cercanos perdieron de esta manera su tesis, disertaci√≥n o informe anual.  ¬øPor qu√© el mismo usuario no sac√≥ un cable de impresora de una impresora que funcionaba en los d√≠as de ona?  Probablemente porque vio o escuch√≥ de los labios de alguien c√≥mo ten√≠a que comprar un nuevo MB o Centronics en ISA (PCI).  No quiero (de la palabra en general) que mi caja fue sacada sin ceremonias.  ¬øQu√© hay que hacer para esto?  Correcto, forma el comportamiento de usuario requerido. <br><br>  Tuve que sacudir las habilidades de circuitos y trazado, y la pr√≥xima versi√≥n de la caja ten√≠a un LED RGB y un bot√≥n en el panel frontal, as√≠ como una se√±al piezoel√©ctrica con un timbre desagradable en el interior.  Un programa simple determin√≥ si el apagado extremo pas√≥ correctamente.  Si era incorrecto y la mala conducta del usuario era la primera en su memoria flash, segu√≠a la acci√≥n de control: en lugar de que el indicador fuera amarillo y verde, la caja parpade√≥ con un ojo rojo y chill√≥ vilmente un par de minutos antes de que se calmara y comenzara a cargar.  La reca√≠da se castigaba con cinco minutos, un brezo a√∫n m√°s vil y una l√≠nea en el manual que la caja bloqueada debido a un apagado incorrecto repetido se elimina de la garant√≠a, aqu√≠. <br><br>  Ya sabes, el m√©todo result√≥ ser sorprendentemente efectivo.  Pero aqu√≠, el Estimado Cliente expres√≥ un deseo de que antes de desconectar la caja todav√≠a informar√≠a al servidor que estaba tomando tiempo de la escena.  Ahora algo, pero se requer√≠a una fuente de energ√≠a.  El cerebro del pr√≥ximo trance creativo regres√≥ con el pensamiento: ¬°una bater√≠a de pol√≠mero de litio es nuestro todo!  El pensamiento com√∫n agreg√≥ mucho escepticismo a este pensamiento: realmente no quer√≠a cargar la bater√≠a cada vez que la encend√≠a, porque la cantidad de descargas de carga es un recurso consumido, as√≠ como el tema del enga√±o c√≠nico de los fabricantes de bater√≠as de clientes inocentes.  ¬øNo se carga cada vez que lo enciende, sino a medida que se descarga?  Por lo tanto, es necesario cercar todo el jard√≠n, calibrar la bater√≠a, medir el voltaje con buena precisi√≥n.  En general, esto y aquello, y luego el Samsung Galaxy entr√≥ en escena con sus bater√≠as incendiarias.  Imaginando un incendio en el lugar donde se supon√≠a que deb√≠a estar la caja, tuve que agitar voluntariamente un sable y detener la dolorosa deliberaci√≥n de la segunda idea. <br><br>  Entrando en trance por tercera vez, un genio creativo sac√≥ a la luz los ionistores.  Y qu√©, no parece malo.  La capacidad est√° en faradios, el n√∫mero de ciclos de carga-descarga no est√° limitado, por as√≠ decirlo, el voltio realmente no es suficiente: 2.7 m√°ximo por celda, y no son muy en cascada.  Ya no hab√≠a nada que reflexionar sobre la falta de opciones, y nuevamente tuve que abordar el circuito junto con la traza. <br><br>  Buscar en las vastas extensiones de Internet trajo algo de trampa y, por un momento de reflexi√≥n, se decidi√≥ detenerse en el microcircuito Linear LTC3110.  Mirando hacia el futuro, dir√© que se han probado un par de opciones m√°s, pero no con un √©xito particular.  Si el lector est√° interesado en los detalles de la elecci√≥n, eres bienvenido en PM.  De las opciones disponibles, el LTC3110 contiene casi todo lo que necesita para construir una fuente de energ√≠a de respaldo en los ionistores: <br>  - tiene un convertidor elevador, lo que hace que el dise√±ador no est√© particularmente limitado en la elecci√≥n de la tensi√≥n de alimentaci√≥n; <br>  - este convertidor utiliza inductancia para el almacenamiento de energ√≠a, lo que aumenta significativamente la eficiencia y permite dar un par de amperios a la carga; <br>  - es posible limitar la corriente consumida durante la carga en el rango de 125mA - 2A, lo cual es especialmente importante cuando se alimenta por USB; <br>  - hay un circuito incorporado para el equilibrio individual de los ionistores conectados en serie para aumentar la potencia y la fiabilidad almacenadas; <br>  - el chip est√° equipado con cables que indican el grado de carga de los ionistores; <br>  - y, para el postre, hay un comparador adicional, cuyos umbrales son establecidos por el usuario. <br><br>  Para obtener detalles y ejemplos de aplicaciones, env√≠o al lector curioso a la hoja de datos del microcircuito, el todopoderoso Google con el hechizo "LTC3110 pdf" para ayudarlo. <br><br>  En teor√≠a, para construir un Micro-UPS que funcione, el LTC3110 necesita agregar un circuito que proporcione energ√≠a a la caja en el modo normal, si hay una conexi√≥n a un USB que funcione.  El IC ST1S10PHR fue elegido para este papel honorable, cuya disposici√≥n sin pretensiones y bajo precio han sido conocidos y probados durante mucho tiempo.  Tambi√©n tuve que agregar una llave que interrumpe el circuito de alimentaci√≥n de los principales consumidores durante la carga inicial de los ionistores.  Esta tecla le permite resolver dos problemas: en primer lugar, se reduce el tiempo de carga inicial (ya que casi todo lo que consume el USB va a los ionistores), y en segundo lugar, elimina la desagradable posibilidad de apag√≥n cuando el UPS est√° tan descargado que el suministro de energ√≠a a√∫n no es suficiente para el correcto apagado  Adem√°s, el "arranque alto" de los ionistores completamente cargados permite que el circuito a veces (pero no muy a menudo) consuma m√°s corriente de la que puede proporcionar el puerto USB; el d√©ficit se repondr√° de los ionistores.  Tal situaci√≥n puede surgir, por ejemplo, al grabar un gran bloque de informaci√≥n en una unidad flash USB de gran capacidad que se alimenta junto con la caja. <br><br>  Creo que la parte introductoria se puede completar sobre esto y pasar a un esquema de trabajo espec√≠fico. <br><br><img src="https://habrastorage.org/files/249/ae5/0b7/249ae50b7dff4c188249bbb255dc9b05.GIF" alt="imagen"><br><br>  As√≠ es como se ve el circuito micro-UPS en los ionistores. <br><br>  La alimentaci√≥n se suministra desde el puerto USB 2.0 (esquina superior izquierda del circuito).  En DA1, de acuerdo con el esquema recomendado, se ensambla un convertidor reductor 5V -&gt; 3.3V a partir de una hoja de datos.  Su √∫nica caracter√≠stica es un filtro adicional del timbre de alta frecuencia en L2 y C7.  Si lo desea, estos elementos pueden ser excluidos.  Las resistencias R3 ... R5 se utilizan para la descarga de emergencia de los ionistores antes del transporte, por ejemplo, o antes de configurar toda la placa como un todo, de lo contrario, la fuente de energ√≠a permanece en ella y es lo suficientemente potente como para quemar cualquier cosa.  Las resistencias de descarga est√°n conectadas o desconectadas por el puente SA1.  VT1, C16, R17 y R18: la clave para alimentar a los principales consumidores, ya se ha mencionado anteriormente y tendr√° que agregar algunas palabras a continuaci√≥n.  Todo lo dem√°s es el arn√©s est√°ndar LTC3110 de la hoja de datos. <br><br>  3V3SBY es la potencia de reserva del circuito de control, en la caja se implementa en el CPLD EPM240T100 de Altera, pero nada impide que se ejecute en un microcontrolador o l√≥gica discreta.  3V3 es la fuente de alimentaci√≥n principal de la caja reservada por UPS.  La informaci√≥n de estado del Micro-UPS se muestra en PWRFAIL, BATFULL y BATLOW con nombres que se explican por s√≠ mismos.  PWRFAIL se activa cuando hay una p√©rdida de energ√≠a del USB, BATFULL indica que la carga alcanza el nivel del 95% (5.2V), BATLOW muestra una disminuci√≥n en el nivel de carga al 40% (2.1V).  Si lo desea, este nivel se puede ajustar seleccionando R6 y R7, guiados por la hoja de datos.  Desafortunadamente, tal truco no funciona con el nivel BATFULL: se clava en el CI con clavos. <br><br>  El micro UPS controla dos se√±ales: PWRON y BATOFF.  PWRON enciende la alimentaci√≥n principal, BATOFF apaga el UPS como un todo. <br><br>  La l√≥gica general del funcionamiento del micro UPS es la siguiente: <br><br><ol><li>  en el estado inicial, C8 y C9 est√°n completamente descargados, el puente SA1 en la posici√≥n izquierda, no se suministra alimentaci√≥n USB de 5V; </li><li>  el dispositivo est√° conectado a un puerto USB-B 2.0; </li><li>  el convertidor en DA1 comienza a suministrar corriente a la l√≠nea 3V3SBY, energizando el circuito de control en CPLD, que, a su vez, abre la tecla VT1, eliminando la se√±al PWRON;  Adem√°s, el circuito de control elimina la se√±al BATOFF, incluyendo DA2; </li><li>  DA2 comienza a cargar los ionistores;  a medida que se cargan, la se√±al BATLOW se desactiva (a 2.1 V), luego se activa BATFULL (a 5.2 V en los ionistores); </li><li>  la aparici√≥n de la se√±al BATFULL, el circuito de control considera la disponibilidad del micro UPS para funcionar y enciende VT1, suministrando energ√≠a al circuito principal;  Al mismo tiempo, DA2 contin√∫a monitoreando los ionistores, y cuando la carga cae por debajo del 95%, comienza a cargarse;  la conexi√≥n de VT1 al pin RSENS DA2 asegura que se tome tal corriente para recargar que no exceda el l√≠mite USB, teniendo en cuenta el circuito principal consumido;  Si el consumo del circuito principal excede este l√≠mite, la descarga de los ionistores comenzar√° a compensar los gastos innecesarios; </li><li>  Al desconectar el USB de 5V, se activa la l√≠nea PWRFAIL, lo que le permite al dispositivo de control saber que la fuente externa ha desaparecido;  el circuito de control genera una solicitud para interrumpir el procesador ARM para ejecutar el script de apagado correcto;  todo este tiempo la energ√≠a es suministrada por DA2; </li><li>  al finalizar el procedimiento de apagado, ARM emite una se√±al de que todo est√° listo para la extinci√≥n, y el circuito de control establece BATOFF, deshabilitando DA2;  en este estado, la caja se encuentra antes de suministrar energ√≠a al USB de 5 V (consulte el punto 1, excepto la carga residual en C8 y C9); </li><li>  Si ARM dud√≥ mucho y no pudo cerrar todo hasta la se√±al BATLOW, el circuito tendr√° que desenergizarse por la fuerza. </li></ol><br>  Si lo desea, es f√°cil organizar cualquier otra l√≥gica de control de micro-UPS, por ejemplo, al aumentar el porcentaje de activaci√≥n de BATLOW al 60% (seleccionando R6 y R7), √∫selo como una se√±al para detenerse, desconect√°ndose por la fuerza de la descarga completa C8 y C9. <br><br>  Al final, revise r√°pidamente los par√°metros configurables del circuito.  R1 y R2 determinan el voltaje de salida de DA1, otro voltaje puede requerir el reemplazo de C1, C2, C4-C6 y L1.  Las clasificaciones de C8 y C9 determinan solo los tiempos de carga y descarga del UPS, personalmente intent√© de 4.7 a 100 Farads, en teor√≠a no hay restricciones.  R6 y R7 determinan el nivel de activaci√≥n de BATLOW.  El voltaje de la carga m√°xima de los ionistores depende de la relaci√≥n R8 / R9.  R11 determina la corriente consumida desde 5V USB, a la resistencia indicada, el circuito consume 0.5A.  La relaci√≥n R12 / R14 establece un nivel de ca√≠da de USB de 5V, que se definir√° como falla de energ√≠a (PWRFAIL).  R15 / R16 determina el voltaje de salida de DA2 en modo de descarga. <br><br>  Las se√±ales de salida del LTC3110 se realizan de acuerdo con el esquema de "drenaje abierto" para no estar atados a un voltaje de suministro espec√≠fico.  En mi circuito, las resistencias pull-up para ellos est√°n involucradas en CPLD, no es un problema usarlas en ning√∫n microcontrolador moderno.  Bueno, si decides montar un circuito de control en K155, entonces debes cuidar las resistencias t√∫ mismo. <br><br>  Algunas palabras sobre el C16.  Obtener este conocimiento me llev√≥ la mayor parte del tiempo dedicado a la placa prototipo de UPS.  Despu√©s de todo, ¬øcu√°l es el problema?  El negro en ingl√©s dice que si desea que se garantice que la suma de la corriente consumida por el circuito principal y la corriente de carga de los ionistores no exceda el l√≠mite establecido por R11, alimente amablemente el circuito principal desde la salida RSENS.  OK, de acuerdo.  Y luego m√°s interesante.  Como su circuito puede tener cualquier cosa, hasta un cortocircuito (cortocircuito, es un cortocircuito, es corto), dice la hoja de datos, el LTC3110 est√° equipado con un circuito de protecci√≥n especial.  OK muy bien  Y ahora para la parte divertida.  Leemos m√°s la hoja de datos: y para que el esquema de protecci√≥n no se confunda, proporcione la capacidad total de la l√≠nea de alimentaci√≥n NO M√ÅS, Karl, 10 microFarads.  Goofy ... Por todo sobre todo, y no te niegues nada.  De hecho, cualquier carga superior a 10uF cuando se conectan cu√±as ... No se enga√±e, Basurman.  Tuve que hacer un ligero retraso en la clave en VT1, lo que da C16.  Entiendo que durante alg√∫n tiempo VT1 no estar√° en el modo clave, sino entre el cielo y la tierra (en el sentido, entre VCC y GND), lo que no es nada bueno.  Pero al menos funciona.  Tal es el "nuevo hawa".  Para los fan√°ticos de la pureza de los modos clave, agregar√© que intent√© no poner C16, sino una inductancia de 1.5 ŒºH en serie con VT1: todo funciona muy bien. <br><br>  A continuaci√≥n, doy una imagen de una placa de circuito impreso con el circuito descrito, por supuesto, la numeraci√≥n de los componentes difiere de la indicada en el diagrama del circuito: es transversal para toda la caja. <br><br><img src="https://habrastorage.org/files/ca6/497/465/ca6497465973465483dabf323d12be70.jpg" alt="imagen"><br><br>  Si tiene preguntas, por favor. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es402243/">https://habr.com/ru/post/es402243/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es402233/index.html">Overclockeamos el enrutador JTAG</a></li>
<li><a href="../es402235/index.html">Se necesitan hojas de ruta detalladas para autom√≥viles inteligentes, no para personas</a></li>
<li><a href="../es402237/index.html">¬øPor qu√© Intel Mobileye?</a></li>
<li><a href="../es402239/index.html">Red religiosa</a></li>
<li><a href="../es402241/index.html">PLC CONTROLLINO compatible con Arduino, parte 1</a></li>
<li><a href="../es402245/index.html">Los preparativos para el lanzamiento del primer buque de carga chino llegaron a la meta.</a></li>
<li><a href="../es402247/index.html">Consejos de impresi√≥n de Epson</a></li>
<li><a href="../es402249/index.html">Astell & Kern AK70 - Pocket Media Harvester para amantes de la m√∫sica</a></li>
<li><a href="../es402251/index.html">La primera ciudad privada en Rusia. Parte 3</a></li>
<li><a href="../es402253/index.html">El poder de las redes naturales est√° en exceso.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>