<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçüè≠ üë±üèø üë©‚Äçüëß‚Äçüë¶ Pepino na nuvem: usando scripts BDD para teste de estresse do produto ü§æ üë∞üèª üê∫</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Outra transcri√ß√£o do relat√≥rio com Pixonic DevGAMM Talks . Anton Kosyakin √© gerente t√©cnico de produtos e est√° trabalhando na plataforma ALICE (como J...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Pepino na nuvem: usando scripts BDD para teste de estresse do produto</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pixonic/blog/428349/">  Outra transcri√ß√£o do relat√≥rio com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pixonic DevGAMM Talks</a> .  Anton Kosyakin √© gerente t√©cnico de produtos e est√° trabalhando na plataforma ALICE (como Jira para hot√©is).  Ele contou como eles integraram as ferramentas de teste existentes no projeto, por que os testes de carga s√£o necess√°rios, quais ferramentas a comunidade oferece e como executar essas ferramentas na nuvem.  Abaixo est√° uma apresenta√ß√£o e o texto do relat√≥rio. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/fJCPRMld29c" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe> <a name="habracut"></a><br>  Estamos criando um produto chamado ALICE Platform e agora vou lhe contar como eles resolveram o problema do teste de carga. <br><br><img src="https://habrastorage.org/webt/yl/ni/ab/ylniab7e6clwettmlag_khwc99u.png"><br><br>  ALICE √© Jira para hot√©is.  Estamos criando uma plataforma para ajud√°-los a lidar com seu interior.  Concierge, operador de recep√ß√£o, faxineiros - eles tamb√©m precisam de ingressos.  Por exemplo: um convidado liga&gt; diz que voc√™ precisa limpar a sala&gt; o funcion√°rio cria um ticket&gt; os funcion√°rios que limpam, sabem em quem a tarefa √© executada&gt; executar&gt; alteram o status. <br><br>  Como temos b2b, os n√∫meros podem n√£o ser impressionantes - apenas 1.000 hot√©is, 5.000 DAUs.  Para jogos, isso n√£o √© muito, mas para n√≥s √© muito legal, porque existem at√© 8 servidores de produtos e eles dificilmente conseguem lidar com esses 5 mil usu√°rios ativos.  Como coisas ligeiramente diferentes acontecem sob o cap√¥ - um monte de bancos de dados, transa√ß√µes, etc. <br><br><img src="https://habrastorage.org/webt/n4/km/xj/n4kmxj-v1475vowxyzeeuudht_w.png"><br><br>  O mais importante: no ano passado, crescemos duas vezes, agora temos uma equipe de engenharia na regi√£o de 50 pessoas e planejamos dobrar a base de usu√°rios em 2019.  E este √© o principal desafio que nos confronta. <br><br>  Um exemplo da vida.  Na sexta-feira √† noite, depois de trabalhar uma semana de trabalho de 60 horas, √†s 23:00, terminei a √∫ltima liga√ß√£o, conclu√≠ rapidamente a apresenta√ß√£o, pulei no trem e vim para c√°.  E cerca de cinco minutos atr√°s, refiz um pouco minha apresenta√ß√£o.  Ent√£o agora tudo funciona para n√≥s, porque somos uma startup e √© legal.  Enquanto dirigia, parte da equipe t√©cnica (chamamos de inc√™ndio na produ√ß√£o) tentou garantir que o sistema n√£o funcionasse e, ao mesmo tempo, os usu√°rios n√£o notassem isso.  Eles tiveram sucesso e n√≥s somos salvos. <br><br>  Como voc√™ pode ver, at√© agora n√£o dormimos muito bem √† noite.  Temos certeza de que nossa infraestrutura cair√°.  Enfrentamos a verdade e entendemos isso.  Uma pergunta: quando?  Foi assim que entendemos que o teste de carga √© a chave da salva√ß√£o.  √â com isso que precisamos nos preocupar. <br><br><img src="https://habrastorage.org/webt/wk/id/oi/wkidoi8iwdp-aafxeo8zgtpjrcy.png"><br><br>  Quais s√£o nossos objetivos.  Primeiro, precisamos entender agora exatamente a capacidade e o desempenho do nosso sistema, qu√£o bem ele funciona para os usu√°rios atuais.  E isso deve acontecer antes que o usu√°rio quebre o contrato conosco (e isso pode ser um cliente para 150 hot√©is e muito dinheiro) devido ao fato de que algo n√£o est√° funcionando ou √© muito lento.  Al√©m disso, o departamento de vendas tem um plano: dobrar o crescimento no pr√≥ximo ano.  E aconteceu que compramos nosso principal concorrente e migramos seus usu√°rios para n√≥s mesmos. <br><br>  E devemos saber que tudo isso pode suportar.  Saiba com anteced√™ncia, antes que esses usu√°rios cheguem e tudo caia. <br><br>  Tamb√©m fazemos lan√ßamentos.  Toda semana.  Na segunda-feira.  Obviamente, nem todas as vers√µes estendem a funcionalidade, em algum lugar de manuten√ß√£o, em algum lugar, mas √© preciso entender que os usu√°rios n√£o perceber√£o isso e sua experi√™ncia n√£o piorar√°. <br><br>  Mas n√≥s, como bons desenvolvedores, somos pessoas pregui√ßosas e n√£o gostamos de trabalhar.  Por isso, perguntaram √† comunidade e ao Google quais servi√ßos / solu√ß√µes existem para teste de carga.  Havia muitos deles.  Existem algumas coisas simples, como o Apache Bench, que simplesmente chuta um site com centenas de threads em url.  Existe uma vers√£o maligna e estranha do Bees with Machine Guns, onde tudo √© o mesmo, mas inicia as inst√¢ncias que voam e colocam seus aplicativos.  Existe o JMeter, voc√™ pode escrever alguns scripts, rodar na nuvem. <br><br><img src="https://habrastorage.org/webt/z6/rr/ux/z6rruxzrgzypyfjac_hafhyetnk.png"><br><br>  Tudo parece estar bem, mas, depois de pensar, percebemos que realmente precisamos trabalhar e primeiro resolver v√°rios problemas. <br><br><img src="https://habrastorage.org/webt/gz/bk/rc/gzbkrcuzhngbzajpyfghlwn50t8.png"><br><br>  Primeiro, voc√™ precisa escrever cen√°rios reais que simulem uma carga completa.  Em alguns sistemas, √© suficiente gerar chamadas aleat√≥rias da API com dados aleat√≥rios.  No nosso caso, s√£o cen√°rios longos para o usu√°rio: recebi uma liga√ß√£o, abri uma tela, dirigi todos os dados (quem ligou para o que ele queria) e salvou.  Em seguida, ele aparece no aplicativo m√≥vel de outra pessoa que executar√° a solicita√ß√£o.  N√£o √© a tarefa mais trivial. <br><br>  E deixe-me lembr√°-lo, lan√ßamentos toda semana.  A funcionalidade √© atualizada, os scripts devem ser realmente relevantes.  Primeiro voc√™ precisa escrev√™-los e depois tamb√©m apoi√°-los. <br><br>  Mas esse n√£o era o maior problema.  Veja flood.io por exemplo.  Uma ferramenta legal, voc√™ pode executar o Selenium nele - √© quando o Chrome √© iniciado, voc√™ pode control√°-lo e ele executa algum tipo de script.  Voc√™ pode executar scripts JMeter nele.  Mas se quisermos executar o Selenium nos scripts do JMeter, tudo de repente se desfaz, porque os caras que o montaram tomaram v√°rias decis√µes de arquitetura.  Ou, por exemplo, alguns servi√ßos podem executar o JUnit - √© simples e direto, mas um desses servi√ßos criou seu pr√≥prio JUnit e simplesmente ignora algumas coisas. <br><br><img src="https://habrastorage.org/webt/x9/uc/hr/x9uchrzxys03kzih_vblmszbqnm.png"><br><br>  A quest√£o da gera√ß√£o de carga √© urgente, porque cada ferramenta pede √† sua maneira de ger√°-la.  E mesmo quando voc√™ conseguiu garantir que os cen√°rios fossem adequados, surge a pergunta: como executar 2-4 vezes mais?  Parece ser: corra e est√° tudo bem.  Mas n√£o.  Existem todos os tipos de IDs nessas solicita√ß√µes - criamos algo, obtemos um novo ID, alteramos o ID antigo e o teste, que carrega a entidade por ID, altera seu campo para outro.  E 10 testes que carregam a mesma entidade 10 vezes n√£o s√£o muito interessantes.  Porque 10 vezes √© necess√°rio carregar entidades diferentes e dimensionar corretamente essa carga. <br><br>  OK, queremos resolver o problema do teste de carga para entender exatamente quantos usu√°rios o aplicativo suportar√° e que nossos planos s√£o consistentes com os do departamento de vendas.  Analisamos as solu√ß√µes que est√£o no mercado e, em seguida, fizemos um invent√°rio de nossas massas e palitos. <br><br>  Como lan√ßamos todas as semanas, naturalmente, automatizamos alguns testes - integra√ß√£o e outra coisa.  Para isso, usamos pepino.  Essa √© uma estrutura de BDD para desenvolvimento orientado a comportamento.  I.e.  pedimos alguns scripts que consistem em etapas. <br><br><img src="https://habrastorage.org/webt/up/qv/jf/upqvjffahbzzeidc9qfaszvlefy.png"><br><br>  Nossa infraestrutura nos permitiu executar testes de integra√ß√£o e funcionais de dois modos: basta chutar o back-end, ajustar a API ou realmente executar o Chrome atrav√©s do Selenium e gerenci√°-lo. <br><br>  Adoramos o NewRelic.  Pode simplesmente monitorar o servidor, os principais indicadores.  Ele se integra √† JVM e intercepta todas as chamadas para os controladores e a API do Endpoint.  Eles tamb√©m t√™m uma solu√ß√£o para o navegador e, como temos a maioria das funcionalidades, ele tamb√©m faz algo no navegador e fornece algum tipo de m√©trica. <br><br><img src="https://habrastorage.org/webt/dl/uu/ia/dluuiasy_dqrx5vb0y_fsermccs.png"><br><br>  Assim, voc√™ precisa juntar tudo.  J√° automatizamos os principais cen√°rios.  Nossos cen√°rios (porque √© como o BDD) imitam usu√°rios reais e a carga √© semelhante √† produ√ß√£o real.  Ao mesmo tempo, podemos escal√°-lo.  Como isso faz parte do processo de lan√ßamento, ele √© sempre atualizado. <br><br><img src="https://habrastorage.org/webt/gs/kr/sk/gskrsk9z456bx3fwkruz_p4mtoi.png"><br><br>  Agora vamos usar qualquer ferramenta que esteja atualmente no mercado.  Eles operam com as mesmas primitivas: http, API chama http, JSON, JUnit, s√≥ isso.  Mas assim que tentamos aplicar nossos testes no pepino, eles fazem o mesmo, operam nas mesmas coisas, mas nada funciona.  Come√ßamos a pensar em como lidar com essa tarefa. <br><br>  Uma pequena digress√£o, porque BDD n√£o √© um termo muito popular no desenvolvimento de jogos, √© mais para solu√ß√µes corporativas. <br><br><img src="https://habrastorage.org/webt/pw/ud/s-/pwuds-iym4yapjojuso5ch5efxw.png"><br><br>  Todos os cen√°rios realmente descrevem algum tipo de comportamento.  O formato da descri√ß√£o do cen√°rio √© muito simples: Dado, Quando, Ent√£o - em termos de BDD chamado Gherkin.  Pepino para n√≥s, usando anota√ß√µes e atributos, mapeia isso para o c√≥digo Java.  Ele faz o que v√™ no cen√°rio: voc√™ precisa dar uma ma√ß√£ √† pessoa, vamos encontrar um m√©todo no qual isso √© implementado. <br><br><img src="https://habrastorage.org/webt/cy/eq/yt/cyeqytn1ychkth8n2_0njfagew0.png"><br><br>  Em seguida, introduzimos um conceito como o Functional Robot.  Este √© um determinado cliente para a aplica√ß√£o, possui m√©todos para efetuar login de um usu√°rio, sair, criar um ticket, ver uma lista de tickets etc.  E pode funcionar de tr√™s modos: com um aplicativo m√≥vel, um aplicativo da Web e apenas fa√ßa chamadas de API. <br><br><img src="https://habrastorage.org/webt/3v/b-/iq/3vb-iqzd_dgobdompwj0jfmxzai.png"><br><br>  Agora, em poucas palavras, a mesma coisa nos slides.  Os arquivos de recursos s√£o divididos em scripts, existem etapas e tudo isso est√° escrito em ingl√™s. <br><br><img src="https://habrastorage.org/webt/wx/x0/f7/wxx0f7drcwrdfbwr_m7-u0bqqv4.png"><br><br>  Em seguida, o Cucumber, o c√≥digo Java, entra em a√ß√£o, mapeia esses scripts para o c√≥digo que est√° realmente em execu√ß√£o. <br><br><img src="https://habrastorage.org/webt/4t/b5/0y/4tb50yvejfg-jkmyz4kwfgodhxe.png"><br><br>  Este c√≥digo usa nosso aplicativo. <br><br><img src="https://habrastorage.org/webt/95/al/vt/95alvtpnyfosxqkrxys7-34nm-i.png"><br><br>  E dependendo do que escolhemos: atrav√©s do Selenium Chrome, acesse o aplicativo ALICE. <br><br><img src="https://habrastorage.org/webt/eb/ik/ko/ebikko_fjkp71aesloejwbf8-ng.png"><br><br>  Ou a mesma coisa atrav√©s da API http. <br><br><img src="https://habrastorage.org/webt/e7/4w/0p/e74w0pudnq0kdupfnkny9f_-tta.png"><br><br>  E ent√£o (gra√ßas aos caras da Yandex for Allure Reports) tudo isso √© muito bem mostrado para n√≥s - quanto tempo levou, quais testes foram executados, em que etapa e at√© aplicamos uma captura de tela se algo desse errado. <br><br><img src="https://habrastorage.org/webt/54/a9/ub/54a9ubss0p28nik3j60p1si5qi0.png"><br><br>  Aqui est√° um breve resumo do que j√° t√≠nhamos. <br><br><img src="https://habrastorage.org/webt/6h/85/fq/6h85fqwod5qxdniwmx7kiawelgc.png"><br><br>  Como criar testes de carga a partir disso?  T√≠nhamos Jenkins administrando a su√≠te Cucumber.  Estes s√£o os nossos testes e eles foram para o ALICE.  Qual foi o principal problema?  Jenkins executa testes localmente; n√£o pode ser escalado para sempre.  Sim, estamos hospedados na Amazon, na nuvem, podemos solicitar uma m√°quina extra-grande.  De qualquer forma, em algum momento, entraremos, pelo menos, na rede.  √â necess√°rio, de alguma forma, carregar essa carga.  Obrigado Amazon, ele pensou por n√≥s.  Podemos empacotar nosso Cucumber Suite em um cont√™iner do Docker e usar o servi√ßo da AWS (chamado Fargate) para dizer "e inici√°-los, por favor".  O problema est√° resolvido, podemos executar nossos testes j√° na nuvem. <br><br><img src="https://habrastorage.org/webt/ef/4o/eu/ef4oeujt2xrfawvtrcc9wkd8cpk.png"><br><br>  Ent√£o, como estamos na nuvem, execute o 5-10-20 Cucumber Suite.  Mas h√° uma nuance: toda execu√ß√£o de todos os nossos testes funcionais gera um relat√≥rio.  Uma vez executamos 400 testes e 400 relat√≥rios foram gerados. <br><br>  Obrigado novamente ao pessoal do Yandex pelo c√≥digo-fonte aberto, lemos a documenta√ß√£o, o c√≥digo-fonte e percebemos que existem maneiras de agregar todos os 400 relat√≥rios em um.  Corrigimos um pouco os dados, escrevemos algumas de nossas extens√µes e tudo deu certo. <br><br><img src="https://habrastorage.org/webt/0p/by/by/0pbybykmkhnxqbbwgqoybxslqme.png"><br><br>  Agora, de Jenkins, dizemos "d√™-nos 200 inst√¢ncias".  Nosso script de orquestra√ß√£o certo vai para a Amaz√¥nia, diz "lan√ßar 400 cont√™ineres".  Cada um deles cont√©m nossos testes de integra√ß√£o, eles geram um relat√≥rio, o relat√≥rio √© coletado atrav√©s do Aggregator em uma √∫nica pe√ßa, colocada em Jenkins, aplicada ao trabalho, funciona super. <br><br>  Mas <br><br>  Tenho certeza de que muitos de voc√™s receberam coisas estranhas dos testadores, como "joguei um jogo, pulei 10 vezes; durante esse tempo, apertei o tiro e acidentalmente apertei o bot√£o de desligar - o personagem come√ßou a piscar, congelar no ar e depois o computador desligou, lidar com isso. "  Voc√™ ainda pode concordar com uma pessoa e dizer, voc√™ sabe, √© imposs√≠vel se reproduzir.  Mas temos m√°quinas sem alma, elas fazem tudo muito rapidamente e em algum lugar os dados n√£o carregam, em algum lugar n√£o s√£o renderizados muito rapidamente, tentam pressionar um bot√£o, mas ainda n√£o h√° nenhum bot√£o ou usam alguns dados que ainda n√£o foram baixados do servidor .  Tudo entra em colapso e o teste √© falho.  Embora (eu quero me concentrar nisso), temos o c√≥digo Java que executa o Chrome, que se conecta a outro Java atrav√©s de um wrapper e faz alguma coisa e ainda funciona com a velocidade da luz. <br><br>  Bem, o problema √≥bvio resultante disso: temos 5 mil usu√°rios e lan√ßamos apenas 100 inst√¢ncias de nossos testes funcionais e criamos a mesma carga.  N√£o √© exatamente isso que quer√≠amos, porque planejamos que no pr√≥ximo m√™s teremos 6 mil usu√°rios.  √â dif√≠cil entender essa carga, entender quantos threads iniciar. <br><br>  OK, vamos humanizar nosso sistema.  √â assim que a interface do usu√°rio se parece: <br><br><img src="https://habrastorage.org/webt/88/rn/xe/88rnxekdkmigjc9fms0bsdbmjay.png"><br><br>  Algu√©m est√° ligando, o concierge quer pressionar o bot√£o "criar um novo ticket", uma janela aparece para ele e ele precisa preencher todos os campos. <br><br><img src="https://habrastorage.org/webt/xg/cd/xc/xgcdxci2xifa0pd85jkm1qbiu9i.png"><br><br>  Mas isso n√£o acontece instantaneamente.  A pessoa real at√© que ele chegue ao mouse, at√© come√ßar a digitar, at√© selecionar algo, enquanto clica em Salvar.  Ent√£o, vamos desacelerar nossos testes. <br><br><img src="https://habrastorage.org/webt/rz/7y/5f/rz7y5fqhtai1h0ekjh2k1buocv8.png"><br><br>  N√≥s o chamamos de modo humano.  Voc√™ s√≥ precisa medir quanto tempo dura o passo e dormir um pouco, se for muito r√°pido.  Ao mesmo tempo, podemos medir quanto, em princ√≠pio, essa etapa levou - se 5 minutos, provavelmente a experi√™ncia do usu√°rio est√° quebrada aqui. <br><br>  Como tivemos alguns testes, n√£o come√ßamos a reescrever cada um deles.  Eles pegaram o AspectJ, inseriram no nosso c√≥digo, adicionaram mais 5 linhas de c√≥digo, funciona muito bem. <br><br>  Demonstra√ß√£o curta. <br><br><img src="https://habrastorage.org/webt/q7/95/x6/q795x6n2x0vwebvkaznad_6ndda.png"><br><br><img src="https://habrastorage.org/webt/2c/3k/iw/2c3kiwa4yskdjo2bk7mxyipwfem.png"><br><br><img src="https://habrastorage.org/webt/eb/ie/bv/ebiebvzalkiqzpc9qt1dnwltmcw.png"><br><br>  Esta √© uma execu√ß√£o na linha do tempo.  Testes verdes s√£o bons, em algum lugar √© ruim.  Allure nos mostrar√° os detalhes de onde ele vira. <br><br>  E aqui est√° a linha do tempo, mostrando que tivemos muitas inst√¢ncias.  Eles fizeram um teste, em algum lugar algo caiu. <br><br><img src="https://habrastorage.org/webt/re/3g/tm/re3gtm_ueprckhhazzmefmehpze.png"><br><br>  O sistema realmente funciona - na semana passada fizemos os primeiros testes na produ√ß√£o de combate. <br><br>  Agora, sobre os pr√≥ximos passos, como, acreditamos, pode ser aprimorado. <br><br><img src="https://habrastorage.org/webt/er/mk/6h/ermk6hs7p-3zmqulgoxxobcugja.png"><br><br>  Mais importante, queremos que as pessoas tenham uma experi√™ncia legal do usu√°rio.  A id√©ia √© que podemos gerar uma grande carga em nosso aplicativo e tudo parece simples - medimos trivialmente o desempenho de cada solicita√ß√£o ao servidor, se ele continua a responder o mais r√°pido ou o in√≠cio da redu√ß√£o de desempenho (o servidor come√ßou a processar solicita√ß√µes de entrada mais lentamente).  Mas n√£o.  Na realidade, o cliente / aplicativo pode lan√ßar v√°rias solicita√ß√µes ao servidor de uma s√≥ vez, em um monte.  E espere at√© que todos sejam processados.  E se uma das solicita√ß√µes, a mais longa, como funcionou por 5 segundos e continuar a funcionar por 5 segundos, n√£o nos importamos absolutamente com como todos os outros trabalham - com rapidez ou lentid√£o para 4 segundos.  Afinal, ainda vamos esperar mais cinco segundos.  Ou voc√™ criou um ticket, tudo funcionou em um milissegundo, mas o ticket apareceu no sistema tarde demais por causa dos caches internos do √≠ndice.  A abordagem usual n√£o resolver√° esse problema; portanto, queremos tentar medir todos os cen√°rios e ver o quanto o script de cria√ß√£o de tickets realmente piorou. <br><br>  Porque  temos todos os cen√°rios baseados em chaves de acesso, podemos imitar executando uma pessoa na recep√ß√£o e 10 produtos de limpeza.  Ent√£o 20 ou 30 produtos de limpeza.  Mas a frente do povo ainda √© a mesma.  I.e.  podemos gerar uma carga real por padr√µes de comportamento, muito perto de uma carga realista. <br><br>  Tamb√©m testes multirregionais.  Nosso sistema √© usado em todo o mundo (embora tudo esteja hospedado na Am√©rica) e, portanto, podemos gerar uma carga da R√∫ssia e da Am√©rica para ver qual deles come√ßa a desacelerar mais rapidamente. <br><br><h3>  Perguntas da plat√©ia </h3><br><br>  <b>- Voc√™ √© for√ßado a escrever uma grande quantidade de l√≥gica e, quando algo muda um pouco, voc√™ quebra muitas coisas nos testes funcionais.</b>  <b>Acontece que voc√™ leva quase mais tempo para apoiar os testes do que para desenvolver?</b> <br><br>  "Sim, mas n√£o."  Este √© o BDD, n√£o s√£o testes funcionais, est√£o mais pr√≥ximos dos testes de integra√ß√£o.  E o que quer que mudemos, o cen√°rio continua o mesmo.  Pressiono um bot√£o, vejo uma janela, nele digito o n√∫mero da sala com a qual o pedido foi recebido, o nome da pessoa e a data em que reservar uma mesa.  Se o layout mudou, os campos mudaram de lugar, se algo acontecer no back-end, o teste ser√° salvo, porque estamos em um n√≠vel muito alto, clicamos nos bot√µes do navegador.  Portanto, estamos protegidos de um grande n√∫mero de altera√ß√µes.  H√° momentos em que tudo pode quebrar.  Portanto, no procedimento de lan√ßamento, aqueles que escrevem um novo recurso - eles s√£o respons√°veis ‚Äã‚Äãpor ver que algo est√° quebrado e consertado.  Mas at√© agora n√£o houve tais problemas em grandes n√∫meros. <br><br>  <b>- E voc√™ n√£o teve uma situa√ß√£o em que, ap√≥s uma mudan√ßa, todos os testes ficassem vermelhos.</b> <br><br>  - N√£o foi.  Teoricamente, isso pode acontecer se o script n√£o tiver um bot√£o, mas alguma outra maneira de abrir uma janela para inserir informa√ß√µes do ticket.  Mas, como mostrei anteriormente, todos os nossos cen√°rios consistem em etapas.  As etapas s√£o tudo, e se tivermos 100 scripts que clicam no mesmo bot√£o, a etapa ainda ser√° uma.  E se tudo der errado por causa dessa etapa espec√≠fica, n√≥s a corrigimos, reescrevemos e todos os testes ficam verdes imediatamente. <br><br>  Embora uma vez, quando quebramos algo acidentalmente, isso tenha acontecido conosco.  Apenas 40% do verde permaneceu, embora antes disso fosse 99%.  Essa foi uma pequena mudan√ßa.  Corrigimos um passo (linha de c√≥digo) e tudo ficou verde novamente. <br><br>  <b>- Embora voc√™ n√£o tenha testes de integra√ß√£o, eles n√£o s√£o totalmente funcionais.</b>  <b>De uma forma ou de outra, √© algum tipo de interface gr√°fica em que os bot√µes s√£o pressionados, algum tipo de intera√ß√£o ocorre especificamente com o shell externo.</b>  <b>Entendo que voc√™ tem testes neste formul√°rio, basta iniciar muitos threads ao mesmo tempo.</b>  <b>E por que eles n√£o organizaram as solicita√ß√µes geradas por ferramentas padr√£o: JMeter, Gatling, que n√£o interagem com o shell externo de forma alguma, mas simplesmente enviam solicita√ß√µes ao servidor?</b> <br><br>  Tudo √© muito simples.  Qual √© a arquitetura do nosso aplicativo?  Temos um back-end, temos um front-end.  Frontend √© a web.  Existe uma aplica√ß√£o m√≥vel.  E quando eu crio um ticket, meu front-end √© conectado, por exemplo, tamb√©m aos servidores de eventos.  Eu crio um ticket no back-end e todas as pessoas que est√£o sentadas no mesmo hotel observam os ingressos no mesmo hotel, elas chegam dos servidores de eventos: os caras atualizam, os dados mudam l√°.  E para juntar tudo, temos um √∫nico ponto - este √© o cliente.  Ele se conecta a um grande n√∫mero de v√°rios componentes e, se programamos com as m√£os, criamos um ticket no back-end e, em seguida, nos conectamos ao servidor de eventos, registramos nele e aguardamos alguns eventos.  Ou eles acabaram de lan√ßar um navegador no qual tudo j√° foi montado, esse c√≥digo j√° est√° escrito e fazemos tudo o que precisamos. <br><br>  <b>- Mas essas s√£o abordagens diferentes?</b>  <b>Ou trabalhamos especificamente com o servidor ou com a janela.</b>  <b>Voc√™ pode simular solicita√ß√µes para v√°rios servidores ao mesmo tempo.</b> <br><br>  - Foi por isso que eu disse que temos rob√¥s funcionais chamados de testes.  H√° quem pega o Chrome e realiza cliques de alto n√≠vel.  Existem aqueles que n√£o clicam no bot√£o, nada acontece, mas no momento da cria√ß√£o do ticket, ele envia uma solicita√ß√£o ao servidor e podemos executar isso ou aquilo.  Optamos por executar o Chrome por um motivo simples: queremos simular usu√°rios reais, da maneira como eles realmente o usam.  Enquanto sua p√°gina estava carregando, enquanto tudo era renderizado para ele, enquanto os scripts Java e assim por diante funcionavam.  Queremos estar o mais pr√≥ximo poss√≠vel do usu√°rio, e essa √© a Web real. <br><br>  <b>- Mas muitas coisas depender√£o de que tipo de usu√°rio a Internet √©, qual ambiente.</b>  <b>Mas, especificamente, a opera√ß√£o do aplicativo depender√° de voc√™ e do seu lado.</b> <b>,   :     -  ?</b> <br><br> ‚Äî  ,     - .       , , ,     .      ,      ,    .       YouTube    ,       .           ,   .    , . <br><br> <b>‚Äî   .    - Selenium Grid   ?     - .</b> <br><br> ‚Äî   Cucumber':    JAR, JAR   Docker image  Fargate' ,   image  .  flood.io  grid  Selenium      ,     . <br><br> <b>‚Äî      ?  ,    Chrome,     .     Internet Explorer 4 ( - ),    ?   -    Android   -.</b> <br><br> ‚Äî  ,  enterprise.  enterprise     ,   requirements.     ‚Äî      ,     ,  web view.   Android   web view    ,     . <br><br> <b>‚Äî  ,   ,    Load-?   ?</b> <br><br> ‚Äî  . <br><br><img src="https://habrastorage.org/webt/q7/95/x6/q795x6n2x0vwebvkaznad_6ndda.png"><br><br>  Environment   .     .    ,      Load,    .     4- ,   ,    aliceapp.com.    Load-    ,      .  ,      504,     ,     MySQL     ElasticSearch. <br><br> <b>‚Äî      ( ),    ,       ?          .</b> <br><br> ‚Äî  Load-        ,         .  I.e.   . <br><br> <b>‚Äî      ,     ?</b> <br><br> ‚Äî ,   .  ,      ,  ,      . <br><br> <b>‚Äî    ,         , ..   html       API?</b> <br><br> ‚Äî    Selenium      DOM-  :   ,     ,   key down  ,     ‚Äî .      . <br><br> <b>‚Äî   ? , ?</b> <br><br> ‚Äî      .    ,  .   QC,    ,  QC.    Smoke-   -.        ¬´  -,   ¬ª.   ‚Äî          ,    ,   ,           . <br><br><h3>    Pixonic DevGAMM Talks </h3><br><ul><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> Consul   stateful-</a> ( , DevOps   BIT.GAMES); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CICD:        </a> ( ,   Pixonic); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">     -  Quake Champions</a> ( , backend- Saber Interactive); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> -  - Tacticool</a> ( , Lead Software Engineer  PanzerDog); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> ECS, C# Job System  SRP    </a> ( , Field Engineer  Unity); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="> KISS  </a> ( , Lead Game Programmer  1C Game Studios); </li><li> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">      </a> ( , Deputy Technical Officer  Pixonic). </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt428349/">https://habr.com/ru/post/pt428349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt428339/index.html">N√£o automatize: m√°s dicas de neg√≥cios</a></li>
<li><a href="../pt428341/index.html">Tecnologia Qsan RAID EE</a></li>
<li><a href="../pt428343/index.html">Um quebra-cabe√ßa interessante em C</a></li>
<li><a href="../pt428345/index.html">Cobrindo requisitos com casos. Realidades do SuperJob</a></li>
<li><a href="../pt428347/index.html">O futuro do WebAssembly como uma "√°rvore de habilidades"</a></li>
<li><a href="../pt428353/index.html">Como criamos um sistema para rastreamentos m√≥veis no SIBUR</a></li>
<li><a href="../pt428355/index.html">Gamification Mechanics: Classifica√ß√£o</a></li>
<li><a href="../pt428357/index.html">Absor√ß√£o na pr√°tica: uma hist√≥ria de vida</a></li>
<li><a href="../pt428363/index.html">Construindo um jetpack / hoverboard: sistemas de resgate</a></li>
<li><a href="../pt428365/index.html">A hist√≥ria de como o faturamento do Google mudou ou como evitar custos desnecess√°rios</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>