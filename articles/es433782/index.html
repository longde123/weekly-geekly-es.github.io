<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧗🏽 🥨 🤰🏻 Un ejemplo práctico de crear su propio componente View 🕴🏻 😈 🌀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Me gusta Dribbble Hay muchos proyectos de diseño interesantes e inspiradores. Pero si usted es un desarrollador, a menudo la sensación de belleza rápi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un ejemplo práctico de crear su propio componente View</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433782/"><p><img src="https://habrastorage.org/getpro/habr/post_images/5c6/ece/f09/5c6ecef09bce1d621d5127f0e49338d1.jpg" alt="Un ejemplo práctico de crear su propio componente View"></p><br><p> Me gusta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dribbble</a>  Hay muchos proyectos de diseño interesantes e inspiradores.  Pero si usted es un desarrollador, a menudo la sensación de belleza rápidamente da paso a la desesperación cuando comienza a pensar en cómo implementar este diseño genial. </p><br><p>  En este artículo, le mostraré un ejemplo de dicho diseño y su implementación, pero antes de eso, hablemos sobre la solución del problema en su conjunto. </p><a name="habracut"></a><br><p>  La forma más fácil es usar algún tipo de biblioteca que cubra nuestras necesidades.  Ahora no me malinterpreten, soy un gran defensor del enfoque de "no reinventar la rueda".  Hay excelentes bibliotecas de código abierto, y cuando necesito cargar imágenes o implementar la API REST, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Glide</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Picasso</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Retrofit</a> me ayudarán mucho. </p><br><p>  Pero cuando necesita implementar un diseño inusual, esta no siempre es la mejor opción.  Deberá pasar tiempo buscando una buena biblioteca compatible que haga algo similar.  Luego, debe examinar el código para asegurarse de que se escriba algo adecuado allí.  Deberá dedicar más tiempo a comprender la configuración y las configuraciones que puede administrar para usar la biblioteca en sus tareas.  Y seamos honestos, lo más probable es que la biblioteca no cubra sus necesidades al 100%, y tendrá que hacer algunos compromisos con los diseñadores. </p><br><p> Por lo tanto, digo que a menudo es más fácil y mejor crear su propio componente <code>View</code> .  Cuando digo "componente de <code>View</code> nativo", me refiero a la extensión de la clase de <code>View</code> , anulando el método <code>onDraw()</code> y usando <code>Paint</code> y <code>Canvas</code> para dibujar el componente de <code>View</code> .  Esto puede parecer aterrador si no lo ha hecho antes, porque estas clases tienen muchos métodos y propiedades, pero puede centrarse en los principales: </p><br><ul><li><p>  <code>canvas.drawRect()</code> : especifica las coordenadas de las esquinas y dibuja un rectángulo; </p><br></li><li><p>  <code>canvas.drawRoundRect()</code> : opcionalmente, especifique el radio y las esquinas del rectángulo se redondearán; </p><br></li><li><p>  <code>canvas.drawPath()</code> es una forma más compleja, pero también más poderosa de crear su propia forma usando líneas y curvas; </p><br></li><li><p>  <code>canvas.drawText()</code> : para dibujar texto en el lienzo (con <code>Paint</code> puede controlar el tamaño, el color y otras propiedades); </p><br></li><li><p>  <code>canvas.drawCircle()</code> : especifique el punto central y el radio y obtenga un círculo; </p><br></li><li><p>  <code>canvas.drawArc()</code> : especifica el rectángulo delimitador, así como los ángulos de inicio y giro para dibujar el arco; </p><br></li><li><p>  <code>paint.style</code> : indica si la forma dibujada se rellenará, circulará o ambas; </p><br></li><li><p>  <code>paint.color</code> : indica el color (incluida la transparencia); </p><br></li><li><p>  <code>paint.strokeWidth</code> : controla el ancho de las formas de trazo; </p><br></li><li><p>  <code>paint.pathEffect</code> : le permite influir en la geometría de la figura dibujada; </p><br></li><li><p>  <code>paint.shader</code> : le permite dibujar degradados. </p><br></li></ul><br><p>  Recuerde, a veces puede que necesite usar otras API, pero incluso si domina estos métodos, puede dibujar formas muy complejas. </p><br><h2 id="prakticheskiy-primer">  Ejemplo práctico </h2><br><p>  Aquí hay un diseño que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Pepper</a> nos ofrece: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f9a/033/e21/f9a033e211e7dae32ea25a6449017765.png" alt="Diseño"></p><br><p>  Aquí hay muchas cosas interesantes, pero tomemos todo en pedazos pequeños. </p><br><h3 id="shag-1-rasschitat-pozicii-markerov">  Paso 1. Calcular las posiciones de los marcadores </h3><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcPositions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(markers: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Marker</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> max = markers.maxBy { it.value } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> min = markers.minBy { it.value } pxPerUnit = chartHeight / (max - min) zeroY = max * pxPerUnit + paddingTop <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> step = (width - <span class="hljs-number"><span class="hljs-number">2</span></span> * padding - scalesWidth) / (markers.size - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((i, marker) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> markers.withIndex()) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = step * i + paddingLeft <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = zeroY - entry.value * pxPerUnit marker.currentPos.x = x marker.currentPos.y = y } }</code> </pre> <br><p>  Encontramos los valores mínimos y máximos, calculamos la relación de píxeles por unidad, el tamaño del paso horizontal entre los marcadores y las posiciones X e Y. </p><br><h3 id="shag-2-narisovat-gradient">  Paso 2. Dibuja un gradiente </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/526/055/4f9/5260554f9e4702b526931cf68dac8bef.png" alt="Gradiente"></p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// prepare the gradient paint val colors = intArrayOf(colorStart, colorEnd)) val gradient = LinearGradient( 0f, paddingTop, 0f, zeroY, colors, null, CLAMP ) gradientPaint.style = FILL gradientPaint.shader = gradient private fun drawGradient(canvas: Canvas) { path.reset() path.moveTo(paddingLeft, zeroY) for (marker in markers) { path.lineTo(marker.targetPos.x, entry.targetPos.y) } // close the path path.lineTo(markers.last().targetPos.x, zeroY) path.lineTo(paddingLeft, zeroY) canvas.drawPath(path, gradientPaint) }</span></span></code> </pre> <br><p>  Creamos una forma comenzando desde el borde izquierdo, dibujando una línea entre cada marcador y terminando la forma en el punto inicial.  Luego dibuja esta forma usando pintura con un sombreador degradado. </p><br><h3 id="shag-3-narisovat-setku">  Paso 3. Dibuja una cuadrícula </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bbc/a14/ded/bbca14ded078fcf450e80f3451eb8988.png" alt="Malla"></p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// prepare the guideline paint dottedPaint.style = STROKE dottedPaint.strokeWidth = DOTTED_STROKE_WIDTH_DP dottedPaint.pathEffect = DashPathEffect(floatArrayOf(INTERVAL, INTERVAL), 0f) private fun drawGuidelines(canvas: Canvas) { val first = findFirstDayOfWeekInMonth(markers) for (i in first..markers.lastIndex step 7) { val marker = markers[i] guidelinePath.reset() guidelinePath.moveTo(entry.currentPos.x, paddingTop) guidelinePath.lineTo(entry.currentPos.x, zeroY) canvas.drawPath(guidelinePath, dottedPaint) } }</span></span></code> </pre> <br><p>  Configuramos la pintura para que dibuje con una línea punteada.  Luego usamos el ciclo de idioma especial de Kotlin, que nos permite iterar sobre los marcadores en pasos de 7 (la cantidad de días en una semana).  Para cada marcador, tomamos la coordenada X y dibujamos una línea de puntos vertical desde la parte superior del gráfico hasta <code>zeroY</code> . </p><br><h3 id="shag-4-narisovat-grafik-i-markery">  Paso 4. Dibuja un gráfico y marcadores </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4f1/a4d/e8c/4f1a4de8cc3e5b40fff2dd71a77d4e0a.png" alt="Gráfico y marcadores"></p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLineAndMarkers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousMarker: Marker? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (marker <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> markers) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousMarker != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// draw the line val p1 = previousMarker.currentPos val p2 = marker.currentPos canvas.drawLine(p1.x, p1.y, p2.x, p2.y, strokePaint) } previousMarker = marker // draw the marker canvas.drawCircle( marker.currentPos.x, marker.currentPos.y, pointRadius, pointPaint ) } }</span></span></code> </pre> <br><p>  Pasamos por los marcadores, dibujamos un círculo lleno para cada uno de ellos y una línea simple desde el marcador anterior al actual. </p><br><h3 id="shag-5-narisovat-knopki-nedel">  Paso 5. Dibuja los botones de las semanas </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e4a/113/85b/e4a11385be04e7b7094597339a291f88.png" alt="Botones de semanas"></p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawWeeks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((i, week) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> weeks.withIndex()) { textPaint.getTextBounds(week, <span class="hljs-number"><span class="hljs-number">0</span></span>, week.length, rect) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = middle(i) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = zeroY + rect.height() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> halfWidth = rect.width() / <span class="hljs-number"><span class="hljs-number">2f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> halfHeight = rect.height() / <span class="hljs-number"><span class="hljs-number">2f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> left = x - halfWidth - padding <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> top = y - halfHeight - padding <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> right = x + halfWidth + padding <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bottom = y + halfHeight + padding rect.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(left, top, right, bottom) paint.color = bgColor paint.style = FILL canvas.drawRoundRect(rect, radius, radius, paint) paint.color = strokeColor paint.style = STROKE canvas.drawRoundRect(rect, radius, radius, paint) canvas.drawText(week, x, keyY, textPaint) } }</code> </pre> <br><p>  Repasamos las marcas de la semana, encontramos la coordenada X de la mitad de la semana y comenzamos a dibujar el botón en capas: primero dibujamos un fondo con esquinas redondeadas, luego un borde y, finalmente, texto.  Ajustamos la pintura antes de dibujar cada capa. </p><br><h3 id="shag-6-narisovat-chislovye-markery-sprava">  Paso 6. Dibuja los marcadores numéricos a la derecha </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e2/fca/38c/5e2fca38cd0c3160c240cee8458d839f.png" alt="Marcadores numéricos"></p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGraduations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = markers.last().currentPos.x + padding <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> graduations) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = zeroY - scale * pxPerUnit <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> formatted = NumberFormat.getIntegerInstance().format(value) canvas.drawText(formatted, x, y, textPaint) } }</code> </pre> <br><p>  La coordenada X es la posición del último marcador más alguna sangría.  La coordenada Y se calcula utilizando la relación de píxeles por unidad.  Formateamos el número en una cadena (si es necesario, agregamos un separador de miles) y dibujamos el texto. </p><br><p>  Eso es todo, ahora nuestro <code>onDraw()</code> se verá así: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { drawGradient(canvas) drawGuidelines(canvas) drawLineAndMarkers(canvas) drawWeeks(canvas) drawGraduations(canvas) }</code> </pre> <br><p>  Y combinar las capas nos dará el resultado deseado: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/051/51e/d11/05151ed1197c4ae9f95d4dab4c3f54c2.png" alt="Resultado"></p><br><h2 id="itog">  Resumen </h2><br><ol><li>  No tenga miedo de crear sus propios componentes de <code>View</code> (si es necesario). </li><li>  Aprenda las API básicas de <code>Canvas</code> y <code>Paint</code> . </li><li>  Divide tu diseño en pequeñas capas y dibuja cada una independientemente. </li></ol><br><p>  En cuanto al último punto, para mí esta es una de las mejores lecciones de programación en general: cuando se enfrente a una tarea grande y compleja, divídala en tareas más pequeñas y simples. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433782/">https://habr.com/ru/post/es433782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433770/index.html">La ciencia de la búsqueda de empleo, parte VII: solo el 50% de los "requisitos" de una vacante deben coincidir</a></li>
<li><a href="../es433772/index.html">Herramienta de anotación de visión por computadora: marcado de datos todo en uno</a></li>
<li><a href="../es433774/index.html">Quién hace TeamLead Conf y por qué</a></li>
<li><a href="../es433776/index.html">Tutorial de controladores de MongoDB Go</a></li>
<li><a href="../es433780/index.html">Transición del kit UI al sistema de diseño en QIWI</a></li>
<li><a href="../es433786/index.html">Fintech Digest: la criptomoneda es propiedad, se ha emitido un número récord de tarjetas de crédito en la Federación Rusa</a></li>
<li><a href="../es433788/index.html">Oferta segura y nuevas revisiones independientes</a></li>
<li><a href="../es433790/index.html">Plantillas avanzadas de compilación de varias etapas</a></li>
<li><a href="../es433792/index.html">Scripts de shell en Ansible</a></li>
<li><a href="../es433796/index.html">Cómo el Homo Sapiens conquistó el mundo. Habilidades de comunicación y negociación.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>