<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äç‚ù§Ô∏è‚Äçüë® üìÄ üï¥üèæ Friday JS: una quine que juega tic-tac-toe üìÄ üèí üëÉüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Saludo a todos en mi secci√≥n tradicional llena de locura lovecraftiana. 

 En el proceso de escribir uno de los art√≠culos anteriores (no mires, no fue...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Friday JS: una quine que juega tic-tac-toe</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435732/"> Saludo a todos en mi secci√≥n tradicional llena de locura lovecraftiana. <br><br>  En el proceso de escribir uno de los art√≠culos anteriores (no mires, no fue particularmente bueno) pens√© en el hecho de que quine ... S√≠, por si acaso, te recuerdo: quine es un programa que muestra su propio texto y lo hace "honestamente" ( sin mirar, por ejemplo, este texto en un archivo en su disco duro).  En general, el tradicional puzomerka sin sentido de los programadores. <br><br>  Entonces, pens√© en el hecho de que quine, en principio, puede llevar una carga √∫til arbitraria.  Es decir, hacer cualquier otra cosa adem√°s de su funci√≥n principal.  Y como prueba de concepto, decid√≠ escribir una quine que juega al tic-tac-toe.  Y escribi√≥  Detalles sucios debajo del corte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/310/2e0/e41/3102e0e41c87371ea771188ab03d4c13.jpg" alt="imagen"><br><a name="habracut"></a><br>  "Pero, ¬øc√≥mo puede hacer algo m√°s que mostrar su texto?"  - tal vez preguntas.  Y f√°cil.  Adem√°s de la salida, el programa tambi√©n tiene entrada.  Si el programa muestra su texto en ausencia de entrada, entonces es quine.  Si el programa hace algo m√°s cuando hay informaci√≥n disponible, ¬øqui√©nes somos para condenarlo? <br><br>  Quiz√°s exponga inmediatamente las cartas sobre la mesa.  <a href="">Aqu√≠ hay un enlace a mi creaci√≥n.</a>  Hay tres entidades en el archivo por referencia: <br><br><ol><li>  La funci√≥n quine es de lo que estoy hablando. </li><li>  La funci√≥n evalAndCall es auxiliar. </li><li>  Clase de juego: incluso m√°s ayudante </li></ol><br>  Primero, hablaremos sobre c√≥mo trabajar con la funci√≥n quine, y luego c√≥mo funciona. <br><br><h3>  Como trabajar con ella </h3><br>  Al comienzo de la funci√≥n quine, puede ver lo siguiente: <br><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-comment"><span class="hljs-comment">/* |1|2|3| |4|x|6| |7|8|9| !  - ,     -. ,   .     ,    ,     .             ,    . :   - 0   - 0  - 0 */</span></span></code> </pre> <br>  El comentario al comienzo de la funci√≥n es la interfaz de usuario.  A trav√©s de √©l, la funci√≥n se comunicar√° con quienes la usen para el juego.  Al principio, pens√© en hacerlo a trav√©s de la consola, pero luego decid√≠ que ser√≠a m√°s correcto mantener <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">limpia</a> la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">funci√≥n</a> . <br><br>  Vamos a comprobar que la funci√≥n es realmente quine.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Aqu√≠,</a> por conveniencia, publiqu√© una p√°gina HTML (casi) vac√≠a con el script quine.js adjunto.  Al abrir las herramientas del desarrollador, puede conducir el siguiente c√≥digo de forma no selectiva all√≠: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quineText = quine(); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> evaluatedQuine = <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(<span class="hljs-string"><span class="hljs-string">"("</span></span> + quineText + <span class="hljs-string"><span class="hljs-string">")"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// ,     eval       //  undefined,   const evaluatedQuineText = evaluatedQuine(); quineText == evaluatedQuineText; // true</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Bore mod</b> <div class="spoiler_text">  De hecho, por supuesto, verificamos solo que la funci√≥n quine devuelve el texto de la quine, y no que en s√≠ misma sea la quine.  Y para ser absolutamente precisos, verificamos solo que la funci√≥n quine devuelve el texto de la funci√≥n, que en nuestro caso funcion√≥ como quine.  No hay garant√≠as de que adentro no contenga algo como: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() &lt; <span class="hljs-number"><span class="hljs-number">0.99</span></span>){ beAGoodQuine(); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ haltAndCatchFire(); }</code> </pre><br></div></div><br>  Ahora podemos intentar jugar con ella.  Digamos que hacemos el primer movimiento a la esquina superior izquierda del campo. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quineText = quine(<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  Ahora la "interfaz de usuario" es la siguiente: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">quine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">)</span></span>{<span class="hljs-comment"><span class="hljs-comment">/* |o|x|3| |4|x|6| |7|8|9| !  - ,     -. ,   .     ,    ,     .             ,    . :   - 0   - 0  - 0 */</span></span></code> </pre><br>  Quine tom√≥ en cuenta nuestro movimiento e hizo una respuesta en el campo central superior.  Por cierto, la funci√≥n resultante tambi√©n es quine: llamada sin argumentos, devolver√° su nuevo texto, y no el texto de la funci√≥n original.  Podemos jugar todo el juego, pero por conveniencia usaremos la funci√≥n auxiliar evalAndCall. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> quineText = quine(); <span class="hljs-comment"><span class="hljs-comment">//         ,    . /* |1|2|3| |4|x|6| |7|8|9| */ quineText = evalAndCall(quineText, 1) /* |x|o|3| |4|x|6| |7|8|9| */ quineText = evalAndCall(quineText, 3) /* |x|o|o| |4|x|6| |7|8|x|     .    ,   0    */ quineText = evalAndCall(quineText, 0) /* |1|2|3| |4|x|6| |7|8|9| :   - 0   - 1  - 0 */</span></span></code> </pre><br>  Voila!  Quine juega, gana e incluso anota.  Puedes jugar con √©l por m√°s tiempo, pero para mayor comodidad, te recomiendo usar la clase Game, con la que prob√© el juego yo mismo.  Creo que si lees hasta este punto, no necesito explicarte c√≥mo usarlo. <br><br><h3>  Como funciona </h3><br>  En general, la tarea consist√≠a en dos partes: escribir, si es posible, una funci√≥n concisa del juego del tic-tac-toe, y luego meterlo en la quine.  Comencemos con el tic-tac-toe. <br><br>  El n√∫cleo de la "inteligencia artificial" est√° en las l√≠neas 66-90 y su silueta se asemeja a una ardilla obstinada: <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> rules = { <span class="hljs-string"><span class="hljs-string">"o___x____"</span></span>: <span class="hljs-string"><span class="hljs-string">"ox__x__!_"</span></span>, <span class="hljs-string"><span class="hljs-string">"ox__x__o_"</span></span>: <span class="hljs-string"><span class="hljs-string">"ox!_x_xo_"</span></span>, <span class="hljs-string"><span class="hljs-string">"oxo_x_xo_"</span></span>: <span class="hljs-string"><span class="hljs-string">"oxo!xxxo_"</span></span>, <span class="hljs-string"><span class="hljs-string">"oxooxxxo_"</span></span>: <span class="hljs-string"><span class="hljs-string">"oxooxxxoxd"</span></span>, <span class="hljs-string"><span class="hljs-string">"_o__x____"</span></span>: <span class="hljs-string"><span class="hljs-string">"xo__x___!"</span></span>, <span class="hljs-string"><span class="hljs-string">"xo__x___o"</span></span>: <span class="hljs-string"><span class="hljs-string">"xo_xx!!_o"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> next = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">field, move</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!~<span class="hljs-string"><span class="hljs-string">"!_"</span></span>.indexOf(field[--move])){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } field[move] = <span class="hljs-string"><span class="hljs-string">"o"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> win = field.indexOf(<span class="hljs-string"><span class="hljs-string">"!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(~win){ field[win] = <span class="hljs-string"><span class="hljs-string">"x"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [...field, <span class="hljs-string"><span class="hljs-string">"w"</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> n = <span class="hljs-number"><span class="hljs-number">0</span></span>; n &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; n++){ field = field.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_, i</span></span></span><span class="hljs-function">) =&gt;</span></span> field[[<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>][i]]); rules[field.join(<span class="hljs-string"><span class="hljs-string">""</span></span>)] &amp;&amp; (field = rules[field.join(<span class="hljs-string"><span class="hljs-string">""</span></span>)].split(<span class="hljs-string"><span class="hljs-string">""</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> field; }</code> </pre> <br>  Este c√≥digo parece un poco confuso porque estaba interesado en hacerlo lo m√°s breve posible.  Su esencia es la siguiente: el estado del campo, una matriz de nueve elementos, y el n√∫mero de la celda donde el jugador-persona realiza un movimiento (el siguiente verifica la validez de este movimiento), ingresa a la siguiente funci√≥n.  Cada elemento del campo puede ser una cruz, un cero, un gui√≥n bajo (celda vac√≠a) o un signo de exclamaci√≥n (una celda vac√≠a en la que poner una cruz en la primera oportunidad).  Si hay un signo de exclamaci√≥n en el campo, inmediatamente hacemos un movimiento all√≠ y ganamos.  De lo contrario, pegamos la matriz en una cadena y buscamos la regla correspondiente en el objeto de reglas.  Para ahorrar espacio, las reglas son precisas para la rotaci√≥n; por lo tanto, para buscar, el campo se gira cuatro veces.  Cuando se encuentra la regla deseada, el estado del campo se reemplaza por el valor de la regla, dividido en caracteres.  A continuaci√≥n, la siguiente funci√≥n devuelve el nuevo estado del campo.  Al mismo tiempo, puede unirse un d√©cimo personaje adicional: "w" - si la IA gan√≥, "d" - si hubo un empate. <br><br>  Gracias a los signos de exclamaci√≥n, "pistas" y la rotaci√≥n del campo, y tambi√©n, por supuesto, debido a que la IA se mueve primero, la estrategia √≥ptima se describi√≥ en solo 6 reglas. <br><br>  Usando la siguiente funci√≥n, la funci√≥n quine procesa la entrada y escribe algunos campos en el objeto magicHash.  Y aqu√≠ pasamos sin problemas a la segunda parte: c√≥mo funciona el componente "quayne".  Toda la magia est√° en el objeto magicHash y su propiedad magicString. <br><br>  La l√≠nea magicString, como puede ver f√°cilmente, contiene texto de programa casi completamente duplicado.  Sin embargo, como todos los que han intentado escribir un quine lo saben, no se puede insertar un texto completamente completo en √©l, porque entonces tendr√° que contenerse estrictamente, lo que es imposible para cadenas de longitud finita.  Por lo tanto, adem√°s del texto "simple", tambi√©n contiene secuencias de comodines "m√°gicas" delimitadas en ambos lados por el car√°cter "$". <br><br>  Cuando llega el momento X y tenemos que devolver el texto de la funci√≥n, simplemente tomamos magicString y reemplazamos las secuencias comod√≠n con las propiedades correspondientes del objeto magicHash.  Estas propiedades pueden ser est√°ticas (retroceso), cambiar en tiempo de ejecuci√≥n (campo) o incluso agregarse en tiempo de ejecuci√≥n (mensaje); no importa.  Es importante que para cada fragmento de c√≥digo "problem√°tico" que no se pueda simplemente duplicar en una l√≠nea, tengamos una propiedad "m√°gica" del objeto magicHash.  El √∫ltimo sustituye a magicString.  El √∫ltimo, porque de lo contrario habr√≠a secuencias comod√≠n adicionales que tambi√©n ser√≠an reemplazadas. <br><br><h3>  Resumen </h3><br>  Compruebo por experiencia propia que puedes meter cualquier cosa en una quine.  En principio, si te molestas, puedes hacer un generador de quine, una funci√≥n que convierte cualquier otra funci√≥n pura en quine y te permite almacenar un estado arbitrario al que puede acceder la funci√≥n pura anterior.  Sin embargo, los m√°rgenes de este manuscrito son demasiado estrechos ... <br><br>  En general, no pretendo la novedad especial de mi "descubrimiento".  Los funcionarios hardcore deben haber le√≠do este texto con una sonrisa de excelencia.  Pero fue interesante para m√≠ levantarlo con mis propias manos, poner, por as√≠ decirlo, dedos en heridas.  Y espero que te haya interesado leer sobre eso. <br><br>  Adi√≥s, ni√±as y ni√±os.  Nos vemos de nuevo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es435732/">https://habr.com/ru/post/es435732/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es435720/index.html">Desarrollo Adblock Radio</a></li>
<li><a href="../es435722/index.html">NB-IoT, Internet de las cosas de banda estrecha. Modos de ahorro de energ√≠a y comandos de control</a></li>
<li><a href="../es435724/index.html">Reteniendo los vicios del imperativo</a></li>
<li><a href="../es435728/index.html">[Viernes] Relato de c√≥mo la venta de TI intent√≥ vender le√±a, o el backstage de una licitaci√≥n</a></li>
<li><a href="../es435730/index.html">La c√°scara se rompi√≥</a></li>
<li><a href="../es435734/index.html">C√≥mo no dejarse enga√±ar haciendo f√≠sica</a></li>
<li><a href="../es435738/index.html">T√©cnica de proyecto de bricolaje. Primera parte</a></li>
<li><a href="../es435740/index.html">El registro est√° abierto en GraphQL Meetup en San Petersburgo</a></li>
<li><a href="../es435742/index.html">Gesti√≥n de recursos en Zimbra Collaboration Suite</a></li>
<li><a href="../es435744/index.html">Fintech digest: el Banco de Rusia podr√° bloquear sitios, los vol√∫menes de pr√©stamos p2p est√°n cayendo, las criptomonedas en Europa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>