<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ฉ๐ผโ๐ป ๐ฑ ๐คน Spring Data JPA: ุฌูุจ ุงููููุงุช ๐๐ฝ ๐ฉ๐ปโ๐คโ๐จ๐ฟ ๐ช๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจูุง ุ ูุฐู ูู ุงููุดุงุฑูุฉ ุงูุซุงููุฉ ุญูู Spring Data JPA. ุงูุฌุฒุก ุงูุฃูู ูุงู ููุฑุณูุง ุชูุงููุง ููุฎุฏุงุน ุชุญุช ุงููุงุก ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุตุงุฆุญ ูู ุฐูู ุงูุฎุจุฑุฉ. ูู ูุฐุง ุงูุฌุฒุก ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Spring Data JPA: ุฌูุจ ุงููููุงุช</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444240/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ูุฑุญุจูุง ุ ูุฐู ูู ุงููุดุงุฑูุฉ ุงูุซุงููุฉ ุญูู Spring Data JPA.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฌุฒุก ุงูุฃูู</a> ูุงู ููุฑุณูุง ุชูุงููุง ููุฎุฏุงุน ุชุญุช ุงููุงุก ุ ุจุงูุฅุถุงูุฉ ุฅูู ูุตุงุฆุญ ูู ุฐูู ุงูุฎุจุฑุฉ.  ูู ูุฐุง ุงูุฌุฒุก ุณูู ูุชุญุฏุซ ุนู ููููุฉ ุตูู ุงูุฅุทุงุฑ ูุงุญุชูุงุฌุงุชู.  ุฌููุน ุงูุฃูุซูุฉ ุงูููุถุญุฉ ูุชุงุญุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . </p><a name="habracut"></a><br><h4 id="grafy" style=";text-align:right;direction:rtl">  ุงูุชูู </h4><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุ ุฑุจูุง ุ ุจูููุฉ ุจุณูุทุฉ ููู ููุณ ุงูููุช: ุนูุฏ ุชุญููู ููุงู ุ ูู ุงูุถุฑูุฑู ุชูุฒูู "ุงุจูุชู" ุจุดูู ุงูุชูุงุฆู.  ุงููุธุฑ ูู ูุซุงู ุจุณูุท: </p><br><pre style=";text-align:right;direction:rtl"><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"parent_id"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.LAZY, cascade = CascadeType.ALL) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Parent parent; } <span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Parent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูููุงู ุงููุฑุนู ูู ูุซุงููุง ูุณูู: ูุง ูุฑูุฏ ุชุญููู ุจูุงูุงุช ุบูุฑ ุถุฑูุฑูุฉ (ูุงูุงูุถูุงู ุฅูู ุฌุฏูู ุขุฎุฑ ูู ุงุณุชุนูุงู SQL) ุนูุฏ ุชููู <code>Child</code> .  ููู ูู ุจุนุถ ุงูุญุงูุงุช ูู ุทูุจูุง ุ ูุนุฑู ุจุงูุชุฃููุฏ ุฃููุง ุณูุญุชุงุฌ ุฅูู ูู ูู ุงูุทูู ููุงูุฏู.  ุฅุฐุง ุชุฑูุช ุงูููุงู ูุณูู ุ ูุณูุญุตู ุนูู ุทูุจูู ูููุตููู.  ุฅุฐุง ุทุจูุช ุนูููุฉ ุงูุชุญููู ุงูุณุฑูุน ุนู ุทุฑูู ุฅุฒุงูุฉ <code>FetchType.LAZY</code> ุ ูุณูุชู ุชุญููู ุงูููุงููู ุฏุงุฆููุง ุนูุฏ ุงูุทูุจ ุงูุฃูู (ููุญู ูุง ูุฑูุฏ ุฐูู). </p><br><p style=";text-align:right;direction:rtl">  ูููุฑ JPQL ุญูุงู ุฌูุฏูุง ูู ุฎุงุฑุฌ ุงูุตูุฏูู - ูุฐู ูู ุงููููุฉ ุงูุฑุฆูุณูุฉ <code>fetch</code> : </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from Child c join fetch c.parent where c.id = :id"</span></span>) <span class="hljs-function"><span class="hljs-function">Child </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByIdFetchParent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Param(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id)</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูุทูุจ ุจุณูุท ููุงุถุญ ุ ููู ุจู ุนููุจ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุฏ ูููุง ุจุงููุนู ุจุชูุฑุงุฑ ููุทู <code>JpaRepository::findById</code> ุจุฅุถุงูุฉ ุชุญููู ุตุฑูุญ </li><li style=";text-align:right;direction:rtl">  <code>@Query</code> ูุญุต ูู ุงุณุชุนูุงู ุชู ูุตูู ุจุงุณุชุฎุฏุงู <code>@Query</code> ุนูุฏ ุจุฏุก ุชุดุบูู ุงูุชุทุจูู ุ ููุง ูุชุทูุจ ุชุญููู ุงูุงุณุชุนูุงู ุ ูุงูุชุญูู ูู ุงููุณุงุฆุท ุ ููุง ุฅูู ุฐูู (ุฑุงุฌุน <a href="">org.springframework.data.jpa.repository.query.SimpleJpaQuery :: validateQuery</a> ).  ูู ูุฐุง ุนูู ูุณุชุบุฑู ููุชูุง ูุฐุงูุฑุฉ. </li><li style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ูุซู ูุฐุง ุงูููุฌ ูู ูุดุฑูุน ูุจูุฑ ูุน ุนุดุฑุงุช ุงููุณุชูุฏุนุงุช ูุงูููุงูุงุช ุงููุฑุชุจุทุฉ (ูู ุจุนุถ ุงูุฃุญูุงู ูุน ุนุดุฑุงุช ูู "ุจูุงุช") ุณูุคุฏู ุฅูู ุงููุฌุงุฑ ุงูุฏูุงุฌู. </li></ul><br><p style=";text-align:right;direction:rtl">  ุงูุชูู ุชุฃุชู ููุณุงุนุฏุชูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@NamedEntityGraphs</span></span>(value = { <span class="hljs-meta"><span class="hljs-meta">@NamedEntityGraph</span></span>( name = Child.PARENT, attributeNodes = <span class="hljs-meta"><span class="hljs-meta">@NamedAttributeNode</span></span>(<span class="hljs-string"><span class="hljs-string">"parent"</span></span>) ) }) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PARENT = <span class="hljs-string"><span class="hljs-string">"Child[parent]"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"parent_id"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.LAZY, cascade = CascadeType.ALL) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Parent parent; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฑุณู ุงูุจูุงูู ููุณู ุณูู ุงููุตู ุ ุชุจุฏุฃ ุงูุตุนูุจุงุช ุนูุฏ ุงุณุชุฎุฏุงูู.  Spring Data JPA ูู ุตูุญุชูุง ุชูุชุฑุญ ุงูููุงู ุจุฐูู ุจูุฐู ุงูุทุฑููุฉ (ููุง ููุทุจู ุนูู ุญุงูุชูุง): </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroupRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GroupInfo</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@EntityGraph</span></span>(value = Child.PARENT) <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from Child c where c.id = :id"</span></span>) <span class="hljs-function"><span class="hljs-function">Child </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findByIdFetchParent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Param(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"id"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> Long id)</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฑู ููุง ุฌููุน ุงููุดููุงุช ููุณูุง (ุจุงุณุชุซูุงุก ุฃู ุงูุทูุจ ุงูููุชูุจ ุฃุตุจุญ ุฃุณูู ููููุงู).  ููููู ูุถุน ุญุฏ ููุง ูู ุถุฑุจุฉ ูุงุญุฏุฉ ุจูุณุงุนุฏุฉ ุตูู.  ูู ุจุฅูุดุงุก ุงููุงุฌูุฉ ุงูุฎุงุตุฉ ุจู ุ ูุงูุชู ุณูู ูุณุชุฎุฏููุง ูุจูุงุก ูุณุชูุฏุนุงุช ุจุฏูุงู ูู <code>JpaRepository</code> ุงููุนุจุฃุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@NoRepositoryBean</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-function">T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ID id, String graphName)</span></span></span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุงูุชูููุฐ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJpaRepositoryImpl</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ID</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> JpaEntityInformation&lt;T, ?&gt; entityInfo; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EntityManager entityManager; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BaseJpaRepositoryImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(JpaEntityInformation&lt;T, ?&gt; ei, EntityManager em)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(ei, em); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityInfo = ei; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.entityManager = em; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ID id, String graphName)</span></span></span><span class="hljs-function"> </span></span>{ Assert.notNull(id, <span class="hljs-string"><span class="hljs-string">"The given id must not be null!"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  EntityGraph&lt;?&gt; graph = entityManager.getEntityGraph(graphName); Map&lt;String, Object&gt; hints = singletonMap(QueryHints.HINT_LOADGRAPH, graph); return entityManager.find(getDomainClass(), id, hints); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ููุฒู ุงูุฑุจูุน ุจุงุณุชุฎุฏุงู <code>BaseJpaRepositoryImpl</code> ูุฃุณุงุณ ูุฌููุน ูุณุชูุฏุนุงุช ุชุทุจูููุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@EnableJpaRepositories</span></span>(repositoryBaseClass = BaseJpaRepositoryImpl.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppConfig</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุณุชููู ุทุฑููุชูุง ูุชุงุญุฉ ูู ุฌููุน ุงููุณุชูุฏุนุงุช ุงูููุฑูุซุฉ ูู ูุณุชูุฏุน <code>BaseJpaRepository</code> ุจูุง. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ุงูููุฌ ูู ุนูุจ ูุงุญุฏ ูููู ุฃู ูุถุน ุฎูุฒูุฑ ุณููู ููุบุงูุฉ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุญุงูู ุฃู ุชููุฑ ุจููุณู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุงููุดููุฉ ูู ุฃู ุงูุณุจุงุช (ุนูู ุงูุฃูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ) ูุง ูุชุทุงุจู ูุน ุฃุณูุงุก ุงูุฑุณูู ุงูุจูุงููุฉ ูุงูุฑุณูู ุงูุจูุงููุฉ ููุณูุง.  ููุฐุง ุงูุณุจุจ ุ ูุฏ ูููู ููุงู ุฎุทุฃ ูู ููุช ุงูุชุดุบูู ุนูุฏูุง ูููู ุจุชูููุฐ ุดูุก ูู ูุฐุง ุงููุจูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">Optional&lt;MyEntity&gt; entity = repository.findById(id, NON_EXISTING_GRAPH);</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ููููู ุงูุชุญูู ูู ุตุญุฉ ุงูุญู ุจุงุณุชุฎุฏุงู ุงูุงุฎุชุจุงุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Sql</span></span>(<span class="hljs-string"><span class="hljs-string">"/ChildRepositoryGraphTest.sql"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepositoryGraphTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Long childId = <span class="hljs-number"><span class="hljs-number">1L</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGraph_expectFieldInitialized</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Child child1 = childRepository.findOne(childId, Child.PARENT); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> initialized = Hibernate.isInitialized(child1.getParent()); assertTrue(initialized); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testGraph_expectFieldNotInitialized</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Child child1 = childRepository .findById(childId) .orElseThrow(NullPointerException::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> initialized = Hibernate.isInitialized(child1.getParent()); assertFalse(initialized); } }</code> </pre> <br><h4 id="kogda-derevya-byli-bolshimi" style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุงูุช ุงูุฃุดุฌุงุฑ ูุจูุฑุฉ </h4><br><p style=";text-align:right;direction:rtl">  ูููุง ุตุบุงุฑูุง ูุนุฏููู ุงูุฎุจุฑุฉ ุ ุบุงูุจูุง ูุง ูุงู ุนูููุง ุฑุคูุฉ ูุฐุง ุงูุฑูุฒ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;DailyRecord&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findBetweenDates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date from, Date to)</span></span></span><span class="hljs-function"> </span></span>{ StringBuilder query = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(<span class="hljs-string"><span class="hljs-string">"from Record "</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (from != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { query.append(<span class="hljs-string"><span class="hljs-string">" where date &gt;="</span></span>).append(format(from)).append(<span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (to != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (from == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { query.append(<span class="hljs-string"><span class="hljs-string">" where date &lt;= "</span></span> + format(to) + <span class="hljs-string"><span class="hljs-string">" "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { query.append(<span class="hljs-string"><span class="hljs-string">" and date &lt;= "</span></span> + format(to) + <span class="hljs-string"><span class="hljs-string">" "</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> em.createQuery(query.toString(), DailyRecord.class).getResultList(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌูุน ูุฐุง ุงูุฑูุฒ ูุทุนุฉ ุงูุทูุจ ูุทุนุฉ.  ุนููุจ ูุฐุง ุงูููุฌ ูุงุถุญุฉ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนููู ุฃู ุชูุนู ุงููุซูุฑ ุจูุฏูู </li><li style=";text-align:right;direction:rtl">  ุญูุซ ููุฌุฏ ุนูู ูุฏูู - ููุงู ุฃุฎุทุงุก </li><li style=";text-align:right;direction:rtl">  ูุง ุชุณููุท ุงูุถูุก ุนูู ุจูุงุก ุงูุฌููุฉ (ุงูุฃุฎุทุงุก ุงููุทุจุนูุฉ ูู ููุช ุงูุชุดุบูู) </li><li style=";text-align:right;direction:rtl">  ูู ุงูุตุนุจ ููุบุงูุฉ ุชูุฏูุฏ ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุงูุญูุงุธ ุนูููุง </li></ul><br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุจูููู ุ ุธูุฑุช ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุงููุนุงููุฑ ุ ูุงูุชู ุณูุญุช ููุง ุจุถุบุท ุงูููุฏ ุฃุนูุงู ููููุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;DailyRecord&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findBetweenDates</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Date from, Date to)</span></span></span><span class="hljs-function"> </span></span>{ Criteria criteria = em .unwrap(Session.class) .createCriteria(DailyRecord.class); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (from != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { criteria.add(Expression.ge(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, from)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (to != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { criteria.add(Expression.le(<span class="hljs-string"><span class="hljs-string">"date"</span></span>, to)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> criteria.list(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุณุชุฎุฏุงู ุงููุนุงููุฑ ูู ุงูุนุฏูุฏ ูู ุงููุฒุงูุง: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงููุฏุฑุฉ ุนูู ุงุณุชุฎุฏุงู metamodel ุจุฏูุงู ูู ุงูููู "ุงูุณูููุฉ" ูุซู "date" </li><li style=";text-align:right;direction:rtl">  ุชุชุญูู ุจุนุถ ุงูุฃุฎุทุงุก ูู ุฅูุดุงุก ุงูุทูุจ ุฅูู ุฃุฎุทุงุก ูู ุงูุชุฑุฌูุฉ ุ ุจูุนูู ุฃูู ุชู ุงูุชุดุงููุง ุจุงููุนู ุนูุฏ ุงููุชุงุจุฉ </li><li style=";text-align:right;direction:rtl">  ุงูุฑูุฒ ุฃูุตุฑ ูุฃูุซุฑ ูุถูุญูุง ูู ุฎูุงู ุณูุงุณู ุงููุตู ุงูุบุจูุฉ </li></ul><br><p style=";text-align:right;direction:rtl">  ููุงู ุฃูุถุง ุนููุจ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุฑูุฒ ูุนูุฏุฉ ุจูุง ููู ุงูููุงูุฉ ูููู </li><li style=";text-align:right;direction:rtl">  ููุนุฑูุฉ ููููุฉ ูุชุงุจุฉ ูุซู ูุฐู ุงูุงุณุชุนูุงูุงุช ุ ูุฌุจ ุฃู ุชููุฃ ูุฏู (ุฃุชุฐูุฑ ุฃูููุง ุดุฏูุฏูุง ุนูุฏูุง ุงุถุทุฑุฑุช ููุชุนุงูู ูุน ุชุตุญูุญ ุงูุฃุฎุทุงุก ูุฃูู ูุฑุฉ ูู ูุซู ูุฐู ุงูุงุณุชุนูุงูุงุช ุ ุงูุชู ุชุชููู ุฃุญูุงููุง ูู 100 ุฅูู 150 ุณุทุฑูุง ุ ูุชูุฑุนุฉ ุ ุฅูุฎ) </li><li style=";text-align:right;direction:rtl">  ุงุณุชุนูุงู ูุนูุฏ ูุฑูู ุฅูู ุญุฏ ูุง (50 ุณุทุฑูุง ุจุนูุฏูุง ุนู ุงูุญุฏ ุงูุฃูุตู) </li></ul><br><p style=";text-align:right;direction:rtl">  ุฃุฑูุฏ ุชุทููุฑู ุจุณูููุฉ ูุจูู ุณุฑูุฑ ุ ูุฐูู ุฃูุง ูุง ุฃุญุจ ููุชุง ุงูุทุฑููุชูู. </p><br><p style=";text-align:right;direction:rtl">  ุฏุนูุง ููุชูู ุฅูู ุงูููุงู ุงูุฐู ุฏุฑุณูุงู ุจุงููุนู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@JoinColumn</span></span>(name = <span class="hljs-string"><span class="hljs-string">"parent_id"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@ManyToOne</span></span>(fetch = FetchType.LAZY, cascade = CascadeType.ALL) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Parent parent; <span class="hljs-comment"><span class="hljs-comment">//... @OneToMany(mappedBy = "owner", cascade = CascadeType.ALL) @LazyCollection(value = LazyCollectionOption.EXTRA) private List&lt;Toy&gt; toys = new ArrayList&lt;&gt;(); }</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃูุฏ ุฃู ุฃููู ูุงุฏุฑูุง ุนูู ุชุญููู ููุงู ูู ุฃูุถุงุน ูุฎุชููุฉ (ููุฌููุนุงุชูุง): </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชุญููู (ุฃู ูุง) ุงูุฃู </li><li style=";text-align:right;direction:rtl">  ุชุญููู (ุฃู ูุง) ุงููุนุจ </li><li style=";text-align:right;direction:rtl">  ูุฑุฒ ุงูุฃุทูุงู ุญุณุจ ุงูุนูุฑ </li></ul><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุจุญู ูุฐู ุงููุดููุฉ ูุฌูุงู ููุฌู ุ ุฃู ุนู ุทุฑูู ูุชุงุจุฉ ุงููุซูุฑ ูู ุงูุงุณุชุนูุงูุงุช ุงูุชู ุชุชูุงูู ูุน ูุถุน ุงูุชุญููู ุงููุญุฏุฏ ุ ูุณูุคุฏู ุฐูู ุณุฑูุนูุง ุฅูู ุงููุฌุงุฑ ุงูุฏูุงุฌู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from Child c join fetch c.parent order by c.age"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Child&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findWithParentOrderByAge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from Child c join fetch c.toys order by c.age"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Child&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findWithToysOrderByAge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select c from Child c join fetch c.parent join fetch c.toys"</span></span>) <span class="hljs-function"><span class="hljs-function">List&lt;Child&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findWithParentAndToys</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//...</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุทุฑููุฉ ุจุณูุทุฉ ูุฃูููุฉ ูุญู ูุฐู ุงููุดููุฉ: ูุฒูุฌ ูู ูุญุฑูุงุช SQL / HQL ูุงููุงูุจ.  ุชู ุงุณุชุฎุฏุงู "Freemarker" ูู ูุดุงุฑูุนู ุ ุนูู ุงูุฑุบู ูู ุฅููุงููุฉ ุงุณุชุฎุฏุงู ุญููู ุฃุฎุฑู ("Timlif" ุ "Mustash" ุ ููุง ุฅูู ุฐูู). </p><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุฎูู.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุญุชุงุฌ ุฅูู ูุตู ุงูุงุณุชุนูุงู ูู ููู ูุชููู ุงูุงูุชุฏุงุฏ <code>*.hql.ftl</code> ุฃู <code>*.sql.ftl</code> (ูู ุญุงูุฉ ุงุณุชุฎุฏุงู SQL "ุฎุงูุต"): </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-comment"><span class="hljs-comment">#* @vtlvariable name="fetchParent" type="java.lang.Boolean" *# #* @vtlvariable name="fetchToys" type="java.lang.Boolean" *# #* @vtlvariable name="orderByAge" type="java.lang.Boolean" *# select child from Child child #if($fetchParent) left join fetch child.parent #end #if($fetchToys) left join fetch child.toys #end #if($orderByAge) order by child.age #end</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃูุช ุงูุขู ุจุญุงุฌุฉ ุฅูู ูุนุงูุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TemplateParser</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Configuration configuration; <span class="hljs-meta"><span class="hljs-meta">@SneakyThrows</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String templateName, Map&lt;String, Object&gt; params)</span></span></span></span>{ Template template = configuration.getTemplate(templateName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FreeMarkerTemplateUtils.processTemplateIntoString(template, params); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ุดูุก ูุนูุฏ.  ุงููุตูู ุฅูู ุงููุณุชูุฏุน.  ูู ุงููุงุถุญ ุฃู ุงููุงุฌูุฉ <code>JpaRepository</code> ูุง <code>JpaRepository</code> .  ุจุฏูุงู ูู ุฐูู ุ ุณูุณุชุบู ุงููุฑุตุฉ ูุฅูุดุงุก ูุณุชูุฏุนุงุชูุง ุงูุฎุงุตุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepositoryCustom</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">List&lt;Child&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fetchParent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fetchToys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order)</span></span></span></span>; } <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepositoryImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseDao</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepositoryCustom</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TemplateParser templateParser; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Child&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fetchParent, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fetchToys, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> order)</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; params = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;&gt;(); params.put(<span class="hljs-string"><span class="hljs-string">"fetchParent"</span></span>, fetchParent); params.put(<span class="hljs-string"><span class="hljs-string">"fetchToys"</span></span>, fetchToys); params.put(<span class="hljs-string"><span class="hljs-string">"orderByAge"</span></span>, orderByAge); String query = templateParser.prepareQuery(BASE_CHILD_TEMPLATE.name, params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> em.createQuery(query, Child.class).getResultList(); } <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> RepositoryTemplates { BASE_CHILD_TEMPLATE(<span class="hljs-string"><span class="hljs-string">"BaseChildTemplate.hql.ftl"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String name; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุนู ุทุฑููุฉ <code>findUsingTemplate</code> ูููู ุงููุตูู ุฅูููุง ูู <code>ChildRepository</code> ุชุญุชุงุฌ ุฅูู ุงูููุงู ุจุฐูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseJpaRepository</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Child</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">&gt;, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChildRepositoryCustom</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุฒุฉ ูููุฉ ูุฑุชุจุทุฉ ุจุงูุงุณู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุณูููู Spring ุจุฑุจุท ูุตููุง ููุงุฌูุงุชูุง ููุท ุจุงูุงุณู ุงูุตุญูุญ: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ChildRepository </li><li style=";text-align:right;direction:rtl">  ุชุดุงููุฏูุณุจูุชูุฑู <strong>ูุฎุตุต</strong> </li><li style=";text-align:right;direction:rtl">  ูุณุชูุฏุน ุฅูุฏุงุน ุงูุทูู </li></ul><br><p style=";text-align:right;direction:rtl">  ุชุฐูุฑ ุฐูู ุ ูุฃูู ูู ุญุงูุฉ ูุฌูุฏ ุฎุทุฃ ูู ุงูุงุณู ุ ุณูุชู ุทุฑุญ ุงุณุชุซูุงุก ุบูุฑ ููููู ุ ุญูุซ ูุณุชุญูู ููู ุณุจุจ ุงูุฎุทุฃ. </p></div></div><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุจุงุณุชุฎุฏุงู ูุฐุง ุงูููุฌ ููููู ุญู ูุดุงูู ุฃูุซุฑ ุชุนููุฏุง.  ูููุชุฑุถ ุฃููุง ุจุญุงุฌุฉ ุฅูู ุฅุฌุฑุงุก ุงุฎุชูุงุฑ ุจูุงุกู ุนูู ุงูุฎุตุงุฆุต ุงูุชู ูุญุฏุฏูุง ุงููุณุชุฎุฏู.  ุจูุนูู ุขุฎุฑ ุ ุฅุฐุง ูู ูุญุฏุฏ ุงููุณุชุฎุฏู ุงูุชูุงุฑูุฎ "ูู" ู "ุฅูู" ุ ููู ูููู ููุงู ููุช ููุชุตููุฉ.  ุฅุฐุง ุชู ุชุญุฏูุฏ ุงูุชุงุฑูุฎ "ูู" ุฃู ููุท ุงูุชุงุฑูุฎ "ุฅูู" ุ ูุณูุชู ุงูุชุตููุฉ ูู ุงุชุฌุงู ูุงุญุฏ.  ุฅุฐุง ุชู ุชุญุฏูุฏ ููุง ุงูุชุงุฑูุฎูู ุ ูุณูุชู ุชุญุฏูุฏ ุงูุณุฌูุงุช ุจูู ุงูุชูุงุฑูุฎ ุงููุญุฏุฏุฉ ููุท ูู ุงูุชุญุฏูุฏ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Getter</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequiredArgsConstructor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestDto</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalDate from; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LocalDate to; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasDateFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> from != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasDateTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> to != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Child&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ChildRequest request)</span></span></span><span class="hljs-function"> </span></span>{ Map&lt;String, Object&gt; params = singletonMap(<span class="hljs-string"><span class="hljs-string">"request"</span></span>, request); String query = templateParser.prepareQuery(TEMPLATE.name, params); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> em.createQuery(query, Child.class).getResultList(); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุงููุงูุจ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs">&lt;<span class="hljs-comment"><span class="hljs-comment">#-- @ftlvariable name="request" type="...RequestDto" --&gt; select child from Child child &lt;#if request.hasDateFrom() &amp;&amp; request.hasDateTo()&gt; where child.birthDate &gt;= :dateFrom and child.birthDate &lt;= :dateTo &lt;#elseif request.hasDateFrom()&gt; where child.birthDate &gt;= :dateFrom &lt;#elseif request.hasDateTo()&gt; where child.birthDate &lt;= :dateTo &lt;/#if&gt;</span></span></code> </pre> <br><h4 id="orakl-i-nvl" style=";text-align:right;direction:rtl">  ุฃูุฑุงูู ู nvl </h4><br><p style=";text-align:right;direction:rtl">  ุงููุธุฑ ูู ุฌููุฑ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DailyRecord</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Long id; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String currency; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"record_rate"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal rate; <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"fixed_rate"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal fxRate; <span class="hljs-meta"><span class="hljs-meta">@Setter</span></span>(value = AccessLevel.PRIVATE) <span class="hljs-meta"><span class="hljs-meta">@Formula</span></span>(<span class="hljs-string"><span class="hljs-string">"select avg(r.record_rate) from daily_record r where r.currency = currency"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BigDecimal avgRate; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชู ุงุณุชุฎุฏุงู ูุฐุง ุงูููุงู ูู ุงูุงุณุชุนูุงู (DBMS ุ ููุง ูุชุฐูุฑ ุ ูุฏููุง Oracle): </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select nvl(record.fxRate, record.avgRate) "</span></span> + <span class="hljs-string"><span class="hljs-string">" from DailyRecord record "</span></span> + <span class="hljs-string"><span class="hljs-string">"where record.currency = :currency"</span></span>) <span class="hljs-function"><span class="hljs-function">BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findRateByCurrency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Param(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"currency"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String currency)</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ุทูุจ ุนูู ุตุงูุญ.  ูููู ููุงู ูุดููุฉ ูุงุญุฏุฉ ุตุบูุฑุฉ ุ ูุงูุชู ุฑุจูุง ูุดูุฑ ุฅูููุง ุฎุจุฑุงุก SQL.  ุงูุญูููุฉ ูู ุฃู <code>nvl</code> ูู ุฃูุฑุงูู ููุณ ูุณูู.  ุจูุนูู ุขุฎุฑ ุ ุนูุฏ ุงุณุชุฏุนุงุก ุงูุฃุณููุจ <code>findRateByCurrency</code> ุ ุณูุชู <code>findRateByCurrency</code> ุณุฌู <code>findRateByCurrency</code> </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> nvl( dr.fixed_rate, <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(r.record_rate) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record r <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> r.currency = dr.currency ) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record dr <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> dr.currency = ?</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุชู ุฅุฐุง ูุงูุช ูููุฉ <code>dr.fixed_rate</code> ููุฌูุฏุฉ ุ ูุฅู ูุธุงู ุฅุฏุงุฑุฉ ููุงุนุฏ ุงูุจูุงูุงุช (DBMS) ูุง ูุฒุงู ูุญุณุจ ุงููููุฉ ุงูุชู ูุชู ุฅุฑุฌุงุนูุง ุจูุงุณุทุฉ ุงูุชุนุจูุฑ ุงูุซุงูู ูู <code>nvl</code> ุ ููู ูู ุญุงูุชูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(r.record_rate) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record r <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> r.currency = dr.currency)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฑุจูุง ูุนุฑู ุงููุงุฑุฆ ุจุงููุนู ููู ูุฑุงูุบ ุงูุซูู ุบูุฑ ุงูุถุฑูุฑู ููุทูุจ: ุจุงูุทุจุน ุ ูุฐู ูู ุงููููุฉ ุงูุฑุฆูุณูุฉ <code>nvl</code> ุ ูุงูุชู ุชูุงุฑู ุจุดูู ุฅูุฌุงุจู ูุน <code>nvl</code> ุ ููุฐูู ุงููุฏุฑุฉ ุนูู ูุจูู ุฃูุซุฑ ูู ุชุนุจูุฑูู.  ุฏุนูุง ูุตุญุญ ุทูุจูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select coalesce(record.fxRate, record.avgRate) "</span></span> + <span class="hljs-string"><span class="hljs-string">" from DailyRecord record "</span></span> + <span class="hljs-string"><span class="hljs-string">"where record.currency = :currency"</span></span>) <span class="hljs-function"><span class="hljs-function">BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findRateByCurrency</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Param(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"currency"</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> String currency)</span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ุ ููุง ูููููู ุ ูุฌุฃุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> nvl(dr.fixed_rate, <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(r.record_rate) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record r <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> r.currency = dr.currency) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record dr <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> dr.currency = ?</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจูู ุงูุทูุจ ููุง ูู.  ุฐูู ูุฃู ููุฌุฉ ุฃูุฑุงูู ูู ุงูุตูุฏูู ุชุชุญูู ุฅูู ุณูุณูุฉ <code>nvl</code> . </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุนููู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑุบุจ ูู ุฅุนุงุฏุฉ ุฅูุชุงุฌ ูุฐุง ุงูุณููู ุ ูุงุญุฐู ุงูุณุทุฑ ุงูุซุงูู ูู ูููุดุฆ ูุฆุฉ <a href="">CustomOracleDialect</a> ููู ุจุชุดุบูู <code>DailyRecordRepositoryTest::findRateByCurrency</code> </p></div></div><br><p style=";text-align:right;direction:rtl">  ูุชูุงุฏู ูุฐุง ุ ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ููุฌุฉ ุฎุงุตุฉ ุจู ูุงุณุชุฎุฏุงููุง ูู ุงูุชุทุจูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomOracleDialect</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Oracle12cDialect</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomOracleDialect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); registerFunction(<span class="hljs-string"><span class="hljs-string">"coalesce"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardSQLFunction(<span class="hljs-string"><span class="hljs-string">"coalesce"</span></span>)); } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุนู ุ ูุฐุง ุจุณูุท.  ุงูุขู ูุฑุจุท ุงูููุฌุฉ ุงูุชู ุชู ุฅูุดุงุคูุง ุจุงูุชุทุจูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">spring: jpa: database-platform: com.luxoft.logeek.config.CustomOracleDialect</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุทุฑููุฉ ุฃุฎุฑู (ููููุฉ):</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">spring: jpa: properties: hibernate.dialect: com.luxoft.logeek.config.CustomOracleDialect</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุงูุชูููุฐ ุงููุชูุฑุฑ ููุทูุจ ูุนุทู koalesk: </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">coalesce</span></span>(dr.fixed_rate, <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">avg</span></span>(r.record_rate) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record r <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> r.currency = dr.currency) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> daily_record dr <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> dr.currency = ?</code> </pre> <br><h4 id="orakl-i-postranichnye-zaprosy" style=";text-align:right;direction:rtl">  ุฃูุฑุงูู ูุทูุจุงุช ุงูุตูุญุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุนุงู ุ ูููุฑ ุฅููุงู ููุฌุฉ ูุฑุตูุง ุซุฑูุฉ ููุนุงูุฌุฉ ุงูุงุณุชุนูุงูุงุช.  ุบุงูุจูุง ูุง ูุชู ุชุทููุฑ ูููุฉ ุชุฑุญูู ุตูุญุงุช ุงูุจูุงูุงุช ุนูุฏ ุชุทููุฑ ุชุทุจูู ููุฌู ููุจ.  ุจูุนูู ุขุฎุฑ ุ ูุฏููุง ุนุฏุฉ ูุฆุงุช ุงูุขูุงู ูู ุงูุณุฌูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุ ููู ูุชู ุนุฑุถูุง ูู ุญุฒู ูู 10/50/100 ุณุฌู ูู ูู ุตูุญุฉ.  ูููุฑ ุชุงุฑูุฎ ุงูููุงุฐ ููุฎุงุฑุฌ ูููุทููุฑ ูุธุงุฆู ููุงุซูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Query</span></span>(<span class="hljs-string"><span class="hljs-string">"select new com.luxoft.logeek.data.BriefChildData("</span></span> + <span class="hljs-string"><span class="hljs-string">"c.id, "</span></span> + <span class="hljs-string"><span class="hljs-string">"c.age "</span></span> + <span class="hljs-string"><span class="hljs-string">") from Child c "</span></span> + <span class="hljs-string"><span class="hljs-string">" join c.parent p "</span></span> + <span class="hljs-string"><span class="hljs-string">"where p.name = ''"</span></span>) <span class="hljs-function"><span class="hljs-function">Page&lt;BriefChildData&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">browse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Pageable pageable)</span></span></span></span>;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุชูู ูุฐุง ุงูููุฌ ุนูู ุนูุจ ูุจูุฑ ุ ููู ุชูููุฐ ุงุณุชุนูุงููู ุ ุฃููููุง ูุญุตู ุนูู ุงูุจูุงูุงุช ุ ูุงูุซุงูู ูุญุฏุฏ ุฅุฌูุงูู ุนุฏุฏูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูุฐุง ุถุฑูุฑู ูุนุฑุถ ุฅุฌูุงูู ูููุฉ ุงูุจูุงูุงุช ูู ูุงุฆู <code>Page</code> ).  ูู ุญุงูุชูุง ุ ูุนุทู ุงุณุชุฏุนุงุก ููุฐู ุงูุทุฑููุฉ ุงูุทูุจุงุช ุงูุชุงููุฉ (ุงูุชุณุฌูู ุจุงุณุชุฎุฏุงู p6spy): </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> c.id, c.age <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">child</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> c.parent_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.name = <span class="hljs-string"><span class="hljs-string">''</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(c.id) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">child</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-keyword"><span class="hljs-keyword">join</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> c.parent_id = p.id <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.name = <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ุงูุงุณุชุนูุงู ุซููููุง (ูุชู ุฑุจุท ุงูุนุฏูุฏ ูู ุงูุฌุฏุงูู ุจุนููุฏ ุบูุฑ ูุงุจู ููููุฑุณุฉ ุ ููุท ุนุฏุฏ ูุจูุฑ ูู ุงูุตูุงุช ุ ุดุฑุท ุงูุชุญุฏูุฏ ุงูุตุนุจ ุ ููุง ุฅูู ุฐูู) ุ ูููู ุฃู ูุตุจุญ ูุฐุง ูุดููุฉ.  ูููู ูุธุฑูุง ูุฃู ูุฏููุง Oracle ุ ูุฅูู ุจุงุณุชุฎุฏุงู ุงูุนููุฏ ุงูุฒุงุฆู rownum ููููู ุงูุญุตูู ุนูู ุทูุจ ูุงุญุฏ. </p><br><p style=";text-align:right;direction:rtl">  ููููุงู ุจุฐูู ุ ูุญุชุงุฌ ุฅูู ุฅููุงุก ููุฌุชูุง ุ ููุตู ุงููุธููุฉ ุงููุณุชุฎุฏูุฉ ูุญุณุงุจ ุฌููุน ุงูุณุฌูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomOracleDialect</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Oracle12cDialect</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CustomOracleDialect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); registerFunction(<span class="hljs-string"><span class="hljs-string">"coalesce"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardSQLFunction(<span class="hljs-string"><span class="hljs-string">"coalesce"</span></span>)); registerFunction(<span class="hljs-string"><span class="hljs-string">"total_count"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TotalCountFunc()); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TotalCountFunc</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SQLFunction</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasArguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasParenthesesIfNoArguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Type </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getReturnType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Type type, Mapping mapping)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StandardBasicTypes.LONG; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Type type, List arguments, SessionFactoryImplementor factory)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arguments.size() != <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalArgumentException(<span class="hljs-string"><span class="hljs-string">"Only 1 argument acceptable"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">" count("</span></span> + arguments.get(<span class="hljs-number"><span class="hljs-number">0</span></span>) + <span class="hljs-string"><span class="hljs-string">") over () "</span></span>; } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุจ ุงูุขู ุงุณุชุนูุงููุง ุฌุฏูุฏูุง (ูู ูุฆุฉ <code>ChildRepositoryImpl</code> ): </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Page&lt;BriefChildData&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">browseWithTotalCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Pageable pageable)</span></span></span><span class="hljs-function"> </span></span>{ String query = <span class="hljs-string"><span class="hljs-string">"select "</span></span> + <span class="hljs-string"><span class="hljs-string">" c.id as id,"</span></span> + <span class="hljs-string"><span class="hljs-string">" c.age as age, "</span></span> + <span class="hljs-string"><span class="hljs-string">" total_count(c.id) as totalCount"</span></span> + <span class="hljs-string"><span class="hljs-string">" from Child c "</span></span> + <span class="hljs-string"><span class="hljs-string">"join c.parent p "</span></span> + <span class="hljs-string"><span class="hljs-string">"where p.name = ''"</span></span>; List&lt;BriefChildData&gt; list = em.unwrap(Session.class) .createQuery(query) .setFirstResult((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) pageable.getOffset()) .setMaxResults(pageable.getPageSize()) .setResultTransformer(Transformers.aliasToBean(BriefChildData.class)) .getResultList(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (list.isEmpty()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PageImpl(Collections.emptyList()); } <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> totalCount = list.get(<span class="hljs-number"><span class="hljs-number">0</span></span>).getTotalCount(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PageImpl&lt;&gt;(list, pageable, totalCount); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงุณุชุฏุนุงุก ูุฐุง ุงูุฑูุฒ ุ ุณูุชู ุชูููุฐ ุทูุจ ูุงุญุฏ </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> c.id, c.age, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(c.id) <span class="hljs-keyword"><span class="hljs-keyword">over</span></span> () <span class="hljs-comment"><span class="hljs-comment">-- &lt;----- from child c inner join parent p on c.parent_id = p.id where p.name = '') where rownum &lt;= 3</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู <code>count(c.id) over ()</code> ุงูุชุนุจูุฑ <code>count(c.id) over ()</code> ููููู ุงูุญุตูู ุนูู ุฅุฌูุงูู ูููุฉ ุงูุจูุงูุงุช ูุงูุญุตูู ุนูููุง ูู ูุฆุฉ ุงูุจูุงูุงุช <code>PageImpl</code> ูููุดุฆ <code>PageImpl</code> .  ููุงู ุทุฑููุฉ ููููุงู ุจุฐูู ุจุดูู ุฃูุซุฑ ุฃูุงูุฉ ุ ุฏูู ุฅุถุงูุฉ ุญูู ุขุฎุฑ ุฅูู ูุฆุฉ ุงูุจูุงูุงุช ุ ููุฑ ูู ุฃูู ูุงุฌุจ ููุฒูู :) ููููู ุงุฎุชุจุงุฑ ุงูุญู ุจุงุณุชุฎุฏุงู ุงุฎุชุจุงุฑ <a href="">ProjectionVsDataTest</a> . </p><br><h4 id="podvodnye-kamni-kastomizacii" style=";text-align:right;direction:rtl">  ูุทุจุงุช ุงูุชุฎุตูุต </h4><br><p style=";text-align:right;direction:rtl">  ูุฏููุง ูุดุฑูุน ุฑุงุฆุน ูุน Oracle ู Spring Date.  ูููุชูุง ูู ุชุญุณูู ุฃุฏุงุก ูุฐุง ุงูุฑูุฒ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">List&lt;Long&gt; ids = getIds(); ids.stream() .map(repository::findById) .filter(Optional::isPresent) .map(Optional::get) .forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::sendToSchool);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุงูุนูุจ ุนูู ุงูุณุทุญ: ุนุฏุฏ ุงุณุชุนูุงูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช ูุณุงูู ุนุฏุฏ ุงูููุงุชูุญ ุงููุฑูุฏุฉ.  ููุงู ุทุฑููุฉ ูุนุฑููุฉ ููุชุบูุจ ุนูู ูุฐู ุงูุตุนูุจุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">List&lt;Long&gt; ids = getIds(); repository .findAllById(ids) .forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::sendToSchool);</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฒุฉ ุฃุฎุฐ ุงูุนููุงุช ุงููุชุนุฏุฏุฉ ูุงุถุญุฉ: ุฅุฐุง ูุงู ูุฏููุง ูู ููุช ุณุงุจู ุงูุนุฏูุฏ ูู ุงูุงุณุชูุณุงุฑุงุช ุงูููุงุซูุฉ ูู ุงููููุฐุฌ </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Pupil p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.id = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Pupil p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.id = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Pupil p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.id = <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ุงูุงู ุงููุงุฑูุง ููุงุญุฏ </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Pupil p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, ... )</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจุฏู ุฃูู ุฃุตุจุญ ุฃุณูู ูุฃุตุจุญ ุฌูุฏูุง.  ูููู ุงููุดุฑูุน ููุชุทูุฑ ููุถุงุนู ุงูุจูุงูุงุช ููุฃุชู ููุช ูุง ููุฑ ููู: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุขูู ุงูุฑุนุฏ ูู ุงูููู ุงูุฃุฒุฑู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">ERROR - ORA-01795: maximum number of expressions in a list is 1000</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุญู ุจุญุงุฌุฉ ุฅูู ุงูุจุญุซ ุนู ูุฎุฑุฌ ูุฑุฉ ุฃุฎุฑู (ูููุณ ุงูุนูุฏุฉ ุฅูู ุงูุฅุตุฏุงุฑ ุงููุฏูู).  ูุธุฑูุง ูุฃู Oracle ูุง ูุณูุญ ูู ุจุชุบุฐูุฉ ุฃูุซุฑ ูู 1000 ููุชุงุญ ุ ูููููู ุชูุณูู ูุฌููุนุฉ ุงูุจูุงูุงุช ุจุฃููููุง ุฅูู ูุดุงุฑูุงุช ูุชุณุงููุฉ ูุง ุชุฒูุฏ ุนู 1000 ูุชูููุฐ ุนุฏุฏ ูู ุงูุงุณุชุนูุงูุงุช: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs">List&lt;List&lt;Long&gt;&gt; idChunks = cgccLists.partition(ids, <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//* idChunks.forEach(idChunk -&gt; repository.findAllById(idChunk).forEach(this::sendToSchool) ); //* cgccLists = com.google.common.collect.Lists</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุนูู ูุฐู ุงูุทุฑููุฉ ุ ููููุง ุชูุจุนุซ ูููุง ุฑุงุฆุญุฉ ุทูููุฉ (ูู ูู ูุฐููุ): ุฅุฐุง ูุงุฌูุช ูุซู ูุฐู ุงูุตุนูุจุงุช ูู ุฃูุงูู ุฃุฎุฑู ุ ูุนููู ุฃู ุชููู ุจุณูุงุฌ ุงูุญุฏููุฉ ููุณูุง.  ุฏุนููุง ูุญุงูู ุญู ุงููุดููุฉ ุจุดูู ุฃูุซุฑ ุฃูุงูุฉ ุ ุฃู ูู ุฎูุงู <code>BaseJpaRepositoryImpl</code> .  ุฃุณูู ุทุฑููุฉ ููููุงู ุจุฐูู ูู ููู ุงูููุทู ุฃุนูุงู ุฅูู ุงูุฏุงุฎู ุ ูุฅุฎูุงุฆู ุนู ุงููุณุชุฎุฏู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAllById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;ID&gt; ids)</span></span></span><span class="hljs-function"> </span></span>{ Assert.notNull(ids, <span class="hljs-string"><span class="hljs-string">"The given Iterable of Id's must not be null!"</span></span>); Set&lt;ID&gt; idsCopy = Sets.newHashSet(ids); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idsCopy.size() &lt;= OracleConstants.MAX_IN_COUNT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.findAllById(ids); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> findAll(idsCopy); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Collection&lt;ID&gt; ids)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;List&lt;ID&gt;&gt; idChunks = Lists.partition(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(ids), <span class="hljs-number"><span class="hljs-number">1000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> idChunks .stream() .map(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::findAllById) .flatMap(List::stream) .collect(Collectors.toList()); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุตุจุญ ุงูุฃูุฑ ุฃูุถู: ุฃููุงู ุ ูููุง ุจุชูุธูู ุฑูุฒ ุงูุนูู ูู ุทุจูุงุช ุงูุจููุฉ ุงูุชุญุชูุฉ ุ ูุซุงููุงู ุ ูุณุนูุง ูุทุงู ุญููุง ููุดูู ุฌููุน ูุณุชูุฏุนุงุช ุงููุดุฑูุน ุงูุชู ุชูุชุฏ <code>BaseJpaRepository</code> ูุณุชูุฏุนุงุช <code>BaseJpaRepository</code> .  ููุงู ุฃูุถุง ุนููุจ.  ุงูุนูุตุฑ ุงูุฑุฆูุณู ูู ุนุฏุฉ ุทูุจุงุช ุจุฏูุงู ูู ุทูุจ ูุงุญุฏ ุ ููุฐูู (ููุจุน ูู ุงูุทูุจ ุงูุฑุฆูุณู) - ุงูุญุงุฌุฉ ุฅูู ุชุตููุฉ ุงูููุงุชูุญ ุ ูุฃูู ุฅุฐุง ูู ูุชู ุฐูู ุ ููุฏ ูุธูุฑ ููุณ ุงูููุชุงุญ ูู <code>idChunks</code> ูุฎุชููุฉ.  ูุฐุง ุ ุจุฏูุฑู ุ ูุนูู ุฃูู ุณูุชู ุฅุฏุฑุงุฌ ููุณ ุงูููุงู ูู ุงููุงุฆูุฉ ูุฑุชูู ุ ูุจุงูุชุงูู ุ ุณุชุชู ูุนุงูุฌุชู ูุฑุชูู.  ูุง ูุญุชุงุฌ ุฅูู ุฐูู ุ ูุฐูู ููุฌุฏ ุญู ุขุฎุฑ ุฃูุซุฑ ุชุทูุฑุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAllById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Iterable&lt;ID&gt; ids)</span></span></span><span class="hljs-function"> </span></span>{ Assert.notNull(ids, <span class="hljs-string"><span class="hljs-string">"The given Iterable of Id's must not be null!"</span></span>); ArrayList&lt;ID&gt; idsCopy = Lists.newArrayList(ids); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idsCopy.size() &lt;= OracleConstants.MAX_IN_COUNT) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.findAllById(ids); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> findAll(idsCopy); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ArrayList&lt;ID&gt; ids)</span></span></span><span class="hljs-function"> </span></span>{ CriteriaBuilder cb = entityManager.getCriteriaBuilder(); CriteriaQuery&lt;T&gt; query = cb.createQuery(getDomainClass()); Root&lt;T&gt; from = query.from(getDomainClass()); Predicate predicate = toPredicate(cb, ids, from); query = query.select(from).where(predicate); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> entityManager.createQuery(query).getResultList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Predicate </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toPredicate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CriteriaBuilder cb, ArrayList&lt;ID&gt; ids, Root&lt;T&gt; root)</span></span></span><span class="hljs-function"> </span></span>{ List&lt;List&lt;ID&gt;&gt; chunks = Lists.partition(ids, OracleConstants.MAX_IN_COUNT); SingularAttribute&lt;? <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> T, ?&gt; id = entityInfo.getIdAttribute(); Predicate[] predicates = chunks.stream() .map(chunk -&gt; root.get(id).in(chunk)) .toArray(Predicate[]::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cb.or(predicates); }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู API Criteria ุ ููุง ูุฌุนู ูู ุงููููู ุจูุงุก ุงุณุชุนูุงู ููุงุฆู ูุงุญุฏ ูู ุงููููุฐุฌ </p><br><pre style=";text-align:right;direction:rtl"> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> p.* <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Pupil p <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> p.id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, ... , <span class="hljs-number"><span class="hljs-number">1000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p.id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">1001</span></span>, ... , <span class="hljs-number"><span class="hljs-number">2000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p.id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-number"><span class="hljs-number">2001</span></span>, ... , <span class="hljs-number"><span class="hljs-number">3000</span></span>)</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุงู ุฏูุฉ: ูููู ุชูููุฐ ุทูุจ ููุงุซู ููุชุฑุฉ ุฃุทูู ูู ุงููุนุชุงุฏ ุจุณุจุจ ุงูุธุฑูู ุงููุฑููุฉ ุ ูุฐูู ูุฏ ุชููู ุงูุทุฑููุฉ ุงูุฃููู (ูู ุจุนุถ ุงูุฃุญูุงู) ูู ุงูุฃูุถู. </p><br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุดูุก ุ ุขูู ุฃู ุชููู ุงูุฃูุซูุฉ ูููุฏุฉ ูู ููููุฏุฉ ูู ุงูุชูููุฉ ุงูููููุฉ.  ุงูุชุนูููุงุช ูุงูุฅุถุงูุงุช ูู ููุถุน ุชุฑุญูุจ. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar444240/">https://habr.com/ru/post/ar444240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar444226/index.html">Pythonetc ุชุฌููุน ูุจุฑุงูุฑ 2019</a></li>
<li><a href="../ar444228/index.html">ูุตุงุฆุญ ูุญูู ูู my Telegram-channelpythonetc ุ ูุจุฑุงูุฑ 2019</a></li>
<li><a href="../ar444230/index.html">ุฏููุฉ ุงูุฅูุชุฑูุช: ุงูุตูู ุนู ุจุนุฏ ูุตุฉ VPN</a></li>
<li><a href="../ar444234/index.html">DeepMind ู Google: ูุนุฑูุฉ ุงูุณูุทุฑุฉ ุนูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ุงูููู</a></li>
<li><a href="../ar444238/index.html">ุฑูุถ ูู ููุฑุฉ ูุงุญุฏุฉ ุ ุฃู ููู ูุตูู ููุญุตูู ุนูู ูุธููุฉ ุงูุญูู</a></li>
<li><a href="../ar444242/index.html">ุงูุชุญูู ูู FreeRDP ูุน ูุญูู PVS-Studio</a></li>
<li><a href="../ar444244/index.html">ุชุชุญุฑู ูู ุฎูุงู ุงูููุงู ูุงูุฒูุงู</a></li>
<li><a href="../ar444246/index.html">ุงูุชุญูู ูู FreeRDP ูุน PVS-Studio</a></li>
<li><a href="../ar444248/index.html">ุงุฎุชุจุงุฑ ููุทูุนุฉ ุงูุฑุฃุณ ูู ุงููุชุตูุญ. ุฅูุฌุงุจูุงุช ูุณูุจูุงุช</a></li>
<li><a href="../ar444250/index.html">ูู ุงููุงุณ ุบูุฑ ูุณุชุนุฏูู ููุจูุชูููู ุฃู ุงูุจูุชูููู ููุชุจูู ุงูุฌูุงุนูุ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>