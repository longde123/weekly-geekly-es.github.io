<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äç‚öñÔ∏è ü§ûüèæ üôéüèø Interrupciones externas en el sistema x86. Parte 1. Evoluci√≥n del controlador de interrupci√≥n üë®üèº‚Äç‚öïÔ∏è üë©üèø‚Äçüè´ üßëüèæ‚Äçü§ù‚Äçüßëüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este art√≠culo trata sobre el proceso de entrega de interrupciones desde dispositivos externos en el sistema x86. Intenta responder preguntas como: 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interrupciones externas en el sistema x86. Parte 1. Evoluci√≥n del controlador de interrupci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/446312/">  Este art√≠culo trata sobre el proceso de entrega de interrupciones desde dispositivos externos en el sistema x86.  Intenta responder preguntas como: <br><br><ul><li>  ¬øQu√© es pic y para qu√© sirve? </li><li>  ¬øQu√© es APIC y para qu√© sirve?  ¬øCu√°l es el prop√≥sito de LAPIC y I / O APIC? </li><li>  ¬øCu√°les son las diferencias entre APIC, xAPIC y x2APIC? </li><li>  ¬øQu√© es el MSI?  ¬øCu√°les son las diferencias entre MSI y MSI-X? </li><li>  ¬øCu√°l es el papel de las tablas $ PIR, MPtable y ACPI? </li></ul><br>  Si desea conocer la respuesta a una de estas preguntas, o si simplemente desea saber sobre la evoluci√≥n del controlador de interrupci√≥n, por favor, bienvenido. <br><a name="habracut"></a><br><h3>  Introduccion </h3><br>  Para aquellos que no saben qu√© es una interrupci√≥n, aqu√≠ hay una cita de Wikipedia: <br><blockquote>  En la programaci√≥n del sistema, una interrupci√≥n es una se√±al al procesador emitida por hardware o software que indica un evento que requiere atenci√≥n inmediata.  Una interrupci√≥n alerta al procesador sobre una condici√≥n de alta prioridad que requiere la interrupci√≥n del c√≥digo actual que el procesador est√° ejecutando.  El procesador responde suspendiendo sus actividades actuales, guardando su estado y ejecutando una funci√≥n llamada controlador de interrupci√≥n (o una rutina de servicio de interrupci√≥n, ISR) para tratar el evento.  Esta interrupci√≥n es temporal y, una vez que finaliza el controlador de interrupciones, el procesador reanuda las actividades normales. <br><br>  Hay dos tipos de interrupciones: interrupciones de hardware e interrupciones de software (softirqs): <br><br><ul><li> Los dispositivos utilizan las interrupciones de hardware para comunicar que requieren atenci√≥n del sistema operativo.  Internamente, las interrupciones de hardware se implementan utilizando se√±ales de alerta electr√≥nicas que se env√≠an al procesador desde un dispositivo externo, que es parte de la computadora, como un controlador de disco o un perif√©rico externo.  Por ejemplo, al presionar una tecla en el teclado o al mover el mouse se activan interrupciones de hardware que hacen que el procesador lea la pulsaci√≥n de tecla o la posici√≥n del mouse.  El acto de iniciar una interrupci√≥n de hardware se denomina solicitud de interrupci√≥n (IRQ). </li><li>  Una interrupci√≥n de software es causada por una condici√≥n excepcional en el procesador o por una instrucci√≥n especial en el conjunto de instrucciones que causa una interrupci√≥n cuando se ejecuta.  El primero a menudo se llama trampa o excepci√≥n y se usa para errores o eventos que ocurren durante la ejecuci√≥n del programa que son lo suficientemente excepcionales como para que no puedan manejarse dentro del programa mismo.  Por ejemplo, se generar√° una excepci√≥n de divisi√≥n por cero si se ordena a la unidad l√≥gica aritm√©tica del procesador que divida un n√∫mero por cero, ya que esta instrucci√≥n es un error e imposible. </li></ul></blockquote><br>  Este art√≠culo trata sobre hardware / interrupciones externas IRQ. <br><br>  ¬øCu√°l es el prop√≥sito de las interrupciones?  Por ejemplo, queremos realizar una acci√≥n con un paquete entrante de la tarjeta de red tan pronto como llegue el paquete.  Si no desea preguntar continuamente a la tarjeta de red "¬øHa llegado mi paquete?"  y perder el tiempo de su procesador, puede utilizar IRQ de interrupci√≥n de hardware externo.  La l√≠nea de interrupci√≥n de un dispositivo debe conectarse a la l√≠nea INTR de la CPU, y despu√©s de recibir cada paquete, la tarjeta de red emitir√° una se√±al a trav√©s de esta l√≠nea.  La CPU detectar√° esta se√±al y sabr√° que la tarjeta de red tiene informaci√≥n para ella.  Solo despu√©s de eso, la CPU leer√° el paquete entrante. <br><br>  Pero, ¬øqu√© debemos hacer si hay muchos dispositivos externos?  Ser√≠a muy improductivo hacer un mont√≥n de pines INTR en la CPU para todos ellos. <br><br><img src="https://habrastorage.org/webt/vg/3q/3v/vg3q3v7kx8vjttp43xo99o8pccs.png"><br><br>  Para resolver este problema, se invent√≥ un chip especial: un controlador de interrupci√≥n. <br><br><h3>  Pic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">osdev</a> ) <br><br>  El primer chip controlador de interrupci√≥n fue el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PIC Intel 8259</a> .  Ten√≠a 8 l√≠neas de entrada (IRQ0-7) y 1 l√≠nea de salida (que conecta el controlador de interrupci√≥n con la l√≠nea INTR de la CPU).  Cuando hay una interrupci√≥n de uno de los dispositivos en sus l√≠neas de entrada, el 8259 emitir√° una se√±al sobre la l√≠nea INTR.  Despu√©s de eso, la CPU sabr√° que alg√∫n dispositivo requiere su atenci√≥n inmediata, y el procesador le preguntar√° al PIC cu√°l de las 8 l√≠neas de entrada (IRQx) fue la fuente de esta interrupci√≥n.  Hay algo de sobrecarga en este sondeo, pero ahora tenemos 8 l√≠neas de interrupci√≥n en lugar de 1. <br><br><img src="https://habrastorage.org/webt/le/yf/6e/leyf6enogyzp6flpijo2d0x1w9g.png"><br><br>  Pronto 8 l√≠neas no fueron suficientes.  Para aumentar el n√∫mero total de l√≠neas de interrupci√≥n, se conectaron dos controladores 8259 (maestro y esclavo) en cascada (Dual PIC). <br><br>  Las IRQ de 0 a 7 se procesan con el primer Intel 8259 PIC (maestro), y las IRQ de 8 a 15 se procesan con el segundo Intel 8259 PIC (maestro).  Solo el maestro est√° conectado a la CPU y puede se√±alar las interrupciones entrantes.  Si hay una interrupci√≥n en las l√≠neas 8-15, el segundo PIC (esclavo) se lo indicar√° al maestro en la l√≠nea IRQ2, y despu√©s de eso, el maestro se√±alar√° a la CPU.  Esta interrupci√≥n en cascada elimina 1 de las 16 l√≠neas, pero hace un total de 15 interrupciones para todos los dispositivos externos. <br><br><img src="https://habrastorage.org/webt/xj/yn/dh/xjyndhabujjwz0alrbx831zfzt8.png"><br><br>  Este esquema fue adoptado por la comunidad, y ahora cuando alguien habla de PIC (Controlador de interrupci√≥n de programa) se refieren a este sistema Dual PIC.  Despu√©s de alg√∫n tiempo, los controladores 8259 se mejoraron y obtuvieron un nuevo nombre: 8259A.  Con estos controladores, el sistema DUAL PIC se incluy√≥ en el conjunto de chips.  En un momento en que el bus principal para la conexi√≥n del dispositivo externo era el ISA, este sistema era suficiente.  Solo era necesario que diferentes dispositivos no se conectaran a la misma l√≠nea IRQ, ya que las interrupciones ISA no son compartibles. <br><br>  El mapeo de interrupci√≥n del dispositivo era bastante est√°ndar: <br><br>  Ejemplo (desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> ): <br>  IRQ 0 - temporizador del sistema <br>  IRQ 1 - controlador de teclado <br>  IRQ 2 - cascada (interrupci√≥n del controlador esclavo) <br>  IRQ 3 - puerto serie COM2 <br>  IRQ 4 - puerto serie COM1 <br>  IRQ 5 - puerto paralelo 2 y 3 o tarjeta de sonido <br>  IRQ 6 - controlador de disquete <br>  IRQ 7 - puerto paralelo 1 <br>  IRQ 8 - Temporizador RTC <br>  IRQ 9 - ACPI <br>  IRQ 10 - abierto / SCSI / NIC <br>  IRQ 11 - abierto / SCSI / NIC <br>  IRQ 12 - controlador de mouse <br>  IRQ 13 - coprocesador matem√°tico <br>  IRQ 14 - ATA canal 1 <br>  IRQ 15 - ATA canal 2 <br><br>  La configuraci√≥n y el trabajo con chips 8259 se realiza con puertos de E / S: <br><div class="scrollable-table"><table><tbody><tr><th>  Chip </th><th>  Registrarse </th><th>  Puerto de E / S </th></tr><tr><td>  Foto maestra </td><td>  Comando </td><td>  0x0020 </td></tr><tr><td>  Foto maestra </td><td>  Datos </td><td>  0x0021 </td></tr><tr><td>  Foto esclavo </td><td>  Comando </td><td>  0x00A0 </td></tr><tr><td>  Foto esclavo </td><td>  Datos </td><td>  0x00A1 </td></tr></tbody></table></div><br>  La documentaci√≥n completa del 8259A se puede encontrar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br>  El bus PCI luego reemplaz√≥ al bus ISA.  Desafortunadamente, el n√∫mero de dispositivos comenz√≥ a exceder el n√∫mero 15. Adem√°s, en lugar del bus ISA est√°tico, los dispositivos en el bus PCI se pueden agregar al sistema din√°micamente, lo que podr√≠a generar a√∫n m√°s problemas.  Pero afortunadamente, las interrupciones en el bus PCI se pueden compartir, por lo que es posible conectar muchos dispositivos a una l√≠nea de interrupci√≥n IRQ.  Al final, para resolver el problema de la falta de l√≠neas de interrupci√≥n, se decidi√≥ agrupar las interrupciones de todos los dispositivos PCI a las l√≠neas PIRQ (solicitud de interrupci√≥n programable). <br><br>  Por ejemplo, supongamos que tenemos 4 l√≠neas de interrupci√≥n libres en el controlador PIC y 20 dispositivos PCI.  Podemos combinar interrupciones de 5 dispositivos en una l√≠nea PIRQx y conectar estas l√≠neas PIRQx al controlador PIC.  En este caso, si hay una interrupci√≥n en una de las l√≠neas PIRQx, el procesador tendr√° que preguntar a todos los dispositivos conectados a esta l√≠nea sobre la interrupci√≥n para saber qui√©n es el responsable, pero al final resuelve el problema.  El dispositivo que conecta las l√≠neas de interrupci√≥n PCI a las l√≠neas PIRQ a menudo se denomina enrutador PIR. <br><br>  Con este m√©todo es necesario asegurarse de que las l√≠neas PIRQx no se conectan a l√≠neas con interrupciones ISA (ya que esto producir√° conflictos) y que las l√≠neas PIRQx est√°n equilibradas (cuantos m√°s dispositivos conectemos a una l√≠nea, m√°s dispositivos necesitar√° la CPU para sondear cuando necesita verificar qu√© dispositivo es responsable de la interrupci√≥n). <br><br><img src="https://habrastorage.org/webt/u_/jr/u9/u_jru9pemdeda2xvvbqihvgtp3y.png"><br><br>  <b>Nota</b> : en la imagen, el mapeo del dispositivo PCI -&gt; PIR se ilustra de forma abstracta, ya que en el caso real es un poco m√°s complicado.  En el mundo real, cada dispositivo PCI tiene 4 l√≠neas de interrupci√≥n (INTA, INTB, INTC, INTD) y hasta 8 funciones, donde cada funci√≥n puede tener solo una de estas interrupciones INTx.  La configuraci√≥n del conjunto de chips determina qu√© l√≠nea INTx ser√° utilizada por cada funci√≥n. <br><br>  Por su naturaleza, las funciones son bloques l√≥gicos separados.  Por ejemplo, un dispositivo PCI puede tener una funci√≥n de controlador Smbus, una funci√≥n de controlador SATA y una funci√≥n de puente LPC.  Desde el punto de vista de un sistema operativo (SO), cada funci√≥n es como un dispositivo separado con su propio espacio de configuraci√≥n (configuraci√≥n PCI). <br><br>  La informaci√≥n sobre el enrutamiento de interrupci√≥n del controlador PIC es enviada al SO por el BIOS, con la ayuda de la tabla $ PIR y a trav√©s de los registros 3Ch (INT_LN Interrupt Line (R / W)) y 3Dh (INT_PN Interrupt Pin (RO)) de El espacio de configuraci√≥n PCI para cada funci√≥n. <br><br>  Recientemente se encontr√≥ una especificaci√≥n para la tabla $ PIR <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en el sitio web de Microsoft</a> , pero actualmente no est√° disponible.  Es posible comprender el contenido de la tabla a partir de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">especificaci√≥n PCI BIOS</a> [4.2.2.  Obtener opciones de enrutamiento de interrupci√≥n PCI] o desde <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> (el √∫ltimo enlace est√° en ruso, pero puede intentar buscar en Google "Especificaci√≥n de tabla de enrutamiento PCI IRQ") <br><br><h3>  Apic </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">osdev</a> ) <br><br>  El √∫ltimo m√©todo funcion√≥ hasta que llegaron los sistemas multiprocesador.  Por naturaleza, el PIC solo puede enviar interrupciones a una CPU, y en un sistema multiprocesador se desea cargar las CPU de forma equilibrada.  La soluci√≥n a este problema fue la nueva interfaz APIC (Advanced PIC). <br><br>  Se agreg√≥ un controlador especial llamado LAPIC (APIC local) para cada procesador, as√≠ como el controlador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">APIC de E / S</a> para enrutar interrupciones desde dispositivos externos.  Todos estos controladores se combinan en un bus com√∫n con el nombre APIC (tenga en cuenta que los sistemas modernos usan un bus de sistema est√°ndar en lugar de un bus APIC separado para esta tarea). <br><br>  Cuando llega una interrupci√≥n externa a la entrada I / O APIC, el controlador enviar√° un mensaje de interrupci√≥n al LAPIC de una de las CPU del sistema.  De esta forma, el controlador I / O APIC ayuda a equilibrar la carga de interrupci√≥n entre procesadores. <br><br>  El primer chip APIC fue el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">82489DX</a> , que era un chip separado que ten√≠a un LAPIC conectado y un APIC de E / S dentro de s√≠ mismo.  Para un sistema de procesador dual se necesitaban tres chips de este tipo: dos para LAPIC y uno para I / O APIC.  La funcionalidad LAPIC posterior se incluy√≥ directamente en los procesadores, y la parte I / O APIC se separ√≥ al chip 82093AA. <br><br>  El I / O APIC <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">82093AA</a> ten√≠a 24 entradas, y la arquitectura APIC pod√≠a soportar hasta 16 CPU.  Las interrupciones 0-15 se dejaron para las antiguas interrupciones ISA por compatibilidad con sistemas m√°s antiguos, y las interrupciones 16-23 estaban destinadas a todos los dispositivos PCI.  Con esta delimitaci√≥n, todos los conflictos entre las interrupciones ISA y PCI podr√≠an evitarse f√°cilmente.  Con el mayor n√∫mero de l√≠neas de interrupci√≥n libre, tambi√©n fue posible aumentar el n√∫mero de l√≠neas PIRQx. <br><br><img src="https://habrastorage.org/webt/mc/ra/hj/mcrahjn-owk9qrcmyiixcmhomcq.png"><br><br>  La programaci√≥n I / O APIC y LAPIC se realiza con la ayuda de MMIO.  Los registros LAPIC generalmente se colocan en la direcci√≥n 0xFEE00000 y los registros APIC de E / S en la direcci√≥n 0xFE0000, aunque es posible volver a configurarlos. <br><br>  Como en el caso de PIC, chips separados al principio se convirtieron en parte del conjunto de chips m√°s tarde. <br><br>  La arquitectura APIC se moderniz√≥ m√°s tarde, y su nueva variante se denomin√≥ xAPIC (x - extendida).  Con total compatibilidad con versiones anteriores, el n√∫mero total de CPU posibles en el sistema se increment√≥ a 256. <br><br>  El siguiente paso en el desarrollo de la arquitectura se denomin√≥ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">x2APIC</a> .  El n√∫mero de CPU posibles en el sistema se increment√≥ a 2 ^ 32.  Estos controladores pueden funcionar en un modo de compatibilidad con versiones anteriores con xAPIC, o pueden funcionar en el nuevo modo x2APIC.  En este nuevo modo, la programaci√≥n del controlador no se realiza a trav√©s de MMIO, sino a trav√©s de registros MSR (que son mucho m√°s r√°pidos).  Seg√∫n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este enlace</a> , el soporte de IOMMU es necesario para este modo. <br><br>  Vale la pena se√±alar que es posible tener varios controladores APIC de E / S en el sistema.  Por ejemplo, una para 24 interrupciones en un puente sur y la otra para 32 interrupciones en un puente norte.  En el contexto de E / S APIC, las interrupciones generalmente se denominan GSI (Interrupci√≥n del sistema global).  Entonces, el sistema mencionado tiene GSI 0-55. <br><br>  ¬øC√≥mo podemos determinar si una CPU tiene un LAPIC interno y qu√© arquitectura APIC admite?  Es posible responder a estas preguntas inspeccionando las banderas de bits de CPUID. <br>  Para ayudar al sistema operativo a descubrir LAPIC y I / O APIC, el BIOS debe presentar informaci√≥n sobre ellos a trav√©s de una tabla MPtable (m√©todo antiguo) o una tabla ACPI (una tabla MADT en este caso).  Adem√°s de la informaci√≥n com√∫n, tanto la MPtable como la ACPI (en este caso, una tabla DSDT) deben contener informaci√≥n sobre el enrutamiento de interrupci√≥n.  Esto significa informaci√≥n sobre qu√© dispositivo usa qu√© l√≠nea de interrupci√≥n (similar a la tabla $ PIR). <br><br>  Puede leer sobre MPtable en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://web.archive.org/web/20121002210153/">especificaci√≥n</a> oficial.  Anteriormente, la especificaci√≥n estaba en el sitio web de Intel, pero actualmente solo es posible encontrarla en una versi√≥n de archivo.  La especificaci√≥n ACPI se puede encontrar en el sitio web de UEFI (la versi√≥n actual es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">6.2</a> ).  Vale la pena notar que con ACPI es posible declarar el enrutamiento de interrupci√≥n para sistemas sin APIC (en lugar de proporcionar una tabla $ PIR separada). <br><br><h3>  Msi </h3><br>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">wiki</a> ) <br><br>  La √∫ltima variante de APIC fue buena, pero no sin inconvenientes.  Todas las l√≠neas de interrupci√≥n de los dispositivos complicaron mucho el sistema y, por lo tanto, aumentaron la probabilidad de error.  El bus PCI express vino a reemplazar al bus PCI, lo que simplific√≥ completamente todos los sistemas de interrupci√≥n.  No tiene l√≠neas de interrupci√≥n en absoluto.  Para la compatibilidad con versiones anteriores, las se√±ales de interrupci√≥n (INTx #) se emulan con un tipo separado de mensajes.  Con las l√≠neas de interrupci√≥n PCI, su conexi√≥n se realiz√≥ con cables f√≠sicos.  Con las l√≠neas de interrupci√≥n PCI express, una conexi√≥n es l√≥gica y se realiza mediante puentes PCI express.  Pero este soporte de interrupciones INTx heredadas solo existe para la compatibilidad con el bus PCI.  PCI express presenta un m√©todo completamente nuevo de entrega de interrupciones: MSI (interrupciones se√±alizadas por mensaje).  En este m√©todo, un dispositivo se√±ala la interrupci√≥n simplemente escribiendo en un lugar especial en la regi√≥n MMIO de las CPU LAPIC. <br><br><img src="https://habrastorage.org/webt/8z/qw/7h/8zqw7him-vupzm_wi5glkqtr1ja.png"><br><br>  Anteriormente, un solo dispositivo PCI (esto significa todas sus funciones) pod√≠a tener solo 4 interrupciones, pero ahora era posible abordar hasta 32 interrupciones. <br><br>  En el caso de MSI, no se comparten l√≠neas de interrupci√≥n: cada interrupci√≥n corresponde naturalmente a su dispositivo. <br><br>  Las interrupciones de MSI tambi√©n resuelven un problema m√°s.  Por ejemplo, imaginemos una situaci√≥n en la que un dispositivo realiza una transacci√≥n de escritura de memoria y quiere indicar que se ha completado a trav√©s de la interrupci√≥n.  Pero una transacci√≥n de escritura puede retrasarse en el bus en el proceso de su transmisi√≥n (y el dispositivo no pod√≠a saberlo).  En este caso, la se√±al sobre la interrupci√≥n llegar√° primero a la CPU, por lo que el procesador leer√° datos a√∫n no v√°lidos.  Si se usa MSI, la informaci√≥n sobre MSI se transmite de la misma manera que los mensajes de datos, por lo que no puede llegar antes. <br><br>  Vale la pena notar que las interrupciones de MSI no pueden funcionar sin LAPIC, pero MSI puede reemplazar I / O APIC (una simplificaci√≥n de dise√±o m√°s). <br><br>  Despu√©s de alg√∫n tiempo, el m√©todo MSI se extendi√≥ a MSI-X.  Ahora cada dispositivo puede tener hasta 2048 interrupciones.  Ahora tambi√©n es posible especificar qu√© CPU debe procesar qu√© interrupci√≥n.  Puede ser muy √∫til para dispositivos de alta carga, como las tarjetas de red, por ejemplo. <br><br>  No hay necesidad de una tabla de BIOS separada para el soporte de MSI.  Pero el dispositivo debe indicar su soporte MSI a trav√©s de una de las capacidades en su espacio de configuraci√≥n PCI.  Adem√°s, un controlador de dispositivo debe incluir todo el soporte necesario para trabajar con el MSI. <br><br><h3>  Conclusi√≥n </h3><br>  En este art√≠culo, hemos estudiado informaci√≥n sobre la evoluci√≥n del controlador de interrupciones y tenemos un conocimiento te√≥rico com√∫n sobre la entrega de interrupciones desde dispositivos externos en el sistema x86. <br><br>  En la siguiente parte, iremos a practicar y veremos c√≥mo involucrar a cada uno de los controladores de interrupci√≥n mencionados en Linux. <br><br>  En la tercera parte, analizaremos el c√≥digo de arranque de n√∫cleo y veremos qu√© configuraciones se necesitan en el conjunto de chips para un enrutamiento de interrupci√≥n correcto. <br><br><h4>  Enlaces: </h4><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Controladores de interrupci√≥n (cosas en el medio)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬øQu√© hacen las diferentes interrupciones en PCIe?</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Reducci√≥n de la latencia de interrupci√≥n mediante el uso de interrupciones se√±alizadas por mensaje</a> </li></ul><br><h4>  Segmentos reconocidos </h4><br>  Un agradecimiento especial a Jacob Garber de la comunidad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">coreboot</a> por ayudarme con la traducci√≥n de este art√≠culo. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/446312/">https://habr.com/ru/post/446312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446300/index.html">C√≥mo coordinar el vuelo de la sonda hacia la estratosfera (lo que encontraremos en la pr√°ctica en el lanzamiento)</a></li>
<li><a href="../446302/index.html">9 citas de Habraseminar 2019 para bloggers, emprendedores y RRHH</a></li>
<li><a href="../446304/index.html">Funciones f√≠sicas no razonables: protecci√≥n de la electr√≥nica contra copia ilegal</a></li>
<li><a href="../446306/index.html">¬øGuerras nucleares del pasado lejano?</a></li>
<li><a href="../446308/index.html">¬øEl reclutamiento de referencias est√° vivo en TI?</a></li>
<li><a href="../446316/index.html">¬°Solo espacio! Una enorme pieza de titanio en 6.5 d√≠as.</a></li>
<li><a href="../446320/index.html">C√≥mo el esc√°ner 3D permiti√≥ abandonar el conjunto de control a gran escala del puente</a></li>
<li><a href="../446322/index.html">Criptograf√≠a en Java. Keytool Utility</a></li>
<li><a href="../446324/index.html">Navegaci√≥n en DataGrip con Yandex.Navigator</a></li>
<li><a href="../446326/index.html">Resolviendo problemas de tr√°fico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>