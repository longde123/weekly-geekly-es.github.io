<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõ∑ ü§±üèº üë®‚Äç‚ù§Ô∏è‚Äçüë® A la pregunta de TI üë©üèª‚Äçüé§ ‚¨úÔ∏è üñïüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""Ahora te mostrar√© un retrato ... Hmm ... Te advierto que este es un retrato ... De todos modos, tr√°talo como un retrato ... 

 En esta publicaci√≥n, h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A la pregunta de TI</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451918/">  <b>"Ahora te mostrar√© un retrato ... Hmm ... Te advierto que este es un retrato ... De todos modos, tr√°talo como un retrato ...</b> <br><br>  En esta publicaci√≥n, hablaremos sobre el desarrollo y la depuraci√≥n de programas para el CC1350 MK en el entorno de desarrollo CCS recomendado por el fabricante.  Los m√©ritos (y lo son) y las desventajas (y c√≥mo sin ellos) de los productos anteriores se ver√°n afectados.  No habr√° capturas de pantalla en el texto para mostrar (en un c√≠rculo) la ubicaci√≥n del icono de compilaci√≥n en el entorno de programaci√≥n integrado o seleccionar un archivo en un directorio.  Reconociendo la posibilidad fundamental de art√≠culos en un estilo similar, tratar√© de enfocarme en temas conceptuales con la esperanza de que mi lector pueda descubrir los detalles. <br><br>  El prop√≥sito de este opus, adem√°s de compartir la experiencia adquirida, es un intento de despertar una sana envidia entre los fabricantes nacionales de MK, que son competidores directos de TI ("en el pa√≠s donde prosperamos"); la tarea es francamente desagradecida, pero dicen que una piedra se desgasta una gota. <br><a name="habracut"></a><br>  Voy a enfatizar de inmediato que solo se tratar√° de la versi√≥n 7 de Windows 7 (adem√°s, solo), aunque el sitio web de TI tiene una opci√≥n para Mac y Linux, no los he probado, estoy bastante listo para creer que no todo est√° tan bien all√≠, pero ¬øpor qu√© pensar? sobre lo malo (o viceversa, todo es genial all√≠, pero entonces, ¬øpor qu√© la envidia?). <br><br>  Entonces, ¬øqu√© nos ense√±a el sitio web de TI? Para comenzar a trabajar con m√≥dulos de evaluaci√≥n, debe realizar tres pasos necesarios: <br><br><ol><li>  Comprar m√≥dulos de evaluaci√≥n - hecho. <br><br>  Nota sobre los m√°rgenes (PNP): tambi√©n tendr√° que hacer esto, porque en el entorno de programaci√≥n en cuesti√≥n, personalmente (desafortunadamente) no logr√© encontrar la capacidad de emular hardware para la depuraci√≥n, al menos donde estaba buscando. </li><li>  Instale el entorno de desarrollo: descargue, ejecute el instalador, todo funcion√≥.  Conectamos el m√≥dulo de evaluaci√≥n a USB: la le√±a se eleva sola y todo volvi√≥ a funcionar, listo.  Cuando intentas programar el dispositivo, recibimos un mensaje sobre la necesidad de actualizar el firmware, estamos de acuerdo y nuevamente todo result√≥.  En general, no hay nada de qu√© escribir si fue siempre y en todas partes ... </li><li>  Vaya y estudie el curso TI SimpleLink Academy 3.10.01 para SimpleLink CC13x0 SDK 3.10: una sugerencia extra√±a, parece que me ense√±a, solo para estropear, pero que as√≠ sea, abro el enlace correspondiente y estoy at√≥nito: cu√°ntas cosas hay aqu√≠. </li></ol><br>  Aqu√≠ vemos materiales de capacitaci√≥n sobre c√≥mo trabajar con controladores de hardware SYS / BIOS y con el sistema operativo TI-RTOS y el uso de la pila de red NDK, incluido USB, y el uso de protocolos inal√°mbricos y muchos m√°s aspectos del trabajo con representantes de varias familias MK producidas por la compa√±√≠a.  Y toda esta riqueza viene acompa√±ada de ejemplos listos para usar, y si tenemos en cuenta la presencia de manuales de usuario y descripciones de m√≥dulos, entonces quiz√°s no hay nada m√°s que desear.  Pero tambi√©n hay utilidades que facilitan el trabajo de preparaci√≥n y configuraci√≥n del c√≥digo del programa, flasheo y depuraci√≥n de varias maneras, y esta riqueza tambi√©n est√° bastante documentada. <br><br>  Pnp: si alguien se inclina a considerar este material como publicidad en relaci√≥n con la empresa, sus productos y su sistema de programaci√≥n, lo m√°s probable es que sea correcto y estoy realmente impresionado con el volumen de software detectado.  Su calidad se discutir√° m√°s a fondo y, espero, las sospechas de parcialidad se disipar√°n, el sentimiento no me ceg√≥ por completo y sigo viendo perfectamente los defectos del objeto de descripci√≥n, por lo que este no es el amor de la juventud, sino un sentimiento serio de un especialista adulto.  Tengo miedo de imaginar la cantidad de costos de material necesarios para crear y mantener un volumen de software y documentaci√≥n para ello, pero esto obviamente no se hizo en un mes, y la compa√±√≠a probablemente comprende lo que est√° haciendo. <br><br>  Bien, hasta que pospongamos el estudio de los materiales para m√°s adelante, comprenderemos todo "en el camino con la pepita" y audazmente abriremos CCS.  Implementa el concepto de espacios de trabajo, recibido del padre - Eclipse.  Personalmente, el concepto del proyecto est√° m√°s cerca de m√≠, pero nadie nos molesta para mantener exactamente un proyecto en el espacio, as√≠ que sigamos adelante. <br><br>  Pero luego las cosas empeoran un poco: abrimos el espacio de trabajo (RP) para nuestra placa de depuraci√≥n y vemos muchos proyectos (por regla general, en dos versiones, para RTOS y para "iron√≠a").  Como dije antes, esto no es un delito, pero el hecho de que muchos proyectos contengan los mismos archivos con m√≥dulos de software id√©nticos no es nada bueno.  El c√≥digo se duplica muchas veces y respaldar los cambios se convierte en una tarea muy trivial.  S√≠, con tal soluci√≥n es mucho m√°s f√°cil transferir el proyecto simplemente copiando el directorio, pero para tales cosas hay exportaci√≥n del proyecto, y est√° bastante bien implementado.  Los enlaces a los archivos en el √°rbol del proyecto son adecuadamente compatibles, por lo que la decisi√≥n de incluir los archivos en los ejemplos proporcionados no puede considerarse satisfactoria. <br><br>  Continuamos nuestra investigaci√≥n: comenzaremos a trabajar con un proyecto terminado, pero sin parpadear un LED, aunque hay dos de ellos en la placa de depuraci√≥n, pero trabajando con un puerto serie, un ejemplo de uartecho listo para usar.  Creamos un nuevo RP, incluimos el proyecto que nos interesa y ... nada sale de √©l, queda claro por el mensaje que es necesario incluir un proyecto relacionado en el RP.  No est√° muy claro por qu√© se hace esto, pero no es dif√≠cil cumplir con los requisitos del medio ambiente, despu√©s de lo cual el proyecto comienza a ensamblarse. <br><br>  Pnp: en la m√°quina dom√©stica, utilic√© el comando Importar proyecto y todas las inclusiones necesarias ocurrieron por su cuenta.  Cuando se indiquen exactamente proyectos relacionados, no lo s√©, dejemos el an√°lisis de este aspecto para el futuro. <br><br>  Compilamos, flasheamos y comenzamos a depurar.  Encontramos un fen√≥meno interesante: la ejecuci√≥n paso a paso no se muestra adecuadamente al considerar la biblioteca de trabajar con un puerto serie: los costos de optimizaci√≥n.  Desactivamos la optimizaci√≥n en la configuraci√≥n del compilador (configuraci√≥n que no existe, hay realmente gente que las conoce y, adem√°s, las usa todas), armamos el proyecto nuevamente, y nada cambia.  Resulta que solo se incluyen aquellos archivos que est√°n incluidos en el √°rbol del proyecto, al menos en forma de enlaces.  Agregamos enlaces a las fuentes de la biblioteca y despu√©s de reconstruir todo se depura correctamente (siempre que tengamos la opci√≥n de generar informaci√≥n de depuraci√≥n habilitada). <br><br>  Pnp: pero encontr√© opciones para habilitar la verificaci√≥n de cumplimiento MISRA-C. <br><br>  Pnp: otra forma es usar el comando "Limpiar ..." con el ensamblaje posterior, el comando "Construir todo" por alguna raz√≥n no afecta el proyecto asociado. <br><br>  Luego descubrimos que no todo se depura siempre normalmente, a veces nos encontramos en √°reas de c√≥digo de m√°quina para las cuales el compilador no encuentra la fuente.  Dado que el entorno de programaci√≥n nos proporciona todos los archivos necesarios para el trabajo: el resultado del preprocesador, el c√≥digo del ensamblador y la tarjeta de enlace (solo debe recordar habilitar las opciones correspondientes), pasamos a este √∫ltimo.  Encontramos dos √°reas del c√≥digo del programa: a partir de 0x0000.  y a partir de 0x1000.  (Las arquitecturas de 32 bits son buenas para todos, pero la escritura de direcciones no es su punto fuerte).  Pasamos a la documentaci√≥n del microcircuito y descubrimos que dentro hay un √°rea ROM asignada espec√≠ficamente a 0x1000., Y contiene la parte integrada de las bibliotecas.  Se argumenta que el uso de rutinas mejora el rendimiento y reduce el consumo en comparaci√≥n con el espacio de direcciones 0x000.  Si bien estamos dominando MK, no estamos tan interesados ‚Äã‚Äãen los √∫ltimos par√°metros, pero la conveniencia de la depuraci√≥n es crucial.  Puede deshabilitar el uso de ROM (pero para nuestros prop√≥sitos) configurando la opci√≥n NO_ROM en el compilador, lo que hacemos y reensamblamos el proyecto. <br><br>  PNP: la transici√≥n a la subrutina en la ROM se ve muy divertida: no hay una transici√≥n larga en el sistema de comando, por lo que primero se realiza la transici√≥n con un retorno al punto intermedio en el √°rea de direcci√≥n baja (0x0000), y all√≠ yace el comando de arranque de la PC, cuyos par√°metros no son reconocidos por el desensamblador.  Algo que no puedo creer, como si con esos costos generales se pudiera ganar en velocidad, aunque para rutinas largas, ¬øpor qu√© no? <br><br>  Por cierto, una pregunta interesante es c√≥mo generalmente se garantiza que el contenido de la ROM corresponde a los c√≥digos fuente amablemente proporcionados por la empresa.  Puedo sugerir de inmediato un mecanismo para incorporar funciones adicionales (por supuesto, depuraci√≥n y servicio) en la ROM, que para el usuario, el programador MK ser√° completamente invisible.  Y personalmente, no tengo dudas de que los desarrolladores del chip tambi√©n conocen muchos otros mecanismos que implementan dicha funcionalidad, pero terminaremos el ataque de paranoia. <br><br>  Por otro lado, solo puedo dar la bienvenida a la aparici√≥n de un an√°logo de este tipo de BIOS, porque a la larga esto har√° realidad el sue√±o de los desarrolladores de la portabilidad real del c√≥digo entre diferentes familias MK con un n√∫cleo.  Tambi√©n observamos la peculiaridad de la implementaci√≥n de la interacci√≥n con los m√≥dulos de software "integrados".  Si en los primeros intentos de crear un mecanismo similar implementado en los modelos TivaC, hubo un supervisor de llamadas al que se accedi√≥ con el n√∫mero de grupo y el n√∫mero del punto de entrada en el subprograma, lo que caus√≥ una sobrecarga significativa, aqu√≠ la resoluci√≥n de las comunicaciones est√° en el nivel de enlace debido a los nombres dobles de funciones y Se insertan saltos largos directos a subrutinas en ROM.  Esto es mucho m√°s r√°pido en la ejecuci√≥n, pero requiere una recompilaci√≥n del proyecto al cambiar el modelo de uso. <br><br>  Ahora que estamos completamente preparados para la depuraci√≥n conveniente, volvemos a nuestro proyecto y comenzamos a depurar el programa en silencio con acceso a los c√≥digos fuente de los m√≥dulos (bueno, eso es lo que pens√© ...), lo que nos permitir√° formar una opini√≥n sobre la calidad de estos textos.  El proyecto en estudio implementa un espejo del canal de comunicaci√≥n en serie y es extremadamente conveniente para fines de capacitaci√≥n.  Por supuesto, tomamos la opci√≥n usando RTOS, no veo la menor raz√≥n para no usarlo en nuestra configuraci√≥n (mucha memoria y memoria de programa). <br><br>  Inmediatamente, notamos que los c√≥digos fuente se presentan en C, a menudo no es muy conveniente, muchas construcciones de lenguaje parecen engorrosas en comparaci√≥n con sus an√°logos en las ventajas, pero los creadores estaban m√°s preocupados por la compatibilidad del c√≥digo que el az√∫car sint√°ctico.  Aunque ser√≠a posible crear una versi√≥n C ++ de las bibliotecas, la compilaci√≥n condicional se conoce desde hace mucho tiempo y se usa en todas partes, pero esto conlleva costos adicionales de material.  Seguramente, la gerencia de la compa√±√≠a sabe lo que est√°n haciendo, y mis comentarios son una especie de "an√°lisis astuto", pero me parece que tambi√©n tengo derecho a mi opini√≥n. <br><br>  Tambi√©n conozco el enfoque opuesto, cuando la biblioteca est√° dise√±ada con las √∫ltimas herramientas de C ++, y cuando se le pregunta qu√© hacer para aquellos desarrolladores que usan compiladores que no cumplen con las √∫ltimas especificaciones, la respuesta perfecta es actualizar a nuevas versiones o no esta biblioteca (recomiendo la segunda opci√≥n en tales casos).  Mi opini√≥n personal es que si realmente queremos que se use nuestro producto (y TI claramente lo quiere, y no crea la biblioteca con el principio de "d√©jelo, aqu√≠ hay un nuevo tambor para usted"), entonces su enfoque es ciertamente cierto. <br><br>  El c√≥digo fuente del programa tiene un aspecto cl√°sico: inicializa el entorno de hardware y software, crea tareas y lanza un programador en el m√≥dulo principal, el texto de la tarea en un m√≥dulo de compilaci√≥n separado.  En el ejemplo en consideraci√≥n, la tarea es exactamente una: mainThread, el prop√≥sito no est√° completamente claro del nombre y, lo que me confunde un poco, el nombre del archivo que contiene el texto fuente no coincide con el nombre de la funci√≥n (uartecho.c, aunque el nombre est√° hablando aqu√≠), bueno, s√≠ La b√∫squeda en el entorno de programaci√≥n se implementa de forma est√°ndar (men√∫ contextual o F3 en el nombre de la entidad) y no hay ning√∫n problema con esto. <br><br>  El proceso de establecer los par√°metros de la tarea antes de comenzar es bastante esperado: <br><br><ol><li>  crear una estructura de par√°metros (local, por supuesto), </li><li>  darle valores por defecto, </li><li>  establecer par√°metros distintos al est√°ndar, y </li><li>  use la estructura al crear la tarea. </li></ol><br>  A pesar del tipo de naturalidad de estas operaciones, no es obvio para todos los autores de bibliotecas, y vi varias implementaciones en las cuales, por ejemplo, no hubo etapa 2, lo que condujo a un comportamiento de programa divertido (para un observador externo, no para un programador).  En este caso, todo est√° bien, la √∫nica pregunta que ha surgido es por qu√© los valores predeterminados no son constantes, probablemente este es un legado del pasado maldito. <br><br>  PNP: en el conocido FREE-RTOS se adopta un enfoque ligeramente diferente con los par√°metros de la tarea indicados directamente en el cuerpo de la llamada de la API de la funci√≥n de creaci√≥n de tareas.  Los pros y los contras de estos enfoques son los siguientes: <br><br><ol><li>  + le permite no especificar expl√≠citamente par√°metros que coincidan con los valores predeterminados, + no requiere recordar el orden de los par√°metros, -m√°s detallado, -Costos de memoria m√°s grandes, -Usted necesita conocer los par√°metros predeterminados, -crea un objeto intermedio con nombre </li><li>  - requiere especificar todos los par√°metros, -requiere recordar el orden de los par√°metros, + es m√°s compacto, + requiere menos memoria, + no requiere objetos intermedios con nombre. <br><br>  Hay un tercer m√©todo, defendido por el autor de esta publicaci√≥n (al estilo de TURBO), que tiene su propio conjunto </li><li>  + le permite no especificar expl√≠citamente los par√°metros que coinciden con el est√°ndar, + no requiere recordar el orden de los par√°metros, -multi-verbal, -costas de memoria m√°s grandes, -Necesita conocer los par√°metros predeterminados, + funciona en el estilo lambda, + hace que los errores est√°ndar sean dif√≠ciles de implementar, -se ve algo extra√±o debido a los muchos corchetes correctos. </li></ol><br>  Bueno, hay otra cuarta opci√≥n, sin inconvenientes, pero que requiere C ++ no inferior a 14: nos lamemos los labios y pasamos de largo. <br><br>  Comenzamos a depurar, ejecutamos el programa y abrimos uno de los dos puertos seriales provistos por la placa de depuraci√≥n en la ventana de terminal proporcionada por el entorno de programaci√≥n.  ¬øCu√°l de los dos puertos (uno es la depuraci√≥n, probablemente el segundo es el usuario, puede ver sus n√∫meros en el sistema) es dif√≠cil de decir por adelantado, a veces el m√°s joven, a veces el mayor, al menos no cambia cuando vuelve a conectar el tablero, por lo que puede escribirlo en el tablero.  Bueno, un inconveniente m√°s: los terminales abiertos no se guardan con el proyecto y no se restauran cuando abre una sesi√≥n de depuraci√≥n, aunque no se cierran cuando sale de √©l.  Verificamos el funcionamiento del programa e inmediatamente descubrimos un inconveniente m√°s: el terminal no se puede configurar, por ejemplo, b√°sicamente funciona en estilo Unix con un cierre / r, he perdido el contacto con tal minimalismo, aunque nadie nos molesta con el uso de un programa de terminal externo. <br><br>  Pnp: Observamos una caracter√≠stica m√°s de la depuraci√≥n, bueno, esto es cierto para cualquier entorno de desarrollo: cuando cambiamos las tareas con un programador, perdemos el foco, los puntos de interrupci√≥n nos ayudar√°n a resolver este problema. <br><br>  Para comenzar, considere el proceso de crear una instancia de un puerto serie: todo parece ser est√°ndar aqu√≠, se utiliza una estructura, cuyos campos tienen asignados los par√°metros requeridos del objeto.  Tenga en cuenta que en las ventajas tenemos la oportunidad, completamente ausente de C, de ocultar toda la inicializaci√≥n muy bien "bajo el cap√≥", pero ya he expresado posibles argumentos a favor de la segunda soluci√≥n.  Hay una funci√≥n para inicializar la estructura de ajuste, y esto es bueno (por parad√≥jico que parezca, esta funci√≥n no parece obligatoria para los autores de algunas bibliotecas).  En este punto de la historia, la luna de miel termina y comienza la vida ordinaria <strike>(conyugal)</strike> . <br><br>  Un estudio cuidadoso de las fuentes muestra que no todo es tan bueno.  ¬øCu√°l es el problema? La funci√≥n de inicializaci√≥n copia los valores predeterminados del objeto que se encuentra en la regi√≥n constante en nuestra estructura de control, y esto es maravilloso, pero por alguna raz√≥n: <br><br><ol><li>  el objeto es global, aunque es usado por la √∫nica funci√≥n para inicializar los par√°metros (en un momento una pr√°ctica similar le cost√≥ a Toyota una cantidad decente) - bueno, agregar la directiva est√°tica es f√°cil; </li><li>  el objeto de control se llama, en C no hay una soluci√≥n hermosa para este problema, o m√°s bien, hay una soluci√≥n con una copia an√≥nima y la di en una publicaci√≥n de mucho tiempo, pero muchos corchetes correctos no permiten llamar a esta opci√≥n realmente hermosa, adem√°s hay una soluci√≥n de belleza incre√≠ble, pero ¬øqu√©? so√±ar con un sue√±o imposible; </li><li>  todos los campos del objeto son claramente redundantes en profundidad de bits, incluso los campos de bits (enumeraciones de dos valores posibles) se almacenan en palabras de 32 bits; </li><li>  las constantes de modo enumerado se definen en forma de define, lo que hace que sea imposible verificar en la etapa de compilaci√≥n y necesario en tiempo de ejecuci√≥n; </li><li>  repitiendo una secci√≥n de un bucle infinito en diferentes lugares de posibles fallas, ser√≠a mucho m√°s correcto hacer un controlador (en este caso vac√≠o); </li><li>  Bueno, todas las operaciones para configurar e iniciar una tarea pueden (y deber√≠an) estar ocultas en una funci√≥n o incluso en una macro. </li></ol><br>  Pero la inicializaci√≥n del b√∫fer de recepci√≥n est√° bien hecha: utilizamos memoria reservada previamente, no se manipula el mont√≥n, la cadena de llamadas es algo complicada, pero todo es legible. <br><br>  Pnp: en la ventana de depuraci√≥n, ante nuestros ojos, la pila de llamadas, todo se hace como debe y de manera s√≥lida: respeto y respeto.  Lo √∫nico sorprendente es que un intento de ocultar esta ventana conduce al final de la sesi√≥n de depuraci√≥n. <br><br>  Bueno, y una decisi√≥n m√°s inesperada: establecer el n√∫mero posible de objetos en la enumeraci√≥n, para puertos serie y para esta placa de depuraci√≥n igual a 1, en el estilo <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CC1310_LAUNCHXL_UARTName { CC1310_LAUNCHXL_UART0 = <span class="hljs-number"><span class="hljs-number">0</span></span>, CC1310_LAUNCHXL_UARTCOUNT } CC1310_LAUNCHXL_UARTName;</code> </pre> <br>  Dichas soluciones son est√°ndar para transferencias reales, pero para la descripci√≥n de objetos de hardware, y no sab√≠a que esto es posible, aunque funciona para m√≠.  Hemos terminado la inicializaci√≥n del hierro, sigamos adelante. <br><br>  En una tarea en ejecuci√≥n, observamos un cl√°sico bucle infinito en el que la funci√≥n lee los datos de un puerto serie <pre> <code class="cpp hljs">UART_read(uart, &amp;input, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre>  e inmediatamente enviado de vuelta por funci√≥n <pre> <code class="cpp hljs">UART_write(uart, &amp;input, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre>  .  Vayamos al primero y veamos un intento de leer caracteres del b√∫fer de recepci√≥n <pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (handle-&gt;fxnTablePtr-&gt;readPollingFxn(handle, buffer, size))</code> </pre>  (¬øC√≥mo odio esas cosas, pero en C es imposible de lo contrario?), profundizamos y nos encontramos en UARTCC26XX_read, y de ah√≠ nos adentramos en la implementaci√≥n del anillo de b√∫fer, una funci√≥n <pre> <code class="cpp hljs">RingBuf_get(&amp;object-&gt;ringBuffer, &amp;readIn)</code> </pre>  .  Aqu√≠, la vida ordinaria entra en una fase aguda. <br><br>  No me gustaba decir que no me gustaba este m√≥dulo en particular (el archivo ringbuf.c), estaba escrito de manera terrible y personalmente, habr√≠a avergonzado el lugar de una compa√±√≠a tan respetada de autores de esta parte con verg√ºenza (todav√≠a me puede llevar en su lugar, pero me temo que el nivel salarial de nuestros colegas indios no me conviene), pero probablemente no s√© qu√©.  Cuida tus manos: <br><br>  1) el re-roll de punteros de lectura / escritura se implementa a trav√©s del resto de la divisi√≥n <br><br><pre> <code class="cpp hljs">object-&gt;tail = (object-&gt;tail + <span class="hljs-number"><span class="hljs-number">1</span></span>) % object-&gt;length;</code> </pre> <br>  y no hay optimizaciones del compilador cuando se realiza esta operaci√≥n, como la superposici√≥n de una m√°scara de bits, ya que la longitud del b√∫fer no es una constante.  S√≠, en este MK hay una operaci√≥n de divisi√≥n de hardware y es bastante r√°pida (escrib√≠ sobre eso), pero a√∫n as√≠ nunca toma 2 ciclos de reloj, como en la implementaci√≥n correcta con re-roll honesto (y escrib√≠ sobre esto tambi√©n), <br><br>  Pnp: Recientemente vi una descripci√≥n de la nueva arquitectura M7 en la implementaci√≥n y no recuerdo a nadie, as√≠ que por alguna raz√≥n, dividir 32 por 32 comenz√≥ a realizarse en 2-12 ciclos en lugar de 2-7.  O se trata de un error de traducci√≥n o ... Ni siquiera s√© en qu√© pensar. <br><br>  2) adem√°s, este fragmento de c√≥digo se repite en m√°s de un lugar: macros e inline para wimps, ctrl + C y ctrl + V, el principio DRY pasa por el bosque, <br><br>  3) se implement√≥ un contador completamente redundante de lugares de almacenamiento intermedio llenos, lo que conllev√≥ el siguiente inconveniente, <br><br>  4) secciones cr√≠ticas tanto en lectura como en escritura.  Bueno, todav√≠a puedo creer que los autores de este m√≥dulo no leen mis publicaciones sobre Habr√© (aunque este comportamiento es inaceptable para los profesionales en el campo del firmware), pero deber√≠an estar familiarizados con el Mustang Book, all√≠ se examina este tema en detalle, <br><br>  5) como una cereza en el pastel, se ha introducido un indicador del tama√±o m√°ximo del b√∫fer, adem√°s, con un nombre muy difuso y una descripci√≥n completamente ausente (este √∫ltimo se aplica generalmente a todo el m√≥dulo).  No excluyo que esta opci√≥n pueda ser √∫til para la depuraci√≥n, pero ¬øpor qu√© arrastrarla a la versi√≥n? ¬øTenemos alg√∫n ciclo de procesador con la RAM? <br><br>  6) al mismo tiempo, el procesamiento de desbordamiento del b√∫fer est√° completamente ausente (hay una se√±alizaci√≥n de retorno de -1 sobre esta situaci√≥n); incluso en Arduino lo es, dejaremos de lado la calidad de este procesamiento, pero su ausencia es a√∫n peor.  ¬øO los autores se inspiraron en el hecho conocido de que cualquier suposici√≥n es cierta con respecto a un conjunto relativamente vac√≠o, incluido el hecho de que no est√° vac√≠o? <br><br>  En general, mis comentarios son totalmente consistentes con la primera l√≠nea del desmotivador sobre el tema de revisi√≥n de c√≥digo "10 l√≠neas de c√≥digo - 10 comentarios". <br><br>  Por cierto, la pen√∫ltima de las deficiencias se√±aladas nos hace pensar en cosas m√°s globales, pero ¬øc√≥mo implementamos la clase base para poder llevar a cabo su profunda modificaci√≥n?  Hacer que todos los campos sean seguros es una idea dudosa (aunque probablemente sea la √∫nica correcta), insertar una llamada de funciones amigables en los herederos es muy parecido a las muletas.  Si en este caso en particular hay una respuesta simple a la pregunta de introducir un indicador de plenitud del b√∫fer: una clase generada con escritura y lectura superpuestas y un contador adicional, entonces implementar la lectura sin avanzar el b√∫fer (como en este caso) o reemplazar el √∫ltimo car√°cter colocado (vi tal implementaci√≥n de b√∫fer en anillo) no puede prescindir del acceso a los datos internos de la clase primaria. <br><br>  Al mismo tiempo, no hay quejas sobre la implementaci√≥n de la lectura real desde la interfaz en serie: la entrada est√° bloqueando, en ausencia de una cantidad suficiente de caracteres en el b√∫fer de recepci√≥n, se amarta un sem√°foro y se transfiere el control al programador: todo se implementa de manera precisa y correcta.  Personalmente, no me gusta controlar el equipo en un procedimiento de prop√≥sito general, pero esto reduce la anidaci√≥n de los procedimientos y el √≠ndice de complejidad ciclom√°tica, sin importar lo que signifique. <br><br>  Ahora prestemos atenci√≥n a la transmisi√≥n de los datos recibidos al canal serie, ya que al crear el objeto se le proporcion√≥ solo un b√∫fer de anillo: el receptor.  De hecho, el b√∫fer interno del hardware se utiliza para transmitir caracteres, y cuando se llena, se ingresa la espera de disponibilidad (al menos en el modo de operaci√≥n de bloqueo).  No puedo evitarlo, para no criticar el estilo de las funciones correspondientes: 1) por alguna raz√≥n, el objeto tiene un puntero generalizado, que dentro de la funci√≥n se convierte constantemente en un puntero a los caracteres <pre> <code class="cpp hljs">*(<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)object-&gt;writeBuf);</code> </pre>  2) la l√≥gica del trabajo es completamente opaca y ligeramente confusa.  Pero todo esto no es tan importante, ya que permanece oculto para el usuario y "no afecta la velocidad m√°xima". <br><br>  En el proceso de investigaci√≥n, nos encontramos con una caracter√≠stica m√°s: no vemos el c√≥digo fuente de algunas funciones internas en modo de depuraci√≥n, esto se debe a un cambio de nombres para diferentes opciones de compilaci√≥n (ROM / NO_ROM).  Reemplace el archivo fuente requerido (C: \ Jenkins \ jobs \ FWGroup-DriverLib \ workspace \ modules \ output \ cc13xx_cha_2_0_ext \ driverlib \ bin \ ccs /./../../../ driverlib / uart.c--) Fall√© (pero realmente no lo intent√©), aunque encontr√© la fuente (por supuesto, en el archivo en el archivo uart.c, gracias, capit√°n), afortunadamente, este fragmento es simple y es f√°cil identificar el c√≥digo del ensamblador con el c√≥digo fuente en C (especialmente si conoce las caracter√≠sticas del equipo de ITxxx).  No s√© c√≥mo resolver este problema para bibliotecas con funciones complejas, pensaremos cuando surja la necesidad. <br><br>  Y finalmente, una peque√±a observaci√≥n: estoy listo para creer que el hardware de la implementaci√≥n del canal en serie para los modelos MK CC13x0 es el mismo que para CC26x0, y la duplicaci√≥n del contenido de un archivo llamado UARTCC26XX.c --- no se puede llamar la soluci√≥n correcta, pero crear un archivo de definici√≥n intermedia con inclusi√≥n Agradecer√≠a el archivo fuente, anulando las funciones y el comentario correspondiente, ya que esto har√≠a que el programa sea m√°s comprensible, y esto siempre deber√≠a ser bienvenido, vout. <br><br>  Entonces, el caso de prueba funciona, aprendimos mucho sobre la estructura interna de las bibliotecas est√°ndar, notamos sus fortalezas y lados no tan buenos, en conclusi√≥n de la revisi√≥n trataremos de encontrar la respuesta a la pregunta que al programador generalmente le importa en el dilema "OS o no OS" - tiempo de cambio de contexto.  Aqu√≠ son posibles dos formas: 1) la consideraci√≥n del c√≥digo fuente es m√°s bien una forma te√≥rica, requiere un nivel de inmersi√≥n en el tema que no estoy listo para demostrar, y 2) un experimento pr√°ctico.  Por supuesto, el segundo m√©todo, a diferencia del primero, no da resultados absolutamente correctos, pero "la verdad siempre es concreta" y los datos obtenidos pueden considerarse adecuados si las mediciones se organizan correctamente. <br><br>  Para comenzar, para estimar el tiempo de cambio, necesitamos aprender a evaluar el tiempo de ejecuci√≥n general de varios fragmentos de programa.  En esta arquitectura, hay un m√≥dulo de depuraci√≥n, parte del cual es un contador del sistema.  La informaci√≥n sobre este m√≥dulo es bastante accesible, pero el demonio, como siempre, se esconde en los detalles.  Primero, intentemos configurar el modo necesario con los controladores directamente a trav√©s del acceso a los registros.  Encontramos r√°pidamente el bloque de registro CPU_DWT y en √©l encontramos tanto el contador CYCCNT como el registro de control CTRL con el bit CYCCNTENA.  Naturalmente, o, como dicen, por supuesto, no pas√≥ nada y el sitio web de ARM tiene una respuesta a la pregunta de por qu√©: es necesario habilitar el m√≥dulo de depuraci√≥n con el bit TRCENA en el registro DEMCR.  Pero el √∫ltimo registro no es tan simple: en el bloque DWT no est√° all√≠, en otros bloques es lento para buscar, son bastante largos, pero no encontr√© ninguna b√∫squeda por nombre en la ventana del registro (pero ser√≠a bueno tenerlo).  Entramos en la ventana de memoria, ingresamos la direcci√≥n del registro (lo conocemos desde la fecha) (por cierto, por alguna raz√≥n el formato hexadecimal de la direcci√≥n no es el predeterminado, debe agregar el prefijo 0x con plumas) y, de repente, vemos una celda de memoria con el nombre CPU_CSC_DEMCR.  Es divertido, por decir lo menos, por qu√© la compa√±√≠a cambi√≥ el nombre de los registros en comparaci√≥n con los nombres propuestos por el licenciante de la arquitectura, probablemente fue necesario.  Y seguro, en el bloque de registros CPU_CSC encontramos nuestro registro, establecemos el bit deseado en √©l, regresamos al contador, lo habilitamos y todo funcion√≥. <br><br>  Pnp: todav√≠a hay una b√∫squeda por nombre, la combinaci√≥n Ctrl-F lo llama (naturalmente), solo existe en el men√∫ contextual, pero en el habitual est√° cancelado, pido disculpas a los desarrolladores. <br><br>  Inmediatamente noto otro inconveniente de la ventana de memoria: la impresi√≥n del contenido se interrumpe al indicar las celdas con nombre, lo que hace que la salida se rompa y no se segmente en higos en 16 (8.32, 64, sustituya las palabras necesarias).  Adem√°s, el formato de salida cambia cuando se cambia el tama√±o de la ventana.  Tal vez todo esto se pueda configurar seg√∫n las necesidades del usuario, pero, seg√∫n mi propia experiencia (y de qu√© otra cosa deber√≠a proceder), declaro que configurar el formato de salida de la ventana de visualizaci√≥n de memoria no se aplica a soluciones intuitivamente obvias.  Estoy totalmente a favor de habilitar una funci√≥n tan conveniente como mostrar √°reas de memoria con nombre en la ventana de visualizaci√≥n, de lo contrario, muchos usuarios nunca lo sabr√≠an, pero tambi√©n se debe tener cuidado con aquellos que desean deshabilitarla conscientemente. <br><br>  Por cierto, no abandonar√≠a por completo la posibilidad de crear macros (o scripts) para trabajar con el entorno, porque ten√≠a que hacer esta configuraci√≥n de registro (para permitir la medici√≥n del tiempo) cada vez despu√©s de restablecer el MK, ya que considero la correcci√≥n del c√≥digo insertando manipulaciones de registro para fines de depuraci√≥n No muy correcto.  Pero, aunque nunca encontr√© macros, el trabajo con registros puede simplificarse en gran medida debido al hecho de que los registros individuales (necesarios) pueden incluirse en la ventana de expresi√≥n y, por lo tanto, facilitan y aceleran significativamente el trabajo con ellos. <br><br>  Para enfatizar que el sentimiento del ingeniero por la familia MK no se ha enfriado (de lo contrario, reprendo diferentes aspectos del entorno de desarrollo), noto que el contador funciona bien: no pude encontrar ning√∫n ciclo adicional en ninguno de los modos de depuraci√≥n, pero antes de que esto sucediera ser, al menos en la serie MK, desarrollada por LuminaryMicro. <br><br>  Por lo tanto, describimos el plan de experimento para determinar el tiempo de cambio de contexto: cree una segunda tarea que incremente un cierto contador interno (en un bucle infinito), inicie el MC durante un cierto tiempo, encuentre la relaci√≥n entre el contador del sistema y el contador de tareas.  Luego, inicie el MK por un tiempo similar (no necesariamente el mismo) e ingrese 10 caracteres a un ritmo aproximadamente una vez por segundo.  Se puede esperar que esto resulte en 10 cambios a la tarea de eco y 10 cambios a la tarea de contador.  S√≠, estos cambios de contexto se realizar√°n no de acuerdo con el temporizador del planificador, sino de acuerdo con el evento, pero esto no deber√≠a afectar el tiempo total de ejecuci√≥n de la funci√≥n investigada, por lo que comenzamos a implementar el plan, crear la tarea de contador y comenzarla. <br><br>  Aqu√≠ encontramos una caracter√≠stica de RTOS, al menos en la configuraci√≥n est√°ndar: no se desplaza "de verdad": si la tarea prioritaria est√° constantemente lista para su ejecuci√≥n (y la tarea de contador es esa) y no le da control al programador (no espera se√±ales, no se duerme, no bloqueado por banderas, etc.), entonces no se ejecutar√° una sola tarea de menor prioridad a partir de la palabra.  Esto no es Linux, en el que se utilizan varios m√©todos para garantizar que todos obtengan un quantum, "para que nadie se sienta ofendido".  Este comportamiento es bastante esperado, muchos RTOS ligeros se comportan de esta manera, pero el problema resulta ser m√°s profundo, ya que la administraci√≥n no recibe tareas de igual prioridad que una constantemente preparada.  Es por eso que en este ejemplo, puse la tarea de eco, que est√° en espera, la prioridad es mayor que la tarea de contador constantemente lista, de lo contrario, esta √∫ltima capturar√° todos los recursos del procesador a tiempo. <br><br>  Comenzamos el experimento, la primera parte (solo esperando el tiempo de ejecuci√≥n) proporcion√≥ los datos sobre la relaci√≥n de los contadores 406181 / 58015 = 7, es bastante esperado.  La segunda parte (con 10 caracteres consecutivos durante ~ 10 segundos) da los resultados 351234k-50167k * 7 = 63k / 20 = 3160 ciclos, el √∫ltimo d√≠gito es el tiempo asociado con el procedimiento de cambio de contexto en ciclos MK.  Personalmente, este valor me parece algo mayor de lo esperado, seguimos investigando, parece que todav√≠a hay algunas acciones que estropean las estad√≠sticas. <br><br>  PNP: un error com√∫n de un experimentador es no evaluar los resultados previstos anteriormente y creer en la basura recibida (hola a 737 desarrolladores). <br><br>  Es obvio ("s√≠, bastante obvio") que el resultado, adem√°s de la conmutaci√≥n de contexto real, tambi√©n contiene el tiempo necesario para realizar las operaciones de lectura de un car√°cter desde el b√∫fer y enviarlo al puerto serie.  Menos obvio es que tambi√©n tiene el tiempo necesario para procesar una interrupci√≥n cuando se recibe y colocar el car√°cter en el b√∫fer de recepci√≥n).  ¬øC√≥mo podemos separar a un gato de la carne? Para esto tenemos un truco complicado, detenemos el programa, ingresamos 10 caracteres y lo iniciamos.  Podemos esperar (deber√≠amos mirar la fuente) que se produzca una interrupci√≥n en la recepci√≥n solo 1 vez e inmediatamente se enviar√°n todos los caracteres desde el b√∫fer de recepci√≥n al anillo, lo que significa que veremos menos sobrecarga.  Tambi√©n es f√°cil determinar el tiempo de entrega al puerto serie: sacaremos cada segundo car√°cter y resolveremos las 2 ecuaciones lineales resultantes con 2 desconocidas.  Y es posible e incluso m√°s simple: no deducir nada, lo cual hice. <br><br>  Y aqu√≠ est√°n los resultados de manipulaciones tan complicadas: hacemos la entrada por paquete y los ticks faltantes se hacen m√°s peque√±os - 2282, apagamos la salida y los costos caen a 1222 ticks - es mejor, aunque esperaba 300 ticks. <br><br>  Pero con el tiempo de lectura, no se puede encontrar nada como esto; se escala simult√°neamente con el tiempo de cambio de contexto deseado.  Lo √∫nico que puedo ofrecer es apagar el temporizador interno al comienzo de ingresar el car√°cter recibido y volver a encenderlo antes de ingresar a la espera del siguiente.  Luego, dos contadores funcionar√°n sincr√≥nicamente (con la excepci√≥n del cambio) y se puede determinar f√°cilmente.  Pero este enfoque requiere una implementaci√≥n profunda de los programas del sistema en los textos, y a√∫n permanecer√° el componente del manejo de interrupciones.  Por lo tanto, propongo limitarme a los datos ya obtenidos, lo que nos permite afirmar firmemente que el tiempo de cambio de tareas en el TI-RTOS en consideraci√≥n no excede los 1222 ciclos de reloj, que para una frecuencia de reloj dada es de 30 microsegundos. <br><br>  PNP: de todos modos, mucho: cont√© ciclos a las 100:30 para guardar el contexto, 40 para determinar la tarea finalizada y 30 para restaurar el contexto, pero obtenemos un orden de magnitud m√°s.  Aunque la optimizaci√≥n se ha desactivado ahora, active ‚Äìo2 y vea el resultado: no ha cambiado mucho, se ha convertido en 2894 en lugar de 3160. <br><br>  Hay otra idea: si el sistema operativo admite el cambio de tareas de igual a igual, entonces podr√≠a ejecutar dos tareas con contadores, obtener m√°gicamente datos sobre el n√∫mero de conmutadores en un momento y calcular la p√©rdida del contador del sistema, pero debido a las peculiaridades del programador, sobre el cual Ya dicho, este enfoque no conducir√° al √©xito.  Si bien es posible otra opci√≥n: hacer ping-pong entre dos tareas de igual a igual (o incluso de igual a igual) a trav√©s de un sem√°foro, es f√°cil calcular la cantidad de cambios de contexto aqu√≠; tendr√° que intentarlo, pero ser√° ma√±ana. <br><br>  Esta vez, la encuesta tradicional al final de la publicaci√≥n estar√° dedicada no al nivel de presentaci√≥n (es claro para cualquier lector imparcial que est√° m√°s all√° de cualquier elogio y excede cualquier expectativa), sino al tema de la pr√≥xima publicaci√≥n. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/451918/">https://habr.com/ru/post/451918/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451904/index.html">A veces m√°s es menos. Cuando una disminuci√≥n en la carga conduce a un aumento en el retraso</a></li>
<li><a href="../451906/index.html">Vulnerabilidad de Exchange: c√≥mo detectar la elevaci√≥n de privilegios a un administrador de dominio</a></li>
<li><a href="../451908/index.html">La historia de las computadoras: una noche en el Museo Yandex</a></li>
<li><a href="../451912/index.html">La red neuronal profunda de MuseNet escribe m√∫sica</a></li>
<li><a href="../451916/index.html">PHP asincr√≥nico y la historia de una bicicleta</a></li>
<li><a href="../451920/index.html">Optimice el almacenamiento de correo en Zimbra Collaboration Suite</a></li>
<li><a href="../451922/index.html">Aritm√©tica de punto fijo en C ++</a></li>
<li><a href="../451926/index.html">Acerca del c√≥digo en vivo despu√©s de 130 transmisiones</a></li>
<li><a href="../451928/index.html">C√≥mo configurar an√°lisis web en p√°ginas AMP</a></li>
<li><a href="../451930/index.html">Automatizaci√≥n de iluminaci√≥n de escaleras</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>