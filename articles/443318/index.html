<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üïë üöñ üëñ Escribir un cargador de wasm para Ghidra. Parte 1: planteamiento del problema y entorno de configuraci√≥n üßóüèª ‚ò∏Ô∏è üõí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Esta semana, la NSA ( Agencia de Seguridad Nacional ) de repente hizo un regalo a la humanidad, abriendo las fuentes de su marco de ingenier√≠a inversa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Escribir un cargador de wasm para Ghidra. Parte 1: planteamiento del problema y entorno de configuraci√≥n</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/443318/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/xy/1q/jm/xy1qjmpn0nactzdrq1laun9brhm.png"></div><br>  Esta semana, la NSA ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Agencia de Seguridad Nacional</a> ) de repente hizo un regalo a la humanidad, abriendo las fuentes de su marco de ingenier√≠a inversa de software.  La comunidad de ingenieros de ingenier√≠a inversa y expertos en seguridad con gran entusiasmo comenz√≥ a explorar el nuevo juguete.  Seg√∫n los comentarios, es una herramienta realmente sorprendente, capaz de competir con las soluciones existentes, como IDA Pro, R2 y JEB.  La herramienta se llama Ghidra y los recursos profesionales est√°n llenos de impresiones de los investigadores.  En realidad, ten√≠an una buena raz√≥n: no todos los d√≠as las organizaciones gubernamentales brindan acceso a sus herramientas internas.  Yo como ingeniero inverso profesional y analista de malware no pod√≠a pasar por alto tambi√©n.  Decid√≠ pasar un fin de semana o dos y obtener una primera impresi√≥n de la herramienta.  Jugu√© un poco con el desmontaje y decid√≠ verificar la extensibilidad de la herramienta.  En esta serie de art√≠culos, explicar√© el desarrollo del complemento Ghidra, que carga el formato personalizado, utilizado para resolver la tarea CTF.  Como es un marco grande y he elegido una tarea bastante complicada, dividir√© el art√≠culo en varias partes. <br><br>  Al final de esta parte, espero configurar el entorno de desarrollo y crear un m√≥dulo m√≠nimo, que pueda reconocer el formato del archivo WebAssembly y sugerir el desensamblador adecuado para procesarlo. <br><a name="habracut"></a><br>  Comencemos con la descripci√≥n de la tarea.  El a√±o pasado, la compa√±√≠a de seguridad FireEye organiz√≥ el concurso CTF, llamado flare-on.  Durante el concurso, los investigadores tuvieron que resolver doce tareas relacionadas con la ingenier√≠a inversa.  Una de las tareas era investigar la aplicaci√≥n web, construida con WebAssembly.  Es un formato ejecutable relativamente nuevo, y que yo sepa, no hay herramientas perfectas para manejarlo.  Durante el desaf√≠o, prob√© varias herramientas diferentes tratando de derrotarlo.  Esos eran simples guiones de github y descompiladores conocidos, como IDA pro y JEB.  Sorprendentemente, me detuve en Chrome, que proporciona un muy buen desensamblador y depurador para WebAssembly.  Mi objetivo es resolver el desaf√≠o con la ghidra.  Voy a describir el estudio lo m√°s completo posible y dar√© toda la informaci√≥n posible para reproducir mis pasos.  Tal vez, como persona que no tiene mucha experiencia con el instrumento, podr√≠a entrar en algunos detalles innecesarios, pero as√≠ es como es. <br><br>  La tarea que voy a utilizar para estudiar se puede descargar del <a href="">sitio de</a> desaf√≠o flareon5.  Hay un archivo 05_web2point0.7z: archivo cifrado con una palabra aterradora <b>infectada</b> .  Hay tres archivos en el archivo: index.html, main.js y test.wasm.  Abramos el archivo index.html en un navegador y verifiquemos el resultado: <br><br><img src="https://habrastorage.org/webt/5z/o2/fd/5zo2fdf7jjndo2tmhesju4go7io.png"><br><br>  Bueno, con eso trabajar√©.  Comencemos con el estudio html, especialmente porque es la parte m√°s f√°cil del desaf√≠o.  El c√≥digo html no contiene nada excepto la carga del script main.js. <br><br><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"container"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"./main.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br>  El gui√≥n tampoco hace nada complicado, a pesar de que parece un poco m√°s detallado.  Simplemente carga el archivo test.wasm y lo usa para crear una instancia de WebAssembly.  Luego lee el par√°metro "q" de la url y lo pasa al m√©todo match, exportado por la instancia.  Si la cadena en el par√°metro es incorrecta, el script muestra la imagen que hemos visto anteriormente, en t√©rminos de los desarrolladores de FireEye llamados "Pila de pop√≥". <br><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Uint8Array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextEncoder().encode(getParameterByName(<span class="hljs-string"><span class="hljs-string">"q"</span></span>))); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pa = wasm_alloc(instance, <span class="hljs-number"><span class="hljs-number">0x200</span></span>); wasm_write(instance, pa, a); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> pb = wasm_alloc(instance, <span class="hljs-number"><span class="hljs-number">0x200</span></span>); wasm_write(instance, pb, b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (instance.exports.Match(pa, a.byteLength, pb, b.byteLength) == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// PARTY POPPER document.getElementById("container").innerText = "√∞≈∏≈Ω‚Ä∞"; } else { // PILE OF POO document.getElementById("container").innerText = "√∞≈∏'"; }</span></span></code> </pre><br>  La soluci√≥n de la tarea es encontrar el valor del par√°metro q que hace que la funci√≥n "match" devuelva "True".  Para hacer esto, voy a desmontar el archivo test.wasm y analizar el algoritmo de la funci√≥n Match. <br><br>  No hay sorpresas, e intentar√© hacerlo en Ghidra.  Pero primero tengo que instalarlo.  La instalaci√≥n puede (y debe) descargarse de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://ghidra-sre.org/</a> .  Como est√° escrito en Java, casi no hay requisitos especiales para la instalaci√≥n, no requiere ning√∫n esfuerzo especial para instalarlo.  Todo lo que necesita es descomprimir el archivo y ejecutar la aplicaci√≥n.  Lo √∫nico que se requiere es actualizar JDK y JRE a la versi√≥n 11. <br><br>  Creemos un nuevo proyecto ghidra (Archivo- <b>&gt; Nuevo proyecto</b> ), y llam√©moslo "wasm" / <br><br><img src="https://habrastorage.org/webt/yt/1j/2s/yt1j2sgpytbsoyhsschjdit4v7m.png"><br><br>  Luego agregue al proyecto el archivo test.wasm ( <b>Archivo ‚Üí Importar archivo</b> ) y vea c√≥mo ghidra puede manejarlo <br><br><img src="https://habrastorage.org/webt/up/wq/jq/upwqjqan-5cooznznqw5pcks-pw.png"><br><br>  Bueno, no puede hacer nada.  No reconoce el formato y no puede desmontar nada, por lo tanto, es absolutamente impotente para hacer frente a esta tarea.  Finalmente hemos llegado al tema del art√≠culo.  No queda nada por hacer, pero escriba un m√≥dulo que pueda cargar el archivo wasm, analizarlo y desmontar su c√≥digo. <br><br>  En primer lugar, he estudiado toda la documentaci√≥n disponible.  En realidad, solo hay un documento adecuado que muestra el proceso de desarrollo de complementos: diapositivas GhidraAdvancedDevelopment.  Voy a seguir el documento, dando una descripci√≥n detallada. <br><br>  Desafortunadamente, el desarrollo de complementos requiere el uso de eclipse.  Toda mi experiencia con eclipse es el desarrollo de dos juegos gdx para Android en 2012. Hab√≠an pasado dos semanas llenas de dolor y sufrimiento, despu√©s de lo cual lo borr√© de mi mente.  Espero que despu√©s de 7 a√±os de desarrollo sea mejor de lo que sol√≠a ser. <br><br>  Descarguemos e instalemos eclipse desde el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio</a> oficial. <br><br>  Luego, instale la extensi√≥n para el desarrollo de ghidra: <br><br>  Ir a eclipse <b>Ayuda ‚Üí Instalar nuevo</b> men√∫ de <b>software</b> , haga clic en el bot√≥n <b>Agregar</b> y seleccione GhidraDev.zip desde / Extensions / Eclipse / GhidraDev /.  Inst√°lelo y reinicie la extensi√≥n.  La extensi√≥n, agrega plantillas al nuevo men√∫ del proyecto, permite depurar m√≥dulos del eclipse y compilar el m√≥dulo al paquete de distribuci√≥n. <br><br>  Como se desprende de los documentos de los desarrolladores, se deben seguir los siguientes pasos para agregar un m√≥dulo para procesar un nuevo formato binario: <br><br><ul><li>  Crear clases, describiendo estructuras de datos. </li><li>  Desarrollar cargador.  El cargador debe heredarse de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AbstractLibrarySupportLoader</a> .  Lee todos los datos necesarios del archivo, verifica la integridad de los datos y convierte los datos binarios en representaci√≥n interna, prepar√°ndolos para el an√°lisis <br></li><li>  Desarrollar analizador.  El analizador se hereda de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">AbstractAnalyzer</a> .  Toma las estructuras de datos preparadas por el cargador y las anota (no estoy muy seguro de lo que significa, pero espero entender durante el desarrollo) <br></li><li>  A√±adir procesador.  Ghidra tiene una abstracci√≥n: procesador.  Est√° escrito en lenguaje declarativo interno y describe el conjunto de instrucciones, el dise√±o de la memoria y otras caracter√≠sticas arquitect√≥nicas.  Voy a cubrir este tema, escribiendo el desensamblador. <br></li></ul><br>  Ahora, cuando tenemos toda la teor√≠a necesaria, es hora de crear el proyecto del m√≥dulo.  Gracias a la extensi√≥n de eclipse previamente instalada GhidraDev, tenemos la plantilla del m√≥dulo directamente en el <b>men√∫ Archivo-&gt; Nuevo proyecto</b> . <br><br><img src="https://habrastorage.org/webt/ir/z3/77/irz377yf_rcsginnfb-e8-ee-ga.png"><br><br>  El asistente pregunta qu√© componentes son necesarios.  Como se describi√≥ anteriormente, necesitar√≠amos dos de ellos: cargador y analizador. <br><br><img src="https://habrastorage.org/webt/vf/cc/j1/vfccj1djknkxefjuc1bg9pysycs.png"><br><br>  El asistente crea un esqueleto de proyecto con todas las partes necesarias: analizador en blanco en el archivo WasmAnalyzer.java, cargador en blanco en el archivo WasmLoader.java y esqueleto de idioma en el directorio / datos / idiomas. <br><br><img src="https://habrastorage.org/webt/bu/3q/uw/bu3quwuupe-0heogbta81hrub7c.png"><br><br>  Comencemos con el cargador.  Como se mencion√≥, debe heredarse de la clase AbstractLibrarySupportLoader y tiene tres m√©todos para sobrecargarse: <br><br><ul><li>  getName: este m√©todo debe incluir el nombre interno del cargador.  Ghidra lo usa en varios lugares, por ejemplo, para vincular el cargador al procesador </li><li>  findSupportedLoadSpecs: devoluci√≥n de llamada, ejecutada, cuando el usuario elige el archivo para importar.  En este cargador de devoluci√≥n de llamada debe decidir si es capaz de procesar el archivo y devolver la instancia de la clase LoadSpec, dici√©ndole al usuario c√≥mo se puede procesar el archivo </li><li>  carga: devoluci√≥n de llamada, ejecutada, despu√©s del archivo cargado por el usuario.  En este m√©todo, el cargador analiza la estructura del archivo y se carga en ghidra.  Lo describiremos con m√°s detalles en el pr√≥ximo art√≠culo. </li></ul><br>  El primer m√©todo y el m√°s simple es getName, solo devuelve el nombre del cargador <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"WebAssembly"</span></span>; }</code> </pre><br>  El segundo m√©todo para implementar es findSupportedLoadSpecs.  La herramienta lo llama durante la importaci√≥n del archivo y debe verificar si el cargador puede procesar el archivo.  Si su m√©todo capaz devuelve el objeto de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LoadSpec</a> , indica qu√© objeto se usa para cargar el archivo y qu√© procesador desarmar√° su c√≥digo. <br><br>  El m√©todo comienza desde la verificaci√≥n del formato.  Como se desprende de la <a href="">especificaci√≥n</a> , los primeros ocho bytes del archivo wasm deben ser la firma "\ 0asm" y la versi√≥n. <br><br>  Para analizar el encabezado, cre√© la clase WasmHeader, implementando la interfaz <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">StructConverter</a> , que es la interfaz base para describir datos estructurados.  El constructor de WasmHeader recibe el objeto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BinaryReader</a> - abstracci√≥n, utilizada para leer datos de la fuente binaria que se analiza.  El constructor lo usa para leer el encabezado del archivo de entrada <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[] magic; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> [] version; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WasmHeader</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BinaryReader reader)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ magic = reader.readNextByteArray(WASM_MAGIC_BASE.length()); version = reader.readNextByteArray(WASM_VERSION_LENGTH); }</code> </pre><br>  Loader usa este objeto para verificar la firma del archivo.  Luego, en caso de √©xito, busca el procesador apropiado.  Llama a la consulta de m√©todo de la clase <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">QueryOpinionService</a> y le pasa el nombre del cargador ("Webassembly").  OpinionService est√° buscando un procesador asociado con este cargador y lo devuelve. <br><br><pre> <code class="java hljs">List&lt;QueryResult&gt; queries = QueryOpinionService.query(getName(), MACHINE, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre><br>  Claro que no devuelve nada, porque ghidra no conoce el procesador, llamado WebAssembly y es necesario definirlo.  Como dije antes, el asistente cre√≥ el esqueleto de idioma en los datos / idiomas del directorio. <br><br><img src="https://habrastorage.org/webt/ck/hq/0d/ckhq0d4gena4dbalhjufpwv9kbs.png"><br><br>  En la etapa actual, hay dos archivos que pueden ser interesantes: Webassembly.opinion y Wbassembly.ldefs.  El archivo .opinon establece la correspondencia entre el cargador y el procesador. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opinions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loader</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WebAssembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">compilerSpecID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">primary</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constraint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">opinions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Contiene xml simple con pocos atributos.  Es necesario establecer el nombre del cargador en el atributo "cargador" y el nombre del procesador en el atributo "procesador", ambos son "Webassembly".  En este paso rellenar√© otros par√°metros con los valores aleatorios.  Tan pronto como sepa m√°s sobre el arquitecto del procesador Webassembly, los cambiar√© a los valores correctos. <br><br>  El archivo .ldefs describe las caracter√≠sticas del procesador, que debe ejecutar el c√≥digo del archivo. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language_definitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">endian</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"little"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">variant</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slafile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.sla"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">processorspec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.pspec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wasm:LE:16:default"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Webassembly Language Module<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">compiler</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">spec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Webassembly.cspec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">language_definitions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  El "procesador" de atributos debe ser el mismo que el procesador de atributos del archivo .opinion.  Dejemos otros campos intactos.  Pero recuerde la pr√≥xima vez que es posible establecer bittness de registro (atributo "tama√±o"), archivo que describe la arquitectura del procesador "processorspec" y el archivo, que contiene la descripci√≥n del c√≥digo en lenguaje declarativo especial "slafile".  Ser√° √∫til trabajar en el desmontaje. <br><br>  Ahora, es hora de volver al cargador y devolver la especificaci√≥n del cargador. <br><br>  Todo est√° listo para la prueba.  El complemento para GhidraDev ha agregado la opci√≥n de ejecuci√≥n ‚Äú <b>Ejecutar ‚Üí Ejecutar como ‚Üí Ghidra</b> ‚Äù para eclipsar: <br><br><img src="https://habrastorage.org/webt/j5/z-/ft/j5z-ft7xxiy1equy99ahzrt6d7a.png"><br><br>  Ejecuta ghidra en modo de depuraci√≥n y despliega su m√≥dulo, dando una gran oportunidad para trabajar con la herramienta y al mismo tiempo usar el depurador para corregir errores en el m√≥dulo que se est√° desarrollando.  Pero en esta etapa simple no hay raz√≥n para usar un depurador.  Como antes, crear√© un nuevo proyecto, importar√© un archivo y ver√© si mis esfuerzos dieron resultado.  A diferencia de la √∫ltima vez, el archivo se reconoce como WebAssembly, y el cargador propone el procesador correspondiente.  Eso significa que todo funciona, y mi m√≥dulo puede reconocer el formato. <br><br><img src="https://habrastorage.org/webt/zs/np/vd/zsnpvdvzqx5ecg7xdlz86dzres0.png"><br><br>  En el siguiente art√≠culo, extender√© el cargador y har√© que no solo reconozca, sino que tambi√©n describa la estructura del archivo wasm.  Creo que en esta etapa, despu√©s de configurar el entorno, ser√° f√°cil de hacer. <br><br>  El c√≥digo del m√≥dulo est√° disponible en el repositorio de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/443318/">https://habr.com/ru/post/443318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../443306/index.html">Ocho leyes de nombres en el dise√±o de experiencia de usuario (Parte 1)</a></li>
<li><a href="../443308/index.html">Mitos de la f√≠sica moderna. Leyes de conservaci√≥n</a></li>
<li><a href="../443310/index.html">Revisi√≥n del dispositivo de bienestar para mujeres Bellabeat</a></li>
<li><a href="../443312/index.html">Gesti√≥n de memoria Python</a></li>
<li><a href="../443316/index.html">Prueba de ReactJS: qu√© tan profunda es la madriguera del conejo</a></li>
<li><a href="../443320/index.html">Sistema de gesti√≥n electr√≥nica de documentos "Visir"</a></li>
<li><a href="../443322/index.html">GitLab 11.8 lanzado con SAST para JavaScript, p√°ginas de GitLab para subgrupos y seguimiento de errores</a></li>
<li><a href="../443324/index.html">Python vs. Scala para Apache Spark: referencia esperada con resultado inesperado</a></li>
<li><a href="../443326/index.html">Python y Arduino. Simple, rapido y hermoso</a></li>
<li><a href="../443330/index.html">Semana de la seguridad 11: RSA 2019 y un futuro mejor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>