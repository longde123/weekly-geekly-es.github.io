<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🗽 🤔 💎 Arrastra y desliza en RecyclerView. Parte 2: arrastrar y soltar controladores, cuadrículas y animaciones personalizadas 🙇🏿 👩🏻‍🤝‍👨🏽 🎴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En la primera parte, analizamos ItemTouchHelper y la implementación de ItemTouchHelper.Callback , que agrega las funciones básicas de arrastrar y solt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arrastra y desliza en RecyclerView. Parte 2: arrastrar y soltar controladores, cuadrículas y animaciones personalizadas</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428419/"><p><img src="https://habrastorage.org/getpro/habr/post_images/fb5/88a/f25/fb588af25a1669e5bd9c7c22eae912b2.jpg" alt="Arrastra y desliza en RecyclerView. Parte 2: arrastrar y soltar controladores, cuadrículas y animaciones personalizadas"></p><br><p> En la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera parte,</a> analizamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ItemTouchHelper</a> y la implementación de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ItemTouchHelper.Callback</a> , que agrega las <strong>funciones</strong> básicas de <strong>arrastrar y soltar</strong> y <strong>deslizar para descartar</strong> a <code>RecyclerView</code> .  En este artículo, continuaremos lo que se hizo en el anterior agregando soporte para organizar elementos en forma de cuadrícula, controladores de arrastrar y soltar, selección de un elemento de la lista y animaciones de deslizamiento personalizadas. </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/getpro/habr/post_images/608/7bc/dfa/6087bcdfa80d40413295b69835929a99.gif" alt="Malla de elementos"></p><br><h2 id="kontrollery-peretaskivaniya">  Arrastrar y soltar controladores </h2><br><p>  Al crear una lista que admite <strong>arrastrar y soltar</strong> , generalmente implementan la capacidad de arrastrar y soltar elementos con el tacto.  Esto contribuye a la claridad y facilidad de uso de la lista en el "modo de edición", y también lo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recomiendan</a> las pautas de materiales.  Agregar controladores de arrastrar y soltar a nuestro ejemplo es increíblemente fácil. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f2f/5b6/52d/f2f5b652de798a2fdfd952b85846d461.jpg" alt="Arrastrar y soltar controladores"></p><br><p>  Primero, actualice el <code>layout</code> elemento ( <strong>item_main.xml</strong> ). </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/item"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?listPreferredItemHeight"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:clickable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:focusable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:foreground</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?selectableItemBackground"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textAppearance</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?android:attr/textAppearanceMedium"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/handle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"?listPreferredItemHeight"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center_vertical|right"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scaleType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@drawable/ic_reorder_grey_500_24dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  La imagen utilizada para el controlador de arrastre se puede encontrar en los <a href="">iconos de Diseño de materiales</a> y agregar al proyecto utilizando el conveniente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento generador de iconos</a> en Android Studio. </p><br><p>  Como se mencionó brevemente en un artículo anterior, puede usar <code>ItemTouchHelper.startDrag(ViewHolder)</code> para iniciar mediante programación arrastrar y soltar.  Entonces, todo lo que tenemos que hacer es actualizar <code>ViewHolder</code> agregando un controlador de arrastre y configurar un controlador táctil simple que llamará a <code>startDrag()</code> . </p><br><p>  Necesitaremos una interfaz para transmitir eventos a lo largo de la cadena: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnStartDragListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Called when a view is requesting a start of a drag. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> viewHolder The holder of the view to drag. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onStartDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder viewHolder)</span></span></span></span>; }</code> </pre> <br><p>  Luego defina un <code>ImageView</code> para el controlador de arrastre en <code>ItemViewHolder</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ImageView handleView; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ItemViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View itemView)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(itemView); <span class="hljs-comment"><span class="hljs-comment">// ... handleView = (ImageView) itemView.findViewById(R.id.handle); }</span></span></code> </pre> <br><p>  y actualice el <code>RecyclerListAdapter</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> OnStartDragListener mDragStartListener; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RecyclerListAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(OnStartDragListener dragStartListener)</span></span></span><span class="hljs-function"> </span></span>{ mDragStartListener = dragStartListener; <span class="hljs-comment"><span class="hljs-comment">// ... } @Override public void onBindViewHolder(final ItemViewHolder holder, int position) { // ... holder.handleView.setOnTouchListener(new OnTouchListener() { @Override public boolean onTouch(View v, MotionEvent event) { if (MotionEventCompat.getActionMasked(event) == MotionEvent.ACTION_DOWN) { mDragStartListener.onStartDrag(holder); } return false; } }); }</span></span></code> </pre> <br><p>  <code>RecyclerListAdapter</code> ahora debería verse así. </p><br><p>  Todo lo que queda por hacer es agregar <code>OnStartDragListener</code> al fragmento: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerListFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnStartDragListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Override public void onViewCreated(View view, Bundle icicle) { super.onViewCreated(view, icicle); RecyclerListAdapter a = new RecyclerListAdapter(this); // ... } @Override public void onStartDrag(RecyclerView.ViewHolder viewHolder) { mItemTouchHelper.startDrag(viewHolder); } }</span></span></code> </pre> <br><p>  <code>RecyclerListFragment</code> ahora debería verse <a href="">así</a> .  Ahora, cuando inicie la aplicación, puede comenzar a arrastrar y soltar tocando el controlador. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1ef/ede/2c9/1efede2c99d654260325ee2f9db4a9f8.gif" alt="Arrastrando elementos de la lista"></p><br><h2 id="vydelenie-elementa-spiska">  Destacar un elemento de la lista </h2><br><p>  Ahora, en nuestro ejemplo, no hay indicación visual del elemento que se está arrastrando.  Obviamente, esto no debería ser así, pero es fácil de solucionar.  Con <code>ItemTouchHelper</code> puede usar efectos de resaltado de elementos estándar.  En Lollipop y versiones posteriores de Android, la luz de fondo "se extiende" sobre el elemento en el proceso de interacción con él;  En versiones anteriores, el elemento simplemente cambia su color a oscuro. </p><br><p>  Para implementar esto en nuestro ejemplo, simplemente agregue un fondo (propiedad de <code>background</code> ) al <code>FrameLayout</code> raíz <code>FrameLayout</code> elemento <code>FrameLayout</code> o <code>FrameLayout</code> en el constructor de <a href="">RecyclerListAdapter.ItemViewHolder</a> .  Se verá más o menos así: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f2c/a9a/ebc/f2ca9aebc4e5e5695c8c749d8813890b.gif" alt="Selección de elemento"></p><br><p>  Se ve genial, pero es posible que desee controlar aún más.  Una forma de hacerlo es permitir que <code>ViewHolder</code> maneje los cambios de estado de un elemento.  Para esto, <code>ItemTouchHelper.Callback</code> proporciona dos métodos más: </p><br><ul><li>  <code>onSelectedChanged(ViewHolder, int)</code> se llama cada vez que el estado de un elemento cambia a <strong>arrastrar</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ACTION_STATE_DRAG</a> ) o <strong>deslizar</strong> ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ACTION_STATE_SWIPE</a> ).  Este es un lugar ideal para cambiar el estado del componente de <code>view</code> a <em>activo</em> . </li><li>  <code>clearView(RecyclerView, ViewHolder)</code> cuando se completa el componente de <code>view</code> arrastrar y soltar, y también cuando se completa el deslizamiento ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ACTION_STATE_IDLE</a> ).  Aquí, el estado <em>inicial</em> de su componente de <code>view</code> generalmente se restaura. </li></ul><br><p>  Ahora, pongamos todo junto. </p><br><p>  Primero, cree una interfaz que <code>ViewHolders</code> implementará: </p><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Notifies a View Holder of relevant callbacks from * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> ItemTouchHelper.Callback}. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemTouchHelperViewHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Called when the {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> ItemTouchHelper} first registers an * item as being moved or swiped. * Implementations should update the item view to indicate * it's active state. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Called when the {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> ItemTouchHelper} has completed the * move or swipe, and the active item state should be cleared. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onItemClear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; }</code> </pre> <br><p>  Luego, en <code>SimpleItemTouchHelperCallback</code> implemente los métodos apropiados: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSelectedChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView.ViewHolder viewHolder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> actionState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// We only want the active item if (actionState != ItemTouchHelper.ACTION_STATE_IDLE) { if (viewHolder instanceof ItemTouchHelperViewHolder) { ItemTouchHelperViewHolder itemViewHolder = (ItemTouchHelperViewHolder) viewHolder; itemViewHolder.onItemSelected(); } } super.onSelectedChanged(viewHolder, actionState); } @Override public void clearView(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder) { super.clearView(recyclerView, viewHolder); if (viewHolder instanceof ItemTouchHelperViewHolder) { ItemTouchHelperViewHolder itemViewHolder = (ItemTouchHelperViewHolder) viewHolder; itemViewHolder.onItemClear(); } }</span></span></code> </pre> <br><p>  Ahora todo lo que queda es que <code>RecyclerListAdapter.ItemViewHolder</code> implemente <code>ItemTouchHelperViewHolder</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemTouchHelperViewHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... @Override public void onItemSelected() { itemView.setBackgroundColor(Color.LTGRAY); } @Override public void onItemClear() { itemView.setBackgroundColor(0); } }</span></span></code> </pre> <br><p>  En este ejemplo, simplemente agregamos un fondo gris mientras el elemento está activo y luego lo eliminamos.  Si su <code>ItemTouchHelper</code> y el adaptador están estrechamente conectados, puede abandonar fácilmente esta configuración y cambiar el estado del componente de <code>view</code> directamente en <code>ItemTouchHelper.Callback</code> . </p><br><h2 id="setki">  Redes </h2><br><p>  Si ahora intenta utilizar el <code>GridLayoutManager</code> , verá que no funciona correctamente.  La razón y la solución son simples: debemos decirle a nuestro <code>ItemTouchHelper</code> que queremos admitir arrastrar elementos de izquierda a derecha.  Anteriormente en <code>SimpleItemTouchHelperCallback</code> ya especificamos: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMovementFlags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> swipeFlags = ItemTouchHelper.START | ItemTouchHelper.END; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> makeMovementFlags(dragFlags, swipeFlags); }</code> </pre> <br><p>  El único cambio necesario para soportar las cuadrículas es agregar las banderas apropiadas: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN | ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT;</code> </pre> <br><p>  Sin embargo, <strong>deslizar para descartar</strong> no <strong>es</strong> un comportamiento muy natural para los elementos de la cuadrícula, por <code>swipeFlags</code> muy probable que las <code>swipeFlags</code> : </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMovementFlags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RecyclerView recyclerView, RecyclerView.ViewHolder viewHolder)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> dragFlags = ItemTouchHelper.UP | ItemTouchHelper.DOWN | ItemTouchHelper.LEFT | ItemTouchHelper.RIGHT; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> swipeFlags = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> makeMovementFlags(dragFlags, swipeFlags); }</code> </pre> <br><p>  Para ver un ejemplo de <code>GridLayoutManager</code> funciona, vea <a href="">RecyclerGridFragment</a> .  Así es como se ve al inicio: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/969/36d/0aa/96936d0aa365bdd5e95278ec9e3c369a.gif" alt="Elementos de cuadrícula"></p><br><h2 id="polzovatelskie-animacii-smahivaniya">  Animaciones de deslizamiento personalizadas </h2><br><p>  <code>ItemTouchHelper.Callback</code> proporciona una forma realmente conveniente de controlar completamente la animación mientras se arrastra o barre.  Dado que <code>ItemTouchHelper</code> es un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RecyclerView.ItemDecoration</a> , podemos intervenir en el proceso de renderizar un componente de <code>view</code> manera similar.  En la siguiente parte, examinaremos esta pregunta con más detalle, pero por ahora, veamos un ejemplo simple de anular la animación de deslizamiento predeterminada para mostrar una desaparición lineal. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChildDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Canvas c, RecyclerView recyclerView, ViewHolder viewHolder, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dY, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> actionState, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> isCurrentlyActive)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (actionState == ItemTouchHelper.ACTION_STATE_SWIPE) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> width = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) viewHolder.itemView.getWidth(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> alpha = <span class="hljs-number"><span class="hljs-number">1.0f</span></span> - Math.abs(dX) / width; viewHolder.itemView.setAlpha(alpha); viewHolder.itemView.setTranslationX(dX); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onChildDraw(c, recyclerView, viewHolder, dX, dY, actionState, isCurrentlyActive); } }</code> </pre> <br><p>  Los <code>dY</code> <code>dX</code> y <code>dY</code> son el cambio actual relativo al componente de <code>view</code> seleccionado, donde: </p><br><ul><li>  <strong>-1.0f</strong> es un deslizamiento completo de derecha a izquierda (de <code>ItemTouchHelper.END</code> a <code>ItemTouchHelper.START</code> ) </li><li>  <strong>1.0f</strong> se desliza por completo de izquierda a derecha (desde <code>ItemTouchHelper.START</code> a <code>ItemTouchHelper.END</code> ) </li></ul><br><p>  Es importante llamar a <code>super</code> para cualquier <code>actionState</code> que no esté procesando para activar la animación predeterminada. </p><br><p>  En la siguiente parte, consideraremos un ejemplo en el que controlaremos el dibujo de un elemento en el momento de arrastrar y soltar. </p><br><h2 id="zaklyuchenie">  Conclusión </h2><br><p>  De hecho, configurar ItemTouchHelper es bastante divertido.  Para no aumentar el volumen de este artículo, lo dividí en varios. </p><br><h2 id="ishodnyy-kod">  Código fuente </h2><br><p>  Consulte el código <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">completo</a> de esta serie de artículos en los repositorios de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Android-ItemTouchHelper-Demo</a> GitHub.  Este artículo cubre las confirmaciones de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ef8f149</a> a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">d164fba</a> . </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">← Arrastra y desliza en RecyclerView.</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Parte 1: ItemTouchHelper</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es428419/">https://habr.com/ru/post/es428419/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es428409/index.html">21 de octubre análisis de incidentes en github</a></li>
<li><a href="../es428411/index.html">Radar tecnológico: lista de idiomas, herramientas y plataformas que pasaron por Lamoda</a></li>
<li><a href="../es428413/index.html">Sistemas de enfriamiento en centros de datos Selectel</a></li>
<li><a href="../es428415/index.html">Descripción general del controlador de nube TP-Link Omada OC200</a></li>
<li><a href="../es428417/index.html">Aprendizaje automático en MatLab / Octave: ejemplos de algoritmos admitidos por fórmulas</a></li>
<li><a href="../es428421/index.html">Sistema flexible para probar y recopilar métricas de programas utilizando el conjunto de pruebas LLVM como ejemplo</a></li>
<li><a href="../es428423/index.html">Cómo un acuerdo de $ 34 mil millones entre IBM y Red Hat cambiará el mercado de TI: expertos y analistas</a></li>
<li><a href="../es428429/index.html">GOST R 34.10 firma electrónica de documentos PDF en la suite ofimática LibreOffice</a></li>
<li><a href="../es428431/index.html">Más que capas concéntricas</a></li>
<li><a href="../es428433/index.html">Abogados de pruebas privadas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>