<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘‚ğŸ¾ â˜®ï¸ ğŸ¤´ğŸ½ éƒ¨ç½²CEPHåˆ†å¸ƒå¼å­˜å‚¨å¹¶å°†å…¶è¿æ¥åˆ°Kubernetes ğŸ“‘ â˜ƒï¸ ğŸ´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬1éƒ¨åˆ†æˆ‘ä»¬éƒ¨ç½²ç”¨äºå¾®æœåŠ¡çš„ç¯å¢ƒã€‚ ç¬¬1éƒ¨åˆ†åœ¨è£¸æœºä¸Šå®‰è£…Kubernetes HAï¼ˆDebianï¼‰ 
 å“ˆï¼Œäº²çˆ±çš„è¯»è€…ï¼Œæ‚¨å¥½ï¼ 


 åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è®¨è®ºäº†å¦‚ä½•éƒ¨ç½²Kubernetesæ•…éšœè½¬ç§»ç¾¤é›†ã€‚ ä½†æ˜¯äº‹å®æ˜¯ï¼Œåœ¨Kubernetesä¸­ï¼Œéƒ¨ç½²ä¸éœ€è¦ç»´æŠ¤çŠ¶æ€æˆ–ä½¿ç”¨æ•°æ®çš„æ— çŠ¶æ€åº”ç”¨ç¨‹åºå¾ˆæ–¹ä¾¿ã€‚ ä½†æ˜¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>éƒ¨ç½²CEPHåˆ†å¸ƒå¼å­˜å‚¨å¹¶å°†å…¶è¿æ¥åˆ°Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465399/"><p><img src="https://habrastorage.org/webt/w-/ha/t9/w-hat9zskv2ab6vdpumzdxllw8w.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1éƒ¨åˆ†æˆ‘ä»¬éƒ¨ç½²ç”¨äºå¾®æœåŠ¡çš„ç¯å¢ƒã€‚</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç¬¬1éƒ¨åˆ†åœ¨è£¸æœºä¸Šå®‰è£…Kubernetes HAï¼ˆDebianï¼‰</a> </p><br><h2> å“ˆï¼Œäº²çˆ±çš„è¯»è€…ï¼Œæ‚¨å¥½ï¼ </h2><br><p> åœ¨ä¸Šä¸€ç¯‡<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡ç« ä¸­ï¼Œ</a>æˆ‘è®¨è®ºäº†å¦‚ä½•éƒ¨ç½²Kubernetesæ•…éšœè½¬ç§»ç¾¤é›†ã€‚ ä½†æ˜¯äº‹å®æ˜¯ï¼Œåœ¨Kubernetesä¸­ï¼Œéƒ¨ç½²ä¸éœ€è¦ç»´æŠ¤çŠ¶æ€æˆ–ä½¿ç”¨æ•°æ®çš„æ— çŠ¶æ€åº”ç”¨ç¨‹åºå¾ˆæ–¹ä¾¿ã€‚ ä½†æ˜¯åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜æ•°æ®ï¼Œå¹¶ä¸”åœ¨é‡æ–°å¯åŠ¨ç‚‰åºŠæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ <br>  Kuberneteså°†å·ç”¨äºè¿™äº›ç›®çš„ã€‚ å½“æˆ‘ä»¬ä½¿ç”¨Kubernetesäº‘è§£å†³æ–¹æ¡ˆæ—¶ï¼Œæ²¡æœ‰ç‰¹åˆ«çš„é—®é¢˜ã€‚ æˆ‘ä»¬åªéœ€è¦ä»Googleï¼ŒAmazonæˆ–å…¶ä»–äº‘æä¾›å•†è®¢è´­æ‰€éœ€çš„å·ï¼Œç„¶ååœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ–‡æ¡£çš„</a>æŒ‡å¯¼ä¸‹å°†æ”¶åˆ°çš„å·è¿æ¥åˆ°Podã€‚ <br> å½“æˆ‘ä»¬å¤„ç†è£¸æœºæ—¶ï¼Œäº‹æƒ…è¦å¤æ‚ä¸€äº›ã€‚ ä»Šå¤©ï¼Œæˆ‘æƒ³è°ˆè°ˆåŸºäºcephçš„ä½¿ç”¨çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ã€‚ </p><br><p> åœ¨æ­¤å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨ï¼š </p><br><ul><li> å¦‚ä½•éƒ¨ç½²Cephåˆ†å¸ƒå¼å­˜å‚¨ </li><li> ä½¿ç”¨Kubernetesæ—¶å¦‚ä½•ä½¿ç”¨Ceph <a name="habracut"></a></li></ul><br><h2> å¼•è¨€ </h2><br><p> é¦–å…ˆï¼Œæˆ‘æƒ³å‘æ‚¨è§£é‡Šè¿™ç¯‡æ–‡ç« å¯¹è°æœ‰ç”¨ã€‚ é¦–å…ˆï¼Œå¯¹äºé‚£äº›æ ¹æ®æˆ‘çš„ç¬¬ä¸€ä¸ªå‡ºç‰ˆç‰©éƒ¨ç½²äº†é›†ç¾¤ä»¥ç»§ç»­æ„å»ºå¾®æœåŠ¡æ¶æ„çš„è¯»è€…ã€‚ å…¶æ¬¡ï¼Œå¯¹äºé‚£äº›æƒ³è¦è‡ªå·±éƒ¨ç½²cephé›†ç¾¤å¹¶è¯„ä¼°å…¶æ€§èƒ½çš„äººã€‚ </p><br><p> åœ¨æœ¬å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘ä¸ä¼šé’ˆå¯¹ä»»ä½•éœ€æ±‚æ¥è®¨è®ºé›†ç¾¤è§„åˆ’çš„ä¸»é¢˜ï¼Œæˆ‘åªä¼šè°ˆè®ºä¸€èˆ¬çš„åŸç†å’Œæ¦‚å¿µã€‚ æˆ‘ä¸ä¼šæ·±å…¥ç ”ç©¶â€œè°ƒä¼˜â€å’Œæ·±åº¦è°ƒä¼˜ï¼Œæœ‰å…³æ­¤ä¸»é¢˜çš„å‡ºç‰ˆç‰©å¾ˆå¤šï¼ŒåŒ…æ‹¬å…³äºHabrçš„å‡ºç‰ˆç‰©ã€‚ æœ¬æ–‡å°†å…·æœ‰æ›´å¤šä»‹ç»æ€§ï¼Œä½†åŒæ—¶ï¼Œå®ƒè¿˜ä½¿æ‚¨èƒ½å¤Ÿè·å¾—å¯è¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œä»¥é€‚åº”å°†æ¥çš„éœ€æ±‚ã€‚ </p><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸»æœºï¼Œä¸»æœºèµ„æºï¼Œæ“ä½œç³»ç»Ÿå’Œè½¯ä»¶ç‰ˆæœ¬çš„åˆ—è¡¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Cephé›†ç¾¤ç»“æ„</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…å‰é…ç½®é›†ç¾¤èŠ‚ç‚¹</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…ceph-deploy</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»ºä¸€ä¸ªcephé›†ç¾¤</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç½‘ç»œè®¾ç½®</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®‰è£…cephè½¯ä»¶åŒ…</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç›‘è§†å™¨çš„å®‰è£…å’Œåˆå§‹åŒ–</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ·»åŠ OSD</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å°†Cephè¿æ¥åˆ°kubernetes</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»ºæ•°æ®æ± </a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»ºå®¢æˆ·æœºå¯†</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">éƒ¨ç½²ceph rbdä¾›åº”å•†</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ›å»ºä¸€ä¸ªå­˜å‚¨ç±»</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kubernetes + CephéŸ§å¸¦æµ‹è¯•</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç‰©å“å‡†å¤‡ä¸­ä½¿ç”¨çš„ææ–™æ¸…å•</a> </li></ol><br><a name="vm"></a><br><h2> ä¸»æœºåˆ—è¡¨å’Œç³»ç»Ÿè¦æ±‚ </h2><br><div class="scrollable-table"><table><tbody><tr><th>  <b>åç§°</b> </th><th>  <b>IPåœ°å€</b> </th><th>  <b>ç•™è¨€</b> </th></tr><tr><td>  ceph01æµ‹è¯• </td><td>  10.73.88.52 </td><td>  ceph-node01 </td></tr><tr><td>  ceph02æµ‹è¯• </td><td>  10.73.88.53 </td><td>  ceph-node02 </td></tr><tr><td>  ceph03æµ‹è¯• </td><td>  10.73.88.54 </td><td>  ceph-node03 </td></tr></tbody></table></div><br><p> åœ¨æ’°å†™æ–‡ç« æ—¶ï¼Œæˆ‘ä½¿ç”¨å…·æœ‰æ­¤é…ç½®çš„è™šæ‹Ÿæœº </p><br><p><img src="https://habrastorage.org/webt/kd/-z/bd/kd-zbdwb_76g1vvvgmtojoirseo.png"></p><br><p> æ¯ä¸ªéƒ½å®‰è£…äº†Debian 9.5æ“ä½œç³»ç»Ÿã€‚ è¿™äº›æ˜¯æµ‹è¯•æœºå™¨ï¼Œæ¯ä¸ªéƒ½æœ‰ä¸¤ä¸ªç£ç›˜ï¼Œç¬¬ä¸€ä¸ªç”¨äºOSï¼Œç¬¬äºŒä¸ªç”¨äºOSD cefã€‚ </p><br><p> æˆ‘å°†é€šè¿‡ceph-deployå®ç”¨ç¨‹åºéƒ¨ç½²é›†ç¾¤ã€‚ æ‚¨å¯ä»¥åœ¨æ‰‹åŠ¨æ¨¡å¼ä¸‹éƒ¨ç½²cephé›†ç¾¤ï¼Œæ‰€æœ‰æ­¥éª¤å‡åœ¨æ–‡æ¡£ä¸­è¿›è¡Œäº†æè¿°ï¼Œä½†æ˜¯æœ¬æ–‡çš„ç›®çš„æ˜¯å‘Šè¯‰æ‚¨å¯ä»¥å¤šå¿«éƒ¨ç½²cephå¹¶å¼€å§‹åœ¨kubernetesä¸­ä½¿ç”¨å®ƒã€‚ <br>  Cephçš„èµ„æºéå¸¸ç¹çï¼Œå°¤å…¶æ˜¯RAMã€‚ ä¸ºäº†è·å¾—è‰¯å¥½çš„é€Ÿåº¦ï¼Œå»ºè®®ä½¿ç”¨ssdé©±åŠ¨å™¨ã€‚ </p><br><p> æ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹cephæ–‡æ¡£ä¸­</a>é˜…è¯»æœ‰å…³è¦æ±‚çš„æ›´å¤šä¿¡æ¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><br></a> </p><br><a name="ceph"></a><br><h2>  Cephé›†ç¾¤ç»“æ„ </h2><br><p>  <strong>è’™</strong> <br>  <em>ç›‘è§†å™¨æ˜¯ä¸€ä¸ªå®ˆæŠ¤ç¨‹åºï¼Œå®ƒå……å½“åè°ƒç¨‹åºçš„å¼€å§‹ï¼Œç¾¤é›†ä»è¯¥å®ˆæŠ¤ç¨‹åºå¼€å§‹ã€‚</em>  <em>ä¸€æ—¦æˆ‘ä»¬è‡³å°‘æœ‰ä¸€ä¸ªå·¥ä½œç›‘è§†å™¨ï¼Œä¾¿æœ‰äº†ä¸€ä¸ªCephé›†ç¾¤ã€‚</em>  <em>ç›‘è§†å™¨é€šè¿‡ä¸å…¶ä»–ç›‘è§†å™¨äº¤æ¢å„ç§å¡æ¥å­˜å‚¨æœ‰å…³ç¾¤é›†çš„å¥åº·çŠ¶å†µçš„ä¿¡æ¯ã€‚</em>  <em>å®¢æˆ·ç«¯è½¬å‘ç›‘è§†å™¨ï¼Œä»¥äº†è§£å‘å“ªä¸ªOSDå†™å…¥/è¯»å–æ•°æ®ã€‚</em>  <em>éƒ¨ç½²æ–°å­˜å‚¨æ—¶ï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯åˆ›å»ºä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ç›‘è§†å™¨ã€‚</em>  <em>ç¾¤é›†å¯ä»¥é©»ç•™åœ¨ä¸€ä¸ªç›‘è§†å™¨ä¸Šï¼Œä½†æ˜¯å»ºè®®åˆ¶ä½œ3ä¸ªæˆ–5ä¸ªç›‘è§†å™¨ï¼Œä»¥é¿å…æ•´ä¸ªç³»ç»Ÿå› å•ä¸ªç›‘è§†å™¨çš„æ•…éšœè€ŒæŸåã€‚</em>  <em>æœ€ä¸»è¦çš„æ˜¯ï¼Œè¿™äº›æ•°ç›®åº”è¯¥æ˜¯å¥‡æ•°ï¼Œä»¥é¿å…å‡ºç°è£‚è„‘æƒ…å†µã€‚</em>  <em>ç›‘è§†å™¨æŒ‰æ³•å®šäººæ•°è¿è¡Œï¼Œå› æ­¤ï¼Œå¦‚æœè¶…è¿‡ä¸€åŠçš„ç›‘è§†å™¨æ‰è½ï¼Œåˆ™ä¼šé˜»å¡ç¾¤é›†ä»¥é˜²æ­¢æ•°æ®ä¸ä¸€è‡´ã€‚</em> <br>  <strong>ç»ç†</strong> <br>  <em>Ceph Managerå®ˆæŠ¤ç¨‹åºä¸Monitorå®ˆæŠ¤ç¨‹åºä¸€èµ·ä½¿ç”¨ä»¥æä¾›å…¶ä»–æ§åˆ¶ã€‚</em> <em><br></em>  <em>ä»12.xç‰ˆå¼€å§‹ï¼Œceph-mgrå®ˆæŠ¤ç¨‹åºå·²æˆä¸ºæ­£å¸¸æ“ä½œæ‰€å¿…éœ€çš„ã€‚</em> <em><br></em>  <em>å¦‚æœmgrå®ˆæŠ¤ç¨‹åºæœªåœ¨è¿è¡Œï¼Œæ‚¨å°†çœ‹åˆ°å…³äºæ­¤çš„è­¦å‘Šã€‚</em> <br>  <strong>OSDï¼ˆå¯¹è±¡å­˜å‚¨è®¾å¤‡ï¼‰</strong> <br>  <em>OSDæ˜¯ä¸€ä¸ªå­˜å‚¨å•å…ƒï¼Œç”¨äºå­˜å‚¨æ•°æ®æœ¬èº«å¹¶é€šè¿‡ä¸å…¶ä»–OSDäº¤æ¢æ•°æ®æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ã€‚</em>  <em>é€šå¸¸æ˜¯ç£ç›˜ã€‚</em>  <em>é€šå¸¸ï¼Œå¯¹äºæ¯ä¸ªOSDï¼Œéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„OSDå®ˆæŠ¤ç¨‹åºï¼Œè¯¥å®ˆæŠ¤ç¨‹åºå¯ä»¥åœ¨å®‰è£…äº†è¯¥ç£ç›˜çš„ä»»ä½•è®¡ç®—æœºä¸Šè¿è¡Œã€‚</em> </p><br><p> æ‰€æœ‰è¿™ä¸‰ä¸ªå®ˆæŠ¤ç¨‹åºéƒ½å°†åœ¨é›†ç¾¤ä¸­çš„æ¯å°æœºå™¨ä¸Šè¿è¡Œã€‚ å› æ­¤ï¼Œå°†ç›‘è§†å’Œç®¡ç†å™¨å®ˆæŠ¤ç¨‹åºä½œä¸ºæœåŠ¡ï¼Œå°†OSDå®ˆæŠ¤ç¨‹åºä½œä¸ºæˆ‘ä»¬è™šæ‹Ÿæœºçš„ä¸€ä¸ªé©±åŠ¨å™¨ã€‚ </p><br><a name="before"></a><br><h2> å®‰è£…å‰é…ç½®é›†ç¾¤èŠ‚ç‚¹ </h2><br><p>  cephæ–‡æ¡£æŒ‡å®šä»¥ä¸‹å·¥ä½œæµç¨‹ï¼š </p><br><p><img src="https://habrastorage.org/webt/wz/9i/gu/wz9igu71hiezyom4zvtbxp6ye30.png"></p><br><p> æˆ‘å°†ä»ceph01-testç¾¤é›†çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å¼€å§‹å·¥ä½œï¼Œå®ƒå°†æ˜¯Admin Nodeï¼Œå®ƒè¿˜å°†åŒ…å«ceph-deployå®ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶ã€‚ ä¸ºäº†ä½¿ceph-deployå®ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œï¼Œå¿…é¡»ä½¿ç”¨AdminèŠ‚ç‚¹é€šè¿‡sshè®¿é—®æ‰€æœ‰ç¾¤é›†èŠ‚ç‚¹ã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†åœ¨ä¸»æœºä¸­å†™å‡ºé›†ç¾¤çš„ç®€ç§° </p><br><pre><code class="plaintext hljs">10.73.88.52 ceph01-test 10.73.88.53 ceph02-test 10.73.88.54 ceph03-tset</code> </pre> <br><p> å¹¶å°†å¯†é’¥å¤åˆ¶åˆ°å…¶ä»–ä¸»æœºã€‚ æˆ‘å°†ä»rootæ‰§è¡Œçš„æ‰€æœ‰å‘½ä»¤ã€‚ </p><br><pre> <code class="plaintext hljs">ssh-copy-id ceph02-test ssh-copy-id ceph03-test</code> </pre> <br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è®¾å®šæ–‡ä»¶</a> </p><br><anchor> å¤´é¢…éƒ¨ç½² </anchor><br><h2> å®‰è£…ceph-deploy </h2><br><p> ç¬¬ä¸€æ­¥æ˜¯åœ¨ceph01-testæœºå™¨ä¸Šå®‰è£…ceph-deploy </p><br><pre> <code class="plaintext hljs">wget -q -O- 'https://download.ceph.com/keys/release.asc' | apt-key add -</code> </pre> <br><p> æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦é€‰æ‹©è¦å‘å¸ƒçš„ç‰ˆæœ¬ã€‚ ä½†æ˜¯è¿™é‡Œæœ‰å›°éš¾ï¼Œç›®å‰ç”¨äºDebian OSçš„cephä»…æ”¯æŒå‘å…‰è½¯ä»¶åŒ…ã€‚ <br> å¦‚æœè¦å‘å¸ƒæ›´æ–°çš„ç‰ˆæœ¬ï¼Œåˆ™å¿…é¡»ä½¿ç”¨é•œåƒï¼Œä¾‹å¦‚ <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://mirror.croit.io/debian-mimic/dists/</a> </p><br><p> åœ¨æ‰€æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šæ·»åŠ å…·æœ‰æ¨¡æ‹Ÿå†…å®¹çš„å­˜å‚¨åº“ </p><br><pre> <code class="plaintext hljs">apt install curl apt-transport-https -y curl https://mirror.croit.io/keys/release.gpg &gt; /usr/share/keyrings/croit-signing-key.gpg echo 'deb [signed-by=/usr/share/keyrings/croit-signing-key.gpg] https://mirror.croit.io/debian-mimic/ stretch main' &gt; /etc/apt/sources.list.d/croit-ceph.list apt update apt install ceph-deploy</code> </pre> <br><p> å¦‚æœå‘å…‰è¶³ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨å®˜æ–¹å­˜å‚¨åº“ </p><br><pre> <code class="plaintext hljs">echo deb https://download.ceph.com/debian-luminous/ $(lsb_release -sc) main | tee /etc/apt/sources.list.d/ceph.list apt-transport-https apt update apt install ceph-deploy</code> </pre> <br><p> æˆ‘ä»¬è¿˜å°†åœ¨æ‰€æœ‰ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£…NTPã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">å› ä¸ºæ­¤å»ºè®®åœ¨cephæ–‡æ¡£ä¸­</b> <div class="spoiler_text"><p> æˆ‘ä»¬å»ºè®®åœ¨CephèŠ‚ç‚¹ä¸Šï¼ˆå°¤å…¶æ˜¯åœ¨Ceph MonitorèŠ‚ç‚¹ä¸Šï¼‰å®‰è£…NTPï¼Œä»¥é˜²æ­¢æ—¶é’Ÿæ¼‚ç§»å¼•èµ·é—®é¢˜ã€‚ <br></p></div></div><br><pre> <code class="plaintext hljs">apt install ntp</code> </pre> <br><p> ç¡®ä¿å¯ç”¨NTPæœåŠ¡ã€‚ ç¡®ä¿æ¯ä¸ªCephèŠ‚ç‚¹ä½¿ç”¨ç›¸åŒçš„NTPæœåŠ¡å™¨ã€‚ æ‚¨å¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨æ­¤å¤„</a>æŸ¥çœ‹æ›´å¤šè¯¦ç»†ä¿¡æ¯ </p><br><a name="ceph-install"></a><br><h2> åˆ›å»ºä¸€ä¸ªcephé›†ç¾¤ </h2><br><p> ä¸ºé…ç½®æ–‡ä»¶å’Œceph-deployæ–‡ä»¶åˆ›å»ºç›®å½• </p><br><pre> <code class="plaintext hljs">mkdir my-cluster cd my-cluster</code> </pre> <br><p> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„é›†ç¾¤é…ç½®ï¼Œåœ¨åˆ›å»ºæ—¶ï¼ŒæŒ‡ç¤ºé›†ç¾¤ä¸­å°†æœ‰ä¸‰ä¸ªç›‘è§†å™¨ </p><br><pre> <code class="plaintext hljs">ceph-deploy new ceph01-test ceph02-test ceph03-test</code> </pre> <br><a name="ceph-network"></a><br><h2> ç½‘ç»œè®¾ç½® </h2><br><p> ç°åœ¨é‡è¦çš„æ˜¯ï¼Œè¯¥è°ˆè®ºcephçš„ç½‘ç»œäº†ã€‚  Cephä½¿ç”¨ä¸¤ä¸ªå…¬å…±ç½‘ç»œå’Œä¸€ä¸ªç¾¤é›†ç½‘ç»œæ¥å·¥ä½œ <br><img src="https://habrastorage.org/webt/jz/dp/wz/jzdpwzxrzpdqr7k9v4u53hmc05s.png"></p><br><p> ä»å…¬å…±ç½‘ç»œå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ˜¯ç”¨æˆ·å’Œåº”ç”¨ç¨‹åºçº§åˆ«ï¼Œè€Œç¾¤é›†ç½‘ç»œæ˜¯é€šè¿‡å…¶å¤åˆ¶æ•°æ®çš„ç½‘ç»œã€‚ <br> éå¸¸éœ€è¦å°†è¿™ä¸¤ä¸ªç½‘ç»œå½¼æ­¤åˆ†å¼€ã€‚ åŒæ ·ï¼Œç½‘ç»œé€Ÿåº¦ç¾¤é›†ç½‘ç»œè‡³å°‘éœ€è¦10 Gbã€‚ <br> å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°†æ‰€æœ‰å†…å®¹ä¿ç•™åœ¨åŒä¸€ç½‘ç»œä¸Šã€‚ ä½†æ˜¯ï¼Œè¿™å……æ»¡äº†è¿™æ ·çš„äº‹å®ï¼šä¸€æ—¦OSDä¹‹é—´çš„å¤åˆ¶é‡å¢åŠ ï¼Œä¾‹å¦‚ï¼Œå½“æ–°çš„OSDï¼ˆç£ç›˜ï¼‰ä¸‹é™æˆ–æ·»åŠ æ—¶ï¼Œç½‘ç»œè´Ÿè½½å°±ä¼šéå¸¸å¤§ã€‚ å› æ­¤ï¼ŒåŸºç¡€æ¶æ„çš„é€Ÿåº¦å’Œç¨³å®šæ€§å°†åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºcephä½¿ç”¨çš„ç½‘ç»œã€‚ <br> ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘çš„è™šæ‹ŸåŒ–ç¾¤é›†æ²¡æœ‰å•ç‹¬çš„ç½‘ç»œï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªå…¬å…±çš„ç½‘æ®µã€‚ <br> é›†ç¾¤çš„ç½‘ç»œé…ç½®æ˜¯é€šè¿‡é…ç½®æ–‡ä»¶å®Œæˆçš„ï¼Œè¯¥æ–‡ä»¶æ˜¯æˆ‘ä»¬ä½¿ç”¨ä¸Šä¸€ä¸ªå‘½ä»¤ç”Ÿæˆçš„ã€‚ </p><br><pre> <code class="plaintext hljs">/my-cluster# cat ceph.conf [global] fsid = 2e0d92b0-e803-475e-9060-0871b63b6e7f mon_initial_members = ceph01-test, ceph02-test, ceph03-test mon_host = 10.73.88.52,10.73.88.53,10.73.88.54 auth_cluster_required = cephx auth_service_required = cephx auth_client_required = cephx</code> </pre> <br><p> å¦‚æˆ‘ä»¬æ‰€è§ï¼Œceféƒ¨ç½²æ²¡æœ‰ä¸ºæˆ‘ä»¬åˆ›å»ºé»˜è®¤çš„ç½‘ç»œè®¾ç½®ï¼Œå› æ­¤æˆ‘å°†public network = {public-network / netmask}å‚æ•°æ·»åŠ åˆ°é…ç½®çš„globaléƒ¨åˆ†ã€‚ æˆ‘çš„ç½‘ç»œæ˜¯10.73.0.0/16ï¼Œæ‰€ä»¥æ·»åŠ æˆ‘çš„é…ç½®åå°†å¦‚ä¸‹æ‰€ç¤º </p><br><pre> <code class="plaintext hljs">[global] fsid = 2e0d92b0-e803-475e-9060-0871b63b6e7f mon_initial_members = ceph01-test, ceph02-test, ceph03-test mon_host = 10.73.88.52,10.73.88.53,10.73.88.54 public network = 10.73.0.0/16 auth_cluster_required = cephx auth_service_required = cephx auth_client_required = cephx</code> </pre> <br><p> å¦‚æœè¦å°†ç¾¤é›†ç½‘ç»œä¸å…¬å…±ç½‘ç»œåˆ†å¼€ï¼Œè¯·æ·»åŠ å‚æ•°cluster network = {cluster-network / netmask} <br> æ‚¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¯ä»¥åœ¨æ–‡æ¡£ä¸­é˜…è¯»</a>æœ‰å…³ç½‘ç»œçš„æ›´å¤šä¿¡æ¯<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ã€‚</a> </p><br><a name="ceph-pack"></a><br><h2> å®‰è£…cephè½¯ä»¶åŒ… </h2><br><p> ä½¿ç”¨ceph-deployï¼Œæˆ‘ä»¬åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£…äº†æ‰€éœ€çš„æ‰€æœ‰cephè½¯ä»¶åŒ…ã€‚ <br> ä¸ºæ­¤ï¼Œè¯·åœ¨ceph01-testä¸Šæ‰§è¡Œ <br> å¦‚æœç‰ˆæœ¬æ˜¯æ¨¡ä»¿çš„ </p><br><pre> <code class="plaintext hljs">ceph-deploy install --release mimic ceph01-test ceph02-test ceph03-test</code> </pre> <br><p> å¦‚æœç‰ˆæœ¬å‘å…‰ </p><br><pre> <code class="plaintext hljs">ceph-deploy install --release luminous ceph01-test ceph02-test ceph03-test</code> </pre> <br><p> ç­‰åˆ°ä¸€åˆ‡éƒ½å»ºç«‹å¥½ã€‚ </p><br><a name="ceph-mon"></a><br><h2> ç›‘è§†å™¨çš„å®‰è£…å’Œåˆå§‹åŒ– </h2><br><p> å®‰è£…å®Œæ‰€æœ‰è½¯ä»¶åŒ…åï¼Œæˆ‘ä»¬å°†åˆ›å»ºå¹¶å¯åŠ¨é›†ç¾¤çš„ç›‘è§†å™¨ã€‚ <br>  C ceph01-testæ‰§è¡Œä»¥ä¸‹æ“ä½œ </p><br><pre> <code class="plaintext hljs">ceph-deploy mon create-initial</code> </pre> <br><p> åœ¨æ­¤è¿‡ç¨‹ä¸­å°†åˆ›å»ºç›‘è§†å™¨ï¼Œå°†å¯åŠ¨å®ˆæŠ¤ç¨‹åºï¼Œè€Œceph-deployå°†æ£€æŸ¥ä»²è£ã€‚ <br> ç°åœ¨ï¼Œå°†é…ç½®åˆ†æ•£åœ¨ç¾¤é›†èŠ‚ç‚¹ä¸Šã€‚ </p><br><pre> <code class="plaintext hljs">ceph-deploy admin ceph01-test ceph02-test ceph03-test</code> </pre> <br><p> å¹¶æ£€æŸ¥æˆ‘ä»¬é›†ç¾¤çš„çŠ¶æ€ï¼Œå¦‚æœæ‚¨æ­£ç¡®æ‰§è¡Œäº†æ‰€æœ‰æ“ä½œï¼Œåˆ™è¯¥çŠ¶æ€åº”ä¸º <br>  HEALTH_OK </p><br><pre> <code class="plaintext hljs">~/my-cluster# ceph status cluster: id: 2e0d92b0-e803-475e-9060-0871b63b6e7f health: HEALTH_OK services: mon: 3 daemons, quorum ceph01-test,ceph02-test,ceph03-test mgr: no daemons active osd: 0 osds: 0 up, 0 in data: pools: 0 pools, 0 pgs objects: 0 objects, 0 B usage: 0 B used, 0 B / 0 B avail pgs:</code> </pre> <br><p> åˆ›å»ºmgr </p><br><pre> <code class="plaintext hljs">ceph-deploy mgr create ceph01-test ceph02-test ceph03-test</code> </pre> <br><p> å¹¶å†æ¬¡æ£€æŸ¥çŠ¶æ€ </p><br><pre> <code class="plaintext hljs">ceph -s</code> </pre> <br><p> åº”è¯¥å‡ºç°ä¸€è¡Œ </p><br><pre> <code class="plaintext hljs">mgr: ceph01-test(active), standbys: ceph02-test, ceph03-test</code> </pre> <br><p> æˆ‘ä»¬å°†é…ç½®å†™å…¥é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»æœº </p><br><pre> <code class="plaintext hljs">ceph-deploy admin ceph01-test ceph02-test ceph03-test</code> </pre> <br><a name="ceph-osd"></a><br><h2> æ·»åŠ OSD </h2><br><p> ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„é›†ç¾¤ï¼Œä½†æ˜¯å®ƒè¿˜æ²¡æœ‰ç”¨äºå­˜å‚¨ä¿¡æ¯çš„ç£ç›˜ï¼ˆåœ¨cephæœ¯è¯­ä¸­ä¸ºosdï¼‰ã€‚ </p><br><p> å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ OSDï¼ˆä¸€èˆ¬è§†å›¾ï¼‰ </p><br><pre> <code class="plaintext hljs">ceph-deploy osd create --data {device} {ceph-node}</code> </pre> <br><p> åœ¨æˆ‘çš„æµ‹è¯•å¹³å°ä¸Šï¼Œdisk / dev / sdbåˆ†é…åœ¨osdä¸‹ï¼Œå› æ­¤åœ¨æˆ‘çš„æƒ…å†µä¸‹ï¼Œå‘½ä»¤å¦‚ä¸‹ </p><br><pre> <code class="plaintext hljs">ceph-deploy osd create --data /dev/sdb ceph01-test ceph-deploy osd create --data /dev/sdb ceph02-test ceph-deploy osd create --data /dev/sdb ceph03-test</code> </pre> <br><p> æ£€æŸ¥æ‰€æœ‰OSDæ˜¯å¦éƒ½åœ¨å·¥ä½œã€‚ </p><br><pre> <code class="plaintext hljs">ceph -s</code> </pre> <br><p> ç»“è®º </p><br><pre> <code class="plaintext hljs"> cluster: id: 2e0d92b0-e803-475e-9060-0871b63b6e7f health: HEALTH_OK services: mon: 3 daemons, quorum ceph01-test,ceph02-test,ceph03-test mgr: ceph01-test(active) osd: 3 osds: 3 up, 3 in</code> </pre> <br><p> æ‚¨ä¹Ÿå¯ä»¥å°è¯•ä¸€äº›æœ‰ç”¨çš„OSDå‘½ä»¤ã€‚ </p><br><pre> <code class="plaintext hljs">ceph osd df ID CLASS WEIGHT REWEIGHT SIZE USE AVAIL %USE VAR PGS 0 hdd 0.00490 1.00000 5.0 GiB 1.0 GiB 4.0 GiB 20.05 1.00 0 1 hdd 0.00490 1.00000 5.0 GiB 1.0 GiB 4.0 GiB 20.05 1.00 0 2 hdd 0.00490 1.00000 5.0 GiB 1.0 GiB 4.0 GiB 20.05 1.00 0 TOTAL 15 GiB 3.0 GiB 12 GiB 20.05</code> </pre> <br><p> å’Œ </p><br><pre> <code class="plaintext hljs">ceph osd tree ID CLASS WEIGHT TYPE NAME STATUS REWEIGHT PRI-AFF -1 0.01469 root default -3 0.00490 host ceph01-test 0 hdd 0.00490 osd.0 up 1.00000 1.00000 -5 0.00490 host ceph02-test 1 hdd 0.00490 osd.1 up 1.00000 1.00000 -7 0.00490 host ceph03-test 2 hdd 0.00490 osd.2 up 1.00000 1.00000</code> </pre><br><p> å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ‰ä¸€ä¸ªæ­£å¸¸å·¥ä½œçš„cephé›†ç¾¤ã€‚ åœ¨ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•åœ¨kubernetesä¸­ä½¿ç”¨ceph </p><br><a name="kubernetes"></a><br><h1> å°†Cephè¿æ¥åˆ°kubernetes </h1><br><p> ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘å°†æ— æ³•åœ¨æœ¬æ–‡ä¸­è¯¦ç»†æè¿°Kuberneteså·çš„æ“ä½œï¼Œå› æ­¤ï¼Œæˆ‘å°†å°è¯•å°†å…¶æ”¾åœ¨ä¸€ä¸ªæ®µè½ä¸­ã€‚ <br>  Kubernetesä½¿ç”¨å­˜å‚¨ç±»æ¥å¤„ç†æ•°æ®çš„æ•°æ®é‡ï¼Œæ¯ä¸ªå­˜å‚¨ç±»éƒ½æœ‰è‡ªå·±çš„é…ç½®ç¨‹åºï¼Œæ‚¨å¯ä»¥å°†å…¶è§†ä¸ºå¤„ç†ä¸åŒæ•°æ®å­˜å‚¨é‡çš„ä¸€ç§â€œé©±åŠ¨ç¨‹åºâ€ã€‚ æ”¯æŒkubernetesçš„å®Œæ•´åˆ—è¡¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹æ–‡æ¡£ä¸­</a>æ‰¾åˆ°ã€‚ <br>  Kubernetesæœ¬èº«ä¹Ÿæ”¯æŒä½¿ç”¨rbdï¼Œä½†æ˜¯å®˜æ–¹çš„kube-controller-manageræ˜ åƒæœªå®‰è£…rbdå®¢æˆ·ç«¯ï¼Œå› æ­¤æ‚¨éœ€è¦ä½¿ç”¨å…¶ä»–æ˜ åƒã€‚ <br> è¿˜åº”æ³¨æ„ï¼Œä»¥rbdåˆ›å»ºçš„å·ï¼ˆpvcï¼‰åªèƒ½æ˜¯ReadWriteOnceï¼ˆRWOï¼‰ï¼Œè¿™æ„å‘³ç€æ‚¨åªèƒ½å°†åˆ›å»ºçš„å·æŒ‚è½½åˆ°ä¸€ä¸ªç‚‰åºŠä¸Šã€‚ </p><br><p> ä¸ºäº†ä½¿æˆ‘ä»¬çš„é›†ç¾¤èƒ½å¤Ÿä½¿ç”¨cephå·ï¼Œæˆ‘ä»¬éœ€è¦ï¼š <br> åœ¨Cephé›†ç¾¤ä¸­ï¼š </p><br><ul><li> åœ¨cephé›†ç¾¤ä¸­åˆ›å»ºæ•°æ®æ±  </li><li> åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯å¹¶è®¿é—®æ•°æ®æ± çš„å¯†é’¥ </li><li> è·å–cephç®¡ç†å‘˜æœºå¯† </li></ul><br><p> ä¸ºäº†ä½¿æˆ‘ä»¬çš„é›†ç¾¤èƒ½å¤Ÿä½¿ç”¨cephå·ï¼Œæˆ‘ä»¬éœ€è¦ï¼š <br> åœ¨Cephé›†ç¾¤ä¸­ï¼š </p><br><ul><li> åœ¨cephé›†ç¾¤ä¸­åˆ›å»ºæ•°æ®æ±  </li><li> åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯å¹¶è®¿é—®æ•°æ®æ± çš„å¯†é’¥ </li><li> è·å–cephç®¡ç†å‘˜æœºå¯† </li></ul><br><p> åœ¨Kubernetesé›†ç¾¤ä¸­ï¼š </p><br><ul><li> åˆ›å»ºcephç®¡ç†å‘˜å¯†ç å’Œcephå®¢æˆ·ç«¯å¯†é’¥ </li><li> å®‰è£…ceph rbdæä¾›ç¨‹åºæˆ–å°†kube-controller-manageræ˜ åƒæ›´æ”¹ä¸ºæ”¯æŒrbdçš„æ˜ åƒ </li><li> ä½¿ç”¨Cephå®¢æˆ·ç«¯å¯†é’¥åˆ›å»ºç§˜å¯† </li><li> åˆ›å»ºå­˜å‚¨ç±» </li><li> åœ¨kuberneteså·¥äººç¬”è®°ä¸Šå®‰è£…ceph-common </li></ul><br><a name="ceph-pool"></a><br><h2> åˆ›å»ºæ•°æ®æ±  </h2><br><p> åœ¨cephé›†ç¾¤ä¸­ï¼Œä¸ºkuberneteså·åˆ›å»ºä¸€ä¸ªæ±  </p><br><pre> <code class="plaintext hljs">ceph osd pool create kube 8 8</code> </pre> <br><p> åœ¨è¿™é‡Œï¼Œæˆ‘å°†åšä¸€ä¸ªå°å°çš„è§£é‡Šï¼Œæœ€åçš„æ•°å­—8 8æ˜¯pgå’Œpgsçš„æ•°å­—ã€‚ è¿™äº›å€¼å–å†³äºcephé›†ç¾¤çš„å¤§å°ã€‚ æœ‰ä¸€äº›ç‰¹æ®Šçš„è®¡ç®—å™¨å¯ä»¥è®¡ç®—pgå’Œpgçš„æ•°é‡ï¼Œä¾‹å¦‚<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">cephçš„</a>å®˜æ–¹æ•°æ® <br> é¦–å…ˆï¼Œæˆ‘å»ºè®®é»˜è®¤æƒ…å†µä¸‹ä¿ç•™å®ƒï¼Œå¦‚æœå°†æ¥å¯ä»¥å¢åŠ æ­¤æ•°é‡ï¼ˆåªèƒ½ä»Nautilusç‰ˆæœ¬ä¸­å‡å°‘ï¼‰ã€‚ </p><br><a name="ceph-key"></a><br><h2> ä¸ºæ•°æ®æ± åˆ›å»ºå®¢æˆ·ç«¯ </h2><br><p> ä¸ºæ–°æ± åˆ›å»ºä¸€ä¸ªå®¢æˆ·ç«¯ </p><br><pre> <code class="plaintext hljs">ceph auth add client.kube mon 'allow r' osd 'allow rwx pool=kube'</code> </pre> <br><p> æˆ‘ä»¬å°†ä¸ºå®¢æˆ·æä¾›ä¸€ä¸ªå¯†é’¥ï¼Œå°†æ¥æˆ‘ä»¬å°†éœ€è¦å®ƒæ¥åˆ›å»ºä¸€ä¸ªç§˜å¯†çš„kubernetesã€‚ </p><br><pre> <code class="plaintext hljs">ceph auth get-key client.kube AQDd5aldka5KJRAAkpWTQYUMQi+5dfGDqSyxkg==</code> </pre> <br><h2> è·å–ç®¡ç†å‘˜å¯†é’¥ </h2><br><p> å¹¶è·å¾—ç®¡ç†å‘˜å¯†é’¥ </p><br><pre> <code class="plaintext hljs">ceph auth get client.admin 2&gt;&amp;1 |grep "key = " |awk '{print $3'} AQAv+Itdx4DwKBAAKVhWRS3+eEPqV3Xrnlg9KA==</code> </pre> <br><p>  <strong>åœ¨cephé›†ç¾¤ä¸Šï¼Œæ‰€æœ‰å·¥ä½œéƒ½å·²å®Œæˆï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å»ä¸€å°å¯ä»¥è®¿é—®kubernetesé›†ç¾¤çš„æœºå™¨</strong> <br> æˆ‘å°†åœ¨ç¬¬ä¸€ç¯‡å‡ºç‰ˆç‰©ä¸­ä½¿ç”¨æˆ‘éƒ¨ç½²çš„é›†ç¾¤çš„master01-testï¼ˆ10.73.71.25ï¼‰ã€‚ </p><br><a name="kubernetes-secrets"></a><br><h2> åˆ›å»ºå®¢æˆ·æœºå¯† </h2><br><p> ä½¿ç”¨æˆ‘ä»¬æ”¶åˆ°çš„å®¢æˆ·ä»¤ç‰Œåˆ›å»ºæ–‡ä»¶ï¼ˆä¸è¦å¿˜è®°ç”¨æ‚¨çš„ä»¤ç‰Œæ›¿æ¢å®ƒï¼‰ </p><br><pre> <code class="plaintext hljs">echo AQDd5aldka5KJRAAkpWTQYUMQi+5dfGDqSyxkg== &gt; /tmp/key.client</code> </pre> <br><p> å¹¶åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬å°†æ¥ä½¿ç”¨çš„ç§˜å¯† </p><br><pre> <code class="plaintext hljs">kubectl create secret generic ceph-secret --from-file=/tmp/key.client --namespace=kube-system --type=kubernetes.io/rbd</code> </pre> <br><h2> åˆ›å»ºç®¡ç†å‘˜æœºå¯† </h2><br><p> ä½¿ç”¨ç®¡ç†å‘˜ä»¤ç‰Œåˆ›å»ºæ–‡ä»¶ï¼ˆä¸è¦å¿˜è®°å°†å…¶æ›¿æ¢ä¸ºä»¤ç‰Œï¼‰ </p><br><pre> <code class="plaintext hljs">echo AQAv+Itdx4DwKBAAKVhWRS3+eEPqV3Xrnlg9KA== &gt; /tmp/key.admin</code> </pre> <br><p> ä¹‹åï¼Œåˆ›å»ºç®¡ç†å‘˜å¯†ç  </p><br><pre> <code class="plaintext hljs">kubectl create secret generic ceph-admin-secret --from-file=/tmp/key.admin --namespace=kube-system --type=kubernetes.io/rbd</code> </pre> <br><p> æ£€æŸ¥æœºå¯†æ˜¯å¦å·²åˆ›å»º </p><br><pre> <code class="plaintext hljs">kubectl get secret -n kube-system | grep ceph ceph-admin-secret kubernetes.io/rbd 1 8m31s ceph-secret kubernetes.io/rbd 1 7m32s</code> </pre> <br><a name="kubernetes-provisioner"></a><br><h2> æ–¹æ³•é¦–å…ˆéƒ¨ç½²ceph rbd Provisioner </h2><br><p> æˆ‘ä»¬ä»githubå…‹éš†äº†kubernetes-incubator / external-storageå­˜å‚¨åº“ï¼Œå®ƒæ‹¥æœ‰ä¸cephå­˜å‚¨åº“æˆä¸ºkubernetesé›†ç¾¤å¥½å‹æ‰€éœ€çš„ä¸€åˆ‡ã€‚ </p><br><pre> <code class="plaintext hljs">git clone https://github.com/kubernetes-incubator/external-storage.git cd external-storage/ceph/rbd/deploy/ NAMESPACE=kube-system sed -r -i "s/namespace: [^ ]+/namespace: $NAMESPACE/g" ./rbac/clusterrolebinding.yaml ./rbac/rolebinding.yaml</code> </pre> <br><pre> <code class="plaintext hljs">kubectl -n $NAMESPACE apply -f ./rbac</code> </pre> <br><p> ç»“è®º </p><br><pre> <code class="plaintext hljs">clusterrole.rbac.authorization.k8s.io/rbd-provisioner created clusterrolebinding.rbac.authorization.k8s.io/rbd-provisioner created deployment.extensions/rbd-provisioner created role.rbac.authorization.k8s.io/rbd-provisioner created rolebinding.rbac.authorization.k8s.io/rbd-provisioner created serviceaccount/rbd-provisioner created</code> </pre> <br><h2> æ–¹æ³•äºŒï¼šæ›¿æ¢kube-controller-manageræ˜ åƒ </h2><br><p> å®˜æ–¹çš„kube-controller-manageræ˜ åƒä¸­æ²¡æœ‰rbdæ”¯æŒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ›´æ”¹controller-manageræ˜ åƒã€‚ <br> ä¸ºæ­¤ï¼Œåœ¨æ¯ä¸ªKuberneteså‘å¯¼ä¸Šï¼Œæ‚¨éœ€è¦ç¼–è¾‘kube-controller-manager.yamlæ–‡ä»¶ï¼Œå¹¶å°†å›¾åƒæ›¿æ¢ä¸ºgcr.io/google_containers/hyperkube:v1.15.2ã€‚ è¯·æ³¨æ„ä¸æ‚¨çš„Kubernetesé›†ç¾¤ç‰ˆæœ¬åŒ¹é…çš„æ˜ åƒç‰ˆæœ¬ã€‚ </p><br><pre> <code class="plaintext hljs">vim /etc/kubernetes/manifests/kube-controller-manager.yaml</code> </pre> <br><p> ä¹‹åï¼Œæ‚¨å°†éœ€è¦é‡æ–°å¯åŠ¨kube-controller-manager </p><br><pre> <code class="plaintext hljs">ubectl get pods -A | grep manager kube-system kube-controller-manager-master01-test 1/1 Running 0 5m54s kube-system kube-controller-manager-master02-test 1/1 Running 0 5m54s kube-system kube-controller-manager-master03-test 1/1 Running 9111 103d</code> </pre> <br><p>  Podåº”è¯¥è‡ªåŠ¨æ›´æ–°ï¼Œä½†æ˜¯å¦‚æœç”±äºæŸç§åŸå› æ²¡æœ‰å‘ç”Ÿï¼Œå¯ä»¥é€šè¿‡åˆ é™¤æ‰‹åŠ¨é‡æ–°åˆ›å»ºã€‚ </p><br><pre> <code class="plaintext hljs">kubectl delete pod -n kube-system kube-controller-manager-master01-test kubectl delete pod -n kube-system kube-controller-manager-master02-test kubectl delete pod -n kube-system kube-controller-manager-master03-test</code> </pre> <br><p> æ£€æŸ¥ä¸€åˆ‡æ­£å¸¸ </p><br><pre> <code class="plaintext hljs">kubectl describe pod -n kube-system kube-controller-manager-master02-test | grep Image: Image: gcr.io/google_containers/hyperkube:v1.15.2</code> </pre> <br><p>  -- </p><br><a name="storage-class"></a><br><h2> åˆ›å»ºä¸€ä¸ªå­˜å‚¨ç±» </h2><br><p>  <strong>æ–¹æ³•ä¸€-å¦‚æœä½¿ç”¨é¢„é…å™¨ceph.com/rbd</strong> <br> åˆ›å»ºä¸€ä¸ªå¸¦æœ‰æˆ‘ä»¬å­˜å‚¨ç±»æè¿°çš„yamlæ–‡ä»¶ã€‚ å¦å¤–ï¼Œä¸‹é¢ä½¿ç”¨çš„æ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥ä¸‹è½½<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åˆ°æˆ‘</a>åœ¨cephç›®å½•ä¸­çš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å­˜å‚¨åº“</a>ä¸­ </p><br><pre> <code class="plaintext hljs">cat &lt;&lt;EOF &gt;./storage-class.yaml kind: StorageClass apiVersion: storage.k8s.io/v1 metadata: name: ceph-rbd provisioner: ceph.com/rbd parameters: monitors: 10.73.88.52:6789, 10.73.88.53:6789, 10.73.88.54:6789 pool: kube adminId: admin adminSecretNamespace: kube-system adminSecretName: ceph-admin-secret userId: kube userSecretNamespace: kube-system userSecretName: ceph-secret imageFormat: "2" imageFeatures: layering EOF</code> </pre> <br><p> å¹¶å°†ä»–åµŒå…¥æˆ‘ä»¬çš„é›†ç¾¤ä¸­ </p><br><pre> <code class="plaintext hljs">kubectl apply -f storage-class.yaml</code> </pre> <br><p> æ£€æŸ¥ä¸€åˆ‡æ­£å¸¸ </p><br><pre> <code class="plaintext hljs">kubectl get sc NAME PROVISIONER AGE ceph-rbd ceph.com/rbd 7s</code> </pre> <br><p>  <strong>æ–¹æ³•äºŒ-å¦‚æœæ‚¨ä½¿ç”¨äº†é¢„é…å™¨kubernetes.io/rbd</strong> <br> åˆ›å»ºå­˜å‚¨ç±» </p><br><pre> <code class="plaintext hljs">cat &lt;&lt;EOF &gt;./storage-class-hyperkube.yaml kind: StorageClass apiVersion: storage.k8s.io/v1 metadata: name: ceph-rbd provisioner: kubernetes.io/rbd allowVolumeExpansion: true parameters: monitors: 10.73.88.52:6789, 10.73.88.53:6789, 10.73.88.54:6789 pool: kube adminId: admin adminSecretNamespace: kube-system adminSecretName: ceph-admin-secret userId: kube userSecretNamespace: kube-system userSecretName: ceph-secret imageFormat: "2" imageFeatures: layering EOF</code> </pre> <br><p> å¹¶å°†ä»–åµŒå…¥æˆ‘ä»¬çš„é›†ç¾¤ä¸­ </p><br><pre> <code class="plaintext hljs">kubectl apply -f storage-class-hyperkube.yaml storageclass.storage.k8s.io/ceph-rbd created</code> </pre> <br><p> æ£€æŸ¥ä¸€åˆ‡æ­£å¸¸ </p><br><pre> <code class="plaintext hljs">kubectl get sc NAME PROVISIONER AGE ceph-rbd kubernetes.io/rbd 107s</code> </pre> <br><a name="test"></a><br><h2>  Kubernetes + CephéŸ§å¸¦æµ‹è¯• </h2><br><p> åœ¨æµ‹è¯•ceph + kubernetesä¹‹å‰ï¼Œå¿…é¡»åœ¨é›†ç¾¤çš„æ¯ä¸ªå·¥ä½œä»£ç ä¸Šå®‰è£…ceph-commonè½¯ä»¶åŒ…ã€‚ </p><br><pre> <code class="plaintext hljs">apt install curl apt-transport-https -y curl https://mirror.croit.io/keys/release.gpg &gt; /usr/share/keyrings/croit-signing-key.gpg echo 'deb [signed-by=/usr/share/keyrings/croit-signing-key.gpg] https://mirror.croit.io/debian-mimic/ stretch main' &gt; /etc/apt/sources.list.d/croit-ceph.list apt update apt install ceph-common</code> </pre> <br><p> åˆ›å»ºä¸€ä¸ªYamlæ–‡ä»¶PersistentVolumeClaim </p><br><pre> <code class="plaintext hljs">cat &lt;&lt;EOF &gt;./claim.yaml kind: PersistentVolumeClaim apiVersion: v1 metadata: name: claim1 spec: accessModes: - ReadWriteOnce storageClassName: ceph-rbd resources: requests: storage: 1Gi EOF</code> </pre> <br><p> æ€äº†ä»– </p><br><pre> <code class="plaintext hljs">kubectl apply -f claim.yaml</code> </pre> <br><p> æ£€æŸ¥æ˜¯å¦å·²åˆ›å»ºPersistentVolumeClaimã€‚ </p><br><pre> <code class="plaintext hljs">bectl get pvc NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE claim1 Bound pvc-d1e47825-289c-4201-acb8-033e62a3fe81 1Gi RWO ceph-rbd 44m</code> </pre> <br><p> å¹¶ä¸”è¿˜è‡ªåŠ¨åˆ›å»ºäº†PersistentVolumeã€‚ </p><br><pre> <code class="plaintext hljs">kubectl get pv NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS REASON AGE pvc-d1e47825-289c-4201-acb8-033e62a3fe81 1Gi RWO Delete Bound default/claim1 ceph-rbd 37m</code> </pre> <br><p> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæµ‹è¯•å®¹å™¨ï¼Œåœ¨å…¶ä¸­å°†åˆ›å»ºçš„pvcåŒ…å«åœ¨/ mntç›®å½•ä¸­ã€‚ ä½¿ç”¨æ–‡æœ¬â€œ Hello Worldï¼â€è¿è¡Œæ­¤æ–‡ä»¶/mnt/test.txtã€‚ </p><br><pre> <code class="plaintext hljs">cat &lt;&lt;EOF &gt;./create-file-pod.yaml kind: Pod apiVersion: v1 metadata: name: create-file-pod spec: containers: - name: test-pod image: gcr.io/google_containers/busybox:1.24 command: - "/bin/sh" args: - "-c" - "echo Hello world! &gt; /mnt/test.txt &amp;&amp; exit 0 || exit 1" volumeMounts: - name: pvc mountPath: "/mnt" restartPolicy: "Never" volumes: - name: pvc persistentVolumeClaim: claimName: claim1 EOF</code> </pre> <br><p> æˆ‘ä»¬å°†æ€æ­»ä»–å¹¶ç¡®è®¤ä»–å·²å®Œæˆä»»åŠ¡ </p><br><pre> <code class="plaintext hljs">kubectl apply -f create-file-pod.yaml kubectl get pods -w</code> </pre> <br><p> è®©æˆ‘ä»¬ç­‰å¾…çŠ¶æ€ </p><br><pre> <code class="plaintext hljs">create-file-pod 0/1 Completed 0 16s</code> </pre> <br><p> è®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªï¼Œå°†å…¶è¿æ¥åˆ°è¯¥å·ï¼Œä½†å·²ç»åœ¨/ mnt / testä¸­ï¼Œç„¶åç¡®ä¿ç”±ç¬¬ä¸€ä¸ªå·åˆ›å»ºçš„æ–‡ä»¶åˆ°ä½ </p><br><pre> <code class="plaintext hljs">cat &lt;&lt;EOF &gt;./test-pod.yaml kind: Pod apiVersion: v1 metadata: name: test-pod spec: containers: - name: test-pod image: gcr.io/google_containers/busybox:1.24 command: - "/bin/sh" args: - "-c" - "sleep 600" volumeMounts: - name: pvc mountPath: "/mnt/test" restartPolicy: "Never" volumes: - name: pvc persistentVolumeClaim: claimName: claim1 EOF</code> </pre> <br><p> è¿è¡Œkubectl get po -wå¹¶ç­‰å¾…ç›´åˆ°podè¿è¡Œ <br> ä¹‹åï¼Œè®©æˆ‘ä»¬è¿›å…¥è¯¥ç›®å½•å¹¶æ£€æŸ¥è¯¥å·æ˜¯å¦å·²è¿æ¥ä»¥åŠæˆ‘ä»¬åœ¨/ mnt / testç›®å½•ä¸­çš„æ–‡ä»¶ </p><br><pre> <code class="plaintext hljs">kubectl exec test-pod -ti sh cat /mnt/test/test.txt Helo world!</code> </pre> <br><p> æ„Ÿè°¢æ‚¨é˜…è¯»åˆ°æœ€åã€‚ æŠ±æ­‰ï¼Œå‘å¸ƒå»¶è¿Ÿã€‚ <br> æˆ‘å·²ç»å‡†å¤‡å¥½å›ç­”ä¸ªäººä¿¡æ¯æˆ–ä¸ªäººèµ„æ–™ä¸­æŒ‡ç¤ºçš„ç¤¾äº¤ç½‘ç»œä¸­çš„æ‰€æœ‰é—®é¢˜ã€‚ <br> åœ¨ä¸‹ä¸€ä¸ªå°å‹å‡ºç‰ˆç‰©ä¸­ï¼Œæˆ‘å°†å‘Šè¯‰æ‚¨å¦‚ä½•åŸºäºåˆ›å»ºçš„cephé›†ç¾¤ï¼Œç„¶åæ ¹æ®ç¬¬ä¸€ä¸ªå‡ºç‰ˆç‰©ä¸­çš„è®¡åˆ’æ¥éƒ¨ç½²S3å­˜å‚¨ã€‚ </p><br><a name="book"></a><br><p> å‡ºç‰ˆææ–™ </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å®˜æ–¹Cephæ–‡æ¡£</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨å›¾ç‰‡ä¸­ä»‹ç»Cephå­˜å‚¨åº“</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Kuberneteså®˜æ–¹æ–‡æ¡£</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetesåŸ¹å…»ç®±/å¤–éƒ¨å­˜å‚¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¸¦æœ‰ç¤ºä¾‹æ–‡ä»¶çš„kubernetes-ceph-perconaå­˜å‚¨åº“</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN465399/">https://habr.com/ru/post/zh-CN465399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN465379/index.html">è‡ªåˆ¶æ— çº¿ç‹¬ç«‹å¼èƒ°å²›ç´ æ³µæ§åˆ¶</a></li>
<li><a href="../zh-CN465391/index.html">åœ¨ä¿„ç½—æ–¯æ–¯å¡æ‹‰è¿åŠ¨çš„è„šæ­¥ã€‚ ç¬¬ä¸€éƒ¨åˆ†</a></li>
<li><a href="../zh-CN465393/index.html">MySensorsè®¾å¤‡çš„ç”µæ± ç”µæº</a></li>
<li><a href="../zh-CN465395/index.html">ä¾èµ–æ³¨å…¥å’ŒæœåŠ¡å®šä½å™¨ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN465397/index.html">Nitroè½¬æ¢å™¨çš„å¤–è§‚å¦‚ä½•ï¼Œå¯å¸®åŠ©å¼€å‘äººå‘˜è¿›è¡Œæœ¬åœ°åŒ–å’ŒæŠ€æœ¯æ”¯æŒ</a></li>
<li><a href="../zh-CN465401/index.html">åœ¨ä»»ä½•ITå›¢é˜Ÿä¸­åŠ é€Ÿè§£å†³é—®é¢˜çš„5é¡¹æ´»åŠ¨</a></li>
<li><a href="../zh-CN465403/index.html">å•Šï¼ å…¬è·¯ä¸Šçš„æ–°ç›¸æœºæˆ–æœ‰å…³é›·è¾¾å’Œé›·è¾¾æ¢æµ‹å™¨çš„æœ€æ–°ä¿¡æ¯</a></li>
<li><a href="../zh-CN465407/index.html">1.æé™ä¼ä¸šå±‚äº¤æ¢æœºæ¦‚è¿°</a></li>
<li><a href="../zh-CN465409/index.html">Vue.js Webå¼€å‘æœ€ä½³å®è·µ</a></li>
<li><a href="../zh-CN465415/index.html">æˆ‘ä»¬ç”¨ä¸€ç§æ˜“äºç†è§£çš„è¯­è¨€è°ˆè®ºDevOps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>