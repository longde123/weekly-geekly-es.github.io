<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåñ ‚ÄºÔ∏è ü§üüèº Impl√©mentation du mod√®le de conception de commande dans Unity üëî üë©üèæ‚Äç‚öïÔ∏è üí¨</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Vous √™tes-vous d√©j√† demand√© comment dans des jeux comme Super Meat Boy la fonction de relecture est impl√©ment√©e? L'une des fa√ßons de le mettre en ≈ìuvr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Impl√©mentation du mod√®le de conception de commande dans Unity</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463953/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/cfb/edf/fefcfbedf0b2e0711f2e831b0d069ebf.gif" alt="image"></div><br>  Vous √™tes-vous d√©j√† demand√© comment dans des jeux comme <i>Super Meat Boy</i> la fonction de relecture est impl√©ment√©e?  L'une des fa√ßons de le mettre en ≈ìuvre consiste √† effectuer l'entr√©e de la m√™me mani√®re que le joueur, ce qui, √† son tour, signifie que l'entr√©e doit √™tre stock√©e d'une mani√®re ou d'une autre.  Vous pouvez utiliser <em>le mod√®le de commande</em> pour cela et bien plus encore. <br><br>  Le mod√®le de commande est √©galement utile pour cr√©er des fonctions d'annulation et de r√©tablissement dans un jeu de strat√©gie. <br><br>  Dans ce didacticiel, nous impl√©mentons le mod√®le de commande en C # et l'utilisons pour guider le personnage du bot √† travers un labyrinthe en trois dimensions.  √Ä partir du didacticiel, vous apprendrez: <br><br><ul><li>  Les bases du mod√®le de commande. </li><li>  Comment impl√©menter le mod√®le de commande </li><li>  Comment cr√©er une file d'attente de commandes d'entr√©e et retarder leur ex√©cution. </li></ul><a name="habracut"></a><br><blockquote>  <em>Remarque</em> : il est suppos√© que vous connaissez d√©j√† Unity et que vous avez une connaissance moyenne de C #.  Dans ce didacticiel, nous travaillerons avec <em>Unity 2019.1</em> et <em>C # 7</em> . </blockquote><br><h2>  Se rendre au travail </h2><br>  Pour commencer, t√©l√©chargez le <a href="">mat√©riel</a> du <a href="">projet</a> .  D√©compressez le fichier et ouvrez le projet <em>Starter</em> dans Unity. <br><br>  Allez dans <em>RW / Scenes</em> et ouvrez la sc√®ne <em>principale</em> .  La sc√®ne se compose d'un bot et d'un labyrinthe, ainsi que d'une interface utilisateur terminale qui affiche des instructions.  Le level design est r√©alis√© sous la forme d'une grille, ce qui est utile lorsque l'on d√©place visuellement le bot √† travers le labyrinthe. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53b/ab9/660/53bab9660bdd0a5017b570d43a57b2d9.png"></div><br>  Si vous cliquez sur <em>Play</em> , nous verrons que les instructions ne fonctionnent pas.  Ceci est normal car nous ajouterons cette fonctionnalit√© au didacticiel. <br><br>  La partie la plus int√©ressante de la sc√®ne est le <em>Bot</em> GameObject.  S√©lectionnez-le dans la fen√™tre Hi√©rarchie en cliquant dessus. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/187/35e/acf/18735eacfd1f8df8920749ea80a12b8f.png"></div><br>  Dans l'inspecteur, vous pouvez voir qu'il a un composant <em>Bot</em> .  Nous utiliserons ce composant en √©mettant des commandes d'entr√©e. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2a5/2e3/2bc/2a52e32bc7feb6baafae6af958cc4910.png"></div><br><h2>  Nous comprenons la logique du bot </h2><br>  Acc√©dez √† <em>RW / Scripts</em> et ouvrez le script <em>Bot</em> dans l'√©diteur de code.  Vous n'avez pas besoin de savoir ce qui se passe dans le script <em>Bot</em> .  Mais jetez un ≈ìil √† deux m√©thodes: <code>Move</code> et <code>Shoot</code> .  Encore une fois, vous n'avez pas √† comprendre ce qui se passe √† l'int√©rieur de ces m√©thodes, mais vous devez comprendre comment les utiliser. <br><br>  Notez que la m√©thode <code>Move</code> re√ßoit un param√®tre d'entr√©e <code>CardinalDirection</code> .  <code>CardinalDirection</code> est une √©num√©ration.  Un √©l√©ment d'√©num√©ration de type <code>CardinalDirection</code> peut √™tre <code>Up</code> , <code>Down</code> , <code>Right</code> ou <code>Left</code> .  Selon la <code>CardinalDirection</code> s√©lectionn√©e <code>CardinalDirection</code> bot se d√©place exactement d'un carr√© le long de la grille dans la direction correspondante. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02c/72e/8ca/02c72e8ca19f987e6e36774558242058.png"></div><br>  La m√©thode <code>Shoot</code> oblige le bot √† tirer des obus qui d√©truisent les <em>murs jaunes</em> , mais sont inutiles contre les autres murs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b34/f18/2bb/b34f182bb9c0bb682606d0c5a1beb0fd.gif"></div><br>  Enfin, jetez un ≈ìil √† la m√©thode <code>ResetToLastCheckpoint</code> ;  pour comprendre ce qu'il fait, regardez le labyrinthe.  Il y a des points dans le labyrinthe appel√©s <em>checkpoint</em> .  Pour passer le labyrinthe, le bot doit se rendre au point de contr√¥le <em>vert</em> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e4c/d3b/fc9/e4cd3bfc9d59944e28d9a22206141888.png"></div><br>  Lorsqu'un bot marche sur un nouveau point de contr√¥le, il devient le <em>dernier</em> pour lui.  <code>ResetToLastCheckpoint</code> r√©initialise la position du bot, le d√©pla√ßant vers le dernier point de contr√¥le. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/829/617/95a/82961795afe53c9b45f1f8037896783c.gif"></div><br>  Bien que nous ne puissions pas utiliser ces m√©thodes, nous le corrigerons bient√¥t.  Pour commencer, vous devez vous renseigner sur le mod√®le de conception de <em>commande</em> . <br><br><h2>  Qu'est-ce que le mod√®le de conception de commande? </h2><br>  Le mod√®le de commande est l'un des 23 mod√®les de conception d√©crits dans le livre <i>Design Patterns: Elements of Reusable Object-Oriented Software</i> √©crit par le Gang of Four par Erich Gamma, Richard Helm, Ralph Johnson et John Vlissides ( <em>GoF</em> , Gang of Four). <br><br>  Les auteurs rapportent que ¬´le mod√®le de commande encapsule la demande en tant qu'objet, nous permettant ainsi de param√©trer d'autres objets avec des demandes diff√©rentes, des demandes de file d'attente ou de journal et de prendre en charge des op√©rations r√©versibles¬ª. <br><br>  Ouah!  Comment est-ce? <br><br>  Je comprends que cette d√©finition n'est pas tr√®s simple, alors analysons-la. <br><br>  <em>L'encapsulation</em> signifie qu'un appel de m√©thode peut √™tre encapsul√© en tant qu'objet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07d/5c3/214/07d5c32142de4fd36bd2cd73c543856a.png" width="50%" height="50%"></div><br>  La m√©thode encapsul√©e peut affecter de nombreux objets en fonction du param√®tre d'entr√©e.  C'est ce qu'on appelle le <em>param√©trage d'</em> autres objets. <br><br>  La ¬´commande¬ª r√©sultante peut √™tre enregistr√©e avec d'autres √©quipes jusqu'√† ce qu'elle soit ex√©cut√©e.  Il s'agit de la <em>file d'attente des</em> demandes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/035/637/264/0356372640076e0829d2a427cf3552f1.png" width="50%" height="50%"></div><br>  <i>File d'attente d'√©quipe</i> <br><br>  Enfin, la <em>r√©versibilit√©</em> signifie que les op√©rations peuvent √™tre annul√©es √† l'aide de la fonction Annuler. <br><br>  OK, mais comment cela se refl√®te-t-il dans le code? <br><br>  La classe <em>Command</em> aura une m√©thode <em>Execute</em> , qui re√ßoit en param√®tre d'entr√©e l'objet (par lequel la commande est ex√©cut√©e) appel√© <em>Receiver</em> .  En fait, la m√©thode Execute est <em>encapsul√©e</em> par la classe Command. <br><br>  De nombreuses instances de la classe Command peuvent √™tre pass√©es en tant qu'objets ordinaires, c'est-√†-dire qu'elles peuvent √™tre stock√©es dans des structures de donn√©es telles qu'une file d'attente, une pile, etc. <br><br>  Pour ex√©cuter une commande, vous devez appeler sa m√©thode Execute.  La classe qui d√©marre l'ex√©cution est appel√©e <em>Invoker</em> . <br><br>  Le projet contient actuellement une classe vide appel√©e <code>BotCommand</code> .  Dans la section suivante, nous allons impl√©menter l'impl√©mentation de ce qui pr√©c√®de pour permettre au bot d'effectuer des actions √† l'aide du mod√®le de commande. <br><br><h2>  D√©placez le bot </h2><br><h3>  Impl√©mentation du mod√®le de commande </h3><br>  Dans cette section, nous impl√©mentons le mod√®le de commande.  Il existe de nombreuses fa√ßons de le mettre en ≈ìuvre.  Dans ce tutoriel, nous allons couvrir l'un d'entre eux. <br><br>  Pour commencer, allez dans <em>RW / Scripts</em> et ouvrez le script <em>BotCommand</em> dans l'√©diteur.  La classe <code>BotCommand</code> toujours vide, mais pas pour longtemps. <br><br>  Ins√©rez le code suivant dans la classe: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private readonly string commandName; //2 public BotCommand(ExecuteCallback executeMethod, string name) { Execute = executeMethod; commandName = name; } //3 public delegate void ExecuteCallback(Bot bot); //4 public ExecuteCallback Execute { get; private set; } //5 public override string ToString() { return commandName; }</span></span></code> </pre> <br>  Que se passe-t-il ici? <br><br><ol><li>  La variable <code>commandName</code> utilis√©e simplement pour stocker le nom de commande lisible par l'homme.  Il n'est pas n√©cessaire de l'utiliser dans le mod√®le, mais nous en aurons besoin plus tard dans le tutoriel. </li><li>  Le constructeur de <code>BotCommand</code> re√ßoit une fonction et une cha√Æne.  Cela nous aidera √† configurer la m√©thode <code>Execute</code> de l'objet Command et son <code>name</code> . </li><li>  Le d√©l√©gu√© <code>ExecuteCallback</code> d√©finit le type de m√©thode encapsul√©e.  La m√©thode encapsul√©e retournera vide et acceptera comme param√®tre d'entr√©e un objet de type <code>Bot</code> (composant <em>Bot</em> ). </li><li>  La propri√©t√© <code>Execute</code> fera r√©f√©rence √† la m√©thode encapsul√©e.  Nous l'utiliserons pour appeler la m√©thode encapsul√©e. </li><li>  La m√©thode <code>ToString</code> est remplac√©e pour renvoyer la cha√Æne <code>commandName</code> .  C'est pratique, par exemple, pour une utilisation dans l'interface utilisateur. </li></ol><br>  Enregistrez les modifications et c'est tout!  Nous avons r√©ussi √† impl√©menter le mod√®le de commande. <br><br>  Reste √† l'utiliser. <br><br><h3>  Constitution d'√©quipe </h3><br>  Ouvrez le <em>BotInputHandler</em> dans le dossier <em>RW / Scripts</em> . <br><br>  Ici, nous allons cr√©er cinq instances de <code>BotCommand</code> .  Ces instances encapsuleront des m√©thodes pour d√©placer le GameObject Bot vers le haut, le bas, la gauche et la droite, ainsi que pour le tir. <br><br>  Pour impl√©menter cela, ins√©rez ce qui suit dans cette classe: <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private static readonly BotCommand MoveUp = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Up); }, "moveUp"); //2 private static readonly BotCommand MoveDown = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Down); }, "moveDown"); //3 private static readonly BotCommand MoveLeft = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Left); }, "moveLeft"); //4 private static readonly BotCommand MoveRight = new BotCommand(delegate (Bot bot) { bot.Move(CardinalDirection.Right); }, "moveRight"); //5 private static readonly BotCommand Shoot = new BotCommand(delegate (Bot bot) { bot.Shoot(); }, "shoot");</span></span></code> </pre> <br>  Dans chacune de ces instances, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">une m√©thode anonyme est</a> transmise au constructeur.  Cette m√©thode anonyme sera encapsul√©e dans l'objet de commande correspondant.  Comme vous pouvez le voir, la signature de chacune des m√©thodes anonymes r√©pond aux exigences sp√©cifi√©es par le d√©l√©gu√© <code>ExecuteCallback</code> . <br><br>  De plus, le deuxi√®me param√®tre du constructeur est une cha√Æne indiquant le nom de la commande.  Ce nom sera retourn√© par la m√©thode <code>ToString</code> de l'instance de commande.  Plus tard, nous l'appliquerons pour l'interface utilisateur. <br><br>  Dans les quatre premi√®res instances, les m√©thodes anonymes appellent la m√©thode <code>Move</code> sur l'objet <code>bot</code> .  Cependant, leurs param√®tres d'entr√©e sont diff√©rents. <br><br>  Les commandes <code>MoveUp</code> , <code>MoveDown</code> , <code>MoveLeft</code> et <code>MoveRight</code> transmettent les param√®tres de <code>Move</code> <code>CardinalDirection.Up</code> , <code>CardinalDirection.Down</code> , <code>CardinalDirection.Left</code> et <code>CardinalDirection.Right</code> .  Comme mentionn√© dans la section <i>Qu'est-ce que le mod√®le de conception de commande</i> , ils indiquent diff√©rentes directions de d√©placement du Bot GameObject. <br><br>  Dans la cinqui√®me instance, la m√©thode anonyme appelle la m√©thode <code>Shoot</code> pour l'objet <code>bot</code> .  Gr√¢ce √† cela, le bot tirera un obus lors de l'ex√©cution de la commande. <br><br>  Maintenant que nous avons cr√©√© les commandes, nous devons en quelque sorte y acc√©der lorsque l'utilisateur fait une entr√©e. <br><br>  Pour ce faire, <code>BotInputHandler</code> code suivant dans le <code>BotInputHandler</code> , imm√©diatement apr√®s les instances de commande: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> BotCommand </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleInput</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.W)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveUp; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.S)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveDown; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.D)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveRight; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.A)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MoveLeft; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.F)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Shoot; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  La m√©thode <code>HandleInput</code> renvoie une instance de la commande en fonction de la touche enfonc√©e par l'utilisateur.  Enregistrez vos modifications avant de continuer. <br><br><h3>  Application de commandes </h3><br>  Super, maintenant il est temps d'utiliser les √©quipes que nous avons cr√©√©es.  Acc√©dez √† nouveau √† <em>RW / Scripts</em> et ouvrez le script <em>SceneManager</em> dans l'√©diteur.  Dans cette classe, vous remarquerez un lien vers une variable <code>uiManager</code> de type <code>UIManager</code> . <br><br>  La classe <code>UIManager</code> fournit des m√©thodes d'aide utiles pour l' <em>interface utilisateur</em> du <em>terminal</em> que nous utilisons dans cette sc√®ne.  Si la m√©thode d' <code>UIManager</code> est utilis√©e, alors le tutoriel expliquera ce qu'elle fait, mais en g√©n√©ral pour nos besoins il n'est pas n√©cessaire de conna√Ætre sa structure interne. <br><br>  De plus, la variable <code>bot</code> fait r√©f√©rence au composant bot attach√© au GameObject <em>Bot</em> . <br><br>  Ajoutez maintenant le code suivant √† la classe <code>SceneManager</code> , en le rempla√ßant par comment <code>//1</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-comment"><span class="hljs-comment">//1 private List&lt;BotCommand&gt; botCommands = new List&lt;BotCommand&gt;(); private Coroutine executeRoutine; //2 private void Update() { if (Input.GetKeyDown(KeyCode.Return)) { ExecuteCommands(); } else { CheckForBotCommands(); } } //3 private void CheckForBotCommands() { var botCommand = BotInputHandler.HandleInput(); if (botCommand != null &amp;&amp; executeRoutine == null) { AddToCommands(botCommand); } } //4 private void AddToCommands(BotCommand botCommand) { botCommands.Add(botCommand); //5 uiManager.InsertNewText(botCommand.ToString()); } //6 private void ExecuteCommands() { if (executeRoutine != null) { return; } executeRoutine = StartCoroutine(ExecuteCommandsRoutine()); } private IEnumerator ExecuteCommandsRoutine() { Debug.Log("Executing..."); //7 uiManager.ResetScrollToTop(); //8 for (int i = 0, count = botCommands.Count; i &lt; count; i++) { var command = botCommands[i]; command.Execute(bot); //9 uiManager.RemoveFirstTextLine(); yield return new WaitForSeconds(CommandPauseTime); } //10 botCommands.Clear(); bot.ResetToLastCheckpoint(); executeRoutine = null; }</span></span></code> </pre> <br>  Wow, combien de code!  Mais ne vous inqui√©tez pas;  nous sommes enfin pr√™ts pour le premier vrai lancement du projet dans la fen√™tre de jeu. <br><br>  J'expliquerai le code plus tard.  N'oubliez pas d'enregistrer les modifications. <br><br><h3>  Ex√©cution du jeu pour tester le mod√®le de commande </h3><br>  Il est donc temps de construire;  Cliquez sur <em>Lecture</em> dans l'√©diteur Unity. <br><br>  Vous devriez pouvoir entrer des commandes de d√©placement √† l'aide des <em>touches WASD</em> .  Pour entrer la commande de prise de vue, appuyez sur la touche <em>F.</em>  Pour ex√©cuter des commandes, appuyez sur <em>Entr√©e</em> . <br><br><blockquote>  <em>Remarque</em> : tant que le processus d'ex√©cution n'est pas termin√©, la saisie de nouvelles commandes n'est pas possible. </blockquote><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20b/ef8/483/20bef8483dd70829836bd9234178f5dd.gif"></div><br>  Notez que des lignes sont ajout√©es √† l'interface utilisateur du terminal.  Les √©quipes dans l'interface utilisateur sont indiqu√©es par leurs noms.  Ceci est rendu possible gr√¢ce √† la variable <code>commandName</code> . <br><br>  Notez √©galement comment l'interface utilisateur d√©file vers le haut avant l'ex√©cution et comment les lignes sont supprim√©es pendant l'ex√©cution. <br><br><h3>  Nous √©tudions les √©quipes de plus pr√®s </h3><br>  Il est temps d'apprendre le code que nous avons ajout√© dans la section "Application des commandes": <br><br><ol><li>  La liste <code>botCommands</code> stocke des liens vers des instances de <code>BotCommand</code> .  N'oubliez pas que pour √©conomiser de la m√©moire, nous ne pouvons cr√©er que cinq instances de commandes, mais il peut y avoir plusieurs r√©f√©rences √† une commande.  De plus, la variable <code>executeCoroutine</code> fait r√©f√©rence √† <code>ExecuteCommandsRoutine</code> , qui contr√¥le l'ex√©cution de la commande. </li><li>  <code>Update</code> v√©rifie si l'utilisateur a appuy√© sur la touche Entr√©e;  si c'est le cas, il appelle <code>ExecuteCommands</code> , sinon <code>CheckForBotCommands</code> est <code>CheckForBotCommands</code> . </li><li>  <code>CheckForBotCommands</code> utilise la m√©thode statique <code>HandleInput</code> du <code>BotInputHandler</code> pour v√©rifier si l'utilisateur a termin√© l'entr√©e, et si c'est le cas, la commande est <em>renvoy√©e</em> .  La commande retourn√©e est transmise √† <code>AddToCommands</code> .  Cependant, si les commandes sont ex√©cut√©es, c'est-√†-dire  si <code>executeRoutine</code> pas null, il reviendra sans rien transmettre √† <code>AddToCommands</code> .  Autrement dit, l'utilisateur doit attendre la fin. </li><li>  <code>AddToCommands</code> ajoute un nouveau lien vers l'instance <em>retourn√©e</em> de la commande dans <code>botCommands</code> . </li><li>  La m√©thode <code>InsertNewText</code> de la classe <code>InsertNewText</code> ajoute une nouvelle ligne de texte √† l'interface utilisateur du terminal.  Une cha√Æne de texte est une cha√Æne pass√©e en param√®tre d'entr√©e.  Dans ce cas, nous lui passons commandName. </li><li>  La m√©thode <code>ExecuteCommandsRoutine</code> lance <code>ExecuteCommandsRoutine</code> . </li><li>  <code>ResetScrollToTop</code> de <code>UIManager</code> d√©filer l'interface utilisateur du terminal vers le haut.  Cela se fait juste avant le d√©but de l'ex√©cution. </li><li>  <code>ExecuteCommandsRoutine</code> contient une boucle <code>for</code> qui it√®re sur les commandes √† l'int√©rieur de la liste <code>botCommands</code> et les ex√©cute une par une, en passant l'objet <code>bot</code> √† la m√©thode renvoy√©e par la propri√©t√© <code>Execute</code> .  Apr√®s chaque ex√©cution, une pause est ajout√©e en secondes <code>CommandPauseTime</code> . </li><li>  La m√©thode <code>RemoveFirstTextLine</code> de <code>UIManager</code> supprime la toute premi√®re ligne de texte dans l'interface utilisateur du terminal, si elle existe.  Autrement dit, lorsqu'une commande est ex√©cut√©e, son nom est supprim√© de l'interface utilisateur. </li><li>  Une fois toutes les commandes <code>botCommands</code> est effac√© et le bot est r√©initialis√© au dernier point d'arr√™t √† l'aide de <code>ResetToLastCheckpoint</code> .  √Ä la fin, <code>executeRoutine</code> <code>null</code> et l'utilisateur peut continuer √† entrer des commandes. </li></ol><br><h2>  Impl√©mentation des fonctionnalit√©s d'annulation et de r√©tablissement </h2><br>  Ex√©cutez √† nouveau la sc√®ne et essayez d'atteindre le point de contr√¥le vert. <br><br>  Vous remarquerez que nous ne pouvons pas annuler la commande entr√©e.  Cela signifie que si vous faites une erreur, vous ne pouvez pas revenir en arri√®re avant d'avoir termin√© toutes les commandes que vous entrez.  Vous pouvez r√©soudre ce probl√®me en ajoutant les fonctionnalit√©s <em>Annuler</em> et <em>R√©tablir</em> . <br><br>  Revenez √† <em>SceneManager.cs</em> et ajoutez la d√©claration de variable suivante imm√©diatement apr√®s la d√©claration <i>List</i> pour <code>botCommands</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Stack&lt;BotCommand&gt; undoStack = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Stack&lt;BotCommand&gt;();</code> </pre> <br>  La variable <code>undoStack</code> est une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">pile</a> (de la famille Collections) qui stockera toutes les r√©f√©rences aux commandes qui peuvent √™tre annul√©es. <br><br>  Nous ajoutons maintenant deux m√©thodes <code>UndoCommandEntry</code> et <code>RedoCommandEntry</code> qui ex√©cuteront Undo et Redo.  Dans la classe <code>SceneManager</code> , <code>SceneManager</code> code suivant apr√®s <code>ExecuteCommandsRoutine</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UndoCommandEntry</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//1 if (executeRoutine != null || botCommands.Count == 0) { return; } undoStack.Push(botCommands[botCommands.Count - 1]); botCommands.RemoveAt(botCommands.Count - 1); //2 uiManager.RemoveLastTextLine(); } private void RedoCommandEntry() { //3 if (undoStack.Count == 0) { return; } var botCommand = undoStack.Pop(); AddToCommands(botCommand); }</span></span></code> </pre> <br>  Analysons le code: <br><br><ol><li>  Si des commandes sont ex√©cut√©es ou si la liste <code>botCommands</code> vide, la m√©thode <code>UndoCommandEntry</code> rien.  Sinon, il √©crit un lien vers la derni√®re commande entr√©e dans la pile <code>undoStack</code> .  Cela supprime √©galement le lien vers la commande de la liste <code>botCommands</code> . </li><li>  La m√©thode <code>RemoveLastTextLine</code> de <code>UIManager</code> supprime la derni√®re ligne de texte de l'interface utilisateur du terminal afin que l'interface utilisateur corresponde au contenu de <code>botCommands</code> . </li><li>  Si la pile <code>undoStack</code> vide, alors <code>RedoCommandEntry</code> ne fait rien.  Sinon, il extrait la derni√®re commande du haut de <code>undoStack</code> et l'ajoute √† la liste des <code>AddToCommands</code> utilisant <code>AddToCommands</code> . </li></ol><br>  Nous allons maintenant ajouter une entr√©e au clavier pour utiliser ces fonctions.  Dans la classe <code>SceneManager</code> remplacez le corps de la m√©thode <code>Update</code> par le code suivant: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.Return)) { ExecuteCommands(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Input.GetKeyDown(KeyCode.U)) <span class="hljs-comment"><span class="hljs-comment">//1 { UndoCommandEntry(); } else if (Input.GetKeyDown(KeyCode.R)) //2 { RedoCommandEntry(); } else { CheckForBotCommands(); }</span></span></code> </pre> <br><ol><li>  Lorsque vous appuyez sur la touche <em>U</em> , la m√©thode <code>UndoCommandEntry</code> est <code>UndoCommandEntry</code> . </li><li>  Lorsque vous appuyez sur la touche <em>R</em> , la m√©thode <code>RedoCommandEntry</code> est <code>RedoCommandEntry</code> . </li></ol><br><h3>  Gestion des cas de bord </h3><br>  Super, nous avons presque fini!  Mais d'abord, nous devons faire ce qui suit: <br><br><ol><li>  Lorsque vous entrez une nouvelle commande, la pile <code>undoStack</code> doit √™tre effac√©e. </li><li>  Avant d'ex√©cuter des commandes, la pile <code>undoStack</code> doit √™tre effac√©e. </li></ol><br>  Pour impl√©menter cela, nous devons d'abord ajouter une nouvelle m√©thode √† <code>SceneManager</code> .  Ins√©rez la m√©thode suivante apr√®s <code>CheckForBotCommands</code> : <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddNewCommand</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">BotCommand botCommand</span></span></span><span class="hljs-function">)</span></span> { undoStack.Clear(); AddToCommands(botCommand); }</code> </pre> <br>  Cette m√©thode efface <code>undoStack</code> et appelle ensuite la m√©thode <code>AddToCommands</code> . <br><br>  Remplacez maintenant l'appel √† <code>AddToCommands</code> dans <code>CheckForBotCommands</code> par le code suivant: <br><br><pre> <code class="cs hljs"> AddNewCommand(botCommand);</code> </pre> <br>  Ins√©rez ensuite la ligne suivante apr√®s l' <code>if</code> dans la m√©thode <code>ExecuteCommands</code> √† effacer avant d'ex√©cuter les commandes <code>undoStack</code> : <br><br><pre> <code class="cs hljs"> undoStack.Clear();</code> </pre> <br>  Et nous avons enfin termin√©! <br><br>  Sauvegardez votre travail.  G√©n√©rez le projet et cliquez sur dans l'√©diteur de <em>lecture</em> .  Saisissez les commandes comme pr√©c√©demment.  Appuyez sur <em>U</em> pour annuler les commandes.  Appuyez sur <em>R</em> pour r√©p√©ter les commandes annul√©es. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fef/cfb/edf/fefcfbedf0b2e0711f2e831b0d069ebf.gif" width="1024" height="576"></div><br>  Essayez d'arriver au point de contr√¥le vert. <br><br><h2>  O√π aller ensuite? </h2><br>  Pour en savoir plus sur les mod√®les de conception utilis√©s dans la programmation de jeux, je vous recommande d'√©tudier les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">mod√®les de programmation de jeux de</a> Robert Nystrom. <br><br>  Pour en savoir plus sur les techniques C # avanc√©es, suivez le cours <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=" rel="noopener">Collections C #, Lambdas et LINQ</a> . <br><br><h3>  T√¢che </h3><br>  En tant que t√¢che, essayez d'arriver au point de contr√¥le vert √† la fin du labyrinthe.  J'ai cach√© une des solutions sous le spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Solution</b> <div class="spoiler_text"><ul><li>  moveUp √ó 2 </li><li>  moveRight √ó 3 </li><li>  moveUp √ó 2 </li><li>  moveLeft </li><li>  tirer </li><li>  moveLeft √ó 2 </li><li>  moveUp √ó 2 </li><li>  moveLeft √ó 2 </li><li>  moveDown √ó 5 </li><li>  moveLeft </li><li>  tirer </li><li>  moveLeft </li><li>  moveUp √ó 3 </li><li>  tirer √ó 2 </li><li>  moveUp √ó 5 </li><li>  moveRight √ó 3 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dab/f9e/05f/dabf9e05f3cb79ab20a6a663108295fe.png"></div></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr463953/">https://habr.com/ru/post/fr463953/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr463933/index.html">Un script Python de 20 lignes qui souhaite aux parents bonjour tous les jours via WhatsApp</a></li>
<li><a href="../fr463937/index.html">Je n'ai rien √† cacher</a></li>
<li><a href="../fr463939/index.html">SimbirSoft a publi√© une solution mobile pour les compagnies d'assurance</a></li>
<li><a href="../fr463943/index.html">Les m√©saventures de la licorne noire</a></li>
<li><a href="../fr463951/index.html">c.tech: Cassandra Meetup # 2</a></li>
<li><a href="../fr463955/index.html">Comment d√©velopper un concept de changement de plateforme IP? Instructions d'utilisation</a></li>
<li><a href="../fr463957/index.html">Comment d√©ployer une liste d'entrevues √† lien unique</a></li>
<li><a href="../fr463961/index.html">Propre mappeur ou un peu sur ExpressionTrees</a></li>
<li><a href="../fr463963/index.html">Reconnaissance faciale sur un chantier de construction</a></li>
<li><a href="../fr463965/index.html">Application de composition dans LaTeX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>