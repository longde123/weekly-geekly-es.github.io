<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üê° üò∫ üë©üèº‚Äçüè´ Monitoramento cont√≠nuo - automa√ß√£o de verifica√ß√µes de qualidade de software no pipeline de CI / CD üßóüèº ü¶ì üí©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Agora sobre o tema do hype DevOps. O transportador de integra√ß√£o e entrega cont√≠nuas de CI / CD √© implementado por todos que desejam. Mas a maioria ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Monitoramento cont√≠nuo - automa√ß√£o de verifica√ß√µes de qualidade de software no pipeline de CI / CD</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lanit/blog/451630/">  Agora sobre o tema do hype DevOps.  O transportador de integra√ß√£o e entrega cont√≠nuas de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CI / CD √©</a> implementado por todos que desejam.  Mas a maioria nem sempre presta a devida aten√ß√£o em garantir a confiabilidade dos sistemas de informa√ß√£o em v√°rios est√°gios do pipeline de CI / CD.  Neste artigo, gostaria de falar sobre minha experi√™ncia na automa√ß√£o de verifica√ß√µes de qualidade de software e na implementa√ß√£o de poss√≠veis cen√°rios para sua ‚Äúautocorre√ß√£o‚Äù. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/279/b1b/d43/279b1bd4301b7755a590307a9378243c.jpg"></div>  <a href=""><i>Fonte</i></a> <br><a name="habracut"></a><br>  Trabalho como engenheiro no departamento de gerenciamento de servi√ßos de TI da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">LANIT-Integration</a> .  Minha √°rea principal √© a implementa√ß√£o de v√°rios sistemas para monitorar o desempenho e a disponibilidade dos aplicativos.  Costumo me comunicar com clientes de TI de diferentes segmentos de mercado em quest√µes de monitoramento da qualidade de seus servi√ßos de TI.  A principal tarefa √© minimizar o tempo do ciclo de libera√ß√£o e aumentar a frequ√™ncia da libera√ß√£o.  Isso, √© claro, √© tudo de bom: mais lan√ßamentos - mais novos recursos - usu√°rios mais satisfeitos - mais lucro.  Mas, na realidade, nem sempre tudo acaba bem.  A taxas de implanta√ß√£o muito altas, surge imediatamente a quest√£o sobre a qualidade de nossos lan√ßamentos.  Mesmo com um pipeline totalmente automatizado, um dos maiores problemas √© a transfer√™ncia de servi√ßos do teste para a produ√ß√£o, o que n√£o afeta o tempo de atividade e a intera√ß√£o do usu√°rio com o aplicativo. <br><br>  Com base nos resultados de in√∫meras conversas com clientes, posso dizer que o controle de qualidade dos lan√ßamentos, o problema da confiabilidade do aplicativo e a possibilidade de sua "autocorre√ß√£o" (por exemplo, revers√£o para uma vers√£o est√°vel) em v√°rios est√°gios do pipeline de CI / CD est√£o entre os t√≥picos mais interessantes e relevantes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/373/e6e/f90/373e6ef9080b3a7f8c6c4e65568254eb.png"></div><br>  Recentemente, eu mesmo trabalhei no lado do cliente - no servi√ßo de suporte a aplicativos banc√°rios online.  A arquitetura do nosso aplicativo usou um grande n√∫mero de microsservi√ßos auto-escritos.  O mais triste √© que nem todos os desenvolvedores lidaram com o alto ritmo de desenvolvimento, a qualidade de alguns microsservi√ßos sofridos, o que deu origem a apelidos rid√≠culos para eles e seus criadores.  Havia hist√≥rias sobre de quais materiais esses produtos s√£o feitos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/210/472/129/21047212917809f642f154cfa2b8e6c6.png"></div><br><h1>  "Declara√ß√£o do problema" </h1><br>  A alta frequ√™ncia de lan√ßamentos e um grande n√∫mero de microsservi√ßos dificultam o entendimento do aplicativo como um todo, tanto no est√°gio de teste quanto no operacional.  As mudan√ßas ocorrem constantemente e √© muito dif√≠cil control√°-las sem boas ferramentas de monitoramento.  Muitas vezes, ap√≥s um lan√ßamento noturno pela manh√£, os desenvolvedores sentam em um barril de p√≥lvora e esperam que nada se quebre, embora, na fase de testes, todas as verifica√ß√µes tenham sido bem-sucedidas. <br><br>  H√° mais um ponto.  Na fase de teste, a operacionalidade do software √© verificada: a implementa√ß√£o das principais fun√ß√µes do aplicativo e a aus√™ncia de erros.  As estimativas qualitativas de desempenho est√£o ausentes ou n√£o levam em considera√ß√£o todos os aspectos do aplicativo e da camada de integra√ß√£o.  Algumas m√©tricas podem n√£o ser verificadas.  Como resultado, quando ocorre uma falha em um ambiente produtivo, o departamento de suporte t√©cnico descobre apenas quando usu√°rios reais come√ßam a reclamar.  Gostaria de minimizar o impacto do software de baixa qualidade nos usu√°rios finais. <br><br>  Uma das solu√ß√µes √© implementar processos de controle de qualidade de software em v√°rios est√°gios do Pipeline de CI / CD, adicionar v√°rios scripts para restaurar o sistema em caso de acidente.  Lembre-se tamb√©m de que temos DevOps.  As empresas esperam receber um novo produto o mais r√°pido poss√≠vel.  Portanto, todas as nossas verifica√ß√µes e scripts devem ser automatizados. <br><br>  A tarefa √© dividida em dois componentes: <br><br><ul><li>  controle de qualidade de montagens na fase de teste (para automatizar o processo de captura de montagens abaixo do padr√£o); </li><li>  controle de qualidade de software no ambiente de produ√ß√£o (mecanismos autom√°ticos de detec√ß√£o de problemas e poss√≠veis cen√°rios de autocorre√ß√£o). </li></ul><br><h1>  Ferramenta para monitorar e coletar m√©tricas </h1><br>  Para realizar as tarefas definidas, √© necess√°rio um sistema de monitoramento que possa detectar problemas e transferi-los para os sistemas de automa√ß√£o em v√°rios est√°gios do pipeline de CI / CD.  Al√©m disso, um ponto positivo ser√° se este sistema fornecer m√©tricas √∫teis para v√°rias equipes: desenvolvimento, teste, opera√ß√£o.  E maravilhoso, se for para neg√≥cios. <br><br>  Para coletar m√©tricas, voc√™ pode usar uma combina√ß√£o de sistemas diferentes (Prometheus, ELK Stack, Zabbix, etc.), mas, na minha opini√£o, as solu√ß√µes APM ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Application Performance Monitoring</a> ) s√£o mais adequadas para essas tarefas, o que pode simplificar bastante sua vida. <br><br>  Como parte do meu trabalho no servi√ßo de acompanhantes, comecei a fazer um projeto semelhante usando a solu√ß√£o de classe APM da Dynatrace.  Agora, trabalhando como integrador, conhe√ßo muito bem o mercado de sistemas de monitoramento.  Minha opini√£o subjetiva: Dynatrace √© mais adequado para essas tarefas. <br>  A solu√ß√£o Dynatrace fornece uma exibi√ß√£o horizontal de cada opera√ß√£o do usu√°rio com um profundo grau de detalhe at√© o n√≠vel de execu√ß√£o do c√≥digo.  Voc√™ pode rastrear toda a cadeia de intera√ß√£o entre v√°rios servi√ßos de informa√ß√µes: dos n√≠veis de front-end de aplicativos da web e m√≥veis, servidores de aplicativos de back-end, barramento de integra√ß√£o a uma chamada espec√≠fica ao banco de dados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/223/706/776/223706776e2f818b7c9e58451f3b5874.png"></div>  <i><a href="">Fonte</a></i>  <i>Constru√ß√£o autom√°tica de todas as depend√™ncias entre os componentes do sistema</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/73f/796/e80/73f796e80d722c47cc6044f1c60bf2c8.png"></div>  <i><a href="">Fonte</a></i>  <i>Detec√ß√£o e constru√ß√£o autom√°ticas de um caminho para uma opera√ß√£o de servi√ßo</i> <br><br>  Lembre-se tamb√©m de que precisamos nos integrar com v√°rias ferramentas de automa√ß√£o.  Aqui, a solu√ß√£o possui uma API conveniente que permite enviar e receber v√°rias m√©tricas e eventos. <br><br>  Em seguida, passaremos a uma discuss√£o mais detalhada sobre como resolver tarefas usando o sistema Dynatrace. <br><br><h1>  Tarefa 1. Automa√ß√£o do controle de qualidade de montagens na fase de teste </h1><br>  A primeira tarefa √© encontrar problemas o mais cedo poss√≠vel nos est√°gios do pipeline de entrega de aplicativos.  Somente constru√ß√µes "boas" de c√≥digo devem atingir o ambiente de produ√ß√£o.  Para fazer isso, monitores adicionais devem ser inclu√≠dos no seu pipeline no est√°gio de teste para verificar a qualidade de seus servi√ßos. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/034/bd9/498/034bd9498761bf4addffd97f68e70699.png"></div><br><br>  Vamos dar uma olhada nas etapas de como implementar isso e automatizar esse processo: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1b6/2eb/b7f/1b62ebb7fa1fd652fc7ca5110926676e.png"></div>  <i><a href="">Fonte</a></i> <br><br>  A figura mostra o fluxo das etapas automatizadas de controle de qualidade de software: <br><br><ol><li>  implanta√ß√£o de um sistema de monitoramento (instala√ß√£o de agentes); </li><li>  defini√ß√£o de eventos de avalia√ß√£o da qualidade do seu software (m√©tricas e valores-limite) e sua transfer√™ncia para o sistema de monitoramento; </li><li>  testes de gera√ß√£o e desempenho de carga; </li><li>  coletando dados de desempenho e disponibilidade em um sistema de monitoramento; </li><li>  transfer√™ncia de dados de teste com base em eventos de avalia√ß√£o de qualidade de software do sistema de monitoramento para o sistema de CI / CD.  An√°lise de montagem autom√°tica. </li></ol><br>  <b>Etapa 1. Implemente um sistema de monitoramento</b> <br><br>  Voc√™ deve primeiro instalar os agentes em seu ambiente de teste.  Ao mesmo tempo, a solu√ß√£o Dynatrace possui um recurso interessante - ela usa o agente universal OneAgent, instalado na inst√¢ncia do sistema operacional (Windows, Linux, AIX), detecta automaticamente seus servi√ßos e come√ßa a coletar dados de monitoramento neles.  Voc√™ n√£o precisa configurar um agente separadamente para cada processo.  Uma situa√ß√£o semelhante ser√° para plataformas de nuvem e cont√™ineres.  Ao mesmo tempo, voc√™ tamb√©m pode automatizar a instala√ß√£o de agentes.  O Dynatrace se encaixa perfeitamente no conceito de "infraestrutura como c√≥digo" ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Infraestrutura como c√≥digo ou IaC</a> ): existem scripts e instru√ß√µes prontas para todas as plataformas populares.  Incorpore o agente na configura√ß√£o do seu servi√ßo e, ao implant√°-lo, voc√™ imediatamente obt√©m um novo servi√ßo com um agente j√° em execu√ß√£o. <br><br>  <b>Etapa 2. Identifique seus eventos de avalia√ß√£o de qualidade de software</b> <br><br>  Agora voc√™ precisa determinar a lista de servi√ßos e opera√ß√µes de neg√≥cios.  √â importante considerar exatamente as opera√ß√µes do usu√°rio cr√≠ticas aos neg√≥cios para o seu servi√ßo.  Aqui, recomendo a consultoria com analistas de neg√≥cios e sistemas. <br><br>  Em seguida, √© necess√°rio determinar quais m√©tricas voc√™ deseja incluir na verifica√ß√£o para cada um dos n√≠veis.  Por exemplo, pode ser tempo de execu√ß√£o (com separa√ß√£o por m√©dia, mediana, percentil etc.), erros (l√≥gico, servi√ßo, infraestrutura etc.) e v√°rias m√©tricas de infraestrutura (heap de mem√≥ria, coletor de lixo, contagem de encadeamentos, etc.). <br><br>  Para automa√ß√£o e facilidade de uso, a equipe do DevOps apresenta o conceito de "Monitoramento como c√≥digo".  O que quero dizer com isso √© que um desenvolvedor / testador pode escrever um arquivo JSON simples que define os indicadores de controle de qualidade de software. <br><br>  Vejamos um exemplo de um arquivo JSON.  Objetos da API Dynatrace s√£o usados ‚Äã‚Äãcomo um par de chave / valor (consulte a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">API Dynatrace para obter uma descri√ß√£o da API</a> ). <br><br><pre><code class="json hljs">{    <span class="hljs-attr"><span class="hljs-attr">"timeseries"</span></span>: [    {      <span class="hljs-attr"><span class="hljs-attr">"timeseriesId"</span></span>: <span class="hljs-string"><span class="hljs-string">"service.ResponseTime"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"aggregation"</span></span>: <span class="hljs-string"><span class="hljs-string">"avg"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"Frontend"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"severe"</span></span>: <span class="hljs-number"><span class="hljs-number">250000</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"warning"</span></span>: <span class="hljs-number"><span class="hljs-number">1000000</span></span>    },    {      <span class="hljs-attr"><span class="hljs-attr">"timeseriesId"</span></span>: <span class="hljs-string"><span class="hljs-string">"service.ResponseTime "</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"aggregation"</span></span>: <span class="hljs-string"><span class="hljs-string">"avg"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>: <span class="hljs-string"><span class="hljs-string">"Backend"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"severe"</span></span>: <span class="hljs-number"><span class="hljs-number">4000000</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"warning"</span></span>: <span class="hljs-number"><span class="hljs-number">8000000</span></span>    },    {      <span class="hljs-attr"><span class="hljs-attr">"timeseriesId"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker.Container.Cpu"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"aggregation"</span></span>: <span class="hljs-string"><span class="hljs-string">"avg"</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"severe"</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>,      <span class="hljs-attr"><span class="hljs-attr">"warning"</span></span>: <span class="hljs-number"><span class="hljs-number">70</span></span>    }  ] }</code> </pre> <br>  O arquivo √© uma matriz de defini√ß√µes de s√©ries temporais: <br><br><ul><li>  timeseriesId - m√©trica verificada, por exemplo, Tempo de resposta, Contagem de erros, Mem√≥ria usada, etc; </li><li>  agrega√ß√£o - o n√≠vel de agrega√ß√£o de m√©tricas, no nosso caso, m√©d, mas voc√™ pode usar o que precisar (m√©d, min, max, soma, contagem, percentil); </li><li>  tags - uma tag de objeto no sistema de monitoramento ou voc√™ pode especificar um identificador de objeto espec√≠fico; </li><li>  grave e aviso - esses indicadores ajustam os valores limite de nossas m√©tricas; se o valor dos testes exceder o limite grave, nossa montagem ser√° marcada como sem √™xito. </li></ul><br>  A figura a seguir mostra um exemplo do uso dessas lixeiras. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/087/be4/db9/087be4db9e8c7a51de722110e526f39a.png"></div>  <i><a href="">Fonte</a></i> <br><br>  <b>Etapa 3. Gera√ß√£o de Carga</b> <br><br>  Depois de determinarmos os n√≠veis de qualidade de nosso servi√ßo, √© necess√°rio gerar uma carga de teste.  Voc√™ pode usar qualquer uma das ferramentas de teste que s√£o convenientes para voc√™, por exemplo, Jmeter, Selenium, Neotys, Gatling, etc. <br><br>  O sistema de monitoramento Dynatrace permite capturar v√°rios metadados de seus testes e reconhecer qual teste est√° relacionado a qual ciclo de libera√ß√£o e servi√ßo.  √â recomend√°vel adicionar cabe√ßalhos adicionais √†s solicita√ß√µes HTTP de teste. <br><br>  A figura a seguir mostra um exemplo em que, usando o cabe√ßalho opcional X-Dynatrace-Test, marcamos que esse teste se refere ao teste da opera√ß√£o de adi√ß√£o de um item ao carrinho. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/96a/3b8/277/96a3b8277f52b4643cc05acc38b7258b.png"></div>  <i><a href="https://dt-cdn.net/images/dynatrace-loadtesting-">Fonte</a></i> <br><br>  Ao executar cada teste de carga, voc√™ envia informa√ß√µes contextuais adicionais ao Dynatrace usando a API de eventos do servidor de CI / CD.  Assim, o sistema pode distinguir entre diferentes testes entre si. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/574/f50/948/574f509484f4a0fcc4dea39f9a39870e.png"></div>  <i><a href="">Fonte</a></i>  <i>Evento no sistema de monitoramento sobre o lan√ßamento do teste de carga</i> <br><br>  <b>Etapa 4-5.</b>  <b>Coletar dados de desempenho e transferir dados para um sistema de CI / CD</b> <br><br>  Juntamente com o teste gerado, um evento √© transmitido ao sistema de monitoramento sobre a necessidade de coletar dados sobre a verifica√ß√£o de indicadores de qualidade de servi√ßo.  Nosso arquivo JSON tamb√©m √© indicado, no qual as principais m√©tricas s√£o definidas. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/584/427/af6/584427af69b059959ece68661cefbf9e.png"></div>  <i>Um evento sobre a necessidade de verificar a qualidade do software gerado no servidor de CI / CD para enviar ao sistema de monitoramento</i> <br><br>  Em nosso exemplo, o evento de controle de qualidade √© chamado <i>perfSigDynatraceReport</i> (Performance_Signature <i>)</i> - este √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">plug</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">in</a> pronto para integra√ß√£o com o Jenkins, desenvolvido pelos profissionais da T-Systems Multimedia Solutions.  Cada evento sobre o in√≠cio do teste cont√©m informa√ß√µes sobre o servi√ßo, n√∫mero da compila√ß√£o e tempo de teste.  O plug-in coleta valores de desempenho durante a montagem, avalia-os e compara o resultado com montagens anteriores e requisitos n√£o funcionais. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e58/f13/7d8/e58f137d890618ddb2c59be5eb292b3d.png"></div>  <i>Evento no sistema de monitoramento sobre o in√≠cio do controle de qualidade da montagem.</i>  <i><a href="">Fonte</a></i> <br><br>  Ap√≥s a conclus√£o do teste, todas as m√©tricas de avalia√ß√£o da qualidade do software s√£o transferidas de volta ao sistema de integra√ß√£o cont√≠nua, por exemplo, Jenkins, que gera um relat√≥rio sobre os resultados. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/0y/nl/rc/0ynlrc9qxeffy9v4ei_s4ihn5v0.png"></div>  <i>O resultado das estat√≠sticas de montagem no servidor de CI / CD.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Para cada montagem individual, vemos estat√≠sticas de cada m√©trica definida durante todo o teste.  Tamb√©m vemos se houve viola√ß√µes em determinados valores limite (avisos e limites severos).  Com base nas m√©tricas agregadas, toda a montagem √© marcada como est√°vel, inst√°vel ou com falha.  Al√©m disso, por conveni√™ncia, voc√™ pode adicionar indicadores para comparar a montagem atual com a anterior no relat√≥rio. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09a/a3d/106/09aa3d106d50eb6be368d1be57e5ee39.png"></div>  <i>Visualize estat√≠sticas detalhadas de montagem no servidor de CI / CD.</i>  <i><a href="">Fonte</a></i> <br><br>  <b>Compara√ß√£o detalhada de duas montagens</b> <br><br>  Se necess√°rio, voc√™ pode ir para a interface do Dynatrace, ver mais detalhadamente as estat√≠sticas de cada uma de suas montagens e compar√°-las. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/586/d52/12d/586d5212dcf21aeb30d8f7a6bbd4f158.png"></div>  <i>Compara√ß√£o de estat√≠sticas de montagem no Dynatrace.</i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  <b>Conclus√µes</b> <br><br>  Como resultado, obtemos o servi√ßo "monitoramento como servi√ßo", automatizado no pipeline de integra√ß√£o cont√≠nua.  O desenvolvedor ou testador s√≥ precisa determinar a lista de m√©tricas no arquivo JSON e tudo o mais acontece automaticamente.  Temos controle de qualidade transparente dos lan√ßamentos: todas as notifica√ß√µes sobre desempenho, consumo de recursos ou regress√µes arquiteturais. <br><br><h1>  Tarefa 2. Automa√ß√£o do controle de qualidade de software em um ambiente de produ√ß√£o </h1><br>  Portanto, resolvemos o problema de como automatizar o processo de monitoramento no est√°gio de teste no Pipeline.  Assim, minimizamos a porcentagem de montagens de baixa qualidade que atingem o ambiente alimentar. <br><br>  Mas o que fazer se um software ruim ainda chegar ao ponto de venda, ou apenas algo quebrar.  Para a utopia, quer√≠amos ter mecanismos para detectar automaticamente problemas e, se poss√≠vel, o pr√≥prio sistema restauraria sua capacidade de trabalho, pelo menos √† noite. <br><br>  Para fazer isso, por analogia com a se√ß√£o anterior, fornecemos verifica√ß√µes autom√°ticas de qualidade de software no ambiente de produ√ß√£o e criamos scripts para autocorre√ß√£o do sistema sob eles. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94d/63e/6c0/94d63e6c0575a310f5982386d731649a.png"></div><br>  <b>Corre√ß√£o autom√°tica como c√≥digo</b> <br><br>  A maioria das empresas j√° possui uma base de conhecimento acumulada em v√°rios tipos de problemas comuns e uma lista de a√ß√µes para corrigi-los, por exemplo, reiniciando processos, limpando recursos, revertendo vers√µes, restaurando altera√ß√µes incorretas na configura√ß√£o, aumentando ou diminuindo o n√∫mero de componentes em um cluster, alternando um contorno azul ou verde e outro <br><br>  Apesar do fato de que muitas das equipes com as quais me comunico conhecem esses casos de uso h√° muitos anos, apenas algumas pensaram e investiram em sua automa√ß√£o. <br><br>  Se voc√™ pensar bem, na implementa√ß√£o de processos para autocorre√ß√£o da sa√∫de do aplicativo, n√£o h√° nada super complicado, voc√™ precisar√° apresentar os cen√°rios de trabalho conhecidos de seus administradores na forma de scripts de c√≥digo (o conceito de "autocorre√ß√£o como c√≥digo") que voc√™ escreveu previamente para cada caso espec√≠fico.  Os cen√°rios de reparo autom√°tico devem abordar a causa raiz do problema.  Voc√™ mesmo define as a√ß√µes corretas de resposta a incidentes. <br><br>  Qualquer m√©trica do seu sistema de monitoramento pode atuar como um gatilho para a execu√ß√£o de um script, o principal √© que essas m√©tricas determinem com precis√£o que tudo est√° ruim, j√° que eu n√£o gostaria de obter falsos positivos em um ambiente produtivo. <br><br>  Voc√™ pode usar qualquer sistema ou conjunto de sistemas: Prometheus, ELK Stack, Zabbix, etc.  Mas vou dar alguns exemplos baseados na solu√ß√£o APM (Dynatrace ser√° novamente um exemplo), o que tamb√©m ajudar√° a tornar sua vida mais f√°cil. <br><br>  Em primeiro lugar, h√° tudo relacionado √† operacionalidade em termos de aplica√ß√£o.  A solu√ß√£o fornece centenas de m√©tricas em v√°rios n√≠veis que voc√™ pode usar como gatilhos: <br><br><ul><li>  n√≠vel de usu√°rio (navegadores, aplicativos m√≥veis, dispositivos de IoT, comportamento do usu√°rio, convers√£o etc.); </li><li>  n√≠vel de servi√ßo e opera√ß√µes (desempenho, disponibilidade, erros, etc.); </li><li>  n√≠vel de infraestrutura do aplicativo (m√©tricas do sistema operacional host, JMX, MQ, servidor da web etc.); </li><li>  n√≠vel da plataforma (virtualiza√ß√£o, nuvem, cont√™iner etc.). </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac2/5f9/480/ac25f94800d26b672cace37d7495d008.png"></div>  <i>Monitorando os n√≠veis no Dynatrace.</i>  <i><a href="">Fonte</a></i> <br><br>  Em segundo lugar, como eu disse anteriormente, o Dynatrace possui uma API aberta, o que torna muito conveniente integr√°-lo a v√°rios sistemas de terceiros.  Por exemplo, enviando uma notifica√ß√£o ao sistema de automa√ß√£o quando os par√¢metros de controle s√£o excedidos. <br><br>  Abaixo est√° um exemplo para interagir com o Ansible. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b90/a7a/d74/b90a7ad74b93428578dafb42235e19b4.png"></div>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fonte</a></i> <br><br>  Abaixo, darei alguns exemplos de exatamente qual automa√ß√£o pode ser feita.  Isso √© apenas parte dos casos; list√°-los em seu ambiente pode ser limitado apenas pela sua imagina√ß√£o e pelos recursos de suas ferramentas de monitoramento. <br><br>  <b>1. Implementa√ß√£o incorreta - revers√£o de vers√£o</b> <br><br>  Mesmo que todos testemos muito bem em um ambiente de teste, ainda h√° uma chance de que uma nova vers√£o possa matar seu aplicativo no ambiente de prod.  O mesmo fator humano n√£o foi cancelado. <br><br>  Na pr√≥xima figura, vemos que h√° um salto acentuado no tempo de execu√ß√£o das opera√ß√µes no servi√ßo.  O in√≠cio desse salto coincide com o tempo de implanta√ß√£o do aplicativo.  Transferimos todas essas informa√ß√µes como eventos para o sistema de automa√ß√£o.  Se a capacidade de manuten√ß√£o do servi√ßo n√£o normalizar ap√≥s o tempo especificado por n√≥s expirar, um script ser√° chamado automaticamente que reverte a vers√£o para a vers√£o anterior. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/f9/ps/lkf9psxvdi6kivm-oa29pvypblw.png"></div>  <i>Degrada√ß√£o do desempenho ap√≥s a implanta√ß√£o.</i>  <i><a href="">Fonte</a></i> <br><br>  <b>2. Recurso carregando em 100% - adicione um n√≥ ao roteamento</b> <br><br>  No exemplo a seguir, o sistema de monitoramento determina que um dos componentes possui 100% de utiliza√ß√£o da CPU. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a6c/f16/d1a/a6cf16d1aebeb435e1a24c3760563f54.png"></div>  <i>Utiliza√ß√£o da CPU 100%</i> <br><br>  V√°rios cen√°rios diferentes s√£o poss√≠veis para este evento.  Por exemplo, o sistema de monitoramento verifica adicionalmente se a falta de recursos est√° associada a um aumento na carga no servi√ßo.  Se sim, √© executado um script que adiciona automaticamente o n√≥ ao roteamento, restaurando assim o sistema como um todo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/du/kc/1z/dukc1zzqhiae9ymfilbxpoem2qo.jpeg"></div>  <i>Escalando n√≥s ap√≥s um incidente</i> <br><br>  <b>3. Falta de espa√ßo no disco r√≠gido - Limpeza de disco</b> <br><br>  Eu acho que muitos desses processos j√° est√£o automatizados.  Usando o APM, voc√™ tamb√©m pode monitorar o espa√ßo livre no subsistema de disco.  Na aus√™ncia de espa√ßo ou opera√ß√£o lenta do disco, chamamos o script para limpar ou adicionar espa√ßo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea8/0cc/b7f/ea80ccb7f269eb465f30e7c94ba18c6d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d8/f22/64d/3d8f2264dd7f312dac430eaa4446d845.png"></div>  <i>Carregamento de disco 100%</i> <br><br>  <b>4. Baixa atividade do usu√°rio ou baixa convers√£o - alterne entre os ramos azul e verde</b> <br><br>  Costumo encontrar clientes usando dois circuitos (implanta√ß√£o azul-verde) para aplicativos no ambiente de produ√ß√£o.  Isso permite que voc√™ alterne rapidamente entre filiais ao entregar novos lan√ßamentos.  Muitas vezes ap√≥s a implanta√ß√£o, podem ocorrer altera√ß√µes importantes que n√£o s√£o percebidas imediatamente.  No entanto, a degrada√ß√£o no desempenho e disponibilidade pode n√£o ser observada.  Para responder rapidamente a essas altera√ß√µes, √© melhor usar v√°rias m√©tricas que refletem o comportamento do usu√°rio (n√∫mero de sess√µes e a√ß√µes do usu√°rio, convers√£o, taxa de rejei√ß√£o).  A figura a seguir mostra um exemplo no qual, quando a convers√£o cai, ocorre a altern√¢ncia entre ramifica√ß√µes de software. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f9c/db2/776/f9cdb27767029d743a6f7b51a31fc87b.png"></div>  <i>Queda de convers√£o ap√≥s alternar entre ramifica√ß√µes de software.</i>  <i><a href="">Fonte</a></i> <br><br>  <b>Mecanismos autom√°ticos de determina√ß√£o de problemas</b> <br><br>  No final, darei mais um exemplo, do qual gosto mais no Dynatrace. <br><br>  Em parte da minha hist√≥ria sobre a automa√ß√£o do controle de qualidade da montagem em um ambiente de teste, determinamos todos os valores limite no modo manual.  Isso √© normal para um ambiente de teste, o pr√≥prio testador determina os indicadores antes de cada teste, dependendo da carga.  No ambiente de produ√ß√£o, √© desej√°vel que os problemas sejam detectados automaticamente, levando em considera√ß√£o os v√°rios mecanismos da linha de base. <br><br>  O Dynatrace possui interessantes ferramentas de intelig√™ncia artificial incorporadas que, baseadas nos mecanismos para determinar m√©tricas an√¥malas (linha de base) e construir um mapa de intera√ß√£o entre todos os componentes, comparando e correlacionando eventos entre si, determinam anomalias no trabalho do seu servi√ßo e fornecem informa√ß√µes detalhadas sobre cada problema e causa raiz. <br><br>  Ao analisar automaticamente as depend√™ncias entre os componentes, o Dynatrace determina n√£o apenas se o servi√ßo problem√°tico √© a principal causa, mas tamb√©m sua depend√™ncia de outros servi√ßos.  No exemplo abaixo, o Dynatrace monitora e avalia automaticamente a integridade de cada servi√ßo como parte de uma transa√ß√£o, identifica o servi√ßo Golang como o principal motivo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/623/f52/afa623f525f3c5e2565fcc6382c173e3.png"></div>  <i>Um exemplo de determina√ß√£o da causa raiz de uma falha.</i>  <i><a href="">Fonte</a></i> <br><br>  A figura a seguir mostra o processo de monitoramento de problemas com seu aplicativo desde o in√≠cio do incidente. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fu/z_/rt/fuz_rt4omgppab3zkuxs4b-xfmm.gif"></div>  <i>Visualiza√ß√£o de um problema emergente com a exibi√ß√£o de todos os componentes e eventos neles</i> <br><br>  O sistema de monitoramento compilou uma cronologia completa dos eventos sobre o problema.  Na janela abaixo da linha do tempo, vemos todos os principais eventos em cada um dos componentes.  Com base nesses eventos, voc√™ pode especificar procedimentos para corre√ß√£o autom√°tica na forma de scripts de c√≥digo. <br><br>  Al√©m disso, aconselho a integrar o sistema de monitoramento ao Service Desk ou a um rastreador de erros.  Se ocorrer um problema, os desenvolvedores recebem rapidamente informa√ß√µes completas para sua an√°lise no n√≠vel do c√≥digo no ambiente de produ√ß√£o. <br><br><h1>  Conclus√£o </h1><br>  Como resultado, acabamos com um pipeline de CI / CD com verifica√ß√µes de qualidade de software automatizadas integradas no Pipeline.  Minimizamos o n√∫mero de montagens de baixa qualidade, aumentamos a confiabilidade do sistema como um todo e, se ainda prejudicarmos o desempenho do sistema, lan√ßamos mecanismos para restaur√°-lo. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9e3/1c3/ae2/9e31c3ae24cc9f07a4771167ad2043d3.png"></div><br>  Definitivamente, vale a pena o esfor√ßo para automatizar o monitoramento da qualidade do software, nem sempre √© um processo r√°pido, mas com o tempo ele dar√° frutos.  Eu recomendo que, depois de resolver um novo incidente no ambiente do prod, pense imediatamente em quais monitores adicionar para verifica√ß√µes no ambiente de teste, a fim de evitar uma m√° constru√ß√£o no prod, e tamb√©m crie um script para corrigir automaticamente esses problemas. <br><br>  Espero que meus exemplos o ajudem em seus empreendimentos.  Tamb√©m ser√° interessante para mim ver seus exemplos de m√©tricas usadas para a implementa√ß√£o de sistemas de autocorre√ß√£o. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bea/ccc/1c5/beaccc1c5f2fb65ac9cf91e6dda3bbd5.jpg"></div>  <i><a href="">Fonte</a></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt451630/">https://habr.com/ru/post/pt451630/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt451620/index.html">Autoriza√ß√£o autom√°tica no cart√£o Strava Heatmap</a></li>
<li><a href="../pt451622/index.html">Sobre contagem de bits, tipos n√£o assinados no Kotlin e sobre situa√ß√µes em que a economia em correspond√™ncias √© justificada</a></li>
<li><a href="../pt451624/index.html">Sobre como Harry Potter molda a educa√ß√£o russa, √© claro, n√£o onde voc√™ precisa</a></li>
<li><a href="../pt451626/index.html">Aprendendo sem professor: um aluno curioso</a></li>
<li><a href="../pt451628/index.html">Avalia√ß√£o da 3D Expo em abril de 2019</a></li>
<li><a href="../pt451634/index.html">Como somos analisados ‚Äã‚Äãem lojas e restaurantes</a></li>
<li><a href="../pt451636/index.html">Cinco anos de escravid√£o</a></li>
<li><a href="../pt451638/index.html">Anima√ß√£o em aplicativos m√≥veis: testando Lottie</a></li>
<li><a href="../pt451640/index.html">Game of Thrones: construindo infogr√°ficos sobre assassinatos, sexo, viagens a Westeros e muito mais</a></li>
<li><a href="../pt451642/index.html">Encontrar um caminho entre obst√°culos redondos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>