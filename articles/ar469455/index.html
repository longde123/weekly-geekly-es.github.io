<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐๏ธ ๐จ๐ปโ๐ ๐ ุงูุชุฑุญูู ูู Nginx ุฅูู ูุจุนูุซ Proxy ๐ถ๐ฟ ๐ ๐๐ป</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุง ูุง ูุจุฑ! ุฃูุฌู ุงูุชุจุงููู ุฅูู ุชุฑุฌูุฉ ุงูููุดูุฑ : ุงูุชุฑุญูู ูู Nginx ุฅูู Envoy Proxy . 


 Envoy ูู ุฎุงุฏู ูููู ููุฒุน ุนุงูู ุงูุฃุฏุงุก (ููุชูุจ ูู C ++) ูุตูู ููุฎุฏูุง...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุงูุชุฑุญูู ูู Nginx ุฅูู ูุจุนูุซ Proxy</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/469455/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฑุญุจุง ูุง ูุจุฑ!  ุฃูุฌู ุงูุชุจุงููู ุฅูู ุชุฑุฌูุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูููุดูุฑ</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุฑุญูู ูู Nginx ุฅูู Envoy Proxy</a> . </p><br><p style=";text-align:right;direction:rtl">  Envoy ูู ุฎุงุฏู ูููู ููุฒุน ุนุงูู ุงูุฃุฏุงุก (ููุชูุจ ูู C ++) ูุตูู ููุฎุฏูุงุช ูุงูุชุทุจููุงุช ุงููุฑุฏูุฉ ุ ููุง ุฃูู ูุงูู ุงุชุตุงู ู "ุทุงุฆุฑุฉ ุจูุงูุงุช ุนุงูููุฉ" ุชู ุชุตููููุง ูุจููุงุช "ุดุจูุฉ ุงูุฎุฏูุฉ" ุงููุจูุฑุฉ ุงูุชู ุชูุฏููุง ุฎุฏูุงุช microservice.  ุนูุฏ ุฅูุดุงุฆู ุ ุชู ุงูุฃุฎุฐ ูู ุงูุงุนุชุจุงุฑ ุญููู ุงููุดููุงุช ุงูุชู ูุดุฃุช ุฃุซูุงุก ุชุทููุฑ ุฎูุงุฏู ูุซู NGINX ู HAProxy ูููุงุฒูุงุช ุชุญููู ุงูุฃุฌูุฒุฉ ูููุงุฒูุงุช ุชุญููู ุงูุณุญุงุจุฉ.  ูุนูู Envoy ูุน ูู ุชุทุจูู ูููุฎุต ุงูุดุจูุฉ ุ ููููุฑ ูุธุงุฆู ูุดุชุฑูุฉ ุจุบุถ ุงููุธุฑ ุนู ุงููุธุงู ุงูุฃุณุงุณู.  ุนูุฏูุง ุชูุฑ ุฌููุน ุญุฑูุงุช ุงูููุงุชุจ ูู ุงูุจููุฉ ุงูุชุญุชูุฉ ุนุจุฑ ุดุจูุฉ Envoy ุ ูุตุจุญ ูู ุงูุณูู ุชุตูุฑ ููุงุทู ุงููุดููุงุช ุงูุชู ุชุชููุฒ ุจุงูููุงุญุธุฉ ุงููุชุณูุฉ ุ ูุถุจุท ุงูุฃุฏุงุก ุงูููู ุ ูุฅุถุงูุฉ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ ูู ูููุน ูุนูู. </p><br><h2 id="vozmozhnosti" style=";text-align:right;direction:rtl">  ุงูุงุญุชูุงูุงุช </h2><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> ุฎุงุฑุฌ ุจููุฉ ุงูุนูููุฉ: ุงููุจุนูุซ ูู ุฎุงุฏู ูุณุชูู ูุนุงูู ุงูุฃุฏุงุก ูุณุชููู ูููุฉ ุตุบูุฑุฉ ูู ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู.  ููู ูุนูู ุฌูุจุง ุฅูู ุฌูุจ ูุน ุฃู ูุบุฉ ุงูุชุทุจูู ุฃู ุงูุฅุทุงุฑ. </li><li style=";text-align:right;direction:rtl">  ุฏุนู http / 2 ู grpc: ูุฏู ุงููุจุนูุซ ุฏุนู ูู ุงูุฏุฑุฌุฉ ุงูุฃููู ูู http / 2 ู grpc ููุงุชุตุงูุงุช ุงููุงุฑุฏุฉ ูุงูุตุงุฏุฑุฉ.  ูุฐุง ูููู ุดูุงู ูู http / 1.1 ุฅูู http / 2. </li><li style=";text-align:right;direction:rtl">  ููุงุฒูุฉ ุงูุญูู ุงููุญุณููุฉ: ูุฏุนู ุงููุจุนูุซ ููุฒุงุช ููุงุฒูุฉ ุงูุชุญููู ุงููุชูุฏูุฉ ุ ุจูุง ูู ุฐูู ุงููุญุงููุงุช ุงูุชููุงุฆูุฉ ูุงูุฏุงุฆุฑุฉ ุงูููุชูุญุฉ ูุงูุญุฏ ุงูุฃูุตู ููุณุฑุนุฉ ุงูุนุงูููุฉ ูุทูุจุงุช ุงูุชุธููู ูููุงุฒูุฉ ุชุญููู ุงูููุทูุฉ ุงููุญููุฉ ููุง ุฅูู ุฐูู. </li><li style=";text-align:right;direction:rtl">  ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุฅุฏุงุฑุฉ ุงูุชูููู: ูููุฑ envoy ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ูููุฉ ูุฅุฏุงุฑุฉ ุงูุชูููู ุงูุฎุงุต ุจู ุฏููุงูููููุง. </li><li style=";text-align:right;direction:rtl">  ูุงุจููุฉ ุงูููุงุญุธุฉ: ููุงุญุธุฉ ุนูููุฉ ูุญุฑูุฉ ูุฑูุฑ L7 ุ ุฏุนู ูุฏูุฌ ููุชุชุจุน ุงูููุฒุน ูููุงุญุธุฉ mongodb ู dynamodb ูุงูุนุฏูุฏ ูู ุงูุชุทุจููุงุช ุงูุฃุฎุฑู. </li></ul><a name="habracut"></a><br><h2 id="shag-1---primer-konfiga-nginx" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 1 - ูุซุงู NGINX Config </h2><br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู ูุฐุง ุงูุจุฑูุงูุฌ ุงููุตู ููู <em>nginx.conf</em> ุชู ุฅูุดุงุคู ุฎุตูุตูุง ุ ุงุณุชูุงุฏูุง ุฅูู ูุซุงู ูุงูู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">NGINX Wiki</a> .  ููููู ุนุฑุถ ุงูุชูููู ูู ุงููุญุฑุฑ ุนู ุทุฑูู ูุชุญ <em>nginx.conf</em> </p><br><p style=";text-align:right;direction:rtl">  ูุตุฏุฑ ุงูุชูููู nginx </p><br><pre style=";text-align:right;direction:rtl"><code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">user</span></span> www www; <span class="hljs-attribute"><span class="hljs-attribute">pid</span></span> /var/run/nginx.pid; <span class="hljs-attribute"><span class="hljs-attribute">worker_processes</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-section"><span class="hljs-section">events</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">worker_connections</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span>; } <span class="hljs-section"><span class="hljs-section">http</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">gzip</span></span> <span class="hljs-literal"><span class="hljs-literal">on</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_min_length</span></span> <span class="hljs-number"><span class="hljs-number">1100</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_buffers</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">8k</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">gzip_types</span></span> text/plain; <span class="hljs-attribute"><span class="hljs-attribute">log_format</span></span> main <span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$remote_addr</span></span></span><span class="hljs-string"> - </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$remote_user</span></span></span><span class="hljs-string"> [</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$time_local</span></span></span><span class="hljs-string">] '</span></span> <span class="hljs-string"><span class="hljs-string">'"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$request</span></span></span><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$status</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$bytes_sent</span></span></span><span class="hljs-string"> '</span></span> <span class="hljs-string"><span class="hljs-string">'"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$http_referer</span></span></span><span class="hljs-string">" "</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$http_user_agent</span></span></span><span class="hljs-string">" '</span></span> <span class="hljs-string"><span class="hljs-string">'"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$gzip_ratio</span></span></span><span class="hljs-string">"'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">log_format</span></span> download <span class="hljs-string"><span class="hljs-string">'</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$remote_addr</span></span></span><span class="hljs-string"> - </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$remote_user</span></span></span><span class="hljs-string"> [</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$time_local</span></span></span><span class="hljs-string">] '</span></span> <span class="hljs-string"><span class="hljs-string">'"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$request</span></span></span><span class="hljs-string">" </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$status</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$bytes_sent</span></span></span><span class="hljs-string"> '</span></span> <span class="hljs-string"><span class="hljs-string">'"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$http_referer</span></span></span><span class="hljs-string">" "</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$http_user_agent</span></span></span><span class="hljs-string">" '</span></span> <span class="hljs-string"><span class="hljs-string">'"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$http_range</span></span></span><span class="hljs-string">" "</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sent_http_content_range</span></span></span><span class="hljs-string">"'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> targetCluster { 172.18.0.3:80; 172.18.0.4:80; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">8080</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> one.example.com www.one.example.com; <span class="hljs-attribute"><span class="hljs-attribute">access_log</span></span> /var/log/nginx.access_log main; <span class="hljs-attribute"><span class="hljs-attribute">error_log</span></span> /var/log/nginx.error_log <span class="hljs-literal"><span class="hljs-literal">info</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://targetCluster/; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; } } }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนุงุฏุฉ ูุง ุชุญุชูู ุชููููุงุช NGINX ุนูู ุซูุงุซุฉ ุนูุงุตุฑ ุฑุฆูุณูุฉ: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุชูููู ุฎุงุฏู NGINX ููููู ุงูุณุฌู ููุธุงุฆู Gzip.  ูุชู ุชุญุฏูุฏ ูุฐุง ุนูู ุงูุตุนูุฏ ุงูุนุงููู ูู ุฌููุน ุงูุญุงูุงุช. </li><li style=";text-align:right;direction:rtl">  ุชููุฆุฉ NGINX ููุจูู ุงูุทูุจุงุช ุงูุฎุงุตุฉ <em>ุจูุถูู one.example.com</em> ุนูู ุงููููุฐ 8080. </li><li style=";text-align:right;direction:rtl">  ุชุญุฏูุฏ ูููุน ูุฌูุชู ุ ูููููุฉ ุงูุชุนุงูู ูุน ุญุฑูุฉ ุงููุฑูุฑ ูุฃุฌุฒุงุก ูุฎุชููุฉ ูู URL. </li></ol><br><p style=";text-align:right;direction:rtl">  ูู ูุชู ุชุทุจูู ูู ุงูุชููุฆุฉ ุนูู Envoy Proxy ุ ููู ุชุญุชุงุฌ ุฅูู ุชูููู ุจุนุถ ุงูุฅุนุฏุงุฏุงุช.  ูุญุชูู Envoy Proxy ุนูู <strong>ุฃุฑุจุนุฉ ุฃููุงุน ุฑุฆูุณูุฉ</strong> ุชุฏุนู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุฃุณุงุณูุฉ ุงูุชู ุชูุฏููุง NGINX.  ุฌููุฑ ูู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <strong>ุงููุณุชูุนูู:</strong> ููุฑุฑูู ููู ููุจู Envoy Proxy ุงูุทูุจุงุช ุงููุงุฑุฏุฉ.  ูุฏุนู Envoy Proxy ุญุงูููุง ุงููุณุชูุนูู ุงููุนุชูุฏูู ุนูู TCP ููุท.  ุจูุฌุฑุฏ ุฅูุดุงุก ุงูุงุชุตุงู ุ ูุชู ูููู ุฅูู ูุฌููุนุฉ ูู ุงููุฑุดุญุงุช ูููุนุงูุฌุฉ. </li><li style=";text-align:right;direction:rtl">  <strong>ุนูุงูู ุงูุชุตููุฉ:</strong> ูู ุฌุฒุก ูู ุจููุฉ ุฎุทูุท ุฃูุงุจูุจ ูููููุง ูุนุงูุฌุฉ ุงูุจูุงูุงุช ุงููุงุฑุฏุฉ ูุงูุตุงุฏุฑุฉ.  ุชุชุถูู ูุฐู ุงููุธููุฉ ุนูุงูู ุชุตููุฉ ุ ูุซู Gzip ุ ุงูุชู ุชุถุบุท ุงูุจูุงูุงุช ูุจู ุฅุฑุณุงููุง ุฅูู ุงูุนููู. </li><li style=";text-align:right;direction:rtl">  <strong>ุฃุฌูุฒุฉ ุงูุชูุฌูู:</strong> ูููููู ุจุฅุนุงุฏุฉ ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงููุฌูุฉ ุงููุทููุจุฉ ุ ูุงููุนุฑููุฉ ุนูู ุฃููุง ูุชูุฉ. </li><li style=";text-align:right;direction:rtl">  <strong>ุงููุชู:</strong> ููู ุชุญุฏุฏ ููุทุฉ ุงูููุงูุฉ ูุฅุนุฏุงุฏุงุช ุงููุฑูุฑ ูุงูุชูููู. </li></ul><br><p style=";text-align:right;direction:rtl">  ุณูู ูุณุชุฎุฏู ูุฐู ุงูููููุงุช ุงูุฃุฑุจุนุฉ ูุฅูุดุงุก ุชูููู Envoy Proxy ููุทุงุจูุฉ ุชูููู NGINX ุงููุญุฏุฏ.  ูุฏู Envoy ูู ุงูุนูู ูุน API ูุงูุชูููู ุงูุฏููุงูููู.  ูู ูุฐู ุงูุญุงูุฉ ุ ุณูุณุชุฎุฏู ุงูุชูููู ุงูุฃุณุงุณู ูุนููุงุช ุซุงุจุชุฉ ูุดูุฑุฉ ูู NGINX. </p><br><h2 id="shag-2---konfiguraciya-nginx" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 2 - ุชูููู NGINX </h2><br><p style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุงูุฌุฒุก ุงูุฃูู ูู <em>nginx.conf</em> ุจุนุถ ููููุงุช NGINX ุงูุฏุงุฎููุฉ ุงูุชู ุชุญุชุงุฌ ุฅูู ุชูููู. </p><br><h4 id="worker-connections-rabochie-soedineniya" style=";text-align:right;direction:rtl">  ุงุชุตุงูุงุช ุงูุนูุงู </h4><br><p style=";text-align:right;direction:rtl">  ูุญุฏุฏ ุงูุชูููู ุฃุฏูุงู ุนุฏุฏ ุนูููุงุช ุงูุนูู ูุงูุงุชุตุงูุงุช.  ูุดูุฑ ูุฐุง ุฅูู ููููุฉ ุชุญุฌูู NGINX ูุชูุจูุฉ ุงูุทูุจ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">worker_processes</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-section"><span class="hljs-section">events</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">worker_connections</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู Envoy Proxy ุจุฅุฏุงุฑุฉ ููุงู ุณูุฑ ุงูุนูู ูุงูุงุชุตุงูุงุช ุจุดูู ูุฎุชูู. </p><br><p style=";text-align:right;direction:rtl">  ููุดุฆ ุงููุจุนูุซ ุณูุฑ ุนูู ููู ูุคุดุฑ ุชุฑุงุจุท ุงูุฃุฌูุฒุฉ ูู ุงููุธุงู.  ูุนูู ูู ูุคุดุฑ ุชุฑุงุจุท ุนุงูู ุญููุฉ ุญุฏุซ ุบูุฑ ุญุธุฑ ูุณุคููุงู ุนู </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุงุณุชูุงุน ุฅูู ูู ูุณุชูุน </li><li style=";text-align:right;direction:rtl">  ูุจูู ุงุชุตุงูุงุช ุฌุฏูุฏุฉ </li><li style=";text-align:right;direction:rtl">  ุฅูุดุงุก ูุฌููุนุฉ ูุฑุดุญ ููุงุชุตุงู </li><li style=";text-align:right;direction:rtl">  ูุนุงูุฌุฉ ุฌููุน ุนูููุงุช ุงูุฅุฏุฎุงู / ุงูุฅุฎุฑุงุฌ ุนูู ูุฏู ุนูุฑ ุงูุงุชุตุงู. </li></ol><br><p style=";text-align:right;direction:rtl">  ุชุชู ูุนุงูุฌุฉ ูุนุงูุฌุฉ ุงูุงุชุตุงู ุงูุฅุถุงููุฉ ุจุงููุงูู ูู ุณูุฑ ุงูุนูู ุ ุจูุง ูู ุฐูู ุฃู ุณููู ุฅุนุงุฏุฉ ุชูุฌูู. </p><br><p style=";text-align:right;direction:rtl">  ููู ุณูุฑ ุนูู ูู Envoy ุ ููุฌุฏ ุงุชุตุงู ูู ุงูุชุฌูุน.  ูุจุงูุชุงูู ุ ุชูุดุฆ ุชุฌูุนุงุช ุงุชุตุงู HTTP / 2 ุงุชุตุงููุง ูุงุญุฏูุง ููู ูุถูู ุฎุงุฑุฌู ูู ูู ูุฑุฉ ุ ูุฅุฐุง ูุงู ููุงู ุฃุฑุจุนุฉ ูุคุดุฑุงุช ุชุฑุงุจุท ุชุงุจุนุฉ ุ ูุณูููู ููุงู ุฃุฑุจุนุฉ ุงุชุตุงูุงุช HTTP / 2 ููู ูุถูู ุฎุงุฑุฌู ูู ุญุงูุฉ ูุณุชูุฑุฉ.  ูู ุฎูุงู ุชุฎุฒูู ูู ุดูุก ูู ุณูุฑ ุนูู ูุงุญุฏ ุ ูููู ูุชุงุจุฉ ุฌููุน ุงูุดูุฑุงุช ุชูุฑูุจูุง ุฏูู ููู ุ ููุง ูู ูุงูุช ูุชุฑุงุจุทุฉ.  ุฅุฐุง ุชู ุชุฎุตูุต ุฃูุซุฑ ูู ุณูุฑ ุงูุนูู ุงูุถุฑูุฑู ุ ููุฏ ูุคุฏู ุฐูู ุฅูู ุงุณุชุฎุฏุงู ุบูุฑ ููุทูู ููุฐุงูุฑุฉ ุ ูุฅูุดุงุก ุนุฏุฏ ูุจูุฑ ูู ุงูุงุชุตุงูุงุช ุงูุฎุงููุฉ ูุชูููู ุนุฏุฏ ุงูุงุชุตุงูุงุช ุงูุชู ุชู ุฅุฑุฌุงุนูุง ุฅูู ุงูุชุฌูุน. </p><br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงููุนูููุงุช ุ ุชูุถู ุจุฒูุงุฑุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุฏููุฉ Envoy Proxy</a> . </p><br><h4 id="konfiguraciya-http" style=";text-align:right;direction:rtl">  ุชูููู HTTP </h4><br><p style=";text-align:right;direction:rtl">  ุชุนุฑูู ูุชูุฉ ุชูููู NGINX ุงูุชุงููุฉ ุฅุนุฏุงุฏุงุช HTTP ุ ูุซู: </p><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูุง ุฃููุงุน ุงูุชูุซูู ุงูุตุงูุช ุงููุฏุนููุฉ </li><li style=";text-align:right;direction:rtl">  ุงููููุงุช ุงูุงูุชุฑุงุถูุฉ </li><li style=";text-align:right;direction:rtl">  ุชูููู Gzip </li></ul><br><p style=";text-align:right;direction:rtl">  ููููู ุชูููู ูุฐู ุงูุฌูุงูุจ ุจุงุณุชุฎุฏุงู ุงููุฑุดุญุงุช ูู Envoy Proxy ุ ูุงูุชู ุณููุงูุดูุง ูุงุญููุง. </p><br><h2 id="shag-3---konfiguraciya-server" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 3 - ุชูููู ุงูุฎุงุฏู </h2><br><p style=";text-align:right;direction:rtl">  ูู ูุชูุฉ ุชูููู HTTP ุ ูุฑุดุฏู ุชูููู NGINX ุฅูู ุงูุงุณุชูุงุน ุนูู ุงููููุฐ 8080 ูุงูุฑุฏ ุนูู ุงูุทูุจุงุช ุงููุงุฑุฏุฉ <em>ูููุทุงููู one.example.com</em> ู <em>www.one.example.com</em> . </p><br><pre style=";text-align:right;direction:rtl"> <code class="nginx hljs"> <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">8080</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> one.example.com www.one.example.com;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฏุงุฎู ุงููุจุนูุซ ุ ุงููุณุชูุนูู ุงูุณูุทุฑุฉ ุนููู. </p><br><h4 id="slushateli-envoy" style=";text-align:right;direction:rtl">  ุงููุณุชูุนูู ุงููุจุนูุซ </h4><br><p style=";text-align:right;direction:rtl">  ูุชูุซู ุงูุฌุงูุจ ุงูุฃูุซุฑ ุฃูููุฉ ูู ุจุฏุก ุงุณุชุฎุฏุงู Envoy Proxy ูู ุชุญุฏูุฏ ุงููุณุชูุนูู.  ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ููู ุชูููู ูุตู ููู ุชุฑูุฏ ุชุดุบูู ูุซูู Envoy. </p><br><p style=";text-align:right;direction:rtl">  ุณููุดุฆ ุงูููุชุทู ุงูููุฌูุฏ ุฃุฏูุงู ูุณุชูุนูุง ุฌุฏูุฏูุง ููุฑุจุทู ุจุงููููุฐ 8080. ูุฎุจุฑ ุงูุชูููู Envoy Proxy ุจุงูููุงูุฐ ุงูุชู ูุฌุจ ุฑุจุทูุง ุจุงูุทูุจุงุช ุงููุงุฑุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ูุณุชุฎุฏู Envoy Proxy ุชุฏููู YAML ูุชููููู.  ููุชุนุฑู ุนูู ูุฐุง ุงูุชุฑููุฒ ุ ุฑุงุฌุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุฑุงุจุท</a> ููุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Copy to Editorstatic_resources: listeners: - name: listener_0 address: socket_address: { address: 0.0.0.0, port_value: 8080 }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุณุช ููุงู ุญุงุฌุฉ ูุชุนุฑูู <em>server_name</em> ุ ุญูุซ ูููู ูุนูุงูู ุงูุชุตููุฉ Envoy Proxy ูุนุงูุฌุฉ ุฐูู. </p><br><h2 id="shag-4---konfiguraciya-mestopolozheniya" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 4 - ุชูููู ุงููููุน </h2><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูุตู ุทูุจ ุฅูู NGINX ุ ุชุญุฏุฏ ูุชูุฉ ุงููููุน ููููุฉ ูุนุงูุฌุฉ ูููุงู ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ.  ูู ุงูุฌุฒุก ุงูุชุงูู ุ ูุชู ููู ูู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงููููุน ุฅูู ูุชูุฉ upstream (ููุงุญุธุฉ ุงููุชุฑุฌู: upstream ุนุงุฏุฉ ูุง ุชููู ุฎุงุฏู ุชุทุจููุงุช) ุชุณูู <em>targetCluster</em> .  ุชุนุฑูู ุงููุชูุฉ upstream ุงูุนูุฏ ุงูุชู ูุฌุจ ูุนุงูุฌุฉ ุงูุทูุจ.  ุณููุงูุด ูุฐุง ูู ุงูุฎุทูุฉ ุงูุชุงููุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://targetCluster/; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุจุนูุซ ุ ููุงุชุฑ ููุนู ูุฐุง. </p><br><h4 id="envoy-filters" style=";text-align:right;direction:rtl">  ูุฑุดุญุงุช ุงููุจุนูุซ </h4><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุชูููู ุงูุซุงุจุช ุ ุชุญุฏุฏ ุงููุฑุดุญุงุช ููููุฉ ุงูุชุนุงูู ูุน ุงูุทูุจุงุช ุงููุงุฑุฏุฉ.  ูู ูุฐู ุงูุญุงูุฉ ุ ูููุง ุจุชุนููู ุนูุงูู ุชุตููุฉ ุชุชุทุงุจู ูุน <em>ุงุณู ุงูุฎุงุฏู</em> ูู ุงูุฎุทูุฉ ุงูุณุงุจูุฉ.  ุนูุฏ ูุตูู ุงูุทูุจุงุช ุงููุงุฑุฏุฉ ุงูุชู ุชุชูุงูู ูุน ูุฌุงูุงุช ููุณุงุฑุงุช ูุญุฏุฏุฉ ุ ูุชู ุชูุฌูู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ุงููุชูุฉ.  ูุฐุง ูู ูุง ูุนุงุฏู ุงูุชูููู ุงูููุจุน NGINX. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Copy to Editor filter_chains: - filters: - name: envoy.http_connection_manager config: codec_type: auto stat_prefix: ingress_http route_config: name: local_route virtual_hosts: - name: backend domains: - "one.example.com" - "www.one.example.com" routes: - match: prefix: "/" route: cluster: targetCluster http_filters: - name: envoy.router</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงุณู <em>envoy.http_connection_manager</em> ูู ุนุงูู ุชุตููุฉ ูุถูู ูู ูููู Envoy.  ูุชุดูู ุงููุฑุดุญุงุช ุงูุฃุฎุฑู <em>Redis</em> ุ <em>Mongo</em> ุ <em>TCP</em> .  ููููู ุงูุนุซูุฑ ุนูู ุงููุงุฆูุฉ ุงููุงููุฉ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู</a> . </p><br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงููุนูููุงุช ุญูู ุณูุงุณุงุช ููุงุฒูุฉ ุงูุชุญููู ุงูุฃุฎุฑู ุ ุชูุถู ุจุฒูุงุฑุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู ุงููุจุนูุซ</a> . </p><br><h2 id="step-5---proxy-and-upstream-configuration" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 5 - ุชูููู ุงููููู ูุงูุจุงูู </h2><br><p style=";text-align:right;direction:rtl">  ูู NGINX ุ ูุญุฏุฏ ุงูุชูููู ุงูุฃุณุงุณู ูุฌููุนุฉ ุงูุฎูุงุฏู ุงููุฏู ุงูุชู ุณุชุชุนุงูู ูุน ุญุฑูุฉ ุงููุฑูุฑ.  ูู ูุฐู ุงูุญุงูุฉ ุ ุชู ุชุนููู ูุฌููุนุชูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="nginx hljs"> <span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> targetCluster { 172.18.0.3:80; 172.18.0.4:80; }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงููุจุนูุซ ุ ูุชู ุฅุฏุงุฑุฉ ุงููุชูุฉ. </p><br><h4 id="envoy-clusters" style=";text-align:right;direction:rtl">  ูุฌููุนุงุช ุงููุจุนูุซูู </h4><br><p style=";text-align:right;direction:rtl">  ูุชู ุชุนุฑูู ุงูููุงูุฆ ุงูููุจุน ููุฌููุนุงุช.  ูู ูุฐู ุงูุญุงูุฉ ุ ุชู ุชุญุฏูุฏ ุงููุถูููู ุงูุฐูู ุณูุฎุฏููู ุญุฑูุฉ ุงููุฑูุฑ.  ูุชู ุชุนุฑูู ุทุฑููุฉ ุงููุตูู ุฅูู ุงููุถูููู ุ ูุซู ุงููููุฉ ุ ุนูู ุฃููุง ุชูููู ูุชูุฉ.  ูุชูุญ ูู ุฐูู ุงูุชุญูู ุจุฏูุฉ ุฃูุจุฑ ูู ุฌูุงูุจ ูุซู ุฒูู ุงูุงุณุชุฌุงุจุฉ ูููุงุฒูุฉ ุงูุชุญููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Copy to Editor clusters: - name: targetCluster connect_timeout: 0.25s type: STRICT_DNS dns_lookup_family: V4_ONLY lb_policy: ROUND_ROBIN hosts: [ { socket_address: { address: 172.18.0.3, port_value: 80 }}, { socket_address: { address: 172.18.0.4, port_value: 80 }} ]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูุฏ ุงุณุชุฎุฏุงู <em>ุงูุชุดุงู</em> ุฎุฏูุฉ <em>STRICT_DNS ุ</em> ุณูููู Envoy ุจุญู ุฃูุฏุงู DNS ุงููุญุฏุฏุฉ ุจุดูู ูุณุชูุฑ ูุบูุฑ ูุชุฒุงูู.  ุณูุชู ุงุนุชุจุงุฑ ูู ุนููุงู IP ุชู ุฅุฑุฌุงุนู ูุชูุฌุฉ DNS ูุถูููุง ุตุฑูุญูุง ูู ูุธุงู ุงููุฌููุนุฉ ุงูุฃูููุฉ.  ูุฐุง ูุนูู ุฃูู ูู ุญุงูุฉ ุฅุฑุฌุงุน ุงูุทูุจ ูุนูุงููู IP ุ ุณูู ููุชุฑุถ Envoy ุฃู ููุงู ูุถูููู ูู ุงููุชูุฉ ุ ููุฌุจ ุฃู ูููู ููุงููุง ูุชูุงุฒููู ูู ุงูุชุญููู.  ุฅุฐุง ุชูุช ุฅุฒุงูุฉ ุงููุถูู ูู ุงููุชูุฌุฉ ุ ููุชุฑุถ Envoy ุฃูู ูู ูุนุฏ ููุฌูุฏูุง ูุณูุฎุชุงุฑ ุญุฑูุฉ ุงููุฑูุฑ ูู ุฃู ุชุฌูุนุงุช ุงุชุตุงู ููุฌูุฏุฉ. </p><br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงููุนูููุงุช ุ ุฑุงุฌุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู ูููู ุงููุจุนูุซ</a> . </p><br><h2 id="shag-6---dostup-k-zhurnalu-i-oshibki" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 6 - ุชุณุฌูู ุงูุฏุฎูู ูุงูุฃุฎุทุงุก </h2><br><p style=";text-align:right;direction:rtl">  ุงูุชูููู ุงูููุงุฆู ูู ุงูุชุณุฌูู.  ุจุฏูุงู ูู ููู ุณุฌูุงุช ุงูุฃุฎุทุงุก ุฅูู ุงููุฑุต ุ ูุณุชุฎุฏู Envoy Proxy ููุฌูุง ูุณุชูุฏ ุฅูู ูุฌููุนุฉ ุงููุธุฑุงุก.  ูุชู ุนุฑุถ ุฌููุน ุณุฌูุงุช ุงูุชุทุจูู ูู <em>stdout</em> ู <em>stderr</em> . </p><br><p style=";text-align:right;direction:rtl">  ุนูุฏูุง ูููู ุงููุณุชุฎุฏููู ุจุชูุฏูู ุทูุจ ุ ุชููู ุณุฌูุงุช ุงููุตูู ุงุฎุชูุงุฑูุฉ ููุชู ุชุนุทูููุง ุงูุชุฑุงุถููุง.  ูุชูููู ุณุฌูุงุช ุงููุตูู ูุทูุจุงุช HTTP ุ ูู ุจุชูููู ุชูููู <em>access_log</em> ูู HTTP Connection Manager.  ูููู ุฃู ูููู ุงููุณุงุฑ ุฅูุง ุฌูุงุฒูุง ุ ูุซู <em>stdout</em> ุฃู ููููุง ุนูู ุงููุฑุต ุ ููููุง ููุชุทูุจุงุชู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุชูููู ุงูุชุงูู ุณูุนูุฏ ุชูุฌูู ุฌููุน ุณุฌูุงุช ุงููุตูู ุฅูู <em>stdout</em> (ููุงุญุธุฉ ุงููุชุฑุฌู - stdout ุถุฑูุฑูุฉ ูุงุณุชุฎุฏุงู ุงููุจุนูุซ ุฏุงุฎู ุนุงูู ูููุงุก. ุฅุฐุง ููุช ุชุณุชุฎุฏู ุฏูู ุนุงูู ูููุงุก ุ ูุงุณุชุจุฏู / dev / stdout ุจุงููุณุงุฑ ุฅูู ููู ุงูุณุฌู ุงูุนุงุฏู).  ุงูุณุฎ ุงูููุชุทู ุฅูู ูุณู ุงูุชูููู ููุฏูุฑ ุงูุงุชุตุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">Copy to Clipboardaccess_log: - name: envoy.file_access_log config: path: "/dev/stdout"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุจุฏู ุงููุชุงุฆุฌ ููุง ููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> - name: envoy.http_connection_manager config: codec_type: auto stat_prefix: ingress_http access_log: - name: envoy.file_access_log config: path: "/dev/stdout" route_config:</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุดูู ุงูุชุฑุงุถู ุ ูุญุชูู Envoy ุนูู ุณูุณูุฉ ุชูุณูู ุชุชุถูู ุชูุงุตูู ุทูุจ HTTP: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[%START_TIME%] "%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%" %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% "%REQ(X-FORWARDED-FOR)%" "%REQ(USER-AGENT)%" "%REQ(X-REQUEST-ID)%" "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%"\n</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชูุฌุฉ ุณูุณูุฉ ุงูุชูุณูู ูุฐู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">[2018-11-23T04:51:00.281Z] <span class="hljs-string"><span class="hljs-string">"GET / HTTP/1.1"</span></span> 200 - 0 58 4 1 <span class="hljs-string"><span class="hljs-string">"-"</span></span> <span class="hljs-string"><span class="hljs-string">"curl/7.47.0"</span></span> <span class="hljs-string"><span class="hljs-string">"f21ebd42-6770-4aa5-88d4-e56118165a7d"</span></span> <span class="hljs-string"><span class="hljs-string">"one.example.com"</span></span> <span class="hljs-string"><span class="hljs-string">"172.18.0.4:80"</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุชุฎุตูุต ูุญุชููุงุช ุงูุฅุฎุฑุงุฌ ุนู ุทุฑูู ุชุนููู ุญูู ุงูุชูุณูู.  ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">access_log: - name: envoy.file_access_log config: path: "/dev/stdout" format: "[%START_TIME%] "%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%" %RESPONSE_CODE% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% "%REQ(X-REQUEST-ID)%" "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%"\n"</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุฃูุถูุง ุฅุฎุฑุงุฌ ุณูุณูุฉ ุงูุณุฌู ุจุชูุณูู JSON ุนู ุทุฑูู ุชุนููู ุญูู <em>json_format</em> .  ุนูู ุณุจูู ุงููุซุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">access_log: - name: envoy.file_access_log config: path: "/dev/stdout" json_format: {"protocol": "%PROTOCOL%", "duration": "%DURATION%", "request_method": "%REQ(:METHOD)%"}</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุฒูุฏ ูู ุงููุนูููุงุช ุญูู ุชูููุงุช ุชุณุฌูู ุงููุจุนูุซ ุ ุชูุถู ุจุฒูุงุฑุฉ </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.envoyproxy.io/docs/envoy/latest/configuration/access_log#config-access-log-format-dictionaries</a> </p><br><p style=";text-align:right;direction:rtl">  ุงูุชุณุฌูู ููุณ ูู ุงูุทุฑููุฉ ุงููุญูุฏุฉ ููุญุตูู ุนูู ููุฑุฉ ุนู ุงูุนูู ูุน Envoy Proxy.  ูุญุชูู ุนูู ููุฒุงุช ูุชูุฏูุฉ ูุถูููุฉ ููุจุญุซ ุนู ุงูููููุฏูู ูููุงููุณ.  ููููู ูุนุฑูุฉ ุงููุฒูุฏ ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู ุงูุชุชุจุน</a> ุฃู ูู ุฎูุงู ุจุฑูุงูุฌ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชุชุจุน ุงูุชูุงุนูู</a> . </p><br><h2 id="shag-7---zapusk" style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ 7 - ุฅุทูุงู </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ููุช ุงูุขู ุจููู ุงูุชูููู ูู NGINX ุฅูู Envoy Proxy.  ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุชุดุบูู ูุซูู ูู Envoy Proxy ูุงุฎุชุจุงุฑู. </p><br><h4 id="zapusk-ot-polzovatelya" style=";text-align:right;direction:rtl">  ุชุดุบูู ูู ุงููุณุชุฎุฏู </h4><br><p style=";text-align:right;direction:rtl">  ูู ุงูุฌุฒุก ุงูุนููู ูู ุชูููู NGINX ุ <em>ุงููุณุชุฎุฏู</em> ุงูุฎุท <em>www wwwุ</em>  ูุดูุฑ ุฅูู ุฃู NGINX ุชู ุฅุทูุงููุง ููุณุชุฎุฏู ูุฏูู ุงูุชูุงุฒุงุช ููุฎูุถุฉ ูุชุนุฒูุฒ ุงูุฃูุงู. </p><br><p style=";text-align:right;direction:rtl">  ูุชุฎุฐ Envoy Proxy ููุฌุง ูุณุชูุฏ ุฅูู ูุฌููุนุฉ ุงููุธุฑุงุก ูุฅุฏุงุฑุฉ ูู ูููู ุงูุนูููุฉ.  ุนูุฏูุง ูููู ุจุชุดุบูู Envoy Proxy ุนุจุฑ ุงูุญุงููุฉ ุ ูููููุง ุชุญุฏูุฏ ูุณุชุฎุฏู ุจูุณุชูู ุงูุชูุงุฒ ููุฎูุถ. </p><br><h4 id="zapusk-envoy-proxy" style=";text-align:right;direction:rtl">  ุฅุทูุงู ูููู Envoy </h4><br><p style=";text-align:right;direction:rtl">  ุณูููู ุงูุฃูุฑ ุฃุฏูุงู ุจุชุดุบูู Envoy Proxy ุนุจุฑ ุญุงููุฉ Docker ุนูู ุงููุถูู.  ูููุฑ ูุฐุง ุงูุฃูุฑ ูู Envoy ุงููุฏุฑุฉ ุนูู ุงูุงุณุชูุงุน ููุทูุจุงุช ุงููุงุฑุฏุฉ ุนุจุฑ ุงููููุฐ 80. ููุน ุฐูู ุ ููุง ูู ููุถุญ ูู ุชูููู ุงููุณุชูุน ุ ูุณุชูุน Envoy Proxy ูุญุฑูุฉ ุงููุฑูุฑ ุงููุงุฑุฏุฉ ุนุจุฑ ุงููููุฐ 8080. ููุฐุง ูุณูุญ ููุนูููุฉ ููุณุชุฎุฏู ุฐู ุงูุชูุงุฒุงุช ููุฎูุถุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker run --name proxy1 -p 80:8080 --user 1000:1000 -v /root/envoy.yaml:/etc/envoy/envoy.yaml envoyproxy/envoy</code> </pre> <br><h4 id="testirovanie" style=";text-align:right;direction:rtl">  ุชุฌุฑูุจ </h4><br><p style=";text-align:right;direction:rtl">  ูุน ุชุดุบูู ุงููููุงุก ุ ูููู ุงูุขู ุฅุฌุฑุงุก ุงูุงุฎุชุจุงุฑุงุช ููุนุงูุฌุชูุง.  ูุตุฏุฑ ุงูุฃูุฑ cURL ุงูุชุงูู ุทูุจูุง ุจุงุณุชุฎุฏุงู ุฑุฃุณ ุงููุถูู ุงููุญุฏุฏ ูู ุชูููู ุงูุฎุงุฏู ุงููููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">curl -H <span class="hljs-string"><span class="hljs-string">"Host: one.example.com"</span></span> localhost -i</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณููุชุฌ ุนู ุทูุจ HTTP ุฎุทุฃ <em>503</em> .  ูุฐุง ูุฑุฌุน ุฅูู ุญูููุฉ ุฃู ุงูุงุชุตุงูุงุช ุงูููุจุน ูุง ุชุนูู ูุฃููุง ุบูุฑ ูุชููุฑุฉ.  ูุจุงูุชุงูู ุ ูุง ูุญุชูู Envoy Proxy ุนูู ุฃู ูุฌูุงุช ูุณุชูุฏูุฉ ูุชุงุญุฉ ููุทูุจ.  ุณููุทูู ุงูุฃูุฑ ุงูุชุงูู ุณูุณูุฉ ูู ุฎุฏูุงุช HTTP ุชุชุทุงุจู ูุน ุงูุชูููู ุงููุญุฏุฏ ูู Envoy. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">docker run -d katacoda/docker-http-server; docker run -d katacoda/docker-http-server;</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุน ุงูุฎุฏูุงุช ุงููุชุงุญุฉ ุ ูููู ูู Envoy ููู ุญุฑูุฉ ุงููุฑูุฑ ุฅูู ูุฌูุชูุง ุจูุฌุงุญ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">curl -H <span class="hljs-string"><span class="hljs-string">"Host: one.example.com"</span></span> localhost -i</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณุชุฑู ุงุณุชุฌุงุจุฉ ุชุดูุฑ ุฅูู ุฃู ุญุงููุฉ Docker ุนุงูุฌุช ุงูุทูุจ.  ูู ุณุฌูุงุช Envoy Proxy ุ ูุฌุจ ุฃู ุชุดุงูุฏ ุฃูุถูุง ุณูุณูุฉ ุงููุตูู ุงููุนุฑูุถุฉ. </p><br><h4 id="dopolnitelnye-zagolovki-otveta-http-http-response" style=";text-align:right;direction:rtl">  ุฑุคูุณ ุงุณุชุฌุงุจุฉ HTTP ุฅุถุงููุฉ </h4><br><p style=";text-align:right;direction:rtl">  ุณุชุฑู ุฑุคูุณ HTTP ุฅุถุงููุฉ ูู ุฑุคูุณ ุงูุงุณุชุฌุงุจุฉ ููุทูุจ ุงููุนูู.  ูุนุฑุถ ุฑุฃุณ ุงูููุช ุงูุฐู ููุถูู ุงููุถูู upstream ูุนุงูุฌุฉ ุงูุทูุจ.  ูุชู ุงูุชุนุจูุฑ ุนููุง ุจุงููููู ุซุงููุฉ.  ูุนุฏ ูุฐุง ูููุฏูุง ุฅุฐุง ูุงู ุงูุนููู ูุฑูุฏ ุชุญุฏูุฏ ููุช ุงูุฎุฏูุฉ ููุงุฑูุฉ ุจููุช ุงูุชูุงู ุงูุดุจูุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">x-envoy-upstream-service-time: 0 server: envoy</code> </pre> <br><h2 id="itogovyy-konfig" style=";text-align:right;direction:rtl">  ุงูุชูููู ุงูููุงุฆู </h2><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">static_resources: listeners: - name: listener_0 address: socket_address: { address: 0.0.0.0, port_value: 8080 } filter_chains: - filters: - name: envoy.http_connection_manager config: codec_type: auto stat_prefix: ingress_http route_config: name: local_route virtual_hosts: - name: backend domains: - "one.example.com" - "www.one.example.com" routes: - match: prefix: "/" route: cluster: targetCluster http_filters: - name: envoy.router clusters: - name: targetCluster connect_timeout: 0.25s type: STRICT_DNS dns_lookup_family: V4_ONLY lb_policy: ROUND_ROBIN hosts: [ { socket_address: { address: 172.18.0.3, port_value: 80 }}, { socket_address: { address: 172.18.0.4, port_value: 80 }} ] admin: access_log_path: /tmp/admin_access.log address: socket_address: { address: 0.0.0.0, port_value: 9090 }</code> </pre> <br><h2 id="dopolnitelnaya-informaciya-ot-perevodchika" style=";text-align:right;direction:rtl">  ูุนูููุงุช ุฅุถุงููุฉ ูู ุงููุชุฑุฌู </h2><br><p style=";text-align:right;direction:rtl">  ูููู ุงูุนุซูุฑ ุนูู ุชุนูููุงุช ุชุซุจูุช ูููู Envoy ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://www.getenvoy.io/</a> </p><br><p style=";text-align:right;direction:rtl">  ุจุดูู ุงูุชุฑุงุถู ูู ุฏูุฑุฉ ูู ุงูุฏูููุฉ ุ ูุง ููุฌุฏ ุชูููู ุฎุฏูุฉ systemd. </p><br><p style=";text-align:right;direction:rtl">  ุฃุถู ุชููุฆุฉ ุฎุฏูุฉ systemd /etc/systemd/system/envoy.service: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">[Unit] Description=Envoy Proxy Documentation=https://www.envoyproxy.io/ After=network-online.target Requires=envoy-auth-server.service Wants=nginx.service [Service] User=root Restart=on-failure ExecStart=/usr/bin/envoy --config-path /etc/envoy/config.yaml [Install] WantedBy=multi-user.target</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญุชุงุฌ ุฅูู ุฅูุดุงุก ุงูุฏููู / etc / envoy / ููุถุน config.yaml config ููุงู. </p><br><p style=";text-align:right;direction:rtl">  ุจูุงุณุทุฉ ุงููุจุนูุซ ุงููููู ููุงู ุฏุฑุฏุดุฉ ุจุฑููุฉ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://t.me/envoyproxy_ru</a> </p><br><p style=";text-align:right;direction:rtl">  ูุง ูุฏุนู Envoy Proxy ุชูุฒูุน ุงููุญุชูู ุงูุซุงุจุช.  ูู ููููู ุงูุชุตููุช ูุตุงูุญ: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/envoyproxy/envoy/issues/378</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar469455/">https://habr.com/ru/post/ar469455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar469445/index.html">ูุธุฑุฉ ุนุงูุฉ ุนูู AngularConnect 2019. ุงูุฌุฒุก 2</a></li>
<li><a href="../ar469447/index.html">ุทุฑูู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ููุฑุฉ ุฑุงุฆุนุฉ ุฅูู ุงูุตูุงุนุฉ ุงูุนูููุฉ</a></li>
<li><a href="../ar469449/index.html">ุดูุงุฏุงุช EV SSL: ูู ููุงู ุญูุงุฉ ุจุนุฏ ุงูููุชุ</a></li>
<li><a href="../ar469451/index.html">ููุณูุฉ ุงูุตูุฑ</a></li>
<li><a href="../ar469453/index.html">ุฅุฏุงุฑุฉ ูุฑูู ููุฒุน ูู ูุถุน ุงููุดุงุฑูุน ุงููุชุนุฏุฏุฉ (ุชูุฑูุฑ ุงููุฑุงุฌุนุฉ ูุงูููุฏูู)</a></li>
<li><a href="../ar469457/index.html">ุญูุซ ูุคุฏู ุงูุฑูุนุฉ</a></li>
<li><a href="../ar469459/index.html">ุชูุตูู ุฃุฌูุฒุฉ ุฅูุชุฑูุช ุงูุฃุดูุงุก ูู ุงููุฏููุฉ ุงูุฐููุฉ</a></li>
<li><a href="../ar469461/index.html">"ุฅูู ุงููุฌูู": ูุนุงุฏุงุฉ ุงูููููุฉ "ููุงูุฉ ุงูุนุงูู ุงูููู"</a></li>
<li><a href="../ar469463/index.html">ุงูุงุชุฌุงูุงุช ูุงูุชููุนุงุช ูู ูุนุงูุฌุฉ ุงููุบุฉ ุงูุทุจูุนูุฉ</a></li>
<li><a href="../ar469465/index.html">ุงูุชููุฆุฉ ูู C ++ ุงูุญุฏูุซุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>