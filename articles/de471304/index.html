<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🔴 😒 🚵🏿 Empire ERP. Unterhaltsame Buchhaltung: Hauptbuch, Konten, Saldo 👨🏿‍🍳 💪🏼 💖</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Artikel werden wir versuchen, in das Herz des "blutigen Unternehmens" einzudringen - der Buchhaltung. Zunächst werden wir eine Untersuchung ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Empire ERP. Unterhaltsame Buchhaltung: Hauptbuch, Konten, Saldo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/471304/"><p> In diesem Artikel werden wir versuchen, in das Herz des "blutigen Unternehmens" einzudringen - der Buchhaltung.  Zunächst werden wir eine Untersuchung des Hauptbuchs, der Konten und der Bilanz durchführen und deren inhärente Eigenschaften und Algorithmen identifizieren.  Wir verwenden die Python- und Test Driven Development-Technologie.  Hier werden wir uns mit dem Prototyping beschäftigen, also werden wir anstelle der Datenbank die grundlegenden Container verwenden: Listen, Wörterbücher und Tupel.  Das Projekt wird gemäß den Anforderungen des <a href="">Empire ERP-Projekts entwickelt</a> . </p><a name="habracut"></a><br><h2 id="uslovie-zadachi">  Aufgabenbedingung </h2><br><p>  Weltraum ... Planet von Empireia ... Ein Staat auf dem ganzen Planeten.  Die Bevölkerung arbeitet 2 Stunden in 2 Wochen, nach 2 Jahren in den Ruhestand.  Der Kontenplan besteht aus 12 Positionen.  Die Konten 1-4 sind aktiv, 5-8 sind aktiv-passiv, 9-12 sind passiv.  Firmenhörner &amp; Hufe.  Alle Transaktionen werden in einer Berichtsperiode ausgeführt, zu Beginn der Periode gibt es keine Salden. </p><br><h2 id="nastroyka-proekta">  Projekteinrichtung </h2><br><p>  Wir klonen das Projekt vom Github: </p><br><pre><code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/nomhoi/empire-erp.git</code> </pre> <br><p>  Wir entwickeln in Python 3.7.4.  <strong>Richten</strong> Sie die virtuelle Umgebung ein, aktivieren Sie sie und installieren Sie <strong>pytest</strong> . </p><br><pre> <code class="bash hljs">pip install pytest</code> </pre> <br><h2 id="1-glavnaya-kniga">  1. Hauptbuch </h2><br><p>  <strong>Wechseln Sie in den</strong> Ordner <strong>reaserch / day1 / step1</strong> . </p><br><p>  <strong>Buchhaltung.py</strong> : </p><br><pre> <code class="python hljs">DEBIT = <span class="hljs-number"><span class="hljs-number">0</span></span> CREDIT = <span class="hljs-number"><span class="hljs-number">1</span></span> AMOUNT = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-string"><span class="hljs-string">'\nGeneral ledger'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self: res += <span class="hljs-string"><span class="hljs-string">'\n {:2} {:2} {:8.2f}'</span></span>.format(e[DEBIT], e[CREDIT], e[AMOUNT]) res += <span class="hljs-string"><span class="hljs-string">"\n----------------------"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre> <br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> accounting <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> decimal <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ledger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GeneralLedger() @pytest.mark.parametrize(<span class="hljs-string"><span class="hljs-string">'entries'</span></span>, [ [(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>)] ]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_ledger</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ledger, entries)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> entry <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> entries: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(ledger) == <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][DEBIT] == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][CREDIT] == <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">0</span></span>][AMOUNT] == Decimal(<span class="hljs-number"><span class="hljs-number">100.00</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][DEBIT] == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][CREDIT] == <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> ledger[<span class="hljs-number"><span class="hljs-number">1</span></span>][AMOUNT] == Decimal(<span class="hljs-number"><span class="hljs-number">100.00</span></span>) print(ledger)</code> </pre> <br><p>  Wie wir sehen, wird das Hauptbuch in Form einer Liste von Aufzeichnungen präsentiert.  Jeder Eintrag ist als Tupel konzipiert.  Für die Aufzeichnung der Transaktion verwenden wir bisher nur die Kontonummern für Lastschrift und Gutschrift sowie den Betrag der Transaktion.  Daten, Beschreibungen und andere Informationen werden noch nicht benötigt, wir werden sie später hinzufügen. </p><br><p>  Der <strong>Ledger</strong> Latch und der parametrisierte Test <strong>test_ledger wurden</strong> in der Testdatei erstellt.  Im <strong>Eintragsparameter</strong> übertragen wir sofort die gesamte Liste der Transaktionen.  Zur Überprüfung führen wir den Befehl <strong>pytest -s -v</strong> im Terminal aus.  Der Test sollte bestanden werden, und im Terminal wird die gesamte Liste der im Hauptbuch gespeicherten Transaktionen angezeigt: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 11 100.00</code> </pre> <br><h2 id="2-scheta">  2. Konten </h2><br><p>  Fügen wir nun dem Projekt Rechnungsunterstützung hinzu.  <strong>Wechseln</strong> Sie in den Ordner <strong>day1 / step2</strong> . </p><br><p>  <strong>Buchhaltung.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, accounts=None)</span></span></span><span class="hljs-function">:</span></span> self.accounts = accounts <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.accounts.append_entry(entry) super().append(entry)</code> </pre> <br><p>  Die <strong>GeneralLedger-</strong> Klasse hat die <strong>Append-</strong> Methode überladen.  Wenn Sie einem Buch eine Transaktion hinzufügen, fügen wir sie sofort den Konten hinzu. </p><br><p>  <strong>Buchhaltung.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, id, begin=Decimal</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">(</span></span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params"><span class="hljs-number">0.00</span></span></span></span></span><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">)</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.id = id self.begin = begin self.end = begin self.entries = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, id, amount)</span></span></span><span class="hljs-function">:</span></span> self.entries.append((id, amount)) self.end += amount <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Accounts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(dict)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.range = range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.range: self[i] = Account(i) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> self[entry[DEBIT]].append(entry[CREDIT], Decimal(entry[AMOUNT])) self[entry[CREDIT]].append(entry[DEBIT], Decimal(-entry[AMOUNT]))</code> </pre> <br><p>  Die <strong>Accounts-</strong> Klasse ist als Wörterbuch konzipiert.  In den Schlüsseln die Kontonummer, in den Werten der Inhalt des Kontos, d.h.  Eine Instanz der <strong>Account-</strong> Klasse, die wiederum die Felder für den Eröffnungs- und Schlusssaldo sowie eine Liste der mit diesem Konto verbundenen Transaktionen enthält.  Beachten Sie, dass in dieser Liste die Beträge der Debit- und Kredittransaktionen in einem Feld gespeichert sind, der Debitbetrag positiv und der Kreditbetrag negativ ist. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def accounts(): return Accounts() @pytest.fixture def ledger(accounts): return GeneralLedger(accounts)</span></span></code> </pre> <br><p>  In der Testdatei haben wir die <strong>Kontosperre</strong> hinzugefügt und die <strong>Ledgersperre</strong> angepasst. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [(1, 12, 100.00), (1, 11, 100.00)] ]) def test_accounts(accounts, ledger, entries): for entry in entries: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) assert len(ledger) == 2 assert ledger[0][DEBIT] == 1 assert ledger[0][CREDIT] == 12 assert ledger[0][AMOUNT] == Decimal(100.00) assert len(accounts) == 12 assert accounts[1].end == Decimal(200.00) assert accounts[11].end == Decimal(-100.00) assert accounts[12].end == Decimal(-100.00) print(ledger) print(accounts)</span></span></code> </pre> <br><p>  Ein neuer Test <strong>test_accounts wurde hinzugefügt</strong> . </p><br><p>  Führen Sie den Test aus und beobachten Sie die Ausgabe: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 11 100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 100.00 0.00 11: 100.00 0.00 end: 200.00 0.00 ---------------------- Account 11 beg: 0.00 0.00 1: 0.00 100.00 end: 0.00 100.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 100.00 end: 0.00 100.00 ----------------------</code> </pre><br><p>  In den Klassen <strong>Konto</strong> und <strong>Konten</strong> <strong>sind</strong> auch die <strong>Methoden __str__</strong> überladen, wie Sie in den <strong>Projektquellen</strong> sehen können.  Die Beträge der Buchungen und Salden werden zur besseren Übersichtlichkeit in zwei Spalten dargestellt: Lastschrift und Gutschrift. </p><br><h2 id="3-scheta-proverka-provodok">  3. Konten: Buchungsbestätigung </h2><br><p>  Wir erinnern uns an folgende Regel: </p><br><pre> <code class="bash hljs">        .         .   -         .</code> </pre> <br><p>  Das heißt, in einer Instanz der <strong>Kontoklasse</strong> kann der Endwert (Endsaldo) auf aktiven Konten nicht negativ und auf passiven Konten nicht positiv sein. </p><br><p>  <strong>Wechseln</strong> Sie in den Ordner <strong>day1 / step3</strong> . </p><br><p>  <strong>Buchhaltung.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BalanceException</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Exception)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><p>  <strong>BalanceException hinzugefügt</strong> . </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Account</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_active</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.id &lt; <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_passive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.id &gt; <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ...</code> </pre> <br><p>  Der Kontoklasse wurde eine Prüfung hinzugefügt, um festzustellen, ob das Konto aktiv oder passiv ist. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Accounts</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(dict)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_balance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self[entry[CREDIT]].end - Decimal(entry[AMOUNT]) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self[entry[CREDIT]].is_active(): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BalanceException(<span class="hljs-string"><span class="hljs-string">'BalanceException'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self[entry[DEBIT]].end + Decimal(entry[AMOUNT]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> self[entry[DEBIT]].is_passive(): <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> BalanceException(<span class="hljs-string"><span class="hljs-string">'BalanceException'</span></span>) ...</code> </pre> <br><p>  Der Klasse " <strong>Accounts.py" wurde</strong> ein Scheck hinzugefügt. Wenn durch Hinzufügen einer neuen Transaktion ein negativer Abbuchungswert für das aktive Konto generiert wird, wird eine Ausnahme ausgelöst, und dasselbe gilt, wenn ein passives Konto einen negativen Kreditwert erhält. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GeneralLedger</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, entry)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.accounts.check_balance(entry) self.accounts.append_entry(entry) super().append(entry) ...</code> </pre> <br><p>  In der <strong>GeneralLedger-</strong> Klasse prüfen wir <strong>,</strong> bevor wir die Buchung zu den Konten hinzufügen.  Wenn eine Ausnahme ausgelöst wird, fällt die Buchung weder in die Konten noch in das Hauptbuch. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries, exception', [ ([(12, 1, 100.00)], BalanceException('BalanceException')), ([(12, 6, 100.00)], BalanceException('BalanceException')), ([(12, 11, 100.00)], BalanceException('BalanceException')), ([(6, 2, 100.00)], BalanceException('BalanceException')), #([(6, 7, 100.00)], BalanceException('BalanceException')), #([(6, 12, 100.00)], BalanceException('BalanceException')), ([(1, 2, 100.00)], BalanceException('BalanceException')), #([(1, 6, 100.00)], BalanceException('BalanceException')), #([(1, 12, 100.00)], BalanceException('BalanceException')), ]) def test_accounts_balance(accounts, ledger, entries, exception): for entry in entries: try: ledger.append((entry[DEBIT], entry[CREDIT], Decimal(entry[AMOUNT]))) except BalanceException as inst: assert isinstance(inst, type(exception)) assert inst.args == exception.args else: pytest.fail("Expected error but found none") assert len(ledger) == 0 assert len(accounts) == 12</span></span></code> </pre> <br><p>  Der Test <strong>test_accounts_balance wurde dem</strong> Testmodul hinzugefügt.  In der Liste der Transaktionen wurden zunächst alle möglichen Kombinationen von Transaktionen aufgelistet und alle Transaktionen auskommentiert, die keine Ausnahme auslösen.  Führen Sie den Test aus und stellen Sie sicher, dass die verbleibenden 5 Buchungsoptionen eine <strong>BalanceException auslösen</strong> . </p><br><h2 id="4-balans">  4. Balance </h2><br><p>  <strong>Wechseln</strong> Sie in den Ordner <strong>day1 / step4</strong> . </p><br><p>  <strong>Buchhaltung.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Balance</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(list)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, accounts)</span></span></span><span class="hljs-function">:</span></span> self.accounts = accounts self.suma = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.sump = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.suma = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.sump = Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.accounts.range: active = self.accounts[i].end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts[i].end &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) passive = -self.accounts[i].end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.accounts[i].end &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Decimal(<span class="hljs-number"><span class="hljs-number">0.00</span></span>) self.append((active, passive)) self.suma += active self.sump += passive</code> </pre> <br><p>  Beim Erstellen eines Saldos sammeln wir einfach die Salden aller Konten in einer Tabelle. </p><br><p>  <strong>test_accounting.py</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture def balance(accounts): return Balance(accounts)</span></span></code> </pre> <br><p>  Erstellen Sie eine <strong>Balance-</strong> Verriegelung. </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [ ( 1, 12, 200.00), # increase active and passive ],[ ( 1, 12, 200.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ],[ ( 1, 12, 300.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ( 2, 1, 100.00), # increase active and decrease active ],[ ( 1, 12, 300.00), # increase active and passive (12, 1, 100.00), # decrease passive and decrease active ( 2, 1, 100.00), # increase active and decrease active (12, 11, 100.00), # decrease passive and increase passive ] ]) def test_balance(accounts, ledger, balance, entries): for entry in entries: ledger.append(entry) balance.create() print(accounts) print(balance)</span></span></code> </pre> <br><p>  Wir haben den Test <strong>test_balance erstellt</strong> .  In den Parameterlisten wurden alle möglichen Arten von Transaktionen aufgeführt: Erhöhung des Vermögenswerts und der Verbindlichkeit, Verringerung des Vermögenswerts und der Verbindlichkeit, Erhöhung des Vermögenswerts und Verringerung des Vermögenswerts, Erhöhung der Verbindlichkeit und Verringerung der Verbindlichkeit.  Es wurden 4 Optionen für Buchungen ausgegeben, damit Sie Schritt für Schritt die Ausgabe sehen können.  Für die letzte Option lautet die Ausgabe wie folgt: </p><br><pre> <code class="plaintext hljs">General ledger 1 12 300.00 12 1 100.00 2 1 100.00 12 11 100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 300.00 0.00 12: 0.00 100.00 2: 0.00 100.00 end: 100.00 0.00 ---------------------- Account 2 beg: 0.00 0.00 1: 100.00 0.00 end: 100.00 0.00 ---------------------- Account 11 beg: 0.00 0.00 12: 0.00 100.00 end: 0.00 100.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 300.00 1: 100.00 0.00 11: 100.00 0.00 end: 0.00 100.00 ---------------------- Balance 1 : 100.00 0.00 2 : 100.00 0.00 3 : 0.00 0.00 4 : 0.00 0.00 5 : 0.00 0.00 6 : 0.00 0.00 7 : 0.00 0.00 8 : 0.00 0.00 9 : 0.00 0.00 10 : 0.00 0.00 11 : 0.00 100.00 12 : 0.00 100.00 ---------------------- sum: 200.00 200.00 ======================</code> </pre> <br><h2 id="5-storno">  5. Umkehren </h2><br><p>  Lassen Sie uns nun überprüfen, wie die Umkehrung durchgeführt wird. </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('entries', [ [ ( 1, 12, 100.00), ( 1, 12,-100.00), ] ]) def test_storno(accounts, ledger, balance, entries): for entry in entries: ledger.append(entry) balance.create() print(ledger) print(accounts) print(balance)</span></span></code> </pre> <br><p>  Die Schlussfolgerung war wie folgt: </p><br><pre> <code class="bash hljs">General ledger 1 12 100.00 1 12 -100.00 ---------------------- Account 1 beg: 0.00 0.00 12: 100.00 0.00 12: 0.00 100.00 end: 0.00 0.00 ---------------------- Account 12 beg: 0.00 0.00 1: 0.00 100.00 1: 100.00 0.00 end: 0.00 0.00 ---------------------- Balance 1 : 0.00 0.00 2 : 0.00 0.00 3 : 0.00 0.00 4 : 0.00 0.00 5 : 0.00 0.00 6 : 0.00 0.00 7 : 0.00 0.00 8 : 0.00 0.00 9 : 0.00 0.00 10 : 0.00 0.00 11 : 0.00 0.00 12 : 0.00 0.00 ---------------------- sum: 0.00 0.00 ======================</code> </pre><br><p>  Alles scheint richtig zu sein. </p><br><p>  Und wenn wir eine solche Reihe von Postings verwenden, besteht der Test: </p><br><pre> <code class="python hljs">( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">-100.00</span></span>),</code> </pre> <br><p>  Und wenn ein solcher Satz die letzten 2 Zeilen an bestimmten Stellen vertauscht, erhalten wir eine Ausnahme: </p><br><pre> <code class="python hljs">( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>), ( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">-100.00</span></span>), (<span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100.00</span></span>),</code> </pre> <br><p>  Um einen solchen Fehler zu erkennen, muss die Stornierung daher unmittelbar nach der Korrektur der Transaktion erfolgen. </p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  In den folgenden Artikeln werden wir das Studium der Rechnungslegung fortsetzen und alle Aspekte der Entwicklung des Systems gemäß der Liste der Anforderungen für Empire ERP berücksichtigen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de471304/">https://habr.com/ru/post/de471304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de471294/index.html">Gedichte über Haskell, C ++ und Programmierer</a></li>
<li><a href="../de471296/index.html">Lean Manufacturing - Ein Werkzeug für Effizienz</a></li>
<li><a href="../de471298/index.html">Bieber und Bilan winken mit einem Stift. AI singt jetzt Lieder</a></li>
<li><a href="../de471300/index.html">Reagieren: Wenn Sie den Status erhöhen, wird Ihre App zerstört</a></li>
<li><a href="../de471302/index.html">Benutzerüberprüfung in China und Sozialkredit</a></li>
<li><a href="../de471306/index.html">Entwicklung des Continent-AP VPN Plugins für Sailfish OS</a></li>
<li><a href="../de471310/index.html">Meine sehr subjektive Meinung über berufliche und nicht nur IT-Ausbildung</a></li>
<li><a href="../de471312/index.html">Vorbereitung auf die Spring Professional-Zertifizierung. Frühlingsstiefel</a></li>
<li><a href="../de471318/index.html">September Maschinelles Lernen und künstliche Intelligenz News Digest</a></li>
<li><a href="../de471320/index.html">Tools für Softwareentwickler: Open Framework- und Machine Learning-Bibliotheken</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>