<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯдЯЁЯП╛ ЁЯЖЦ ЁЯЩНЁЯП┐ рднрд╛рдЧ 0. рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдпреЛрдЧрд┐рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╕рдВрднрд╡ рд╣реИ ЁЯеЧ ЁЯП┤єаБзєаБвєаБеєаБоєаБзєаБ┐ ЁЯСиЁЯП┐тАНЁЯН│</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рд╕рд╛рд╡рдзрд╛рдиреА: рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рд╣реИред рд╣рд╛рдВ, рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдЗрд╕рдореЗрдВ рдХреБрдЫ рдФрд░ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред 


 рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЛ рдПрдХ рдХрд╛рд▓реНрдкрдирд┐рдХ рдлрдВрддрд╛рд╕реА рдЦреЗрд▓ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдХрд╛рдо рджрд┐рдпрд╛ рдЧрдп...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рднрд╛рдЧ 0. рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдпреЛрдЧрд┐рдиреА рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╕рдВрднрд╡ рд╣реИ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452592/"><p>  <strong>рд╕рд╛рд╡рдзрд╛рдиреА: рд╕рд┐рд╕реНрдЯрдо рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рд╣реИред</strong>  <strong>рд╣рд╛рдВ, рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ, рдЗрд╕рдореЗрдВ рдХреБрдЫ рдФрд░ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реИред</strong> </p><br><p> рдЖрдЗрдП рдХрд▓реНрдкрдирд╛ рдХрд░реЗрдВ рдХрд┐ рдЖрдкрдХреЛ рдПрдХ рдХрд╛рд▓реНрдкрдирд┐рдХ рдлрдВрддрд╛рд╕реА рдЦреЗрд▓ рд▓рд┐рдЦрдиреЗ рдХрд╛ рдХрд╛рдо рджрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред  рдЦреИрд░, рд╡рд╣рд╛рдБ рдХрд▓реНрдкрд┐рдд рдмреМрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВред  рдФрд░ рдЖрднрд╛рд╕реА рд╡рд╛рд╕реНрддрд╡рд┐рдХрддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВред  рдмрдЪрдкрди рд╕реЗ, рдЖрдкрдиреЗ рдРрд╕рд╛ рдХреБрдЫ рд▓рд┐рдЦрдиреЗ рдХрд╛ рд╕рдкрдирд╛ рджреЗрдЦрд╛ рдерд╛ рдФрд░ рдмрд┐рдирд╛ рдХрд┐рд╕реА рд╣рд┐рдЪрдХрд┐рдЪрд╛рд╣рдЯ рдХреЗ рд╕рд╣рдордд рдереЗред  рдЬрд▓реНрдж рд╣реА, рдЖрдкрдХреЛ рдПрд╣рд╕рд╛рд╕ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдЬреНрдпрд╛рджрд╛рддрд░ рдкреБрд░рд╛рдиреЗ рдмрд╢реАрд░рдШ рдФрд░ рдЕрдиреНрдп рд╡рд┐рд╡рд╛рджрд┐рдд рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЪреБрдЯрдХреБрд▓реЛрдВ рдХреА рджреБрдирд┐рдпрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирддреЗ рд╣реИрдВред  <em>рдЙрдлрд╝, рдПрдХ рд╕рдорд╕реНрдпрд╛ред</em>  рдЦреИрд░, рдЬрд╣рд╛рдВ рд╣рдорд╛рд░рд╛ рдЧрд╛рдпрдм рдирд╣реАрдВ рд╣реБрдЖ ... рд╕рдореГрджреНрдз рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЕрдиреБрднрд╡ рджреНрд╡рд╛рд░рд╛ рд╕рд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЖрдк Google рдкрд░ рдЬрд╛рдПрдВ, "рдПрд▓реНрдл рд╡рд┐рдирд┐рд░реНрджреЗрд╢" рджрд░реНрдЬ рдХрд░реЗрдВ рдФрд░ рд▓рд┐рдВрдХ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред  рдУрд╣!  рдпрд╣ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдкреАрдбреАрдПрдл рдХреА</a> рдУрд░ рдЬрд╛рддрд╛ рд╣реИ ... рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдпрд╣рд╛рдВ рдХреНрдпрд╛ рд╣реИ ... рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ <code>Elf32_Sword</code> рддрд▓рд╡рд╛рд░ - <code>Elf32_Sword</code> рддрд▓рд╡рд╛рд░реЗрдВ - рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдХреНрдпрд╛ рдЪрд╛рд╣рд┐рдПред  32 рдЬрд╛рд╣рд┐рд░ рддреМрд░ рдкрд░ рдЪрд░рд┐рддреНрд░ рдХрд╛ рд╕реНрддрд░ рд╣реИ, рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЙрд▓рдо рдореЗрдВ рджреЛ рдЪрд╛рд░ рд╢рд╛рдпрдж рдиреБрдХрд╕рд╛рди рд╣реИрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЖрдк рдХреНрдпрд╛ рдЬрд░реВрд░рдд рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдХреИрд╕реЗ рд╡реНрдпрд╡рд╕реНрдерд┐рдд! </p><a name="habracut"></a><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдПрдХ рдУрд▓рдВрдкрд┐рдпрд╛рдб рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХрд╛рд░реНрдп рдореЗрдВ рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд╛рдкрд╛рди, рд╕рдореБрд░рд╛рдИ рдФрд░ рдЧреАрд╢рд╛ рдХреЗ рд╡рд┐рд╖рдп рдкрд░ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рдкрд╛рда рдХреЗ рдкреИрд░рд╛рдЧреНрд░рд╛рдл рдХреЗ рдПрдХ рдЬреЛрдбрд╝реЗ рдХреЗ рдмрд╛рдж: "рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╕рдордЭ рдЪреБрдХреЗ рд╣реИрдВ, рдХрд╛рд░реНрдп рдЙрд╕ рдмрд╛рд░реЗ рдореЗрдВ рдмрд┐рд▓реНрдХреБрд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред"  рд╣рд╛рдВ, рдкреНрд░рддрд┐рдпреЛрдЧрд┐рддрд╛ рдХреБрдЫ рд╕рдордп рдХреЗ рд▓рд┐рдП рдереАред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рдореИрдВ рдкрд╛рдВрдЪ рдорд┐рдирдЯ рдХреЗ рддрдк рдХреЛ рдмрдВрдж рдХрд░рдиреЗ рдХреА рдШреЛрд╖рдгрд╛ рдХрд░рддрд╛ рд╣реВрдВред </p><br><p>  рдЖрдЬ рдореИрдВ рдХрд┐рд╕реА рдлрд╝рд╛рдЗрд▓ рдХреЛ 64-рдмрд┐рдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдИрдПрд▓рдПрдл</a> рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реВрдВрдЧрд╛ред  рд╕рд┐рджреНрдзрд╛рдВрдд рд░реВрдк рдореЗрдВ, рдЬреЛ рд╡реЗ рдЗрд╕рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ рд╣реИрдВ рдореВрд▓ рдХрд╛рд░реНрдпрдХреНрд░рдо, рд╕реНрдерд┐рд░ рдкреБрд╕реНрддрдХрд╛рд▓рдп, рдбрд╛рдпрдиреЗрдорд┐рдХ рд▓рд╛рдЗрдмреНрд░реЗрд░реА, рд╣рд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╡рд┐рд╢рд┐рд╖реНрдЯ, рдЬреИрд╕реЗ рдХреНрд░реИрд╢рдбрдореНрдкреНрд╕ ... рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд▓рд┐рдирдХреНрд╕ рдФрд░ рдХрдИ рдЕрдиреНрдп рдпреВрдирд┐рдХреНрд╕ рдЬреИрд╕реЗ рд╕рд┐рд╕реНрдЯрдо, рд╣рд╛рдВ, рд╡реЗ рдХрд╣рддреЗ рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдлреЛрди рднреАред рдЗрд╕рдХрд╛ рд╕рдорд░реНрдерди рд╕рдХреНрд░рд┐рдп рд░реВрдк рд╕реЗ рдкрд╣рд▓реЗ рдкреИрдЪ рдХрд┐рдП рдЧрдП рдлрд░реНрдорд╡реЗрдпрд░ рдореЗрдВ рднрд░рд╛ рд╣реБрдЖ рдерд╛ред  рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдЧрдВрднреАрд░ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рднрдВрдбрд╛рд░рдг рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рд░реВрдк рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдирд╛ рдореБрд╢реНрдХрд┐рд▓ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред  рддреЛ рдореИрдВрдиреЗ рд╕реЛрдЪрд╛ред  рд╣рд╛рдБ, рдпрд╣ рд╢рд╛рдпрдж рд╣реИред  рд▓реЗрдХрд┐рди рд╣рдо рдПрдХ рдмрд╣реБрдд рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░реЗрдВрдЧреЗ: <code>.o</code> рдлрд╝рд╛рдЗрд▓реЛрдВ рд╕реЗ eBPF рдмрд╛рдЗрдЯрдХреЛрдб рд▓реЛрдб рдХрд░рдирд╛ред  рдРрд╕рд╛ рдХреНрдпреЛрдВ?  рдмрд╕ рдЖрдЧреЗ рдХреЗ рдкреНрд░рдпреЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рдХреБрдЫ рдЧрдВрднреАрд░ (рдпрд╛рдиреА, <em>рдШреБрдЯрдиреЗ-рдКрдВрдЪреЗ рдирд╣реАрдВ</em> ) рдХреНрд░реЙрд╕-рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдмрд╛рдпрдЯреЗрдХреЛрдб рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдЬрд┐рд╕реЗ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ рд▓рд┐рдЦреЗ рдЬрд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп рд╕реА рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдИрдПрдХреНрд╕рдкреАрдПрдл рд╕рд░рд▓ рд╣реИ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрд▓рдПрд▓рд╡реАрдПрдо рдмреИрдХрдПрдВрдб рд╣реИред  рдФрд░ рдореБрдЭреЗ рдмрд╕ рдПрдХ рдХрдВрдЯреЗрдирд░ рдХреЗ рд░реВрдк рдореЗрдВ рдИрдПрд▓рдПрдл рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рдмрд╛рдпрдЯреЗрдХреЛрдб рдХреЛ рд╕рдВрдХрд▓рдХ рджреНрд╡рд╛рд░рд╛ рдбрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рдмрд╕ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдореИрдВ рд╕реНрдкрд╖реНрдЯ рдХрд░ рджреВрдВрдЧрд╛: рд▓реЗрдЦ рдЦреЛрдЬрдкрд░рдХ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рд╣реИ рдФрд░ рдПрдХ рд╕рдВрдкреВрд░реНрдг рдЧрд╛рдЗрдб рд╣реЛрдиреЗ рдХрд╛ рджрд╛рд╡рд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред  рдЕрдВрддрд┐рдо рд▓рдХреНрд╖реНрдп рдПрдХ рдмреВрдЯрд▓реЛрдбрд░ рдмрдирд╛рдирд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ рдХреНрд▓реЗрдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдИрдПрдХреНрд╕рдкреАрдПрдл рдореЗрдВ рд╕рдВрдХрд▓рд┐рдд рд╕реА рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ - рдЬреЛ рдореЗрд░реЗ рдкрд╛рд╕ рд╣реИрдВ - рдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ рдЬрд╛рд░реА рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдорд╛рддреНрд░рд╛ рдореЗрдВред </p><br><h1 id="zagolovok">  рд╣реИрдбрд░ </h1><br><p>  рдИрдПрд▓рдПрдл рдореЗрдВ рд╢реВрдиреНрдп рдСрдлрд╕реЗрдЯ рд╕реЗ рд╢реБрд░реВ рд╣реЗрдбрд░ рдирд┐рд╣рд┐рдд рд╣реИред  рдЗрд╕рдореЗрдВ рдмрд╣реБрдд рдЕрдХреНрд╖рд░ E, L, F рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдЬрд┐рдиреНрд╣реЗрдВ рдЖрдк рдкрд╛рда рд╕рдВрдкрд╛рджрдХ рдФрд░ рдХреБрдЫ рд╡реИрд╢реНрд╡рд┐рдХ рдЪрд░ рдХреЗ рд╕рд╛рде рдЦреЛрд▓рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рджрд░рдЕрд╕рд▓, рд╣реЗрдбрд░ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рдСрдлрд╕реЗрдЯ рдкрд░ рд╕реНрдерд┐рдд рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХрдорд╛рддреНрд░ рд╕рдВрд░рдЪрдирд╛ рд╣реИ, рдФрд░ рдЗрд╕рдореЗрдВ рдмрд╛рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рд╢рд╛рдорд┐рд▓ рд╣реИред  <em>(рдЗрд╕рдХреЗ рдмрд╛рдж, рдореИрдВ 32-рдмрд┐рдЯ рдкреНрд░рд╛рд░реВрдк рдФрд░ <code>elf.h</code> рд▓рд┐рдП рдкреНрд░рд▓реЗрдЦрди рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдд <code>elf.h</code> , рдЬреЛ 64-рдмрд┐рдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдиреЛрдЯрд┐рд╕ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЙрдиреНрд╣реЗрдВ рд╕реБрдзрд╛рд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрд╡рддрдВрддреНрд░ рдорд╣рд╕реВрд╕ рдХрд░реЗрдВ)</em> </p><br><p>  рдкрд╣рд▓реА рдЪреАрдЬрд╝ рдЬреЛ рд╣рдореЗрдВ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдорд┐рд▓рддреА рд╣реИ, рд╡рд╣ <code>unsigned char e_ident[16]</code> ред  рдЗрди рдордЬреЗрджрд╛рд░ рд▓реЗрдЦреЛрдВ рдХреЛ рдпрд╛рдж рд░рдЦреЗрдВ "рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдмрдпрд╛рдиреЛрдВ рдореЗрдВ рд╕реЗ рд╕рднреА рдЭреВрдареЗ рд╣реИрдВ" рд╢реНрд░реГрдВрдЦрд▓рд╛?  рдпрд╣рд╛рдБ рдпрд╣ рдЙрд╕реА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣реИ: ELF рдореЗрдВ 32- рдпрд╛ 64-рдмрд┐рдЯ рдХреЛрдб, рд▓рд┐рдЯрд┐рд▓ рдпрд╛ рдмрд┐рдЧ рдПрдВрдбрд┐рдпрди рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдПрдХ рджрд░реНрдЬрди рд╕реЗ рдЕрдзрд┐рдХ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред  рдЖрдк рдЗрд╕реЗ рдереЛрдбрд╝рд╛ рдПрдВрдбрд┐рдпрди рдХреЗ рддрд╣рдд рдПрд▓реНрдл 64 рдХреЗ рд░реВрдк рдореЗрдВ рдкрдврд╝рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ - рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ, рд╕реМрднрд╛рдЧреНрдп ... рдмрд╛рдЗрдЯреНрд╕ рдХреА рдпрд╣ рд╕рд░рдгреА рдПрдХ рддрд░рд╣ рдХрд╛ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рд╣реИ рдЬреЛ рдЕрдВрджрд░ рд╣реИ рдФрд░ рдЗрд╕реЗ рдкрд╛рд░реНрд╕ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдПред </p><br><p>  рдкрд╣рд▓реЗ рдЪрд╛рд░ рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде, рд╕рдм рдХреБрдЫ рд╕рд░рд▓ рд╣реИ - рдпрд╣ <code>[0x7f, 'E', 'L', 'F']</code> ред  рдпрджрд┐ рд╡реЗ рдореЗрд▓ рдирд╣реАрдВ рдЦрд╛рддреЗ рд╣реИрдВ, рддреЛ рдпрд╣ рдорд╛рдирдиреЗ рдХрд╛ рдХрд╛рд░рдг рд╣реИ рдХрд┐ рд╡реЗ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рдЧрд▓рдд рдордзреБрдордХреНрдЦрд┐рдпрд╛рдБ рд╣реИрдВред  рдЕрдЧрд▓реЗ рдмрд╛рдЗрдЯ рдореЗрдВ рдХреНрд▓рд╛рд╕ рд╣реЛрддрд╛ рд╣реИ <del>  рдЪрд░рд┐рддреНрд░ </del>  рдлрд╝рд╛рдЗрд▓: <code>ELFCLASS32</code> рдпрд╛ <code>ELFCLASS64</code> - рдмрд┐рдЯ рдЧрд╣рд░рд╛рдИред  рд╕рд╛рджрдЧреА рдХреЗ рд▓рд┐рдП, рд╣рдо рдХреЗрд╡рд▓ 64-рдмрд┐рдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ (рдХреНрдпрд╛ 32-рдмрд┐рдЯ рдИрдПрдХреНрд╕рдкреАрдПрдл?) рд╣реИред  рдпрджрд┐ рдХрдХреНрд╖рд╛ <code>ELFCLASS32</code> рд╣реЛ <code>ELFCLASS32</code> , рддреЛ рд╣рдо рдмрд╕ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдмрд╛рд╣рд░ рдирд┐рдХрд▓рддреЗ рд╣реИрдВ: рд╕рднреА рд╕рдорд╛рди, рд╕рдВрд░рдЪрдирд╛ "рдлреНрд▓реЛрдЯ" рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдкрд╡рд┐рддреНрд░рддрд╛ рдЬрд╛рдВрдЪ рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЪреЛрдЯ рдирд╣реАрдВ рдкрд╣реБрдВрдЪреЗрдЧреАред  рдЗрд╕ рд╕рдВрд░рдЪрдирд╛ рдореЗрдВ рд╣рдорд╛рд░реЗ рд▓рд┐рдП рдмреНрдпрд╛рдЬ рдХреА рдЕрдВрддрд┐рдо рдмрд╛рдЗрдЯ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рдорд╛рдкреНрддрд┐ рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИ - рд╣рдо рдЕрдкрдиреЗ рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдореВрд▓ рдмрд╛рдЗрдЯ рдСрд░реНрдбрд░ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░реЗрдВрдЧреЗред </p><br><p>  рдпрджрд┐ рдореИрдВ C рдореЗрдВ ELF рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реВрдВ, рддреЛ рдЖрдк рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдмрддрд╛рдПрдВрдЧреЗ: рдЖрдкрдХреЛ рдкреНрд░рддреНрдпреЗрдХ рдЧрдгрдирд╛ рдХреЛ рдЪрддреБрд░рд╛рдИ рд╕реЗ рдЧрдгрдирд╛ рдХрд┐рдП рдЧрдП рдСрдлрд╕реЗрдЯ рд╕реЗ рдШрдЯрд╛рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП - <code>elf.h</code> рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рд╕рдВрд░рдЪрдирд╛рдПрдВ рд╣реИрдВ, рдФрд░ рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ <code>e_ident</code> рдореЗрдВ рдмрд╛рдЗрдЯ рдирдВрдмрд░ рднреА рд╣реИрдВ: <code>EI_MAG0</code> , <code>EI_MAG1</code> , <code>EI_MAG2</code> , <code>EI_MAG3</code> , <code>EI_CLASS</code> рдбреЗрдЯрд╛ рд╕реЗ рдкреЙрдЗрдВрдЯрд░ рдХреЛ рдлрд╛рдЗрд▓ рд╕реЗ рдореЗрдореЛрд░реА рдореЗрдВ рдореИрдк рдпрд╛ рдореИрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреЙрдЗрдВрдЯрд░ рд╕реЗ рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдФрд░ рд░реАрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  <code>e_ident</code> рдЕрд▓рд╛рд╡рд╛ <code>e_ident</code> рд╣реЗрдбрд░ рдореЗрдВ рдЕрдиреНрдп рдлрд╝реАрд▓реНрдб рд╢рд╛рдорд┐рд▓ рд╣реИрдВ, рдХреБрдЫ рд╣рдо рд╕рд┐рд░реНрдл рдЬрд╛рдБрдЪ рдХрд░реЗрдВрдЧреЗ, рдФрд░ рдХреБрдЫ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдЧреЗ рдХреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдмрд╛рдж рдореЗрдВред  рдЕрд░реНрдерд╛рддреН, рд╣рдо <code>e_machine == EM_BPF</code> рдХрд┐ <code>e_machine == EM_BPF</code> (рдЕрд░реНрдерд╛рдд, рдпрд╣ "eBPF рдкреНрд░реЛрд╕реЗрд╕рд░ рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЗ рдЕрдВрддрд░реНрдЧрдд рд╣реИ"), <code>e_type == ET_REL</code> , <code>e_shoff != 0</code> ред  рдЕрдВрддрд┐рдо рдЪреЗрдХ рдХреЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрд░реНрде рд╣реИрдВ: рдПрдХ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдВрдХрд┐рдВрдЧ (рд╕реЗрдХреНрд╢рди рдЯреЗрдмрд▓ рдФрд░ рд╕реЗрдХреНрд╢рди), рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдкреНрд░реЛрдЧреНрд░рд╛рдо рдЯреЗрдмрд▓ рдФрд░ рд╕реЗрдЧрдореЗрдВрдЯ), рдпрд╛ рджреЛрдиреЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рд╣реЛ рд╕рдХрддреА рд╣реИред  рдкрд┐рдЫрд▓реЗ рджреЛ рдЪреЗрдХ рдХреЗ рд╕рд╛рде, рд╣рдо рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рд╣рдореЗрдВ рдЬреЛ рдЬрд╛рдирдХрд╛рд░реА рдЪрд╛рд╣рд┐рдП (рдЬреИрд╕реЗ рдХрд┐ рд▓рд┐рдВрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП) рдлрд╛рдЗрд▓ рдореЗрдВ рд╣реИред  рдпрд╣ рднреА рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдкреНрд░рд╛рд░реВрдк рдХрд╛ рд╕рдВрд╕реНрдХрд░рдг <code>EV_CURRENT</code> ред </p><br><p>  <strong>рддреБрд░рдВрдд рдЖрд░рдХреНрд╖рдг рдХрд░реЗрдВ, рдореИрдВ рдлрд╝рд╛рдЗрд▓ рдХреА рд╡реИрдзрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдирд╣реАрдВ рдХрд░реВрдВрдЧрд╛, рдпрд╣ рдорд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдЕрдЧрд░ рд╣рдо рдЗрд╕реЗ рдЕрдкрдиреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░реЗрдВред</strong>  рдЕрд╡рд┐рд╢реНрд╡рд╛рд╕рд┐рдд рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХрд░реНрдиреЗрд▓ рдпрд╛ рдЕрдиреНрдп рдХрд╛рд░реНрдпрдХреНрд░рдореЛрдВ рдХреЗ рдХреЛрдб рдореЗрдВ, <strong>рдХрд┐рд╕реА рднреА рдорд╛рдорд▓реЗ рдореЗрдВ рдРрд╕рд╛ рдХрд░рдирд╛</strong> рд╕реНрд╡рд╛рднрд╛рд╡рд┐рдХ рд░реВрдк рд╕реЗ <strong>рдЕрд╕рдВрднрд╡ рд╣реИ</strong> ред </p><br><h1 id="tablica-sekciy">  рдЕрдиреБрднрд╛рдЧ рддрд╛рд▓рд┐рдХрд╛ </h1><br><p>  рдЬреИрд╕рд╛ рдХрд┐ рдореИрдВрдиреЗ рдХрд╣рд╛, рд╣рдо рдлрд╛рдЗрд▓ рдХреЗ рд▓рд┐рдВрдХрд┐рдВрдЧ рд╡реНрдпреВ, рдпрд╛рдиреА рд╕реЗрдХреНрд╢рди рдЯреЗрдмрд▓ рдФрд░ рд╕реНрд╡рдпрдВ рд╕реЗрдХреНрд╢рди рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВред  рд╣реЗрдбрд░ рдореЗрдВ рд╕реЗрдХреНрд╢рди рдЯреЗрдмрд▓ рдХреА рддрд▓рд╛рд╢ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рдХрд╣рд╛рдБ рд╣реИред  рдЗрд╕рдХрд╛ рдЖрдХрд╛рд░ рд╡рд╣рд╛рдВ рднреА рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рд╕рд╛рде рд╣реА <strong>рдПрдХ рддрддреНрд╡</strong> рдХрд╛ <strong>рдЖрдХрд╛рд░</strong> - рдпрд╣ <strong>рдЖрдХрд╛рд░ рд╕реЗ</strong> рдмрдбрд╝рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ <code>sizeof(Elf64_Shdr)</code> (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рдВрд╕реНрдХрд░рдг рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░реЗрдЧрд╛, рдореБрдЭреЗ рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ рдкрддрд╛ рдирд╣реАрдВ рд╣реИ)ред  рдХреБрдЫ рдкреНрд░рдореБрдЦ рдЦрдВрдб рд╕рдВрдЦреНрдпрд╛рдПрдБ рдЖрд░рдХреНрд╖рд┐рдд рд╣реИрдВ, рдФрд░ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИрдВред  рдЙрдиреНрд╣реЗрдВ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рд╢реЗрд╖ рдЕрд░реНрде рд╣реИред  рд╣рдо рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдХреЗрд╡рд▓ <code>SHN_UNDEF</code> рдореЗрдВ рд░реБрдЪрд┐ рд░рдЦрддреЗ рд╣реИрдВ (рд╢реВрдиреНрдп рднреА рдЖрд░рдХреНрд╖рд┐рдд рд╣реИ - рд▓рд╛рдкрддрд╛ рдЕрдиреБрднрд╛рдЧ; рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ, рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рдЗрд╕рдХрд╛ рд╢реАрд░реНрд╖рдХ рдЕрднреА рднреА рд╣реИ) <code>SHN_ABS</code> ред  рдЪрд░рд┐рддреНрд░ " <code>SHN_UNDEF</code> рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд" рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИ, рдФрд░ <code>SHN_ABS</code> рдЗрд╕рдХрд╛ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдПрдХ рдкреВрд░реНрдг рдореВрд▓реНрдп рд╣реИ рдФрд░ рдЗрд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рд╣рд╛рд▓рд╛рдБрдХрд┐, <code>SHN_ABS</code> рдореЗрд░реЗ <code>SHN_ABS</code> рдирд╣реАрдВ рд▓рдЧрддреА рд╣реИред </p><br><h2 id="tablica-strok">  рдкрдВрдХреНрддрд┐ рддрд╛рд▓рд┐рдХрд╛ </h2><br><p>  рдпрд╣рд╛рдБ рд╣рдо рдкрд╣рд▓реА рдмрд╛рд░ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдЯреЗрдмрд▓ - рдлрд╛рдЗрд▓ рдореЗрдВ рдкреНрд░рдпреБрдХреНрдд рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЗ рдЯреЗрдмрд▓ рдХреЗ рд▓рд┐рдП рдЖрддреЗ рд╣реИрдВред  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрджрд┐ <code>const char *strtab</code> рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреА рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рд╣реИ, рддреЛ <code>sh_name</code> рдХреЗрд╡рд▓ <code>strtab + sh_name</code> ред  рд╣рд╛рдВ, рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдирд┐рд╢реНрдЪрд┐рдд рд╕реВрдЪрдХрд╛рдВрдХ рд╕реЗ рд╢реБрд░реВ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд░реЗрдЦрд╛ рд╣реИ рдФрд░ рд╢реВрдиреНрдп рдмрд╛рдЗрдЯ рддрдХ рдЬрд╛рд░реА рд╣реИред  рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдкреНрд░рддрд┐рдЪреНрдЫреЗрдж рдХрд░ рд╕рдХрддреА рд╣реИрдВ (рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ, рдПрдХ рджреВрд╕рд░реЗ рдХрд╛ рдкреНрд░рддреНрдпрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИ)ред  рдЕрдиреБрднрд╛рдЧреЛрдВ рдореЗрдВ рдирд╛рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдлрд┐рд░ ELF рд╣реИрдбрд░ рдореЗрдВ <code>e_shstrndx</code> рдлрд╝реАрд▓реНрдб рдкрдВрдХреНрддрд┐ рддрд╛рд▓рд┐рдХрд╛ (рдЕрдиреБрднрд╛рдЧ рдирд╛рдореЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ, рдпрджрд┐ рдХрдИ рд╣реИрдВ) рдХреЗ рдПрдХ рдЦрдВрдб рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛, рдФрд░ рдЕрдиреБрднрд╛рдЧ рд╣реЗрдбрд░ рдореЗрдВ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкрдВрдХреНрддрд┐ рдореЗрдВ <code>sh_name</code> рдлрд╝реАрд▓реНрдбред </p><br><p>  рдкрдВрдХреНрддрд┐ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдкрд╣рд▓реЗ (рд╢реВрдиреНрдп) рдФрд░ рдЕрдВрддрд┐рдо рдмрд╛рдЗрдЯ рдореЗрдВ рдЕрд╢рдХреНрдд рд╡рд░реНрдг рд╣реЛрддреЗ рд╣реИрдВред  рдЙрддреНрддрд░рд╛рд░реНрджреНрдз рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ рдХреНрдпреЛрдВ: рдореВрд▓реНрдп-рдШрдВрдЯреЗ, рдЕрдВрддрд┐рдо рдкрдВрдХреНрддрд┐ рд╕рдорд╛рдкреНрдд рд╣реЛрддреА рд╣реИред  рд▓реЗрдХрд┐рди рд╢реВрдиреНрдп рдСрдлрд╕реЗрдЯ рдПрдХ <em>рдЕрдиреБрдкрд╕реНрдерд┐рдд</em> рдпрд╛ <em>рдЦрд╛рд▓реА</em> рдирд╛рдо рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ - рд╕рдВрджрд░реНрдн рдХреЗ рдЖрдзрд╛рд░ рдкрд░ред </p><br><h2 id="zagruzka-sekciy">  рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ рд╡рд░реНрдЧреЛрдВ </h2><br><p>  рдкреНрд░рддреНрдпреЗрдХ рд╕реЗрдХреНрд╢рди рдХреЗ рд╣реЗрдбрд░ рдореЗрдВ рджреЛ рдПрдбреНрд░реЗрд╕ рд╣реЛрддреЗ рд╣реИрдВ: рдПрдХ, <code>sh_addr</code> рд▓реЛрдб рдПрдбреНрд░реЗрд╕ (рдЬрд╣рд╛рдБ рд╕реЗрдХреНрд╢рди рдХреЛ рдореЗрдореЛрд░реА рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рдПрдЧрд╛), рджреВрд╕рд░рд╛, <code>sh_offset</code> рдЙрд╕ рдлрд╛рдЗрд▓ рдореЗрдВ рдСрдлрд╕реЗрдЯ рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕ рдкрд░ рдпрд╣ рд╕реЗрдХреНрд╢рди рдирд┐рд╣рд┐рдд рд╣реИред  рдореБрдЭреЗ рдирд╣реАрдВ рдкрддрд╛ рдХрд┐ рд╡реЗ рджреЛрдиреЛрдВ рдХреИрд╕реЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рдЗрдирдореЗрдВ рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рдорд╛рди 0 рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: рдПрдХ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЕрдиреБрднрд╛рдЧ "рдбрд┐рд╕реНрдХ рдкрд░ рд░рд╣рддрд╛ рд╣реИ", рдХреНрдпреЛрдВрдХрд┐ рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреА рд╕реЗрд╡рд╛ рдЬрд╛рдирдХрд╛рд░реА рд╣реИред  рджреВрд╕рд░реЗ рдореЗрдВ, рдЕрдиреБрднрд╛рдЧ <em>рдбрд┐рд╕реНрдХ рд╕реЗ рд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ</em> , рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдмрд╕ рдЗрд╕реЗ рдЪреБрдирдиреЗ рдФрд░ рдЗрд╕реЗ рд╢реВрдиреНрдп ( <code>.bss</code> ) рдХреЗ рд╕рд╛рде рд╕реНрдХреЛрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдИрдорд╛рдирджрд╛рд░реА рд╕реЗ, рдЬрдмрдХрд┐ рдореБрдЭреЗ рдбрд╛рдЙрдирд▓реЛрдб рдкрддреЗ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдирд╣реАрдВ рдХрд░рдирд╛ рдерд╛ - рдЬрд╣рд╛рдВ рдЗрд╕реЗ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд╡рд╣рд╛рдВ рдЗрд╕реЗ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ :) рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИрдВ, рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ, рднреАред </p><br><h1 id="relokaciya">  рдкреБрдирд░реНрд╡рд╛рд╕ </h1><br><p>  рдФрд░ рдЕрдм рджрд┐рд▓рдЪрд╕реНрдк рдмрд╛рдд: рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░, рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ, рд╡реЗ рдЖрдзрд╛рд░ рдкрд░ рд╢реЗрд╖ рдСрдкрд░реЗрдЯрд░ рдХреЗ рдмрд┐рдирд╛ рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рдирд╣реАрдВ рдЬрд╛рддреЗ рд╣реИрдВред  рдФрд░ рдЬрдм рд╕реЗ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЕрднреА рднреА рдпрд╣рд╛рдВ рдлрдВрддрд╛рд╕реА рд╣реИ, рдСрдкрд░реЗрдЯрд░ рдХреЗ рд╕рд╛рде рдХрдиреЗрдХреНрд╢рди рдЯреЗрд▓реАрдкреИрдерд┐рдХ рд╣реЛрдЧрд╛ред  рдЕрд░реЗ рд╣рд╛рдБ, рдореИрдВрдиреЗ рдкрд╛рдБрдЪ рдорд┐рдирдЯ рдХреЗ рддрдк рдХреА рдШреЛрд╖рдгрд╛ рдХреАред  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, рд╣рдо рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд▓рд┐рдВрдХрд┐рдВрдЧ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВрдЧреЗред </p><br><p>  рдореЗрд░реЗ рдкреНрд░рдпреЛрдЧ рдХреЗ рд▓рд┐рдП, рдореБрдЭреЗ рдирд┐рдпрдорд┐рдд <code>libdl</code> рд╕рд╛рде рд▓реЛрдб рдХрд┐рдП рдЧрдП рдПрдХ рдирд┐рдпрдорд┐рдд рдмреВрдЯ рдореЗрдВ рд╕рдВрдХрд▓рд┐рдд рдХреЛрдб рдХрд╛ рдПрдХ рдЯреБрдХрдбрд╝рд╛ <code>libdl</code> ред  рдпрд╣рд╛рдБ рдореИрдВрдиреЗ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрди рднреА рдирд╣реАрдВ рдХрд┐рдпрд╛ рд╣реИ - рдмрд╕ <code>dlopen</code> рдЦреЛрд▓реЗрдВ, <code>dlsym</code> рдорд╛рдзреНрдпрдо рд╕реЗ рд╡рд░реНрдгреЛрдВ рдХреЛ рдмрд╛рд╣рд░ <code>dlsym</code> , рдХрд╛рд░реНрдпрдХреНрд░рдо <code>dlclose</code> рд╣реЛрдиреЗ рдкрд░ рдЗрд╕реЗ <code>dlclose</code> рд╕рд╛рде рдмрдВрдж рдХрд░реЗрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣рд╛рдВ рддрдХ тАЛтАЛрдХрд┐ рдпреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╡рд┐рд╡рд░рдг рднреА рд╣реИрдВ рдЬреЛ <em>рд╣рдорд╛рд░реЗ</em> рдИрдПрд▓рдПрдл рдлрд╝рд╛рдЗрд▓ рд▓реЛрдбрд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реИрдВред  рдмрд╕ рдХреБрдЫ <em>рд╕рдВрджрд░реНрдн рд╣реИ</em> : рдирд╛рдо рд╕реЗ рд╕реВрдЪрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ред </p><br><p>  рд╕рд╛рдорд╛рдиреНрдп рддреМрд░ рдкрд░, eBPF рдирд┐рд░реНрджреЗрд╢ рд╕реЗрдЯ рд╕рдВрд░реЗрдЦрд┐рдд рдорд╢реАрди рдХреЛрдб рдХреА рдПрдХ рдЬреАрдд рд╣реИ: рдПрдХ рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рд╣рдореЗрд╢рд╛ 8 рдмрд╛рдЗрдЯреНрд╕ рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рд╕рдВрд░рдЪрдирд╛ рд╣реЛрддреА рд╣реИ </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> opcode; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> dst:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> src:<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> offset; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> imm; };</code> </pre> <br><p>  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдкреНрд░рддреНрдпреЗрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдХрдИ рдХреНрд╖реЗрддреНрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ - рдПрдХ "рдорд╢реАрди" рдХреЛрдб рдХреЗ рд▓рд┐рдП рдЕрдВрддрд░рд┐рдХреНрд╖ рдХреА рдмрдЪрдд рд╣рдорд╛рд░реЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИред </p><br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдкрд╣рд▓рд╛ рдирд┐рд░реНрджреЗрд╢ рддреБрд░рдВрдд рджреВрд╕рд░реЗ рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рднреА рдСрдкрдХреЛрдб рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдмрд╕ 32 рд╕реЗ 64 рдмрд┐рдЯреНрд╕ рддрдХ рддрддреНрдХрд╛рд▓ рдХреНрд╖реЗрддреНрд░ рдХрд╛ рд╡рд┐рд╕реНрддрд╛рд░ рд╣реЛрддрд╛ рд╣реИред  рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рдпреМрдЧрд┐рдХ рдирд┐рд░реНрджреЗрд╢ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреИрдЪ рд╣реИ рдЬрд┐рд╕реЗ <code>R_BPF_64_64</code> рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред </p><br><p>  рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рдмрд╛рд░ рдлрд┐рд░ рд╣рдо <code>sh_type == SHT_REL</code> рдХреЗ рдЕрдиреБрднрд╛рдЧ рддрд╛рд▓рд┐рдХрд╛ рдХреЛ <code>sh_type == SHT_REL</code> ред  рд╢реАрд░реНрд╖ рд▓реЗрдЦ рдХрд╛ <code>sh_info</code> рдлрд╝реАрд▓реНрдб рдЗрдВрдЧрд┐рдд рдХрд░реЗрдЧрд╛ рдХрд┐ рд╣рдо рдХрд┐рд╕ рдЕрдиреБрднрд╛рдЧ рдХреЛ рдкреИрдЪ рдХрд░ рд░рд╣реЗ рд╣реИрдВ, рдФрд░ <code>sh_link</code> - рд╡рд░реНрдгреЛрдВ рдХрд╛ рд╡рд░реНрдгрди рдХрд┐рд╕ рддрд╛рд▓рд┐рдХрд╛ рд╕реЗ рд▓реЗрдирд╛ рд╣реИред </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> Elf64_Addr r_offset; Elf64_Xword r_info; } Elf64_Rel;</code> </pre> <br><p>  рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рджреЛ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рдЕрдиреБрднрд╛рдЧ рд╣реИрдВ: <code>REL</code> рдФрд░ <code>RELA</code> - рджреВрд╕рд░реЗ рдореЗрдВ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдПрдХ рдЕрддрд┐рд░рд┐рдХреНрдд рд╢рдмреНрдж рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВрдиреЗ рдЗрд╕реЗ рдЕрднреА рддрдХ рдирд╣реАрдВ рджреЗрдЦрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рд╕рд┐рд░реНрдл рдЗрд╕ рддрдереНрдп рдкрд░ рдЬреЛрд░ рджреЗрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рд╣рдо рдЗрд╕рдХреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░реЗрдВрдЧреЗред  рдЕрдЧрд▓рд╛, рдореИрдВ рдЙрд╕ рдореВрд▓реНрдп рдореЗрдВ рдЬреЛрдбрд╝реВрдВрдЧрд╛ рдЬреЛ рдирд┐рд░реНрджреЗрд╢реЛрдВ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдкреНрд░рддреАрдХ рдХрд╛ рдкрддрд╛ред  рдФрд░ рдХрд╣рд╛рдВ рд╕реЗ рд▓рд╛рдПрдВ?  рдпрд╣рд╛рдВ, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЬрд╛рдирддреЗ рд╣реИрдВ, рд╡рд┐рдХрд▓реНрдк рд╕рдВрднрд╡ рд╣реИрдВ: </p><br><ul><li>  рдкреНрд░рддреАрдХ <code>SHN_ABS</code> рдЕрдиреБрднрд╛рдЧ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред  рддреЛ рдмрд╕ <code>st_value</code> рд▓реЗ <code>st_value</code> </li><li>  рдЪрд░рд┐рддреНрд░ `SHN_UNDEF рдЕрдиреБрднрд╛рдЧ рдХреЛ рд╕рдВрджрд░реНрднрд┐рдд рдХрд░рддрд╛ рд╣реИред  рдлрд┐рд░ рдмрд╛рд╣рд░реА рдкреНрд░рддреАрдХ рдЦреАрдВрдЪреЗрдВ </li><li>  рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдмрд╕ рдЙрд╕реА рдлрд╝рд╛рдЗрд▓ рдХреЗ рдХрд┐рд╕реА рдЕрдиреНрдп рдЕрдиреБрднрд╛рдЧ рдХреЗ рд▓рд┐рдВрдХ рдХреЛ рдкреИрдЪ рдХрд░реЗрдВ </li></ul><br><h1 id="kak-poprobovat-samomu">  рдЗрд╕реЗ рдЦреБрдж рдХреИрд╕реЗ рдЖрдЬрдорд╛рдПрдВ </h1><br><p>  рдкрд╣рд▓рд╛, рдХреНрдпрд╛ рдкрдврд╝рдирд╛ рд╣реИ?  рдкрд╣рд▓реЗ рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдХреЗ</a> рдЕрд▓рд╛рд╡рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">,</a> рдпрд╣ <a href="">рдЗрд╕ рдлрд╝рд╛рдЗрд▓</a> рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдордЭ рдореЗрдВ рдЖрддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ iovisor рдЯреАрдо eBPF рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рд┐рдирдХреНрд╕ рдХрд░реНрдиреЗрд▓ рд╕реЗ рдирд┐рдХрд╛рд▓реА рдЧрдИ рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░рддреА рд╣реИред </p><br><p>  рджреВрд╕рд░реЗ, рдХреИрд╕реЗ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╕рднреА рдХреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП?  рдкрд╣рд▓реЗ рдЖрдкрдХреЛ рдХрд╣реАрдВ рд╕реЗ ELF рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЬреИрд╕рд╛ рдХрд┐ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рд╕реНрдЯреИрдХрдСрд╡рд░рдлреЙ рдореЗрдВ</a> рдХрд╣рд╛ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрдпрд╛ рд╣реИ</a> , рдЯреАрдо рд╣рдорд╛рд░реА рдорджрдж рдХрд░реЗрдЧреАред </p><br><pre> <code class="bash hljs">clang -O2 -emit-llvm -c bpf.c -o - | llc -march=bpf -filetype=obj -o bpf.o</code> </pre> <br><p>  рджреВрд╕рд░реЗ, рдЖрдкрдХреЛ рдХрд┐рд╕реА рддрд░рд╣ рдлрд╝рд╛рдЗрд▓ рдХреЗ рдПрдХ рд╕рдВрджрд░реНрдн рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХреЛ рдЯреБрдХрдбрд╝реЛрдВ рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд┐рддрд┐ рдореЗрдВ, <code>objdump</code> рдХрдорд╛рдВрдб рд╣рдорд╛рд░реА рдорджрдж рдХрд░реЗрдЧреА: </p><br><pre> <code class="plaintext hljs">$ objdump : objdump &lt;&gt; &lt;()&gt;     &lt;()&gt;.          : -a, --archive-headers Display archive header information -f, --file-headers Display the contents of the overall file header -p, --private-headers Display object format specific file header contents -P, --private=OPT,OPT... Display object format specific contents -h, --[section-]headers Display the contents of the section headers -x, --all-headers Display the contents of all headers -d, --disassemble Display assembler contents of executable sections -D, --disassemble-all Display assembler contents of all sections --disassemble=&lt;sym&gt; Display assembler contents from &lt;sym&gt; -S, --source Intermix source code with disassembly -s, --full-contents Display the full contents of all sections requested -g, --debugging Display debug information in object file -e, --debugging-tags Display debug information using ctags style -G, --stabs Display (in raw form) any STABS info in the file -W[lLiaprmfFsoRtUuTgAckK] or --dwarf[=rawline,=decodedline,=info,=abbrev,=pubnames,=aranges,=macro,=frames, =frames-interp,=str,=loc,=Ranges,=pubtypes, =gdb_index,=trace_info,=trace_abbrev,=trace_aranges, =addr,=cu_index,=links,=follow-links] Display DWARF info in the file -t, --syms Display the contents of the symbol table(s) -T, --dynamic-syms Display the contents of the dynamic symbol table -r, --reloc Display the relocation entries in the file -R, --dynamic-reloc Display the dynamic relocation entries in the file @&lt;file&gt; Read options from &lt;file&gt; -v, --version Display this program's version number -i, --info List object formats and architectures supported -H, --help Display this information</code> </pre> <br><p>  рд▓реЗрдХрд┐рди рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрд╣ рд╢рдХреНрддрд┐рд╣реАрди рд╣реИ: </p><br><pre> <code class="plaintext hljs">$ objdump -d test-bpf.o test-bpf.o:   elf64-little objdump:      UNKNOWN!</code> </pre> <br><p>  рдЕрдзрд┐рдХ рд╕рдЯреАрдХ рд░реВрдк рд╕реЗ, рдпрд╣ рд╡рд░реНрдЧреЛрдВ рдХреЛ рджрд┐рдЦрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрд╕рдВрддреБрд╖реНрдЯ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИред  рдпрд╣рд╛рдВ рд╣рдореЗрдВ рдпрд╛рдж рд╣реИ рдХрд┐ рд╣рдордиреЗ LLVM рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреНрдпрд╛ рдПрдХрддреНрд░ рдХрд┐рдпрд╛ рдерд╛ред  <code>llvm-&lt; &gt;</code> рд╕реЗ рдЙрдкрдпреЛрдЧрд┐рддрд╛рдУрдВ рдХреЗ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдПрдирд╛рд▓реЙрдЧ рд╣реИрдВ, рдлреЙрд░реНрдо <code>llvm-&lt; &gt;</code> рдирд╛рдореЛрдВ рдХреЗ рд╕рд╛рдеред  рд╡реЗ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрд▓рдПрд▓рд╡реАрдПрдо рдмрд┐рдЯрдХреЛрдб рдХреЛ рд╕рдордЭрддреЗ рд╣реИрдВред  рдФрд░ рд╡реЗ eBPF рдХреЛ рднреА рд╕рдордЭрддреЗ рд╣реИрдВ - рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдпрд╣ рд╕рдВрдХрд▓рди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ рдпрд╣ рд╕рдВрдХрд▓рд┐рдд рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕реЗ рд╣рдореЗрд╢рд╛ рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рд▓рд┐рдП, рд╕реБрд╡рд┐рдзрд╛ рдХреЗ рд▓рд┐рдП, рдореИрдВ рдПрдХ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдмрдирд╛рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддрд╛ рд╣реВрдВ: </p><br><pre> <code class="bash hljs">vim <span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-bpf.c <span class="hljs-comment"><span class="hljs-comment">#     clang -Oz -emit-llvm -c test-bpf.c -o - | llc -march=bpf -filetype=obj -o test-bpf.o llvm-objdump -d -t -r test-bpf.o</span></span></code> </pre> <br><p>  рдлрд┐рд░ рдРрд╕реЗ рд╕реНрд░реЛрдд рдХреЗ рд▓рд┐рдП: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdint.h&gt; extern uint64_t z; uint64_t func(uint64_t x, uint64_t y) { return x + y + z; }</span></span></span></span></code> </pre> <br><p>  рдРрд╕рд╛ рдкрд░рд┐рдгрд╛рдо рд╣реЛрдЧрд╛: </p><br><pre> <code class="plaintext hljs">$ ./compile-bpf.sh test-bpf.o: file format ELF64-BPF Disassembly of section .text: 0000000000000000 func: 0: bf 20 00 00 00 00 00 00 r0 = r2 1: 0f 10 00 00 00 00 00 00 r0 += r1 2: 18 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 r1 = 0 ll 0000000000000010: R_BPF_64_64 z 4: 79 11 00 00 00 00 00 00 r1 = *(u64 *)(r1 + 0) 5: 0f 10 00 00 00 00 00 00 r0 += r1 6: 95 00 00 00 00 00 00 00 exit SYMBOL TABLE: 0000000000000000 l df *ABS* 00000000 test-bpf.c 0000000000000000 ld .text 00000000 .text 0000000000000000 g F .text 00000038 func 0000000000000000 *UND* 00000000 z</code> </pre> <br><p>  <a href="">рдХреЛрдб</a> ред </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рднрд╛рдЧ 1. QInst: рдПрдХ рджрд┐рди рдЦреЛрдирд╛ рдмреЗрд╣рддрд░ рд╣реИ, рдлрд┐рд░ рдкрд╛рдВрдЪ рдорд┐рдирдЯ рдореЗрдВ рдЙрдбрд╝рд╛рди рднрд░реЗрдВ (рд▓реЗрдЦрди рдЙрдкрдХрд░рдг рддреБрдЪреНрдЫ рд╣реИ)</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi452592/">https://habr.com/ru/post/hi452592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi452576/index.html">рдЖрдИрдЯреА рдореЗрдВ рдкрд░рд┐рдЪрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
<li><a href="../hi452580/index.html">20 рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ, 20 рднрд╛рд╖рд╛рдУрдВ, рдХрд▓ рдХреА рд╕рдордп рд╕реАрдорд╛ред рднрд╛рдЧ 3</a></li>
<li><a href="../hi452584/index.html">рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдпреВрдирд┐рдХреНрд╕ рд╕рдордп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЧрд▓рдд рдзрд╛рд░рдгрд╛рдПрдВ</a></li>
<li><a href="../hi452586/index.html">рдПрдбреЛрдм рдЗрд▓рд╕реНрдЯреНрд░реЗрдЯрд░ рдореЗрдВ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдХреИрд╕реЗ рд╢реБрд░реВ рдХрд░реЗрдВред рдПрдХ рднрд╛рдЧ</a></li>
<li><a href="../hi452590/index.html">рдЕрдореЗрд░рд┐рдХрди рдиреЗ рдХрдо рдмрдЬрдЯ рдХреЗ 3 рдбреА рдкреНрд░рд┐рдВрдЯрд┐рдВрдЧ рд╕реНрдХреВрд▓реЛрдВ рдореЗрдВ рдмрдЪреНрдЪреЛрдВ рдХреЛ рдкрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореЛрдмрд╛рдЗрд▓ рдХреНрд▓рд╛рд╕рд░реВрдо рдмрдирд╛рдпрд╛, рдпрд╣ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдкрд╣рд▓реЗ рд╣реА 100,000 рд╕реЗ рдЕрдзрд┐рдХ рдХрд╛ рд╕рдВрдЧреНрд░рд╣ рдХрд░ рдЪреБрдХрд╛ рд╣реИ</a></li>
<li><a href="../hi452596/index.html">735,000 IPv4 рдкрддреЗ рдПрдХ рд╕реНрдХреИрдорд░ рд╕реЗ рд▓рд┐рдП рдЧрдП рдФрд░ рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЧрдП</a></li>
<li><a href="../hi452598/index.html">рдкреНрд░реЛрдЧреНрд░рд╛рдорд░ рдХреА рдПрдХ рдЯреАрдо рдХрд╛ рдкреНрд░рдмрдВрдзрди: рдЙрдиреНрд╣реЗрдВ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХреИрд╕реЗ рдФрд░ рдХреИрд╕реЗ рдкреНрд░реЗрд░рд┐рдд рдХрд░рдирд╛ рд╣реИ? рдПрдХ рднрд╛рдЧ</a></li>
<li><a href="../hi452602/index.html">рд╣рд╛рдИ-рд▓реЛрдб рдбреЗрдЯрд╛рдмреЗрд╕ рдореИрдиреЗрдЬрдореЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рд▓рд┐рдП рд╕рд┐рд╕реНрдХреЛ рд╣рд╛рдЗрдкрд░рдлреНрд▓реЗрдХреНрд╕</a></li>
<li><a href="../hi452606/index.html">UDBред рдпрд╣ рдХреНрдпрд╛ рд╣реИ? рднрд╛рдЧ 8. UDB рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рддреЗ рд╣реБрдП</a></li>
<li><a href="../hi452608/index.html">рднрд╛рдЧ 1. QInst: рдПрдХ рджрд┐рди рдЦреЛрдирд╛ рдмреЗрд╣рддрд░ рд╣реИ, рдлрд┐рд░ рдкрд╛рдВрдЪ рдорд┐рдирдЯ рдореЗрдВ рдЙрдбрд╝рд╛рди рднрд░реЗрдВ (рд▓реЗрдЦрди рдЙрдкрдХрд░рдг рддреБрдЪреНрдЫ рд╣реИ)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>