<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👏🏿 🤚🏾 👋🏾 Batterieleistung für MySensors-Geräte 👉🏾 👂🏻 📴</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Diese Musik hält ewig, wenn ich die Batterien austausche (C) 





 Dieses Werk widmet sich meiner Forschung zur Leistung autonomer drahtloser Geräte,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Batterieleistung für MySensors-Geräte</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/465393/"><p>  <em>Diese Musik hält ewig, wenn ich die Batterien austausche (C)</em> </p><br><p><img src="https://habrastorage.org/webt/ut/-j/xu/ut-jxulgxugkbo3hrs8ax8metkg.jpeg"></p><br><p>  Dieses Werk widmet sich meiner Forschung zur Leistung autonomer drahtloser Geräte, die Teil des MySensors Smart Home-Systems sind. </p><br><h2 id="sperva-byl-litiy">  Zuerst gab es Lithium ... </h2><br><p>  Vielmehr Lithium-Ionen- und Lithium-Polymer-Batterien. </p><br><p> Diese Batterien aus alten Geräten haben sich lange Zeit in einer Box angesammelt.  Ich dachte - hier ist es, universelle Leistung für alle kleinen Mikrocontroller.  Darüber hinaus ist die Spannung von 3,3-4,2 V sowohl für AVR als auch für alle Arten von ESP und STM hervorragend.  Aus Gründen der Zuverlässigkeit können Sie einen LDO-Stabilisator mit der erforderlichen Leistung einsetzen und für MK und die gesamte Peripherie stabile 3.3 erhalten. </p><a name="habracut"></a><br><p><img src="https://habrastorage.org/webt/sl/by/e1/slbye1sktidu-9qymebtsw7gwzy.jpeg"></p><br><p>  Aber wie sich herausstellte, ist nicht alles so gut. </p><br><ol><li>  Batterien mussten aufgeladen werden.  Zu diesem Zweck mussten sie entfernbar gemacht oder Ihrem Gerät <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein Lademodul</a> hinzugefügt werden, was wiederum zusätzliche Kosten, Abmessungen und Ladelöcher im Gehäuse verursachte.  Und es ist nicht immer bequem, Geräte wie einen Wettersensor außerhalb des Fensters aufzuladen. </li><li>  Lithiumbatterien (wie die meisten Netzteile im Allgemeinen) sind nicht für den Einsatz bei niedrigen Temperaturen geeignet.  Bei einem am Fenster angebrachten Wettersensor sank die Batterie im Winter sofort im Frost. </li><li>  Wenn die Batteriespannung im Langzeitbetrieb nicht rechtzeitig überwacht wird, können Sie sie "auf Null" entladen, dh unter dem zulässigen Wert, der sie garantiert tötet.  Sie brauchen also Schutz vor Überentladung. </li><li>  Eine Vielzahl von Batteriegrößen und -kapazitäten hat die Wiederholbarkeit von Geräten in identischen Gehäusen erheblich eingeschränkt.  Und die Reserven an alten Batterien gingen schnell zu Ende - deshalb musste man irgendwo Neues kaufen.  Und wie sich herausstellte, waren die Kosten für solche Stromquellen ziemlich hoch und erhöhten die Kosten für jedes Gerät um mindestens 2 US-Dollar (unter Berücksichtigung der Ladetafel und mehr).  Darüber hinaus gab es keine Wirtschaftlichkeit beim Wiederaufladen, da die meisten autonomen Steuerungen sehr wenig Energie verbrauchten und viele Monate ohne Aufladen arbeiten konnten. </li></ol><br><p>  NiMH und andere AA / AAA-Batterien waren noch schlechter.  Sie mussten in einem speziellen Ladegerät aufgeladen werden, hatten einen „Memory-Effekt“ und eine anfänglich niedrige Spannung (1,2-1,3 V), und wenn sie aufgrund des unterschiedlichen Innenwiderstands in Reihe geschaltet wurden, konnte eine der Batterien mehr als andere entladen werden, was wiederum zu ihrer führte Verderb. </p><br><h2 id="i-vnov-litiy-">  Und wieder Lithium ... </h2><br><p>  Jetzt gibt es runde kleine 3,0-V-Lithiumbatterien, für die ich mich entschieden habe, launische und teure Batterien aufzugeben. </p><br><p>  CR2032-Batterien werden in einer Vielzahl von BIOS-Computern, Stromzählern und anderen Geräten mit RTC, Uhren, Taschenrechnern und verschiedenen Spielzeugen verwendet.  Mit kleinen Abmessungen und niedrigem Preis haben sie eine Spannung von 3,0 V, was für MK völlig ausreichend ist, und eine anständige Kapazität von 200 bis 250 mA / h für ihre Abmessungen. </p><br><p><img src="https://habrastorage.org/webt/-x/4l/rx/-x4lrx1wg7c5gxmliml_lufiuyi.jpeg"></p><br><p>  Aber wieder Probleme.  Die Tatsache der Sache.  dass der Gleichstrom einer solchen Batterie nur 0,4mA beträgt.  Wenn Sie es mit einem höheren Strom laden, fällt die Batteriespannung ab, obwohl es sich dann teilweise oder vollständig erholen kann.  Ein typischer Mysensor-Schlafmodus verbraucht mehrere Mikroampere.  Aber im Übertragungsmodus - schon ca. 15-20mA.  Gleichzeitig zwingen neue Versionen der MySensors-Bibliothek Geräte dazu, viele Pakete zu senden - Ping, Begrüßung, Präsentationen, Suche nach einem Gateway oder Router, was zu einem langen, manchmal mehrere Sekunden dauernden Betrieb des Funkmoduls führt.  Bei einer Spannung von ca. 2 V beginnt das billige chinesische NRF24L01 zu versagen, und manchmal ist es nicht einmal möglich, sie von MySensors in den Schlaf zu versetzen (). </p><br><p>  Infolgedessen funktioniert alles irgendwie mit einer frischen Batterie, aber wenn sich die Batterie entlädt, die Kommunikationsprobleme zunehmen, beginnt das Funkmodul mehr in die Luft zu fluten, was die Batterieentladung erhöht.  Am Ende fällt die Spannung bis zu dem Punkt ab, an dem das gesamte Gerät nicht mehr in den Ruhezustand wechselt, und anschließend erfolgt ein zyklischer Neustart, bis der Akku vollständig entladen ist. </p><br><p>  Je nach Hersteller und "Frische" des Akkus kann das Gerät einige Tage bis zu einem Monat arbeiten.  Wenn Sie bei aliexpress billige Batterien kaufen, gibt es eine Lotterie.  Der Übergang zu den geräumigeren CR2450 und CR2477 spart ein wenig, aber sie wissen lange nicht, wie sie einen Strom von mehr als 0,5 mA liefern sollen. </p><br><p>  Eine Weile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">experimentierte</a> ich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">mit Aufwärtswandlern</a> , die es der Batterie ermöglichten, die normale Betriebsspannung für den MK bis zu den letzten Krümeln der Energie aufrechtzuerhalten, aber sie hatten einen kleinen Ruhestrom ungleich Null, was die Gesamtlebensdauer verkürzte. </p><br><h2 id="palchiki---mizinchiki">  Kleine Finger - kleine Finger </h2><br><p><img src="https://habrastorage.org/webt/ym/3r/sp/ym3rsphakzuewavswscm7ot7vvi.jpeg"></p><br><p>  Es ist Zeit, sich zu beruhigen und die "fortgeschrittene" chinesische Erfahrung zu nutzen, um alle Ihre Geräte mit drei AAA zu versorgen (Batterien sind nicht im Lieferumfang enthalten).  Er entschied sich jedoch für eine Lösung mit mindestens zwei 1,5-Volt-Batterien. </p><br><p>  Ich habe bei einem solchen Schema mit einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zunehmenden Stabilisator NCP1400 angehalten</a> : </p><br><p><img src="https://habrastorage.org/webt/zy/bv/ii/zybviid6dds-ng2kwivuenh9gli.jpeg"></p><br><p>  Zwei in Reihe geschaltete alkalische AAA-Batterien liefern am Ende des Produktionszeitraums zunächst 2,7-3,1 V, wodurch die Spannung auf 1-2 V reduziert wird </p><br><p>  Wenn der NCP1400 ausgeschaltet ist (niedriger Pegel am Steuereingang), wird die Batterie sofort über die L1-Spule und die Schottky-d1-Diode mit einem minimalen Spannungsabfall von etwa 0,1 V an den MC geliefert.  Wenn an den Steuereingang ein hoher Pegel angelegt wird, startet der NCP1400-Stabilisator und gibt dem MK eine Spannung von 3,3 V mit einer Gesamtbatteriespannung von 0,8 V bis 3,1 V. </p><br><h4 id="algoritm-raboty-takoy">  Der Operationsalgorithmus ist wie folgt: </h4><br><ol><li>  Während sich der Controller hauptsächlich im PowerDownMode befindet, sind alle Peripheriegeräte, einschließlich des NRF24, deaktiviert oder befinden sich auch im Energiesparmodus. </li><li>  Der MC verlässt den Ruhemodus durch Unterbrechung durch den Timer oder durch eine externe Unterbrechung (z. B. bei Schaltern durch Unterbrechung durch die Taste). Die Versorgungsspannung VCC (eingebaute Funktion von AVR-Controllern) wird gemessen. </li><li>  Wenn die Versorgungsspannung größer als 3 V ist (oder eine andere Spannung, die für einen stabilen Peripheriebetrieb ausreicht), startet der NCP1400 nicht und die gesamte Verarbeitung wird bei dieser Versorgungsspannung bis zum nächsten Ruhezyklus ausgeführt. </li><li>  Wenn die Spannung unter 3 V liegt, startet der NCP1400-Stabilisator, die Versorgungsspannung wird auf 3,3 V eingestellt, die gesamte reguläre Verarbeitung des Geräts wird durchgeführt, einschließlich des Sendens von Daten über NRF24 </li><li>  Wenn die Spannung über 1,7 V liegt (ausreichende Spannung, um den MC aus dem Ruhemodus zu verlassen), wird der NCP1400 bis zum nächsten Aufweckzyklus ausgeschaltet. </li><li>  Wenn die Spannung weniger als 1,7 beträgt (die minimale Spannung des MK), schaltet sich der NCP1400 erst aus, wenn der Controller neu startet oder wenn die Versorgungsspannung unter 0,8 V fällt (Spannung des NCP1400). </li></ol><br><div class="spoiler">  <b class="spoiler_title">Skizze dieses Algorithmus</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RF24_CE_PIN 9 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RF24_CS_PIN 10 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RF24_POWER_PIN 8 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MY_RADIO_NRF24 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;MySensors.h&gt; #define PIN_NCP1400 2 #define CHILD_ID_VCC 0 MyMessage msgVcc(CHILD_ID_VCC, V_VOLTAGE); bool low_power = false; int readVcc(); // void before(){ pinMode(PIN_NCP1400,OUTPUT); digitalWrite(PIN_NCP1400,HIGH); } void presentation(){ sendSketchInfo("NCP1400 test", "1.0"); present(CHILD_ID_VCC, S_MULTIMETER,"mV"); } // void loop(){ int vcc = 1000; if( low_power == false ){ vcc = readVcc(); digitalWrite(PIN_NCP1400,HIGH); //  NRF1400 } if( vcc &lt; 1700 )low_power = true; //      NRF1400 send(msgVcc.set(vcc)); //  VCC if( low_power == false )digitalWrite(PIN_NCP1400,LOW); //  NRF1400 sleep( 300000 ); //      5  } /** *     VCC  */ int readVcc() { long result; // Read 1.1V reference against AVcc ADMUX = _BV(REFS0) | _BV(MUX3) | _BV(MUX2) | _BV(MUX1); delay(2); // Wait for Vref to settle ADCSRA |= _BV(ADSC); // Convert while (bit_is_set(ADCSRA,ADSC)); result = ADCL; result |= ADCH&lt;&lt;8; result = (1100L * 1023)/result; return((int)result); }</span></span></span></span></code> </pre> </div></div><br><h2 id="testirovanie">  Testen </h2><br><p>  Und wie gehen wir in der Praxis mit dem aktuellen Verbrauch um?  Ich schließe meinen Stromkreis an den LBP an und messe den Stromverbrauch und die Ausgangsspannung. </p><br><p><img src="https://habrastorage.org/webt/ti/ss/_z/tiss_zsvv77ac2gpbmcmkigrwge.jpeg"></p><br><p>  Der Leerlaufstrom bei ausgeschaltetem NCP1400 und einer Eingangsspannung von 1-3 V betrug 0,3 μA.  Noch niedriger als die im Datenblatt angegebenen 0,5 mkA (oder vielleicht geben meine Geräte in diesem Bereich einen großen Fehler aus).  Bei eingeschaltetem Stabilisator ohne Last stellte sich heraus, dass der Strom unerwartet groß war - mehr als 0,3 mA.  Es stellte sich heraus, dass der Pull-up-Widerstand R1 einen hohen Verbrauch verursachte.  Durch Ersetzen der R1-Bewertung von 10 K auf 150 K erhielt ich 30 μA bei einer Eingangsspannung von 3,0 V und 44 μA bei 1,0 V. </p><br><p>  Wenn Sie den Widerstand R1 vollständig entfernen, wird der Stabilisator, wenn dieser Eingang nicht mit dem MC verbunden ist, ständig mit einer ankommenden 2 V von etwa 11 μA verbraucht. <br>  Jetzt verbinde ich den Mikrocontroller mit NRF24L01 und dem HUD21-Sensor und arbeite nach dem oben beschriebenen Algorithmus: </p><br><ul><li>  Eingangsspannung 3,0 V - aktiver Modus (NCP1400 ist eingeschaltet) 32 mA, Schlafmodus (NCP1400 ist ausgeschaltet) 9 mA </li><li>  Eingangsspannung 2,0 V - aktiver Modus (NCP1400 ist eingeschaltet) 51 mA, Schlafmodus (NCP1400 ist ausgeschaltet) 6 mA </li><li>  Eingangsspannung 1,7 V - aktiver Modus (NCP1400 ein) 63 mA, Schlafmodus (NCP1400 aus) 5,6 mA </li><li>  Eingangsspannung 1.0V - NCP1400 ist ständig eingeschaltet - Schlafmodus 197mkA </li><li>  Eingangsspannung 0,5 V - NCP1400 ist ständig eingeschaltet - 397 μA Schlafmodus </li></ul><br><p>  Der aktive Batterieverbrauch steigt, wenn die Leistung reduziert wird.  Die Spannung von 1,7 V wurde experimentell gewählt.  Unterhalb dieses Wertes arbeitet der Mikrocontroller möglicherweise bereits nicht stabil.  Wenn die Batteriespannung unter diesen Schwellenwert fällt, schaltet sich der NCP1400-Stabilisator nicht mehr aus und der Verbrauch im Schlafmodus ist ziemlich hoch.  In diesem Modus halten die Batterien nicht lange, aber es bleibt genügend Zeit, um sie auszutauschen. </p><br><h2 id="voploschenie-v-zheleze">  Verkörperung in der Drüse </h2><br><p>  Entwickelte universelle Stromversorgungsplatinen für meine Smart-Home-Geräte </p><br><p><img src="https://habrastorage.org/webt/q5/gv/io/q5gviogxu9mb_biahhyvvdv0bpo.jpeg"></p><br><p><img src="https://habrastorage.org/webt/eg/da/sc/egdasc6nwhiv_frbsr_glatlqsy.jpeg"></p><br><p>  Und obwohl die fertigen Geräte nicht so kompakt waren wie mit Lithiumbatterien, war das Ergebnis für mich ganz gut.  vor allem angesichts der Kosten für Alkalibatterien in den Geschäften von Galomart, Kastorama, Leroyle usw. </p><br><p><img src="https://habrastorage.org/webt/zp/vw/sm/zpvwsmw1ocdc7plhi0pupkqhmww.jpeg"></p><br><p>  Derzeit arbeite ich zu Hause mit mehr als einem Dutzend verschiedenen Geräten zur Überwachung von Temperatur, Bodenfeuchtigkeit usw. im MuSensors / MajorDoMo-System. </p><br><p>  Lesen Sie mehr <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">in meinem Blog</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de465393/">https://habr.com/ru/post/de465393/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de465373/index.html">Kein Test des ASUS ZenBook Pro 15 UX580GE - fast ein Jahr mit fast der Spitze</a></li>
<li><a href="../de465375/index.html">Verkauf von dedizierten Servern in den Niederlanden und in Moskau</a></li>
<li><a href="../de465377/index.html">Mach es selbst Skype</a></li>
<li><a href="../de465379/index.html">Selbstgemachte drahtlose eigenständige Insulinpumpensteuerung</a></li>
<li><a href="../de465391/index.html">Auf den Spuren der russischen Scala-Bewegung. Teil 1</a></li>
<li><a href="../de465395/index.html">Was ist der Hauptunterschied zwischen Dependency Injection und Service Locator?</a></li>
<li><a href="../de465397/index.html">Wie ist der Nitro-Übersetzer entstanden, der Entwicklern bei der Lokalisierung und beim technischen Support hilft?</a></li>
<li><a href="../de465399/index.html">Stellen Sie verteilten CEPH-Speicher bereit und verbinden Sie ihn mit Kubernetes</a></li>
<li><a href="../de465401/index.html">5 Aktivitäten zur Beschleunigung der Problemlösung in einem beliebigen IT-Team</a></li>
<li><a href="../de465403/index.html">Achtung! Neue Kameras unterwegs oder aktuelle Informationen zu Radargeräten und Radarwarnern</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>