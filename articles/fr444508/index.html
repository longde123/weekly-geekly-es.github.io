<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì° ü§û üïí Comment nous avons rendu PHP 7 deux fois plus rapide que PHP 5. Partie 1: optimisation des structures de donn√©es ‚ôëÔ∏è üöß üë®üèº‚Äçüé®</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="En d√©cembre 2015 , PHP 7.0 a √©t√© publi√©. Les entreprises qui sont pass√©es au ¬´sept¬ª ont not√© que la productivit√© avait augment√© et que la charge sur l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment nous avons rendu PHP 7 deux fois plus rapide que PHP 5. Partie 1: optimisation des structures de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/444508/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En d√©cembre 2015</a> , PHP 7.0 a √©t√© publi√©.  Les entreprises qui sont pass√©es au ¬´sept¬ª ont not√© que la productivit√© avait augment√© et que la charge sur le serveur avait diminu√©.  Les premiers √† passer aux sept ont √©t√© Vebia et Etsy, et nous avons Badoo, Avito et OLX.  Pour Badoo, le passage aux sept a co√ªt√© 1 million de dollars en √©conomies de serveur.  Gr√¢ce √† PHP 7 dans OLX, la charge moyenne du serveur a diminu√© de 3 fois, augmentant l'efficacit√© et les √©conomies de ressources. <br><br>  <strong>Dmitry Stogov</strong> de Zend Technologies a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">parl√©</a> √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++</a> , ce qui a augment√© la productivit√©.  En d√©codage: sur la structure interne de PHP, sur les id√©es au c≈ìur de la version 7.0, sur les changements dans les structures de donn√©es de base et les algorithmes qui ont d√©termin√© le succ√®s. <br><br>  <em>Avertissement: En mars 2019,</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>80% des sites</em></a> <em>fonctionnaient sur PHP et</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>70% d'entre eux</em></a> <em>fonctionnaient sur</em> <em>PHP 5, bien que</em> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><em>cette version ne soit plus prise en charge</em></a> <em>depuis le 1er janvier 2019</em> <em>.</em>  <em>Le rapport de Dmitry de 2016 sur les principes en raison desquels il y a eu un double saut de productivit√© entre PHP 5 et 7 est √©galement pertinent en mars 2019. Pour la moiti√© des sites, bien s√ªr.</em> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/tHapNKpacSQ" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><a name="habracut"></a><br>  <strong>√Ä propos de l'orateur: Dmitry Stogov a</strong> commenc√© √† programmer dans les ann√©es 80: ¬´Electronics B3-34¬ª, Basic, assembleur.  En 2002, Dmitry s'est familiaris√© avec PHP et a rapidement commenc√© √† l'am√©liorer: il a d√©velopp√© Turck MMCache pour PHP, a g√©r√© le projet PHPNG et a jou√© un r√¥le important dans le travail sur JIT pour PHP.  Les 14 derni√®res ann√©es d'ing√©nieur principal chez Zend Technologies. <br><br>  Zend Technologies d√©veloppe PHP et des solutions commerciales bas√©es sur lui.  En 1999, il a √©t√© fond√© par les programmeurs isra√©liens Andy Gutmans et Zeev Suraski, qui ont cr√©√© il y a deux ans PHP 3. Ces personnes √©taient √† la pointe du d√©veloppement PHP et ont largement d√©termin√© l'apparence actuelle du langage et le succ√®s de la technologie. <br><br>  Zend Technologies d√©veloppe le noyau PHP et ses applications, et pendant le travail, j'ai d√ª √©crire des extensions, entrer dans tous les sous-syst√®mes et m√™me m'engager dans des projets commerciaux, parfois pas du tout connect√©s avec PHP.  Mais le sujet le plus int√©ressant pour moi a toujours √©t√© la <strong>performance</strong> . <br><br>  J'ai commenc√© √† chercher des moyens d'acc√©l√©rer PHP avant m√™me de rejoindre Zend, travaillant sur mon propre projet en concurrence avec l'entreprise.  Pendant le travail sur le projet, j'ai bien compris le langage et r√©alis√© que ne pas travailler avec le projet mainstream, vous ne pouvez influencer que certains aspects de l'ex√©cution du script, et tous les plus int√©ressants et efficaces ne peuvent √™tre cr√©√©s <strong>que dans le noyau</strong> .  Cette compr√©hension et cette co√Øncidence m'ont conduit √† Zend. <br><br><h2>  Une petite parenth√®se dans l'histoire de PHP </h2><br>  PHP n'est pas seulement et <strong>pas seulement un langage de programmation</strong> .  PHP signifie Personal Home Page - un outil pour cr√©er des pages Web personnelles et des sites Web dynamiques.  La langue n'est qu'une de ses principales parties.  PHP est une √©norme biblioth√®que de fonctions, de nombreuses extensions pour travailler avec d'autres biblioth√®ques tierces, par exemple, pour acc√©der √† la base de donn√©es ou aux analyseurs XML, ainsi qu'un ensemble de modules pour communiquer avec divers serveurs Web. <br><br>  Le programmeur danois <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Rasmus Lerdorf a</a> introduit PHP <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en juin 1995</a> .  √Ä l'√©poque, ce n'√©tait qu'une <strong>collection de scripts CGI √©crits en Perl</strong> .  En avril 96, Rasmus a introduit PHP / FI, et en juin PHP / FI 2.0 a √©t√© publi√©.  Par la suite, cette version a √©t√© substantiellement retravaill√©e par Andy Gutmans et Zeev Surasky, et dans la 98e version PHP 3.0.  En 2000, le langage est devenu le type que nous avons l'habitude de voir aujourd'hui √† la fois en termes de langage et d'architecture interne - PHP 4, bas√© sur le moteur Zend. <br><br>  Depuis la version 4, PHP a √©volu√©.  Le tournant a √©t√© la sortie de PHP 5 en 2004, lorsque le <strong>mod√®le objet a √©t√© compl√®tement mis √† jour</strong> .  C'est elle qui a ouvert l'√®re des frameworks PHP et soulev√© la question des performances √† un nouveau niveau.  Anticipant cela, imm√©diatement apr√®s la sortie de la version 5.0, chez Zend, nous avons pens√© √† acc√©l√©rer PHP et avons commenc√© √† travailler sur l'am√©lioration de la productivit√©. <br><br>  La version 7.1, sortie en novembre 2016 sur des tests synth√©tiques, <strong>est 25 fois plus rapide que la version 2002</strong> .  Selon le graphique des changements de performances dans diff√©rentes branches, les principales perc√©es sont visibles en 5.1 et 7.0. <br><br><img src="https://habrastorage.org/webt/ao/_s/mp/ao_smpopukfzjmclxqqu83xefvo.png"><br><br>  Dans la version 5.1, nous venons de commencer √† travailler sur les performances, et tout ce que nous avons obtenu a √©t√© obtenu, mais apr√®s 5.3 nous sommes tomb√©s sur un mur, toutes les tentatives pour am√©liorer l'interpr√©teur ont √©chou√©. <br><br>  N√©anmoins, nous avons trouv√© o√π creuser et avons obtenu encore plus que pr√©vu - une acc√©l√©ration de 2,5 fois par rapport √† la version pr√©c√©dente 5,6 lors des tests.  Mais le plus int√©ressant est que nous avons obtenu la m√™me acc√©l√©ration de 2,5 fois sur des applications r√©elles inchang√©es.  C'est un ph√©nom√®ne, car nous avons d√©velopp√© le facteur 2 pr√©c√©dent tout au long de la vie des cinq en 10 ans. <br><br><img src="https://habrastorage.org/webt/ge/9j/n_/ge9jn_isn9hxm-gbrk0ahaexfms.png"><br><br>  L'√©norme saut en 5.1 sur les tests synth√©tiques n'est pas perceptible sur les applications r√©elles.  La raison en est qu'avec des utilisations diff√©rentes, les performances PHP reposent sur les freins associ√©s √† diff√©rents sous-syst√®mes. <br><br>  <strong>L'histoire de PHP 7 commence par une stagnation de trois ans</strong> qui a commenc√© en 2012 et s'est termin√©e en 2015 avec la sortie de la septi√®me version.  Puis nous avons r√©alis√© que nous ne pouvions plus augmenter la productivit√© avec de petites am√©liorations de notre interpr√®te et nous nous sommes tourn√©s vers le c√¥t√© JIT. <br><br><h2>  Se promener dans JIT </h2><br>  Pr√®s de deux ans, nous avons pass√© sur le prototype JIT pour PHP-5.5.  Au d√©but, nous avons g√©n√©r√© un code tr√®s simple - une s√©quence d'appels pour les gestionnaires standard, quelque chose comme un code Fort assembl√©.  Ensuite, ils ont √©crit leur propre <strong>assembleur d'ex√©cution</strong> , en ligne un code s√©par√© pour les solutions de contournement, mais ont r√©alis√© que ces <strong>optimisations de bas niveau ne donnaient pas d'</strong> effet <strong>pratique</strong> m√™me sur les tests. <br><br>  Nous avons ensuite pens√© √† d√©river des types de variables √† l'aide de m√©thodes d'analyse statique.  Ayant r√©alis√© la conclusion, nous avons imm√©diatement re√ßu <strong>une acc√©l√©ration double dans les tests.</strong>  Encourag√©s, ils ont essay√© d'√©crire des allocateurs de registres mondiaux, mais ont √©chou√©.  Nous avons utilis√© une repr√©sentation assez √©lev√©e et il √©tait presque impossible de l'utiliser pour l'allocation des registres. <br><br>  Pour √©viter les probl√®mes avec un niveau bas, nous avons d√©cid√© d'essayer LLVM, et apr√®s un an nous avons eu une <strong>acc√©l√©ration 10x pour bench.php</strong> , mais rien sur les applications r√©elles.  De plus, la compilation des applications r√©elles prenait maintenant quelques minutes, par exemple, la premi√®re <strong>demande √† Wordpress prenait 2 minutes et ne donnait pas d'acc√©l√©ration.</strong>  Bien s√ªr, cela n'√©tait pas du tout adapt√© √† une pratique r√©elle. <br><br><blockquote>  Un bon code est possible avec une pr√©diction de type appropri√©e, qui fonctionne mal dans des applications r√©elles, et l'utilisation de structures de donn√©es PHP rend le code g√©n√©r√© inefficace. </blockquote><br><h3>  Qu'est-ce qui ralentit? </h3><br>  Nous avons repens√© les raisons des √©checs et d√©cid√© √† nouveau de voir pourquoi PHP est lent.  L'image montre le r√©sultat du profilage de plusieurs demandes vers la page d'accueil de Wordpress. <br><br><img src="https://habrastorage.org/webt/3w/dh/7v/3wdh7vd40xumtwtyqgshsdan-a8.png"><br><br>  Moins de 30% sont d√©pens√©s pour interpr√©ter le bytecode, 20% est la surcharge du gestionnaire de m√©moire, 13% travaille avec des tables de hachage et 5% travaille avec des expressions r√©guli√®res. <br><br>  En travaillant chez JIT, nous ne nous sommes d√©barrass√©s que des premiers 30%, et tout le reste √©tait mort.  Presque partout, nous avons √©t√© oblig√©s d'utiliser des structures de donn√©es PHP standard, ce qui entra√Ænait des frais g√©n√©raux: allocation de m√©moire, comptage de r√©f√©rences, etc.  Cette compr√©hension a conduit √† la conclusion qu'il est n√©cessaire de remplacer les structures de donn√©es cl√©s en PHP.  Avec cette <strong>substitution de la fondation</strong> , le projet <strong>PHPNG</strong> a <strong>commenc√©.</strong> <br><br><h2>  Phpng  Nouvelle g√©n√©ration </h2><br>  Le projet a √©t√© d√©velopp√© apr√®s des tentatives infructueuses de cr√©ation de JIT pour PHP.  L'objectif principal est <strong>d'atteindre un nouveau niveau de productivit√© et de jeter les bases d'am√©liorations futures</strong> . <br><br>  Nous nous sommes promis pendant un certain temps de ne plus utiliser de tests synth√©tiques pour mesurer les performances - ce sont g√©n√©ralement de petits programmes informatiques qui utilisent une quantit√© limit√©e de donn√©es qui tient enti√®rement dans le cache du processeur.  Les applications r√©elles, en revanche, sont soumises aux freins associ√©s √† la m√©moire du sous-syst√®me, et une seule lecture dans la m√©moire peut co√ªter 100 instructions de calcul.  <strong>Le projet PHPNG est une refactorisation des structures de donn√©es PHP cl√©s pour optimiser l'acc√®s √† la m√©moire</strong> .  Aucune innovation, 100% compatible PHP 5. <br><br>  Comment changer ces structures √©tait clair.  Mais le volume des changements d√©pendants √©tait √©norme, car le <strong>c≈ìur de PHP</strong> lui <strong>-</strong> m√™me <strong>est de 150 000 lignes</strong> , et presque chaque tiers devait √™tre chang√©.  Ajoutez une centaine d'extensions suppl√©mentaires incluses dans la distribution de base, une douzaine de modules pour diff√©rents serveurs Web et vous r√©aliserez la grandeur du projet. <br><br>  Nous n'√©tions m√™me pas s√ªrs de terminer le projet.  Par cons√©quent, ils ont lanc√© le projet en secret et ne l'ont ouvert que lorsque les premiers r√©sultats optimistes sont apparus.  Il a fallu deux semaines pour simplement <strong>compiler le noyau</strong> .  Deux semaines plus tard, bench.php a gagn√©.  Nous avons pass√© un mois et demi pour soutenir Wordpress.  Un mois plus tard, nous avons ouvert le projet - c'√©tait en mai 2014.  √Ä cette √©poque, nous avions une <strong>acc√©l√©ration de 30% sur Wordpress</strong> .  Cela semblait d√©j√† √™tre un grand √©v√©nement. <br><br>  PHPNG a imm√©diatement suscit√© une vague d'int√©r√™t, et en ao√ªt 2014, il a √©t√© <strong>adopt√© comme base pour l'avenir de PHP 7</strong> .  C'√©tait d√©j√† un autre projet, avec un ensemble d'objectifs diff√©rents, o√π la productivit√© n'√©tait que l'un d'entre eux. <br><br><h2>  PHP 7.0 </h2><br>  La version num√©ro 7 elle-m√™me √©tait dans le doute.  La version pr√©c√©dente √©tait la cinqui√®me.  Et le sixi√®me a √©t√© d√©velopp√© il y a plusieurs ann√©es et √©tait enti√®rement consacr√© au support <strong>Unicode</strong> natif, mais les d√©cisions infructueuses prises aux premiers stades de d√©veloppement ont conduit √† une complexit√© excessive du code du noyau et de chaque extension.  Finalement, il a √©t√© d√©cid√© de geler le projet. <br><br>  √Ä cette √©poque, une grande quantit√© de mat√©riel consacr√© √† PHP 6 avait d√©j√† √©t√© accumul√©: discours lors de conf√©rences, livres publi√©s.  Afin de ne d√©router personne, nous avons appel√© le projet PHP 7, en sautant PHP 6. Cette version √©tait beaucoup plus chanceuse - PHP 7 est sorti en d√©cembre 2015, presque comme pr√©vu. <br><br>  En plus des performances, certaines innovations recherch√©es depuis longtemps sont apparues dans PHP 7: <br><br><ul><li>  Possibilit√© de d√©finir des types scalaires de param√®tres et des valeurs de retour. </li><li>  Exceptions au lieu d'erreurs - nous pouvons maintenant les d√©tecter et les traiter. </li><li> <code>Zero-cost assert()</code> , classes anonymes, incoh√©rences de nettoyage, nouveaux op√©rateurs et fonctions (&lt;=&gt;, ??) sont apparus. </li></ul><br>  L'innovation est bonne, mais revenons aux changements internes.  Parlons du chemin que PHP 7 a suivi et o√π ce chemin peut nous mener. <br><br><h2>  zval </h2><br>  Il s'agit de la structure de base des donn√©es PHP.  Il est utilis√© pour <strong>repr√©senter n'importe quelle valeur en PHP</strong> .  Puisque notre langage est typ√© dynamiquement et que le type de variables peut changer pendant l'ex√©cution du programme, nous devons stocker un champ de type (type zend_uchar), qui peut prendre les valeurs IS_NULL, IS_BOOL, IS_LONG, IS_DOUBLE, IS_ARRAY, IS_OBJECT, etc., et en fait la valeur repr√©sent√©e par union (valeur), o√π un entier, un nombre r√©el, une cha√Æne, un tableau ou un objet peuvent √™tre stock√©s. <br><br><h3>  zval en PHP 5 </h3><br>  La m√©moire de chacune de ces structures a √©t√© allou√©e s√©par√©ment dans Heap.  En plus du type et de la valeur, il contenait √©galement un compteur de r√©f√©rences √† la structure.  La structure a donc pris 24 octets, sans compter les frais g√©n√©raux du gestionnaire de m√©moire et le pointeur vers celui-ci. <br><br>  L'image en haut √† droite montre les structures de donn√©es qui ont √©t√© cr√©√©es dans la m√©moire de PHP 5 pour un script simple. <br><br><img src="https://habrastorage.org/webt/m8/km/ix/m8kmixgehjrhtxthe-gefmmi86i.png"><br><br>  Sur la pile, de la m√©moire a √©t√© allou√©e √† 4 variables repr√©sent√©es par des pointeurs.  Les valeurs elles-m√™mes (zval) sont sur le tas.  Dans notre cas, ce ne sont que deux zval, dont chacun est r√©f√©renc√© par deux variables, et en cons√©quence leurs compteurs de r√©f√©rence sont d√©finis sur 2. <br><br>  Pour acc√©der √† un type ou √† une valeur scalaire, vous avez besoin d'au moins deux lectures: lisez d'abord la valeur du pointeur, puis la valeur de la structure.  Si vous devez lire non pas une valeur scalaire, mais, par exemple, une partie d'une cha√Æne ou d'un tableau, vous aurez besoin d'au moins une autre lecture. <br><br><h3>  zval en PHP 7 </h3><br>  L√† o√π nous utilisions des pointeurs auparavant, dans les sept, nous avons commenc√© √† int√©grer zval.  Nous nous sommes √©loign√©s du comptage de r√©f√©rences pour les types scalaires.  Le type et la valeur des champs sont rest√©s sans changements importants, mais quelques drapeaux suppl√©mentaires et une place r√©serv√©e ont √©t√© ajout√©s, dont je parlerai un peu plus tard. <br><br><img src="https://habrastorage.org/webt/tz/we/yn/tzweyn8n32_rntdwwjxhz-fbwc4.png"><br><br>  √Ä gauche, √† quoi cela ressemblait en PHP 5, et √† droite, en PHP 7. <br><br><img src="https://habrastorage.org/webt/5n/wl/4h/5nwl4hrqaqr2kb4pmenzvbtrnh4.png"><br><br>  Maintenant, zval eux-m√™mes sont sur la pile.  Pour lire les types et les valeurs scalaires, une seule instruction machine suffit.  Toutes les valeurs sont regroup√©es dans une zone de m√©moire, ce qui signifie que lorsque nous travaillons avec des variables locales, nous n'aurons pratiquement aucune perte due √† des √©checs du cache du processeur.  Mais la v√©ritable puissance de la nouvelle performance est incluse lorsque la copie est n√©cessaire. <br><br><h3>  Copier l'enregistrement </h3><br>  Dans la premi√®re ligne du script, une autre affectation a √©t√© ajout√©e. <br><br><img src="https://habrastorage.org/webt/kb/yr/ww/kbyrwwvzaeuqpt8quf1lyujztjo.png"><br><br>  En PHP5, nous avons allou√© de la m√©moire √† partir du tas pour le nouveau zval, initialis√© son int (2), chang√© la valeur du pointeur √† la variable b et diminu√© le compteur de r√©f√©rence de la valeur √† laquelle b avait pr√©c√©demment fait r√©f√©rence. <br><br>  En PHP 7, nous avons simplement <strong>initialis√© la variable b directement en place avec quelques instructions</strong> , tandis qu'en PHP 5, elle n√©cessitait des centaines d'instructions.  Donc zval regarde maintenant en m√©moire. <br><br><img src="https://habrastorage.org/webt/ax/ab/sa/axabsadvso8c49azoqvvks5jsfc.png"><br><br>  Ce sont deux mots de 64 bits.  Le premier mot <strong>signifie:</strong> entier, r√©el ou pointeur.  Dans le deuxi√®me mot, le <strong>type</strong> (il indique comment interpr√©ter le sens), les drapeaux et un emplacement r√©serv√© qui seraient encore ajout√©s lors de l'alignement.  Mais il ne dispara√Æt pas, mais est utilis√© par diff√©rents sous-syst√®mes pour stocker des valeurs indirectement li√©es. <br><br>  <strong>Les</strong> indicateurs <strong>sont un ensemble de bits</strong> o√π chaque bit indique si zval prend en charge un protocole.  Par exemple, s'il s'agit de <code>IS_TYPE_REFCOUNTED</code> , alors lorsque vous travaillez avec ce zval, le moteur doit prendre soin de la valeur du compteur de r√©f√©rence.  Lors de l'affectation, augmentez; lorsque vous quittez la port√©e, diminuez; si le compteur de r√©f√©rence atteint z√©ro, d√©truisez la structure d√©pendante. <br><br>  Parmi les types, par rapport √† PHP 5, plusieurs nouveaux sont apparus. <br><br><ul><li>  <code>IS_UNDEF</code> - un marqueur d'une variable non initialis√©e. </li><li>  L'unique <code>IS_BOOL</code> remplac√© par des <code>IS_FALSE</code> et <code>IS_TRUE</code> . </li><li>  Ajout d'un type distinct pour les liens et quelques autres types magiques. </li></ul><br>  Les types de <code>IS_UNDEF</code> √† <code>IS_DOUBLE</code> sont scalaires et ne n√©cessitent pas de m√©moire suppl√©mentaire.  Pour les copier, il suffit de copier le premier mot 64 bits de la machine avec une valeur et la moiti√© de la seconde avec un type et des drapeaux. <br><br><h3>  Recompt√© </h3><br>  Avec d'autres types plus difficiles.  Ils sont tous repr√©sent√©s par une structure subordonn√©e, et zval stocke simplement une r√©f√©rence √† cette structure.  Pour chaque type, cette structure est diff√©rente, mais en termes de POO, ils ont tous un anc√™tre abstrait commun ou une structure zend_refcounted.  Il d√©termine le format du premier <strong>mot 64 bits</strong> , o√π le nombre de r√©f√©rences et d'autres informations pour le garbage collector sont stock√©s. <br><br><img src="https://habrastorage.org/webt/vn/zm/yy/vnzmyywum831lpzipgxtenm_98s.png"><br><br>  Ce mot peut √™tre consid√©r√© simplement comme une information pour le garbage collector, et les structures pour des types sp√©cifiques ajoutent leurs champs apr√®s ce premier mot. <br><br><h3>  Lignes </h3><br>  Dans les sept de la cha√Æne, nous stockons la valeur calcul√©e de la fonction de hachage, sa longueur et les caract√®res eux-m√™mes.  La taille d'une telle structure est variable et d√©pend de la longueur de la cha√Æne.  La fonction de hachage est calcul√©e une fois pour la cha√Æne, si n√©cessaire.  En PHP 5, il a √©t√© recalcul√© √† chaque besoin. <br><br><img src="https://habrastorage.org/webt/em/2t/ax/em2tax1wdnckpbzqxjh1tlqn37o.png"><br><br>  Maintenant, les cha√Ænes sont devenues d√©nombrables de r√©f√©rence, et si en PHP 5 nous avons copi√© les caract√®res eux-m√™mes, maintenant il suffit d'augmenter le nombre de r√©f√©rences pour cette structure. <br><br>  Comme en PHP 5, nous avons toujours le concept de <strong>cha√Ænes immuables ou intern√©es</strong> .  Ils existent g√©n√©ralement dans une seule instance, vivent jusqu'√† la fin de la requ√™te et peuvent se comporter comme des valeurs scalaires.  Nous n'avons pas besoin de prendre soin du compteur des r√©f√©rences √† eux, et pour la copie, il suffit de copier uniquement zval lui-m√™me √† l'aide de quatre instructions machine. <br><br><h3>  Tableaux </h3><br>  Les tableaux sont repr√©sent√©s par une table de hachage int√©gr√©e et ne sont pas tr√®s diff√©rents de PHP 5. La table de hachage elle-m√™me a chang√©, mais plus √† ce sujet s√©par√©ment. <br><br><img src="https://habrastorage.org/webt/_u/kn/ls/_uknlsdbw247d7whq_-euez8zuw.png"><br><br>  Les tableaux sont d√©sormais une <strong>structure adaptative</strong> qui modifie l√©g√®rement sa structure interne et son comportement en fonction des donn√©es stock√©es.  Si nous stockons uniquement des √©l√©ments avec des cl√©s num√©riques proches, nous avons acc√®s aux √©l√©ments directement par index avec une vitesse comparable √† la vitesse des tableaux en C.Mais si vous ajoutez un √©l√©ment avec une cl√© de cha√Æne au m√™me tableau, il se transforme en un v√©ritable hachage avec une r√©solution de collision. <br><br>  Voici √† quoi ressemble la table de hachage en PHP 5. <br><br><img src="https://habrastorage.org/webt/d6/c-/6r/d6c-6rvue6zlsyyhnscfyjtnjj4.png"><br><br>  Il s'agit d'une impl√©mentation de table de hachage classique avec une r√©solution de collision √† l'aide de listes lin√©aires (affich√©es dans le coin sup√©rieur droit).  Chaque √©l√©ment est repr√©sent√© par un seau.  Tous les compartiments sont li√©s par des listes doublement li√©es pour r√©soudre les collisions et li√©s par une autre liste doublement li√©e pour it√©rer dans l'ordre.  Les valeurs de chaque zval sont attribu√©es s√©par√©ment - dans Bucket, nous n'enregistrons qu'un lien vers celui-ci.  De plus, les cl√©s de cha√Æne peuvent √™tre attribu√©es s√©par√©ment. <br><br>  Ainsi, pour chaque table de hachage, vous devez allouer beaucoup de petits blocs de m√©moire, et pour trouver quelque chose plus tard, vous devez parcourir les pointeurs.  Chacune de ces transitions peut provoquer un manque de cahce et un retard d'environ 10 √† 100 cycles de processeur. <br><br>  C'est ce qui s'est pass√© en PHP 7. <br><br><img src="https://habrastorage.org/webt/g_/mk/ax/g_mkaxt7a0ua8shao-rzketmjag.png"><br><br>  La structure logique est rest√©e inchang√©e, seule la physique a chang√©.  Maintenant, sous une table de hachage, la m√©moire est allou√©e en une seule op√©ration. <br><br>  Dans l'image, au bas du pointeur de base, il y a des √©l√©ments, et en haut se trouve un tableau de hachage qui est adress√© par une fonction de hachage.  Pour les tableaux plats ou compact√©s, lorsque nous stockons uniquement des √©l√©ments avec des indices num√©riques, la partie sup√©rieure n'est pas allou√©e du tout et nous adressons le Bucket directement par num√©ro. <br><br>  Pour contourner les √©l√©ments, nous les trions s√©quentiellement de haut en bas ou de bas en haut, ce que les processeurs modernes font parfaitement.  Les valeurs sont int√©gr√©es aux compartiments, mais l'espace r√©serv√© qu'elles contiennent est uniquement utilis√© pour r√©soudre les collisions.  Il stocke l'index d'un autre Bucket avec la m√™me valeur de fonction de hachage ou la fin du marqueur de liste. <br><br>  La m√©moire pour les valeurs de cha√Æne des cl√©s est allou√©e s√©par√©ment, mais c'est toujours la m√™me zend_string.  Lors du collage dans un tableau, il suffit d'augmenter le compteur de r√©f√©rence de la cha√Æne, bien que nous devions auparavant copier les caract√®res directement et lors de la recherche, nous pouvons maintenant comparer non pas les caract√®res, mais les pointeurs vers les cha√Ænes elles-m√™mes. <br><br><h3>  Tableaux immuables </h3><br>  Auparavant, nous avions des cha√Ænes immuables, mais maintenant des tableaux immuables sont √©galement apparus.  Comme les cha√Ænes, elles n'utilisent pas le nombre de r√©f√©rences et ne sont d√©truites qu'√† la fin de la demande.  Il s'agit d'un script simple qui cr√©e un tableau d'un million d'√©l√©ments, et chaque √©l√©ment est le m√™me tableau avec un seul √©l√©ment "bonjour". <br><br><img src="https://habrastorage.org/webt/uv/sm/lu/uvsmluqtfldezjnbbfdqvd83sr8.png"><br><br>  En PHP 5, √† chaque it√©ration de boucle, un nouveau tableau vide √©tait cr√©√©, ¬´bonjour¬ª y √©tait √©crit, et tout cela √©tait ajout√© au tableau r√©sultant.  En PHP 7, au stade de la compilation, nous <strong>cr√©ons un seul tableau immuable</strong> qui se comporte comme un scalaire et l'ajoutons √† celui qui en r√©sulte.  Dans l'exemple pr√©sent√©, cela nous permet de r√©duire la consommation de m√©moire de plus de 10 fois et d'acc√©l√©rer de pr√®s de 10 fois. <br><br>  Bien s√ªr, on ne trouve pas souvent des tableaux constants de millions d'√©l√©ments dans des applications r√©elles, mais les petits sont assez courants.  Sur chacun d'eux, vous obtiendrez une petite, mais une victoire. <br><br><h3>  Les objets </h3><br>  Les liens vers tous les objets en PHP 5 se trouvaient dans un r√©f√©rentiel s√©par√©, et dans zval, il n'y avait qu'un handle - un ID d'objet unique. <br><br><img src="https://habrastorage.org/webt/in/lo/dq/inlodqhjne7lo12nslgcuqrckvy.png"><br><br>  Pour arriver √† l'objet, nous avons fait au moins 3 lectures.  De plus, la m√©moire pour la valeur de chaque propri√©t√© de l'objet a √©t√© allou√©e s√©par√©ment, et nous avions besoin d'au moins 2 lectures suppl√©mentaires pour le lire. <br><br>  En PHP 7, nous avons pu passer √† l'adressage direct. <br><br><img src="https://habrastorage.org/webt/zm/vp/vv/zmvpvvqlmybttr3zvze6gzglin4.png"><br><br>  L'adresse <code>zend_object</code> est <code>zend_object</code> accessible avec une seule instruction machine.  Et les propri√©t√©s sont int√©gr√©es et pour les lire, vous n'avez besoin que d'une lecture suppl√©mentaire.  Ils sont √©galement regroup√©s, ce qui <strong>am√©liore la localisation des donn√©es</strong> et aide les processeurs modernes √† ne pas tr√©bucher. <br><br>  En plus de la propri√©t√© pr√©d√©finie, un lien vers la classe de cet objet est √©galement stock√© ici, certains gestionnaires - un analogue des tables de m√©thodes virtuelles et une table de hachage pour les propri√©t√©s qui n'ont pas √©t√© d√©finies.  En PHP, vous pouvez ajouter une propri√©t√© √† n'importe quel objet qui n'a pas √©t√© d√©fini √† l'origine, et si plusieurs instructions machine sont suffisantes pour acc√©der √† la propri√©t√© pr√©d√©finie, alors pour les propri√©t√©s non pr√©d√©finies, vous devrez utiliser une table de hachage, qui n√©cessitera des dizaines d'instructions machine.  Bien s√ªr, cela co√ªte beaucoup plus cher. <br><br><h3>  R√©f√©rence </h3><br>  Enfin, nous avons d√ª introduire un <strong>type distinct</strong> pour repr√©senter les liens PHP. <br><br><img src="https://habrastorage.org/webt/yk/jj/ng/ykjjngfnlq8sefuvmwzjfxwjz7g.png"><br><br>  Il s'agit d'un type compl√®tement transparent.  Il n'est pas visible pour les scripts PHP.  Les scripts voient un autre zval int√©gr√© √† la structure zend_reference.  Il est entendu que nous nous r√©f√©rons √† une telle structure √† partir d'au moins deux endroits, et le compteur de r√©f√©rence de cette structure est toujours sup√©rieur √† 1. D√®s que le compteur tombe √† 1, le lien se transforme en une valeur scalaire r√©guli√®re.  Le zval incorpor√© dans le lien est copi√© dans le dernier zval qui le r√©f√©rence et la structure elle-m√™me est supprim√©e. <br><br>  Il semble que travailler avec r√©f√©rence soit maintenant beaucoup plus compliqu√© qu'avec d'autres types (et c'est vrai), mais en fait en PHP 5 nous avons d√ª faire un travail de complexit√© comparable lors de l'acc√®s √† n'importe quelle valeur (m√™me un entier premier).  Maintenant, nous appliquons des protocoles plus complexes √† un seul type et acc√©l√©rons ainsi le travail avec tous les autres, en particulier avec les valeurs scalaires. <br><br><h3>  IS_FALSE et IS_TRUE </h3><br>  J'ai d√©j√† dit que le type unique IS_BOOL √©tait divis√© en IS_FALSE et IS_TRUE s√©par√©s.  Cette id√©e a √©t√© espionn√©e dans la mise en ≈ìuvre de LuaJIT et a √©t√© faite pour acc√©l√©rer l'une des op√©rations les plus courantes - la transition conditionnelle. <br><br><img src="https://habrastorage.org/webt/fv/5j/-z/fv5j-zx0u_2kfmtmxjwce4uzetk.png"><br><br>  Si en PHP 5, il fallait lire le type, v√©rifier le bool√©en, lire la valeur, savoir si elle est vraie ou fausse et faire une transition en fonction de cela, maintenant il suffit de simplement v√©rifier le type et de le comparer avec vrai: <br><br><ul><li>  si c'est vrai, alors nous suivons une branche; </li><li>  si c'est moins que vrai, passez √† une autre branche; </li><li>  s'il est plus que vrai, allez sur le soi-disant chemin lent (chemin lent) et l√†, nous v√©rifions de quel type il provient et ce qu'il faut en faire: s'il est entier, nous devons comparer sa valeur √† 0, si float - √† nouveau avec 0 ( mais r√©el), etc. </li></ul><br><h2>  Convention d'appel </h2><br>  Un changement dans la convention d'appel ou la convention d'appel de fonction est une optimisation importante qui affecte non seulement les structures de donn√©es, mais √©galement les algorithmes sous-jacents.  Dans l'image de gauche est un petit script compos√© de la fonction foo () et de son appel.  Ci-dessous se trouve le bytecode dans lequel ce script a √©t√© compil√© par PHP 5. <br><br><img src="https://habrastorage.org/webt/bn/fw/a4/bnfwa4e5ifjqs6rd6cp66uctega.png"><br><br>  Tout d'abord, je vais vous expliquer comment cela a fonctionn√© en PHP 5. <br><br><h3>  Convention d'appel en PHP 5 </h3><br>  La premi√®re instruction <code>SEND_VAL</code> √©t√© d'envoyer la valeur ¬´3¬ª √† la fonction foo.  Pour ce faire, elle a √©t√© forc√©e d'allouer un nouveau zval sur le tas, d'y copier la valeur (3) et d'√©crire la valeur du pointeur sur cette structure sur la pile. <br><br><img src="https://habrastorage.org/webt/mt/vu/d3/mtvud3tb2ljaijnwecbmvnqepjs.png"><br><br>  De m√™me avec la deuxi√®me instruction.  En outre, <code>DO_FCALL</code> initialis√© <code>DO_FCALL</code> <code>CALL FRAME</code> , a r√©serv√© une place pour les variables locales et temporaires et a transf√©r√© le contr√¥le √† la fonction appel√©e. <br><br><img src="https://habrastorage.org/webt/rx/rw/qo/rxrwqogtbhgd0q9tsd7wnw2r4og.png"><br><br>  La premi√®re <code>RECV</code> v√©rifi√© le premier argument et initialis√© le slot sur la pile avec la variable locale correspondante ($ a).  Ici, nous avons fait sans copier et simplement augment√© le compteur de r√©f√©rence du param√®tre correspondant (zval avec une valeur de 3).  De m√™me, la deuxi√®me <code>RECV</code> √©tabli une connexion entre la variable $ b et le param√®tre 5. <br><br><img src="https://habrastorage.org/webt/lw/c1/zw/lwc1zw26uby_oj54yjzu7yz-vus.png"><br><br>  Autres fonctions corporelles.  L'ajout de 3 + 5 s'est produit - il s'est av√©r√© 8. Il s'agit d'une variable temporaire et sa valeur a √©t√© stock√©e directement sur la pile. <br><br><img src="https://habrastorage.org/webt/d0/xj/s5/d0xjs5j2c0i6qgioybezypay9k4.png"><br><br>  RETOUR et nous revenons de la fonction. <br><br><img src="https://habrastorage.org/webt/zd/cc/nb/zdccnbal1xuynwdcymbrwcf2fmq.png"><br><br>  Lors du retour, nous lib√©rons toutes les variables et tous les arguments hors de port√©e.  Pour ce faire, nous parcourons tous les zval r√©f√©renc√©s par les slots de la trame lib√©r√©e, et pour chacun, nous diminuons le nombre de r√©f√©rences.  S'il atteint 0, d√©truisez la structure correspondante. <br><br>  Comme vous pouvez le voir, m√™me une op√©ration aussi simple que l'envoi d'une constante √† une fonction n√©cessite d'allouer de la nouvelle m√©moire, de copier et d'augmenter le compteur de r√©f√©rence, puis de doubler la diminution et la suppression. <br><br><h3>  Convention d'appel en PHP 7 </h3><br>  En PHP 7, ces probl√®mes ont √©t√© corrig√©s - maintenant sur la pile, nous stockons non pas les pointeurs zval, mais les zval eux-m√™mes. <br><br><img src="https://habrastorage.org/webt/xc/ek/ls/xceklspoxwmga__zvpeat1a4plw.png"><br><br>  Nous avons √©galement introduit une nouvelle instruction, <code>INIT_FCALL</code> , qui est maintenant charg√©e d'initialiser et d'allouer de la m√©moire sous <code>CALL FRAME</code> , et de r√©server de l'espace pour les arguments et les variables temporaires. <br><br><img src="https://habrastorage.org/webt/yi/gd/a5/yigda5wg7xswdcyadip7euboboa.png"><br><br>  <code>SEND_VAL 3</code> d√©sormais l'argument dans le premier emplacement apr√®s le <code>CALL FRAME</code> .  <code>SEND_VAL 5</code> vers le deuxi√®me emplacement. <br><br><img src="https://habrastorage.org/webt/-0/es/8_/-0es8_skigjtyvja3vzzegwo-su.png"><br><br>  Ensuite, le plus int√©ressant.  Il semblerait que <code>DO_FCALL</code> devrait passer le contr√¥le √† la premi√®re instruction de la fonction appel√©e.  Mais les arguments ont d√©j√† atteint les emplacements r√©serv√©s aux param√®tres variables $ a et $ b, et les instructions <code>RECV</code> ne font rien.  Par cons√©quent, vous pouvez simplement les ignorer.  Nous avons envoy√© deux param√®tres, nous sautons donc deux instructions.  S'ils en avaient envoy√© trois, ils en auraient manqu√© trois. <br><br><img src="https://habrastorage.org/webt/4z/vm/gj/4zvmgjldpmtfpgprtvqoks__-km.png"><br><br>  Nous allons donc directement au corps de la fonction, faisons l'addition et le retour. <br><br><img src="https://habrastorage.org/webt/zh/j1/yf/zhj1yfwxp5kf1s4xxlyoasy170i.png"><br><br>  Lors du retour, nous effa√ßons toutes les variables locales, mais maintenant seulement pour deux emplacements, et puisque nous avons l√† des scalaires, nous n'avons √† nouveau rien √† faire. <br><br><img src="https://habrastorage.org/webt/wy/dh/2p/wydh2pvz_hpawjivtoxx3hmxoqa.png"><br><br>  Mon histoire est un peu simplifi√©e, elle ne prend pas en compte les fonctions avec un nombre variable d'arguments et la n√©cessit√© d'une v√©rification de type et quelques autres points. <br><br>  <strong>La nouvelle convention d'appel a un peu cass√© la compatibilit√©</strong> .  PHP a des fonctions comme <code>func_get_arg</code> et <code>func_get_args</code> .  Si auparavant, ils renvoyaient la valeur d'origine du param√®tre envoy√©, ils retournent maintenant la valeur actuelle de la variable locale correspondante, car nous ne stockons tout simplement pas les valeurs d'origine.  Tout comme les d√©bogueurs C. <br><br><img src="https://habrastorage.org/webt/5r/n2/6j/5rn26j24gjyfolmeu07qgv1wmxu.png"><br><br>  De plus, la fonction ne peut plus avoir plusieurs param√®tres portant le m√™me nom.  Cela ne servait √† rien auparavant, mais j'ai rencontr√© un tel code PHP <code>foo($_, $_)</code> .  √Ä quoi √ßa ressemble?  (J'ai reconnu Prolog) <br><br><h2>  Nouveau gestionnaire de m√©moire </h2><br>  Apr√®s avoir termin√© l'optimisation des structures de donn√©es et des algorithmes de base, nous avons de nouveau attir√© l'attention sur tous les sous-syst√®mes de freinage.  Le gestionnaire de m√©moire en PHP 5 occupait <strong>pr√®s de 20% du temps processeur</strong> sur Wordpress. <br><br>  Une fois que nous nous sommes d√©barrass√©s de nombreuses allocations, ses frais g√©n√©raux sont devenus moins importants, mais toujours importants - et non pas parce qu'il effectuait un travail important, mais parce qu'il est tomb√© sur la cache.  Cela est d√ª au fait que nous avons utilis√© l'algorithme malloc classique de Doug Lea, qui impliquait de trouver des emplacements de m√©moire libres appropri√©s en voyageant √† travers des liens et des arbres, et tous ces d√©placements ont in√©vitablement caus√© des √©checs de cache. <br><br>  Aujourd'hui, il existe de nouveaux algorithmes de gestion de la m√©moire qui prennent en compte les caract√©ristiques des processeurs modernes.  Par exemple: <strong>jemalloc</strong> et <strong>ptmalloc de Google</strong> .  Au d√©but, nous avons essay√© de les utiliser tels quels, mais nous n'avons pas obtenu gain de cause, car le manque de fonctionnalit√©s sp√©cifiques √† PHP a rendu plus co√ªteuse la lib√©ration compl√®te de la m√©moire √† la fin de la demande.  En cons√©quence, nous avons abandonn√© dlmalloc et √©crit quelque chose √† nous, combinant des id√©es de l'ancien gestionnaire de m√©moire et de jemalloc. <br><br>  Nous avons <strong>r√©duit la surcharge de Memory Manager √† 5%</strong> , r√©duit la surcharge de m√©moire pour les informations de service et am√©lior√© l'utilisation du cache du processeur.  Les blocs de m√©moire appropri√©s sont d√©sormais recherch√©s par bitmaps, la m√©moire pour les petits blocs est allou√©e √† partir de pages individuelles et mise en cache lors de la publication, des fonctions sp√©cialis√©es pour les tailles de bloc fr√©quemment utilis√©es sont ajout√©es. <br><br><h2>  De nombreuses petites am√©liorations </h2><br>  Je n'ai parl√© que des am√©liorations les plus importantes, mais il y en a eu beaucoup plus mineures.  Je peux en mentionner certains. <br><br><ul><li>  API rapide pour analyser les param√®tres des fonctions internes et une nouvelle API pour it√©rer sur HashTable. </li><li>  Nouvelles instructions VM: concat√©nation de cha√Ænes, sp√©cialisation, super-instructions. </li><li>  Certaines fonctions internes ont √©t√© transform√©es en instructions VM: strlen, is_int. </li><li>  Utilisation des registres CPU pour les registres VM: IP et FP. </li><li>  Optimisation de la duplication et de la suppression des tableaux. </li><li>  Utilisez le nombre de liens au lieu de copier o√π vous le pouvez. </li><li>  PCRE JIT. </li><li>  Optimisation des fonctions internes et s√©rialisation (). </li><li>  Taille de code r√©duite et donn√©es trait√©es. </li></ul><br>  Certains √©taient tr√®s simples, par exemple, il n'a fallu que trois lignes de code pour activer JIT dans les expressions Perl r√©guli√®res, ce qui a imm√©diatement apport√© une acc√©l√©ration visible (2-3%) √† presque toutes les applications.  D'autres optimisations ont touch√© certains aspects √©troits de certaines fonctions PHP et ne sont pas particuli√®rement int√©ressantes, bien que la contribution totale de toutes ces am√©liorations mineures soit assez importante. <br><br><h2>  O√π es-tu venu </h2><br>  C'est la contribution de divers sous-syst√®mes sur WordPress / PHP 7.0. <br><br><img src="https://habrastorage.org/webt/7q/r4/d0/7qr4d08m8yhid4rngwh9-gffxbu.png"><br><br>  La contribution des machines virtuelles est pass√©e √† 50%. Memory Manager    5% ‚Äî         Memory Manager,        .         130 . ,    10 .  ,           Memory Manager           ,         . <br><br><img src="https://habrastorage.org/webt/kk/nq/5p/kknq5ppnd1ihr8wjw9xfv38boyy.png"><br>   : <br><br><ul><li>      2 . </li><li>   MM   17 . </li><li> -     4 . </li><li>    WordPress   3,5 . </li></ul><br>       2,5-  ,    .  ?   ,         ,        CPU time,   ‚Äî  ,    .  PHP     ,        . <br><br><h3>  PHP 7 </h3><br> WordPress 3.6      ‚Äî         .  - ,   PHP 7   mysql,     ,     . <br><br><img src="https://habrastorage.org/webt/bs/x9/pa/bsx9pa3fc3ccedmnajaj1h5dm0q.png"><br><br>   ,          PHPNG.     2/3 .     ,    . <br><br> ,       WordPress,      ,      ‚Äî  1,5  2- . <br><br><h3> PHP 7  HHVM </h3><br>              HHVM. <br><br><img src="https://habrastorage.org/webt/fs/vg/ot/fsvgotogozunvqed7dwflmmef1u.png"><br><br>      ‚Äî  .     .   Facebook   .   HHVM   . ,      ,     ,    ,      . <br><br><img src="https://habrastorage.org/webt/c_/pg/jv/c_pgjvoejr-q3o5sgvgtplxkbm0.png"><br><br>  PHP 7 ‚Äî    .    Vebia,  Etsy  Badoo. Highload-    ,       . <br><br>   PHP 7.0  Etsy  Badoo       -. Badoo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>    . <br><br><img src="https://habrastorage.org/webt/pn/rv/rj/pnrvrjrzp9re46lbmngnyddzu44.png"><br><br>  ,          2 ,    ‚Äî   7 . <br><br>         PHP 7.0.     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a> ,  PHP 7.1,        . <br><br><blockquote>    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PHP Russia</a>     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a>        <b>PHP 8</b> .         PHP,  ,    ,      ‚Äî <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  1 .  , ,    ‚Äî   ,    ,     ,  . <br></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444508/">https://habr.com/ru/post/fr444508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444494/index.html">La Moto Volante (Lazareth LMV 496) - moto transformateur volant</a></li>
<li><a href="../fr444496/index.html">De nouveaux outils pour d√©tecter l'interception HTTPS</a></li>
<li><a href="../fr444500/index.html">29 mars, Moscou - Backend Stories 3.0</a></li>
<li><a href="../fr444502/index.html">La cryptographie quantique est-elle vraiment fiable?</a></li>
<li><a href="../fr444504/index.html">Utilisation du r√©pertoire de packages local en Python maintenant</a></li>
<li><a href="../fr444512/index.html">Cr√©ation d'une application graphique pour r√©soudre le probl√®me du parcours du cheval</a></li>
<li><a href="../fr444514/index.html">Webinaire "S√©curit√© de l'apprentissage automatique: probl√®mes naturels de l'intelligence artificielle"</a></li>
<li><a href="../fr444516/index.html">Wolfenstein 3D: lancer de rayons avec WebGL1</a></li>
<li><a href="../fr444518/index.html">Vers une th√©orie fondamentale de la conscience</a></li>
<li><a href="../fr444520/index.html">2. Check Point Getting Started R80.20. Architecture de la solution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>