<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🕦 👩‍👦 👩🏿‍🤝‍👩🏼 PVS-Studio in den Wolken: GitLab CI / CD 👨🏾‍💻 🥟 😉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel setzt die Veröffentlichungsreihe zur Verwendung von PVS-Studio in Cloud-Systemen fort. Dieses Mal schauen wir uns an, wie der Analyzer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio in den Wolken: GitLab CI / CD</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/476626/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68f/80b/26c/68f80b26c3c19102558efb6c789e11ee.png" alt="Abbildung 2"></div><br>  Dieser Artikel setzt die Veröffentlichungsreihe zur Verwendung von PVS-Studio in Cloud-Systemen fort.  Dieses Mal schauen wir uns an, wie der Analyzer mit GitLab CI zusammenarbeitet, einem Produkt von GitLab Inc.  Die Integration des Static Analyzers in ein CI-System ermöglicht die Erkennung von Fehlern direkt nach der Projekterstellung und ist eine äußerst effektive Methode, um die Kosten für die Fehlersuche zu senken. <br><a name="habracut"></a><br>  Eine Liste unserer anderen Artikel zur Integration in Cloud-CI-Systeme: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio in den Wolken: Azure DevOps</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio in den Wolken: Travis CI</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio in den Wolken: CircleCI</a> </li></ul><br><h2>  Informationen zur verwendeten Software </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitLab</a> ist ein Onlinedienst zur Verwaltung von Repositorys.  Sie können es direkt in einem Browser auf der offiziellen Website verwenden, indem Sie Ihr Konto registrieren, oder es auf Ihrem eigenen Server installieren und bereitstellen. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">PVS-Studio</a> ist ein Tool zur Erkennung von Fehlern und potenziellen Schwachstellen im Quellcode von Programmen, die in C, C ++, C # und Java geschrieben wurden.  Funktioniert in 64-Bit-Systemen unter Windows, Linux und MacOS und kann Code für 32-Bit-, 64-Bit- und Embedded-ARM-Plattformen analysieren.  Wenn Sie den Analyzer zum ersten Mal verwenden, um Ihre Projekte zu überprüfen, empfehlen wir Ihnen, den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artikel</a> zu lesen, in dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">beschrieben wird,</a> wie Sie die interessantesten PVS-Studio-Warnungen schnell überprüfen und die Funktionen des Tools bewerten können. <br><br>  Das OBS-Projekt wird verwendet, um die Fähigkeiten des statischen Analysators in der Cloud zu demonstrieren.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Open Broadcaster Software</a> ist eine kostenlose und offene Sammlung von Programmen für die Videoaufnahme und das Streaming.  OBS bietet Geräte- und Quellenüberwachung in Echtzeit, Szenenkomposition, Dekodierung, Aufnahme und Ausstrahlung.  Die Daten werden hauptsächlich über das Real Time Messaging-Protokoll übertragen und können an jede Quelle gesendet werden, die RTMP unterstützt. Das Programm verfügt über fertige Vorinstallationen für die Live-Übertragung auf den beliebtesten Streaming-Plattformen. <br><br><h2>  Konfiguration </h2><br>  Um mit GitLab zu arbeiten, gehen Sie auf die Website und klicken Sie auf <i>Registrieren</i> : <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fc0/453/0d3/fc04530d3ed96be434e244f833b6386f.png" alt="Abbildung 6"></div><br>  Sie können sich registrieren, indem Sie Konten anderer Dienste wie GitHub, Twitter, Google, BitBucket, Saleforce verknüpfen oder einfach das offene Formular ausfüllen.  Nach der Autorisierung lädt GitLab uns ein, ein Projekt zu erstellen: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2e5/79d/cf3/2e579dcf3072b3452135516f35289725.png" alt="Abbildung 7"></div><br>  Eine Liste der verfügbaren Plattformen zum Importieren von Dateien: <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/356/f46/3a7/356f463a7a382f1bd5f066e0201b8cba.png" alt="Abbildung 33"></a> </div><p></p><br>  Lassen Sie uns aus Gründen der Übersichtlichkeit ein leeres Projekt erstellen: <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e5a/ded/9bf/e5aded9bfbd23e1a61a6845339e9854f.png" alt="Abbildung 17"></a> </div><p></p><br>  Als nächstes müssen wir unser Projekt in das erstellte Repository hochladen.  Verwenden Sie dazu die Hinweise, die im Fenster des erstellten Projekts angezeigt werden. <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e6e/751/d9c/e6e751d9c77d267af8e8f2fdb3f50f22.png" alt="Abbildung 1"></a> </div><p></p><br>  Wenn Sie die Aufgabe starten, entnimmt GitLab CI Anweisungen aus der Datei <i>.gitlab-ci.yml</i> .  Sie können es hinzufügen, indem Sie entweder <i>auf CI / CD</i> einrichten klicken oder einfach ein lokales Repository erstellen und auf die Site hochladen.  Folgen wir der ersten Option: <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/543/469/1d1/5434691d16d04a25bfae4b8ebd0707cb.png" alt="Abbildung 21"></a> </div><p></p><br><br>  Erstellen Sie jetzt einen minimalen Wrapper für das Skript: <br><br><pre><code class="cpp hljs">image: debian job: script:</code> </pre> <br>  Laden Sie den Analyzer und das Sendemail-Dienstprogramm herunter, die wir später benötigen werden: <br><br><pre> <code class="cpp hljs">- apt-get update &amp;&amp; apt-get -y install wget gnupg - wget -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | apt-key add - - wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - apt-get update &amp;&amp; apt-get -y install pvs-studio sendemail</span></span></code> </pre> <br>  Als Nächstes installieren wir Abhängigkeiten und Dienstprogramme zum Erstellen von OBS: <br><br><pre> <code class="cpp hljs">- apt-get -y install build-essential cmake make pkg-config libx11-dev libgl1-mesa-dev libpulse-dev libxcomposite-dev libxinerama-dev libv4l-dev libudev-dev libfreetype6-dev libfontconfig-dev qtbase5-dev libqt5x11extras5-dev libx264-dev libxcb-xinerama0-dev libxcb-shm0-dev libjack-jackd2-dev libcurl4-openssl-dev libavcodec-dev libqt5svg5 libavfilter-dev libavdevice-dev libsdl2-dev ffmpeg qt5-<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> qtscript5-dev libssl-dev qttools5-dev qttools5-dev-tools qtmultimedia5-dev libqt5svg5-dev libqt5webkit5-dev libasound2 libxmu-dev libxi-dev freeglut3-dev libasound2-dev libjack-jackd2-dev libxrandr-dev libqt5xmlpatterns5-dev libqt5xmlpatterns5 coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls28-dev libselinux1-dev linux-libc-dev libtool autotools-dev libio-socket-ssl-perl libnet-ssleay-perl ca-certificates</code> </pre> <br>  Jetzt müssen wir die Datei mit der Analyzer-Lizenz erstellen (Standardmäßig wird die Datei PVS-Studio.lic im Verzeichnis ../.config/PVS-Studio erstellt).  Dabei muss die Lizenzdatei nicht in den laufenden Parametern des Analysators angegeben werden, sie wird automatisch abgerufen.): <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer credentials $PVS_NAME $PVS_KEY</code> </pre> <br>  Hier sind <i>PVS_NAME</i> und <i>PVS_KEY</i> die Namen von Variablen, deren Werte wir in den Einstellungen angeben.  Sie speichern den PVS-Studio-Login und den Lizenzschlüssel.  Gehen Sie wie folgt vor, um die Werte festzulegen: Einstellungen&gt; CI / CD&gt; Variablen. <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/290/ac0/bc4/290ac0bc472a4495eef56b8d110f9aac.png" alt="Abbildung 23"></a> </div><p></p><br>  Erstellen Sie das Projekt mit cmake: <br><br><pre> <code class="cpp hljs">- cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=On /builds/Stolyarrrov/obscheck/ - make -j4</code> </pre> <br>  Danach führen Sie den Analyzer aus: <br><br><pre> <code class="cpp hljs">- pvs-studio-analyzer analyze -o PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span></code> </pre> <br>  <i>PVS-Studio.log</i> speichert die Analyseergebnisse.  Die resultierende Datei mit dem Bericht ist nicht zum Lesen vorgesehen.  Um es für ein menschliches Auge zugänglich zu machen, benötigen wir das Dienstprogramm plog-converter.  Dieses Programm konvertiert das Protokoll des Analysators in verschiedene Formate.  Zum einfachen Lesen konvertieren wir das Protokoll in das HTML-Format: <br><br><pre> <code class="cpp hljs">- plog-converter -t html PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> -o PVS-Studio.html</code> </pre> <br>  Sie können den Bericht mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Artefakten</a> exportieren, aber wir ändern den Kurs und senden die Datei mit den Analyseergebnissen per E-Mail mit dem Dienstprogramm sendemail: <br><br><pre> <code class="cpp hljs">- sendemail -t $MAIL_TO -u <span class="hljs-string"><span class="hljs-string">"PVS-Studio report, commit:GITLAB_COMMIT"</span></span> -m <span class="hljs-string"><span class="hljs-string">"PVS-Studio report, commit:GITLAB_COMMIT"</span></span> -s $GMAIL_PORT -o tls=<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> -f $MAIL_FROM -xu $MAIL_FROM -xp $MAIL_FROM_PASS -a PVS-Studio.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span> PVS-Studio.html</code> </pre> <br>  Vollständige .gitlab-ci.yml: <br><br><pre> <code class="cpp hljs">image: debian job: script: - apt-get update &amp;&amp; apt-get -y install wget gnupg - wget -O - https:<span class="hljs-comment"><span class="hljs-comment">//files.viva64.com/etc/pubkey.txt | apt-key add - - wget -O /etc/apt/sources.list.d/viva64.list https://files.viva64.com/etc/viva64.list - apt-get update &amp;&amp; apt-get -y install pvs-studio sendemail - apt-get -y install build-essential cmake pkg-config libx11-dev libgl1-mesa-dev libpulse-dev libxcomposite-dev libxinerama-dev libv4l-dev libudev-dev libfreetype6-dev libfontconfig-dev qtbase5-dev libqt5x11extras5-dev libx264-dev libxcb-xinerama0-dev libxcb-shm0-dev libjack-jackd2-dev libcurl4-openssl-dev libavcodec-dev libqt5svg5 libavfilter-dev libavdevice-dev libsdl2-dev ffmpeg qt5-default qtscript5-dev libssl-dev qttools5-dev qttools5-dev-tools qtmultimedia5-dev libqt5svg5-dev libqt5webkit5-dev libasound2 libxmu-dev libxi-dev freeglut3-dev libasound2-dev libjack-jackd2-dev libxrandr-dev libqt5xmlpatterns5-dev libqt5xmlpatterns5 coccinelle parallel libapparmor-dev libcap-dev libseccomp-dev python3-dev python3-setuptools docbook2x libgnutls28-dev libselinux1-dev linux-libc-dev libtool autotools-dev make libio-socket-ssl-perl libnet-ssleay-perl ca-certificates - pvs-studio-analyzer credentials $PVS_NAME $PVS_KEY - cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=On /builds/Stolyarrrov/obscheck/ - make -j4 - pvs-studio-analyzer analyze -o PVS-Studio.log - plog-converter -t html PVS-Studio.log -o PVS-Studio.html - sendemail -t $MAIL_TO -u "PVS-Studio report, commit:GITLAB_COMMIT" -m "PVS-Studio report, commit:GITLAB_COMMIT" -s $GMAIL_PORT -o tls=auto -f $MAIL_FROM -xu $MAIL_FROM -xp $MAIL_FROM_PASS -a PVS-Studio.log PVS-Studio.html</span></span></code> </pre> <br>  Klicken Sie auf <i>Änderungen</i> festschreiben.  Wenn wir alles richtig gemacht haben, sehen wir die Ausgabe: <i>Diese GitLab CI-Konfiguration ist gültig.</i>  Um den Fortschritt zu verfolgen, gehen wir zur Registerkarte <i>CI / CD&gt; Pipelines</i> . <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/40e/058/344/40e058344baf116f11a25d16befe61dc.png" alt="Abbildung 5"></a> </div><p></p><br>  Klicken Sie auf " <i>Laufen"</i> .  Es wird das Terminalfenster der virtuellen Maschine angezeigt, in dem unsere Konfigurationsdatei ausgeführt wird.  Nach einer Weile bekommen wir eine Nachricht: <i>job succeeded.</i> <br><br><p></p><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/48e/f80/8c9/48ef808c9f67dbe409e5e004bb6d8061.png" alt="Abbildung 29"></a> </div><p></p><br>  Es ist also Zeit, die HTML-Datei mit Warnungen zu öffnen, die per E-Mail gesendet werden. <br><br><h2>  Analyseergebnisse </h2><br>  Werfen wir einen Blick auf einige Warnungen aus dem Bericht, in denen Fehler im Open Broadcaster-Softwareprojekt aufgedeckt werden, um das Wesentliche der statischen Codeanalyse zu erfahren.  Da der Hauptzweck des Artikels darin besteht, die Prinzipien der Interaktion zwischen PVS-Studio und GitLab CI / CD zu beschreiben, wurden nur einige nicht triviale Beispiele herausgegriffen.  Wir sind bereit, den Autoren des Projekts eine zeitlich begrenzte Lizenz zu erteilen. Auf Wunsch können sie auch eine gründlichere Projektanalyse durchführen.  Darüber hinaus können sie eine der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Möglichkeiten nutzen, um eine kostenlose PVS-Studio-Lizenz zu erhalten</a> . <br><br>  Außerdem kann jeder <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einen Testschlüssel erhalten</a> , um die PVS-Studio-Funktionen zu erkunden und seine Projekte zu überprüfen. <br><br>  Schauen wir uns also einige Beispiele für gefundene Fehler in der Open Broadcaster-Software an. <br><br>  <b>Warnung N1</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V547</a> Ausdruck 'back_size' ist immer wahr.  circlebuf.h (138) <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">circlebuf</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> capacity; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">circlebuf_place</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct circlebuf *cb, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position,....,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> data_end_pos; data_end_pos = position + size; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data_end_pos &gt; cb-&gt;capacity) { <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> back_size = data_end_pos - cb-&gt;capacity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (back_size) { <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *)cb-&gt;data + position, data, loop_size); } .... }</code> </pre> <br>  Die Zeile <i>if (data_end_pos&gt; cb-&gt; capacity)</i> ist auf jeden Fall einen Blick wert.  Wenn die Bedingung wahr ist, ist die in der folgenden Zeile definierte Variable <i>back_size</i> immer größer als Null, da hier die Subtraktion des notorisch kleineren Werts von dem größeren Wert behandelt wird.  Am Ende ist die Bedingung, die zwei Zeilen weiter unten steht, immer <i>wahr</i> .  Die redundante Bedingung ist nicht so harmlos, wenn der Code folgt und Daten ändert. <br><br>  <b>Warnungen N2, N3</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V629</a> Betrachten Sie den Ausdruck '1 &lt;&lt; Einzug'.  Bitverschiebung des 32-Bit-Wertes mit anschließender Erweiterung auf den 64-Bit-Typ.  profiler.c (610) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">profile_print_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint64_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> active, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indent, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... active &amp;= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; indent) - <span class="hljs-number"><span class="hljs-number">1</span></span>; .... }</code> </pre> <br>  Verwirrte Operationen über 32-Bit- und 64-Bit-Typen sehen hier verdächtig aus.  Zuerst wertet der Programmierer die Maske unter Verwendung von 32-Bit-Typen aus (Ausdruck <i>(1 &lt;&lt; Einzug) - 1</i> ), danach wird sie implizit in den 64-Bit-Typ im Ausdruck <i>active &amp; = ... erweitert.</i>  Höchstwahrscheinlich war bei der Auswertung der Maske auch die Verwendung von 64-Bit-Typen erforderlich. <br><br>  Richtige Codeversion: <br><br><pre> <code class="cpp hljs">active &amp;= ((<span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span>)(<span class="hljs-number"><span class="hljs-number">1</span></span>) &lt;&lt; indent) - <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  Oder: <br><br><pre> <code class="cpp hljs">active &amp;= (<span class="hljs-number"><span class="hljs-number">1u</span></span>ll &lt;&lt; indent) - <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  Übrigens, die Copy-Paste-Version dieses Blocks ist unten, der Analysator hat auch die Warnung dafür ausgegeben: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V629</a> Betrachten Sie den Ausdruck '1 &lt;&lt; Indent'.  Bitverschiebung des 32-Bit-Wertes mit anschließender Erweiterung auf den 64-Bit-Typ.  profiler.c (719) <br><br>  <b>Warnung N4</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V761 Es wurden</a> vier identische Textblöcke gefunden.  'obs-audio-controls.c' (353) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_true_peak</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... peak = _mm_max_ps(peak, abs_ps(intrp_samples)); SHIFT_RIGHT_2PS(new_work, work); VECTOR_MATRIX_CROSS_PS(intrp_samples, work, m3, m1, p1, p3); peak = _mm_max_ps(peak, abs_ps(intrp_samples)); SHIFT_RIGHT_2PS(new_work, work); VECTOR_MATRIX_CROSS_PS(intrp_samples, work, m3, m1, p1, p3); peak = _mm_max_ps(peak, abs_ps(intrp_samples)); SHIFT_RIGHT_2PS(new_work, work); VECTOR_MATRIX_CROSS_PS(intrp_samples, work, m3, m1, p1, p3); peak = _mm_max_ps(peak, abs_ps(intrp_samples)); SHIFT_RIGHT_2PS(new_work, work); VECTOR_MATRIX_CROSS_PS(intrp_samples, work, m3, m1, p1, p3); .... }</code> </pre> <br>  Vier identische Blöcke.  In fast allen Fällen weist ein solcher Code auf einen Fehler beim <i>Kopieren und Einfügen hin</i> .  Diese Funktionen müssen höchstwahrscheinlich mit unterschiedlichen Argumenten aufgerufen worden sein.  Auch wenn nicht, sieht dieser Code seltsam aus.  Eine gute Lösung wäre, den Block nur einmal zu schreiben und ihn in eine Schleife zu packen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i++) { peak = _mm_max_ps(peak, abs_ps(intrp_samples)); SHIFT_RIGHT_2PS(new_work, work); VECTOR_MATRIX_CROSS_PS(intrp_samples, work, m3, m1, p1, p3); }</code> </pre> <br>  <b>Warnung n5</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V560</a> Ein Teil eines bedingten Ausdrucks ist immer falsch: '! Modifikatoren'.  obs-hotkey.c (662) <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obs_key_combination</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obs_key_combination_t</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">obs_key_combination</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> modifiers; <span class="hljs-keyword"><span class="hljs-keyword">obs_key_t</span></span> key; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_binding</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">obs_key_combination_t</span></span> combo = {<span class="hljs-number"><span class="hljs-number">0</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> *modifiers = &amp;combo.modifiers; load_modifier(modifiers, data, <span class="hljs-string"><span class="hljs-string">"shift"</span></span>, INTERACT_SHIFT_KEY); load_modifier(modifiers, data, <span class="hljs-string"><span class="hljs-string">"control"</span></span>, INTERACT_CONTROL_KEY); load_modifier(modifiers, data, <span class="hljs-string"><span class="hljs-string">"alt"</span></span>, INTERACT_ALT_KEY); load_modifier(modifiers, data, <span class="hljs-string"><span class="hljs-string">"command"</span></span>, INTERACT_COMMAND_KEY); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!modifiers &amp;&amp; (combo.key == OBS_KEY_NONE || combo.key &gt;= OBS_KEY_LAST_VALUE)) { .... } .... }</code> </pre> <br>  Definition der <i>load_modifier</i> Funktion: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">inline</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load_modifier</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *modifiers, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">obs_data_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint32_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flag)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obs_data_get_bool(data, name)) *modifiers |= flag; }</code> </pre> <br>  Wie wir sehen können, ist <i>Modifiers</i> ein Zeiger, der durch die Adresse des <i>Modifiers-</i> Feldes der <i>Combo-</i> Struktur initialisiert wird.  Da sich sein Wert bis zur Überprüfung nicht ändert, bleibt er ungleich Null.  Darüber hinaus wird der Zeiger nach der Initialisierung vor der Prüfung beim Aufrufen der Funktion <i>load_modifier</i> verwendet, wo er dereferenziert wird.  Dementsprechend ist die Prüfung von <i>! Modifiers</i> sinnlos, da der Operator <i>&amp;&amp;</i> bei der Auswertung des logischen Ausdrucks immer den Wert <i>false</i> liefert.  Ich denke, der Programmierer wollte einen ganzzahligen Wert anhand der Adresse überprüfen, die im <i>Modifikatorzeiger</i> gespeichert ist, vergaß jedoch, diesen Zeiger dereferenzieren. <br><br>  Aus diesem Grund sollte die Prüfung meines Erachtens wie folgt aussehen: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!*modifiers &amp;&amp; ....) Or like <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!combo.modifiers &amp;&amp; ....)</code> </pre> <br>  <b>Warnung N6</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V575</a> Der potenzielle Nullzeiger wird an die Funktion 'strncpy' übergeben.  Untersuche das erste Argument.  Zeilen prüfen: 2904, 2903. rtmp.c (2904) <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PublisherAuth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... ptr = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(r-&gt;Link.app.av_len + pubToken.av_len); <span class="hljs-built_in"><span class="hljs-built_in">strncpy</span></span>(ptr, r-&gt;Link.app.av_val, r-&gt;Link.app.av_len); .... }</code> </pre> <br>  In den meisten <i>Fällen</i> ist ein solcher Code nicht sicher, da er ignoriert, dass <i>malloc</i> einen Nullzeiger zurückgeben kann.  Wenn <i>malloc</i> <i>NULL</i> zurückgibt, tritt in diesem Fall ein undefiniertes Verhalten auf, da das erste Argument der Funktion <i>strncpy</i> den Wert <i>NULL</i> hat. <br><br>  Weitere Informationen dazu, warum es wichtig ist, den Rückgabewert der <i>Malloc-</i> Funktion zu überprüfen, finden Sie im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">entsprechenden Artikel</a> . <br><br>  <b>Warnhinweise N7, N8, N9</b> <br><br>  Ratet mal, welche Fälle falsche Berechnungen enthalten: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OBSProjector</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> OBSQTDisplay { .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sourceX, sourceY, ....; .... } .... <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> OBSProjector::OBSRenderMultiview(....) { OBSProjector *window = (OBSProjector *)data; .... <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> calcBaseSource = [&amp;](<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (multiviewLayout) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MultiviewLayout::HORIZONTAL_TOP_24_SCENES: window-&gt;sourceX = (i % <span class="hljs-number"><span class="hljs-number">6</span></span>) * window-&gt;scenesCX; window-&gt;sourceY = window-&gt;pvwprgCY + (i / <span class="hljs-number"><span class="hljs-number">6</span></span>) * window-&gt;scenesCY; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MultiviewLayout::VERTICAL_LEFT_8_SCENES: window-&gt;sourceX = window-&gt;pvwprgCX; window-&gt;sourceY = (i / <span class="hljs-number"><span class="hljs-number">2</span></span>) * window-&gt;scenesCY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i % <span class="hljs-number"><span class="hljs-number">2</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>) { window-&gt;sourceX += window-&gt;scenesCX; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MultiviewLayout::VERTICAL_RIGHT_8_SCENES: window-&gt;sourceX = <span class="hljs-number"><span class="hljs-number">0</span></span>; window-&gt;sourceY = (i / <span class="hljs-number"><span class="hljs-number">2</span></span>) * window-&gt;scenesCY; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i % <span class="hljs-number"><span class="hljs-number">2</span></span> != <span class="hljs-number"><span class="hljs-number">0</span></span>) { window-&gt;sourceX = window-&gt;scenesCX; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> MultiviewLayout::HORIZONTAL_BOTTOM_8_SCENES: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) { window-&gt;sourceX = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(i) * window-&gt;scenesCX); window-&gt;sourceY = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { window-&gt;sourceX = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>(i - <span class="hljs-number"><span class="hljs-number">4</span></span>) * window-&gt;scenesCX); window-&gt;sourceY = window-&gt;scenesCY; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>:<span class="hljs-comment"><span class="hljs-comment">// MultiviewLayout::HORIZONTAL_TOP_8_SCENES: if (i &lt; 4) { window-&gt;sourceX = (float(i) * window-&gt;scenesCX); window-&gt;sourceY = window-&gt;pvwprgCY; } else { window-&gt;sourceX = (float(i - 4) * window-&gt;scenesCX); window-&gt;sourceY = window-&gt;pvwprgCY + window-&gt;scenesCY; } } } .... }</span></span></code> </pre> <br>  Analyzer-Warnungen: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V636</a> Der Ausdruck 'i / 6' wurde implizit vom Typ 'size_t' in den Typ 'float' umgewandelt.  Erwägen Sie die Verwendung einer expliziten Typumwandlung, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  Fensterprojektor.cpp (330) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V636</a> Der Ausdruck 'i / 2' wurde implizit vom Typ 'size_t' in den Typ 'float' umgewandelt.  Erwägen Sie die Verwendung einer expliziten Typumwandlung, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  Fensterprojektor.cpp (334) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">V636</a> Der Ausdruck 'i / 2' wurde implizit vom Typ 'size_t' in den Typ 'float' umgewandelt.  Erwägen Sie die Verwendung einer expliziten Typumwandlung, um den Verlust eines Bruchteils zu vermeiden.  Ein Beispiel: double A = (double) (X) / Y;  Fensterprojektor.cpp (340) </li></ul><br>  Hier ist die richtige Antwort: In denen, in denen <i>ich</i> nicht zum Schweben gezwungen bin.  Der Analysator zeigt uns Fragmente mit ganzzahliger Teilung.  Ein solcher Code funktioniert möglicherweise nicht so, wie es sich der Programmierer erhofft hatte. <br><br><h2>  Fazit </h2><br>  Wie wir sehen können, ist die Integration des PVS-Studio-Analysators in Ihr Projekt auf GitLab ein recht einfacher Vorgang.  Dazu müssen Sie nur eine Konfigurationsdatei schreiben und in Ihrem Cloud-Repository ablegen.  Da GitLab über eine eigene integrierte virtuelle Maschine verfügt, müssen wir nicht einmal viel Zeit für die Konfiguration des CI-Systems aufwenden.  Mit der Codeüberprüfung können Sie Probleme direkt nach dem Build feststellen.  Dies hilft, Probleme in der Phase zu beseitigen, in der ihre Komplexität und Kosten noch gering sind. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de476626/">https://habr.com/ru/post/de476626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de476596/index.html">Siemens errichtet eine Elektrolyse-Anlage zur Herstellung von Stahl, die von Windmühlen angetrieben wird</a></li>
<li><a href="../de476610/index.html">Ein bisschen Geschäftsprozesstheorie</a></li>
<li><a href="../de476618/index.html">Wie ich das Focus Kit entworfen habe</a></li>
<li><a href="../de476620/index.html">SP701 + PCAM-5C + 15 Minuten + VITIS = Easy MIPI auf FPGA</a></li>
<li><a href="../de476624/index.html">Qualitätspipelines in der mobilen Entwicklung, Teil 1: Android</a></li>
<li><a href="../de476628/index.html">PVS-Studio geht in die Cloud: GitLab CI / CD</a></li>
<li><a href="../de476636/index.html">Optimieren von Firebird und Linux für eine Datenbank mit einer Größe von 691 GB und mehr als 1000 Benutzern</a></li>
<li><a href="../de476640/index.html">Schutz von Zimbra OSE vor Brute-Force- und DoS-Angriffen</a></li>
<li><a href="../de476644/index.html">Sprachschichten</a></li>
<li><a href="../de476646/index.html">3-Wege-Fusion in Werf: Einsatz in Kubernetes mit Helm "auf Steroiden"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>