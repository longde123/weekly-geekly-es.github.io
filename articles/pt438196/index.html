<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèΩ üë®üèº‚Äçüíº üë©üèæ‚Äçü§ù‚Äçüë®üèΩ Se o projeto for "Teatro", use atores ... üìü üà∂ üßëüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Este artigo ir√° contar sobre a experi√™ncia de usar a abordagem de ator em um projeto interessante de um sistema de controle automatizado para o teatro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Se o projeto for "Teatro", use atores ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438196/"><p>  Este artigo ir√° contar sobre a experi√™ncia de usar a abordagem de ator em um projeto interessante de um sistema de controle automatizado para o teatro.  Esta √© exatamente a impress√£o de uso, nada mais. </p><a name="habracut"></a><br><p>  Recentemente, pude participar de uma tarefa muito interessante - moderniza√ß√£o, mas de fato - o desenvolvimento de um novo sistema de controle automatizado para elevar racks de um dos cinemas. </p><br><p>  Um teatro moderno (se for grande) √© uma organiza√ß√£o bastante complexa.  Muitas pessoas, equipamentos e v√°rios sistemas est√£o envolvidos nele.  Um desses sistemas √© o sistema de controle para "elevar e abaixar" o cen√°rio no palco.  Apresenta√ß√µes modernas, e mais √≥peras e bal√©s, est√£o ficando cada vez mais saturadas de meios t√©cnicos a cada ano.  Ele usa muitos cen√°rios complexos e seus movimentos durante a a√ß√£o.  O cen√°rio √© usado ativamente nos planos de dire√ß√£o, expandindo o significado do que est√° acontecendo e at√© ‚Äúdesempenhando seu pr√≥prio papel de apoio‚Äù).  Em geral, foi muito interessante familiarizar-se com a vida nos bastidores do teatro e descobrir o que acontece durante as apresenta√ß√µes.  Afinal, os espectadores comuns veem apenas o que est√° acontecendo no palco. </p><br><p>  Mas este artigo ainda √© t√©cnico e eu queria compartilhar a experi√™ncia de usar a abordagem de ator para implementar o gerenciamento.  E tamb√©m compartilhe a experi√™ncia de usar uma das poucas estruturas de ator C ++ - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sobjectizer</a> . </p><br><p>  Por que exatamente ele?  Estamos de olho nele h√° muito tempo.  Existem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigos</a> em um habr, com excelente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> detalhada com exemplos.  O projeto √© bastante maduro.  Uma r√°pida olhada nos exemplos mostrou que os desenvolvedores operam com conceitos "familiares" (estados, temporizadores, eventos), ou seja,  grandes problemas n√£o eram esperados com compreens√£o e dom√≠nio, para uso em nosso projeto.  E sim, importante, os desenvolvedores s√£o adequados e amig√°veis, prontos para ajudar com conselhos <del>  (em russo) </del>  .  Ent√£o decidimos tentar ... </p><br><h2 id="a-chto-delaem">  O que estamos fazendo? </h2><br><p>  Ent√£o, como √© o nosso "objeto de controle"?  O sistema de elevadores shtanketovy - s√£o 62 hastes (tubos de metal) em toda a largura do palco, suspensas acima dessa mesma cena, aproximadamente a cada 30 a 40 cm da borda do palco em profundidade.  As hastes s√£o suspensas em cordas e podem subir ou descer no palco (movimento vertical).  Em cada performance (ou √≥pera ou bal√©), parte das estrofes √© usada para decora√ß√£o.  O cen√°rio √© pendurado neles e movido (se o script exigir) durante a a√ß√£o.  O movimento em si √© realizado sob o comando dos operadores (eles t√™m pain√©is de controle especiais) usando o sistema "motor - cabo - contrapeso" (quase o mesmo que elevadores em resid√™ncias).  Os motores est√£o localizados nas bordas do palco (em v√°rias camadas), para que n√£o fiquem vis√≠veis para o espectador.  Todos os motores s√£o divididos em 8 grupos e cada grupo possui tr√™s conversores de frequ√™ncia (IF).  Em cada grupo, tr√™s motores podem ser ativados simultaneamente, cada um conectado ao seu pr√≥prio inversor.  No total, temos um sistema de 62 motores e 24 inversores, que devemos controlar. </p><br><p>  Nossa tarefa era desenvolver uma interface de opera√ß√£o para gerenciar essa economia, bem como implementar algoritmos de gerenciamento.  O sistema inclui tr√™s postos de controle.  Dois postos de controle est√£o localizados diretamente acima do palco e um posto est√° localizado na sala de m√°quinas (onde est√£o os arm√°rios de controle) e foi projetado para monitorar o trabalho de um eletricista de plant√£o.  Nos arm√°rios de controle existem controladores que executam comandos, controlam PWM, fornecem energia aos motores, rastreiam a posi√ß√£o das hastes.  Nos dois controles remotos superiores est√£o os monitores, uma unidade de sistema onde os algoritmos de controle e o trackball est√£o girando como um "mouse".  Uma rede Ethernet √© usada entre os pain√©is de controle.  Cada gabinete de controle possui um canal RS485 (ou seja, 8 canais) de cada um dos dois pain√©is de controle.  O gerenciamento pode ser realizado simultaneamente em ambos os controles remotos (que est√£o acima do palco), mas ao mesmo tempo apenas um dos controles remotos (designado pelo operador como operador principal) est√° trocando com os gabinetes, o segundo console neste momento √© considerado um backup e a troca √© desativada. </p><br><h2 id="prichyom-tut-aktory">  E aqui os atores </h2><br><p>  Do ponto de vista dos algoritmos, todo o sistema √© constru√≠do sobre eventos.  Essas s√£o algumas mudan√ßas nos sensores, ou as a√ß√µes do operador, ou o in√≠cio de algum tempo (temporizadores).  E tais algoritmos s√£o muito bem colocados pelo sistema de atores que processam eventos recebidos, formam algum tipo de resposta e tudo isso, dependendo do seu estado.  No sobjectador, todos esses mecanismos saem da caixa.  Os principais princ√≠pios nos quais esse sistema se baseia podem ser atribu√≠dos: a intera√ß√£o entre os atores ocorre por meio de mensagens, os atores podem ter estados e se mover entre eles, em cada estado o ator processa apenas as mensagens que lhe interessam no momento.  O interessante √© que, em um sobjetitador, trabalhar com atores √© conceitualmente separado de trabalhar com fluxos de trabalho.  I.e.  Voc√™ pode descrever os atores de que precisa, perceber sua l√≥gica, interagir com mensagens.  Mas, em seguida, resolva separadamente o problema de alocar threads (recursos) para seu trabalho.  Isso √© garantido pelos chamados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">"despachantes",</a> respons√°veis ‚Äã‚Äãpor uma pol√≠tica espec√≠fica de trabalho com threads.  Por exemplo, existe um despachante que aloca um encadeamento separado para cada ator trabalhar, h√° um despachante que fornece um conjunto de encadeamentos (ou seja, pode haver mais atores que encadeamentos) com a capacidade de definir o n√∫mero m√°ximo de encadeamentos, h√° um despachante que aloca um encadeamento para todos.  A presen√ßa de despachantes fornece um mecanismo muito flex√≠vel para configurar um sistema de ator para atender √†s suas necessidades.  Voc√™ pode combinar grupos de atores para trabalhar com um dos despachantes, enquanto altera um tipo de despachante para outro, isso basicamente altera uma linha de c√≥digo.  Segundo os autores da estrutura, escrever seu pr√≥prio despachante exclusivo tamb√©m n√£o √© dif√≠cil.  Isso n√£o era necess√°rio em nosso projeto, porque tudo o que precis√°vamos j√° estava no sobjetador. </p><br><p>  Outra caracter√≠stica interessante √© a presen√ßa do conceito de ‚Äúcoopera√ß√£o‚Äù dos atores.  Coopera√ß√£o √© um grupo de atores que podem existir ou serem destru√≠dos (ou n√£o lan√ßados) se pelo menos um ator da coopera√ß√£o n√£o puder iniciar o trabalho ou concluir.  N√£o tenho medo de fazer essa analogia ( <del>  mesmo que seja de outra "√≥pera" </del>  ) de que o conceito de "coopera√ß√£o" √© como o conceito de "lareiras" nos Kubernetes, agora na moda, parece apenas no sobjetador, surgiu mais cedo ... </p><br><p>  No momento da cria√ß√£o, cada ator √© inclu√≠do na coopera√ß√£o (a coopera√ß√£o pode consistir em um ator), fica ligado a um ou outro despachante e come√ßa a trabalhar.  Ao mesmo tempo, atores (e coopera√ß√£o) podem (facilmente) ser criados dinamicamente em grandes n√∫meros e, como prometem os desenvolvedores, n√£o √© caro.  Todos os atores trocam entre si atrav√©s de " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">caixas de correio</a> " (mbox).  Este tamb√©m √© um conceito bastante interessante e forte no sobjetador.  Ele fornece um mecanismo muito flex√≠vel para processar mensagens recebidas.  Em primeiro lugar, mais de um destinat√°rio pode estar escondido atr√°s de uma caixa.  √â realmente muito conveniente.  Por exemplo, √© criada uma caixa na qual os eventos de sensores externos s√£o recebidos e cada ator assina eventos de seu interesse.  Isso fornece um estilo de opera√ß√£o "publicar / assinar".  Em segundo lugar, os desenvolvedores ofereceram a oportunidade de criar com relativa facilidade sua pr√≥pria implementa√ß√£o de caixas de correio que podem pr√©-processar mensagens recebidas (por exemplo, de alguma forma, filtr√°-las ou distribu√≠-las de uma maneira especial entre os consumidores).  Al√©m disso, cada ator tem sua pr√≥pria caixa de correio e pode at√© enviar um "link" a ela em mensagens para outros atores, por exemplo, para que eles possam enviar algum tipo de notifica√ß√£o como resposta de retorno. </p><br><p>  Em nosso projeto, para garantir a independ√™ncia dos grupos de motores entre si, al√©m de garantir a opera√ß√£o "ass√≠ncrona" dos motores dentro do grupo, todos os objetos de controle foram divididos em 8 grupos (de acordo com o n√∫mero de gabinetes de controle), cada um com tr√™s trabalhadores. fluxo (uma vez que n√£o mais que tr√™s motores podem operar em um grupo por vez). <br>  Tamb√©m deve-se dizer que o sobjetador (na vers√£o atual 5.5) n√£o cont√©m mecanismos de intera√ß√£o entre processos e redes e deixa essa parte para os desenvolvedores.  Os autores fizeram isso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">deliberadamente</a> , para que o quadro seja mais "f√°cil".  Al√©m disso, os mecanismos de intera√ß√£o de rede ‚Äúuma vez‚Äù existiam nas vers√µes anteriores, mas foram exclu√≠dos.  No entanto, isso n√£o causa nenhum inconveniente, porque na verdade a intera√ß√£o da rede depende muito das tarefas que est√£o sendo resolvidas, dos protocolos de troca usados ‚Äã‚Äãetc.  Aqui, uma implementa√ß√£o universal n√£o pode ser ideal para todos os casos. </p><br><p>  No nosso caso, para comunica√ß√£o em rede e interprocessos, usamos um de nossos desenvolvimentos de longa data - a biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libuniset2</a> .  Como resultado, a arquitetura do nosso sistema √© mais ou menos assim: </p><br><ul><li>  libuniset fornece comunica√ß√£o de rede e interprocessos (com base em sensores) </li><li>  o sobjectizer fornece a cria√ß√£o de um sistema de atores interagindo entre si (no mesmo espa√ßo de endere√ßo) implementando algoritmos de controle. </li></ul><br><p>  Ent√£o, deixe-me lembr√°-lo, temos 62 motores.  Cada motor pode ser conectado ao inversor, o suporte correspondente pode receber a coordenada √† qual voc√™ deve chegar e a velocidade com a qual deve se mover.  Al√©m disso, o mecanismo possui as seguintes condi√ß√µes: </p><br><ul><li>  pronto para ir </li><li>  conectado </li><li>  correndo (girando) </li><li>  acidente </li><li>  conex√£o (estado transit√≥rio) </li><li>  desligamento (estado transit√≥rio) </li></ul><br><p>  Como resultado, cada ‚Äúmecanismo‚Äù √© representado no sistema por um ator que implementa a l√≥gica de transi√ß√µes entre estados, processando eventos de sensores e emitindo comandos de controle.  No sobjectizer, os atores s√£o criados facilmente, apenas herdam sua classe da classe base so_5 :: agent_t.  Nesse caso, o construtor deve aceitar o chamado contexto: so_5 :: context_t como o primeiro argumento, os argumentos restantes s√£o determinados pela necessidade do desenvolvedor. </p><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drive_A</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Drive_A( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, ... ); ... }</code> </pre> <br><p>  Porque  Como este artigo n√£o √© educacional, n√£o fornecerei aqui os textos detalhados das descri√ß√µes de classes ou m√©todos.  O artigo s√≥ queria mostrar como √© f√°cil (em poucas linhas) com a ajuda do sobjectizer tudo isso √© implementado.  Deixe-me lembr√°-lo de que o projeto possui uma excelente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">documenta√ß√£o</a> detalhada, com v√°rios exemplos diferentes. </p><br><h2 id="a-chto-za-sostoyaniya-u-etih-aktorov-o-chyom-rech">  E quais s√£o os "estados" desses atores?  Do que voc√™ est√° falando? </h2><br><p>  O uso de estados e transi√ß√µes entre eles para o ACS geralmente √© um t√≥pico nativo.  Esse "conceito" se encaixa muito bem na manipula√ß√£o de eventos.  No sobjectizer, esse conceito √© suportado no n√≠vel da API.  Em uma classe de ator, os estados s√£o facilmente declarados </p><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Drive_A</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">final</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> so_5::<span class="hljs-keyword"><span class="hljs-keyword">agent_t</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Drive_A( <span class="hljs-keyword"><span class="hljs-keyword">context_t</span></span> ctx, ... ); <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ~Drive_A(); <span class="hljs-comment"><span class="hljs-comment">//  state_t st_base {this}; state_t st_disabled{ initial_substate_of{st_base}, "disabled" }; state_t st_preinit{ substate_of{st_base}, "preinit" }; state_t st_off{ substate_of{st_base}, "off" }; state_t st_connecting{ substate_of{st_base}, "connecting" }; state_t st_disconnecting{ substate_of{st_base}, "disconnecting" }; state_t st_connected{ substate_of{st_base}, "connected" }; ... }</span></span></code> </pre><br><p>  e ainda, para cada estado, o desenvolvedor determina os manipuladores necess√°rios.  Freq√ºentemente, algumas a√ß√µes s√£o necess√°rias ao entrar e sair de um estado.  Isso tamb√©m √© fornecido no sobjectizer, voc√™ define com facilidade os manipuladores para esses eventos ("entrada de estado", "sa√≠da de estado"). <del>  Considera-se que os desenvolvedores no passado t√™m uma vasta experi√™ncia com ACS-shny </del>  ... </p><br><h3 id="obrabotchiki-sobytiy">  Manipuladores de eventos </h3><br><p>  Manipuladores de eventos, √© aqui que a l√≥gica do seu aplicativo √© implementada.  Como mencionado acima, √© feita uma assinatura para uma caixa de correio espec√≠fica e para um determinado estado do ator.  Se um ator n√£o tiver estados declarados explicitamente no c√≥digo, ele estar√° implicitamente no estado especial "default_state".  Em estados diferentes, voc√™ pode definir manipuladores diferentes para os mesmos eventos.  Se voc√™ n√£o especificou o manipulador de nenhum evento nesta caixa de correio, ele ser√° simplesmente ignorado (ou seja, simplesmente n√£o existir√° para o ator). </p><br><p>  A sintaxe para definir manipuladores √© muito simples.  √â o suficiente para indicar sua fun√ß√£o.  Nenhum tipo ou argumento de modelo √© necess√°rio.  Tudo √© deduzido automaticamente da defini√ß√£o da fun√ß√£o.  Por exemplo: </p><br><pre> <code class="cpp hljs">so_subscribe(drv-&gt;so_mbox()) .in(st_base) .event( &amp;Drive_A::on_get_info ) .event( &amp;Drive_A::on_control ) .event( &amp;Drive_A::off_control );</code> </pre> <br><p>  Aqui est√° um exemplo de inscri√ß√£o em eventos em uma caixa espec√≠fica para o estado st_base.  Curiosamente, neste exemplo, st_base √© o estado base para outros estados e, portanto, essa assinatura ser√° v√°lida para todos os estados que s√£o "herdados" do st_base.  Essa abordagem permite que voc√™ se livre de "copiar e colar" para determinar os mesmos manipuladores para diferentes estados.  Ao mesmo tempo, em um estado espec√≠fico, voc√™ pode substituir o manipulador especificado ou "desativ√°-lo" (suprimir). </p><br><p>  H√° outra maneira de definir manipuladores.  Esta √© uma defini√ß√£o direta de fun√ß√µes lambda.  Essa √© uma maneira muito conveniente, porque geralmente os manipuladores s√£o fun√ß√µes curtas em algumas a√ß√µes, enviam algo a algu√©m ou alternam o estado. </p><br><pre> <code class="cpp hljs">so_subscribe(drv-&gt;so_mbox()) .in(st_disconnecting) .event([<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>](<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">msg_disconnected_t</span></span>&amp; m) { ... st_off.activate(); }) .event([<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>]( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">msg_failure_t</span></span>&amp; m ) { ... st_protection.activate(); });</code> </pre> <br><p>  A princ√≠pio, essa sintaxe parece complicada.  Mas em apenas alguns dias de desenvolvimento ativo, voc√™ se acostuma e at√© come√ßa a gostar.  Como toda a l√≥gica do trabalho do ator em um estado ou outro pode se encaixar em um c√≥digo bastante curto e tudo estar√° diante de seus olhos.  Por exemplo, no exemplo mostrado, no estado desconectado (st_disconnecting), a transi√ß√£o para o estado desconectado (st_off.) Ou o estado de prote√ß√£o (st_protection) ocorre se uma mensagem sobre algum tipo de falha ocorrer.  Esse c√≥digo √© muito f√°cil de ler. </p><br><p>  A prop√≥sito, para casos simples em que um evento s√≥ precisa entrar em algum estado, h√° uma sintaxe ainda mais curta: </p><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> mbox = drv-&gt;so_mbox(); st_off .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_connected_t</span></span>&gt;(mbox, st_connected) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_failure_t</span></span>&gt;(mbox, st_protection) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_on_limit_t</span></span>&gt;(mbox, st_protection) .just_switch_to&lt;<span class="hljs-keyword"><span class="hljs-keyword">msg_on_t</span></span>&gt;(mbox, st_on);</code> </pre><br><h2 id="upravlenie">  Ger√™ncia </h2><br><p>  Como funciona a gest√£o de toda essa economia?  Como mencionado acima, dois controles remotos s√£o fornecidos para o controle direto do movimento dos shtankets.  Cada controle remoto possui um monitor, um manipulador (trackball) e uma discagem r√°pida (al√©m do ‚Äúcomputador‚Äù oculto no controle remoto no qual tudo gira e empilha todos os tipos de conversores).  O sistema possui v√°rios modos de controlar o movimento dos shtankets.  Manual e "modo de script".  Sobre o "modo de cen√°rio" ser√° discutido mais adiante, e agora um pouco sobre o "modo manual".  Nesse modo, o operador seleciona a haste desejada, prepara-a para o movimento (conecta o motor ao inversor), define a marca (posi√ß√£o de destino) da haste e, assim que define a velocidade maior que zero, as hastes come√ßam a se mover.  Para definir a velocidade, √© utilizado um ajustador f√≠sico especial, na forma de um ‚Äúpotenci√¥metro com um bot√£o‚Äù, mas tamb√©m existe um ‚Äúajustador de tela‚Äù de velocidade.  Quanto mais "virado", mais <del>  mais alto </del>  vai mais r√°pido.  A velocidade m√°xima √© limitada a 1,5 m / s.  Bot√£o de velocidade - um para todos.  I.e.  No modo manual, todas as hastes conectadas pelo operador se movem na mesma velocidade definida.  Embora eles possam se mover em dire√ß√µes diferentes (depende de onde o operador os direcionou).  Obviamente, √© dif√≠cil para uma pessoa acompanhar mais de dois ou tr√™s shtankets ao mesmo tempo; portanto, geralmente eles n√£o est√£o se movendo muito no modo manual.  Em duas esta√ß√µes, os operadores podem gerenciar simultaneamente cada um de seus shtankets.  Al√©m disso, cada console (operador) possui seu pr√≥prio controlador de velocidade. </p><br><p>  Do ponto de vista da implementa√ß√£o, o modo manual n√£o cont√©m nenhuma l√≥gica especial.  O comando para conectar o mecanismo vem da interface gr√°fica, √© convertido em uma mensagem para o ator correspondente, que trabalha nele.  Passando pelos estados ‚Äúdesligado‚Äù -&gt; ‚Äúconectando‚Äù -&gt; ‚Äúconectado‚Äù.  O mesmo acontece com a defini√ß√£o da posi√ß√£o para o movimento do stunket e a velocidade.  Todos esses eventos chegam ao ator na forma de mensagens √†s quais ele reage.  A menos que se note que a interface gr√°fica e o processo de controle em si s√£o processos diferentes e entre eles existe uma intera√ß√£o entre processos atrav√©s dos "sensores" usando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">libuniset2</a> . </p><br><h2 id="rezhim-ispolneniya-scenariya-opyat-eti-aktory">  Modo de execu√ß√£o de script (novamente, esses atores?) </h2><br><p>  De fato, o modo de controle manual √© usado principalmente apenas para conviver durante os ensaios ou em casos simples.  O principal modo em que o controle est√° em andamento √© o "modo de execu√ß√£o de script" ou, brevemente, o "modo de script".  Nesse modo, cada shtank se move para o seu ponto com os par√¢metros especificados no script (velocidade e marca de destino).  Para o operador, o controle neste modo consiste em dois comandos simples: </p><br><ul><li>  prepare-se (o grupo certo de motores est√° conectado) </li><li>  vamos l√° (o grupo come√ßa a se mover para as posi√ß√µes de destino definidas para cada). </li></ul><br><p>  Todo o cen√°rio √© dividido nas chamadas "agendas".  Uma agenda √© um movimento de um grupo shtanket.  I.e.  cada agenda inclui um grupo de shtankets, com a velocidade e a marca desejadas para onde voc√™ precisa.  De fato, o roteiro √© dividido em atos, atos s√£o divididos em pinturas, pinturas s√£o divididas em intima√ß√µes, e intima√ß√µes j√° consistem em "objetivos" para shtankets espec√≠ficos.  Mas, do ponto de vista da ger√™ncia, essa divis√£o n√£o √© importante, porque  est√° na agenda que par√¢metros espec√≠ficos do movimento s√£o indicados no final. </p><br><p>  Para implementar esse regime, o sistema de atores surgiu da melhor maneira poss√≠vel.  Um "script player" foi desenvolvido que cria um grupo de atores especiais e os lan√ßa.  Desenvolvemos dois tipos de atores: atores-atores, projetados para executar tarefas para um shtanket espec√≠fico, e um ator-coordenador, que distribui tarefas entre os artistas.  Al√©m disso, os atores s√£o criados conforme necess√°rio, se no momento da pr√≥xima equipe n√£o estiver livre.  O ator coordenador √© respons√°vel por criar e manter o pool de atores perform√°ticos.  Como resultado, o gerenciamento se parece com isso: </p><br><ul><li>  A instru√ß√£o carrega o script </li><li>  "Vira" para a agenda desejada (geralmente apenas segue uma fila). </li><li>  no momento certo, pressiona o bot√£o "preparar", de acordo com o qual um comando (mensagem) √© enviado ao ator coordenador para cada formul√°rio inclu√≠do na agenda atual com par√¢metros de movimento. </li><li>  O coordenador de atores examina seu pool de atores com desempenho livre, pega um gr√°tis (se ele n√£o cria um novo) e d√° a ele uma tarefa (n√∫mero de hastes e par√¢metros de movimento). </li><li>  Cada ator-ator que recebeu a tarefa come√ßa a cumprir o comando "prepare-se".  I.e.  ele conecta o mecanismo e entra no modo de espera do comando "go". </li><li>  quando chegar a hora, o operador dar√° o comando "vamos l√°" </li><li>  a equipe "vai" vem ao coordenador.  Ele envia para todos os artistas atualmente ativos e eles come√ßam a "execu√ß√£o". </li></ul><br><p>  Vale ressaltar que na agenda existem par√¢metros adicionais.  Por exemplo, inicie o movimento com um atraso de N segundos ou inicie o movimento somente ap√≥s um comando de operador especial separado.  Portanto, a lista de estados para cada ator √© bastante grande: "pronto para executar o pr√≥ximo comando", "pronto para mover", "movimento atrasado", "aguardando o comando do operador", "movimento", "execu√ß√£o conclu√≠da", "mau funcionamento" . </p><br><p>  Depois que o shanket alcan√ßou com sucesso (ou n√£o) a marca especificada, o ator-executor notifica o coordenador da tarefa conclu√≠da.  O coordenador fornece o comando para desligar esse mecanismo (se n√£o estiver mais participando da agenda atual) ou emite novos par√¢metros de movimento.  Por sua vez, o ator-int√©rprete recebeu um comando para desligar o mecanismo, o desliga e entra em um estado de espera por novos comandos ou come√ßa a executar um novo comando. </p><br><p>  Devido ao fato de o sobjectizer ter uma API bem pensada e conveniente para trabalhar com estados, o c√≥digo de implementa√ß√£o √© bastante conciso.  Por exemplo, o atraso no movimento √© descrito em uma linha: </p><br><pre> <code class="cpp hljs">st_delay.time_limit( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::chrono::milliseconds{target-&gt;delay()}, st_moving ); st_delay.activate(); ...</code> </pre><br><p>  A fun√ß√£o time_limit define um limite de tempo para quanto pode ser gasto em um determinado estado e qual estado deve ser passado ap√≥s um tempo especificado (st_moving). </p><br><h2 id="aktory-zaschity">  Atores de prote√ß√£o </h2><br><p>  Obviamente, durante a opera√ß√£o, podem ocorrer problemas de funcionamento.  O sistema √© necess√°rio para lidar com essas situa√ß√µes.  Aqui tamb√©m havia um lugar para o uso de atores.  Considere v√°rias destas prote√ß√µes: </p><br><ul><li>  sobre a prote√ß√£o atual </li><li>  prote√ß√£o contra falha de medi√ß√£o </li><li>  prote√ß√£o contra movimento na dire√ß√£o oposta (e isso pode acontecer, se algo estiver errado com o sensor ou o medidor) </li><li>  prote√ß√£o contra movimento sem comando </li><li>  controle da execu√ß√£o da equipe (controle de que o shtanket come√ßou a se mover) </li></ul><br><p>  Voc√™ pode ver que todas essas prote√ß√µes s√£o independentes (auto-suficientes) do ponto de vista da implementa√ß√£o e devem funcionar "em paralelo".  I.e.  qualquer condi√ß√£o pode funcionar.  Ao mesmo tempo, a l√≥gica de verificar as condi√ß√µes de acionamento de cada uma das prote√ß√µes tem sua pr√≥pria, √†s vezes √© necess√°rio um atraso (temporizador) para acionar, √†s vezes o processamento preliminar de v√°rias medi√ß√µes anteriores, etc.  Portanto, a implementa√ß√£o de cada tipo de prote√ß√£o como um pequeno ator separado acabou sendo muito conveniente.  Todos esses atores s√£o lan√ßados al√©m (em coopera√ß√£o) do ator principal que implementa a l√≥gica de controle.  Essa abordagem facilita a adi√ß√£o de tipos adicionais de defesas simplesmente adicionando outro ator ao grupo.  Ao mesmo tempo, a implementa√ß√£o de um ator assim permanece bastante f√°cil e compreens√≠vel, porque  Ele implementa apenas uma fun√ß√£o. </p><br><p>  Os atores de prote√ß√£o tamb√©m t√™m v√°rios estados.  Basicamente, eles ligam (entram no estado "ligado") somente quando o motor est√° conectado ou a haste est√° em movimento.  Quando as condi√ß√µes de prote√ß√£o s√£o acionadas, eles publicam uma notifica√ß√£o sobre a prote√ß√£o que est√° sendo acionada (com um c√≥digo de seguran√ßa e alguns detalhes para o log), o ator principal j√° est√° respondendo a essa notifica√ß√£o, que, se necess√°rio, desliga o mecanismo e passa para o modo de prote√ß√£o. </p><br><h2 id="v-kachestve-vyvoda">  Como conclus√£o .. </h2><br><p>  ... √© claro que este artigo n√£o √© algum tipo de "descoberta".  A abordagem do ator h√° muito tempo √© usada com sucesso em muitos sistemas.  Mas, para mim, foi a primeira experi√™ncia de usar conscientemente a abordagem de ator para criar algoritmos de sistema de controle em um projeto relativamente pequeno.  E a experi√™ncia foi bastante bem-sucedida.  Espero ter conseguido mostrar que os atores est√£o muito bem sobrepostos aos algoritmos de controle, pois encontraram um lugar literalmente em todo lugar. </p><br><p>  Com a experi√™ncia de projetos anteriores, ficou claro que, de uma forma ou de outra, est√°vamos implementando ‚Äúalgo assim‚Äù (estados, mensagens, controle de fluxo etc.), mas essa n√£o era uma abordagem unificada.  Usando o sobjectizer, obtivemos uma ferramenta de desenvolvimento leve e concisa que enfrenta muitos problemas.  N√£o √© mais necess√°rio (expl√≠cito) usar ferramentas de sincroniza√ß√£o (mutexes, etc.), n√£o h√° trabalho expl√≠cito com fluxos, nem realiza√ß√µes da m√°quina de estado.  Tudo isso est√° na estrutura, logicamente interconectado e apresentado como uma API conveniente, al√©m disso, sem perder o controle sobre os detalhes.  Ent√£o a experi√™ncia foi interessante.  Para quem ainda duvida, recomendo prestar aten√ß√£o √† abordagem do ator e √† estrutura do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">sobjectador</a> em particular.  Ele deixa emo√ß√µes positivas. </p><br><p>  E a abordagem do ator realmente funciona!  Especialmente no teatro. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438196/">https://habr.com/ru/post/pt438196/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438174/index.html">Amarelo - V√°cuo - Nuvem</a></li>
<li><a href="../pt438176/index.html">Vis√£o geral do IPSec no Mikrotik</a></li>
<li><a href="../pt438178/index.html">Criando seu primeiro aplicativo ARCore</a></li>
<li><a href="../pt438180/index.html">Registrar uma transa√ß√£o imobili√°ria on-line</a></li>
<li><a href="../pt438182/index.html">O estudo constatou os benef√≠cios da pirataria moderada para produtores e distribuidores de conte√∫do</a></li>
<li><a href="../pt438198/index.html">Vamos aprofundar a hist√≥ria: onde crescem as pernas dos quadroc√≥pteros</a></li>
<li><a href="../pt438202/index.html">JavaScript: campos de classe p√∫blica e privada</a></li>
<li><a href="../pt438204/index.html">Dispositivo compilador r√°pido. Parte 1</a></li>
<li><a href="../pt438206/index.html">26 recomenda√ß√µes para usar o tipo var em Java</a></li>
<li><a href="../pt438210/index.html">Civiliza√ß√£o de Springs, 2/5</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>