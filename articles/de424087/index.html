<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤰🏾 👻 🧑 Arduino-gesteuertes Bluetooth-gesteuertes Android-Gerät - vollständiger Zyklus (Teil 1) 🙎🏾 👨🏿‍⚖️ 🦉</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Einführung 
 Eine detaillierte Geschichte darüber, wie das Arduino-Auto, das von einem Android-Gerät über Bluetooth gesteuert wird, aus drei Motoren z...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Arduino-gesteuertes Bluetooth-gesteuertes Android-Gerät - vollständiger Zyklus (Teil 1)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/424087/"><h2>  Einführung </h2><br>  Eine detaillierte Geschichte darüber, wie das Arduino-Auto, das von einem Android-Gerät über Bluetooth gesteuert wird, aus drei Motoren zusammengesetzt wurde.  In mehreren Dutzend Absätzen werde ich versuchen, Schritt für Schritt so viel wie möglich zu erklären, wo die einzelnen Drähte angeschlossen werden, wie eine proprietäre Anwendung geschrieben wird und auf welchen Kinderharken ich mehr als eine Woche lang springen musste. <br><br><h2>  Ein bisschen über Level, Autor und Warnungen </h2><br>  Ich, ein Autor, ein Kind zwischen 16 und 17 Jahren aus einem Dorf in der Nähe von Moskau, habe mich auf das Schreiben von Android-Anwendungen spezialisiert (und dort ist es schwieriger, etwas zu verbrennen). Deshalb übernehme ich die Verantwortung für einen optimalen Ansatz zur Lösung von Problemen. <br><br>  Praktisch jeder der unten beschriebenen Schritte hat mich mehr gekostet, als es die Zeit wert wäre.  Wahrscheinlich aus diesem Grund möchte ich meine Erfahrungen teilen.  Gleichzeitig freue ich mich sehr, wenn Sie nach Fehlern schimpfen und mich zur Optimierung auffordern. <br><br><h2>  Herausforderung </h2><br>  Die einfachste Aufgabe besteht darin, das Arduino-gesteuerte Auto zum Fahren zu bringen und die Fernbedienung durch ein Android-Gerät zu ersetzen.  Aber in den meisten Momenten musste ich das Rad neu erfinden, weil im Internet keine geeignete Lösung gefunden wurde. <br><a name="habracut"></a><br><h3>  Wird brauchen </h3><br><ol><li>  Arduino </li><li>  Motor Shield (in meinem Fall zwei) </li><li>  Bluetooth </li><li>  Android </li><li>  Herkömmliche Drähte </li></ol><br><h2>  Designbasis </h2><br>  Der Lego Outdoor Challenger wurde als Basis genommen (in Wirklichkeit sieht er weniger erbärmlich aus).  Alles, was von ihr übrig bleibt: der Koffer (alle Dekorationselemente werden entfernt) und drei Motoren. <br><img src="https://habrastorage.org/webt/5u/w0/8p/5uw08p_lewnr1zi49vaufwll86s.jpeg" alt="Bild"><br>  Die Maschine hatte ein eigenes Board, aber eine der Aufgaben implizierte Universalität: Ich habe es getan, andere können es wiederholen.  Er holte das Gehirn heraus und setzte den Arduino Uno ein. <br><br><h2>  Arduino Installation </h2><br>  Aus irgendeinem Grund stellten die Schöpfer dem Arduino keinen Platz zur Verfügung, deshalb befestigten sie ihn durch Bohren von Kunststoff an den Schrauben.  Er legte Sperrholz unter das Brett, damit nichts kurzgeschlossen wurde.  Es ist besser, etwas Plastik unter die Schrauben (ein Stück Flasche) zu schieben, da die Platte nicht vor Eisenbolzen geschützt ist. <br><br><img src="https://habrastorage.org/webt/-z/qx/o4/-zqxo4riolp63sjxmvgkhuusejm.png"><br><br>  Oben auf dem Brett habe ich sofort zwei Motorscheiben angebracht, also sei es.  Um den zweiten zu steuern, müssen Sie einen Draht von einem beliebigen digitalen Anschluss nach H1 (Richtung) und den zweiten von einem Stift mit einer Unterlegscheibe (gekennzeichnet mit einem „~“, normalerweise 10, 11) nach E1 (Geschwindigkeit) werfen. <br><br><img src="https://habrastorage.org/webt/ud/it/js/uditjsgup1hjr2yxejhphyk0zbq.png"><br><br><h2>  Bestimmung des Drehwinkels </h2><br>  Es ist überraschenderweise nicht der Servoantrieb, der auf die Drehung der Maschine reagiert, sondern der gewöhnliche Motor.  Es gibt ein Problem: Es wäre schön, es nicht zu verbrennen, da der Drehwinkel begrenzt ist und der Motor so viel drehen kann, wie Sie möchten. <br><br>  Die Option mit der Poke-Methode verschwindet, da sich bei einem anderen Batteriestand die dem Motor zugeführte Strommenge ändert, was zu einem sich ständig ändernden Winkel führt.  Es ist auch unmöglich, bis zum Anschlag zu drehen, früher oder später bröckeln die Zahnräder. <br><br>  Lösung: Verfolgen Sie den Winkel durch die Schaltung.  Das Foto zeigt ein kleines Ding, das in der Nähe des Drehmechanismus montiert ist.  An dem Teil, der sich mit den Rädern vom Motor nach links / rechts dreht, ist eine Jakobsmuschel mit Eisenkontakten angebracht. <br><br><img src="https://habrastorage.org/webt/4p/9c/yi/4p9cyiwd7tppugbduc7wrq-dejq.jpeg"><br><br><img src="https://habrastorage.org/webt/7t/sd/bj/7tsdbjwklwcsckcbuvjxkx_am0k.jpeg"><br><br>  Funktionsprinzip: An jede Leitung wird ein Draht gelötet (es gibt insgesamt vier), der Boden ist mit dem Plus verbunden (es wird immer mit einem Kamm geklemmt, siehe Bild), die restlichen Drähte gehen auf Minus.  Wenn der Jakobsmuschelzahn in die unterste Reihe fällt und beispielsweise in der dritten Reihe ein Kurzschluss auftritt und Strom fließt, wird dies von Arduino bemerkt. <br><br><img src="https://habrastorage.org/webt/fs/6-/br/fs6-br5cafv3h0zuhu8veydvb-w.jpeg"><br><br>  Dank der verschiedenen Kombinationen der drei Bänder können bis zu sieben Winkel definiert werden.  Wenn beispielsweise auf allen Leitungen Strom vorhanden ist, werden die Räder ganz nach rechts gedreht. Wenn nur oben Strom vorhanden ist, werden die Räder so weit wie möglich nach links gedreht.  Die Tabelle enthält alle Optionen. <br><br><img src="https://habrastorage.org/webt/zm/58/p0/zm58p0a4lopofcg4q64biku9qss.png"><br><br><h2>  Verbindungswinkel und Code </h2><br>  Jede Farbe hat ihre eigene Farbe: Die Unterseite ist grün, die erste unten ist rot, die zweite ist schwarz und die dritte ist weiß.  In der Anfangsphase wurden Steckbrett und LEDs zum visuellen Debuggen verwendet. <br><br><img src="https://habrastorage.org/webt/bp/40/7m/bp407mzavfdtrovvmbage4rwhus.jpeg"><br><br>  Das Anschlussdiagramm ist in der Abbildung dargestellt.  Außerdem ziehen wir zu Grün, die anderen strecken wir zu Minus.  Schließen Sie die Drähte über den installierten Widerstand an die Ausgänge A0-A2 an, um Störungen und das Fehlen von Kurzschlüssen zu vermeiden.  Sie werden einfach aus dem Speichern anderer Ports ausgewählt. <br><br><img src="https://habrastorage.org/webt/ud/it/js/uditjsgup1hjr2yxejhphyk0zbq.png"><br><br>  Der Code wird mit Kommentaren angegeben.  Wir verbinden Pins und fragen sie über digitarRead () ab.  Wenn Spannung anliegt, wird true zurückgegeben.  Als nächstes schauen wir, ob das Ergebnis bedeutet, dass sich die Räder in extremen Positionen befinden. Wir verbieten eine weitere Drehung in diese Richtung. <br><br>  Ein kleiner Trick: Da in Zukunft Ausgänge mit 5 V und 3,3 V benötigt werden, können Sie einen Pluspunkt auf einen der digitalen Pins setzen.  Geben Sie vor jeder Winkelprüfung einen Strom durch digitalWrite (whitePin), überprüfen Sie dann den Winkel und entfernen Sie den Strom. <br><br><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">int</span></span> speedTurn = <span class="hljs-number"><span class="hljs-number">180</span></span>; // ,  <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">255</span></span> //    <span class="hljs-type"><span class="hljs-type">int</span></span> pinRed = A0; <span class="hljs-type"><span class="hljs-type">int</span></span> pinWhite = A1; <span class="hljs-type"><span class="hljs-type">int</span></span> pinBlack = A2; <span class="hljs-type"><span class="hljs-type">int</span></span> pinAngleStop = <span class="hljs-number"><span class="hljs-number">12</span></span>; //   ,    ,  //   <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { //    pinMode(pinRed, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinBlack, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(pinWhite, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); // pinMode(pinAngleStop, OUTPUT); //  ,    pinMode(angleDirection, OUTPUT); pinMode(angleSpeed, OUTPUT); <span class="hljs-type"><span class="hljs-type">Serial</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">begin</span></span>(<span class="hljs-number"><span class="hljs-number">9600</span></span>); } //   <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>(),      <span class="hljs-type"><span class="hljs-type">void</span></span> turn(<span class="hljs-type"><span class="hljs-type">int</span></span> angle) { digitalWrite(pinAngleStop, HIGH); //   ,    delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); // ,   ""  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(angle &gt; <span class="hljs-number"><span class="hljs-number">149</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( digitalRead(pinWhite) == HIGH &amp;&amp; digitalRead(pinBlack) == LOW &amp;&amp; digitalRead(pinBlack) == LOW) { //    ,      ,   //  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //   ,  digitalWrite(angleDirection, HIGH); analogWrite(angleSpeed, speedTurn); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (angle &lt; <span class="hljs-number"><span class="hljs-number">31</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(digitalRead(pinRed) == HIGH &amp;&amp; digitalRead(pinBlack) == HIGH &amp;&amp; digitalRead(pinWhite) == HIGH) { //    ,      ,   //  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } //   ,  digitalWrite(angleDirection, LOW); analogWrite(angleSpeed, speedTurn); } digitalWrite(pinAngleStop, LOW); //     delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); }</code> </pre> <br><h2>  Parallelisierung von Laufrädern </h2><br>  Zunächst sind zwei Antriebsmotoren miteinander verbunden.  Sie wurden aus zwei Gründen getrennt: Eine Drehung ist effektiver, wenn die Räder in verschiedene Richtungen durchdrehen und zwei leistungsstarke Motoren nicht an einem Brett ziehen. <br><br>  Problem: Die Motorabschirmung hat zwei Ausgänge, von denen jeder bis zu 2 Ampere erzeugt.  Jeder Motor frisst 0,7A.  Es scheint weniger, aber nicht bei maximaler Belastung.  Nehmen wir an, die Maschine steckt im Sand oder ruht sich aus, der Strom steigt über das Ampere.  Nicht kritisch, aber potenziell gefährlich. <br><br>  Es stellte sich jedoch als kritisch heraus, dass sich das Board erwärmt.  Minuten und eine halbe Stunde nach dem Rennen erwärmte sich das Motorschild und begann hässlich zu arbeiten: Die Ströme wurden nicht richtig zugeführt, die Räder drehten nicht und so weiter. <br><br>  Die Lösung für beide Probleme: Ein Motor ist mit einem Motorschild verbunden, der zweite mit dem anderen.  Seltsamerweise hat es geholfen.  Die Temperatur ist gesunken, es gibt keine Überhitzung.  Sie könnten einen Kühler einsetzen, aber die Montage ist schwierig. <br><br><img src="https://habrastorage.org/webt/qp/ty/zd/qptyzd9l9hs1icacrd2m1oetyiq.png"><br><br><h2>  Bluetooth-Verbindung </h2><br>  Ich habe das Modell HC-05 verwendet, das einen fatalen Witz spielte.  Alle Bluetooth-Geräte sind auf die gleiche Weise verbunden: Ein Kabel mit 3,3 V (manchmal begann es erst ab 5 V zu arbeiten), das zweite mit Minus, zwei weitere an Port 0 und 1 (Lesen bzw. Senden).  Ein von RXD auf Bluetooth signiertes Kabel steckt in TXD Arduino und TXD in RXD fest (wenn Sie es verwechseln, werden die Daten nicht angezeigt). <br><br>  Es gibt eine Einschränkung: Die Ports 0 und 1 werden standardmäßig von Serial verwendet, wodurch die Skizze überflutet wird.  Das heißt, während das Bluetooth nicht funktioniert, wird die Skizze nicht überflutet.  Es gibt zwei Möglichkeiten: Nehmen Sie das Bluetooth für die Zeit des Füllens heraus oder weisen Sie die Ein- und Ausgänge des Bluetooth neu zu.  Die zweite Option wird in zwei Zeilen ausgeführt. <br><br><pre> <code class="hljs cpp"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;SoftwareSerial.h&gt; \\  SoftwareSerial BTSerial(8, 9); \\ 8  9   0  1</span></span></span></span></code> </pre> <br>  Die Falle, die mich drei Arbeitstage lang aufgefressen hat, ist die Geschwindigkeit der Kommunikation.  Aus Gewohnheit habe ich 9600 installiert und es versucht.  Entweder kamen die Daten nicht, dann gab es ein Durcheinander von Charakteren.  Und am Ende lautet die Antwort, dass der HC-05 auf 38400 kommuniziert!  Achten Sie genau darauf, dass ich in Setup () BTSerial.begin (39400) ausführen werde, obwohl Serial.begin (9600). <br><br><h2>  Befehlssendesystem </h2><br>  Der Artikel wird zu lang, daher werde ich die Betrachtung des Arduino- und Android-Codes in einem separaten zweiten Teil herausnehmen und nun das Prinzip beschreiben. <br><br>  Auf dem Android-Gerät befindet sich ein Joystick (ein Kreis, dessen Implementierung sich ebenfalls im zweiten Teil befindet).  Android liest die Messwerte daraus und wandelt sie in für Arduino geeignete Zahlen um: Die Geschwindigkeit von Pixeln wird zu einem Wert von -255 bis 255 (negativ - umgekehrt) und bestimmt auch den Winkel.  Ich habe diese Aufgabe bewusst dem Telefon übertragen, da es viel leistungsfähiger ist und die Berechnung von mehreren hundert Werten pro Sekunde ruhig bewältigen kann. <br><br><img src="https://habrastorage.org/webt/gc/sz/op/gcszopqgz0xeruzdui4zlntrtnu.jpeg"><br><br>  Nach der Installation des Sockets werden die Daten im folgenden Format gesendet: @ speed # * angle #.  @ - zeigt an, dass die folgenden Ziffern die Geschwindigkeit enthalten, # - gibt das Ende des Geschwindigkeitswertes an, * - den Anfang des Winkelwerts, # - beendet die Aufzeichnung des Winkels.  Der Zyklus ist endlos, Befehle werden alle 100 Millisekunden gesendet (die optimale Anzahl wird ausgewählt).  Wenn auf dem Android nichts gedrückt wird, wird nichts gesendet. <br><br>  Der Datenempfangsalgorithmus ist im Skizzencode ausführlich beschrieben.  Er hat mehr als einmal korrespondiert und funktioniert für mich perfekt. <br><br><h2>  Abschluss des ersten Teils </h2><br>  In diesem Artikel habe ich versucht, alles offenzulegen, was sich auf den physischen Teil der Maschine bezieht.  Höchstwahrscheinlich habe ich etwas verpasst, also fragen Sie unbedingt. <br><br>  Aber das interessanteste, was mich betrifft, blieb für das zweite - das Arduino-Programm und die Android-Anwendung, dort ist echte Magie los, zumindest für das junge Ich. <br><br>  Wenn Sie die Antwort auf einen Teil nicht finden und mich persönlich in Mängel stürzen möchten, warte ich - dendolg1@mail.ru,. <br><br>  UPD: Der zweite Teil ist bereits erschienen - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">habr.com/post/424813</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de424087/">https://habr.com/ru/post/de424087/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de424073/index.html">Remotecodeausführung in Microsoft JET Database Engine</a></li>
<li><a href="../de424077/index.html">Frankreich fordert, das „Recht auf Vergessen“ global zu machen - was es beeinflussen kann</a></li>
<li><a href="../de424081/index.html">RESS - Neue Architektur für mobile Anwendungen</a></li>
<li><a href="../de424083/index.html">Einem Handelsdienst an der Robinhood-Börse wurde vorgeworfen, Daten zu Benutzeranwendungen an Hochfrequenzhändler verkauft zu haben</a></li>
<li><a href="../de424085/index.html">Wir entwickeln das NIOS II-Prozessormodul für IDA Pro</a></li>
<li><a href="../de424089/index.html">Konferenzen sind böse. Oder gut?</a></li>
<li><a href="../de424091/index.html">WiX.Py: Wir sammeln das MSI-Paket "in drei Zeilen"</a></li>
<li><a href="../de424093/index.html">Vom antiken Radio bis zum DIY-Lautsprecher: 12 YouTube-Kanäle für ein akustisches Gerät</a></li>
<li><a href="../de424099/index.html">Bestimmen der Reife einer Wassermelone mithilfe von Keras: ein vollständiger Zyklus von einer Idee bis zu einem Programm bei Google Play</a></li>
<li><a href="../de424103/index.html">Silicon Valley ist seit den 1970er Jahren für seine Mitarbeiter „unverzeihlich“</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>