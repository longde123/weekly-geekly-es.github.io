<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèæ‚Äç‚öïÔ∏è üò• üëßüèø Int√©gration de code et danger de logiciels pirat√©s üí™ üÉè üò¥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Ä propos de la fa√ßon dont vous pouvez incorporer du code sans jmp dans la section de code et rester invisible si vous n'√©tudiez pas le code compl√®teme...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Int√©gration de code et danger de logiciels pirat√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/477590/"> √Ä propos de la fa√ßon dont vous pouvez incorporer du code sans jmp dans la section de code et rester invisible si vous n'√©tudiez pas le code compl√®tement d√©mont√©.  Peu importe, s'il vous pla√Æt, sous le chat. <br><a name="habracut"></a><br>  Je d√©veloppe un d√©sassembleur C pour Linux.  √Ä propos de moi, je ne dirais pas que je suis un programmeur professionnel.  Je ne travaille pas en tant que programmeur, mais ce que j'ai appris c'est soit en lisant des livres, soit en l'inventant moi-m√™me, soit en √©tudiant le code source d'autres programmes.  Par cons√©quent, si le code vous semble enfantin, ne jurez pas. <br><br>  Pour commencer, j'ai fait un d√©sassembleur et mon code ressemble maintenant √† ceci, c'est-√†-dire qu'un octet est lu et pass√© √† la fonction souhait√©e. <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disasm_intel</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ptr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> size, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> byte_order, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> show )</span></span></span><span class="hljs-function"> </span></span>{ show_asm = show; virt = global_virt_text; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *start = ptr; start_op = ptr; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; size; index++ ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( show_asm == TRUE ) <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span> ( <span class="hljs-string"><span class="hljs-string">"%lx: "</span></span>, virt ); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ( *ptr ) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x30</span></span>: intel_opcode_1_0x30 ( &amp;ptr, &amp;index, byte_order ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x31</span></span>: intel_opcode_1_0x31 ( &amp;ptr, &amp;index, byte_order ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x66</span></span>: intel_opcode_1_0x66 ( &amp;ptr, &amp;index, byte_order ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x67</span></span>: intel_opcode_1_0x67 ( &amp;ptr, &amp;index, byte_order ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x83</span></span>: intel_opcode_1_0x83 ( &amp;ptr, &amp;index, byte_order ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x88</span></span>: intel_opcode_1_0x88 ( &amp;ptr, &amp;index, byte_order ); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">// mov register to register byte case 0x89: intel_opcode_1_0x89 ( &amp;ptr, &amp;index, byte_order ); break; case 0x8a: intel_opcode_1_0x8a ( &amp;ptr, &amp;index, byte_order ); break; case 0x8b: intel_opcode_1_0x8b ( &amp;ptr, &amp;index, byte_order ); break; // mov esp, %x : mov ebp, %x case 0x8d: intel_opcode_1_0x8d ( &amp;ptr, &amp;index, byte_order ); break; // lea case 0xb0: intel_opcode_1_0xb0 ( &amp;ptr, &amp;index ); break; // mov al, %x case 0xb1: intel_opcode_1_0xb1 ( &amp;ptr, &amp;index ); break; // mov cl, %x case 0xb2: intel_opcode_1_0xb2 ( &amp;ptr, &amp;index ); break; // mov dl, %x case 0xb3: intel_opcode_1_0xb3 ( &amp;ptr, &amp;index ); break; // mov bl, %x case 0xb4: intel_opcode_1_0xb4 ( &amp;ptr, &amp;index ); break; // mov ah, %x case 0xb5: intel_opcode_1_0xb5 ( &amp;ptr, &amp;index ); break; // mov ch, %x case 0xb6: intel_opcode_1_0xb6 ( &amp;ptr, &amp;index ); break; // mov dh, %x case 0xb7: intel_opcode_1_0xb7 ( &amp;ptr, &amp;index ); break; // mov bh, %x case 0xb8: intel_opcode_1_0xb8 ( &amp;ptr, &amp;index, byte_order ); break; // mov eax, %x case 0xb9: intel_opcode_1_0xb9 ( &amp;ptr, &amp;index, byte_order ); break; // mov ecx, %x case 0xba: intel_opcode_1_0xba ( &amp;ptr, &amp;index, byte_order ); break; // mov edx, %x case 0xbb: intel_opcode_1_0xbb ( &amp;ptr, &amp;index, byte_order ); break; // mov ebx, %x case 0xbe: intel_opcode_1_0xbe ( &amp;ptr, &amp;index, byte_order ); break; // mov esi, %x case 0xbf: intel_opcode_1_0xbf ( &amp;ptr, &amp;index, byte_order ); break; // mov edi, %x case 0xc3: intel_opcode_1_0xc3 ( ); break; // ret case 0xcd: intel_opcode_1_0xcd ( &amp;ptr, &amp;index ); break; // int 0x%x } ptr++; virt += ptr - start; start = ptr; start_op = ptr; } show_asm = FALSE; }</span></span></code> </pre> <br>  Et ces fonctions sont d√©j√† un tas.  √Ä certains endroits, j'ai fait des commentaires afin de rattraper l'interconnexion des instructions de la machine, et peut-√™tre plus tard de faire un d√©monteur plus comp√©tent.  Mais sous cette forme, dans laquelle j'ai maintenant le code, je peux facilement d√©finir toutes les conditions pour chaque op√©rateur. <br><br>  Et donc pendant que je faisais cela, j'ai eu une id√©e, est-il possible d'ajouter du code au milieu de la section de code?  Il s'av√®re que vous le pouvez, mais dans tous les cas?  Jusqu'√† pr√©sent, pour ajouter du code, j'utilise des codes machine d√©j√† pr√©par√©s.  Si je peux plus tard, je ferai du traducteur assembleur en code machine pour ajouter du code √©tait plus pratique.  Dans mon cas, vous devez sp√©cifier le d√©calage dans la section de code et les octets sont copi√©s au bon endroit.  Il y avait aussi un certain probl√®me: l'adressage en m√©moire.  J'ai ajout√© un code √† la commande lea qui enregistre les donn√©es n√©cessaires dans la structure, et si vous ins√©rez de nouveaux op√©rateurs dans la section de code, tous les d√©calages sont align√©s de mani√®re √† indiquer les donn√©es lors des nouveaux d√©calages.  Eh bien, ce n'est pas tr√®s difficile, si vous ins√©rez le code, la section de code augment√©e du m√™me nombre d'octets et toutes les autres sections apr√®s que la section de code contiendra d√©j√† de nouveaux d√©calages.  Je l'ai fait pour qu'il y ait des diff√©rences dans l'endroit o√π vous collez le code, tous les d√©calages fonctionnent correctement.  Ensuite, le probl√®me a surgi <br><br><pre> <code class="cpp hljs">mov eax, [eax + eax + <span class="hljs-number"><span class="hljs-number">0x100</span></span>]</code> </pre> <br>  Le fait est que dans un tel adressage, il peut y avoir ebp et pointer vers la pile, et non vers une autre section.  J'ai d√©cid√© de faire en sorte que si l'adresse pointe vers la section de donn√©es, alors consid√©rez les d√©calages lors de l'insertion du code, si elle pointe vers la pile, c'est-√†-dire pas l'adresse dans la section de donn√©es, alors ne prenez pas en compte les d√©calages. <br><br>  Et de cette fa√ßon, les attaquants peuvent en profiter.  Apr√®s tout, un code malveillant peut √™tre ins√©r√© au d√©but d'une fonction dans le programme, par exemple, afin qu'un enfant fork soit cr√©√© et qu'un fichier sp√©cial soit t√©l√©charg√©.  Sous Linux, cela peut se faire sans aucun probl√®me.  En effet, dans / usr / include il y a un fichier avec toutes les fonctions syst√®me du syst√®me d'exploitation.  Autrement dit, vous pouvez utiliser la partie r√©seau, m√™me si le programme n'a pas de fonctions r√©seau.  Je ne sais pas comment dans Windows, mais je vais essayer d'ajouter du travail avec le format pe plus tard.  Il peut s'av√©rer faire la m√™me chose que sous Linux.  Jusqu'√† pr√©sent, j'ai une version console.  Mais alors je pr√©vois de faire sur gtk. <br><br>  Merci d'avoir consacr√© votre temps √† mon article. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477590/">https://habr.com/ru/post/fr477590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477566/index.html">Huawei Cloud: il fait nuageux dans PVS-Studio aujourd'hui</a></li>
<li><a href="../fr477568/index.html">Le service est un retour inconditionnel facile. Poste russe</a></li>
<li><a href="../fr477578/index.html">Comment choisir un langage de programmation pour cr√©er une application Android</a></li>
<li><a href="../fr477580/index.html">Meilleurs cadres PHP pour le d√©veloppement Web</a></li>
<li><a href="../fr477584/index.html">Classique intemporel: ce que les jeux d'action modernes devraient apprendre de DOOM</a></li>
<li><a href="../fr477596/index.html">Museum DataArt: des ordinateurs industriels de destination connue et inconnue</a></li>
<li><a href="../fr477598/index.html">Vous aimez lire avec vos oreilles? R√©flexions sur l'avenir d'ITSumma Press</a></li>
<li><a href="../fr477602/index.html">Du Web √† l'application dans un seul DeepLink</a></li>
<li><a href="../fr477606/index.html">Lecture pour un homme audio: vieux fer, formats r√©tro, ¬´brillance et pauvret√©¬ª dans l'industrie musicale</a></li>
<li><a href="../fr477610/index.html">√âcrivains, pirates et piastres</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>