<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🎤 😥 🗾 Binary format reverse engineering menggunakan Korg .SNG file sebagai contoh 🛳️ 🌨️ 🛤️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kita hidup di masa yang menakjubkan. Di sekitar kita terdapat banyak teknologi: telepon, komputer, jam tangan pintar, dan gadget lainnya. Setiap hari,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Binary format reverse engineering menggunakan Korg .SNG file sebagai contoh</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/442580/"><img src="https://habrastorage.org/webt/ve/-p/e3/ve-pe3tgqlv4dwca26xozjh6t2s.jpeg"><br><br>  Kita hidup di masa yang menakjubkan.  Di sekitar kita terdapat banyak teknologi: telepon, komputer, jam tangan pintar, dan gadget lainnya.  Setiap hari, pabrikan merilis lebih banyak perangkat ke pasar.  Kebanyakan dari mereka ditakdirkan untuk hidup yang pendek dan cerah (atau tidak begitu): perusahaan pemasaran yang kuat pada saat rilis, 1-2 tahun dukungan penuh oleh produsen, dan kemudian lambat terlupakan.  Perangkat sederhana dapat bekerja selama bertahun-tahun setelah berakhirnya periode dukungan resmi.  Dengan perangkat pintar, semakin sulit.  Ada baiknya jika gadget setidaknya terus berfungsi setelah memutuskan hubungan server / layanan pabrikan.  Dan beruntung jika pembaruan OS, driver atau perangkat lunak lain berikutnya tidak mengalahkan kompatibilitas. <br><a name="habracut"></a><br>  Sayangnya, peristiwa semakin berkembang sesuai dengan skenario pesimistis.  Dan 5-10 tahun setelah pembelian, kami memiliki perangkat suara teknis di tangan kami, yang bagaimanapun tidak dapat digunakan karena kurangnya dukungan perangkat lunak.  Tentu saja, gadget yang rusak tidak menyenangkan.  Tetapi jauh lebih tidak menyenangkan jika ada data pengguna dalam format yang tidak kompatibel dengan apa pun.  Data ini dapat dianggap hilang jika perangkat berhenti berfungsi.  Dalam kasus saya, yang terburuk belum terjadi, tetapi bel alarm sudah berdering. <br><br>  Jadi, ada perusahaan terkenal Korg, yang memproduksi peralatan musik yang sangat berkualitas tinggi.  Pada 2010, saya membeli synthesizer dari perusahaan ini untuk berlatih musik sebagai hobi.  Korg microstation adalah model yang cukup canggih.  Antara lain, ia memiliki sequencer on board untuk merekam treknya dan dapat menulis data ke kartu memori dalam format SNG yang dipatenkan.  Dimungkinkan untuk mengekspor ke format midi yang umum, tetapi hampir semua metadata hilang: informasi tentang efek dan filter yang dilapiskan, berbagai pengaturan instrumen virtual, dll.  Masalah utama bagi saya pribadi adalah kecepatan transisi untuk merekam ide-ide musik.  Muse adalah ciptaan yang aneh, dan sebagian besar waktu saya menemukan ide yang menarik hanya dengan berimprovisasi atau memainkan sesuatu yang tidak rumit.  Semakin cepat saya menekan tombol rekam tanpa berkeliaran di sekitar menu, semakin besar kemungkinan saya dapat mengulangi dan merekam fragmen yang menarik, yang di masa depan mungkin menjadi bagian dari pekerjaan yang lengkap.  Tentu saja, pendekatan ini tidak sempurna, tetapi kita berbicara tentang hobi.  Dengan satu atau lain cara, selama hampir sepuluh tahun, saya telah mengumpulkan sekitar seribu sketsa dan sketsa musik dalam format SNG. <br><br>  Bel berbunyi dalam bentuk serangkaian gangguan synthesizer, yang membutuhkan perangkat berkedip.  Dan saya berpikir untuk mengubah semua data yang terakumulasi ke dalam format Midi, terlebih lagi karena itu akan membuatnya lebih mudah untuk menyimpan, mengatur dan mengeditnya.  Pencarian konverter di Google tidak memberikan apa-apa.  Ada banyak permintaan di semua jenis forum, sejarah telah berlangsung selama 20 tahun, jika tidak lebih.  Yang saya temukan hanyalah utilitas Windows kuno milik orang lain, secara alami tidak kompatibel dengan file saya. <br><br>  Dan kemudian saya memutuskan untuk mencoba melihat apa sebenarnya format SNG ini?  Mungkin di suatu tempat di dalam sana ada data MIDI normal yang dapat Anda tarik dan simpan dengan mudah? <br><br><h3>  Upaya untuk memecahkan masalah "dahi" </h3><br>  Jadi, dari instruksi untuk synthesizer, Anda dapat mengetahui bahwa format SNG adalah sebuah wadah di mana apa yang disebut "lagu" disimpan.  Setiap lagu berisi 16 trek sequencer dengan data musik, serta pengaturan untuk suara dan efek.  Saat mengekspor ke format Midi melalui menu synthesizer, setiap "lagu" diekspor ke file .MID yang terpisah, dan semua pengaturan untuk suara dan efek hilang.  Karena  Saya memutar ide saya dalam bentuk paling sederhana dan tanpa efek, masalahnya justru sejumlah besar file SNG dan ketidaknyamanan proses konversi manual.  Mari kita lihat apakah proses ini dapat dipercepat atau otomatis. <br><br>  Pertama, mari kita ingat apa itu data MIDI.  Sederhananya, ini adalah aliran acara musik: menekan dan melepaskan kunci, menekan dan melepaskan pedal penopang, mengubah tempo, patch (instrumen virtual) dan parameter lainnya.  Setiap acara berisi delta waktu dari saat acara dan data sebelumnya, misalnya, intensitas catatan dan nada.  Format file midi sangat sederhana: selain header dan data itu sendiri, praktis tidak ada apa-apa di sana. <br><img src="https://habrastorage.org/webt/va/4r/jr/va4rjrzdye1cuhhufe1j5nvfdqk.jpeg"><br>  <i>Pink adalah acara Note On.</i>  <i>Kuning pucat adalah delta waktu.</i>  <i>Biru - Acara Catatan Mati.</i> <br><br>  Mari kita coba mencari data midi kita di file SNG.  Untuk melakukan ini, tulis urutan beberapa catatan pada synthesizer dan ekspor ke kedua format.  Karena  Karena kami tidak tahu di mana tepatnya data musik berada dalam file biner, kami akan mencoba mengulangi proses dengan urutan catatan yang berbeda. <br><br>  Selanjutnya saya menggunakan Hex-editor Synalyze It!  Kemampuannya di masa depan akan sangat berguna bagi kita.  Sementara itu, cukup gunakan fungsi perbandingan biner. <br><img src="https://habrastorage.org/webt/ap/rc/um/aprcumsiubha7hfzvasa3cbsxd0.jpeg"><br>  Bahkan, hanya nama "lagu" yang bertepatan.  Membandingkan dua file SNG dengan urutan catatan yang berbeda, kita dapat kira-kira menebak di mana tepatnya data musik disimpan, tetapi untuk sekarang ini tidak akan membantu kita dengan cara apa pun - format data berbeda.  File itu sendiri sepuluh kali lebih besar daripada file Midi dan tampaknya mengandung banyak informasi tambahan.  Anda dapat melihat tanda tangan KORG dalam empat byte pertama dan beberapa baris lainnya, termasuk nama "lagu" dan nama tambalan (nada) yang ditetapkan untuk trek. <br><br><h3>  Parsing struktur blok data </h3><br>  Ini bisa diselesaikan jika, untungnya, tidak ada alat yang membuatnya relatif mudah untuk menganalisis dan memahami struktur data biner.  Program yang sama Synalaze It! Akan membantu kami dengan ini, yang memungkinkan Anda untuk membuat dan menerapkan "tata bahasa" untuk menganalisis file biner. <br><br>  Tata bahasa adalah struktur deskriptif hirarkis yang memungkinkan Anda untuk merepresentasikan data biner dalam bentuk yang dapat dibaca manusia.  Program ini memungkinkan Anda mengunduh tata bahasa untuk beberapa format.  Misalnya, untuk midi yang sama: <br><img src="https://habrastorage.org/webt/5j/fh/f1/5jfhf1mz0twm0_8pajoitnmcvxe.jpeg"><br>  Untuk format SNG, tidak ada tata bahasa siap pakai yang diharapkan.  Baiklah, mari kita lihat apa yang bisa kita ekstrak dari file kita sendiri. <br><br>  Mari kita mulai dengan judul.  Biasanya, bagian ini berisi tanda tangan file, informasi versi, ukuran dan offset blok data.  Setelah membandingkan beberapa file SNG yang berbeda, kami menemukan bagian-bagian yang tidak berubah-ubah dan lebih memperhatikan yang berubah <br><img src="https://habrastorage.org/webt/xp/dc/1i/xpdc1inosnksf1cl567lhuef62w.jpeg"><br>  Buat struktur judul di editor tata bahasa.  4 byte pertama jelas merupakan tanda tangan dari file tersebut.  Asumsikan 4 byte berikut ini versi.  Beberapa puluh byte berikutnya tidak berubah dan tidak mengandung sesuatu yang menarik - kami akan membuatkan mereka binaryData dengan ukuran yang sesuai.  Tapi kemudian kesenangan dimulai.  Anda dapat melihat beberapa pola dalam perilaku byte di offset 0x13 dan 0x1b.  Yang kedua tampaknya sesuai dengan jumlah "lagu" di file kami.  Dan yang pertama juga tumbuh dengan jumlah data di header - ini tampaknya menjadi ukuran, hanya hitungan mundur tidak datang dari awal file, tetapi dari byte berikutnya 0x14.  Pada tahap ini, kita hanya bisa menebak tentang jenis data numerik.  Misalkan ukurannya adalah tipe UInt32, mis.  membutuhkan 4 byte.  Tambahkan mereka ke struktur kita.  Sekarang kita dapat mengatur ukuran struktur header (ukuran + 20). <br><img src="https://habrastorage.org/webt/av/ad/kt/avadkttmovx2nj_aj1gqdlnvvsk.jpeg"><br><div class="spoiler">  <b class="spoiler_title">Tata bahasa dengan struktur tajuk file yang ditambahkan</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ol/xd/lw/olxdlwqbmnyjybfbcrsvujibxta.jpeg"><br></div></div><br>  Mari kita lihat apa yang terjadi selanjutnya.  Jika Anda melihat lebih dekat, Anda akan melihat bahwa singkatan tiga huruf tersebar di seluruh file: SNG1, SDK1, SGS1, dan sebagainya.  Karakter-karakter ini ditemukan di semua file SNG, jadi kita dapat mengasumsikan bahwa ini adalah tanda tangan dari blok tertentu.  Selain itu, judul kami berakhir dengan sangat sukses tepat sebelum salah satu dari tanda tangan ini.  Bandingkan perilaku 4 byte berikut dalam file dengan ukuran berbeda.  Dapat dilihat bahwa nilai meningkat dengan meningkatnya jumlah data. <br><img src="https://habrastorage.org/webt/kb/w-/4k/kbw-4kahz2btt_qwz-wd37pb-gu.jpeg"><br>  Beberapa percobaan, analisis, dan perhitungan lagi, dan gambar berikut mulai muncul: <br><br><img src="https://habrastorage.org/webt/ld/jn/iy/ldjniyrqi4s8a_n_unggs2-b0sq.jpeg"><br><br><div class="spoiler">  <b class="spoiler_title">Tampilan bagan alternatif</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/gj/tn/bv/gjtnbvwnqv4yr2nz0zdrl9irupg.jpeg"><br></div></div><br>  Dengan demikian, file kami terdiri dari hierarki blok yang cukup sederhana.  Ada blok induk yang dapat berisi beberapa blok anak.  Ada blok daun (dalam terminologi pohon biner) yang tidak mengandung blok lain. <br><br>  Kemudian keajaiban dimulai.  <b>Dengan hanya beberapa struktur tata bahasa, kita dapat sepenuhnya mem-parsing struktur file blok</b> <br><br>  Jadi, buat struktur template DataChunk dengan bidang-bidang berikut (ukurannya ditunjukkan dalam tanda kurung siku): <br><br>  id: String [4] <br>  ukuran: Int [4] <br>  hierarki: Int [4] <br>  data: struktur <br><br>  Sekarang buat struktur parentChunk yang mewarisi DataChunk.  Di properti hierarki, tentukan Nilai Tetap 0x400 - ini adalah tanda blok induk.  Pastikan untuk mencentang kotak Harus cocok. <br><br>  Demikian pula, buat childChunk.  Hierarki dalam kasus ini akan memiliki dua nilai: 0x240100 dan 0x100 <br><br>  Tambahkan referensi ke struktur parentChunk dan childChunk ke struktur data parentChunk - dengan cara ini kita membuat rekursi. <br><br>  Akhirnya, tambahkan referensi ke struktur parentChunk di simpul utama. <br><img src="https://habrastorage.org/webt/jj/d3/gq/jjd3gq-5q330yazk-6q8fl1naa8.jpeg"><br>  Urutan elemen dalam struktur data parentChunk harus Variabel, juga diharuskan untuk menetapkan jumlah minimum dan maksimum anak-anak dari struktur ini: 0 dan Tidak Terbatas, masing-masing. <br><br>  Mari kita terapkan perubahannya, dan voila - file kita diuraikan dengan baik ke dalam blok utama <br><img src="https://habrastorage.org/webt/ny/qx/pz/nyqxpztkqdknd1scoh63o28ezkq.jpeg"><br>  Kami masih belum tahu apa-apa tentang data itu sendiri, tetapi sekarang kami dapat lebih mudah menavigasi dalam file dan fokus pada menemukan informasi yang kami butuhkan. <br><br><h3>  Parsing blok yang berisi daftar isi file </h3><br>  Untuk pelatihan, mari kita coba menguraikan beberapa blok sederhana, misalnya, SDK1.  Rupanya, itu berisi sesuatu seperti daftar isi - daftar lagu dan mungkin beberapa offset / ukuran. <br><img src="https://habrastorage.org/webt/zr/-r/dq/zr-rdqiljqlnsflxebu5e2nx8q0.jpeg"><br>  Buat struktur sdk1Chunk yang mewarisi childChunk.  Kami akan mengedit bidang ID, yang menunjukkan tanda tangan dari blok kami di bidang Nilai Tetap.  Jangan lupa tentang kotak centang Harus cocok.  Dalam blok data, seseorang dapat mengamati pola berulang yang cukup jelas: nama "lagu" dan data yang sejauh ini tidak diketahui.  Perhatikan bahwa ukuran fragmen berulang adalah 64 byte.  Juga, membandingkan versi file dengan jumlah "lagu" yang berbeda, Anda dapat menentukan bahwa nomor tersebut disimpan dalam empat byte pertama.  Dengan menggunakan perhitungan sederhana dan membuat beberapa asumsi, kami mendapatkan versi struktur berikut dalam tata bahasa: <br><img src="https://habrastorage.org/webt/oo/mh/p3/oomhp3mjkz5pymbcxksszwdrn8w.jpeg"><br>  Di sini saya membuat struktur anak songInfo 64 byte dan menunjukkan kemampuan untuk mengulangi jumlah kali.  Berikut adalah hasil penerapan tata bahasa: <br><img src="https://habrastorage.org/webt/0w/bi/th/0wbithoju1jbjec30hjxmo7tiwu.jpeg"><br>  Analisis file lebih lanjut tetap menjadi masalah teknis.  Saya mengubah pengaturan umum "lagu" dan parameter masing-masing trek pada synthesizer.  Dengan membandingkan versi file dengan berbagai perubahan, Anda dapat meningkatkan dan memperbaiki tata bahasa.  Setelah jumlah iterasi yang cukup besar, hampir tidak ada bagian data yang tidak dikenal dalam file.  Saya agak terbawa oleh proses dan memilah-milah hampir semua bagian file, meskipun ini tidak diperlukan untuk tugas asli. <br><br><div class="spoiler">  <b class="spoiler_title">Sebagian kecil tata bahasa file SNG setelah 8 jam penguraian</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/td/zt/2b/tdzt2btswihzm3dxjubmbztvaa0.jpeg"><br></div></div><br>  Saya akan melewatkan detail dari proses ini - di masa depan kita akan fokus pada analisis data musikal secara langsung. <br><br>  Tetapi lebih lanjut tentang itu di bagian selanjutnya.  Di sana kita akan menghadapi tugas konversi data yang menarik (sangat cocok untuk wawancara), kami akan mencoba menyelesaikannya dengan skrip kecil dan kami akan mendengar hasil konversi tes yang agak tidak biasa. <br><br><h3>  Hasil Awal </h3><br>  Kebutuhan untuk membalikkan file biner dapat terjadi secara tak terduga.  Misalnya, untuk menganalisis firmware perangkat, mengonversi dari format data langka, menganalisis ancaman digital, atau bahkan mengubah secara sepintas game save.  Alat modern memungkinkan Anda untuk memecahkan masalah ini dengan cepat dan efisien.  Sekitar 10 tahun yang lalu, saya sedang meneliti firmware laptop dan proses ini bisa memakan waktu beberapa minggu.  Kemudian diminta untuk menulis skrip secara manual untuk menganalisis blok data dan menyusun struktur.  Dengan pendekatan parsial otomatis baru, saya membuat tata bahasa file yang hampir lengkap hanya dalam beberapa hari. <br><br>  Anda dapat memulai analisis file biner dengan mencari string - mereka dapat memberikan petunjuk pertama dan mempercepat proses analisis.  Seringkali file biner terdiri dari blok data yang disusun dalam struktur hierarkis atau linier.  Jika Anda berurusan dengan struktur ini, maka analisis lebih lanjut akan jauh lebih mudah.  Header file dapat memberikan petunjuk tentang offset / ukuran blok data.  Pada tahap pertama, masuk akal untuk fokus pada deskripsi struktur dan balok yang jelas.  Tugas analisis sangat disederhanakan oleh kemampuan untuk membuat versi baru file dengan pengaturan, parameter, data yang berbeda.  Ada sejumlah kesulitan yang terkait dengan tipe data yang tidak diketahui dan urutan byte dalam representasi biner mereka (Endianness).  Kami akan menyentuh pertanyaan-pertanyaan ini di bagian selanjutnya. <br><br><h3>  Bacaan yang Disarankan </h3><br>  Andreas Pehnack.  Cara Pendekatan Analisis Format File Biner </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id442580/">https://habr.com/ru/post/id442580/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id442570/index.html">Aturan Sigma. Kerajinan atau standar baru untuk SOC</a></li>
<li><a href="../id442572/index.html">Menggunakan Alat Konfigurasi Datapath</a></li>
<li><a href="../id442574/index.html">Dasar untuk teori umum jaringan saraf dibuat</a></li>
<li><a href="../id442576/index.html">Overclocker lama: bagaimana cairan pendingin mulai mendominasi di pusat data</a></li>
<li><a href="../id442578/index.html">Linux 5.0 rilis</a></li>
<li><a href="../id442582/index.html">Bagaimana kami mencoba mobbing</a></li>
<li><a href="../id442584/index.html">Dokumen di gedung: sedikit kegembiraan otomatisasi pada contoh Menara Kegelapan</a></li>
<li><a href="../id442586/index.html">Kerentanan dalam Telegram memungkinkan untuk mem-bypass kata sandi kode lokal dengan panjang berapa pun</a></li>
<li><a href="../id442588/index.html">Ajukan pertanyaan kepada penulis Lua</a></li>
<li><a href="../id442590/index.html">Tip & Trik Forensik Digital: Cara Menemukan Koneksi VPN Aktif di Memory Dump</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>