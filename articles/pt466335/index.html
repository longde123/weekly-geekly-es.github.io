<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíñ üßñüèº ‚òîÔ∏è Criando um aplicativo Slack usando os recursos do 8base üë®üèø üò° üë®‚Äçüíº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O Slack √© um √≥timo aplicativo para comunica√ß√£o interna entre equipes. Um dos recursos que podemos expandi-lo facilmente, criando e integrando bots de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Criando um aplicativo Slack usando os recursos do 8base</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466335/"><img src="https://habrastorage.org/getpro/habr/post_images/ee8/574/873/ee8574873908032aed87f5703682d618.png" alt="imagem"><br><br>  O Slack √© um √≥timo aplicativo para comunica√ß√£o interna entre equipes.  Um dos recursos que podemos expandi-lo facilmente, criando e integrando bots de bate-papo e comandos de barra que permitem aos usu√°rios interagir com servi√ßos externos.  Um excelente bot do Slack, muito popular e √∫til, √© o bot do GitHub, que publica atualiza√ß√µes sobre solicita√ß√µes de recebimento, confirma√ß√µes e ish no canal. <br><br>  Neste artigo, criaremos um bot do Slack que publica atualiza√ß√µes ao criar um pedido na plataforma de com√©rcio eletr√¥nico inventada que gerenciamos. <br><br>  A plataforma de com√©rcio eletr√¥nico √© um aplicativo sem servidor criado usando o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">8base</a> .  Neste artigo, usaremos as fun√ß√µes do 8base para escutar os eventos Create em um modelo de dados usando gatilhos. <br><br>  Um acionador √© um tipo de fun√ß√£o que √© acionada em resposta a um evento de muta√ß√£o de dados: <i>criando</i> , <i>atualizando</i> ou excluindo um objeto.  O 8base fornece dois tipos de gatilhos, dependendo se o desenvolvedor deseja executar a fun√ß√£o antes ou depois de alterar os dados: trigger.before e trigger.after. <br><br><h4>  Voc√™ vai precisar </h4><br><ul><li>  Compreens√£o b√°sica de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">React</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Node.js.</a>  Antes de come√ßar, verifique se voc√™ tem o Node e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">npm</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">yarn instalados</a> . </li><li>  Usaremos algumas consultas do GraphQL no projeto, portanto a familiaridade com o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GraphQL √© √∫til</a> . </li><li>  Crie uma conta na 8base (se ainda n√£o o fez) visitando o <a href="http://">site</a> deles. </li></ul><br><h3>  Preparando o ambiente 8base </h3><br>  Crie uma conta ou fa√ßa login na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=https://auth.8base.com/login%3Fstate%3Dg6Fo2SBpTkZiUGl6QXJ5VFVkZS16U09yanNQU3dxNlJlQlV2NqN0aWTZIC04bGxiaENJU05ha0MzVUduT2ZuU19senhlbE5VN1l1o2NpZNkgcUdIWlZ1NUN4WTVrbGl2bTI4T1BMam9wdnNZcDBiYUQ%26client%3DqGHZVu5CxY5klivm28OPLjopvsYp0baD%26protocol%3Doauth2%26response_type%3Dtoken%2520id_token%26redirect_uri%3D">8base</a> .  Para novas contas, o 8base fornece acesso gratuito por 30 dias. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/064/449/5e8/0644495e868a6e3b11bf27df93d61080.png" alt="imagem"><br>  ¬ß 2  Ap√≥s o login, v√° para a p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dados</a> e clique em "Nova tabela" para come√ßar a configurar o back-end. <br><img src="https://habrastorage.org/getpro/habr/post_images/011/8e4/ce6/0118e4ce63f1da4bc98b872b1e76a260.png" alt="imagem"><br>  ‚Äç3  Ap√≥s carregar uma nova tabela, voc√™ ver√° um diagrama e poder√° come√ßar a definir os campos.  Em seguida, crie uma tabela chamada Pedidos, consistindo nos seguintes campos: <br>  - <b>usu√°rio</b> : o tipo de campo √© tabela.  Na se√ß√£o direita, selecione a tabela Usu√°rios e, no campo Nome do campo de rela√ß√£o, especifique "pedidos".  Em seguida, marque a caixa "Permitir v√°rios <b>pedidos</b> por <b>usu√°rio</b> ". <br><img src="https://habrastorage.org/getpro/habr/post_images/64f/24f/8d0/64f24f8d0f5f626c397708980ef822ea.png" alt="imagem"><br>  - items: o tipo de campo √© JSON.  Este campo cont√©m informa√ß√µes sobre os produtos que o usu√°rio compra, por exemplo, pre√ßo, nome e imagem. <br>  Nosso esquema √© bastante simples e deve abranger as fun√ß√µes necess√°rias.  Em seguida, vamos configurar o Slack App e instal√°-lo. <br><br><h3>  Criar um aplicativo Slack </h3><br>  Comece fazendo login no Slack ou crie um novo para este guia.  Visite o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Slack API Console</a> para criar um novo aplicativo Slack. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/870/fb8/956/870fb8956f2b3b4dabceadf602df6d0d.png" alt="imagem"><br><br>  Chame este aplicativo Slack ap√≥s a nossa plataforma fict√≠cia de com√©rcio eletr√¥nico chamada <b>Shop Quick</b> . <br><br>  Depois de criarmos o aplicativo em nosso workshop, podemos adiar temporariamente o aplicativo Slack e trabalhar na cria√ß√£o da fun√ß√£o 8base, que ouvir√° os eventos de cria√ß√£o de novos pedidos na plataforma <b>Shop Quick</b> . <br><br><h4>  Criar uma fun√ß√£o 8base </h4><br>  A plataforma 8base oferece recursos que facilitam a cria√ß√£o de aplicativos sem servidor.  Para este aplicativo Slack, precisamos de l√≥gica e integra√ß√µes personalizadas que n√£o possam ser implementadas apenas com o CRUD.  No nosso caso, queremos enviar mensagens para o Slack ao criar um novo pedido.  Podemos conseguir isso usando as fun√ß√µes 8base, ouvindo os eventos Create, Update e Delete, usaremos triggers. <br><br>  Um acionador √© uma fun√ß√£o que √© acionada em resposta a um evento de muta√ß√£o de dados: quando um objeto √© criado, atualizado ou exclu√≠do.  Existem dois tipos de gatilhos, dependendo de serem executados antes ou depois das altera√ß√µes nos dados: trigger.before e trigger.after. <br><br>  No nosso caso, chamaremos nossa fun√ß√£o ap√≥s criar o pedido.  Portanto, devemos especificar Orders.create.  Os valores poss√≠veis para o evento de dados s√£o criar, atualizar e excluir. <br><br><h4>  CLI 8base </h4><br>  O CLI 8base permite escrever JavaScript personalizado ou TypeScript para adicionar efetivamente a l√≥gica, concentrando-se apenas no que √© exclusivo para o seu aplicativo, evitando o c√≥digo padr√£o. <br><br>  A interface de linha de comando (CLI) da 8base facilita a adi√ß√£o de l√≥gica de servidor personalizada aos seus aplicativos diretamente do terminal.  Instale a CLI executando o seguinte comando em um terminal: <br><br><pre><code class="javascript hljs">npm install -g <span class="hljs-number"><span class="hljs-number">8</span></span>base</code> </pre> <br>  Depois de instalar a CLI globalmente, voc√™ precisa fazer login para conceder acesso √† CLI na sua conta 8base.  Execute o seguinte comando para efetuar login: <br>  ‚Äç <br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">8</span></span>base login</code> </pre><br>  Quando voc√™ executa este comando, uma janela do navegador aparece para autoriza√ß√£o da CLI.  O login d√° ao CLI acesso √† sua conta 8base.  Voc√™ pode encontrar outros comandos oferecidos pela CLI executando o comando help: <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">8</span></span>base help</code> </pre><br>  Em seguida, inicializamos o projeto 8base usando a CLI executando o seguinte comando no seu terminal: <br><br><pre> <code class="javascript hljs"><span class="hljs-number"><span class="hljs-number">8</span></span>base init shop-quick-functions</code> </pre><br>  Ap√≥s a execu√ß√£o do comando, uma nova pasta ser√° criada.  A estrutura da pasta deve ficar assim: <br><br><pre> <code class="javascript hljs">‚îú‚îÄ‚îÄ src/ | ‚îú‚îÄ‚îÄ function1.ts | ‚îî‚îÄ‚îÄ function2.js ‚îú‚îÄ‚îÄ <span class="hljs-number"><span class="hljs-number">8</span></span>base.yml ‚îî‚îÄ‚îÄ package.json</code> </pre> <br>  A CLI carrega um projeto Node regular, que permite instalar depend√™ncias usando npm ou yarn.  Al√©m disso, a CLI 8base vem com o Webpack e o TypeScript pr√©-configurados para que voc√™ possa escrever c√≥digo JavaScript ou TypeScript. <br><br>  Configuramos recursos e permiss√µes personalizados no 8base.yml.  Alteramos a configura√ß√£o atual do arquivo 8base.yml de acordo com nossas necessidades.  Abra o arquivo e fa√ßa as seguintes altera√ß√µes: <br><br><pre> <code class="javascript hljs">functions: notifySlack: handler: code: src/notifySlack.js type: trigger.after operation: Orders.create</code> </pre> <br>  A estrutura do arquivo √© semelhante a qualquer arquivo YAML.  O primeiro bloco que veremos √© um bloco funcional;  colocaremos todas as defini√ß√µes de fun√ß√µes que criaremos neste bloco.  Por exemplo, a fun√ß√£o notifySlack que criamos;  A fun√ß√£o possui as seguintes propriedades: <br><br><ul><li>  <b>manipulador</b> : caminho relativo do arquivo para o manipulador da fun√ß√£o notifySlack. </li><li>  <b>opera√ß√£o</b> : o par√¢metro determina qual tipo de dados e evento o gatilho deve ouvir. </li><li>  <b>tipo</b> : se eles foram iniciados antes ou depois da altera√ß√£o dos dados.  Existem dois tipos: trigger.before e trigger.after. </li></ul><br>  A pr√≥xima etapa √© criar um arquivo manipulador para come√ßar a receber eventos ap√≥s o gatilho.  Para enviar atualiza√ß√µes para o Slack, usaremos o m√©todo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chat.postMessage</a> .  As mensagens ser√£o enviadas usando o m√©todo de postagem HTTP - cada solicita√ß√£o para o m√©todo chat.postMessage ser√° assinada pelo token de acesso OAuth do seu bot.  Visite a p√°gina de detalhes do seu aplicativo, clique no link OAuth e permiss√µes na navega√ß√£o da barra lateral. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/180/c54/94d/180c5494dcf0df2c5de56fcefbc65c2a.png" alt="imagem"><br><br>  ‚Äç Copie o token e v√° para a guia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vari√°veis ‚Äã‚Äãde ambiente</a> na p√°gina de configura√ß√µes do 8base.  Suas fun√ß√µes t√™m acesso a todas as vari√°veis ‚Äã‚Äãde ambiente criadas.  <b>Sempre</b> armazene seus valores e credenciais confidenciais aqui e n√£o os coloque diretamente no banco de dados de c√≥digo-fonte.  Crie uma nova vari√°vel chamada SLACK_ACCESS_TOKEN, cole o token copiado e salve-o. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/84a/b45/96b/84ab4596bc04520f2ae6da4675274dc4.png" alt="imagem"><br><br>  Agora vamos adicionar o c√≥digo ao editor.  Crie um arquivo chamado utils.js no diret√≥rio src.  Abra o arquivo no seu editor favorito e copie o seguinte para ele: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/utils.js */</span></span><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> message = <span class="hljs-string"><span class="hljs-string">`A new order was just created`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> messageBody = dataBuilder(order); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> body = { <span class="hljs-attr"><span class="hljs-attr">channel</span></span>: <span class="hljs-string"><span class="hljs-string">'general'</span></span>, <span class="hljs-attr"><span class="hljs-attr">attachments</span></span>: messageBody, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: message }; ‚Äç <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Message body'</span></span>, { body }); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Sending message request'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> makeRequest(body); };‚Äç</code> </pre> <br>  Portanto, a fun√ß√£o sendMessage aceita um pedido com um argumento, que √© um objeto que cont√©m os campos que criamos para o modelo Order.  Agora precisamos criar uma nova mensagem usando o objeto order, para que passemos o objeto para uma fun√ß√£o chamada dataBuilder.  A fun√ß√£o dataBuilder retorna um objeto no formato de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">anexos</a> do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Slack</a> . <br><br>  Em seguida, criamos o corpo da solicita√ß√£o que cont√©m o canal da √°rea de trabalho no qual publicamos a mensagem, os anexos retornados do dataBuilder e, finalmente, o texto.  Em seguida, a solicita√ß√£o para publicar a mensagem √© enviada pela fun√ß√£o makeRequest. <br><br>  Vamos criar a fun√ß√£o dataBuilder, copie o fragmento abaixo e atualize o arquivo utils.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/utils.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { ...}; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dataBuilder = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { items } = order; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> itemSections = items.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'section'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: item.name, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'#3AA3E3'</span></span>, <span class="hljs-attr"><span class="hljs-attr">accessory</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'image'</span></span>, <span class="hljs-attr"><span class="hljs-attr">image_url</span></span>: item.image, <span class="hljs-attr"><span class="hljs-attr">alt_text</span></span>: item.name, }, }; }); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = [ { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'section'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'mrkdwn'</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">`*There are </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${items.length}</span></span></span><span class="hljs-string"> items in the order*`</span></span>, }, }, ...itemSections, ]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data; };</code> </pre> <br>  A fun√ß√£o dataBuilder aceita um objeto de pedido e cria uma se√ß√£o para cada item no pedido usando o nome e a imagem do item.  Voc√™ pode usar o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Message Builder</a> para visualizar a formata√ß√£o de mensagens e anexos em tempo real. <br><br>  Em seguida, adicionamos a fun√ß√£o makeRequest, que envia o corpo da mensagem para o workshop do Slack. <br><br>  Copie o seguinte snippet no arquivo utils.js: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/utils.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetch <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'node-fetch'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> sendMessage = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { ... }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dataBuilder = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">order</span></span></span><span class="hljs-function">) =&gt;</span></span> { ... }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> makeRequest = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> url = <span class="hljs-string"><span class="hljs-string">'https://slack.com/api/chat.postMessage'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> headers = { <span class="hljs-attr"><span class="hljs-attr">Authorization</span></span>: <span class="hljs-string"><span class="hljs-string">`Bearer </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${process.env.SLACK_ACCESS_TOKEN}</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>: <span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fetch(url, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-attr"><span class="hljs-attr">body</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(data), headers, }); };</code> </pre> <br>  Primeiro instale o pacote node-fetch executando o seguinte comando: <br><br><pre> <code class="javascript hljs">npm install node-fetch</code> </pre><br>  N√≥s importamos o pacote e o usamos na fun√ß√£o makeRequest.  Como parte da fun√ß√£o, adicionaremos todos os cabe√ßalhos necess√°rios √† solicita√ß√£o.  A solicita√ß√£o deve ser assinada com o cabe√ßalho da Autoriza√ß√£o ao Portador.  O token ser√° obtido da vari√°vel de ambiente que criamos anteriormente.  Por fim, retornamos a solicita√ß√£o POST usando a API de busca. <br><br>  Agora temos tudo o que voc√™ precisa para enviar uma mensagem para o espa√ßo de guerra do Slack usando um bot.  Vamos criar um manipulador de fun√ß√µes que referenciamos no arquivo 8base.yml acima. <br><br>  Crie um arquivo chamado notifySlack.js no diret√≥rio src, abra o arquivo e copie o c√≥digo para ele: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/* src/notifySlack.js */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { sendMessage } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./utils'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> (event) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Sending notification to slack'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> res = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> sendMessage(event.data); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Notification sent successfully'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (error) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(error); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: event.data, }; };</code> </pre> <br>  No arquivo, usamos a fun√ß√£o de utilit√°rio sendMessage que criamos.  O manipulador da fun√ß√£o 8base transmite dois argumentos: um evento e um contexto.  A estrutura do objeto de evento depende do tipo de fun√ß√£o e o objeto de contexto cont√©m propriedades e m√©todos √∫teis, sobre os quais voc√™ pode ler <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> . <br>  No nosso caso, o objeto de evento conter√° o Pedido criado, que consiste em dois campos de usu√°rio e itens.  O objeto Order √© uma propriedade dos dados do objeto de evento e passamos esse objeto para a fun√ß√£o sendMessage para notificar o Slack. <br><br>  A chamada de fun√ß√£o √© agrupada em try / catch, porque n√£o queremos que nenhum erro fa√ßa com que a fun√ß√£o termine.  Finalmente, retornamos os dados do evento no final da fun√ß√£o. <br>  Com esses dados, podemos indicar o assunto e o corpo da mensagem e enviar e-mails usando o transportador que criamos.  Salve o arquivo e implemente a fun√ß√£o usando a CLI 8base executando o seguinte comando: <br><br>  ‚Äç <pre> <code class="javascript hljs"># deploy <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> project root directory <span class="hljs-number"><span class="hljs-number">8</span></span>base deploy</code> </pre> <br>  Depois de definir com √™xito a fun√ß√£o, voc√™ ver√° a seguinte sa√≠da do terminal: <br>  ‚Äç <br><pre> <code class="javascript hljs">‚ûú <span class="hljs-number"><span class="hljs-number">8</span></span>base deploy deploy done. Time: <span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">553</span></span> ms.</code> </pre> <br><h4>  Recursos de depura√ß√£o </h4><br>  √â importante ter logs em suas fun√ß√µes para que voc√™ possa depurar facilmente as fun√ß√µes e acompanhar o que est√° acontecendo l√°.  O 8base possui uma p√°gina para visualizar todas as fun√ß√µes anexadas ao seu perfil.  Voc√™ pode visualizar facilmente todos os logs provenientes de cada fun√ß√£o. <br><br>  V√° para o 8base <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dashboard</a> e clique em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">L√≥gica</a> no menu lateral.  Na p√°gina l√≥gica, voc√™ pode visualizar todas as fun√ß√µes definidas. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1a2/c20/38a/1a2c2038afb3be1b65769a05cda9482b.png" alt="imagem"><br>  Para uma fun√ß√£o espec√≠fica, clique em <b>Exibir logs</b> para ver todos os logs.  Em seguida, instalamos o aplicativo Slack e o testamos. <br><br><h3>  Instalando e testando o aplicativo Slack </h3><br>  Vamos terminar a √∫ltima etapa e instalar o aplicativo Slack na √°rea de trabalho.  Para fazer isso, retorne ao console do aplicativo Slack e clique em <b>Instalar aplicativo</b> na barra de navega√ß√£o lateral. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76e/212/b74/76e212b74709411272256b422a77f653.png" alt="imagem"><br><br>  Na p√°gina, voc√™ ver√° um aviso sobre como adicionar uma fun√ß√£o ou autoridade para instalar o aplicativo.  Clique nele e adicione permiss√£o. <br><br>  Ap√≥s a instala√ß√£o bem-sucedida do aplicativo, podemos testar a fun√ß√£o e o aplicativo.  V√° para a p√°gina 8base <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Data</a> , clique na tabela Orders na barra lateral.  No visualizador de tabela de pedidos, clique na guia <b>DADOS</b> , aqui podemos adicionar novas linhas √† tabela. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7c0/fab/84c/7c0fab84c009f1f3620ab57e41086a55.png" alt="imagem"><br><br>  Na tabela de dados, pressione o bot√£o {+} e crie uma nova linha. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b1a/015/2bf/b1a0152bf7dad2951b3ef2d1e0a07310.png" alt="imagem"><br><br>  Voc√™ pode preencher o campo do produto com os seguintes dados: <br><br><pre> <code class="javascript hljs">[{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Food product"</span></span>, <span class="hljs-string"><span class="hljs-string">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://static.pexels.com/photos/368893/pexels-photo-368893.jpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">4</span></span> }, { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"The real fruit"</span></span>, <span class="hljs-string"><span class="hljs-string">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://static.pexels.com/photos/368893/pexels-photo-368883.jpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"price"</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span> }]</code> </pre> <br>  Clique em <b>Adicionar linha</b> para criar um novo pedido.  Em seguida, v√° para a oficina onde instalou o Slack App, clique no canal #general e voc√™ ver√° uma nova mensagem do bot. <br><br>  Deve ficar assim: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/739/025/ef1/739025ef157a8879e5a1aa63595036de.png" alt="imagem"><br><br>  Nova notifica√ß√£o do bot 8base no canal Slack <br><br><h3>  Palavras finais </h3><br>  Criar um aplicativo Slack √© uma boa ideia;  O Slack √© o principal meio de comunica√ß√£o para a maioria das equipes e pode permitir que voc√™ tenha todas as informa√ß√µes necess√°rias para o trabalho di√°rio. <br><br>  Para este artigo, usando a funcionalidade 8base, criamos um aplicativo Slack simples que envia mensagens sobre novos pedidos no sistema.  As mensagens enviadas eram bem simples.  O Slack possui uma <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">formata√ß√£o</a> rica para suas mensagens, e voc√™ pode complic√°-las para que elas contenham mais informa√ß√µes.  Leia mais sobre os recursos do 8base <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> .  Veja o c√≥digo neste artigo no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">GitHub</a> . <br><br>  Obrigado pela leitura. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt466335/">https://habr.com/ru/post/pt466335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt466317/index.html">Dicas e truques do meu canal de telegrama @pythonetc, agosto de 2019</a></li>
<li><a href="../pt466319/index.html">Acordo: VMware compra startup baseada na nuvem</a></li>
<li><a href="../pt466323/index.html">Criamos um jogo de plataforma port√°til no microcontrolador Cortex M0 +</a></li>
<li><a href="../pt466329/index.html">Mapa eletr√¥nico de vinifica√ß√£o na R√∫ssia. Design e conte√∫do</a></li>
<li><a href="../pt466333/index.html">Como organizar um local de trabalho para si mesmo</a></li>
<li><a href="../pt466337/index.html">Qual a cor da sua fun√ß√£o?</a></li>
<li><a href="../pt466339/index.html">Como no Microsoft SQL Server para obter dados do Google Analytics usando R</a></li>
<li><a href="../pt466341/index.html">Treinamento Cisco 200-125 CCNA v3.0. Dia 33. Prepara√ß√£o para o exame ICND1</a></li>
<li><a href="../pt466349/index.html">Como realizar testes A / B em 15.000 lojas offline</a></li>
<li><a href="../pt466355/index.html">Os crocodilos voam, mas baixo-baixo (sobre ekranoplanes sem emo√ß√µes, mas com digress√µes)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>