<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🐺 💇🏾 🍇 Interaktive Karte für eine Webanwendung in wenigen Stunden 🏑 ✍🏼 💅🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In einem früheren Artikel habe ich kurz über die Funktionen von kepler.gl gesprochen, dem neuen Open Source-Tool zur Visualisierung und Analyse großer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interaktive Karte für eine Webanwendung in wenigen Stunden</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422759/"><p>  In einem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">früheren Artikel habe</a> ich kurz über die Funktionen von kepler.gl gesprochen, dem neuen Open Source-Tool zur Visualisierung und Analyse großer Geodatensätze. </p><br><p><img src="https://habrastorage.org/webt/j7/wr/ug/j7wrugptpbwykcqm4quq-lrk72s.png" alt="Optionen für Karten, die mit kepler.gl erstellt wurden"><br>  <em>Abbildung 1. Optionen für Karten, die mit kepler.gl (von Uber) erstellt wurden</em> </p><br><p> Mit dieser Webanwendung können Sie in wenigen Minuten eine informative und vor allem farbenfrohe interaktive Karte erstellen, die auf beliebigen Geodatensätzen basiert.  Es stellt sich jedoch die Frage, was als nächstes damit zu tun ist.  Wie kann ich die Ergebnisse mit Kollegen, Freunden oder Kunden teilen? </p><a name="habracut"></a><br><h3 id="sravnivaem-alternativnye-varianty">  Alternativen vergleichen </h3><br><p>  Die ganze „Magie“ von kepler.gl geschieht auf dem Client, sodass die Anwendung nur zwei Möglichkeiten bietet, Ihre Ergebnisse mit anderen zu teilen: </p><br><ul><li>  Speichern Sie die Visualisierung als statisches Bild (während Sie nicht mehr mit der Karte interagieren können). </li><li>  Exportieren Sie die erstellte Konfiguration und Daten als Dateien und senden Sie sie an alle Interessenten mit Anweisungen zum Herunterladen der empfangenen Daten auf kepler.gl, um die erstellte Karte anzuzeigen </li></ul><br><p>  Glücklicherweise ist kepler.gl nicht nur ein Webtool, sondern auch eine React-Komponente, mit der Sie schnell eine Demo-Site mit Ihren Visualisierungen erstellen oder in eine vorhandene Webanwendung integrieren können. </p><br><p>  <em><strong>Hinweis</strong></em>  <em>Kepler.gl verarbeitet und aggregiert Daten im laufenden Betrieb und benötigt häufig viele Ressourcen.</em>  <em>Daher sollten Sie besonders vorsichtig sein, wenn Sie es in Anwendungen integrieren, die auf Mobilgeräte zugeschnitten sind.</em> </p><br><p>  Dieser Anwendungsfall für kepler.gl ermöglicht: </p><br><ul><li>  das Anzeigen der Visualisierung nicht erschweren (senden Sie einfach einen Link zu Ihrer Anwendung) </li><li>  Geben Sie keinen expliziten Zugriff auf die Originaldatensätze (wie im 2-Basisfall gefordert). </li><li>  Benutzerzugängliche Formate für die Interaktion mit Visualisierungen einschränken (z. B. die Selbstoptimierung von Filtern oder Datenanzeigemethoden verbieten) </li><li>  Speichern Sie alle gewünschten Formate für die Interaktion mit der Karte (Tooltip, Zoom, Kartenmodus wechseln usw.). </li></ul><br><p>  Die letzte der in Betracht gezogenen Optionen erfordert zusätzliche Anstrengungen seitens des Erstellers der Geovisualisierung, und Sie können nicht auf die Programmierung verzichten.  Wie Sie gleich sehen werden, ist es jedoch nicht schwierig, es auf die gleiche Weise zu implementieren. </p><br><h3 id="sozdaem-demo-prilozhenie">  Erstellen Sie eine Demo-Anwendung </h3><br><p>  Es ist Zeit, von der Theorie zur Praxis überzugehen.  Um Ihnen die grundlegenden Schritte zur Integration von kepler.gl in Ihren Code vorzustellen, habe ich eine kleine Demo-Anwendung erstellt. </p><br><p>  Der Benutzer kann Informationen zu kostenpflichtigen Moskauer Parkplätzen in einem von zwei Modi anzeigen - allgemein oder aggregiert.  Gleichzeitig können Sie mit der Anwendung nur die von uns erstellten Visualisierungen anzeigen, zwischen ihnen wechseln und im schreibgeschützten Modus mit der Karte arbeiten.  Der gesamte Quellcode und die Live-Version sind auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">GitHub</a> verfügbar. </p><br><p><img src="https://habrastorage.org/webt/sh/hb/qa/shhbqaimmmrciwal58iquhxiy08.png" alt="Demo-Antrag für kostenpflichtiges Parken in Moskau"><br>  <em>Abbildung 2. Zwei von der Demoanwendung bereitgestellte Kartenansichtsmodi</em> </p><br><p>  Um diese Demo zu erstellen, habe ich meine eigene Projektvorlage verwendet.  Wenn Sie sich jedoch dazu entschließen, selbst mit kepler.gl zu spielen, aber noch keine persönlichen Vorlieben haben, empfehle ich Ihnen, die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">App create-react-app zu verwenden</a> , wodurch sich der Zeitaufwand <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">für</a> die Erstellung der Grundlage Ihrer zukünftigen Anwendung erheblich verkürzt. </p><br><h3 id="dobavlyaem-keplergl-v-proekt">  Fügen Sie kepler.gl zum Projekt hinzu </h3><br><p>  Kepler.gl ist eine React-Komponente, die Redux zum Speichern und Verwalten ihres Status verwendet.  Um es dem Projekt hinzuzufügen, installieren Sie einfach das entsprechende npm-Paket: </p><br><pre><code class="bash hljs">npm install --save kepler.gl</code> </pre> <br><p>  Dieses npm-Paket enthält: </p><br><ul><li>  Eine Reihe von UI-Komponenten und -Fabriken, mit denen sie mit ihren eigenen Komponenten neu definiert werden können </li><li>  vordefinierte Methoden zum Hinzufügen / Ändern der verwendeten Daten und deren Anzeige </li><li>  Redux Reduzierer für ihre Arbeit notwendig </li></ul><br><h3 id="nastraivaem-redux-hranilische-dlya-raboty-keplergl">  Redux-Speicher für kepler.gl konfigurieren </h3><br><p>  Kepler.gl verwendet Redux, um seinen Status beim Erstellen und Aktualisieren von Karten zu verwalten.  Bevor wir die KeplerGl-Komponente verwenden, müssen wir dem Anwendungsreduzierer den entsprechenden Reduzierer hinzufügen. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { combineReducers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> keplerGlReducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl/reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> appReducer <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./appReducer'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducers = combineReducers({ <span class="hljs-attr"><span class="hljs-attr">keplerGl</span></span>: mapReducer, <span class="hljs-attr"><span class="hljs-attr">app</span></span>: appReducer, }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> reducers;</code> </pre> <br><p>  Es ist wichtig zu beachten, dass die KeplerGl-Komponente dem Benutzer standardmäßig alle verfügbaren Optionen zum Selbstbearbeiten, Herunterladen, Aktualisieren und Filtern von Daten bietet.  Um die für den Benutzer zulässigen Aktionen einzuschränken, müssen Sie Informationen zum Kartenmodus (zum Lesen oder Bearbeiten) und verfügbaren Kartensteuerelementen in den Anfangszustandsparametern übertragen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapReducer = keplerGlReducer .initialState({ <span class="hljs-attr"><span class="hljs-attr">uiState</span></span>: { <span class="hljs-attr"><span class="hljs-attr">readOnly</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">mapControls</span></span>: { <span class="hljs-attr"><span class="hljs-attr">visibleLayers</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">toggle3d</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }, <span class="hljs-attr"><span class="hljs-attr">splitMap</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">mapLegend</span></span>: { <span class="hljs-attr"><span class="hljs-attr">show</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">active</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> } } } });</code> </pre> <br><p>  Wir müssen auch React <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">-Palm</a> installieren, mit dem kepler.gl Nebenwirkungen kontrolliert und taskMiddleware aus diesem npm-Paket zum Redux-Repository seiner Anwendung hinzufügt: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {createStore, applyMiddleware, compose} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {taskMiddleware} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-palm'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> reducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = { }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> middlewares = [ taskMiddleware ]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> enhancers = [applyMiddleware(...middlewares)]; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> createStore( reducers, initialState, compose(...enhancers) );</code> </pre> <br><p>  <em><strong>Hinweis</strong></em>  <em>Derzeit arbeitet das Uber Engineering-Team aktiv an einer neuen Version von kepler.gl, die nicht von React-Palm abhängig sein wird.</em> </p><br><p>  Standardmäßig erwartet kepler.gl, dass sich sein Statusobjekt auf der obersten Ebene des Status der gesamten Anwendung befindet und über den Namen keplerGl zugänglich ist.  Wenn die Konfiguration des Redux-Repositorys von der erwarteten abweicht, reicht es für den korrekten Betrieb der entsprechenden React-Komponente aus, die Position ihres Status in der Hierarchie mithilfe der getState-Eigenschaft anzugeben. </p><br><h3 id="vstraivaem-react-komponent-keplergl">  Betten Sie die KeplerGl-Reaktionskomponente ein </h3><br><p>  Für das schnelle Rendern von Karten mit einer großen Anzahl angezeigter Elemente (bis zu Millionen von Geopunkten!) Verwendet Kepler.gl das Desk.gl - WebGL-Framework für die Datenvisualisierung und MapBox - Open Source Geo-Plattform, die eine praktische API und umfangreiche Möglichkeiten zum Anpassen erstellter Karten bietet .  Daher ist einer der erforderlichen Parameter, die an die KeplerGl-Komponente übergeben werden, das API-Token für den Zugriff auf den MapBox-Dienst. </p><br><p>  Um ein Token zu erhalten, müssen Sie sich unter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">www.mapbox.com</a> registrieren.  MapBox bietet eine Auswahl verschiedener Tarifpläne. Für kleine Anwendungen ist jedoch eine kostenlose Version mit 50.000 Ansichten pro Monat ausreichend. </p><br><p>  Nach dem Erstellen eines Kontos müssen Sie zum <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Abschnitt Token</a> gehen und einen öffentlichen Schlüssel generieren, um auf den Dienst zuzugreifen. </p><br><p>  Setzen Sie das empfangene Token auf die entsprechende Umgebungsvariable: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MapboxAccessToken=&lt;your_mapBox_token&gt;</code> </pre> <br><p>  Jetzt können Sie eine React-Komponente erstellen, um Informationen zu kostenpflichtigen Parkplätzen anzuzeigen.  In unserem Fall handelt es sich lediglich um einen Wrapper über die KeplerGl-Komponente, der die Abmessungen der Karte als Parameter verwendet: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KeplerGl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mapboxAccessToken = process.env.MapboxAccessToken; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ParkingMap = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function">) =&gt;</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">KeplerGl</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"parking_map"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mapboxApiAccessToken</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{mapboxAccessToken}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.width</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">props.height</span></span></span></span><span class="xml"><span class="hljs-tag"> } /&gt;</span></span></span><span class="xml"> ); export default ParkingMap;</span></span></code> </pre> <br><p>  Fügen Sie der App ParkingMap hinzu.  Zu diesem Zeitpunkt wird anstelle von Parkinformationen einfach eine Karte ohne Informationen angezeigt, da wir die Daten, auf deren Grundlage unsere Visualisierungen erstellt wurden, noch nicht übertragen haben. </p><br><h3 id="zagruzhaem-dannye-i-konfiguracii-karty">  Laden Sie Daten und Kartenkonfigurationen herunter </h3><br><p>  Um Ihre Daten auf der Karte anzuzeigen, müssen Sie den Datensatz, auf dessen Grundlage die Karte erstellt wird, und die gewünschte Konfiguration der endgültigen Visualisierung an KeplerGl übertragen.  Dies kann mit einer von zwei Methoden erfolgen - addDataToMap oder updateVisData. </p><br><p>  Mit der ersten Methode können Sie nicht nur den erforderlichen Datensatz herunterladen und die Konfiguration der entsprechenden Instanz der KeplerGl-Komponente einschließlich der Visualisierungseinstellungen (visState) und der Karte (mapState) sowie den Stil der verwendeten Karte (mapStyle) vollständig festlegen / aktualisieren. </p><br><p>  AddDataToMap akzeptiert ein Objekt mit den folgenden Informationen als Parameter für die Methode: </p><br><ul><li>  verwendete Datensätze für die Gebäudevisualisierung </li><li>  zusätzliche Konfigurationsparameter (Optionen) </li><li>  Konfigurationsdaten einschließlich mapState, mapStyle, visState <br><pre> <code class="javascript hljs">addDataToMap({ <span class="hljs-attr"><span class="hljs-attr">datasets</span></span>: { … } options: { … } config: { mapState { … }, mapStyle { … }, <span class="hljs-attr"><span class="hljs-attr">visState</span></span>: { … } } });</code> </pre> </li></ul><br><p>  <em><strong>Hinweis</strong></em>  <em>Daten aus dem Konfigurationsobjekt haben immer Vorrang vor den im Optionsobjekt übergebenen Einstellungen.</em> </p><br><p>  Mit der updateVisData-Methode können nur verwendete Datasets aktualisiert werden, ohne die Konfiguration der verwendeten Komponente vollständig zu ändern.  Als Parameter verwendet es wie die erste Methode ein Objekt, das Informationen zu einem neuen Satz oder neuen Datensätzen enthält, sowie den Parameter „options“ zum Aktualisieren einiger Kartenanzeigeeinstellungen. </p><br><p>  <strong>Karteninitialisierung</strong> </p><br><p>  Für das anfängliche Laden der Daten benötigen wir daher die Methode addDataToMap.  In der erstellten Demo-Anwendung wird die Datenbank für kostenpflichtige Parkplätze in Moskau geladen, wenn auf die Anwendung zum ersten Mal über eine separate Anforderung zugegriffen wird.  Die resultierenden Quelldaten müssen für den Upload nach KeplerGl vorbereitet sein.  In den meisten Fällen ist hierfür einer der vordefinierten Prozessoren ausreichend, die CSV / JSON-Daten in das von kepler.gl unterstützte Datenformat portieren. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadParkingData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mapMode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function">) =&gt;</span></span> { dispatch( requestParkingData() ); fetch(demoDataUrl) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">response</span></span></span><span class="hljs-function"> =&gt;</span></span> response.text()) .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">source</span></span></span><span class="hljs-function"> =&gt;</span></span> { dispatch( getParkingData() ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> data = Processors.processCsvData(source); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = getMapConfig(mapMode); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> datasets = [{ info, data }]; dispatch( wrapTo(<span class="hljs-string"><span class="hljs-string">'parking_map'</span></span>, addDataToMap({ datasets, config }) )); }); }; }</code> </pre> <br><p>  <strong>Zwischen den Modi wechseln</strong> </p><br><p>  Um zwischen den Kartenansichtsmodi zu wechseln, müssen wir eine andere Aktionsfunktion definieren.  Da es in der aktuellen Version von KeplerGl keine einfache Möglichkeit gibt, nur die Konfiguration der Karte zu ändern, ohne die Daten zu beeinflussen, ist die Methode addDataToMap auch die am besten geeignete Methode zum Umschalten zwischen den Modi: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggleMapMode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">mode</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, getState</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> config = getMapConfig( mode ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> datasets = getDatasets(getState()); dispatch( wrapTo(<span class="hljs-string"><span class="hljs-string">'parking_map'</span></span>, addDataToMap({ datasets, config }) )); dispatch( setMapMode(mode) ); }; }</code> </pre> <br><p>  Der Datensatzparameter ist erforderlich. Daher übertragen wir jedes Mal, wenn wir den Kartenansichtsmodus wechseln, den beim Start der Anwendung geladenen Originaldatensatz erneut.  Die Kartenkonfigurationsinformationen werden jedes Mal aktualisiert.  In diesem Artikel werde ich nicht näher darauf eingehen, wie die Hilfsmethoden getMapConfig und getDatasets implementiert sind, deren Quellcode Sie auf GitHub kennenlernen können. </p><br><p>  <em><strong>Hinweis</strong></em>  <em>Derzeit ist die KeplerGl-API sehr begrenzt und für die grundlegendsten Fälle (Hinzufügen und Aktualisieren von Daten) konzipiert.</em>  <em>Gleichzeitig erkennen die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Entwickler</a> selbst <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">an,</a> dass die aktuelle Version keine effektive Methode zum Aktualisieren nur von Konfigurationen oder zum Aktualisieren von Daten in Echtzeit bietet.</em>  <em>Vergessen Sie jedoch nicht, dass sich das Projekt in der aktiven Entwicklung befindet und Hoffnung auf eine baldige Erweiterung seiner Funktionalität besteht.</em> </p><br><h3 id="kastomiziruem-elementy-karty">  Passen Sie Kartenelemente an </h3><br><p>  KeplerGl enthält nicht nur einen Container mit Geovisualisierung, sondern auch Kartensteuerelemente, einen Tooltip, einen Seitenbereich zum Verwalten der angezeigten Daten, ein Dialogfeld zum Laden von Daten im CSV-, JSON- oder Geojson-Format usw.  Gleichzeitig kann jede der aufgelisteten Komponenten mithilfe des Abhängigkeitsinjektionssystems problemlos durch eine eigene Version ersetzt werden. </p><br><p>  Um die Basiskomponente durch die angepasste Version zu ersetzen, reicht Folgendes aus: </p><br><ul><li>  Standardkomponentenfabrik importieren </li><li>  Definieren Sie eine neue Factory, die eine benutzerdefinierte Komponente zurückgibt </li><li>  Betten Sie eine neue Factory mit der Methode insertComponents ein </li></ul><br><p>  In der von uns erstellten Demo-Anwendung möchten wir dem Benutzer nicht die Möglichkeit geben, den Anzeigemodus unabhängig zu konfigurieren, vorhandene zu filtern oder neue Daten zu laden. </p><br><p>  Theoretisch reicht dies aus, um anzuzeigen, dass sich die KeplerGl-Komponente im schreibgeschützten Modus befindet, der nur in Version 0.0.27 angezeigt wurde. Selbst in dieser Version werden dem Benutzer jedoch in den ersten Augenblicken vor dem Laden der Karte alle Steuerelemente angezeigt und erst dann ausgeblendet.  Um dies zu vermeiden, können wir unerwünschte Komponenten mithilfe der injizierenden Komponentenmethode explizit durch eine Nullkomponente ersetzen: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { injectComponents, ModalContainerFactory, SidePanelFactory, } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl/components'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// define null factory to don not render any unnecessary components const NullComponent = () =&gt; null; const nullComponentFactory = () =&gt; NullComponent; const KeplerGl = injectComponents([ [ModalContainerFactory, nullComponentFactory], [SidePanelFactory, nullComponentFactory], ]); export default KeplerGl;</span></span></code> </pre> <br><p>  Mit KeplerGl können Sie nicht nur grundlegende Komponenten durch benutzerdefinierte ersetzen, sondern mit der withState-Methode auch zusätzliche Aktionen und Statusparameter für neue Komponenten hinzufügen. </p><br><h3 id="kak-ispolzovat-neskolko-kart-odnovremenno">  So verwenden Sie mehrere Karten gleichzeitig </h3><br><p>  Wenn Sie mehrere verschiedene KeplerGL-Komponenten in derselben Anwendung verwenden möchten, muss jede dieser Komponenten in den Parametern mit einer eindeutigen ID festgelegt werden, die zum Hinzufügen / Aktualisieren von Daten und Konfigurationen der einzelnen Karten erforderlich ist: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> wrapToParking = wrapTo(<span class="hljs-string"><span class="hljs-string">' parking_map'</span></span>); dispatch( wrapToParking( addDataToMap({ datasets, config }) ));</code> </pre> <br><p>  Eine Alternative besteht darin, die Verbindungsfunktion von Redux und die ForwardTo-Funktion von kepler.gl zu verwenden.  In diesem Fall ist es für die entsprechende Dispatcher-Funktion einfach genug, die ID der entsprechenden Karte anzugeben: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> KeplerGl <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { forwardTo, toggleFullScreen } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'kepler.gl/actions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {connect} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> MapContainer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">props</span></span></span><span class="hljs-function"> =&gt;</span></span> ( &lt;div&gt; &lt;button onClick=() =&gt; props.keplerGlDispatch(toggleFullScreen())/&gt; &lt;KeplerGl id="foo" /&gt; &lt;/div&gt; ) const mapStateToProps = state =&gt; state const mapDispatchToProps = (dispatch, props) =&gt; ({ dispatch, keplerGlDispatch: forwardTo('foo', dispatch) });</code> </pre> <br><h3 id="zaklyuchenie">  Fazit </h3><br><p>  Mit KeplerGl können Sie Ihrer reaktionsbasierten Webanwendung farbenfrohe interaktive Karten hinzufügen.  Dank der Verwendung des Komponenten-Frameworks desktop.gl können problemlos Millionen von Geopunkten in einem Format angezeigt werden, das für die Anzeige und Analyse geeignet ist. </p><br><p>  Die vielfältigen Möglichkeiten, nicht nur erstellte Visualisierungen, sondern auch Kartenstile sowie Benutzerinteraktionsformate anzupassen, machen KeplerGl zu einem sehr attraktiven Werkzeug für die Erstellung komplexer kartografischer Visualisierungen und Dashboards. </p><br><p>  Aufgrund der begrenzten API-Szenarien, der Datenverarbeitung auf dem Client sowie der Verwendung von MapBox ohne die Möglichkeit, eine andere Kartenquelle auszuwählen, wird die Anzahl der Projekte reduziert, für die dieses Tool verwendet werden kann. </p><br><p>  Vergessen Sie jedoch nicht, dass das Projekt heute noch sehr jung ist und sich in der aktiven Entwicklungsphase befindet, sodass viele dieser Mängel in naher Zukunft möglicherweise irrelevant werden. </p><br><h3 id="poleznye-ssylki">  Nützliche Links </h3><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vollständiger Demo-Code</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Einführungsartikel zu Kepler.Gl zu Habr</a> </li><li>  <a href="">Kepler.gl Repository auf Github</a> </li><li>  <a href="">Die offizielle Dokumentation zu kepler.gl</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kepler.gl Tutorial zur Vis.Academy [de]</a> </li></ol><br></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de422759/">https://habr.com/ru/post/de422759/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de422747/index.html">IEEE Official Strong Encryption Support Position</a></li>
<li><a href="../de422751/index.html">10 kostenlose SSL / TLS-Diagnosetools für Webmaster</a></li>
<li><a href="../de422753/index.html">Grundlegendes zu Partitionen in PostgreSQL 9</a></li>
<li><a href="../de422755/index.html">Schützt das Portfolio vor Krypto-Senkung?</a></li>
<li><a href="../de422757/index.html">Keine Politik. Wie kann man Straßenproteste mit einer mobilen Anwendung dauerhaft transformieren?</a></li>
<li><a href="../de422761/index.html">Vier Wege von der Yandex Data Analysis School</a></li>
<li><a href="../de422763/index.html">Digitale Veranstaltungen in Moskau vom 10. bis 16. September</a></li>
<li><a href="../de422765/index.html">OpenID Connect 1.0 On Fingers</a></li>
<li><a href="../de422767/index.html">DEFCON-Konferenz 16. Fedor, InSecure.org Hacker. NMAP Scan Online</a></li>
<li><a href="../de422769/index.html">Gewinner des Startup Battlefield TechCrunch Disrupt San Francisco 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>