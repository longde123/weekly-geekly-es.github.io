<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìº ‚å®Ô∏è üéÖüèø Notas de aficionados, o The Tale of How the Scala FPGA Developer Configured ‚õ±Ô∏è üë®üèΩ‚Äçüè´ üë®üèº‚Äçüè≠</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Durante mucho tiempo so√±√© con aprender a trabajar con FPGA, mir√© de cerca. Luego compr√≥ un tablero de depuraci√≥n, escribi√≥ un par de hola mundos y col...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Notas de aficionados, o The Tale of How the Scala FPGA Developer Configured</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414995/"><p><img src="https://habrastorage.org/webt/iv/-q/hz/iv-qhzuto0ce_yrg6l226fghqf8.png" width="60%" align="left">  Durante mucho tiempo so√±√© con aprender a trabajar con FPGA, mir√© de cerca.  Luego compr√≥ un tablero de depuraci√≥n, escribi√≥ un par de hola mundos y coloc√≥ el tablero en una caja, porque no estaba claro qu√© hacer con √©l.  Entonces surgi√≥ la idea: escribamos un generador de video compuesto para un antiguo televisor CRT.  La idea, por supuesto, es divertida, pero realmente no conozco a Verilog, y todav√≠a tengo que recordarlo, y realmente no necesito este generador ... Y recientemente quer√≠a mirar hacia los procesadores de software <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RISC-V</a> .  Debe comenzar en alguna parte, y el c√≥digo de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Rocket Chip</a> (esta es una de las implementaciones) est√° escrito en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Chisel</a> , este es un DSL para Scala.  Entonces, de repente record√© que durante dos a√±os hab√≠a estado desarrollando profesionalmente en Scala y me di cuenta: hab√≠a llegado el momento ... </p><br><p>  Entonces, si desea leer una historia de la vida de los cortadores de alambre, un mult√≠metro digital y un osciloscopio que se haya realizado, entonces bienvenido a cat. </p><a name="habracut"></a><br><p>  Entonces, ¬øqu√© habr√° en este art√≠culo?  En √©l, describir√© mis intentos de generar una se√±al de video PAL compuesta (¬øpor qu√© PAL? - Acabo de encontrar un buen tutorial espec√≠ficamente sobre la generaci√≥n PAL) en la placa <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Mars rover 2</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">nckma</a> .  Sobre RISC-V en este art√≠culo no dir√© nada en absoluto.  :) </p><br><p>  Primero, un poco sobre Scala y Chisel: Scala es un lenguaje que se ejecuta en la parte superior de la m√°quina virtual Java y utiliza de manera transparente las bibliotecas Java existentes (aunque tambi√©n hay Scala.js y Scala Native).  Cuando comenc√© a estudiarlo, tuve la sensaci√≥n de que era un h√≠brido muy viable de "ventajas" y Haskell <em>(sin embargo, los colegas no comparten esta opini√≥n)</em> : es un sistema de tipos dolorosamente avanzado y un lenguaje conciso, pero debido a la necesidad de cruzar el funcionalismo con OOP una abundancia de construcciones de lenguaje en algunos lugares evoc√≥ recuerdos de C ++.  Sin embargo, no tenga miedo de Scala: es un lenguaje muy conciso y seguro con un sistema de tipo potente, en el que al principio puede simplemente escribir como Java mejorado.  Y tambi√©n, hasta donde yo s√©, Scala se desarroll√≥ originalmente como un lenguaje para la creaci√≥n conveniente de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">lenguajes espec√≠ficos</a> de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">dominio</a> : esto es cuando usted describe, digamos, equipos digitales o notas en un lenguaje formal, y este lenguaje parece bastante l√≥gico desde el punto de vista de su √°rea tem√°tica.  Y de repente descubres que era el c√≥digo correcto en Scala (bueno, o Haskell), solo personas amables escribieron una biblioteca con una interfaz conveniente.  Chisel es una biblioteca para Scala, que nos permite describir la l√≥gica digital en un DSL conveniente, y luego ejecutar el c√≥digo Scala resultante y generar c√≥digo en Verilog (o alguna otra cosa) que se pueda copiar al proyecto Quartus.  Bueno, o ejecute inmediatamente las pruebas unitarias est√°ndar de estilo scala, que simular√°n bancos de pruebas y emitir√°n un informe sobre los resultados. </p><br><p>  Para familiarizarse con los circuitos digitales, recomiendo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">este libro</a> (ya est√° en la versi√≥n impresa en ruso).  De hecho, mi conocimiento sistem√°tico del mundo de FPGA casi termina en este libro, por lo que las cr√≠ticas constructivas en los comentarios son bienvenidas (sin embargo, repito, el libro es maravilloso: cuenta desde lo b√°sico hasta la creaci√≥n de un procesador transportador simple. Y hay im√°genes all√≠;)).  Bueno, seg√∫n Chisel, hay un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">buen tutorial oficial</a> . </p><br><p>  <strong>Descargo de responsabilidad: el</strong> autor no es responsable del equipo quemado, y si decide repetir el experimento, es mejor verificar los niveles de se√±al con un osciloscopio, rehacer la parte anal√≥gica, etc.  Y en general, observe las precauciones de seguridad.  <em>(Por ejemplo, en el proceso de escribir el art√≠culo, me di cuenta de que las patas tambi√©n son extremidades, y no hay nada que las pegue en la bater√≠a de calefacci√≥n central, aferr√°ndose a la salida del tablero ...)</em> Por cierto, esta infecci√≥n tambi√©n caus√≥ interferencia en el televisor de la habitaci√≥n contigua. en el curso de la depuraci√≥n ... </p><br><h2 id="nastroyka-proekta">  Configuraci√≥n del proyecto </h2><br><p> Escribiremos el c√≥digo en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">IntelliJ Idea Community Edition</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sbt</a> ser√° el sistema de compilaci√≥n, as√≠ que cree un directorio, coloque <code>.gitignore</code> , <code>project/build.properties</code> , <code>project/plugins.sbt</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">desde aqu√≠</a> y </p><br><div class="spoiler">  <b class="spoiler_title">build.sbt algo simplificado</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scalacOptionsVersion</span></span></span></span>(scalaVersion: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = { <span class="hljs-type"><span class="hljs-type">Seq</span></span>() ++ { <span class="hljs-comment"><span class="hljs-comment">// If we're building with Scala &gt; 2.11, enable the compile option // switch to support our anonymous Bundle definitions: // https://github.com/scala/bug/issues/10047 CrossVersion.partialVersion(scalaVersion) match { case Some((2, scalaMajor: Long)) if scalaMajor &lt; 12 =&gt; Seq() case _ =&gt; Seq("-Xsource:2.11") } } } name := "chisel-example" version := "1.0.0" scalaVersion := "2.11.12" resolvers ++= Seq( Resolver.sonatypeRepo("snapshots"), Resolver.sonatypeRepo("releases") ) // Provide a managed dependency on X if -DXVersion="" is supplied on the command line. val defaultVersions = Map( "chisel3" -&gt; "3.1.+", "chisel-iotesters" -&gt; "1.2.+" ) libraryDependencies ++= (Seq("chisel3","chisel-iotesters").map { dep: String =&gt; "edu.berkeley.cs" %% dep % sys.props.getOrElse(dep + "Version", defaultVersions(dep)) }) scalacOptions ++= scalacOptionsVersion(scalaVersion.value)</span></span></code> </pre> </div></div><br><p>  Ahora √°bralo en la Idea y solicite importar el proyecto sbt, mientras que sbt descargar√° las dependencias necesarias. </p><br><h2 id="pervye-moduli">  Primeros m√≥dulos </h2><br><h3 id="shim">  PWM </h3><br><p>  Primero, intentemos escribir un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PWM</a> simple.  Mi l√≥gica era aproximadamente la siguiente: para generar una se√±al de ciclo de trabajo n / m, inicialmente colocamos 0 en el registro y agregaremos n en cada paso.  Cuando el valor del registro excede m, reste my d√© un nivel alto para un ciclo de reloj.  En realidad, ser√° defectuoso si n&gt; m, pero consideraremos que es un comportamiento indefinido, que es necesario para optimizar los casos reales utilizados. </p><br><p>  No volver√© a contar toda la gu√≠a para principiantes: se lee en media hora, solo dir√© que para describir el m√≥dulo, necesitamos importar el <code>chisel3._</code> y heredarlo de la clase abstracta <code>Module</code> .  Es abstracto porque necesitamos describir el <code>Bundle</code> bajo el nombre <code>io</code> ; tendr√° toda la interfaz del m√≥dulo.  Al mismo tiempo, las entradas de <code>clock</code> y <code>reset</code> aparecer√°n impl√≠citamente; no es necesario que las describa por separado.  Esto es lo que sucedi√≥: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWM</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> numerator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> denominator = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pulse = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> counter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(width.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> nextValue = counter + io.numerator io.pulse := nextValue &gt; io.denominator counter := <span class="hljs-type"><span class="hljs-type">Mux</span></span>(io.pulse, nextValue - io.denominator, nextValue) }</code> </pre><br><p>  ¬°Observe que llamamos al m√©todo <code>.W</code> un int regular para obtener el ancho del puerto, y al <code>.asUInt(width.W)</code> generalmente llamamos a un literal entero!  ¬øC√≥mo es esto posible?  - bueno, en Smalltalk simplemente definir√≠amos un nuevo m√©todo para la clase Integer (o como se llame all√≠), pero en la JVM todav√≠a no tenemos todo el objeto - tambi√©n hay tipos primitivos, y Scala entiende esto (y, adem√°s, hay clases de terceros que no podemos modificar).  Por lo tanto, hay una variedad de s impl√≠citos: en este caso, Scala probablemente encuentre algo como </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BetterInt</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">n: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">W</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Width</span></span> = ... }</code> </pre> <br><p>  en el √°mbito actual, por lo que las entradas ordinarias tienen superpoderes  Esta es una de las caracter√≠sticas que hace que Scala sea m√°s conciso y f√°cil de crear DSL. </p><br><div class="spoiler">  <b class="spoiler_title">Agregue una pizca de pruebas a esto.</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.iotesters._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.{<span class="hljs-type"><span class="hljs-type">FlatSpec</span></span>, <span class="hljs-type"><span class="hljs-type">Matchers</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterConstant</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denum: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, const: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (const) denum <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) poke(pwm.io.denominator, denum) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">2</span></span> * denum) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, const) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterExact</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, ratio: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">) </span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, num * ratio) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> delay = (<span class="hljs-number"><span class="hljs-number">1</span></span> to ratio + <span class="hljs-number"><span class="hljs-number">2</span></span>).takeWhile { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse) == <span class="hljs-type"><span class="hljs-type">BigInt</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>) } println(<span class="hljs-string"><span class="hljs-string">s"delay = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$delay</span></span></span><span class="hljs-string">"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">10</span></span>) { expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j &lt;- <span class="hljs-number"><span class="hljs-number">1</span></span> to ratio - <span class="hljs-number"><span class="hljs-number">1</span></span>) { step(<span class="hljs-number"><span class="hljs-number">1</span></span>) expect(pwm.io.pulse, <span class="hljs-literal"><span class="hljs-literal">false</span></span>) } step(<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMTesterApproximate</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PWM</span></span></span></span><span class="hljs-class"><span class="hljs-params">, num: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, denom: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PeekPokeTester</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">pwm</span></span></span><span class="hljs-class">)</span></span>{ poke(pwm.io.numerator, num) poke(pwm.io.denominator, denom) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> count = (<span class="hljs-number"><span class="hljs-number">1</span></span> to <span class="hljs-number"><span class="hljs-number">100</span></span> * denom).map { _ =&gt; step(<span class="hljs-number"><span class="hljs-number">1</span></span>) peek(pwm.io.pulse).toInt }.sum <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> diff = count - <span class="hljs-number"><span class="hljs-number">100</span></span> * num println(<span class="hljs-string"><span class="hljs-string">s"Difference = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">$diff</span></span></span><span class="hljs-string">"</span></span>) expect(<span class="hljs-type"><span class="hljs-type">Math</span></span>.abs(diff) &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">"Difference should be almost 0"</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PWMSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlatSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">PWMSpec</span></span>._ behavior of <span class="hljs-string"><span class="hljs-string">"PWMSpec"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testWith</span></span></span></span>(testerConstructor: <span class="hljs-type"><span class="hljs-type">PWM</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">PeekPokeTester</span></span>[<span class="hljs-type"><span class="hljs-type">PWM</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { chisel3.iotesters.<span class="hljs-type"><span class="hljs-type">Driver</span></span>(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>))(testerConstructor) shouldBe <span class="hljs-literal"><span class="hljs-literal">true</span></span> } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 1/1"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return False constant for 10/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterConstant</span></span>(_, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return True exactly once in 3 steps for 1/3"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterExact</span></span>(_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)) } it should <span class="hljs-string"><span class="hljs-string">"return good approximation for 3/10"</span></span> in { testWith(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWMTesterApproximate</span></span>(_, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>)) } }</code> </pre> </div></div><br><p>  <code>PeekPokeTester</code> es uno de los tres probadores est√°ndar en Chisel.  Le permite establecer los valores en las entradas del DUT (dispositivo bajo prueba) y verificar los valores en las salidas.  Como podemos ver, el ScalaTest habitual se usa para las pruebas y las pruebas ocupan espacio 5 veces la implementaci√≥n en s√≠, lo que, en principio, es normal para el software.  Sin embargo, sospecho que los desarrolladores experimentados de equipos "fundidos en silicio" solo sonreir√°n con un n√∫mero tan microsc√≥pico de pruebas.  Lanzamiento y Ups ... </p><br><pre> <code class="hljs powershell">Circuit state created [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] SEED <span class="hljs-number"><span class="hljs-number">1529827417539</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">000</span></span>] EXPECT AT <span class="hljs-number"><span class="hljs-number">1</span></span> io_pulse got <span class="hljs-number"><span class="hljs-number">0</span></span> expected <span class="hljs-number"><span class="hljs-number">1</span></span> FAIL ... [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec: [<span class="hljs-type"><span class="hljs-type">info</span></span>] PWMSpec [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> *** FAILED *** [<span class="hljs-type"><span class="hljs-type">info</span></span>] false was not equal to true (PWMSpec.scala:<span class="hljs-number"><span class="hljs-number">56</span></span>) [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> False constant <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> True exactly once <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> steps <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-type"><span class="hljs-type">info</span></span>] - should <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> good approximation <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>/<span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br><p>  S√≠, corr√≠jalo en PWM en la l√≠nea <code>io.pulse := nextValue &gt; io.denominator</code> reg√≠strate <code>&gt;=</code> , reinicia las pruebas, ¬°todo funciona!  Me temo que los desarrolladores experimentados de equipos digitales querr√°n matarme por una actitud tan fr√≠vola al dise√±o (y algunos desarrolladores de software con gusto se unir√°n a ellos) ... </p><br><h3 id="generator-impulsov">  Generador de pulso </h3><br><p>  Tambi√©n necesitaremos un generador que genere pulsos de sincronizaci√≥n para "medias tramas".  ¬øPor qu√© semi?  porque primero se transmiten las l√≠neas impares, luego las pares (bueno, o viceversa, pero ahora no nos interesa la grasa). </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.util._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OneShotPulseGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">val lengths: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Seq</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">], val initial: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Add sentinel value here, so no output flip required after the last state private val delayVecValues = lengths.map(_ - 1) :+ 0 val io = IO(new Bundle { val signal = Output(Bool()) }) private val nextIndex = RegInit(1.asUInt( log2Ceil(delayVecValues.length + 1).W )) private val countdown = RegInit(delayVecValues.head.asUInt( log2Ceil(lengths.max + 1).W )) private val output = RegInit(initial.asBool) private val delaysVec = VecInit(delayVecValues.map(_.asUInt)) private val moveNext = countdown === 0.asUInt private val finished = nextIndex === delayVecValues.length.asUInt when (!finished) { when (moveNext) { countdown := delaysVec(nextIndex) nextIndex := nextIndex + 1.asUInt output := !output }.otherwise { countdown := countdown - 1.asUInt } } io.signal := output }</span></span></code> </pre> <br><p>  Cuando se elimina la se√±al de <code>reset</code> , dispara con pulsos rectangulares con las longitudes de los intervalos entre la conmutaci√≥n especificada por el par√°metro de <code>lengths</code> , despu√©s de lo cual permanece para siempre en el √∫ltimo estado.  Este ejemplo demuestra el uso de tablas de valores usando <code>VecInit</code> , as√≠ como una forma de obtener el ancho de registro requerido: <code>chisel3.util.log2Ceil(maxVal + 1).W</code> .  Sinceramente, no recuerdo c√≥mo se hizo en Verilog, pero en Chisel, para crear dicho m√≥dulo parametrizado por un vector de valores, es suficiente llamar al constructor de la clase con el par√°metro requerido. </p><br><p>  Probablemente pregunte: "Si las entradas de <code>clock</code> y <code>reset</code> se generan impl√≠citamente, ¬øc√≥mo" recargaremos "el generador de impulsos para cada cuadro?"  Los desarrolladores de Cincel han proporcionado todo: </p><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> module = <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> moduleWithCustomReset = withReset(customReset) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> otherClockDomain = withClock(otherClock) { <span class="hljs-type"><span class="hljs-type">Module</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">MyModule</span></span>() ) }</code> </pre> <br><h2 id="naivnaya-realizaciya-generatora-signala">  Implementaci√≥n ingenua de un generador de se√±al </h2><br><p>  Para que el televisor nos entienda al menos de alguna manera, debe admitir el "protocolo" del nivel de truco promedio: hay tres niveles de se√±al importantes: </p><br><ul><li>  1.0V - color blanco </li><li>  0.3V - color negro </li><li>  0V - nivel especial </li></ul><br><p>  ¬øPor qu√© llam√© 0V especial?  Debido a que con una transici√≥n suave de 0.3V a 1.0V, cambiamos suavemente de negro a blanco, y entre 0V y 0.3V, hasta donde puedo entender, no hay niveles intermedios y 0V se usa solo para sincronizaci√≥n.  <em>(De hecho, ni siquiera cambia en el rango 0V - 1V, pero -0.3V - 0.7V, pero, con suerte, todav√≠a hay un condensador en la entrada)</em> </p><br><p>  Como nos ense√±a este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">maravilloso art√≠culo</a> , una se√±al PAL compuesta consiste en un flujo interminable de 625 l√≠neas repetidas: la mayor√≠a de ellas son l√≠neas, de hecho, im√°genes (por separado, pares e impares por separado), algunas se usan para fines de sincronizaci√≥n (hicimos el generador para ellas se√±ales), algunos no son visibles en la pantalla.  Se ven as√≠ (no piratear√© y dar√© enlaces al original): </p><br><ul><li>  <a href="">Una l√≠nea de imagen regular</a> </li><li>  <a href="">Cadenas de sincronizaci√≥n</a> </li></ul><br><p>  Intentemos describir las interfaces de los m√≥dulos: </p><br><p>  <code>BWGenerator</code> gestionar√° los tiempos, etc., necesita saber con qu√© frecuencia funciona: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> inScanLine = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  <code>PalColorCalculator</code> calcular√° el nivel de la se√±al de luminancia, as√≠ como una se√±al de color adicional: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalColorCalculator</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scanLine = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">L</span></span> = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-comment"><span class="hljs-comment">//  --  / io.L := (0.asUInt(10.W) + io.red + io.green + io.blue) / 4.asUInt io.millivolts := 0.asUInt }</span></span></code> </pre> <br><p>  En el m√≥dulo <code>PalGenerator</code> , simplemente <code>PalGenerator</code> dos m√≥dulos especificados: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PalGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bw = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">BWGenerator</span></span>(clocksPerUs)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> color = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalColorCalculator</span></span>) io.red &lt;&gt; color.io.red io.green &lt;&gt; color.io.green io.blue &lt;&gt; color.io.blue bw.io.<span class="hljs-type"><span class="hljs-type">L</span></span> &lt;&gt; color.io.<span class="hljs-type"><span class="hljs-type">L</span></span> bw.io.inScanLine &lt;&gt; color.io.scanLine bw.io.x &lt;&gt; io.x bw.io.y &lt;&gt; io.y io.millivolts := bw.io.millivolts + color.io.millivolts }</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Y ahora lamentablemente dibujamos el primer b√∫ho ...</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> io.github.atrosinenko.fpga.tv <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3.core.withReset <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">OneShotPulseGenerator</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BWGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncStartUs</span></span> = <span class="hljs-number"><span class="hljs-number">4.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">ScanLineHSyncEndUs</span></span> = <span class="hljs-number"><span class="hljs-number">12.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">TotalScanLineLengthUs</span></span> = <span class="hljs-number"><span class="hljs-number">64.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> <span class="hljs-type"><span class="hljs-type">VSyncStart</span></span> = <span class="hljs-type"><span class="hljs-type">Seq</span></span>( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-comment"><span class="hljs-comment">// 623 / 311 2, 30, 2, 30 // 624 / 312 ) val VSyncEnd = Seq( 30, 2, 30, 2, // 2 / 314 30, 2, 30, 2, // 3 / 315 2, 30, 2, 30, // 4 / 316 2, 30, 2, 30 // 5 / 317 ) val VSync1: Seq[Int] = VSyncStart ++ Seq( 2, 30, 2, 30, // 625 30, 2, 30, 2 // 1 ) ++ VSyncEnd ++ (6 to 23).flatMap(_ =&gt; Seq(4, 60)) val VSync2: Seq[Int] = VSyncStart ++ Seq( 2, 30, 30, 2 // 313 ) ++ VSyncEnd ++ (318 to 335).flatMap(_ =&gt; Seq(4, 60)) val BlackMv = 300.asUInt(12.W) val WhiteMv = 1000.asUInt(12.W) val FirstHalf = (24, 311) val SecondHalf = (336, 623) val TotalScanLineCount = 625 } class BWGenerator(clocksPerUs: Int) extends Module { import BWGenerator._ val io = IO(new Bundle { val L = Input(UInt(8.W)) val x = Output(UInt(10.W)) val y = Output(UInt(10.W)) val inScanLine = Output(Bool()) val millivolts = Output(UInt(12.W)) }) private val scanLineNr = RegInit(0.asUInt(10.W)) private val inScanLineCounter = RegInit(0.asUInt(16.W)) when (inScanLineCounter === (TotalScanLineLengthUs * clocksPerUs - 1).toInt.asUInt) { inScanLineCounter := 0.asUInt when(scanLineNr === (TotalScanLineCount - 1).asUInt) { scanLineNr := 0.asUInt } otherwise { scanLineNr := scanLineNr + 1.asUInt } } otherwise { inScanLineCounter := inScanLineCounter + 1.asUInt } private val fieldIActive = SecondHalf._2.asUInt &lt;= scanLineNr || scanLineNr &lt; FirstHalf._1.asUInt private val fieldIGenerator = withReset(!fieldIActive) { Module(new OneShotPulseGenerator(VSync1.map(_ * clocksPerUs), initial = false)) } private val fieldIIActive = FirstHalf._2.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._1.asUInt private val fieldIIGenerator = withReset(!fieldIIActive) { Module(new OneShotPulseGenerator(VSync2.map(_ * clocksPerUs), initial = false)) } private val inFirstHalf = FirstHalf ._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; FirstHalf ._2.asUInt private val inSecondHalf = SecondHalf._1.asUInt &lt;= scanLineNr &amp;&amp; scanLineNr &lt; SecondHalf._2.asUInt io.inScanLine := (inFirstHalf || inSecondHalf) &amp;&amp; ((ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt &lt;= inScanLineCounter) io.x := Mux( io.inScanLine, inScanLineCounter - (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt, 0.asUInt ) / 4.asUInt io.y := Mux( io.inScanLine, Mux( inFirstHalf, ((scanLineNr - FirstHalf ._1.asUInt) &lt;&lt; 1).asUInt, ((scanLineNr - SecondHalf._1.asUInt) &lt;&lt; 1).asUInt + 1.asUInt ), 0.asUInt ) when (fieldIActive) { io.millivolts := Mux(fieldIGenerator .io.signal, BlackMv, 0.asUInt) }.elsewhen (fieldIIActive) { io.millivolts := Mux(fieldIIGenerator.io.signal, BlackMv, 0.asUInt) }.otherwise { when (inScanLineCounter &lt; (ScanLineHSyncStartUs * clocksPerUs).toInt.asUInt) { io.millivolts := 0.asUInt }.elsewhen (inScanLineCounter &lt; (ScanLineHSyncEndUs * clocksPerUs).toInt.asUInt) { io.millivolts := BlackMv }.otherwise { io.millivolts := (BlackMv + (io.L &lt;&lt; 1).asUInt).asUInt } } }</span></span></code> </pre> </div></div><br><h3 id="generaciya-sinteziruemogo-koda">  Generaci√≥n de c√≥digo sintetizado </h3><br><p>  Todo esto es bueno, pero queremos coser el dise√±o resultante en una tabla.  Para hacer esto, debe sintetizar Verilog.  Esto se hace de una manera muy simple: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> chisel3._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> io.github.atrosinenko.fpga.common.<span class="hljs-type"><span class="hljs-type">PWM</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codegen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestModule</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">mhz: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> millivolts = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">12.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> imageGenerator = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestColorImageGenerator</span></span>(<span class="hljs-number"><span class="hljs-number">540</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encoder = <span class="hljs-type"><span class="hljs-type">Module</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PalGenerator</span></span>(clocksPerUs = mhz)) imageGenerator.io.x &lt;&gt; encoder.io.x imageGenerator.io.y &lt;&gt; encoder.io.y imageGenerator.io.red &lt;&gt; encoder.io.red imageGenerator.io.green &lt;&gt; encoder.io.green imageGenerator.io.blue &lt;&gt; encoder.io.blue io.millivolts := encoder.io.millivolts <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">desiredName</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"CompositeSignalGenerator"</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>(args: <span class="hljs-type"><span class="hljs-type">Array</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>]): <span class="hljs-type"><span class="hljs-type">Unit</span></span> = { <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">PWM</span></span>(<span class="hljs-number"><span class="hljs-number">12</span></span>)) <span class="hljs-type"><span class="hljs-type">Driver</span></span>.execute(args, () =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">TestModule</span></span>(mhz = <span class="hljs-number"><span class="hljs-number">32</span></span>)) } }</code> </pre><br><p>  En realidad, en el m√©todo <code>main()</code> dos l√≠neas <code>main()</code> lo hacemos dos veces, el resto del c√≥digo es otro m√≥dulo que sigue. </p><br><div class="spoiler">  <b class="spoiler_title">Generador de im√°genes de prueba absolutamente aburrido</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestColorImageGenerator</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">width: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, height: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> red = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> green = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> blue = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">8.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) io.red := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.green := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">200.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) io.blue := <span class="hljs-type"><span class="hljs-type">Mux</span></span>((io.x / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt + io.y / <span class="hljs-number"><span class="hljs-number">32.</span></span>asUInt)(<span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt, <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) }</code> </pre> </div></div><br><p>  Ahora debe incluirlo en el proyecto Quartus.  Para Mars rover 2, necesitaremos la versi√≥n gratuita de Quartus 13.1.  C√≥mo instalarlo, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√° escrito</a> en el sitio de los rovers de Marte.  A partir de ah√≠, descargu√© el "Primer proyecto" para la placa Mars Rover 2, lo puse en el repositorio y lo correg√≠ un poco.  Como no soy ingeniero electr√≥nico (y FPGA me interesan m√°s como aceleradores que como tarjetas de interfaz), entonces </p><br><div class="spoiler">  <b class="spoiler_title">como en esa broma ...</b> <div class="spoiler_text"><p>  El programador se encuentra profundamente en la depuraci√≥n. <br>  Hijo apto: <br>  "Pap√°, ¬øpor qu√© sale el sol en el este todos los d√≠as y se sienta en el oeste?" <br>  "¬øLo revisaste?" <br>  - Comprobado. <br>  - Bien comprobado? <br>  - bien. <br>  - Funciona? <br>  - Funciona <br>  - ¬øFunciona todos los d√≠as? <br>  S√≠, todos los d√≠as. <br>  - Entonces, por el amor de Dios, hijo, no toques nada, no cambies nada. </p></div></div><br><p>  ... Acabo de eliminar el generador de se√±al VGA y agregu√© mi m√≥dulo. </p><br><p><img src="https://habrastorage.org/webt/uq/tu/fx/uqtufxsowkzdbhnd652ezepquva.png" alt="Cambio en quatus"></p><br><p>  Despu√©s de eso, conect√© el sintonizador de TV anal√≥gico a otra computadora (computadora port√°til), para que hubiera al menos un aislamiento galv√°nico entre la fuente de alimentaci√≥n del generador de se√±al y el consumidor y simplemente envi√© una se√±al desde los pines IO7 (+) y GND (-) de la placa a la entrada compuesta (menos al contacto externo, m√°s al centro).  Bueno, es decir, como "simple" ... Simplemente ser√≠a si las manos crecieran de donde deber√≠a, bueno, o si tuviera cables de conexi√≥n hembra-macho.  Pero solo tengo un mont√≥n de cables macho-macho.  Pero tengo tenacidad y pinzas!  En general, hay un hilo de estre√±imiento, me hice casi dos trabajadores, con dificultad, pero aferr√°ndome al tablero.  Y aqu√≠ est√° lo que vi: </p><br><p><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="Primera imagen en blanco y negro"></p><br><p>  De hecho, yo, por supuesto, te enga√±√© un poco.  El c√≥digo que se muestra arriba lo obtuve despu√©s de aproximadamente tres horas de depuraci√≥n "en hardware", pero, ¬°maldici√≥n, lo escrib√≠ y funciona!  Y, dado que no estaba familiarizado con la electr√≥nica seria, creo que la tarea no fue terrible, qu√© tarea dif√≠cil. </p><br><h2 id="generaciya-cvetnogo-videosignala">  Generaci√≥n de video en color </h2><br><p>  Bueno, entonces, la cosa sigue siendo peque√±a: agregar un generador de se√±al de video en color.  Tom√© el tutorial y comenc√© a tratar de formar una explosi√≥n de color (agregada al nivel de negro de la onda sinusoidal a la frecuencia portadora de la se√±al de color, producida durante un corto tiempo durante HSync) y, de hecho, la se√±al de color de acuerdo con la f√≥rmula.  Pero no sale, a pesar de que se quiebra ... En alg√∫n momento me di cuenta de que, a pesar del hecho de que la frecuencia no me llam√≥ la atenci√≥n al echar un vistazo r√°pido al documento, el televisor apenas se sintoniz√≥ en uno arbitrario.  Despu√©s de buscar, descubr√≠ que el PAL usa una frecuencia portadora de 4.43 MHz.  La cosa es el sombrero, pens√©.  "J√≥dete", respondi√≥ el sintonizador.  Despu√©s de un d√≠a entero de depuraci√≥n y solo una vez viendo destellos de color en la imagen (adem√°s, cuando le dije al sintonizador que era NTSC en general) </p><br><div class="spoiler">  <b class="spoiler_title">... me di cuenta de c√≥mo se ve realmente la desesperanza</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/7a/pi/d-/7apid-1jqyjglndca2aefk2wi2u.png" alt="hopelessness.zhpg"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Recuerdo ...</a> </p></div></div><br><p>  Entonces me di cuenta de que no puedo prescindir de un osciloscopio.  Y, como ya he dicho, no estoy familiarizado con la electr√≥nica, y, por supuesto, no tengo un milagro de la tecnolog√≠a en casa.  Para comprar?  Un poco caro para un experimento ... ¬øY de qu√© se puede construir en la rodilla?  ¬øConectar una se√±al a la entrada de l√≠nea de la tarjeta de sonido?  S√≠, 4 megahercios y medio, es poco probable que comience (al menos sin alteraci√≥n).  Hmm, el Mars Rover tiene un ADC a 20 MHz, pero no es suficiente transferir un flujo sin procesar de la velocidad de la interfaz serial a la computadora.  Bueno, en alg√∫n lugar, todav√≠a tienes que procesar la se√±al para mostrar, y de hecho habr√° una cantidad bastante aceptable de bits de informaci√≥n, pero tambi√©n es para meterse con el puerto serie, escribir programas para la computadora ... Entonces pens√© que el ingeniero deber√≠a desarrollar hay una tenacidad saludable en s√≠ misma: hay un generador de im√°genes en color inactivo, hay un ADC ... Pero la imagen en blanco y negro se emite de forma estable ... Bueno, ¬°deje que el generador de se√±al se depure! </p><br><p>  <em>Digresi√≥n l√≠rica (como dicen, "La opini√≥n del alumno no tiene que coincidir con la opini√≥n del maestro, el sentido com√∫n y la axiom√°tica de Peano"):</em> cuando agregu√© generaci√≥n de color con todo tipo de multiplicaciones y otras cosas complicadas, Fmax se hundi√≥ fuertemente por el acondicionador de se√±al.  ¬øQu√© es la Fmax?  Seg√∫n tengo entendido por el libro de texto de Harris &amp; Harris, CAD para FPGA prefiere cuando Verilog se escribe no en ning√∫n caso como dentro del est√°ndar, sino "por conceptos": por ejemplo, el resultado deber√≠a ser un circuito sincr√≥nico, una especie de red ac√≠clica direccional de <em>l√≥gica combinatoria</em> (suma, multiplicaci√≥n , divisi√≥n, operaciones l√≥gicas, ...), pegado con sus entradas y salidas a las salidas y entradas de disparadores, respectivamente.  Un disparador en el borde de la se√±al de reloj recuerda el valor de su entrada para todo el siguiente ciclo de reloj, cuyo nivel debe ser estable en alg√∫n momento antes del frente y alg√∫n tiempo despu√©s (estas son dos constantes de tiempo).  Las se√±ales de las salidas de los disparadores, a su vez, despu√©s de que la se√±al del reloj comience a correr hacia las salidas de la l√≥gica combinacional (y, por lo tanto, las entradas de otros disparadores. Bueno, y las salidas del microcircuito), que tambi√©n se caracteriza por dos intervalos: el tiempo durante el cual a√∫n no se ha emitido ninguna salida. tendr√° tiempo para comenzar a cambiar, y el tiempo despu√©s del cual los cambios se calmar√°n (siempre que la entrada haya cambiado una vez).  Aqu√≠ est√° la frecuencia m√°xima a la que la l√≥gica combinacional asegura que se cumplan los requisitos de los disparadores, y esto es Fmax.  Cuando el circuito entre dos relojes deber√≠a tener tiempo para contar m√°s, la Fmax disminuye.  Por supuesto, quiero que la frecuencia sea mayor, pero si de repente salt√≥ 10 veces (o incluso la cantidad de dominios de frecuencia en el informe CAD disminuy√≥), compruebe, tal vez haya estropeado algo en alguna parte, y como resultado, CAD encontr√≥ una expresi√≥n constante y felizmente lo us√© para la optimizaci√≥n. </p><br><h3 id="raskrutka-oscillografa">  Promoci√≥n del osciloscopio </h3><br><p>  No, no despu√©s de la cual hay un giro del osciloscopio y un pu√±ado de piezas adicionales, pero el arranque del osciloscopio es como el arranque del compilador, solo para el osciloscopio. </p><br><p>  Haremos un osciloscopio, a pedido, grabando algunas muestras de la se√±al de entrada, despu√©s de lo cual solo se mostrar√° la grabaci√≥n.  Dado que necesitar√° de alguna manera dar un comando para grabar, y despu√©s de navegar por √©l, necesitaremos algunos controladores de botones, escrib√≠ no muy conveniente, pero bastante primitivo, aqu√≠ est√°: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clickThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressThreshold: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, period: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pressedIsHigh: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Boolean</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> buttonInput = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> click = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> longPress = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) })</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">SHOCK!</b>  <b class="spoiler_title">SENSACI√ìN!</b>  <b class="spoiler_title">Para que funcione, solo necesitas ...</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> cycleCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pressedCounter = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.click := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> io.longPress := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (cycleCounter === <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt) { when (pressedCounter &gt;= pressThreshold.asUInt) { io.longPress := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> }.elsewhen (pressedCounter &gt;= clickThreshold.asUInt) { io.click := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> } cycleCounter := period.asUInt pressedCounter := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } otherwise { cycleCounter := cycleCounter - <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt when (io.buttonInput === pressedIsHigh.<span class="hljs-type"><span class="hljs-type">B</span></span>) { pressedCounter := pressedCounter + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } } }</code> </pre> </div></div><br><p>     : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Oscilloscope</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> clocksPerUs: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, inputWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, windowPixelHeight: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params"> </span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> signal = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visualOffset = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">10.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> output = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) }) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> mem = <span class="hljs-type"><span class="hljs-type">SyncReadMem</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-type"><span class="hljs-type">UInt</span></span>(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> physicalPixel = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">32.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) when (io.start) { physicalPixel := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt } when (physicalPixel &lt; mem.length.asUInt) { mem.write(physicalPixel, io.signal) physicalPixel := physicalPixel + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> shiftedX = io.x + io.visualOffset <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> currentValue = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(inputWidth.<span class="hljs-type"><span class="hljs-type">W</span></span>)) currentValue := ((<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; inputWidth) - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt - mem.read( <span class="hljs-type"><span class="hljs-type">Mux</span></span>(shiftedX &lt; mem.length.asUInt, shiftedX, (mem.length - <span class="hljs-number"><span class="hljs-number">1</span></span>).asUInt) ) when (io.x &gt; windowPixelWidth.asUInt || io.y &gt; windowPixelHeight.asUInt) { <span class="hljs-comment"><span class="hljs-comment">//  1 -  io.output := !( io.y &gt; (windowPixelHeight + 10).asUInt &amp;&amp; io.y &lt; (windowPixelHeight + 20).asUInt &amp;&amp; (io.x / clocksPerUs.asUInt)(0) ) } otherwise { // , ,  // signal / 2^inputWidth ~ y / windowPixelHeight // signal * windowPixelHeight ~ y * 2^inputWidth io.output := (currentValue * windowPixelHeight.asUInt &gt;= ((io.y - 5.asUInt) &lt;&lt; inputWidth).asUInt) &amp;&amp; (currentValue * windowPixelHeight.asUInt &lt;= ((io.y + 5.asUInt) &lt;&lt; inputWidth).asUInt) } }</span></span></code> </pre> <br><p>   ‚Äî ,   : </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OscilloscopeController</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> visibleWidth: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, createButtonController: (</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=&gt;</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleButtonController</span></span></span><span class="hljs-class"> ) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Module</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> io = <span class="hljs-type"><span class="hljs-type">IO</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Bundle</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button1 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> button2 = <span class="hljs-type"><span class="hljs-type">Input</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> visibleOffset = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> start = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">Bool</span></span>()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">Output</span></span>(<span class="hljs-type"><span class="hljs-type">UInt</span></span>(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) }) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller1 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> controller2 = <span class="hljs-type"><span class="hljs-type">Module</span></span>(createButtonController()) controller1.io.buttonInput &lt;&gt; io.button1 controller2.io.buttonInput &lt;&gt; io.button2 <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> offset = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">16.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> leds = <span class="hljs-type"><span class="hljs-type">RegInit</span></span>(<span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt(<span class="hljs-number"><span class="hljs-number">4.</span></span><span class="hljs-type"><span class="hljs-type">W</span></span>)) io.start := <span class="hljs-literal"><span class="hljs-literal">false</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> when (controller1.io.longPress &amp;&amp; controller2.io.longPress) { offset := <span class="hljs-number"><span class="hljs-number">0.</span></span>asUInt io.start := <span class="hljs-literal"><span class="hljs-literal">true</span></span>.<span class="hljs-type"><span class="hljs-type">B</span></span> leds := leds + <span class="hljs-number"><span class="hljs-number">1.</span></span>asUInt }.elsewhen (controller1.io.click) { offset := offset + (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller2.io.click) { offset := offset - (visibleWidth / <span class="hljs-number"><span class="hljs-number">10</span></span>).asUInt }.elsewhen (controller1.io.longPress) { offset := offset + visibleWidth.asUInt }.elsewhen (controller2.io.longPress) { offset := offset - visibleWidth.asUInt } io.visibleOffset := offset io.leds := leds }</code> </pre> <br><p>            (,   ),      - :           ‚Äî ,    ‚Äî  ,       (   ‚Äî  ).    ‚Äî       ! ,  Verilog  ?.. </p><br><p>     - ,    FPGA: </p><br><p><img src="https://habrastorage.org/webt/fz/bf/ig/fzbfigfaqcfjsuhwmrooccvryze.png" alt="Desde el controlador de se√±al --- inmediatamente a la tabla"></p><br><p>   ‚Äî  (      IO7,   VGA_GREEN  R-2R )        : </p><br><p><img src="https://habrastorage.org/webt/71/uy/x-/71uyx-fz7rf4c9kp2yw2pwxbed4.png" alt="En an√°logo, luego en &quot;la figura&quot;, y luego --- en el gr√°fico"></p><br><p>    ,  ‚Äî   ,  ,     .     <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">   PAL</a> ‚Äî "Picture At Last (-, !)" </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">  GitHub</a> . </p><br><h2 id="vyvody">  Conclusiones </h2><br><p> Scala + Chisel       ‚Äî    ,        Higher-kinded types.     Scala- ,   Chisel  ,       .             .   ‚Äî ! </p><br><p>   : "   -?" ‚Äî   ! <em>  ...</em> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414995/">https://habr.com/ru/post/es414995/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414981/index.html">Biblioteca no escrita</a></li>
<li><a href="../es414983/index.html">Alan Kay: ¬øQu√© hizo que Xerox PARC fuera especial y qui√©n todav√≠a se parece a ellos hoy?</a></li>
<li><a href="../es414989/index.html">Sat√©lite de desechos espaciales lanzado desde la EEI</a></li>
<li><a href="../es414991/index.html">Detecci√≥n y reconocimiento de objetos de la c√°mara en ROS utilizando el paquete find_object_2d</a></li>
<li><a href="../es414993/index.html">Identificaci√≥n y clasificaci√≥n de comentarios t√≥xicos. Conferencia en Yandex</a></li>
<li><a href="../es414997/index.html">ML-Blitz: an√°lisis de las tareas de la primera ronda de clasificaci√≥n</a></li>
<li><a href="../es414999/index.html">Probador 3D de vigilancia y termistor</a></li>
<li><a href="../es415001/index.html">El operador del autom√≥vil rob√≥tico Uber, que derrib√≥ a un ciclista, vio el espect√°culo de Voz en el momento de la colisi√≥n.</a></li>
<li><a href="../es415003/index.html">Carga de archivos sin restricciones en Apple.com</a></li>
<li><a href="../es415005/index.html">Paneles solares, comandos de voz y carreras off-road: el presente y el futuro de las bicicletas el√©ctricas.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>