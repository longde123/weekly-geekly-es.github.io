<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ด ๐๐ผ ๐จ๐พโโ๏ธ ูุญู ูุนูู ุนูู ุชุทููุฑ ุจูุฆุฉ ููุนูู ูุน microservices. ุงูุฌุฒุก 1 ูู ุชุซุจูุช Kubernetes HA ุนูู ุงููุนุฏู ุงูุนุงุฑู (ุฏุจูุงู) ๐๐ผ ๐ง๐ป ๐๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูุฑุญุจุงู ุนุฒูุฒู ุงููุฑุงุก ูู ูุจุฑ! 


 ูุน ูุฐุง ุงูููุดูุฑ ุ ุฃุฑูุฏ ุฃู ุฃุจุฏุฃ ุณูุณูุฉ ูู ุงูููุงูุงุช ุญูู ูุดุฑ ุจูุฆุฉ ุชุฒุงูู ูุงููุฉ ูุน ุญุงููุงุช Kubernetes ุ ูุงูุชู ุณุชููู ุฌุงูุฒุฉ ููุชุด...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ูุญู ูุนูู ุนูู ุชุทููุฑ ุจูุฆุฉ ููุนูู ูุน microservices. ุงูุฌุฒุก 1 ูู ุชุซุจูุช Kubernetes HA ุนูู ุงููุนุฏู ุงูุนุงุฑู (ุฏุจูุงู)</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/462473/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/aq/dx/l3/aqdxl3a5akxfl3rh9b7bzc_kqji.jpeg"></p><br><h4 style=";text-align:right;direction:rtl">  ูุฑุญุจุงู ุนุฒูุฒู ุงููุฑุงุก ูู ูุจุฑ! </h4><br><p style=";text-align:right;direction:rtl">  ูุน ูุฐุง ุงูููุดูุฑ ุ ุฃุฑูุฏ ุฃู ุฃุจุฏุฃ ุณูุณูุฉ ูู ุงูููุงูุงุช ุญูู ูุดุฑ ุจูุฆุฉ ุชุฒุงูู ูุงููุฉ ูุน ุญุงููุงุช Kubernetes ุ ูุงูุชู ุณุชููู ุฌุงูุฒุฉ ููุชุดุบูู ูุฅุทูุงู ุงูุชุทุจููุงุช. <br>  ูุง ุฃุฑูุฏ ุฃู ุฃุฎุจุฑ ููุท ุนู ููููุฉ ูุดุฑ ูุชูุฉ Kubernetes ุ ูููู ุฃูุถูุง ุญูู ููููุฉ ุชูููู ูุชูุฉ ุจุนุฏ ุงูุชุซุจูุช ุ ูููููุฉ ุฅุถุงูุฉ ุฃุฏูุงุช ููุงุฆูุฉ ููุธุงุฆู ุฅุถุงููุฉ ุฅูููุง ูุงุณุชุฎุฏุงู ุจููุฉ microservice. </p><br><h2 style=";text-align:right;direction:rtl">  ุณุชุชุฃูู ูุฐู ุงูุฏูุฑุฉ ูู ุฃุฑุจุน ููุงูุงุช ุนูู ุงูุฃูู: </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู ุฃูููุง ุ ุณุฃุฎุจุฑู ุนู ููููุฉ ุชุซุจูุช ูุฌููุนุฉ kubernet ุขููุฉ ูู ุงููุดู ุนูู ุงูุญุฏูุฏ ุงูุนุงุฑู ุ ูููููุฉ ุชุซุจูุช ููุญุฉ ูุนูููุงุช ููุงุณูุฉ ูุชูููู ุงููุตูู ุฅูููุง ุ ูููููุฉ ุชุซุจูุช ุฌูุงุฒ ุงูุชุญูู ูู ุงูุฏุฎูู. </li><li style=";text-align:right;direction:rtl">  ูู ููุงูุฉ ุซุงููุฉ ุ ุณุฃูุถุญ ูู ููููุฉ ูุดุฑ ูุฌููุนุฉ ุชุฌุงูุฒ ูุดู Ceph ูููููุฉ ุงูุจุฏุก ูู ุงุณุชุฎุฏุงู ูุญุฏุงุช ุชุฎุฒูู RBD ูู ูุธุงู Kubernetes ุงูุฎุงุต ุจูุง.  ุณูู ุฃุชุทุฑู ุฃูุถูุง ุฅูู ุฃููุงุน ุงูุชุฎุฒูู ุงูุฃุฎุฑู ููููุงู (ุงููุณุชูุฏุนุงุช) ูุณุฃูุธุฑ ูู ุงูุชุฎุฒูู ุงููุญูู ุจูุฒูุฏ ูู ุงูุชูุงุตูู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณุฃุฎุจุฑู ุจููููุฉ ุชูุธูู ุชุฎุฒูู S3 ุงููุชุณุงูุญ ูุน ุงูุฃุฎุทุงุก ุงุณุชูุงุฏูุง ุฅูู ูุฌููุนุฉ CEPH ุงูุชู ุชู ุฅูุดุงุคูุง </li><li style=";text-align:right;direction:rtl">  ูู ุงูููุงูุฉ ุงูุซุงูุซุฉ ุ ุณุฃุดุฑุญ ููููุฉ ูุดุฑ ูุธุงู ูุฌููุนุฉ ุชุฌุงูุฒ ุงููุดู MySql ูู ูุฌููุนุฉ Kubernetes ุงูุฎุงุตุฉ ุจูุง ุ ููู Percona XtraDB Cluster ุนูู Kubernetes.  ููุฐูู ุณูู ุฃุตู ูู ุงููุดููุงุช ุงูุชู ูุงุฌููุงูุง ุนูุฏูุง ูุฑุฑูุง ููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅูู kubernetes. </li><li style=";text-align:right;direction:rtl">  ูู ุงูููุงูุฉ ุงูุฑุงุจุนุฉ ุ ุณุฃุญุงูู ุฃู ุฃุฌูุน ูู ุดูุก ูุฃุฎุจุฑู ุจููููุฉ ูุดุฑ ูุชุดุบูู ุชุทุจูู ูุณุชุฎุฏู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููุฌูุฏุงุช ceph.  ุณูู ุฃุฎุจุฑู ุจููููุฉ ุชูููู ุฌูุงุฒ ุงูุชุญูู ูู ุงููุตูู ูููุตูู ุฅูู ุชุทุจูููุง ูู ุงูุฎุงุฑุฌ ูุฎุฏูุฉ ุทูุจ ุงูุดูุงุฏุฉ ุงูุชููุงุฆูุฉ ูู Let's Encrypt.  ุขุฎุฑ ูู ููููุฉ ุงูุญูุงุธ ุนูู ูุฐู ุงูุดูุงุฏุงุช ุชููุงุฆูุง ุญุชู ุงูุขู.  ุณูุชุทุฑู ุฃูุถูุง ุฅูู RBAC ูู ุณูุงู ุงููุตูู ุฅูู ููุญุฉ ุงูุชุญูู.  ุณุฃุฎุจุฑู ุจุงุฎุชุตุงุฑ ุนู ูููู ูุชุซุจูุชู. <br>  ุฅุฐุง ููุช ููุชููุง ุจุงููุนูููุงุช ุงููุงุฑุฏุฉ ูู ูุฐู ุงูููุดูุฑุงุช ุ ููุฑุญุจุงู ุจู! <a name="habracut"></a></li></ol><br><h2 style=";text-align:right;direction:rtl">  ุฏุฎูู: </h2><br><p style=";text-align:right;direction:rtl">  ูู ูู ูุฐู ุงูููุงูุงุชุ  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุฃููุฆู ุงูุฐูู ุจุฏุฃูุง ููุชู ุฑุญูุชูู ูู ุฏุฑุงุณุฉ Kubernetes.  ุฃูุถูุง ุ ุณุชููู ูุฐู ุงูุฏูุฑุฉ ูููุฏุฉ ูููููุฏุณูู ุงูุฐูู ูููุฑูู ูู ุงูุงูุชูุงู ูู ูุชุฑุงุตุฉ ุฅูู ุงูุฎุฏูุงุช ุงูุตุบูุฑุฉ.  ูู ูุง ุชู ูุตูู ูู ุชุฌุฑุจุชู ุ ุจูุง ูู ุฐูู ุงูุชุฌุฑุจุฉ ุงูุชู ุชู ุงูุญุตูู ุนูููุง ุนูุฏ ุชุฑุฌูุฉ ุงูุนุฏูุฏ ูู ุงููุดุงุฑูุน ูู ูุชุฑุงุตุฉ ุฅูู Kubernetes.  ูู ุงููููู ุฃู ุชููู ุจุนุถ ุฃุฌุฒุงุก ุงูููุดูุฑุงุช ุฐุงุช ุฃูููุฉ ูููููุฏุณูู ุฐูู ุงูุฎุจุฑุฉ. </p><br><h4 style=";text-align:right;direction:rtl">  ูุง ูู ุฃููุฑ ููู ุจุงูุชูุตูู ูู ูุฐู ุงูุณูุณูุฉ ูู ุงูููุดูุฑุงุช: </h4><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงุดุฑุญ ุจุงูุชูุตูู ูุงููุฉ ุจุฏุงูุงุช kubernetes ุ ูุซู: ุฌุฑุงุจ ุ ูุดุฑ ุ ุฎุฏูุฉ ุ ุฅุฏุฎุงู ุ ุฅูุฎ. </li><li style=";text-align:right;direction:rtl">  ุณูู ุฃุนุชุจุฑ CNI (ูุงุฌูุฉ ุดุจูุฉ ุงูุญุงููุฉ) ุณุทุญูุฉ ููุบุงูุฉ ุ ููุญู ูุณุชุฎุฏู callico ูุจุงูุชุงูู ุญููู ุฃุฎุฑู ุ ูุณุฃุฏุฑุฌ ููุท. </li><li style=";text-align:right;direction:rtl">  ุนุงูู ุจูุงุก ุตูุฑุฉ ุนูููุฉ ุจูุงุก. </li><li style=";text-align:right;direction:rtl">  ุนูููุงุช CI \ CD.  (ุฑุจูุง ููุดูุฑ ูููุตู ุ ูููู ุจุนุฏ ุงูุฏูุฑุฉ ุจุฃููููุง) </li><li style=";text-align:right;direction:rtl">  ุฑุฃุณ.  ููุฏ ูุชุจ ุงููุซูุฑ ุนูู ุ ุณูู ุฃุชุทุฑู ููุท ุฅูู ุนูููุฉ ุชุซุจูุชู ูู ุงููุฌููุนุฉ ูุฅุนุฏุงุฏ ุงูุนููู. </li></ul><br><h4 style=";text-align:right;direction:rtl">  ูุง ุฃุฑูุฏ ุฃู ุฃููุฑ ููู ุจุงูุชูุตูู: </h4><br><ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุนูููุฉ ูุดุฑ ูุธุงู Kubernet ุฎุทูุฉ ุจุฎุทูุฉ.  ุณุฃุณุชุฎุฏู kubeadm.  ูููู ูู ุงูููุช ููุณู ุ ุณูู ุฃููู ูุธุฑุฉ ุชูุตูููุฉ ุชูุตูููุฉ ุนูู ุนูููุฉ ุชุซุจูุช ูุชูุฉ ุนูู ุงููุนุฏู ุงูุนุงุฑู ุ ูุฃููุงุน ูุฎุชููุฉ ูู ุชุซุจูุช ETCD ุ ูุชูููู ูููุงุช kube admina.  ุณุฃุญุงูู ุชูุถูุญ ุฌููุน ุฎูุงุฑุงุช ุงูููุงุฒูุฉ ููุญุฏุฉ ุงูุชุญูู ูู Ingress ูุงููุฑู ูู ุฃูุธูุฉ ุงููุตูู ุงููุฎุชููุฉ ูุฃูุธูุฉ ุงูุนูู ุฅูู api ุงูุฎุงุต ุจุงูุฎุงุฏู. <br>  ุฃุนูู ุฃู ููุงู ุงูููู ุงูุนุฏูุฏ ูู ุงูุฃุฏูุงุช ุงูุฑุงุฆุนุฉ ููุดุฑ kubernetes ุ ุนูู ุณุจูู ุงููุซุงู ุ kubespray ุฃู ููุณ ุฑุนุงุฉ ุงูุจูุฑ.  ุฑุจูุง ุณูููู ุฃูุซุฑ ููุงุกูุฉ ูุดุฎุต ูุง ูุงุณุชุฎุฏุงููุง.  ูููู ุ ุฃุนุชูุฏ ุ ุฃู ููุงู ุงูุนุฏูุฏ ูู ุงููููุฏุณูู ุงูุฐูู ูุฑุบุจูู ูู ุงููุธุฑ ูู ุงููุถูุฉ ุจูุฒูุฏ ูู ุงูุชูุตูู. </li><li style=";text-align:right;direction:rtl">  ูุตุทูุญุงุช CEPH ูุชุซุจูุช ูุฌููุนุฉ CEPH ุฎุทูุฉ ุจุฎุทูุฉ ุ ุจุงูุฅุถุงูุฉ ุฅูู ุฅุฑุดุงุฏุงุช ุฎุทูุฉ ุจุฎุทูุฉ ุญูู ุชูุตูู ุชุฎุฒูู ceph ุจุงููุฌููุนุฉ ุงูุชู ุฃูุดุฃุชูุง Kubernetes. </li><li style=";text-align:right;direction:rtl">  ุงููุฎุงุฒู ุงููุญููุฉ ุ ูุงูุงุชุตุงู ุจูุฌููุนุฉ kubernetes ุ ููุฐูู ุงูุงุฎุชูุงูุงุช ูู ุงูุงุชุตุงูุงุช ูุซู hostpath ุ ุฅูุฎ. </li><li style=";text-align:right;direction:rtl">  ูุดุบูู kubernetes ููุดุฑ Percona XtraDB Cluster ุจูุณุงุนุฏุฉ ุงููุดุบู ุ ููุฐูู ูุญุงููุฉ ุงูุชุญุฏุซ ุนู ุฅูุฌุงุจูุงุช ูุณูุจูุงุช ูุซู ูุฐุง ุงูุญู ุจุนุฏ ุณุชุฉ ุฃุดูุฑ ูู ุงูุฎุจุฑุฉ ูู ุงูุฅูุชุงุฌ.  ูุณุฃุดุงุฑู ุฃูุถูุง ุจุนุถ ุงูุฎุทุท ููุถุน ุงูููุณุงุช ุงูุฃุฎูุฑุฉ ุนูู ุงููุดุบู ูู ุจูุฑูููุง. </li></ul><br><h2 style=";text-align:right;direction:rtl">  ุฌุฏูู ุงููุญุชููุงุช: </h2><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุงุฆูุฉ ุงููุถูููู ุ ููุงุฑุฏ ุงููุถูู ุ ุฅุตุฏุงุฑุงุช ูุธุงู ุงูุชุดุบูู ูุงูุจุฑุงูุฌ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">Kubernetes ุงูุนูููุฏูุฉ ูุฎุทุท HA</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุจู ุฃู ุชุจุฏุฃ ุฃู ูุจู ุฃู ุชุจุฏุฃ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุฃ ููู create-config.sh</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุญุฏูุซ ููุงุฉ ูุธุงู ุงูุชุดุบูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุนุฏุงุฏ ุงูุนูุฏ ุชุซุจูุช Kubelet ู Kubectl ู Kubeadm ู Docker</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุซุจูุช ETCD (ุฎูุงุฑุงุช ูุฎุชููุฉ)</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุทูุงู ุฃูู ูุนุงูุฌ kubernetes</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">CNI ูุงูููู ุงูุชุซุจูุช</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุทูุงู ูุนุงูุฌุงุช kubernetes ุงูุซุงููุฉ ูุงูุซุงูุซุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุฅุถุงูุฉ ุนูุฏุฉ ุนุงูู ุฅูู ุงููุชูุฉ</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุซุจูุช haproxy ุนูู ุงูุนูุฏ ุงูุนุงูู ู HA</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุซุจูุช ุฌูุงุฒ ุงูุชุญูู ูู ุงูุฏุฎูู</a> </li><li style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชุซุจูุช Web UI (ููุญุฉ ุงููุนูููุงุช)</a> </li></ol><br><a name="vm"></a><br><h2 style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ููุฌูุฉ ุงููุถูููู </h2><br><p style=";text-align:right;direction:rtl">  ุณูุชู ูุถุน ุฌููุน ุงูุนูุฏ ุงูุฎุงุตุฉ ุจูุฌููุนุชู ุนูู ุฃุฌูุฒุฉ ุงูุชุฑุงุถูุฉ ูุน ูุธุงู ุงูุชุฏุงุฏ ุฏุจูุงู 9 ุงููุซุจุช ูุณุจููุง ูุน kernel 4.19.0-0.bpo.5-amd64.  ูููุญุงูุงุฉ ุงูุงูุชุฑุงุถูุฉ ุ ุฃุณุชุฎุฏู Proxmox VE. </p><br><h4 style=";text-align:right;direction:rtl">  ุงูุฌุฏูู VM ูุฎุตุงุฆุต ุฃุฏุงุฆูุง: </h4><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><th>  <b>ุงุณู</b> </th><th>  <b>ุนููุงู IP</b> </th><th>  <b>ุชุนููู</b> </th><th>  <b>ูุญุฏุฉ ุงููุนุงูุฌุฉ ุงููุฑูุฒูุฉ</b> </th><th>  <b>MEM</b> </th><th>  <b>DISK1</b> </th><th>  <b>DISK2</b> </th></tr><tr><td>  master01 </td><td>  10.73.71.25 </td><td>  ุนูุฏุฉ ุฑุฆูุณูุฉ </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  --- </td></tr><tr><td>  master02 </td><td>  10.73.71.26 </td><td>  ุนูุฏุฉ ุฑุฆูุณูุฉ </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  --- </td></tr><tr><td>  master03 </td><td>  10.73.71.27 </td><td>  ุนูุฏุฉ ุฑุฆูุณูุฉ </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  --- </td></tr><tr><td>  worknode01 </td><td>  10.73.75.241 </td><td>  ุนูุฏุฉ ุงูุนูู </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  SSD </td></tr><tr><td>  worknode02 </td><td>  10.73.75.242 </td><td>  ุนูุฏุฉ ุงูุนูู </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  SSD </td></tr><tr><td>  worknode03 </td><td>  10.73.75.243 </td><td>  ุนูุฏุฉ ุงูุนูู </td><td>  4vcpu </td><td>  4GB </td><td>  HDD </td><td>  SSD </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ููุณ ูู ุงูุถุฑูุฑู ุฃู ูููู ูุฏูู ูุซู ูุฐุง ุงูุชูููู ูู ุงูุฃุฌูุฒุฉ ุ ููู ูุง ุฒูุช ุฃูุตุญู ุจุงูุงูุชุฒุงู ุจุชูุตูุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุซุงุฆู ุงูุฑุณููุฉ</a> ุ ูุจุงููุณุจุฉ ููุงุณุงุชุฐุฉ ุ ูุฌุจ ุฒูุงุฏุฉ ููุฏุงุฑ ุฐุงูุฑุฉ ุงููุตูู ุงูุนุดูุงุฆู ุฅูู 4 ุบูุบุงุจุงูุช ุนูู ุงูุฃูู.  ูุงุณุชุดุฑุงููุง ูููุณุชูุจู ุ ุณุฃููู ุฃูู ุจุนุฏุฏ ุฃูู ุ ุงูุชุดูุช ููุงุทู ุงูุฎูู ูู ุนูู CNI Callico <br>  Ceph ูู ุฃูุถุง ุดุฑู ุฌุฏุง ูู ุญูุซ ุงูุฐุงูุฑุฉ ูุฃุฏุงุก ุงููุฑุต. <br>  ุชุนูู ููุดุขุช ุงูุฅูุชุงุฌ ูุฏููุง ุฏูู ูุญุงูุงุฉ ุงูุชุฑุงุถูุฉ ูููุนุงุฏู ุ ููููู ุฃุนุฑู ุงูุนุฏูุฏ ูู ุงูุฃูุซูุฉ ุญูุซ ูุงูุช ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ ุฐุงุช ุงูููุงุฑุฏ ุงููุชูุงุถุนุฉ ูุงููุฉ.  ูู ูุฐุง ูุชููู ุนูู ุงุญุชูุงุฌุงุชู ูุฃุนุจุงุก ุงูุนูู. </p><br><h2 style=";text-align:right;direction:rtl">  ูุงุฆูุฉ ูุฅุตุฏุงุฑุงุช ุงูุจุฑุงูุฌ </h2><br><div class="scrollable-table" style=";text-align:right;direction:rtl"><table style=";text-align:right;direction:rtl"><tbody><tr><th>  <b>ุงุณู</b> </th><th>  <b>ูุต</b> </th></tr><tr><td>  Kubernetes </td><td>  1.15.1 </td></tr><tr><td>  ุนุงูู ูููุงุก </td><td>  19.3.1 </td></tr></tbody></table></div><br><p style=";text-align:right;direction:rtl">  ุจุฏุกูุง ูู ุงูุฅุตุฏุงุฑ 1.14 ุ ุชููู Kubeadm ุนู ุฏุนู ุฅุตุฏุงุฑ API v1alpha3 ูุงูุชูู ุจุงููุงูู ุฅูู ุฅุตุฏุงุฑ API v1beta1 ุ ูุงูุฐู ุณูุฏุนูู ูู ุงููุณุชูุจู ุงููุฑูุจ ุ ูุฐูู ูู ูุฐู ุงูููุงูุฉ ุณุฃุชุญุฏุซ ููุท ุนู v1beta1. <br>  ูุฐูู ุ ูุนุชูุฏ ุฃูู ูุฏ ุฃุนุฏุฏุช ุขูุงุช ูุฌููุนุฉ kubernetes.  ูููู ุงููุตูู ุฅูููู ุฌููุนูุง ุนุจุฑ ุงูุดุจูุฉ ุ ููุฏููู "ุงุชุตุงู ุฅูุชุฑูุช" ุจุงูุฅูุชุฑูุช ููุชู ุชุซุจูุช ูุธุงู ุชุดุบูู "ูุธูู" ุนูููู. <br>  ุจุงููุณุจุฉ ููู ุฎุทูุฉ ูู ุฎุทูุงุช ุงูุชุซุจูุช ุ ุณุฃูุถุญ ุงูุขูุงุช ุงูุชู ูุชู ุชูููุฐ ุฃูุฑ ุฃู ูุฌููุนุฉ ุงูุฃูุงูุฑ ุนูููุง.  ุชูููุฐ ุฌููุน ุงูุฃูุงูุฑ ูุฌุฐุฑ ุ ูุง ูู ููุต ุนูู ุฎูุงู ุฐูู. <br>  ุชุชููุฑ ุฌููุน ูููุงุช ุงูุชูููู ุ ุจุงูุฅุถุงูุฉ ุฅูู ุจุฑูุงูุฌ ูุตู ูุฅุนุฏุงุฏูุง ุ ููุชูุฒูู ูู <a href="">ุฌูุซุจ ุงูุฎุงุต</a> ุจู <br>  ูุฐูู ุฏุนููุง ูุจุฏุฃ. </p><br><a name="ha-image"></a><br><h2 style=";text-align:right;direction:rtl">  Kubernetes ุงูุนูููุฏูุฉ ูุฎุทุท HA </h2><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ch/mx/pg/chmxpgzdyk0bvxwx7-6lawqfmvo.jpeg"><br>  ุฑุณู ุชุฎุทูุทู ุชูุฑูุจู ููุฌููุนุฉ HA.  ุฅู ููุงูู ุตุงุฏู ุชูุงููุง ุ ููููู ุณุฃุญุงูู ุดุฑุญ ุฐูู ุจุงุฎุชุตุงุฑ ูุจุณุงุทุฉ ุดุฏูุฏุฉ ุ ุฏูู ุงูุฎูุถ ูู ุงููุธุฑูุฉ ุจุดูู ุฎุงุต. <br>  ูุฐูู ุ ุณูู ุชุชุฃูู ุงููุฌููุนุฉ ุงูุฎุงุตุฉ ุจูุง ูู ุซูุงุซ ููุงุท ุฑุฆูุณูุฉ ูุซูุงุซุฉ ุนูุฏ ุนุงููุฉ.  ูู ูู ุนูุฏุฉ ุฑุฆูุณูุฉ ูู kubernetes ุ ููุง ุฅูู ุฐูู (ุงูุฃุณูู ุงูุฎุถุฑุงุก ูู ุงูุฑุณู ุงูุชุฎุทูุทู) ูุณุชุนูู ุฃุฌุฒุงุก ุฎุฏูุฉ kubernetes ููุง ุ  ุฏุนููุง ูุฏุนู ููู ุจุดูู ุนุงู - kubeapi. <br>  ูู ุฎูุงู ุงููุชูุฉ ุงูุฑุฆูุณูุฉ etcd ุ ุชุชุจุงุฏู ุงูุนูุฏ ุญุงูุฉ ุงููุชูุฉ kubernetes.  ุณุฃุดูุฑ ุฅูู ููุณ ุนูุงููู ููุงุท ุฅุฏุฎุงู ูุญุฏุฉ ุงูุชุญูู ูู ุงูุฏุฎูู ูุญุฑูุฉ ุงููุฑูุฑ ุงูุฎุงุฑุฌูุฉ (ุงูุฃุณูู ุงูุญูุฑุงุก ูู ุงูุฑุณู ุงูุชุฎุทูุทู) <br>  ุนูู ุงูุนูุฏ ุงูุนุงููุฉ ุ ูุนูู kubelet ุจุงููุณุจุฉ ููุง ุ ูุงูุฐู ูุชุตู ุจุฎุงุฏู api kubernetes ุนุจุฑ haproxy ุงููุซุจุช ูุญูููุง ุนูู ูู ุนูุฏุฉ ุนุงูู.  ุจูุง ุฃู ุนููุงู api ุงูุฎุงุต ุจุงููููู ูู kubelet ุ ูุณูู ุฃุณุชุฎุฏู ุงููุถูู ุงููุญูู 127.0.0.1:6443 ุ ูุณูููู haproxy ุนูู roundrobin ุจุชูุฒูุน ุงูุทูุจุงุช ุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุงูุซูุงุซุฉ ุ ููุง ุณูุชุญูู ูู ุชููุฑ ุงูุนูุฏ ุงูุฑุฆูุณูุฉ.  ุณูุณูุญ ููุง ูุฐุง ุงููุฎุทุท ุจุฅูุดุงุก HA ุ ููู ุญุงูุฉ ูุดู ุฅุญุฏู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุ ุณุชุฑุณู ุงูุนูุฏ ุงููููุตูุฉ ุทูุจุงุช ุจูุฏูุก ุฅูู ุงูุนูุฏุชูู ุงูุฑุฆูุณูุชูู ุงููุชุจููุชูู. </p><br><a name="begin"></a><br><h2 style=";text-align:right;direction:rtl">  ูุจู ุฃู ุชุจุฏุฃ </h2><br><p style=";text-align:right;direction:rtl">  ูุจู ุงูุจุฏุก ูู ุงูุนูู ุนูู ูู ุนูุฏุฉ ูู ุงููุชูุฉ ุ ุณูุฒูุฏ ุงูุญุฒู ุงูุชู ุณูุญุชุงุฌูุง ููุนูู: </p><br><pre style=";text-align:right;direction:rtl"><code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y curl apt-transport-https git</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุ ุงูุณุฎ ูุณุชูุฏุน ุงูุชุฎุฒูู ุจุงุณุชุฎุฏุงู ููุงูุจ ุงูุชูููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">sudo -i git clone https://github.com/rjeka/kubernetes-ceph-percona.git</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุชุทุงุจู ุนููุงู IP ูููุถูููู ุนูู ุงููุนุงูุฌุงุช ูุน ุงูุนููุงู ุงูุฐู ุณูุณุชูุน ุฅููู ุฎุงุฏู kubernetes </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">hostname &amp;&amp; hostname -i master01 10.73.71.25</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููุฐุง ูุฌููุน ุงูุนูุฏ ุงูุฑุฆูุณูุฉ. </p><br><p style=";text-align:right;direction:rtl">  ุชุฃูุฏ ูู ุชุนุทูู SWAP ุ ูุฅูุง ูุฅู kubeadm ุณูููู ุฎุทุฃ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[ERROR Swap]: running with swap on is not supported. Please disable swap</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุชุนุทูู ุงูุฃูุฑ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">swapoff -a</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุฐูุฑ ุฃู ุชุนูู ูู / etc / fstab </p><br><a name="create-config"></a><br><h2 style=";text-align:right;direction:rtl">  ุงููุฃ ููู create-config.sh </h2><br><p style=";text-align:right;direction:rtl">  ูููุก ุงูุชููููุงุช ุงููุงุฒูุฉ ูุชุซุจูุช ูุธุงู kubernetes ุชููุงุฆููุง ุ ููุช ุจุชุญููู ุจุฑูุงูุฌ ูุตู ุตุบูุฑ create-config.sh.  ุชุญุชุงุฌ ุฅูู ููุก ููู ุญุฑููุง 8 ุฎุทูุท.  ุฃุดุฑ ุฅูู ุนูุงููู IP ูุงุณู ูุถูู ุฃุณูุงุฏู.  ููุฐูู ุชุญุฏูุฏ ุงูุฑูุฒ ุงููููุฒ ุ ูุง ููููู ุชุบููุฑู.  ุณุฃูุฏู ุฃุฏูุงู ูุฐุง ุงูุฌุฒุก ูู ุงูุจุฑูุงูุฌ ุงููุตู ุงูุฐู ุชุญุชุงุฌ ุฅูู ุฅุฌุฑุงุก ุชุบููุฑุงุช ุนููู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#!/bin/bash ####################################### # all masters settings below must be same ####################################### # master01 ip address export K8SHA_IP1=10.73.71.25 # master02 ip address export K8SHA_IP2=10.73.71.26 # master03 ip address export K8SHA_IP3=10.73.71.27 # master01 hostname export K8SHA_HOSTNAME1=master01 # master02 hostname export K8SHA_HOSTNAME2=master02 # master03 hostname export K8SHA_HOSTNAME3=master03 #etcd tocken: export ETCD_TOKEN=9489bf67bdfe1b3ae077d6fd9e7efefd #etcd version export ETCD_VERSION="v3.3.10"</code> </pre><br><a name="kernel"></a><br><h2 style=";text-align:right;direction:rtl">  ุชุญุฏูุซ ููุงุฉ ูุธุงู ุงูุชุดุบูู </h2><br><p style=";text-align:right;direction:rtl">  ูุฐู ุงูุฎุทูุฉ ุงุฎุชูุงุฑูุฉ ุ ูุธุฑูุง ูุฃู ุงูููุงุฉ ุณูู ุชุญุชุงุฌ ุฅูู ุชุญุฏูุซ ูู ุงูููุงูุฐ ุงูุฎูููุฉ ุ ูููููู ุงูููุงู ุจุฐูู ุนูู ูุณุคูููุชู ุงูุฎุงุตุฉ ููุฎุงุทุฑู.  ุฑุจูุง ูู ุชูุงุฌู ูุฐู ุงููุดููุฉ ุฃุจุฏูุง ุ ูุฅุฐุง ุญุฏุซ ุฐูู ุ ููููู ุชุญุฏูุซ ุงูููุงุฉ ุญุชู ุจุนุฏ ูุดุฑ ุงูููุจุฑููุช.  ุจุดูู ุนุงู ุ ุนููู ุฃู ุชูุฑุฑ. <br>  ูุทููุจ ุชุญุฏูุซ kernel ูุฅุตูุงุญ ุฎูู ุนุงูู ุงูุฑุตูู ุงููุฏูู ุ ูุงูุฐู ุชู ุฅุตูุงุญู ููุท ูู ุฅุตุฏุงุฑ linux kernel 4.18.  ููููู ูุฑุงุกุฉ ุงููุฒูุฏ ุญูู ูุฐุง ุงูุฎุทุฃ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุชู ุงูุชุนุจูุฑ ุนู ุฎุทุฃ ูู ุงูุฃุนุทุงู ุงูุฏูุฑูุฉ ููุงุฌูุฉ ุงูุดุจูุฉ ุนูู ุนูุฏ kubernetes ุจุณุจุจ ุงูุฎุทุฃ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">waiting for eth0 to become free. Usage count = 1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุซุจูุช ูุธุงู ุงูุชุดุบูู ุ ุญุตูุช ุนูู ุฅุตุฏุงุฑ kernel 4.9 </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">uname -a Linux master01 4.9.0-7-amd64 <span class="hljs-comment"><span class="hljs-comment">#1 SMP Debian 4.9.110-3+deb9u2 (2018-08-13) x86_64 GNU/Linux</span></span></code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู ูู ุขูุฉ ู kubernetes ูููุฐ <br>  ุงูุฎุทูุฉ ุฑูู 1 <br>  ุฅุถุงูุฉ ููุงูุฐ ุงูุนูุฏุฉ ุฅูู ูุงุฆูุฉ ุงููุตุฏุฑ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">echo deb http://ftp.debian.org/debian stretch-backports main &gt; /etc/apt/sources.list apt-get update apt-cache policy linux-compiler-gcc-6-x86</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุฑูู 2 <br>  ุญุฒูุฉ ุงูุชุซุจูุช </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt install -y -t stretch-backports linux-image-amd64 linux-headers-amd64</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุฑูู 3 <br>  ุชูููุฏ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">reboot</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุฃูุฏ ูู ุฃู ูู ุดูุก ุนูู ูุง ูุฑุงู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">uname -a Linux master01 4.19.0-0.bpo.5-amd64 #1 SMP Debian 4.19.37-4~bpo9+1 (2019-06-19) x86_64 GNU/Linux</code> </pre><br><a name="kubelet"></a><br><h2 style=";text-align:right;direction:rtl">  ุฅุนุฏุงุฏ ุงูุนูุฏ ุชุซุจูุช Kubelet ู Kubectl ู Kubeadm ู Docker </h2><br><h4 style=";text-align:right;direction:rtl">  ุชุซุจูุช Kubelet ุ Kubectl ุ Kubeadm </h4><br><p style=";text-align:right;direction:rtl">  ูุถุน ุนูู ุฌููุน ุงูุนูุฏ ูู ุงููุชูุฉ ุ ูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุซุงุฆู kubernetes</a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl</code> </pre> <br><h4 style=";text-align:right;direction:rtl">  ุชุซุจูุช ุนุงูู ุงููููุงุก </h4><br><p style=";text-align:right;direction:rtl">  ุชุซุจูุช ุนุงูู ูููุงุก ูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุนูููุงุช ุงููุงุฑุฏุฉ ูู ุงููุซุงุฆู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><br></a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get remove docker docker-engine docker.io containerd runc apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - apt-key fingerprint 0EBFCD88</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">add-apt-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable"</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get update apt-get install docker-ce docker-ce-cli containerd.io</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุฑููุจ ุชุฑููุจ Kubelet ุ Kubectl ุ Kubeadm ูุฑุณู ุงูุณูู ุจุงุณุชุฎุฏุงู ansible</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฌููุนุฉ ุงููุงุฌุณุชูุฑ ุ ูู ุจุชุณุฌูู ูุงุฌุณุชูุฑ ุงูููููุฉ ุงูููุฑูุฉ. <br>  ูู ูุฌููุนุฉ ุงูุนูุงู ุ ุงูุชุจ ip ููุนูุฏ ุงูุนูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># sudo c  ansible-playbook -i hosts.ini kubelet.yaml -K ansible-playbook -i hosts.ini docker.yaml -K # sudo  ansible-playbook -i hosts.ini kubelet.yaml ansible-playbook -i hosts.ini docker.yaml</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ูุง ุชุฑุบุจ ูู ุงุณุชุฎุฏุงู ุนุงูู ูููุงุก ูุณุจุจ ูุง ุ ููููู ุงุณุชุฎุฏุงู ุฃู CRI.  ููููู ุฃู ุชูุฑุฃ ุนููุง ุ ุนูู ุณุจูู ุงููุซุงู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุ ูููู ูุฐุง ุงูููุถูุน ุฎุงุฑุฌ ุนู ูุทุงู ูุฐู ุงูููุงูุฉ. </p><br><a name="etcd"></a><br><h2 style=";text-align:right;direction:rtl">  ETCD ุงูุชุซุจูุช </h2><br><p style=";text-align:right;direction:rtl">  ูู ุฃุชุนูู ูู ุงููุธุฑูุฉ ุ ุจุงุฎุชุตุงุฑ: etcd ูู ุชุฎุฒูู ูููุฉ ููุฒุนุฉ ููุชูุญ ุงููุตุฏุฑ.  etcd ููุชูุจ ูู GO ููุณุชุฎุฏู ูู kubernetes ูู ุงููุงูุน ุ ููุงุนุฏุฉ ุจูุงูุงุช ูุชุฎุฒูู ุญุงูุฉ ุงููุชูุฉ.  ููุญุตูู ุนูู ูุฑุงุฌุนุฉ ุฃูุซุฑ ุชูุตููุงู ุ ุฑุงุฌุน <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู kubernetes</a> . <br>  ูููู ุชุซุจูุช etcd ุจุนุฏุฉ ุทุฑู.  ููููู ุชุซุจูุชู ูุญูููุง ูุชุดุบููู ุนูู ุฃูู ุจุฑูุงูุฌ ุฎูู ุ ูููููู ุชุดุบููู ูู ุญุงููุงุช ุงูุฅุฑุณุงุก ุ ูููููู ุชุซุจูุชู ุญุชู ููุฑูุฉ kubernetes.  ููููู ุชุซุจูุชู ุจุงููุฏ ุ ุฃู ููููู ุชุซุจูุชู ุจุงุณุชุฎุฏุงู kubeadm (ูู ุฃุฌุฑุจ ูุฐู ุงูุทุฑููุฉ).  ูููู ุชุซุจูุชูุง ุนูู ุฃุฌูุฒุฉ ุงููุชูุฉ ุฃู ุงูุฎูุงุฏู ุงููุฑุฏูุฉ. <br>  ุณูู ุฃููู ุจุชุซุจูุช ุงูุฎ ุนูู ุงููุณุชูู ุงููุญูู ุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ูุฃุนูู ุจูุซุงุจุฉ ุจุฑูุงูุฌ ุฎูู ูู ุฎูุงู systemd ุ ุจุงูุฅุถุงูุฉ ุฅูู ุงููุธุฑ ูู ุงูุชุซุจูุช ูู ุนุงูู ูููุงุก.  ูููููู ุงุณุชุฎุฏุงู etcd ุจุฏูู TLS ุ ุฅุฐุง ููุช ุจุญุงุฌุฉ ุฅูู TLS ุ ูุฑุงุฌุน ูุซุงุฆู etcd ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">kubernetes ููุณูุง</a> <br>  ุฃูุถุง ูู ุจูุฏู github ุณูููู anbook - playbook ูุชุซุจูุช etcd ูุน ุฅุทูุงู ูู ุฎูุงู systemd. </p><br><h4 style=";text-align:right;direction:rtl">  ุงูุฎูุงุฑ ุฑูู 1 <br>  ุชุซุจูุช ูุญููุง ุ ูู ุฎูุงู ุชุดุบูู systemd </h4><br><p style=";text-align:right;direction:rtl">  ุนูู ุฌููุน ุงูุฃุณุงุชุฐุฉ: (ุนูู ุนูุฏ ุนูู ุงููุชูุฉ ุ ูุฐู ุงูุฎุทูุฉ ููุณุช ุถุฑูุฑูุฉ) <br>  ุงูุฎุทูุฉ ุฑูู 1 <br>  ูู ุจุชูุฒูู ููู ุงูุฃุฑุดูู ูุน etcd: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">mkdir archives cd archives export etcdVersion=v3.3.10 wget https://github.com/coreos/etcd/releases/download/$etcdVersion/etcd-$etcdVersion-linux-amd64.tar.gz tar -xvf etcd-$etcdVersion-linux-amd64.tar.gz -C /usr/local/bin/ --strip-components=1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุฑูู 2 <br>  ุฅูุดุงุก ููู ุงูุชูููู ู ETCD </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">cd .. ./create-config.sh etcd</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุจู ุงูุจุฑูุงูุฌ ุงููุตู ุงููููุฉ etcd ููุฏุฎูุงุช ุ ููููู ุจุฅูุดุงุก ููู ุชููุฆุฉ ูู ุฏููู etcd.  ุจุนุฏ ุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุ ุณูุชู ูุถุน ููู ุงูุชูููู ุงูููุงุฆู ูู ุฏููู etcd. <br>  ุจุงููุณุจุฉ ูุฌููุน ุงูุชููููุงุช ุงูุฃุฎุฑู ุ ูุนูู ุงูุจุฑูุงูุฌ ุงููุตู ุนูู ููุณ ุงููุจุฏุฃ.  ูุณุชุบุฑู ุจุนุถ ุงููุฏุฎูุงุช ููุฎูู ุงูุชูููู ูู ุฏููู ูุนูู. </p><br><p style=";text-align:right;direction:rtl">  ุงูุฎุทูุฉ ุฑูู 3 <br>  ูุจุฏุฃ ุงููุฌููุนุฉ etcd ูุงูุชุญูู ูู ุฃุฏุงุฆูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">systemctl start etcd</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุชุญูู ูู ุฃุฏุงุก ุงูุฎูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">systemctl status etcd โ etcd.service - etcd Loaded: loaded (/etc/systemd/system/etcd.service; disabled; vendor preset: enabled) Active: active (running) since Sun 2019-07-07 02:34:28 MSK; 4min 46s ago Docs: https://github.com/coreos/etcd Main PID: 7471 (etcd) Tasks: 14 (limit: 4915) CGroup: /system.slice/etcd.service โโ7471 /usr/local/bin/etcd --name master01 --data-dir /var/lib/etcd --listen-client-urls http://0.0.0.0:2379,http://0.0.0.0:4001 --advertise-client-urls http://10.73.71.25:2379,http://10.73.71. Jul 07 02:34:28 master01 etcd[7471]: b11e73358a31b109 [logterm: 1, index: 3, vote: 0] cast MsgVote for f67dd9aaa8a44ab9 [logterm: 2, index: 5] at term 554 Jul 07 02:34:28 master01 etcd[7471]: raft.node: b11e73358a31b109 elected leader f67dd9aaa8a44ab9 at term 554 Jul 07 02:34:28 master01 etcd[7471]: published {Name:master01 ClientURLs:[http://10.73.71.25:2379 http://10.73.71.25:4001]} to cluster d0979b2e7159c1e6 Jul 07 02:34:28 master01 etcd[7471]: ready to serve client requests Jul 07 02:34:28 master01 etcd[7471]: serving insecure client requests on [::]:4001, this is strongly discouraged! Jul 07 02:34:28 master01 systemd[1]: Started etcd. Jul 07 02:34:28 master01 etcd[7471]: ready to serve client requests Jul 07 02:34:28 master01 etcd[7471]: serving insecure client requests on [::]:2379, this is strongly discouraged! Jul 07 02:34:28 master01 etcd[7471]: set the initial cluster version to 3.3 Jul 07 02:34:28 master01 etcd[7471]: enabled capabilities for version 3.3 lines 1-19</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุตุญุฉ ุงููุชูุฉ ููุณูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">etcdctl cluster-health member 61db137992290fc is healthy: got healthy result from http://10.73.71.27:2379 member b11e73358a31b109 is healthy: got healthy result from http://10.73.71.25:2379 member f67dd9aaa8a44ab9 is healthy: got healthy result from http://10.73.71.26:2379 cluster is healthy etcdctl member list 61db137992290fc: name=master03 peerURLs=http://10.73.71.27:2380 clientURLs=http://10.73.71.27:2379,http://10.73.71.27:4001 isLeader=false b11e73358a31b109: name=master01 peerURLs=http://10.73.71.25:2380 clientURLs=http://10.73.71.25:2379,http://10.73.71.25:4001 isLeader=false f67dd9aaa8a44ab9: name=master02 peerURLs=http://10.73.71.26:2380 clientURLs=http://10.73.71.26:2379,http://10.73.71.26:4001 isLeader=true</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุซุจูุช etcd ูุญููุง ูุน ansible ุ ูู ุฎูุงู ุชุดุบูู systemd</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ุจุงุณุชุฎุฏุงู github ุ ุณูู ูููู ุจูุณุฎ ุงููุณุชูุฏุน ุจุงูุฑูุฒ ุฅูู ุงูุฌูุงุฒ ุงูุฐู ุณุชููู ุจุชุดุบูู playbook ููู.  ูุฌุจ ุฃู ูููู ูุฏู ูุฐุง ุงูุฌูุงุฒ ูุตูู ssh ุนูู ููุชุงุญ ุณูุฏ ูุฌููุนุฉ ุงููุณุชูุจู ุงูุฎุงุตุฉ ุจูุง. </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rjeka/kubernetes-ceph-percona.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฌููุนุฉ ุงููุงุฌุณุชูุฑ ุ ูู ุจุชุณุฌูู ูุงุฌุณุชูุฑ ุงูููููุฉ ุงูููุฑูุฉ. <br>  etcd_version ูู ุฅุตุฏุงุฑ etcd.  ููููู ุฃู ุชุฑู ุฐูู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุญุฉ etcd ูู ุฌูุซุจ</a> .  ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูุงู ููุงู ูุณุฎุฉ v3.3.13 ุฃูุง ุฃุณุชุฎุฏู ุงูุฅุตุฏุงุฑ v3.3.10. <br>  etcdToken - ููููู ุชุฑู ููุณู ุ ุฃู ุชูููุฏ ุจููุณู. <br>  ุชุดุบูู ูุฑูู ููุงุนุฏ ุงููุนุจุฉ ุงูุชู ุชูุงุฑุณูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># sudo c  ansible-playbook -i hosts.ini -l masters etcd.yaml -K BECOME password: &lt;sudo &gt; # sudo  ansible-playbook -i hosts.ini -l masters etcd.yaml</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ููุช ุชุฑูุฏ ุชุดุบูู etcd ูู ุนุงูู ูููุงุก ุ ูููุงู ุชุนูููุงุช ุชุญุช ุงูููุณุฏ. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุซุจูุช etcd ูุน ุนุงูู ุฅูุดุงุก ุ ุฅุทูุงู ูู ุนุงูู ูููุงุก</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูุฌุจ ุชูููุฐ ูุฐู ุงูุฃูุงูุฑ ุนูู ูุงูุฉ ุนูุฏ ูุธุงู ุงููุฌููุนุฉ ุงูุฑุฆูุณูุฉ. <br>  ูุน ุฌูุซุจ ุ ุงุณุชูุณุงุฎ ูุณุชูุฏุน ูุน ุฑูุฒ </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/rjeka/kubernetes-ceph-percona.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> kubernetes-ceph-percona</code> </pre> <br><p style=";text-align:right;direction:rtl">  etcd_version ูู ุฅุตุฏุงุฑ etcd.  ููููู ุฃู ุชุฑู ุฐูู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุตูุญุฉ etcd ูู ุฌูุซุจ</a> .  ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูุงู ููุงู ูุณุฎุฉ v3.3.13 ุฃูุง ุฃุณุชุฎุฏู ุงูุฅุตุฏุงุฑ v3.3.10. <br>  etcdToken - ููููู ุชุฑู ููุณู ุ ุฃู ุชูููุฏ ุจููุณู. </p><br><p style=";text-align:right;direction:rtl">  ูุถุน ุนุงูู ูููุงุก ูุคูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get install -y docker-compose</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ุชูููุฏ ุงูุชูููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./create-config.sh docker</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุจุชุดุบูู ุชุซุจูุช ุงููุชูุฉ etcd ูู ุนุงูู ูููุงุก </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker-compose --file etcd-docker/docker-compose.yaml up -d</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุฃู ุงูุญุงููุงุช ุชุตู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker ps</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุถุน ุงููุชูุฉ ุงูุฎ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@master01:~/kubernetes-ceph-percona# docker exec -ti etcd etcdctl cluster-health member 61db137992290fc is healthy: got healthy result from http://10.73.71.27:2379 member b11e73358a31b109 is healthy: got healthy result from http://10.73.71.25:2379 member f67dd9aaa8a44ab9 is healthy: got healthy result from http://10.73.71.26:2379 cluster is healthy root@master01:~/kubernetes-ceph-percona# docker exec -ti etcd etcdctl member list 61db137992290fc: name=etcd3 peerURLs=http://10.73.71.27:2380 clientURLs=http://10.73.71.27:2379,http://10.73.71.27:4001 isLeader=false b11e73358a31b109: name=etcd1 peerURLs=http://10.73.71.25:2380 clientURLs=http://10.73.71.25:2379,http://10.73.71.25:4001 isLeader=true f67dd9aaa8a44ab9: name=etcd2 peerURLs=http://10.73.71.26:2380 clientURLs=http://10.73.71.26:2379,http://10.73.71.26:4001 isLeader=false</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ุญุฏุซ ุฎุทุฃ ูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">docker logs etcd</code> </pre> </div></div><br><a name="master-one"></a><br><h2 style=";text-align:right;direction:rtl">  ุฅุทูุงู ุฃูู ูุนุงูุฌ kubernetes </h2><br><p style=";text-align:right;direction:rtl">  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูุญู ุจุญุงุฌุฉ ุฅูู ุฅูุดุงุก ุงูุชูููู ู kubeadmin </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./create-config.sh kubeadm</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุญู ุชูููู ุงูุชูููู ู kubeadm</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apiVersion: kubeadm.k8s.io/v1beta1 kind: InitConfiguration localAPIEndpoint: advertiseAddress: 10.73.71.25 #    API- --- apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration kubernetesVersion: stable #      apiServer: #    kubeadm   certSANs: - 127.0.0.1 - 10.73.71.25 - 10.73.71.26 - 10.73.71.27 controlPlaneEndpoint: 10.73.71.25 #     etcd: #  etc external: endpoints: - http://10.73.71.25:2379 - http://10.73.71.26:2379 - http://10.73.71.27:2379 networking: podSubnet: 192.168.0.0/16 #   ,   CNI  .</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุฃู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุชูุฑุฃ</a> ุนู ุงูุดุจูุงุช ุงููุฑุนูุฉ CNI ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู kubernetes.</a> <br>  ูุฐุง ูู ุงูุชูููู ุงูุญุฏ ุงูุฃุฏูู ุงูุนูู.  ุจุงููุณุจุฉ ููุธุงู ุงููุฌููุนุฉ ุงูุฐู ูุญุชูู ุนูู ุซูุงุซุฉ ูุนุงูุฌุงุช ุ ููููู ุชุบููุฑู ุฅูู ุชูููู ูุธุงู ุงููุฌููุนุฉ.  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ููุช ุชุฑูุฏ ุงุณุชุฎุฏุงู ูุนุงูุฌุงุช ุงุซููู ุ ููู ุจุจุณุงุทุฉ ุจุชุญุฏูุฏ ุนููุงููู ูู certSANs. <br>  ูููู ุงูุนุซูุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนูู</a> ุฌููุน ูุนููุงุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงูุชูููู</a> ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุตู API kubeadm</a> . </p></div></div><br><p style=";text-align:right;direction:rtl">  ูุจุฏุฃ ุงูุณูุฏ ุงูุฃูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubeadm init --config=kubeadmin/kubeadm-init.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู kubeadm ูุนูู ุฏูู ุฃุฎุทุงุก ุ ูุนูุฏุฆุฐู ูู ุงููุงุชุฌ ูุญุตู ุนูู ุงููุงุชุฌ ุงูุชุงูู ุชูุฑูุจูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">You can now join any number of control-plane nodes by copying certificate authorities and service account keys on each node and then running the following as root: kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3 \ --control-plane Then you can join any number of worker nodes by running the following on each as root: kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3</code> </pre> <br><a name="callica"></a><br><h2 style=";text-align:right;direction:rtl">  CNI ูุงูููู ุงูุชุซุจูุช </h2><br><p style=";text-align:right;direction:rtl">  ููุฏ ุญุงู ุงูููุช ูุฅูุดุงุก ุดุจูุฉ ุชุนูู ูููุง ุงูุณููุงุช ุงูุฎุงุตุฉ ุจูุง.  ูููููู ุงุณุชุฎุฏุงู ูุงูููู ุ ูุณูู ูุถุนูุง. <br>  ุจุงููุณุจุฉ ูููุจุชุฏุฆูู ุ ูู ุจุชูููู ุงููุตูู ูู kubelet.  ูุญู ูููุฐ ุฌููุน ุงูุฃูุงูุฑ ุนูู master01 <br>  ุฅุฐุง ููุช ุชููู ุจุชุดุบูู ุงูุฌุฐุฑ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">export KUBECONFIG=/etc/kubernetes/admin.conf</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูู ุชุญุช ุงููุณุชุฎุฏู ุงูุจุณูุท </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุฃูุถูุง ุฅุฏุงุฑุฉ ุงููุชูุฉ ูู ุงูููุจููุชุฑ ุงููุญููู ุฃู ุฃู ุฌูุงุฒ ูุญูู.  ููููุงู ุจุฐูู ุ ุงูุณุฎ ููู /etc/kubernetes/admin.conf ุฅูู ุงูููุจููุชุฑ ุงููุญููู ุฃู ุฃู ุฌูุงุฒ ุขุฎุฑ ูู $ HOME / .kube / config </p><br><p style=";text-align:right;direction:rtl">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุถุน</a> CNI <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุง ููุซุงุฆู Kubernetes</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><br></a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl apply -f https://docs.projectcalico.org/v3.8/manifests/calico.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุชุธุฑ ุญุชู ุชุฑุชูุน ุฌููุน ุงููุฑูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">watch -n1 kubectl get pods -A NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-59f54d6bbc-psr2z 1/1 Running 0 96s kube-system calico-node-hm49z 1/1 Running 0 96s kube-system coredns-5c98db65d4-svcx9 1/1 Running 0 77m kube-system coredns-5c98db65d4-zdlb8 1/1 Running 0 77m kube-system kube-apiserver-master01 1/1 Running 0 76m kube-system kube-controller-manager-master01 1/1 Running 0 77m kube-system kube-proxy-nkdqn 1/1 Running 0 77m kube-system kube-scheduler-master01 1/1 Running 0 77m</code> </pre> <br><a name="mastes-other"></a><br><h2 style=";text-align:right;direction:rtl">  ุฅุทูุงู ูุนุงูุฌุงุช kubernetes ุงูุซุงููุฉ ูุงูุซุงูุซุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูุจู ุจุฏุก master02 ู master03 ุ ุชุญุชุงุฌ ุฅูู ูุณุฎ ุงูุดูุงุฏุงุช ุจุงุณุชุฎุฏุงู master01 ุงูุชู ุชู ุฅูุดุงุคูุง kubeadm ุนูุฏ ุฅูุดุงุก ุงููุชูุฉ.  ุณุฃูุณุฎ ุนุจุฑ scp <br>  ุนูู master01 </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">export master02=10.73.71.26 export master03=10.73.71.27 scp -r /etc/kubernetes/pki $master02:/etc/kubernetes/ scp -r /etc/kubernetes/pki $master03:/etc/kubernetes/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุนูู master02 ู master03 <br>  ุฅูุดุงุก ุงูุชูููู ู kubeadm </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./create-config.sh kubeadm</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฅุถุงูุฉ master02 ู master03 ุฅูู ุงููุชูุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubeadm init --config=kubeadmin/kubeadm-init.yaml</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ููุงุทู ุงูุฎูู ูู ุนุฏุฉ ูุงุฌูุงุช ุงูุดุจูุฉ!</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุงูุฅูุชุงุฌ ุ ุงุณุชุฎุฏู kubernetes v1.13.5 ู calico v3.3.  ููู ููู ูุฏู ูุซู ูุฐู ุงูุซุบุฑุงุช. <br>  ูููู ุนูุฏ ุฅุนุฏุงุฏ ุงูููุงูุฉ ูุงุณุชุฎุฏุงู ุงูุฅุตุฏุงุฑ ุงูุซุงุจุช (ูู ููุช ูุชุงุจุฉ ูุฐุง ุงูุชูุฑูุฑ ุ ูุงู ุงูุฅุตุฏุงุฑ 1.11.1 ูู kubernetes ูุงูุฅุตุฏุงุฑ 3.8 callico) ุ ูุงุฌูุช ูุดููุฉ ุชู ุงูุชุนุจูุฑ ุนููุง ูู ุฃุฎุทุงุก ุจุฏุก ุชุดุบูู CNI </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@master01:~/kubernetes-ceph-percona# kubectl get pods -A -w NAMESPACE NAME READY STATUS RESTARTS AGE kube-system calico-kube-controllers-658558ddf8-t6gfs 0/1 ContainerCreating 0 11s kube-system calico-node-7td8g 1/1 Running 0 11s kube-system calico-node-dthg5 0/1 CrashLoopBackOff 1 11s kube-system calico-node-tvhkq 0/1 CrashLoopBackOff 1 11s</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฐุง ูู ุฎูู ูุฌููุนุฉ ุงูุฎูู ูุงูููู ุนูุฏูุง ูููู ุงูุฎุงุฏู ุนุฏุฉ ูุงุฌูุงุช ุงูุดุจูุฉ <br>  ุนูู githab ููุงู ูุดููุฉ ูู ูุฐุง ุงูุฎูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://github.com/projectcalico/calico/issues/2720</a> <br>  ูุชู ุญููุง ุนู ุทุฑูู ุชุญุฑูุฑ daemon set calico-node ูุฅุถุงูุฉ ุงููุนููุฉ IP_AUTODETECTION_METHOD ุฅูู env </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl edit -n kube-system ds calico-node</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุถู ุงููุนููุฉ IP_AUTODETECTION_METHOD ูุน ุงุณู ุงููุงุฌูุฉ ุงูุชู ูุนูู ุนูููุง ุงููุนุงูุฌ ุ  ูู ุญุงูุชู ููู ens19 </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">- name: IP_AUTODETECTION_METHOD value: ens19</code> </pre> <br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/xe/pq/7h/xepq7hbpjwhgowfk0hkc6-ryw8a.png"><br>  ุชุญูู ูู ุฃู ูุงูุฉ ุงูุนูุฏ ูู ุงููุชูุฉ ููุฏ ุงูุชุดุบูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 28m v1.15.1 master02 Ready master 26m v1.15.1 master03 Ready master 18m v1.15.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููุง ูู ุนูู ููุฏ ุงูุญูุงุฉ ูุงูููุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># kubectl get pods -A -o wide | grep calico kube-system calico-kube-controllers-59f54d6bbc-5lxgn 1/1 Running 0 27m kube-system calico-node-fngpz 1/1 Running 1 24m kube-system calico-node-gk7rh 1/1 Running 0 8m55s kube-system calico-node-w4xtt 1/1 Running 0 25m</code> </pre> </div></div><br><a name="worknodes"></a><br><h2 style=";text-align:right;direction:rtl">  ุฅุถุงูุฉ ุงูุนูุฏ ุนุงูู ุฅูู ุงููุชูุฉ </h2><br><p style=";text-align:right;direction:rtl">  ูู ุงูููุช ุงูุญุงูู ุ ูุฏููุง ูุฌููุนุฉ ุชุนูู ูููุง ุซูุงุซ ููุงุท ุฑุฆูุณูุฉ.  ููู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ูู ุขูุงุช ุชููู ุจุชุดุบูู api ุ ูุฌุฏููุฉ ุ ูุฎุฏูุงุช ุฃุฎุฑู ูู ูุธุงู kubernetes.  ุญุชู ูุชููู ูู ุชุดุบูู ุงููุฑูู ูุฏููุง ุ ูุญุชุงุฌ ุฅูู ุนูุฏ ุงูุนูุงู ุงููุฒุนููุฉ. <br>  ุฅุฐุง ููุช ูุญุฏูุฏุฉ ุงูููุงุฑุฏ ุ ูููููู ุชุดุบูู ุงููุฑูู ุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุ ููููู ุดุฎุตูุงู ูุง ุฃูุตุญ ุจุฐูู. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุดุบูู ุงููููุฏ ุนูู ุงูุฃุฏูุฑุฉ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl">  ูู ุฃุฌู ุงูุณูุงุญ ุจุฅุทูุงู ุงููููุฏ ุนูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุ ูู ุจุชูููุฐ ุงูุฃูุฑ ุงูุชุงูู ุนูู ุฃู ูู ุงููุนุงูุฌุงุช </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl taint nodes --all node-role.kubernetes.io/master-</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุชุซุจูุช ุงูุนูุฏ kubelet ุ kubeadm ุ kubectl ูุฑุณู ุงูุณูู ุนูู ุงูุนุงูู ููุง ูู ุงูุญุงู ูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุซุจูุช kubelet ุ kubeadm ุ kubectl ุนุงูู ูููุงุก</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get update &amp;&amp; apt-get install -y apt-transport-https curl curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet kubeadm kubectl apt-mark hold kubelet kubeadm kubectl</code> </pre> <br><h4 style=";text-align:right;direction:rtl">  ุชุซุจูุช ุนุงูู ุงููููุงุก </h4><br><p style=";text-align:right;direction:rtl">  ุชุซุจูุช ุนุงูู ูููุงุก ูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุชุนูููุงุช ุงููุงุฑุฏุฉ ูู ุงููุซุงุฆู</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u="><br></a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get remove docker docker-engine docker.io containerd runc apt-get install apt-transport-https ca-certificates curl gnupg2 software-properties-common</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">curl -fsSL https://download.docker.com/linux/debian/gpg | apt-key add - apt-key fingerprint 0EBFCD88</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">add-apt-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable"</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">apt-get update apt-get install docker-ce docker-ce-cli containerd.io</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุชุฑููุจ ุชุฑููุจ Kubelet ุ Kubectl ุ Kubeadm ูุฑุณู ุงูุณูู ุจุงุณุชุฎุฏุงู ansible</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/playbooks vim masters.ini</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ูุฌููุนุฉ ุงููุงุฌุณุชูุฑ ุ ูู ุจุชุณุฌูู ูุงุฌุณุชูุฑ ุงูููููุฉ ุงูููุฑูุฉ. <br>  ูู ูุฌููุนุฉ ุงูุนูุงู ุ ุงูุชุจ ip ููุนูุฏ ุงูุนูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># sudo c  ansible-playbook -i hosts.ini kubelet.yaml -K ansible-playbook -i hosts.ini docker.yaml -K # sudo  ansible-playbook -i hosts.ini kubelet.yaml ansible-playbook -i hosts.ini docker.yaml</code> </pre> </div></div></div></div><br><p style=";text-align:right;direction:rtl">  ุญุงู ุงูููุช ุงูุขู ููุนูุฏุฉ ุฅูู ุงูุณุทุฑ ุงูุฐู ุฃูุดุฃู kubeadm ุนูุฏูุง ูููุง ุจุชุซุจูุช ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ. <br>  ุงููุง ุชุจุฏู ูุซู ูุฐุง ุจุงููุณุจุฉ ูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubeadm join 10.73.71.25:6443 --token ivwoap.259retezqf34amx8 \ --discovery-token-ca-cert-hash sha256:b5c93e32457c8e6478782ff62e8ef77acf72738dda59cd603cdf4821abe12ca3</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุถุฑูุฑู ุชูููุฐ ูุฐุง ุงูุฃูุฑ ุนูู ูู ุนูุฏุฉ ุนุงูู. <br>  ุฅุฐุง ูู ุชูู ูุฏ ูุชุจุช ุฑูุฒูุง ูููุฒูุง ุ ูููููู ุฅูุดุงุก ุฑูุฒ ุฌุฏูุฏ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubeadm token create --print-join-command --ttl=0</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุนูู kubeadm ุ ูุชู ุฅุฏุฎุงู ุงูุนูุฏุฉ ุงูุฌุฏูุฏุฉ ูู ุงููุชูุฉ ูุชููู ุฌุงูุฒุฉ ููุนูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">This node has joined the cluster: * Certificate signing request was sent to apiserver and a response was received. * The Kubelet was informed of the new secure connection details. Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฏุนููุง ูููู ูุธุฑุฉ ุนูู ุงููุชูุฌุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@master01:~# kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 10d v1.15.1 master02 Ready master 10d v1.15.1 master03 Ready master 10d v1.15.1 worknode01 Ready &lt;none&gt; 5m44s v1.15.1 worknode02 Ready &lt;none&gt; 59s v1.15.1 worknode03 Ready &lt;none&gt; 51s v1.15.1</code> </pre> <br><a name="haproxy"></a><br><h2 style=";text-align:right;direction:rtl">  ุชุซุจูุช haproxy ุนูู worknodes </h2><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูุฏููุง ูุฌููุนุฉ ุนูู ูุน ุซูุงุซุฉ ุนูุฏ ุฑุฆูุณูุฉ ูุซูุงุซุฉ ุนูุฏ ุนุงูู. <br>  ุงููุดููุฉ ูู ุฃูู ุงูุขู ููุณ ูุฏููุง ุนูุฏ ุงูุนุงูู ูุถุน HA. <br>  ุฅุฐุง ูุธุฑุช ุฅูู ููู ุชูููู kubelet ุ ูุณูุฑู ุฃู ุนูุฏูุง ุงูุนุงููุฉ ูุง ุชุตู ุฅูุง ุฅูู ูุงุญุฏุฉ ูู ุงูุนูุฏ ุงูุฑุฆูุณูุฉ ุงูุซูุงุซุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@worknode01:~# cat /etc/kubernetes/kubelet.conf | grep server: server: https://10.73.71.27:6443</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุญุงูุชู ุ ูุฐุง ูู master03.  ูุน ูุฐุง ุงูุชูููู ุ ูู ุญุงูุฉ ุชุนุทู master03 ุ ุณุชููุฏ ุนูุฏุฉ ุงูุนุงูู ุงูุงุชุตุงู ูุน ุฎุงุฏู API ุงููุชูุฉ.  ูุฌุนู ูุฌููุนุชูุง HA ุจุงููุงูู ุ ุณูููู ุจุชุซุจูุช Load Balancer (Haproxy) ุนูู ูู ูู ุงูุนูุงู ุ ูุงูุชู ุ ููููุง ูุฌููุฉ ุฑูุจู ุ ุณุชุชุจุนุซุฑ ุทูุจุงุช ุงูุนูุฏ ุงูุซูุงุซ ุงูุฑุฆูุณูุฉ ุ ููู ุชูููู kubelet ุนูู ุนูุฏ ุงูุนุงูู ุ ุณูููู ุจุชุบููุฑ ุนููุงู ุงูุฎุงุฏู ุฅูู 127.0.0.1:6443 <br>  ุฃููุงู ุ ูู ุจุชุซุจูุช HAProxy ุนูู ูู ุนูุฏุฉ ุนุงูู. <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุงู ูุฑูุฉ ุงูุบุด ุฌูุฏุฉ ููุชุซุจูุช</a> </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">curl https://haproxy.debian.net/bernat.debian.org.gpg | \ apt-key add - echo deb http://haproxy.debian.net stretch-backports-2.0 main | \ tee /etc/apt/sources.list.d/haproxy.list apt-get update apt-get install haproxy=2.0.\*</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุชุซุจูุช HAproxy ุ ูุญุชุงุฌ ุฅูู ุฅูุดุงุก ุชููุฆุฉ ูู. <br>  ุฅุฐุง ูู ููู ููุงู ุฏููู ุนูู ุงูุนูุฏ ุงูููููุฐุฉ ูุญุชูู ุนูู ูููุงุช ุงูุชูููู ุ ูุณูููู ุจุงุณุชูุณุงุฎูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">git clone https://github.com/rjeka/kubernetes-ceph-percona.git cd kubernetes-ceph-percona/</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุชุดุบูู ุงูุจุฑูุงูุฌ ุงููุตู ุงูุชูููู ูุน ุงูุนูู haproxy </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./create-config.sh haproxy</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุณูููู ุงูุจุฑูุงูุฌ ุงููุตู ุจุชูููู ูุฅุนุงุฏุฉ ุชุดุบูู haproxy. <br>  ุชุญูู ูู ุฃู haproxy ุจุฏุฃ ุงูุงุณุชูุงุน ุฅูู ุงููููุฐ 6443. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@worknode01:~/kubernetes-ceph-percona# netstat -alpn | grep 6443 tcp 0 0 127.0.0.1:6443 0.0.0.0:* LISTEN 30675/haproxy tcp 0 0 10.73.75.241:6443 0.0.0.0:* LISTEN 30675/haproxy</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญู ุงูุขู ุจุญุงุฌุฉ ุฅูู ุฅุฎุจุงุฑ kubelet ูููุตูู ุฅูู ูุถูู ูุญูู ุจุฏูุงู ูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ.  ููููุงู ุจุฐูู ุ ูู ุจุชุญุฑูุฑ ูููุฉ ุงูุฎุงุฏู ูู ูููุงุช /etc/kubernetes/kubelet.conf ู /etc/kubernetes/bootstrap-kubelet.conf ุนูู ุฌููุน ุงูุนูุฏ ุงููููุฐุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">vim /etc/kubernetes/kubelet.conf vim nano /etc/kubernetes/bootstrap-kubelet.conf</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฌุจ ุฃู ุชุฃุฎุฐ ูููุฉ ุงูุฎุงุฏู ูู ูุฐุง ุงููููุฐุฌ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">server: https://127.0.0.1:6443</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฅุฌุฑุงุก ุงูุชุบููุฑุงุช ุ ูู ุจุฅุนุงุฏุฉ ุชุดุบูู ุฎุฏูุงุช kubelet ูุฑุณู ุงูุณูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">systemctl restart kubelet &amp;&amp; systemctl restart docker</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุฃู ุฌููุน ุงูุนูุฏ ุชุนูู ุจุดูู ุตุญูุญ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl get nodes NAME STATUS ROLES AGE VERSION master01 Ready master 29m v1.15.1 master02 Ready master 27m v1.15.1 master03 Ready master 26m v1.15.1 worknode01 Ready &lt;none&gt; 25m v1.15.1 worknode02 Ready &lt;none&gt; 3m15s v1.15.1 worknode03 Ready &lt;none&gt; 3m16s v1.15.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุญุชู ุงูุขู ุ ููุณ ูุฏููุง ุชุทุจููุงุช ูู ุงููุฌููุนุฉ ูุงุฎุชุจุงุฑ HA.  ูููู ูููููุง ุฅููุงู ุชุดุบูู kubelet ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู ูุงูุชุฃูุฏ ูู ุฃู ูุธุงููุง ุงูุนูููุฏู ูุฏ ุจูู ููุฏ ุงูุชุดุบูู. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">systemctl stop kubelet &amp;&amp; systemctl stop docker</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุซุงููุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">root@master02:~# kubectl get nodes NAME STATUS ROLES AGE VERSION master01 NotReady master 15h v1.15.1 master02 Ready master 15h v1.15.1 master03 Ready master 15h v1.15.1 worknode01 Ready &lt;none&gt; 15h v1.15.1 worknode02 Ready &lt;none&gt; 15h v1.15.1 worknode03 Ready &lt;none&gt; 15h v1.15.1</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุนูู ุฌููุน ุงูุนูุฏ ุจุดูู ุทุจูุนู ุจุงุณุชุซูุงุก ุชูู ุงูุชู ุฃููููุง ูููุง ุงูุฎุฏูุงุช. <br>  ูุง ุชูุณู ุฅุนุงุฏุฉ ุชุดุบูู ุฎุฏูุงุช kubernetes ุนูู ุงูุนูุฏุฉ ุงูุฑุฆูุณูุฉ ุงูุฃููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">systemctl start kubelet &amp;&amp; systemctl start docker</code> </pre> <br><a name="ingress"></a><br><h2 style=";text-align:right;direction:rtl">  ุชุซุจูุช ุฌูุงุฒ ุงูุชุญูู ูู ุงูุฏุฎูู </h2><br><p style=";text-align:right;direction:rtl">  ุชุนุฏ ุฃุฏุงุฉ ุงูุชุญูู ูู ุงูุฏุฎูู ูู ูุธููุฉ Kubernetes ุงูุฅุถุงููุฉ ุ ูุงูุชู ูููููุง ูู ุฎูุงููุง ุงููุตูู ุฅูู ุชุทุจููุงุชูุง ูู ุงูุฎุงุฑุฌ.  ููุฌุฏ ูุตู ููุตู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูุซุงุฆู Kuberbnetes</a> .  ููุงู ุงููุซูุฑ ุฌุฏุง ูู ูุญุฏุงุช ุงูุชุญูู ุงูุฏุฎูู ุ ูุฃูุง ุงุณุชุฎุฏู ูุญุฏุฉ ุชุญูู ูู Nginx.  ุณุฃุชุญุฏุซ ุนู ุงูุชุซุจูุช.  ูููู ูุฑุงุกุฉ ุงููุซุงุฆู ุงููุชุนููุฉ ุจุชุดุบูู ูุชููุฆุฉ ูุชุฑููุจ ุฌูุงุฒ ุงูุชุญูู ูู ุงูุฏุฎูู ูู Nginx ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููููุน ุงูุฑุณูู</a> </p><br><p style=";text-align:right;direction:rtl">  ููุจุฏุฃ ุงูุชุซุจูุช ุ ูููู ุชูููุฐ ุฌููุน ุงูุฃูุงูุฑ ุจุงุณุชุฎุฏุงู master01. <br>  ุชุซุจูุช ูุญุฏุฉ ุชุญูู ููุณูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/master/deploy/static/mandatory.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุงูุขู - ุฎุฏูุฉ ูู ุฎูุงููุง ุณุชุชููุฑ ุงูุฏุฎูู <br>  ููููุงู ุจุฐูู ุ ูู ุจุฅุนุฏุงุฏ ุงูุชูููู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">./create-config.sh ingress</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุฃุฑุณููุง ุฅูู ูุฌููุนุชูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl apply -f ingress/service-nodeport.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุฃู Ingress ูุนูู ุนูู ุงูุนูุงููู ุงูุตุญูุญุฉ ููุณุชูุน ุฅูู ุงูููุงูุฐ ุงูุตุญูุญุฉ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"># kubectl get svc -n ingress-nginx NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE ingress-nginx NodePort 10.99.35.95 10.73.71.25,10.73.71.26,10.73.71.27 80:31669/TCP,443:31604/TCP 10m</code> </pre> <br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs"> kubectl describe svc -n ingress-nginx ingress-nginx Name: ingress-nginx Namespace: ingress-nginx Labels: app.kubernetes.io/name=ingress-nginx app.kubernetes.io/part-of=ingress-nginx Annotations: kubectl.kubernetes.io/last-applied-configuration: {"apiVersion":"v1","kind":"Service","metadata":{"annotations":{},"labels":{"app.kubernetes.io/name":"ingress-nginx","app.kubernetes.io/par... Selector: app.kubernetes.io/name=ingress-nginx,app.kubernetes.io/part-of=ingress-nginx Type: NodePort IP: 10.99.35.95 External IPs: 10.73.71.25,10.73.71.26,10.73.71.27 Port: http 80/TCP TargetPort: 80/TCP NodePort: http 31669/TCP Endpoints: 192.168.142.129:80 Port: https 443/TCP TargetPort: 443/TCP NodePort: https 31604/TCP Endpoints: 192.168.142.129:443 Session Affinity: None External Traffic Policy: Cluster Events: &lt;none&gt;</code> </pre> <br><a name="dashboard"></a><br><h2 style=";text-align:right;direction:rtl">  ุชุซุจูุช Web UI (ููุญุฉ ุงููุนูููุงุช) </h2><br><p style=";text-align:right;direction:rtl">  Kubernetes ูุฏูู ูุงุฌูุฉ ูุณุชุฎุฏู ููุจ ููุงุณูุฉ ุ ูุงูุชู ูู ุฎูุงููุง ูููู ูู ุงูููุงุณุจ ูู ุจุนุถ ุงูุฃุญูุงู ุฃู ููุธุฑ ุจุณุฑุนุฉ ุฅูู ุญุงูุฉ ุงููุชูุฉ ุฃู ุฃุฌุฒุงุฆูุง ุงููุฑุฏูุฉ.  ูู ุนููู ุ ุบุงูุจูุง ูุง ุฃุณุชุฎุฏู ููุญุฉ ุงูููุงุฏุฉ ููุชุดุฎูุต ุงููุจุฏุฆู ูุนูููุงุช ุงููุดุฑ ุฃู ูุญุงูุฉ ุฃุฌุฒุงุก ุงููุชูุฉ. <br>  ุฑุงุจุท ุงููุซุงุฆู ููุฌูุฏ ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูููุน kubernetes</a> <br>  ุงูุชุซุจูุช.  ุฃูุง ุฃุณุชุฎุฏู ุงูุฅุตุฏุงุฑ ุงููุณุชูุฑ ุ ูู ุฃุญุงูู ุงูุฅุตุฏุงุฑ 2.0 ุจุนุฏ. </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#  kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v1.10.1/src/deploy/recommended/kubernetes-dashboard.yaml # 2.0 kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta1/aio/deploy/recommended.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฃู ูููุง ุจุชุซุจูุช ุงูููุญุฉ ูู ูุฌููุนุชูุง ุ ุฃุตุจุญุช ุงูููุญุฉ ูุชุงุญุฉ ูู </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/.</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ูู ุฃุฌู ุงููุตูู ุฅูููุง ุ ูุญุชุงุฌ ุฅูู ุฅุนุงุฏุฉ ุชูุฌูู ุงูููุงูุฐ ูู ุงูุฌูุงุฒ ุงููุญูู ุจุงุณุชุฎุฏุงู ูููู kubectl.  ุจุงููุณุจุฉ ูู ุ ูุฐุง ุงููุฎุทุท ููุณุช ูุฑูุญุฉ ููุบุงูุฉ.  ูุฐูู ุ ุณูู ุฃููู ุจุชุบููุฑ ุฎุฏูุฉ ููุญุฉ ุงูุชุญูู ุจุญูุซ ุชุตุจุญ ููุญุฉ ุงูููุงุฏุฉ ูุชุงุญุฉ ุนูู ุนููุงู ุฃู ุนูุฏุฉ ูุชูุฉ ุนูู ุงููููุฐ 30443. ููุงู ุทุฑู ุฃุฎุฑู ูููุตูู ุฅูู ููุญุฉ ุงูููุงุฏุฉ ุ ุนูู ุณุจูู ุงููุซุงู ุ ูู ุฎูุงู ุงูุฏุฎูู.  ุฑุจูุง ุณุฃูุธุฑ ูู ูุฐู ุงูุทุฑููุฉ ูู ุงูููุดูุฑุงุช ุงูุชุงููุฉ. <br>  ูุชุบููุฑ ุงูุฎุฏูุฉ ุ ูู ุจุชุดุบูู ูุดุฑ ุงูุฎุฏูุฉ ุงูุชู ุชู ุชุบููุฑูุง </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl apply -f dashboard/service-nodeport.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุจูู ูุฅูุดุงุก ุงููุณุชุฎุฏู ุงููุณุคูู ูุงูุฑูุฒ ุงููููุฒ ูููุตูู ุฅูู ุงููุชูุฉ ูู ุฎูุงู ููุญุฉ ุงูููุงุฏุฉ </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">kubectl apply -f dashboard/rbac.yaml kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk '{print $1}')</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุจุนุฏ ุฐูู ุ ููููู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ููุญุฉ ุงูุชุญูู ุนูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">https://10.73.71.25:30443</a> <br><img src="https://habrastorage.org/webt/p7/zu/8q/p7zu8qv47mwdsmdydtvyo7gs_y4.png"><br>  ุงูุดุงุดุฉ ุงูุฑุฆูุณูุฉ ูููุญุฉ ุงูููุงุฏุฉ <br><img src="https://habrastorage.org/webt/h2/ks/jq/h2ksjq_7egqatf4ulnl0zkwqvqk.png"></p><br><p style=";text-align:right;direction:rtl">  ุชูุงูููุง!  ุฅุฐุง ููุช ูุฏ ูุตูุช ุฅูู ูุฐู ุงูุฎุทูุฉ ุ ูุฃูุช ูุฏูู ูุฌููุนุฉ HA ูู kubernetes ุชุนูู ุ ููู ุฌุงูุฒุฉ ููุดุฑ ุชุทุจููุงุชู. <br> Kubernetes    ,      .          . <br>       ,  GitHub,    ,    . <br> C ,  . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar462473/">https://habr.com/ru/post/ar462473/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar462461/index.html">GOES-17 ุชุญุทู ูุชุงุฆุฌ ุงูุชุญููู</a></li>
<li><a href="../ar462465/index.html">ุงุณุชุฎุฏุงู ุฃูุงูู Apple ุงูุฃุตููุฉ</a></li>
<li><a href="../ar462467/index.html">Frontend Weekly Digest (29 ููููู - 4 ุฃุบุณุทุณ ุ 2019)</a></li>
<li><a href="../ar462469/index.html">ุงุนุชุจุงุฑุงุช ููููุฉ ููุญูุณุจุฉ ุงููุชุฒุงููุฉ ูู ุงูุจุญุซ ุนู ููุงู "ุงููุคุณุณุฉ"</a></li>
<li><a href="../ar462471/index.html">ุญู ูุธููุฉ ูุน pwnable.kr 16 - UAF. ุงุณุชุฎุฏู ุจุนุฏ ุงูุถุนู ุงูุญุฑ</a></li>
<li><a href="../ar462475/index.html">ุฃูููุณู ุณุงููุงุชูู: ููู ูุญุงุฑุจ ุงููุณุงุฏ ุจูุณุงุนุฏุฉ ุงูุฑูุงุถูุงุช (ุฌุงุฆุฒุฉ ููุจู ูู ุงูุงูุชุตุงุฏ ูุนุงู 2016)</a></li>
<li><a href="../ar462477/index.html">ูุฏุนู ุงูุนููุงุก ุฃู ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ูุคูู ุจุฑุงุกุฉ ุงุฎุชุฑุงุน ุฌุฏูุฏุฉ ููุญุงูููู ุชุบููุฑ ูุงููู ุจุฑุงุกุงุช ุงูุงุฎุชุฑุงุน</a></li>
<li><a href="../ar462479/index.html">ุณุชูู ูููุฏูุฒ ุนููู ูุญูู ุชุตุนูุฏ ุงูุงูุชูุงุฒ 0day</a></li>
<li><a href="../ar462481/index.html">ุงูุชุจ ูุธุงู ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ</a></li>
<li><a href="../ar462483/index.html">ุงูุจุฑูุฌุฉ ุงููุธูููุฉ: ูุนุจุฉ ุฃุญูู ุชูุชู ุฅูุชุงุฌูุฉ ุงูุนูุงูุฉ. ุงูุฌุฒุก 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>