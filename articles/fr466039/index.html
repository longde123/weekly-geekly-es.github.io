<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üéè üò≤ üöô Biblioth√®ques PHP pour le commerce √©lectronique: travailler avec ATOL et Payture, analyser les codes GS1 et autres t√¢ches ü§∏ üîÄ üÜó</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, je m'appelle Pavel Savelyev, je suis le chef du d√©partement d'automatisation des processus m√©tier chez Lamoda. Nous travaillons avec des t√¢ch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Biblioth√®ques PHP pour le commerce √©lectronique: travailler avec ATOL et Payture, analyser les codes GS1 et autres t√¢ches</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/466039/">  Bonjour, je m'appelle Pavel Savelyev, je suis le chef du d√©partement d'automatisation des processus m√©tier chez Lamoda.  Nous travaillons avec des t√¢ches tr√®s diff√©rentes et essayons de choisir les outils les plus pratiques pour chacun.  En cons√©quence, nous utilisons diff√©rents langages - dans nos syst√®mes, vous pouvez trouver Java, Go et un peu de Kotlin pour Android.  Dans le m√™me temps, une partie importante du d√©veloppement est r√©alis√©e en PHP; plus de deux douzaines de services y sont √©crits qui automatisent non seulement le travail avec les commandes, mais aussi les processus op√©rationnels d'un large r√©seau de livraison, des centres d'appels dans trois pays et de notre propre studio photo, ainsi que de fournir tout cela sous la forme services √† nos partenaires B2B.  Ces services sont pris en charge et d√©velopp√©s par 5 √©quipes de d√©veloppement de notre d√©partement. <br><br><img src="https://habrastorage.org/webt/vv/vz/ia/vvvziajvf5uazdok_tjzpzs-5ae.png" alt="image"><br><br>  √Ä mesure que les services eux-m√™mes et l'infrastructure qui les entoure se d√©veloppent, des t√¢ches similaires se produisent plus souvent dans ces syst√®mes, telles que la connexion au CLS (Centralized Logging System) commun, le test du stockage de fichiers, la collecte de m√©triques pour Prometheus et d'autres.  Nous essayons de normaliser les moyens de r√©soudre ces probl√®mes et d'utiliser des composants communs pour diff√©rents syst√®mes. <br><a name="habracut"></a><br><blockquote>  Lorsque l'une des √©quipes est confront√©e √† l'adaptation ou √† l'int√©gration d'un nouveau service / outil qui peut devenir commun √† tous, nous initions le d√©veloppement de la biblioth√®que de cette √©quipe.  Et puis le composant fini est pr√©par√© pour une r√©utilisation future et pr√©sent√© dans le domaine public. <br></blockquote><br>  Donc, un tel processus se d√©roule r√©guli√®rement avec nous, nous avons cr√©√© une ligne directrice qui nous permet de le mener sans douleur - j'essaierai d'en faire rapport lors d'une des prochaines conf√©rences. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Plus de deux douzaines de nos biblioth√®ques PHP</a> ont √©t√© rendues publiques sur GitHub.  Et nous pr√©voyons de nous √©tendre davantage.  Pourquoi?  Eh bien, nous avons investi beaucoup de ressources et (je veux le croire) avons bien fait.  Et nous esp√©rons astucieusement que d'autres d√©veloppeurs utiliseront nos biblioth√®ques, les aideront √† terminer et √† d√©velopper davantage, au lieu de passer du temps √† √©crire leurs analogues √† partir de z√©ro.  Dans cet article, je veux parler bri√®vement de sept biblioth√®ques con√ßues pour r√©soudre des probl√®mes courants pour les t√¢ches de commerce √©lectronique - je serai heureux si elles vous sont utiles, et je serai encore plus heureux de les d√©velopper ensemble :) <br><br><h2>  1. La fiscalisation en ligne: un client pour ATOL Online </h2><br>  Comme d'autres soci√©t√©s russes, nous sommes tenus de respecter pleinement les exigences du FZ-54, dont l'une est la fiscalisation en ligne.  Toutes les commandes pr√©pay√©es sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">lamoda.ru</a> sont toujours tax√©es: elles g√©n√®rent des ch√®ques en ligne qui sont envoy√©s aux clients.  Notre service de fiscalisation fonctionne par API avec le syst√®me <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ATOL Online,</a> et la premi√®re <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que</a> de notre liste est un client √† part enti√®re pour ce service.  En plus de la biblioth√®que elle-m√™me, nous avons √©galement publi√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bundle</a> , avec lequel vous pouvez facilement le connecter √† tous les projets bas√©s sur le framework Symfony.  La biblioth√®que elle-m√™me peut √™tre int√©gr√©e dans n'importe quel autre framework PHP: Laravel, Yii, etc. - il suffit d'√©crire un ¬´wrapper¬ª pour la biblioth√®que. <br><br><h2>  2. Paiements pr√©pay√©s: interaction avec Payture </h2><br>  Pour traiter les paiements pr√©pay√©s, nous interagissons activement avec le service Payture.  Ce service poss√®de plusieurs interfaces logicielles.  Nous utilisons l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">option Payture InPay</a> et avons √©crit notre propre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">client API</a> pour cela.  La biblioth√®que vous permet de manipuler plusieurs terminaux, prend en charge la journalisation PSR-3 standard.  Il est √©galement possible d'utiliser le client Guzzle pr√©-configur√© - cela facilite l'organisation des tests √† l'aide du <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">gestionnaire de simulation Guzzle</a> . <br><br>  Notre ensemble de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®ques</a> fournit une configuration s√©mantique des terminaux et vous permet de configurer facilement les param√®tres client (jusqu'√† pr√©sent uniquement des d√©lais) pour diverses op√©rations d'API. <br><br><h2>  3. √âtiquetage du produit: analyseur de code GS1 Datamatrix </h2><br>  L'un des projets les plus importants de 2019 dans notre entreprise est le soutien √† l'√©tiquetage des marchandises par l'√âtat.  Dans le cadre de ce projet, des codes uniques sp√©ciaux seront appliqu√©s √† tous les produits de certaines cat√©gories - au format GS1 Datamatrix.  Ces codes permettront √† tout acheteur de v√©rifier l'authenticit√© des marchandises, leur origine et leur historique.  Afin que les syst√®mes internes Lamoda fonctionnent avec ces codes-barres, nous avons d√©velopp√© une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que</a> pour l'analyse correcte des codes GS1. <br>  Dans un avenir proche, nous pr√©voyons √©galement de pr√©senter les codes sources de nos clients d√©velopp√©s pour l'interaction avec le syst√®me d'information de marquage et de tra√ßabilit√© (IP MP). <br><br><h2>  4. Gestion des microservices: middleware pour le bus d'√©quipe Tactician </h2><br>  Nous avons plus d'une centaine de microservices qui effectuent de nombreuses op√©rations distinctes: ils v√©rifient l'√©tat des paiements ou des nouveaux fichiers dans les stockages, envoient des commandes de contr√¥le aux caissiers, t√©l√©chargent et traitent les photos des services externes.  Presque toutes ces op√©rations sont effectu√©es en arri√®re-plan et le mod√®le de bus de commande est excellent pour les g√©rer.  Pour impl√©menter le bus dans les syst√®mes PHP, nous avons choisi une solution pr√™te √† l'emploi - la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Tactician</a> ouverte. <br><br>  Cependant, un probl√®me est survenu: nos √©quipes d'arri√®re-plan interagissent souvent avec des services externes, qui ont une limite sur le nombre d'op√©rations en n secondes.  Et le tacticien n'a pas la possibilit√© de contr√¥ler le nombre de commandes ex√©cutables dans une fen√™tre de temps sp√©cifique.  Par cons√©quent, nous avons d√©velopp√© un middleware suppl√©mentaire - biblioth√®que de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">limites de taux pour les tacticiens</a> .  Avec son aide, vous pouvez ajouter une nouvelle couche de traitement qui suit le nombre de commandes ex√©cut√©es sur le bus selon la strat√©gie de limitation de d√©bit s√©lectionn√©e.  Les strat√©gies sont enfichables, les strat√©gies de la biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">stiphle</a> sont disponibles <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">imm√©diatement</a> . <br><br>  √âgalement dans le domaine public est notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">paquet Symfony</a> √† la biblioth√®que. <br><br><h2>  5. Collecte et rendu des m√©triques pour Prometheus </h2><br>  Nos microservices g√©n√®rent des m√©triques techniques et commerciales, qui sont ensuite collect√©es via l'op√©rateur Prometheus de l'ensemble du cluster k8s.  Pour g√©rer tout cela, nous avons √©crit une <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que</a> qui traite les m√©triques personnalis√©es selon le sc√©nario ¬´collect-save-show¬ª.  Dans le m√™me temps, la biblioth√®que prend en charge les modes de fonctionnement dans lesquels l'un des √©l√©ments de script peut √™tre omis pour augmenter l'efficacit√©.  Par exemple, pour des mesures rapides et calculables, un sc√©nario simplifi√© de ¬´collecte-pr√©sentation¬ª peut √™tre ex√©cut√©.  Et travailler avec des mesures commerciales lentes peut se traduire partiellement en arri√®re-plan, tout en se d√©composant en deux √©tapes: ¬´collecter-enregistrer¬ª + ¬´collecter (√† partir du stockage) - afficher¬ª. <br><br>  La biblioth√®que poss√®de les niveaux d'abstraction n√©cessaires √† la fois pour √©crire ses g√©n√©rateurs de m√©triques et pour √©crire des r√©f√©rentiels.  Hors de la bo√Æte, il existe un adaptateur abstrait pour Doctrine, qui peut √™tre configur√© sur l'entit√© pour enregistrer les donn√©es dans la base de donn√©es. <br><br>  En tant que formats de rendu m√©trique, prometheus et telegraf httpjson sont actuellement pris en charge. <br><br>  La biblioth√®que est livr√©e avec un bundle Symfony, qui fournit une configuration s√©mantique des sources m√©triques, des r√©f√©rentiels et des m√©triques de routage.  Il dispose √©galement de commandes d'assistance pour le d√©bogage et l'enregistrement des m√©triques √† partir des sources (par exemple, pour calculer les m√©triques cron). <br><br><h2>  6. Tester le stockage des fichiers: travailler avec diff√©rents syst√®mes de fichiers </h2><br>  Pour automatiser les tests, nous utilisons le framework <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Codeception</a> , qui nous permet d'√©crire des tests de diff√©rents niveaux et dispose d'une biblioth√®que assez √©tendue de modules standard.  Nous avons r√©cemment √©crit plus sur nos approches pour tester le d√©veloppement dans un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">article</a> s√©par√© et parl√© lors d'une conf√©rence <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PHP Russie</a> .  Codeception a des modules pr√™ts √† l'emploi pour interagir avec FTP et le FileSystem local, mais dans nos tests, il est n√©cessaire de travailler avec plus de syst√®mes de fichiers.  Au minimum, nous utilisons √©galement AWS S3 et Webdav.  De plus, je voudrais interagir avec tous les syst√®mes de fichiers en utilisant la m√™me API (il s'agit de tous les syst√®mes de fichiers :)). <br><br>  Heureusement, il existe une biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FlySystem</a> ouverte qui fournit une interface logicielle unique pour travailler avec diff√©rents syst√®mes de fichiers.  Nous n'avions donc besoin que de combiner les deux outils - ce que nous avons fait en √©crivant un wrapper sur FlySystem en tant que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">module Codeception-flysystem</a> .  Il prend d√©sormais en charge SFTP, S3 et Webdav.  Il suffit de configurer les param√®tres une fois pour se connecter au syst√®me de fichiers souhait√© dans la configuration de test yml, et apr√®s cela, vous pouvez travailler avec tous les syst√®mes de fichiers en utilisant le m√™me ensemble de m√©thodes: √©crire le fichier, copier le fichier, nettoyer le r√©pertoire, etc.  Le module est d√©j√† inclus dans la page des ajouts et recommandations de Codeception: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">codeception.com/addons</a> . <br><br><h2>  7. Utilisation des variables d'environnement en mode multi-tenant </h2><br>  Dans le d√©partement d'automatisation des processus m√©tier, il existe des syst√®mes qui fonctionnent en mode multi locataire.  Pour assurer leur travail, il est n√©cessaire de pouvoir travailler avec des variables d'environnement - pour d√©terminer quelle variable utiliser √† l'heure actuelle. <br><br>  Notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">biblioth√®que</a> propose plusieurs strat√©gies pour travailler avec des variables d'environnement en mode multi-tenant.  En fonction des param√®tres pass√©s √† l'√©tape d'initialisation, la biblioth√®que d√©termine la variable d'environnement √† laquelle acc√©der dans la demande en cours. <br><br><h2>  √Ä suivre </h2><br>  Ce n'est que la premi√®re partie des biblioth√®ques.  Nous en avons une douzaine de plus √† l'int√©rieur - ils attendent en ligne lorsque nous les ¬´peignons¬ª un peu et les mettons dans le domaine public.  Cela me motive √† comprendre que ces biblioth√®ques peuvent √™tre utiles √† quelqu'un d'autre.  Je me r√©jouis des commentaires et des √©toiles sur le github, et j'esp√®re continuer √† d√©velopper des biblioth√®ques avec d'autres d√©veloppeurs.  En effet, de nombreux projets de commerce √©lectronique russes fonctionnent avec ATOL et Payture.  Pour Datamatrix, en plus de l'analyseur de code d√©crit dans l'article, nous avons √©galement quelques clients que nous utilisons d√©j√† en interne - ces biblioth√®ques sont les premi√®res dans la file d'attente sur GitHub. <br><br>  Nous essayons de ne pas oublier les autres langues - nous avons d√©j√† post√© la premi√®re biblioth√®que sur Go (nous en avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit</a> plus <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici sur Habr√©</a> ) et nous en pr√©parons d'autres.  Restez √† l'√©coute! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466039/">https://habr.com/ru/post/fr466039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466021/index.html">Comment j'ai appris √† Yandex Alice √† parler de jouets sexuels</a></li>
<li><a href="../fr466027/index.html">Le livre "The Way of Python. Ceinture noire pour le d√©veloppement, la mise √† l'√©chelle, les tests et le d√©ploiement ¬ª</a></li>
<li><a href="../fr466029/index.html">Comment transformer un ordinateur quantique en un g√©n√©rateur de nombres al√©atoires parfait</a></li>
<li><a href="../fr466031/index.html">La mission √©pique de DeepMind pour r√©soudre le probl√®me scientifique le plus complexe</a></li>
<li><a href="../fr466033/index.html">Comment attirer une √©quipe dans le processus de recherche d'id√©es et obtenir bien plus que des id√©es</a></li>
<li><a href="../fr466041/index.html">Le premier √©v√©nement hors ligne du Facebook Developer Circle: la communaut√© de Moscou - Launch Event</a></li>
<li><a href="../fr466045/index.html">Comment revitaliser une marque: une narration qui a fonctionn√©</a></li>
<li><a href="../fr466047/index.html">Conception de boutiques en ligne. Partie 3. Page d'accueil et catalogue</a></li>
<li><a href="../fr466049/index.html">Du copier-coller aux composants: r√©utiliser le code dans diff√©rentes applications</a></li>
<li><a href="../fr466051/index.html">Automatisation du profilage Java Meetup 10/09</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>