<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äçü§ù‚Äçüë©üèæ üë©üèº‚Äçüç≥ üïü Amazon Cloud Services et analyse de portefeuille d'investissement üó∫Ô∏è üëÉüèΩ üêß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="R√©cemment, il y a eu une forte volatilit√© sur les march√©s boursiers lorsque, par exemple, un papier stable d'une soci√©t√© bien connue peut perdre plusi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Amazon Cloud Services et analyse de portefeuille d'investissement</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/426027/">  R√©cemment, il y a eu une forte volatilit√© sur les march√©s boursiers lorsque, par exemple, un papier stable d'une soci√©t√© bien connue peut perdre plusieurs pour cent √† la fois en raison de sanctions contre sa direction ou vice versa s'envoler dans le ciel sur un rapport positif et les attentes des investisseurs concernant les dividendes extra-profit. <br><br>  Comment d√©terminer si la propri√©t√© d'un titre donn√© a g√©n√©r√© des revenus ou seulement des pertes et des d√©ceptions? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q3/2q/zs/q32qzs8fmzzpilpnbmfcek6l57a.png"></div>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(Source)</a> <br><br>  Dans cet article, je vais vous expliquer comment identifier et visualiser le r√©sultat financier ajust√© des titres. <br><br>  En utilisant l'exemple du reporting client Opening Broker, nous consid√©rerons l'analyse et la consolidation des rapports de courtage pour le march√© boursier, en construisant l'architecture d'un syst√®me de reporting cloud avec une analyse simple et pratique ult√©rieure dans AWS Quicksight. <br><a name="habracut"></a><br><h2>  Description de la t√¢che </h2><br>  De nombreuses formations et le√ßons de formation nous parlent de la n√©cessit√© d'un journal du commer√ßant, o√π tous les param√®tres de transaction sont enregistr√©s pour une analyse plus approfondie et r√©sumer les r√©sultats de la strat√©gie de trading.  Je suis d'accord que cette approche du travail sur la Bourse vous permet de discipliner un commer√ßant, d'augmenter sa conscience, mais cela peut aussi vous fatiguer d'un processus fastidieux. <br><br>  J'avoue qu'au d√©but, j'ai essay√© soigneusement de suivre les conseils de la journalisation, √©crit m√©ticuleusement chaque transaction avec ses param√®tres dans un tableau Excel, construit des rapports, des graphiques r√©capitulatifs, planifi√© les transactions futures, mais ... J'en ai vite √©t√© fatigu√©. <br><br><div class="spoiler">  <b class="spoiler_title">Pourquoi tenir un journal d'un commer√ßant manuellement n'est pas pratique?</b> <div class="spoiler_text"><ul><li>  le remplissage manuel du journal (m√™me en utilisant une automatisation partielle, sous forme de d√©chargement des transactions quotidiennes du terminal de trading) se fatigue rapidement; </li><li>  il y a un risque √©lev√© d'erreur ou de faute de frappe avec la saisie manuelle; </li><li>  il peut arriver qu'un trader actif devienne un investisseur passif et il revient de moins en moins dans ce magazine, puis l'oublie compl√®tement (mon cas);  enfin et enfin </li><li>  nous pouvons programmer, pourquoi ne pas en profiter et automatiser l'ensemble du processus?  Alors allons-y! </li></ul></div></div><br>  Souvent, les soci√©t√©s de courtage sont des organisations de haute technologie qui fournissent √† leurs clients des analyses d'assez bonne qualit√© sur presque toutes les questions d'int√©r√™t.  Il est juste de dire que ces rapports s'am√©liorent de plus en plus avec chaque mise √† jour, mais m√™me les plus avanc√©s d'entre eux peuvent ne pas avoir la personnalisation et la consolidation que les clients exigeants et curieux veulent voir. <br><br>  Par exemple, Opening Broker vous permet de recevoir des rapports de courtage au format XML dans votre compte personnel, mais si vous avez un IIA et un compte de courtage r√©gulier √† la Bourse de Moscou (MOEX), ce seront deux rapports diff√©rents, et si vous avez un autre compte sur St. Petersburg Stock Exchange (SPB), puis les deux premiers en ajouteront un de plus. <br><br>  Au total, pour obtenir un journal consolid√© de l'investisseur, il faudra traiter trois fichiers au format XML. <br><br>  Les rapports susmentionn√©s sur le MOEX et le SPB diff√®rent l√©g√®rement dans leurs formats, qui devront √™tre pris en compte dans le processus de mise en ≈ìuvre de la cartographie des donn√©es. <br><br><h2>  Architecture du syst√®me en cours de d√©veloppement </h2><br>  Le sch√©ma ci-dessous montre le mod√®le d'architecture du syst√®me en cours de d√©veloppement: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vv/uq/ed/vvuqedfvl-l8tnghx3v6vtujabc.jpeg"></div><br><h2>  Impl√©mentation de l'analyseur </h2><br>  Nous recevrons des rapports sur les trois comptes dans le compte personnel pour la p√©riode maximale possible (peut √™tre divis√© en plusieurs rapports pour chaque ann√©e), les enregistrer au format XML et les mettre dans un dossier.  Comme donn√©es de test pour l'√©tude, nous utiliserons un portefeuille de clients fictifs, mais avec des param√®tres aussi proches que possible des r√©alit√©s du march√©. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/og/ig/xw/ogigxw4yganahuuzbdqecsbqmry.png"></div><br>  Supposons que l'investisseur M. X consid√©r√© ait un petit portefeuille de cinq titres: <br><br><ol><li>  Le rapport sur l'√©change SPB comprendra deux articles: Apple et Microsoft; </li><li>  Le rapport sur la bourse MOEX (courtage) contient un document: FGC UES; </li><li>  Le rapport sur le MOEX Exchange (IIS) contient deux titres: MMK et OFZ 24019; </li></ol><br>  Selon nos cinq titres, il peut y avoir des transactions sur l'achat / la vente, le paiement de dividendes et d'un coupon, le prix peut changer, etc.  Nous voulons voir la situation actuelle, √† savoir: le r√©sultat financier, en tenant compte de tous les paiements, transactions et valeur marchande actuelle. <br><br>  Et ici Python entre en jeu, nous lisons les informations de tous les rapports dans un tableau: <br><br><pre><code class="python hljs">my_files_list = [join(<span class="hljs-string"><span class="hljs-string">'Data/'</span></span>, f) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> listdir(<span class="hljs-string"><span class="hljs-string">'Data/'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isfile(join(<span class="hljs-string"><span class="hljs-string">'Data/'</span></span>, f))] my_xml_data = [] <span class="hljs-comment"><span class="hljs-comment">#     for f in my_files_list: tree = ET.parse(f) root = tree.getroot() my_xml_data.append(root)</span></span></code> </pre> <br><blockquote>  Pour l'analyse, les rapports n√©cessitent plusieurs entit√©s, √† savoir: <br><br><ul><li>  Positions de titres dans un portefeuille; </li><li>  Accords conclus; </li><li>  Op√©rations non commerciales et autres mouvements de compte; </li><li>  Prix ‚Äã‚Äãmoyens des positions ouvertes </li></ul></blockquote>  Afin de pr√©parer l'√©chantillon, nous utiliserons quatre dictionnaires pour d√©crire les ensembles ci-dessus. <br><br><pre> <code class="python hljs">dict_stocks = {<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'account'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'currency'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'current_cost'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'current_cost_rub'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'saldo'</span></span> : []} dict_deals = {<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'account'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'date_oper'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'type_oper'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'quantity'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'price'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'currency'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'brokerage'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'result'</span></span>: []} dict_flows = {<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'account'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'date_oper'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'type_oper'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'result'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'currency'</span></span>: []} dict_avg_price = {<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'account'</span></span>: [], <span class="hljs-string"><span class="hljs-string">'avg_open_price'</span></span> : []}</code> </pre> <br>  Quelques mots sur la signification de ces dictionnaires. <br><br><div class="spoiler">  <b class="spoiler_title">Dictionnaire Dict_stocks</b> <div class="spoiler_text">  Le dictionnaire dict_stocks est n√©cessaire pour stocker des informations g√©n√©rales sur le portefeuille: <br><br><ul><li>  Nom du papier (nom_stock); </li><li>  Nom du compte (SPB, MOEX BROK, MOEX IIS) (compte); </li><li>  Devise utilis√©e pour les r√®glements sur ce papier (devise); </li><li>  Valeur actuelle (au moment de la g√©n√©ration du rapport dans le courtier d'ouverture de compte personnel) (current_cost).  Ici, je tiens √† noter que pour les clients trop exigeants, il est possible d'apporter des am√©liorations suppl√©mentaires √† l'avenir et d'utiliser la r√©ception dynamique d'un devis de s√©curit√© √† partir d'un terminal de trading ou du site Web de la bourse correspondante; </li><li>  La valeur actuelle de la position de s√©curit√© au moment o√π le rapport a √©t√© g√©n√©r√© (current_cost_rub) <br>  De mani√®re similaire √† l'article ci-dessus, vous pouvez √©galement obtenir ici le taux de la Banque centrale au moment actuel ou le taux de change, comme vous le souhaitez. </li><li>  Solde courant des titres (saldo) </li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Dictionnaire dict_deals</b> <div class="spoiler_text">  Le dictionnaire dict_deals est n√©cessaire pour stocker les informations suivantes sur les transactions termin√©es: <br><br><ul><li>  Nom du papier (nom_stock); </li><li>  Nom du compte (SPB, MOEX BROK, MOEX IIS) (compte); </li><li>  Date de transaction, c.-√†-d.  T0 (date_oper); </li><li>  Type d'op√©ration (type_oper); </li><li>  Le volume de titres participant √† la transaction (quantit√©); </li><li>  Le prix auquel la transaction a √©t√© ex√©cut√©e (prix); </li><li>  Devise dans laquelle la transaction a √©t√© effectu√©e (devise); </li><li>  Commission de courtage pour une transaction (courtage); </li><li>  Le r√©sultat financier de la transaction (r√©sultat) </li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Dictionnaire Dict_flows</b> <div class="spoiler_text">  Le dictionnaire dict_flows refl√®te le mouvement des fonds sur le compte client et est utilis√© pour stocker les informations suivantes: <br><br><ul><li>  Nom du papier (nom_stock); </li><li>  Nom du compte (SPB, MOEX BROK, MOEX IIS) (compte); </li><li>  Date de transaction, c.-√†-d.  T0 (date_oper); </li><li>  Type d'op√©ration (type_oper).  Il peut prendre plusieurs valeurs: div, NKD, tax; </li><li>  Devise dans laquelle la transaction a √©t√© effectu√©e (devise); </li><li>  Le r√©sultat financier de l'op√©ration (r√©sultat) </li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Dictionnaire dict_avg_price</b> <div class="spoiler_text">  Le dictionnaire dict_avg_price est n√©cessaire pour les informations comptables au prix d'achat moyen pour chaque papier: <br><br><ul><li>  Nom du papier (nom_stock); </li><li>  Nom du compte (SPB, MOEX BROK, MOEX IIS) (compte); </li><li>  Prix ‚Äã‚Äãmoyen d'une position ouverte (avg_open_price) </li></ul></div></div><br>  Nous traitons un tableau de documents XML et remplissons ces dictionnaires avec les donn√©es appropri√©es: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#       for XMLdata in my_xml_data: #      exchange_name = 'SPB' if XMLdata.get('board_list') == ' ' else 'MOEX' client_code = XMLdata.get('client_code') account_name = get_account_name(exchange_name, client_code) #   current_position, deals, flows, stock_name, \ saldo, ticketdate, price, brokerage, \ operationdate, currency, \ current_cost, current_cost_rub, \ stock_name_deal, payment_currency, currency_flows = get_allias(exchange_name) #      get_briefcase(XMLdata) df_stocks = pd.DataFrame(dict_stocks) df_stocks.set_index("stock_name", drop = False, inplace = True) #    get_deals(XMLdata) df_deals = pd.DataFrame(dict_deals) df_avg = pd.DataFrame(dict_avg_price) #       get_nontrade_operation(XMLdata) df_flows = pd.DataFrame(dict_flows)</span></span></code> </pre> <br>  Tout le traitement passe par la boucle sur toutes les donn√©es XML des rapports.  Les informations sur la plateforme de trading, le code client sont les m√™mes dans tous les rapports, vous pouvez donc les extraire en toute s√©curit√© des m√™mes balises sans utiliser de mappage. <br><br>  Mais nous devons ensuite utiliser une conception sp√©ciale qui fournira l'alias n√©cessaire pour la balise bas√©e sur le rapport (SPB ou MOEX), car  les donn√©es de nature identique dans ces rapports sont appel√©es diff√©remment. <br><br><div class="spoiler">  <b class="spoiler_title">√âcarts de balise</b> <div class="spoiler_text"><ul><li>  La commission de courtier de transactions dans le rapport SBP se trouve dans la balise de <b>courtage</b> et dans le rapport <b>MOEX</b> - <b>broker_commission</b> ; </li><li>  La date de transaction du compte non commercial dans le rapport SPB est <b>operationdate</b> et dans MOEX, c'est <b>operation_date</b> , etc. </li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Exemple de mappage de balises</b> <div class="spoiler_text"><pre> <code class="python hljs">tags_mapping = { <span class="hljs-string"><span class="hljs-string">'SPB'</span></span>: { <span class="hljs-string"><span class="hljs-string">'current_position'</span></span>: <span class="hljs-string"><span class="hljs-string">'briefcase_position'</span></span>, <span class="hljs-string"><span class="hljs-string">'deals'</span></span>: <span class="hljs-string"><span class="hljs-string">'closed_deal'</span></span>, <span class="hljs-string"><span class="hljs-string">'flows'</span></span>: <span class="hljs-string"><span class="hljs-string">'nontrade_money_operation'</span></span>, ... <span class="hljs-string"><span class="hljs-string">'stock_name_deal'</span></span>: <span class="hljs-string"><span class="hljs-string">'issuername'</span></span>, <span class="hljs-string"><span class="hljs-string">'paymentcurrency'</span></span>: <span class="hljs-string"><span class="hljs-string">'paymentcurrency'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_flows'</span></span>: <span class="hljs-string"><span class="hljs-string">'currencycode'</span></span> }, <span class="hljs-string"><span class="hljs-string">'MOEX'</span></span>: { <span class="hljs-string"><span class="hljs-string">'current_position'</span></span>: <span class="hljs-string"><span class="hljs-string">'spot_assets'</span></span>, <span class="hljs-string"><span class="hljs-string">'deals'</span></span>: <span class="hljs-string"><span class="hljs-string">'spot_main_deals_conclusion'</span></span>, <span class="hljs-string"><span class="hljs-string">'flows'</span></span>: <span class="hljs-string"><span class="hljs-string">'spot_non_trade_money_operations'</span></span>, ... <span class="hljs-string"><span class="hljs-string">'stock_name_deal'</span></span>: <span class="hljs-string"><span class="hljs-string">'security_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'paymentcurrency'</span></span>: <span class="hljs-string"><span class="hljs-string">'price_currency_code'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency_flows'</span></span>: <span class="hljs-string"><span class="hljs-string">'currency_code'</span></span> } }</code> </pre></div></div><br>  La fonction get_allias renvoie le nom de la balise n√©cessaire pour le traitement, en prenant le nom de la plateforme de trading en entr√©e: <br><br><div class="spoiler">  <b class="spoiler_title">Fonction Get_allias</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_allias</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(exchange_name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>( tags_mapping[exchange_name][<span class="hljs-string"><span class="hljs-string">'current_position'</span></span>], tags_mapping[exchange_name][<span class="hljs-string"><span class="hljs-string">'deals'</span></span>], tags_mapping[exchange_name][<span class="hljs-string"><span class="hljs-string">'flows'</span></span>], ... tags_mapping[exchange_name][<span class="hljs-string"><span class="hljs-string">'stock_name_deal'</span></span>], tags_mapping[exchange_name][<span class="hljs-string"><span class="hljs-string">'paymentcurrency'</span></span>], tags_mapping[exchange_name][<span class="hljs-string"><span class="hljs-string">'currency_flows'</span></span>] )</code> </pre></div></div><br>  La fonction get_briefcase est responsable du traitement des informations sur l'√©tat du portefeuille client: <br><br><div class="spoiler">  <b class="spoiler_title">Fonction Get_briefcase</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_briefcase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLdata)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#         briefcase_position briefcase_position = XMLdata.find(current_position) if not briefcase_position: return try: for child in briefcase_position: stock_name_reduce = child.get(stock_name).upper() stock_name_reduce = re.sub('[,\.]|(\s?INC)|(\s+$)|([-\s]?)', '', stock_name_reduce) dict_stocks['stock_name'].append(stock_name_reduce) dict_stocks['account'].append(account_name) dict_stocks['currency'].append(child.get(currency)) dict_stocks['current_cost'].append(float(child.get(current_cost))) dict_stocks['current_cost_rub'].append(float(child.get(current_cost_rub))) dict_stocks['saldo'].append(float(child.get(saldo))) except Exception as e: print('get_briefcase --&gt; Oops! It seems we have a BUG!', e)</span></span></code> </pre> </div></div><br>  Ensuite, la fonction get_deals r√©cup√®re des informations sur les transactions: <br><br><div class="spoiler">  <b class="spoiler_title">Fonction Get_deals</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_deals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLdata)</span></span></span><span class="hljs-function">:</span></span> stock_name_proc = <span class="hljs-string"><span class="hljs-string">''</span></span> closed_deal = XMLdata.find(deals) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> closed_deal: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-comment"><span class="hljs-comment">#   SPB    -    , #    MOEX:  ,      #    : if exchange_name == 'SPB': sortchildrenby(closed_deal, stock_name_deal) for child in closed_deal: sortchildrenby(child, stock_name_deal) try: for child in closed_deal: stock_name_reduce = child.get(stock_name_deal).upper() stock_name_reduce = re.sub('[,\.]|(\s?INC)|(\s+$)|([-\s]?)', '', stock_name_reduce) dict_deals['stock_name'].append(stock_name_reduce) dict_deals['account'].append(account_name) dict_deals['date_oper'].append(to_dt(child.get(ticketdate)).strftime('%Y-%m-%d')) current_cost = get_current_cost(stock_name_reduce) #    SPB     - quantity, #   MOEX  : buy_qnty  sell_qnty if exchange_name == 'MOEX': if child.get('buy_qnty'): quantity = float(child.get('buy_qnty')) else: quantity = - float(child.get('sell_qnty')) else: quantity = float(child.get('quantity')) dict_deals['quantity'].append(quantity) dict_deals['price'].append(float(child.get('price'))) dict_deals['type_oper'].append('deal') dict_deals['currency'].append(child.get(payment_currency)) brok_comm = child.get(brokerage) if brok_comm is None: brok_comm = 0 else: brok_comm = float(brok_comm) dict_deals['brokerage'].append(float(brok_comm)) #         if stock_name_proc != stock_name_reduce: if stock_name_proc != '': put_avr_price_in_df(account_name, stock_name_proc, \ pnl.m_net_position, pnl.m_avg_open_price) current_cost = get_current_cost(stock_name_proc) pnl.update_by_marketdata(current_cost) if len(dict_deals['result']) &gt; 0: if exchange_name != 'SPB': dict_deals['result'][-1] = pnl.m_unrealized_pnl * 0.87 -dict_deals['brokerage'][-2] else: dict_deals['result'][-1] = pnl.m_unrealized_pnl - dict_deals['brokerage'][-2] stock_name_proc = stock_name_reduce pnl = PnlSnapshot(stock_name_proc, float(child.get('price')), quantity) dict_deals['result'].append(-1 * brok_comm) else: pnl.update_by_tradefeed(float(child.get('price')), quantity) #  ,   if quantity &lt; 0: if pnl.m_realized_pnl &gt; 0 and exchange_name != 'SPB': pnl_sum = pnl.m_realized_pnl * 0.87 - brok_comm else: pnl_sum = pnl.m_realized_pnl - brok_comm dict_deals['result'].append(float(pnl_sum)) else: pnl.update_by_marketdata(current_cost) dict_deals['result'].append(-1 * brok_comm) put_avr_price_in_df(account_name, stock_name_proc, \ pnl.m_net_position, pnl.m_avg_open_price) current_cost = get_current_cost(stock_name_proc) pnl.update_by_marketdata(current_cost) if len(dict_deals['result']) &gt; 0: if exchange_name != 'SPB': dict_deals['result'][-1] = pnl.m_unrealized_pnl * 0.87 -dict_deals['brokerage'][-2] else: dict_deals['result'][-1] = pnl.m_unrealized_pnl - dict_deals['brokerage'][-2] except Exception as e: print('get_deals --&gt; Oops! It seems we have a BUG!', e)</span></span></code> </pre> </div></div><br>  En plus de traiter un tableau avec des informations sur les param√®tres de la transaction, le prix moyen d'une position ouverte et r√©alis√© par PNL en utilisant la m√©thode FIFO est √©galement calcul√© ici.  La classe PnlSnapshot est responsable de ce calcul, dont la cr√©ation avec les petites modifications le code pr√©sent√© ici a √©t√© prise comme base: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">calcul P&amp;L</a> <br><br>  Et enfin, le plus difficile √† mettre en ≈ìuvre est la fonction d'obtention d'informations sur les op√©rations non commerciales - <b>get_nontrade_operation</b> .  Sa complexit√© r√©side dans le fait que dans le bloc de rapport utilis√© pour les op√©rations non commerciales, il n'y a pas d'informations claires sur le type de transaction et la s√©curit√© √† laquelle cette op√©ration est li√©e. <br><br><div class="spoiler">  <b class="spoiler_title">Exemple de destinations de paiement pour les op√©rations non commerciales</b> <div class="spoiler_text">  Le paiement de dividendes ou de revenus de coupons accumul√©s peut √™tre indiqu√© comme suit: <br><br><ol><li>  Paiement des revenus du client &lt;777777&gt; <font color="#cc0000">dividendes</font> &lt; <font color="#cc0000">APPLE</font> INC-ao&gt; -&gt; paiement des dividendes du rapport SPB; </li><li>  Paiement des revenus du client &lt;777777&gt; <font color="#cc0000">dividendes</font> &lt; <font color="#cc0000">MICROSOFT</font> COM-&gt; </li><li>  Paiement des revenus des clients 777777i (NKD 2 <font color="#cc0000">OFZ 24019</font> ) retenue √† la source 0,00 roubles -&gt; paiement du coupon du rapport MOEX; </li><li>  Paiement des revenus au client 777777 <font color="#cc0000">dividendes de FGC UES</font> -ao pr√©compte mobilier XX.XX roubles -&gt; paiement des dividendes du rapport MOEX.  etc. </li></ol></div></div><br>  En cons√©quence, il sera difficile de se passer d'expressions r√©guli√®res, nous les utiliserons donc au maximum.  L'autre c√¥t√© du probl√®me est que le nom de l'entreprise ne co√Øncide pas toujours avec le nom dans le portefeuille ou dans les transactions aux fins du paiement.  Par cons√©quent, le nom re√ßu de l'√©metteur du but du paiement doit √™tre corr√©l√© en plus avec le dictionnaire.  En tant que dictionnaire, nous utiliserons un √©ventail d'offres, car  il y a la liste la plus compl√®te des entreprises. <br><br>  La fonction <b>get_company_from_str</b> r√©cup√®re le nom de l'√©metteur dans le commentaire: <br><br><div class="spoiler">  <b class="spoiler_title">Fonction Get_company_from_str</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_company_from_str</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(comment)</span></span></span><span class="hljs-function">:</span></span> company_name = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-comment"><span class="hljs-comment">#    / flows_pattern = [ '^.+\s&lt;(\w+)?.+-&gt;$', '^.+\s(.+)-.+$', '^.+\(\s\d?\s(.+)\).+$', '^.+\s(.+)-.+$' ] for pattern in flows_pattern: match = re.search(pattern, comment) if match: return match.group(1).upper() return company_name</span></span></code> </pre> </div></div><br>  La fonction <b>get_company_from_briefcase</b> m√®ne le nom de la soci√©t√© au dictionnaire si elle trouve une correspondance parmi les soci√©t√©s qui ont particip√© aux transactions: <br><br><div class="spoiler">  <b class="spoiler_title">Fonction Get_company_from_briefcase</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_company_from_briefcase</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(company_name)</span></span></span><span class="hljs-function">:</span></span> company_name_full = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> value_from_dic = df_deals[df_deals[<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>].str.contains(company_name)] company_arr = value_from_dic[<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>].unique() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(company_arr) == <span class="hljs-number"><span class="hljs-number">1</span></span>: company_name_full = company_arr[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> company_name_full</code> </pre> <br></div></div><br>  Et enfin, la fonction finale de la collecte de donn√©es sur les op√©rations non commerciales est <b>get_nontrade_operation</b> : <br><br><div class="spoiler">  <b class="spoiler_title">Fonction Get_nontrade_operation</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_nontrade_operation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(XMLdata)</span></span></span><span class="hljs-function">:</span></span> nontrade_money_operation = XMLdata.find(flows) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> nontrade_money_operation: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> child <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> nontrade_money_operation: comment = child.get(<span class="hljs-string"><span class="hljs-string">'comment'</span></span>) type_oper_match = re.search(<span class="hljs-string"><span class="hljs-string">'||^.+.+.+$'</span></span>, comment) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type_oper_match: company_name = get_company_from_str(comment) type_oper = get_type_oper(comment) dict_flows[<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>].append(company_name) dict_flows[<span class="hljs-string"><span class="hljs-string">'account'</span></span>].append(account_name) dict_flows[<span class="hljs-string"><span class="hljs-string">'date_oper'</span></span>].append(to_dt(child.get(operationdate)).strftime(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%d'</span></span>)) dict_flows[<span class="hljs-string"><span class="hljs-string">'type_oper'</span></span>].append(type_oper) dict_flows[<span class="hljs-string"><span class="hljs-string">'result'</span></span>].append(float(child.get(<span class="hljs-string"><span class="hljs-string">'amount'</span></span>))) dict_flows[<span class="hljs-string"><span class="hljs-string">'currency'</span></span>].append(child.get(currency_flows)) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print(<span class="hljs-string"><span class="hljs-string">'get_nontrade_operation --&gt; Oops! It seems we have a BUG!'</span></span>, e)</code> </pre> </div></div><br>  Le r√©sultat de la collecte de donn√©es √† partir des rapports sera trois DataFrames, qui sont approximativement les suivants: <br><br><ol><li>  DataFrame avec des informations sur les prix moyens des positions ouvertes: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1o/c-/qs/1oc-qs_akl5cvraaq7sg7pvfwfu.png"></div></li><li>  Deal DataFrame: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gq/lp/xb/gqlpxby2utfl0ahr-fm8l_fqywc.png"></div></li><li>  DataFrame avec des informations sur les op√©rations non commerciales: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hx/-7/su/hx-7suk1zgheyiyr6ov6o0z5yd0.png"></div><br></li></ol><br>  Il ne nous reste donc plus qu'√† effectuer une union externe de la table des transactions avec la table d'informations du portefeuille: <br><br><pre> <code class="python hljs">df_result = pd.merge(df_deals, df_stocks_avg, how=<span class="hljs-string"><span class="hljs-string">'outer'</span></span>, on=[<span class="hljs-string"><span class="hljs-string">'stock_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'account'</span></span>, <span class="hljs-string"><span class="hljs-string">'currency'</span></span>]).fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>) df_result.sample(<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jo/wj/nz/jowjnzmldhgscs30ynz5lrdcueu.png"></div><br>  Enfin, la derni√®re √©tape du traitement du tableau de donn√©es est la fusion du tableau de donn√©es obtenu √† l'√©tape pr√©c√©dente avec le DataFrame pour les transactions non commerciales. <br>  Le r√©sultat du travail effectu√© est une grande table plate avec toutes les informations n√©cessaires √† l'analyse: <br><br><pre> <code class="python hljs">df_result_full = df_result.append(df_flows, ignore_index=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>).fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>) df_result_full.sample(<span class="hljs-number"><span class="hljs-number">10</span></span>).head()</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/cc/jc/rh/ccjcrh4dq5auyrg3jba6csb_s0g.png"></div><br>  L'ensemble de donn√©es r√©sultant (rapport final) du DataFrame est facilement t√©l√©charg√© sur le CSV et peut ensuite √™tre utilis√© pour une analyse d√©taill√©e dans n'importe quel syst√®me de BI. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> exists(<span class="hljs-string"><span class="hljs-string">'OUTPUT'</span></span>): makedirs(<span class="hljs-string"><span class="hljs-string">'OUTPUT'</span></span>) report_name = <span class="hljs-string"><span class="hljs-string">'OUTPUT\my_trader_diary.csv'</span></span> df_result_full.to_csv(report_name, index = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, encoding=<span class="hljs-string"><span class="hljs-string">'utf-8-sig'</span></span>)</code> </pre> <br><br><h2>  Charger et traiter des donn√©es dans AWS </h2><br>  Les progr√®s ne sont pas en reste et les services cloud et les mod√®les informatiques sans serveur gagnent d√©sormais en popularit√© dans le traitement et le stockage des donn√©es.  Cela est en grande partie d√ª √† la simplicit√© et au co√ªt peu √©lev√© de cette approche, lorsque vous n'avez pas besoin d'acheter un √©quipement co√ªteux pour construire une architecture syst√®me pour le calcul complexe ou le traitement de donn√©es volumineuses, mais que vous louez simplement l'√©nergie dans le cloud pour le temps dont vous avez besoin et d√©ployez les ressources n√©cessaires assez rapidement pour un co√ªt relativement faible. . <br><br>  Amazon est l'un des fournisseurs de cloud les plus importants et les plus connus du march√©.  Regardons l'exemple de l'environnement Amazon Web Services (AWS) pour construire un syst√®me analytique de traitement des donn√©es sur notre portefeuille d'investissement. <br><br>  AWS dispose d'une vaste s√©lection d'outils, mais nous utiliserons les √©l√©ments suivants: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amazon S3</a> - stockage d'objets, qui vous permet de stocker des quantit√©s presque illimit√©es d'informations; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">AWS Glue</a> - le service ETL cloud le plus puissant qui peut lui-m√™me d√©terminer la structure et g√©n√©rer le code ETL √† partir des donn√©es source donn√©es; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amazon Athena</a> , un service de requ√™te SQL en ligne sans serveur, vous permet d'analyser rapidement les donn√©es de S3 sans trop de pr√©paration.  Il a √©galement acc√®s aux m√©tadonn√©es qu'AWS Glue pr√©pare, ce qui vous permet d'acc√©der aux donn√©es imm√©diatement apr√®s avoir pass√© l'ETL; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Amazon QuickSight</a> - BI-service sans serveur, vous pouvez cr√©er n'importe quelle visualisation, des rapports analytiques "√† la vol√©e", etc. </li></ul><br>  La documentation d'Amazon est correcte, en particulier, il existe un bon article <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Meilleures pratiques lors de l'utilisation d'Athena avec AWS Glue</a> , qui d√©crit comment cr√©er et utiliser des tables et des donn√©es √† l'aide d'AWS Glue.  Profitons des id√©es principales de cet article et appliquons-les pour cr√©er notre propre architecture d'un syst√®me de rapports analytiques. <br><br>  Les fichiers CSV pr√©par√©s par notre analyseur de rapports seront ajout√©s au compartiment S3.  Il est pr√©vu que le dossier correspondant sur S3 soit r√©approvisionn√© tous les samedis - √† la fin de la semaine de n√©gociation, de sorte que vous ne pouvez pas vous passer du partitionnement des donn√©es √† la date de formation et de traitement du rapport. <br>  En plus d'optimiser le fonctionnement des requ√™tes SQL sur de telles donn√©es, cette approche nous permettra de mener des analyses compl√©mentaires, par exemple, pour obtenir la dynamique des changements dans le r√©sultat financier de chaque article, etc. <br><br><div class="spoiler">  <b class="spoiler_title">Travailler avec Amazon S3</b> <div class="spoiler_text"><ul><li>  Cr√©ez un compartiment sur S3, appelez-le ¬´report-parser¬ª; </li><li>  Dans ce bucket "report-parser" cr√©ez un dossier appel√© "my_trader_diary"; </li><li>  Dans le r√©pertoire "my_trader_diary", cr√©ez un r√©pertoire avec la date du rapport actuel, par exemple, "date_report = 2018-10-01" et placez-y le fichier CSV; </li><li>  Dans le seul but d'exp√©rimenter et de mieux comprendre le partitionnement, nous allons cr√©er deux r√©pertoires suppl√©mentaires: "date_report = 2018-09-27" et "date_report = 2018-10-08".  Nous y mettons le m√™me fichier CSV; </li><li>  Le dernier "analyseur de rapports" du compartiment S3 devrait ressembler √† celui illustr√© dans les images ci-dessous: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/n1/4z/c9/n14zc9odchiv6l-_dpc_qbs3s_o.png"></div></li></ul></div></div><br><div class="spoiler">  <b class="spoiler_title">Travailler avec AWS Glue</b> <div class="spoiler_text">  En gros, vous ne pouvez faire qu'Amazon Athena pour cr√©er une table externe √† partir des donn√©es se trouvant sur S3, mais AWS Glue est un outil plus flexible et pratique pour cela. <br><br><ul><li>  Nous allons dans AWS Glue et cr√©ons un nouveau robot, qui collectera une table √† partir de fichiers CSV distincts par date de rapport: <br><ul><li>  D√©finissez le nom du nouveau robot; </li><li>  Nous indiquons le r√©f√©rentiel d'o√π obtenir les donn√©es (s3: // report-parser / my_trader_diary /) </li><li>  Nous s√©lectionnons ou cr√©ons un nouveau r√¥le IAM qui aura acc√®s au lancement du robot et √† la ressource sp√©cifi√©e sur S3; </li><li>  Ensuite, vous devez d√©finir la fr√©quence de d√©marrage.  Nous l'avons mis sur demande pour l'instant, mais √† l'avenir, je pense que cela va changer et le lancement deviendra hebdomadaire; </li><li>  Enregistrez et attendez la cr√©ation du robot. </li></ul></li><li>  Lorsque le robot entre en √©tat Pr√™t, d√©marrez-le! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ed/xx/z9/edxxz9kurfrebky5-fuaqwzt-0e.png"></div></li><li>  Une fois que cela fonctionne, une nouvelle table my_trader_diary appara√Ætra dans l'onglet AWS Glue: Base de donn√©es -&gt; Tables: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u6/2n/rt/u62nrttephj6m-hxxguky4il6os.png"></div></li></ul></div></div><br>  Consid√©rez le tableau g√©n√©r√© plus en d√©tail. <br>  Si vous cliquez sur le nom de la table cr√©√©e, nous irons √† la page avec la description des m√©tadonn√©es.  En bas, il y a une disposition de table et la plus r√©cente est une colonne qui n'√©tait pas dans le fichier CSV source - date_report.  Cette colonne qu'AWS Glue cr√©e automatiquement en fonction de la d√©finition des sections des donn√©es source (dans Bucket S3, nous avons sp√©cialement nomm√© les dossiers date_report = YYYY-MM-DD, ce qui nous a permis de les utiliser comme sections s√©par√©es par date). <br><br><div class="spoiler">  <b class="spoiler_title">Partitionnement de table</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/5o/30/2v/5o302vb08y_zmylnfyaiign5us0.png"></div><br>  Sur la m√™me page dans le coin sup√©rieur droit, il y a un bouton Afficher les partitions, en cliquant sur lequel nous pouvons voir quelles sections notre tableau g√©n√©r√© comprend: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/82/0l/kk/820lkk4mytj34kzh0tt__ieb6me.png"></div></div></div><br><h2>  Analyse des donn√©es </h2><br>  Ayant √† notre disposition des donn√©es trait√©es t√©l√©charg√©es, nous pouvons facilement commencer √† les analyser.  Pour commencer, consid√©rez les capacit√©s d'Amazon Athena comme le moyen le plus simple et le plus rapide d'effectuer des requ√™tes analytiques.  Pour ce faire, acc√©dez au service Amazon Athena, s√©lectionnez la base de donn√©es dont nous avons besoin (financi√®re) et √©crivez le code SQL suivant: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> d.date_report, d.account, d.stock_name, d.currency, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(d.quantity) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> quantity, <span class="hljs-keyword"><span class="hljs-keyword">round</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(d.result), <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">result</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> my_trader_diary d <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> d.date_report, d.account, d.stock_name, d.currency <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> d.account, d.stock_name, d.date_report;</code> </pre> <br>  Cette demande nous affichera un r√©sultat financier net pour chaque titre pour toutes les dates de d√©claration.  Parce que  nous avons t√©l√©charg√© le m√™me rapport trois fois pour des dates diff√©rentes, le r√©sultat ne changera pas, ce qui, bien s√ªr, sur un march√© r√©el sera diff√©rent: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/9o/fg/dl/9ofgdloafbrxbvctdyprolilvna.png"></div><br>  Mais que se passe-t-il si nous voulons visualiser les donn√©es re√ßues sous forme de tableaux ou de diagrammes flexibles?  Ici, Amazon QuickSight vient √† la rescousse, avec l'aide de laquelle vous pouvez configurer des analyses flexibles presque aussi rapidement que l'√©criture d'une requ√™te SQL.  Nous allons acc√©der au service Amazon QuickSight (si vous n'y √™tes pas encore inscrit, l'inscription est obligatoire). <br><br>  Cliquez sur le bouton Nouvelles analyses -&gt; Nouvel ensemble de donn√©es et dans la fen√™tre qui appara√Æt s√©lectionnez les sources pour l'ensemble de donn√©es, cliquez sur Ath√©na: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yq/kr/bv/yqkrbv144qas16af4jolsj3rnci.png"></div><br><br>  Nous allons trouver un nom pour notre source de donn√©es, par exemple, "PNL_analysis" et cliquer sur le bouton "Cr√©er une source de donn√©es". <br><br>  Ensuite, la fen√™tre Choisissez votre table s'ouvre, o√π vous devez s√©lectionner la base de donn√©es et la table de source de donn√©es.  Nous s√©lectionnons la base de donn√©es - financi√®re, et la table qu'elle contient: my_traider_diary.  Par d√©faut, la table enti√®re est utilis√©e, mais si vous s√©lectionnez ¬´Utiliser SQL personnalis√©¬ª, vous pouvez personnaliser et affiner l'√©chantillon de donn√©es dont vous avez besoin.  Par exemple, nous utilisons l'ensemble du tableau et cliquez sur le bouton Modifier / Aper√ßu des donn√©es. <br><br>  Une nouvelle page s'ouvrira o√π vous pourrez effectuer des r√©glages suppl√©mentaires et traiter les donn√©es existantes. <br><br>  Nous devons maintenant ajouter des champs calcul√©s suppl√©mentaires √† notre jeu de donn√©es: trimestre et ann√©e de fonctionnement.  Un lecteur attentif peut remarquer que de telles manipulations √©taient plus faciles √† faire du c√¥t√© de l'analyseur avant d'enregistrer le rapport final au format CSV.  Sans aucun doute, mon objectif est maintenant de d√©montrer les capacit√©s et la flexibilit√© des param√®tres du syst√®me BI √† la vol√©e.  Nous continuons √† cr√©er des champs calcul√©s en cliquant sur le bouton ¬´Nouveau champ¬ª. <br><br><div class="spoiler">  <b class="spoiler_title">Cr√©er un nouveau champ</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/ax/1z/ag/ax1zagyy7nnryd62t5najdntcio.png"></div></div></div><br>  Pour mettre en √©vidence l'ann√©e de l'op√©ration et le trimestre, des formules simples sont utilis√©es: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pm/yc/bi/pmycbiybxqtus62nkaa_5v2fu4s.png"></div><br><div class="spoiler">  <b class="spoiler_title">Remplir des formules pour un nouveau champ</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/uo/e1/u1/uoe1u1uco3ygn7cljsr6qcnhwbk.png"></div></div></div><br>  Lorsque les champs calcul√©s ont √©t√© cr√©√©s avec succ√®s et ajout√©s √† la s√©lection, donnez un nom √† notre jeu de donn√©es, par exemple, "my_pnl_analyze" et cliquez sur le bouton "Enregistrer et visualiser". <br><br>  Apr√®s cela, nous transf√©rons vers la carte principale d'Amazon QuickSight et la premi√®re chose que nous devons faire est de configurer un filtre pour la date du rapport (en tenant compte du fait que les m√™mes donn√©es ont √©t√© collect√©es dans trois sections).  S√©lectionnez la date du rapport 2018-10-01 et cliquez sur le bouton Appliquer et acc√©dez √† l'onglet Visualiser. <br><br><div class="spoiler">  <b class="spoiler_title">R√©glage du filtre</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/an/jo/et/anjoet5xt_divhygnebb5v9ys8k.png"></div></div></div><br>          , ,       ,        (..      )   .      BI ‚Äì  .      ,       (   MS Excel) <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/90/3e/it/903eitay8v9j1psyz05d8qaqh_k.png"></div><blockquote>     ,          ,      , ..     1 509.91 .     (1 763.36 . ‚Äì     174 . ‚Äì   ).         . </blockquote><br>   ‚Äì  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/up/a7/qj/upa7qjdqjiqyo-j6tx0bnrth67m.png"></div><br>    ,   ,      ,               .       : sum_investment  count_days. <br><br><div class="spoiler"> <b class="spoiler_title"> sum_investment</b> <div class="spoiler_text">   sum_investment ( )   : <br><br> ifelse({stock_name} = ' 24019',{avg_open_price} * quantity * 10,{avg_open_price} * quantity) <br><br>           ,       ‚Äì     (    ‚Äì 1000). <br></div></div><br><div class="spoiler"> <b class="spoiler_title"> count_days</b> <div class="spoiler_text">   count_day (   )                : <br><br> dateDiff(parseDate({date_oper}),parseDate({date_report})) <br></div></div><br>      : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ut/ws/dk/utwsdkbzhksrjh3wunw_w6stqr0.png"></div><br><br><h2>    </h2><br>              ¬´ ¬ª    Amazon.          , ..            , ,          ,  . <br><br>              ,     (  )     .   ,        ,     ,       ‚Äì     . <br><br> ,           . ,      PNL        (,    ),       .‚Ä¶     Quicksight     ,    ,        Python      . <br><br>     -  ,      :          XML-! ,    ,  API               .       Amazon:   ETL-job  AWS Glue           Amazon QuickSight    . <br><br>          <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr426027/">https://habr.com/ru/post/fr426027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr426017/index.html">Comment r√©duire le nombre d'exp√©riences sur des animaux</a></li>
<li><a href="../fr426019/index.html">Station m√©t√©o sur Arduino de A √† Z. Partie 5</a></li>
<li><a href="../fr426021/index.html">libgdx et sentiments</a></li>
<li><a href="../fr426023/index.html">Le√ßon ouverte "Laboratoire virtuel √† Vagrant"</a></li>
<li><a href="../fr426025/index.html">Utiliser des m√©thodes offensives pour enrichir Threat Intelligence</a></li>
<li><a href="../fr426029/index.html">Vous abandonnez et souhaitez quitter la t√¢che? Voici √† quoi ressemble une formation de d√©veloppeur efficace</a></li>
<li><a href="../fr426031/index.html">S'inqui√©ter de capturer le monde avec l'intelligence artificielle peut √™tre bas√© sur des hypoth√®ses non scientifiques</a></li>
<li><a href="../fr426033/index.html">Les titans des maths s'affrontent sur la preuve √©pique de l'hypoth√®se abc</a></li>
<li><a href="../fr426039/index.html">Lancement d'urgence "Soyouz MS-10" (√©quipage sauv√©, retransmis)</a></li>
<li><a href="../fr426041/index.html">Solution symbolique d'√©quations et de syst√®mes diff√©rentiels lin√©aires par la m√©thode de transformation de Laplace utilisant SymPy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>