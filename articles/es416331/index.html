<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§Ωüèº üëñ üòµ La historia de refactorizar la aplicaci√≥n Citimobil üëÉüèª üè∞ üë©üèæ‚Äçü§ù‚Äçüë®üèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hace poco m√°s de un a√±o, me un√≠ al equipo de CityMobil como desarrollador de Android. Me acostumbr√© a un nuevo proyecto para m√≠, nuevos enfoques y tec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>La historia de refactorizar la aplicaci√≥n Citimobil</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/416331/"><img src="https://habrastorage.org/webt/0x/uf/e0/0xufe0ffghyddfihpobtxjywqpe.jpeg"><br><br>  Hace poco m√°s de un a√±o, me un√≠ al equipo de CityMobil como desarrollador de Android.  Me acostumbr√© a un nuevo proyecto para m√≠, nuevos enfoques y tecnolog√≠as.  En ese momento, Citimobil ya ten√≠a una historia bastante larga, como el proyecto que adopt√©, una aplicaci√≥n de Android para pedir un taxi.  Sin embargo, como suele suceder en tales casos, el c√≥digo llevaba los rastros caracter√≠sticos de las soluciones antiguas.  Y ahora, despu√©s de refactorizar con √©xito el c√≥digo, quiero compartir ideas que, en mi opini√≥n, pueden ser √∫tiles para aquellos que tienen que refactorizar un proyecto existente.  Y, sobre todo, puede ser √∫til para peque√±as empresas con peque√±os equipos de desarrollo. <br><a name="habracut"></a><br>  Una empresa a menudo prueba sus ideas, le dirige recursos limitados e intenta obtener retroalimentaci√≥n, prueba sus hip√≥tesis lo m√°s r√°pido posible.  En tales momentos, como regla general, el pensamiento de alta calidad y la implementaci√≥n de la arquitectura del proyecto, teniendo en cuenta el futuro, se desvanecen en un segundo plano.  Poco a poco, el proyecto adquiere una nueva funcionalidad, aparecen nuevos requisitos comerciales y todo esto afecta la base del c√≥digo.  "CityMobil" a este respecto no fue la excepci√≥n.  El proyecto fue desarrollado secuencialmente por varios equipos en la antigua oficina, luego, durante la mudanza, fue apoyado y correspondi√≥ parcialmente con la subcontrataci√≥n.  Luego comenzaron a formar un nuevo equipo y me entregaron trabajo en el proyecto. <br><br>  En ese momento, el "desarrollo" se traslad√≥ a la oficina de Mosc√∫, el trabajo estaba en su apogeo: constantemente aparec√≠an nuevas tareas interesantes y ambiciosas.  Sin embargo, el legado cada vez m√°s pone palos en las ruedas, y una vez que nos dimos cuenta de que hab√≠a llegado el momento de grandes cambios.  Desafortunadamente, no se encontr√≥ tanta literatura √∫til entonces.  Es comprensible, se conoce por experiencia, es casi imposible encontrar o encontrar la receta perfecta que funcione en el 100% de los casos. <br><br>  Lo primero que debe hacer es entender si realmente necesita refactorizar.  Esto debe considerarse si: <br><br><ol><li>  La velocidad de introducci√≥n de nuevas caracter√≠sticas es irrazonablemente baja, a pesar del alto nivel de especialistas en el equipo. </li><li>  Los cambios en el c√≥digo en una parte del programa pueden conducir a un comportamiento inesperado en otra parte. </li><li>  La adaptaci√≥n de los nuevos miembros del equipo se retrasa. </li><li>  La prueba de c√≥digo se ve obstaculizada por una fuerte conectividad. </li></ol><br>  Despu√©s de darse cuenta de la existencia de un problema, uno debe encontrar respuestas a las siguientes preguntas: <br><br><ol><li>  ¬øQu√©, de hecho, est√° mal? </li><li>  ¬øQu√© llev√≥ a esto? </li><li>  ¬øQu√© hay que hacer para evitar que esto vuelva a suceder? </li><li>  ¬øC√≥mo arreglar la situaci√≥n? </li></ol><br>  Es casi imposible construir un buen proyecto de larga duraci√≥n sin establecer una determinada arquitectura.  En nuestro proyecto, decidimos introducir una arquitectura "en capas", que ya ha demostrado su eficacia. <br><br>  Inicialmente, el proyecto fue escrito principalmente con la ayuda de las herramientas proporcionadas por el SDK de Android.  El enfoque indudablemente funciona, pero te obliga a escribir mucho c√≥digo repetitivo, lo que inhibe en gran medida el desarrollo.  Y considerando que hoy en d√≠a muchos est√°n acostumbrados a ciertas pilas de tecnolog√≠a, la adaptaci√≥n de los nuevos desarrolladores tom√≥ m√°s tiempo.  Poco a poco, llegamos a tecnolog√≠as m√°s convenientes que muchos conocen y valoran, y que han demostrado su fiabilidad y consistencia: <br><br><ul><li>  MVP - Patr√≥n de dise√±o de interfaz de usuario (Model-View-Presenter). </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Dagger 2</a> es un marco para implementar dependencias. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RxJava2</a> es una implementaci√≥n de ReactiveX, una biblioteca para crear programas as√≠ncronos y basados ‚Äã‚Äãen eventos utilizando el patr√≥n Observer para la JVM. </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cicerone</a> es una biblioteca que le permite simplificar la navegaci√≥n en la aplicaci√≥n. </li><li>  Una serie de bibliotecas espec√≠ficas para trabajar con mapas y ubicaciones. </li></ul><br>  Es muy importante adoptar un estilo de c√≥digo com√∫n para el equipo, para desarrollar un conjunto de mejores pr√°cticas.  Tambi√©n debe cuidar la infraestructura y los procesos.  Es mejor escribir pruebas para el nuevo c√≥digo de inmediato, ya que hay mucha informaci√≥n sobre este tema. <br><br>  Dentro del equipo, comenzamos a realizar una revisi√≥n del c√≥digo sin falta, no lleva tanto tiempo, pero la calidad del c√≥digo se ha vuelto mucho m√°s alta.  Incluso si est√° solo en el equipo, le recomiendo trabajar en Git Flow, crear solicitudes de fusi√≥n y al menos verificarlas usted mismo. <br><br>  Todo el trabajo "sucio" se puede delegar a CI; en nuestro caso, esto es TeamCity usando fastlane.  Lo configuramos para crear ramas de caracter√≠sticas, ejecutar las pruebas y dise√±ar la prueba interna.  En nuestro lugar, configuramos ensamblajes por separado para el entorno de producci√≥n / preparaci√≥n, caracter√≠stica- (los llamamos por el n√∫mero de tarea con la plantilla TASK # task_number) y liberamos ramas.  Esto facilita las pruebas y, si se produce un error, sabemos de inmediato qu√© debe corregirse y d√≥nde. <br><br>  Despu√©s de llevar a cabo todas las acciones preliminares, nos ponemos a trabajar.  Comenzamos una nueva vida en un proyecto antiguo creando un paquete (cleanarchitecture).  Es importante no olvidarse <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">del alias de actividad</a> al mover puntos de entrada a la aplicaci√≥n (a-la ActivitySplash).  Si descuida esto, entonces, en el mejor de los casos, perder√° el √≠cono en el iniciador y, en el peor de los casos, se violar√° la compatibilidad con otras aplicaciones. <br><br><pre><code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- android:name=".SplashActivity" - old launcher activity --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- android:targetActivity=".cleanarchitecture.presentation.SplashActivity" - new launcher activity --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity-alias</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".SplashActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetActivity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".cleanarchitecture.presentation.SplashActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.MAIN"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.category.LAUNCHER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity-alias</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Como sugiere la experiencia, es mejor comenzar a refactorizar con pantallas peque√±as y partes menores de la aplicaci√≥n.  Y cuando llegue el momento de procesar la parte m√°s compleja y voluminosa del programa, una parte considerable del c√≥digo ya estar√° escrita para otros m√≥dulos y podr√° reutilizarse. <br><br>  Adem√°s, tuvimos la gran tarea de redise√±ar completamente la aplicaci√≥n, lo que, a veces, result√≥ en una reescritura completa de las pantallas.  Comenzamos mejorando las pantallas auxiliares, prepar√°ndonos para pasar a lo principal. <br><br>  Despu√©s de reescribir la siguiente parte de la aplicaci√≥n, buscamos secciones de c√≥digo en la parte anterior de la aplicaci√≥n y las marcamos con anotaciones @Deprecated y an√°logos de estas: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">https://github.com/VitalyNikonorov/UsefulAnnotation</a> .  En ellos indicamos qu√© se debe hacer al reescribir esta parte del programa, qu√© funcionalidad y d√≥nde se implementa. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** * This class deprecated, you have to use * com.project.company.cleanarchitecture.utils.ResourceUtils * for new refactored classes */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Deprecated</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceHelper</span></span></span><span class="hljs-class"> </span></span>{...}</code> </pre> <br>  Despu√©s de que todo estaba listo para funcionar en la pantalla principal, decidieron no lanzar nuevas funciones durante 6-8 semanas.  Realizamos una reescritura global en nuestra propia sucursal, a la que luego agregamos solicitudes de fusi√≥n.  Al final de la refactorizaci√≥n, recibieron la codiciada solicitud de extracci√≥n y una aplicaci√≥n casi completamente actualizada. <br><img src="https://habrastorage.org/getpro/habr/post_images/1eb/062/3a2/1eb0623a2c56f5c26cc0d67925541049.png" width="500"><br>  Despu√©s de refactorizar, los cambios en la funcionalidad de la aplicaci√≥n se hicieron mucho m√°s f√°ciles.  Entonces, recientemente volvimos a participar en el procesamiento de pantallas de autorizaci√≥n. <br><br>  Inicialmente, se ve√≠an de la siguiente manera: <br><br><img src="https://habrastorage.org/webt/1o/c1/7c/1oc17clds4-xv0qli25p5c8klqo.png"><br><br>  Despu√©s del primer procesamiento y refactorizaci√≥n, comenzaron a verse as√≠: <br><br><img src="https://habrastorage.org/webt/cn/xn/00/cnxn00lr34u_gaj889l2uyzwwgi.png"><br><br>  Ahora se ven as√≠: <br><br><img src="https://habrastorage.org/webt/x-/bi/wc/x-biwc7n6mtpg4y2jj5gdfpfpkg.png"><br><br>  Como resultado, la primera iteraci√≥n tom√≥ m√°s del doble de tiempo que la segunda.  Como adem√°s de procesar la interfaz de usuario, tambi√©n tuve que entender el c√≥digo de l√≥gica de negocios ubicado en el mismo lugar, aunque esto no era necesario, pero se elimin√≥ la falla, lo que redujo el tiempo dedicado a la tarea en la segunda iteraci√≥n. <br><br>  ¬øQu√© tenemos en este momento? <br><br>  Para que el c√≥digo sea conveniente para su uso y desarrollo en el futuro, nos adherimos al principio de "arquitectura limpia".  No dir√≠a que tenemos Clean can√≥nico, pero adoptamos muchos enfoques.  La capa de presentaci√≥n se escribe utilizando el patr√≥n MVP (Modelo-Vista-Presentador). <br><br><ul><li>  Anteriormente, ten√≠amos que discutir interminablemente cada paso entre nosotros, para aclarar si el cambio en un m√≥dulo afecta la funcionalidad de otro.  Y ahora los gastos generales por correspondencia se han reducido significativamente. </li><li>  Debido a la unificaci√≥n de componentes y fragmentos individuales, el volumen de la base del c√≥digo ha disminuido considerablemente. </li><li>  Como resultado de la misma unificaci√≥n y procesamiento de la arquitectura, hay muchas m√°s clases, pero ahora hay una clara divisi√≥n de responsabilidades en ellas, lo que simplifica la comprensi√≥n del proyecto. </li><li>  La base del c√≥digo se divide en capas, para su separaci√≥n e interacci√≥n, se utiliza el marco de inyecci√≥n de dependencia Dagger 2. Esto redujo la coherencia del c√≥digo y aument√≥ la velocidad de prueba. </li></ul><br>  Hay muchos m√°s puntos interesantes relacionados con la refactorizaci√≥n de c√≥digo heredado.  Si los lectores estar√°n interesados, escribir√© m√°s sobre ellos la pr√≥xima vez.  Tambi√©n me alegrar√° si tambi√©n compartes tu experiencia. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416331/">https://habr.com/ru/post/es416331/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416319/index.html">Antecedentes: listas blancas de IMEI y Rossvyaz</a></li>
<li><a href="../es416321/index.html">C√≥mo convertirse en orador de conferencias internacionales de TI</a></li>
<li><a href="../es416323/index.html">La opci√≥n de acceso aleatorio a las configuraciones y grabaciones del registrador de autom√≥viles desde cualquier lugar en Internet</a></li>
<li><a href="../es416327/index.html">El nuevo est√°ndar 802.11ax (WLAN de alta eficiencia), ¬øqu√© hay de nuevo en √©l y cu√°ndo esperarlo?</a></li>
<li><a href="../es416329/index.html">El regreso de la estaci√≥n interplanetaria sovi√©tica. Previsi√≥n preliminar</a></li>
<li><a href="../es416333/index.html">Nueva ola: por qu√© la refrigeraci√≥n por agua en el centro de datos est√° ganando popularidad</a></li>
<li><a href="../es416335/index.html">Una peque√±a rese√±a de QCon 2018</a></li>
<li><a href="../es416339/index.html">Cuenta de Ethereum y Gu√≠a de propiedad del contrato</a></li>
<li><a href="../es416341/index.html">C√≥mo protegemos las rese√±as, compras y viajes de los estafadores</a></li>
<li><a href="../es416343/index.html">¬øDe d√≥nde vienen las redes neuronales y qu√© est√° sucediendo ahora?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>