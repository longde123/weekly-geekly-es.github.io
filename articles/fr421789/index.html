<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìâ üë©üèø‚Äçü§ù‚Äçüë®üèº üë®üèø‚Äç‚úàÔ∏è Faire du backend un "backend" √† nouveau üöπ üë©üèº‚Äçüç≥ ü§õüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nikolai Ryzhikov a propos√© sa version de la r√©ponse √† la question de savoir pourquoi il est si difficile de d√©velopper une interface utilisateur. Sur ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Faire du backend un "backend" √† nouveau</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/jugru/blog/421789/">  Nikolai Ryzhikov a propos√© sa version de la r√©ponse √† la question de savoir pourquoi il est si difficile de d√©velopper une interface utilisateur.  Sur l'exemple de son projet, il montrera que l'application sur le frontend de certaines id√©es du backend affecte √† la fois la r√©duction de la complexit√© de d√©veloppement et la testabilit√© du frontend. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/XBfi3Q74BnE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Le mat√©riel a √©t√© pr√©par√© sur la base d'un rapport de Nikolai Ryzhikov lors de la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">conf√©rence de</a> printemps <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HolyJS 2018 Piter</a> . <br><a name="habracut"></a><br>  Actuellement, Nikolai Ryzhikov travaille dans le secteur Sant√©-TI pour cr√©er des syst√®mes d'information m√©dicale.  Membre de la communaut√© des programmeurs fonctionnels FPROG de Saint-P√©tersbourg.  Membre actif de la communaut√© Online Clojure, membre de la norme d'√©change d'informations m√©dicales HL7 FHIR.  Programmation depuis 15 ans. <br><br><hr><br>  - J'ai toujours √©t√© tourment√© par la question: pourquoi l'interface graphique √©tait-elle toujours difficile √† faire?  Pourquoi cela a-t-il toujours soulev√© de nombreuses questions? <br><br>  Aujourd'hui, je vais essayer de sp√©culer sur la possibilit√© de d√©velopper efficacement une interface utilisateur.  Pouvons-nous r√©duire la complexit√© de son d√©veloppement. <br><br><h3>  Qu'est-ce que l'efficacit√©? </h3><br>  D√©finissons ce qu'est l'efficacit√©.  Du point de vue du d√©veloppement d'une interface utilisateur, l'efficacit√© signifie: <br><br><ul><li>  vitesse de d√©veloppement </li><li>  nombre de bugs </li><li>  montant d'argent d√©pens√© ... </li></ul><br>  Il y a une tr√®s bonne d√©finition: <br><br><blockquote>  L'efficacit√©, c'est faire plus avec moins </blockquote><br>  Apr√®s cette d√©termination, vous pouvez mettre tout ce que vous voulez - passer moins de temps, moins d'efforts.  Par exemple, ¬´si vous √©crivez moins de code, autorisez moins de bogues¬ª et atteignez le m√™me objectif.  En g√©n√©ral, nous d√©pensons beaucoup d'efforts en vain.  Et l'efficacit√© est un objectif plut√¥t √©lev√© - se d√©barrasser de ces pertes et ne faire que ce qui est n√©cessaire. <br><br><h3>  Qu'est-ce que la complexit√©? </h3><br>  √Ä mon avis, la complexit√© est le principal probl√®me du d√©veloppement. <br><br>  Fred Brooks a √©crit un article en 1986 intitul√© No silver bullet.  Il y r√©fl√©chit sur les logiciels.  Dans le mat√©riel, les progr√®s sont des sauts et des limites, et avec les logiciels, tout est bien pire.  La question principale de Fred Brooks - peut-il y avoir une telle technologie qui nous acc√©l√®re imm√©diatement d'un ordre de grandeur?  Et lui-m√™me donne une r√©ponse pessimiste, d√©clarant que dans le logiciel, il n'est pas possible d'y parvenir, expliquant sa position.  Je recommande fortement de lire cet article. <br><br>  Un de mes amis a dit que la programmation de l'interface utilisateur est un tel "sale probl√®me".  Vous ne pouvez pas vous asseoir une seule fois et trouver la bonne option pour que le probl√®me soit r√©solu pour toujours.  De plus, au cours des 10 derni√®res ann√©es, la complexit√© du d√©veloppement n'a fait qu'augmenter. <br><br><h3>  Il y a 12 ans ... </h3><br>  Nous avons commenc√© √† d√©velopper un syst√®me d'information m√©dicale il y a 12 ans.  D'abord avec flash.  Nous avons ensuite examin√© ce que Gmail avait commenc√© √† faire.  Nous l'avons aim√© et nous voulions passer au JavaScript avec HTML. <br><br>  En fait, nous √©tions alors bien en avance.  Nous avons pris un dojo, et en fait, nous avions tout de m√™me que nous avons maintenant.  Il y avait des composants qui √©taient assez bons dans les widgets dojo, il y avait un syst√®me de construction modulaire et exigeait que le compilateur Google Clojure soit construit et minimis√© (RequireJS et CommonJS ne sentaient m√™me pas alors). <br><br>  Tout a fonctionn√©.  Nous avons regard√© Gmail, avons √©t√© inspir√©s, avons pens√© que tout allait bien.  Au d√©but, nous n'avions √©crit qu'un lecteur de carte patient.  Ensuite, ils sont progressivement pass√©s √† l'automatisation d'autres flux de travail √† l'h√¥pital.  Et tout est devenu compliqu√©.  L'√©quipe semble √™tre des professionnels - mais chaque fonctionnalit√© a commenc√© √† grincer.  Cette sensation est apparue il y a 12 ans - et ne me quitte toujours pas. <br><br><h3>  Voie Rails + jQuery </h3><br>  Nous avons fait la certification du syst√®me et il a fallu r√©diger un portail patient.  C'est un tel syst√®me o√π le patient peut aller voir ses donn√©es m√©dicales. <br><br>  Notre backend a ensuite √©t√© √©crit en Ruby on Rails.  Bien que la communaut√© Ruby on Rails ne soit pas tr√®s grande, elle a eu un impact √©norme sur l'industrie.  De votre petite communaut√© passionn√©e, tous vos gestionnaires de packages, GitHub, Git, maquillages automatiques, etc. sont venus. <br><br>  L'essence du d√©fi auquel nous avons √©t√© confront√©s √©tait que nous devions mettre en ≈ìuvre le portail des patients en deux semaines.  Et nous avons d√©cid√© d'essayer la m√©thode Rails - pour tout faire sur le serveur.  Un tel web 2.0 classique.  Et ils l'ont fait - ils l'ont vraiment fait en deux semaines. <br><br>  Nous √©tions en avance sur la plan√®te enti√®re: nous avons fait du SPA, nous avions une API REST, mais pour une raison quelconque, elle √©tait inefficace.  Certaines fonctionnalit√©s pouvaient d√©j√† faire des unit√©s, car seules elles √©taient capables de g√©rer toute cette complexit√© des composants, la relation du backend avec le frontend.  Et quand nous avons pris la voie Rails - un peu d√©pass√©e par rapport √† nos normes, les fonctionnalit√©s ont soudainement commenc√© √† riveter.  Le d√©veloppeur moyen a commenc√© √† d√©ployer la fonctionnalit√© en quelques jours.  Et nous avons m√™me commenc√© √† √©crire des tests simples. <br><br>  Sur cette base, j'ai toujours une blessure: il y avait des questions.  Lorsque nous sommes pass√©s de Java √† Rails sur le backend, l'efficacit√© du d√©veloppement a √©t√© multipli√©e par 10 environ.  Mais lorsque nous avons marqu√© sur le SPA, l'efficacit√© du d√©veloppement a √©galement augment√© de mani√®re significative.  Comment √ßa? <br><br><h3>  Pourquoi le Web 2.0 a-t-il √©t√© efficace? </h3><br>  Commen√ßons par une autre question: pourquoi faisons-nous une application d'une seule page, pourquoi y croyons-nous? <br><br>  Ils nous disent simplement: nous devons le faire - et nous le faisons.  Et tr√®s rarement le remettre en question.  L'architecture REST API et SPA est-elle correcte?  Est-il vraiment adapt√© au cas o√π nous l'utilisons?  Nous ne pensons pas. <br><br>  D'un autre c√¥t√©, il existe des exemples inverses remarquables.  Tout le monde utilise GitHub.  Savez-vous que GitHub n'est pas une application d'une seule page?  GitHub est une application "rail" classique qui est rendue sur le serveur et o√π il y a peu de widgets.  Quelqu'un en a-t-il fait l'exp√©rience?  Je pense qu'il y a trois personnes.  Les autres n'ont m√™me pas remarqu√©.  Cela n'a pas affect√© l'utilisateur en aucune fa√ßon, mais en m√™me temps, pour une raison quelconque, nous devons payer 10 fois plus pour le d√©veloppement d'autres applications (√† la fois la force, la complexit√©, etc.).  Un autre exemple est Basecamp.  Twitter n'√©tait autrefois qu'une application Rails. <br><br>  En fait, il y a tellement d'applications Rails.  Cela a √©t√© partiellement d√©termin√© par le g√©nie DHH (David Heinemeier Hansson, cr√©ateur de Ruby on Rails).  Il a su cr√©er un outil ax√© sur les affaires, qui vous permet de faire imm√©diatement ce dont vous avez besoin, sans √™tre distrait par des probl√®mes techniques. <br><br>  Lorsque nous avons utilis√© la m√©thode Rails, bien s√ªr, il y avait beaucoup de magie noire.  Au fur et √† mesure de notre d√©veloppement, nous sommes pass√©s de Ruby √† Clojure, en conservant pratiquement la m√™me efficacit√©, mais en simplifiant tout un ordre de grandeur.  Et c'√©tait merveilleux. <br><br><h3>  12 ans se sont √©coul√©s </h3><br>  Au fil du temps, de nouvelles tendances ont commenc√© √† appara√Ætre dans le frontend. <br><br>  Nous avons compl√®tement ignor√© Backbone, car l'application dojo que nous avons √©crite auparavant √©tait encore plus sophistiqu√©e que ce que Backbone offrait. <br><br>  Puis vint Angular.  C'√©tait un ¬´rayon de lumi√®re¬ª assez int√©ressant - du point de vue de l'efficacit√©, Angular est tr√®s bon.  Vous prenez le d√©veloppeur moyen, et il rivalise avec la fonctionnalit√©.  Mais du point de vue de la simplicit√©, Angular apporte un tas de probl√®mes - il est opaque, complexe, il y a la veille, l'optimisation, etc. <br><br>  React est apparu, ce qui a apport√© un peu de simplicit√© (au moins la simplicit√© du rendu, qui, gr√¢ce au Virtual DOM, nous permet √† chaque fois comme pour simplement redessiner, comprendre et √©crire).  Mais en termes d'efficacit√©, pour √™tre honn√™te, React nous a consid√©rablement repouss√©s. <br><br>  Le pire, c'est que rien n'a chang√© en 12 ans.  Nous faisons toujours la m√™me chose qu'alors.  Il est temps de r√©fl√©chir - quelque chose ne va pas ici. <br><br>  Fred Brooks dit qu'il y a deux probl√®mes avec le d√©veloppement de logiciels.  Bien s√ªr, il voit le probl√®me principal de la complexit√©, mais il le divise en deux groupes: <br><br><ul><li>  complexit√© importante qui vient de la t√¢che elle-m√™me.  Il ne peut tout simplement pas √™tre jet√©, car il fait partie de la t√¢che. </li><li>  la complexit√© al√©atoire est celle que nous apportons en essayant de r√©soudre ce probl√®me. </li></ul><br>  La question est, quel est l'√©quilibre entre eux.  C'est pr√©cis√©ment ce dont nous discutons actuellement. <br><br><h3>  Pourquoi est-ce si p√©nible de faire l'interface utilisateur? </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/d22/667/d4e/d22667d4e3249034be27b07250a635ff.png"><br><br>  Il me semble que la premi√®re raison est notre mod√®le d'application mentale.  Les composants React sont une approche purement OOP.  Notre syst√®me est un graphe dynamique d'objets mutables interconnect√©s.  Les types Turing-complete g√©n√®rent constamment des n≈ìuds de ce graphe, certains n≈ìuds disparaissent.  Avez-vous d√©j√† essay√© d'imaginer votre application dans votre t√™te?  C'est effrayant!  Je pr√©sente g√©n√©ralement une application POO comme celle-ci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7cd/7b4/c7a/7cd7b4c7a846d2e973b012d566945a19.png"><br><br>  Je recommande la lecture des th√®ses de Roy Fielding (auteur de l'architecture REST).  Sa th√®se s'intitule ¬´Les styles architecturaux et la conception de logiciels en r√©seau¬ª.  Au tout d√©but, il y a une tr√®s bonne introduction, o√π il explique comment acc√©der √† l'architecture en g√©n√©ral, et pr√©sente les concepts: d√©compose le syst√®me en composants et les relations entre ces composants.  Il a une architecture "z√©ro", o√π tous les composants peuvent potentiellement √™tre associ√©s √† tous.  C'est le chaos architectural.  Il s'agit de notre repr√©sentation d'objet de l'interface utilisateur. <br><br>  Roy Fielding recommande de rechercher et d'imposer un ensemble de contraintes, car c'est un ensemble de contraintes qui d√©finit votre architecture. <br><br>  La chose la plus importante est probablement que les restrictions sont des amis de l'architecte.  Recherchez ces limitations r√©elles et concevez un syst√®me √† partir de celles-ci.  Parce que la libert√© est mauvaise.  La libert√© signifie que vous avez un million d'options parmi lesquelles vous pouvez choisir, et non un seul crit√®re par lequel vous pouvez d√©terminer si le choix √©tait bon.  Recherchez les contraintes et tirez parti de celles-ci. <br><br>  Il y a un excellent article intitul√© OUT OF THE TAR PIT (¬´Plus facile qu'un puits de goudron¬ª), dans lequel les gars apr√®s Brooks ont d√©cid√© d'analyser ce qui contribue exactement √† la complexit√© de l'application.  Ils en sont venus √† la conclusion d√©cevante qu'un syst√®me mutable √† propagation √©tatique est la principale source de complexit√©.  Ici, il est possible d'expliquer de mani√®re purement combinatoire - si vous avez deux cellules, et dans chacune d'elles une balle peut mentir (ou ne pas mentir), combien d'√©tats sont possibles?  - Quatre. <br><br>  Si trois cellules - 2 <sup>3</sup> , si 100 cellules - 2 <sup>100</sup> .  Si vous pr√©sentez votre application et comprenez √† quel point l'√©tat est flou, vous vous rendez compte qu'il existe un nombre infini d'√©tats possibles de votre syst√®me.  Si en m√™me temps vous n'√™tes limit√© par rien, c'est trop difficile.  Et le cerveau humain est faible, cela a d√©j√† √©t√© prouv√© par diverses √©tudes.  Nous sommes capables de tenir jusqu'√† trois √©l√©ments dans nos t√™tes en m√™me temps.  Certains disent sept, mais m√™me pour cela, le cerveau utilise un hack.  Par cons√©quent, la complexit√© est vraiment un probl√®me pour nous. <br><br>  Je recommande de lire cet article, o√π les gars arrivent √† la conclusion que quelque chose doit √™tre fait avec cet √©tat mutable.  Par exemple, il existe des bases de donn√©es relationnelles, vous pouvez y supprimer l'int√©gralit√© de l'√©tat mutable.  Et le reste se fait dans un style purement fonctionnel.  Et ils viennent juste avec l'id√©e d'une telle programmation fonctionnelle-relationnelle. <br><br>  Le probl√®me vient donc du fait que: <br><br><ul><li>  premi√®rement, nous n'avons pas un bon mod√®le d'interface utilisateur fixe.  Les approches par composants nous conduisent √† l'enfer existant.  Nous n'imposons aucune restriction, nous r√©pandons l'√©tat mutable, en cons√©quence, la complexit√© du syst√®me √† un moment donn√© nous √©crase tout simplement; <br></li><li>  deuxi√®mement, si nous √©crivons une application backend - frontend classique, c'est d√©j√† un syst√®me distribu√©.  Et la premi√®re r√®gle des syst√®mes distribu√©s est de ne pas cr√©er de syst√®mes distribu√©s (Premi√®re loi de la conception d'objets distribu√©s: ne distribuez pas vos objets - par Martin Fowler), car vous augmentez imm√©diatement la complexit√© d'un ordre de grandeur.  Quiconque a √©crit une int√©gration comprend que d√®s que vous entrez dans l'interaction intersyst√®mes, toutes les estimations de projet peuvent √™tre multipli√©es par 10. Mais nous l'oublions et passons aux syst√®mes distribu√©s.  C'√©tait probablement la principale consid√©ration lorsque nous sommes pass√©s √† Rails, en retournant tout le contr√¥le au serveur. <br></li></ul><br>  Tout cela est trop dur pour un pauvre cerveau humain.  R√©fl√©chissons √† ce que nous pouvons faire avec ces deux probl√®mes - le manque de restrictions en architecture (le graphique des objets mutables) et la transition vers des syst√®mes distribu√©s qui sont si complexes que les universitaires se demandent encore comment les faire correctement (en m√™me temps, nous nous condamner √† ces tourments dans les applications commerciales les plus simples)? <br><br><h3>  Comment le backend a-t-il √©volu√©? </h3><br>  Si nous √©crivons le backend dans le m√™me style que nous cr√©ons l'interface utilisateur maintenant, il y aura le m√™me ¬´bordel sanglant¬ª.  Nous y consacrerons autant de temps.  Donc vraiment une fois essay√© de le faire.  Puis, progressivement, ils ont commenc√© √† imposer des restrictions. <br><br>  La premi√®re grande invention de backend est la base de donn√©es. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/777/d5a/8aa/777d5a8aa62a6623e0918cdc57abdbee.png"><br><br>  Au d√©but, dans le programme, l'√âtat tout entier restait inexplicablement o√π, et il √©tait difficile de le g√©rer.  Au fil du temps, les d√©veloppeurs ont cr√©√© une base de donn√©es et y ont supprim√© tout l'√©tat. <br><br>  La premi√®re diff√©rence int√©ressante entre la base de donn√©es est que les donn√©es ne sont pas des objets avec leur propre comportement, ce sont des informations pures.  Il existe des tables ou d'autres structures de donn√©es (par exemple, JSON).  Ils n'ont aucun comportement, ce qui est √©galement tr√®s important.  Parce que le comportement est une interpr√©tation de l'information, et il peut y avoir de nombreuses interpr√©tations.  Et les faits de base - ils restent fondamentaux. <br><br>  Un autre point important est que sur cette base de donn√©es, nous avons un langage de requ√™te tel que SQL.  Du point de vue des limitations, dans la plupart des cas, SQL n'est pas un langage complet de Turing, il est plus simple.  En revanche, il est d√©claratif - plus expressif, car en SQL, vous dites ¬´quoi¬ª, pas ¬´comment¬ª.  Par exemple, lorsque vous combinez deux √©tiquettes dans SQL, SQL d√©cide comment effectuer cette op√©ration efficacement.  Lorsque vous cherchez quelque chose, il r√©cup√®re un index pour vous.  Vous ne le dites jamais explicitement.  Si vous essayez de combiner quelque chose en JavaScript, vous devrez √©crire un tas de code pour cela. <br><br>  Ici encore, il est important que nous ayons impos√© des restrictions et maintenant nous allons √† cette base √† travers un langage plus simple et plus expressif.  Complexit√© redistribu√©e. <br><br>  Une fois le backend entr√© dans la base, l'application est devenue apatride.  Cela conduit √† des effets int√©ressants - maintenant, par exemple, nous n'avons peut-√™tre pas peur de mettre √† jour l'application (l'√©tat ne se bloque pas dans la couche application en m√©moire, qui dispara√Ætra si l'application red√©marre).  Pour une couche d'application, l'apatridie est une bonne fonctionnalit√© et une excellente contrainte.  Mettez-le si vous le pouvez.  De plus, une nouvelle application peut √™tre tir√©e sur l'ancienne base, car les faits et leur interpr√©tation ne sont pas des choses li√©es. <br><br>  De ce point de vue, les objets et les classes sont terribles car ils collent les comportements et les informations.  L'information est plus riche, elle vit plus longtemps.  Les bases de donn√©es et les faits survivent au code √©crit en Delphi, Perl ou JavaScript. <br><br>  Lorsque le backend est arriv√© √† une telle architecture, tout est devenu beaucoup plus simple.  L'√®re d'or du Web 2.0 est arriv√©e.  Il √©tait possible d'obtenir quelque chose de la base de donn√©es, de soumettre les donn√©es √† des mod√®les (fonction pure) et de renvoyer le HTML-ku, qui est envoy√© au navigateur. <br><br>  Nous avons appris √† √©crire des applications assez complexes sur le backend.  Et la plupart des applications sont √©crites dans ce style.  Mais d√®s que le backend fait un pas de c√¥t√© - dans l'incertitude - les probl√®mes recommencent. <br><br>  Les gens ont commenc√© √† y penser et ont eu l'id√©e de jeter l'OLP et les rituels. <br><br>  Que font r√©ellement nos syst√®mes?  Ils prennent des informations quelque part - de l'utilisateur, d'un autre syst√®me, etc. - les mettent dans la base de donn√©es, les transforment, les v√©rifient d'une mani√®re ou d'une autre.  De la base, ils le sortent avec des requ√™tes astucieuses (analytiques ou synth√©tiques) et le retournent.  C‚Äôest tout.  Et c'est important √† comprendre.  De ce point de vue, les simulations sont un concept tr√®s faux et mauvais. <br><br>  Il me semble qu'en g√©n√©ral, l'ensemble de la POO est n√© de l'interface utilisateur.  Les gens ont essay√© de simuler et de simuler une interface utilisateur.  Ils ont vu un certain objet graphique sur le moniteur et ont pens√©: ce serait bien de le stimuler dans notre runtime, avec ses propri√©t√©s, etc.  Toute cette histoire est √©troitement li√©e √† la POO.  Mais la simulation est le moyen le plus simple et le plus na√Øf de r√©soudre la t√¢che.  Des choses int√©ressantes se font lorsque vous vous √©cartez.  De ce point de vue, il est plus important de s√©parer les informations du comportement, de se d√©barrasser de ces objets √©tranges, et tout deviendra beaucoup plus facile: votre serveur web re√ßoit une cha√Æne HTTP, renvoie une cha√Æne de r√©ponse HTTP.  Si vous ajoutez une base √† l'√©quation, vous obtenez une fonction g√©n√©ralement pure: le serveur accepte la base et demande, retourne une nouvelle base et une r√©ponse (donn√©es entr√©es - donn√©es restantes). <br><br>  Sur le chemin de cette simplification, les fonctionnaires ont jet√© un autre ‚Öî des bagages qui s'√©taient accumul√©s sur le backend.  Il n'√©tait pas n√©cessaire, c'√©tait juste un rituel.  Nous ne sommes toujours pas un d√©veloppeur de jeux - nous n'avons pas besoin que le patient et le m√©decin vivent en quelque sorte pendant l'ex√©cution, se d√©placent et suivent leurs coordonn√©es.  Notre mod√®le d'information est autre chose.  Nous ne pr√©tendons pas √™tre des m√©dicaments, des ventes ou quoi que ce soit d'autre.  Nous cr√©ons quelque chose de nouveau √† la jonction.  Par exemple, Uber ne simule pas le comportement des op√©rateurs et des machines - il introduit un nouveau mod√®le d'information.  Dans notre domaine, nous cr√©ons √©galement quelque chose de nouveau, pour que vous ressentiez la libert√©. <br><br>  Il n'est pas n√©cessaire d'essayer de simuler compl√®tement - cr√©er. <br><br><h3>  Clojure = JS-- </h3><br>  Il est temps de vous dire exactement comment vous pouvez tout jeter.  Et ici, je veux mentionner Clojure Script.  En fait, si vous connaissez JavaScript, vous connaissez Clojure.  Dans Clojure, nous n'ajoutons pas de fonctionnalit√©s √† JavaScript, mais nous les supprimons. <br><br><ul><li>  Nous jetons la syntaxe - dans Clojure (en Lisp) il n'y a pas de syntaxe.  Dans un langage ordinaire, nous √©crivons du code, qui est ensuite analys√© et un AST est obtenu, qui est compil√© et ex√©cut√©.  En Lisp, nous √©crivons imm√©diatement un AST qui peut √™tre ex√©cut√© - interpr√©t√© ou compil√©. <br></li><li>  Nous jetons la mutabilit√©.  Il n'y a pas d'objets ou de tableaux modifiables dans Clojure.  Chaque op√©ration g√©n√®re comme si une nouvelle copie.  De plus, cette copie est tr√®s bon march√©.  C'est si intelligemment con√ßu pour √™tre bon march√©.  Et cela nous permet de travailler, comme en math√©matiques, avec des valeurs.  Nous ne changeons rien - nous cr√©ons quelque chose de nouveau.  S√ªr, facile. <br></li><li>  Nous organisons des cours, des jeux avec des prototypes, etc.  Ce n'est tout simplement pas l√†. </li></ul><br>  En cons√©quence, nous avons toujours des fonctions et des structures de donn√©es sur lesquelles nous op√©rons, ainsi que des primitives.  Voici le Clojure entier.  Et l√†-dessus, vous pouvez faire la m√™me chose que vous faites dans d'autres langues, o√π il existe de nombreux outils suppl√©mentaires que personne ne sait utiliser. <br><br><h4>  Des exemples </h4><br>  Comment arriver √† Lisp via AST?  Voici une expression classique: <br><br><pre><code class="hljs lisp">(<span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) - <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre> <br>  Si nous essayons d'√©crire son AST, par exemple, sous la forme d'un tableau, o√π la t√™te est le type de n≈ìud, et ce qui est ensuite un param√®tre, nous obtiendrons quelque chose de similaire (nous essayons d'√©crire ceci en Java Script): <br><br><pre> <code class="hljs json">['minus', ['plus', <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">3</span></span>]</code> </pre><br>  Jetez maintenant les guillemets suppl√©mentaires, nous pouvons remplacer le moins par <code>-</code> , et le plus par <code>+</code> .  Jetez les virgules qui sont des espaces dans Lisp.  Nous obtiendrons le m√™me AST: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>)</code> </pre><br>  Et en Lisp, nous √©crivons tous comme √ßa.  Nous pouvons v√©rifier - c'est une fonction math√©matique pure (mon emacs est connect√© au navigateur; j'y laisse tomber le script, il y √©value la commande et le renvoie √† emacs - vous voyez la valeur apr√®s le symbole <code>=&gt;</code> ): <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">-</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-number"><span class="hljs-number">3</span></span>) =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  On peut aussi d√©clarer une fonction: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">defn</span></span> xplus [ab] (<span class="hljs-name"><span class="hljs-name">+</span></span> ab)) ((<span class="hljs-name"><span class="hljs-name">fn</span></span> [xy] (<span class="hljs-name"><span class="hljs-name">*</span></span> xy)) <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br>  Ou une fonction anonyme.  Cela semble peut-√™tre un peu effrayant: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">type</span></span> xplus)</code> </pre><br>  Son type est une fonction JavaScript: <br><br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> xplus) =&gt; #<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>]</code> </pre><br>  On peut l'appeler en lui passant le param√®tre: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">xplus</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br>  Autrement dit, tout ce que nous faisons est d'√©crire AST, qui est ensuite soit compil√© en JS ou en bytecode, soit interpr√©t√©. <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">defn</span></span> mymin [ab] (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">a</span></span> &gt; b) ba))</code> </pre><br>  Clojure est une langue h√©berg√©e.  Par cons√©quent, il prend des primitives du runtime parent, c'est-√†-dire que dans le cas de Clojure Script, nous aurons des types JavaScript: <br><br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) =&gt; #<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[Number]</code> </pre><br><br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> "string") =&gt; #<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[String]</code> </pre><br>  Donc, les expressions rationnelles sont √©crites: <br><br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> #"^Cl.*$") =&gt; #<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[RegExp]</code> </pre><br>  Les fonctions que nous avons sont des fonctions: <br><br><pre> <code class="hljs pgsql">(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> (fn [x] x)) =&gt; #<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span>]</code> </pre><br>  Ensuite, nous avons besoin d'une sorte de types composites. <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">def</span></span> user {<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-string"><span class="hljs-string">"niquola"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:address</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:city</span></span> <span class="hljs-string"><span class="hljs-string">"SPb"</span></span>} <span class="hljs-symbol"><span class="hljs-symbol">:profiles</span></span> [{<span class="hljs-symbol"><span class="hljs-symbol">:type</span></span> <span class="hljs-string"><span class="hljs-string">"github"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span> <span class="hljs-string"><span class="hljs-string">"https://‚Ä¶.."</span></span>} {<span class="hljs-symbol"><span class="hljs-symbol">:type</span></span> <span class="hljs-string"><span class="hljs-string">"twitter"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span> <span class="hljs-string"><span class="hljs-string">"https://‚Ä¶.."</span></span>}] <span class="hljs-symbol"><span class="hljs-symbol">:age</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>} (<span class="hljs-name"><span class="hljs-name">type</span></span> user)</code> </pre><br>  Cela peut √™tre lu comme si vous cr√©iez un objet en JavaScript: <br><br><pre> <code class="hljs pgsql">(def <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> {<span class="hljs-type"><span class="hljs-type">name</span></span>: "niquola" ‚Ä¶</code> </pre><br>  Dans Clojure, cela s'appelle hashmap.  Il s'agit d'un conteneur dans lequel se trouvent les valeurs.  Si des crochets sont utilis√©s - alors cela s'appelle un vecteur - c'est votre tableau: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">def</span></span> user {<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-string"><span class="hljs-string">"niquola"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:address</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:city</span></span> <span class="hljs-string"><span class="hljs-string">"SPb"</span></span>} <span class="hljs-symbol"><span class="hljs-symbol">:profiles</span></span> [{<span class="hljs-symbol"><span class="hljs-symbol">:type</span></span> <span class="hljs-string"><span class="hljs-string">"github"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span> <span class="hljs-string"><span class="hljs-string">"https://‚Ä¶.."</span></span>} {<span class="hljs-symbol"><span class="hljs-symbol">:type</span></span> <span class="hljs-string"><span class="hljs-string">"twitter"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span> <span class="hljs-string"><span class="hljs-string">"https://‚Ä¶.."</span></span>}] <span class="hljs-symbol"><span class="hljs-symbol">:age</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>} =&gt; #'intro/user (<span class="hljs-name"><span class="hljs-name">type</span></span> user)</code> </pre><br>  Nous enregistrons toute information avec des hashmaps et des vecteurs. <br><br>  Les noms de deux-points √©tranges ( <code>:name</code> ) sont les soi-disant caract√®res: des cha√Ænes constantes qui sont cr√©√©es pour √™tre utilis√©es comme cl√©s dans les hashmaps.  Dans diff√©rentes langues, ils sont appel√©s diff√©remment - symboles, autre chose.  Mais cela peut √™tre pris simplement comme une cha√Æne constante.  Ils sont assez efficaces - vous pouvez √©crire des noms longs et ne pas y consacrer beaucoup de ressources, car ils sont connect√©s (c'est-√†-dire qu'ils ne sont pas r√©p√©t√©s). <br><br>  Clojure fournit des centaines de fonctions pour g√©rer ces structures de donn√©es g√©n√©riques et primitives.  Nous pouvons ajouter, ajouter de nouvelles cl√©s.  De plus, nous avons toujours une s√©mantique de copie, c'est-√†-dire chaque fois que nous obtenons une nouvelle copie.  Vous devez d'abord vous y habituer, car vous ne pourrez plus enregistrer quelque chose, comme auparavant, quelque part dans la variable, puis modifier cette valeur.  Votre calcul doit toujours √™tre simple - tous les arguments doivent √™tre pass√©s explicitement √† la fonction. <br><br>  Cela m√®ne √† une chose importante.  Dans les langages fonctionnels, une fonction est un composant id√©al car elle re√ßoit tout explicitement √† l'entr√©e.  Pas de liens cach√©s divergents dans le syst√®me.  Vous pouvez prendre une fonction d'un endroit, la transf√©rer vers un autre et l'utiliser l√†-bas. <br><br>  Dans Clojure, nous avons d'excellentes op√©rations d'√©galit√© en valeur m√™me pour les types composites complexes: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">=</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:a</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>} {<span class="hljs-symbol"><span class="hljs-symbol">:a</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>}) =&gt; true</code> </pre><br>  Et cette op√©ration est bon march√© du fait que des structures immuables rus√©es peuvent √™tre compar√©es simplement par r√©f√©rence.  Par cons√©quent, m√™me une table de hachage avec des millions de cl√©s, nous pouvons comparer en une seule op√©ration. <br><br>  Au fait, les gars de React ont simplement copi√© l'impl√©mentation de Clojure et rendu JS immuable. <br><br>  Clojure a √©galement un tas d'op√©rations, par exemple, obtenir quelque chose √† partir d'un chemin imbriqu√© dans hashmap: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">get-in</span></span> user [<span class="hljs-symbol"><span class="hljs-symbol">:address</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:city</span></span>])</code> </pre><br>  Mettez quelque chose le long du chemin imbriqu√© dans hashmap: <br><br><pre> <code class="hljs ruby">(assoc-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> user [<span class="hljs-symbol"><span class="hljs-symbol">:address</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:city</span></span>] <span class="hljs-string"><span class="hljs-string">"LA"</span></span>) =&gt; {<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-string"><span class="hljs-string">"niquola"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:address</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:city</span></span> <span class="hljs-string"><span class="hljs-string">"LA"</span></span>}, <span class="hljs-symbol"><span class="hljs-symbol">:profiles</span></span> [{<span class="hljs-symbol"><span class="hljs-symbol">:type</span></span> <span class="hljs-string"><span class="hljs-string">"github"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span> <span class="hljs-string"><span class="hljs-string">"https://‚Ä¶.."</span></span>} {<span class="hljs-symbol"><span class="hljs-symbol">:type</span></span> <span class="hljs-string"><span class="hljs-string">"twitter"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span> <span class="hljs-string"><span class="hljs-string">"https://‚Ä¶.."</span></span>}], <span class="hljs-symbol"><span class="hljs-symbol">:age</span></span> <span class="hljs-number"><span class="hljs-number">37</span></span>}</code> </pre><br>  Mettre √† jour une valeur: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">update-in</span></span> user [<span class="hljs-symbol"><span class="hljs-symbol">:profiles</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:link</span></span>] (<span class="hljs-name"><span class="hljs-name">fn</span></span> [old] (<span class="hljs-name"><span class="hljs-name">str</span></span> old <span class="hljs-string"><span class="hljs-string">"+++++"</span></span>)))</code> </pre><br>  S√©lectionnez uniquement une cl√© sp√©cifique: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">select-keys</span></span> user [<span class="hljs-symbol"><span class="hljs-symbol">:name</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:address</span></span>])</code> </pre><br>  M√™me chose avec le vecteur: <br><br><pre> <code class="hljs pgsql">(def clojurists [{:<span class="hljs-type"><span class="hljs-type">name</span></span> "Rich"} {:<span class="hljs-type"><span class="hljs-type">name</span></span> "Micael"}]) (first clojurists) (second clojurists) =&gt; {:<span class="hljs-type"><span class="hljs-type">name</span></span> "Michael"}</code> </pre><br>  Il existe des centaines d'op√©rations de la biblioth√®que de base qui vous permettent d'op√©rer sur ces structures de donn√©es.  Il y a une interop√©rabilit√© avec l'h√¥te.  Vous devez vous y habituer un peu: <br><br><pre> <code class="hljs pgsql">(js/alert "Hello!") =&gt; nil &lt;/csource&gt;         "".    <span class="hljs-keyword"><span class="hljs-keyword">location</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>: &lt;source lang="clojure"&gt; (.-<span class="hljs-keyword"><span class="hljs-keyword">location</span></span> js/<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>)</code> </pre><br>  Il y a tous les sucres qui vont le long des cha√Ænes: <br><br><pre> <code class="hljs pgsql">(.. js/<span class="hljs-keyword"><span class="hljs-keyword">window</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">location</span></span> -href) =&gt; "http://localhost:3000/#/billing/dashboard"</code> </pre><br><pre> <code class="hljs pgsql">(.. js/<span class="hljs-keyword"><span class="hljs-keyword">window</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">location</span></span> -host) =&gt; "localhost:3000"</code> </pre><br>  Je peux prendre la date JS et en retourner l'ann√©e: <br><br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">let</span></span> [d (<span class="hljs-name"><span class="hljs-name">js/Date</span></span>.)] (.getFullYear d)) =&gt; <span class="hljs-number"><span class="hljs-number">2018</span></span></code> </pre><br>  Rich Hickey, le cr√©ateur de Clojure, nous a s√©v√®rement limit√©s.  Nous n'avons vraiment rien d'autre, nous faisons donc tout par le biais de structures de donn√©es g√©n√©riques.  Par exemple, lorsque nous √©crivons SQL, nous l'√©crivons g√©n√©ralement avec une structure de donn√©es.  Si vous regardez attentivement, vous verrez que ce n'est qu'une carte de hachage dans laquelle quelque chose est int√©gr√©.  Ensuite, il y a une fonction qui traduit tout cela en une cha√Æne SQL: <br><br><pre> <code class="hljs ruby">{select [<span class="hljs-symbol"><span class="hljs-symbol">:*</span></span>] <span class="hljs-symbol"><span class="hljs-symbol">:from</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:users</span></span>] <span class="hljs-symbol"><span class="hljs-symbol">:where</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> <span class="hljs-string"><span class="hljs-string">"user-1"</span></span>]} =&gt; {<span class="hljs-symbol"><span class="hljs-symbol">:select</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:*</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">:from</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:users</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">:where</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:</span></span>= <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span> <span class="hljs-string"><span class="hljs-string">"user-1"</span></span>]}</code> </pre><br>  Nous √©crivons √©galement des routages avec une structure de donn√©es et des structures de donn√©es compos√©es: <br><br><pre> <code class="hljs ruby">{<span class="hljs-string"><span class="hljs-string">"users"</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:get</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:handler</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:users-list</span></span>}} <span class="hljs-symbol"><span class="hljs-symbol">:get</span></span> {<span class="hljs-symbol"><span class="hljs-symbol">:handler</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:welcome-page</span></span>}}</code> </pre><br><pre> <code class="hljs json">[:div.row [:div {:on-click #(.log js/console <span class="hljs-string"><span class="hljs-string">"Hello"</span></span>)} <span class="hljs-string"><span class="hljs-string">"User "</span></span>]]</code> </pre><br><h3>  DB dans l'interface utilisateur </h3><br>  Nous avons donc discut√© de Clojure.  Mais j'ai mentionn√© plus t√¥t qu'une grande r√©ussite dans le backend √©tait la base de donn√©es.  Si vous regardez ce qui se passe dans le frontend maintenant, nous verrons que les gars utilisent le m√™me mod√®le - ils entrent dans la base de donn√©es dans l'interface utilisateur (dans une application d'une seule page). <br><br>  Les bases de donn√©es sont introduites dans elm-architecture, dans le re-frame script√© par Clojure et m√™me sous une forme limit√©e dans flux et redux (des plugins suppl√©mentaires doivent √™tre d√©finis ici pour lancer des requ√™tes).  L'architecture, le recadrage et le flux de l'orme ont √©t√© lanc√©s √† peu pr√®s au m√™me moment et emprunt√©s les uns aux autres.  Nous √©crivons sur re-frame.  Ensuite, je vais parler un peu de son fonctionnement. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ff/11e/ddf/8ff11eddf7c9e2eb3254a3d9eee47d3d.png"><br><br>  L'√©v√©nement (c'est un peu comme redux) vole hors de la vue-chi, qui est captur√©e par un certain contr√¥leur.  Le contr√¥leur que nous appelons gestionnaire d'√©v√©nements.  Le gestionnaire d'√©v√©nements √©met un effet, qui est √©galement une personne interpr√©t√©e par la structure de donn√©es. <br><br>  Un type d'effet est la mise √† jour de la base de donn√©es.  Autrement dit, il prend la valeur de base de donn√©es actuelle et en renvoie une nouvelle.  Nous avons √©galement une chose telle que l'abonnement - un analogue des demandes sur le backend.  Autrement dit, ce sont des requ√™tes r√©actives que nous pouvons lancer dans cette base de donn√©es.  Ces demandes r√©actives, nous nous regroupons ensuite sur la vue.  Dans le cas de r√©agir, nous semblons redessiner compl√®tement, et si le r√©sultat de cette demande a chang√© - c'est pratique. <br>  React n'est pr√©sent √† nos c√¥t√©s que quelque part √† la toute fin, et en g√©n√©ral l'architecture n'y est en aucun cas li√©e.  Cela ressemble √† ceci: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42b/655/922/42b65592288ba93676e13b086f3f48b7.png"><br><br>  Ici est ajout√© ce qui manque, par exemple, dans redux-s. <br><br>  Tout d'abord, nous s√©parons les effets.  L'application frontale n'est pas autonome.  Il a un certain backend - une sorte de ¬´source de vrai¬ª.  L'application doit constamment √©crire quelque chose et lire quelque chose √† partir de l√†.  Pire encore, s'il a plusieurs backends vers lesquels il devrait aller.  Dans la mise en ≈ìuvre la plus simple, cela pourrait √™tre fait directement dans l'action creater - dans votre contr√¥leur, mais c'est mauvais.  Par cons√©quent, les gars de re-frame introduisent un niveau suppl√©mentaire d'indirection: une certaine structure de donn√©es sort du contr√¥leur, ce qui indique ce qui doit √™tre fait.  Et ce poste a son propre gestionnaire qui fait le sale boulot.  Il s'agit d'une introduction tr√®s importante, dont nous discuterons un peu plus tard. <br><br>  C'est √©galement important (parfois ils l'oublient) - certains faits fondamentaux devraient √™tre dans la base.  Tout le reste peut √™tre supprim√© de la base de donn√©es - et les requ√™tes le font g√©n√©ralement, elles transforment les donn√©es - elles n'ajoutent pas de nouvelles informations, mais structurent correctement celles existantes.  Nous avons besoin de cette requ√™te.  En redux, √† mon avis, cela permet maintenant de res√©lectionner, et en recadrage nous l'avons sorti de la bo√Æte (int√©gr√©). <br><br>  Jetez un ≈ìil √† notre sch√©ma d'architecture.  Nous avons reproduit un petit backend (dans le style du Web 2.0) avec une vue base, contr√¥leur,.  La seule chose ajout√©e est la r√©activit√©.  C'est tr√®s similaire √† MVC, sauf que tout est au m√™me endroit.  Une fois que les premiers MVC pour chaque widget ont cr√©√© leur propre mod√®le, mais ici, tout est pli√© en une seule base.  En principe, vous pouvez synchroniser avec le backend du contr√¥leur via l'effet, vous pouvez trouver un look plus g√©n√©rique pour que la base de donn√©es fonctionne comme un proxy pour le backend.  Il existe m√™me une sorte d'algorithme g√©n√©rique: vous √©crivez dans votre base de donn√©es locale et elle se synchronise avec la principale. <br><br>  Maintenant, dans la plupart des cas, la base est juste une sorte d'objet dans lequel nous √©crivons quelque chose en redux.  Mais en principe, on peut imaginer qu'il se d√©veloppera plus loin en une base de donn√©es √† part enti√®re avec un langage de requ√™te riche.  Peut-√™tre avec une sorte de synchronisation g√©n√©rique.  Par exemple, il existe datomic - une base de donn√©es logique √† trois magasins qui s'ex√©cute directement dans le navigateur.  Vous le ramassez et y mettez tout votre √©tat.  Datomic a un langage de requ√™te assez riche, comparable en puissance √† SQL, et m√™me gagnant quelque part.  Un autre exemple est Google a √©crit lovefield.  Tout ira quelque part l√†-bas. <br><br>  Ensuite, je vais expliquer pourquoi nous avons besoin d'un abonnement r√©actif. <br><br>  Nous obtenons maintenant la premi√®re perception na√Øve - nous avons obtenu l'utilisateur du backend, l'avons mis dans la base de donn√©es, puis nous devons le dessiner.  Au moment du rendu, une certaine logique se produit, mais nous m√©langeons cela au rendu, √† la vue.  Si nous commen√ßons imm√©diatement √† rendre cet utilisateur, nous obtenons un gros morceau d√©licat qui fait quelque chose avec le DOM virtuel et autre chose.  Et il est m√©lang√© avec le mod√®le logique de notre point de vue. <br><br>  Un concept tr√®s important qui doit √™tre compris: en raison de la complexit√© de l'interface utilisateur, il doit √©galement √™tre mod√©lis√©.  Il est n√©cessaire de s√©parer la fa√ßon dont il est dessin√© (tel qu'il appara√Æt) de son mod√®le logique.  Le mod√®le logique sera alors plus stable.  Vous ne pouvez pas le surcharger avec la d√©pendance √† un cadre sp√©cifique - Angular, React ou VueJS.  Un mod√®le est le citoyen de premi√®re classe habituel dans votre runtime.  Id√©alement, s'il ne s'agit que de donn√©es et d'un ensemble de fonctions au-dessus. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7b/52f/9c3/c7b52f9c3c048a91276c3ae8dcd33771.png"><br><br>  Autrement dit, √† partir du mod√®le backend (objet), nous pouvons obtenir un mod√®le de vue dans lequel, sans utiliser encore de rendu, nous pouvons recr√©er le mod√®le logique.  S'il existe une sorte de menu ou quelque chose de similaire - tout cela peut √™tre fait dans le mod√®le de vue. <br><br><h3>  Pourquoi? </h3><br>  Pourquoi faisons-nous tous cela? <br><br>  Je n'ai vu de bons tests d'interface utilisateur que lorsqu'il y a une √©quipe de 10 testeurs. <br>  Habituellement, il n'y a pas de test d'interface utilisateur.  Par cons√©quent, nous essayons de pousser cette logique hors des composants du mod√®le de vue.  L'absence de tests est un tr√®s mauvais signe, indiquant que quelque chose ne va pas l√†-bas, d'une mani√®re ou d'une autre, tout est mal structur√©. <br><br>  Pourquoi l'interface utilisateur est-elle difficile √† tester?  Pourquoi les gars du backend ont-ils appris √† tester leur code, ont fourni une couverture √©norme et cela aide vraiment √† vivre avec le code du backend?  Pourquoi l'interface utilisateur est-elle incorrecte?  Tr√®s probablement, nous faisons quelque chose de mal.  Et tout ce que j'ai d√©crit ci-dessus nous a r√©ellement orient√©s vers la testabilit√©. <br><br><h3>  Comment faisons-nous les tests? </h3><br>  Si vous regardez attentivement, la partie de notre architecture, contenant le contr√¥leur, l'abonnement et la base de donn√©es, n'est m√™me pas li√©e √† JS.  Autrement dit, il s'agit d'une sorte de mod√®le qui fonctionne simplement sur les structures de donn√©es: nous les ajoutons quelque part, transformons en quelque sorte, supprimons la requ√™te.  Gr√¢ce aux effets, nous sommes d√©connect√©s de l'interaction avec le monde ext√©rieur.  Et cette pi√®ce est enti√®rement portable.  Il peut √™tre √©crit dans le soi-disant cljc - c'est un sous-ensemble commun entre Clojure Script et Clojure, qui se comporte de la m√™me mani√®re ici et l√†.  Nous pouvons simplement couper ce morceau du frontend et le mettre dans la JVM - o√π le backend vit.  Ensuite, nous pouvons √©crire un autre effet dans la JVM, qui atteint directement le point final - il tire le routeur sans aucune conversion de cha√Æne http, analyse, etc. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b2/b23/d1d/5b2b23d1d90d589a6cff9d99582d416d.png"><br><br>  En cons√©quence, nous pouvons √©crire un test tr√®s simple - le m√™me test fonctionnel int√©gral que les gars √©crivent sur le backend.  Nous lan√ßons un certain √©v√©nement, il lance un effet qui frappe directement le point final sur le backend.  Il nous renvoie quelque chose, le met dans la base de donn√©es, calcule l'abonnement, et dans l'abonnement se trouve une vue logique (nous y mettons la logique de l'interface utilisateur au maximum).  Nous affirmons ce point de vue. <br><br>  Ainsi, nous pouvons tester 80% du code sur le backend, tandis que tous les outils de d√©veloppement du backend sont √† notre disposition.  √Ä l'aide d'appareils fixes ou de certaines usines, nous pouvons recr√©er une situation sp√©cifique dans la base de donn√©es. <br><br>  Par exemple, nous avons un nouveau patient ou quelque chose n'est pas pay√©, etc.  Nous pouvons passer par un tas de combinaisons possibles. <br><br>  Ainsi, nous pouvons traiter le deuxi√®me probl√®me - avec un syst√®me distribu√©.  Parce que le contrat entre les syst√®mes est pr√©cis√©ment le principal point sensible, car ce sont deux temps d'ex√©cution diff√©rents, deux syst√®mes diff√©rents: le backend a chang√© quelque chose et quelque chose s'est cass√© sur notre frontend (vous ne pouvez pas √™tre s√ªr que cela ne se produira pas). <br><br><h3>  D√©monstration </h3><br>  Voici √† quoi cela ressemble dans la pratique.  C'est un assistant backend qui a nettoy√© la base et y a √©crit un petit monde: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/919/ef0/e23/919ef0e23883707631e051ff6c62acf6.png"><br><br>  Ensuite, nous jetons l'abonnement: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2a1/bcb/35a/2a1bcb35a77444806d276e859f7aaebb.png"><br><br>  Habituellement, l'URL d√©finit compl√®tement la page et un √©v√©nement est d√©clench√© - vous √™tes maintenant sur telle ou telle page avec un ensemble de param√®tres.  Ici, nous sommes entr√©s dans un nouveau flux de travail et notre abonnement est revenu: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/956/34e/776/95634e7760690ebbef5ce5bbc51de9d6.png"><br><br>  Derri√®re la sc√®ne, il est all√© √† la base, a obtenu quelque chose, l'a mis dans notre base d'interface utilisateur.  L'abonnement a fonctionn√© et en a d√©duit le mod√®le de vue logique. <br><br>  Nous l'avons initialis√©.  Et voici notre mod√®le logique: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d84/ee7/e0a/d84ee7e0a7e22ab8da638d8488df8833.png"><br><br>  M√™me sans regarder l'interface utilisateur, nous pouvons deviner ce qui sera dessin√© selon ce mod√®le: un avertissement viendra, des informations sur le patient, des rencontres et un ensemble de liens se trouveront (c'est un widget de workflow qui dirige la r√©ception √† certaines √©tapes lorsque le patient arrive). <br><br>  Ici, nous arrivons √† un monde plus complexe.  Ils ont effectu√© certains paiements et ont √©galement test√© apr√®s l'initialisation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ea/032/f24/4ea032f24871cc57608dddf4687c30d7.png"><br><br>  S'il a d√©j√† pay√© la visite, il le verra dans l'interface utilisateur: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b8/71a/910/0b871a910ae3741ebd45e2b442f76d9c.png"><br><br>  Ex√©cutez les tests, d√©finis sur CI.  La synchronisation entre le backend et le frontend sera garantie par des tests, et pas honn√™tement. <br><br><h3>  Retour au backend? </h3><br>  Nous avons introduit les tests il y a six mois et nous avons vraiment aim√©.  Le probl√®me de la logique floue demeure.  Plus une application m√©tier est intelligente, plus elle a besoin d'informations pour certaines √©tapes.  Si vous essayez d'ex√©cuter une sorte de flux de travail √† partir du monde r√©el, il y aura des d√©pendances sur tout: pour chaque interface utilisateur, vous devez obtenir quelque chose de diff√©rentes parties de la base de donn√©es sur le backend.  Si nous √©crivons des syst√®mes comptables, cela ne peut √™tre √©vit√©.  En cons√©quence, comme je l'ai dit, toute logique est tach√©e. <br><br>  Avec l'aide de tels tests, nous pouvons cr√©er l'illusion au moins en temps de d√©veloppement - au moment du d√©veloppement - que nous, comme dans l'ancien temps du Web 2.0, sommes assis sur le serveur en une seule ex√©cution et que tout est confortable. <br><br>  Une autre id√©e folle est venue (elle n'a pas encore √©t√© mise en ≈ìuvre).  Pourquoi ne pas abaisser cette partie au backend?  Pourquoi ne pas vous √©loigner compl√®tement de l'application distribu√©e maintenant?  Que cet abonnement et notre mod√®le de vue soient g√©n√©r√©s sur le backend?  L√†, la base est disponible, tout est synchrone.  Tout est simple et clair. <br><br>  Le premier avantage que je vois dans cela est que nous aurons le contr√¥le en un seul endroit.  Nous simplifions tout simplement tout de suite par rapport √† notre application distribu√©e.  Les tests deviennent simples, les doubles validations disparaissent.  Le monde √† la mode des syst√®mes multi-utilisateurs interactifs s'ouvre (si deux utilisateurs vont sur le m√™me formulaire, nous leur en parlons; ils peuvent le modifier en m√™me temps). <br><br>  Une caract√©ristique int√©ressante appara√Æt: en allant au backend et √† la perspective de la session, nous pouvons comprendre qui est actuellement dans le syst√®me et ce qu'il fait.  C'est un peu comme le d√©veloppement de jeu, o√π les serveurs fonctionnent comme √ßa.  L√†, le monde vit sur le serveur et le front-end ne s'affiche que.  En cons√©quence, nous pouvons obtenir un certain client l√©ger. <br><br>  D'un autre c√¥t√©, cela cr√©e un d√©fi.  Nous devrons avoir un serveur d'√©tat sur lequel ces sessions vivent.  Si nous avons plusieurs serveurs d'applications, il faudra en quelque sorte √©quilibrer correctement la charge ou r√©pliquer la session.  Cependant, on soup√ßonne que ce probl√®me est inf√©rieur au nombre d'avantages que nous obtenons. <br><br>  Par cons√©quent, je reviens au slogan principal: il existe de nombreux types d'applications qui peuvent √™tre √©crites non distribu√©es, pour en √©liminer la complexit√©.  Et vous pouvez obtenir une augmentation multiple de l'efficacit√© si vous r√©visez √† nouveau les postulats de base sur lesquels nous nous sommes appuy√©s dans le d√©veloppement. <br><br><blockquote>  Si vous avez aim√© le rapport, faites attention: du 24 au 25 novembre, un nouveau <b>HolyJS</b> se tiendra √† Moscou, et il y aura √©galement beaucoup de choses int√©ressantes.  Des informations d√©j√† connues sur le programme sont <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site</a> , et des billets peuvent y √™tre achet√©s. </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr421789/">https://habr.com/ru/post/fr421789/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr421775/index.html">R√©seau neuronal form√© pour reconna√Ætre la d√©pression par le discours arbitraire d'une personne sans contexte</a></li>
<li><a href="../fr421779/index.html">OceanLotus: nouvelle porte d√©rob√©e, anciens sch√©mas</a></li>
<li><a href="../fr421783/index.html">Cadre Huex Fun State Management</a></li>
<li><a href="../fr421785/index.html">La Californie est au bord de l'abstraction du carbone dans la production d'√©nergie</a></li>
<li><a href="../fr421787/index.html">D√©veloppement d'architecture de projet, vaisseaux et JavaScript</a></li>
<li><a href="../fr421791/index.html">Probl√®mes √©thiques de l'intelligence artificielle</a></li>
<li><a href="../fr421793/index.html">√Ä la recherche du meilleur ou comment nous avons choisi le r√©seau blockchain pour le projet</a></li>
<li><a href="../fr421795/index.html">D√©cision bas√©e sur les donn√©es sur l'exemple de choix d'une couleur pour la peinture des murs</a></li>
<li><a href="../fr421797/index.html">Pourquoi avez-vous besoin de Splunk? Surveillance de l'infrastructure informatique</a></li>
<li><a href="../fr421799/index.html">Comment obtenir un emploi √† distance dans une entreprise qui ne prend pas de collaborateurs distants?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>