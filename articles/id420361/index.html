<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏼‍🚀 🤦🏾 👩🏼‍⚖️ Bug saat menjalankan TextBox.GetLineText di .NET WPF 🤺 👩🏾 💜</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Untuk melakukan penelitian tentang pengoperasian program dan OS, ada banyak alat yang berbeda. Mesin virtual, IDE, smart notes, IDA, radare, hex edito...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Bug saat menjalankan TextBox.GetLineText di .NET WPF</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pm/blog/420361/">  Untuk melakukan penelitian tentang pengoperasian program dan OS, ada banyak alat yang berbeda.  Mesin virtual, IDE, smart notes, IDA, radare, hex editor, pe editor, dan bahkan lebih dari seratus utilitas Sysinternals - semua ini dilakukan untuk memfasilitasi banyak operasi rutin.  Tetapi kadang-kadang suatu saat ketika Anda menyadari bahwa di antara semua keragaman ini Anda kehilangan utilitas kecil yang hanya akan melakukan pekerjaan yang biasa dan sederhana.  Anda dapat menulis skrip dengan python atau Powershell di atas lutut, tetapi seringkali Anda tidak dapat melihat kerajinan seperti itu tanpa air mata dan membaginya dengan kolega Anda. <br><br>  Baru-baru ini, situasi ini datang kepada saya lagi.  Dan saya memutuskan sudah waktunya untuk mengambil dan menulis utilitas yang rapi.  Saya akan bercerita tentang utilitas di salah satu artikel berikutnya, tetapi saya akan menceritakan tentang salah satu masalah selama pengembangan sekarang. <br><br>  Kesalahan memanifestasikan dirinya sebagai berikut: jika Anda <i>memasukkan</i> banyak baris teks ke dalam kontrol TextBox standar, maka panggilan ke fungsi <i>GetLineText ()</i> mulai dari indeks tertentu akan mengembalikan baris yang salah. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lp/9r/yh/lp9ryh02toec7dfzs40ue4oqao0.png"></div><br>  Yang salah adalah bahwa meskipun garis akan dari teks yang diinstal, tetapi terletak lebih jauh, sebenarnya <i>GetLineText ()</i> hanya akan melewatkan beberapa baris.  Kesalahan muncul dengan sejumlah besar garis.  Jadi saya bertemu dengannya - saya mencoba menampilkan 25 megabyte teks dalam TextBox.  Bekerja dengan baris terakhir mengungkapkan efek yang tidak terduga. <br><br>  Google <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menyarankan bahwa kesalahan sudah ada sejak 2011</a> dan Microsoft tidak terburu-buru untuk memperbaiki sesuatu. <br><a name="habracut"></a><br><h2>  <font color="orange">Contoh</font> </h2><br>  Tidak ada persyaratan khusus untuk versi .NET.  Kami membuat proyek WPF standar dan mengisi file-file seperti ini: <br>  MainWindow.xaml <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wpf_textbox.MainWindow"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:x</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:d</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:mc</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:local</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"clr-namespace:wpf_textbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mc:Ignorable</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"WTF, WPF?"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"350"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"525"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RowDefinition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid.RowDefinitions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"txt"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AcceptsReturn</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AcceptsTab</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"True"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Fire 1!"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn_OnClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Fire 2!"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn2_OnClick"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Grid</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  MainWindow.cs (melewatkan penggunaan dan namespace) <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MainWindow</span></span> : <span class="hljs-title"><span class="hljs-title">Window</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn_OnClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">90009</span></span>; i++) sb.AppendLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{i}</span></span></span><span class="hljs-string">"</span></span>); txt.Text = sb.ToString(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn2_OnClick</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">7</span></span>; i++) sb.AppendLine(<span class="hljs-string"><span class="hljs-string">"req: "</span></span> + <span class="hljs-number"><span class="hljs-number">150</span></span> * i + <span class="hljs-string"><span class="hljs-string">", get: "</span></span> + txt.GetLineText(<span class="hljs-number"><span class="hljs-number">150</span></span> * i).Trim()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">7</span></span>; i++) sb.AppendLine(<span class="hljs-string"><span class="hljs-string">"req: "</span></span> + <span class="hljs-number"><span class="hljs-number">15000</span></span> * i + <span class="hljs-string"><span class="hljs-string">", get: "</span></span> + txt.GetLineText(<span class="hljs-number"><span class="hljs-number">15000</span></span> * i).Trim()); txt.Text = sb.ToString(); } }</code> </pre><br>  Aplikasi ini terdiri dari TextBox dan dua tombol.  Klik pertama "Fire 1!"  (Isi TextBox dengan angka), lalu "Fire 2!"  (itu akan meminta baris dengan angka dan mencetak). <br><br>  Hasil yang Diharapkan: <br><blockquote>  req: 150, dapatkan: 150 <br>  req: 300, dapatkan: 300 <br>  req: 450, dapatkan: 450 <br>  req: 600, dapatkan: 600 <br>  req: 750, dapatkan: 750 <br>  req: 900, dapatkan: 900 <br>  req: 15000, dapatkan: 15000 <br>  req: 30000, dapatkan: 30000 <br>  req: 45000, dapatkan: 45000 <br>  req: 60000, dapatkan: 60000 <br>  req: 75000, dapatkan: 75000 <br>  req: 90000, dapatkan: 90000 </blockquote><br>  Realitas: <br><br><img src="https://habrastorage.org/webt/d7/6j/qq/d76jqqy-o9ve3ih_krtbrk7jj9a.png"><br><br>  Dapat dilihat bahwa untuk indeks kurang dari 1000 - semuanya baik-baik saja, tetapi untuk 15000 besar - pergeseran telah dimulai.  Dan semakin jauh, semakin banyak. <br><br><h2>  <font color="orange">Jelajahi bug</font> </h2><br>  Kami mengungkap bagian dari resolver yang bertanggung jawab untuk melihat kode sumber .NET dan kelas khusus "Ekspander peluang dan pemenang pembatasan berdasarkan Refleksi". <br><br><div class="spoiler">  <b class="spoiler_title">Extender dan Limiter Kemampuan Refleksi</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ReflectionExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T GetFieldValue&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> obj, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bindingFlags = BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> field = obj.GetType().GetField(name, bindingFlags); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) field = obj.GetType().BaseType.GetField(name, bindingFlags); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (T)field?.GetValue(obj); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InvokeMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> methodName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] methodParams</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> methodParamTypes = methodParams?.Select(p =&gt; p.GetType()).ToArray() ?? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Type[] { }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bindingFlags = BindingFlags.NonPublic | BindingFlags.Public | BindingFlags.Instance | BindingFlags.Static; MethodInfo method = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> type = obj.GetType(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (method == <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; type != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { method = type.GetMethod(methodName, bindingFlags, Type.DefaultBinder, methodParamTypes, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intfs = type.GetInterfaces(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intf <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> intfs) { method = intf.GetMethod(methodName, bindingFlags, Type.DefaultBinder, methodParamTypes, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } type = type.BaseType; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method?.Invoke(obj, methodParams); } }</code> </pre><br></div></div><br>  Secara empiris, kami menetapkan bahwa dalam contoh tertentu, masalah dimulai di wilayah baris 8510.  Jika Anda meminta <i>txt.GetLineText (8510)</i> , maka "8510" kembali.  Untuk 8511 - 8511, dan untuk 8512 - tiba-tiba, 8513. <br><br>  Kami melihat implementasi <i>GetLineText ()</i> pada TextBox: <br><br><img src="https://habrastorage.org/webt/eg/xi/dh/egxidhjcehum7gie4b-kcks-8z8.png"><br>  Kami melewatkan pemeriksaan di baris pertama dan melihat panggilan <i>GetStartPositionOfLine ()</i> .  Tampaknya masalahnya ada pada fungsi ini, karena untuk garis yang salah posisi yang salah pada awal garis harus dikembalikan. <br><br>  Kami memanggil kode kami: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o00 = txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetStartPositionOfLine"</span></span>, <span class="hljs-number"><span class="hljs-number">8510</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o01 = txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetStartPositionOfLine"</span></span>, <span class="hljs-number"><span class="hljs-number">8511</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o02 = txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetStartPositionOfLine"</span></span>, <span class="hljs-number"><span class="hljs-number">8512</span></span>);</code> </pre><br>  Dan kebenaran - offset dari objek pertama (awal garis 8510) diindikasikan sebagai 49950 karakter, untuk objek kedua - 49956, dan yang ketiga - 49968. Di antara dua 6 karakter pertama, dan di antara 12. karakter berikutnya - Disorder - ini adalah baris yang hilang. <br><br>  Masuk ke dalam <i>GetStartPositionOfLine ()</i> : <br><br><img src="https://habrastorage.org/webt/3w/he/17/3whe17kxjlb1ncjbxchfxgl-ysi.png"><br><br>  Sekali lagi kami melewatkan pemeriksaan awal dan melihat tindakan nyata.  Pertama, titik dihitung, yang harus menuju ke baris dengan nomor <i>lineIndex</i> .  Ketinggian semua garis diambil dan setengah tinggi garis ditambahkan untuk mencapai pusatnya.  <i>Kami</i> tidak melihat ini. <i>Pengaturan Vertikal</i> dan ini. <i>Pengaturan Horizontal</i> - mereka adalah nol. <br><br>  Kami mempertimbangkan dalam kode kami: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lineHeight = (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>) txt.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineHeight"</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y0 = lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">8510</span></span> + lineHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - txt.VerticalOffset; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y1 = lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">8511</span></span> + lineHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - txt.VerticalOffset; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> y2 = lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)<span class="hljs-number"><span class="hljs-number">8512</span></span> + lineHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - txt.VerticalOffset;</code> </pre><br>  Nilai-nilai itu masuk akal, berkorelasi dengan logika, semuanya teratur.  Kami melangkah lebih jauh di sepanjang kode <i>GetStartPositionOfLine ()</i> - kami tertarik pada baris yang bermakna berikut (yang pertama di dalam kondisi), yang terlihat seperti buaya dan diakhiri dengan panggilan ke <i>GetTextPositionFromPoint ()</i> . <br><br>  Kami membuka tantangan dan menariknya melalui refleksi.  Harap perhatikan bahwa beberapa antarmuka tidak tersedia bagi kami karena batasan visibilitas, jadi kami harus merujuknya menggunakan Refleksi yang sama. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> renderScope = (txt.GetFieldValue&lt;FrameworkElement&gt;(<span class="hljs-string"><span class="hljs-string">"_renderScope"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IServiceProvider); <span class="hljs-comment"><span class="hljs-comment">// 7 -   ITextView var textView = renderScope.GetService(renderScope.GetType().GetInterfaces()[7]); var o10 = textView.InvokeMethod("GetTextPositionFromPoint", new Point(-txt.HorizontalOffset, y0), true); var o11 = textView.InvokeMethod("GetTextPositionFromPoint", new Point(-txt.HorizontalOffset, y1), true); var o12 = textView.InvokeMethod("GetTextPositionFromPoint", new Point(-txt.HorizontalOffset, y2), true);</span></span></code> </pre><br>  Objek yang dihasilkan menunjukkan semua offset yang sama - 49950, 49956, 49568. Kita masuk lebih dalam ke implementasi <i>GetTextPositionFromPoint ()</i> di dalam TextBoxView. <br><br><img src="https://habrastorage.org/webt/cu/bz/su/cubzsusmp8w7yljcb36xmadksae.png"><br>  Di, <i>GetLineIndexFromPoint ()</i> terlihat menjanjikan.  Panggil kode Anda. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o20 = textView.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineIndexFromPoint"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y0), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o21 = textView.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineIndexFromPoint"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y1), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o22 = textView.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"GetLineIndexFromPoint"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y2), <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br>  Kami mendapatkan 8510, 8511 dan 8513 - bingo!  Untuk implementasi: <br><br><img src="https://habrastorage.org/webt/9i/lp/q9/9ilpq9myefgvsnyxjkdv7oiirds.png"><br><br>  Bahkan dengan mata telanjang, jelas bahwa ini adalah pencarian biner.  <i>_lineMetrics</i> - daftar karakteristik string (mulai, panjang, lebar perbatasan).  Saya menggosok pena dengan gembira - Saya pikir karena sering terjadi, mereka lupa menempel <i>+1 di</i> suatu tempat atau meletakkan <i>&gt;</i> bukannya <i>&gt; =</i> .  Salin fungsi ke kode dan lakukan debug.  Karena sifat tertutup dari tipe <i>_lineMetrics</i> , <i>kami</i> menariknya melalui refleksi, <i>_lineTinggi yang</i> kami dapatkan sebelumnya.  Total: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lm = textView.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_lineMetrics"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)lm.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"get_Count"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lineMetrics = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; c; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> arr_o = lm.InvokeMethod(<span class="hljs-string"><span class="hljs-string">"get_Item"</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contLength = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_contentLength"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> length = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_length"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_offset"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> width = arr_o.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_width"</span></span>); lineMetrics.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tuple&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(contLength, length, offset, width)); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o30 = GetLineIndexFromPoint(lineMetrics, lineHeight, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y0), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o31 = GetLineIndexFromPoint(lineMetrics, lineHeight, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y1), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> o32 = GetLineIndexFromPoint(lineMetrics, lineHeight, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(-txt.HorizontalOffset, y2), <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*&lt;...&gt;*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetLineIndexFromPoint</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;Tuple&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;&gt; lm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _lineHeight, Point point, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> snapToText</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &lt; <span class="hljs-number"><span class="hljs-number">0.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !snapToText ? <span class="hljs-number"><span class="hljs-number">-1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &gt;= _lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)lm.Count) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!snapToText) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lm.Count - <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num2 = lm.Count; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (num1 &lt; num2) { index = num1 + (num2 - num1) / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lineMetric = lm[index]; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> num3 = _lineHeight * (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)index; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &lt; num3) num2 = index; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (point.Y &gt;= num3 + _lineHeight) { num1 = index + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!snapToText &amp;&amp; (point.X &lt; <span class="hljs-number"><span class="hljs-number">0.0</span></span> || point.X &gt;= lineMetric.Item4)) { index = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (num1 &gt;= num2) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> index; }</code> </pre><br>  Kami tidak bisa melakukan debugging.  o30, o31 dan o32 masing-masing adalah 8510, 8511 dan 8512.  Seperti seharusnya!  Tapi O20, O21 dan O22 tidak setuju dengan mereka.  Bagaimana bisa begitu?  Kami hampir tidak mengubah kode.  Hampir?  Dan inilah wawasannya. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lh = textView.GetFieldValue&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"_lineHeight"</span></span>);</code> </pre><br><img src="https://habrastorage.org/webt/v6/tv/ar/v6tvarxvg-sz-da4znxe7nnzigo.png"><br><br>  Itulah alasannya - perbedaannya adalah <b>0,0009375</b> .  Selain itu, jika kami memperkirakan akumulasi kesalahan - kami mengalikannya dengan 8511, kami mendapatkan 7.9790625.  Ini hanya sekitar setengah dari garis Tinggi, dan oleh karena itu, ketika menghitung koordinat, titik tersebut terbang di luar garis yang diinginkan dan jatuh pada baris berikutnya.  Variabel yang sama (dalam arti) dihitung dengan dua cara yang berbeda dan, tiba-tiba, tidak cocok. <br><br>  Tentang ini saya memutuskan untuk berhenti.  Mungkin untuk benar-benar memahami mengapa ketinggian kolom ternyata berbeda, tetapi saya tidak melihat banyak gunanya.  Sangat diragukan bahwa Microsoft akan memperbaikinya, jadi kami melihat tongkat penyangga untuk mengatasinya.  Reflection-crutch - atur <i>_lineHeigh yang</i> benar <i>di</i> salah satu atau di tempat lain.  Kedengarannya bodoh, mungkin lambat dan kemungkinan besar tidak bisa diandalkan.  Atau Anda dapat mempertahankan rangkaian garis Anda sendiri, sejajar dengan TextBox, dan mengambil garis darinya, karena mendapatkan nomor baris pada posisi kursor berfungsi dengan benar. <br><br><h2>  <font color="orange">Kesimpulan</font> </h2><br>  Dari programmer pemula Anda sering dapat mendengar sesuatu tentang bug di kompiler atau komponen standar.  Pada kenyataannya, mereka tidak begitu umum, tetapi masih tidak ada yang aman dari mereka.  Jangan takut untuk melihat ke dalam alat yang Anda butuhkan - itu menarik dan menarik. <br><br>  Tulis kode yang bagus! <br><br><h2>  <font color="orange">Artikel blog lainnya</font> </h2><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Pembelajaran Mesin dengan Keamanan Menyerang</a> <br>  Tidak ada mobil yang bisa menggantikan saya.  Muhaha ha.  Saya harap begitu. <br><br>  → <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Di mana memasukkan tanda kutip di IPv6</a> <br>  Orang-orang tahu di mana dan apa yang harus didorong untuk membuatnya menjadi baik.  Setelah kata-kata seperti itu, mereka akan menggantikan saya dengan robot, pasti.  Menikah!  UHF! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id420361/">https://habr.com/ru/post/id420361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id420351/index.html">Cara melakukan pencarian pengguna di GitHub menggunakan Vue</a></li>
<li><a href="../id420353/index.html">Kami menjadikan Shrimp lebih bermanfaat: menambahkan transcoding gambar ke format lain</a></li>
<li><a href="../id420355/index.html">Smart watch Pebble: bagaimana menjadi langka dalam semalam</a></li>
<li><a href="../id420357/index.html">Vuex: menyusun proyek-proyek besar dan bekerja dengan modul</a></li>
<li><a href="../id420359/index.html">Var, biarkan atau const? Masalah Lingkup Variabel dan ES6</a></li>
<li><a href="../id420363/index.html">Webinar HPE pada Agustus-Oktober: topik baru (+ SHD, praktik AI, penyimpanan turnkey petabyte)</a></li>
<li><a href="../id420367/index.html">Kiamat ber-AC: skenario smart grid blackout</a></li>
<li><a href="../id420369/index.html">Extreme Extended Edge, atau Switching IEEE 802.1BR</a></li>
<li><a href="../id420371/index.html">Pada masalah konstruksi sepeda di bidang penyimpanan surat listrik</a></li>
<li><a href="../id420373/index.html">Hampir OCR untuk mendapatkan kata sandi VPNBook. PHP + Mikrotik</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>