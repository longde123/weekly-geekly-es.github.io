<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🥇 🔋 ✍🏽 Iteraptor: Bibliothek für Deep Transparent Map Redus 👩‍👩‍👦 👙 🍶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Elixier- Datenstrukturen sind unveränderlich. Dies ist vom Standpunkt der Überzeugung großartig, dass unsere Daten nicht bis zur Unkenntlichkeit in ei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Iteraptor: Bibliothek für Deep Transparent Map Redus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482478/"><p>  <em>Elixier-</em> Datenstrukturen sind unveränderlich.  Dies ist vom Standpunkt der Überzeugung großartig, dass unsere Daten nicht bis zur Unkenntlichkeit in einem anderen irrelevanten Teil des Codes verfälscht werden, aber es ist ein wenig ärgerlich, wenn wir eine tief verschachtelte Struktur ändern müssen. </p><br><p> Wir haben eine brillante <a href="https://hexdocs.pm/elixir/Access.html" rel="nofollow"><code>Access</code></a> Abstraktion, die vier grundlegende Operationen für tief verschachtelte Objekte mithilfe der standardmäßig aus dem <code>Kernel</code> exportierten Funktionen erheblich vereinfacht: </p><br><ul><li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.get_in/2</code></a> </li> <li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.put_in/{2,3}</code></a> </li> <li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.update_in/{2,3}</code></a> </li> <li> <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.pop_in/{1,2}</code></a> </li> </ul><a name="habracut"></a><br><p>  Diese vier Musketiere (und d'Artagnan <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.get_and_update_in/{2,3}</code></a> werden normalerweise wie <a href="https://hexdocs.pm/elixir/Kernel.html" rel="nofollow"><code>Kernel.get_and_update_in/{2,3}</code></a> verwendet: </p><br><pre> <code class="ruby hljs">iex&gt; users = <span class="hljs-string"><span class="hljs-string">%{"john" =&gt; %{age: 27, mood: ""}</span></span>, <span class="hljs-string"><span class="hljs-string">"meg"</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">%{age: 23}</span></span>} <span class="hljs-comment"><span class="hljs-comment">#   iex&gt; get_in(users, ["john", :age]) #⇒ 27 #   iex&gt; put_in(users, ["john", :age], 28) #⇒ %{"john" =&gt; %{age: 28, mood: ""}, "meg" =&gt; %{age: 23}} #   iex&gt; update_in(users, ["john", :mood], &amp; &amp;1 + 1) #⇒ %{"john" =&gt; %{age: 28, mood: ""}, "meg" =&gt; %{age: 23}} #   iex&gt; pop_in(users, ["john", :mood]) #⇒ {"", %{"john" =&gt; %{age: 27}, "meg" =&gt; %{age: 23}}}</span></span></code> </pre> <br><p>  Es ist praktisch und funktioniert in vielen Fällen ... mit Ausnahme derer, bei denen es nicht funktioniert.  Um <code>Access</code> , müssen Sie den Pfad zum Zielelement kennen, und all dies erfordert eine erhebliche Menge an Code, um mehrere verschachtelte Werte gleichzeitig zu aktualisieren (löschen Sie beispielsweise alle Blätter mit dem Wert <code>nil</code> oder markieren Sie den Inhalt aller Felder, die nicht in den Protokollen angezeigt werden müssen). </p><br><p>  Um Rabatte für die Arbeit mit verschachtelten Strukturen zu gewähren, wurde die <code>Iteraptor</code> Bibliothek erstellt. </p><br><p>  <strong>TL; DR:</strong> </p><br><ul><li>  <a href="https://github.com/am-kantox/elixir-iteraptor" rel="nofollow">Quellcodes</a> ; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow">die Dokumentation</a> . </li></ul><br><hr><br><p>  Durchlaufen Sie bei <em>Elixir</em> alles, was Sie auf magische Weise durchlaufen können.  Um es <a href="https://hexdocs.pm/elixir/Enumerable.html" rel="nofollow"><code>Enumerable</code></a> zu machen, implementieren <a href="https://hexdocs.pm/elixir/Enumerable.html" rel="nofollow"><code>Enumerable</code></a> einfach das <a href="https://hexdocs.pm/elixir/Enumerable.html" rel="nofollow"><code>Enumerable</code></a> Protokoll für diesen bestimmten Typ.  Sie können Passagen in Pipelines gruppieren, kartieren, reduzieren, filtern, ausdünnen ... Verzeihen Sie mein Französisch, ja.  Jeder, der mindestens acht Stunden mit <em>Elixir verbracht hat, hat</em> definitiv so etwas gesehen (und möglicherweise sogar geschrieben): </p><br><pre> <code class="ruby hljs">~w<span class="hljs-params"><span class="hljs-params">|   |</span></span> <span class="hljs-params"><span class="hljs-params">|&gt; Enum.map(&amp;String.capitalize/1) |</span></span>&gt; Enum.each(fn capitalized_name -&gt; IO.puts <span class="hljs-string"><span class="hljs-string">"Hello, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{capitalized_name}</span></span></span><span class="hljs-string">!"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Hello, ! # Hello, ! # Hello, ! # Hello, !</span></span></code> </pre> <br><p>  Es ist wirklich sehr praktisch.  Bei stark verschachtelten Strukturen, z. B. einer <em>Map</em> mit verschachtelten <em>Schlüsselwörtern</em> , Listen usw., wird der Code jedoch schnell umständlich. Ein gutes Beispiel hierfür ist jede Konfigurationsdatei, die verschachtelte Unterabschnitte enthält. </p><br><p>  Die Anzahl der Fragen zum <em>Stapelüberlauf</em> mit der Frage "Wie kann ich die verschachtelte Struktur ändern?" Hat mich gezwungen, diese Bibliothek endgültig zu erstellen.  Die Implementierung bei <em>Elixir</em> wirkt etwas verwirrend, da alles rundherum unveränderlich ist und Sie nicht einfach die Äste der Struktur bis zu den Blättern hinuntergehen und alles ändern können, was Sie an Ort und Stelle benötigen.  Sie benötigen einen Akku, wie jedoch unter keiner Haube eines Funktionscodes.  Das Ändern von verschachtelten Strukturen ist wahrscheinlich das einzige Beispiel, das ich in meinem Leben gesehen habe, wenn die Wandlungsfähigkeit die Dinge erleichtert. </p><br><p>  Als Bonus für reguläre Kartenvorläufer habe ich eine Implementierung hinzugefügt, um den Wert tief in der Struktur zu speichern, wodurch bei Bedarf Zwischenschlüssel erstellt werden.  Es verhält sich wie vorgeschlagen, wird aber in Ruby Core <code>Hash#bury</code> verworfen.  Diese Bibliothek kann auch verschachtelte Strukturen mit <em>Stichwörtern</em> „jasonisieren“, die nicht einfach in <em>json</em> serialisiert werden können, da sie als Listen von Tupeln mit zwei Elementen dargestellt werden ( <code>[foo: :bar] == [{:foo, :bar}]</code> ). und Tupel sind nicht sofort serialisierbar. </p><br><hr><br><p>  Lassen Sie uns also die Bibliothek begrüßen, die über eine <em>Karte</em> / ein <em>Schlüsselwort</em> / eine <em>Liste</em> im Schwanz und in der Mähne iteriert und fast so einfach ist wie die Standard- <code>Enum.each/2</code> und <code>Enum.map/2</code> . </p><br><h3 id="vozmozhnosti">  Die Möglichkeiten </h3><br><ul><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.each/3</code></a> einfachen Iteration die Struktur selbst zurück. </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.map/3</code></a> gibt eine zugeordnete Struktur zurück. </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.reduce/4</code></a> reduus gibt die Batterie zurück; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.map_reduce/4</code></a> map <em>und</em> redus geben ein Tupel mit dem Ergebnis von Mapping <em>und</em> Batterie zurück; </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.filter/3</code></a> filtert die Struktur mit der Funktion, die durch den letzten Parameter erhalten wurde. </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.jsonify/2</code></a> bereitet die Struktur für die Serialisierung in <em>json vor</em> : Alle <em>Schlüsselwörter</em> werden durch <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.jsonify/2</code></a> ersetzt, Schlüssel werden in Zeichenfolgen konvertiert. </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.Extras.html" rel="nofollow"><code>Iteraptor.Extras.bury/4</code></a> schreibt den Wert tief in die Struktur und erstellt bei Bedarf Zwischenschlüssel. </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.to_flatmap/2</code></a> verwandelt die Struktur in eine flache Struktur und erstellt sorgfältig Indizes für Listen.  Die ursprüngliche Struktur kann mit wieder hergestellt werden </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.html" rel="nofollow"><code>Iteraptor.from_flatmap/3</code></a> verwandelt eine Platunk-Struktur mit verketteten Schlüsseln in eine tief verschachtelte. </li><li>  <a href="https://hexdocs.pm/iteraptor/Iteraptor.Iteraptable.html" rel="nofollow"><code>use Iteraptor.Iteraptable</code></a> , um die Protokolle <code>Enumerable</code> und <code>Collectable</code> sowie das <code>Access</code> für die Struktur automatisch zu implementieren.  Es gibt eine <a href="https://rocket-science.ru/hacking/2018/11/16/iteraptable-extending-elixir-structs" rel="nofollow">detailliertere Beschreibung dessen,</a> was sich unter der Haube befindet. </li></ul><br><h3 id="slova-nichego-ne-stoyat-pokazhi-kod">  Worte kosten nichts, zeig den Code! </h3><br><h4 id="iterirovanie-mapping-redyusing">  Iteration, Mapping, Reduktion </h4><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># each iex&gt; %{a: %{b: %{c: 42}}} |&gt; Iteraptor.each(&amp;IO.inspect(&amp;1, label: "each"), yield: :all) # each: {[:a], %{b: %{c: 42}}} # each: {[:a, :b], %{c: 42}} # each: {[:a, :b, :c], 42} %{a: %{b: %{c: 42}}} # map iex&gt; %{a: %{b: %{c: 42}}} |&gt; Iteraptor.map(fn {k, _} -&gt; Enum.join(k) end) %{a: %{b: %{c: "abc"}}} iex&gt; %{a: %{b: %{c: 42}, d: "some"}} ...&gt; |&gt; Iteraptor.map(fn ...&gt; {[_], _} = self -&gt; self ...&gt; {[_, _], _} -&gt; "********" ...&gt; end, yield: :all) %{a: %{b: "********", d: "some"}} # reduce iex&gt; %{a: %{b: %{c: 42}}} ...&gt; |&gt; Iteraptor.reduce([], fn {k, _}, acc -&gt; ...&gt; [Enum.join(k, "_") | acc] ...&gt; end, yield: :all) ...&gt; |&gt; :lists.reverse() ["a", "a_b", "a_b_c"] # map-reduce iex&gt; %{a: %{b: %{c: 42}}} ...&gt; |&gt; Iteraptor.map_reduce([], fn ...&gt; {k, %{} = v}, acc -&gt; {​{k, v}, [Enum.join(k, ".") | acc]} ...&gt; {k, v}, acc -&gt; {​{k, v * 2}, [Enum.join(k, ".") &lt;&gt; "=" | acc]} ...&gt; end, yield: :all) {​%{a: %{b: %{c: 42}}}, ["abc=", "ab", "a"]} # filter iex&gt; %{a: %{b: 42, e: %{f: 3.14, c: 42}, d: %{c: 42}}, c: 42, d: 3.14} ...&gt; |&gt; Iteraptor.filter(fn {key, _} -&gt; :c in key end, yield: :none) %{a: %{e: %{c: 42}, d: %{c: 42}}, c: 42}</span></span></code> </pre> <br><h4 id="glubokaya-vlozhennost--ploskaya-struktura-i-obratno">  Tiefes Nesting → flache Struktur und umgekehrt </h4><br><pre> <code class="ruby hljs">iex&gt; <span class="hljs-string"><span class="hljs-string">%{a: %{b: %{c: 42, d: [nil, 42]}</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">e:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">:f</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>]}} ...&gt; <span class="hljs-params"><span class="hljs-params">|&gt; Iteraptor.to_flatmap(delimiter: "_") #⇒ %{"a_b_c" =&gt; 42, "a_b_d_0" =&gt; </span><span class="hljs-literal"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span><span class="hljs-params">, "a_b_d_1" =&gt; 42, "a_e_0" =&gt; :f, "a_e_1" =&gt; 42} iex&gt; %{"abc": 42, "abd0": </span><span class="hljs-literal"><span class="hljs-params"><span class="hljs-literal">nil</span></span></span><span class="hljs-params">, "abd1": 42, "ae0": :f, "ae1": 42} ...&gt; |</span></span>&gt; Iteraptor.from_flatmap <span class="hljs-comment"><span class="hljs-comment">#⇒ %{a: %{b: %{c: 42, d: [nil, 42]}, e: [:f, 42]}}</span></span></code> </pre> <br><h4 id="plyushki">  Brötchen </h4><br><pre> <code class="ruby hljs">iex&gt; Iteraptor.jsonify([<span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">bar:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">baz:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:zoo</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">boo:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>]], <span class="hljs-symbol"><span class="hljs-symbol">values:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>) <span class="hljs-string"><span class="hljs-string">%{"foo" =&gt; %{"bar" =&gt; %{"baz" =&gt; "zoo"}</span></span>, <span class="hljs-string"><span class="hljs-string">"boo"</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">42</span></span>}} iex&gt; Iteraptor.Extras.bury([<span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:bar</span></span>], ~w<span class="hljs-params"><span class="hljs-params">|abcd|</span></span>a, <span class="hljs-number"><span class="hljs-number">42</span></span>) [<span class="hljs-symbol"><span class="hljs-symbol">a:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">b:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">c:</span></span> [<span class="hljs-symbol"><span class="hljs-symbol">d:</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>]]], <span class="hljs-symbol"><span class="hljs-symbol">foo:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:bar</span></span>]</code> </pre> <br><hr><br><p>  Die Quellen <a href="https://github.com/am-kantox/elixir-iteraptor" rel="nofollow">sind offen</a> , die Dokumentation <a href="https://hex.pm/packages/iteraptor" rel="nofollow">sehr detailliert</a> , wir sind seit fast zwei Jahren in Produktion. </p><br><p>  Habt eine gute Iteration! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de482478/">https://habr.com/ru/post/de482478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de482466/index.html">5 Dinge, die Sie tun können, um sich auf Vue 3.0 vorzubereiten</a></li>
<li><a href="../de482468/index.html">5 Erweiterungen und Designs für VS Code, die das Leben eines Front-End-Entwicklers verändern können</a></li>
<li><a href="../de482470/index.html">Schnelles Laden von Seiten auf den einfachsten günstigen Handys</a></li>
<li><a href="../de482472/index.html">Woraus besteht JavaScript?</a></li>
<li><a href="../de482474/index.html">"Wie ich den Sommer verbracht habe"</a></li>
<li><a href="../de482480/index.html">Kosmische Berührungen des ausgehenden Jahres</a></li>
<li><a href="../de482482/index.html">Rollenspiele</a></li>
<li><a href="../de482484/index.html">So steigern Sie die Entwicklungseffizienz mithilfe der Constraints-Theorie</a></li>
<li><a href="../de482486/index.html">Was ist Misra und wie man es kocht</a></li>
<li><a href="../de482490/index.html">Was ist MISRA und wie kocht man es?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>