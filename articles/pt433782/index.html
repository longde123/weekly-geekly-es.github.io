<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👊🏼 🥡 😲 Um exemplo prático de criação do seu próprio componente View 🦎 🏔️ 🔍</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eu gosto de Dribbble . Existem muitos projetos de design interessantes e inspiradores. Mas se você é um desenvolvedor, geralmente o sentimento de bele...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Um exemplo prático de criação do seu próprio componente View</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433782/"><p><img src="https://habrastorage.org/getpro/habr/post_images/5c6/ece/f09/5c6ecef09bce1d621d5127f0e49338d1.jpg" alt="Um exemplo prático de criação do seu próprio componente View"></p><br><p> Eu gosto de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Dribbble</a> .  Existem muitos projetos de design interessantes e inspiradores.  Mas se você é um desenvolvedor, geralmente o sentimento de beleza rapidamente se desanima quando você começa a pensar em como implementar esse design legal. </p><br><p>  Neste artigo, mostrarei um exemplo desse design e de sua implementação, mas antes disso, vamos falar sobre a solução do problema como um todo. </p><a name="habracut"></a><br><p>  A maneira mais fácil é usar algum tipo de biblioteca que cubra nossas necessidades.  Agora, não me interpretem mal, sou um grande defensor da abordagem "não reinvente a roda".  Existem ótimas bibliotecas de código aberto e, quando preciso fazer upload de imagens ou implementar a API REST, o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Glide</a> / <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Picasso</a> e o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Retrofit</a> me ajudarão bastante. </p><br><p>  Mas quando você precisa implementar um design incomum, essa nem sempre é a melhor opção.  Você precisará gastar tempo procurando uma biblioteca boa e suportada que faça algo semelhante.  Então você precisa procurar no código para garantir que algo adequado esteja escrito lá.  Você precisará dedicar mais tempo para entender as configurações que você pode gerenciar para usar a biblioteca em suas tarefas.  E, sejamos honestos, provavelmente a biblioteca não atenderá 100% às suas necessidades e você precisará fazer alguns compromissos com os designers. </p><br><p> Portanto, digo que geralmente é mais fácil e melhor criar seu próprio componente <code>View</code> .  Quando digo "componente nativo do <code>View</code> ", quero dizer a extensão da classe <code>View</code> , substituindo o método <code>onDraw()</code> e usando o <code>Paint</code> and <code>Canvas</code> para desenhar o componente <code>View</code> .  Isso pode parecer assustador se você não tiver feito isso antes, porque essas classes têm muitos métodos e propriedades, mas você pode se concentrar nos principais: </p><br><ul><li><p>  <code>canvas.drawRect()</code> - especifique as coordenadas dos cantos e desenhe um retângulo; </p><br></li><li><p>  <code>canvas.drawRoundRect()</code> - opcionalmente, especifique o raio e os cantos do retângulo serão arredondados; </p><br></li><li><p>  <code>canvas.drawPath()</code> é uma maneira mais complexa, mas também mais poderosa, de criar sua própria forma usando linhas e curvas; </p><br></li><li><p>  <code>canvas.drawText()</code> - para desenhar texto na tela (usando o <code>Paint</code> você pode controlar o tamanho, a cor e outras propriedades); </p><br></li><li><p>  <code>canvas.drawCircle()</code> - especifique o ponto central e o raio e obtenha um círculo; </p><br></li><li><p>  <code>canvas.drawArc()</code> - especifique o retângulo delimitador, bem como os ângulos de início e de rotação para desenhar o arco; </p><br></li><li><p>  <code>paint.style</code> - indica se a forma desenhada será preenchida, circulada ou ambas; </p><br></li><li><p>  <code>paint.color</code> - indica a cor (incluindo transparência); </p><br></li><li><p>  <code>paint.strokeWidth</code> - controla a largura das formas de traçado; </p><br></li><li><p>  <code>paint.pathEffect</code> - permite influenciar a geometria da figura desenhada; </p><br></li><li><p>  <code>paint.shader</code> - permite desenhar gradientes. </p><br></li></ul><br><p>  Lembre-se de que algumas vezes você pode precisar usar outras APIs, mas mesmo tendo dominado esses métodos, é possível desenhar formas muito complexas. </p><br><h2 id="prakticheskiy-primer">  Exemplo prático </h2><br><p>  Aqui está um design que a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Pepper</a> nos oferece: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f9a/033/e21/f9a033e211e7dae32ea25a6449017765.png" alt="Desenho"></p><br><p>  Há muitas coisas interessantes aqui, mas vamos levar tudo em pequenos pedaços. </p><br><h3 id="shag-1-rasschitat-pozicii-markerov">  Etapa 1. Calcular as posições dos marcadores </h3><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcPositions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(markers: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">List</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Marker</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> max = markers.maxBy { it.value } <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> min = markers.minBy { it.value } pxPerUnit = chartHeight / (max - min) zeroY = max * pxPerUnit + paddingTop <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> step = (width - <span class="hljs-number"><span class="hljs-number">2</span></span> * padding - scalesWidth) / (markers.size - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((i, marker) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> markers.withIndex()) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = step * i + paddingLeft <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = zeroY - entry.value * pxPerUnit marker.currentPos.x = x marker.currentPos.y = y } }</code> </pre> <br><p>  Encontramos os valores mínimo e máximo, calculamos a proporção de pixels por unidade, o tamanho do passo horizontal entre os marcadores e as posições X e Y. </p><br><h3 id="shag-2-narisovat-gradient">  Etapa 2. Desenhe um gradiente </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/526/055/4f9/5260554f9e4702b526931cf68dac8bef.png" alt="Gradiente"></p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// prepare the gradient paint val colors = intArrayOf(colorStart, colorEnd)) val gradient = LinearGradient( 0f, paddingTop, 0f, zeroY, colors, null, CLAMP ) gradientPaint.style = FILL gradientPaint.shader = gradient private fun drawGradient(canvas: Canvas) { path.reset() path.moveTo(paddingLeft, zeroY) for (marker in markers) { path.lineTo(marker.targetPos.x, entry.targetPos.y) } // close the path path.lineTo(markers.last().targetPos.x, zeroY) path.lineTo(paddingLeft, zeroY) canvas.drawPath(path, gradientPaint) }</span></span></code> </pre> <br><p>  Criamos uma forma começando na borda esquerda, desenhando uma linha entre cada marcador e finalizando a forma no ponto inicial.  Em seguida, desenhe essa forma usando tinta com um shader de gradiente. </p><br><h3 id="shag-3-narisovat-setku">  Etapa 3. Desenhe uma grade </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bbc/a14/ded/bbca14ded078fcf450e80f3451eb8988.png" alt="Malha"></p><br><pre> <code class="kotlin hljs"><span class="hljs-comment"><span class="hljs-comment">// prepare the guideline paint dottedPaint.style = STROKE dottedPaint.strokeWidth = DOTTED_STROKE_WIDTH_DP dottedPaint.pathEffect = DashPathEffect(floatArrayOf(INTERVAL, INTERVAL), 0f) private fun drawGuidelines(canvas: Canvas) { val first = findFirstDayOfWeekInMonth(markers) for (i in first..markers.lastIndex step 7) { val marker = markers[i] guidelinePath.reset() guidelinePath.moveTo(entry.currentPos.x, paddingTop) guidelinePath.lineTo(entry.currentPos.x, zeroY) canvas.drawPath(guidelinePath, dottedPaint) } }</span></span></code> </pre> <br><p>  Colocamos a tinta para que ela desenhe com uma linha pontilhada.  Em seguida, usamos o ciclo especial da linguagem Kotlin, que permite iterar sobre os marcadores nas etapas 7 (o número de dias em uma semana).  Para cada marcador, pegamos a coordenada X e desenhamos uma linha pontilhada vertical da parte superior do gráfico até <code>zeroY</code> . </p><br><h3 id="shag-4-narisovat-grafik-i-markery">  Etapa 4. Desenhe um gráfico e marcadores </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4f1/a4d/e8c/4f1a4de8cc3e5b40fff2dd71a77d4e0a.png" alt="Gráfico e marcadores"></p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawLineAndMarkers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousMarker: Marker? = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (marker <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> markers) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previousMarker != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// draw the line val p1 = previousMarker.currentPos val p2 = marker.currentPos canvas.drawLine(p1.x, p1.y, p2.x, p2.y, strokePaint) } previousMarker = marker // draw the marker canvas.drawCircle( marker.currentPos.x, marker.currentPos.y, pointRadius, pointPaint ) } }</span></span></code> </pre> <br><p>  Examinamos os marcadores, desenhamos um círculo preenchido para cada um deles e uma linha simples do marcador anterior ao atual. </p><br><h3 id="shag-5-narisovat-knopki-nedel">  Etapa 5. Desenhe os botões da semana </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e4a/113/85b/e4a11385be04e7b7094597339a291f88.png" alt="Botões de semanas"></p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawWeeks</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ((i, week) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> weeks.withIndex()) { textPaint.getTextBounds(week, <span class="hljs-number"><span class="hljs-number">0</span></span>, week.length, rect) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = middle(i) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = zeroY + rect.height() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> halfWidth = rect.width() / <span class="hljs-number"><span class="hljs-number">2f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> halfHeight = rect.height() / <span class="hljs-number"><span class="hljs-number">2f</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> left = x - halfWidth - padding <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> top = y - halfHeight - padding <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> right = x + halfWidth + padding <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bottom = y + halfHeight + padding rect.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(left, top, right, bottom) paint.color = bgColor paint.style = FILL canvas.drawRoundRect(rect, radius, radius, paint) paint.color = strokeColor paint.style = STROKE canvas.drawRoundRect(rect, radius, radius, paint) canvas.drawText(week, x, keyY, textPaint) } }</code> </pre> <br><p>  Examinamos as marcas da semana, localizamos a coordenada X do meio da semana e começamos a desenhar o botão em camadas: primeiro desenhamos um plano de fundo com cantos arredondados, depois uma borda e, finalmente, texto.  Ajustamos a tinta antes de desenhar cada camada. </p><br><h3 id="shag-6-narisovat-chislovye-markery-sprava">  Etapa 6. Desenhe os marcadores numéricos à direita </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5e2/fca/38c/5e2fca38cd0c3160c240cee8458d839f.png" alt="Marcadores numéricos"></p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawGraduations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> x = markers.last().currentPos.x + padding <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> graduations) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> y = zeroY - scale * pxPerUnit <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> formatted = NumberFormat.getIntegerInstance().format(value) canvas.drawText(formatted, x, y, textPaint) } }</code> </pre> <br><p>  A coordenada X é a posição do último marcador mais algum recuo.  A coordenada Y é calculada usando a proporção de pixels por unidade.  Formaizamos o número em uma sequência (se necessário, adicione um separador de milhares) e desenhamos o texto. </p><br><p>  Isso é tudo, agora o nosso <code>onDraw()</code> ficará assim: </p><br><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(canvas: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Canvas</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> { drawGradient(canvas) drawGuidelines(canvas) drawLineAndMarkers(canvas) drawWeeks(canvas) drawGraduations(canvas) }</code> </pre> <br><p>  E combinar as camadas nos dará o resultado desejado: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/051/51e/d11/05151ed1197c4ae9f95d4dab4c3f54c2.png" alt="Resultado"></p><br><h2 id="itog">  Sumário </h2><br><ol><li>  Não tenha medo de criar seus próprios componentes do <code>View</code> (se necessário). </li><li>  Aprenda as APIs básicas do <code>Canvas</code> e do <code>Paint</code> . </li><li>  Divida seu design em pequenas camadas e desenhe cada uma de forma independente. </li></ol><br><p>  Quanto ao último ponto, para mim, essa é uma das melhores lições de programação em geral: quando confrontada com uma tarefa grande e complexa, divida-a em tarefas menores e mais simples. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt433782/">https://habr.com/ru/post/pt433782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt433770/index.html">A ciência da procura de emprego, parte VII: apenas 50% dos "requisitos" de uma vaga devem ser atendidos</a></li>
<li><a href="../pt433772/index.html">Ferramenta de anotação da Visão por computador: Marcação de dados completa</a></li>
<li><a href="../pt433774/index.html">Quem cria o TeamLead Conf e por quê</a></li>
<li><a href="../pt433776/index.html">Tutorial do Driver MongoDB Go</a></li>
<li><a href="../pt433780/index.html">Transição do kit de interface do usuário para o sistema de design no QIWI</a></li>
<li><a href="../pt433786/index.html">Fintech Digest: criptomoeda é propriedade, um número recorde de cartões de crédito foi emitido na Federação Russa</a></li>
<li><a href="../pt433788/index.html">Negócio Seguro e Novas Revisões Freelancers</a></li>
<li><a href="../pt433790/index.html">Modelos avançados de construção em vários estágios</a></li>
<li><a href="../pt433792/index.html">Scripts de shell no Ansible</a></li>
<li><a href="../pt433796/index.html">Como o Homo Sapiens conquistou o mundo. Habilidades de comunicação e negociação</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>