<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë¨ ü§Æ ‚ôèÔ∏è CRDT: tipos de dados replicados sem conflitos üíû üëâüèø üßñüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como contar os hits da p√°gina google.com? E como armazenar o contador de gostos de usu√°rios muito populares? Este artigo prop√µe considerar a solu√ß√£o d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CRDT: tipos de dados replicados sem conflitos</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/418897/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/r1/we/lm/r1welma_rgaxinwrbp7ekni1tdo.png"></div><br>  Como contar os hits da p√°gina google.com?  E como armazenar o contador de gostos de usu√°rios muito populares?  Este artigo prop√µe considerar a solu√ß√£o desses problemas usando o CRDT (tipos de dados replicados sem conflitos, que em russo se traduz aproximadamente como tipos de dados replicados sem conflitos) e, no caso mais geral, tarefas de sincroniza√ß√£o de r√©plicas em um sistema distribu√≠do com v√°rios n√≥s principais. <br><a name="habracut"></a><br><h1>  1. Introdu√ß√£o </h1><br>  H√° muito que estamos acostumados a usar aplicativos como um calend√°rio ou um servi√ßo de anota√ß√µes como o Evernote.  Eles est√£o unidos pelo fato de permitir que voc√™ trabalhe offline, de v√°rios dispositivos e para v√°rias pessoas ao mesmo tempo (nos mesmos dados).  O desafio enfrentado pelos desenvolvedores de cada aplicativo √© como garantir a sincroniza√ß√£o mais "suave" dos dados alterados simultaneamente em v√°rios dispositivos.  Idealmente, o envolvimento do usu√°rio n√£o deve ser necess√°rio para resolver conflitos de mesclagem. <br><br>  Em um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">artigo anterior,</a> j√° consideramos uma abordagem para resolver esses problemas - Transforma√ß√£o Operacional, tamb√©m descrever√° um m√©todo muito semelhante que possui vantagens e desvantagens (por exemplo, o CRDT para JSON ainda n√£o foi inventado. Upd: Gra√ßas ao <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link">msvn</a> pelo link, aqui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Aqui est√° um</a> projeto dos autores de um artigo de pesquisa sobre a implementa√ß√£o do JSON no CRDT) <br><br><h1>  2. Forte consist√™ncia eventual </h1><br>  Recentemente, muito trabalho foi escrito e muita pesquisa foi feita no campo da eventual consist√™ncia.  Na minha opini√£o, agora h√° uma forte tend√™ncia para uma mudan√ßa de consist√™ncia forte para v√°rias op√ß√µes de consist√™ncia, para pesquisar qual consist√™ncia em que situa√ß√µes / sistemas √© mais rent√°vel aplicar, para repensar as defini√ß√µes existentes.  Isso leva a alguma confus√£o, por exemplo, quando os autores de algumas obras, falando sobre consist√™ncia, significam consist√™ncia eventual com alguma propriedade adicional, e outros autores usam certa terminologia para isso. <br><br>  A pergunta levantada pelos autores de um dos artigos critica a defini√ß√£o atual de consist√™ncia eventual: de acordo com ela, se o seu sistema sempre responde ‚Äú42‚Äù a todas as solicita√ß√µes, tudo est√° bem, e eventualmente √© consistente. <br><br>  Sem violar a corre√ß√£o deste artigo, eu, seguindo os autores dos artigos originais, usarei a seguinte terminologia (observe que essas n√£o s√£o defini√ß√µes estritas, s√£o diferen√ßas): <br><br><ul><li>  Consist√™ncia forte (SC): todas as opera√ß√µes de grava√ß√£o s√£o estritamente ordenadas, uma solicita√ß√£o de leitura em qualquer r√©plica retorna o mesmo resultado, √∫ltimo registro.  √â necess√°rio um consenso em <b>tempo real</b> para resolver conflitos (com as conseq√º√™ncias resultantes), pode suportar uma queda para n / 2 - 1 n√≥s. </li><li>  Eventual consist√™ncia (EC): atualize os dados localmente, envie a atualiza√ß√£o ainda mais.  A leitura em r√©plicas diferentes pode retornar dados obsoletos.  Em caso de conflito, revertemos ou de alguma forma decidimos o que fazer.  T.O.  ainda √© necess√°rio um consenso, mas n√£o <b>mais em tempo real</b> . </li><li>  Forte consist√™ncia eventual (SEC): EC + para resolver conflitos, as r√©plicas t√™m um algoritmo predefinido.  T.O.  <b>n√£o √© necess√°rio um consenso</b> , pois pode suportar uma queda para n - 1 n√≥s. </li></ul><br>  Observe que a SEC (por assim dizer) resolve o problema do teorema da CAP: todas as tr√™s propriedades s√£o satisfeitas. <br><br>  Portanto, estamos prontos para doar o SC e queremos ter um certo conjunto de tipos de dados b√°sicos para o nosso sistema distribu√≠do potencialmente inst√°vel que resolver√° automaticamente os conflitos de grava√ß√£o para n√≥s (nenhuma intera√ß√£o do usu√°rio ou solicita√ß√£o a algum √°rbitro √© necess√°ria) <br><br><h1>  3. Tarefas sobre curtidas e hits </h1><br>  Sem d√∫vida, existem v√°rios algoritmos para resolver esses problemas.  O CRDT oferece uma maneira bastante elegante e f√°cil. <br><br><h3>  Contagem de hits do Google.com.br: </h3><br>  O google.com processa aproximadamente 150.000 solicita√ß√µes por segundo de todo o mundo.  Obviamente, o contador precisa ser atualizado de forma ass√≠ncrona.  As filas resolvem parcialmente o problema - por exemplo, se fornecermos uma API externa para obter esse valor, teremos que fazer a replica√ß√£o para n√£o colocar o reposit√≥rio com solicita√ß√µes de leitura.  E se j√° houver replica√ß√£o, talvez sem filas globais? <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/wv/4y/tn/wv4ytnmej1xm2tbhen3ddztgv6w.png" alt="imagem"></div><br><br><h3>  Contando gostos do usu√°rio: </h3><br>  A tarefa √© muito semelhante √† anterior, s√≥ que agora voc√™ precisa contar hits √∫nicos. <br><br><h1>  4. Terminologia </h1><br>  Para uma compreens√£o mais completa do artigo, voc√™ precisa conhecer os seguintes termos: <br><br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Idempot√™ncia</a> <br>  Diz que a aplica√ß√£o da opera√ß√£o v√°rias vezes n√£o altera o resultado. <br>  Exemplos - opera√ß√£o GET ou adi√ß√£o com zero: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">f</span><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">x</span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">x</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-9">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-1"> f (x) = x + 0 </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Comutatividade</a> <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-10"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">f</span><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">x</span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">y</span><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">f</span><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">y</span><span class="MJXp-mo" id="MJXp-Span-21" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">x</span><span class="MJXp-mo" id="MJXp-Span-23" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-2"> f (x, y) = f (y, x) </script><br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Ordem parcial</a> <br>  Reflexividade + transitividade + antissimetria <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Meia estrutura</a> <br>  Conjunto parcialmente pedido com a face superior (inferior) exata <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Vetor de vers√£o</a> <br>  Um vetor de dimens√£o √© igual ao n√∫mero de n√≥s e cada n√≥, quando ocorre um determinado evento, incrementa seu valor no vetor.  Durante a sincroniza√ß√£o, os dados s√£o transmitidos com esse vetor e isso introduz uma rela√ß√£o de ordem, que permite determinar qual r√©plica possui dados antigos / novos. </li></ol><br><h1>  5. Modelos de sincroniza√ß√£o </h1><br><h3>  Baseado no estado: </h3><br>  Tamb√©m chamada de sincroniza√ß√£o passiva, forma o Tipo de dados replicado convergente - CvRDT. <br>  √â usado em sistemas de arquivos como NFS, AFS, Coda e nos armazenamentos KV Riak, Dynamo <br>  Nesse caso, as r√©plicas trocam os estados diretamente, a r√©plica de recebimento mescla o estado recebido com seu estado atual. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/ac/r_/7b/acr_7blhm_vkl7rwgfenmjpvdus.png" alt="imagem"></div><br>  Para executar a converg√™ncia de r√©plicas usando essa sincroniza√ß√£o, √© necess√°rio que: <br><br><ul><li>  Os dados formaram um semil√°tico </li><li>  A fun√ß√£o de mesclagem produziu um limite superior exato </li><li>  As r√©plicas formaram um gr√°fico conectado. </li></ul><br>  Um exemplo: <br><br><ul><li>  Conjunto de dados: n√∫meros naturais <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-24"><span class="MJXp-mtext" id="MJXp-Span-25">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-27">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">b</span><span class="MJXp-mrow" id="MJXp-Span-32"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">N</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-3"> \ mathbb {N} </script></li><li>  Item m√≠nimo: <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-34"><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-36">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-4"> - \ infty </script></li><li><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-42"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">m</span><span class="MJXp-mo" id="MJXp-Span-52" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53">x</span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-55">y</span><span class="MJXp-mo" id="MJXp-Span-56" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58">m</span><span class="MJXp-mrow" id="MJXp-Span-59"><span class="MJXp-mo" id="MJXp-Span-60" style="margin-left: 0em; margin-right: 0em;">√°</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64">o</span><span class="MJXp-mo" id="MJXp-Span-65" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66">x</span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">y</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> mesclagem (x, y) = m√°ximo (x, y) </script></li></ul><br>  Esses requisitos nos fornecem uma fun√ß√£o de mesclagem <b>comutativa</b> e <b>idempotente</b> que <b>cresce monotonicamente</b> em um determinado conjunto de dados: <br><br><div style="text-align:center;"><img width="300" src="https://habrastorage.org/webt/jn/nw/vl/jnnwvlfp_tjkank2zknwdcbj-oc.png" alt="imagem"></div><br>  Isso garante que as r√©plicas converjam mais cedo ou mais tarde e permita que voc√™ n√£o se preocupe com o protocolo de transfer√™ncia de dados - <b>podemos perder mensagens com um novo estado, envi√°-las v√°rias vezes e at√© mesmo em qualquer ordem</b> . <br><br><h3>  Baseado em opera√ß√£o: </h3><br>  Tamb√©m chamado de Sincroniza√ß√£o Ativa, ele forma o Tipo de Dados Replicado Comutativo - CmRDT. <br>  Utilizado em sistemas cooperativos como Bayou, Rover, IceCube, Telex. <br><br>  Nesse caso, as r√©plicas trocam opera√ß√µes de atualiza√ß√£o de estado.  Ao atualizar dados, a r√©plica original: <br><br><ul><li>  Chama o m√©todo generate (), que retorna o m√©todo effector () para executar nas r√©plicas restantes.  Em outras palavras, effector () √© o fechamento para alterar o estado das r√©plicas restantes. </li><li>  Aplicando um efetor a um estado local </li><li>  Envia efetor para todas as outras r√©plicas </li></ul><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/bd/i3/ps/bdi3pshr57wi0udnldnurhcdpfs.png" alt="imagem"></div><br>  Para executar a converg√™ncia de r√©plicas, as seguintes condi√ß√µes devem ser atendidas: <br><br><ul><li>  Protocolo de Entrega Confi√°vel </li><li>  Se o efetor for entregue a todas as r√©plicas de acordo com a ordem inserida (para um determinado tipo), os efetores simult√¢neos ser√£o comutativos <b>ou</b> </li><li>  Se o efetor for entregue a todas as r√©plicas sem levar em conta o pedido, todos os efetores ser√£o comutativos. </li><li>  Caso o efetor possa ser entregue v√°rias vezes, ele deve ser idempotente </li><li>  Algumas implementa√ß√µes usam filas (Kafka) como parte do protocolo de entrega. </li></ul><br><h3>  Baseado em Delta: </h3><br>  Considerando o estado / opera√ß√£o, √© f√°cil perceber que, se uma atualiza√ß√£o altera apenas parte do estado, n√£o faz sentido enviar o estado inteiro e, se um grande n√∫mero de altera√ß√µes afeta um estado (por exemplo, um contador), voc√™ pode enviar uma altera√ß√£o agregada e nem todas as opera√ß√µes mudan√ßas. <br><br>  A sincroniza√ß√£o delta combina as duas abordagens e envia mutadores delta que atualizam o estado de acordo com a data da sincroniza√ß√£o mais recente.  Na sincroniza√ß√£o inicial, √© necess√°rio enviar o estado completamente, e algumas implementa√ß√µes nesses casos j√° levam em considera√ß√£o o estado das r√©plicas restantes ao construir delta-mutadores. <br><br>  O pr√≥ximo m√©todo de otimiza√ß√£o √© compactar o log baseado em op, se atrasos forem permitidos. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rd/vi/a5/rdvia5kv708z55ndt_t5j_leaum.png" alt="imagem"></div><br><h3>  Baseado em opera√ß√£o pura: </h3><br>  H√° um atraso na cria√ß√£o do opector na sincroniza√ß√£o baseada em op.  Em alguns sistemas, isso pode n√£o ser aceit√°vel, ent√£o voc√™ deve enviar a altera√ß√£o original com o custo de complicar o protocolo e a quantidade adicional de metadados. <br><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/webt/3l/p2/r2/3lp2r2ruizjddxllrwgbgwh5ykw.png" alt="imagem"></div><br><h3>  Abordagens de uso padr√£o: </h3><br><ul><li>  Se as atualiza√ß√µes forem <b>enviadas imediatamente</b> no sistema, a escolha com base no estado seria uma m√° escolha, pois o envio de todo o estado √© mais caro do que apenas uma opera√ß√£o de atualiza√ß√£o.  Baseado em Delta funciona melhor, mas nesse caso em particular, a diferen√ßa com base em estado ser√° pequena. </li><li>  Se voc√™ precisar <b>sincronizar a r√©plica ap√≥s uma falha</b> , ser√° baseada em estado e em delta a escolha perfeita.  Se voc√™ precisar usar opera√ß√µes, ent√£o as op√ß√µes s√£o: <br><br>  1) Role todas as opera√ß√µes perdidas desde o momento da falha <br>  2) Uma c√≥pia completa de uma das r√©plicas e revers√£o de opera√ß√µes perdidas </li><li>  Como observado acima, o sistema operacional exige que as atualiza√ß√µes sejam entregues exatamente uma vez para cada r√©plica.  O requisito de entrega apenas uma vez pode ser omitido se o efetor for idempotente.  Na pr√°tica, √© muito mais f√°cil implementar o primeiro que o segundo. </li></ul><br><h3>  A rela√ß√£o entre Op-based e State: </h3><br>  Duas abordagens podem ser emuladas uma pela outra, portanto, no futuro, consideraremos o CRDT sem refer√™ncia a qualquer modelo de sincroniza√ß√£o espec√≠fico. <br><br><h1>  6. CRDT </h1><br><h2>  6.1 Contador </h2><br>  Um n√∫mero inteiro que suporta duas opera√ß√µes: inc e dec.  Como exemplo, considere poss√≠veis implementa√ß√µes para sincroniza√ß√µes baseadas em op e baseadas em estado: <br><br><h3>  Contador baseado em Op: </h3><br>  Obviamente, basta enviar atualiza√ß√µes.  Exemplo para inc: <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-function">function </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> function (counter) { counter += <span class="hljs-number"><span class="hljs-number">1</span></span> } }</code> </pre> <br><h3>  Contador baseado em estado: </h3><br>  A implementa√ß√£o n√£o √© mais t√£o √≥bvia, pois n√£o est√° claro como deve ser a fun√ß√£o de mesclagem. <br><br>  Considere as seguintes op√ß√µes: <br><br>  <u>Contador de aumento monot√¥nico (contador de incremento apenas, contador G):</u> <br><br>  Os dados ser√£o armazenados como um vetor de dimens√£o igual ao n√∫mero de n√≥s (vetor de vers√£o) e cada r√©plica aumentar√° o valor na posi√ß√£o com seu ID. <br><br>  A fun√ß√£o de mesclagem assumir√° o m√°ximo nas posi√ß√µes correspondentes, e o valor final √© a soma de todos os elementos do vetor <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-70"><span class="noError" id="MJXp-Span-71" style="display: inline-block;">\&nbsp;begin&nbsp;{align}&nbsp;inc&nbsp;()&nbsp;&amp;:&nbsp;V&nbsp;[id&nbsp;()]&nbsp;=&nbsp;V&nbsp;[id&nbsp;()]&nbsp;+&nbsp;1&nbsp;\\&nbsp;valor&nbsp;()&nbsp;&amp;:&nbsp;\&nbsp;sum_&nbsp;{i&nbsp;=&nbsp;0}&nbsp;^&nbsp;{n}&nbsp;V&nbsp;[i]&nbsp;\\&nbsp;mesclar&nbsp;(C_1,&nbsp;C_2)&nbsp;&amp;:&nbsp;i&nbsp;\&nbsp;em&nbsp;[1..n]&nbsp;\&nbsp;Resultado&nbsp;[i]&nbsp;=&nbsp;m√°ximo&nbsp;(C_1.V&nbsp;[i],&nbsp;C_2.V&nbsp;[i])&nbsp;\&nbsp;end&nbsp;{align</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \ begin {align} inc () &: V [id ()] = V [id ()] + 1 \\ valor () &: \ sum_ {i = 0} ^ {n} V [i] \\ mesclar (C_1, C_2) &: i \ em [1..n] \ Resultado [i] = m√°ximo (C_1.V [i], C_2.V [i]) \ end {align</script></p><br>  Voc√™ tamb√©m pode usar o G-Set (veja abaixo) <br><br>  Aplica√ß√£o: <br><br><ul><li>  Contando cliques / hits (sic!) </li></ul><br>  <u>Contador com suporte de decremento (contador PN)</u> <br><br>  Come√ßamos dois contador G - um para opera√ß√µes de incremento, o segundo - para decremento <br><br>  Aplica√ß√£o: <br><br><ul><li>  O n√∫mero de usu√°rios conectados em uma rede p2p, como o Skype </li></ul><br>  <u>Contador n√£o negativo</u> <br><br>  Uma implementa√ß√£o simples ainda n√£o existe.  Sugira suas id√©ias nos coment√°rios, discuta. <br><br><h2>  6.2 Registrar </h2><br>  Uma c√©lula de mem√≥ria com duas opera√ß√µes - atribuir (escrever) e valor (ler). <br>  O problema √© que a atribui√ß√£o n√£o √© comutativa.  Existem duas abordagens para resolver esse problema: <br><br><h3>  √öltimo registro de vit√≥rias de grava√ß√£o (LWW-Register): </h3><br>  Entramos no pedido completo por meio da gera√ß√£o de ID exclusivo para cada opera√ß√£o (registro de data e hora, por exemplo). <br><br>  Um exemplo de sincroniza√ß√£o √© a troca de pares (valor, id): <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/rw/8m/1k/rw8m1k8wgby7v0gczcthhdmdvns.png"></div><br>  Aplica√ß√£o: <br><br><ul><li>  Colunas em cassandra </li><li>  NFS - arquivo no todo ou em parte </li></ul><br><h3>  Registre-se com v√°rios valores (Multi-Value Register, MV-Register): </h3><br>  A abordagem √© semelhante a um contador G - armazenamos o conjunto (valor, vetor de vers√£o).  Registre o valor - todos os valores, ao mesclar - o LWW separadamente para cada valor no vetor. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/o3/kr/vc/o3krvcuowzsa-vi_avn27jcscxk.png"></div><br>  Aplica√ß√£o: <br><br><ul><li>  Cesta na Amaz√¥nia.  Um bug conhecido √© associado a isso, quando, ap√≥s remover um item da cesta, ele aparece l√° novamente.  O motivo √© que, apesar do registro armazenar um conjunto de valores, ele n√£o √© um conjunto (veja a figura abaixo).  A prop√≥sito, a Amazon nem considera isso um bug - na verdade, aumenta as vendas. </li><li>  Riak.  Em um caso mais geral, mudamos o problema de escolher o valor real (observa√ß√£o - n√£o h√° conflito!) Para o aplicativo. </li></ul><br>  Explica√ß√£o do bug na Amazon: <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/k0/au/le/k0auleq-jjcrfdtkdswe8tfdxnq.png"></div><br><br><h2>  6.3 Lotes </h2><br>  O conjunto √© o tipo b√°sico para a constru√ß√£o de cont√™ineres, mapas e gr√°ficos e suporta opera√ß√µes - add e rmv, que n√£o s√£o comutativas. <br><br>  Considere a implementa√ß√£o ing√™nua do conjunto baseado em op, no qual add e rmv s√£o executados √† medida que chegam (add chega a 1 e 2 r√©plicas ao mesmo tempo e, em seguida, rmv vai para 1) <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/yk/uu/3b/ykuu3b4-brgkjj2p4y32gmytafs.png"></div><br>  Como voc√™ pode ver, as r√©plicas eventualmente se dispersaram.  Considere as v√°rias op√ß√µes para construir conjuntos sem conflito: <br><br><h3>  Conjunto crescente (G-Set): </h3><br>  A solu√ß√£o mais f√°cil √© impedir que itens sejam exclu√≠dos.  Tudo o que resta √© a opera√ß√£o de adi√ß√£o, que √© comutativa.  A fun√ß√£o de mesclagem √© a uni√£o de conjuntos. <br><br><h3>  Conjunto bif√°sico (conjunto 2P): </h3><br>  Permitimos que voc√™ exclua, mas n√£o ser√° poss√≠vel adicion√°-lo novamente ap√≥s a remo√ß√£o.  Para implementar, configuramos um conjunto separado de elementos remotos do conjunto G (esse conjunto √© chamado de conjunto de marca de exclus√£o) <br>  Exemplo para baseado em estado: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-72"><span class="noError" id="MJXp-Span-73" style="display: inline-block;">\&nbsp;begin&nbsp;{align}&nbsp;pesquisa&nbsp;(e)&nbsp;&amp;:&nbsp;e&nbsp;\&nbsp;em&nbsp;A&nbsp;\&nbsp;land&nbsp;e&nbsp;\&nbsp;n√£o&nbsp;em&nbsp;R&nbsp;\\&nbsp;add&nbsp;(e)&nbsp;&amp;:&nbsp;A&nbsp;=&nbsp;A&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;rmv&nbsp;(e)&nbsp;&amp;:&nbsp;R&nbsp;=&nbsp;R&nbsp;\&nbsp;cup&nbsp;\&nbsp;{e&nbsp;\}&nbsp;\\&nbsp;mesclar&nbsp;(S_1,&nbsp;S_2)&nbsp;&amp;:&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.A&nbsp;=&nbsp;S_1.A&nbsp;\&nbsp;cup&nbsp;S_2.A&nbsp;\\&nbsp;Res&nbsp;&amp;&nbsp;ult.R&nbsp;=&nbsp;S_1.R&nbsp;\&nbsp;cup&nbsp;S_2.R&nbsp;\&nbsp;end&nbsp;{align}</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \ begin {align} pesquisa (e) &: e \ em A \ land e \ n√£o em R \\ add (e) &: A = A \ cup \ {e \} \\ rmv (e) &: R = R \ cup \ {e \} \\ mesclar (S_1, S_2) &: \\ Res & ult.A = S_1.A \ cup S_2.A \\ Res & ult.R = S_1.R \ cup S_2.R \ end {align} </script></p><br><h3>  Conjunto de elementos LWW: </h3><br>  A pr√≥xima maneira de implementar um conjunto sem conflito √© introduzir um pedido completo, uma das op√ß√µes √© gerar registros de data e hora exclusivos para cada elemento. <br><br>  Temos dois conjuntos - add-set e remove-set, quando add () √© chamado, add (elemento, unique_id ()), ao verificar se h√° um elemento no conjunto - veja onde o timestamp √© maior - em remove-set ou em add-set <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/iw/gt/95/iwgt95jsuu9xps80j0w-sjgweq4.png"></div><br><h3>  Conjunto PN: </h3><br>  Varia√ß√£o com a ordena√ß√£o do conjunto - iniciamos um contador para cada elemento, quando o adicionamos, aumentamos, quando o exclu√≠mos, diminu√≠mos.  Um elemento est√° no conjunto se seu contador for positivo. <br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/nf/qz/dw/nfqzdwf7risphmn8qyuq0tsjc3s.png"></div><br>  Observe o efeito interessante - na terceira r√©plica, adicionar um elemento n√£o leva √† sua apar√™ncia. <br><br><h3>  Conjunto Observar-Remover, Conjunto OR ou Conjunto Add-Win: </h3><br>  Nesse tipo, adicionar tem preced√™ncia sobre remover.  Exemplo de implementa√ß√£o: a cada elemento adicionado recentemente √© atribu√≠da uma tag exclusiva (relativa ao elemento e n√£o ao conjunto inteiro).  Rmv remove um elemento do conjunto e envia todos os pares vistos (elemento, tag) para as r√©plicas para remo√ß√£o. <br><br><div style="text-align:center;"><img width="600" src="https://habrastorage.org/webt/5n/ac/1l/5nac1lanif5y_kh_w9rvaz-jqoe.png"></div><br><br><h3>  Conjunto Remover-Ganhar: </h3><br>  Semelhante ao anterior, mas ao mesmo tempo, add / rmv rmv vence. <br><br><h2>  6.4 Gr√°fico </h2><br>  Este tipo √© constru√≠do com base em muitos.  O problema √© o seguinte: se houver opera√ß√µes simult√¢neas addEdge (u, v) e removeVertex (u) - o que devo fazer?  As seguintes op√ß√µes s√£o poss√≠veis: <br><br><ul><li>  Prioridade RemoveVertex, todas as arestas incidentes nesse v√©rtice s√£o exclu√≠das </li><li>  Prioridade AddEdge, v√©rtices exclu√≠dos restaurados </li><li>  Adiamos a execu√ß√£o do removeVertex at√© que todos os addEdge simult√¢neos sejam executados. </li></ul><br>  A op√ß√£o mais f√°cil √© a primeira, para sua implementa√ß√£o (gr√°fico 2P2P) basta obter dois conjuntos 2P, um para os v√©rtices e o segundo para as arestas <br><br><h2>  6.5 Mapa </h2><br><h3>  Mapa de literais: </h3><br>  Dois problemas a resolver: <br><br><ul><li>  O que fazer com opera√ß√µes de venda simult√¢nea?  Por analogia com os contadores, voc√™ pode escolher sem√¢ntica LWW ou MV </li><li>  O que fazer com o put / rmv simult√¢neo?  Por analogia com os conjuntos, √© poss√≠vel sem√¢ntica put-wins ou rmv-wins ou last-put-wins. </li></ul><br><h3>  Mapeamento CRDT (Mapa de CRDTs): </h3><br>  Um caso mais interessante, porque  permite criar mapeamentos aninhados.  N√£o consideramos casos de altera√ß√£o de tipos aninhados - isso deve ser decidido pelo pr√≥prio CRDT aninhado. <br><br>  <u>Mapa Remover-como-redefini√ß√£o recursiva</u> <br><br>  A opera√ß√£o de remo√ß√£o "redefine" o valor do tipo para um determinado estado inicial.  Por exemplo, para um contador, esse √© um valor zero. <br><br>  Considere um exemplo - uma lista de compras geral.  Um dos usu√°rios adiciona farinha e o segundo faz uma finaliza√ß√£o da compra (isso leva a uma chamada para a opera√ß√£o de exclus√£o em todos os elementos).  Como resultado, uma unidade de farinha permanece na lista, o que parece l√≥gico. <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/9g/sn/4j/9gsn4jdmbdg_ba1hdrmftl5mcgy.png"></div><br>  <u>Mapa Remove-wins</u> <br><br>  A opera√ß√£o rmv tem preced√™ncia. <br><br>  Exemplo: em um jogo online, um jogador de Alice tem 10 moedas e um martelo.  Em seguida, dois eventos ocorrem simultaneamente: na r√©plica A, ela produziu uma unha, e na r√©plica B, seu personagem √© exclu√≠do com a remo√ß√£o de todos os objetos: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/tb/xd/6s/tbxd6s7eun3rpn57mnwt9d4hbxa.png"></div><br><br>  Observe que, ao usar remover como recursivo, uma unha acabaria por permanecer, o que n√£o √© o estado correto quando o personagem √© removido. <br><br>  <u>Atualizar mapa de vit√≥rias</u> <br><br>  As atualiza√ß√µes t√™m preced√™ncia, ou melhor, cancelam opera√ß√µes anteriores para excluir rmv simult√¢neas. <br><br>  Exemplo: em um jogo online, o personagem Alice na r√©plica B √© exclu√≠do devido √† inatividade, mas a atividade ocorre na r√©plica A ao mesmo tempo.  Obviamente, a opera√ß√£o de exclus√£o deve ser cancelada. <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/63/oz/5y/63oz5yzch4ioguyram3erawkzl0.png"></div><br>  H√° um efeito interessante ao trabalhar com essa implementa√ß√£o - suponha que tenhamos duas r√©plicas, A e B, e elas armazenem o conjunto por alguma chave k.  Ent√£o, se A excluir o valor da chave k e B excluir todos os elementos do conjunto, no final, as r√©plicas deixar√£o um conjunto vazio com a chave k. <br><br>  Observe que uma implementa√ß√£o ing√™nua n√£o funcionar√° corretamente - voc√™ n√£o pode simplesmente desfazer todas as opera√ß√µes de exclus√£o anteriores.  No exemplo a seguir, com essa abordagem, o estado final seria o estado inicial, incorreto: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/webt/mp/un/hm/mpunhmkzj125hqob4net7iq7kc4.png"></div><br><h2>  Lista </h2><br>  O problema com esse tipo √© que os √≠ndices de itens em r√©plicas diferentes ser√£o diferentes ap√≥s as opera√ß√µes locais de inser√ß√£o / exclus√£o.  Para resolver esse problema, a abordagem Transforma√ß√£o operacional √© aplicada - ao aplicar a altera√ß√£o obtida, o √≠ndice do elemento na r√©plica original deve ser levado em considera√ß√£o. <br><br><h1>  7. Riak </h1><br>  Como exemplo, considere o CRDT em Riak: <br><br><ul><li>  Contador: Contador PN </li><li>  Conjunto: Conjunto OR </li><li>  Mapa: atualiza√ß√£o ganha mapa de CRDTs </li><li>  Sinalizador (booleano): OR-Defina onde no m√°ximo 1 elemento </li><li>  Registro: pares (valor, registro de data e hora) </li></ul><br><h1>  8. Quem usa CRDT </h1><br>  A se√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">wiki</a> cont√©m bons exemplos. <br><br><h1>  9. Refer√™ncias </h1><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Lojas Key-CRDT</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um tipo de dados JSON replicado sem conflitos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um estudo abrangente dos tipos de dados replicados convergentes e comutativos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tipo de dados replicado convergente e comutativo</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tipo de dados replicado sem conflitos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Um guia de bluffers para CRDTs em Riak</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">CRDTs: uma atualiza√ß√£o (ou apenas um PUT)</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Tipos de dados replicados sem conflitos: uma vis√£o geral</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Consist√™ncia Eventual Forte e Tipos de Dados Replicados sem Conflitos</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Estruturas de dados eventualmente consistentes</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt418897/">https://habr.com/ru/post/pt418897/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt418885/index.html">Crispr pode acelerar processos naturais e mudar a forma como os alimentos s√£o cultivados</a></li>
<li><a href="../pt418887/index.html">Qu√£o r√°pido o universo est√° se expandindo?</a></li>
<li><a href="../pt418889/index.html">Guia de Teste de Aplica√ß√£o Manual: Benef√≠cios, Etapas e Metodologias</a></li>
<li><a href="../pt418891/index.html">Verificamos os c√≥digos-fonte do Android usando o PVS-Studio, ou ningu√©m √© perfeito</a></li>
<li><a href="../pt418895/index.html">Aprenda Intelig√™ncia Artificial para jogar um jogo</a></li>
<li><a href="../pt418899/index.html">Primeiras impress√µes e a√ß√µes ap√≥s a atualiza√ß√£o do MySQL da vers√£o 5.7 para 8.0.11</a></li>
<li><a href="../pt418901/index.html">Os russos conquistaram a maioria das medalhas de ouro na Olimp√≠ada Europeia de Ci√™ncia da Computa√ß√£o eJOI 2018</a></li>
<li><a href="../pt418903/index.html">Cientistas: n√£o h√° CO‚ÇÇ suficiente em Marte para aquecer a atmosfera. Explos√£o de p√≥lo n√£o vai ajudar</a></li>
<li><a href="../pt418905/index.html">InlineKeyboard em telegram bots</a></li>
<li><a href="../pt418907/index.html">Como ensinar o Zabbix a enviar notifica√ß√µes de problemas diretamente para a √°rea de trabalho</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>