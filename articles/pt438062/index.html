<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì´ üßòüèæ üë®üèΩ‚Äçüè´ Meu endere√ßo n√£o √© uma casa ou rua, meu endere√ßo √© a Uni√£o Sovi√©tica? üßúüèª üìø üë©üèΩ‚Äçü§ù‚Äçüë®üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="microBIGDATA ou FIAS no seu bolso 


 Peter Brueghel, o Jovem, Pagamento de Impostos , 1640 

 A √∫ltima entrada no barbeador nos objetos foi. Continua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meu endere√ßo n√£o √© uma casa ou rua, meu endere√ßo √© a Uni√£o Sovi√©tica?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438062/"> <b>microBIGDATA ou FIAS no seu bolso</b> <br><br><img src="https://habrastorage.org/webt/gq/le/vh/gqlevhij14f0jkubb4pmbjwvb5u.jpeg"><br>  <i>Peter Brueghel, o Jovem, <b>Pagamento de Impostos</b> , 1640</i> <br><br>  A √∫ltima entrada no barbeador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nos objetos</a> foi.  Continuaremos o reconhecimento em batalha.  Hoje vamos falar sobre o dif√≠cil.  Ainda n√£o se trata de BIG DATA, mas j√° √© inconveniente trabalhar - grandes quantidades de dados.  Nem todos cabem em toda a RAM, mas alguns nem cabem no disco (n√£o h√° espa√ßo suficiente, mas muito lixo).  O nome do nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">banco de dados FIAS de</a> confian√ßa √© o banco de dados do sistema de informa√ß√µes de endere√ßo federal.  Arquivo de 5,5 GB.  E √© compactado em um arquivo XML.  Ap√≥s descompactar, haver√° 53 GB completos (armazene 110 GB para descompactar).  E quando voc√™ come√ßa a analis√°-lo e convert√™-lo, 110 GB n√£o ser√£o suficientes.  Sobre a quantidade necess√°ria de RAM tamb√©m ser√°. <br><a name="habracut"></a><br>  Tudo ficaria bem, mas voc√™ pode ir al√©m.  Existe um projeto internacional de coleta e sistematiza√ß√£o de dados de c√≥digo aberto - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenAddresses</a> .  Portanto, haver√° mais bancos de dados.  A cobertura atual do planeta tem muitas manchas brancas, por exemplo, a R√∫ssia est√° quase ausente.  O tamanho do arquivo √© de 10 GB. <br><br>  Ou um banco de dados de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto OpenStreetMaps</a> bastante conhecido.  √â constru√≠do por volunt√°rios com base na Wikipedia.  Muito detalhado e multil√≠ngue.  Agora, um arquivo completo de XML compactado com um tamanho de 74 GB. <br><blockquote>  Se eles come√ßaram a falar sobre endere√ßos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chegaram not√≠cias</a> inesperadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do DuckDuckGo</a> , o melhor mecanismo de pesquisa seguro de hoje, sobre sua transi√ß√£o para os cart√µes da Apple.  Mais precisamente no Apple MapKit JS.  A caracter√≠stica mais interessante em nosso contexto √© a "busca aprimorada de endere√ßos".  A Apple √© a melhor coletiva e prote√ß√£o cuidadosa de nossos dados?  Ser√° necess√°rio rastrear ... </blockquote>  Ent√£o o desafio.  Como colocar toda essa riqueza de endere√ßos em um reposit√≥rio agrad√°vel para uso, para permitir que voc√™ sonhe com uma API gratuita (em Python, √© claro) e para n√£o deixar seu querido ferro engasgar com uma carga n√£o lida.  Vamos cham√°-lo de MicroBigData - mcBD ou ŒºBG em ingl√™s :-) <br><br>  Na economia de cada segundo (ou mesmo do primeiro) desenvolvedor, esse √© um diret√≥rio de endere√ßos, tamb√©m √© um diret√≥rio de top√¥nimos, algo muito necess√°rio.  E quando tamb√©m √© normativo, preparado, limpo e bem documentado pelo corpo certo, √© apenas um conto de fadas.  Devemos prestar homenagem, o servi√ßo fiscal russo est√° fazendo bem sua produ√ß√£o digital.  Tanto quanto poss√≠vel.  Provavelmente existem algumas falhas no interior e a limpeza dos dados continua.  Como resolver esse problema, deixe os chefes de Estado pensarem.  Eles decidem por n√≥s mesmos e pelo benef√≠cio de todos n√≥s.  A prop√≥sito, um erro de digita√ß√£o do FIAS foi encontrado no exemplo abaixo.  O resultado n√£o √© afetado.  Eu n√£o consertei.  Voc√™ vai encontrar? <br><br>  N√£o sei at√© que ponto os dados de endere√ßo s√£o relevantes em seus projetos - todas s√£o regi√µes, cidades, ruas.  Mas parece que nem um √∫nico projeto para as pessoas pode prescindir delas.  Esse √© o endere√ßo para onde procurar uma pessoa ou para onde enviar encomendas para ela.  Os detalhes do passaporte ou qualquer outro documento devem ser salvos.  Ou talvez seja o endere√ßo do escrit√≥rio ou das atra√ß√µes que voc√™ recomenda visitar.  E o que fazer?  Onde obter <br><br>  A solu√ß√£o mais simples, sem considerar erros e duplicatas, s√£o objetos primitivos que cont√™m literais simples de cadeia de caracteres (s√£o constantes de cadeia, tamb√©m s√£o cadeias de caracteres).  Permita que os usu√°rios insiram as pr√≥ximas entradas recebidas neles.  E os objetos s√£o capazes de se salvar - j√° <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">passamos por isso</a> . <br><br>  Tais objetos s√£o, por exemplo, conforme descrito na classe abaixo.  <a href="">Diretamente do livro</a> , embora americano, mas ajustado √† nossa realidade russa - em vez de seu CEP, haver√° o nosso c√≥digo postal.  Eu tamb√©m substituiria o CEP por um n√∫mero, mas por uma quest√£o de monotonia, deixo uma string.  Qualquer pessoa que reconhe√ßa imediatamente uma linguagem, e este √© o ObjectScript, tem direito a um incentivo semelhante. <br><br><pre><code class="plaintext hljs">Class Soviet.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  √â claro que muitos ficar√£o indignados, dizem que tudo est√° saindo dos bolsos do objeto (literais).  Onde foi visto, para que o objeto brilhe publicamente seus campos ?!  Vamos deixar assim, d√≥i tamb√©m um exemplo eloq√ºente e √© compreens√≠vel para qualquer aluno. <br><br>  Isso √© realmente tudo o que √© necess√°rio.  Preenchido os campos.  Coloque em armazenamento.  Transferido para outros objetos para o trabalho.  Herdado ainda mais por algu√©m.  Tudo funciona.  E armazenado! <br><blockquote>  Mas algumas palavras por que n√£o vale a pena fazer isso, √© preciso dizer.  Qual √© o nosso endere√ßo de objeto?  Por que n√£o pode ser apenas um grupo de cadeias de texto?  As obje√ß√µes mais √≥bvias que v√™m √† mente v√™m do contexto - quem usa este endere√ßo, de que forma e com que finalidade?  Tente deixar de lado seu pensamento de programa√ß√£o e imagine como um ‚Äúturista estrangeiro‚Äù, ‚Äúhistoriador‚Äù, ‚Äúinspetor de impostos‚Äù, ‚Äúadvogado‚Äù e assim por diante pensam. <br><br>  Creio que imediatamente surgem uma s√©rie de perguntas e esclarecimentos adicionais: que idioma usar, em que codifica√ß√£o armazenar e fornecer, em que √©poca classificar, quais documentos s√£o efetivados, legais ou postais?  Uma cidade √© um assentamento ou o qu√™?  Mesmo uma rua pode se transformar em uma avenida, uma rua lateral, avenida ou outra coisa.  O que fazer com todos esses detalhes importantes de implementa√ß√£o? <br><br>  Tome um exemplo vivo.  O Google agora √© gerenciado por Sundar Pichai.  Ele pr√≥prio √© da √çndia.  Nascido na cidade de Chennai (tamb√©m conhecido como Chennai).  Ou em Madras?  Em 1996, os √≠ndios decidiram que o nome da cidade era muito portugu√™s e renomearam a capital de Tamil Nadu, de Madras para Chennai.  E o que Sundar e 72 milh√µes de seus compatriotas devem escrever em seus documentos eletr√¥nicos? <br><br>  Em geral, toda a ci√™ncia lida com isso - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">topon√≠mia aplicada</a> . </blockquote>  Ent√£o as perguntas imploram.  Como lidar com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hora e data</a> ?  O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dinheiro</a> √© t√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">√≥bvio</a> ?  As coordenadas geogr√°ficas s√£o t√£o simples?  E como isso √© implementado no seu c√≥digo?  Voc√™ pode transferir para o DBMS selecionado sem diminuir o n√≠vel de abstra√ß√£o?  Como n√£o entrar nos tipos at√¥micos de dados da m√°quina e pensar constantemente em sua reconstru√ß√£o?  Aqui, vale a pena procurar a fonte de uma API primitiva ou, inversamente, s√≥lida.  Pense nisso √† vontade. <br><br>  Em resumo, o contexto √© o mais importante.  E o modelo de objeto nos d√° a oportunidade de us√°-lo diretamente, encapsulando ‚Äúdados da m√°quina‚Äù e implementando um comportamento ‚Äúativo‚Äù sens√≠vel ao contexto.  Nem todas as tuplas de baixo n√≠vel dispostas nas tabelas ;-) <br><br>  Enquanto isso, voltemos √† implementa√ß√£o "primitiva" e complicamos nossas vidas.  Para come√ßar, elimine erros e duplicatas.  Ou seja, procuraremos uma maneira de escrever endere√ßos imediatamente.  Ao mesmo tempo, ajudaremos os desenvolvedores da interface do usu√°rio a organizar dicas para os usu√°rios ao preencher os campos de entrada de dados. <br><blockquote>  Quando duas pessoas se re√∫nem em um s√≥ lugar - textos e a plataforma de dados InterSystems IRIS, o desenvolvedor tem uma oportunidade real de implantar ao m√°ximo sem sair da m√°quina.  Por exemplo, usando os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">componentes de objeto internos iKnow e iFind</a> .  Esses s√£o componentes para trabalhar com dados n√£o estruturados e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pesquisa de texto completo</a> , respectivamente.  O russo √© suportado "pronto para uso". </blockquote>  Primeiramente, ensinaremos o Endere√ßo a ler os dados necess√°rios da fonte original.  Felizmente, o conjunto de dados do servi√ßo tribut√°rio federal possui descri√ß√µes prontas da estrutura dos documentos XML.  De acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descri√ß√£o</a> anexada aos dados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do site do FIAS</a> , precisamos do conjunto de dados ADDROBJ, que, no meu caso, corresponde ao arquivo AS_ADDROBJ_2_250_01_04_01_01.xsd <br><br>  Em seguida, usaremos o conversor do sistema do modelo XSD na estrutura de campo correspondente da classe% XML.Adaptor, gentilmente preparada para n√≥s pelos desenvolvedores do IRIS.  O sinal de porcentagem no in√≠cio significa apenas que essa √© uma classe da biblioteca do sistema.  <a href="">Detalhes de uso est√£o na documenta√ß√£o</a> .  Vamos realizar opera√ß√µes no terminal. <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("http://localhost/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre> <br>  O mesmo pode ser obtido no <a href="">Atelier IDE</a> (no menu Ferramentas&gt; Suplementos&gt; Assistente de Esquema XML) ou por solicita√ß√µes semelhantes a objetos diretamente do c√≥digo do programa. <br><br><img src="https://habrastorage.org/webt/ed/3k/8c/ed3k8cfd9t_jc8gklg_euthhihy.png"><br><br>  Como usamos o construtor sem especificar os par√¢metros, ou seja, o nome do pacote para colocar as classes resultantes, elas terminaram no pacote de teste.  Como voc√™ pode ver no segundo comando, eu dei o arquivo de esquema atrav√©s do meu servidor web local em Python: <br><br><pre> <code class="bash hljs">python3 -m http.server 80</code> </pre> <br>  Voc√™ pode usar qualquer outro servidor http que desejar.  Ou fa√ßa o upload do arquivo para o servidor IRIS e indique o caminho direto para ele. <br><br>  Como resultado, temos duas classes que refletem completamente a estrutura do nosso XML endere√ß√°vel: <br><br><div class="spoiler">  <b class="spoiler_title">Test.AddressObjects</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///            Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; ///    Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">Test.object</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///  : http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// OKATO Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// OKTMO Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); ///    Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///        Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); ///        Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); ///           4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); ///      4.0      (  ) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); ///     .     .      . /// 0 ‚Äì   /// 1 -  Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///   Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     ‚Äì    (.   OperationStatus): /// 01 ‚Äì ; /// 10 ‚Äì ; /// 20 ‚Äì ; /// 21 ‚Äì  ; /// 30 ‚Äì ; /// 31 -     ; /// 40 ‚Äì    (); /// 41 ‚Äì     ; /// 42 -        ; /// 43 -         ; /// 50 ‚Äì ; /// 51 ‚Äì     ; /// 60 ‚Äì    ; /// 61 ‚Äì        Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    4 (    ) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); ///     Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///  : /// 0 -   /// 1 - ; /// 2 - - Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre> <br></div></div><br>  De toda a lista de arquivos xml no FIAS, usaremos apenas um arquivo com os nomes de regi√µes, cidades e ruas.  No momento da prepara√ß√£o da publica√ß√£o, eu tinha o seguinte: <br>  AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML <br><br>  O tamanho do arquivo n√£o √© grande nem pequeno, mas quase 3 GB.  Voc√™ n√£o o abrir√° com ferramentas de texto comuns - elas n√£o digerem esse tamanho. <br><blockquote>  A prop√≥sito, o comprimento m√°ximo de uma string literal (tipo String) no InterSystems IRIS n√£o passa de 3.641.144 caracteres.  Ou seja, o download do arquivo diretamente ou a URL nele falhar√°.  Outras restri√ß√µes podem ser encontradas <a href="">na documenta√ß√£o</a> .  Para trabalhar com grandes volumes de dados, voc√™ pode usar fluxos de dados (fluxos) que n√£o possuem um limite de tamanho. </blockquote>  Vamos ver o que temos? <br><br>  Cozinhar FIAS pimenta recheada.  Esta √© apenas uma prepara√ß√£o para um futuro maravilhoso.  Primeiro, obtemos o conjunto m√≠nimo inicial.  Precisamos apenas destes ingredientes: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ];</code> </pre><br>  Em seguida, <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">escreva</a> .  Criamos um objeto que entende XML como nativo - usamos uma classe da biblioteca de sistema% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  E damos-lhe instru√ß√µes a quem levar e ignoramos o resto.  Tomaremos uma por√ß√£o: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject")</code> </pre> <br>  Depois, h√° varia√ß√µes sobre como obter o arquivo microbd original.  Se for conveniente, voc√™ pode coloc√°-lo ao lado do reposit√≥rio - localmente no sistema de arquivos do servidor IRIS.  Ou, como no meu exemplo, pe√ßa para enviar via HTTP.  Existe uma op√ß√£o ainda mais universal, sobre a qual haver√° algumas palavras abaixo. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre> <br><blockquote>  Importante!  Neste momento, a maioria que passar√° esse exemplo para si ter√° uma coisa terr√≠vel.  O sistema retornar√° em vez do alegre "1" (tudo est√° em ordem), algo come√ßando com "0 ¬∏ STORE ...".  E n√£o vai agradar.  Ou seja, o arquivo com uma microbase aparentemente n√£o √© muito micro e n√£o se encaixa no nosso objeto.  A mem√≥ria alocada para ele n√£o era suficiente.  Sol√∫vel?  Claro.  A plataforma de dados IRIS permite criar objetos de at√© 4 TB na RAM.  Ent√£o o que deu errado?  Por padr√£o, as configura√ß√µes do sistema s√£o definidas para 256 MB por objeto.  E precisar√≠amos de muito mais.  E lembre-se, esses s√£o requisitos de RAM.  Existe estoque suficiente no seu computador / servidor? </blockquote>  Qual o tamanho da mem√≥ria que precisamos para instalar este gigante que instalamos empiricamente - quase 10 GB.  O que voc√™ precisa especificar nas configura√ß√µes (Menu&gt; Configurar mem√≥ria&gt; Mem√≥ria m√°xima por processo (KB)) ou atrav√©s da <a href="">vari√°vel de sistema $ ZSTORAGE</a> (em kilobytes): <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=10000000</code> </pre> <br>  Lan√ßou um novo processo com as configura√ß√µes de mem√≥ria necess√°rias?  Ent√£o tudo √© mais simples - lemos e salvamos. <br><br>  Existe uma op√ß√£o alternativa (e provavelmente preferida) - <a href="">use a propriedade</a> UsePPGHandler da classe% XML.Reader que permite que voc√™ n√£o armazene XML na mem√≥ria e trabalhe com configura√ß√µes de mem√≥ria padr√£o. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre> <br>  mais ... Correlate / Read, etc.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre> <br>  E assim 3.722.548 vezes para cada opera√ß√£o :-) <br><br>  Isso √© cansativo.  Portanto, complementamos nossa classe FIAS.AddressObject com um m√©todo de importa√ß√£o, com base nos comandos mostrados: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { //     XML Set reader = ##class(%XML.Reader).%New() //   XML   Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} //       Do reader.Correlate("Object","FIAS.AddressObject") //       While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } //      ,   If $$$ISERR(status) {Do $System.Status.DisplayError(status)} }</code> </pre> <br>  Vamos usar o poder do exoc√≥rtex do computador - apenas um comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre> <br><img src="https://habrastorage.org/webt/bd/mh/t7/bdmht7k0urpyo07qcdcmkj5_nym.gif"><br><br>  Pe√ßo a todos para a mesa.  Havia MCD, e agora o prato pronto na forma de um global com os nomes verificados de cidades e pesos russos est√° pronto. <br><br><img src="https://habrastorage.org/webt/1u/he/a6/1uhea6bdexgrpwlfpmtn2b2gdyy.png"><br><br>  E, finalmente, algumas palavras sobre quando 4 TB n√£o √© suficiente.  Nesse caso, <a href="">seguimos os fluxos</a> (ou fluxos, se desejar).  A documenta√ß√£o √© apresentada nas prateleiras.  Voc√™ pode bin√°rio, voc√™ pode simb√≥lico.  Loja no global tamb√©m n√£o √© proibida.  A receita √© a seguinte: pegamos uma corrente, cortamos em partes e entregamos aos objetos que precisamos para o consumo. <br><br>  Al√©m disso, sobre belos objetos ObjectScript endere√ß√°veis ‚Äã‚Äãe APIs em Python n√£o se encaixavam.  Haver√° uma hist√≥ria separada. <br><blockquote>  Agrad√°vel: o Gartner acaba de concluir a cole√ß√£o anual de classifica√ß√µes e avalia√ß√µes reais de usu√°rios na categoria DBMS e, com base nisso, publicou sua classifica√ß√£o dos melhores DBMS de 2019.  Os produtos InterSystems Cach√© e InterSystems IRIS Data Platform receberam a mais alta classifica√ß√£o de escolha do consumidor.  De quem voc√™ escolheu e como avaliou, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">voc√™ mesmo pode dar uma olhada</a> . </blockquote>  Melhor Software de Sistemas Operacionais de Gerenciamento de Banco de Dados de 2019, conforme revisto pelos clientes <br><br><img src="https://habrastorage.org/webt/gw/jg/dd/gwjgdd1segqlvnnpfzgo9buww4y.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438062/">https://habr.com/ru/post/pt438062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438044/index.html">Hello World Analysis</a></li>
<li><a href="../pt438048/index.html">Removemos recursos e produtos desnecess√°rios para melhorar os neg√≥cios.</a></li>
<li><a href="../pt438052/index.html">Interator, Padr√£o de Opera√ß√£o</a></li>
<li><a href="../pt438058/index.html">"An√°lise de dados em Python" em duas partes</a></li>
<li><a href="../pt438060/index.html">Estimativa da orienta√ß√£o espacial ou Como n√£o ter medo dos filtros Mahoney e Majwik</a></li>
<li><a href="../pt438064/index.html">Lista de verifica√ß√£o: o que precisava ser feito antes de iniciar os microsservi√ßos no prod</a></li>
<li><a href="../pt438066/index.html">10 canais educacionais do YouTube em ingl√™s dos quais voc√™ nunca ouviu falar</a></li>
<li><a href="../pt438070/index.html">Como a gera√ß√£o Y se transformou em uma gera√ß√£o esgotada?</a></li>
<li><a href="../pt438074/index.html">[An√∫ncio para Ecaterimburgo, Novosibirsk, S√£o Petersburgo] QSess√£o de teste de automa√ß√£o: cobriremos tudo, desde o Neva ao Ob, com testes</a></li>
<li><a href="../pt438078/index.html">O Facebook paga US $ 20 por m√™s para configurar sua pseudo-VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>