<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📫 🧘🏾 👨🏽‍🏫 Meu endereço não é uma casa ou rua, meu endereço é a União Soviética? 🧜🏻 📿 👩🏽‍🤝‍👨🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="microBIGDATA ou FIAS no seu bolso 


 Peter Brueghel, o Jovem, Pagamento de Impostos , 1640 

 A última entrada no barbeador nos objetos foi. Continua...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meu endereço não é uma casa ou rua, meu endereço é a União Soviética?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438062/"> <b>microBIGDATA ou FIAS no seu bolso</b> <br><br><img src="https://habrastorage.org/webt/gq/le/vh/gqlevhij14f0jkubb4pmbjwvb5u.jpeg"><br>  <i>Peter Brueghel, o Jovem, <b>Pagamento de Impostos</b> , 1640</i> <br><br>  A última entrada no barbeador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">nos objetos</a> foi.  Continuaremos o reconhecimento em batalha.  Hoje vamos falar sobre o difícil.  Ainda não se trata de BIG DATA, mas já é inconveniente trabalhar - grandes quantidades de dados.  Nem todos cabem em toda a RAM, mas alguns nem cabem no disco (não há espaço suficiente, mas muito lixo).  O nome do nosso <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">banco de dados FIAS de</a> confiança é o banco de dados do sistema de informações de endereço federal.  Arquivo de 5,5 GB.  E é compactado em um arquivo XML.  Após descompactar, haverá 53 GB completos (armazene 110 GB para descompactar).  E quando você começa a analisá-lo e convertê-lo, 110 GB não serão suficientes.  Sobre a quantidade necessária de RAM também será. <br><a name="habracut"></a><br>  Tudo ficaria bem, mas você pode ir além.  Existe um projeto internacional de coleta e sistematização de dados de código aberto - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OpenAddresses</a> .  Portanto, haverá mais bancos de dados.  A cobertura atual do planeta tem muitas manchas brancas, por exemplo, a Rússia está quase ausente.  O tamanho do arquivo é de 10 GB. <br><br>  Ou um banco de dados de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">projeto OpenStreetMaps</a> bastante conhecido.  É construído por voluntários com base na Wikipedia.  Muito detalhado e multilíngue.  Agora, um arquivo completo de XML compactado com um tamanho de 74 GB. <br><blockquote>  Se eles começaram a falar sobre endereços, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">chegaram notícias</a> inesperadas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do DuckDuckGo</a> , o melhor mecanismo de pesquisa seguro de hoje, sobre sua transição para os cartões da Apple.  Mais precisamente no Apple MapKit JS.  A característica mais interessante em nosso contexto é a "busca aprimorada de endereços".  A Apple é a melhor coletiva e proteção cuidadosa de nossos dados?  Será necessário rastrear ... </blockquote>  Então o desafio.  Como colocar toda essa riqueza de endereços em um repositório agradável para uso, para permitir que você sonhe com uma API gratuita (em Python, é claro) e para não deixar seu querido ferro engasgar com uma carga não lida.  Vamos chamá-lo de MicroBigData - mcBD ou μBG em inglês :-) <br><br>  Na economia de cada segundo (ou mesmo do primeiro) desenvolvedor, esse é um diretório de endereços, também é um diretório de topônimos, algo muito necessário.  E quando também é normativo, preparado, limpo e bem documentado pelo corpo certo, é apenas um conto de fadas.  Devemos prestar homenagem, o serviço fiscal russo está fazendo bem sua produção digital.  Tanto quanto possível.  Provavelmente existem algumas falhas no interior e a limpeza dos dados continua.  Como resolver esse problema, deixe os chefes de Estado pensarem.  Eles decidem por nós mesmos e pelo benefício de todos nós.  A propósito, um erro de digitação do FIAS foi encontrado no exemplo abaixo.  O resultado não é afetado.  Eu não consertei.  Você vai encontrar? <br><br>  Não sei até que ponto os dados de endereço são relevantes em seus projetos - todas são regiões, cidades, ruas.  Mas parece que nem um único projeto para as pessoas pode prescindir delas.  Esse é o endereço para onde procurar uma pessoa ou para onde enviar encomendas para ela.  Os detalhes do passaporte ou qualquer outro documento devem ser salvos.  Ou talvez seja o endereço do escritório ou das atrações que você recomenda visitar.  E o que fazer?  Onde obter <br><br>  A solução mais simples, sem considerar erros e duplicatas, são objetos primitivos que contêm literais simples de cadeia de caracteres (são constantes de cadeia, também são cadeias de caracteres).  Permita que os usuários insiram as próximas entradas recebidas neles.  E os objetos são capazes de se salvar - já <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">passamos por isso</a> . <br><br>  Tais objetos são, por exemplo, conforme descrito na classe abaixo.  <a href="">Diretamente do livro</a> , embora americano, mas ajustado à nossa realidade russa - em vez de seu CEP, haverá o nosso código postal.  Eu também substituiria o CEP por um número, mas por uma questão de monotonia, deixo uma string.  Qualquer pessoa que reconheça imediatamente uma linguagem, e este é o ObjectScript, tem direito a um incentivo semelhante. <br><br><pre><code class="plaintext hljs">Class Soviet.Address Extends %Persistent { Property streetName As %String; Property cityName As %String; Property areaName As %String; Property postalCode As %String; }</code> </pre> <br>  É claro que muitos ficarão indignados, dizem que tudo está saindo dos bolsos do objeto (literais).  Onde foi visto, para que o objeto brilhe publicamente seus campos ?!  Vamos deixar assim, dói também um exemplo eloqüente e é compreensível para qualquer aluno. <br><br>  Isso é realmente tudo o que é necessário.  Preenchido os campos.  Coloque em armazenamento.  Transferido para outros objetos para o trabalho.  Herdado ainda mais por alguém.  Tudo funciona.  E armazenado! <br><blockquote>  Mas algumas palavras por que não vale a pena fazer isso, é preciso dizer.  Qual é o nosso endereço de objeto?  Por que não pode ser apenas um grupo de cadeias de texto?  As objeções mais óbvias que vêm à mente vêm do contexto - quem usa este endereço, de que forma e com que finalidade?  Tente deixar de lado seu pensamento de programação e imagine como um “turista estrangeiro”, “historiador”, “inspetor de impostos”, “advogado” e assim por diante pensam. <br><br>  Creio que imediatamente surgem uma série de perguntas e esclarecimentos adicionais: que idioma usar, em que codificação armazenar e fornecer, em que época classificar, quais documentos são efetivados, legais ou postais?  Uma cidade é um assentamento ou o quê?  Mesmo uma rua pode se transformar em uma avenida, uma rua lateral, avenida ou outra coisa.  O que fazer com todos esses detalhes importantes de implementação? <br><br>  Tome um exemplo vivo.  O Google agora é gerenciado por Sundar Pichai.  Ele próprio é da Índia.  Nascido na cidade de Chennai (também conhecido como Chennai).  Ou em Madras?  Em 1996, os índios decidiram que o nome da cidade era muito português e renomearam a capital de Tamil Nadu, de Madras para Chennai.  E o que Sundar e 72 milhões de seus compatriotas devem escrever em seus documentos eletrônicos? <br><br>  Em geral, toda a ciência lida com isso - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">toponímia aplicada</a> . </blockquote>  Então as perguntas imploram.  Como lidar com <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">hora e data</a> ?  O <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dinheiro</a> é tão <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">óbvio</a> ?  As coordenadas geográficas são tão simples?  E como isso é implementado no seu código?  Você pode transferir para o DBMS selecionado sem diminuir o nível de abstração?  Como não entrar nos tipos atômicos de dados da máquina e pensar constantemente em sua reconstrução?  Aqui, vale a pena procurar a fonte de uma API primitiva ou, inversamente, sólida.  Pense nisso à vontade. <br><br>  Em resumo, o contexto é o mais importante.  E o modelo de objeto nos dá a oportunidade de usá-lo diretamente, encapsulando “dados da máquina” e implementando um comportamento “ativo” sensível ao contexto.  Nem todas as tuplas de baixo nível dispostas nas tabelas ;-) <br><br>  Enquanto isso, voltemos à implementação "primitiva" e complicamos nossas vidas.  Para começar, elimine erros e duplicatas.  Ou seja, procuraremos uma maneira de escrever endereços imediatamente.  Ao mesmo tempo, ajudaremos os desenvolvedores da interface do usuário a organizar dicas para os usuários ao preencher os campos de entrada de dados. <br><blockquote>  Quando duas pessoas se reúnem em um só lugar - textos e a plataforma de dados InterSystems IRIS, o desenvolvedor tem uma oportunidade real de implantar ao máximo sem sair da máquina.  Por exemplo, usando os <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">componentes de objeto internos iKnow e iFind</a> .  Esses são componentes para trabalhar com dados não estruturados e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pesquisa de texto completo</a> , respectivamente.  O russo é suportado "pronto para uso". </blockquote>  Primeiramente, ensinaremos o Endereço a ler os dados necessários da fonte original.  Felizmente, o conjunto de dados do serviço tributário federal possui descrições prontas da estrutura dos documentos XML.  De acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">descrição</a> anexada aos dados <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">do site do FIAS</a> , precisamos do conjunto de dados ADDROBJ, que, no meu caso, corresponde ao arquivo AS_ADDROBJ_2_250_01_04_01_01.xsd <br><br>  Em seguida, usaremos o conversor do sistema do modelo XSD na estrutura de campo correspondente da classe% XML.Adaptor, gentilmente preparada para nós pelos desenvolvedores do IRIS.  O sinal de porcentagem no início significa apenas que essa é uma classe da biblioteca do sistema.  <a href="">Detalhes de uso estão na documentação</a> .  Vamos realizar operações no terminal. <br><br><pre> <code class="plaintext hljs">set xmlScheme = ##class(%XML.Utils.SchemaReader).%New() do xmlScheme.Process("http://localhost/AS_ADDROBJ_2_250_01_04_01_01.xsd")</code> </pre> <br>  O mesmo pode ser obtido no <a href="">Atelier IDE</a> (no menu Ferramentas&gt; Suplementos&gt; Assistente de Esquema XML) ou por solicitações semelhantes a objetos diretamente do código do programa. <br><br><img src="https://habrastorage.org/webt/ed/3k/8c/ed3k8cfd9t_jc8gklg_euthhihy.png"><br><br>  Como usamos o construtor sem especificar os parâmetros, ou seja, o nome do pacote para colocar as classes resultantes, elas terminaram no pacote de teste.  Como você pode ver no segundo comando, eu dei o arquivo de esquema através do meu servidor web local em Python: <br><br><pre> <code class="bash hljs">python3 -m http.server 80</code> </pre> <br>  Você pode usar qualquer outro servidor http que desejar.  Ou faça o upload do arquivo para o servidor IRIS e indique o caminho direto para ele. <br><br>  Como resultado, temos duas classes que refletem completamente a estrutura do nosso XML endereçável: <br><br><div class="spoiler">  <b class="spoiler_title">Test.AddressObjects</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///            Class Test.AddressObjects Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "AddressObjects"; Parameter XMLSEQUENCE = 1; ///    Relationship Object As Test.Object(XMLNAME = "Object", XMLPROJECTION = "ELEMENT") [ Cardinality = many, Inverse = AddressObjects ]; }</code> </pre> <br></div></div><div class="spoiler">  <b class="spoiler_title">Test.object</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">///  : http://localhost:28869/AS_ADDROBJ_2_250_01_04_01_01.xsd Class Test.Object Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property FORMALNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "FORMALNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property REGIONCODE As %String(MAXLEN = 2, MINLEN = 2, XMLNAME = "REGIONCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AUTOCODE As %String(MAXLEN = 1, MINLEN = 1, XMLNAME = "AUTOCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property AREACODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "AREACODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property CITYCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CITYCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property CTARCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "CTARCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property PLACECODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "PLACECODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property PLANCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "PLANCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property STREETCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "STREETCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property EXTRCODE As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "EXTRCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property SEXTCODE As %String(MAXLEN = 3, MINLEN = 3, XMLNAME = "SEXTCODE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSFL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSFL", XMLPROJECTION = "ATTRIBUTE"); ///    Property IFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "IFNSUL", XMLPROJECTION = "ATTRIBUTE"); ///      Property TERRIFNSUL As %String(MAXLEN = 4, MINLEN = 4, XMLNAME = "TERRIFNSUL", XMLPROJECTION = "ATTRIBUTE"); /// OKATO Property OKATO As %String(MAXLEN = 11, MINLEN = 11, XMLNAME = "OKATO", XMLPROJECTION = "ATTRIBUTE"); /// OKTMO Property OKTMO As %String(MAXLEN = 11, MINLEN = 8, XMLNAME = "OKTMO", XMLPROJECTION = "ATTRIBUTE"); ///    Property UPDATEDATE As %Date(XMLNAME = "UPDATEDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///        Property PREVID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PREVID", XMLPROJECTION = "ATTRIBUTE"); ///        Property NEXTID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NEXTID", XMLPROJECTION = "ATTRIBUTE"); ///           4.0. Property CODE As %String(MAXLEN = 17, MINLEN = 0, XMLNAME = "CODE", XMLPROJECTION = "ATTRIBUTE"); ///      4.0      (  ) Property PLAINCODE As %String(MAXLEN = 15, MINLEN = 0, XMLNAME = "PLAINCODE", XMLPROJECTION = "ATTRIBUTE"); ///     .     .      . /// 0 –   /// 1 -  Property ACTSTATUS As %Integer(XMLNAME = "ACTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///   Property CENTSTATUS As %Integer(XMLNAME = "CENTSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     –    (.   OperationStatus): /// 01 – ; /// 10 – ; /// 20 – ; /// 21 –  ; /// 30 – ; /// 31 -     ; /// 40 –    (); /// 41 –     ; /// 42 -        ; /// 43 -         ; /// 50 – ; /// 51 –     ; /// 60 –    ; /// 61 –        Property OPERSTATUS As %Integer(XMLNAME = "OPERSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    4 (    ) Property CURRSTATUS As %Integer(XMLNAME = "CURRSTATUS", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///    Property STARTDATE As %Date(XMLNAME = "STARTDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property ENDDATE As %Date(XMLNAME = "ENDDATE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///      Property NORMDOC As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "NORMDOC", XMLPROJECTION = "ATTRIBUTE"); ///     Property LIVESTATUS As %xsd.byte(VALUELIST = ",0,1", XMLNAME = "LIVESTATUS", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///  : /// 0 -   /// 1 - ; /// 2 - - Property DIVTYPE As %xsd.int(VALUELIST = ",0,1,2", XMLNAME = "DIVTYPE", XMLPROJECTION = "ATTRIBUTE") [ Required ]; Relationship AddressObjects As Test.AddressObjects(XMLPROJECTION = "NONE") [ Cardinality = one, Inverse = Object ]; }</code> </pre> <br></div></div><br>  De toda a lista de arquivos xml no FIAS, usaremos apenas um arquivo com os nomes de regiões, cidades e ruas.  No momento da preparação da publicação, eu tinha o seguinte: <br>  AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML <br><br>  O tamanho do arquivo não é grande nem pequeno, mas quase 3 GB.  Você não o abrirá com ferramentas de texto comuns - elas não digerem esse tamanho. <br><blockquote>  A propósito, o comprimento máximo de uma string literal (tipo String) no InterSystems IRIS não passa de 3.641.144 caracteres.  Ou seja, o download do arquivo diretamente ou a URL nele falhará.  Outras restrições podem ser encontradas <a href="">na documentação</a> .  Para trabalhar com grandes volumes de dados, você pode usar fluxos de dados (fluxos) que não possuem um limite de tamanho. </blockquote>  Vamos ver o que temos? <br><br>  Cozinhar FIAS pimenta recheada.  Esta é apenas uma preparação para um futuro maravilhoso.  Primeiro, obtemos o conjunto mínimo inicial.  Precisamos apenas destes ingredientes: <br><br><pre> <code class="plaintext hljs">Class FIAS.AddressObject Extends (%Persistent, %XML.Adaptor) [ ProcedureBlock ] { Parameter XMLNAME = "Object"; Parameter XMLSEQUENCE = 1; ///      Property AOGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOGUID", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///   Property OFFNAME As %String(MAXLEN = 120, MINLEN = 1, XMLNAME = "OFFNAME", XMLPROJECTION = "ATTRIBUTE"); ///   Property POSTALCODE As %String(MAXLEN = 6, MINLEN = 6, XMLNAME = "POSTALCODE", XMLPROJECTION = "ATTRIBUTE"); ///     Property SHORTNAME As %String(MAXLEN = 10, MINLEN = 1, XMLNAME = "SHORTNAME", XMLPROJECTION = "ATTRIBUTE") [ Required ]; ///    Property AOLEVEL As %Integer(XMLNAME = "AOLEVEL", XMLPROJECTION = "ATTRIBUTE", XMLTotalDigits = 10) [ Required ]; ///     Property PARENTGUID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "PARENTGUID", XMLPROJECTION = "ATTRIBUTE"); ///   .  . Property AOID As %String(MAXLEN = 36, MINLEN = 36, XMLNAME = "AOID", XMLPROJECTION = "ATTRIBUTE") [ Required ];</code> </pre><br>  Em seguida, <a href="https://docs.intersystems.com/irislatest/csp/docbook/DocBook.UI.Page.cls?KEY=GXML_import#GXML_import_">escreva</a> .  Criamos um objeto que entende XML como nativo - usamos uma classe da biblioteca de sistema% XML.Reader: <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New()</code> </pre> <br>  E damos-lhe instruções a quem levar e ignoramos o resto.  Tomaremos uma porção: <br><br><pre> <code class="plaintext hljs">do reader.Correlate("Object","FIAS.AddressObject")</code> </pre> <br>  Depois, há variações sobre como obter o arquivo microbd original.  Se for conveniente, você pode colocá-lo ao lado do repositório - localmente no sistema de arquivos do servidor IRIS.  Ou, como no meu exemplo, peça para enviar via HTTP.  Existe uma opção ainda mais universal, sobre a qual haverá algumas palavras abaixo. <br><br><pre> <code class="plaintext hljs">set url="http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML" write reader.OpenUrl(url)</code> </pre> <br><blockquote>  Importante!  Neste momento, a maioria que passará esse exemplo para si terá uma coisa terrível.  O sistema retornará em vez do alegre "1" (tudo está em ordem), algo começando com "0 ¸ STORE ...".  E não vai agradar.  Ou seja, o arquivo com uma microbase aparentemente não é muito micro e não se encaixa no nosso objeto.  A memória alocada para ele não era suficiente.  Solúvel?  Claro.  A plataforma de dados IRIS permite criar objetos de até 4 TB na RAM.  Então o que deu errado?  Por padrão, as configurações do sistema são definidas para 256 MB por objeto.  E precisaríamos de muito mais.  E lembre-se, esses são requisitos de RAM.  Existe estoque suficiente no seu computador / servidor? </blockquote>  Qual o tamanho da memória que precisamos para instalar este gigante que instalamos empiricamente - quase 10 GB.  O que você precisa especificar nas configurações (Menu&gt; Configurar memória&gt; Memória máxima por processo (KB)) ou através da <a href="">variável de sistema $ ZSTORAGE</a> (em kilobytes): <br><br><pre> <code class="plaintext hljs">set $ZSTORAGE=10000000</code> </pre> <br>  Lançou um novo processo com as configurações de memória necessárias?  Então tudo é mais simples - lemos e salvamos. <br><br>  Existe uma opção alternativa (e provavelmente preferida) - <a href="">use a propriedade</a> UsePPGHandler da classe% XML.Reader que permite que você não armazene XML na memória e trabalhe com configurações de memória padrão. <br><br><pre> <code class="plaintext hljs">set reader = ##class(%XML.Reader).%New() set reader.UsePPGHandler = 1</code> </pre> <br>  mais ... Correlate / Read, etc.  ... <br><br><pre> <code class="plaintext hljs">do reader.Next(.object) do object.%Save()</code> </pre> <br>  E assim 3.722.548 vezes para cada operação :-) <br><br>  Isso é cansativo.  Portanto, complementamos nossa classe FIAS.AddressObject com um método de importação, com base nos comandos mostrados: <br><br><pre> <code class="plaintext hljs">ClassMethod Import() { //     XML Set reader = ##class(%XML.Reader).%New() //   XML   Set status = reader.OpenURL("http://localhost/AS_ADDROBJ_20190106_90809714-fe22-45b2-929c-52bd950963e0.XML") If $$$ISERR(status) {Do $System.Status.DisplayError(status)} //       Do reader.Correlate("Object","FIAS.AddressObject") //       While (reader.Next(.object,.status)) { Set status = object.%Save() If $$$ISERR(status) {do $System.Status.DisplayError(status)} } //      ,   If $$$ISERR(status) {Do $System.Status.DisplayError(status)} }</code> </pre> <br>  Vamos usar o poder do exocórtex do computador - apenas um comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">no terminal</a> : <br><br><pre> <code class="plaintext hljs">do ##class(FIAS.AddressObject).Import()</code> </pre> <br><img src="https://habrastorage.org/webt/bd/mh/t7/bdmht7k0urpyo07qcdcmkj5_nym.gif"><br><br>  Peço a todos para a mesa.  Havia MCD, e agora o prato pronto na forma de um global com os nomes verificados de cidades e pesos russos está pronto. <br><br><img src="https://habrastorage.org/webt/1u/he/a6/1uhea6bdexgrpwlfpmtn2b2gdyy.png"><br><br>  E, finalmente, algumas palavras sobre quando 4 TB não é suficiente.  Nesse caso, <a href="">seguimos os fluxos</a> (ou fluxos, se desejar).  A documentação é apresentada nas prateleiras.  Você pode binário, você pode simbólico.  Loja no global também não é proibida.  A receita é a seguinte: pegamos uma corrente, cortamos em partes e entregamos aos objetos que precisamos para o consumo. <br><br>  Além disso, sobre belos objetos ObjectScript endereçáveis ​​e APIs em Python não se encaixavam.  Haverá uma história separada. <br><blockquote>  Agradável: o Gartner acaba de concluir a coleção anual de classificações e avaliações reais de usuários na categoria DBMS e, com base nisso, publicou sua classificação dos melhores DBMS de 2019.  Os produtos InterSystems Caché e InterSystems IRIS Data Platform receberam a mais alta classificação de escolha do consumidor.  De quem você escolheu e como avaliou, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">você mesmo pode dar uma olhada</a> . </blockquote>  Melhor Software de Sistemas Operacionais de Gerenciamento de Banco de Dados de 2019, conforme revisto pelos clientes <br><br><img src="https://habrastorage.org/webt/gw/jg/dd/gwjgdd1segqlvnnpfzgo9buww4y.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt438062/">https://habr.com/ru/post/pt438062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt438044/index.html">Hello World Analysis</a></li>
<li><a href="../pt438048/index.html">Removemos recursos e produtos desnecessários para melhorar os negócios.</a></li>
<li><a href="../pt438052/index.html">Interator, Padrão de Operação</a></li>
<li><a href="../pt438058/index.html">"Análise de dados em Python" em duas partes</a></li>
<li><a href="../pt438060/index.html">Estimativa da orientação espacial ou Como não ter medo dos filtros Mahoney e Majwik</a></li>
<li><a href="../pt438064/index.html">Lista de verificação: o que precisava ser feito antes de iniciar os microsserviços no prod</a></li>
<li><a href="../pt438066/index.html">10 canais educacionais do YouTube em inglês dos quais você nunca ouviu falar</a></li>
<li><a href="../pt438070/index.html">Como a geração Y se transformou em uma geração esgotada?</a></li>
<li><a href="../pt438074/index.html">[Anúncio para Ecaterimburgo, Novosibirsk, São Petersburgo] QSessão de teste de automação: cobriremos tudo, desde o Neva ao Ob, com testes</a></li>
<li><a href="../pt438078/index.html">O Facebook paga US $ 20 por mês para configurar sua pseudo-VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>