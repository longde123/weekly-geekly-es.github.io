<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úçüèæ ü§±üèª üßòüèΩ DDoS pour aider: comment nous menons le stress et les tests de stress üëèüèΩ üôè üò∞</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Variti d√©veloppe une protection contre les robots et les attaques DDoS, et effectue √©galement des tests de stress et de charge. Lors de la conf√©rence ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>DDoS pour aider: comment nous menons le stress et les tests de stress</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/variti/blog/448626/"><img src="https://habrastorage.org/webt/ze/th/rb/zethrbwkfxc_3voyzfevkonnzao.png"><br><br>  <i>Variti d√©veloppe une protection contre les robots et les attaques DDoS, et effectue √©galement des tests de stress et de charge.</i>  <i>Lors de la conf√©rence HighLoad ++ 2018, nous avons expliqu√© comment s√©curiser les ressources contre diff√©rents types d'attaques.</i>  <i>En bref: isoler des parties du syst√®me, utiliser les services cloud et CDN et mettre √† jour r√©guli√®rement.</i>  <i>Mais sans entreprises sp√©cialis√©es, une protection que vous ne pouvez toujours pas faire :)</i> <br><a name="habracut"></a><br>  Avant de lire le texte, vous pouvez vous familiariser avec de courts r√©sum√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">sur le site Web de la conf√©rence</a> . <br>  Et si vous n'aimez pas lire ou souhaitez simplement regarder une vid√©o, l'enregistrement de notre reportage est ci-dessous sous le spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Signaler la vid√©o</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/Lu4tsUvfYRc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div><br>  De nombreuses entreprises savent d√©j√† faire des tests de r√©sistance, mais toutes ne le font pas.  Certains de nos clients pensent que leur site est invuln√©rable car ils disposent d'un syst√®me √† haute charge et il prot√®ge contre les attaques.  Nous montrons que ce n'est pas enti√®rement vrai. <br><br>  Bien s√ªr, avant d'effectuer les tests, nous obtenons l'autorisation du client, sign√©e et tamponn√©e, et avec notre aide, nous ne pouvons pas attaquer DDoS contre qui que ce soit.  Les tests sont effectu√©s √† l'heure choisie par le client, lorsque la fr√©quentation de sa ressource est minimale, et les probl√®mes d'acc√®s n'affecteront pas les clients.  De plus, √©tant donn√© que quelque chose peut toujours mal tourner pendant le processus de test, nous avons un contact constant avec le client.  Cela permet non seulement de rendre compte des r√©sultats obtenus, mais aussi de changer quelque chose pendant le test.  A l'issue des tests, nous √©tablissons toujours un rapport dans lequel nous signalons les failles d√©couvertes et formulons des recommandations pour √©liminer les faiblesses du site. <br><br><h3>  Comment travaillons-nous </h3><br>  Pendant les tests, nous √©mulons un botnet.  Puisque nous travaillons avec des clients qui ne sont pas situ√©s dans nos r√©seaux, afin d'emp√™cher le test de se terminer dans la premi√®re minute en raison du d√©clenchement de limites ou de protection, nous chargeons la charge non pas √† partir d'une IP, mais √† partir de notre propre sous-r√©seau.  De plus, pour cr√©er une charge importante, nous avons notre propre serveur de test plut√¥t puissant. <br><br><h3>  Postulats </h3><br><blockquote>  <b>Beaucoup n'est pas bon</b> <br><br>  Moins nous pouvons amener la ressource √† l'√©chec, mieux c'est.  Si vous parvenez √† faire en sorte que le site cesse de fonctionner √† partir d'une demande par seconde, voire d'une demande par minute, √ßa va.  Parce que selon la loi de la m√©chancet√©, les utilisateurs ou les attaquants tombent accidentellement dans cette vuln√©rabilit√©. </blockquote><blockquote> <b>Une d√©faillance partielle vaut mieux qu'une d√©faillance compl√®te</b> <br><br>  Nous conseillons toujours de rendre les syst√®mes h√©t√©rog√®nes.  De plus, il vaut la peine de les s√©parer au niveau physique, et pas seulement de la conteneurisation.  Dans le cas d'une s√©paration physique, m√™me si quelque chose √©choue sur le site, il est probable que cela ne s'arr√™tera pas compl√®tement, et les utilisateurs auront toujours acc√®s √† au moins une partie de la fonctionnalit√©. </blockquote><blockquote>  <b>Une architecture appropri√©e est le fondement de la durabilit√©</b> <br><br>  La tol√©rance aux pannes d'une ressource et sa capacit√© √† r√©sister aux attaques et aux charges doivent √™tre d√©finies au stade de la conception, en fait, au stade du dessin des premiers sch√©mas fonctionnels dans un cahier.  Parce que si des erreurs fatales se glissent, vous pouvez les corriger √† l'avenir, mais c'est tr√®s difficile. </blockquote><blockquote>  <b>Non seulement le code devrait √™tre bon, mais aussi une config</b> <br><br>  Beaucoup de gens pensent qu'une bonne √©quipe de d√©veloppement est une garantie de r√©silience du service.  Une bonne √©quipe de d√©veloppement est vraiment n√©cessaire, mais il doit aussi y avoir un bon fonctionnement, de bons DevOps.  Autrement dit, nous avons besoin de sp√©cialistes qui configurent correctement Linux et le r√©seau, √©crivent correctement les configurations dans nginx, configurent les limites et plus encore.  Sinon, la ressource ne fonctionnera bien que sur le test, et en production √† un moment donn√©, tout se cassera. </blockquote><blockquote>  <b>Diff√©rences entre le stress et les tests de r√©sistance</b> <br><br>  Les tests de charge vous permettent d'identifier les limites du syst√®me.  Les tests de r√©sistance visent √† d√©tecter les faiblesses du syst√®me et sont utilis√©s pour casser ce syst√®me et voir comment il se comportera en cas de d√©faillance de certaines pi√®ces.  Dans le m√™me temps, la nature de la charge reste g√©n√©ralement inconnue du client jusqu'au d√©but des tests de r√©sistance. </blockquote><h3>  Caract√©ristiques distinctives des attaques L7 </h3><br>  Nous divisons g√©n√©ralement les types de charges en charges au niveau de L7 et L3 &amp; 4.  L7 est une charge au niveau de l'application, le plus souvent, elle est uniquement comprise comme HTTP, mais nous entendons toute charge au niveau du protocole TCP. <br><br>  Les attaques L7 ont certaines caract√©ristiques distinctives.  Premi√®rement, ils arrivent directement √† l'application, c'est-√†-dire qu'il est peu probable qu'ils puissent √™tre refl√©t√©s par des moyens r√©seau.  De telles attaques utilisent la logique et, de ce fait, elles consomment le processeur, la m√©moire, le disque, la base de donn√©es et d'autres ressources tr√®s efficacement et avec peu de trafic. <br><br><h3>  D√©luge HTTP </h3><br>  Dans le cas d'une attaque, la charge est plus facile √† cr√©er qu'√† g√©rer, et dans le cas de L7, cela est √©galement vrai.  Le trafic d'attaque n'est pas toujours facile √† distinguer de l√©gitime, et le plus souvent il peut √™tre fait par fr√©quence, mais si tout est correctement planifi√©, alors il est impossible de comprendre o√π est l'attaque et o√π les demandes l√©gitimes proviennent des journaux. <br><br>  Comme premier exemple, consid√©rons une attaque HTTP Flood.  Le graphique montre que de telles attaques sont g√©n√©ralement tr√®s puissantes, dans l'exemple ci-dessous, le nombre maximal de demandes d√©passait 600 000 par minute. <br><br><img src="https://habrastorage.org/webt/rl/-i/qz/rl-iqze06e8bg4epyzgcsfpwddu.png"><br><br>  HTTP Flood est le moyen le plus simple de cr√©er une charge.  Habituellement, une sorte d'outil de test de charge est utilis√©e pour cela, par exemple, ApacheBench, et la demande et le but sont d√©finis.  Avec une approche aussi simple, il est susceptible de se heurter √† la mise en cache du serveur, mais il est facile de se d√©placer.  Par exemple, l'ajout de lignes al√©atoires √† la requ√™te, ce qui oblige le serveur √† donner constamment une nouvelle page. <br>  N'oubliez pas non plus l'agent utilisateur dans le processus de cr√©ation d'une charge.  De nombreux agents utilisateurs des outils de test populaires sont filtr√©s par les administrateurs syst√®me et, dans ce cas, la charge peut tout simplement ne pas atteindre le backend.  Vous pouvez am√©liorer consid√©rablement le r√©sultat en ins√©rant un en-t√™te plus ou moins valide du navigateur dans la demande. <br>  Pour toute sa simplicit√©, les attaques HTTP Flood ont leurs inconv√©nients.  Premi√®rement, de grandes capacit√©s sont n√©cessaires pour cr√©er une charge.  Deuxi√®mement, de telles attaques sont tr√®s faciles √† d√©tecter, surtout si elles proviennent de la m√™me adresse.  En cons√©quence, les demandes commencent imm√©diatement √† √™tre filtr√©es soit par les administrateurs syst√®me, soit m√™me au niveau du fournisseur. <br><br><h3>  Que chercher </h3><br>  Pour r√©duire le nombre de demandes par seconde et ne pas perdre en efficacit√©, il faut faire preuve d'un peu d'imagination et explorer le site.  Ainsi, vous pouvez charger non seulement le canal ou le serveur, mais √©galement des parties individuelles de l'application, par exemple, des bases de donn√©es ou des syst√®mes de fichiers.  Vous pouvez √©galement rechercher des emplacements sur le site qui font de grands calculs: calculatrices, pages de s√©lection de produits, etc.  Enfin, il arrive souvent qu'il existe sur le site un script php qui g√©n√®re une page de plusieurs centaines de milliers de lignes.  Un tel script charge √©galement fortement le serveur et peut devenir une cible d'attaque. <br><br><h3>  O√π chercher </h3><br>  Lorsque nous analysons une ressource avant de tester, nous examinons tout d'abord, bien s√ªr, le site lui-m√™me.  Nous recherchons toutes sortes de champs de saisie, des fichiers lourds - en g√©n√©ral, tout ce qui peut cr√©er des probl√®mes pour une ressource et ralentir son fonctionnement.  Ici, les outils de d√©veloppement courants de Google Chrome et Firefox permettent d'afficher le temps de r√©ponse de la page. <br><br>  Nous analysons √©galement les sous-domaines.  Par exemple, il existe une certaine boutique en ligne, abc.com, et elle a un sous-domaine admin.abc.com.  Il s'agit tr√®s probablement du panneau d'administration avec autorisation, mais si vous y mettez une charge, cela peut cr√©er des probl√®mes pour la ressource principale. <br><br>  Le site peut avoir un sous-domaine api.abc.com.  Il s'agit tr√®s probablement d'une ressource pour les applications mobiles.  L'application peut √™tre trouv√©e dans l'App Store ou Google Play, mettre un point d'acc√®s sp√©cial, diss√©quer l'API et enregistrer des comptes de test.  Le probl√®me est que souvent les gens pensent que tout ce qui est prot√©g√© par une autorisation est √† l'abri des attaques par d√©ni de service.  Apparemment, l'autorisation est le meilleur CAPTCHA, mais ce n'est pas le cas.  Cr√©er des comptes de test 10-20 est simple, et en les cr√©ant, nous avons acc√®s √† des fonctionnalit√©s complexes et non d√©guis√©es. <br><br>  Naturellement, nous regardons l'historique, √† robots.txt et WebArchive, ViewDNS, nous recherchons d'anciennes versions de la ressource.  Parfois, il arrive que les d√©veloppeurs d√©ploient, disons, mail2.yandex.net, mais l'ancienne version, mail.yandex.net, est rest√©e.  Ce mail.yandex.net n'est plus pris en charge, les ressources de d√©veloppement ne lui sont pas allou√©es, mais il continue de consommer la base de donn√©es.  Par cons√©quent, en utilisant l'ancienne version, vous pouvez utiliser efficacement les ressources du backend et tout ce qui se trouve derri√®re la mise en page.  Bien s√ªr, cela ne se produit pas toujours, mais nous rencontrons toujours quelque chose comme √ßa assez souvent. <br><br>  Naturellement, nous diss√©quons tous les param√®tres de demande, la structure des cookies.  Vous pouvez, par exemple, pousser une valeur dans le tableau JSON √† l'int√©rieur du cookie, cr√©er plus d'imbrication et faire fonctionner la ressource de mani√®re d√©raisonnablement longue. <br><br><h3>  Charge de recherche </h3><br>  La premi√®re chose qui vient √† l'esprit lors de la recherche d'un site est de charger la base de donn√©es, car presque tout le monde a une recherche, et presque tout le monde, malheureusement, est mal prot√©g√©.  Pour une raison quelconque, les d√©veloppeurs ne pr√™tent pas assez d'attention √† la recherche.  Mais il y a une recommandation - ne faites pas le m√™me type de demandes, car vous pouvez rencontrer la mise en cache, comme c'est le cas avec le d√©luge HTTP. <br><br>  Les requ√™tes al√©atoires dans la base de donn√©es ne sont pas non plus toujours efficaces.  Il est pr√©f√©rable de cr√©er une liste de mots cl√©s pertinents pour la recherche.  Si vous revenez √† l'exemple d'une boutique en ligne: disons qu'un site vend des pneus de voiture et vous permet de d√©finir le rayon des pneus, le type de voiture et d'autres param√®tres.  En cons√©quence, des combinaisons de mots pertinents feront fonctionner la base de donn√©es dans des conditions beaucoup plus complexes. <br><br>  De plus, cela vaut la peine d'utiliser la pagination: il est beaucoup plus difficile pour une recherche de renvoyer l'avant-derni√®re page d'un probl√®me que la premi√®re.  Autrement dit, avec l'aide de la pagination, vous pouvez diversifier un peu la charge. <br><br>  Dans l'exemple ci-dessous, nous montrons la charge dans la recherche.  On voit que d√®s la premi√®re seconde du test √† une vitesse de dix requ√™tes par seconde, le site est tomb√© en panne et n'a pas r√©pondu. <br><br><img src="https://habrastorage.org/webt/dg/bu/oa/dgbuoarg4u2ufo9_jw1w2nxkurq.png"><br><br><h3>  S'il n'y a pas de recherche? </h3><br>  S'il n'y a pas de recherche, cela ne signifie pas que le site ne contient pas d'autres champs de saisie vuln√©rables.  Ce champ peut √™tre une autorisation.  D√©sormais, les d√©veloppeurs aiment cr√©er des hachages complexes afin de prot√©ger la base de donn√©es de connexion contre les attaques sur les tables arc-en-ciel.  C'est bien, mais de tels hachages consomment de grandes ressources CPU.  Un flux important de fausses autorisations entra√Æne une d√©faillance du processeur et, par cons√©quent, le site cesse de fonctionner sur la sortie. <br><br>  La pr√©sence sur le site de toutes sortes de formulaires de commentaires et de retours d'exp√©rience est l'occasion d'y envoyer de tr√®s gros textes ou simplement de cr√©er un d√©luge massif.  Parfois, les sites acceptent les pi√®ces jointes, y compris au format gzip.  Dans ce cas, nous prenons un fichier de 1 To, en utilisant gzip nous le compressons √† quelques octets ou kilo-octets et l'envoyons sur le site.  Ensuite, il est d√©compress√© et un effet tr√®s int√©ressant est obtenu. <br><br><h3>  API Rest </h3><br>  Je voudrais faire un peu attention √† des services aussi populaires que l'API Rest.  La protection de l'API Rest est beaucoup plus difficile qu'un site classique.  Pour l'API Rest, m√™me des m√©thodes triviales de protection contre le craquage de mot de passe et d'autres activit√©s ill√©gitimes ne fonctionnent pas. <br><br>  L'API Rest est tr√®s facile √† casser car elle acc√®de directement √† la base de donn√©es.  Dans le m√™me temps, la d√©faillance d'un tel service entra√Æne des cons√©quences assez graves pour l'entreprise.  Le fait est que l'API Rest implique g√©n√©ralement non seulement le site principal, mais √©galement l'application mobile, certaines ressources commerciales internes.  Et si tout cela tombe, alors l'effet est beaucoup plus fort que dans le cas de la d√©faillance d'un site simple. <br><br><h3>  Charge de contenu √©lev√©e </h3><br>  Si on nous propose de tester une application ordinaire d'une page, une page de destination, un site Web de carte de visite, qui ne poss√®de pas de fonctionnalit√©s complexes, nous recherchons du contenu lourd.  Par exemple, de grandes images que le serveur donne, des fichiers binaires, de la documentation pdf - nous essayons de tout pomper.  De tels tests chargent bien le syst√®me de fichiers et obstruent les canaux, et sont donc efficaces.  Autrement dit, m√™me si vous ne mettez pas le serveur hors tension, en t√©l√©chargeant un fichier volumineux √† faible vitesse, vous obstruerez simplement le canal du serveur cible et un d√©ni de service se produira. <br>  Un exemple d'un tel test montre qu'√† une vitesse de 30 RPS, le site a cess√© de r√©pondre ou a g√©n√©r√© 500 erreurs de serveur. <br><br><img src="https://habrastorage.org/webt/qc/wt/o-/qcwto-1m01beyofdf9vwgov8a6g.png"><br><br>  N'oubliez pas de configurer des serveurs.  Vous pouvez souvent constater qu'une personne a achet√© une machine virtuelle, y a install√© Apache, tout configur√© par d√©faut, localis√© une application php, et ci-dessous vous pouvez voir le r√©sultat. <br><br><img src="https://habrastorage.org/webt/js/ji/xj/jsjixjh1afv4981burqrqtopx8i.png"><br><br>  Ici, la charge est all√©e √† la racine et ne repr√©sentait que 10 RPS.  Nous avons attendu 5 minutes et le serveur s'est √©cras√©.  √Ä la fin, cependant, on ne sait pas pourquoi il est tomb√©, mais on suppose qu'il √©tait simplement plein de m√©moire et a donc cess√© de r√©pondre. <br><br><h3>  Bas√© sur les vagues </h3><br>  Au cours des deux derni√®res ann√©es, les attaques par vagues sont devenues tr√®s populaires.  Cela est d√ª au fait que de nombreuses organisations ach√®tent certains √©l√©ments mat√©riels pour se prot√©ger contre les DDoS, qui n√©cessitent une certaine quantit√© de statistiques pour commencer √† filtrer les attaques.  Autrement dit, ils ne filtrent pas l'attaque dans les 30 √† 40 premi√®res secondes, car ils accumulent des donn√©es et apprennent.  Par cons√©quent, dans ces 30 √† 40 secondes, vous pouvez lancer autant de ressources que la ressource restera longtemps longtemps jusqu'√† ce que toutes les demandes soient ratiss√©es. <br><br>  Dans le cas de l'attaque, il y a eu un intervalle de 10 minutes plus bas, apr√®s quoi une nouvelle partie modifi√©e de l'attaque est arriv√©e. <br><br><img src="https://habrastorage.org/webt/tx/b4/l7/txb4l7l3s0yneaz0dn5__jzozmu.png"><br><br>  Autrement dit, la d√©fense s'est entra√Æn√©e, a commenc√© √† filtrer, mais une nouvelle portion compl√®tement diff√©rente de l'attaque est arriv√©e, et la d√©fense a recommenc√© √† s'entra√Æner.  En effet, le filtrage cesse de fonctionner, la protection devient inefficace et le site est inaccessible. <br><br>  Les attaques par vagues se caract√©risent par des valeurs tr√®s √©lev√©es au pic, elle peut atteindre cent mille ou un million de requ√™tes par seconde, dans le cas de L7.  Si nous parlons de L3 et 4, il peut y avoir des centaines de gigabits de trafic, ou, en cons√©quence, des centaines de mpps, si vous comptez en paquets. <br><br>  Le probl√®me avec de telles attaques est la synchronisation.  Les attaques proviennent d'un botnet et afin de cr√©er un pic unique tr√®s important, un degr√© √©lev√© de synchronisation est requis.  Et cette coordination ne fonctionne pas toujours: parfois, la sortie est une sorte de pic parabolique, qui semble plut√¥t path√©tique. <br><br><h3>  Non HTTP Unified </h3><br>  En plus de HTTP au niveau L7, nous adorons exploiter d'autres protocoles.  En r√®gle g√©n√©rale, un site Web r√©gulier, en particulier un h√©bergement r√©gulier, a des protocoles de messagerie et MySQL qui sort.  Les protocoles de messagerie sont moins affect√©s que les bases de donn√©es, mais ils peuvent √©galement √™tre charg√©s assez efficacement et obtenir un processeur surcharg√© sur le serveur en sortie. <br><br>  Avec l'aide de la vuln√©rabilit√© SSH 2016, nous avons r√©ussi.  Maintenant, cette vuln√©rabilit√© a √©t√© corrig√©e pour presque tout le monde, mais cela ne signifie pas que SSH ne peut pas √™tre charg√©.  Tu peux.  Juste une √©norme charge d'autorisations est servie, SSH consomme presque tout le processeur sur le serveur, puis le site Web est d√©j√† compos√© d'une ou deux demandes par seconde. <br><br>  Par cons√©quent, ces une ou deux requ√™tes de journal ne peuvent pas √™tre distingu√©es d'une charge l√©gitime. <br>  Les nombreuses connexions que nous ouvrons dans les serveurs restent pertinentes.  Auparavant, Apache a p√©ch√©, maintenant nginx a r√©ellement p√©ch√©, car il est souvent configur√© par d√©faut.  Le nombre de connexions que nginx peut garder ouvert est limit√©, nous ouvrons donc ce nombre de connexions, la nouvelle connexion nginx n'accepte plus et le site ne fonctionne pas en sortie. <br><br>  Notre cluster de test poss√®de suffisamment de CPU pour attaquer la n√©gociation SSL.  En principe, comme le montre la pratique, les botnets aiment aussi parfois le faire.  D'une part, il est clair que vous ne pouvez pas vous passer de SSL, car l'√©mission, le classement et la s√©curit√© de Google.  SSL, d'autre part, a malheureusement un probl√®me de processeur. <br><br><h3>  L3 &amp; 4 </h3><br>  Lorsque nous parlons d'une attaque au niveau L3 &amp; 4, nous parlons g√©n√©ralement d'une attaque au niveau du canal.  Une telle charge se distingue presque toujours de la l√©gitime s'il ne s'agit pas d'une attaque par inondation SYN.  Le probl√®me des attaques par inondation SYN pour les fonctions de s√©curit√© est important.  La valeur maximale de L3 et 4 √©tait de 1,5 √† 2 To / s.  Un tel trafic est tr√®s difficile √† g√©rer m√™me pour les grandes entreprises, notamment Oracle et Google. <br><br>  SYN et SYN-ACK sont les packages utilis√©s pour √©tablir la connexion.  Par cons√©quent, il est difficile de distinguer SYN-flood d'une charge l√©gitime: il n'est pas clair qu'il s'agit de SYN, qui est venu √©tablir la connexion, ou une partie du d√©luge. <br><br><h3>  Inondation UDP </h3><br>  En g√©n√©ral, les attaquants n'ont pas les capacit√©s que nous avons, donc l'amplification peut √™tre utilis√©e pour organiser des attaques.  Autrement dit, un attaquant scanne Internet et trouve des serveurs vuln√©rables ou mal configur√©s qui, par exemple, en r√©ponse √† un paquet SYN, r√©pondent avec trois SYN-ACK.  En simulant l'adresse source √† partir de l'adresse du serveur cible, vous pouvez utiliser un package pour augmenter la capacit√©, disons, trois fois, et rediriger le trafic vers la victime. <br><br><img src="https://habrastorage.org/webt/nd/yu/qz/ndyuqzpld7k2bu58rqqmbriass4.png"><br><br>  Le probl√®me des amplifications est leur d√©tection complexe.  √Ä partir des derniers exemples, nous pouvons citer le cas sensationnel avec le memcached vuln√©rable.  De plus, il existe maintenant de nombreux appareils IoT, des cam√©ras IP, qui sont √©galement principalement configur√©s par d√©faut, et par d√©faut, ils sont configur√©s de mani√®re incorrecte.Par cons√©quent, gr√¢ce √† de tels appareils, les attaquants font le plus souvent des attaques. <br><br><img src="https://habrastorage.org/webt/h-/si/2n/h-si2n6jf8q84xzuzbfgwgwnd6o.png"><br><br><h3>  SYN-flood difficile </h3><br>  SYN-flood est probablement la vue la plus int√©ressante de toutes les attaques du point de vue du d√©veloppeur.  Le probl√®me est que les administrateurs syst√®me utilisent souvent le blocage IP pour la protection.  De plus, le blocage IP affecte non seulement les administrateurs syst√®me qui fonctionnent selon des scripts, mais, malheureusement, certains syst√®mes de s√©curit√© achet√©s pour beaucoup d'argent. <br><br>  Cette m√©thode peut se transformer en catastrophe, car si les attaquants modifient leurs adresses IP, l'entreprise bloquera son propre sous-r√©seau.  Lorsque le pare-feu bloque son propre cluster, les interactions externes se bloquent √† la sortie et la ressource s'arr√™te. <br><br>  Et il est facile de bloquer votre propre r√©seau.  Si le bureau du client dispose d'un r√©seau Wi-Fi, ou si la sant√© des ressources est mesur√©e √† l'aide de diverses surveillances, nous prenons l'adresse IP de ce syst√®me de surveillance ou client Wi-Fi de bureau, et nous l'utilisons comme source.  En sortie, la ressource semble √™tre disponible, mais les adresses IP cibles sont bloqu√©es.  Ainsi, le r√©seau Wi-Fi de la conf√©rence HighLoad, o√π un nouveau produit de l'entreprise est pr√©sent√©, peut √™tre bloqu√©, ce qui entra√Æne certains co√ªts commerciaux et √©conomiques. <br><br>  Pendant les tests, nous ne pouvons pas utiliser l'amplification via memcached par certaines ressources externes, car il existe des accords pour fournir du trafic uniquement aux adresses IP autoris√©es.  En cons√©quence, nous utilisons l'amplification via SYN et SYN-ACK, lorsque le syst√®me r√©pond avec deux ou trois SYN-ACK pour envoyer un SYN et que la sortie est multipli√©e par deux √† trois fois. <br><br><h3>  Les outils </h3><br>  L'un des principaux outils que nous utilisons pour la charge au niveau L7 est le r√©servoir Yandex.  En particulier, un fant√¥me est utilis√© comme pistolet, et il existe plusieurs scripts pour g√©n√©rer des cartouches et analyser les r√©sultats. <br><br>  Tcpdump est utilis√© pour analyser le trafic r√©seau et Nmap est utilis√© pour analyser le trafic du serveur.  Pour cr√©er une charge au niveau L3 &amp; 4, OpenSSL est utilis√© et un peu de sa propre magie avec la biblioth√®que DPDK.  DPDK est une biblioth√®que d'Intel qui vous permet de travailler avec une interface r√©seau, en contournant la pile Linux, et ainsi d'augmenter l'efficacit√©.  Naturellement, nous utilisons DPDK non seulement au niveau L3 &amp; 4, mais aussi au niveau L7, car il vous permet de cr√©er un flux de charge tr√®s √©lev√©, en quelques millions de requ√™tes par seconde √† partir d'une machine. <br>  Nous utilisons √©galement certains g√©n√©rateurs de trafic et des outils sp√©ciaux que nous √©crivons pour des tests sp√©cifiques.  Si nous rappelons la vuln√©rabilit√© sous SSH, alors avec l'ensemble ci-dessus, elle ne peut pas √™tre √©chapp√©e.  Si nous attaquons le protocole de messagerie, nous prenons des utilitaires de messagerie ou √©crivons simplement des scripts dessus. <br><br><blockquote><h3>  Conclusions </h3><br>  En cons√©quence, je voudrais dire: <br><br><ul><li>  En plus des tests de charge classiques, des tests de contrainte doivent √©galement √™tre effectu√©s.  Nous avons un exemple concret o√π un sous-traitant partenaire n'a effectu√© que des tests de charge.  Il a montr√© que la ressource r√©siste √† la charge standard.  Mais alors une charge anormale est apparue, les visiteurs du site ont commenc√© √† utiliser la ressource un peu diff√©remment, et en fin de compte le sous-traitant s'est fix√©.  Ainsi, il vaut la peine de rechercher des vuln√©rabilit√©s m√™me si vous √™tes d√©j√† prot√©g√© contre les attaques DDoS. </li><li>  Il est n√©cessaire d'isoler certaines parties du syst√®me des autres.     ,      ,      .       ,    -  .    -      ,   , ,    ,    OAuth2. </li><li>      . </li><li>  CDN      ,               . </li><li>     .  L3&amp;4        ,    ,  ,    .  L7      ,     . ,     -   ,  . </li><li>  .     ,   SSH daemon,       .  ,    ,            . </li></ul></blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr448626/">https://habr.com/ru/post/fr448626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr448610/index.html">DIY: Comment nous avons cr√©√© un programme en direct pour Codefest X</a></li>
<li><a href="../fr448612/index.html">Ce qui a √©t√© gel√© au gel des fonctionnalit√©s 2019. Partie I. JSONPath</a></li>
<li><a href="../fr448618/index.html">Algorithme Douglas-Pecker</a></li>
<li><a href="../fr448622/index.html">PHP GR8: JIT am√©liorera-t-il les performances de PHP 8</a></li>
<li><a href="../fr448624/index.html">Voir les donn√©es? Non. Donc je ne vois pas, mais ils le sont. Nous d√©truisons les donn√©es sur les disques SSD et restaurons m√™me la vitesse</a></li>
<li><a href="../fr448628/index.html">Esth√©tique et technologie technique sovi√©tique</a></li>
<li><a href="../fr448632/index.html">Java est maintenant pay√©? D√©mystifier les rumeurs (ou pas?)</a></li>
<li><a href="../fr448634/index.html">Cours d'ukrainien</a></li>
<li><a href="../fr448636/index.html">Hackaday Retro Computer Case</a></li>
<li><a href="../fr448638/index.html">Buildroot - Partie 1. Informations g√©n√©rales, construction d'un syst√®me minimal, configuration via le menu</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>