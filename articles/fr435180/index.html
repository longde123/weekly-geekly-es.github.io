<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚≠êÔ∏è üè¢ ‚úçüèø API REST sans serveur "sur le genou en 5 minutes" üë©üèæ‚Äçü§ù‚Äçüë®üèΩ üññüèø üñäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour, Habr! Aujourd'hui, nous continuons la discussion sur les opportunit√©s qu'Amazon Web Services nous offre et comment utiliser ces opportunit√©s ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>API REST sans serveur "sur le genou en 5 minutes"</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/435180/">  Bonjour, Habr!  Aujourd'hui, nous continuons la discussion sur les opportunit√©s qu'Amazon Web Services nous offre et comment utiliser ces opportunit√©s pour r√©soudre les probl√®mes d'application. <br><br>  Dans un exemple simple, nous envisagerons de cr√©er en quelques minutes notre propre API REST auto-√©volutive sans serveur avec analyse de cas - obtenir une liste pour une ressource. <br><br>  Int√©ressant?  Alors passez sous la coupe! <br><br><img src="https://habrastorage.org/webt/o1/lo/od/o1loodoauwe328yyywvsjwxbhpu.png"><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">(Source)</a> <br><a name="habracut"></a><br><h2>  Au lieu de rejoindre </h2><br>  Nous n'utiliserons aucune base de donn√©es pour analyser l'exemple; √† la place, notre source d'informations sera un fichier texte en clair sur AWS S3. <br><br><ul><li>  Supposons donc que sur AWS S3, nous ayons un fichier texte avec des en-t√™tes et que certains processus y √©crivent des informations. </li><li>  Nous allons cr√©er une API cloud qui renverra une r√©ponse JSON en tant que demande GET avec le param√®tre pass√©. </li><li>  En m√™me temps, selon la complexit√© des t√¢ches et, par cons√©quent, les exigences accrues pour la puissance de traitement des ressources, vous n'avez pas √† vous en pr√©occuper, car  le service est enti√®rement √©volutif.  Et cela signifie que vous n'avez besoin d'aucune administration, allocation et gestion de serveur, t√©l√©chargez simplement votre code et ex√©cutez-le. </li></ul><br><h2>  Architecture du syst√®me en cours de d√©veloppement </h2><br><img src="https://habrastorage.org/webt/jm/7r/yb/jm7ryb1z30xucimouckrlyitm6a.png"><br><br>  Composants d'Amazon Web Services utilis√©s: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Amazon S3</b></a> - stockage d'objets, qui vous permet de stocker des quantit√©s presque illimit√©es d'informations; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>AWS Identity and Access Management (IAM)</b></a> - Un service qui permet de contr√¥ler en toute s√©curit√© l'acc√®s aux services et ressources AWS.  √Ä l'aide d'IAM, vous pouvez cr√©er, g√©rer, g√©rer des utilisateurs et des groupes AWS et utiliser des autorisations pour accorder ou refuser l'acc√®s aux ressources AWS; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>AWS Lambda</b></a> est un service qui vous permet d'ex√©cuter du code sans sauvegarder ni configurer de serveurs.  Toute la puissance de calcul est automatiquement mise √† l'√©chelle pour chaque appel.  Les frais sont factur√©s en fonction du nombre de demandes de fonctionnalit√©s et de leur dur√©e, c'est-√†-dire  temps pendant lequel le code est ex√©cut√©. <br><blockquote>  Le niveau d'acc√®s gratuit (niveau gratuit) implique 1 million de demandes par mois gratuites et 400K Go.  Langages pris en charge: Node.js, Java, C #, Go, Python, Ruby, PowerShell </blockquote>  .  Nous utiliserons Python: <br><br><ul><li>  La biblioth√®que <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>boto3</b></a> est un SDK AWS pour Python qui vous permet d'interagir avec divers services Amazon; </li></ul></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Amazon API Gateway</b></a> est un service de d√©veloppeur enti√®rement g√©r√© con√ßu pour cr√©er, publier, maintenir, surveiller et s√©curiser des API √† n'importe quelle √©chelle.  Outre la possibilit√© d'utiliser plusieurs versions de la m√™me API (√©tapes) pour le d√©bogage, le raffinement et les tests, le service vous permet de cr√©er des API REST sans serveur √† l'aide d'AWS Lambda.  Lambda ex√©cute le code dans une infrastructure informatique hautement accessible, √©liminant ainsi le besoin de distribution, de mise √† l'√©chelle et de gestion des serveurs. <br><blockquote>  Le niveau gratuit pour l'API HTTP / REST comprend un million d'appels d'API par mois pendant 12 mois </blockquote></li></ul><br><h2>  Pr√©paration des donn√©es </h2><br>  Un fichier texte avec un onglet sera utilis√© comme d√©limiteur de champ comme source d'informations pour g√©n√©rer des r√©ponses √† une demande GET REST.  Les informations n'ont plus vraiment d'importance pour cet exemple, mais pour une utilisation ult√©rieure de l'API, j'ai t√©l√©charg√© √† partir du terminal de n√©gociation Quik une table de n√©gociation actuelle des obligations libell√©es en roubles russes, je l'ai enregistr√©e dans bonds.txt et j'ai plac√© ce fichier dans un compartiment AWS S3 sp√©cialement cr√©√©. <br><br>  Un exemple des informations re√ßues est illustr√© dans la figure ci-dessous: <br><br> <a href=""><img src="https://habrastorage.org/webt/ua/yl/na/uaylnacmex2xuts2gnqstudoxii.jpeg"></a> <br><br>  Ensuite, vous devez √©crire une fonction qui lira les informations du fichier bonds.txt, les analysera et les √©mettra sur demande.  AWS Lambda s'en sortira tr√®s bien.  Mais d'abord, vous devrez cr√©er un nouveau r√¥le qui permettra √† la fonction Lambda cr√©√©e de lire les informations √† partir du compartiment situ√© dans AWS S3. <br><br><h2>  Cr√©er des r√¥les pour AWS Lambda </h2><br><ol><li>  Dans la console de gestion AWS, acc√©dez au service AWS IAM puis √† l'onglet "R√¥les", cliquez sur le bouton "Cr√©er un r√¥le"; <br><br><div class="spoiler">  <b class="spoiler_title">Ajout d'un nouveau r√¥le</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/bz/wl/n9/bzwln9pjpdlusmo8cgwv7csvey8.jpeg"><br></div></div></li><li>  Le r√¥le que nous cr√©ons maintenant sera utilis√© par AWS Lambda pour lire les informations d'AWS S3.  Par cons√©quent, √† l'√©tape suivante, s√©lectionnez "S√©lectionner le type de confiance" -&gt; "Service Aws" et "Choisissez le service qui utilisera ce r√¥le" -&gt; "Lambda" et cliquez sur le bouton "Suivant: Autorisations" <br><br><div class="spoiler">  <b class="spoiler_title">R√¥le du service Lambda</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/mq/bh/ik/mqbhikgn46p9m4ul1ulytb1etpk.jpeg"><br></div></div></li><li>  Vous devez maintenant d√©finir les strat√©gies d'acc√®s pour les ressources AWS qui seront utilis√©es dans le r√¥le nouvellement cr√©√©.  Parce que  la liste des politiques est assez impressionnante, en utilisant le filtre des politiques, nous lui indiquons ¬´S3¬ª.  En cons√©quence, nous obtenons une liste filtr√©e pour le service S3.  Notez la case √† cocher en face de la politique ¬´AmazonS3ReadOnlyAccess¬ª et cliquez sur le bouton ¬´Suivant: Tags¬ª. <br><br><div class="spoiler">  <b class="spoiler_title">Strat√©gies pour les r√¥les</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ix/nz/jk/ixnzjk8y4wkt3xo6sntt_ss_q04.jpeg"><br></div></div></li><li>  L'√©tape (Ajouter des balises (facultatif)) est facultative, mais vous pouvez sp√©cifier des balises pour les r√¥les si vous le souhaitez.  Nous ne le ferons pas et passons √† l'√©tape suivante - Aper√ßu.  Ici, vous devez d√©finir le nom du r√¥le - "ForLambdaS3-ReadOnly", ajouter une description et cliquer sur le bouton "Cr√©er un r√¥le". <br><br><div class="spoiler">  <b class="spoiler_title">R√¥les de titre</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/pf/lc/cj/pflccjxy1lmfker-x-_jmb00m7e.jpeg"><br></div></div></li></ol><br>  Tout, le r√¥le a √©t√© cr√©√© et nous pouvons l'utiliser dans d'autres travaux. <br><br><h2>  Cr√©er une nouvelle fonctionnalit√© dans AWS Lambda </h2><br><ol><li>  Acc√©dez au service AWS Lambda et cliquez sur le bouton "Cr√©er une fonction": <br><br><div class="spoiler">  <b class="spoiler_title">Cr√©ation de fonction</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lb/9g/mq/lb9gmqf_f2wkakv3y3ta-xgpr_u.jpeg"><br></div></div><br>  Remplissez tous les champs comme indiqu√© dans la capture d'√©cran ci-dessous: <br><br><ul><li>  Nom - "getAllBondsList"; </li><li>  Runtime - "Python 3.6" </li><li>  R√¥le - ¬´Choisissez un r√¥le existant¬ª </li><li>  R√¥le existant - ici, nous s√©lectionnons le r√¥le que nous avons cr√©√© ci-dessus - ForLambdaS3-ReadOnly </li></ul><br><div class="spoiler">  <b class="spoiler_title">Nom et choix du r√¥le</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/g7/7y/od/g77yodilqokdh3rmtmwk1arsh80.jpeg"><br></div></div></li><li>  Il ne reste plus qu'√† √©crire le code de la fonction et √† v√©rifier ses performances sur diff√©rents tests.  Il convient de noter que le composant principal de toute fonction Lambda (si vous utilisez Python) est la biblioth√®que boto3: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> boto3 s3 = boto3.resource(<span class="hljs-string"><span class="hljs-string">'s3'</span></span>) bucket = s3.Bucket(<span class="hljs-string"><span class="hljs-string">'your-s3-bucket'</span></span>) obj = bucket.Object(key = <span class="hljs-string"><span class="hljs-string">'bonds.txt'</span></span>) response = obj.get()</code> </pre> <br>  L'id√©e de base de notre fonction Python est la suivante: <br><br><ul><li>  Ouvrez le fichier bonds.txt; </li><li>  Lire les en-t√™tes de colonne; </li><li>  Battez des records par page (10 collections dans notre cas); </li><li>  S√©lectionnez la page souhait√©e; </li><li>  Mappez le nom des colonnes et des enregistrements; </li><li>  Donnez le r√©sultat sous forme de collections. </li></ul><br>  Nous ne consacrerons pas beaucoup de temps au code de fonction lui-m√™me et √† l'impl√©mentation technique, tout est assez simple et le code complet est disponible dans mon <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">GitHub</a> . <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, len(lines_proc)): d = dict((<span class="hljs-string"><span class="hljs-string">u''</span></span>.join(key), <span class="hljs-string"><span class="hljs-string">u''</span></span>.join(value)) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (key, value) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> zip(headers, lines_proc[i].split(<span class="hljs-string"><span class="hljs-string">"\t"</span></span>))) response_body.append(d) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'statusCode'</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'page'</span></span> : num_page, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: response_body }</code> </pre><br>  Ins√©rez le code (ou √©crivez le v√¥tre :)) dans le bloc ¬´Code de fonction¬ª et cliquez sur le bouton ¬´Enregistrer¬ª dans le coin sup√©rieur droit de l'√©cran. <br><br><div class="spoiler">  <b class="spoiler_title">Insertion de code</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/py/v7/bz/pyv7bzmaokoa7dxmgc-auhuji7q.jpeg"><br></div></div></li><li>  Cr√©ez des √©v√©nements de test.  Apr√®s avoir ins√©r√© le code, la fonction est disponible pour le lancement et le test.  Cliquez sur le bouton ¬´Test¬ª et cr√©ez des √©v√©nements de test: lancement de la fonction lambda_handler avec diff√©rents param√®tres.  √Ä savoir: <br><br><ul><li>  D√©marrage d'une fonction avec le param√®tre 'page': '100'; </li><li>  Lancement d'une fonction avec le param√®tre 'page': '1000000'; </li><li>  D√©marrage d'une fonction avec le param√®tre 'page': 'bla-bla-bla'; </li><li>  Ex√©cution d'une fonction sans le param√®tre 'page'. </li></ul><br><div class="spoiler">  <b class="spoiler_title">√âv√©nement de test Page100</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/f4/lc/s8/f4lcs8v_qj_nmzetyijk0ybngp4.jpeg"><br></div></div><br>  D√©marrage de la fonction cr√©√©e avec l'envoi de la page d'√©v√©nement de test == 100. Comme le montre la capture d'√©cran ci-dessous, la fonction a fonctionn√© avec succ√®s, a renvoy√© le statut 200 (OK), ainsi qu'une collection de collections qui correspondent √† la centi√®me page de donn√©es divis√©es en utilisant la pagination. <br><br><div class="spoiler">  <b class="spoiler_title">D√©clenchement d'un √©v√©nement de test Page100</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/of/7e/1b/of7e1bgnqpk63gugwnletylpxzk.jpeg"><br></div></div><br>  Pour la puret√© de l'exp√©rience, nous lancerons un autre √©v√©nement test - ¬´PageBlaBlaBla¬ª.  Dans ce cas, la fonction renvoie le r√©sultat avec le code 415 et un commentaire qu'il faut v√©rifier l'exactitude des param√®tres pass√©s: <br><br><div class="spoiler">  <b class="spoiler_title">√âv√©nement de test PageBlaBlaBla</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sp/qt/op/spqtopae3qqqroxxpwmhcdmdmu8.jpeg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">D√©clenchement d'un √©v√©nement PageBlaBlaBla</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/v3/ms/3x/v3ms3x0jd9pyucqqmnb4qqnful4.jpeg"><br></div></div><br></li></ol><br><h2>  Cr√©ation d'API </h2><br>  Une fois que tous les autres cas ont √©t√© test√©s et qu'il est entendu que la fonction Lambda fonctionne comme pr√©vu, nous proc√©dons √† la cr√©ation de l'API.  Cr√©ons un point d'acc√®s √† la fonction Lambda cr√©√©e ci-dessus et configurons en outre une protection contre les d√©marrages ind√©sirables √† l'aide de la cl√© API. <br><br><ul><li>  Acc√©dez au service AWS API Gateway.  Cliquez sur le bouton Cr√©er une API, d√©finissez le nom de l'API - getAllBondsList <br><br><div class="spoiler">  <b class="spoiler_title">Cr√©er une nouvelle API</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/yc/1q/7z/yc1q7zqud7q7m_fu7gibtsql9-w.jpeg"><br></div></div></li><li>  Ajoutez la m√©thode GET √† l'API nouvellement cr√©√©e.  Pour ce faire, s√©lectionnez Actions -&gt; Cr√©er une m√©thode, s√©lectionnez la m√©thode GET dans la liste d√©roulante et cliquez sur la coche <br><br><div class="spoiler">  <b class="spoiler_title">Nouvelle m√©thode GET</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/7j/6j/df/7j6jdfyvpyvhzhfv3yjxewkc0lk.jpeg"><br></div></div><br>  Ensuite, nous indiquons que la m√©thode GET utilisera notre fonction Lambda getAllBondsList.  S√©lectionnez-le et cliquez sur le bouton Enregistrer. <br><br><div class="spoiler">  <b class="spoiler_title">Reliure de fonction lambda</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/zi/8e/5l/zi8e5ly5xby143omz8p_-oxk4x0.jpeg"><br></div></div></li><li>  D√©ployons notre API, obtenant ainsi l'URL pour appeler l'API. <br>  Cliquez sur Actions -&gt; Deploy API, puis sur Deployment stage -&gt; New Stage <br><blockquote>  Il est possible de d√©ployer l'API √† diff√©rentes √©tapes et vous pouvez appeler ces √©tapes comme vous le souhaitez (par exemple, DEV / QA / PROD).  Nous d√©ploierons imm√©diatement sur PROD. </blockquote><div class="spoiler">  <b class="spoiler_title">D√©ployer l'API</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ok/vb/gm/okvbgmwxrrzzcilnvzwisbeoqw4.jpeg"><br></div></div><br>  Apr√®s le d√©ploiement, un lien pour lancer l'API nouvellement cr√©√©e sera disponible.  Nous allons acc√©der √† cette URL dans la barre d'adresse du navigateur (ou ex√©cuter la commande curl dans le terminal) - nous recevrons un appel API et, par cons√©quent, lancerons la fonction Lambda: <br><br><div class="spoiler">  <b class="spoiler_title">URL de l'API</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/y3/ok/1e/y3ok1esjw61-xjp7uzql21cxdxa.jpeg"><br></div></div><br>  J'utiliserai l'application <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Postman</a> pour illustrer la passerelle API AWS.  Dans ce document, vous pouvez d√©boguer et tester le fonctionnement de l'API de mani√®re tr√®s confortable. <br><br><div class="spoiler">  <b class="spoiler_title">Premier test d'API</b> <div class="spoiler_text">  Copiez l'URL de l'√©tape PROD vers Postman et envoyez une demande GET √† notre API: <br><br> <a href=""><img src="https://habrastorage.org/webt/bo/ku/3x/boku3xlj9kkoknm0wfnax1ninqg.jpeg"></a> <br><br>  Quelque chose semble avoir mal tourn√© ... la demande GET a renvoy√© une r√©ponse JSON avec le code 400 et une indication que le param√®tre Page n'a pas √©t√© d√©fini dans la demande d'appel API.  Ajoutez la prise en charge des param√®tres de demande √† l'API. <br></div></div></li><li>  Prise en charge des param√®tres pass√©s dans la demande. <br>  Nous revenons aux param√®tres de la demande GET et passons √† l'√©tape de demande de m√©thode. <br><br><div class="spoiler">  <b class="spoiler_title">Demande de m√©thode</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/di/yi/oo/diyioox34z86tv41lrp0oqw8tu4.jpeg"><br></div></div><br>  Dans les param√®tres d√©taill√©s de la demande de m√©thode, vous devez d√©velopper le bloc Param√®tres de cha√Æne de requ√™te d'URL et ajouter un nouveau ¬´page¬ª de param√®tre et le rendre obligatoire: <br><br><div class="spoiler">  <b class="spoiler_title">Ajout d'un param√®tre</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/j2/rj/gc/j2rjgcaffqvrmq6a6rrh7znhimy.jpeg"><br></div></div><br>  Nous revenons √† la page Ex√©cution de m√©thode et passons √† la demande d'int√©gration.  Nous descendons au bas de la page et ouvrons le bloc ¬´Mapping Templates¬ª.  S√©lectionnez "Quand aucun mod√®le n'est d√©fini (recommand√©)", dans le champ Content-Type, sp√©cifiez <b>application / json</b> et cliquez sur la coche.  Faites d√©filer la page ci-dessous et entrez le code dans la zone de texte, comme indiqu√© dans l'image ci-dessous.  Apr√®s cela, cliquez sur le bouton Enregistrer. <br><br><div class="spoiler">  <b class="spoiler_title">Demande de m√©thode</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ue/s3/y5/ues3y5vyonxozczm7onfg2-351s.jpeg"><br></div></div><br>  Apr√®s avoir fait le d√©ploiement de l'API, nous v√©rifions √† nouveau, mais avec le param√®tre "page" pass√©: <br><br> <a href=""><img src="https://habrastorage.org/webt/s5/-3/v_/s5-3v_kqnx5k3drotwwhw4mltf4.jpeg"></a> <br><br>  C'est un succ√®s!  Maintenant, la demande a fonctionn√© avec succ√®s et nous a renvoy√© les collections contenues sur la dixi√®me page!  Hourra! </li><li>  Il ne reste plus qu'√† prot√©ger notre API contre les attaques ind√©sirables de l'ext√©rieur. <br><br>  Pour ce faire, vous devez configurer l'API de telle mani√®re que lors de l'acc√®s, elle n√©cessite une cl√© secr√®te, qui est transmise √† l'en-t√™te. <br><br>  Acc√©dez aux cl√©s API et cr√©ez un nouveau groupe de cl√©s API - KeyForBondsList. <br><br><div class="spoiler">  <b class="spoiler_title">Cl√©s API</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/su/na/ba/sunaba6acca0mmout5n1yu4xyd8.jpeg"><br></div></div><br>  Une fois la cl√© d'API cr√©√©e avec succ√®s, vous devez sp√©cifier que l'API getAllBondsList doit exiger que la cl√© d'API soit transmise dans l'en-t√™te de la demande.  Et liez un KeyForBondsList sp√©cifique √† l'API getAllBondsList. <br><br>  Revenons aux param√®tres de la demande GET dans la demande de m√©thode et modifions le param√®tre API Key Required de false √† true.  Maintenant, l'API n√©cessitera le transfert de la cl√© API. <br><br><div class="spoiler">  <b class="spoiler_title">Cl√© API requise</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/dn/gu/sy/dngusygxk5h50j4qnbcxt3umkbs.jpeg"><br></div></div><br>  Acc√©dez √† Plan d'utilisation et cr√©ez un nouveau plan d'utilisation de l'API. <br><br>  Premi√®rement, nous lui donnons un nom et une description, et deuxi√®mement, ici, vous pouvez d√©finir des limites au lancement de l'API, par exemple, pas plus d'un lancement par seconde, etc. <br><br><div class="spoiler">  <b class="spoiler_title">Cr√©ation d'un plan d'utilisation</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/zl/-3/y9/zl-3y9ruwexssvl3jzpzlocfqpe.jpeg"><br></div></div><br>  Cliquez sur Suivant et passez √† la page suivante o√π vous devez connecter les √©tapes de l'API avec le plan d'utilisation: <br><br><div class="spoiler">  <b class="spoiler_title">Liaison d'une √©tape √† un plan d'utilisation</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/lh/q8/m0/lhq8m0te7ejfwkjz1sftxwznz24.jpeg"><br></div></div><br>  Sur la page suivante, nous lions les cl√©s API au plan d'utilisation de l'API.  Cliquez sur le bouton Ajouter des cl√©s API au plan d'utilisation et recherchez les cl√©s API cr√©√©es dans les √©tapes pr√©c√©dentes par nom: <br><br><div class="spoiler">  <b class="spoiler_title">Liaison des cl√©s d'API au plan d'utilisation</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/y2/p0/8c/y2p08c59ly3trqt6kjhlbud2tmg.jpeg"><br></div></div><br>  Apr√®s avoir effectu√© le d√©ploiement et ex√©cut√© √† nouveau l'appel GET de notre API, nous obtenons la r√©ponse: ¬´Interdit¬ª, car  l'en-t√™te de demande ne contient pas la cl√© API: <br><br> <a href=""><img src="https://habrastorage.org/webt/oy/z9/39/oyz939fbfo9e6g-xpbujygkhj3o.jpeg"></a> <br><br>  Essayons de l'ajouter en copiant √† partir des cl√©s API -&gt; KeyForBondsList -&gt; cl√© API -&gt; Afficher et coller dans la section correspondante de la demande avec la cl√© "x-api-key": <br><br> <a href=""><img src="https://habrastorage.org/webt/vc/ml/l5/vcmll5c2bbyazujggy7orazylbm.jpeg"></a> <br><br>  Tout a fonctionn√©!  Cette fois, la demande renvoie des donn√©es sans aucun probl√®me, l'appel API est s√ªr et prot√©g√© contre les intrus par la cl√© API secr√®te. </li></ul><br><h2>  Conclusions et r√©sum√© </h2><br>  Dans cet article, nous avons examin√© la cr√©ation d'une API REST auto-√©volutive sans serveur √† l'aide des services cloud d'Amazon.  L'article n'√©tait pas le plus petit en volume, mais j'ai essay√© d'expliquer autant que possible l'ensemble du processus de cr√©ation de l'API et de composer la s√©quence compl√®te des actions. <br><br>  Je suis s√ªr qu'apr√®s une ou deux r√©p√©titions des √©tapes d√©crites dans l'article, vous pouvez augmenter vos API cloud en 5 minutes ou m√™me plus rapidement. <br><br>  En raison de sa relative simplicit√©, de son faible co√ªt et de sa puissance, le service AWS API Gateway offre de nombreuses opportunit√©s aux d√©veloppeurs √† utiliser dans le cadre de projets professionnels et commerciaux.  Pour consolider le mat√©riel th√©orique de cet article, essayez de vous inscrire √† un abonnement annuel gratuit √† Amazon Web Services et effectuez vous-m√™me les √©tapes ci-dessus pour cr√©er une API REST. <br><br>  Pour toutes questions et suggestions, je suis pr√™t √† parler avec plaisir.  J'attends avec impatience vos commentaires sur l'article et vous souhaite beaucoup de succ√®s! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr435180/">https://habr.com/ru/post/fr435180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr435170/index.html">Un aper√ßu de l'ECG Apple Watch pour quelqu'un qui s'en soucie</a></li>
<li><a href="../fr435172/index.html">Oculus GoBlack - comment am√©liorer Oculus Go</a></li>
<li><a href="../fr435174/index.html">Unreal Engine 4 - Shader br√ªlant</a></li>
<li><a href="../fr435176/index.html">DEFCON 21. Les mots de passe ne suffisent pas √† eux seuls, ou pourquoi le chiffrement du disque ¬´casse¬ª et comment y rem√©dier? Partie 1</a></li>
<li><a href="../fr435178/index.html">DEFCON 21. Les mots de passe ne suffisent pas √† eux seuls, ou pourquoi le chiffrement du disque ¬´casse¬ª et comment y rem√©dier? 2e partie</a></li>
<li><a href="../fr435182/index.html">√âtude: le march√© des disques durs diminuera d'un tiers d'ici 2021</a></li>
<li><a href="../fr435184/index.html">L'intelligence artificielle apprise √† d√©tecter la maladie d'Alzheimer dans le cerveau 6 ans avant le diagnostic</a></li>
<li><a href="../fr435186/index.html">Rolls-Royce d√©veloppe l'avion √©lectrique le plus rapide du monde</a></li>
<li><a href="../fr435190/index.html">Google a r√©ussi √† se retirer de la taxe de 22,7 milliards de dollars via l'Irlande et les Bermudes</a></li>
<li><a href="../fr435194/index.html">Simplifiez la r√©daction du CV d'un d√©veloppeur</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>