<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤨 🙅🏻 💃🏼 Sakelar lampu wifi pintar ❣️ 👭 🐹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Selamat siang, pembaca yang budiman. 
 
 Sedikit lirik di awal. Gagasan tentang saklar lampu "pintar" sama sekali bukan hal baru dan, mungkin, ini ada...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sakelar lampu wifi pintar</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/393497/"><img src="https://habrastorage.org/files/8cf/a56/9c8/8cfa569c88ff458c8c84c600a6b3c67a.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selamat siang, pembaca yang budiman. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sedikit lirik di awal. Gagasan tentang saklar lampu "pintar" sama sekali bukan hal baru dan, mungkin, ini adalah hal pertama yang terlintas dalam pikiran bagi mereka yang mulai berkenalan dengan platform Arduino dan elemen IoT. Dan saya tidak terkecuali untuk ini. Setelah bereksperimen dengan elemen rangkaian, motor dan LED, saya ingin melakukan sesuatu yang lebih diterapkan, yang banyak diminati dalam kehidupan sehari-hari dan, yang paling penting, akan mudah digunakan, dan tidak akan tetap menjadi korban percobaan demi kenyamanan. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pada artikel ini saya akan memberi tahu Anda bagaimana saya membuat saklar yang akan bekerja seperti yang normal (yaitu, yang biasanya dipasang di dinding) dan pada saat yang sama memungkinkannya dikendalikan melalui WiFi (atau melalui Internet, seperti yang dilakukan dalam kasus ini).</font></font><a name="habracut"></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Jadi, kami akan membuat daftar apa yang diperlukan untuk mengimplementasikan rencana tersebut. </font><font style="vertical-align: inherit;">Saya harus segera mengatakan bahwa saya bermaksud untuk tidak berbelanja banyak pada komponen dan memilih komponen berdasarkan umpan balik di forum dan nilai uang. </font><font style="vertical-align: inherit;">Oleh karena itu, beberapa komponen mungkin tampak tidak pantas di sini untuk amatir listrik yang berpengalaman, tetapi tolong jangan menilai dengan ketat, karena </font><font style="vertical-align: inherit;">Saya hanya baru di bidang elektromekanik dan akan sangat menghargai komentar dari para profesional yang lebih berpengalaman.</font></font><br>
<table>
<tbody><tr>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tidak.</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nama</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Deskripsi</font></font></th>
<th><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Harga</font></font></th>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HLK-PM01</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220VAC ke adaptor 5VDC</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,02 €</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSR-40DA</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relay Solid State untuk Kontrol Arus Sirkuit</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3,35 €</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AMS1117-3.3</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5V ke 3V penekan tegangan</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1,29 €</font></font></td>
</tr>
<tr>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4</font></font></td>
<td><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP8266-01</font></font></a></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mikrokontroler dengan WiFi</font></font></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,35 €</font></font></td>
</tr>
<tr>
<td colspan="3" align="right"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Total:</font></font></b></td>
<td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11,01 €</font></font></td>
</tr>
</tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya juga membutuhkan: server dengan mana sakelar akan dikontrol melalui Internet, Arduino Uno, dengan mana saya memprogram ESP, router dan barang habis pakai seperti kabel, terminal, dll., Semua ini dapat berbeda dari rasa dan tidak akan mempengaruhi ke hasil akhir. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Harga diambil dari Ebay, tempat saya membelinya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan inilah bagaimana elemen-elemen dari tabel terlihat: </font></font><br>
<br>
<img src="https://habrastorage.org/files/1ef/70b/dc9/1ef70bdc91704739b496786442c19517.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang Anda dapat membuat diagram koneksi:</font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/eb8/740/8f0/eb87408f0f4743d986dbe39f4abe02b3.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seperti yang mungkin Anda perhatikan, skema ini sangat sederhana. Semuanya dirakit dengan mudah, cepat dan tanpa solder. Semacam prototipe yang berfungsi, yang tidak perlu repot untuk waktu yang lama. Semuanya terhubung oleh kabel dan terminal. Satu-satunya negatif adalah bahwa relay tidak cocok dengan soket switch. Ya, awalnya saya berencana untuk mendorong semuanya ke dinding di belakang saklar agar terlihat estetis. Tetapi saya menyesal, tidak ada ruang yang cukup di soket dan relay hanya tidak cocok di kedua sisi atau sisi: </font></font><br>
<br>
<img src="https://habrastorage.org/files/ce9/090/c6f/ce9090c6ff18427486c49ce2f48570e6.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Oleh karena itu, saya sementara mengambil relay dari soket sampai saya menemukan kotak saklar yang cocok dengan soket untuk menyembunyikan besi di dalamnya. Tapi tidak ada yang lebih permanen daripada sementara, bukan? Oleh karena itu, semua ini sekarang terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/files/69c/45e/792/69c45e79281a4ce8a02bd6cf17ece631.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pita isolasi akan menghemat dari sengatan listrik ... Saya harap. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sekarang mari kita bicara tentang bagian perangkat lunak.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan sebelum melanjutkan dengan analisis kode dan perincian, saya akan memberikan diagram umum tentang penerapan kontrol lampu. </font></font><br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/9b7/7cc/efe/9b77ccefe7c84f339fd25435ba3c74f0.png"></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya berharap bahwa suatu hari nanti saya akan menulis ulang semuanya dan koneksi akan didasarkan pada protokol yang lebih cepat daripada HTTP, tetapi untuk permulaan itu akan dilakukan. </font><font style="vertical-align: inherit;">Secara jarak jauh, bohlam mengubah kondisinya dalam waktu sekitar 1-1,5 detik, dan dari sakelar secara instan, sebagaimana layaknya sakelar yang layak.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pemrograman ESP8266-01</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Cara termudah untuk melakukan ini adalah dengan Arduino. Anda dapat mengunduh pustaka yang diperlukan untuk Arduino IDE dari </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GitHub</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ada semua petunjuk pemasangan dan konfigurasi. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Selanjutnya, kita perlu menghubungkan ESP ke komputer, untuk ini kita perlu USB ke Serial Adapter (seperti </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTDi</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CH340</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FT232RL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) atau platform Arduino (saya punya Arduino Uno) dengan output RX dan TX. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Perlu dicatat bahwa ESP8266-01 ditenagai oleh 3,3 Volts, yang berarti bahwa dalam kasus apapun tidak menghubungkannya ke Arduino, yang (sering) didukung oleh 5 Volts, secara langsung kalau tidak semuanya akan menjadi neraka. Anda dapat menggunakan peredam tegangan, yang ditunjukkan pada tabel di atas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Skema koneksi sederhana: kami menghubungkan </font></font><abbr title="Pemancar"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TX</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,</font></font><abbr title="Penerima"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RX</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dan </font></font><abbr title="Tanah"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GND</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ESP ke RX, TX dan adaptor GND / Arduino masing-masing. </font><font style="vertical-align: inherit;">Setelah itu, nyatanya, koneksi siap digunakan. </font><font style="vertical-align: inherit;">Mikrokontroler dapat diprogram menggunakan Arduino IDE. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa nuansa saat menggunakan Arduino Uno:</font></font></b> <br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Uno memiliki output untuk 3.3V, tetapi itu tidak cukup. </font><font style="vertical-align: inherit;">Ketika Anda menghubungkan ESP ke sana, semuanya tampak berfungsi, indikatornya menyala, tetapi komunikasi dengan port COM terputus. </font><font style="vertical-align: inherit;">Jadi saya menggunakan catu daya 3.3V berbeda untuk ESP.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Selain itu, UNO tidak memiliki masalah berkomunikasi dengan ESP, mengingat bahwa UNO ditenagai oleh 5V, dan ESP dari 3V.</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Setelah beberapa percobaan dengan ESP8266-01, ternyata ESP sensitif terhadap tegangan yang terhubung ke GPIO0 dan GPIO2. </font><font style="vertical-align: inherit;">Pada saat peluncuran, mereka tidak boleh di-grounded jika Anda bermaksud memulainya dalam mode normal. </font><font style="vertical-align: inherit;">Rincian lebih lanjut tentang awal mikrokontroler di </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Saya tidak tahu ini dan saya harus sedikit mengubah sirkuit, karena </font><font style="vertical-align: inherit;">dalam versi ESP-01, hanya 2 pin ini yang tersedia dan keduanya digunakan di sirkuit saya. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Dan di sini adalah program untuk ESP itu sendiri:</font></font><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tampilkan kode</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;ESP8266WiFi.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;WiFiClient.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;ESP8266WebServer.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;ESP8266mDNS.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;ESP8266HTTPClient.h&gt;</span></span></span></span>
<span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> { <span class="hljs-comment"><span class="hljs-comment">//         initVariant</span></span>
  <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user_interface.h"</span></span></span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ssid = <span class="hljs-string"><span class="hljs-string">"WIFISSID"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  WiFi</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* password = <span class="hljs-string"><span class="hljs-string">"***************"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  WiFi</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String self_token = <span class="hljs-string"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String serv_token = <span class="hljs-string"><span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String name = <span class="hljs-string"><span class="hljs-string">"IOT_lamp"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  ,  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> String serverIP = <span class="hljs-string"><span class="hljs-string">"192.168.1.111"</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  IP WEB  </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> lamp_on =  <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> can_toggle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> button_state;<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-function">ESP8266WebServer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">80</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
HTTPClient http; <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lamp = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    GPIO2</span></span>
<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> button = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""   GPIO0</span></span><font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//    </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRoot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <font></font>
  server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello! I am "</span></span> + name);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//    </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleNotFound</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  String message = <span class="hljs-string"><span class="hljs-string">"not found"</span></span>;<font></font>
  server.send(<span class="hljs-number"><span class="hljs-number">404</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, message);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">turnOnLamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  digitalWrite(lamp, LOW);<font></font>
  lamp_on = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">turnOffLamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  digitalWrite(lamp, HIGH);<font></font>
  lamp_on = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//     ./.</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendServer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> state)</span></span></span></span>{<font></font>
  http.begin(<span class="hljs-string"><span class="hljs-string">"http://"</span></span>+serverIP+<span class="hljs-string"><span class="hljs-string">"/iapi/setstate"</span></span>);<font></font>
  String post = <span class="hljs-string"><span class="hljs-string">"token="</span></span>+self_token+<span class="hljs-string"><span class="hljs-string">"&amp;state="</span></span>+(state?<span class="hljs-string"><span class="hljs-string">"on"</span></span>:<span class="hljs-string"><span class="hljs-string">"off"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//         </span></span>
  http.addHeader(<span class="hljs-string"><span class="hljs-string">"Content-Type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>);
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> httpCode = http.POST(post);<font></font>
  http.end();  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toggleLamp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lamp_on == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
    turnOffLamp();<font></font>
    sendServer(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);<font></font>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<font></font>
    turnOnLamp();<font></font>
    sendServer(<span class="hljs-literal"><span class="hljs-literal">true</span></span>);<font></font>
  }<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleOn</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  String token = server.arg(<span class="hljs-string"><span class="hljs-string">"token"</span></span>);
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(serv_token != token) {<font></font>
    String message = <span class="hljs-string"><span class="hljs-string">"access denied"</span></span>;<font></font>
    server.send(<span class="hljs-number"><span class="hljs-number">401</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, message);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
  }<font></font>
  turnOnLamp();<font></font>
  String message = <span class="hljs-string"><span class="hljs-string">"success"</span></span>;<font></font>
  server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, message);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleOff</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{<font></font>
  String token = server.arg(<span class="hljs-string"><span class="hljs-string">"token"</span></span>);
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(serv_token != token) {<font></font>
    String message = <span class="hljs-string"><span class="hljs-string">"access denied"</span></span>;<font></font>
    server.send(<span class="hljs-number"><span class="hljs-number">401</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, message);
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;<font></font>
  }<font></font>
  turnOffLamp();<font></font>
  String message = <span class="hljs-string"><span class="hljs-string">"success"</span></span>;<font></font>
  server.send(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>, message);<font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//  MAC    IP</span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initVariant</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> mac[<span class="hljs-number"><span class="hljs-number">6</span></span>] = {<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xA3</span></span>, <span class="hljs-number"><span class="hljs-number">0xA0</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x8C</span></span>, <span class="hljs-number"><span class="hljs-number">0x45</span></span>};<font></font>
  wifi_set_macaddr(STATION_IF, &amp;mac[<span class="hljs-number"><span class="hljs-number">0</span></span>]);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{<font></font>
  pinMode(lamp, OUTPUT);<font></font>
  pinMode(button, INPUT_PULLUP); <span class="hljs-comment"><span class="hljs-comment">//   INPUT_PULLUP</span></span><font></font>
  turnOffLamp();<font></font>
  WiFi.hostname(name);<font></font>
  WiFi.begin(ssid, password);<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">//     WiFi</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (WiFi.status() != WL_CONNECTED) {<font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
  }<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
  server.on(<span class="hljs-string"><span class="hljs-string">"/"</span></span>, handleRoot);<font></font>
  server.on(<span class="hljs-string"><span class="hljs-string">"/on"</span></span>,  HTTP_POST, handleOn);<font></font>
  server.on(<span class="hljs-string"><span class="hljs-string">"/off"</span></span>, HTTP_POST, handleOff);<font></font>
  server.onNotFound(handleNotFound);<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  server.begin();<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{<font></font>
  server.handleClient();<font></font>
<font></font>
  <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
  button_state = digitalRead(button);<font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (button_state == HIGH &amp;&amp; can_toggle) {<font></font>
    toggleLamp();<font></font>
    can_toggle = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
    delay(<span class="hljs-number"><span class="hljs-number">500</span></span>);<font></font>
  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(button_state == LOW){<font></font>
    can_toggle = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;<font></font>
  }<font></font>
}<font></font>
</code></pre><br>
</div></div><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Beberapa komentar pada kode:</font></font></b><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sangat penting untuk mendeklarasikan pin GPIO0 sebagai pinMode (tombol, </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INPUT_PULLUP</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), karena </font><font style="vertical-align: inherit;">Di sirkuit kita tidak menggunakan resistor untuk tombol ini. </font><font style="vertical-align: inherit;">Dan ESP memiliki "dijahit" sendiri untuk tujuan ini.</font></font></li>
<li>               .</li>
</ul><br>
<h2> WEB </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Di sini Anda dapat melampiaskan imajinasi Anda dan menggunakan segala cara yang tersedia untuk membuat layanan yang akan memproses permintaan yang dikirim oleh saklar dan mengirim permintaan untuk on / off. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Saya menggunakan </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yii</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> untuk tujuan ini </font><font style="vertical-align: inherit;">. Saya memilih kerangka kerja ini karena beberapa alasan, saya memerlukan otorisasi (karena portal tersedia di Internet) dan manajemen peran (untuk eksperimen di masa depan), dan saya menyukainya. Dan sekarang portal manajemen saya terlihat seperti ini: </font></font><br>
<br>
<img src="https://habrastorage.org/files/119/cb0/e72/119cb0e72f4845f8a6cac74fc856787a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Untuk mengontrol bola lampu di zona jangkauan jaringan, server itu sendiri pada ESP akan cukup. Tetapi Anda benar-benar ingin memiliki log, logika, dan perangkat lain di masa depan, jadi lebih baik tetap menggunakan server terpisah untuk manajemen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ini semua tentang portal, saya pikir tidak masuk akal untuk menulis lebih banyak tentangnya, tetapi jika Anda memiliki pertanyaan, saya akan dengan senang hati menjawabnya di komentar.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alih-alih sebuah kesimpulan</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Terima kasih jika Anda membaca artikel sampai akhir dan, mungkin, menemukan sesuatu yang bermanfaat untuk diri Anda sendiri di dalamnya. </font><font style="vertical-align: inherit;">Saya akan senang dengan saran dan kritik. </font><font style="vertical-align: inherit;">Secara umum, masih bagi saya bahwa hambatan dalam rangkaian adalah adaptor 5V dan saya akan senang jika Anda berbagi pengalaman Anda dalam memecahkan masalah seperti itu. </font><font style="vertical-align: inherit;">Adapun ESP8266-01, sejauh ini belum mengajukan keluhan dari saya kecuali untuk penggunaan khusus pin GPIO. </font><font style="vertical-align: inherit;">Ini telah bekerja secara stabil untuk minggu kedua. </font><font style="vertical-align: inherit;">Sukses dalam proyek.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id393497/">https://habr.com/ru/post/id393497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id393485/index.html">100.000 Lumens Air Cooled DIY LED Senter</a></li>
<li><a href="../id393487/index.html">Pengering turbo: cara mudah mengeringkan sepatu, kaos kaki, atau pakaian basah dengan cepat</a></li>
<li><a href="../id393491/index.html">Tujuh cantik skuter Novelty terjangkau</a></li>
<li><a href="../id393493/index.html">The Return of Eric - Robot Berbicara Pertama di Inggris</a></li>
<li><a href="../id393495/index.html">Seorang pria dipenjara karena dia tidak bisa mendekripsi isi HDD</a></li>
<li><a href="../id393505/index.html">Xiaomi mi Band2 "tidak sengaja" menyala di tangan CEO</a></li>
<li><a href="../id393507/index.html">Proyek "Eye" bagian 21</a></li>
<li><a href="../id393509/index.html">Craig Wright terus berusaha menyamar sebagai pencipta Bitcoin</a></li>
<li><a href="../id393513/index.html">Probabilitas kepunahan manusia diperkirakan 0,1% per tahun</a></li>
<li><a href="../id393515/index.html">PrivatBank mulai menjual solent</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>