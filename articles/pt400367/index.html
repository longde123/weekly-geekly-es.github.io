<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòâ üöô üëãüèº O que fazer no fim de semana: interfone com controle remoto, Nextion com remapeamento sem or√ßamento, confronto com Onlaym ‚úçüèæ üï∫üèª üò§</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="√Äs vezes, √†s sextas-feiras, a fic√ß√£o √© considerada aceit√°vel aqui. Hoje, √© claro, n√£o √© sexta-feira, mas n√£o √© fic√ß√£o, mas tr√™s mini-romances que t√™m ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que fazer no fim de semana: interfone com controle remoto, Nextion com remapeamento sem or√ßamento, confronto com Onlaym</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400367/"><img src="https://habrastorage.org/files/044/f5f/30d/044f5f30df86463087940fff4fc4ba92.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√Äs vezes, √†s sextas-feiras, a fic√ß√£o √© considerada aceit√°vel aqui. </font><font style="vertical-align: inherit;">Hoje, √© claro, n√£o √© sexta-feira, mas n√£o √© fic√ß√£o, mas tr√™s mini-romances que t√™m algo a ver com a minha vida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um leitor apressado tamb√©m pode se perguntar que rela√ß√µes podem realmente conectar o interfone e o provedor de Internet. </font><font style="vertical-align: inherit;">E estar√° certo, porque eu tamb√©m n√£o vim imediatamente a isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas sobre tudo (Arduino, hacks banais, brigas telef√¥nicas) em ordem.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim, abra!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser sincero, o controle remoto do interfone de acordo com a minha vers√£o √© quase in√∫til, e eu percebi isso antes mesmo de come√ßar. Portanto, para justificar o empreendimento, tive que usar todo o poder da imagina√ß√£o para apresentar alguns casos, como se costuma dizer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para come√ßar, decidi que dessa maneira deixaria os convidados se aquecerem na varanda, se ainda n√£o tivesse conseguido correr para casa. Ou n√£o me incomodo particularmente em obter as chaves com anteced√™ncia - afinal, voc√™ pode configurar o telefone para que ele d√™ um comando para abrir a porta quando chegar em casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para as pessoas comuns, isso parece bastante selvagem, mas, como eles dizem, per aspera ad astra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E eu realmente queria, de alguma forma, usar alguns rel√©s no gabinete, que estavam ociosos no controlador central desde o in√≠cio de sua opera√ß√£o. A situa√ß√£o, de fato, √© rid√≠cula: naquela √©poca havia apenas um bloco para 4 rel√©s em m√£os, dos quais apenas dois eram necess√°rios. E como n√£o queria esperar mais um m√™s pelo bloco de dois revezamentos, peguei o que estava √† m√£o e imediatamente comecei a me preocupar com redund√¢ncia. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, para os interfones. Em geral, a abertura autom√°tica de um sistema de interfone n√£o √© uma coisa exclusiva. Por exemplo, aqui no Geektimes, camarada </font><font style="vertical-align: inherit;">Em 2013 (quando o d√≥lar tinha 30 anos), o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fazia n√£o apenas um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controle remoto, mas tamb√©m uma secret√°ria eletr√¥nica para os h√≥spedes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa √© de longe a coisa mais legal que eu j√° vi nessa classe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas muito antes, os visitantes do RadioKota e muitos outros f√≥runs tem√°ticos</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se divertiu com dispositivos como "abridor"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - desbloqueando o interfone imediatamente em uma chamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu n√£o ia repetir um ou outro. </font><font style="vertical-align: inherit;">O primeiro - porque √© dif√≠cil, e porque eu j√° tinha um controlador em funcionamento, que planejava dar novos poderes. </font><font style="vertical-align: inherit;">A segunda, por raz√µes mais √≥bvias: muitos detalhes e muito pouco senso, pe√ßo desculpas se ofendi os autores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sentido, √© claro, para mim, e de maneira nenhuma. </font><font style="vertical-align: inherit;">Ou seja, categoricamente n√£o gosto do esquema, que hospitalamente abre a porta para quem disca um n√∫mero de apartamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Da√≠ os requisitos b√°sicos para o meu abridor: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Usando um controlador central para controlar via Internet e r√°dio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Prote√ß√£o m√≠nima contra acesso n√£o autorizado</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Interfer√™ncia m√≠nima no interior</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comecei familiarizando-me com o princ√≠pio de opera√ß√£o do interfone, que peguei emprestado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tubo funciona de maneira muito simples: quando o tubo √© colocado, ele tem uma resist√™ncia de 50 Ohms, quando o tubo √© removido, a resist√™ncia √© de aprox. </font><font style="vertical-align: inherit;">400 Ohm, quando o bot√£o de libera√ß√£o da trava √© pressionado, a resist√™ncia √© medida em quilo-ohms ... Quando n√£o h√° chamada, n√£o h√° tens√£o na linha. </font><font style="vertical-align: inherit;">Quando uma chamada √© recebida e o telefone monta uma corrente grande e a tens√£o acaba sendo pequena de 5-7 V, quando o telefone est√° ausente e a resist√™ncia √© chamada ao infinito e a tens√£o √© m√°xima aprox. </font><font style="vertical-align: inherit;">15V quando o aparelho estiver desligado, aproximadamente 10V. </font><font style="vertical-align: inherit;">Quando o bot√£o de tens√£o √© pressionado, o m√°ximo √© de aprox. </font><font style="vertical-align: inherit;">15V - pressionar o bot√£o significa quebra de linha.</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso da Digital, isso √© um pouco diferente, j√° que a documenta√ß√£o do aparelho, mas eu tinha o KM-2NO (a prop√≥sito, expresso minha gratid√£o √† Digital por publicar o esquema) indica:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Consumo de corrente no modo "Talk" 18-22 mA </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Tens√£o da linha com um tubo instalado na caixa 1,5‚Äì2,5 V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Tens√£o da linha com um tubo acima de 5,8-6,5 V</font></font><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, me familiarizei com mais detalhes com o diagrama de circuitos do meu tubo: </font></font><br>
<br>
<img src="https://habrastorage.org/files/b76/591/c8f/b76591c8f87c4eaca7a8bfec1f652f39.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e descobri que tudo √© exatamente o mesmo em termos de resist√™ncia e, provavelmente, o restante da l√≥gica do Digital dificilmente √© diferente da Visita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chamo a aten√ß√£o para o fato de que minha modifica√ß√£o √© sem LED. Mas isso acabou sendo correto, pois esse fato facilita a transmiss√£o de informa√ß√µes de chamada para o controlador central. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja: a chamada soa, o LED "acende", o acoplador √≥ptico liga, no pino do controlador, temos uma mudan√ßa de n√≠vel de alto para baixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, em vez do LED, instalei meu acoplador √≥ptico 4N35, cuja sa√≠da eu enviei diretamente para o Arduino. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acordo com o esquema padr√£o</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da mesma Internet:</font></font><br>
<br>
<img src="https://habrastorage.org/files/a7f/c39/9f8/a7fc399f840e4931b225370b2f21c3cd.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E como eu queria me familiarizar com o m√≠nimo de detalhes e recursos dispon√≠veis do controlador, dos quais os pinos digitais eram os mais valiosos (o Uno n√£o era suficiente para eles), em vez de um resistor de pull-up de 10K, usei o resistor pull-up embutido do Arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando conectado a um pino digital, fica assim:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT_PULLUP);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando conectado a um pino anal√≥gico:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT);<font></font>
digitalWrite(ringPin, HIGH);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu decidi colocar o optron do microcontrolador. </font><font style="vertical-align: inherit;">N√£o posso justificar, mas achei que havia menos risco de falsos positivos de poss√≠veis capturas. </font><font style="vertical-align: inherit;">√â poss√≠vel que ele esteja errado, mas at√© agora tudo est√° normal com dicas </font><font style="vertical-align: inherit;">eles n√£o s√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto √† terra no exemplo acima, voc√™ precisa entender: embora a terra pare√ßa ser comum no diagrama, isso n√£o √© verdade - na verdade, existe realmente um isolamento optoeletr√¥nico. </font><font style="vertical-align: inherit;">Bem, por isso ele √© um exemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre-se de mim!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A decis√£o de se livrar completamente dos circuitos de intercomunica√ß√£o n√£o veio imediatamente, mas inevitavelmente. A prop√≥sito, lembrei-me muito do caso de seis anos atr√°s, quando vi como um momento constrangedor com uma trava eletromagn√©tica se formou durante a instala√ß√£o de um ACS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
N√£o sei como aconteceu, mas o castelo funcionou de alguma forma. Aquele "rastreamento", ent√£o nada, e os pr√≥prios instaladores j√° quebraram a cabe√ßa. Por√©m, no final, foi sugerido que eles tivessem um curto-circuito inesperado em algum lugar (ou algo parecido) nos circuitos de controle. Obviamente, verificamos tudo, √© claro, sem muito sucesso, pois eles foram definidos claramente de acordo com as instru√ß√µes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O √≥leo foi adicionado ao fogo pelo fato de que exatamente a mesma trava estava exatamente na mesma configura√ß√£o, mas funcionou muito bem no outro andar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por quanto tempo, brevemente, eles decidiram que o assunto estava na pr√≥pria porta, na qual a fechadura est√° presa. Na minha opini√£o, eles sugeriram que, quando foi instalado, eles grudaram na armadura, que, por sua vez, foi aterrada, o que levou a efeitos inesperados na trava (que, possivelmente, tinha uma trava de controle no gabinete). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, eles resolveram muito tempo e tediosamente. E eu n√£o queria repetir a mesma coisa em casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, n√£o salvei os fios e conectei os contatos do rel√© da maneira mais simples: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Normalmente um rel√© fechado - em s√©rie com o bot√£o para cima SW1 (porque este bot√£o est√° fechado no estado normal) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Normalmente abra outro rel√© - em paralelo com o bot√£o de abertura da porta SB1 ( porque este bot√£o est√° normalmente aberto)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os contatos de controle do rel√©, √© claro, conectados aos pinos digitais livres (hooray, eles ainda eram) do microcontrolador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No total, √© f√°cil imaginar que foram necess√°rios seis fios: dois para o acoplador √≥ptico e mais quatro para o rel√©. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pe√ßo desculpas pelo primitivismo da ilustra√ß√£o:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do intercomunicador</font></font></h4><br>
<img src="https://habrastorage.org/files/cfe/2f2/23c/cfe2f223cb2b4d49ad1b853482b3895a.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por Arduino</font></font></h4><br>
<img src="https://habrastorage.org/files/c99/84f/e4b/c9984fe4be554b13b2ec17915ca86474.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os rel√©s aqui s√£o mostrados exclusivamente esquematicamente. </font><font style="vertical-align: inherit;">Como repito, usei m√≥dulos de rel√© prontos com enchimento completo - optoacopladores, transistores, diodos e assim por diante. </font><font style="vertical-align: inherit;">Eu recomendo fortemente n√£o conectar rel√©s nus ao Arduino.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e n√£o me ligue mais!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J√° nessa fase, eu era capaz de abrir com facilidade o interfone via Internet ou rede local a partir de um computador ou smartphone, de acordo com o seguinte princ√≠pio: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) No momento em que o interfone toca, o controlador entra no modo de permiss√£o para abrir a porta por 40 segundos. O tempo √© selecionado com base na documenta√ß√£o do interfone digital, onde √© indicado que a dura√ß√£o do sinal de chamada √© exatamente 40 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I.e. por mais tempo, n√£o faz sentido permanecer aberto condicionalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Ap√≥s o recebimento de um comando aberto via Internet (HTTP POST), o controlador alterna seq√ºencialmente o rel√©. Primeiro, ele abre o rel√© do tubo, que simula sua ascens√£o. Depois de uma breve pausa, o rel√© do bot√£o de abertura se fecha, simulando sua press√£o. Depois - "libera" o bot√£o e "desliga" o telefone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A bancada de testes era muito primitiva:</font></font><br>
<br>
<img src="https://habrastorage.org/files/3b5/44c/db1/3b544cdb17ab4f67953d7643d98e0156.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seria poss√≠vel parar com isso se eu, como orgulhoso propriet√°rio do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTsDV-12-2,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o soubesse o qu√£o inconveniente √© - correr pelo controle remoto ou pelo telefone toda vez que precisar ativar / desativar algo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, em particular, se eu n√£o tivesse terminado recentemente uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">esta√ß√£o meteorol√≥gica de mesa com uma tela sens√≠vel ao toque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, ao que parece, n√£o tivesse um potencial totalmente desenvolvido. </font></font><br>
<br>
<img src="https://habrastorage.org/files/90a/d36/f45/90ad36f45757421295f332c7425578fa.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em suma, rapidamente adicionei √† esta√ß√£o meteorol√≥gica o transmissor de 433 MHz mais comum e vulgar com modula√ß√£o de amplitude, cujas toneladas s√£o vendidas no Aliexpress por dinheiro rid√≠culo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, a esta√ß√£o meteorol√≥gica se tornou outro ponto de controle para o interfone e, portanto, se uma campainha tocar e voc√™ se sentar ao lado dela, n√£o faz sentido interromper o telefone, pois diretamente na tela voc√™ pode:</font></font><br>
<br>
1)  <br>
<br>
2)      (    1,5   40  )   ,    ‚Äî ,  <br>
<br>
3) ¬´¬ª  ( ¬´¬ª   ¬´¬ª )<br>
<br>
 , ,       ,     ,        (  ‚Äî    ,    ).<br>
<br>
 ,        HAL. ,     ,   .    :   ,    ,     ,    material ,    :<br>
<br>
<img src="https://habrastorage.org/files/71a/154/0d4/71a1540d420441d3aa62d3ca673f3a43.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa tela substitui os dados clim√°ticos quando o interfone toca: neste momento, o controlador central emite um comando de r√°dio, ao qual a tela meteorol√≥gica responde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode ser um pouco il√≥gico aqui, mas a campainha no centro informa principalmente sobre a chamada de interfone. </font><font style="vertical-align: inherit;">Pression√°-lo (il√≥gico aqui) silencia o som do interfone da maneira mais b√°rbara - imitando o processo de levantar e abaixar o telefone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O castelo √† esquerda √© a abertura do castelo. </font><font style="vertical-align: inherit;">Telefone √† direita - pegue o telefone para simular o in√≠cio de uma conversa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tela muda para a principal ap√≥s 40 segundos desde o in√≠cio da chamada e n√£o imediatamente pressionando o bot√£o √≠cone. </font><font style="vertical-align: inherit;">Isso permite que voc√™ pressione v√°rias vezes se o controlador de repente n√£o "ouviu" um comando, o que n√£o √© incomum, dado o tipo de canal de r√°dio usado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionei, no come√ßo eu era modesto e queria apenas uma coisa: abrir o interfone sob comando pelo telefone e no momento da liga√ß√£o. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, depois de alguns dias, percebi que ficar na frente do interfone e cutucar a tela √© uma tarefa bastante chata, e √© muito mais interessante permitir uma abertura "atrasada" quando voc√™ se aproxima da entrada. Resta apenas discar o n√∫mero do apartamento no painel do interfone e pronto, a porta est√° aberta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, pensei que, nessa situa√ß√£o, provavelmente faz sentido proibir a abertura - em geral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas ent√£o ele se recomp√¥s, depois se soltou, pegou uma ferramenta mais √∫til, popularmente chamada de navalha de Occam, e rapidamente se livrou de entidades desnecess√°rias. Ou seja: desde que eu estava fazendo o controle remoto, n√£o era para deslig√°-lo. Portanto - o desligamento n√£o √© necess√°rio.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, de acordo com o pensamento s√≥brio (e n√£o como de costume), descobriu-se que n√£o havia diferen√ßa especial entre a abertura por um comando imediatamente no momento da chamada ou por um determinado comando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, voltando √† ergonomia do controle, quero dizer que quanto mais modos - menos pessoas comuns os usar√£o. Sim, sou aborrecido, mas como imaginei ter tr√™s modos para diferentes ocasi√µes, percebi que ainda usaria um. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o modo √© um e o comando √© um, e existem dois processadores: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Se o interfone tocar, o controlador permitir√° a abertura dentro de 40 segundos desde o in√≠cio da chamada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Se o comando de abertura √© recebido primeiro, o controlador permite a abertura e aguarda uma chamada dentro de N minutos a partir do momento em que o comando foi recebido (isto √©, para preparar o interfone para abertura no caminho para a casa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode haver duas fontes do comando de abertura: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) HTTP POST- uma solicita√ß√£o por meio de uma rede local ou da Internet (por exemplo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myserver.com/?sim-sim-openup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ou seja, voc√™ pode abrir pelo menos a partir de Kuala Lumpur </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) O comando de r√°dio nos pain√©is ou bot√µes da casa (na minha implementa√ß√£o, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">atrav√©s da biblioteca RC-Switch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E como toda a estrutura est√° conectada ao aparelho sem afetar seu funcionamento, o intercomunicador pode continuar a ser usado da maneira usual (bot√£o do fone de m√£o com oi-oi-oi), ou seja, </font><font style="vertical-align: inherit;">dom√©stico, incapaz de apreciar os m√©ritos do progresso tecnol√≥gico e n√£o precisa se aprofundar nos detalhes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B√¥nus repentinos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo que voc√™ n√£o use a fun√ß√£o de abridor de portas, agora o controlador notifica regularmente que algu√©m est√° arranhando a porta da entrada pelo interfone. </font><font style="vertical-align: inherit;">Para mim, como pessoa curiosa, essa informa√ß√£o n√£o √© de interesse - e agora eu a recebo regularmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais importante, essa fun√ß√£o continua funcionando mesmo que voc√™ desligue o fone do interfone com o interruptor. </font><font style="vertical-align: inherit;">Potencialmente, isso significa que agora h√° menos chances de deixar o intercomunicador desativado, se voc√™ precisar excluir temporariamente a possibilidade de suas chamadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, o circuito do intercomunicador √© tal que, quando desligado, torna-se imposs√≠vel controlar remotamente a trava (parece que a unidade central considera que, nesse caso, o telefone est√° ‚Äúdesligado‚Äù, independentemente de sua posi√ß√£o atual).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E paisagismo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu estava buscando uma interfer√™ncia m√≠nima no interior, tive que tomar uma decis√£o sobre como me conectar ao controlador central, com base no fato de que o controlador e o interfone estavam em lados diferentes da porta e o controlador tinha eletricidade, mas o interfone n√£o. </font></font><br>
<br>
<img src="https://habrastorage.org/files/7b6/8e8/6c3/7b68e86c3aab453e8fcbc579149f4e2a.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, decidi que seria melhor esticar o cabo atr√°s da moldura da porta e fechar seus fragmentos com pain√©is decorativos impressos em uma impressora 3D do que ocupar outra tomada com uma fonte de alimenta√ß√£o, n√£o est√° claro como puxar o fio para o monofone do interfone e bloquear o canal de r√°dio entre o monofone e o controlador. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/a91/84a/e65a9184ab9d4cb29e84e515689e607e.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E acho que nas minhas condi√ß√µes essa √© a melhor op√ß√£o. </font><font style="vertical-align: inherit;">Sim, e o revezamento entrou no neg√≥cio, mas com um canal de r√°dio - novamente teria permanecido em reserva.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remapeando a Nextion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falando sobre a exibi√ß√£o do tempo na √°rea de trabalho (esta√ß√£o meteorol√≥gica, se voc√™ quiser), mencionei que durante o processo de acabamento, consegui danificar o componente principal - a pr√≥pria tela de toque do Nextion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A falha n√£o afetou a opera√ß√£o do microcontrolador de bordo e a exibi√ß√£o de dados, mas o painel de toque quase falhou. No entanto, experimentalmente, descobri que, mesmo que voc√™ n√£o exer√ßa muita press√£o no painel do Nextion em um determinado local, dessa maneira voc√™ pode restaurar a sensibilidade da metade esquerda (aproximadamente) da tela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse truque funciona inst√°vel e nem sempre, mas com frequ√™ncia suficiente para que eu possa atend√™-lo, pensando em pedir uma nova tela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, isso me deixou feliz e triste. Por um lado, foi poss√≠vel obter operabilidade parcial. Por outro lado, eu gostaria de jogar um pouco mais com as paradas. E, de repente, percebi em que armadilha idiota ca√≠: por algum motivo, fiquei obcecado em usar toda a √°rea da tela, quando podia transferir livremente os bot√µes "n√£o funcionantes" para a √°rea de trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entendo que, para muitos, √© realmente uma decis√£o banal. Mas gostaria de compartilhar alegria inocente com aqueles que, como eu, gostam de ir ao extremo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o, eu descobri, mudei um pouco o tamanho dos bot√µes, desenhei um novo circuito de controle virtual na minha cabe√ßa e pronto! Restauramos quase completamente a funcionalidade de uma tela parcialmente morta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi: </font></font><br>
<br>
<img src="https://habrastorage.org/files/8cb/774/fc0/8cb774fc06b444ce994ad1470e7319d8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tornou-se:</font></font><br>
<br>
<img src="https://habrastorage.org/files/202/2b8/82f/2022b882fd2245a79cc4fae8514ddde5.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao longo do caminho, no entanto, tive que matar um perfeccionista em mim e refazer a tela de controle do interfone da tela original para uma minimamente funcional:</font></font><br>
<br>
<img src="https://habrastorage.org/files/bd2/bec/a58/bd2beca5810346c5a99099e1ac046288.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao vivo</font></font></h4><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/P6Iqh6SYVRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o suporte t√©cnico n√£o √© ale</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que, em todos esses altos e baixos, seria poss√≠vel concluir, se n√£o fosse um detalhe: de repente, descobri que o interfone (e atr√°s dele o restante da automa√ß√£o) deixou de ser controlado ao acessar a partir de redes externas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, todos os comandos funcionavam perfeitamente quando conectados √† Internet atrav√©s da rede dom√©stica e a endere√ßos externos (e n√£o de acordo com o tipo interno 192.xxx.xxx.xxx), mas eles se recusavam igualmente a ser executados a partir das redes de outros operadores (tentei dois). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ deve entender imediatamente que os comandos s√£o transmitidos por meio de uma solicita√ß√£o HTTP para uma porta externa espec√≠fica do roteador e, a partir da√≠, eles j√° s√£o redirecionados para o IP e a porta internos necess√°rios.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E esse esquema funcionou sem os menores problemas desde o seu lan√ßamento em 2013 at√© que algo quebrou no atual. E ainda tenho certeza de que n√£o √© minha culpa. Mas n√£o sei como verificar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, no come√ßo eu queria xingar a Beeline, porque inicialmente pensei que o problema estava na Internet m√≥vel. Mas ent√£o eu me recompus, encontrei outro provedor, tentei e descobri que atrav√©s dele o mesmo problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ent√£o liguei para Onlaym e, como pude, expliquei a ess√™ncia das alega√ß√µes. E em resposta, eles me explicaram popularmente que:</font></font><br>
<br>
<blockquote>               :<br>
TCP/25 ‚Äì  -;<br>
TCP/135-139, TCP/445  UDP/135-139 ‚Äì   ,    MS Windows;<br>
TCP/23, TCP/161, UDP/69  UDP/161‚Äì   .<br>
 <br>
  ,  ,  .</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por sua vez, insisti que minha porta a) n√£o se enquadra nesse intervalo, b) n√£o funciona como esperado ec) n√£o mudei nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que tal uma parede de ervilhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, o que devo fazer, expliquei educadamente que, embora entenda que meus infelizes 450 rublos por m√™s n√£o causam o tempo para eles, vou de tal absurdo procurar o mesmo absurdo, mas pelo menos funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resposta, eles murmuraram novamente que estavam me fornecendo IP e todos os meus problemas. Bem meu, decidi, depois meu. E por uma decis√£o decidida, verifiquei primeiro a operabilidade do sistema em outra porta (transferida para uma unidade) - funciona. E ent√£o ele fez uma configura√ß√£o flex√≠vel do n√∫mero da porta no Tasker, atrav√©s do qual, de fato, o volante √© autom√°tico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, ao que descrevo meus sofrimentos: objetivamente, eu realmente queria entender quem estava errado em tal situa√ß√£o. </font><font style="vertical-align: inherit;">Porque me sinto um completo idiota - reiniciei o roteador e verifiquei as configura√ß√µes (al√©m disso, por minha pr√≥pria iniciativa, e n√£o por solicita√ß√£o de "especialistas"), e ainda assim eles me mandaram para o inferno, sugerindo minhas m√£os tortas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fora da tela</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em conclus√£o, que usei para a constru√ß√£o do s√©culo: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTSDV-12-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Telefone port√°til Digital KM-2NO - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Optoacoplador 4N35 - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Cabo plano de 10 n√∫cleos (usado seis, mas coloque tudo - apenas no caso) - 3 m. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Conectores ao cabo - 2 pe√ßas. </font><font style="vertical-align: inherit;">pais e m√£es </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitor clim√°tico</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caseiro </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">com tela sens√≠vel ao toque Nextion</font></a><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) transmissor de 433 MHz ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um kit como este</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) para modificar a exibi√ß√£o do tempo - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) Resistor de 1 kŒ© para o acoplador √≥ptico - 1 pc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Op√ß√µes: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface atualizada para o Nextion</font></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C√≥digo de teste (antes da integra√ß√£o com o KTSDV-12-2 e um conjunto completo de fun√ß√µes de servi√ßo, apenas para entender a linha de racioc√≠nio)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RCSwitch.h&gt; //   http://code.google.com/p/rc-switch/</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringTimeOut 40000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       2094</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openTimeOut 300000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    allowOpen        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetPin A3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    0</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openPin A4 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    (1)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin 7 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   (3)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringCode 360500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> doorBell 3395840 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openCode 255899 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openDelay 1500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetDelay 2500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> txPin 8</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ringTime, openTime; <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
boolean ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
boolean ringRepeat = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
boolean allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span><font></font>
<font></font>
RCSwitch mySwitch = RCSwitch();<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDoor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    <font></font>
    digitalWrite(handsetPin, LOW);<font></font>
    delay(handsetDelay);<font></font>
    digitalWrite(openPin, LOW);<font></font>
    delay(openDelay);<font></font>
    digitalWrite(openPin, HIGH);<font></font>
    digitalWrite(handsetPin, HIGH);<font></font>
    ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
    allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(37); //           </span></span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  mySwitch.enableTransmit(txPin); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  pinMode(handsetPin, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
  pinMode(openPin, OUTPUT);<font></font>
  pinMode(ringPin, INPUT_PULLUP  );<font></font>
  digitalWrite(handsetPin, HIGH); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  digitalWrite(openPin, HIGH);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ready"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(ringPin) == LOW &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//            </span></span>
    ring = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
    ringTime = millis();<font></font>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(36); //     </span></span>
    mySwitch.send(ringCode, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Sent ringCode"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ringRepeat == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
      mySwitch.send(doorBell, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
      Serial.println(<span class="hljs-string"><span class="hljs-string">"DoorBell repeat"</span></span>);<font></font>
    }<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring-ring!"</span></span>);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - ringTime) &gt; ringTimeOut &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   40  (   )    </span></span>
  ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring reset"</span></span>);
  <span class="hljs-comment"><span class="hljs-comment">// sendMail(38); //      </span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
  openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via net"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ""   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - openTime) &gt; openTimeOut) { <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
   allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; 
   <span class="hljs-comment"><span class="hljs-comment">// sendMail(39); //     </span></span><font></font>
  }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mySwitch.available()) { <span class="hljs-comment"><span class="hljs-comment">//</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = mySwitch.getReceivedValue();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
      Serial.println(mySwitch.getReceivedValue());<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mySwitch.getReceivedValue()) {<font></font>
        <font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> openCode: <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
            mySwitch.disableReceive();<font></font>
            openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
            Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via radio"</span></span>);<font></font>
            mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
          }<font></font>
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
    }<font></font>
    mySwitch.resetAvailable();<font></font>
  }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
}<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tirei as fotos para a interface no maravilhoso site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pixabay</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt400367/">https://habr.com/ru/post/pt400367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt400357/index.html">Google mostra padr√£o de caridade com tr√™s benef√≠cios</a></li>
<li><a href="../pt400359/index.html">Propriocep√ß√£o para n√£o especialistas. Parte 3. Din√¢mico sentado em uma cadeira</a></li>
<li><a href="../pt400361/index.html">Foreve Elon 2016/2017 (v√©spera de Ano Novo online)</a></li>
<li><a href="../pt400363/index.html">Mergulho profundo: de CSS a transistor</a></li>
<li><a href="../pt400365/index.html">O que promete aos usu√°rios do VKontakte em 2017</a></li>
<li><a href="../pt400371/index.html">2017 n√£o √© apenas um ...</a></li>
<li><a href="../pt400377/index.html">Vis√£o geral dos materiais 3D atuais</a></li>
<li><a href="../pt400379/index.html">Como organizamos a busca no Telegram e o que aconteceu. UPD: resumimos os resultados da competi√ß√£o</a></li>
<li><a href="../pt400381/index.html">Projetando uma fonte de alimenta√ß√£o de comuta√ß√£o com KKM ativo. Epis√≥dio I</a></li>
<li><a href="../pt400383/index.html">Reamostragem. Parede de tijolo digital contra a teoria da conspira√ß√£o. Conto de Natal para amantes de som n√≠tido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>