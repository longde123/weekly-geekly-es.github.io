<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>😉 🚙 👋🏼 O que fazer no fim de semana: interfone com controle remoto, Nextion com remapeamento sem orçamento, confronto com Onlaym ✍🏾 🕺🏻 😤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Às vezes, às sextas-feiras, a ficção é considerada aceitável aqui. Hoje, é claro, não é sexta-feira, mas não é ficção, mas três mini-romances que têm ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>O que fazer no fim de semana: interfone com controle remoto, Nextion com remapeamento sem orçamento, confronto com Onlaym</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400367/"><img src="https://habrastorage.org/files/044/f5f/30d/044f5f30df86463087940fff4fc4ba92.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Às vezes, às sextas-feiras, a ficção é considerada aceitável aqui. </font><font style="vertical-align: inherit;">Hoje, é claro, não é sexta-feira, mas não é ficção, mas três mini-romances que têm algo a ver com a minha vida. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Um leitor apressado também pode se perguntar que relações podem realmente conectar o interfone e o provedor de Internet. </font><font style="vertical-align: inherit;">E estará certo, porque eu também não vim imediatamente a isso. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas sobre tudo (Arduino, hacks banais, brigas telefônicas) em ordem.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sim-sim, abra!</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ser sincero, o controle remoto do interfone de acordo com a minha versão é quase inútil, e eu percebi isso antes mesmo de começar. Portanto, para justificar o empreendimento, tive que usar todo o poder da imaginação para apresentar alguns casos, como se costuma dizer. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para começar, decidi que dessa maneira deixaria os convidados se aquecerem na varanda, se ainda não tivesse conseguido correr para casa. Ou não me incomodo particularmente em obter as chaves com antecedência - afinal, você pode configurar o telefone para que ele dê um comando para abrir a porta quando chegar em casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para as pessoas comuns, isso parece bastante selvagem, mas, como eles dizem, per aspera ad astra.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E eu realmente queria, de alguma forma, usar alguns relés no gabinete, que estavam ociosos no controlador central desde o início de sua operação. A situação, de fato, é ridícula: naquela época havia apenas um bloco para 4 relés em mãos, dos quais apenas dois eram necessários. E como não queria esperar mais um mês pelo bloco de dois revezamentos, peguei o que estava à mão e imediatamente comecei a me preocupar com redundância. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No entanto, para os interfones. Em geral, a abertura automática de um sistema de interfone não é uma coisa exclusiva. Por exemplo, aqui no Geektimes, camarada </font><font style="vertical-align: inherit;">Em 2013 (quando o dólar tinha 30 anos), o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cluster</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> fazia não apenas um </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">controle remoto, mas também uma secretária eletrônica para os hóspedes</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa é de longe a coisa mais legal que eu já vi nessa classe. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas muito antes, os visitantes do RadioKota e muitos outros fóruns temáticos</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">se divertiu com dispositivos como "abridor"</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - desbloqueando o interfone imediatamente em uma chamada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu não ia repetir um ou outro. </font><font style="vertical-align: inherit;">O primeiro - porque é difícil, e porque eu já tinha um controlador em funcionamento, que planejava dar novos poderes. </font><font style="vertical-align: inherit;">A segunda, por razões mais óbvias: muitos detalhes e muito pouco senso, peço desculpas se ofendi os autores. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Sentido, é claro, para mim, e de maneira nenhuma. </font><font style="vertical-align: inherit;">Ou seja, categoricamente não gosto do esquema, que hospitalamente abre a porta para quem disca um número de apartamento. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Daí os requisitos básicos para o meu abridor: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Usando um controlador central para controlar via Internet e rádio </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Proteção mínima contra acesso não autorizado</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Interferência mínima no interior</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar</font></font></h3><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Comecei familiarizando-me com o princípio de operação do interfone, que peguei emprestado </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O tubo funciona de maneira muito simples: quando o tubo é colocado, ele tem uma resistência de 50 Ohms, quando o tubo é removido, a resistência é de aprox. </font><font style="vertical-align: inherit;">400 Ohm, quando o botão de liberação da trava é pressionado, a resistência é medida em quilo-ohms ... Quando não há chamada, não há tensão na linha. </font><font style="vertical-align: inherit;">Quando uma chamada é recebida e o telefone monta uma corrente grande e a tensão acaba sendo pequena de 5-7 V, quando o telefone está ausente e a resistência é chamada ao infinito e a tensão é máxima aprox. </font><font style="vertical-align: inherit;">15V quando o aparelho estiver desligado, aproximadamente 10V. </font><font style="vertical-align: inherit;">Quando o botão de tensão é pressionado, o máximo é de aprox. </font><font style="vertical-align: inherit;">15V - pressionar o botão significa quebra de linha.</font></font></blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No caso da Digital, isso é um pouco diferente, já que a documentação do aparelho, mas eu tinha o KM-2NO (a propósito, expresso minha gratidão à Digital por publicar o esquema) indica:</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. Consumo de corrente no modo "Talk" 18-22 mA </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2. Tensão da linha com um tubo instalado na caixa 1,5–2,5 V </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3. Tensão da linha com um tubo acima de 5,8-6,5 V</font></font><br>
</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, me familiarizei com mais detalhes com o diagrama de circuitos do meu tubo: </font></font><br>
<br>
<img src="https://habrastorage.org/files/b76/591/c8f/b76591c8f87c4eaca7a8bfec1f652f39.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
e descobri que tudo é exatamente o mesmo em termos de resistência e, provavelmente, o restante da lógica do Digital dificilmente é diferente da Visita. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Chamo a atenção para o fato de que minha modificação é sem LED. Mas isso acabou sendo correto, pois esse fato facilita a transmissão de informações de chamada para o controlador central. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja: a chamada soa, o LED "acende", o acoplador óptico liga, no pino do controlador, temos uma mudança de nível de alto para baixo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, em vez do LED, instalei meu acoplador óptico 4N35, cuja saída eu enviei diretamente para o Arduino. </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De acordo com o esquema padrão</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da mesma Internet:</font></font><br>
<br>
<img src="https://habrastorage.org/files/a7f/c39/9f8/a7fc399f840e4931b225370b2f21c3cd.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E como eu queria me familiarizar com o mínimo de detalhes e recursos disponíveis do controlador, dos quais os pinos digitais eram os mais valiosos (o Uno não era suficiente para eles), em vez de um resistor de pull-up de 10K, usei o resistor pull-up embutido do Arduino. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando conectado a um pino digital, fica assim:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT_PULLUP);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quando conectado a um pino analógico:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin _</span></span><font></font>
<font></font>
pinMode(ringPin, INPUT);<font></font>
digitalWrite(ringPin, HIGH);<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Eu decidi colocar o optron do microcontrolador. </font><font style="vertical-align: inherit;">Não posso justificar, mas achei que havia menos risco de falsos positivos de possíveis capturas. </font><font style="vertical-align: inherit;">É possível que ele esteja errado, mas até agora tudo está normal com dicas </font><font style="vertical-align: inherit;">eles não são. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quanto à terra no exemplo acima, você precisa entender: embora a terra pareça ser comum no diagrama, isso não é verdade - na verdade, existe realmente um isolamento optoeletrônico. </font><font style="vertical-align: inherit;">Bem, por isso ele é um exemplo.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Livre-se de mim!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A decisão de se livrar completamente dos circuitos de intercomunicação não veio imediatamente, mas inevitavelmente. A propósito, lembrei-me muito do caso de seis anos atrás, quando vi como um momento constrangedor com uma trava eletromagnética se formou durante a instalação de um ACS. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Não sei como aconteceu, mas o castelo funcionou de alguma forma. Aquele "rastreamento", então nada, e os próprios instaladores já quebraram a cabeça. Porém, no final, foi sugerido que eles tivessem um curto-circuito inesperado em algum lugar (ou algo parecido) nos circuitos de controle. Obviamente, verificamos tudo, é claro, sem muito sucesso, pois eles foram definidos claramente de acordo com as instruções. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O óleo foi adicionado ao fogo pelo fato de que exatamente a mesma trava estava exatamente na mesma configuração, mas funcionou muito bem no outro andar.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por quanto tempo, brevemente, eles decidiram que o assunto estava na própria porta, na qual a fechadura está presa. Na minha opinião, eles sugeriram que, quando foi instalado, eles grudaram na armadura, que, por sua vez, foi aterrada, o que levou a efeitos inesperados na trava (que, possivelmente, tinha uma trava de controle no gabinete). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em geral, eles resolveram muito tempo e tediosamente. E eu não queria repetir a mesma coisa em casa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, não salvei os fios e conectei os contatos do relé da maneira mais simples: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Normalmente um relé fechado - em série com o botão para cima SW1 (porque este botão está fechado no estado normal) </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Normalmente abra outro relé - em paralelo com o botão de abertura da porta SB1 ( porque este botão está normalmente aberto)</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os contatos de controle do relé, é claro, conectados aos pinos digitais livres (hooray, eles ainda eram) do microcontrolador. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No total, é fácil imaginar que foram necessários seis fios: dois para o acoplador óptico e mais quatro para o relé. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Peço desculpas pelo primitivismo da ilustração:</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Do intercomunicador</font></font></h4><br>
<img src="https://habrastorage.org/files/cfe/2f2/23c/cfe2f223cb2b4d49ad1b853482b3895a.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Por Arduino</font></font></h4><br>
<img src="https://habrastorage.org/files/c99/84f/e4b/c9984fe4be554b13b2ec17915ca86474.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os relés aqui são mostrados exclusivamente esquematicamente. </font><font style="vertical-align: inherit;">Como repito, usei módulos de relé prontos com enchimento completo - optoacopladores, transistores, diodos e assim por diante. </font><font style="vertical-align: inherit;">Eu recomendo fortemente não conectar relés nus ao Arduino.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... e não me ligue mais!</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Já nessa fase, eu era capaz de abrir com facilidade o interfone via Internet ou rede local a partir de um computador ou smartphone, de acordo com o seguinte princípio: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) No momento em que o interfone toca, o controlador entra no modo de permissão para abrir a porta por 40 segundos. O tempo é selecionado com base na documentação do interfone digital, onde é indicado que a duração do sinal de chamada é exatamente 40 segundos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
I.e. por mais tempo, não faz sentido permanecer aberto condicionalmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Após o recebimento de um comando aberto via Internet (HTTP POST), o controlador alterna seqüencialmente o relé. Primeiro, ele abre o relé do tubo, que simula sua ascensão. Depois de uma breve pausa, o relé do botão de abertura se fecha, simulando sua pressão. Depois - "libera" o botão e "desliga" o telefone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A bancada de testes era muito primitiva:</font></font><br>
<br>
<img src="https://habrastorage.org/files/3b5/44c/db1/3b544cdb17ab4f67953d7643d98e0156.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Seria possível parar com isso se eu, como orgulhoso proprietário do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTsDV-12-2,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> não soubesse o quão inconveniente é - correr pelo controle remoto ou pelo telefone toda vez que precisar ativar / desativar algo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E, em particular, se eu não tivesse terminado recentemente uma </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estação meteorológica de mesa com uma tela sensível ao toque</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e, ao que parece, não tivesse um potencial totalmente desenvolvido. </font></font><br>
<br>
<img src="https://habrastorage.org/files/90a/d36/f45/90ad36f45757421295f332c7425578fa.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em suma, rapidamente adicionei à estação meteorológica o transmissor de 433 MHz mais comum e vulgar com modulação de amplitude, cujas toneladas são vendidas no Aliexpress por dinheiro ridículo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como resultado, a estação meteorológica se tornou outro ponto de controle para o interfone e, portanto, se uma campainha tocar e você se sentar ao lado dela, não faz sentido interromper o telefone, pois diretamente na tela você pode:</font></font><br>
<br>
1)  <br>
<br>
2)      (    1,5   40  )   ,    — ,  <br>
<br>
3) «»  ( «»   «» )<br>
<br>
 , ,       ,     ,        (  —    ,    ).<br>
<br>
 ,        HAL. ,     ,   .    :   ,    ,     ,    material ,    :<br>
<br>
<img src="https://habrastorage.org/files/71a/154/0d4/71a1540d420441d3aa62d3ca673f3a43.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Essa tela substitui os dados climáticos quando o interfone toca: neste momento, o controlador central emite um comando de rádio, ao qual a tela meteorológica responde. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode ser um pouco ilógico aqui, mas a campainha no centro informa principalmente sobre a chamada de interfone. </font><font style="vertical-align: inherit;">Pressioná-lo (ilógico aqui) silencia o som do interfone da maneira mais bárbara - imitando o processo de levantar e abaixar o telefone. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O castelo à esquerda é a abertura do castelo. </font><font style="vertical-align: inherit;">Telefone à direita - pegue o telefone para simular o início de uma conversa. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A tela muda para a principal após 40 segundos desde o início da chamada e não imediatamente pressionando o botão ícone. </font><font style="vertical-align: inherit;">Isso permite que você pressione várias vezes se o controlador de repente não "ouviu" um comando, o que não é incomum, dado o tipo de canal de rádio usado.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algoritmos</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como mencionei, no começo eu era modesto e queria apenas uma coisa: abrir o interfone sob comando pelo telefone e no momento da ligação. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas, depois de alguns dias, percebi que ficar na frente do interfone e cutucar a tela é uma tarefa bastante chata, e é muito mais interessante permitir uma abertura "atrasada" quando você se aproxima da entrada. Resta apenas discar o número do apartamento no painel do interfone e pronto, a porta está aberta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por fim, pensei que, nessa situação, provavelmente faz sentido proibir a abertura - em geral. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mas então ele se recompôs, depois se soltou, pegou uma ferramenta mais útil, popularmente chamada de navalha de Occam, e rapidamente se livrou de entidades desnecessárias. Ou seja: desde que eu estava fazendo o controle remoto, não era para desligá-lo. Portanto - o desligamento não é necessário.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em segundo lugar, de acordo com o pensamento sóbrio (e não como de costume), descobriu-se que não havia diferença especial entre a abertura por um comando imediatamente no momento da chamada ou por um determinado comando. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Finalmente, voltando à ergonomia do controle, quero dizer que quanto mais modos - menos pessoas comuns os usarão. Sim, sou aborrecido, mas como imaginei ter três modos para diferentes ocasiões, percebi que ainda usaria um. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Portanto, o modo é um e o comando é um, e existem dois processadores: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) Se o interfone tocar, o controlador permitirá a abertura dentro de 40 segundos desde o início da chamada.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Se o comando de abertura é recebido primeiro, o controlador permite a abertura e aguarda uma chamada dentro de N minutos a partir do momento em que o comando foi recebido (isto é, para preparar o interfone para abertura no caminho para a casa). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pode haver duas fontes do comando de abertura: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) HTTP POST- uma solicitação por meio de uma rede local ou da Internet (por exemplo: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">myserver.com/?sim-sim-openup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), ou seja, você pode abrir pelo menos a partir de Kuala Lumpur </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) O comando de rádio nos painéis ou botões da casa (na minha implementação, </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">através da biblioteca RC-Switch</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E como toda a estrutura está conectada ao aparelho sem afetar seu funcionamento, o intercomunicador pode continuar a ser usado da maneira usual (botão do fone de mão com oi-oi-oi), ou seja, </font><font style="vertical-align: inherit;">doméstico, incapaz de apreciar os méritos do progresso tecnológico e não precisa se aprofundar nos detalhes.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bônus repentinos</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mesmo que você não use a função de abridor de portas, agora o controlador notifica regularmente que alguém está arranhando a porta da entrada pelo interfone. </font><font style="vertical-align: inherit;">Para mim, como pessoa curiosa, essa informação não é de interesse - e agora eu a recebo regularmente. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mais importante, essa função continua funcionando mesmo que você desligue o fone do interfone com o interruptor. </font><font style="vertical-align: inherit;">Potencialmente, isso significa que agora há menos chances de deixar o intercomunicador desativado, se você precisar excluir temporariamente a possibilidade de suas chamadas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Infelizmente, o circuito do intercomunicador é tal que, quando desligado, torna-se impossível controlar remotamente a trava (parece que a unidade central considera que, nesse caso, o telefone está “desligado”, independentemente de sua posição atual).</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E paisagismo</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como eu estava buscando uma interferência mínima no interior, tive que tomar uma decisão sobre como me conectar ao controlador central, com base no fato de que o controlador e o interfone estavam em lados diferentes da porta e o controlador tinha eletricidade, mas o interfone não. </font></font><br>
<br>
<img src="https://habrastorage.org/files/7b6/8e8/6c3/7b68e86c3aab453e8fcbc579149f4e2a.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No final, decidi que seria melhor esticar o cabo atrás da moldura da porta e fechar seus fragmentos com painéis decorativos impressos em uma impressora 3D do que ocupar outra tomada com uma fonte de alimentação, não está claro como puxar o fio para o monofone do interfone e bloquear o canal de rádio entre o monofone e o controlador. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e65/a91/84a/e65a9184ab9d4cb29e84e515689e607e.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E acho que nas minhas condições essa é a melhor opção. </font><font style="vertical-align: inherit;">Sim, e o revezamento entrou no negócio, mas com um canal de rádio - novamente teria permanecido em reserva.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remapeando a Nextion</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Falando sobre a exibição do tempo na área de trabalho (estação meteorológica, se você quiser), mencionei que durante o processo de acabamento, consegui danificar o componente principal - a própria tela de toque do Nextion. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A falha não afetou a operação do microcontrolador de bordo e a exibição de dados, mas o painel de toque quase falhou. No entanto, experimentalmente, descobri que, mesmo que você não exerça muita pressão no painel do Nextion em um determinado local, dessa maneira você pode restaurar a sensibilidade da metade esquerda (aproximadamente) da tela. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Esse truque funciona instável e nem sempre, mas com frequência suficiente para que eu possa atendê-lo, pensando em pedir uma nova tela.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Claro, isso me deixou feliz e triste. Por um lado, foi possível obter operabilidade parcial. Por outro lado, eu gostaria de jogar um pouco mais com as paradas. E, de repente, percebi em que armadilha idiota caí: por algum motivo, fiquei obcecado em usar toda a área da tela, quando podia transferir livremente os botões "não funcionantes" para a área de trabalho. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Entendo que, para muitos, é realmente uma decisão banal. Mas gostaria de compartilhar alegria inocente com aqueles que, como eu, gostam de ir ao extremo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então, eu descobri, mudei um pouco o tamanho dos botões, desenhei um novo circuito de controle virtual na minha cabeça e pronto! Restauramos quase completamente a funcionalidade de uma tela parcialmente morta. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi: </font></font><br>
<br>
<img src="https://habrastorage.org/files/8cb/774/fc0/8cb774fc06b444ce994ad1470e7319d8.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tornou-se:</font></font><br>
<br>
<img src="https://habrastorage.org/files/202/2b8/82f/2022b882fd2245a79cc4fae8514ddde5.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ao longo do caminho, no entanto, tive que matar um perfeccionista em mim e refazer a tela de controle do interfone da tela original para uma minimamente funcional:</font></font><br>
<br>
<img src="https://habrastorage.org/files/bd2/bec/a58/bd2beca5810346c5a99099e1ac046288.png"><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ao vivo</font></font></h4><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/P6Iqh6SYVRU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quando o suporte técnico não é ale</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parece que, em todos esses altos e baixos, seria possível concluir, se não fosse um detalhe: de repente, descobri que o interfone (e atrás dele o restante da automação) deixou de ser controlado ao acessar a partir de redes externas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ou seja, todos os comandos funcionavam perfeitamente quando conectados à Internet através da rede doméstica e a endereços externos (e não de acordo com o tipo interno 192.xxx.xxx.xxx), mas eles se recusavam igualmente a ser executados a partir das redes de outros operadores (tentei dois). </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Você deve entender imediatamente que os comandos são transmitidos por meio de uma solicitação HTTP para uma porta externa específica do roteador e, a partir daí, eles já são redirecionados para o IP e a porta internos necessários.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
E esse esquema funcionou sem os menores problemas desde o seu lançamento em 2013 até que algo quebrou no atual. E ainda tenho certeza de que não é minha culpa. Mas não sei como verificar. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, no começo eu queria xingar a Beeline, porque inicialmente pensei que o problema estava na Internet móvel. Mas então eu me recompus, encontrei outro provedor, tentei e descobri que através dele o mesmo problema. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Então liguei para Onlaym e, como pude, expliquei a essência das alegações. E em resposta, eles me explicaram popularmente que:</font></font><br>
<br>
<blockquote>               :<br>
TCP/25 –  -;<br>
TCP/135-139, TCP/445  UDP/135-139 –   ,    MS Windows;<br>
TCP/23, TCP/161, UDP/69  UDP/161–   .<br>
 <br>
  ,  ,  .</blockquote><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por sua vez, insisti que minha porta a) não se enquadra nesse intervalo, b) não funciona como esperado ec) não mudei nada. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Que tal uma parede de ervilhas. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Bem, o que devo fazer, expliquei educadamente que, embora entenda que meus infelizes 450 rublos por mês não causam o tempo para eles, vou de tal absurdo procurar o mesmo absurdo, mas pelo menos funciona. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em resposta, eles murmuraram novamente que estavam me fornecendo IP e todos os meus problemas. Bem meu, decidi, depois meu. E por uma decisão decidida, verifiquei primeiro a operabilidade do sistema em outra porta (transferida para uma unidade) - funciona. E então ele fez uma configuração flexível do número da porta no Tasker, através do qual, de fato, o volante é automático.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Na verdade, ao que descrevo meus sofrimentos: objetivamente, eu realmente queria entender quem estava errado em tal situação. </font><font style="vertical-align: inherit;">Porque me sinto um completo idiota - reiniciei o roteador e verifiquei as configurações (além disso, por minha própria iniciativa, e não por solicitação de "especialistas"), e ainda assim eles me mandaram para o inferno, sugerindo minhas mãos tortas.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fora da tela</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Em conclusão, que usei para a construção do século: </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
1) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KTSDV-12-2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
2) Telefone portátil Digital KM-2NO - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
3) Optoacoplador 4N35 - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
4) Cabo plano de 10 núcleos (usado seis, mas coloque tudo - apenas no caso) - 3 m. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
5) Conectores ao cabo - 2 peças. </font><font style="vertical-align: inherit;">pais e mães </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
6) </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitor climático</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> caseiro </font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;">com tela sensível ao toque Nextion</font></a><font style="vertical-align: inherit;"> - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
7) transmissor de 433 MHz ( </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">de um kit como este</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) para modificar a exibição do tempo - 1 pc. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
8) Resistor de 1 kΩ para o acoplador óptico - 1 pc. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Opções: </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface atualizada para o Nextion</font></font></a><br>
<br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Código de teste (antes da integração com o KTSDV-12-2 e um conjunto completo de funções de serviço, apenas para entender a linha de raciocínio)</font></font></b><div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;RCSwitch.h&gt; //   http://code.google.com/p/rc-switch/</span></span></span></span><font></font>
<font></font>
<font></font>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringTimeOut 40000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       2094</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openTimeOut 300000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    allowOpen        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetPin A3 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    0</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openPin A4 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    (1)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringPin 7 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   (3)</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ringCode 360500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> doorBell 3395840 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//       </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openCode 255899 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> openDelay 1500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> handsetDelay 2500 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//    </span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> txPin 8</span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> ringTime, openTime; <span class="hljs-comment"><span class="hljs-comment">//    </span></span>
boolean ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>;<font></font>
boolean ringRepeat = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
boolean allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//     </span></span><font></font>
<font></font>
RCSwitch mySwitch = RCSwitch();<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//  </span></span>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openDoor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
    <font></font>
    digitalWrite(handsetPin, LOW);<font></font>
    delay(handsetDelay);<font></font>
    digitalWrite(openPin, LOW);<font></font>
    delay(openDelay);<font></font>
    digitalWrite(openPin, HIGH);<font></font>
    digitalWrite(handsetPin, HIGH);<font></font>
    ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
    allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(37); //           </span></span><font></font>
}<font></font>
<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);<font></font>
  mySwitch.enableTransmit(txPin); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  pinMode(handsetPin, OUTPUT); <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
  pinMode(openPin, OUTPUT);<font></font>
  pinMode(ringPin, INPUT_PULLUP  );<font></font>
  digitalWrite(handsetPin, HIGH); <span class="hljs-comment"><span class="hljs-comment">//  </span></span><font></font>
  digitalWrite(openPin, HIGH);<font></font>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ready"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<font></font>
  <font></font>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(ringPin) == LOW &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//            </span></span>
    ring = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    </span></span><font></font>
    ringTime = millis();<font></font>
    <span class="hljs-comment"><span class="hljs-comment">// sendMail(36); //     </span></span>
    mySwitch.send(ringCode, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Sent ringCode"</span></span>);
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ringRepeat == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//      </span></span>
      mySwitch.send(doorBell, <span class="hljs-number"><span class="hljs-number">24</span></span>);<font></font>
      Serial.println(<span class="hljs-string"><span class="hljs-string">"DoorBell repeat"</span></span>);<font></font>
    }<font></font>
    Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring-ring!"</span></span>);<font></font>
  }<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - ringTime) &gt; ringTimeOut &amp;&amp; ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//   40  (   )    </span></span>
  ring = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Ring reset"</span></span>);
  <span class="hljs-comment"><span class="hljs-comment">// sendMail(38); //      </span></span><font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
  openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
  Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via net"</span></span>);<font></font>
}<font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">false</span></span> &amp;&amp; allowOpen == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//  ""   </span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((millis() - openTime) &gt; openTimeOut) { <span class="hljs-comment"><span class="hljs-comment">//       </span></span>
   allowOpen = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; 
   <span class="hljs-comment"><span class="hljs-comment">// sendMail(39); //     </span></span><font></font>
  }<font></font>
  <font></font>
}<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mySwitch.available()) { <span class="hljs-comment"><span class="hljs-comment">//</span></span>
    <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value = mySwitch.getReceivedValue();
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value != <span class="hljs-number"><span class="hljs-number">0</span></span>) {<font></font>
      Serial.println(mySwitch.getReceivedValue());<font></font>
      <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mySwitch.getReceivedValue()) {<font></font>
        <font></font>
        <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> openCode: <span class="hljs-comment"><span class="hljs-comment">//   </span></span>
          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ring == <span class="hljs-literal"><span class="hljs-literal">true</span></span>) {<font></font>
            mySwitch.disableReceive();<font></font>
            openDoor(); <span class="hljs-comment"><span class="hljs-comment">//  </span></span>
            Serial.println(<span class="hljs-string"><span class="hljs-string">"Door opened via radio"</span></span>);<font></font>
            mySwitch.enableReceive(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
          }<font></font>
          <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
    }<font></font>
    mySwitch.resetAvailable();<font></font>
  }<font></font>
<font></font>
<span class="hljs-comment"><span class="hljs-comment">//   </span></span><font></font>
}<font></font>
<font></font>
}<font></font>
<font></font>
<font></font>
<font></font>
</code></pre><br>
</div></div><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tirei as fotos para a interface no maravilhoso site </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pixabay</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt400367/">https://habr.com/ru/post/pt400367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt400357/index.html">Google mostra padrão de caridade com três benefícios</a></li>
<li><a href="../pt400359/index.html">Propriocepção para não especialistas. Parte 3. Dinâmico sentado em uma cadeira</a></li>
<li><a href="../pt400361/index.html">Foreve Elon 2016/2017 (véspera de Ano Novo online)</a></li>
<li><a href="../pt400363/index.html">Mergulho profundo: de CSS a transistor</a></li>
<li><a href="../pt400365/index.html">O que promete aos usuários do VKontakte em 2017</a></li>
<li><a href="../pt400371/index.html">2017 não é apenas um ...</a></li>
<li><a href="../pt400377/index.html">Visão geral dos materiais 3D atuais</a></li>
<li><a href="../pt400379/index.html">Como organizamos a busca no Telegram e o que aconteceu. UPD: resumimos os resultados da competição</a></li>
<li><a href="../pt400381/index.html">Projetando uma fonte de alimentação de comutação com KKM ativo. Episódio I</a></li>
<li><a href="../pt400383/index.html">Reamostragem. Parede de tijolo digital contra a teoria da conspiração. Conto de Natal para amantes de som nítido</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>