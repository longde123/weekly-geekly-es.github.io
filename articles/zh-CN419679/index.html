<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ® ğŸ’¬ ğŸ“‰ ä»å¤´å¼€å§‹å®ç°Spring Framework APIã€‚ åˆå­¦è€…å…¥é—¨ã€‚ ç¬¬ä¸€éƒ¨åˆ† ğŸ§“ ğŸ“¼ ğŸ‘¨ğŸ¼â€ğŸ“</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Springæ¡†æ¶æ˜¯æœ€å¤æ‚çš„ç†è§£å’Œå­¦ä¹ æ¡†æ¶ä¹‹ä¸€ã€‚ å¤§å¤šæ•°å¼€å‘äººå‘˜é€šè¿‡å®é™…ä»»åŠ¡å’ŒGoogleæ…¢æ…¢å­¦ä¹ å®ƒã€‚ è¿™ç§æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºå®ƒä¸èƒ½æä¾›å®Œæ•´çš„å›¾åƒï¼ŒåŒæ—¶åˆå¾ˆæ˜‚è´µã€‚ 

 æˆ‘æƒ³ä¸ºæ‚¨æä¾›ä¸€ç§å…¨æ–°çš„æ˜¥å­£å­¦ä¹ æ–¹æ³•ã€‚ å®ƒåŒ…å«ä»¥ä¸‹äº‹å®ï¼šä¸€ä¸ªäººè¦ç»è¿‡ä¸€ç³»åˆ—ä¸“é—¨å‡†å¤‡çš„æ•™ç¨‹å¹¶ç‹¬ç«‹å®ç°springçš„åŠŸèƒ½ã€‚ è¿™ç§æ–¹æ³•çš„ç‹¬ç‰¹...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä»å¤´å¼€å§‹å®ç°Spring Framework APIã€‚ åˆå­¦è€…å…¥é—¨ã€‚ ç¬¬ä¸€éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419679/"><img src="https://habrastorage.org/webt/iw/mz/82/iwmz824_ptetkxwvc6sqtwjmbjw.png"><br><br>  Springæ¡†æ¶æ˜¯æœ€å¤æ‚çš„ç†è§£å’Œå­¦ä¹ æ¡†æ¶ä¹‹ä¸€ã€‚ å¤§å¤šæ•°å¼€å‘äººå‘˜é€šè¿‡å®é™…ä»»åŠ¡å’ŒGoogleæ…¢æ…¢å­¦ä¹ å®ƒã€‚ è¿™ç§æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºå®ƒä¸èƒ½æä¾›å®Œæ•´çš„å›¾åƒï¼ŒåŒæ—¶åˆå¾ˆæ˜‚è´µã€‚ <br><br> æˆ‘æƒ³ä¸ºæ‚¨æä¾›ä¸€ç§å…¨æ–°çš„æ˜¥å­£å­¦ä¹ æ–¹æ³•ã€‚ å®ƒåŒ…å«ä»¥ä¸‹äº‹å®ï¼šä¸€ä¸ªäººè¦ç»è¿‡ä¸€ç³»åˆ—ä¸“é—¨å‡†å¤‡çš„æ•™ç¨‹å¹¶ç‹¬ç«‹å®ç°springçš„åŠŸèƒ½ã€‚ è¿™ç§æ–¹æ³•çš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºï¼Œé™¤äº†å¯¹Springçš„å·²ç ”ç©¶æ–¹é¢æœ‰100ï¼…çš„äº†è§£å¤–ï¼Œå®ƒè¿˜æå¤§åœ°æé«˜äº†Java Coreï¼ˆæ³¨é‡Šï¼Œåå°„ï¼Œæ–‡ä»¶ï¼Œæ³›å‹ï¼‰ã€‚ <br><br> è¿™ç¯‡æ–‡ç« å°†ä¸ºæ‚¨å¸¦æ¥éš¾å¿˜çš„ä½“éªŒï¼Œå¹¶ä½¿æ‚¨æ„Ÿè§‰åƒæ˜¯Pivotalå¼€å‘äººå‘˜ã€‚ é€æ­¥ï¼Œæ‚¨å°†ä½¿æ‚¨çš„ç±»beanå¹¶ç»„ç»‡å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼ˆä¸çœŸæ­£çš„æ˜¥å­£ç›¸åŒï¼‰ã€‚ æ‚¨å°†å®ç°çš„ç±»æ˜¯<b>BeanFactory</b> ï¼Œ <b>Component</b> ï¼Œ <b>Service</b> ï¼Œ <b>BeanPostProcessor</b> ï¼Œ <b>BeanNameAware</b> ï¼Œ <b>BeanFactoryAware</b> ï¼Œ <b>InitializingBean</b> ï¼Œ <b>PostConstruct</b> ï¼Œ <b>PreDestroy</b> ï¼Œ <b>DisposableBean</b> ï¼Œ <b>ApplicationContext</b> ï¼Œ <b>ApplicationListener</b> ï¼Œ <b>ContextClosedEvent</b> ã€‚ <br><a name="habracut"></a><br><h2> å…³äºä½ è‡ªå·±çš„ä¸€ç‚¹ </h2><br> æˆ‘çš„åå­—å«Yaroslavï¼Œæˆ‘æ˜¯ä¸€ä½æœ‰4å¹´ç»éªŒçš„Javaå¼€å‘äººå‘˜ã€‚ ç›®å‰ï¼Œæˆ‘åœ¨EPAM Systemsï¼ˆSPBï¼‰å·¥ä½œï¼Œå¹¶æ·±å…¥ç ”ç©¶äº†æˆ‘ä»¬ä½¿ç”¨çš„æŠ€æœ¯ã€‚ æˆ‘ç»å¸¸ä¸å¾—ä¸åº”å¯¹æ˜¥å­£é—®é¢˜ï¼Œè€Œä¸”æˆ‘åœ¨æ˜¥å­£ä¸­çœ‹åˆ°â€‹â€‹å¯ä»¥æˆé•¿çš„ä¸­é—´åœ°å¸¦ï¼ˆæ¯ä¸ªäººéƒ½éå¸¸äº†è§£Javaï¼Œå¹¶ä¸”ç‰¹å®šçš„å·¥å…·å’ŒæŠ€æœ¯å¯ä»¥æ¥å»å»ï¼‰ã€‚ <br><br> å‡ ä¸ªæœˆå‰ï¼Œæˆ‘é€šè¿‡äº†Spring Professional v5.0è®¤è¯ï¼ˆä¸å‚åŠ è¯¾ç¨‹ï¼‰ã€‚ ä¹‹åï¼Œæˆ‘æƒ³åˆ°äº†å¦‚ä½•æ•™åˆ«äººå¼¹è·³ã€‚ ä¸å¹¸çš„æ˜¯ï¼Œç›®å‰æ²¡æœ‰æœ‰æ•ˆçš„æ•™å­¦æ–¹æ³•ã€‚ å¤§å¤šæ•°å¼€å‘äººå‘˜å¯¹æ¡†æ¶åŠå…¶åŠŸèƒ½éƒ½æœ‰å¾ˆè‚¤æµ…çš„æƒ³æ³•ã€‚ ä»è®­ç»ƒçš„è§’åº¦æ¥çœ‹ï¼Œè°ƒè¯•å¼¹ç°§æºå¤ªå›°éš¾äº†ï¼Œè€Œä¸”ç»å¯¹æ²¡æœ‰æ•ˆæœï¼ˆæˆ‘å¯¹æ­¤æœ‰ç‚¹å–œæ¬¢ï¼‰ã€‚ åš10ä¸ªé¡¹ç›®ï¼Ÿ æ˜¯çš„ï¼Œåœ¨æŸä¸ªåœ°æ–¹æ‚¨å¯ä»¥åŠ æ·±çŸ¥è¯†å¹¶è·å¾—è®¸å¤šå®è·µç»éªŒï¼Œä½†æ˜¯â€œå¹•åâ€çš„è®¸å¤šå†…å®¹æ°¸è¿œéƒ½ä¸ä¼šåœ¨æ‚¨é¢å‰å‡ºç°ã€‚ é˜…è¯»Spring in Actionï¼Ÿ å¾ˆé…·ï¼Œä½†æ˜¯å·¥ä½œæˆæœ¬å¾ˆé«˜ã€‚ æˆ‘å·²ç»å®Œæˆäº†40ï¼…çš„å·¥ä½œï¼ˆåœ¨å‡†å¤‡è®¤è¯è¿‡ç¨‹ä¸­ï¼‰ï¼Œä½†è¿™å¹¶ä¸å®¹æ˜“ã€‚ <br><br> æœ€ç»ˆç†è§£æŸä»¶äº‹çš„å”¯ä¸€æ–¹æ³•æ˜¯è‡ªå·±å¼€å‘å®ƒã€‚ æœ€è¿‘ï¼Œæˆ‘æƒ³åˆ°æ‚¨å¯ä»¥å¸¦é¢†ä¸€ä¸ªäººå®Œæˆä¸€ä¸ªæœ‰è¶£çš„æ•™ç¨‹ï¼Œè¯¥æ•™ç¨‹å°†ç›‘ç£å…¶DIæ¡†æ¶çš„å¼€å‘ã€‚ å…¶ä¸»è¦ç‰¹å¾æ˜¯è¯¥APIå°†ä¸æ­£åœ¨ç ”ç©¶çš„APIä¸€è‡´ã€‚ è¿™ç§æ–¹æ³•çš„å‡ºè‰²ä¹‹å¤„åœ¨äºï¼Œé™¤äº†å¯¹å¼¹ç°§æœ‰æ·±åˆ»çš„ç†è§£ï¼ˆæ²¡æœ‰ç©ºæ ¼ï¼‰ä¹‹å¤–ï¼Œä¸€ä¸ªäººè¿˜å°†åœ¨Java Coreä¸­è·å¾—å¤§é‡çš„ç»éªŒã€‚ å¦ç™½è¯´ï¼Œæˆ‘è‡ªå·±åœ¨æ’°å†™æœ¬æ–‡æ—¶åœ¨Springå’ŒJava Coreä¸Šå­¦åˆ°äº†å¾ˆå¤šæ–°ä¸œè¥¿ã€‚ è®©æˆ‘ä»¬å¼€å§‹å¼€å‘ï¼ <br><br><h2> ä»å¤´å¼€å§‹ </h2><br> å› æ­¤ï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯æ‰“å¼€æ‚¨å–œæ¬¢çš„IDEå¹¶ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚ æˆ‘ä»¬ä¸ä¼šè¿æ¥ä»»ä½•Mavenæˆ–ä»»ä½•ç¬¬ä¸‰æ–¹åº“ã€‚ æˆ‘ä»¬ç”šè‡³éƒ½ä¸ä¼šè¿æ¥Springä¾èµ–é¡¹ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¼€å‘ä¸Spring APIæœ€ç›¸ä¼¼çš„APIï¼Œå¹¶è‡ªå·±å®ç°ã€‚ <br><br> åœ¨ä¸€ä¸ªå¹²å‡€çš„é¡¹ç›®ä¸­ï¼Œåˆ›å»º2ä¸ªä¸»è¦åŒ…ã€‚ ç¬¬ä¸€ä¸ªåŒ…æ˜¯æ‚¨çš„åº”ç”¨ç¨‹åºï¼ˆ <code>com.kciray</code> ï¼‰ï¼Œå¹¶ä¸”åœ¨å…¶ä¸­æ˜¯<code>Main.java</code>ç±»ã€‚ ç¬¬äºŒä¸ªè½¯ä»¶åŒ…æ˜¯org.springframeworkã€‚ æ˜¯çš„ï¼Œæˆ‘ä»¬å°†å¤åˆ¶åŸå§‹springçš„åŒ…ç»“æ„ï¼Œå…¶ç±»çš„åç§°åŠå…¶æ–¹æ³•ã€‚ æœ‰ä¸€ä¸ªå¦‚æ­¤æœ‰è¶£çš„æ•ˆæœ-å½“æ‚¨åˆ›å»ºè‡ªå·±çš„ä¸œè¥¿æ—¶ï¼Œæ‚¨è‡ªå·±çš„ä¸œè¥¿ä¼¼ä¹å¼€å§‹å˜å¾—ç®€å•æ˜“æ‡‚ã€‚ ç„¶åï¼Œå½“æ‚¨åœ¨å¤§å‹é¡¹ç›®ä¸­å·¥ä½œæ—¶ï¼Œæ‚¨ä¼¼ä¹ä¼šæ ¹æ®å·¥ä»¶åœ¨æ­¤å¤„åˆ›å»ºæ‰€æœ‰å†…å®¹ã€‚ è¿™ç§æ–¹æ³•å¯¹äºæ•´ä½“ç†è§£ç³»ç»Ÿï¼Œæ”¹è¿›ç³»ç»Ÿï¼Œä¿®å¤é”™è¯¯ï¼Œè§£å†³é—®é¢˜ç­‰å…·æœ‰éå¸¸ç§¯æçš„ä½œç”¨ã€‚ <br><br> å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜ï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œè¿›è¡Œ</a>å·¥ä½œã€‚ <br><br><h2> åˆ›å»ºä¸€ä¸ªå®¹å™¨ </h2><br> é¦–å…ˆï¼Œè®¾ç½®ä»»åŠ¡ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªç±»<code>ProductFacade</code>å’Œ<code>PromotionService</code> ã€‚ ç°åœ¨ï¼Œå‡è®¾æ‚¨æƒ³å°†è¿™äº›ç±»å½¼æ­¤è¿æ¥ï¼Œä½†æ˜¯è¿™äº›ç±»æœ¬èº«å½¼æ­¤ä¹‹é—´å¹¶ä¸äº†è§£ï¼ˆæ¨¡å¼DIï¼‰ã€‚ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥ç®¡ç†æ‰€æœ‰è¿™äº›ç±»å¹¶ç¡®å®šå®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚ æˆ‘ä»¬ç§°å®ƒä¸ºå®¹å™¨ã€‚ è®©æˆ‘ä»¬åˆ›å»º<code>Container</code>ç±»...å°½ç®¡ä¸ï¼Œè¯·è€å¿ƒç­‰å¾…ï¼  Springæ²¡æœ‰å•ä¸ªå®¹å™¨ç±»ã€‚ æˆ‘ä»¬æœ‰å¾ˆå¤šå®¹å™¨å®ç°ï¼Œæ‰€æœ‰è¿™äº›å®ç°éƒ½å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹-binå·¥å‚å’Œä¸Šä¸‹æ–‡ã€‚  binå·¥å‚åˆ›å»ºbeanå¹¶å°†å®ƒä»¬é“¾æ¥åœ¨ä¸€èµ·ï¼ˆä¾èµ–æ³¨å…¥ï¼ŒDIï¼‰ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡æ‰§è¡Œçš„æ“ä½œå¤§è‡´ç›¸åŒï¼Œæ­¤å¤–è¿˜æ·»åŠ äº†ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼ˆä¾‹å¦‚ï¼Œå¯¹æ¶ˆæ¯è¿›è¡Œå›½é™…åŒ–ï¼‰ã€‚ ä½†æ˜¯æˆ‘ä»¬ç°åœ¨ä¸éœ€è¦è¿™äº›é™„åŠ åŠŸèƒ½ï¼Œå› æ­¤æˆ‘ä»¬å°†ä¸åƒåœ¾ç®±å·¥å‚ä¸€èµ·å·¥ä½œã€‚ <br><br> åˆ›å»ºä¸€ä¸ªæ–°çš„<code>BeanFactory</code>ç±»ï¼Œå¹¶å°†å…¶æ”¾å…¥<code>org.springframework.beans.factory</code>åŒ…ä¸­ã€‚ è®©<code>Map&lt;String, Object&gt; singletons</code>å­˜å‚¨åœ¨æ­¤ç±»å†…ï¼Œå…¶ä¸­binçš„<code>id</code>æ˜ å°„åˆ°binæœ¬èº«ã€‚ å‘å…¶æ·»åŠ <code>Object getBean(String beanName)</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æŒ‰æ ‡è¯†ç¬¦æå–beanã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String, Object&gt; singletons = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String beanName)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> singletons.get(beanName); } }</code> </pre> <br> è¯·æ³¨æ„ï¼Œ <code>BeanFactory</code>å’Œ<code>FactoryBean</code>æ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚ ç¬¬ä¸€ä¸ªæ˜¯åƒåœ¾ç®±å·¥å‚ï¼ˆå®¹å™¨ï¼‰ï¼Œç¬¬äºŒä¸ªæ˜¯åƒåœ¾ç®±å·¥å‚ï¼Œå®ƒä½äºå®¹å™¨å†…éƒ¨ï¼Œè¿˜ç”Ÿäº§åƒåœ¾ç®±ã€‚ å·¥å‚å†…å·¥å‚ã€‚ å¦‚æœæ‚¨å¯¹è¿™äº›å®šä¹‰æ„Ÿåˆ°å›°æƒ‘ï¼Œæ‚¨å¯èƒ½è¿˜è®°å¾—åœ¨è‹±è¯­ä¸­ç¬¬äºŒä¸ªåè¯æ˜¯å¼€å¤´çš„åè¯ï¼Œç¬¬ä¸€ä¸ªåè¯æ˜¯å½¢å®¹è¯ã€‚ åœ¨Bean <b>Factoryä¸­ï¼Œ</b>ä¸»è¦è¯æ˜¯factoryï¼›åœ¨Factory <b>Beanä¸­</b> ï¼Œä¸»è¦è¯æ˜¯beanã€‚ <br><br> ç°åœ¨ï¼Œåˆ›å»º<code>ProductService</code>å’Œ<code>PromotionsService</code>ç±»ã€‚  <code>ProductService</code>å°†ä»æ•°æ®åº“ä¸­è¿”å›äº§å“ï¼Œä½†æ˜¯åœ¨æ­¤ä¹‹å‰ï¼Œæ‚¨éœ€è¦æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•æŠ˜æ‰£ï¼ˆä¿ƒé”€ï¼‰é€‚ç”¨äºæ­¤äº§å“ã€‚ åœ¨ç”µå­å•†åŠ¡ä¸­ï¼Œæ‰“æŠ˜å·¥ä½œé€šå¸¸åˆ†é…ç»™å•ç‹¬çš„æœåŠ¡ç±»åˆ«ï¼ˆæœ‰æ—¶åˆ†é…ç»™ç¬¬ä¸‰æ–¹WebæœåŠ¡ï¼‰ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PromotionsService</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PromotionsService promotionsService; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PromotionsService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPromotionsService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promotionsService; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPromotionsService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PromotionsService promotionsService)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.promotionsService = promotionsService; } }</code> </pre><br> ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿å®¹å™¨ï¼ˆ <code>BeanFactory</code> ï¼‰æ£€æµ‹åˆ°æˆ‘ä»¬çš„ç±»ï¼Œä¸ºæˆ‘ä»¬åˆ›å»ºå®ƒä»¬ï¼Œç„¶åå°†å…¶ä¸­ä¸€ä¸ªæ³¨å…¥å¦ä¸€ä¸ªã€‚ è¯¸å¦‚<code>new ProductService()</code>åº”ä½äºå®¹å™¨å†…éƒ¨ï¼Œå¹¶ç”±å¼€å‘äººå‘˜å®Œæˆã€‚ è®©æˆ‘ä»¬ä½¿ç”¨æœ€ç°ä»£çš„æ–¹æ³•ï¼ˆç±»æ‰«æå’Œæ³¨é‡Šï¼‰ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>@Component</code>åˆ›å»ºä¸€ä¸ª<code>@Component</code>æ‰¹æ³¨ï¼ˆ <code> org.springframework.beans.factory.stereotype</code> ï¼‰ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Component { }</code> </pre><br> é»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºè¿è¡Œæ—¶ï¼ˆ <code>RetentionPolicy.CLASS</code> ï¼‰ä¸ä¼šå°†æ³¨é‡ŠåŠ è½½åˆ°å†…å­˜ä¸­ã€‚ æˆ‘ä»¬é€šè¿‡æ–°çš„ä¿ç•™ç­–ç•¥ï¼ˆ <code>RetentionPolicy.RUNTIME</code> ï¼‰æ›´æ”¹äº†æ­¤è¡Œä¸ºã€‚ <br><br> ç°åœ¨ï¼Œåœ¨<code>ProductService</code>ç±»ä¹‹å‰å’Œ<code>PromotionService</code>ä¹‹å‰æ·»åŠ <code>@Component</code> ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... } @Component public class PromotionService { //... }</span></span></code> </pre> <br><br> æˆ‘ä»¬éœ€è¦<code>BeanFactory</code>æ‰«æåŒ…ï¼ˆ <code>com.kciray</code> ï¼‰å¹¶åœ¨å…¶ä¸­æŸ¥æ‰¾<code>@Component</code>æ³¨é‡Šçš„<code>@Component</code> ã€‚ è¿™ä¸ªä»»åŠ¡ç»éæ˜“äº‹ã€‚  Java Coreä¸­<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ²¡æœ‰ç°æˆçš„è§£å†³æ–¹æ¡ˆ</a> ï¼Œæˆ‘ä»¬å°†ä¸å¾—ä¸è‡ªå·±åšä¸€ä¸ªæ‹æ–ã€‚ æˆåƒä¸Šä¸‡çš„å¼¹ç°§åº”ç”¨ç¨‹åºé€šè¿‡æ­¤æ‹æ–è¿›è¡Œç»„ä»¶æ‰«æã€‚ æ‚¨å·²ç»å­¦åˆ°äº†å¯æ€•çš„çœŸç†ã€‚ æ‚¨å°†å¿…é¡»ä»<code>ClassLoader</code>æå–<code>ClassLoader</code>åï¼Œå¹¶æ£€æŸ¥å®ƒä»¬<code>ClassLoader</code>ä»¥â€œ .classâ€ç»“å°¾ï¼Œç„¶åæ„å»ºå…¶å…¨åå¹¶ä»ä¸­æ‹‰å‡ºç±»å¯¹è±¡ï¼ <br><br> æˆ‘æƒ³ç«‹å³è­¦å‘Šæ‚¨ï¼Œä¼šæœ‰è®¸å¤šæ£€æŸ¥è¿‡çš„å¼‚å¸¸ï¼Œå› æ­¤è¯·å‡†å¤‡å¥½åŒ…è£…å®ƒä»¬ã€‚ ä½†æ˜¯é¦–å…ˆï¼Œè®©æˆ‘ä»¬å†³å®šæˆ‘ä»¬æƒ³è¦ä»€ä¹ˆã€‚ æˆ‘ä»¬è¦å‘<code>BeanFactory</code>æ·»åŠ ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œå¹¶åœ¨<code>Main</code>è°ƒç”¨å®ƒï¼š <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//BeanFactory.java public class BeanFactory{ public void instantiate(String basePackage) { } } //Main.java BeanFactory beanFactory = new BeanFactory(); beanFactory.instantiate("com.kciray");</span></span></code> </pre><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è·å–<code>ClassLoader</code> ã€‚ å®ƒè´Ÿè´£åŠ è½½ç±»ï¼Œå¹¶ä¸”æå–éå¸¸ç®€å•ï¼š <br><br><pre> <code class="java hljs">ClassLoader classLoader = ClassLoader.getSystemClassLoader();</code> </pre> <br> æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œç¨‹åºåŒ…ä¹‹é—´ç”¨ç‚¹åˆ†éš”ï¼Œæ–‡ä»¶ç”¨æ­£æ–œæ åˆ†éš”ã€‚ æˆ‘ä»¬éœ€è¦å°†æ‰¹å¤„ç†è·¯å¾„è½¬æ¢ä¸ºæ–‡ä»¶å¤¹è·¯å¾„ï¼Œå¹¶è·å¾—ç±»ä¼¼<code>List&lt;URL&gt;</code> ï¼ˆæ–‡ä»¶ç³»ç»Ÿä¸­å¯åœ¨å…¶ä¸­æœç´¢ç±»æ–‡ä»¶çš„è·¯å¾„ï¼‰ã€‚ <br><br><pre> <code class="java hljs">String path = basePackage.replace(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//"com.kciray" -&gt; "com/kciray" Enumeration&lt;URL&gt; resources = classLoader.getResources(path);</span></span></code> </pre> <br> æ‰€ä»¥ç­‰ä¸€ä¸‹ï¼  <code>Enumeration&lt;URL&gt;</code>ä¸æ˜¯<code>List&lt;URL&gt;</code> ã€‚ è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ å“¦ï¼Œå¤ªææ€–äº†ï¼Œè¿™æ˜¯<code>Iterator</code>çš„æ—§ç‰ˆæœ¬ï¼Œä»Java 1.0å¼€å§‹å¯ç”¨ã€‚ è¿™æ˜¯æˆ‘ä»¬å¿…é¡»å¤„ç†çš„é—äº§ã€‚ å¦‚æœå¯ä»¥ä½¿ç”¨foréå†<code>Iterable</code> ï¼ˆæ‰€æœ‰é›†åˆéƒ½å®ç°å®ƒï¼‰ï¼Œé‚£ä¹ˆåœ¨<code>Enumeration</code>çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¿…é¡»é€šè¿‡<code>while(resources.hasMoreElements())</code>å’Œ<code>nextElement()</code>è¿›è¡Œå¥æŸ„ç»•è¿‡ã€‚ ä½†æ˜¯ï¼Œè¿˜æ²¡æœ‰åŠæ³•ä»é›†åˆä¸­åˆ é™¤é¡¹ç›®ã€‚ åªæœ‰1996å¹´ï¼Œåªæœ‰é“æ†ã€‚ å“¦ï¼Œæ˜¯çš„ï¼Œåœ¨Java 9ä¸­ï¼Œä»–ä»¬æ·»åŠ äº†<code>Enumeration.asIterator()</code>æ–¹æ³•ï¼Œå› æ­¤æ‚¨å¯ä»¥å®Œæˆå®ƒã€‚ <br><br> è®©æˆ‘ä»¬èµ°å¾—æ›´è¿œã€‚ æˆ‘ä»¬éœ€è¦æå–æ–‡ä»¶å¤¹å¹¶é€ä¸€å¤„ç†å®ƒä»¬çš„å†…å®¹ã€‚ å°†URLè½¬æ¢ä¸ºæ–‡ä»¶ï¼Œç„¶åè·å–å…¶åç§°ã€‚ è¿™é‡Œåº”è¯¥æ³¨æ„ï¼Œæˆ‘ä»¬ä¸ä¼šæ‰«æåµŒå¥—çš„ç¨‹åºåŒ…ï¼Œä»¥å…ä½¿ä»£ç å¤æ‚åŒ–ã€‚ æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ä½¿ä»»åŠ¡å¤æ‚åŒ–å¹¶è¿›è¡Œé€’å½’ã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (resources.hasMoreElements()) { URL resource = resources.nextElement(); File file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(resource.toURI()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(File classFile : file.listFiles()){ String fileName = classFile.getName();<span class="hljs-comment"><span class="hljs-comment">//ProductService.class } }</span></span></code> </pre><br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦è·å–ä¸å¸¦æ‰©å±•åçš„æ–‡ä»¶åã€‚ åœ¨2018å¹´çš„é™¢å­é‡Œï¼ŒJavaå·²ç»å¼€å‘äº†æ–‡ä»¶I / Oï¼ˆNIO 2ï¼‰å¤šå¹´äº†ï¼Œä½†ä»æ— æ³•å°†æ‰©å±•åä¸æ–‡ä»¶ååˆ†å¼€ã€‚ æˆ‘å¿…é¡»åˆ›å»ºè‡ªå·±çš„è‡ªè¡Œè½¦ï¼Œå› ä¸º æˆ‘ä»¬å†³å®šä¸ä½¿ç”¨è¯¸å¦‚Apache Commonsä¹‹ç±»çš„ç¬¬ä¸‰æ–¹åº“ã€‚ è®©æˆ‘ä»¬ä½¿ç”¨æ—§çš„ç¥–çˆ¶æ–¹å¼<code>lastIndexOf(".")</code> ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(fileName.endsWith(<span class="hljs-string"><span class="hljs-string">".class"</span></span>)){ String className = fileName.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, fileName.lastIndexOf(<span class="hljs-string"><span class="hljs-string">"."</span></span>)); }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç±»çš„å…¨åæ¥è·å–ç±»å¯¹è±¡ï¼ˆä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ç±»ç§°ä¸º<code>Class</code> ï¼‰ï¼š <br><br><pre> <code class="java hljs">Class classObject = Class.forName(basePackage + <span class="hljs-string"><span class="hljs-string">"."</span></span> + className);</code> </pre> <br> å¥½å§ï¼Œç°åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹å°±åœ¨æˆ‘ä»¬æ‰‹ä¸­ã€‚ æ­¤å¤–ï¼Œä»…çªå‡ºæ˜¾ç¤ºå…¶ä¸­å¸¦æœ‰<code>@Component</code>æ‰¹æ³¨çš„ç»„ä»¶ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(classObject.isAnnotationPresent(Component.class)){ System.out.println(<span class="hljs-string"><span class="hljs-string">"Component: "</span></span> + classObject); }</code> </pre> <br> è¿è¡Œå¹¶æ£€æŸ¥ã€‚ æ§åˆ¶å°åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š <br><br><pre> <code class="bash hljs">Component: class com.kciray.ProductService Component: class com.kciray.PromotionsService</code> </pre> <br> ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºæˆ‘ä»¬çš„beanã€‚ æ‚¨éœ€è¦æ‰§è¡Œç±»ä¼¼<code>new ProductService()</code> ï¼Œä½†æ˜¯å¯¹äºæ¯ä¸ªbeanï¼Œæˆ‘ä»¬éƒ½æœ‰è‡ªå·±çš„ç±»ã€‚  Javaä¸­çš„åå°„ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªé€šç”¨è§£å†³æ–¹æ¡ˆï¼ˆç§°ä¸ºé»˜è®¤æ„é€ å‡½æ•°ï¼‰ï¼š <br><br><pre> <code class="java hljs">Object instance = classObject.newInstance();<span class="hljs-comment"><span class="hljs-comment">//=new CustomClass()</span></span></code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†æ­¤beanæ”¾å…¥<code>Map&lt;String, Object&gt; singletons</code> ã€‚ ä¸ºæ­¤ï¼Œè¯·é€‰æ‹©Beanåç§°ï¼ˆå…¶IDï¼‰ã€‚ åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å°†å˜é‡ç§°ä¸ºç±»ï¼ˆä»…é¦–å­—æ¯å°å†™ï¼‰ã€‚ è¿™ç§æ–¹æ³•ä¹Ÿå¯ä»¥åº”ç”¨äºbeanï¼Œå› ä¸ºSpringæ˜¯Javaæ¡†æ¶ï¼ è½¬æ¢binåç§°ï¼Œä½¿ç¬¬ä¸€ä¸ªå­—æ¯å˜å°ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°åœ°å›¾ä¸­ï¼š <br><br><pre> <code class="java hljs">String beanName = className.substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).toLowerCase() + className.substring(<span class="hljs-number"><span class="hljs-number">1</span></span>); singletons.put(beanName, instance);</code> </pre> <br> ç°åœ¨ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚ å®¹å™¨å¿…é¡»åˆ›å»ºbeanï¼Œå¹¶ä¸”å¿…é¡»æŒ‰åç§°æ£€ç´¢å®ƒä»¬ã€‚ è¯·æ³¨æ„ï¼Œæ‚¨çš„<code>instantiate()</code>æ–¹æ³•çš„åç§°å’Œè¯¥<code>classObject.newInstance();</code>æ–¹æ³•çš„åç§°<code>classObject.newInstance();</code> æœ‰å…±åŒçš„æ ¹æºã€‚ è€Œä¸”ï¼Œ <code>instantiate()</code>æ˜¯beanç”Ÿå‘½å‘¨æœŸçš„ä¸€éƒ¨åˆ†ã€‚ åœ¨Javaä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯ç›¸äº’è”ç³»çš„ï¼ <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Main.java BeanFactory beanFactory = new BeanFactory(); beanFactory.instantiate("com.kciray"); ProductService productService = (ProductService) beanFactory.getBean("productService"); System.out.println(productService);//ProductService@612</span></span></code> </pre> <br><br> è¿˜å°è¯•å®ç°<code>org.springframework.beans.factory.stereotype.Service</code>æ‰¹æ³¨ã€‚ å®ƒæ‰§è¡Œä¸<code>@Component</code>å®Œå…¨ç›¸åŒçš„åŠŸèƒ½ï¼Œä½†è°ƒç”¨æ–¹å¼æœ‰æ‰€ä¸åŒã€‚ é‡ç‚¹åœ¨äºåç§°-æ‚¨è¯æ˜äº†ç±»æ˜¯æœåŠ¡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç»„ä»¶ã€‚ è¿™æœ‰ç‚¹åƒæ¦‚å¿µä¸Šçš„æ‰“å­—ã€‚ åœ¨æ˜¥å­£è®¤è¯ä¸­ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜â€œåˆ»æ¿å°è±¡æ˜¯ä»€ä¹ˆï¼Ÿâ€  ï¼ˆåˆ—å‡ºçš„é‚£äº›ï¼‰ã€‚â€ å› æ­¤ï¼Œåˆ»æ¿æ³¨è§£æ˜¯<code>stereotype</code>åŒ…ä¸­çš„é‚£äº›ã€‚ <br><br><h2> å¡«å†™å±æ€§ </h2><br> çœ‹ä¸‹é¢çš„å›¾ï¼Œå®ƒæ˜¾ç¤ºäº†beanç”Ÿå‘½å‘¨æœŸçš„å¼€å§‹ã€‚ åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯å®ä¾‹åŒ–ï¼ˆé€šè¿‡<code>newInstance()</code>åˆ›å»ºbeanï¼‰ã€‚ ä¸‹ä¸€æ­¥æ˜¯è±†çš„äº¤å‰æ³¨å…¥ï¼ˆä¾èµ–æ³¨å…¥ï¼Œå®ƒä¹Ÿæ˜¯æ§åˆ¶åè½¬ï¼ˆIoCï¼‰ï¼‰ã€‚ æ‚¨éœ€è¦éå†beançš„å±æ€§ï¼Œå¹¶äº†è§£éœ€è¦æ³¨å…¥å“ªäº›å±æ€§ã€‚ å¦‚æœç°åœ¨è°ƒç”¨<code>productService.getPromotionsService()</code> ï¼Œåˆ™ä¼šå¾—åˆ°<code>null</code> ï¼Œå› ä¸º ä¾èµ–å…³ç³»å°šæœªæ·»åŠ ã€‚ <br><br><img src="https://habrastorage.org/webt/2i/4v/4c/2i4v4cbsb-bdpdrgb0grh_swclu.png"><br><br> é¦–å…ˆï¼Œåˆ›å»º<code>org.springframework.beans.factory.annotation</code>åŒ…ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ <code>@Autowired</code>æ‰¹æ³¨ã€‚ æƒ³æ³•æ˜¯æ ‡è®°ä¸æ­¤æ‰¹æ³¨ç›¸å…³çš„å­—æ®µã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Autowired { }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œå°†å…¶æ·»åŠ åˆ°å±æ€§ä¸­ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> PromotionsService promotionsService; <span class="hljs-comment"><span class="hljs-comment">//... }</span></span></code> </pre> <br> ç°åœ¨æˆ‘ä»¬éœ€è¦æ•™æˆ‘ä»¬çš„<code>BeanFactory</code>æŸ¥æ‰¾è¿™äº›æ³¨é‡Šå¹¶æ³¨å…¥å¯¹å®ƒä»¬çš„ä¾èµ–å…³ç³»ã€‚ ä¸ºæ­¤æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„æ–¹æ³•ï¼Œå¹¶ä»<code>Main</code>è°ƒç”¨å®ƒï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... public void populateProperties(){ System.out.println("==populateProperties=="); } }</span></span></code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦éå†<code>singletons</code>æ˜ å°„ä¸­çš„æ‰€æœ‰beanï¼Œå¹¶ä¸ºæ¯ä¸ªbeanéå†å…¶æ‰€æœ‰å­—æ®µï¼ˆ <code>object.getClass().getDeclaredFields()</code>æ–¹æ³•å°†è¿”å›æ‰€æœ‰å­—æ®µï¼ŒåŒ…æ‹¬ç§æœ‰å­—æ®µï¼‰ã€‚ å¹¶æ£€æŸ¥è¯¥å­—æ®µæ˜¯å¦å…·æœ‰<code>@Autowired</code>æ‰¹æ³¨ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Object object : singletons.values()) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Field field : object.getClass().getDeclaredFields()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.isAnnotationPresent(Autowired.class)) { } } }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å†éå†æ‰€æœ‰åƒåœ¾ç®±ï¼Œç„¶åæŸ¥çœ‹å®ƒä»¬çš„ç±»å‹-çªç„¶ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åƒåœ¾ç®±æƒ³è¦è‡ªå·±å¤„ç†çš„ç±»å‹ã€‚ æ˜¯çš„ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸‰ç»´å¾ªç¯ï¼ <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Object dependency : singletons.values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dependency.getClass().equals(field.getType())) { } }</code> </pre> <br> æ­¤å¤–ï¼Œå½“æˆ‘ä»¬å‘ç°ä¸Šç˜¾æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥å®ƒã€‚ æ‚¨å¯èƒ½æƒ³åˆ°çš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ç›´æ¥ä½¿ç”¨åå°„æ¥ç¼–å†™<code>promotionsService</code>å­—æ®µã€‚ ä½†æ˜¯æ˜¥å¤©ä¸æ˜¯é‚£æ ·ã€‚ æ¯•ç«Ÿï¼Œå¦‚æœè¯¥å­—æ®µå…·æœ‰<code>private</code>ä¿®é¥°ç¬¦ï¼Œåˆ™æˆ‘ä»¬é¦–å…ˆå¿…é¡»å°†å…¶è®¾ç½®ä¸º<code>public</code> ï¼Œç„¶åå†™å…¥æˆ‘ä»¬çš„å€¼ï¼Œç„¶åå†æ¬¡å°†å…¶è®¾ç½®ä¸º<code>private</code> ï¼ˆä»¥ä¿æŒå®Œæ•´æ€§ï¼‰ã€‚ å¬èµ·æ¥åƒä¸ªå¤§æ‹æ–ã€‚ ä»£æ›¿å¤§æ‹æ–ï¼Œè®©æˆ‘ä»¬åšä¸€ä¸ªå°æ‹æ–ï¼ˆæˆ‘ä»¬å°†è®¾ç½®å¡ç‰¹çš„åç§°å¹¶ç§°ä¹‹ä¸ºï¼‰ï¼š <br><br><pre> <code class="java hljs">String setterName = <span class="hljs-string"><span class="hljs-string">"set"</span></span> + field.getName().substring(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).toUpperCase() + field.getName().substring(<span class="hljs-number"><span class="hljs-number">1</span></span>);<span class="hljs-comment"><span class="hljs-comment">//setPromotionsService System.out.println("Setter name = " + setterName); Method setter = object.getClass().getMethod(setterName, dependency.getClass()); setter.invoke(object, dependency);</span></span></code> </pre> <br> ç°åœ¨è¿è¡Œæ‚¨çš„é¡¹ç›®ï¼Œå¹¶ç¡®ä¿åœ¨è°ƒç”¨<code>productService.getPromotionsService()</code>è€Œä¸æ˜¯<code>null</code> ï¼Œè¿”å›äº†æˆ‘ä»¬çš„beanã€‚ <br><br> æˆ‘ä»¬å®ç°çš„æ˜¯æŒ‰ç±»å‹è¿›è¡Œæ³¨å…¥ã€‚ è¿˜æœ‰ä¸€ä¸ªæŒ‰åç§°çš„æ³¨å…¥ï¼ˆ <code>javax.annotation.Resource</code>æ³¨é‡Šï¼‰ã€‚ å®ƒçš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå°†æå–å…¶åç§°ï¼Œè€Œä¸æ˜¯å­—æ®µçš„ç±»å‹ï¼Œå¹¶æ ¹æ®è¯¥åç§°-æ¥è‡ªæ˜ å°„çš„ä¾èµ–å…³ç³»ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½ç›¸ä¼¼ï¼Œç”šè‡³æ›´ç®€å•ã€‚ æˆ‘å»ºè®®æ‚¨è¿›è¡Œå®éªŒå¹¶åˆ›å»ºè‡ªå·±çš„beanï¼Œç„¶åä½¿ç”¨<code>@Resource</code>æ³¨å…¥å®ƒå¹¶æ‰©å±•<code>populateProperties()</code>æ–¹æ³•ã€‚ <br><br><h2> æˆ‘ä»¬æ”¯æŒçŸ¥é“å…¶åç§°çš„å’–å•¡è±† </h2><br><img src="https://habrastorage.org/webt/ds/ge/nn/dsgennl2rvz-spa6h51l_yox81o.png"><br><br> æœ‰æ—¶å€™ï¼Œæ‚¨éœ€è¦åœ¨åƒåœ¾ç®±ä¸­è·å–ä»–çš„åå­—ã€‚ è¿™ç§éœ€æ±‚å¹¶ä¸ç»å¸¸å‡ºç°ï¼Œå› ä¸º ä»æœ¬è´¨ä¸Šè®²ï¼Œåƒåœ¾ç®±ä¸åº”è¯¥å½¼æ­¤äº†è§£ï¼Œå®ƒä»¬æ˜¯åƒåœ¾ç®±ã€‚ åœ¨Springçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ä¸­ï¼Œå‡å®šBeanæ˜¯POJOï¼ˆæ™®é€šçš„æ—§Javaå¯¹è±¡ï¼Œæ™®é€šçš„æ—§Javaå¯¹è±¡ï¼‰ï¼Œå¹¶ä¸”æ•´ä¸ªé…ç½®éƒ½å‘ˆç°åœ¨XMLæ–‡ä»¶ä¸­å¹¶ä¸å®ç°åˆ†å¼€ã€‚ ä½†æ˜¯æˆ‘ä»¬å®ç°äº†æ­¤åŠŸèƒ½ï¼Œå› ä¸ºåç§°æ³¨å…¥æ˜¯binç”Ÿå‘½å‘¨æœŸçš„ä¸€éƒ¨åˆ†ã€‚ <br><br> æˆ‘ä»¬å¦‚ä½•çŸ¥é“å“ªä¸ªè±†æƒ³è¦çŸ¥é“ä»–çš„åå­—æ˜¯ä»€ä¹ˆä»¥åŠä»–ä¸æƒ³ä»€ä¹ˆï¼Ÿ é¦–å…ˆæƒ³åˆ°çš„æ˜¯åˆ¶ä½œä¸€ä¸ª<code>@InjectName</code>ç±»å‹çš„æ–°æ³¨é‡Šï¼Œå¹¶å°†å…¶é›•åˆ»åˆ°Stringç±»å‹çš„å­—æ®µä¸­ã€‚ ä½†æ˜¯è¿™ç§è§£å†³æ–¹æ¡ˆå¤ªç¬¼ç»Ÿäº†ï¼Œå®ƒä¼šè®©æ‚¨æ— æ‰€äº‹äº‹ï¼ˆå°†æ­¤æ³¨é‡Šæ”¾ç½®åœ¨ä¸é€‚å½“ç±»å‹çš„å­—æ®µï¼ˆä¸æ˜¯Stringï¼‰ä¸Šï¼Œæˆ–å°è¯•å°†åç§°æ³¨å…¥åŒä¸€ç±»çš„å¤šä¸ªå­—æ®µä¸­ï¼‰ã€‚ è¿˜æœ‰å¦ä¸€ç§æ›´ç²¾ç¡®çš„è§£å†³æ–¹æ¡ˆ-ç”¨ä¸€ä¸ªè®¾ç½®æ–¹æ³•åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ç•Œé¢ã€‚ å®ç°å®ƒçš„æ‰€æœ‰åƒåœ¾æ¡¶éƒ½å…·æœ‰å…¶åç§°ã€‚ åœ¨<code>org.springframework.beans.factory</code>åŒ…ä¸­åˆ›å»º<code>BeanNameAware</code>ç±»ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanNameAware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBeanName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span></span>; }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çš„<code>PromotionsService</code>å®æ–½å®ƒï¼š <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PromotionsService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanNameAware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String beanName; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBeanName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span><span class="hljs-function"> </span></span>{ beanName = name; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBeanName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> beanName; } }</code> </pre> <br> æœ€åï¼Œå‘beanå·¥å‚æ·»åŠ æ–°æ–¹æ³•ã€‚ è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•-æˆ‘ä»¬éå†bin-singletonï¼Œæ£€æŸ¥binæ˜¯å¦å®ç°äº†æˆ‘ä»¬çš„æ¥å£ï¼Œç„¶åè°ƒç”¨setterï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">injectBeanNames</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String name : singletons.keySet()) { Object bean = singletons.get(name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(bean <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> BeanNameAware){ ((BeanNameAware) bean).setBeanName(name); } } }</code> </pre> <br> è¿è¡Œå¹¶ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ï¼š <br><br><pre> <code class="java hljs">BeanFactory beanFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeanFactory(); beanFactory.instantiate(<span class="hljs-string"><span class="hljs-string">"com.kciray"</span></span>); beanFactory.populateProperties(); beanFactory.injectBeanNames(); <span class="hljs-comment"><span class="hljs-comment">//... System.out.println("Bean name = " + promotionsService.getBeanName());</span></span></code> </pre><br> åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œåœ¨æ˜¥å¤©è¿˜æœ‰å…¶ä»–ç±»ä¼¼çš„æ¥å£ã€‚ æˆ‘å»ºè®®æ‚¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è‡ªå·±</a>å®ç°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">BeanFactoryAware</a>æ¥å£ï¼Œè¯¥æ¥å£å…è®¸Beanæ¥æ”¶åˆ°Beanå·¥å‚çš„é“¾æ¥ã€‚ å®ƒä»¥ç±»ä¼¼çš„æ–¹å¼å®ç°ã€‚ <br><br><h2> åˆå§‹åŒ–Bean </h2><br><img src="https://habrastorage.org/webt/yq/0w/5t/yq0w5t8x0kqrgqwllfuxsi77xug.png"><br><br> å‡è®¾æ‚¨é‡åˆ°ä¸€ç§æƒ…å†µï¼Œåœ¨æ³¨å…¥ä¾èµ–é¡¹ï¼ˆè®¾ç½®binå±æ€§ï¼‰åï¼Œéœ€è¦æ‰§è¡Œä¸€äº›ä»£ç ã€‚ ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä½¿åƒåœ¾ç®±å…·æœ‰åˆå§‹åŒ–è‡ªèº«çš„èƒ½åŠ›ã€‚ å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª<code>InitializingBean</code>æ¥å£ï¼Œå¹¶åœ¨å…¶ä¸­æ”¾ç½®<code>void afterPropertiesSet()</code>æ–¹æ³•çš„ç­¾åã€‚ è¯¥æœºåˆ¶çš„å®ç°ä¸ä¸º<code>BeanNameAware</code>æ¥å£æä¾›çš„å®ç°å®Œå…¨ç›¸åŒï¼Œå› æ­¤è§£å†³æ–¹æ¡ˆåœ¨ç ´åè€…çš„æ§åˆ¶ä¹‹ä¸‹ã€‚ é©¬ä¸Šç»ƒä¹ å¹¶è‡ªå·±åšï¼š <br><br><div class="spoiler">  <b class="spoiler_title">Beanåˆå§‹åŒ–è§£å†³æ–¹æ¡ˆ</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//InitializingBean.java package org.springframework.beans.factory; public interface InitializingBean { void afterPropertiesSet(); } //BeanFactory.java public void initializeBeans(){ for (Object bean : singletons.values()) { if(bean instanceof InitializingBean){ ((InitializingBean) bean).afterPropertiesSet(); } } } //Main.java beanFactory.initializeBeans();</span></span></code> </pre> <br></div></div><br><br><h2> æ·»åŠ åå¤„ç†å™¨ </h2><br> æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨å°†å–ä»£ç¬¬ä¸€æ‰¹Springå¼€å‘äººå‘˜ã€‚ æ‚¨çš„æ¡†æ¶æ­£åœ¨ä¸æ–­å‘å±•ï¼Œå¹¶ä¸”åœ¨å¼€å‘äººå‘˜ä¸­éå¸¸å—æ¬¢è¿ï¼Œæ¯å¤©éƒ½ä¼šå°†ä¿¡ä»¶å‘é€ç»™é‚®ä»¶ï¼Œå¹¶è¦æ±‚æ·»åŠ ä¸€ä¸ªæˆ–å¦ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ã€‚ å¦‚æœä¸ºæ¯ä¸ªè¿™æ ·çš„åŠŸèƒ½æ·»åŠ è‡ªå·±çš„æ¥å£å¹¶åœ¨beançš„ç”Ÿå‘½å‘¨æœŸä¸­å¯¹å…¶è¿›è¡Œæ£€æŸ¥ï¼Œåˆ™è¯¥æ¥å£ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰å°†è¢«ä¸å¿…è¦çš„ä¿¡æ¯æ‰€é˜»å¡ã€‚ å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé€šç”¨æ¥å£ï¼Œè¯¥æ¥å£å…è®¸æˆ‘ä»¬æ·»åŠ ä¸€äº›é€»è¾‘ï¼ˆç»å¯¹æ˜¯ä»»ä½•é€»è¾‘ï¼Œæ— è®ºæ˜¯æ£€æŸ¥æ³¨è§£ï¼Œå°†binæ›¿æ¢ä¸ºå¦ä¸€ä¸ªbinï¼Œè®¾ç½®æŸäº›ç‰¹æ®Šå±æ€§ï¼Œç­‰ç­‰ï¼‰ã€‚ <br><br> è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹æ­¤æ¥å£çš„ä½œç”¨ã€‚ å®ƒéœ€è¦å¯¹beanè¿›è¡Œä¸€äº›åæœŸå¤„ç†ï¼Œå› æ­¤å¯ä»¥ç§°ä¸ºBeanPostProcessorã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªéš¾é¢˜ï¼šä½•æ—¶åº”è¯¥éµå¾ªé€»è¾‘ï¼Ÿ æ¯•ç«Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹å‰æ‰§è¡Œå®ƒï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œå®ƒã€‚ å¯¹äºæŸäº›ä»»åŠ¡ï¼Œç¬¬ä¸€ç§é€‰æ‹©æ›´å¥½ï¼Œå¯¹äºå…¶ä»–ä»»åŠ¡åˆ™æ›´å¥½-ç¬¬äºŒç§...æ€ä¹ˆåšï¼Ÿ <br><br> æˆ‘ä»¬å¯ä»¥åŒæ—¶å¯ç”¨è¿™ä¸¤ä¸ªé€‰é¡¹ã€‚ è®©ä¸€ä¸ªåå¤„ç†å™¨å¸¦æœ‰ä¸¤ç§é€»è¾‘ï¼Œä¸¤ç§æ–¹æ³•ã€‚ ä¸€ä¸ªåœ¨åˆå§‹åŒ–ä¹‹å‰ï¼ˆåœ¨<code>afterPropertiesSet()</code>æ–¹æ³•ä¹‹å‰<code>afterPropertiesSet()</code>æ‰§è¡Œï¼Œå¦ä¸€ä¸ªåœ¨åˆå§‹åŒ–ä¹‹åæ‰§è¡Œã€‚ ç°åœ¨è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹æ–¹æ³•æœ¬èº«-å®ƒä»¬åº”è¯¥å…·æœ‰å“ªäº›å‚æ•°ï¼Ÿ æ˜¾ç„¶ï¼Œ <code>Object bean</code>æœ¬èº«ï¼ˆ <code>Object bean</code> ï¼‰å¿…é¡»åœ¨é‚£é‡Œã€‚ ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œé™¤äº†beanä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä¼ é€’æ­¤beançš„åç§°ã€‚ æ‚¨è¿˜è®°å¾—åƒåœ¾ç®±æœ¬èº«ä¸çŸ¥é“å…¶åç§°ã€‚ è€Œä¸”ï¼Œæˆ‘ä»¬ä¸æƒ³å¼ºåˆ¶æ‰€æœ‰beanå®ç°BeanNameAwareæ¥å£ã€‚ ä½†æ˜¯ï¼Œåœ¨åå¤„ç†å™¨çº§åˆ«ï¼Œbeanåç§°å¯èƒ½éå¸¸æœ‰ç”¨ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å°†å…¶æ·»åŠ ä¸ºç¬¬äºŒä¸ªå‚æ•°ã€‚ <br><br> åå¤„ç†beanæ—¶ï¼Œè¯¥æ–¹æ³•åº”è¯¥è¿”å›ä»€ä¹ˆï¼Ÿ è®©æˆ‘ä»¬è®©å®ƒè¿”å›åƒåœ¾ç®±æœ¬èº«ã€‚ è¿™ä¸ºæˆ‘ä»¬æä¾›äº†è¶…å¼ºçš„çµæ´»æ€§ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä»£æ›¿åŒ…è£¹å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼ˆå¹¶å¢åŠ å®‰å…¨æ€§ï¼‰æ¥ä»£æ›¿binã€‚ æˆ–è€…æ‚¨å¯ä»¥é€šè¿‡é‡æ–°åˆ›å»ºåƒåœ¾ç®±æ¥å®Œå…¨è¿”å›å¦ä¸€ä¸ªå¯¹è±¡ã€‚ ç»™å¼€å‘äººå‘˜å¾ˆå¤§çš„è¡ŒåŠ¨è‡ªç”±ã€‚ ä»¥ä¸‹æ˜¯è®¾è®¡ç•Œé¢çš„æœ€ç»ˆç‰ˆæœ¬ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.springframework.beans.factory.config; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeforeInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessAfterInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span></span>; }</code> </pre> <br> æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å‘beanå·¥å‚æ·»åŠ ä¸€ä¸ªç®€å•å¤„ç†å™¨åˆ—è¡¨ï¼Œå¹¶å…·æœ‰æ·»åŠ æ–°å¤„ç†å™¨çš„åŠŸèƒ½ã€‚ æ˜¯çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¸¸è§„çš„ArrayListã€‚ <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//BeanFactory.java private List&lt;BeanPostProcessor&gt; postProcessors = new ArrayList&lt;&gt;(); public void addPostProcessor(BeanPostProcessor postProcessor){ postProcessors.add(postProcessor); }</span></span></code> </pre> <br> ç°åœ¨æ›´æ”¹<code>initializeBeans</code>æ–¹æ³•ï¼Œä»¥ä¾¿å°†åå¤„ç†å™¨è€ƒè™‘åœ¨å†…ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initializeBeans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (String name : singletons.keySet()) { Object bean = singletons.get(name); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (BeanPostProcessor postProcessor : postProcessors) { postProcessor.postProcessBeforeInitialization(bean, name); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bean <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> InitializingBean) { ((InitializingBean) bean).afterPropertiesSet(); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (BeanPostProcessor postProcessor : postProcessors) { postProcessor.postProcessAfterInitialization(bean, name); } } }</code> </pre> <br> è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå°å‹çš„åå¤„ç†å™¨ï¼Œè¯¥å¤„ç†å™¨ç®€å•åœ°è·Ÿè¸ªå¯¹æ§åˆ¶å°çš„è°ƒç”¨å¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„beanå·¥å‚ä¸­ï¼š <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomPostProcessor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeforeInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"---CustomPostProcessor Before "</span></span> + beanName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bean; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessAfterInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"---CustomPostProcessor After "</span></span> + beanName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bean; } }</code> </pre> <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Main.java BeanFactory beanFactory = new BeanFactory(); beanFactory.addPostProcessor(new CustomPostProcessor());</span></span></code> </pre> <br><br> ç°åœ¨è¿è¡Œå¹¶ç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚ ä½œä¸ºåŸ¹è®­ä»»åŠ¡ï¼Œåˆ›å»ºä¸€ä¸ªåå¤„ç†å™¨ï¼Œè¯¥å¤„ç†å™¨å°†æä¾›<code>@PostConstruct (javax.annotation.PostConstruct)</code>æ‰¹æ³¨<code>@PostConstruct (javax.annotation.PostConstruct)</code> ã€‚ å®ƒæä¾›äº†å¦ä¸€ç§åˆå§‹åŒ–æ–¹å¼ï¼ˆæ¤æ ¹äºJavaï¼Œè€Œä¸æ˜¯Springï¼‰ã€‚ å…¶æœ¬è´¨æ˜¯å°†æ³¨é‡Šæ”¾ç½®åœ¨æŸä¸ªæ–¹æ³•ä¸Šï¼Œå¹¶ä¸”è¯¥æ–¹æ³•å°†è¢«ç§°ä¸ºæ ‡å‡†å¼¹ç°§åˆå§‹åŒ–ï¼ˆInitializingBeanï¼‰ä¹‹å‰ã€‚ <br><br> ç¡®ä¿æ‰‹åŠ¨åˆ›å»ºæ‰€æœ‰æ³¨é‡Šå’ŒåŒ…ï¼ˆç”šè‡³javax.annotationï¼‰ï¼Œè¯·å‹¿è¿æ¥ä¾èµ–é¡¹ï¼ è¿™å°†å¸®åŠ©æ‚¨äº†è§£springæ ¸å¿ƒåŠå…¶æ‰©å±•ï¼ˆjavaxæ”¯æŒï¼‰ä¹‹é—´çš„åŒºåˆ«ï¼Œå¹¶è®°ä½å®ƒã€‚ è¿™å°†åœ¨å°†æ¥ä¿ç•™ä¸€ç§æ ·å¼ã€‚ <br><br>     ,      <code>@PostConstruct</code>    ,  - CommonAnnotationBeanPostProcessor.    ,   . <br><br>  ,      <code>void close()</code>   <code>BeanFactory</code>     .  â€”  <code>@PreDestroy (javax.annotation.PreDestroy)</code> ,   ,       .  â€”  <code>org.springframework.beans.factory.DisposableBean</code> ,    <code>void destroy()</code> .  ,   ,       ( , ). <br><br><div class="spoiler"> <b class="spoiler_title">@PreDestroy + DisposableBean</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//DisposableBean.java package org.springframework.beans.factory; public interface DisposableBean { void destroy(); } //PreDestroy.java package javax.annotation; import java.lang.annotation.Retention; import java.lang.annotation.RetentionPolicy; @Retention(RetentionPolicy.RUNTIME) public @interface PreDestroy { } //DisposableBean.java public void close() { for (Object bean : singletons.values()) { for (Method method : bean.getClass().getMethods()) { if (method.isAnnotationPresent(PreDestroy.class)) { try { method.invoke(bean); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (InvocationTargetException e) { e.printStackTrace(); } } } if (bean instanceof DisposableBean) { ((DisposableBean) bean).destroy(); } } }</span></span></code> </pre> <br></div></div><br><br><h2>     </h2><img src="https://habrastorage.org/webt/ns/uh/lk/nsuhlk9ko9d9gxtzmcytopfruim.png"><br>        ,    .  ,       . <br><br><h2>    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ç¨‹åºå‘˜ç»å¸¸ä½¿ç”¨ä¸Šä¸‹æ–‡ä¸€è¯ï¼Œä½†å¹¶ä¸æ˜¯æ¯ä¸ªäººéƒ½ç†è§£å®ƒçš„çœŸæ­£å«ä¹‰ã€‚</font><font style="vertical-align: inherit;">ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¸€åˆ‡æ•´ç†å¦¥å½“ã€‚</font><font style="vertical-align: inherit;">æ­£å¦‚æˆ‘åœ¨æ–‡ç« å¼€å¤´æ‰€æŒ‡å‡ºçš„ï¼Œä¸Šä¸‹æ–‡æ˜¯å®¹å™¨çš„å®ç°ï¼Œä»¥åŠ</font></font><code>BeanFactory</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ã€‚</font><font style="vertical-align: inherit;">ä½†æ˜¯ï¼Œé™¤äº†åŸºæœ¬åŠŸèƒ½ï¼ˆDIï¼‰ä¹‹å¤–ï¼Œå®ƒè¿˜å¢åŠ äº†ä¸€äº›å¾ˆé…·çš„åŠŸèƒ½ã€‚</font><font style="vertical-align: inherit;">è¿™äº›åŠŸèƒ½ä¹‹ä¸€æ˜¯åœ¨å®¹å™¨ä¹‹é—´å‘é€å’Œå¤„ç†äº‹ä»¶ã€‚</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æ–‡ç« å¤ªå¤§äº†ï¼Œå†…å®¹å¼€å§‹è¢«åˆ èŠ‚ï¼Œå› æ­¤æˆ‘å°†ä¸Šä¸‹æ–‡ä¿¡æ¯æ”¾åœ¨ç ´åè€…çš„ä¸‹é¢ã€‚</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">æˆ‘ä»¬æ„è¯†åˆ°èƒŒæ™¯</font></font></b> <div class="spoiler_text">    .   <code>org.springframework.context</code> ,   <code>ApplicationContext</code>  .        <code>BeanFactory</code> .      ,      <code>close()</code> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationContext</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> BeanFactory beanFactory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BeanFactory(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplicationContext</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String basePackage)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ReflectiveOperationException</span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"******Context is under construction******"</span></span>); beanFactory.instantiate(basePackage); beanFactory.populateProperties(); beanFactory.injectBeanNames(); beanFactory.initializeBeans(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ beanFactory.close(); } }</code> </pre> <br><br>     <code>Main</code> ,   ,   : <br><br><pre> <code class="java hljs">ApplicationContext applicationContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationContext(<span class="hljs-string"><span class="hljs-string">"com.kciray"</span></span>); applicationContext.close();</code> </pre> <br>   ,   .       <code>close()</code> ,     Â« Â»     - .   ,   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.springframework.context.event; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextClosedEvent</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>      <code>ApplicationListener</code> ,      .        ,          ( <code>ApplicationListener&lt;E&gt;</code> ). ,    Java-,         . ,      ,    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.springframework.context; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">E</span></span></span><span class="hljs-class">&gt;</span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onApplicationEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(E event)</span></span></span></span>; }</code> </pre> <br>     <code>ApplicationContext</code> .     <code>close()</code>     ,  ,      .    <code>ApplicationListener&lt;ContextClosedEvent&gt;</code> ,     <code>onApplicationEvent(ContextClosedEvent)</code> .    ,   ? <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ beanFactory.close(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(Object bean : beanFactory.getSingletons().values()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bean <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ApplicationListener) { } } }</code> </pre> <br> ä½†æ˜¯æ²¡æœ‰   .       <code>bean instanceof ApplicationListener&lt;ContextClosedEvent&gt;</code> .      Java.      <i>  (type erasure)</i> ,    &lt;T&gt;   &lt;Object&gt;.   ,   ?    ,    <code>ApplicationListener&lt;ContextClosedEvent&gt;</code> ,     ? <br><br>   ,       ,       .  ,      ,    ,     ,   : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Type type: bean.getClass().getGenericInterfaces()){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(type <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> ParameterizedType){ ParameterizedType parameterizedType = (ParameterizedType) type; } }</code> </pre> <br> ,       ,  ,   â€”   .   ,         : <br><br><pre> <code class="java hljs">Type firstParameter = parameterizedType.getActualTypeArguments()[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(firstParameter.equals(ContextClosedEvent.class)){ Method method = bean.getClass().getMethod(<span class="hljs-string"><span class="hljs-string">"onApplicationEvent"</span></span>, ContextClosedEvent.class); method.invoke(bean, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ContextClosedEvent()); }</code> </pre> <br>        ApplicationListener: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Service</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PromotionsService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanNameAware</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApplicationListener</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ContextClosedEvent</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... @Override public void onApplicationEvent(ContextClosedEvent event) { System.out.println("&gt;&gt; ContextClosed EVENT"); } }</span></span></code> </pre> <br> ,     Main  ,    ,   : <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//Main.java void testContext() throws ReflectiveOperationException{ ApplicationContext applicationContext = new ApplicationContext("com.kciray"); applicationContext.close(); }</span></span></code> </pre> <br></div></div><br><h2> ç»“è®º </h2><br>       Baeldung  ,   ,          .     ,   .      30,   .   ,       Spring Core,    ,      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Core Spring 5.0 Certification Study Guide</a> .  ,               Java-. <br><br><h2> Update 10/05/2018 </h2><br>       Â«  ,   Â».     ,      . ,  -     ,         -.      ,             . <br><br>  : <br> Spring Container â€” [ ] <br> Spring AOP â€” [ ] <br> Spring Web â€” [ ] <br> Spring Cloud â€” [ ] </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN419679/">https://habr.com/ru/post/zh-CN419679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN419669/index.html">åæ¬¾é€‚åˆä»»ä½•é’±åŒ…çš„æœ€ä½³æ¸¸æˆé¼ æ ‡</a></li>
<li><a href="../zh-CN419671/index.html">éœ€è¦è¿åçš„é™åˆ¶æˆ–æˆ‘ä»¬å¦‚ä½•åŠ é€ŸåŠŸèƒ½æµ‹è¯•ä¸‰é</a></li>
<li><a href="../zh-CN419673/index.html">æ—©æœŸå®‡å®™6.å‡åŒ€è†¨èƒ€å®‡å®™çš„åŠ¨åŠ›å­¦ï¼Œç¬¬2éƒ¨åˆ†</a></li>
<li><a href="../zh-CN419675/index.html">2018å¹´å¤å­£è«æ–¯ç§‘ç”µåŠ¨æ»‘æ¿è½¦æ¯åˆ†é’Ÿç§Ÿé‡‘çš„è¯„è®º</a></li>
<li><a href="../zh-CN419677/index.html">å¦‚ä½•å—…æ¢iOSè®¾å¤‡çš„HTTPSæµé‡</a></li>
<li><a href="../zh-CN419683/index.html">æŒ‡æ ‡å¯¹æ•æ·å›¢é˜Ÿæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="../zh-CN419685/index.html">å…³äºç¼–ç¨‹é¢è¯•åº”äº†è§£çš„æœ€é‡è¦çš„æ•°æ®ç»“æ„</a></li>
<li><a href="../zh-CN419687/index.html">Secret Keyboard Level 3æˆ–å¦‚ä½•æ‰“å°é•¿ç ´æŠ˜å·</a></li>
<li><a href="../zh-CN419689/index.html">ä¸€ï¼Œé€‚åº”èƒ½åŠ›å·®ã€‚ äºŒã€‚ å¤šåŠ¨ç—‡æˆ–æ‡’æƒ°çš„ç™½ç—´ï¼Ÿ</a></li>
<li><a href="../zh-CN419693/index.html">Mikrotikï¼šé‡ç½®ï¼Œå¤‡ä»½å’ŒDualBoot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>