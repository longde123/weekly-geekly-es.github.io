<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîú üëâ üìΩÔ∏è R√©flexions sur la POO et l'√©tat des objets ü§∑üèΩ üòå üöè</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le code du programme est √©crit de haut en bas. Les instructions sont lues et ex√©cut√©es dans le m√™me ordre. C'est logique et tout le monde y est habitu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>R√©flexions sur la POO et l'√©tat des objets</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478826/"><p>  Le code du programme est √©crit de haut en bas.  Les instructions sont lues et ex√©cut√©es dans le m√™me ordre.  C'est logique et tout le monde y est habitu√© depuis longtemps.  Dans certains cas, vous pouvez modifier l'ordre des op√©rations.  Mais parfois, la s√©quence d'appels de fonction est importante, bien que syntaxiquement cela ne soit pas √©vident.  Il s'av√®re que le code semble fonctionner, m√™me apr√®s avoir r√©organis√© les appels, et le r√©sultat est inattendu. </p><br><p>  Une fois, un code similaire a attir√© mon attention. <a name="habracut"></a></p><br><h2 id="problema">  Le probl√®me </h2><br><p>  Une fois, fouillant dans le code de quelqu'un d'autre dans un projet commun, j'ai d√©couvert une fonction comme: </p><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product, Images images, Prices prices, Availabilities availabilities)</span></span></span></span>{ priceFiller.fill(product, prices); <span class="hljs-comment"><span class="hljs-comment">//do not move this line below availabilityFiller call, availabilities require prices availabilityFiller.fill(product, availabilities); imageFiller.fill(product, images); return product; }</span></span></code> </pre> <br><p>  Bien s√ªr, pas le style le plus "√©l√©gant" n'attire votre attention: les classes stockent des donn√©es (POJO), les fonctions changent les objets entrants ... </p><br><p>  En g√©n√©ral, cela ne semble rien.  Nous avons un objet dans lequel il n'y a pas assez de donn√©es, et il y a des donn√©es elles-m√™mes qui proviennent d'autres sources (services), que nous allons maintenant placer dans cet objet pour le compl√©ter. </p><br><p>  Mais il y a quelques nuances. </p><br><ol><li>  Je n'aime pas le fait qu'aucune fonction ne soit √©crite dans le style de FP et ne modifie l'objet pass√© en argument. <br><ul><li>  Mais disons que cela a √©t√© fait pour r√©duire le temps de traitement et le nombre d'objets cr√©√©s. </li></ul></li><li>  Seul un commentaire dans le code indique que la s√©quence d'appels est importante, et vous devez √™tre prudent lors de l'int√©gration du nouveau <code>Filler</code> <br><ul><li>  Mais le nombre de personnes travaillant sur le projet est sup√©rieur √† 1 et tout le monde ne conna√Æt pas cette astuce.  Surtout de nouvelles personnes dans l'√©quipe (pas n√©cessairement dans l'entreprise). </li></ul></li></ol><br><p>  Le dernier point m'a particuli√®rement gard√©.  Apr√®s tout, l'API est construite de telle mani√®re que nous ne savons pas ce qui a chang√© dans l'objet apr√®s avoir appel√© cette fonction.  Par exemple, avant et apr√®s, nous avons une m√©thode <code>Product::getImages</code> qui, avant d'appeler la fonction <code>fill</code> , produira une liste vide, puis une liste avec des images de notre produit. </p><br><p>  Avec <code>Filler</code> choses sont encore pires.  <code>AvailabilityFiller</code> ne pr√©cise pas qu'il s'attend √† ce que les informations sur le prix des marchandises soient d√©j√† int√©gr√©es dans l'objet transf√©r√©. </p><br><p>  J'ai donc r√©fl√©chi √† la mani√®re de prot√©ger mes coll√®gues de l'utilisation erron√©e des fonctions. </p><br><h2 id="predlozhennye-resheniya">  Solutions propos√©es </h2><br><p>  J'ai d'abord d√©cid√© de discuter de ce cas avec mes coll√®gues.  Malheureusement, toutes les solutions qu'ils ont propos√©es ne me semblent pas √™tre la bonne approche. </p><br><h3 id="runtimeexception">  Runtimeexception </h3><br><p>  L'une des options propos√©es √©tait: et vous √©crivez dans le <code>AvailabilityFiller</code> au d√©but de la fonction <code>Objects.requireNonNull(product.getPrices)</code> , puis tout programmeur recevra d√©j√† une erreur lors des tests locaux. </p><br><ul><li>  mais le prix peut vraiment ne pas √™tre l√†, si le service n'√©tait pas disponible ou une autre erreur, alors le produit devrait recevoir le statut "en rupture de stock".  Nous devrons attribuer toutes sortes d'indicateurs ou quoi que ce soit pour distinguer "aucune donn√©e" de "m√™me pas demand√©". <br><ul><li>  Si vous lancez une exception dans <code>getPrices</code> lui-m√™me, nous cr√©erons les m√™mes probl√®mes que Java moderne avec des listes <br><ul><li>  Supposons qu'une liste soit pass√©e √† une fonction qui propose la m√©thode get dans son API ... Je sais que vous n'avez pas besoin de modifier les objets transf√©r√©s, mais cr√©ez-en de nouveaux.  Mais l'essentiel est que l'API nous propose une telle m√©thode, mais au moment de l'ex√©cution, une erreur peut se produire s'il s'agit d'une liste immuable, telle que celle obtenue √† partir de Collectors.toList () </li></ul></li></ul></li><li>  si <code>AvailabilityFiller</code> est utilis√© par quelqu'un d'autre, le programmeur qui a √©crit l'appel ne comprendra pas imm√©diatement le probl√®me.  Seulement apr√®s le lancement et le d√©bogage.  Ensuite, il doit encore comprendre le code pour savoir o√π obtenir les donn√©es. </li></ul><br><h3 id="test">  Test </h3><br><p>  "Et vous √©crivez un test qui se cassera si vous changez l'ordre des appels."  c'est-√†-dire  si tous les <code>Filler</code> retournent un ¬´nouveau¬ª produit, quelque chose comme ceci se r√©v√©lera: </p><br><pre> <code class="java hljs">given(priceFillerMock.fill(eq(productMock), any())).willReturn(productWithPricesMock); given(availabilityFillerMock.fill(eq(productMockWithPrices), any())).willReturn(productMockWithAvailabilities); given(imageFillerMock.fill(eq(productMockWithAvailabilities), any())).willReturn(productMockWithImages); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = productFiller.fill(productMock, p1, p2, p3); assertThat(<span class="hljs-string"><span class="hljs-string">"unexpected return value"</span></span>, result, is(productMockWithImages));</code> </pre> <br><ul><li>  Je n'aime pas les tests qui sont si "White-Box" </li><li>  Rompe avec chaque nouveau <code>Filler</code> </li><li>  Il se casse lors du changement de la s√©quence d'appels ind√©pendants </li><li>  Encore une fois, cela ne r√©sout pas le probl√®me de la r√©utilisation de <code>AvailabilityFiller</code> lui-m√™me </li></ul><br><h2 id="sobstvennye-popytki-resheniya-problemy">  Propres tentatives pour r√©soudre le probl√®me </h2><br><h3 id="ideya">  Id√©e </h3><br><p>  Je pense que vous avez d√©j√† devin√© que j'aimerais r√©soudre le probl√®me au niveau de la compilation.  Eh bien, pourquoi ai-je besoin, demande-t-on, d'un langage compil√© avec un typage fort si je ne peux pas emp√™cher l'erreur. </p><br><p>  Et je me demandais si un objet sans donn√©es suppl√©mentaires et un objet "√©tendu" appartiennent √† la m√™me classe? </p><br><p>  Ne serait-il pas juste de d√©crire les diff√©rents √©tats possibles d'un objet en tant que classes ou interfaces distinctes? </p><br><p>  Donc, mon id√©e √©tait la suivante: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;? extends BaseProduct&gt; product, Images images, Prices prices, Availabilities availabilities)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p1 = priceFiller.fill(product, prices); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> p2 = availabilityFiller.fill(p1, availabilities); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imageFiller.fill(p2, images); } <span class="hljs-function"><span class="hljs-function">PriceFiller </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProductWithPrices </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;? extends BaseProduct&gt; product, Prices prices)</span></span></span><span class="hljs-function"> AvailabilityFiller </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProductWithAvailabilities </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;? extends ProductWithPrices&gt; product, Prices prices)</span></span></span><span class="hljs-function">  </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> &lt;BaseProduct &amp; PriceAware &amp; AvailabilityAware&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;? extends BaseProduct &amp; PriceAware&gt; product, Prices prices)</span></span></span></span></code> </pre> <br><p>  C'est-√†-dire  le produit initialement d√©fini est une instance d'une classe autre que celle renvoy√©e, qui montre d√©j√† les changements de donn√©es. </p><br><p>  <code>Filler</code> , dans leurs API, sp√©cifient exactement les donn√©es dont ils ont besoin et ce qu'ils renvoient. </p><br><p>  De cette fa√ßon, vous pouvez emp√™cher la mauvaise s√©quence d'appels. </p><br><h3 id="realizaciya">  Impl√©mentation </h3><br><p>  Comment traduire cela en r√©alit√© en Java?  (Rappelons que l'h√©ritage de plusieurs classes en Java n'est pas possible.) </p><br><p>  La complexit√© est ajout√©e par des op√©rations ind√©pendantes.  Par exemple, des images peuvent √™tre ajout√©es avant et apr√®s l'ajout de prix, ainsi qu'√† la toute fin de la fonction. <br>  Alors peut-√™tre </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductWithImages</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageAware</span></span></span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductWithImagesAndPrices</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageAware</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PriceAware</span></span></span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageAware</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PriceAware</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AvailabilityAware</span></span></span></span>{}</code> </pre> <br><p>  Comment tout d√©crire? </p><br><p>  Cr√©er des adaptateurs? </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductWithImagesAndPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;? extends BaseProduct &amp; PriceAware&gt; base)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.base = base; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images = Collections.emptyList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.base.getId(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Price </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.base.getPrice(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Image&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images; }</code> </pre> <br><p>  Copier des donn√©es / liens? </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProductWithImagesAndPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&lt;? extends BaseProduct &amp; PriceAware&gt; base)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = base.getId(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.prices = base.getPrices(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images = Collections.emptyList(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Image&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images; }</code> </pre> <br><p>  Comme d√©j√† visible, tout se r√©sume √† une √©norme quantit√© de code.  Et cela malgr√© le fait que dans l'exemple je n'ai laiss√© que 3 types de donn√©es d'entr√©e.  Dans le monde r√©el, il peut y en avoir beaucoup plus. </p><br><p>  Il s'av√®re que les co√ªts d'√©criture et de maintenance d'un tel code ne se justifient pas, bien que l'id√©e de diviser l'√âtat en classes s√©par√©es me paraisse tr√®s int√©ressante. </p><br><p>  <em>Retraite</em> </p><br><blockquote>  Si vous regardez d'autres langues, alors quelque part ce probl√®me est plus facile √† r√©soudre, mais pas quelque part. <br>  Par exemple, dans Go, vous pouvez √©crire une r√©f√©rence √† une classe extensible sans m√©thodes de ¬´copie¬ª ou de ¬´surcharge¬ª.  Mais il ne s'agit pas de Go </blockquote><p>  <em>Une autre digression</em> </p><br><blockquote>  Lors de l'√©criture de cet article, une autre solution possible a √©t√© trouv√©e avec <code>Proxy</code> , qui ne demandait que l'√©criture de nouvelles m√©thodes, mais n√©cessitant une hi√©rarchie d'interfaces.  En g√©n√©ral, effrayant, en col√®re et ne convient pas.  Si quelqu'un est soudain int√©ress√©: </blockquote><br><div class="spoiler">  <b class="spoiler_title">Avant d'aller au lit et de manger, il n'est pas recommand√© de regarder</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseProduct = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseProductProxy().create(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseProductImpl(<span class="hljs-number"><span class="hljs-number">100L</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productWithPrices = fillPrices(baseProduct, BigDecimal.TEN); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productWithAvailabilities = fillAvailabilities(productWithPrices, <span class="hljs-string"><span class="hljs-string">"available"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> productWithImages = fillImages(productWithAvailabilities, List.of(<span class="hljs-string"><span class="hljs-string">"url1, url2"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = productWithImages; System.out.println(product.getId()); System.out.println(product.getPrice()); System.out.println(product.getAvailability()); System.out.println(product.getImages()); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T extends BaseProduct&gt; <span class="hljs-function"><span class="hljs-function">ImageAware </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T base, List&lt;String&gt; images)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ImageAware) Proxy.newProxyInstance(base.getClass().getClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[]{ImageAware.class, BaseProduct.class}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyInvocationHandler&lt;&gt;(base, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ImageAware() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images; } })); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T extends BaseProduct&gt; <span class="hljs-function"><span class="hljs-function">PriceAware </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillPrices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T base, BigDecimal price)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (PriceAware) Proxy.newProxyInstance(base.getClass().getClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[]{PriceAware.class}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyInvocationHandler&lt;&gt;(base, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PriceAware() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> price; } })); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> AvailabilityAware </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillAvailabilities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PriceAware base, String availability)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (AvailabilityAware) Proxy.newProxyInstance(base.getClass().getClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[]{AvailabilityAware.class}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyInvocationHandler&lt;&gt;(base, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AvailabilityAware() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base.getPrice().intValue() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? availability : <span class="hljs-string"><span class="hljs-string">"sold out"</span></span>; } })); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProductImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; BaseProductImpl(<span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProductProxy</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">BaseProduct </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BaseProduct base)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (BaseProduct) Proxy.newProxyInstance(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getClass().getClassLoader(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Class[]{BaseProduct.class}, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyInvocationHandler&lt;&gt;(base, base)); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -<span class="hljs-number"><span class="hljs-number">1L</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PriceAware</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> BigDecimal </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BigDecimal.ZERO; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AvailabilityAware</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PriceAware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"sold out"</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageAware</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AvailabilityAware</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.emptyList(); } } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyInvocationHandler</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">U</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseProduct</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InvocationHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> U additional; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> T base; MyInvocationHandler(T base, U additional) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.additional = additional; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.base = base; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">invoke</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object proxy, Method method, Object[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Throwable </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Arrays.stream(additional.getClass().getInterfaces()).anyMatch(i -&gt; i == method.getDeclaringClass())) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.invoke(additional, args); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> baseMethod = Arrays.stream(base.getClass().getMethods()).filter(m -&gt; m.getName().equals(method.getName())).findFirst(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (baseMethod.isPresent()) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> baseMethod.get().invoke(base, args); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoSuchMethodException(method.getName()); } } }</code> </pre> </div></div><br><h2 id="vyvod">  Conclusion </h2><br><p>  Qu'est-ce qui se passe?  D'une part, il existe une approche int√©ressante qui applique des classes distinctes √† un "objet" dans diff√©rents √©tats et garantit la pr√©vention des erreurs caus√©es par une s√©quence incorrecte d'appels aux m√©thodes qui modifient cet objet. </p><br><p>  D'un autre c√¥t√©, cette approche vous fait √©crire tellement de code que vous voulez imm√©diatement le refuser.  Un tas d'interfaces et de classes ne fait que compliquer la compr√©hension du projet. </p><br><p>  Dans mon autre projet, j'ai quand m√™me essay√© d'utiliser cette approche.  Et au d√©but, au niveau de l'interface, tout allait bien.  J'ai √©crit les fonctions: </p><br><pre> <code class="java hljs">&lt;T extends Foo&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">firstStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;T&gt; ts)</span></span></span></span>{} &lt;T extends Foo &amp; Bar&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;T&gt; ts)</span></span></span></span>{} &lt;T extends Foo&gt; <span class="hljs-function"><span class="hljs-function">List&lt;T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finalStep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;T&gt; ts)</span></span></span></span>{}</code> </pre> <br><p>  Ayant ainsi indiqu√© qu'une certaine √©tape du traitement des donn√©es n√©cessite des informations suppl√©mentaires qui ne sont n√©cessaires ni au d√©but du traitement, ni √† sa fin. </p><br><p>  En utilisant <code>mock</code> 'et, j'ai r√©ussi √† tester le code.  Mais en ce qui concerne la mise en ≈ìuvre et la quantit√© de donn√©es et de diverses sources a commenc√© √† augmenter, j'ai rapidement abandonn√© et tout refait dans un aspect ¬´normal¬ª.  Tout fonctionne et personne ne se plaint.  Il s'av√®re que l'efficacit√© et la simplicit√© du code l'emportent sur la "pr√©vention" des erreurs, et vous pouvez tracer manuellement la bonne s√©quence d'appels, m√™me si l'erreur ne se manifeste qu'au stade du test manuel. </p><br><p>  Peut-√™tre que si je prenais du recul et regardais le code de l'autre c√¥t√©, j'aurais des solutions compl√®tement diff√©rentes.  Mais il se trouve que je me suis int√©ress√© √† cette ligne particuli√®re comment√©e. </p><br><p>  D√©j√† √† la fin de l'article, en pensant au fait que comme il n'est pas agr√©able de d√©crire les setters dans les interfaces, vous pouvez imaginer l'assemblage des donn√©es produit sous la forme d'un <code>Builder</code> , qui renvoie une interface diff√©rente apr√®s l'ajout des donn√©es d√©finies.  Encore une fois, tout d√©pend de la complexit√© de la logique de construction des objets.  Si vous avez travaill√© avec Spring Security, vous connaissez ce type de solution. </p><br><p>  Pour mon exemple, √ßa va: </p><br><div class="spoiler">  <b class="spoiler_title">Solution bas√©e sur un mod√®le de g√©n√©rateur</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application_2</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product.Builder() .id(<span class="hljs-number"><span class="hljs-number">1000</span></span>) .price(<span class="hljs-number"><span class="hljs-number">20</span></span>) .availability(<span class="hljs-string"><span class="hljs-string">"available"</span></span>) .images(List.of(<span class="hljs-string"><span class="hljs-string">"url1, url2"</span></span>)) .build(); System.out.println(product.getId()); System.out.println(product.getAvailability()); System.out.println(product.getPrice()); System.out.println(product.getImages()); } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> price; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String availability; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> List&lt;String&gt; images; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Product</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, String availability, List&lt;String&gt; images)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.price = price; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.availability = availability; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images = images; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> price; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> id; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> availability; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getImages</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> images; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductBuilder</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductWithPriceBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> price; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> id; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String availability; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;String&gt; images; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">id</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.id = id; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProductWithPriceBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">price</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.price = price; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">availability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String availability)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.availability = availability; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; images)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.images = images; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> av = price &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; availability != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ? availability : <span class="hljs-string"><span class="hljs-string">"sold out"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product(price, id, av, images); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductBuilder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">id</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List&lt;String&gt; images)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">ProductWithPriceBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">price</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductWithPriceBuilder</span></span></span></span>{ <span class="hljs-function"><span class="hljs-function">ProductBuilder </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">availability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String availability)</span></span></span></span>; } } }</code> </pre> </div></div><br><p>  Alors que: </p><br><ul><li>  √âcrire des fonctionnalit√©s propres </li><li>  √âcrivez un code beau et clair </li><li>  N'oubliez pas que la bri√®vet√© est une s≈ìur et surtout que le code fonctionne </li><li>  N'h√©sitez pas √† remettre en question les choses, √† chercher d'autres moyens et m√™me √† proposer des solutions alternatives, d'ailleurs </li><li>  Ne te tais pas!  Lors de l'explication d'un probl√®me aux autres, de meilleures solutions naissent (Rubber Duck Driven Developent) </li></ul><br><h2 id="spasibo-za-vnimanie">  Merci de votre attention. </h2></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr478826/">https://habr.com/ru/post/fr478826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr478814/index.html">Comment le marketing acc√©l√®re le chargement de vos smartphones</a></li>
<li><a href="../fr478816/index.html">Test des applications Android √† l'aide de s√©l√©no√Øde. Rechercher l'emplacement dans une application mobile √† l'aide d'Appium</a></li>
<li><a href="../fr478820/index.html">Vivaldi pour Android: une b√™ta est bonne et la seconde est meilleure</a></li>
<li><a href="../fr478822/index.html">Robotisation de l'IA avec InterSystems IRIS Data Platform</a></li>
<li><a href="../fr478824/index.html">Unity, ECS, Actors: comment augmenter dix fois le FPS dans votre jeu, quand il n'y a rien √† optimiser [avec des modifications]</a></li>
<li><a href="../fr478830/index.html">Plesk, cPanel ou ISPmanager: que choisir?</a></li>
<li><a href="../fr478832/index.html">Point d'√©change de trafic: des d√©buts √† la cr√©ation de votre propre IX</a></li>
<li><a href="../fr478834/index.html">Pourquoi nous sommes engourdis par la peur: l'effet de la s√©rotonine sur la locomotion</a></li>
<li><a href="../fr478836/index.html">Ce qui est commun entre un revolver, des rondelles et un robot autonome</a></li>
<li><a href="../fr478838/index.html">La premi√®re mort sur un jetpack</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>