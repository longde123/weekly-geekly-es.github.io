<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👇🏿 👎🏼 🚶🏿 Insulinpumpen, manipulationssichere Mikrochips und softwaredefiniertes Radio 👏🏾 👩🏾 😢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Reverse Engineering Insulinpumpe für die DIY-Therapie 

 Vor ungefähr drei Jahren hörte ich von einer Website, die eine Belohnung dafür bietet, dass s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Insulinpumpen, manipulationssichere Mikrochips und softwaredefiniertes Radio</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450962/">  <i>Reverse Engineering Insulinpumpe für die DIY-Therapie</i> <br><br>  Vor ungefähr drei Jahren hörte ich von einer Website, die eine Belohnung dafür bietet, dass sie mir sehr am Herzen liegt: Reverse Engineering-Kommunikation mit einer Insulinpumpe.  Ich habe bereits mitgeholfen, ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">System</a> für meine Tochter namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Loop</a> mit einer Medtronic-Pumpe zu erstellen, für das ich die Kommunikation zurückentwickle (der größte Teil des Medtronic-Hauptkommunikationsprotokolls wurde von Ben West mithilfe des Carelink-USB-Geräts dekodiert, und ich habe die Funkfrequenzen herausgefunden und einige zusätzliche Arbeiten durchgeführt Protokoll).  Die Medtronic-Pumpe musste jedoch während des Turnens für mehrere Stunden abgeschaltet werden.  Das schlauchlose Design dieser Omnipod-Pumpe schien mir interessant zu sein, und ich hatte alle Werkzeuge, um zu arbeiten. <br><br>  Das Omnipod-System besteht aus einer kleinen Einwegpumpe, die als Modul (Pod) bezeichnet wird, und einer Steuereinheit (PDM). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/841/6a8/053/8416a805371c4dd2def86783f903bc24.jpg"></div><br><a name="habracut"></a><br>  Da das PDM über Funk mit dem Modul kommuniziert und das Modul keine integrierte Schnittstelle hat, bedeutet dies, dass es vollständig funkgesteuert ist.  Es besteht die Möglichkeit einer vollständigen Integration in Loop, wobei nur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RileyLink</a> oder seine modifizierte Version verwendet wird. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">James Wedding</a> ernannte eine Belohnung, die viel Aufmerksamkeit auf sich zog, und dann die richtigen Leute, die bei der Arbeit halfen. <br><br><h1>  Software Defined Radio </h1><br>  SDR ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">großartiges Werkzeug</a> .  Er macht die verborgene Welt des Radios sichtbar.  Es gibt eine Vielzahl von Arten von Nachrichten, die ständig in der Luft übertragen werden. Mit diesen Tools können Sie herumstöbern, Nachrichten anzeigen und nach einiger Arbeit die kleinen Blitze dekodieren, die Sie dort sehen.  Wenn Sie nach Nachrichten von einem bestimmten Gerät suchen, müssen Sie wissen, in welchem ​​Bereich die Suche gestartet werden soll.  Hier bieten sich öffentliche FCC-Dokumente an. <br><br>  In der FCC-Dokumentation für PDM, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RBV-019</a> , heißt es, dass das Gerät im 433-MHz-Band sendet.  Nach der Konfiguration der SDR-Software für das Abhören im Bereich von 433 MHz werden die folgenden Signale angezeigt, wenn der Status von PDM ausgegeben wird: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45b/3a2/f4b/45b3a2f4bc2273bfc3980fe7ce880ddf.png"><br><br>  Wie ich schließlich herausfand, zeigen diese beiden hellen Linien eine bestimmte Art von Modulation an, die als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Frequenzumtastung</a> oder FSK bezeichnet wird.  Dies bedeutet, dass die Signalfrequenz abhängig von der übertragenen Information variiert.  Bit 1 wird als höhere Frequenz (obere Zeile) und 0 mit einer etwas niedrigeren Frequenz (untere Zeile) gesendet.  Mit dem <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Inspectrum-</a> Tool <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">können</a> wir die Daten analysieren, um 1 und 0 klarer zu erkennen. Hier ist eine stark vergrößerte Ansicht der ersten Nachricht: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20c/80e/a0d/20c80ea0d16d084da29f5e2afdd76283.png"><br><br>  Ich habe ein Python-Skript geschrieben, um diese Bits zu extrahieren, damit wir sie als ganze Pakete betrachten können. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a9/bbc/f46/4a9bbcf46f710c93c85407fb9c4df813.png"><br><br>  Es stellt sich heraus, dass dieses sich wiederholende Muster Teil der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Präambel ist</a> .  Um Energie zu sparen, gehen Empfänger häufig in den Ruhemodus und wachen regelmäßig auf, um das Signal zu überprüfen.  Der Sender sendet die Präambel so lange, dass der Empfänger sie während einer der kurzen Hörperioden abfangen kann.  Wenn der Empfänger die Präambel hört, wird sie aktiviert, bis echte Daten angezeigt werden. <br><br>  Sie müssen eine andere Ebene durchlaufen, bevor Sie die tatsächlichen Chargendaten erhalten.  Sie können Ihre Daten nicht genau wie die Originalbits über Funk senden, da der Empfänger Übergänge verwendet, um die Zeit zu synchronisieren, in der auf das nächste Bit gewartet werden soll.  Wenn Sie einen langen Satz von Nullen oder Einsen haben, ist der Empfänger möglicherweise nicht mehr synchron.  Daher verwendet die Funkkommunikation normalerweise eine Codierung, um zu überprüfen, ob genügend Übergänge vorhanden sind.  Omnipod-Kommunikation verwendet die sogenannte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Manchester-Codierung</a> .  Jedes Bit ist in zwei Bits codiert.  1 wird als 10 und 0 als 01 codiert. <br><br>  Es hat lange <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">gedauert</a> , es herauszufinden, und es gab viele Theorien auf <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dem Openomni-Kanal in Slack,</a> als wir versuchten, die ursprünglichen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Teile</a> zu wiederholen.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mark Brighton</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dan Caron</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@larsonlr</a> haben mit <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFCat</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ti Stick</a> einige Erfolge bei der Erfassung von Paketen erzielt.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Evarist Kurgio hat</a> schließlich ein Tool namens <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">rtlomni geschrieben</a> . Er verwendet den rtl-sdr-USB-Empfänger, um Pakete abzuhören und zu dekodieren. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dies</a> erwies sich als sehr praktisch und zuverlässiger als Methoden, die auf TI Stick basieren. <br><br><h1>  Paketdecodierung </h1><br>  Nachdem wir die tatsächlichen Bits erhalten hatten, begannen wir, die Struktur des Pakets zu untersuchen.  Basierend auf den Änderungen zwischen verschiedenen Modulen und verschiedenen Teams haben wir eine Struktur erstellt, die folgendermaßen aussieht: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/502/143/9c3/5021439c396b22015da60af09a84516a.png"><br><br><h1>  CRC8 </h1><br>  Radio ist weit entfernt von einem idealen Übertragungsmedium.  Es gibt viele verschiedene Störquellen, durch die der Empfänger 1 hört, wenn 0 gesendet wird, und umgekehrt.  Es ist wichtig zu wissen, wann dies passiert ist, daher verwenden die meisten Protokolle eine Prüfsumme, die häufig als CRC bezeichnet wird.  Der Empfänger berechnet die CRC, wenn Daten empfangen werden, und das letzte Byte des Pakets enthält die vom Sender berechnete CRC.  Wenn sie nicht übereinstimmen, verwirft der Empfänger das Paket und wartet auf die erneute Übertragung. <br><br>  Das Omnipod-Protokoll verwendete die Standard-8-Bit-CRC.  Als wir ihn fanden, entschieden wir, dass wir dem Verständnis der Botschaften sehr nahe waren.  Wie wenig wir wussten ... <br><br><h1>  Nachrichten, CRC16 </h1><br>  Einige Nachrichten sind zu groß, um in ein Paket zu passen, sodass sie in mehrere Pakete aufgeteilt sind.  Wir fingen an, das Nachrichtenformat zusammenzusetzen, und bemerkten am Ende jeder Nachricht einen weiteren Satz von Bits, der wie eine 16-Bit-CRC aussah.  Aber es war seltsam: 5 von 16 Bits wurden nie gesetzt.  Wir haben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">viele verschiedene Methoden</a> ausprobiert <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">,</a> um herauszufinden, wie dies codiert ist, aber nichts hat funktioniert. <br><br>  Dies war das erste große Problem: Wir konnten weiterhin an anderen Bits in den Nachrichten arbeiten, aber es wird nicht viel helfen, zu verstehen, was gesendet wird, und wir werden nicht in der Lage sein, selbst neue Pakete zu generieren, sodass der Fortschritt verlangsamt wird. <br><br>  Mehrere Monate vergingen fast ohne Erfolg.  Schließlich berichtete ein Mitglied der Gruppe unter dem Spitznamen <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">@lorelai</a> im Winter 2016, dass sie die Firmware erfolgreich von einem größeren ARM-Chip auf PDM kopiert und den langwierigen Demontageprozess gestartet hatte: Akzeptieren von CPU-Anweisungen und Verwandeln in lesbaren Code mit semantischen Variablen und Funktionsnamen.  Sie hat großartige Arbeit geleistet und herausgefunden, mit welchen verschiedenen Methoden Daten übertragen wurden. <br><br>  Ich habe mir eine der Routinen ohne Titel angesehen und festgestellt, dass sie wie eine Standardimplementierung der CRC-Berechnung aus einer Tabelle aussieht.  Und die Tabelle hatte Werte für die Standard-16-Bit-CRC.  Ich habe meine eigene Implementierung auf Tabellen geschrieben und sie wurde wie ein normaler CRC getestet.  Dann habe ich mir genau angesehen, wie die Funktion geschrieben wurde.  Eine normale CRC-Implementierung sieht folgendermaßen aus: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (len--) { crc = (crc &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ crctable[((crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ *c++)]; }</code> </pre> <br>  Ihre Implementierung sah folgendermaßen aus: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (len--) { crc = (crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ crctable[((crc &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) ^ *c++)]; }</code> </pre> <br>  Beachten Sie den Unterschied?  Was eigentlich ein bitweiser Linksverschiebungsoperator sein sollte, wurde irgendwie als Rechtsverschiebung codiert.  Das ist ein Fehler;  Es gibt keinen Grund, Ihren eigenen CRC-Algorithmus zu lähmen, da dies die Identifizierung beschädigter Nachrichten erschwert. <br><br>  Wir sind wieder in Betrieb!  Und sie nahmen die Arbeit an der Dekodierung von Nachrichten wieder auf, zeichneten Sitzungen von PDM für die Abgabe von Boli [Drogen] und temporären Basen auf [Die temporäre Basalrate bestimmt eine Zunahme oder Abnahme der Insulinabgabe - ca.  Spur], Aussetzung der Einreichung usw. <br><br><h1>  Einwegnummer </h1><br>  Alle Insulinabgabeteams hatten am Anfang der Nachricht ein 4-Byte-Datenelement, das wie eine Art Kryptographie aussah.  Wieder haben wir viele verschiedene Möglichkeiten ausprobiert, es im Kontext der Nachrichten, in denen es gesendet wurde, zu interpretieren und zu analysieren, aber es war kein CRC (manchmal sahen wir die gleichen 4 Bytes sogar in verschiedenen Nachrichten).  Und manchmal sahen wir, wie sich das Bild wiederholte.  Es sah vielleicht als Teil eines Protokolls aus, um die Datenwiedergabe zu verhindern.  In anderen Protokollen wird eine ähnliche Funktion als <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nonce bezeichnet</a> . <br><br>  Eine der Optionen, die wir in Betracht gezogen haben, war das Aufzeichnen einer Nachrichtenbasis für die Wiedergabe bestimmter Befehle.  Selbst wenn die Adresse jedes Moduls unterschiedlich war, wussten wir jetzt, wie man eine CRC generiert, damit wir die vorherige Kopie des Befehls nehmen, die neue Adresse in die Nachricht einfügen und die CRC nachzählen können.  Nur diese Nonce hat uns daran gehindert, diese Strategie anzuwenden.  Unabhängig vom Befehl akzeptierte das Modul nur die nächste Nonce in der Sequenz, und wir wussten nicht, wie die nächste Nonce generiert werden sollte. <br><br>  Aber!  Immerhin haben wir eine dekompilierte PDM-Firmware, wir können einfach da schauen!  Also haben wir die PDM-Firmware untersucht, die Generierung von Nachrichten im Code verfolgt und herausgefunden, wo diese vier Bytes sein sollten.  Anstelle einer Methode, die eine kryptografische Nonce berechnet, haben wir nur vier <code>INS.</code> Zeichen gefunden <code>INS.</code>  .  Was für ein Unsinn?!?!  Nun, irgendwie muss dieser Nachrichtenbereich später in der Pipeline aktualisiert werden. <br><br>  Auf dem PDM befand sich ein weiterer Chip, näher am Radio.  Es war derselbe Chip, der in den Modulen verwendet wurde, mit der Kennung SC9S08ER48, die im Internet nicht dokumentiert war.  Es wurde wahrscheinlich auf Bestellung für das Insulet angefertigt.  Vielleicht können wir die Firmware von diesem Chip entfernen.  Leider war der Chip blockiert, was das Kopieren der Firmware verhinderte. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7fa/b0d/60c/7fab0d60c765bfaf689f79d4bdf5433a.png"><br><br>  Die Arbeit verlangsamte sich wieder ... es war wie eine echte Sackgasse.  Wir haben alle unsere mentalen Anstrengungen in diese Nonce gesteckt, und wir hatten keine guten Hinweise in der Mathematik dahinter.  Und der ER48-Chip, der (möglicherweise) Geheimnisse bewahrt hat, wurde blockiert, und es ist schwierig, öffentliche Informationen zu finden, die helfen könnten, ihn zu knacken. <br><br><h1>  Röntgenstrahlen </h1><br>  Einige Mitglieder der Slack-Community versuchten, ER48 zu verstehen, und schlugen vor, Röntgenaufnahmen zu machen.  Es war wirklich cool, hat aber leider keine neuen Möglichkeiten eröffnet. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/76f/9d7/261/76f9d72614dc261b6a594d099b610514.jpg"><br>  <i><font color="gray">Allgemeiner Schuss</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8b/5ac/86b/d8b5ac86b2c595e0ab03724e22eb58de.jpg"><br>  <i><font color="gray">Detaillierte Aufnahme</font></i> <br><br><h1>  Autopsie und Schießen </h1><br>  Dan Caron beschloss, sich an einen Forscher zu wenden, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dr. Sergey Skorobogatov</a> von der Universität Cambridge in Großbritannien.  Dan las, dass er Erfahrung mit dem Extrahieren von Code aus gesperrten Chips hat, und überzeugte ihn, sich unser Problem anzuschauen.  Dr. Skorobogatov forschte auf dem Gebiet der Verwendung von SEM (Rasterelektronenmikroskop) für das Reverse Engineering von Mikroschaltungen.  Er schlug vor, dass es möglich ist, aber es wird teuer sein, teure Ausrüstung erfordern und kein Ergebnis garantieren.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Joe Moran</a> , der vor kurzem mit Loop angefangen hat, nachdem wir uns im Herbst 2016 beim Nightscout-Hackathon getroffen hatten, erklärte sich bereit, bei dem Projekt zu helfen.  Er stimmte mit einem Unternehmen aus dem Silicon Valley, Nanolab Technologies, überein, die Chips zu öffnen und zu fotografieren, und finanzierte freundlicherweise die Arbeit von Nanolab und Dr. Skorobogatov (sowie seine persönlichen Module). <br><br>  Dr. Skorobogatov bat Nanolab, verschiedene bildgebende Verfahren anzuwenden, um herauszufinden, ob es möglich ist, den Schutz mit bekannten nicht-invasiven oder semi-invasiven Methoden zu knacken.  Infolgedessen erschienen viele Bilder, von denen einige sehr schön waren.  Dies sind optisch mikroskopische Bilder einer Siliziummatrix. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/031/21e/bfb/03121ebfb9b91c9b4b68c71664df2869.jpg"><br>  <i><font color="gray">Gesamtansicht der Mikroschaltung unter einem optischen Mikroskop</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9a/131/5b7/d9a1315b7eb9403fd06e38b06229f01d.jpg"><br>  <i><font color="gray">Gesamtansicht der Mikroschaltung unter einem optischen Mikroskop</font></i> <br><br>  Es wurden auch Bilder von bestimmten Bereichen der Matrix unter Verwendung eines Rasterelektronenmikroskops aufgenommen.  Mit unterschiedlichen Spannungen, unterschiedlicher Oberflächenvorbereitung und unterschiedlicher Ausstattung. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/e7a/1b0/d3ae7a1b0d68eb0bd0400c56eecad6fa.jpg"><br>  <i><font color="gray">REM-Aufnahme von Flash-Zellen.</font></i>  <i><font color="gray">Zeigt keine Daten an</font></i> <br><br>  Leider zeigte keines dieser Bilder den tatsächlichen Inhalt des Flash-Speichers. <br><br>  Dr. Skorobogatov hatte eine letzte Methode, die nur im Falle eines Versagens angewendet werden kann.  Dies war eine patentierte Methode, deren Verwendung die Erlaubnis der Universität einholen musste.  Dr. Skorobogatov führte den ersten Test durch und bestätigte, dass er Daten auf diesem Chip lesen konnte.  Bevor jedoch fortgefahren werden konnte, musste die NDA unterzeichnet werden. Daher wurden Verhandlungen darüber geführt, wer den Inhalt der extrahierten Firmware erhalten würde. <br><br>  Letztendlich unterzeichnete die NDA die Nightscout-Stiftung und übernahm die Verantwortung dafür, die unbefugte Offenlegung von Methoden und Ergebnissen zur Speicherextraktion zu verhindern. <br><br>  Das Ergebnis dieser Vereinbarung und Arbeit war <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ein unglaublicher Artikel</a> von Dr. Sergei Skorobogatov sowie der Firmware-Code.  Vom ersten Mal an gab es einige Fehler im Code, aber dies war genug, um loszulegen.  Beim Nightscout Spring Hackathon wandte sich Joe an die Jungs, wenn jemand eine Demontage durchführen möchte.  Niemand hob die Hände.  Prozessoranweisungen in etwas Verständliches zu verwandeln, ist mühsame Arbeit, und nur sehr wenige Menschen wissen, wie es geht.  Ich habe versucht, mithilfe der CPU-Dokumentation in Assembler einzutauchen, aber ich habe sehr wenig erreicht und war enttäuscht.  Andere fragten optimistisch nach dem Firmware-Code mit der Erwartung eines schnellen Fortschritts, erkannten dann den Umfang und die Komplexität der Aufgabe - und fielen leise ab. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b4/ab1/8f8/5b4ab18f82c273633dab9f193d69d331.png"><br>  <i><font color="gray">Beispiel für die Demontage von SC908-Anweisungen</font></i> <br><br>  Es stellt sich heraus, dass Joe auch umfangreiche Erfahrung in der Arbeit mit Assembler hatte und begann, diese schwierige Aufgabe auszuführen.  Im Juli schloss Dr. Skorobogatov eine zweite Speicherextraktionsoperation mit viel weniger Fehlern ab.  Während des Sommers arbeitete Joe Moran unermüdlich daran, eine große Anzahl von Prozessoranweisungen anzuzeigen und diese schrittweise in das Gesamtbild des Modulpseudocodes zu integrieren. <br><br>  Am Ende kam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Ken Shirriff</a> , ein Experte für Hardware-Reverse Engineering, zu uns und beschleunigte den Prozess erheblich.  Zusammen übersetzten Joe und Ken genug Code, um eine Funktion zu finden, die Nonce codiert.  Dies geschah im September 2017. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d93/1d5/a00/d931d5a000713fdefa9f865744a5b6a2.gif"></div><br><br><h1>  RileyLink und Loop </h1><br>  Wir haben die Python-Skripte von openomni aktualisiert, aber jetzt ist es Zeit, sich auf RileyLink + iOS zu konzentrieren. Deshalb habe ich begonnen, an OmniKit- und Firmware-Updates für RileyLink zu arbeiten.  Ich glaubte, dass wir die Grundlagen des Protokolls hatten, und der Rest waren nur Details.  Wieder völlig unterschätzt, wie viel noch kommen wird. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f5/710/6d8/4f57106d8931a3e2b5f01e2a8fd8f9db.jpg"><br><br>  Ich musste eine neue Firmware schreiben, die die Modulation und Codierung des Moduls übernimmt.  Ich musste auch umschreiben, wie zwei Chips auf RL miteinander sprechen, um Nullen zu verarbeiten, da in Medtronic Nullen das spezielle Ende des Paketmarkers waren.  Ein Großteil der Schleife musste neu gestaltet werden, um mehrere Pumpen zu unterstützen, sowie neue Schnittstellen, um das Pairing, Deaktivieren und die Fehlerbehandlung zu unterstützen.  Glücklicherweise hat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Nate Racklift</a> bei Loop ein solides Fundament gelegt, um dies alles zu ermöglichen. <br><br>  In der Zwischenzeit wurde weiter daran gearbeitet, das Format der Teams zu verstehen.  Alles wurde sorgfältig im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">openomni-Wiki</a> dokumentiert, der umfassendsten Dokumentation des Protokolls.  Joe, Evarist und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Elke Jäger</a> haben im Laufe der Zeit wirklich gute Arbeit geleistet, um Nachrichten zu dekodieren und Seiten zu aktualisieren.  Verschiedene Slack-Channel-Mitglieder haben zur Erfassung von PDM-Paketen und des Moduls beigetragen, um die gesamten Decodierungsbemühungen zu unterstützen. <br><br>  Das Dekodieren war ein lustiger Job mit vielen kleinen Siegen, da jede Komponente jedes Teams entschlüsselt, und ich habe es wirklich gemocht, an diesem Teil zu arbeiten und Loop schrittweise Code hinzuzufügen.  Im April 2018 teilte ich bei Slack mit, dass ich „eine primäre Kanülierung, die über iPhone + RL gemäß dem programmierten Grundplan gepaart wurde, durchgeführt habe und dann 5 Einheiten krank wurden“. <br><br>  Die RL 2.0-Firmware wurde im Juli 2018 fertiggestellt, und neue Lieferungen wurden bereits durchgeführt.  Es wurde gehofft, dass diese Karten mit Loop und Omnipod verwendet werden könnten, aber die vorhandene 915-MHz-Antenne war zu schlecht, um effektiv mit 433 MHz zu arbeiten. <br><br>  Die Dekodierung und Implementierung hat im Sommer erhebliche Fortschritte gemacht, und Loop nähert sich allmählich der Leistung.  Joe hat das Erstaunliche getan, indem er mir Geld gegeben hat, also habe ich meinen Job gekündigt und mich auf dieses Projekt konzentriert, und schließlich bin ich dem wunderbaren Tidepool-Team beigetreten.  Natürlich gab es im Bereich DIY und der gesetzlichen Regelung für medizinische Geräte weitere Ereignisse, die ich nicht behandeln werde, aber es war ein sehr interessanter Sommer! <br><br><h1>  Schreier </h1><br>  Als weitere Funktionen im Treiber angezeigt wurden, habe ich ihn mit Loop verbunden und die Möglichkeit aktiviert, die Lieferung pünktlich automatisch zu konfigurieren.  Zu diesem Zeitpunkt wurden häufig „auffällige“ Module erhalten, wenn bei einigen internen Modulprüfungen ein Problem festgestellt wurde und er die Insulinabgabe einstellte. <br><br>  Dies schien jedoch ein lösbares Problem zu sein, da wir beim manuellen Senden von Befehlen weiterhin kleine Abweichungen in den Loop-Paketen und im ursprünglichen PDM fanden und ich davon ausging, dass die „Schreie“ aufhören werden, wenn wir sie alle beheben. <br><br><h1>  Arbeitsschleife! </h1><br>  Am 3. Oktober 2018 zog Joe das von Loop verwaltete Modul an und wurde der erste Loop Omnipod-Benutzer, obwohl er es mir nicht sofort sagte, weil er wusste, dass ich mir Sorgen machen würde.  Als er es mir sagte, war ich immer noch besorgt.  Wir haben gesehen, wie das Modul funktioniert, und die Funktionalität verstanden, und der grundlegende Algorithmus wurde lange getestet, aber immer noch ... <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c74/adc/6ec/c74adc6ecee823d919dbf3162b120e5c.png"><br><br>  Einen Monat später, beim Nightscout-Hackathon im November 2018, beschlossen mehrere weitere Abenteurer, es selbst zu versuchen, und wurden Teil einer kleinen geschlossenen Testgruppe, die vor Veröffentlichung des Codes auf mehr als 30 Personen anwachsen wird. <br><br>  Leider sind wir immer noch auf Modulschreie gestoßen, die häufig vor Ablauf der gesamten drei Tage auftreten, und wir haben Loop-Befehle sorgfältig mit PDM-Beispielen verglichen.  In diesem Prozess war Elke besonders nützlich: Er schrieb ein Skript zum automatischen Überprüfen von Befehlen mit Originalversionen.  Ich begann mir Sorgen zu machen, dass der intermittierende Betrieb der Module durch erhöhte Batterieanforderungen für die Kommunikation alle fünf Minuten verursacht wurde. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e92/90b/39b/e9290b39bd5057064ebaf3dfed0e8980.png"><br>  <i><font color="gray">Gewindebohrer des Spannungsreglers im Modul, gebohrt durch den Kunststoff der Rückwand, auf Sekundenkleber</font></i> <br><br>  Daher begann ich, die Versorgungsspannung des Moduls mit Arduino zu messen, Daten zu schreiben und zur Visualisierung in einer lokalen Datenbank zu speichern.  Ich habe PDM und Loop verglichen. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/701/02d/d09/70102dd0984ee469ff50a75f4912f8bc.png"><br>  <i><font color="gray">Langzeitänderung der Modulversorgungsspannung</font></i> <br><br>  Leider stellte sich heraus, dass dies auch eine Sackgasse war;  Mit PDM und Injektion einer großen Menge Insulin konnte ich das Modul auf eine niedrigere Spannung bringen als während der gesamten Lebensdauer des Loop-Moduls und das Modul nicht zum „Schreien“ bringen.  Es schien, dass Stress kein Problem war, es muss etwas anderes geben. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fc6/4bc/e44/fc64bce4473247b8d55f69a3d2bcab58.jpg"><br>  <i><font color="gray">RileyLinks mit 955 MHz (links) und 433 MHz Spulenantennen (rechts)</font></i> <br><br>  Irgendwann bemerkte ich, dass das Modul, wenn der Austausch von Nachrichten mit dem Modul fehlschlug, manchmal weiterhin versuchte, den Austausch zu beenden, indem Pakete immer wieder erneut gesendet wurden.  Die Testerprotokolle zeigten auch viele Störungen, so dass ich anfing, mit Antennen zu experimentieren.  Beide Probleme sollten mit der Qualität der Kommunikation zusammenhängen.  Ich hatte vor, verschiedene Antennen auszuprobieren und sie an verschiedenen Stellen im Internet zu bestellen, hatte aber keine Zeit, sie zu testen, bis dies zu einer Priorität wurde. <br><br>  Ich hatte mehrere flexible 433-MHz-Antennen, die an der Innenseite des RL-Gehäuses angebracht werden können.  In einigen Szenarien zeigen sie häufig eine bessere Leistung, in anderen jedoch nicht.  zu unzuverlässig.  Als ich zur Rolle kam, zeigte sie sehr konstant gute Leistung und auf sehr erstaunlichen Reichweiten.  Zeit, einen neuen Fall für RileyLink zu machen. <br><br>  Mit einer neuen Antenne und einigen Optimierungen, die das Messaging reduzierten und dennoch alle 5 Minuten Anpassungen vornahmen, wurden Schreie sehr selten.  Wahrscheinlich vergleichbar mit der üblichen Verwendung von Modulen mit PDM.  In den letzten 7.500 Stunden Echtzeit-Tests wurden 94% der Module ohne Fehler abgeschlossen. <br><br><h1>  Test und Dokumentation </h1><br>  Die Testgruppe wuchs langsam: Es kamen ständig neue Benutzer hinzu, die mit einem frischen Aussehen beurteilen konnten, welche Teile verwirrend aussehen.  Diese Tester haben viele auffällige Module in Kauf genommen und einen großen Beitrag zur Verbesserung der Leistung von Loop mit Omnipod geleistet.  Grundsätzlich haben sie Problemberichte und Arbeitsprotokolle gesendet. <br><br>  Diese Berichte enthalten ein Protokoll mit Nachrichten, die mit einem von Elke erstellten Tool analysiert werden können.  Es gibt eine Vorstellung davon, ob wir verzerrte Befehle erhalten, und ermöglicht es Ihnen, Statistiken über bestimmte Teile der Interaktion von Loop mit Modulen zu sammeln. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Marion Barker</a> trat der Testgruppe bei und fügte spezielle Berichte und zusätzliche Statistiken zum Testfortschritt hinzu - und wir konnten ihre Statistiken über erfolgreiche Module gegen Fehler verwenden, um eine Vorstellung von Fortschritten auf hohem Niveau zu bekommen. <br><br>  Am Ende trat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Katie DiSimone</a> der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Testgruppe</a> bei.  Sie begann eine umfassende Umstrukturierung von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">loopdocs.org</a> mit einer Dokumentation zur Verwendung von Loop mit mehreren Geräten.  Das Warten auf die Version von Loop, die mit Omnipod funktioniert, war unglaublich hoch, und ohne gute Dokumentation war klar, dass wir mit denselben Fragen überfordert sein würden. <br><br><h1>  Neue Loop-Funktionen </h1><br>  Die Integration mit Omnipod erforderte ein Überdenken einiger Schnittstellenelemente und das Hinzufügen neuer Steuerelemente.  Das Modul meldet den Akku nicht und der Benutzer kann in diesem Fall mit einer geringen Ladung wenig anfangen. Daher ist die Anzeige des Widgets für den Akkuladestand nicht sinnvoll.  Darüber hinaus sollte der Benutzer ohne eine Benutzeroberfläche an der Pumpe in der Lage sein, den Bolus schnell abzubrechen.  Das Panzersymbol zeigte den Medtronic-Panzer, daher wollten wir ihn neu gestalten.  Vielen Dank an <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paul Forgione</a> für die Entwicklung des Logos des Moduls, das jetzt den Füllstand des Tanks anzeigt. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ed/2ff/020/0ed2ff02079b5cbaf6606c21467577ee.png"><br><br><h1>  Danksagung </h1><br>  Vielen Dank an alle, die uns geholfen haben, diesen langen Weg zu gehen, damit wir das Ziel verwirklichen, das wir uns vor langer Zeit gesetzt haben.  Ich weiß, dass ich nicht alle Beteiligten und nicht alle Ereignisse erwähnt habe.  Dies ist in einem Artikel nicht möglich, und ich habe nur persönliche Erfahrung.  Es ist schwer vorstellbar, wie viele Stunden es gedauert hat.  Wenn Sie alle zusammenzählen, ist das sicher eine schockierende Zahl.  Ganz zu schweigen von der Arbeit an der Schaffung des Omnipods selbst, die meines Erachtens all diese Bemühungen überschattet.  Also vielen Dank an alle.  Außerdem wären viele dieser Stunden sonst mit Familien verbracht worden.  Ich schätze das Verständnis meiner Frau und meiner Kinder aufgrund der Zeit, die ich damit verbracht habe, sehr und möchte ihnen auch danken. <br><br><h1>  Anmerkungen </h1><br>  Ich sollte <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Joachim Ornstedt</a> als einen der Mitwirkenden an der Openomni-Dekodierung sowie als den Schöpfer der wahrscheinlich ersten Integration mit Omnipod erwähnen.  Er baute ein Gerät, das optische Zeichenerkennung (OCR) verwendete, um Daten aus dem PDM zu extrahieren, und verband die Zifferntasten über einen anderen Mikrocontroller mit dem physischen PDM.  Dieser Ansatz ist schwer zu skalieren, aber er ist sehr intelligent und umgeht viele der Probleme, mit denen wir uns bei einer auf RE basierenden Lösung befassen mussten.  Ich bewundere wirklich, wie er mit dem Problem umgegangen ist und die Arbeit für einen winzigen Bruchteil der Zeit eingerichtet hat, die erforderlich war, um das Gerät mit Loop zum Laufen zu bringen. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de450962/">https://habr.com/ru/post/de450962/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de450950/index.html">Dart Streams Grundlagen</a></li>
<li><a href="../de450952/index.html">Mittlerer Index und Antibank</a></li>
<li><a href="../de450954/index.html">Wie wir gelernt haben, Java in Docker auszunutzen</a></li>
<li><a href="../de450956/index.html">Vergleich der industriellen COB: ISIM vs. Kics</a></li>
<li><a href="../de450958/index.html">AnyStub, Java-Verbindungsstubbibliothek</a></li>
<li><a href="../de450964/index.html">Neue x86 SIMD-Bibliothek - Immintrin-Debug</a></li>
<li><a href="../de450966/index.html">Video von einem alten Computer aufnehmen - Methoden von LGR</a></li>
<li><a href="../de450970/index.html">Wie man die Apple-Preise in den USA und in Russland wirklich vergleicht. Persönliche Erfahrung</a></li>
<li><a href="../de450972/index.html">Wie organisiere ich ein Fotostudio? Fall von Bolshakova Studio</a></li>
<li><a href="../de450974/index.html">Xiaomi Sleep Tracker - Sleepace Sleep Dot Bewertung</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>