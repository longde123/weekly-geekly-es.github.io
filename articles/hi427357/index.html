<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ЁЯСРЁЯП╗ тЬК ЁЯОУ рдПрдХрддрд╛ рдореЗрдВ рд▓реЗрдЦрдиред GrabPass, PerRendererData тЫ╜я╕П ЁЯС╕ЁЯП╝ ЁЯТЙ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдирдорд╕реНрддреЗ! рдореИрдВ рдпреВрдирд┐рдЯреА рдореЗрдВ рдЕрдкрдиреЗ рдЕрдиреБрднрд╡ рд▓реЗрдЦрди рд╢реЗрдбреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред рдЖрдЗрдП 2 рдбреА рдореЗрдВ рд╡рд┐рд╕реНрдерд╛рдкрди / рдЕрдкрд╡рд░реНрддрди рд╢реЗрдбрд░ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВ, рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдПрдХрддрд╛ рдореЗрдВ рд▓реЗрдЦрдиред GrabPass, PerRendererData</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427357/">  рдирдорд╕реНрддреЗ!  рдореИрдВ рдпреВрдирд┐рдЯреА рдореЗрдВ рдЕрдкрдиреЗ рдЕрдиреБрднрд╡ рд▓реЗрдЦрди рд╢реЗрдбреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣реВрдВрдЧрд╛ред  рдЖрдЗрдП 2 рдбреА рдореЗрдВ рд╡рд┐рд╕реНрдерд╛рдкрди / рдЕрдкрд╡рд░реНрддрди рд╢реЗрдбрд░ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рдХрд░реЗрдВ, рдЗрд╕реЗ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░реЗрдВ (GrabPass, PerRendererData), рдФрд░ рдЬрд░реВрд░реА рд╕рдорд╕реНрдпрд╛рдУрдВ рдкрд░ рднреА рдзреНрдпрд╛рди рджреЗрдВред <br><br>  рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЙрди рд▓реЛрдЧреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ, рдЬрд┐рдирдХреЗ рдкрд╛рд╕ рд╢реЗрдбреНрд╕ рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╡рд┐рдЪрд╛рд░ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмрдирд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЧрдИ рд╣реИ, рд▓реЗрдХрд┐рди рдЙрди рдХреНрд╖рдорддрд╛рдУрдВ рд╕реЗ рдкрд░рд┐рдЪрд┐рдд рдирд╣реАрдВ рд╣реИрдВ рдЬреЛ рдпреВрдирд┐рдЯреА рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВ, рдФрд░ рдпрд╣ рдирд╣реАрдВ рдЬрд╛рдирддреА рд╣реИрдВ рдХрд┐ рдХрд┐рд╕ рддрд░рдл рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд░рдирд╛ рд╣реИред  рдЬрд╝рд░рд╛ рдЧреМрд░ рдХреАрдЬрд┐рдП, рд╢рд╛рдпрдж рдореЗрд░рд╛ рдЕрдиреБрднрд╡ рдЖрдкрдХреЛ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗред <br><br><img src="https://habrastorage.org/webt/7p/cy/pr/7pcyprnckvacvecylqvlu-8g68m.gif"><br><a name="habracut"></a><br>  рдпрд╣ рд╡рд╣ рдкрд░рд┐рдгрд╛рдо рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/u5/wo/ll/u5woll2fo6nibjmd0lrgvszxvxk.gif" alt="рдЫрд╡рд┐"><br><br><h2>  рдЯреНрд░реЗрдирд┐рдВрдЧ </h2><br>  рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдПрдХ рд╢реЗрдбрд░ рдмрдирд╛рдПрдВ рдЬреЛ рдХреЗрд╡рд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕реНрдкреНрд░рд╛рдЗрдЯ рдХреЛ рдЖрдХрд░реНрд╖рд┐рдд рдХрд░реЗрдЧрд╛ред  рд╡рд╣ рдЖрдЧреЗ рдХреЗ рдЬреЛрдбрд╝рддреЛрдбрд╝ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░рд╛ рдЖрдзрд╛рд░ рд╣реЛрдЧрд╛ред  рдЗрд╕рдореЗрдВ рдХреБрдЫ рдЬреЛрдбрд╝рд╛ рдЬрд╛рдПрдЧрд╛, рдЗрд╕рдХреЗ рд╡рд┐рдкрд░реАрдд рдХреБрдЫ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдпрд╣ рдХреБрдЫ рдЯреИрдЧ рдФрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреА рдЕрдиреБрдкрд╕реНрдерд┐рддрд┐ рдХреЗ рдорд╛рдирдХ "рд╕реНрдкреНрд░рд╛рдЗрдЯреНрд╕-рдбрд┐рдлреЙрд▓реНрдЯ" рд╕реЗ рдЕрд▓рдЧ рд╣реЛрдЧрд╛ рдЬреЛ рдкрд░рд┐рдгрд╛рдо рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред <br><br><div class="spoiler">  <b class="spoiler_title">рд╕реНрдкреНрд░рд╛рдЗрдЯ рдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдЫрд╛рдпрд╛рджрд╛рд░ рдХреЛрдб</b> <div class="spoiler_text"><pre><code class="hljs pgsql">Shader "Displacement/Displacement_Wave" { Properties { [PerRendererData] _MainTex ("Main Texture", <span class="hljs-number"><span class="hljs-number">2</span></span>D) = "white" {} _Color ("Color" , Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) } SubShader { Tags { "RenderType" = "Transparent" "Queue" = "Transparent" } Cull <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> Blend SrcAlpha OneMinusSrcAlpha Pass { CGPROGRAM #pragma vertex vert #pragma fragment frag #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "UnityCG.cginc" struct appdata { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : POSITION; float2 uv : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; }; struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; float2 uv : TEXCOORD0; <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; }; fixed4 _Color; sampler2D _MainTex; v2f vert (appdata v) { v2f o; o.uv = v.uv; o.color = v.color; o.vertex = UnityObjectToClipPos(v.vertex); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; } fixed4 frag (v2f i) : SV_Target { fixed4 texColor = tex2D(_MainTex, i.uv)*i.color; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> texColor; } ENDCG } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдкреНрд░рд╛рдЗрдЯ</b> <div class="spoiler_text">  рдкреГрд╖реНрдарднреВрдорд┐ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдкрд╛рд░рджрд░реНрд╢реА рд╣реИ, рдЬрд╛рдирдмреВрдЭрдХрд░ рдЕрдВрдзреЗрд░рд╛ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/7l/yu/in/7lyuingedtk8frmquebh2m0kgdy.jpeg" alt="рдЫрд╡рд┐"><br></div></div><br>  рдкрд░рд┐рдгрд╛рдореА рд╡рд░реНрдХрдкреАрд╕ред <br><br><img src="https://habrastorage.org/webt/yl/ir/9i/ylir9i7bz4ibkkbhag61q8v95ak.jpeg" alt="рдЫрд╡рд┐"><br><br><h2>  GrabPass </h2><br>  рдЕрдм рд╣рдорд╛рд░рд╛ рдХрд╛рд░реНрдп рд╕реНрдХреНрд░реАрди рдкрд░ рд╡рд░реНрддрдорд╛рди рдЫрд╡рд┐ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░рдирд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдПрдХ рдЫрд╡рд┐ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдФрд░ <i>GrabPass</i> рдкреИрд╕реЗрдЬ рд╣рдорд╛рд░реА рдорджрдж рдХрд░реЗрдЧрд╛ред  рдпрд╣ рдорд╛рд░реНрдЧ <i>_GrabTexture</i> рдмрдирд╛рд╡рдЯ рдореЗрдВ рд╕реНрдХреНрд░реАрди рдЫрд╡рд┐ рдХреЛ рдХреИрдкреНрдЪрд░ рдХрд░реЗрдЧрд╛ред  рдмрдирд╛рд╡рдЯ рдореЗрдВ рд╡рд╣реА рд╣реЛрдЧрд╛ рдЬреЛ рдЗрд╕ рдЫрд╛рдпрд╛рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд╛рд░реА рд╡рд╕реНрддреБ рд╕реЗ рдкрд╣рд▓реЗ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред <br><br>  рдмрдирд╛рд╡рдЯ рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рдкрд┐рдХреНрд╕реЗрд▓ рд░рдВрдЧ рдХреЛ рдкрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдХреИрди рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЕрддрд┐рд░рд┐рдХреНрдд рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рдЯреБрдХрдбрд╝рд╛ shader рдбреЗрдЯрд╛ рдореЗрдВ рдЬреЛрдбрд╝реЗрдВред  рдпреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдирд╣реАрдВ рд╣реИрдВ (рдорд╛рди 0 рд╕реЗ 1 рддрдХ рдХреА рд╕реАрдорд╛ рдореЗрдВ рдирд╣реАрдВ рд╣реИрдВ) рдФрд░ рдХреИрдорд░реЗ рдХреЗ рд╕реНрдерд╛рди (рдкреНрд░рдХреНрд╖реЗрдкрдг) рдореЗрдВ рдПрдХ рдмрд┐рдВрджреБ рдХреА рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="hljs pgsql">struct v2f { <span class="hljs-type"><span class="hljs-type">float4</span></span> vertex : SV_POSITION; float2 uv : <span class="hljs-type"><span class="hljs-type">float4</span></span> color : COLOR; <span class="hljs-type"><span class="hljs-type">float4</span></span> grabPos : TEXCOORD1; };</code> </pre> <br>  рдФрд░ рд╢реАрд░реНрд╖ рдореЗрдВ shader рдЙрдиреНрд╣реЗрдВ рднрд░реЗрдВред <br><br><pre> <code class="hljs">o.grabPos = ComputeGrabScreenPos (o.vertex);</code> </pre> <br>  <i>_GrabTexture</i> рд╕реЗ рд░рдВрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рд╣рдо рдЧреИрд░-рд╕рд╛рдорд╛рдиреНрдпреАрдХреГрдд рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ <br><br><pre> <code class="hljs lisp">tex2Dproj(<span class="hljs-name"><span class="hljs-name">_GrabTexture</span></span>, i.grabPos)</code> </pre> <br>  рд▓реЗрдХрд┐рди рд╣рдо рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдФрд░ рдкрд░рд┐рдкреНрд░реЗрдХреНрд╖реНрдп рд╡рд┐рднрд╛рдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░реЗрдВрдЧреЗ, рдЕрд░реНрдерд╛рддред  рдЕрдиреНрдп рд╕рднреА рдХреЛ w- рдШрдЯрдХ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рдирд╛ред <br><br><pre> <code class="hljs lisp">tex2D(<span class="hljs-name"><span class="hljs-name">_GrabTexture</span></span>, i.grabPos.xy/i.grabPos.w)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">w рдШрдЯрдХ</b> <div class="spoiler_text">  рдПрдХ рдбрдмреНрд▓реНрдпреВ-рдШрдЯрдХ рдореЗрдВ рд╡рд┐рднрд╛рдЬрди рдХреЗрд╡рд▓ рдкрд░рд┐рдкреНрд░реЗрдХреНрд╖реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рдСрд░реНрдереЛрдЧреНрд░рд╛рдлрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдкрдг рдореЗрдВ рдпрд╣ рд╣рдореЗрд╢рд╛ 1 рд╣реЛрдЧрд╛ред рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, <b>рдбрдмреНрд▓реНрдпреВ</b> рджреВрд░реА рдХреЗ рдореВрд▓реНрдп рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рддрд╛ рд╣реИ, рдХреИрдорд░реЗ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рдпрд╣ рдЧрд╣рд░рд╛рдИ рдирд╣реАрдВ рд╣реИ - <b>z</b> , рдЬрд┐рд╕рдХрд╛ рдорд╛рди 0 рд╕реЗ 1 рддрдХ рдХреА рд╕реАрдорд╛ рдореЗрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЧрд╣рд░рд╛рдИ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдирд╛ рдПрдХ рдЕрд▓рдЧ рд╡рд┐рд╖рдп рдХреЗ рдпреЛрдЧреНрдп рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЕрдкрдиреА рдЫрд╛рдпрд╛ рдореЗрдВ рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдВрдЧреЗред </div></div><br>  рдкрд░рд┐рдкреНрд░реЗрдХреНрд╖реНрдп рд╡рд┐рднрд╛рдЬрди рдХреЛ рд╢реАрд░реНрд╖ рдХреЗ рд╢реЗрдбрд░ рдореЗрдВ рднреА рдкреНрд░рджрд░реНрд╢рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рддреИрдпрд╛рд░ рдбреЗрдЯрд╛ рдХреЛ рдЯреБрдХрдбрд╝реЗ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред <br><br><pre> <code class="hljs mel">v2f vert (appdata v) { v2f o; o.uv = v.uv; o.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = v.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; o.vertex = UnityObjectToClipPos(v.vertex); o.grabPos = ComputeScreenPos (o.vertex); o.grabPos /= o.grabPos.w; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; }</code> </pre> <br>  рдХреНрд░рдорд╢рдГ рдПрдХ рдЯреБрдХрдбрд╝рд╛ shader рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="hljs matlab">fixed4 frag (v2f <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>) : SV_Target { fixed4 = grabColor = tex2d(_GrabTexture, <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>.grabPos.xy); fixed4 texColor = tex2D(_MainTex, <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>.uv)*<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>.color; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> grabColor; }</code> </pre> <br>  рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдорд┐рд╢реНрд░рдг рдореЛрдб рдХреЛ рдмрдВрдж рдХрд░реЗрдВ, рдХреНрдпреЛрдВрдХрд┐  рдЕрдм рд╣рдо рдЕрдкрдиреЗ рд╕рдореНрдорд┐рд╢реНрд░рдг рдореЛрдб рдХреЛ рдЯреБрдХрдбрд╝реЗ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЗ рдЕрдВрджрд░ рд▓рд╛рдЧреВ рдХрд░ рд░рд╣реЗ рд╣реИрдВред <br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">//Blend SrcAlpha OneMinusSrcAlpha Blend Off</span></span></code> </pre><br>  рдФрд░ <i>GrabPass</i> рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреЛ <i>рджреЗрдЦреЗрдВ</i> ред <br><br><img src="https://habrastorage.org/webt/mh/ex/b_/mhexb_lek_zyrgsto6p0ki4rmoi.jpeg" alt="рдЫрд╡рд┐"><br><br>  рдХреБрдЫ рднреА рдирд╣реАрдВ рд╣реБрдЖ рд▓рдЧрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдирд╣реАрдВ рд╣реИред  рд╕реНрдкрд╖реНрдЯрддрд╛ рдХреЗ рд▓рд┐рдП, рд╣рдо рдПрдХ рдорд╛рдореВрд▓реА рдмрджрд▓рд╛рд╡ рдХрд╛ рдкрд░рд┐рдЪрдп рджреЗрддреЗ рд╣реИрдВ, рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдо рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдЪрд░ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред  рддрд╛рдХрд┐ рд╣рдо рдЪрд░ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХреЗрдВ, рдПрдХ рдирдпрд╛ <i>_DisplacementPower</i> рдЧреБрдг рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="hljs powershell">Properties { <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">PerRendererData</span></span></span><span class="hljs-function">] _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainTex</span></span></span></span> (<span class="hljs-string"><span class="hljs-string">"Main Texture"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Color (<span class="hljs-string"><span class="hljs-string">"Color"</span></span> , Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _DisplacementPower (<span class="hljs-string"><span class="hljs-string">"Displacement Power"</span></span> , Float) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Pass { ... float _DisplacementPower; ... } }</code> </pre> <br>  рдФрд░ рдлрд┐рд░ рд╕реЗ, рдЯреБрдХрдбрд╝рд╛ shader рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХрд░реЗрдВред <br><br><pre> <code class="hljs lisp">fixed4 grabColor = tex2d(<span class="hljs-name"><span class="hljs-name">_GrabTexture</span></span>, i.grabPos.xy + _DisplaccementPower)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  рдУрдк рд╣реЙрдк рдФрд░ рдкрд░рд┐рдгрд╛рдо!  рдПрдХ рдмрджрд▓рд╛рд╡ рдХреЗ рд╕рд╛рде рдЫрд╡рд┐ред <br><br><img src="https://habrastorage.org/webt/ky/yl/9w/kyyl9w51dqeap4_wvxws1nod4fg.jpeg"><br><br>  рдПрдХ рд╕рдлрд▓ рдмрджрд▓рд╛рд╡ рдХреЗ рдмрд╛рдж, рдЖрдк рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рд╡рд┐рдХреГрддрд┐ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдкреВрд░реНрд╡-рддреИрдпрд╛рд░ рдмрдирд╛рд╡рдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдмрд┐рдВрджреБ рдкрд░ рд╡рд┐рд╕реНрдерд╛рдкрди рдмрд▓ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛ред  X рдЕрдХреНрд╖ рдкрд░ рдСрдлрд╕реЗрдЯ рдорд╛рди рдХреЗ рд▓рд┐рдП рд▓рд╛рд▓ рд░рдВрдЧ, рдФрд░ y рдЕрдХреНрд╖ рдкрд░ рд╣рд░рд╛ред <br><br><div class="spoiler">  <b class="spoiler_title">рд╡рд┐рд░реВрдкрдг рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЧрдП рдмрдирд╛рд╡рдЯ</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0f/fu/-e/0ffu-ezmyhr9lb3qofn9d99ese8.png"><br><img src="https://habrastorage.org/webt/ld/mf/no/ldmfnoicn2b7e7cmsbpeml716hs.png"><br></div></div><br>  рдЪрд▓рд┐рдП рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдмрдирд╛рд╡рдЯ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдирдИ рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">_DisplacementTex</span></span> (<span class="hljs-string"><span class="hljs-string">"Displacement Texture"</span></span>, 2D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {}</code> </pre> <br>  рдФрд░ рдПрдХ рдЪрд░ред <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sampler2D</span></span> _DisplacementTex;</code> </pre> <br>  рдЯреБрдХрдбрд╝реЗ рдХреА рдЫрд╛рдпрд╛ рдореЗрдВ рд╣рдо рдмрдирд╛рд╡рдЯ рд╕реЗ рдСрдлрд╕реЗрдЯ рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдмрдирд╛рд╡рдЯ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рдореЗрдВ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВред <br><br><pre> <code class="hljs lisp">fixed4 displPos = tex2D(<span class="hljs-name"><span class="hljs-name">_DisplacementTex</span></span>, i.uv)<span class="hljs-comment"><span class="hljs-comment">; float2 offset = (displPos.xy*2 - 1) * _DisplacementPower * displPos.a; fixed4 grabColor = tex2D (_GrabTexture, i.grabPos.xy + offset);</span></span></code> </pre><br>  рдЕрдм, <i>_DisplacementPower</i> рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдмрджрд▓рддреЗ рд╣реБрдП, рд╣рдо рдХреЗрд╡рд▓ рдореВрд▓ рдЫрд╡рд┐ рдХреЛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рд╡рд┐рдХреГрдд рдХрд░рддреЗ рд╣реИрдВред <br><br><img src="https://habrastorage.org/webt/tu/pu/w3/tupuw3jqxaztn2jl19mdyhtvzwi.gif"><br><br><h3>  рдУрд╡рд░рд▓реЗ </h3><br>  рдЕрдм рд╕реНрдХреНрд░реАрди рдкрд░ рдХреЗрд╡рд▓ рдЕрдВрддрд░рд┐рдХреНрд╖ рдХрд╛ рд╡рд┐рд░реВрдкрдг рд╣реИ, рдФрд░ рд╕реНрдкреНрд░рд╛рдЗрдЯ, рдЬрд┐рд╕реЗ рд╣рдордиреЗ рдмрд╣реБрдд рд╢реБрд░реБрдЖрдд рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдерд╛, рдЕрдиреБрдкрд╕реНрдерд┐рдд рд╣реИред  рд╣рдо рдЗрд╕реЗ рдЙрд╕рдХреА рдЬрдЧрд╣ рдкрд░ рд▓реМрдЯрд╛ рджреЗрдВрдЧреЗред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рд░рдВрдЧреЛрдВ рдХреЗ рдПрдХ рдХрдард┐рди рдорд┐рд╢реНрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдХреБрдЫ рдФрд░ рд▓реЗрдВ, рдЬреИрд╕реЗ рдХрд┐ рдУрд╡рд░рд▓реЗ рдмреНрд▓реЗрдВрдбрд┐рдВрдЧ рдореЛрдбред  рдЗрд╕рдХрд╛ рд╕реВрддреНрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ: <br><br><img src="https://habrastorage.org/webt/wd/qr/z7/wdqrz7rv0skaotpofwwu4owvyxy.jpeg"><br><br>  рдЬрд╣рд╛рдВ S рдореВрд▓ рдЫрд╡рд┐ рд╣реИ, C рд╕реБрдзрд╛рд░рд╛рддреНрдордХ рд╣реИ, рдЕрд░реНрдерд╛рдд рд╣рдорд╛рд░рд╛ рд╕реНрдкреНрд░рд╛рдЗрдЯ, R рдкрд░рд┐рдгрд╛рдо рд╣реИред <br><br>  рдЗрд╕ рдлреЙрд░реНрдореВрд▓реЗ рдХреЛ рд╣рдорд╛рд░реЗ shader рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВред <br><br><pre> <code class="hljs mel">fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> ? <span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>*texColor : <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-number"><span class="hljs-number">-2</span></span>*(<span class="hljs-number"><span class="hljs-number">1</span></span>-texColor)*(<span class="hljs-number"><span class="hljs-number">1</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>);</code> </pre><br>  рдПрдХ shader рдореЗрдВ рд╕рд╢рд░реНрдд рдСрдкрд░реЗрдЯрд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдмрд▓реНрдХрд┐ рднреНрд░рд╛рдордХ рд╡рд┐рд╖рдп рд╣реИред  рдмрд╣реБрдд рдХреБрдЫ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдФрд░ рдЧреНрд░рд╛рдлрд┐рдХреНрд╕ рдПрдкреАрдЖрдИ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИред  рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рд╕рд╢рд░реНрдд рд╡рдХреНрддрд╡реНрдп рдкреНрд░рджрд░реНрд╢рди рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  рд▓реЗрдХрд┐рди рдпрд╣ рд╣рдореЗрд╢рд╛ рдХрдордмреИрдХ рдХрд░рдиреЗ рд▓рд╛рдпрдХ рд╣реЛрддрд╛ рд╣реИред  рд╕рд╢рд░реНрдд рдСрдкрд░реЗрдЯрд░ рдХреЛ рдЧрдгрд┐рдд рдФрд░ рдЙрдкрд▓рдмреНрдз рддрд░реАрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрдорд╛рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ <br><br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = step ( y, x); r = <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> * a + (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) * b;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">рдХрджрдо рд╕рдорд╛рд░реЛрд╣</b> <div class="spoiler_text">  рдЪрд░рдг рдлрд╝рдВрдХреНрд╢рди 1 рд╡рд╛рдкрд╕ рдЖ рдЬрд╛рдПрдЧрд╛ рдпрджрд┐ <b>x</b> <b>y</b> рд╕реЗ рдЕрдзрд┐рдХ рдпрд╛ рдмрд░рд╛рдмрд░ рд╣реИред  рдФрд░ 0 рдЕрдЧрд░ <b>x</b> <b>y</b> рд╕реЗ рдХрдо рд╣реИред <br><br>  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ <b>x</b> = 1, рдФрд░ <b>y</b> = 0.5 рд╣реИ, рддреЛ <b>c</b> рдХрд╛ рдкрд░рд┐рдгрд╛рдо 1. рд╣реЛрдЧрд╛ рдФрд░ рдирд┐рдореНрди рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХреА рддрд░рд╣ рджрд┐рдЦреЗрдЧрд╛ <br>  рдЖрд░ = 1 * рдП + 0 * рдмреА <br>  рдХреНрдпреЛрдВрдХрд┐  0 рд╕реЗ рдЧреБрдгрд╛ рдХрд░рдирд╛ 0 рджреЗрддрд╛ рд╣реИ, рддреЛ рдкрд░рд┐рдгрд╛рдо рдХреЗрд╡рд▓ a рдХрд╛ рдорд╛рди рд╣реЛрдЧрд╛ред <br>  рдЕрдиреНрдпрдерд╛, рдпрджрд┐ <b>c</b> 0 рд╣реИ, <br>  r = 0 * a + 1 * b <br>  рдФрд░ рдЕрдВрддрд┐рдо рдкрд░рд┐рдгрд╛рдо <b>рдмреА</b> рд╣реЛрдЧрд╛ред <br></div></div><br>  <i>рдУрд╡рд░рд▓реЗ</i> рдореЛрдб рдХреЗ рд▓рд┐рдП рд░рдВрдЧ рдХреЛ рдлрд┐рд░ рд╕реЗ рд▓рд┐рдЦреЗрдВред <br><br><pre> <code class="hljs mel">fixed s = step(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = s * (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> * texColor) + (<span class="hljs-number"><span class="hljs-number">1</span></span> - s) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> - texColor) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>));</code> </pre> <br>  рд╕реНрдкреНрд░рд╛рдЗрдЯ рдХреА рдкрд╛рд░рджрд░реНрд╢рд┐рддрд╛ рдкрд░ рд╡рд┐рдЪрд╛рд░ рдХрд░рдирд╛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рджреЛ рд░рдВрдЧреЛрдВ рдХреЗ рдмреАрдЪ рд░реИрдЦрд┐рдХ рдкреНрд░рдХреНрд╖реЗрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = lerp(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> ,texColor.a);</code> </pre> <br>  рдкреВрд░реНрдг рдЯреБрдХрдбрд╝рд╛ shader рдХреЛрдбред <br><br><pre> <code class="hljs mel">fixed4 frag (v2f i) : SV_Target { fixed4 displPos = tex2D(_DisplacementTex, i.uv); float2 offset = (displPos.xy*<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) * _DisplacementPower * displPos.a; fixed4 texColor = tex2D(_MainTex, i.uv + offset)*i.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; fixed4 <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> = tex2D (_GrabTexture, i.grabPos.xy + offset); fixed s = step(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = s * (<span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> * texColor) + (<span class="hljs-number"><span class="hljs-number">1</span></span> - s) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> - texColor) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = lerp(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> ,texColor.a); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; }</code> </pre> <br>  рдФрд░ рд╣рдорд╛рд░реЗ рдХрд╛рдо рдХрд╛ рдирддреАрдЬрд╛ рд╣реИред <br><br><img src="https://habrastorage.org/webt/ea/au/xy/eaauxypqmxxrbcjrkl4swnctjeg.gif"><br><br><h3>  GrabPass рдлрд╝реАрдЪрд░ </h3><br>  рдпрд╣ рдКрдкрд░ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ <i>GrabPass</i> рдкрд╛рд╕ <i>{}</i> рд╕реНрдХреНрд░реАрди рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ <i>_GrabTexture</i> рдмрдирд╛рд╡рдЯ рдореЗрдВ рдХреИрдкреНрдЪрд░ рдХрд░рддрд╛ рд╣реИред  рдЙрд╕реА рд╕рдордп, рд╣рд░ рдмрд╛рд░ рдЗрд╕ рдорд╛рд░реНрдЧ рдХреЛ рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрдирд╛рд╡рдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред <br>  рдмрдирд╛рд╡рдЯ рдХреЗ рдирд╛рдо рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ рдирд┐рд░рдВрддрд░ рдЕрджреНрдпрддрди рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реНрдХреНрд░реАрди рдХреА рд╕рд╛рдордЧреНрд░реА рдХреИрдкреНрдЪрд░ рдХреА рдЬрд╛рдПрдЧреАред <br><pre> <code class="hljs objectivec">GrabPass{<span class="hljs-string"><span class="hljs-string">"_DisplacementGrabTexture"</span></span>}</code> </pre> <br>  рдЕрдм рдмрдирд╛рд╡рдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗрд╡рд▓ GrabPass рдкрд╛рд╕ рдкреНрд░рддрд┐ рдлреНрд░реЗрдо рдХреЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдкрд░ рдЕрдкрдбреЗрдЯ рдХреА рдЬрд╛рдПрдЧреАред  рдпрд╣ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рдХреЛ рдмрдЪрд╛рддрд╛ рд╣реИ рдЕрдЧрд░ <i>GrabPass {}</i> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ <i>рдмрд╣реБрдд рд╕рд╛рд░реЗ</i> рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИрдВред  рд▓реЗрдХрд┐рди рдЕрдЧрд░ рджреЛ рд╡рд╕реНрддреБрдПрдВ рдУрд╡рд░рд▓реИрдк рд╣реЛрддреА рд╣реИрдВ, рддреЛ рдХрд▓рд╛рдХреГрддрд┐рдпрд╛рдВ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрдВрдЧреА, рдХреНрдпреЛрдВрдХрд┐ рджреЛрдиреЛрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдПрдХ рд╣реА рдЫрд╡рд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br>  GrabPass {"_ DisplacementGrabTexture"} рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред <br><br><img src="https://habrastorage.org/webt/9n/uv/n9/9nuvn9st0v_t9l7rwxspbmy8iww.jpeg"><br><br>  GrabPass {} рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред <br><br><img src="https://habrastorage.org/webt/sl/ai/4a/slai4akjk0suyfp43gptuyp3pfw.jpeg"><br><br><h2>  рдПрдиреАрдореЗрд╢рди </h2><br>  рдЕрдм рд╣рдорд╛рд░реЗ рдкреНрд░рднрд╛рд╡ рдХреЛ рдЪреЗрддрди рдХрд░рдиреЗ рдХрд╛ рд╕рдордп рдЖ рдЧрдпрд╛ рд╣реИред  рдзрдорд╛рдХреЗ рдХреА рд▓рд╣рд░ рдмрдврд╝рдиреЗ рдкрд░ рд╣рдо рд╡рд┐рд░реВрдкрдг рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рдХрдо рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдмрджрд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред <br><br><div class="spoiler">  <b class="spoiler_title">рдПрдиреАрдореЗрд╢рди рдХреЗ рд▓рд┐рдП рд╕реНрдХреНрд░рд┐рдкреНрдЯ</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Wave</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> _elapsedTime; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SpriteRenderer _renderer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> Duration; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AnimationCurve ScaleProgress; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Vector3 ScalePower; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AnimationCurve PropertyProgress; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PropertyPower; [Space] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> AnimationCurve AlphaProgress; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _renderer = GetComponent&lt;SpriteRenderer&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _elapsedTime = <span class="hljs-number"><span class="hljs-number">0f</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_elapsedTime &lt; Duration) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> progress = _elapsedTime / Duration; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> scale = ScaleProgress.Evaluate(progress) * ScalePower; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property = PropertyProgress.Evaluate(progress) * PropertyPower; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alpha = AlphaProgress.Evaluate(progress); transform.localScale = scale; _renderer.material.SetFloat(<span class="hljs-string"><span class="hljs-string">"_DisplacementPower"</span></span>, property); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> color = _renderer.color; color.a = alpha; _renderer.color = color; _elapsedTime += Time.deltaTime; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _elapsedTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">рдФрд░ рдЗрд╕рдХреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/cs/sm/9f/cssm9fqvoequsovfl8wlff72rxu.jpeg"><br></div></div><br>  рдПрдиреАрдореЗрд╢рди рдХрд╛ рдкрд░рд┐рдгрд╛рдо рд╣реИред <br><br><img src="https://habrastorage.org/webt/5j/sm/ic/5jsmicvf7jepmp-adecch-jlwb8.gif"><br><br><h2>  PerRendererData </h2><br>  рдиреАрдЪреЗ рдХреА рд░реЗрдЦрд╛ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВред <br><br><pre> <code class="cs hljs">_renderer.material.SetFloat(<span class="hljs-string"><span class="hljs-string">"_DisplacementPower"</span></span>, property);</code> </pre> <br>  рдпрд╣рд╛рдВ рд╣рдо рдХреЗрд╡рд▓ рд╕рд╛рдордЧреНрд░реА рдХреЗ рдЧреБрдгреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХреЛ рдирд╣реАрдВ рдмрджрд▓ рд░рд╣реЗ рд╣реИрдВ, рдмрд▓реНрдХрд┐ рд╕реНрд░реЛрдд рд╕рд╛рдордЧреНрд░реА (рдХреЗрд╡рд▓ рдЗрд╕ рдкрджреНрдзрддрд┐ рдХреЗ рдкрд╣рд▓реЗ рдХреЙрд▓ рдкрд░) рдХреА рдПрдХ рдкреНрд░рддрд┐ рдмрдирд╛ рд░рд╣реЗ рд╣реИрдВ рдФрд░ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд░рд╣реЗ рд╣реИрдВред  рдпрд╣ рдХрд╛рдлреА рдХрд╛рдо рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╡рд┐рдХрд▓реНрдк рд╣реИ, рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдордВрдЪ рдкрд░ рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ рдСрдмреНрдЬреЗрдХреНрдЯ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╣рдЬрд╛рд░, рддреЛ рдмрд╣реБрдд рд╕рд╛рд░реА рдкреНрд░рддрд┐рдпрд╛рдВ рдмрдирд╛рдиреЗ рд╕реЗ рдХреБрдЫ рднреА рдЕрдЪреНрдЫрд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред  рдПрдХ рдмреЗрд╣рддрд░ рд╡рд┐рдХрд▓реНрдк рд╣реИ - рдпрд╣ shader рдореЗрдВ <i>[PerRendererData]</i> рд╡рд┐рд╢реЗрд╖рддрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реИ, рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ <i>MaterialPropertyBlock</i> рдСрдмреНрдЬреЗрдХреНрдЯред <br><br>  рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, shader рдореЗрдВ <i>_DisplacementPower</i> рдЧреБрдг рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖рддрд╛ рдЬреЛрдбрд╝реЗрдВред <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">PerRendererData</span></span></span><span class="hljs-function">] _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisplacementPower</span></span></span></span> (<span class="hljs-string"><span class="hljs-string">"Displacement Power"</span></span> , Range(-.<span class="hljs-number"><span class="hljs-number">1</span></span>,.<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br>  рдЙрд╕рдХреЗ рдмрд╛рдж, рд╕рдВрдкрддреНрддрд┐ рдЕрдм рдирд┐рд░реАрдХреНрд╖рдХ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рд╣реЛрдЧреА, рдХреНрдпреЛрдВрдХрд┐  рдЕрдм рдпрд╣ рдкреНрд░рддреНрдпреЗрдХ рд╡рд╕реНрддреБ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╣реИ, рдЬреЛ рдореВрд▓реНрдпреЛрдВ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдЧрд╛ред <br><br><img src="https://habrastorage.org/webt/ni/g4/zu/nig4zujdlflr1xjm_ry-cwulane.jpeg"><br><br>  рд╣рдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд░ рд▓реМрдЯрддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> MaterialPropertyBlock _propertyBlock; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _renderer = GetComponent&lt;SpriteRenderer&gt;(); _propertyBlock = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MaterialPropertyBlock(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... <span class="hljs-comment"><span class="hljs-comment">//_renderer.material.SetFloat("_DisplacementPower", property); _renderer.GetPropertyBlock(_propertyBlock); _propertyBlock.SetFloat("_DisplacementPower", property); _renderer.SetPropertyBlock(_propertyBlock); ... }</span></span></code> </pre> <br>  рдЕрдм, рд╕рдВрдкрддреНрддрд┐ рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <i>рд╕рд╛рдордЧреНрд░реА</i> рдХреА рдкреНрд░рддрд┐рдпрд╛рдВ рдмрдирд╛рдП рдмрд┐рдирд╛ рдЕрдкрдиреА рд╡рд╕реНрддреБ рдХреЗ <i>MaterialPropertyBlock</i> рдХреЛ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВрдЧреЗред <br><br><div class="spoiler">  <b class="spoiler_title">SpriteRenderer рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</b> <div class="spoiler_text">  рдЖрдЗрдП рдЗрд╕ рд░реЗрдЦрд╛ рдХреЛ shader рдореЗрдВ рджреЗрдЦреЗрдВред <br><br><pre> <code class="hljs powershell"><span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">PerRendererData</span></span></span><span class="hljs-function">] _</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainTex</span></span></span></span> (<span class="hljs-string"><span class="hljs-string">"Main Texture"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {}</code> </pre> <br>  <i>рд╕реНрдкреНрд░рд╛рдЗрдЯ рд░реЗрдВрдбрд░рд░</i> рд╕реНрдкреНрд░рд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рдЗрд╕реА рддрд░рд╣ <i>рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ</i> ред  рдпрд╣ <i>MaterialPropertyBlock</i> рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ <i>рдЕрдкрдиреЗ</i> рдореВрд▓реНрдп рдХреЗ рд▓рд┐рдП <i>_MainTex</i> рд╕рдВрдкрддреНрддрд┐ рд╕реЗрдЯ рдХрд░рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдирд┐рд░реАрдХреНрд╖рдХ рдореЗрдВ, <i>_MainTex</i> рд╕рдВрдкрддреНрддрд┐ рдХреЛ рд╕рд╛рдордЧреНрд░реА рдХреЗ рд▓рд┐рдП рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ <i>SpriteRenderer</i> рдШрдЯрдХ рдореЗрдВ рд╣рдо рдЙрд╕ рдмрдирд╛рд╡рдЯ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХреА рд╣рдореЗрдВ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕реА рд╕рдордп, рдордВрдЪ рдкрд░ рдХрдИ рдЕрд▓рдЧ-рдЕрд▓рдЧ рд╕реНрдкреНрд░рд╛рдЗрдЯ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЙрдирдХреЗ рдкреНрд░рддрд┐рдкрд╛рджрди рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдПрдХ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ (рдпрджрд┐ рдЖрдк рдЗрд╕реЗ рд╕реНрд╡рдпрдВ рдирд╣реАрдВ рдмрджрд▓рддреЗ рд╣реИрдВ)ред <br></div></div><br><h3>  PerRendererData рдлрд╝реАрдЪрд░ </h3><br>  рдЖрдк рд░реЗрдВрдбрд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд▓рдЧрднрдЧ рд╕рднреА рдШрдЯрдХреЛрдВ рд╕реЗ <i>MaterialPropertyBlock</i> рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, <i>SpriteRenderer</i> , <i>ParticleRenderer</i> , <i>MeshRenderer</i> рдФрд░ рдЕрдиреНрдп <i>Renderer</i> рдШрдЯрдХред  рд▓реЗрдХрд┐рди рд╣рдореЗрд╢рд╛ рдПрдХ рдЕрдкрд╡рд╛рдж рд╣реЛрддрд╛ рд╣реИ, рдпрд╣ <i>рдХреИрдирд╡рд╕ рд░реЗрдВрдбрд░рд░ рд╣реИ</i> ред  рдЗрд╕ рдкрджреНрдзрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдФрд░ рдмрджрд▓рдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдк UI рдШрдЯрдХреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ 2 рдбреА рдЧреЗрдо рд▓рд┐рдЦрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рд╢реЗрдбрд░реНрд╕ рд▓рд┐рдЦрддреЗ рд╕рдордп рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░реЗрдВрдЧреЗред <br><br><h2>  рд░реЛрдЯреЗрд╢рди </h2><br>  рдПрдХ рдЕрдкреНрд░рд┐рдп рдкреНрд░рднрд╛рд╡ рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдЫрд╡рд┐ рдХреЛ рдШреБрдорд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред  рдПрдХ рдЧреЛрд▓ рд▓рд╣рд░ рдХреЗ рдЙрджрд╛рд╣рд░рдг рдкрд░, рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИред <br><br>  рдореЛрдбрд╝ (90 рдбрд┐рдЧреНрд░реА) рдкрд░ рд╕рд╣реА рддрд░рдВрдЧ рдПрдХ рдФрд░ рд╡рд┐рдХреГрддрд┐ рджреЗрддреА рд╣реИред <br><br><img src="https://habrastorage.org/webt/ns/gy/2e/nsgy2effgwcv8d0kavaltwd2ofi.jpeg"><br><br>  рд▓рд╛рд▓ рдмрдирд╛рд╡рдЯ рдореЗрдВ рдПрдХ рд╣реА рдмрд┐рдВрджреБ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рд╡реИрдХреНрдЯрд░ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдмрдирд╛рд╡рдЯ рдХреЗ рдПрдХ рдЕрд▓рдЧ рд░реЛрдЯреЗрд╢рди рдХреЗ рд╕рд╛рдеред  рдСрдлрд╝рд╕реЗрдЯ рдорд╛рди рд╕рдорд╛рди рд░рд╣рддрд╛ рд╣реИ рдФрд░ рд░реЛрдЯреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЦрд╛рддрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╣рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо <i>unity_ObjectToWorld</i> рдкрд░рд┐рд╡рд░реНрддрди <i>рдореИрдЯреНрд░рд┐рдХреНрд╕ рдХрд╛</i> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред  рдпрд╣ рд╣рдорд╛рд░реЗ рд╡реЗрдХреНрдЯрд░ рдХреЛ рд╕реНрдерд╛рдиреАрдп рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рд╕реЗ рджреБрдирд┐рдпрд╛ рдХреЗ рдирд┐рд░реНрджреЗрд╢рд╛рдВрдХ рддрдХ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧрд╛ред <br><br><pre> <code class="hljs pgsql">float2 <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> = (displPos.xy*<span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) * _DisplacementPower * displPos.a; <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> = mul( unity_ObjectToWorld, <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>);</code> </pre> <br>  рд▓реЗрдХрд┐рди рдореИрдЯреНрд░рд┐рдХреНрд╕ рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдкреИрдорд╛рдиреЗ рдкрд░ рдбреЗрдЯрд╛ рднреА рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╡рд┐рд░реВрдкрдг рдХреА рддрд╛рдХрдд рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдкреИрдорд╛рдиреЗ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред <br><br><pre> <code class="cs hljs">_propertyBlock.SetFloat(<span class="hljs-string"><span class="hljs-string">"_DisplacementPower"</span></span>, property/transform.localScale.x);</code> </pre> <br>  рджрд╛рд╣рд┐рдиреА рд▓рд╣рд░ рдХреЛ рднреА 90 рдбрд┐рдЧреНрд░реА рдШреБрдорд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рд╡рд┐рд░реВрдкрдг рдЕрдм рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЧрдгрдирд╛ рдХреА рдЬрд╛рддреА рд╣реИред <br><br><img src="https://habrastorage.org/webt/g4/hc/gu/g4hcguat4nxvgm0b2jyylrqvlze.jpeg"><br><br><h2>  рдХреНрд▓рд┐рдк </h2><br>  рд╣рдорд╛рд░реА рдмрдирд╛рд╡рдЯ рдореЗрдВ рдкрд░реНрдпрд╛рдкреНрдд рдкрд╛рд░рджрд░реНрд╢реА рдкрд┐рдХреНрд╕реЗрд▓ рд╣реИрдВ (рд╡рд┐рд╢реЗрд╖рдХрд░ рдпрджрд┐ рд╣рдо <i>Rect</i> mesh рдкреНрд░рдХрд╛рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ)ред  рд╢реЗрдбрд░ рдЙрдиреНрд╣реЗрдВ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдордЭ рдореЗрдВ рдирд╣реАрдВ рдЖрддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╣рдо рдЕрдирд╛рд╡рд╢реНрдпрдХ рдЧрдгрдирд╛рдУрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВрдЧреЗред  рд╣рдо <i>рдХреНрд▓рд┐рдк (x)</i> рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╛рд░рджрд░реНрд╢реА рдкрд┐рдХреНрд╕реЗрд▓ рдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рдмрд╛рдзрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдпрджрд┐ рдЗрд╕рдореЗрдВ рджрд┐рдпрд╛ рдЧрдпрд╛ рдкреИрд░рд╛рдореАрдЯрд░ рд╢реВрдиреНрдп рд╕реЗ рдХрдо рд╣реИ, рддреЛ рд╢реЗрдбрд░ рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рдПрдЧрд╛ред  рд▓реЗрдХрд┐рди рдЪреВрдВрдХрд┐ рдЕрд▓реНрдлрд╛ рдорд╛рди 0 рд╕реЗ рдХрдо рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдЙрд╕рд╕реЗ рдПрдХ рдЫреЛрдЯрд╛ рдореВрд▓реНрдп рдШрдЯрд╛рдПрдВрдЧреЗред  рдЗрд╕реЗ рдЧреБрдгреЛрдВ ( <i>рдХрдЯрдЖрдЙрдЯ</i> ) рдореЗрдВ рднреА рдбрд╛рд▓рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдЫрд╡рд┐ рдХреЗ рдкрд╛рд░рджрд░реНрд╢реА рднрд╛рдЧреЛрдВ рдХреЛ рдХрд╛рдЯрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рд╣рдореЗрдВ рдПрдХ рдЕрд▓рдЧ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рд╣рдо рдмрд╕ рд╕рдВрдЦреНрдпрд╛ <b>0.01 рдХрд╛</b> рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗред <br><br>  рдкреВрд░реНрдг рдЯреБрдХрдбрд╝рд╛ shader рдХреЛрдбред <br><br><pre> <code class="hljs mel">fixed4 frag (v2f i) : SV_Target { fixed4 displPos = tex2D(_DisplacementTex, i.uv); float2 offset = (displPos.xy * <span class="hljs-number"><span class="hljs-number">2</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span>) * _DisplacementPower * displPos.a; offset = mul( unity_ObjectToWorld,offset); fixed4 texColor = tex2D(_MainTex, i.uv + offset)*i.<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">clip</span></span>(texColor.a - <span class="hljs-number"><span class="hljs-number">0.01</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> = tex2D (_GrabTexture, i.grabPos.xy + offset); fixed s = step(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-number"><span class="hljs-number">0.5</span></span>); fixed4 <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = s * <span class="hljs-number"><span class="hljs-number">2</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span> * texColor + (<span class="hljs-number"><span class="hljs-number">1</span></span> - s) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span> - texColor) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = lerp(<span class="hljs-keyword"><span class="hljs-keyword">grabColor</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">color</span></span> ,texColor.a); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">color</span></span>; }</code> </pre> <br>  рдкреБрдирд╢реНрдЪ: рд╢реЗрдбрд░ рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд▓рд┐рдП рд╕реНрд░реЛрдд рдХреЛрдб <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдЧрд┐рдЯ рдХреА</a> рдПрдХ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=hi&amp;u=">рдХрдбрд╝реА рд╣реИ</a> ред  рд╡рд┐рд░реВрдкрдг рдХреЗ рд▓рд┐рдП рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдПрдХ рдЫреЛрдЯрд╛ рдмрдирд╛рд╡рдЯ рдЬрдирд░реЗрдЯрд░ рднреА рд╣реИред  рдХреБрд░рд╕реА рдХреЗ рд╕рд╛рде рдХреНрд░рд┐рд╕реНрдЯрд▓ рд╕рдВрдкрддреНрддрд┐ - 2 рдбреА рдЧреЗрдо рдХрд┐рдЯ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi427357/">https://habr.com/ru/post/hi427357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi427347/index.html">Google рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдкрд░ рдкрд▓рд╛рдпрди (Google рдХреНрд▓рд╛рдЙрдб рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо - GCP)</a></li>
<li><a href="../hi427349/index.html">рд╕рд╕реНрддреЗ CH340 рдЪреАрдиреА рдХрдирд╡рд░реНрдЯрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирдП рдЯреЙрдирдПрд╡реАрдЖрд░рдЖрд░ рдкрд░рд┐рд╡рд╛рд░ рдХреЗ рд▓рд┐рдП рдкреНрд░реЛрдЧреНрд░рд╛рдорд░</a></li>
<li><a href="../hi427351/index.html">рд╕реБрд░рдХреНрд╖рд╛ рд╕рдкреНрддрд╛рд╣ 40: рд╕реАрдПрдордПрд╕ рдбреНрд░реБрдкрд▓ рдФрд░ рдЕрдзрд┐рдХ рдореЗрдВ рдХрдордЬреЛрд░рд┐рдпрд╛рдВ</a></li>
<li><a href="../hi427353/index.html">рдбреНрд░реЛрди рджрд┐рдЦрд╛рддреЗ рд╣реИрдВ: рд╣рдордиреЗ рдбрд╛рдВрд╕рд┐рдВрдЧ рдХреЙрдкрд░реНрд╕ рдХреЗ рдЭреБрдВрдб рдХрд╛ рд╕рдордиреНрд╡рдп рдХреИрд╕реЗ рдХрд┐рдпрд╛</a></li>
<li><a href="../hi427355/index.html">CJM рд╕рдВрдХрд▓рди, рдкреНрд░рдореБрдЦ рдХрд▓рд╛ рдирд┐рд░реНрджреЗрд╢рдХ рдХреМрд╢рд▓ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рд╕рдордЭ</a></li>
<li><a href="../hi427359/index.html">рдХреИрд╕реЗ ECS, C # рдЬреЙрдм рд╕рд┐рд╕реНрдЯрдо, рдФрд░ SRP рдЪреЗрдВрдЬ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░</a></li>
<li><a href="../hi427361/index.html">FPGA рдкрд░ рд╡рд┐рдВрдбреЛ рдлрд╝рд┐рд▓реНрдЯрд░рд┐рдВрдЧ рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ</a></li>
<li><a href="../hi427363/index.html">рдПрдХ рдХреГрд╖рд┐ рдЙрджреНрдпрдо рдореЗрдВ рд▓реЛрд░рд╛рд╡рди рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдиред рдирд┐рд░реНрдорд╛рдг, рд▓реЙрдиреНрдЪ рдФрд░ рд╕рдорд╛рдзрд╛рди рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕рдм рдХреБрдЫ</a></li>
<li><a href="../hi427365/index.html">рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ RedSlerm рдХреА рд░рд┐рдкреЛрд░реНрдЯ (рдореЙрдиреЗрдЯ, рдЬрд╝реИрдмрд┐рдХреНрд╕)</a></li>
<li><a href="../hi427367/index.html">рдмреНрд▓реИрдХ рд╣рдЯ рдпреВрдПрд╕рдП рд╕рдореНрдореЗрд▓рдиред рдХреИрд╕реЗ рдПрдХ рд╣реЙрд▓реАрд╡реБрдб рд╣реИрдХрд░ рдирд┐рдЧрд░рд╛рдиреА рдХреИрдорд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рднрд╛рдЧ 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>