<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ûó ü§µüèø üèüÔ∏è Nuevo descargador de Buhtrap üë©üèø‚Äçüîß üßëüèæ‚Äçü§ù‚Äçüßëüèæ üß£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hoy le informaremos sobre un nuevo enfoque para enviar malware al grupo Buhtrap. 



 M√≥dulo de arranque 
 El 19 de diciembre, nos dimos cuenta de un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Nuevo descargador de Buhtrap</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/bizone/blog/434626/">  Hoy le informaremos sobre un nuevo enfoque para enviar malware al grupo Buhtrap. <br><br><img src="https://habrastorage.org/webt/sn/u8/a1/snu8a1cvx8zvuttb34taqxmyoxi.png"><br><br><h3>  <font color="#4169E1">M√≥dulo de arranque</font> </h3><br>  El 19 de diciembre, nos dimos cuenta de un correo malicioso que conten√≠a un archivo ejecutable ( <i>md5: faf833a1456e1bb85117d95c23892368</i> ).  El archivo tom√≥ varios nombres: "Reconciliaci√≥n para December.exe", "Docs wednesday.exe", "Documentos 19.12.exe", "Documentos de cierre wednesday.exe". <br><br>  Interesante: el archivo est√° escrito en .Net, lo que no es t√≠pico de este grupo criminal.  Para descompilar .Net, puede tomar cualquier software: <b>Reflector</b> , <b>dotPeek</b> , <b>dnSpy</b> , <b>ILSpy</b> .  En el art√≠culo hablaremos sobre las caracter√≠sticas de la implementaci√≥n de este archivo y c√≥mo lo analizamos. <br><a name="habracut"></a><br><h3>  <font color="#4169E1">Inspecci√≥n inicial del cargador de arranque</font> </h3><br>  Para el an√°lisis, usamos <b>dnSpy</b> , y todas las capturas de pantalla adicionales ser√°n de √©l. <br>  Por costumbre, abra el ejecutable en <b>IDA Pro</b> y mire la secci√≥n de importaci√≥n.  Ejemplos: <br><br><img src="https://habrastorage.org/webt/6n/ks/r-/6nksr-jvgkh8kj5kerx7erkx13w.png"><br><br>  La presencia de algunas funciones sugiere la presencia de una carga √∫til empaquetada ( <b>LoadCursorW</b> , <b>LoadIconW</b> - obtuvo el objeto de los recursos, <b>VirtualProtect</b> - cambi√≥ los atributos de la p√°gina, luego puede ejecutar el c√≥digo) y un simple anti-depuraci√≥n ( <b>IsDebuggerPresent</b> ).  Pero todo result√≥ ser a√∫n m√°s simple.  La ejecuci√≥n ni siquiera lleg√≥ a IsDebuggerPresent, y LoadCursorW y LoadIconW fueron in√∫tiles porque intentaron acceder a recursos inexistentes (LoadCursorW desde " <i>fiza</i> " y LoadIconW desde " <i>saxikulatebutohutejijobodugore</i> "): <br><br><img src="https://habrastorage.org/webt/gp/ye/vf/gpyevft3j2j5-vzaeg87-o9tczw.png"><br><br><img src="https://habrastorage.org/webt/lo/kq/ic/lokqicp7awjfseefk3gnouqs3p0.png"><br><br>  Pero volvamos al descompilador <b>dnSpy</b> .  En el archivo ejecutable, vemos una cantidad significativa de c√≥digo no administrado: <br><br><img src="https://habrastorage.org/webt/n1/og/k_/n1ogk_upsf-5baxmk9q04-8tsyw.png"><br><br>  Para comprender qu√© c√≥digo no administrado est√° en el archivo bajo investigaci√≥n, usaremos IDA Pro.  La forma m√°s f√°cil es ver el cuerpo del c√≥digo no administrado en forma hexadecimal.  Para hacer esto, vaya a la compensaci√≥n de archivo de desplazamiento.  Usando la funci√≥n <b>_main ()</b> como ejemplo: <br><br><img src="https://habrastorage.org/webt/-4/5p/81/-45p816dvsaj7whinkl7ctkaj8u.png"><br><br><img src="https://habrastorage.org/webt/vr/mf/ua/vrmfua0qkoqgqfcqvwzgj3rl_qc.png"><br><br>  A continuaci√≥n, en <b>IDA Pro, buscaremos</b> por secuencia hexadecimal: <br><br><img src="https://habrastorage.org/webt/ro/hh/oy/rohhoylitba4gnuxygzn9bs_pes.png"><br><br>  En la salida, obtenemos la funci√≥n no administrada _main (), con la que puede trabajar convenientemente con la ayuda del descompilador de idv: <br><br><img src="https://habrastorage.org/webt/zv/gs/pc/zvgspc2az6zmnuymfakhjy8tc0e.png"><br><br><img src="https://habrastorage.org/webt/ef/ea/sz/efeaszcwmkc-dpzpm_sl-dfjuk0.png"><br><br><h4>  Obteniendo carga √∫til </h4><br>  De vuelta a dnSpy.  Se llama la atenci√≥n sobre la variable <b>payloadData</b> . <br><br><img src="https://habrastorage.org/webt/fk/sc/od/fkscodflcwfpqv91v780smb2h4c.png"><br><br><img src="https://habrastorage.org/webt/rm/xx/xd/rmxxxdvbwil4utycw3fd5romqci.png"><br><br>  Encontramos esta secuencia en IDA Pro, obtenemos enlaces a ella y descubrimos que la llamada ocurre solo en la funci√≥n <b>_main ()</b> : <br><br><img src="https://habrastorage.org/webt/lm/2m/i7/lm2mi7e28qgrkqqtwbfenvkppls.png"><br><br>  El c√≥digo descompilado que usa este b√∫fer se ve as√≠: <br><br><img src="https://habrastorage.org/webt/u_/cw/1j/u_cw1jdwih4vxh7xx-2kb09fd5m.png"><br><br>  Las siguientes funciones son responsables de convertir este b√∫fer: <br><br><img src="https://habrastorage.org/webt/oc/tw/a6/octwa6li37592_dxbjjl5iw_vtu.png"><br><br>  Aqu√≠, la variable <b>holdrand</b> se <b>inicializa</b> a <i>0xEA48CB16</i> y la funci√≥n <b>foo ()</b> se llama en un bucle para cada byte desde <b>payloadData</b> ( <i>par√°metro sbyte c</i> ).  Cabe se√±alar que la funci√≥n t () proviene de un c√≥digo inseguro: si observa su c√≥digo, puede asegurarse de que siempre devuelva <i>0x343FD</i> . <br><br>  Nos armamos con IDA Pro y, al observar el b√∫fer desempaquetado resultante, notamos que contiene algo de c√≥digo al principio: <br><br><img src="https://habrastorage.org/webt/sf/5r/wu/sf5rwudeoqmxkcs-kcrrk5hskcg.png"><br><br>  En el desplazamiento <i>0x15A0</i> desde el comienzo del b√∫fer, se encuentra un archivo ejecutable: <br><br><img src="https://habrastorage.org/webt/4y/ul/fa/4yulfappi52yhaucx3iuy2je-tc.png"><br><br>  Gu√°rdelo para su posterior an√°lisis. <br><br>  Bueno, en el c√≥digo ejecutable en s√≠, se implementa algo bastante trivial.  Primero, se forma la siguiente estructura ( <i>aqu√≠ mz_base es la direcci√≥n de desplazamiento en el b√∫fer con el PE desempaquetado, y los campos restantes son las direcciones de las funciones requeridas y los identificadores de la biblioteca</i> ): <br><br><img src="https://habrastorage.org/webt/em/tx/2x/emtx2xx3rpongt81rdkgqenspt8.png"><br><br>  Y luego, utilizando las funciones obtenidas, se crea el proceso del mismo archivo ejecutable ( <i>md5: faf833a1456e1bb85117d95c23892368</i> ), y el ejecutable desempaquetado se asigna a las direcciones virtuales del nuevo proceso.  Despu√©s de cambiar la direcci√≥n de la instrucci√≥n ejecutable ( <b>paquete GetThreadContext</b> y <b>SetThreadContext</b> ), se inicia el subproceso del nuevo proceso y se <b>elimina</b> el proceso principal. <br><br>  Bueno, ahora pasamos al an√°lisis del archivo ejecutable resultante (carga √∫til). <br><br><h3>  <font color="#4169E1">Desempaque de carga √∫til</font> </h3><br>  La carga √∫til ( <i>volcado md5: d8f40c7060c44fab57df87ab709f058f</i> ) tambi√©n est√° escrita en .Net Framework. <br><br>  Para protegerse contra el an√°lisis est√°tico y din√°mico, los desarrolladores de <b>malware</b> utilizaron el √∫ltimo protector <b>ConfuserEx</b> popular: <br><br><img src="https://habrastorage.org/webt/75/ui/tb/75uitbdw5gznezlw4flyzx4c6-e.png"><br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ConfuserEx</a> es un protector de c√≥digo abierto bien establecido. <br><br><h3>  <font color="#4169E1">Desembalaje primario</font> </h3><br>  El punto de entrada de los archivos protegidos por este protector es el siguiente: <br><br><img src="https://habrastorage.org/webt/xc/fk/sr/xcfksree6xb2nl7l3sg-nn1dsqg.png"><br><br>  Despu√©s del descifrado, la matriz de bytes se carga en la memoria en forma de un m√≥dulo llamado <b>koi</b> .  Luego se determina y se llama el m√©todo principal de este m√≥dulo.  En la plataforma .Net, se puede obtener un m√©todo o constructor en un m√≥dulo a partir del token de metadatos llamando a la funci√≥n <b>Module.ResolveMethod ()</b> .  Para transferir el control al m√©todo obtenido, se utiliza la funci√≥n <b>MethodBase.Invoke ()</b> . <br><br><img src="https://habrastorage.org/webt/-s/1n/xo/-s1nxo2iy6mgehse3asimugo_ra.png"><br><br>  El c√≥digo ejecutable en el m√≥dulo <b>koi</b> es el siguiente: <br><br><img src="https://habrastorage.org/webt/fp/cj/9v/fpcj9viyn46punvfce7grleeati.png"><br><br>  Para quitar la banda de rodadura, utilizamos las siguientes utilidades: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/cawk/ConfuserEx-Unpacker</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">github.com/0xd4d/de4dot</a> </li></ul><br>  <b>ConfuserEx-Unpacker</b> descifr√≥ las l√≠neas y el c√≥digo dentro de los m√©todos, y <b>de4dot</b> hizo que los nombres de los m√©todos <b>fueran</b> legibles. <br><br>  El resultado es un c√≥digo adecuado para el an√°lisis est√°tico: <br><br><img src="https://habrastorage.org/webt/5p/_c/yx/5p_cyxuqhky7vndvuh0htnkkzp4.png"><br><br>  Por supuesto, tuvimos la suerte de obtener un c√≥digo legible.  Los creadores de virus pueden modificar el c√≥digo fuente de la banda de rodadura de <b>ConfuserEx</b> para complicar a√∫n m√°s el an√°lisis. <br>  Todav√≠a hay dos problemas que tuvieron que resolverse para un an√°lisis c√≥modo del archivo. <br><br><h4>  1er problema </h4><br>  Despu√©s de quitar la banda de rodadura, el descompilador no pudo analizar algunos de los m√©todos.  Por ejemplo: <br><br><img src="https://habrastorage.org/webt/uj/xm/h4/ujxmh4ivlwt0fm7w0xzkig5lu_k.png"><br><br>  Si cambia al c√≥digo IL, notar√° llamadas en punteros nulos: <br><br><img src="https://habrastorage.org/webt/5b/pw/is/5bpwismvu1l9gt6bktnrpvoxlya.png"><br><br>  Para corregir los errores de descompilaci√≥n, reemplace las instrucciones incorrectas con instrucciones nop.  (La utilidad <b>dnSpy le</b> permite modificar tanto el c√≥digo descompilado como el c√≥digo IL). <br>  Despu√©s del reemplazo, el c√≥digo descompilado se ve correcto: <br><br><img src="https://habrastorage.org/webt/gy/zi/8l/gyzi8lglspniec_imqi-uauacz4.png"><br><br>  Cambiando el c√≥digo IL en todos los m√©todos problem√°ticos, obtuvimos un archivo completamente descompilado. <br><br><h4>  2do problema </h4><br>  Es poco probable que se inicie el archivo resultante, y esto excluye la posibilidad de an√°lisis din√°mico.  Para resolver este problema, debe especificar el token del m√©todo de entrada en la estructura del archivo ejecutable. <br><br>  Puede encontrarlo de dos maneras: <br><br><ul><li>  mire debajo de la depuraci√≥n con qu√© par√°metro se llam√≥ la funci√≥n </li></ul><br>  <b>Module.ResolveMethod ()</b> antes de descomprimir el archivo: <br><br><img src="https://habrastorage.org/webt/1y/vt/ex/1yvtexa_v0psvugzbzwla1ow4zq.png"><br><br><ul><li>  en el archivo desempaquetado, encuentre el m√©todo con la etiqueta <b>[STAThread]</b> : </li></ul><br><img src="https://habrastorage.org/webt/xr/an/wi/xranwidrui8z1gmkbc23c84ibpg.png"><br><br>  En este caso, el token de metadatos para el m√©todo de entrada es <i>0x6000106</i> .  Lo cambiamos usando la utilidad <b>CFF Explorer</b> : <br><br><img src="https://habrastorage.org/webt/ad/7u/xp/ad7uxpajjbfh1gzvdqgaj8kw3oc.png"><br><br>  Despu√©s de guardar los cambios, se inicia el archivo desempaquetado y se depura correctamente. <br><br><h3>  <font color="#4169E1">An√°lisis del gestor de arranque</font> </h3><br>  Inmediatamente despu√©s del inicio del trabajo, el gestor de arranque comprueba si se est√° ejecutando en un entorno virtual. <br>  La ejecuci√≥n bajo <b>VMWare</b> o <b>QEMU</b> se determina buscando las subcadenas "vmware" y "qemu" en el siguiente valor de registro: <br><br><ul><li>  [HKLM \ System \ CurrentControlSet \ Services \ Disk \ Enum \ 0]. </li></ul><br>  Si se detecta una m√°quina virtual, el gestor de arranque muestra el mensaje de la ventana correspondiente: <br><br><img src="https://habrastorage.org/webt/wt/pw/lz/wtpwlzmwrcfsghc-bgib6fw0kru.png"><br><br>  Curiosamente, la salida de este mensaje no afecta el funcionamiento del proceso. <br><br>  Despu√©s de eso, el malware intenta cargar las bibliotecas de la siguiente lista en la memoria: <b>SbieDll.dll, dbghelp.dll, api_log.dll, dir_watch.dll, pstorec.dll, vmcheck.dll, wpespy.dll, snxhk.dll, guard32.dll</b> . <br><br>  Adem√°s, utilizando las llamadas a las funciones <b>Debugger.IsLogging ()</b> y <b>Debugger.get_IsAttached ()</b> , el cargador verifica si se est√° ejecutando bajo el depurador. <br>  Si al menos una de las bibliotecas se carga correctamente o el cargador detecta que se est√° ejecutando bajo el depurador, se <i>eliminar√° autom√°ticamente</i> mediante el comando " <i>cmd / C ping 8.8.8.8 -n 1 -w 3000&gt; Nul &amp; Del</i> ".  Curiosamente, el gestor de arranque puede auto <b>borrarse</b> incluso en un sistema real al cargar la biblioteca <b>dbghelp.dl</b> l. <br><br>  A continuaci√≥n, el malware comprueba si se inicia desde el directorio que contiene la subcadena "Mozilla". <br><br><h4>  Si el proceso no se inicia desde el directorio que contiene la subcadena "Mozilla" </h4><br><ul><li>  El malware crea una lista de directorios que se encuentran en el escritorio y contiene las siguientes subcadenas (todas las l√≠neas dentro del gestor de arranque se cifran con el algoritmo AES-256-ECB, las claves de cifrado se generan con contrase√±as codificadas): </li></ul><br><img src="https://habrastorage.org/webt/5f/xj/cb/5fxjcbvohua3udy6wiwixj3kwmo.jpeg"><br><br><ul><li>  Genera una lista de URL del historial del navegador que contiene las siguientes subcadenas: </li></ul><br><img src="https://habrastorage.org/webt/tc/ra/lh/tcralhf4zikmr0z5egouejvwafw.jpeg"><br><br><ul><li>  Genera una lista de archivos que se encuentran en los directorios "% UserProfile% \\ Desktop", "% AppData%", "C: \\ Program Files (x86)", "C: \\ Program Files (x86) (x86)" y tener los siguientes nombres: </li></ul><br><img src="https://habrastorage.org/webt/g5/5a/4k/g55a4keejjvjzv0jjdto5cs1fgw.jpeg"><br><br><ul><li>  Cuenta el n√∫mero de listas no vac√≠as de los indicadores relacionados con las operaciones bancarias (en la versi√≥n actual del gestor de arranque, esta funcionalidad no afecta nada). </li><li>  Crea una tarea para ejecutar este archivo cada vez que un usuario inicia sesi√≥n con el comando "schtasks / create / f / sc ONLOGON / RL HIGHEST / tn LimeRAT-Admin / tr". </li><li>  Si no se pudo crear la tarea, crea el acceso directo "% AppData% \\ Microsoft \\ Windows \\ Men√∫ Inicio \\ Programas \\ Inicio \\ MozillaUpdate.lnk", que indica "% Appdata% \\ Mozilla \\ xaudiodg.exe" , lo que garantiza que el archivo xaudiodg.exe se inicia cada vez que se reinicia el sistema. </li><li>  Se copia a lo largo de la ruta "% AppData% \\ Mozilla \\ xaudiodg.exe". </li><li>  Elimina el archivo &lt;self_path&gt;: Zone.Identifier, ejecuta xaudiodg.exe y se elimina autom√°ticamente. </li></ul><br><h4>  Si el proceso se inicia desde el directorio que contiene la subcadena "Mozilla" </h4><br><ul><li>  El malware tambi√©n busca los indicadores anteriores de operaciones bancarias dentro del sistema infectado. </li><li>  Recopila otra informaci√≥n del sistema para enviarla al servidor de administraci√≥n. </li><li>  En un hilo separado env√≠a informaci√≥n a los C&amp;C y espera una respuesta del servidor. </li><li>  En otro hilo, env√≠a una cadena encriptada "PING?" Al servidor en un bucle sin fin. </li></ul><br><h3>  <font color="#4169E1">Interacci√≥n del servidor de administraci√≥n</font> </h3><br>  La direcci√≥n IP del servidor en la muestra de malware probada es 213.252.244 [.] 200.  La conexi√≥n se inicializa mediante un puerto seleccionado al azar de la lista: <br><br>  ‚Ä¢ 8989, <br>  ‚Ä¢ 5656, <br>  ‚Ä¢ 2323. <br><br>  Inmediatamente despu√©s de que se inicializa la conexi√≥n, el gestor de arranque env√≠a informaci√≥n sobre el sistema infectado a los C&amp;C: <br><br>  ‚Ä¢ ID de usuario, <br>  ‚Ä¢ nombre de usuario <br>  ‚Ä¢ versi√≥n del sistema operativo, <br>  ‚Ä¢ su propia versi√≥n (cargador v0.2.1), <br>  ‚Ä¢ listas de indicadores de operaciones bancarias que se encuentran en el sistema infectado. <br><br>  Un ejemplo de una l√≠nea enviada por el cargador al servidor de administraci√≥n: <br><br><pre><code class="xml hljs">¬´INFO<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>9D3A4B22D21C<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>IEUser<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span> Windows 7 Enterprise SP 1 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>loader v0.2.1<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>1c, ¬ª</code> </pre> <br><br>  Esta l√≠nea se enviar√° si hay una carpeta "1c" en el escritorio del usuario infectado y no hay otros indicadores. <br>  La funci√≥n para procesar la respuesta del servidor es la siguiente: <br><br><img src="https://habrastorage.org/webt/o7/a0/qj/o7a0qjtcivxuursy_coehrz0lds.png"><br><br>  La respuesta descifrada del servidor es la siguiente: <br><br><ul><li><pre> <code class="xml hljs">COMMAND<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>DATA1<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>DATA2<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NYANxCAT</span></span></span><span class="hljs-tag">&gt;</span></span>‚Ä¶</code> </pre> </li></ul><br>  Como se puede ver en la captura de pantalla, COMMAND puede tomar uno de los siguientes valores: <br><br><ul><li>  <b>CERRAR</b> : finaliza la conexi√≥n y cierra el proceso actual; </li><li>  <b>DW</b> : decodifica el contenido base64 de DATA2, lo escribe en el archivo &lt;temp_file_name&gt; con la extensi√≥n de DATA1 e inicia el archivo para su ejecuci√≥n; </li><li>  <b>ACTUALIZACI√ìN</b> : decodifica el contenido base64 de DATA1, lo escribe en un archivo con el nombre &lt;temp_file_name&gt; y la extensi√≥n .exe, inicia un nuevo archivo ejecutable y se borra solo; </li><li>  <b>RD-</b> - env√≠a la cadena "RD-" en respuesta; </li><li>  <b>RD +</b> : env√≠a una captura de pantalla al servidor de administraci√≥n; </li><li>  DEL - se elimina autom√°ticamente. </li></ul><br>  Durante la investigaci√≥n del cargador de arranque, logramos obtener el comando DW del servidor atacante.  Como resultado de esto, el software Punto Switcher se instal√≥ con la DLL maliciosa winmm.dll (md5: 9d25553bb09e2785262b2f7ba7923605), que es un m√≥dulo de spyware Buhtrap. <br><br>  TCP Stream es el siguiente: <br><br><img src="https://habrastorage.org/webt/3c/su/h_/3csuh_fjfjm6hs4g9tt0ngql5qa.png"><br><br><img src="https://habrastorage.org/webt/mj/bw/uv/mjbwuvakfsdnak_k8lhfvtsht6o.png"><br><br>  Para cifrar los datos transmitidos entre el cliente y el servidor de administraci√≥n, se utiliza el algoritmo <b>AES-128-ECB</b> .  La clave de cifrado se inicializa con una contrase√±a codificada. <br><br>  Despu√©s del descifrado, el tr√°fico es el siguiente: <br><br><img src="https://habrastorage.org/webt/yp/-z/-8/yp-z-8jb5walz17xs-rozjatzjw.png"><br><br><img src="https://habrastorage.org/webt/lw/kg/ni/lwkgniohrsvqexvxamrwogmcmgy.png"><br><br>  Desde base64, el instalador NSIS se decodifica con los siguientes contenidos: <br><br><img src="https://habrastorage.org/webt/nx/fe/ij/nxfeijizxvvy4agsiobhqeil9tu.png"><br><br>  Curiosamente, el servidor respondi√≥, aunque la lista de indicadores bancarios estaba vac√≠a. <br><br><h3>  <font color="#4169E1">DLL malicioso</font> </h3><br>  La biblioteca <b>winmm.dll se</b> ejecuta utilizando la t√©cnica de secuestro de dll.  El m√≥dulo malicioso env√≠a informaci√≥n sobre el sistema infectado y una lista de lectores de tarjetas inteligentes activos a los C&amp;C.  Adem√°s, tiene un componente keylogger y puede recibir otros m√≥dulos maliciosos del servidor de gesti√≥n, ejecutarlos desde el disco o en la memoria del proceso actual.  Los servidores C y C de la muestra en estudio se encuentran en las siguientes direcciones: <br><br><ul><li>  hxxp: // my1cprovider [.] xyz: 6060 / klog [.] php </li><li>  hxxp: // tinderminderorli1999 [.] xyz: 7764 / klog [.] php </li></ul><br><h3>  <font color="#4169E1">Conclusi√≥n</font> </h3><br>  El proceso de infecci√≥n se puede representar como el siguiente esquema: <br><br><img src="https://habrastorage.org/webt/r8/ho/0e/r8ho0ecv5utwzrjykx0yg4jrpuk.png"><br><br>  A pesar de la buena protecci√≥n contra el an√°lisis, est√° claro que en este momento el gestor de arranque no funciona correctamente y es muy probable que est√© en proceso de desarrollo: <br><br><ul><li>  puede auto borrarse incluso en un sistema real; </li><li>  comprueba la conexi√≥n del sistema infectado con las operaciones bancarias antes de copiarse en "% AppData% \\ Mozilla \\ xaudiodg.exe" y antes de interactuar con C&amp;C, pero no utiliza esta informaci√≥n de ninguna manera. </li></ul><br>  Finalmente, recuerda el extra√±o mensaje de la ventana.  Curiosamente, ¬øes esto una falla en los desarrolladores, o se hace espec√≠ficamente para alentar a los usuarios a abandonar el entorno virtual y comenzar en una m√°quina real?  Bienvenido en los comentarios. <br><br><h3>  <font color="#4169E1">COI</font> </h3><br>  <b>MD5:</b> <br><br>  <i>faf833a1456e1bb85117d95c23892368</i> <i><br></i>  <i>9d25553bb09e2785262b2f7ba7923605</i> <br><br>  <b>URLs:</b> <br><br>  hxxp: // my1cprovider [.] xyz: 6060 / klog [.] php <br>  hxxp: // tinderminderorli1999 [.] xyz: 7764 / klog [.] php <br>  IPs: <br>  213.252.244 [.] 200 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es434626/">https://habr.com/ru/post/es434626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es434616/index.html">HI-FI sovi√©tico y sus creadores: grabaci√≥n de sonido digital en la URSS, a un paso de la victoria</a></li>
<li><a href="../es434618/index.html">MVP and Dagger 2 - Esqueleto de la aplicaci√≥n de Android - Parte 2</a></li>
<li><a href="../es434620/index.html">Cree una elegante cascada de RiME directamente en Unity o UE4</a></li>
<li><a href="../es434622/index.html">¬øQu√© mundos pueden sobrevivir despu√©s de la muerte del sol?</a></li>
<li><a href="../es434624/index.html">C√≥mo encontr√© un error en GNU Tar</a></li>
<li><a href="../es434628/index.html">bitContainer (para comida) - Yandex casero.</a></li>
<li><a href="../es434634/index.html">Universal Radio Hacker: una forma f√°cil de explorar los protocolos de radio digital</a></li>
<li><a href="../es434636/index.html">¬øC√≥mo explotar a los ni√±os?</a></li>
<li><a href="../es434638/index.html">Lanzamiento de cohetes desde el este con tus propios ojos</a></li>
<li><a href="../es434640/index.html">Por qu√© la validaci√≥n regular de correo electr√≥nico no es suficiente. Validaci√≥n de registros MX con ejemplos en PHP y Ruby</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>