<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚Ü™Ô∏è üí• üìô V√©rifications en ligne sur le r√©seau f√©d√©ral via RabbitMQ, 1C et magie noire üëåüèΩ üå∞ üëÜüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'ann√©e derni√®re, le directeur informatique de l'une des plus grandes exploitations agro-industrielles de Russie nous a contact√©s. L'approche de l'ent...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>V√©rifications en ligne sur le r√©seau f√©d√©ral via RabbitMQ, 1C et magie noire</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/422151/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/89/-z/xo/89-zxong6o-oxnwst3edu20hxba.png"></div><br><p> L'ann√©e derni√®re, le directeur informatique de l'une des plus grandes exploitations agro-industrielles de Russie nous a contact√©s.  L'approche de l'entreprise mise en ≈ìuvre par notre client √©tait impressionnante.  Il a √©t√© l'un des premiers √† mettre en ≈ìuvre l'id√©e d'une entreprise √† cycle complet - du champ √† l'√©tag√®re de l'√©picerie.  En raison de la disponibilit√© et de la haute qualit√© des produits, cette holding est devenue une marque reconnue qu'ils connaissent et choisissent.  √Ä cette √©poque, la holding comprenait plus de 650 points de vente et plus de 20 000 employ√©s r√©partis dans toute la F√©d√©ration de Russie. </p><br><p>  Le client devait assurer la livraison la plus rapide des ch√®ques au centre de tous les points de vente au d√©tail en Russie, y compris les stands de nourriture dans les villages recul√©s avec Internet occasionnel et une informatisation minimale. </p><br><p>  Compte tenu des sp√©cificit√©s sp√©cifi√©es, la solution au probl√®me s'est transform√©e en une aventure passionnante avec un tambourin, des chamans et des cuisses de lapin face √† RabbitMQ.  Comment nous avons construit un cluster f√©d√©r√© de files d'attente et ce que nous avons rencontr√© - sous la coupe. </p><a name="habracut"></a><br><h2 id="o-problematike-zakazchika">  √Ä propos des probl√®mes des clients </h2><br><p>  Tenir avec un grand nombre de points de vente distribu√©s, op√©rant dans des conditions de concurrence f√©roce, exigeait que leurs dirigeants prennent rapidement des d√©cisions de gestion.  Pour cela, les managers avaient besoin d'informations sur les contr√¥les en mode temps r√©el. </p><br><p>  Dans le syst√®me actuel, le d√©lai de livraison du ch√®que du caissier au syst√®me central atteint 3 jours.  Dans le m√™me temps, les informations sur l'achat parfait n'√©taient pas enregistr√©es p√©riodiquement (perte de ch√®que). </p><br><p>  Il √©tait n√©cessaire de fournir des informations sur les ventes ¬´ici et maintenant¬ª pour optimiser la livraison des produits aux points de vente et pour r√©pondre rapidement aux changements dans l'√©quilibre des biens et de la demande.  Ces informations doivent √™tre transmises simultan√©ment au SI central de l'exploitation bas√© sur 1C et √† l'ordinateur du marchandiseur dans un magasin / point de vente particulier. </p><br><p>  En outre, il √©tait n√©cessaire d'assurer une r√©√©valuation centralis√©e et op√©rationnelle des marchandises sur le r√©seau, ainsi que de connecter au syst√®me de BI de l'exploitation un flux de donn√©es en ligne de tous les points de vente. <br>  En cons√©quence, des crit√®res de r√©ussite du projet ont √©t√© d√©finis: </p><br><ul><li>  les ch√®ques frapp√©s √† la caisse du magasin doivent √™tre visibles dans le syst√®me central 1C au plus 1 seconde √† compter de sa ¬´fiscalisation¬ª √† la caisse en pr√©sence (communication) de communication; </li><li>  en cas de d√©faillance temporaire de la communication, assurer la livraison rapide et garantie des ch√®ques au syst√®me central apr√®s la restauration du canal de communication. </li></ul><br><p>  Pour l'√©quipe Silver Bullet, c'√©tait une chose tr√®s tentante, car √† cette √©poque, nous avions d√©j√† d√©velopp√© notre adaptateur 1C pour RabbitMQ et la capacit√© de le lancer au combat √† de grandes distances et des charges attiraient les esprits geek.  Le concept m√™me de ¬´position du ch√®que au centre en 1 seconde¬ª n'est pas si nouveau, en 2013, nous avons <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pr√©sent√© l'id√©e d'utiliser des files d'attente</a> en 1C, et m√™me test√© sur un r√©seau commercial, mais √† l'√©poque, il s'agissait de b√©quilles tr√®s exp√©rimentales, qui comprenaient, en plus de Rabbit + 1C est toujours C #, WCF et m√™me un peu de C ++. </p><br><p>  Bien s√ªr, nous l'avons tous espionn√© dans des livres intelligents qui ont √©t√© √©crits encore plus t√¥t.  Par cons√©quent, je n'oserai pas juger exactement quand l'id√©e de lignes dans les projets d'int√©gration a commenc√© √† envahir le monde. </p><br><p>  D'une mani√®re ou d'une autre, la partie th√©orique et le concept architectural ont prouv√© leur efficacit√©, il en reste un peu - tout faire, tester, corriger les bugs, documenter et d√©ployer.  : trollface: </p><br><h2 id="nyryaem-s-golovoy">  Plonger avec la t√™te </h2><br><p>  Personne ne conna√Æt mieux que le propri√©taire de l‚Äôentreprise ses forces et ses faiblesses. Tous les projets d‚Äôint√©gration commencent donc par un audit des processus du client et une compr√©hension du point de d√©part (TEL QUEL).  En r√®gle g√©n√©rale, une enqu√™te aupr√®s des entreprises comprend: </p><br><ul><li>  analyse des informations sur la fa√ßon dont les processus commerciaux se d√©roulent actuellement; </li><li>  recueillir les exigences du syst√®me en interrogeant les employ√©s cl√©s afin de comprendre comment, √† leur avis, les processus op√©rationnels devraient √™tre organis√©s; </li><li>  formalisation et optimisation des processus m√©tiers. </li></ul><br><p>  Pour √©liminer les divergences, nous utilisons la formalisation des processus commerciaux TELS QUELS et TOUS sous la forme de sch√©mas BPMN.  Il est plus facile de le comprendre nous-m√™mes et il est plus facile pour le client de ne rien manquer lorsque nous parcourons le diagramme de processus avec lui. </p><br><p>  D'apr√®s les caract√©ristiques techniques, l'audit a r√©v√©l√© que: </p><br><ul><li>  les points de vente utilisent des machines Windows - avec des syst√®mes d'exploitation h√©t√©rog√®nes install√©s (selon l'ann√©e de cr√©ation) de Windows XP vers Windows 7, 8, 10; </li><li>  les caisses enregistreuses ex√©cutent le micrologiciel Frontol avec Windows Embedded √† bord; </li><li>  le circuit de gestion de la vente au d√©tail utilise des logiciels h√©t√©rog√®nes, comprenant √† la fois les solutions des fournisseurs 1C et ses propres d√©veloppements; </li><li>  les canaux de communication sont mis en ≈ìuvre sur le principe de ¬´ce qui est, c'est-√†-dire¬ª dans la gamme des lignes c√¢bl√©es aux modems sifflets USB; </li><li>  les points de vente au d√©tail sont desservis par des soci√©t√©s d'impartition locales et non par un service de conservation centralis√©; </li><li>  le fonctionnement du syst√®me d√©pend dans une large mesure de la facilit√© de maintenance (bon fonctionnement) de l'ordinateur du gestionnaire de produits √† chaque point de vente. </li></ul><br><p><img src="https://habrastorage.org/webt/cv/hw/xl/cvhwxlmawid2vavdngll1nqs4ca.png" alt="Sch√©ma d'int√©gration AS-IS"></p><br><p>  <em>Sch√©ma d'int√©gration AS-IS</em> </p><br><p>  L'audit a √©galement montr√© que les processus op√©rationnels de l'entreprise n'avaient pratiquement pas besoin d'√™tre ajust√©s, mais que l'am√©lioration de l'infrastructure √©tait n√©cessaire pour garantir un flux d'informations ininterrompu. </p><br><p>  En g√©n√©ral, nous avons √©t√© confront√©s √† la t√¢che de livraison fiable des documents entre les trois composantes du processus: caisse enregistreuse, marchandiseur informatique et central.  En m√™me temps, l‚Äôordinateur du marchandiseur est une machine ¬´sous la table¬ª.  Il peut √™tre activ√© / d√©sactiv√© √† la demande du marchandiseur.  Ou m√™me √™tre √©teint 23 heures sur 24.  Cependant, en quittant le cr√©puscule, le marchandiseur doit voir un ensemble r√©el de prix, de soldes, d'articles en stock, etc. </p><br><h2 id="vybor-resheniya-sbor-grabley-i-rasstanovka-kostyley">  Choisir une solution, ramasser un r√¢teau et placer des b√©quilles </h2><br><p>  L'int√©gration des files d'attente est depuis longtemps devenue un mod√®le courant.  Lorsque vous devez transf√©rer quelque chose quelque part, avec de nombreux liens, dans un environnement peu fiable et acheminer des flux de donn√©es en m√™me temps, vous avez besoin d'√©v√©nements et de files d'attente.  Par cons√©quent, nous avons choisi RabbitMQ, car il s'int√®gre facilement dans tout environnement (il nous a sembl√©), y compris la plate-forme 1C, pour laquelle nous avions d√©j√† notre propre adaptateur pour le protocole AMQP. </p><br><p>  RMQ est une sorte de gestionnaire de flux de donn√©es et permet une int√©gration en mode temps ¬´presque r√©el¬ª, tout en conservant une faible connexion des syst√®mes, r√©sistant aux charges, et ainsi de suite ... Un bon serveur, en un mot, beaucoup a √©t√© √©crit √† ce sujet sur Habr√©. </p><br><p>  L'une des fonctionnalit√©s int√©ressantes est le clustering pr√™t √† l'emploi et la possibilit√© de cr√©er des clusters de serveurs distribu√©s qui fonctionnent ensemble. </p><br><p><img src="https://habrastorage.org/webt/3t/4z/ze/3t4zzefa40o467uuhiwepzb4_fs.png" alt="image"></p><br><p>  J'ai toujours aim√© les photos avec l'architecture de l'int√©gration dans les files d'attente.  Ils se composent toujours de trois d√©s, au centre desquels se trouve un courtier de messages.  Qu'une telle image soit dans cet article, afin de ne pas violer le canon. </p><br><p>  Lors de la construction du sch√©ma, la question s'est pos√©e - o√π le serveur de files d'attente devrait-il √™tre situ√©?  Dans quelles conditions notre syst√®me peut-il se retrouver?  Nous avons d√©couvert qu'il y a 5 situations d'urgence dans lesquelles le travail ne doit pas s'arr√™ter. </p><br><ol><li>  Tous les blocs sont inclus. </li><li>  Le centre est d√©connect√©, il y a acc√®s √† un marchandiseur. </li><li>  Le marchandiseur est d√©connect√©, il y a acc√®s au centre. </li><li>  Handicap√©s et marchandiseur et centre. </li><li>  Syst√®me 1C d√©sactiv√©. </li></ol><br><p>  Les contr√¥les dans toutes ces situations doivent √™tre rompus, le commerce ne doit pas s'arr√™ter.  Lors de la restauration de la cha√Æne - les ch√®ques doivent parvenir √† l'abonn√©.  Permettez-moi de vous rappeler qu'un point de vente peut √©galement √™tre un stand rural.  Aucun serveur distinct n'est install√© sur lequel RMQ pourrait √™tre install√©.  Il s'est av√©r√© que le courtier de messages devait √™tre directement √† la caisse.  Les serveurs sont un luxe inadmissible, et Rabbit est assez l√©ger et peut fonctionner sur un petit terminal de point de vente.  Alors pourquoi pas oui? </p><br><p>  Bien s√ªr, nous n'avons pas fait de POS le seul n≈ìud du cluster RMQ, mais nous avons plac√© l'un des n≈ìuds du cluster f√©d√©r√© directement sur le terminal de trading, ex√©cutant Windows Embedded.  Dire que c'√©tait un peu plus facile que de le faire, mais nous l'avons fait de mani√®re gaie et imprudente.  Ce que je vais vous dire maintenant. </p><br><h3 id="kak-postavit-rmq-terminal-frontol">  Comment mettre le terminal RMQ Frontol </h3><br><p>  Je dois dire qu'Erlang et le serveur RMQ lui-m√™me sont arriv√©s au terminal Windows presque sans probl√®me.  Des probl√®mes sont survenus chez le client, qui devrait interagir avec le serveur √† partir du logiciel de caisse enregistreuse. </p><br><p>  Le logiciel de caisse enregistreuse Frontol a une assez bonne documentation, √† partir de laquelle nous avons d√©couvert qu'il est possible de personnaliser le comportement √† l'aide de Javascript.  "Yuhu!"  - nous avons dit et commenc√© √† google le client JS pour RabbitMQ.  Il est rapidement devenu √©vident qu'un d√©rapeur nous attendait.  Sur le devant, pas tout √† fait Javascript.  Eh bien, c'est-√†-dire  formellement, oui, la syntaxe est la m√™me l√†-bas, mais la machine JavaScript elle-m√™me provient de Windows Script Host, la m√™me que VBScript, cscript.exe, etc.  En bref, il est tr√®s ancien, sp√©cifique √† Microsoft, et aucun client JS de lapin sain d'esprit ne travaillera dessus. </p><br><p>  Cependant, dans l'√©cosyst√®me WSH, vous pouvez utiliser des objets COM et nous nous sommes dirig√©s vers le client <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RMQ pour .NET</a> . </p><br><p>  Les versions modernes de ce client ne prennent plus en charge le .NET 3.5, qui √©tait √† notre disposition sur le terminal de point de vente, mais heureusement, le code source du client est ouvert, et en outre, le github du projet a conserv√© les balises dans lesquelles .NET 3.5 √©tait toujours pris en charge.  Gloire √† l'Open Source!  Il restait √† d√©gonfler le code source de l'ancienne version du client .NET, √† cocher la case Com-Visible et √† d√©ployer sur le terminal. </p><br><h3 id="vzaimodeystvie-s-kassoy-frontol">  Interaction de paiement Frontol </h3><br><p>  Le logiciel de caisse enregistreuse a une API qui peut √™tre utilis√©e pour l'interaction. </p><br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ frontol.addEventListener(<span class="hljs-string"><span class="hljs-string">"openDocument"</span></span>, <span class="hljs-string"><span class="hljs-string">"beforeOpenDocument"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); frontol.addEventListener(<span class="hljs-string"><span class="hljs-string">"closeDocument"</span></span>, <span class="hljs-string"><span class="hljs-string">"beforeCloseDocument"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); frontol.addEventListener(<span class="hljs-string"><span class="hljs-string">"closeDocument"</span></span>, <span class="hljs-string"><span class="hljs-string">"afterCloseDocument"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); frontol.addEventListener(<span class="hljs-string"><span class="hljs-string">"closeSession"</span></span>, <span class="hljs-string"><span class="hljs-string">"beforeCloseSession"</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); frontol.addEventListener(<span class="hljs-string"><span class="hljs-string">"closeSession"</span></span>, <span class="hljs-string"><span class="hljs-string">"afterCloseSession"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); addPolyfills(); <span class="hljs-comment"><span class="hljs-comment">//   ) initRmqVariables(); createRMQConnection(); }</span></span></code> </pre> <br><p>  Les capacit√©s du JS natif int√©gr√© √† Windows sont extr√™mement m√©diocres.  Par exemple, il n'y a pas Array.indexOf ou JSON.stringify.  Mais le monde n'est pas sans bonnes personnes.  Nous nous sommes souvenus de la b√©quille populaire sur navigateur appel√©e ¬´polyphillas¬ª et nous les avons heureusement int√©gr√©s dans la caisse.  Mis √† part les blagues, tous les tours de magie avec JS ont √©t√© intentionnellement minutieusement comment√©s afin que les g√©n√©rations de futurs administrateurs puissent comprendre clairement et rapidement ce qui se passe, d'o√π cela vient et comment cela fonctionne. </p><br><p><img src="https://habrastorage.org/webt/dy/r4/wt/dyr4wtajznottdsc0kf4hdxm-vq.png"></p><br><p><img src="https://habrastorage.org/webt/5f/zn/6o/5fzn6okjyzwwcmyaauou07ny818.png"></p><br><p>  Il est rapidement devenu clair que l'API JS ne couvre pas une partie de nos cas, cependant, puisque Frontol comprend un SGBD Firebird et qu'il existe un fournisseur ODBC, nous pouvons utiliser Javascript pour contacter directement la base de donn√©es du caissier en utilisant Javascript. obtenir les donn√©es dont nous avons besoin l√†-bas. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterCloseSession</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> connection = getDatabaseConnection(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> qSelect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">"ADODB.Command"</span></span>); qSelect.ActiveConnection = connection; qSelect.CommandText = <span class="hljs-string"><span class="hljs-string">"SELECT ChequeNumber "</span></span> + <span class="hljs-string"><span class="hljs-string">"FROM Document "</span></span> + <span class="hljs-string"><span class="hljs-string">"WHERE "</span></span> + <span class="hljs-string"><span class="hljs-string">" State = 1 "</span></span> + <span class="hljs-string"><span class="hljs-string">" AND(ChequeType IN(0, 1, 2)) "</span></span></code> </pre><br><p>  Et enfin, travailler directement avec le serveur de file d'attente de notre JS ressemble √† ceci: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRMQConnection</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ factory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">"RabbitMQ.Client.ConnectionFactory"</span></span>); factory.UserName = rmqUser; factory.Password = rmqPass; factory.VirtualHost = <span class="hljs-string"><span class="hljs-string">"/"</span></span>; factory.HostName = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { rmqConnection = factory.CreateConnection(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"     .   !\n"</span></span> + e.message); } rmqChannel = rmqConnection.CreateModel(); rmqMessageProperties = rmqChannel.CreateBasicProperties(); rmqMessageProperties.ContentType = <span class="hljs-string"><span class="hljs-string">"text/plain"</span></span>; rmqMessageProperties.ContentEncoding = <span class="hljs-string"><span class="hljs-string">"string"</span></span>; rmqMessageProperties.DeliveryMode = <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br><h2 id="obschaya-kartina-resheniya">  L'image globale de la solution </h2><br><p>  Les principes suivants ont √©t√© pos√©s en architecture: </p><br><ul><li>  F√©d√©ration des serveurs RabbitMQ - RMQ - Mode serveur de f√©d√©ration pour que les √©v√©nements soient remis √† tous les destinataires; </li><li>  survie de la caisse locale - si un √©v√©nement est survenu √† la caisse, il doit √™tre livr√© dans tous les cas, m√™me si pour le moment la caisse n'est pas accessible sur le r√©seau; </li><li>  2 fournisseurs de donn√©es - en mode normal, les donn√©es sont livr√©es via le serveur (l'ordinateur du marchand), si l'ordinateur du marchand n'est pas disponible (√† la suite d'un accident ou pour d'autres raisons), le caissier livre la livraison, lorsque l'ordinateur du marchand est allum√©, il recevra sa partie des √©v√©nements plus tard que le centre, mais garanti; </li><li>  RMQ - service RabbitMQ serveur avec des ports TCP ouverts pour le clustering et la messagerie; </li><li>  Pour garantir la remise garantie des messages, une redondance du flux de donn√©es est appliqu√©e.  Cela minimise l'impact des connexions r√©seau entre les n≈ìuds du syst√®me; </li><li>  dans 1C: Center, il a √©t√© d√©cid√© d'installer un ensemble de serveurs RMQ en mode HA - haute disponibilit√© du serveur central, incl.  Il y a une double r√©servation et r√©plication d'√©v√©nement, pour garantir la livraison. </li></ul><br><p><img src="https://habrastorage.org/webt/st/tp/vs/sttpvss5ldov15shsqsfa_88xao.png"></p><br><p>  Conform√©ment √† la solution architecturale, le diagramme de flux de donn√©es suivant a √©t√© cr√©√©: </p><br><ul><li>  Frontol, 1C - points de d√©part et d'arriv√©e des √©changes - objets sources et r√©cepteurs de messages; </li><li>  file d'attente f√©d√©r√©e - un type sp√©cial de file d'attente qui vous permet de cr√©er un syst√®me distribu√© pour envoyer des messages, dans lequel la file d'attente peut √™tre publi√©e dans le n≈ìud situ√© √† la sortie (en amont), et leur r√©ception √† partir de la file d'attente au centre (en aval).  Pour la transmission des messages de l'amont vers l'aval, un plug-in sp√©cial (Federation PlugIn) est install√© sur le serveur de file d'attente central; </li><li>  Pelle - (litt√©ralement "pelle") - un m√©canisme pour transmettre des messages d'un objet (file d'attente) √† un autre.  Les objets peuvent appartenir √† un serveur ou diff√©rents; </li><li>  l'architecture du syst√®me permet la gestion du d√©ploiement √† distance, c'est-√†-dire la possibilit√© d'installer des serveurs RabbitMQ sur n'importe quel ordinateur du r√©seau d'attente √† partir d'un centre unique; </li><li>  la configuration et la connexion √† la f√©d√©ration sont effectu√©es √† l'aide des scripts dits de post-installation, qui sont fournis en standard avec la livraison des serveurs RMQ, avec la configuration n√©cessaire des param√®tres r√©seau accept√©e sur le r√©seau du Client. </li></ul><br><p>  Le circuit r√©sultant fournit les caract√©ristiques de vitesse ordonn√©es et fonctionne de mani√®re stable lorsque l'un des composants tombe.  Une fois la connexion perdue et r√©tablie, les donn√©es accumul√©es vont au centre dans les 5 √† 10 secondes.  En pratique, la technologie des syst√®mes √† couplage l√¢che a prouv√© son efficacit√©.  Tous les √©v√©nements se d√©roulent comme dans un m√™me bureau, sans tenir compte des diff√©rents types de retards li√©s √† la r√©partition territoriale et des diff√©rents degr√©s de disponibilit√© des canaux de communication qui lui sont inh√©rents. </p><br><h2 id="kratkoe-zaklyuchenie">  Br√®ve conclusion </h2><br><p>  Je voudrais profiter s√©par√©ment de ce moment incroyable dans lequel nous vivons.  Plus r√©cemment, l'utilisation de l'Open Source dans un produit √©tait une sorte d'asc√©tisme.  "Votre logiciel open source fonctionne-t-il?"  Alors, comment aimez-vous ce cactus? "  Aujourd'hui, c'est une maxime absolue. </p><br><p>  Je ne peux pas imaginer une entreprise qui n'a pas de produits open source dans le produit.  Gr√¢ce √† la disponibilit√© des informations, des logiciels open source, la mise en ≈ìuvre des id√©es commerciales est devenue beaucoup plus facile et plus rapide.  Besoin de mettre RMQ sur d'anciens Javascript et Windows personnalis√©s?  Rien de plus simple.  Une solution googl√© est un peu inappropri√©e?  - voyez comment c'est fait et ajoutez les √©l√©ments manquants.  Le temps de mise sur le march√© lors de l'utilisation de produits ouverts est consid√©rablement r√©duit.  Et tout le monde sait qu'une lib√©ration rapide d'une solution signifie un avantage concurrentiel. </p><br><p>  Github, Stackoverflow, une documentation et des normes ouvertes permettent de lancer en quelques semaines ce qui n√©cessitait auparavant de nombreuses ann√©es d'expertise dans divers domaines de la connaissance informatique. </p><br><p>  Et bien s√ªr, il est particuli√®rement agr√©able que la communaut√© des surnoms 1C sorte de son monde ferm√© chaque ann√©e et se transforme en informatique mondiale.  Par exemple, ¬´1C: Enterprise¬ª est aujourd'hui l'une des langues officielles prises en charge par Github, et les membres de la communaut√© 1C l'ont ¬´enseign√©e¬ª √† cette langue.  Cette histoire m√©rite probablement un article s√©par√©, je l'√©crirai peut-√™tre un jour.  En attendant - bonne chance et bonne chance! </p><br><p>  Merci pour votre temps! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr422151/">https://habr.com/ru/post/fr422151/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr422139/index.html">Version mobile de Habr. Version 3.0</a></li>
<li><a href="../fr422141/index.html">D√©ploiement et d√©bogage √† distance des applications de base dotnet sur * nix</a></li>
<li><a href="../fr422143/index.html">La recette d'une revue de code utile du d√©veloppeur de Yandex</a></li>
<li><a href="../fr422147/index.html">Relevez votre n≈ìud Speedtest</a></li>
<li><a href="../fr422149/index.html">Comment est-ce - d'√™tre un agent de bord</a></li>
<li><a href="../fr422155/index.html">Phrase secr√®te de l'auditeur</a></li>
<li><a href="../fr422157/index.html">CPE - mod√®le de paiement pour l'utilisateur impliqu√© dans le reciblage mobile</a></li>
<li><a href="../fr422161/index.html">Abaisser le niveau de connectivit√© √† l'aide de DI pour am√©liorer la testabilit√© du code, exemple d'impl√©mentation</a></li>
<li><a href="../fr422163/index.html">D√©veloppement d'un convertisseur vid√©o 264 vers AVI pour dashcam QCM-08DL</a></li>
<li><a href="../fr422165/index.html">Quel client Microsoft dois-je mettre √† niveau vers Dynamics 365?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>