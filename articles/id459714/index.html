<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤛🏿 👴🏽 🛑 Mesin virtual pada ESP8266 untuk menjalankan game 🍫 🚶 🧢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="VM ditulis oleh tangan yang tidak pasti dari humaniora di lingkungan pemrograman Arduino menggunakan quickcode dan sepeda. Dan ada juga kompiler untuk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mesin virtual pada ESP8266 untuk menjalankan game</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/459714/"> VM ditulis oleh tangan yang tidak pasti dari humaniora di lingkungan pemrograman Arduino menggunakan quickcode dan sepeda.  Dan ada juga kompiler untuk itu dari bahasa seperti-C, ditulis dalam JavaScript menggunakan metode yang sama.  Ya  Anda sudah bisa buru-buru berkomentar, melempar batu.  Nah, bagi yang masih tertarik, saya mengajak Anda untuk terus membaca. <br><br><img src="https://habrastorage.org/webt/id/lf/6y/idlf6yqnyzplrex2cq3waeu0txc.png" alt="Trolleybus roti"><br><a name="habracut"></a><br>  Secara umum, pekerjaan saya sudah sedikit dicakup oleh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=" class="user_link">tormozedison yang</a> disegani di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Tetapi pada saat itu ada prototipe bola dalam ruang hampa.  Dan sekarang saya sudah mendapatkan perangkat RomanS, yang dengan ramah dia berikan kepada saya untuk percobaan yang benar-benar gratis.  Perangkat ini disebut ESPboy.  Ini berbeda dari kerajinan lain dengan kekompakan dan slot ekspansi menggunakan chip MCP23017.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Di sini</a> Anda dapat mempelajari lebih lanjut tentang dia. <br><br>  Jika ada yang tertarik, bagaimana ide aneh itu muncul di benak saya sebagai mesin virtual pada mikrokontroler, maka Anda dapat membacanya di bawah spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Latar belakang</b> <div class="spoiler_text">  Setibanya di sekolah, saya dibawa oleh seorang gamemaker dari yoyogames, dan, seperti banyak orang, terpaku padanya, tidak mengerti apa.  Demo yang bengkok dan ditulis dengan buruk ini masih bisa membanggakan kepada teman-teman, tetapi di Internet mereka tenggelam di antara yang serupa.  Saya menyadari betapa sulitnya untuk menulis bahkan permainan sederhana sendiri, belum lagi yang serius di mana Anda bisa merampok sapi.  Namun keinginan untuk menulis game tidak hilang.  Ketika saya mendapatkan ponsel, saya menemukan Midlet Pascal dan bersenang-senang dengannya selama beberapa tahun.  Setelah semua, saya menyadari bahwa menulis game untuk perangkat yang lemah lebih mudah daripada untuk kakak yang lebih kuat.  Setidaknya, orang selalu bisa berbicara bukan tentang tangan yang bengkok, tetapi tentang kemampuan platform yang terbatas.  Namun, para pemain tombol memberi jalan kepada sensor kesempatan lain untuk menaklukkan dunia yang terlewatkan.  Namun demikian, pada titik tertentu saya menyadari bahwa saya dapat menghidupkan kembali mimpi saya menggunakan mikrokontroler. <br><br>  Saya mulai dengan menulis permainan di bawah arduino uno, ke mana Anda akan pergi tanpa itu.  Kemudian dia adalah satu-satunya saya, dan saya sangat khawatir dengan penampilannya.  Saya mencoba flash sesedikit mungkin.  Tapi jalan menyapu berjalan dalam langkah-langkah kecil.  Setiap perubahan kecil pada kode membuatnya berkedip berulang-ulang.  Dan saya memutuskan untuk menulis mesin virtual bertumpuk.  Bagaimanapun, ada dua kilobyte RAM untuk byte kode dan data di papan.  Tetapi betapa lambatnya itu, tetapi karena suatu alasan ingatan terus-menerus kurang.  Mungkin intinya adalah bahwa semua sepeda saya dengan roda persegi dan naik perlahan.  Kemudian saya memutuskan untuk menulis emulator chip-8 pada Arduino Mega yang baru saja tiba dari China.  Tentu saja, kemudian saya ingin menulis emulator gameboy untuknya, playstation pertama dan beberapa superkomputer lebih mudah.  Hasilnya, saya mengerti hal utama.  Mesin virtual chip-8 sangat sederhana, terlalu sederhana.  Sedemikian rupa sehingga ketika menulis gim Anda untuk perkalian atau pembagian, Anda harus menulis subrutin lambat yang terpisah.  Jadi, Anda perlu menulis VM Anda, menyingkirkan kesalahan fatal.  Pada saat ini, beberapa esp8266 lainnya tiba, dengan ruang 160MHz. <br></div></div><br>  Jika Anda merasa bahwa mesin virtual adalah pemborosan sumber daya, maka saya juga menulis ulang emulator chip-8 saya untuk itu.  Ternyata mesin virtual di mesin virtual pada mikrokontroler.  Anda mungkin bisa melangkah lebih jauh dan menulis mesin Turing pada chip-8. <br><br><h4>  Spesifikasi Mesin Game Kecil ESP </h4><br>  Mesin virtual berisi 16 register masing-masing 16 bit, register nol adalah stack pointer.  Setiap instruksi adalah byte ganda, beberapa instruksi mengandung dua byte data.  Memori yang dapat dialamatkan 64KB.  Dalam kasus ESP8266, 20KB tersedia.  Program ini dapat diunduh dari SPIFFS dan UART.  Jika diinginkan, Anda dapat menambahkan unduhan dari kartu memori atau melalui WiFi.  Selain instruksi aritmatika dan instruksi untuk memindahkan data, ada instruksi terpisah untuk bekerja dengan sprite, layar, dan suara.  Ukuran layar 128 x 128 piksel.  Pada 16 warna per titik, layar membutuhkan 8KB memori, jumlah buffer yang sama untuk menggambar sprite dan partikel.  Meskipun perpustakaan TFT_eSPI yang saya gunakan mampu memperbarui layar lebih dari 60 kali per detik, saya harus membatasi diri hingga 20 frame per detik.  Jika tidak, waktu prosesor tidak cukup untuk mesin virtual.  Anda dapat menggambar ubin dan 32 sprite hingga ukuran 128x128 piksel dengan kemungkinan rotasi dan mirroring.  Untuk menghemat memori, Anda dapat menggunakan gambar bit tunggal atau kompresi RLE.  Ada fisika yang disederhanakan: deteksi tabrakan sprite dengan sprite dan ubin, resolusi tabrakan, gravitasi.  Layar diperbarui baris demi baris hanya jika satu baris telah mengubah piksel.  Kecepatan VM, tergantung pada berapa banyak garis yang ditarik dalam bingkai, bervariasi dari 100 ribu hingga 900 ribu operasi per detik.  Anda dapat menggunakan layar warna yang berbeda, ada peregangan lembut gambar ke proporsi yang diinginkan. <br><br><img src="https://habrastorage.org/webt/jf/ai/mv/jfaimvgh6rbtnum5u-lpdsslpws.png"><br>  <i>Beberapa game yang saya tulis dapat dilihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .</i> <br><br>  Pada saat yang sama dengan VM untuk ESP8266, saya menulis emulator JavaScript untuk browser.  Agar tidak mengedit bytecode secara manual, assembler sederhana telah ditambahkan, berdasarkan pengalaman saya dengan assembler untuk MOS6502.  Kemudian saya memutuskan untuk menambahkan bahasa tingkat yang lebih tinggi.  Namun demikian, tugas utama saya adalah menulis game sederhana dengan cepat, dan bukan kode perakitan debug yang panjang.  Menurut saya menulis kompiler Anda akan lebih mudah daripada menambahkan LLVM.  Dan saya menulisnya dalam JavaScript, karena saya tahu itu tidak seburuk bahasa lain.  Saat ini, ia jauh dari mendukung standar C, dan ketika menyusun, Anda dapat dengan mudah menemukan kesalahan yang tidak dapat dipahami di tempat yang tidak dapat dipahami.  Tapi itu cepat, karena butuh kurang dari 2000 baris. <br><br>  Dan sekarang untuk pertanyaan, mengapa saya menulis semua ini di sini.  Sudah sekarang Anda dapat menulis dan menjalankan game.  Namun, kesempurnaan masih jauh.  Jika ada yang ingin membantu saya menyelesaikan ESP LGE, atau menulis game sendiri, maka saya akan sangat senang.  Jika Anda pikir ide saya menarik, dan Anda ingin tahu lebih banyak, maka saya akan dengan senang hati menjawab pertanyaan Anda.  Saya peringatkan Anda, kode untuk Arduino cukup sulit dibaca.  Sebagian karena aku belajar sendiri.  Sebagian karena fakta bahwa saya mencoba mengurangi jumlah pemanggilan fungsi untuk meningkatkan kecepatan kerja.  Akibatnya, banyak fungsi berisi jejak kode yang sangat besar.  Jadi jangan biarkan ibu hamil dan anak-anak ke layar.  Secara bertahap, saya akan mencoba untuk memperbaikinya dan meningkatkan keterbacaan. <br><br>  Dan bagi yang sudah membaca, contohnya sebuah game.  Dibutuhkan kurang dari seratus baris dan kurang dari 1KB dalam bentuk yang dikompilasi. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> stickCount; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> key,previouseKey,takenSticks; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redraw</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-comment"><span class="hljs-comment">//   setcolor(2); //   for(i = 0; i &lt; stickCount; i++) line(22 + i * 6, 74, 22 + i * 6, 84); //   setcolor(11); //  for(i = stickCount; i &lt; 15; i++) line(22 + i * 6, 74, 22 + i * 6, 84); //     setcolor(1); //   delayredraw(); } void playersMove(){ //    ,     .  while(key == previouseKey){ key = getkey(); } while(key != KEY_LEFT &amp;&amp; key != KEY_DOWN &amp;&amp; key != KEY_RIGHT){ key = getkey(); } if(key &amp; KEY_LEFT){ takenSticks = 1; }else if(key &amp; KEY_DOWN){ takenSticks = 2; }else{ takenSticks = 3; } printf("%d, ", takenSticks); stickCount -= takenSticks; previouseKey = key; } void computersMove(){ if(stickCount % 4){ //   ,    takenSticks = stickCount % 4; }else{ //      takenSticks = 1 + random(1); } stickCount -= takenSticks; printf("%d, ", takenSticks); } void game(){ // stickCount = 15; clearscreen(); //       gotoxy(8,0); puts(""); gotoxy(2,1); puts(" 1,2  3 .  ,   . :\n"); // 27,25  26   printf(" %c 1 %c 2 %c 3", 27, 25, 26); gotoxy(0,12); redraw(); while(1){ playersMove(); if(stickCount &lt;= 0){ gotoxy(3,8); puts(" "); return; } redraw(); computersMove(); redraw(); if(stickCount &lt;= 0){ gotoxy(3,8); puts(" "); return; } } } void main(){ while(1){ game(); //  settimer(1,1000); while(gettimer(1)){} while(getkey() == 0){} previouseKey = key; } }</span></span></code> </pre> <br>  Anda bisa langsung <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengujinya</a> .  Ikuti tautannya, lalu klik kompilasi, lalu jalankan.  Jika Anda ingin tahu lebih banyak tentang kemungkinan-kemungkinan IDE, Anda dapat membaca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tutorialnya</a> .  Terima kasih atas perhatian anda </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id459714/">https://habr.com/ru/post/id459714/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id459704/index.html">LLVM IR dan Go</a></li>
<li><a href="../id459706/index.html">5 alasan mengapa Anda harus melupakan Redux dalam Bereaksi aplikasi</a></li>
<li><a href="../id459708/index.html">Desain Antarmuka Game. Brent Fox Tentang apa buku itu?</a></li>
<li><a href="../id459710/index.html">Selamat dari tabrakan langsung dan mengapa amnesia bukan seperti yang Anda pikirkan</a></li>
<li><a href="../id459712/index.html">Peretas Mommy di Pekerjaan Resmi: Apa yang Dilakukan Pentester</a></li>
<li><a href="../id459716/index.html">Beberapa aspek mengoptimalkan kueri LINQ di C # .NET untuk MS SQL Server</a></li>
<li><a href="../id459718/index.html">10 tips untuk merevisi kode yang tidak Anda sukai</a></li>
<li><a href="../id459722/index.html">Apa yang dimiliki oleh pengembangan tim dan pendakian gunung</a></li>
<li><a href="../id459726/index.html">7 buah yang pasti tidak perlu Anda lakukan saat membuka klub robotika. Di sini tidak perlu dilakukan</a></li>
<li><a href="../id459728/index.html">Smartphone dengan mudah: Ulasan ZTE Red Magic 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>