<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üìò ü§õüèΩ üë©üèæ‚Äçü§ù‚Äçüë©üèº LED d'adresse color√©es pour la nouvelle ann√©e sans programmation ni soudure üìØ üëñ üî±</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Le Nouvel An arrive bient√¥t, mais l'ambiance pour diverses raisons n'est parfois pas celle du Nouvel An, et ici l'illumination du Nouvel An vient √† la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>LED d'adresse color√©es pour la nouvelle ann√©e sans programmation ni soudure</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/481566/"><p> Le Nouvel An arrive bient√¥t, mais l'ambiance pour diverses raisons n'est parfois pas celle du Nouvel An, et ici l'illumination du Nouvel An vient √† la rescousse.  Je veux parler de mon exp√©rience avec les guirlandes et rubans LED adressables.  Il est peu probable que je d√©couvre l'Am√©rique, mais cela s'est av√©r√© magnifique et peu co√ªteux. </p><br><p><img src="https://habrastorage.org/webt/eu/ks/bo/euksbogl1rav5lvy75cz1xuzkrc.gif"><br>  J'examinerai deux options - s√©par√©ment sans domotique existante et travailler en conjonction avec une ¬´maison intelligente¬ª. </p><a name="habracut"></a><br><p>  De nombreuses informations structur√©es sont apparues sur les rubans LED adressables, et vous pouvez donc facilement faire un choix √©clair√©.  Par exemple, avant d'acheter, j'ai regard√© attentivement les vid√©os correspondantes des <a href="https://youtu.be/tXvtxwK3jRk%3Ft%3D438">cha√Ænes DrZzs (en anglais)</a> et <a href="https://youtu.be/QnvircC22hU%3Ft%3D213">The Hook Up (en anglais)</a> et j'ai tir√© des conclusions sur le co√ªt des bandes n√©cessaires - parce que le r√©sultat du travail des bandes dans mon cas est un - surlignage color√©. </p><br><p>  Il a opt√© pour deux options peu co√ªteuses en provenance de Chine: </p><br><ol><li>  <a href="https://www.aliexpress.com/item/32682015405.html">Ruban WS2812B - 300 LED</a> - 5 m√®tres. </li><li>  <a href="https://www.aliexpress.com/item/32444382333.html">WS2811 Garland - 50 LED</a> x 3 pi√®ces - environ 10 m√®tres (3 x 3,3 m) </li></ol><br><p><img src="https://habrastorage.org/webt/0x/gh/8o/0xgh8oibngraaijuiyih_bw-8ni.jpeg"><br>  <em>Pixels d'adresse √† l'int√©rieur d'un bureau</em> </p><br><p>  Dans les deux cas, 5 volts sont n√©cessaires pour alimenter mes bandes.  Je ne comptais pas sur l'alimentation, mais j'ai install√© le bloc d'alimentation <a href="https://meanwellpower.ru/istochnik-pitaniya-ac-dc-mean-well-rs-150-5">Mean Well RS-150-5</a> existant et abordable. </p><br><p><img src="https://habrastorage.org/webt/hj/eg/v5/hjegv5csxbptdn1x0_4z4t9gxmy.jpeg"><br>  <em>Unit√© d'alimentation Mean Well RS-150-5</em> </p><br><p>  Et la partie la plus importante pour g√©rer le programme du Nouvel An est le contr√¥leur.  J'ai choisi le microcontr√¥leur ESP8266 du fabricant chinois Espressif Systems, c'est-√†-dire que dans mon cas j'ai utilis√© une <a href="https://www.aliexpress.com/item/32529101036.html">mini</a> carte <a href="https://www.aliexpress.com/item/32529101036.html">LOLIN (WEMOS) D1</a> peu co√ªteuse. </p><br><p><img src="https://habrastorage.org/webt/7u/4m/6t/7u4m6thz8kgpqlriu89ezskz-he.jpeg"><br>  <em>LOLIN (WEMOS) D1 mini r√©tractable reli√© √† un ruban sur l'arbre de No√´l</em> </p><br><h2 id="hardware">  Mat√©riel informatique </h2><br><p>  Pour les rubans et les guirlandes, le choix est tr√®s large - il existe un grand nombre de chipsets diff√©rents et vous devez regarder pour que le contr√¥leur prenne en charge les rubans que vous allez acheter. <br>  Ma t√¢che consistait √† utiliser des bandes de pixels d'adresse dans le cadre d'une automatisation bas√©e sur la plate-forme open source <a href="https://www.home-assistant.io/">Home Assistant</a> .  L'option la plus abordable pour cela est d'utiliser l'ESP8266.  Il existe une <a href="https://blakadder.github.io/templates/light.html">grande base de donn√©es de contr√¥leurs compatibles fabriqu√©s en usine</a> (section LED Controller), compil√©e par les auteurs du firmware Tasmota. <br>  √Ä mon avis, Tasmota est un bon firmware, mais pour les pixels contr√¥l√©s et les <a href="https://habr.com/ru/post/480690/">moteurs pas √† pas,</a> il n'est pas tr√®s appropri√©. </p><br><p><img src="https://habrastorage.org/webt/xv/ah/o-/xvaho-hbz991uoxukkboyrdj_a0.jpeg"><br>  <em>LOLIN (WEMOS) D1 mini connect√© √† une guirlande</em> </p><br><h2 id="software">  Logiciels </h2><br><h3 id="variant-bez-domashney-avtomatizacii">  Option sans domotique </h3><br><p>  Si vous souhaitez un d√©marrage rapide ¬´sans inscription ni SMS¬ª, alors la solution la plus raisonnable est le firmware ESP8266 du projet WLED <a href="https://github.com/Aircoookie/WLED">(WiFi Lighting Effects Driver)</a> .  Le firmware a sa propre application qui vous permet de contr√¥ler facilement les LED, ainsi qu'une √©norme liste d'effets pr√©d√©finis pour les bandes d'adresse et les guirlandes.  WLED prend √©galement en charge de nombreux protocoles de gestion, y compris <abbr title="Transport de t√©l√©m√©trie Message Queuing">MQTT</abbr> , si n√©cessaire. <br>  Il n'est pas n√©cessaire de souder pour connecter la bande √† WEMOS. </p><br><p><img src="https://habrastorage.org/webt/y0/u4/1c/y0u41c5hp2qj17vjcwm3adynbc8.png"><br>  <em>Interface WLED (pilote d'effets d'√©clairage WiFi)</em> </p><br><h3 id="adresnaya-illyuminaciya-v-sostave-umnogo-doma-na-baze-home-assistant">  √âclairage cibl√© dans le cadre d'une maison intelligente bas√©e sur Home Assistant </h3><br><p>  Il convient de noter que WLED r√©cemment (en d√©cembre 2019) est apparu <a href="https://www.home-assistant.io/integrations/wled/">une int√©gration compl√®te pour Home Assistant</a> . <br>  Mais, depuis que j'√©tais engag√© dans des guirlandes en novembre, avant que cette int√©gration n'apparaisse, la connexion Home Assistant &lt;--&gt; WLED MQTT m'a sembl√© bogu√©e. </p><br><p><img src="https://habrastorage.org/webt/84/zs/iz/84zsiziqm9ymyidmesj2rqorn4q.png"><br>  <em>ESPHome Control Panel</em> </p><br><p>  Pour Home Assistant, il existe un firmware natif <a href="https://esphome.io/index.html">ESPHome</a> qui fonctionne avec Home Assistant sans MQTT et il <a href="https://esphome.io/components/light/fastled.html">prend</a> √©galement en <a href="https://esphome.io/components/light/fastled.html">charge les LED d'adresse</a> . </p><br><div class="spoiler">  <b class="spoiler_title">Voici une liste des chipsets pris en charge.</b> <div class="spoiler_text"><p>  Sans horloge: <br>  NEOPIXEL <br>  WS2811 <br>  WS2811_400 (WS2811 avec une fr√©quence d'horloge de 400 kHz) <br>  WS2812B <br>  WS2812 <br>  WS2813 <br>  WS2852 <br>  APA104 <br>  APA106 <br>  Gw6205 <br>  GW6205_400 (GW6205 avec une fr√©quence d'horloge de 400 kHz) <br>  LPD1886 <br>  LPD1886_8BIT (LPD1886 avec des valeurs de canal de couleur 8 bits) <br>  PL9823 <br>  SK6812 <br>  SK6822 <br>  TM1803 <br>  TM1804 <br>  TM1809 <br>  TM1829 <br>  UCS1903B <br>  UCS1903 <br>  UCS1904 <br>  UCS2903 </p><br><p>  SPI: <br>  APA102 <br>  Dotstar <br>  LPD8806 <br>  P9813 <br>  SK9822 <br>  SM16716 <br>  WS2801 <br>  WS2803 </p></div></div><br><p>  Depuis que j'utilise l'image <a href="https://www.home-assistant.io/hassio/">Hass.io</a> , j'ai utilis√© l'option la plus simple pour compiler le firmware - le <a href="https://github.com/esphome/hassio">module compl√©mentaire ESPHome Hass.io Add-On</a> . </p><br><p><img src="https://habrastorage.org/webt/vq/1_/or/vq1_orjpjkcqkmcs-f71-e0k34a.png"><br>  <em>Fen√™tre de l'√©diteur de firmware ESPHome</em> </p><br><p>  Les guirlandes et rubans de micrologiciel r√©sultants: </p><br><div class="spoiler">  <b class="spoiler_title">ws2811_string.yaml</b> <div class="spoiler_text"><pre><code class="plaintext hljs">substitutions: devicename: ws2811_string upper_devicename: WS2811 string esphome: name: $devicename platform: ESP8266 board: d1_mini wifi: ssid: "XXX" password: "XXX" # Enable fallback hotspot (captive portal) in case wifi connection fails ap: ssid: "WS2811 string Fallback Hotspot" password: "XXX" captive_portal: web_server: port: 80 css_url: http://192.168.15.10:8123/local/webserver-v1.min.css #   -        https://github.com/esphome/issues/issues/648 js_url: http://192.168.15.10:8123/local/webserver-v1.min.js # Enable Home Assistant API api: # Enable OTA Access ota: # Enable verbose logging over serial logger: light: - platform: fastled_clockless chipset: WS2811 pin: D4 num_leds: 150 name: " WS2811" effects: - addressable_rainbow: name: Rainbow Effect With Custom Values speed: 30 width: 150 - addressable_color_wipe: name: Color Wipe Effect With Custom Values colors: - red: 10% green: 10% blue: 100% num_leds: 1 - red: 0% green: 0% blue: 0% num_leds: 1 add_led_interval: 100ms reverse: False - random: name: "My Fast Random Effect" transition_length: 4s update_interval: 5s - strobe: name: Strobe Effect With Custom Values colors: - state: True brightness: 100% red: 100% green: 90% blue: 0% duration: 500ms - state: False duration: 250ms - state: True brightness: 100% red: 0% green: 100% blue: 0% duration: 500ms - addressable_scan: name: Scan Effect With Custom Values move_interval: 60ms - addressable_fireworks: name: Fireworks Effect With Custom Values update_interval: 32ms spark_probability: 10% use_random_color: false fade_out_rate: 120 #     sensor: - platform: uptime id: uptime_sec - platform: wifi_signal name: ${upper_devicename} WiFi Signal id: wifis_signal update_interval: 900s text_sensor: - platform: template name: ${upper_devicename} Uptime lambda: |- int seconds = (id(uptime_sec).state); int days = seconds / (24 * 3600); seconds = seconds % (24 * 3600); int hours = seconds / 3600; seconds = seconds % 3600; int minutes = seconds / 60; seconds = seconds % 60; return { (String(days) +"d " + String(hours) +"h " + String(minutes) +"m "+ String(seconds) +"s").c_str() }; icon: mdi:clock-start update_interval: 113s - platform: template name: ${upper_devicename} Wifi Strength icon: "mdi:wifi" lambda: |- if (id(wifis_signal).state &gt; -50 ) { return {"Excellent"}; } else if (id(wifis_signal).state &gt; -60) { return {"Good"}; } else if (id(wifis_signal).state &gt; -70) { return {"Fair"}; } else if (id(wifis_signal).state &lt; -70) { return {"Weak"}; } else { return {"None"}; } update_interval: 900s - platform: version name: ${upper_devicename} Version - platform: template name: ${upper_devicename} MAC Address lambda: 'return {WiFi.macAddress().c_str()};' icon: mdi:fingerprint update_interval: 1d switch: - platform: restart name: ${upper_devicename} Restart</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">ws2811_strip.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">substitutions: devicename: ws2811_strip upper_devicename: WS2811 strip esphome: name: $devicename platform: ESP8266 board: d1_mini_lite wifi: ssid: "XXX" password: "XXX" # Enable fallback hotspot (captive portal) in case wifi connection fails ap: ssid: "WS2811 strip Fallback Hotspot" password: "XXX" captive_portal: web_server: port: 80 css_url: http://192.168.15.10:8123/local/webserver-v1.min.css #   -        https://github.com/esphome/issues/issues/648 js_url: http://192.168.15.10:8123/local/webserver-v1.min.js # Enable Home Assistant API api: # Enable OTA Access ota: # Enable verbose logging over serial logger: light: - platform: fastled_clockless chipset: WS2811 pin: D4 num_leds: 300 rgb_order: GRB name: " WS2811" effects: - addressable_rainbow: name: Rainbow Effect With Custom Values speed: 30 width: 300 - addressable_color_wipe: name: Color Wipe Effect With Custom Values colors: - red: 10% green: 10% blue: 100% num_leds: 1 - red: 0% green: 0% blue: 0% num_leds: 1 add_led_interval: 100ms reverse: False - random: name: "My Fast Random Effect" transition_length: 4s update_interval: 5s - strobe: name: Strobe Effect With Custom Values colors: - state: True brightness: 100% red: 100% green: 90% blue: 0% duration: 500ms - state: False duration: 250ms - state: True brightness: 100% red: 0% green: 100% blue: 0% duration: 500ms - addressable_scan: name: Scan Effect With Custom Values move_interval: 60ms - addressable_fireworks: name: Fireworks Effect With Custom Values update_interval: 32ms spark_probability: 10% use_random_color: false fade_out_rate: 120 #     sensor: - platform: uptime id: uptime_sec - platform: wifi_signal name: ${upper_devicename} WiFi Signal id: wifis_signal update_interval: 900s text_sensor: - platform: template name: ${upper_devicename} Uptime lambda: |- int seconds = (id(uptime_sec).state); int days = seconds / (24 * 3600); seconds = seconds % (24 * 3600); int hours = seconds / 3600; seconds = seconds % 3600; int minutes = seconds / 60; seconds = seconds % 60; return { (String(days) +"d " + String(hours) +"h " + String(minutes) +"m "+ String(seconds) +"s").c_str() }; icon: mdi:clock-start update_interval: 113s - platform: template name: ${upper_devicename} Wifi Strength icon: "mdi:wifi" lambda: |- if (id(wifis_signal).state &gt; -50 ) { return {"Excellent"}; } else if (id(wifis_signal).state &gt; -60) { return {"Good"}; } else if (id(wifis_signal).state &gt; -70) { return {"Fair"}; } else if (id(wifis_signal).state &lt; -70) { return {"Weak"}; } else { return {"None"}; } update_interval: 900s - platform: version name: ${upper_devicename} Version - platform: template name: ${upper_devicename} MAC Address lambda: 'return {WiFi.macAddress().c_str()};' icon: mdi:fingerprint update_interval: 1d switch: - platform: restart name: ${upper_devicename} Restart</code> </pre> </div></div><br><p>  Apr√®s avoir ajout√© les appareils r√©sultants √† Home Assistant dans l'interface, vous pouvez voir et d√©finir les options d'effets. </p><br><p><img src="https://habrastorage.org/webt/on/56/ah/on56ah882ioqsx4950ppkg-mlec.png"><br>  <em>Interface de l'assistant domestique</em> </p><br><p>  De plus, les effets peuvent √™tre utilis√©s dans l'automatisation.  Par exemple, lorsque vous ouvrez la porte pendant 30 secondes, un effet, 10 secondes, un autre effet, puis d√©sactivez-le pour ne pas vous distraire.  Mais il y a une condition: l'inclusion uniquement lorsque la rue est d√©j√† au cr√©puscule. </p><br><div class="spoiler">  <b class="spoiler_title">automations.yaml</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">################################################### # # # WS2811 :    # # # ################################################### - alias: WS2811 string trigger: - platform: state entity_id: binary_sensor.dver from: 'off' to: 'on' condition: - condition: numeric_state entity_id: 'sensor.osveshchennost_u_okna' below: 1500 # action: - service: homeassistant.turn_on data: entity_id: group.new_year #light.girlianda_ws2811 brightness: 255 effect: Rainbow Effect With Custom Values - delay: '00:00:25' - service: homeassistant.turn_on data: entity_id: group.new_year brightness: 255 effect: Color Wipe Effect With Custom Values - delay: '00:00:13' - service: homeassistant.turn_off entity_id: group.new_year - alias: Table lamp ON trigger: - platform: state entity_id: binary_sensor.dver from: 'off' to: 'on' condition: - condition: numeric_state entity_id: 'sensor.osveshchennost_u_okna' below: 90 # action: - service: homeassistant.turn_on entity_id: switch.potolochnaia_lampa - alias: Table lamp OFF trigger: - platform: state entity_id: binary_sensor.dver from: 'on' to: 'off' condition: [] action: - service: homeassistant.turn_off entity_id: switch.potolochnaia_lampa</code> </pre> </div></div><br><p><img src="https://habrastorage.org/webt/gy/ci/o9/gycio9hm7fhzga6hjjxbn3yb2eg.jpeg"><br>  <em>Sapin de No√´l avec bande LED d'adresse</em> </p><br><h2 id="itog">  R√©sum√© </h2><br><p>  Comme vous pouvez le voir, avec une certaine dext√©rit√©, vous pouvez organiser l'√©clairage du Nouvel An √† moindre co√ªt et l'int√©grer dans le syst√®me de ¬´maison intelligente¬ª existant ou l'utiliser s√©par√©ment sans domotique en utilisant une application distincte sur votre smartphone. </p><br><p>  Plus de d√©tails peuvent √™tre trouv√©s sur <a href="https://github.com/empenoso/diy-holiday-lighting">GitHub</a> . </p><br><p>  Publi√© par: <a href="https://www.facebook.com/mikhail.shardin">Mikhail Shardin</a> , <br>  23 d√©cembre 2019 </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr481566/">https://habr.com/ru/post/fr481566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr481554/index.html">Comment passer par le Master of Science en ligne en informatique et √† qui cela peut ne pas convenir</a></li>
<li><a href="../fr481556/index.html">File d'attente des t√¢ches PostgreSQL</a></li>
<li><a href="../fr481560/index.html">Le condens√© de mati√®res fra√Æches du monde du front-end de la derni√®re semaine n ¬∞ 394 (15-22 d√©cembre 2019)</a></li>
<li><a href="../fr481562/index.html">Test thermique du Raspberry Pi 4</a></li>
<li><a href="../fr481564/index.html">PHP Digest n ¬∞ 170 (9-23 d√©cembre 2019)</a></li>
<li><a href="../fr481568/index.html">√âv√©nements num√©riques √† Moscou du 23 au 29 d√©cembre</a></li>
<li><a href="../fr481570/index.html">Aujourd'hui √† 17h00, le webinaire DevOps: outils et num√©ros aura lieu</a></li>
<li><a href="../fr481572/index.html">Ma nouvelle pile de technologies Web pour 2020</a></li>
<li><a href="../fr481574/index.html">Auto-h√©bergement de ressources tierces: bonnes, mauvaises, mauvaises</a></li>
<li><a href="../fr481576/index.html">Frontend 2019: r√©sultats de l'ann√©e</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>