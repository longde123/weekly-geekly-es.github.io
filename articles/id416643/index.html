<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè¨ ü§¥üèø üîá Menyebarkan Elasticsearch di AWS dengan Kubernetes dalam 10 Langkah üå¨Ô∏è üç¨ üê≤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kubernetes alias k8s adalah sistem open source untuk mengotomatiskan penerapan, penskalaan, dan pengelolaan aplikasi yang k8s . Dalam artikel ini, say...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Menyebarkan Elasticsearch di AWS dengan Kubernetes dalam 10 Langkah</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/416643/"><p><img src="https://habrastorage.org/webt/rt/no/ud/rtnouda08zlh-unwdbcvqlb8fts.jpeg"></p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kubernetes</a> alias <code>k8s</code> adalah sistem open source untuk mengotomatiskan penerapan, penskalaan, dan pengelolaan aplikasi yang <code>k8s</code> .  Dalam artikel ini, saya akan menunjukkan kepada Anda cara mengkonfigurasi cluster Kubernetes dan menggunakan cluster Elasticsearch ke AWS di atasnya.  Pengaturan ini juga berfungsi pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">GCE</a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Azure</a> . </p><a name="habracut"></a><br><h3 id="konfigurirovanie-kubernetes-na-aws">  Mengkonfigurasi Kubernetes di AWS </h3><br><p>  Untuk memulai, dapatkan akses administratif ke layanan AWS berikut: <strong>S3, EC2, Route53, IAM,</strong> dan <strong>VPC</strong> . </p><br><p>  <strong>1. Instalasi:</strong> Saya akan menunjukkan instalasi CLI untuk Linux.  Jika Anda memiliki sistem operasi yang berbeda, ikuti tautan di bawah ini untuk instruksi instalasi untuk OS Anda. </p><br><p>  Pertama, atur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">AWS CLI</a> untuk mengakses AWS melalui CLI.  Jika Anda sudah memiliki Python dan pip, jalankan perintah: </p><br><pre> <code class="plaintext hljs">pip install awscli --upgrade --user</code> </pre> <br><p>  Kemudian kita menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kops</a> , alat baris perintah yang membawa kita melalui pengaturan cluster tingkat produksi K8S. <br>  Instal binari <strong>Kops</strong> langsung dari github. </p><br><pre> <code class="plaintext hljs">wget -O kops https://github.com/kubernetes/kops/releases/download/$(curl -s https://api.github.com/repos/kubernetes/kops/releases/latest | grep tag_name | cut -d '"' -f 4)/kops-linux-amd64 chmod +x ./kops sudo mv ./kops /usr/local/bin/</code> </pre> <br><p>  Akhirnya, kami menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kubectl</a> - CLI untuk mengelola cluster K8S (jika Anda menggunakan buruh pelabuhan, ini mirip dengan <strong>buruh pelabuhan</strong> CLI).  Rilis terbaru diinstal oleh perintah: </p><br><pre> <code class="plaintext hljs">wget -O kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl chmod +x ./kubectl sudo mv ./kubectl /usr/local/bin/kubectl</code> </pre> <br><p>  <strong>Catatan:</strong> Anda bisa memulai kluster Kubernetes dan ikuti instruksi dalam artikel ini di mesin rumah dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">minikube</a> . </p><br><p>  <strong>2.Buat pengguna IAM:</strong> untuk membuat kluster di AWS, kami akan membuat pengguna IAM terpisah untuk <code>kops</code> .  Untuk <code>kops</code> memerlukan akun API.  Buat pengguna dan konfigurasikan akun melalui antarmuka pengguna <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">konsol AWS</a> .  Pengguna <code>kops</code> akan membutuhkan izin IAM berikut: </p><br><ul><li>  AmazonEC2FullAccess </li><li>  AmazonRoute53FullAccess </li><li>  AmazonS3FullAccess </li><li>  IAMFullAccess </li><li>  AmazonVPCFullAccess </li></ul><br><p><img src="https://habrastorage.org/webt/93/ll/zh/93llzhkqarlmyjtluwo3xiqpjwa.jpeg"></p><br><p>  Atau, Anda dapat melakukan hal yang sama dari CLI dengan menerapkan perintah berikut: </p><br><pre> <code class="plaintext hljs">aws iam create-group --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonEC2FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonRoute53FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonS3FullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/IAMFullAccess --group-name kops aws iam attach-group-policy --policy-arn arn:aws:iam::aws:policy/AmazonVPCFullAccess --group-name kops aws iam create-user --user-name kops aws iam add-user-to-group --user-name kops --group-name kops aws iam create-access-key --user-name kops</code> </pre> <br><p>  Catat <code>AccessKeyID</code> <code>SecretAccessKey</code> dan <code>AccessKeyID</code> di <code>kops</code> . </p><br><p>  Konfigurasikan AWS CLI untuk menggunakan akun Anda dengan <code>aws configure</code> . </p><br><p>  Pastikan pengguna yang Anda buat ada di daftar <code>aws iam list-users</code> . </p><br><p>  Kami mengekspor akun AWS sebagai variabel lingkungan berikut sehingga CLI <code>kops</code> dapat menggunakannya. </p><br><pre> <code class="plaintext hljs">export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id) export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key)</code> </pre> <br><blockquote>  <em>Jika Anda menggunakan Kops 1.6.2 atau yang lebih baru, pengaturan DNS adalah opsional.</em>  <em>Anda dapat membuat cluster gosip.</em>  <em>Satu-satunya persyaratan: nama cluster harus diakhiri dengan <code>.k8s.local</code> .</em> </blockquote><br><h3 id="nastroyka-dns">  Penyiapan DNS </h3><br><p>  Jika Anda telah meng-host domain Anda melalui AWS dan berencana untuk menggunakannya, tidak ada yang perlu dilakukan.  Opsi lain: jika Anda ingin menggunakan subdomain dari domain Anda, buat zona hosting publik kedua untuk subdomain ini.  Dalam manual ini, kami akan bekerja dengan zona hosting pribadi.  Tetapkan zona dengan nama apa pun.  Gunakan nama ini untuk membuat cluster Kubernetes.  <a href="">Baca lebih lanjut</a> tentang pengaturan DNS di <a href="">sini</a> . </p><br><p>  <strong>3. Membuat bucket S3:</strong> untuk menyimpan status dan tampilan cluster K8S kami, Anda perlu membuat bucket S3 terpisah untuk <code>kops</code> .  Ember ini akan menjadi sumber data yang dapat diandalkan untuk klaster konfigurasi. </p><br><pre> <code class="plaintext hljs">aws s3api create-bucket \ --bucket &lt;your-unique-bucket-name&gt; \ --region us-east-1</code> </pre> <br><p>  <strong>Catatan:</strong> jika Anda mengoperasikan bucket di area selain <code>us-east-1</code> , selain pengaturan <code>- region</code> alihkan ke area yang diinginkan dan tambahkan <code>LocationConstraint</code> ke area yang sama.  Berikut ini menunjukkan perintah build bucket di wilayah <code>us-west-1</code> . </p><br><pre> <code class="plaintext hljs">aws s3api create-bucket \ --bucket &lt;your-unique-bucket-name&gt; \ --region us-west-1 \ --create-bucket-configuration LocationConstraint=us-west-1</code> </pre> <br><p>  Untuk mengonfigurasi penyimpanan untuk versi bucket S3 untuk pemulihan, gunakan perintah berikut: </p><br><pre> <code class="plaintext hljs">aws s3api put-bucket-versioning \ --bucket &lt;your-unique-bucket-name&gt; \ --versioning-configuration Status=Enabled</code> </pre> <br><p>  <strong>4. Membuat cluster Kubernetes pertama:</strong> Jadi, Anda siap membuat cluster pertama Anda!  Pertama, atur variabel lingkungan untuk menyederhanakan proses.  Jika Anda melewatkan konfigurasi DNS (setelah langkah 2), tambahkan <code>.k8s.local</code> ke nilai <code>NAME</code> . </p><br><pre> <code class="plaintext hljs">export NAME=myfirstcluster.example.com export KOPS_STATE_STORE=s3://your-bucket-name</code> </pre> <br><p>  Jangan lupa untuk melacak zona regional mana yang tersedia untuk Anda.  Dalam contoh ini, kami akan menggunakan cluster di wilayah <strong>us-east-2</strong> . </p><br><pre> <code class="plaintext hljs">aws ec2 describe-availability-zones --region us-east-2</code> </pre> <br><p>  Jika Anda menggunakan zona hosting publik, buat sebuah cluster menggunakan perintah berikut: </p><br><pre> <code class="plaintext hljs">kops create cluster \ --zones us-east-2c \ --node-count 3 \ ${NAME}</code> </pre> <br><p>  Jika Anda menggunakan zona hosting pribadi, lakukan: </p><br><pre> <code class="plaintext hljs">kops create cluster \ --zones us-east-2c \ --node-count 3 \ --dns private ${NAME}</code> </pre> <br><p>  Perintah ini akan memberi Anda log konfigurasi cluster K8S.  Cluster membutuhkan waktu untuk memulai, karena ia menciptakan mesin EC2 baru untuk node master minion. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 test]$ kops create cluster \ &gt; --dns private \ &gt; --zones us-east-2c \ &gt; --node-count 3 \ &gt; ${NAME} --yes I0306 09:45:29.636834 20628 create_cluster.go:439] Inferred --cloud=aws from zone "us-east-2c" I0306 09:45:29.637030 20628 create_cluster.go:971] Using SSH public key: /home/ec2-user/.ssh/id_rsa.pub I0306 09:45:29.850021 20628 subnets.go:184] Assigned CIDR 172.20.32.0/19 to subnet us-east-2c I0306 09:45:31.118837 20628 dns.go:92] Private DNS: skipping DNS validation I0306 09:45:46.986963 20628 executor.go:91] Tasks: 73 done / 73 total; 0 can run I0306 09:45:46.987101 20628 dns.go:153] Pre-creating DNS records I0306 09:45:47.668392 20628 update_cluster.go:248] Exporting kubecfg for cluster kops has set your kubectl context to k8s.appbase Cluster is starting. It should be ready in a few minutes.</code> </pre> <br><p>  Voila!  Cluster K8s seharusnya sudah berfungsi. </p><br><p>  <strong>5. Pemeriksaan cluster:</strong> semua instance yang dibuat oleh <code>kops</code> berada di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">ASG (Grup Penskalaan Otomatis)</a> .  Jika terjadi kegagalan, instance ASG diperiksa dan secara otomatis dibangun kembali. </p><br><p>  Untuk mengubah konfigurasi cluster, jalankan perintah berikut: </p><br><pre> <code class="plaintext hljs">kops edit cluster ${NAME}</code> </pre> <br><p>  Setiap kali Anda mengubah konfigurasi cluster, Anda harus membuat cluster dengan menjalankan perintah berikut: </p><br><pre> <code class="plaintext hljs">kops update cluster ${NAME} --yes</code> </pre> <br><p>  Anda akan melihat sesuatu seperti ini. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 examples]$ kops update cluster --yes Using cluster from kubectl context: k8s.appbase I0216 05:09:06.074467 2158 dns.go:92] Private DNS: skipping DNS validation I0216 05:09:07.699380 2158 executor.go:91] Tasks: 73 done / 73 total; 0 can run I0216 05:09:07.699486 2158 dns.go:153] Pre-creating DNS records I0216 05:09:07.961703 2158 update_cluster.go:248] Exporting kubecfg for cluster kops has set your kubectl context to k8s.appbase Cluster changes have been applied to the cloud.</code> </pre> <br><p>  Periksa kluster. </p><br><pre> <code class="plaintext hljs">kops validate cluster</code> </pre> <br><p>  Pastikan bahwa cluster sudah berfungsi. </p><br><pre> <code class="plaintext hljs">Using cluster from kubectl context: k8s.appbase Validating cluster k8s.appbase INSTANCE GROUPS NAME ROLE MACHINETYPE MIN MAX SUBNETS master-us-east-2c Master t2.large 1 1 us-east-2c nodes Node t2.medium 3 3 us-east-2c NODE STATUS NAME ROLE READY ip-172-20-44-33.us-east-2.compute.internal master True ip-172-20-52-48.us-east-2.compute.internal node True ip-172-20-62-30.us-east-2.compute.internal node True ip-172-20-64-53.us-east-2.compute.internal node True Your cluster k8s.appbase is ready</code> </pre> <br><p>  <strong>Lihat k8 baru Anda!</strong> </p><br><p>  Dengan panggilan sederhana ke API Kubernetes, Anda dapat memeriksa apakah API sedang online dan mendengarkan.  Gunakan <code>kubectl</code> untuk memeriksa node. </p><br><pre> <code class="plaintext hljs">kubectl get nodes</code> </pre> <br><p>  Ini akan memberikan informasi tentang node Anda dan status mereka saat ini. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 elasticsearch]$ kubectl get nodes NAME STATUS ROLES AGE VERSION ip-172-20-44-33.us-east-2.compute.internal Ready master 1m v1.8.6 ip-172-20-52-48.us-east-2.compute.internal Ready node 3m v1.8.6 ip-172-20-62-30.us-east-2.compute.internal Ready node 2m v1.8.6 ip-172-20-64-53.us-east-2.compute.internal Ready node 4m v1.8.6</code> </pre> <br><p>  Sub Kubernetes adalah abstraksi yang mewakili sekelompok satu atau beberapa wadah aplikasi (seperti Docker) dan beberapa sumber daya bersama untuk wadah ini.  Di bawah terbuka pada node.  Jika Anda perlu mengukur aplikasi, tambahkan node ke K8S yang digunakan. </p><br><p>  Untuk mengetahui tentang pod yang tersedia: </p><br><pre> <code class="plaintext hljs">kubectl get pods</code> </pre> <br><p>  Perintah ini akan mendaftar perapian yang tersedia di cluster. </p><br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 ~]$ kubectl get pods NAME READY STATUS RESTARTS AGE es-5967f5d99c-5vcpb 1/1 Running 0 3h es-5967f5d99c-cqk88 1/1 Running 0 3h es-5967f5d99c-lp789 1/1 Running 0 3h</code> </pre> <br><h3 id="razvertyvanie-elasticsearch-v-klastere-k8s">  Penerapan Elasticsearch di K8S Cluster </h3><br><p><img src="https://habrastorage.org/webt/ot/1m/he/ot1mhep0o9nltuo2ueq0puexg7g.png"></p><br><p>  Jika Anda tidak terbiasa dengan Kubernetes, saya sarankan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">pelatihan online k8s</a> . </p><br><p>  Saat ini, kami telah membuat cluster K8S: node utama dan dua node agen.  Peran node utama adalah untuk mentransfer perintah penyebaran ke aplikasi yang berjalan di pod agen node. </p><br><p>  Penerapan aplikasi K8S bersifat deklaratif dan dikonfigurasi melalui file JSON / YAML.  Pilih pengontrol berdasarkan jenis aplikasi atau sistem yang Anda gunakan.  Karena Elasticsearch adalah aplikasi stateful, kami akan menggunakan pengontrol StatefulSet. </p><br><p>  <strong>6. Penempatan melalui StatefulSet.</strong>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><strong>StatefulSet</strong></a> mengelola pod berdasarkan spesifikasi wadah yang identik.  Ini mengelola penyebaran dan penskalaan set perapian dan memastikan ketertiban dan keunikan perapian ini.  Pengontrol <strong>StatefulSet</strong> juga memudahkan untuk mengaitkan aplikasi dengan volume persisten, yang penting untuk Elasticsearch. </p><br><p>  Buat file bernama <code>es-stateful set. yaml</code> .  Ini akan berisi spesifikasi Elasticsearch.  Jangan ragu untuk mengubah konfigurasi.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lihat</a> daftar variabel lingkungan yang dapat diteruskan ke gambar Elasticsearch Anda di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><p>  <strong>7. Layanan:</strong> <code>Service</code> Kubernetes - abstraksi yang mendefinisikan seperangkat <code></code> logis dan akses ke sana.  Ini membantu aplikasi kontainer mengidentifikasi aplikasi kontainer lain atau contohnya sendiri dalam perapian yang berbeda. </p><br><p><img src="https://habrastorage.org/webt/di/wn/yq/diwnyqsurqxa0813hatxpfhfgco.png"></p><br><p>  <code>LoadBalancer</code> adalah jenis layanan khusus yang menyediakan pod ke jaringan eksternal dan mendistribusikan beban.  Kami akan menggunakannya untuk membuat alamat IP eksternal di mana siapa pun dapat menghubungi cluster Elasticsearch.  Kami akan menggunakan layanan ini untuk node ES sebagai cara untuk menemukan satu sama lain. </p><br><p>  Buat file bernama <code>es-svc.yaml</code> .  Edit dan tentukan layanan penyeimbang beban. </p><br><pre> <code class="plaintext hljs">apiVersion: v1 #API Version of the resource kind: Service #Type of resource metadata: #Contains metadata of this resource. name: elasticsearch #Name of this resource labels: #Additional identifier to put on pods component: elasticsearch #puts component = elasticsearch spec: #Specifications of this resource type: LoadBalancer #type of service selector: #will distribute load on pods which component: elasticsearch #have label `component = elasticsearch` ports: #Port on which LoadBalancer will listen - name: http #Name given to port port: 9200 #Port number protocol: TCP #Protocol supported - name: transport #Name given to port port: 9300 #Port number protocol: TCP #Protocol supported</code> </pre> <br><p>  <strong>8. Membuat aplikasi:</strong> itu saja yang kami butuhkan.  Menyebarkan cluster Elasticsearch kami di K8S menggunakan perintah berikut. </p><br><pre> <code class="plaintext hljs">kubectl create -f es-statefulset.yaml kubectl create -f es-svc.yaml</code> </pre> <br><p>  'Buat' adalah perintah universal untuk membuat sumber daya apa pun di K8S. </p><br><p>  3-node kami (ingat <code>replicas = 3</code> dalam konfigurasi StatefulSet?) Cluster Elasticsearch akan diluncurkan secara instan. </p><br><p>  Kami dapat memeriksa pod Elasticsearch dengan perintah ini: </p><br><pre> <code class="plaintext hljs">kubectl get pods</code> </pre> <br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 test]$ kubectl get pods,svc,deployment NAME READY STATUS RESTARTS AGE es-0 1/1 Running 0 23m es-1 1/1 Running 0 17m es-2 1/1 Running 0 23m</code> </pre> <br><p>  <strong>9. Menguji cluster Elasticsearch:</strong> periksa untuk melihat apakah Elasticsearch dikonfigurasi dengan benar dan berfungsi.  Dapatkan alamat IP eksternal untuk terhubung ke Elasticsearch.  Ini akan berlokasi di layanan <strong>LoadBalancer yang</strong> kami buat.  Gunakan perintah berikut untuk menjelaskan <strong>LoadBalancer</strong> : </p><br><pre> <code class="plaintext hljs">kubectl describe service elasticsearch</code> </pre> <br><pre> <code class="plaintext hljs">[ec2-user@ip-172-31-35-145 examples]$ kubectl describe service elasticsearch Name: elasticsearch Namespace: default Labels: component=elasticsearch Annotations: &lt;none&gt; Selector: component=elasticsearch Type: LoadBalancer IP: 100.70.114.146 LoadBalancer Ingress: http://a4d0c157d212811e898430af47d23da1-952261901.us-east-2.elb.amazonaws.com Port: http 9200/TCP TargetPort: 9200/TCP NodePort: http 31358/TCP Endpoints: 100.96.4.28:9200 Port: transport 9300/TCP TargetPort: 9300/TCP NodePort: transport 31767/TCP Endpoints: 100.96.4.28:9300 Session Affinity: None External Traffic Policy: Cluster Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal EnsuringLoadBalancer 1m service-controller Ensuring load balancer Normal EnsuredLoadBalancer 1m service-controller Ensured load balancer [ec2-user@ip-172-31-35-145 examples]$</code> </pre> <br><p>  Perhatikan nilai <code>LoadBalancer Ingress</code> .  Buka browser dengan URI dan nomor akhiran dari port eksternal Elasticsearch: <code>9200</code> .  Anda akan melihat ini: </p><br><p><img src="https://habrastorage.org/webt/el/b_/zl/elb_zlrvyocf5b7phv5pd9zubri.jpeg"></p><br><p>  Anda dapat memeriksa fungsionalitas node Elasticsearch dengan menambahkan: <code>9200/_cluster /health?pretty</code> ke alamat IP eksternal. </p><br><p><img src="https://habrastorage.org/webt/hh/ye/aa/hhyeaabyci4yvxnwqjkxacghek4.jpeg"></p><br><p>  <strong>10. Kubernetes Healing Testing:</strong> StatefulSets memiliki <strong>kemampuan untuk</strong> menyimpan jumlah replika yang ditentukan.  Dengan begitu, jika sub jatuh, StatefulSet akan memulai sub baru. </p><br><p>  Kami akan mengujinya dengan mensimulasikan kegagalan (menghapus semua pod tempat ES kami dijalankan) untuk melihat apakah cluster ES kami dapat secara otomatis mencadangkan dengan data yang utuh. </p><br><p><img src="https://habrastorage.org/webt/l1/vh/nb/l1vhnbrmqhhumqzqi1c7uczvdaa.gif"></p><br><p>  Karena StatefulSet menjalankan satu perapian pada satu waktu, dibutuhkan waktu untuk memulihkan semua kontainer. </p><br><p>  Kita melihat bahwa setelah pemulihan perapian, catatan yang diindeks tersedia bagi kita di negara bagian sebelum kegagalan ES. </p><br><h3 id="rekomenduem-sleduyuschie-shagi">  Disarankan langkah selanjutnya </h3><br><p>  Sebelum menggunakan pengaturan ini dalam produksi, harap diperhatikan: </p><br><ol><li>  Konfigurasikan cadangan.  Membantu memulihkan data yang hilang.  Proses ini paling baik otomatis. </li><li>  Penyiapan otorisasi.  Kami ingin melindungi cluster Elasticsearch.  Menyiapkan otentikasi atau otorisasi dasar berdasarkan token media akan memberikan keamanan. </li><li>  Sertifikat TLS.  Konfigurasikan LetsEncrypt / penyedia TLS lainnya dari sertifikat pemetaan domain pribadi untuk kelompok ES kami dan lindungi semua permintaan yang dikirim kepadanya. </li></ol><br><p>  Meskipun artikelnya bukan tentang itu, tetapi ketahuilah: Kubernetes dapat melakukan semua ini. </p><br><p>  Asli: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Menyebarkan Elasticsearch dengan Kubernetes di AWS dalam 10 langkah</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id416643/">https://habr.com/ru/post/id416643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id416633/index.html">QUIC, TLS 1.3, DNS-over-HTTPS, lalu di mana-mana</a></li>
<li><a href="../id416635/index.html">Dari kanan ke kiri. Cara mengubah antarmuka situs di bawah RTL</a></li>
<li><a href="../id416637/index.html">Musik dari kertas dan kardus: sejarah singkat variophone dan "suara yang ditarik"</a></li>
<li><a href="../id416639/index.html">Wawancara dengan pelopor peremajaan</a></li>
<li><a href="../id416641/index.html">8 tahap proses pengembangan antarmuka aplikasi seluler</a></li>
<li><a href="../id416645/index.html">MIS. Pola penelitian</a></li>
<li><a href="../id416647/index.html">Apakah lembaga pemerintah memimpikan risiko listrik?</a></li>
<li><a href="../id416651/index.html">1M HTTP rps pada 1 cpu core. DPDK bukannya nginx + linux kernel TCP / IP</a></li>
<li><a href="../id416653/index.html">Jenis perpustakaan</a></li>
<li><a href="../id416657/index.html">Dua pertiga kartu memori bekas berisi data pribadi pemilik sebelumnya</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>