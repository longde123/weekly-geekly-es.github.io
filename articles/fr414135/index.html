<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëá üçö üõ¢Ô∏è Comment le portage d'un jeu sur PSVita a am√©lior√© les performances globales ü¶Ü üçí üåΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Au niveau peut √™tre des milliers d'ennemis. 

 Defender's Quest: Valley of the Forgotten DX a toujours eu des probl√®mes de vitesse de longue date, et ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment le portage d'un jeu sur PSVita a am√©lior√© les performances globales</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414135/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/937/148/2a1/9371482a13b17c628afe9e994e6df76f.jpg" alt="image"></div><br>  <i>Au niveau peut √™tre des milliers d'ennemis.</i> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Defender's Quest: Valley of the Forgotten DX</a> a toujours eu des probl√®mes de vitesse de longue date, et j'ai finalement r√©ussi √† les r√©soudre.  La principale incitation √† une augmentation massive de la vitesse √©tait notre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">port sur la PlayStation Vita</a> .  Le jeu √©tait d√©j√† sorti sur PC et fonctionnait bien, sinon parfaitement, sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Xbox One</a> avec la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PS4</a> .  Mais sans une am√©lioration majeure du jeu, nous ne pourrions jamais le lancer sur Vita. <br><br>  Lorsqu'un jeu ralentit, les commentateurs sur Internet accusent g√©n√©ralement un langage ou un moteur de programmation.  Il est vrai que des langages comme C # et Java sont plus chers que C et C ++, et des outils comme Unity ont des probl√®mes insolubles, comme la r√©cup√©ration de place.  En fait, les gens proposent de telles explications parce que la langue et le moteur sont les propri√©t√©s les plus √©videntes des logiciels.  Mais les vrais tueurs de la performance peuvent √™tre de minuscules d√©tails stupides qui n'ont rien √† voir avec l'architecture. <br><a name="habracut"></a><br><h1>  0. Outils de profilage </h1><br>  Il n'y a qu'un seul moyen r√©el d'acc√©l√©rer le jeu: effectuer le profilage.  D√©couvrez ce que l'ordinateur passe trop de temps et faites-lui passer moins de temps dessus, ou mieux, √©vitez qu'il ne perde du temps. <br><br>  L'outil de profilage le plus simple est le moniteur syst√®me Windows standard (moniteur de performances): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ea3/b29/a69/ea3b29a690d6fe0ce9c6014abb6a9a62.png"></div><br>  En fait, c'est un outil assez flexible et il est tr√®s facile de travailler avec lui.  Appuyez simplement sur Ctrl + Alt + Suppr, ouvrez le "Gestionnaire des t√¢ches" et cliquez sur l'onglet "Performances".  Cependant, n'ex√©cutez pas trop d'autres programmes.  Si vous regardez attentivement, vous pouvez facilement d√©tecter les pics d'utilisation du processeur et m√™me les fuites de m√©moire.  C'est un moyen non informatif, mais cela peut √™tre la premi√®re √©tape pour trouver des endroits lents. <br><br>  Defender's Quest est √©crit dans le langage <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Haxe de</a> haut niveau compil√© dans d'autres langages (ma cible principale √©tait le C ++).  Cela signifie que tout outil capable de profiler C ++ peut √©galement profiler mon code C ++ g√©n√©r√© par Haxe.  Donc, quand j'ai voulu comprendre les causes des probl√®mes, j'ai lanc√© Performance Explorer √† partir de Visual Studio: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/999/a24/932/999a24932b41cd329e28bcb6c5076725.png"></div><br>  De plus, diff√©rentes consoles ont leurs propres outils de profilage, ce qui est tr√®s pratique, mais √† cause du NDA je ne peux rien vous dire √† leur sujet.  Mais si vous y avez acc√®s, assurez-vous de les utiliser! <br><br>  Au lieu d'√©crire un terrible tutoriel sur la fa√ßon d'utiliser des outils de profilage comme Performance Explorer, je laisse simplement un lien vers la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">documentation officielle</a> et je passe au sujet principal - les choses incroyables qui ont conduit √† une √©norme augmentation de la productivit√© et comment j'ai r√©ussi √† les trouver ! <br><br><h1>  1. D√©tection des probl√®mes </h1><br>  La performance du jeu n'est pas seulement la vitesse elle-m√™me, mais aussi sa perception.  Defender's Quest est un jeu de genre de tower defense qui est rendu √† 60 FPS, mais avec une vitesse de jeu variable dans la plage de 1 / 4x √† 16x.  Quelle que soit la vitesse du jeu, la simulation utilise un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">horodatage fixe</a> avec 60 mises √† jour par seconde de 1x temps de simulation.  Autrement dit, si vous ex√©cutez le jeu √† une vitesse de 16x, la logique de mise √† jour fonctionnera en fait avec une fr√©quence de <em>960 FPS</em> .  Honn√™tement, ce sont des demandes trop √©lev√©es pour le jeu!  Mais c'est moi qui ai cr√©√© ce mode, et s'il s'av√®re lent, les joueurs le remarqueront certainement. <br><br>  Et dans le jeu, il y a <em>un tel</em> niveau: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ed9/5e1/694/ed95e16941a18fe9a71b7333d537f1d9.png"></div><br>  C'est la bataille bonus finale "Endless 2", c'est aussi "mon cauchemar personnel".  La capture d'√©cran a √©t√© prise en mode New Game +, dans lequel les ennemis sont non seulement beaucoup plus forts, mais ont √©galement des fonctionnalit√©s telles que la restauration de la sant√©.  La strat√©gie pr√©f√©r√©e du joueur ici est de pomper les dragons au niveau Roar maximum (attaque AOE qui √©tourdit les ennemis), et derri√®re eux a mis un certain nombre de chevaliers avec Knockback pomp√© au maximum pour pousser tout le monde passant les dragons dans leur zone d'action.  L'effet cumulatif est qu'un √©norme groupe de monstres reste ind√©finiment au m√™me endroit, beaucoup plus longtemps que les joueurs n'auraient √† survivre s'ils les avaient r√©ellement tu√©s.  √âtant donn√© que les joueurs doivent <em>attendre les</em> vagues et ne pas les <em>tuer</em> pour recevoir des r√©compenses et des r√©alisations, une telle strat√©gie est absolument efficace et brillante - c'est exactement le comportement des joueurs que j'ai stimul√©. <br><br>  Malheureusement, cela s'av√®re √©galement √™tre un cas <em>pathologique</em> pour les performances, en <em>particulier</em> lorsque les joueurs veulent jouer √† des vitesses 16x ou 8x.  Bien s√ªr, seuls les joueurs les plus hardcore essaieront d'obtenir le succ√®s "Hundredth Wave" dans New Game + au niveau Endless 2, mais ce ne sont que ceux qui parlent le jeu le plus fort, donc je voulais qu'ils soient heureux. <br><br>  C'est juste un jeu 2D avec un tas de sprites, qu'est-ce qui pourrait ne pas y arriver? <br><br>  Et en effet.  Faisons les choses correctement. <br><br><h1>  2. R√©solution des collisions </h1><br>  Jetez un ≈ìil √† cette capture d'√©cran: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/098/bd2/116/098bd2116180a0b3ea3c9a66339b7fa3.png"></div><br>  Vous voyez ce bagel autour du ranger?  C'est sa zone d'impact - notez qu'il y a aussi une zone morte dans laquelle il <em>ne peut pas</em> toucher des cibles.  Chaque classe a sa propre zone d'attaque, et chaque d√©fenseur a une zone de taille diff√©rente, selon le niveau de boost et les param√®tres personnels.  Et chaque d√©fenseur peut en th√©orie viser n'importe quel ennemi dans le champ de sa port√©e.  Il en va de m√™me pour certains types d'ennemis.  Il peut y avoir jusqu'√† 36 d√©fenseurs sur la carte (sans compter le personnage principal Azru), mais il n'y a pas de limite sup√©rieure sur le nombre d'ennemis.  Chaque d√©fenseur et ennemi a une liste de cibles possibles, cr√©√©e sur la base d'appels pour v√©rifier la zone √† chaque √©tape de mise √† jour (moins la coupure logique de ceux qui ne peuvent pas attaquer pour le moment, etc.). <br><br>  Aujourd'hui, les processeurs vid√©o sont tr√®s rapides - si vous ne les forcez pas trop, ils peuvent alors traiter presque n'importe quel nombre de polygones.  Mais m√™me les CPU les plus rapides ont tr√®s facilement des ¬´goulots d'√©tranglement¬ª dans les proc√©dures simples, en particulier celles qui croissent de fa√ßon exponentielle.  C‚Äôest pourquoi un jeu 2D peut se r√©v√©ler plus lent qu‚Äôun jeu 3D beaucoup plus beau - non pas parce que le programmeur ne pouvait pas faire face (peut-√™tre que c‚Äôest aussi, du moins dans mon cas), mais en principe parce que la logique peut parfois √™tre plus ch√®re, que de dessiner!  La question n'est pas de savoir combien d'objets sont √† l'√©cran, mais ce qu'ils <em>font</em> . <br><br>  Explorons et acc√©l√©rons la reconnaissance des collisions.  √Ä titre de comparaison, je dirai qu'avant l'optimisation, la reconnaissance des collisions prenait jusqu'√† ~ 50% du temps processeur dans le cycle de bataille principal.  Apr√®s optimisation, moins de 5%. <br><br><h2>  Tout tourne autour des arbres quadrants </h2><br>  La principale solution au probl√®me de la reconnaissance de collision lente est de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">diviser l'espace</a> - et d√®s le d√©but, nous avons utilis√© une impl√©mentation <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de</a> haute qualit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de l'arbre quadrant</a> .  Essentiellement, il s√©pare efficacement l'espace de sorte que de nombreux contr√¥les de collision facultatifs peuvent √™tre ignor√©s. <br><br>  Dans chaque image, nous mettons √† jour l'arborescence enti√®re des quadrants (QuadTree) pour suivre la position de chaque objet, et lorsque l'ennemi ou le d√©fenseur veut viser quelqu'un, il demande √† QuadTree une liste des objets √† proximit√©.  Mais le profileur nous a dit que ces deux op√©rations sont beaucoup plus lentes qu'elles ne devraient l'√™tre. <br><br>  Qu'est-ce qui ne va pas ici? <br><br>  Il s'est av√©r√© - beaucoup. <br><br><h2>  Saisie de cha√Ænes </h2><br>  Comme j'ai gard√© les ennemis et les d√©fenseurs dans un arbre quadrant, j'ai d√ª indiquer ce que je cherchais, et cela a √©t√© fait comme ceci: <br><br> <code>var things:Array&lt;XY&gt; = _qtree.queryRange(zone.bounds, "e"); //"e" -   "enemy"</code> <br> <br>  Dans le jargon des programmeurs, cela s'appelle du code de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">frappe de cha√Æne</a> et, entre autres raisons, c'est mauvais parce que les comparaisons de cha√Ænes sont toujours plus lentes que les comparaisons enti√®res. <br><br>  J'ai rapidement r√©cup√©r√© des constantes enti√®res et remplac√© le code par ceci: <br><br> <code>var things:Array&lt;XY&gt; = _qtree.queryRange(zone.bounds, QuadTree.ENEMY);</code> <br> <br>  (Oui, cela valait probablement la peine d'utiliser <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Enum Abstract</a> pour une s√©curit√© maximale du type, mais j'√©tais press√© et je devais d'abord faire le travail.) <br><br>  Ce changement √† lui seul a apport√© une <em>√©norme</em> contribution, car cette fonction est appel√©e <em>constamment</em> et r√©cursivement, chaque fois que quelqu'un a besoin d'une nouvelle liste d'objectifs. <br><br><h2>  Tableau vs vecteur </h2><br>  Jetez un ≈ìil √† ceci: <br><br> <code>var things:Array&lt;XY&gt;</code> <br> <br>  Les tableaux Haxe sont tr√®s similaires aux tableaux ActionScript et JS en ce qu'ils sont des collections d'objets redimensionnables, mais dans Haxe, ils sont fortement typ√©s. <br><br>  Cependant, il existe une autre structure de donn√©es plus efficace avec les langages cibles statiques tels que cpp, √† savoir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">haxe.ds.Vector</a> .  Les vecteurs Haxe sont essentiellement les m√™mes que les tableaux, sauf que lorsqu'ils sont cr√©√©s, ils obtiennent une taille fixe. <br><br>  Comme mes arbres quadrants avaient d√©j√† un volume fixe, j'ai remplac√© les tableaux par des vecteurs pour obtenir une augmentation de vitesse notable. <br><br><h2>  Demandez uniquement ce dont vous avez besoin </h2><br>  Auparavant, ma fonction <code>queryRange</code> une liste d'objets, des instances <code>XY</code> .  Ils contenaient les coordonn√©es x / y de l'objet de jeu r√©f√©renc√© et son identifiant d'entier unique (index de recherche dans le tableau principal).  L'objet de jeu ex√©cutant la demande a re√ßu ces XY, extrait un identifiant entier pour obtenir sa cible, puis a oubli√© le reste. <br><br>  Alors pourquoi devrais-je passer toutes ces r√©f√©rences aux objets XY pour chaque n≈ìud QuadTree de <em>mani√®re r√©cursive</em> , et m√™me <em>960 fois par trame?</em>  Il me suffit de renvoyer une liste d'identifiants entiers. <br><br>  <strong><em>CONSEIL PROFESSIONNEL: les nombres entiers sont beaucoup plus rapides √† transmettre que presque tous les autres types de donn√©es!</em></strong> <br><br>  Compar√© √† d'autres corrections, c'√©tait assez simple, mais la croissance des performances √©tait encore perceptible, car cette boucle interne √©tait utilis√©e tr√®s activement. <br><br><h2>  Optimisation de la r√©cursivit√© de la queue </h2><br>  Il existe une chose √©l√©gante appel√©e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">optimisation de l'appel de queue</a> .  C'est difficile √† expliquer, je ferai donc mieux de vous montrer un exemple. <br><br>  C'√©tait: <br><br> <code>nw.queryRange(Range, -1, result); <br> ne.queryRange(Range, -1, result); <br> sw.queryRange(Range, -1, result); <br> se.queryRange(Range, -1, result); <br> return result;</code> <br> <br>  C'est devenu: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> se.queryRange(Range, <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>, sw.queryRange(Range, <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>, ne.queryRange(Range, <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>, nw.queryRange(Range, <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>, result))));</code> </pre> <br>  Le code renvoie les m√™mes r√©sultats logiques, mais selon le profileur, la deuxi√®me option est plus rapide, au moins lors de la traduction en cpp.  Les deux exemples ex√©cutent exactement la m√™me logique - ils modifient la structure de donn√©es ¬´r√©sultat¬ª et la transmettent √† la fonction suivante avant de revenir.  Lorsque nous le faisons r√©cursivement, nous pouvons √©viter que le compilateur g√©n√®re des r√©f√©rences temporaires, car il peut simplement retourner imm√©diatement le r√©sultat de la fonction pr√©c√©dente, plut√¥t que de s'y tenir dans une √©tape suppl√©mentaire.  Ou quelque chose comme √ßa.  Je ne comprends pas bien comment cela fonctionne, alors lisez l'article sur le lien ci-dessus. <br><br>  (√Ä en juger par ce que je sais, la version actuelle du compilateur Haxe n'a pas de fonction d'optimisation de r√©cursivit√© de queue, c'est-√†-dire que c'est probablement le travail du compilateur C ++ - alors ne soyez pas surpris si cette astuce ne fonctionne pas lors de la traduction de code Haxe pas en cpp.) <br><br><h2>  Pool d'objets </h2><br>  Si j'ai besoin de r√©sultats pr√©cis, je dois √† nouveau d√©truire et reconstruire QuadTree √† chaque appel de mise √† jour.  La cr√©ation de nouvelles instances QuadTree est une t√¢che assez courante, mais avec un grand nombre de nouveaux objets AABB et XY, les QuadTrees qui en d√©pendent ont entra√Æn√© une grave surcharge de m√©moire.  Comme ce sont des objets tr√®s simples, il serait logique d'allouer beaucoup de ces objets √† l'avance et de les r√©utiliser constamment.  C'est ce qu'on appelle un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pool d'objets</a> . <br><br>  Je faisais quelque chose comme √ßa: <br><br> <code>nw = new QuadTree( new AABB( cx - hs2x, cy - hs2y, hs2x, hs2y) ); <br> ne = new QuadTree( new AABB( cx + hs2x, cy - hs2y, hs2x, hs2y) ); <br> sw = new QuadTree( new AABB( cx - hs2x, cy + hs2y, hs2x, hs2y) ); <br> se = new QuadTree( new AABB( cx + hs2x, cy + hs2y, hs2x, hs2y) );</code> <br> <br>  Mais j'ai remplac√© le code par ceci: <br><br> <code>nw = new QuadTree( AABB.get( cx - hs2x, cy - hs2y, hs2x, hs2y) ); <br> ne = new QuadTree( AABB.get( cx + hs2x, cy - hs2y, hs2x, hs2y) ); <br> sw = new QuadTree( AABB.get( cx - hs2x, cy + hs2y, hs2x, hs2y) ); <br> se = new QuadTree( AABB.get( cx + hs2x, cy + hs2y, hs2x, hs2y) );</code> <br> <br>  Nous utilisons le framework open source <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HaxeFlixel</a> , nous l'avons donc <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">impl√©ment√© en</a> utilisant la classe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FlxPool</a> HaxeFlixel.  Dans le cas de telles optimisations hautement sp√©cialis√©es, je remplace souvent certains √©l√©ments de base de Flixel (par exemple, la reconnaissance des collisions) par ma propre impl√©mentation (comme je l'ai fait avec QuadTrees), mais FlxPool est meilleur que tout ce que j'ai √©crit moi-m√™me et il fait exactement ce dont il a besoin. <br><br><h2>  Sp√©cialisation si n√©cessaire </h2><br>  Un objet <code>XY</code> est une classe simple qui a les propri√©t√©s <code>x</code> , <code>y</code> et <code>int_id</code> .  Puisqu'il a √©t√© utilis√© dans une boucle interne particuli√®rement active, j'ai pu √©conomiser beaucoup de commandes et d'op√©rations d'allocation de m√©moire en d√©pla√ßant toutes ces donn√©es vers une structure de donn√©es sp√©ciale qui fournit les m√™mes fonctionnalit√©s que <code>Vector&lt;XY&gt;</code> .  J'ai appel√© cette nouvelle classe <code>XYVector</code> et le r√©sultat peut √™tre vu <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> .  Il s'agit d'une application tr√®s hautement sp√©cialis√©e et non flexible en m√™me temps, mais elle nous a apport√© quelques am√©liorations de vitesse. <br><br><h2>  Fonctions int√©gr√©es </h2><br>  Maintenant, apr√®s avoir termin√© la vaste phase de reconnaissance des collisions, nous devons effectuer de nombreuses v√©rifications pour savoir quels objets entrent en collision.  Lorsque c'est possible, j'essaie de comparer des points et des chiffres, pas des chiffres et des chiffres, mais parfois je dois faire ces derniers.  Dans tous les cas, tout cela n√©cessite ses propres contr√¥les sp√©ciaux: <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> static function _collide_circleCircle(a:Zone, b:Zone):Bool { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dx:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = a.centerX - b.centerX; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dy:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = a.centerY - b.centerY; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d2:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = (dx * dx) + (dy * dy); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r2:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = (a.radius2) + (b.radius2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d2 &lt; r2; }</code> </pre> <br><br>  Tout cela peut √™tre am√©lior√© avec un seul <code>inline</code> : <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> function _collide_circleCircle(a:Zone, b:Zone):Bool { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dx:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = a.centerX - b.centerX; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dy:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = a.centerY - b.centerY; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d2:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = (dx * dx) + (dy * dy); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r2:<span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> = (a.radius2) + (b.radius2); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> d2 &lt; r2; }</code> </pre> <br><br>  Lorsque nous ajoutons inline √† une fonction, nous demandons au compilateur de copier et coller ce code et de coller les variables lorsqu'il est utilis√©, et de ne pas faire d'appel externe √† une fonction distincte, ce qui entra√Æne des co√ªts inutiles.  L'incorporation n'est pas toujours applicable (par exemple, elle gonfle la quantit√© de code), mais elle est id√©ale pour les situations o√π de petites fonctions sont appel√©es encore et encore. <br><br><h2>  Nous √©voquons les conflits </h2><br>  La vraie le√ßon ici est que dans le monde r√©el, les optimisations ne sont pas toujours du m√™me type.  Ces correctifs sont un m√©lange de techniques avanc√©es, de hacks bon march√©, d'application de recommandations logiques et d'√©limination des erreurs stupides.  Tout cela en g√©n√©ral nous donne une am√©lioration des performances. <br><br>  Mais encore - <em>mesurez sept fois, coupez-en un!</em> <br><br>  Deux heures d'optimisation p√©dante de la fonction, appel√©es une fois toutes les six images et prenant 0,001 ms, ne valent pas l'effort, malgr√© la laideur et la stupidit√© du code. <br><br><h1>  3. Triez tout </h1><br>  En fait, c'√©tait l'une de mes derni√®res am√©liorations, mais elle s'est av√©r√©e si avantageuse qu'elle m√©rite son propre titre.  De plus, c'√©tait le plus simple et il a fait ses preuves √† plusieurs reprises.  Le profileur m'a montr√© une proc√©dure que je ne pouvais pas am√©liorer du tout - la boucle draw () principale, qui prenait trop de temps.  La raison en √©tait la fonction qui triait tous les √©l√©ments de l'√©cran avant le rendu - √† savoir, le <em>tri de</em> tous les sprites prenait beaucoup plus de temps que de les dessiner! <br><br>  Si vous regardez les captures d'√©cran du jeu, vous verrez que tous les ennemis et d√©fenseurs sont d'abord tri√©s par <code>y</code> , puis par <code>x</code> , de sorte que les √©l√©ments se chevauchent d'arri√®re en avant, de gauche √† droite, lorsque nous passons du coin sup√©rieur gauche au coin inf√©rieur droit de l'√©cran. <br><br>  Une fa√ßon de d√©jouer le tri est de simplement passer le tri du rendu √† travers le cadre.  C'est une astuce utile pour certaines fonctions co√ªteuses, mais cela a imm√©diatement conduit √† des bugs visuels tr√®s visibles, donc cela ne nous convenait pas. <br><br>  Enfin, la d√©cision est venue de l'un des mainteneurs de HaxeFlixel, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Jens Fisher</a> .  Il a demand√©: "Vous √™tes-vous assur√© d'utiliser un algorithme de tri rapide pour les tableaux presque tri√©s?" <br><br>  Non!  Il s'est av√©r√© que non.  J'ai utilis√© le tri de tableaux √† partir de la biblioth√®que standard Haxe (je pense que c'√©tait un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tri par fusion</a> - un bon choix pour les cas g√©n√©raux. Mais j'avais un cas tr√®s <em>sp√©cial</em> . Lors du tri dans chaque image, la position de tri ne change qu'un tr√®s petit nombre de sprites, m√™me s'il y en a beaucoup. Par cons√©quent J'ai remplac√© l'ancien appel de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">tri par un tri par encarts</a> et <em>boum!</em> - la vitesse a instantan√©ment augment√©. <br><br><h1>  4. Autres probl√®mes techniques </h1><br>  La reconnaissance et le tri des collisions ont √©t√© de grandes victoires dans la logique de <code>update()</code> et <code>draw()</code> , mais de nombreux autres pi√®ges √©taient cach√©s dans les boucles internes activement utilis√©es. <br><br><h2>  Std.is () et cast </h2><br>  Dans diff√©rentes boucles internes "chaudes", j'avais un code similaire: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Std.<span class="hljs-keyword"><span class="hljs-keyword">is</span></span>(something,<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>)) { var typed:<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> = cast(something,<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>); }</code> </pre> <br><br>  Dans le langage Haxe, <code>Std.is()</code> nous indique si un objet appartient √† un type sp√©cifique (Type) ou √† une classe (Class), et <code>cast</code> essaie de le convertir en un type sp√©cifique pendant l'ex√©cution du programme. <br><br>  Il existe des versions s√ªres et non prot√©g√©es des <code>cast</code> s√ªrs pour la <code>cast</code> , ce qui r√©duit les performances, mais pas les lancements non prot√©g√©s. <br><br>  Coffre-fort: <code>cast(something, Type);</code> <br><br>  Non prot√©g√©: <code>var typed:Type = cast something;</code> <br><br>  Lorsqu'une tentative de distribution non s√©curis√©e √©choue, nous obtenons une valeur nulle, tandis qu'une distribution s√©curis√©e l√®ve une exception.  Mais si nous n'attrapons pas d'exception, quel est l'int√©r√™t de faire un casting s√ªr?  Sans prise, l'op√©ration √©choue toujours, mais elle fonctionne plus lentement. <br><br>  De plus, il est inutile de faire pr√©c√©der une distribution s√©curis√©e avec la <code>Std.is()</code> .  La seule raison d'utiliser un casting s√ªr est une exception garantie, mais si nous v√©rifions le type avant le casting, nous garantissons d√©j√† que le casting n'√©chouera pas! <br><br>  Je peux acc√©l√©rer un peu les <code>Std.is()</code> avec un casting <code>Std.is()</code> apr√®s avoir v√©rifi√© <code>Std.is()</code> .  Mais pourquoi devons-nous r√©√©crire la m√™me chose si je n'ai pas du tout besoin de v√©rifier le type de classe? <br><br>  Supposons que j'ai un <code>CreatureSprite</code> , qui peut √™tre une instance d'une sous-classe de <code>DefenderSprite</code> ou <code>EnemySprite</code> .  Au lieu d'appeler <code>Std.is(this,DefenderSprite)</code> nous pouvons cr√©er un champ entier dans <code>CreatureSprite</code> avec des valeurs comme <code>CreatureType.DEFENDER</code> ou <code>CreatureType.ENEMY</code> , qui sont v√©rifi√©es encore plus rapidement. <br><br>  Je le r√©p√®te, cela ne vaut la peine de le r√©parer que dans les endroits o√π un ralentissement significatif est clairement enregistr√©. <br><br>  Au fait, vous pouvez en savoir plus sur la distribution <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√ªre</a> et <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">non prot√©g√©e</a> dans le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">manuel Haxe</a> . <br><br><h2>  S√©rialisation / d√©s√©rialisation de l'univers </h2><br>  C'√©tait ennuyeux de trouver de tels endroits dans le code: <br><br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:SomeClass </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> SomeClass.fromXML(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.toXML()); }</code> </pre> <br>  Ouais.  Pour copier un objet, nous le <em>s√©rialisons en XML</em> , puis <em>analysons tout ce XML</em> , apr√®s quoi nous rejetons instantan√©ment le XML et retournons un nouvel objet.  C'est probablement le moyen le plus lent de copier un objet, en plus, cela surcharge la m√©moire.  Au d√©part, j'ai √©crit des appels XML pour enregistrer et charger √† partir du disque, et je pense que j'√©tais trop paresseux pour √©crire les bonnes proc√©dures de copie. <br><br>  Probablement, tout serait en ordre si cette fonction √©tait rarement utilis√©e, mais ces appels ont surgi √† des endroits inappropri√©s au milieu du gameplay.  Alors je me suis assis et j'ai commenc√© √† √©crire et √† tester la fonction de copie correcte. <br><br><h2>  Dites non √† Null </h2><br>  La v√©rification de l'√©galit√© pour null est utilis√©e assez souvent, mais lors de la conversion de Haxe en cpp, un objet qui permet une valeur ind√©finie entra√Æne des co√ªts inutiles qui ne surviennent pas si le compilateur peut supposer que l'objet ne sera jamais nul.  Cela est particuli√®rement vrai pour les types de base comme <code>Int</code> - Haxe impl√©mente la validit√© d'une valeur ind√©finie pour eux dans le syst√®me cible statique par leur ¬´emballage¬ª, ce qui se produit non seulement pour les variables qui sont explicitement d√©clar√©es nulles ( <code>var myVar:Null&lt;Int&gt;</code> ), mais aussi pour des choses comme les options d'assistance ( <code>?myParam:Int</code> ).  De plus, les contr√¥les nuls eux-m√™mes provoquent des d√©chets inutiles. <br><br>  J'ai pu r√©soudre certains de ces probl√®mes simplement en regardant le code et en pensant √† des alternatives - puis-je faire une v√©rification plus simple, qui sera toujours vraie lorsque l'objet est nul?  Puis-je intercepter null beaucoup plus t√¥t dans la cha√Æne d'appels de fonction et transmettre un indicateur entier ou bool√©en simple aux appels enfants?  Puis-je tout structurer pour que la valeur <em>ne</em> soit <em>jamais</em> garantie de devenir nulle?  Et ainsi de suite.  Nous ne pouvons pas √©liminer compl√®tement les v√©rifications nulles et les valeurs nullables, mais les retirer des fonctions m'a beaucoup aid√©. <br><br><h1>  5. Temps de t√©l√©chargement </h1><br>  Sur PSVita, nous avons eu de s√©rieux probl√®mes particuliers avec le temps de chargement de certaines sc√®nes.  Lors du profilage, il s'est av√©r√© que les raisons se r√©sument principalement √† la pixellisation du texte, au rendu logiciel inutile, au rendu des boutons co√ªteux et √† d'autres choses. <br><br><h2>  Texte </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HaxeFlixel est</a> bas√© sur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">OpenFL</a> , qui a TextField impressionnant et fiable.  Mais j'ai utilis√© des objets FlxText de mani√®re imparfaite - les objets FlxText ont un champ de texte OpenFL qui est pixellis√©.  Cependant, il s'est av√©r√© que je n'avais pas besoin de la plupart de ces fonctions de texte complexes, mais en raison de la fa√ßon stupide de configurer mon syst√®me d'interface utilisateur, les champs de texte devaient √™tre rendus avant que tous les autres objets ne soient localis√©s.  Cela a conduit √† des sauts petits mais perceptibles, par exemple, lors du chargement d'une fen√™tre contextuelle. <br><br>  Ici, j'ai fait trois corrections - tout d'abord, j'ai remplac√© autant de texte que possible par des polices raster.  Flixel prend en charge diff√©rents formats de polices raster, y compris le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">BMFont d'AngelCode</a> , ce qui facilite le travail avec Unicode, le style et le cr√©nage, mais l'API de texte raster est l√©g√®rement diff√©rente de l'API de texte brut, j'ai donc d√ª √©crire une petite classe wrapper pour simplifier la transition.  (Je lui ai donn√© un nom appropri√© <code>FlxUITextHack</code> ). <br><br>  Cela a l√©g√®rement am√©lior√© le travail - les polices bitmap s'affichent tr√®s rapidement - mais la complexit√© a l√©g√®rement augment√©: j'ai d√ª pr√©parer sp√©cialement des jeux de caract√®res s√©par√©s et ajouter une logique de commutation entre eux en fonction des param√®tres r√©gionaux, au lieu de simplement configurer une zone de texte qui a fait tout le travail. <br><br>  Le deuxi√®me correctif consistait √† cr√©er un nouvel objet d'interface utilisateur qui √©tait un simple <em>espace r√©serv√©</em> pour le texte mais qui avait les m√™mes propri√©t√©s publiques que le texte.  Je l'ai appel√© ¬´zone de texte¬ª et j'ai cr√©√© une nouvelle classe pour cela dans ma biblioth√®que d'interface utilisateur afin que mon syst√®me d'interface utilisateur puisse utiliser ces zones de texte de la m√™me mani√®re que les champs de texte r√©els, mais il ne restitue rien tant qu'il n'a pas calcul√© la taille et la position pour tout le reste.  Ensuite, lorsque ma sc√®ne a √©t√© pr√©par√©e, j'ai commenc√© la proc√©dure de remplacement de ces zones de texte par de vrais champs de texte (ou champs de texte de polices bitmap). <br><br>  La troisi√®me correction concernait la perception.  S'il y a des pauses entre l'entr√©e et la r√©action m√™me en une demi-seconde, le joueur per√ßoit cela comme un freinage.  Par cons√©quent, j'ai essay√© de trouver toutes les sc√®nes dans lesquelles il y a un retard dans l'entr√©e jusqu'√† la transition suivante, et j'ai ajout√© soit un calque translucide avec le mot "Loading ..." soit juste un calque sans texte.  Une telle correction simple a consid√©rablement am√©lior√© la <em>perception de la</em> r√©activit√© du jeu, car quelque chose se produit imm√©diatement apr√®s que le joueur a touch√© la commande, m√™me si cela prend un certain temps pour afficher le menu. <br><br><h2>  Rendu logiciel </h2><br>  La plupart des menus utilisent une combinaison de mise √† l'√©chelle logicielle et de composition √† 9 tranches.  Cela est arriv√© parce que dans la version PC, il y avait une interface utilisateur ind√©pendante de la r√©solution qui pouvait fonctionner avec un rapport d'aspect de 4: 3 et 16: 9, mis √† l'√©chelle en cons√©quence.  Mais sur PSVita, nous <em>connaissons</em> d√©j√† <em>la</em> r√©solution, c'est-√†-dire que nous n'avons pas besoin de toutes ces ressources extra-haute r√©solution et algorithmes de mise √† l'√©chelle en temps r√©el.  Nous pouvons simplement pr√©-rendre les ressources √† la r√©solution exacte et les placer sur l'√©cran. <br><br>  Tout d'abord, je suis entr√© dans le balisage de l'interface utilisateur pour les conditions Vita qui ont chang√© le jeu en utilisant un ensemble parall√®le de ressources.  Ensuite, je devais cr√©er ces ressources pr√©par√©es pour une autorisation.  Le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d√©bogueur HaxeFlixel</a> s'est av√©r√© tr√®s utile <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ici</a> - j'y ai ajout√© mon script pour qu'il vide simplement le cache raster sur le disque.  Ensuite, j'ai cr√©√© une configuration de construction sp√©ciale pour Windows qui simule l'autorisation de Vita, ouvert tour √† tour tous les menus du jeu, bascul√© vers le d√©bogueur et lanc√© la commande d'exportation pour les versions √† l'√©chelle des ressources sous la forme de fichiers PNG pr√™ts √† l'emploi.  Ensuite, je les ai simplement renomm√©s et les ai utilis√©s comme ressources pour Vita. <br><br><h2>  Rendu des boutons </h2><br>  Mon syst√®me d'interface utilisateur avait un vrai probl√®me avec les boutons - lorsqu'ils ont √©t√© cr√©√©s, les boutons ont rendu le jeu de ressources par d√©faut, et un instant plus tard, ils ont redimensionn√© (et rendu √† nouveau) le code de d√©marrage de l'interface utilisateur, et parfois m√™me la <em>troisi√®me</em> fois, avant que l'interface utilisateur enti√®re ne soit charg√©e .  J'ai r√©solu ce probl√®me en ajoutant des options qui retardaient le rendu des boutons √† la derni√®re √©tape. <br><br><h2>  Num√©risation de texte en option </h2><br>  Le magazine se chargeait particuli√®rement lentement.  Au d√©but, je pensais que le probl√®me venait des champs de texte, mais non.  Le texte du magazine pouvait contenir des liens vers d'autres pages, ce qui √©tait indiqu√© par des caract√®res sp√©ciaux int√©gr√©s dans le texte brut lui-m√™me.  Ces caract√®res ont ensuite √©t√© d√©coup√©s et utilis√©s pour calculer l'emplacement du lien. <br><br>  Cela s'est av√©r√©.  que j'ai scann√© <em>chaque champ de texte</em> pour trouver et remplacer ces caract√®res par des liens correctement format√©s, sans m√™me v√©rifier d'abord s'il y a un caract√®re sp√©cial dans ce champ de texte!  Pire, selon la conception, les liens n'√©taient utilis√©s que sur la page de contenu, mais je les ai v√©rifi√©s dans chaque zone de texte de chaque page. <br><br>  J'ai r√©ussi √† contourner toutes ces v√©rifications en utilisant la construction if du formulaire "Cette zone de texte utilise-t-elle des liens".  La r√©ponse √† cette question √©tait g√©n√©ralement non.  Enfin, la page qui a mis le plus de temps √† se charger s'est av√©r√©e √™tre la page d'index.  Comme il ne change jamais dans le menu du journal, pourquoi ne le cache-t-on pas? <br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 6. Profilage de la m√©moire </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La vitesse n'est pas seulement le CPU. </font><font style="vertical-align: inherit;">La m√©moire peut √©galement √™tre un probl√®me, en particulier sur les plates-formes faibles comme Vita. </font><font style="vertical-align: inherit;">M√™me lorsque vous avez r√©ussi √† vous d√©barrasser de la derni√®re fuite de m√©moire, vous pouvez toujours avoir des probl√®mes avec l'utilisation de la m√©moire en dents de scie dans un environnement de r√©cup√©ration de place. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Quelle est l'utilisation de la m√©moire en dents de scie? </font><font style="vertical-align: inherit;">Le garbage collector fonctionne comme suit: les donn√©es et les objets que vous n'utilisez pas s'accumulent au fil du temps et sont p√©riodiquement effac√©s. </font><font style="vertical-align: inherit;">Mais vous n'avez pas de contr√¥le clair sur le moment o√π cela se produit, donc le graphique d'utilisation de la m√©moire ressemble √† une scie:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7fc/d66/464/7fcd664644c9d2b8bbfe3ac82d60ae2b.png"></div><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sortez la poubelle </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√âtant donn√© que le nettoyage n'est pas instantan√©, la quantit√© totale de RAM que vous utilisez est g√©n√©ralement sup√©rieure √† ce dont vous avez vraiment besoin. Mais si vous </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d√©passez la</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> quantit√© totale de RAM syst√®me, deux choses peuvent se produire - sur un PC, vous utilisez probablement simplement </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">un fichier d'√©change</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , c'est-√†-dire convertissez temporairement une partie de l'espace du disque dur en RAM virtuelle. Une alternative dans les environnements √† m√©moire limit√©e (comme les consoles) consiste √† planter l'application, m√™me s'il n'y avait pas assez d'une paire mis√©rable d'octets. Et cela se produira m√™me si vous n'utilisez pas ces octets et le ramasse-miettes y sera bient√¥t effectu√©!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La bonne chose √† propos de Haxe est qu'il est compl√®tement open source, c'est-√†-dire que vous n'√™tes pas enferm√© dans une bo√Æte noire que vous ne pouvez pas r√©parer, comme c'est le cas avec Unity. </font><font style="vertical-align: inherit;">Et le backend hxcpp fournit une gestion √©tendue de la r√©cup√©ration de place directement √† partir de l'API! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous les avons utilis√©s pour effacer instantan√©ment la m√©moire apr√®s un grand niveau afin de rester dans les limites donn√©es: </font></font><br><br> <code>cpp.vm.Gc.run(false); //   (true/false - /  )</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vous ne devriez pas l'utiliser involontairement si vous ne savez pas ce que vous faites, mais il est pratique que de tels outils existent quand ils sont n√©cessaires.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 7. Solution de contournement par la conception </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Toutes ces am√©liorations de performances √©taient plus que suffisantes pour optimiser le jeu pour le PC, mais nous avons √©galement essay√© de publier une version pour PSVita, et nous avions des plans √† long terme pour la Nintendo Switch, nous avons donc d√ª tout presser, du code √† la baisse. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais il y a souvent une ¬´vision tunnel¬ª lorsque vous vous concentrez uniquement sur les hacks techniques et oubliez qu'un simple changement de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">conception</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> peut am√©liorer consid√©rablement la situation </font><font style="vertical-align: inherit;">.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Acc√©l√©rer les effets √† grande vitesse </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√Ä 16x, de nombreux effets se produisent si rapidement que le joueur ne les voit m√™me pas. Nous avons d√©j√† utilis√© une astuce: la foudre d'Azra est devenue plus facile avec la vitesse du jeu et le nombre de particules pour les attaques AOE est plus faible. Nous avons compl√©t√© cette technique en d√©sactivant les nombres de dommages √† grande vitesse et d'autres astuces similaires. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons √©galement r√©alis√© qu'√† un moment donn√©, la vitesse de 16x peut en fait √™tre </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plus lente</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> que la vitesse de 8x lorsqu'il y a trop d'objets sur l'√©cran, donc lorsque le nombre d'ennemis augmente jusqu'√† une certaine limite, nous r√©duisons automatiquement la vitesse de jeu √† 8x ou 4x. En pratique, le joueur ne verra probablement cela que dans Endless Battle 2. Cela permet des performances et un rendu fluides sans surcharger le CPU.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous avons √©galement utilis√© des restrictions sp√©cifiquement pour la plate-forme. </font><font style="vertical-align: inherit;">Sur Vita, nous ignorons l'effet de la foudre lorsque Azra d√©clenche ou acc√©l√®re le personnage, et utilisons d'autres astuces similaires.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Masquer le corps </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Et qu'en est-il de l'√©norme tas d'ennemis dans le coin inf√©rieur droit d'Endless Battle 2 - il y a litt√©ralement des centaines, voire des </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">milliers d'</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ennemis tirant l'un sur l'autre. </font><font style="vertical-align: inherit;">Pourquoi ne sautons-nous pas simplement le rendu de ceux que nous ne pouvons m√™me pas voir? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il s'agit d'une astuce de conception astucieuse qui n√©cessite une programmation astucieuse, car nous avons besoin d'un algorithme intelligent qui d√©finit les objets cach√©s. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">La plupart de ces jeux sont dessin√©s en utilisant </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l'algorithme de l'artiste</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - les objets pr√©c√©dents dans la liste de dessins sont bloqu√©s par tout ce qui vient apr√®s eux.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En inversant l'ordre de rendu de l'algorithme de l'artiste, vous pouvez g√©n√©rer une ¬´carte de couverture¬ª et d√©couvrir ce qui doit √™tre cach√©. J'ai cr√©√© une fausse ¬´toile¬ª avec 8 niveaux d '¬´obscurit√©¬ª (juste un tableau d'octets en deux dimensions) avec une r√©solution beaucoup plus faible qu'un vrai champ de bataille. √Ä partir de la </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fin de</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> la liste de rendu, nous prenons le cadre de d√©limitation de chaque objet et le ¬´dessinons¬ª sur la toile, en augmentant ¬´l'obscurit√©¬ª du point de 1 pour chaque ¬´pixel¬ª couvert par le cadre de d√©limitation basse r√©solution. En m√™me temps, nous lisons ¬´l'obscurit√©¬ª moyenne de la zone dans laquelle nous allons dessiner. En fait, nous pr√©disons le nombre de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">redessins que</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> chaque objet subira avec un v√©ritable appel de dessin.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si le nombre pr√©vu de retraits est suffisamment √©lev√©, je marque l'ennemi comme ¬´enterr√©¬ª, avec deux seuils - compl√®tement enterr√©, c'est-√†-dire compl√®tement invisible ou partiellement enterr√©, c'est-√†-dire qu'il sera dessin√©, mais sans afficher de barre de sant√©. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Au fait, voici la </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fonction de</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> v√©rification des redessins.) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour que cela fonctionne correctement, vous devez configurer correctement la r√©solution de la carte de masquage. </font><font style="vertical-align: inherit;">S'il est trop grand, nous devrons effectuer un groupe suppl√©mentaire d'appels de dessin simplifi√©s, s'il est trop petit, nous cacherons les objets de mani√®re trop agressive et obtiendrons des bogues visuels. </font><font style="vertical-align: inherit;">Si vous s√©lectionnez correctement la carte, l'effet est √† peine perceptible, mais l'augmentation de la vitesse est tr√®s perceptible - il n'y a aucun moyen de dessiner quelque chose plus rapidement que de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne pas le dessiner du tout</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ! </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Meilleure pr√©charge que les freins </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Au milieu des combats, j'ai remarqu√© des freinages fr√©quents qui, j'en √©tais s√ªr, √©taient dus √† une pause dans la collecte des ordures. </font><font style="vertical-align: inherit;">Cependant, le profilage a montr√© que ce n'est pas le cas. </font><font style="vertical-align: inherit;">Des tests suppl√©mentaires ont r√©v√©l√© que cela se produit au d√©but de la vague d'apparition d'ennemis, et plus tard, j'ai d√©couvert que cela ne se produit que lorsque c'est une vague d'ennemis qui </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n'existait pas auparavant.</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">De toute √©vidence, un code de configuration ennemi a caus√© le probl√®me, et bien s√ªr, lors du profilage, une fonction ¬´chaude¬ª a √©t√© trouv√©e dans les param√®tres graphiques. </font><font style="vertical-align: inherit;">J'ai commenc√© √† travailler sur une configuration de t√©l√©chargement multi-thread complexe, mais j'ai r√©alis√© que je pouvais simplement mettre toutes les proc√©dures de chargement de graphiques ennemis dans la pr√©charge de bataille. </font><font style="vertical-align: inherit;">S√©par√©ment, il s'agissait de tr√®s petits t√©l√©chargements, m√™me sur les plates-formes les plus lentes, ajoutant moins d'une seconde au temps total de chargement de la bataille, mais ils ont √©vit√© un freinage tr√®s notable pendant le gameplay.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Nous r√©servons du stock pour plus tard </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Si vous travaillez dans un environnement avec une m√©moire limit√©e, vous pouvez utiliser l'ancienne astuce de notre industrie - allouer une grande m√©moire comme √ßa, puis l'oublier jusqu'√† la fin du projet. A la fin du projet, apr√®s avoir gaspill√© tout le budget m√©moire disponible, vous pouvez √™tre sauv√© gr√¢ce √† ce ¬´nest egg¬ª. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nous nous sommes retrouv√©s dans une telle situation - nous n'avions besoin que d'une douzaine d'octets pour enregistrer l'assemblage pour PSVita, mais bon sang - nous avons oubli√© cette astuce et nous sommes donc rest√©s coinc√©s! Les seules options restantes √©taient des semaines de chirurgie d√©sesp√©r√©e et douloureuse du code! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mais attendez un instant! L'une de mes optimisations (infructueuses) a √©t√© de charger autant de ressources que possible et </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">perp√©tuelles</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">les stocker en m√©moire, car j'ai suppos√© √† tort qu'un temps de chargement important √©tait d√ª √† la lecture des ressources lors de l'ex√©cution du programme. </font><font style="vertical-align: inherit;">Il s'est av√©r√© que ce n'√©tait pas le cas, donc presque tous ces appels suppl√©mentaires pour le pr√©chargement et le stockage √©ternel pouvaient √™tre compl√®tement supprim√©s, et j'avais encore de la m√©moire libre!</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Se d√©barrasser des choses que nous n'utilisons pas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En travaillant sur la construction de PSVita, nous avons √©t√© particuli√®rement clairs sur le fait qu'il y a un tas de choses dont nous n'avons tout simplement pas besoin. En raison de la faible r√©solution, le mode graphique source et le mode graphique HD √©taient indiscernables, donc pour tous les sprites, nous avons utilis√© les graphiques originaux. Nous avons √©galement r√©ussi √† am√©liorer la fonction de remplacement de la palette √† l'aide d'un pixel shader sp√©cial (auparavant, nous utilisions la fonction de rendu de programme). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un autre exemple √©tait la carte de bataille elle-m√™me - sur le PC et les consoles de salon, nous avons empil√© un tas de cartes de tuiles les unes sur les autres pour cr√©er une carte multicouche. Mais comme la carte ne change jamais, sur Vita, nous pouvions simplement tout faire en une seule image finie pour qu'elle soit appel√©e en un seul tirage.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En plus des ressources suppl√©mentaires, le jeu a eu de nombreux appels suppl√©mentaires, par exemple, les d√©fenseurs et les ennemis envoyant un signal de r√©g√©n√©ration dans chaque image, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m√™me lorsqu'ils n'ont pas la capacit√© de se r√©g√©n√©rer</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Si l'interface utilisateur √©tait ouverte pour une telle cr√©ature, elle a √©t√© redessin√©e dans </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chaque cadre</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Il existe une demi-douzaine d'autres exemples de petits algorithmes qui calculent quelque chose √† l'int√©rieur d'une fonction ¬´chaude¬ª, mais ne retournent jamais de r√©sultats nulle part. </font><font style="vertical-align: inherit;">Habituellement, ce sont les r√©sultats de la cr√©ation de la structure aux premiers stades de d√©veloppement, nous les supprimons donc.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> NaNopocalypse </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cette affaire √©tait dr√¥le. </font><font style="vertical-align: inherit;">Le profileur a indiqu√© qu'il fallait beaucoup de temps pour calculer les angles. </font><font style="vertical-align: inherit;">Voici le code Haxe C ++ g√©n√©r√© dans le profileur:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f4/387/7d5/4f43877d538fc9c44c34e5bfaa72bd45.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C'est l'une de ces fonctions qui prennent des valeurs comme </font></font><code>-90</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">et se convertissent en </font></font><code>270</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Parfois, vous obtenez des valeurs comme </font></font><code>-724</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui en quelques cycles sont r√©duites √† </font></font><code>4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pour une raison quelconque, une valeur a √©t√© transmise √† cette fonction </font></font><code>-2147483648</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7d8/6bc/9c8/7d86bc9c84d9e75a345b898ff44940a1.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Faisons les calculs. Si, dans chaque cycle, nous ajoutons 360 √† -2147483648, il faudra alors environ 5 965 233 it√©rations jusqu'√† ce qu'il devienne sup√©rieur √† 0 et termine le cycle. Soit dit en passant, ce cycle a √©t√© effectu√© √† chaque mise √† jour (pas dans chaque </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">image</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - dans chaque </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mise √† jour</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> !) - chaque fois que le projectile (ou autre chose) changeait son angle. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bien s√ªr, c'√©tait de ma faute, car j'ai transmis la valeur </font></font><code>NaN</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- une signification sp√©ciale pour ¬´Pas un nombre¬ª (pas un nombre), qui signale g√©n√©ralement une erreur qui s'est d√©j√† produite dans le code. Si vous l'amenez √† un entier sans v√©rification pr√©alable, alors de telles choses √©tranges se produisent. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Comme correctif temporaire, j'ai ajout√© un ch√®que</font></font><code>Math.isNan()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, qui r√©initialise l'angle lorsqu'un tel √©v√©nement (plut√¥t rare, mais in√©vitable) se produit. </font><font style="vertical-align: inherit;">Dans le m√™me temps, j'ai continu√© √† rechercher la cause premi√®re de l'erreur, je l'ai trouv√©e et le retard a imm√©diatement disparu. </font><font style="vertical-align: inherit;">Il s'av√®re que si vous n'effectuez pas 6 millions d'it√©rations inutiles, vous pouvez obtenir une grande augmentation de vitesse! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Un correctif pour cette erreur a √©t√© </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ins√©r√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dans HaxeFlixel lui-m√™me).</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ne te surpasse pas </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenFL et HaxeFlixel sont bas√©s sur la mise en cache des ressources. </font><font style="vertical-align: inherit;">Cela signifie que lorsque nous chargeons une ressource, la prochaine fois qu'elle sera re√ßue, elle sera extraite du cache et non recharg√©e √† partir du disque. </font><font style="vertical-align: inherit;">Ce comportement peut √™tre ignor√© et parfois il a du sens. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cependant, je suis entr√© dans des choses √©tranges et farfelues: j'ai t√©l√©charg√© la ressource, j'ai explicitement dit au syst√®me de </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ne pas mettre en</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cache les r√©sultats, parce que j'√©tais compl√®tement s√ªr de ce que je faisais et ne voulais pas ¬´gaspiller de la m√©moire¬ª sur le cache. </font><font style="vertical-align: inherit;">Des ann√©es plus tard, ces appels ¬´intelligents¬ª m'ont fait charger la m√™me ressource encore et encore, ralentissant le jeu et gaspillant une m√©moire pr√©cieuse, que j'ai ¬´sauv√©e¬ª en abandonnant le cache.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 8. De plus, cela peut ne pas valoir la peine de faire des niveaux comme Endless Battle 2 </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oui, c'est g√©nial d'avoir mis en place toutes ces petites astuces pour augmenter la vitesse. Honn√™tement, nous n'avons pas remarqu√© la plupart d'entre eux jusqu'√† ce que nous commencions √† porter le jeu sur des syst√®mes moins puissants, quand √† certains niveaux les probl√®mes sont devenus compl√®tement intol√©rables. Je suis heureux qu'au final nous ayons r√©ussi √† augmenter la vitesse, mais je pense que la conception du niveau pathologique devrait √©galement √™tre √©vit√©e. Endless Battle 2 a mis trop de pression sur le syst√®me, en particulier par rapport √† </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tous les autres niveaux du jeu</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√™me apr√®s tous ces changements, la version PSVita ne peut toujours pas faire face √† la conception originale d'Endless 2, et je ne voulais pas risquer la vitesse sur les mod√®les de base XB1 et PS4, j'ai donc chang√© l'√©quilibre pour les versions console d'Endless 2. J'ai r√©duit le nombre d'ennemis, mais augment√© leurs caract√©ristiques pour que le niveau ait √† peu pr√®s la m√™me difficult√©. De plus, sur PSVita, nous avons limit√© le nombre d'ondes √† cent pour √©viter le risque de panne de m√©moire, mais nous n'avons pas ajout√© de restrictions sur la PS4 et la XB1. Gr√¢ce √† cela, la r√©alisation de l'endurance est toujours aussi difficile sur toutes les consoles. Dans la version PC, la conception du niveau Endless Batlte 2 est rest√©e inchang√©e.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tout cela a √©t√© une le√ßon pour nous, dont nous tiendrons compte lors de la cr√©ation de Defender's Quest II - nous serons tr√®s attentifs aux niveaux sans limite sup√©rieure du nombre d'ennemis √† l'√©cran! </font><font style="vertical-align: inherit;">Bien s√ªr, les missions ¬´sans fin¬ª sont tr√®s attrayantes pour les fans de Tower Defense, donc je ne m'en d√©barrasserai pas compl√®tement, mais qu'en est-il des niveaux avec des points de contr√¥le auxquels le joueur DOIT tout d√©truire √† l'√©cran avant de passer aux vagues suivantes? </font><font style="vertical-align: inherit;">Cela nous permettra non seulement de limiter le nombre d'ennemis √† l'√©cran, mais aussi de r√©aliser des √©conomies au milieu du niveau sans se soucier de s√©rialiser l'√©tat de la soupe folle d'objets dans une bataille intense - il nous suffira de simplement enregistrer les coordonn√©es des d√©fenseurs, augmenter les niveaux, etc.</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 9. R√©flexions en conclusion </font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Les performances de jeu sont un sujet complexe, car les joueurs ne comprennent souvent pas ce que c'est, et nous ne devrions pas nous attendre √† une telle compr√©hension de leur part. Mais j'esp√®re que cet article vous a clarifi√© un peu comment tout se passe √† l'int√©rieur, et vous en avez appris plus sur la fa√ßon dont la conception, les compromis techniques et les d√©cisions simplement stupides ralentissent les jeux. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">L'essentiel est que m√™me dans un jeu avec un bon design d√©velopp√© par une √©quipe talentueuse, de tels petits fragments de code "rouill√©s" peuvent √™tre trouv√©s absolument </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">partout</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Mais en pratique, seule une petite fraction d'entre eux affecte r√©ellement les performances. La capacit√© de les d√©tecter et de les √©liminer est √† la fois un art et une science.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Je suis heureux que nous profitions de tous ces avantages dans le d√©veloppement de Defender's Quest II. </font><font style="vertical-align: inherit;">Honn√™tement, si nous n'avions pas fait de portage pour PSVita, je n'aurais probablement m√™me pas essay√© la moiti√© de ces optimisations. </font><font style="vertical-align: inherit;">Et m√™me si vous n'achetez pas le jeu pour PSVita, vous pouvez remercier cette petite console, qui a consid√©rablement am√©lior√© la vitesse de Defender's Quest.</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr414135/">https://habr.com/ru/post/fr414135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr414125/index.html">Comment nous avons test√© VMware vSAN ‚Ñ¢: pourquoi cela fonctionne dans la pratique</a></li>
<li><a href="../fr414127/index.html">Installez 3CX sur un h√©bergement pour 2,99 euros / mois. en 10 minutes</a></li>
<li><a href="../fr414129/index.html">Master en informatique th√©orique √† l'Universit√© d'√âtat de Saint-P√©tersbourg</a></li>
<li><a href="../fr414131/index.html">L'effet de la fr√©quence du signal sur l'√©nergie des liaisons radio dans l'espace libre</a></li>
<li><a href="../fr414133/index.html">Conception de jeux de puzzle avec l'exemple de In The Shadows</a></li>
<li><a href="../fr414137/index.html">Exp√©rience de d√©veloppement de SPA sur VueJS + Nuxt</a></li>
<li><a href="../fr414139/index.html">Sortie du proxy MTProto non officiel en Python, fonctionnalit√©s du protocole</a></li>
<li><a href="../fr414141/index.html">7 r√®gles pour concevoir des cartes de circuits imprim√©s</a></li>
<li><a href="../fr414149/index.html">Les raisons du mauvais son de la plupart des smartphones Android</a></li>
<li><a href="../fr414151/index.html">Fintech-Digest: les banques signaleront les dommages caus√©s par les attaques de pirates informatiques, Western Union refuse de travailler avec les crypto-monnaies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>