<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🏫 👍🏽 🧑🏽‍🤝‍🧑🏻 Embox pada prosesor Elbrus. Atau jangan pernah melupakan kecerdasan Anda ▶️ 🚴🏻 🐕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah kesimpulan logis untuk serangkaian artikel "mendaki Elbrus" tentang memperkenalkan arsitektur prosesor Embox ke Elbrus (E2K) . Meng...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Embox pada prosesor Elbrus. Atau jangan pernah melupakan kecerdasan Anda</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/embox/blog/485694/"><img src="https://habrastorage.org/webt/ic/4z/5o/ic4z5olelesc04boln85goculk4.png" align="right" width="320">  Artikel ini adalah kesimpulan logis untuk <a href="https://habr.com/ru/company/embox/blog/447704/">serangkaian artikel</a> <a href="https://habr.com/ru/company/embox/blog/421441/">"mendaki Elbrus"</a> tentang memperkenalkan <a href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BB%25D1%258C%25D0%25B1%25D1%2580%25D1%2583%25D1%2581_2000">arsitektur prosesor</a> <a href="http://embox.github.io/">Embox</a> ke <a href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BB%25D1%258C%25D0%25B1%25D1%2580%25D1%2583%25D1%2581_2000">Elbrus (E2K)</a> .  Mengapa kesimpulan logis, karena sebagai hasilnya, dimungkinkan untuk menjalankan melalui telnet aplikasi yang menampilkan gambar di layar, yaitu, untuk mencapai kerja penuh Embox pada arsitektur ini.  Penelitian lebih lanjut hampir tidak bisa disebut pengantar, meskipun tentu saja, masih banyak yang tidak jelas.  Dan arsitekturnya sendiri memiliki banyak fitur menarik, yang saat ini juga belum dipahami.  Pada artikel ini, kita akan berbicara tentang mengatur memori virtual, mari kita menyentuh PCI, berbicara sedikit tentang kartu jaringan dan menyentuh kartu video pada perangkat keras tertentu yang kita miliki. <a name="habracut"></a><br><br>  Bagi yang terlalu malas membaca artikel, saya akan langsung memberikan video pendek dengan hasilnya. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/FqOSFJ36B48" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Dan sekarang bagi mereka yang tertarik, kami akan mengungkapkan detail teknis yang kami dapat mengerti dalam proses. <br><br><h3>  Memori virtual </h3><br><h4>  Kesalahan tumpukan kami </h4><br>  Mari kita mulai dengan memori virtual.  Sebenarnya, inilah yang kami selesaikan di <a href="https://habr.com/ru/company/embox/blog/447744/">artikel</a> sebelumnya <a href="https://habr.com/ru/company/embox/blog/447744/">dalam</a> seri.  Perlu segera diingat mengapa kami membutuhkan memori virtual, karena Embox dapat bekerja tanpanya.  Sederhana: masalahnya adalah caching.  Vidyaha bekerja, tetapi saya harus merekam hal yang sama dua kali dalam memori video untuk pengambilan gambar yang andal.  Tentu saja, itu mungkin untuk menangani cache, tetapi contoh kami melibatkan penggunaan memori video langsung dari aplikasi pengguna, tanpa hal-hal nuklir seperti manajemen cache, jadi itu benar untuk belajar bagaimana memetakan memori sebagai non-cacheable.  Hal yang sama dapat dilakukan di Linux dengan memetakan fb ( <a href="http://dmilvdv.narod.ru/Translate/ELSDD/elsdd_sample_frame_buffer_example.html">contoh</a> ). <br><br>  Perlu dicatat bahwa meskipun kami tidak menulis tentang Elbrus untuk waktu yang lama dan mungkin terlihat bahwa MMU dalam arsitektur ini adalah jenis yang sangat rumit, tetapi masalahnya berbeda.  Bahkan, kami menambahkan dukungan di musim panas, kami sama sekali tidak mencapai tangan kami untuk menulis tentang hal itu.  Waktu yang lama (beberapa bulan) dihabiskan karena kesalahan bodoh kami.  Kesalahan ini bahkan dibuat dalam judul artikel ("Atau tidak pernah melupakan apa yang Anda dapatkan selama intelijen").  Kita berbicara tentang tumpukan dengan mana kita berurusan dengan cukup baik dan menggambarkan ini dalam artikel Climbing <a href="https://habr.com/ru/company/embox/blog/447704/">Elbrus - Reconnaissance.</a>  <a href="https://habr.com/ru/company/embox/blog/447704/">Bagian Teknis 1. Register, tumpukan dan detail teknis lainnya</a> . <a href="https://habr.com/ru/company/embox/blog/447704/">"</a>  Kami menderita untuk waktu yang sangat lama, dengan bodohnya kehilangan fakta bahwa kami mengambil tumpukan awal (di mana sistem diinisialisasi) dari suatu tempat di luar, dan memetakan semuanya.  apa yang kami butuhkan agar Embox berfungsi, kami tidak memetakan data ini. <br><br>  Di bawah kucing, saya akan memberikan fungsi baru e2k_entry, yang dijelaskan dalam artikel kedua di <a href="https://habr.com/ru/company/embox/blog/447744/">artikel dalam seri</a> . <br><br>  Jika diinginkan, Anda dapat membandingkan. <br><br><pre><code class="cpp hljs">__attribute__ ((__section__(<span class="hljs-string"><span class="hljs-string">".e2k_entry"</span></span>))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e2k_entry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct pt_regs *regs)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* Since we enable exceptions only when all CPUs except the main one * reached the idle state (cpu_idle), we can rely that order and can * guarantee exceptions happen strictly after all CPUS entries. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entries_count &gt;= CPU_COUNT) { <span class="hljs-comment"><span class="hljs-comment">/* Entering here because of exception or interrupt */</span></span> e2k_trap_handler(regs); RESTORE_COMMON_REGS(regs); E2K_DONE; } <span class="hljs-comment"><span class="hljs-comment">/* It wasn't exception, so we decide this usual program execution, * that is, Embox started on CPU0 or CPU1 */</span></span> e2k_wait_all(); entries_count = __e2k_atomic32_add(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;entries_count); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (entries_count &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* XXX currently we support only single core */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Run cpu_idle on 2nd CPU */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* it's just needed if log_debug enabled in e2k_context module * else output will be wrong because 2 cpu printing at the same time */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!sync_count); context_init(&amp;cpu_ctx[<span class="hljs-number"><span class="hljs-number">0</span></span>], CONTEXT_PRIVELEGED | CONTEXT_IRQDISABLE, cpu_idle, idle_stack, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(idle_stack)); context_switch(&amp;cpu_ctx_prev[<span class="hljs-number"><span class="hljs-number">0</span></span>], &amp;cpu_ctx[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-comment"><span class="hljs-comment">/* Run e2k_kernel_start on 1st CPU */</span></span> context_init(&amp;cpu_ctx[<span class="hljs-number"><span class="hljs-number">1</span></span>], CONTEXT_PRIVELEGED | CONTEXT_IRQDISABLE, e2k_kernel_start, &amp;_stack_top, KERNEL_STACK_SZ); sync_count = __e2k_atomic32_add(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;sync_count); context_switch(&amp;cpu_ctx_prev[<span class="hljs-number"><span class="hljs-number">1</span></span>], &amp;cpu_ctx[<span class="hljs-number"><span class="hljs-number">1</span></span>]); }</code> </pre> <br>  Saya hanya akan menjelaskan bahwa sekarang kita menggunakan fungsi context_init () dan context_switch () hanya untuk mengalihkan stack ke memori di ruang Embox.  Dan kami melakukan ini untuk semua core, termasuk yang tidak digunakan. <br><br><h3>  Organisasi MMU </h3><br>  Sekarang saya akan berbicara sedikit tentang organisasi MMU dalam arsitektur E2k. <br><br>  Secara umum, arsitektur MMU cukup biasa dan memiliki tabel empat tingkat (atau tiga saat menggunakan halaman 4MB). <br><br>  Ada beberapa register layanan dalam arsitektur E2k, mereka diakses menggunakan perintah akses ke ruang alternatif, serta ke ruang I / O yang dijelaskan secara singkat dalam artikel <a href="https://habr.com/ru/company/embox/blog/421441/">"Embox mulai mendaki Elbrus"</a> . <br><br>  Kami akan membutuhkan register tersebut: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MMU_REG_CR 0x00 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Control register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MMU_REG_CONT 0x10 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Context register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MMU_REG_CR3_RG 0x20 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* CR3 register for INTEL only */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MMU_REG_ELB_PTB 0x30 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* ELBRUS page table virtual base */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MMU_REG_ROOT_PTB 0x40 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Root Page Table Base register */</span></span></span><span class="hljs-meta">/</span></span></code> </pre> <br>  Sebenarnya, ini adalah register kontrol, register nomor konteks, daftar root tabel, dan MMU_REG_ELB_PTB sedikit tidak jelas.  Mari kita mulai dengan itu, register ini harus diatur ke beberapa nilai, 512GB berikutnya akan digunakan oleh prosesor untuk kebutuhan peralatan, dan alamat ini tidak akan tersedia untuk programmer.  Saya akan memberikan penjelasan dari surat spesialis ICST, saya hampir tidak bisa menjelaskan lebih baik: <br><br><blockquote>  Di Linux, kami mengatur MMU_ELB_PTB ke 0xff1 &lt;&lt; 39, lalu <br>  memori virtual bagian atas (0xff8000000000 - 0xffffffffffff) <br>  dicadangkan untuk kebutuhan peralatan, yaitu, TLB.  Setiap halaman <br>  tabel halaman (TS) mendapatkan alamat uniknya di area ini, <br>  selain itu, alamat-alamat ini mudah diperoleh dari alamat di mana program tersebut <br>  menarik ke memori.  Dan sejak itu  TLB menyimpan pemetaan alamat virtual <br>  fisik, ini memungkinkan Anda untuk cache di buffer TLB yang sama <br>  siaran tidak hanya untuk alamat pengguna, tetapi juga untuk kendaraan itu sendiri. <br><br>  Dalam prosesor / arsitektur di mana TLB terpisah dibuat untuk berbeda <br>  tingkat tabel halaman, trik seperti itu menjadi tidak perlu. <br><br>  Jadi, ketika Anda melewatkan TLB, menjadi mungkin untuk tidak memulai pencarian <br>  dari level nol (pgd *), dan segera periksa level terakhir kendaraan (pte *). <br>  Tidak ada persyaratan perangkat keras untuk memetakan area ini sendiri, Wirth.  alamat dari <br>  itu diperlukan hanya sebagai indeks untuk pencarian TLB.  Namun, pada intinya <br>  pgd terakhir di level nol dari tabel halaman ditulis nat.  alamat ini <br>  tingkat paling nol.  Akibatnya, hanya <br>  4 KB terakhir dari area ff80'0000'0000 - ffff'ffff'ffff - i.e.  tepat <br>  tingkat kendaraan nol.  Ini memungkinkan pgd * diakses secara biasa <br>  baca / tulis instruksi yang bekerja di alamat virtual. </blockquote><br>  Alhasil, diputuskan untuk sekadar memasukkan nilai yang besar di register ini, yang tidak akan mengganggu kami.  Bagaimanapun, solusi yang diusulkan memungkinkan kami untuk mengoptimalkan pencarian halaman, tetapi kami belum terlibat dalam optimasi.  Disampaikan sama seperti di Linux. <br><br>  Sekarang register kontrol.  Anda perlu mengaktifkan MMU melalui itu.  Bit yang dikenal terlihat seperti ini: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_TLB_EN 0x0000000000000001 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* translation enable */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_CD_MASK 0x0000000000000006 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* cache disable bits */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_SET1 0x0000000000000008 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* set #1 enable for 4 MB pages */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_SET2 0x0000000000000010 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* set #2 enable for 4 MB pages */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_SET3 0x0000000000000020 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* set #3 enable for 4 MB pages */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* paging enable for second space INTEL */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_CR0_PG 0x0000000000000040 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* page size 4Mb enable for second space INTEL */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_CR4_PSE 0x0000000000000080 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* cache disable for secondary space INTEL */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_CR0_CD 0x0000000000000100 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* TLU enable for secondary space INTEL */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_TLU2_EN 0x0000000000000200 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* memory protection table enable for LD from secondary space INTEL */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_LD_MPT 0x0000000000000400 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_IPD_MASK 0x0000000000000800 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Instruction Prefetch Depth */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _MMU_CR_UPT_EN 0x0000000000001000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* enable UPT */</span></span></span></span></code> </pre> <br>  Kami tertarik pada bit pertama, yang mencakup terjemahan alamat. <br><br>  Kami juga menetapkan _MMU_CR_SET3, tetapi kami belum menemukan kasus tertentu yang harus dilakukan. <br><br>  Daftar Kontes  Nah, jika sederhana, maka ini adalah PID dari proses atau ruang alamat.  Lebih teknis, ini adalah ekstensi alamat 11-bit.  Dalam kasus kami, kami membuat semua halaman menjadi nuklir, dengan menetapkan sedikit globalitas di semua halaman kami, kami menggunakan ruang alamat yang sama dan oleh karena itu kami dapat menggunakan nol dalam register ini. <br><br>  Dalam register tabel root adalah pointer ke alamat fisik dari awal tabel terjemahan.  Anda bisa saja melakukan penipuan dengan memetakan tabel juga ke alamat yang ditentukan dalam register MMU_REG_ELB_PTB, tetapi seperti yang saya katakan, kami tidak fokus pada optimasi. <br><br>  Apa lagi yang bisa saya katakan, struktur tabelnya cukup biasa, benderanya adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_P 0x0000000000000001ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Page Present bit */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_W 0x0000000000000002ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Writable (0 - only read) */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_UU2 0x0000000000000004ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* unused bit # 2 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_PWT 0x0000000000000008ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Write Through */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_CD1 0x0000000000000010ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Cache disable (right bit) */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_A 0x0000000000000020ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Accessed Page */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_D 0x0000000000000040ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Page Dirty */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_HUGE 0x0000000000000080ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Page Size */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_G 0x0000000000000100ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Global Page */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_CD2 0x0000000000000200ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Cache disable (left bit) */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_NWA 0x0000000000000400ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Prohibit address writing */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_AVAIL 0x0000000000000800ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Available page */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_PFN 0x000000fffffff000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Physical Page Number */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_VALID 0x0000010000000000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Valid Page */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_PV 0x0000020000000000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* PriVileged Page */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_INT_PR 0x0000040000000000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Integer address access Protection */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_NON_EX 0x0000080000000000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Non Executable Page */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_RES 0x0000f00000000000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Reserved bits */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E2K_MMU_PAGE_C_UNIT 0xffff000000000000ULL </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Compilation Unit */</span></span></span></span></code> </pre> <br>  Untuk tabel 4 tingkat, shift alamat adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __MMU_PGD_SHIFT (PAGE_SHIFT + 3 * (PAGE_SHIFT-3)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* 39 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __MMU_PUD_SHIFT (PAGE_SHIFT + 2 * (PAGE_SHIFT-3)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* 30 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> __MMU_PMD_SHIFT (PAGE_SHIFT + 1 * (PAGE_SHIFT-3)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* 21 */</span></span></span></span></code> </pre><br><h3>  Sedikit tentang PCI </h3><br><h4>  Komunikasi melalui ruang alamat alternatif </h4><br>  Sebelum beralih ke vidyaha dan kartu jaringan, mari kita kembali ke PCI.  Kami sudah berbicara sedikit tentang ini di bagian pertama <a href="https://habr.com/ru/company/embox/blog/421441/">"Embox mulai mendaki Gunung Elbrus</a> . <a href="https://habr.com/ru/company/embox/blog/421441/">"</a>  Itu menunjukkan makro untuk berkomunikasi dengan ruang alamat alternatif: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_READ_MAS(addr, mas, type, size_letter, chan_letter) \ ({ \ register type res; \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ld"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%1] %2, %0"</span></span></span><span class="hljs-meta"> \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"=r"</span></span></span><span class="hljs-meta"> (res) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas)); \ res; \ }) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _E2K_WRITE_MAS(addr, val, mas, type, size_letter, chan_letter) \ ({ \ asm volatile (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"st"</span></span></span><span class="hljs-meta"> #size_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">","</span></span></span><span class="hljs-meta"> #chan_letter </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" \t0x0, [%0] %2, %1"</span></span></span><span class="hljs-meta"> \ : \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((__e2k_ptr_t) (addr)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"r"</span></span></span><span class="hljs-meta"> ((type) (val)), \ </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"i"</span></span></span><span class="hljs-meta"> (mas) \ : </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"memory"</span></span></span><span class="hljs-meta">); \ })</span></span></code> </pre> <br>  Dan ada referensi pada prinsip ruang alamat.  Ruang alamat yang berbeda didefinisikan menggunakan MAS (penentu alamat memori).  Dan misalnya, untuk mengakses IO, melalui mana PCI diakses, Anda harus menggunakan 6, dan untuk MMU 7. <br><br>  Tetapi dengan studi makro yang lebih menyeluruh, Anda dapat melihat beberapa jenis chan_letter.  Dan jika Anda melihat deskripsi perintah e2k, kami menemukan <br><blockquote>  LDD ddd membaca kata ganda <br>  ldd [address] mas, dst </blockquote><br>  Artinya, pada pandangan pertama, tidak ada saluran.  Tetapi jika Anda mengikuti tautan, ternyata kode untuk ldd operasi yang diberikan adalah 67. Namun 67 adalah kode untuk ldd hanya untuk saluran AL0 / AL3 dan AL2 / AL5, dan untuk saluran AL1 / AL4 kode ini sesuai dengan operasi POPCNTd. <br><br>  Jadi, tidak mungkin untuk sepenuhnya memahami saluran apa yang ada dalam terminologi Elbrus.  Saya berani menyarankan bahwa ini sudah terhubung dengan prinsip vliw, ketika Anda dapat menentukan alu mana yang digunakan, karena dalam jenis arsitektur ini salah satu fitur adalah kehadiran beberapa perangkat komputasi independen.  Saya bisa, tentu saja, salah, tetapi kenyataannya adalah bahwa untuk mengakses PCI atau MMU Anda perlu menggunakan saluran kedua atau kelima.  Dengan demikian, perintahnya akan terlihat seperti ini: <br><blockquote>  ldd, 2 0x0, [addr_in_mas] mas_id,% reg </blockquote><br><h4>  lspci </h4><br>  Sekarang saya akan memberikan hasil dari output perintah lspci pada perangkat yang kita miliki: <br><blockquote>  root @ embox: (null) #lspci <br>  00: 0,0 (PCI dev E3E3: ABCD) [6 4] <br>  Jembatan PCI-ke-PCI: (null) Jembatan Elbrus PCIe (rev 01) <br>  00: 1.0 (PCI dev 8086: E3E3) [6 4] <br>  Jembatan PCI-ke-PCI: Jembatan Intel Intel Elbrus Virt PCI (rev 01) <br>  01: 0.0 (PCI dev 1FFF: 8000) [6 4] <br>  Jembatan PCI-ke-PCI: (null) Jembatan PCI Elbrus (rev 05) <br>  01: 1.0 (PCI dev 8086: 4D45) [2 0] <br>  Pengontrol Ethernet: Intel Corporation MCST ETH1000 Gigabit Ethernet (rev 01) <br>  01: 2.0 (PCI dev 8086: 4D49) [1 1] <br>  Pengontrol IDE: Intel Corporation MCST IDE (rev 128) <br>  01: 2.1 (PCI dev 8086: 0002) [7 2] <br>  Comm sederhana.  controller: Intel Corporation (null) (rev 05) <br>  01: 2.2 (PCI dev 8086: 8000) [7 128] <br>  Comm sederhana.  controller: Intel Corporation Elbrus PCI bridge (rev 00) <br>  01: 2.3 (PCI dev 1013: 6005) [4 1] <br>  Perangkat multimedia: Cirrus Logic Crystal CS4281 PCI Audio (rev 01) <br>  01: 3.0 (PCI dev 8086: 4748) [1 6] <br>  Pengontrol penyimpanan massal: Intel Corporation MCST SATA (rev 00) <br>  01: 4.0 (PCI dev 8086: 554F) [12 3] <br>  Perangkat USB: Intel Corporation OHCI untuk Elbrus (rev 00) <br>  01: 4.1 (PCI dev 8086: 5545) [12 3] <br>  Perangkat USB: Intel Corporation EHCI untuk Elbrus (rev 00) <br>  02: 1.0 (PCI dev 126F: 0718) [3 0] <br>  Pengontrol yang kompatibel dengan VGA: Silicon Motion, Inc.  SM718 LynxSE + (rev 160) <br>  root @ embox: (null) # </blockquote><br>  Catatan <br><blockquote>  01: 2.2 (PCI dev 8086: 8000) [7 128] <br>  Comm sederhana.  controller: Intel Corporation Elbrus PCI bridge (rev 00) </blockquote><br>  Bahkan, itu adalah port serial dari MCST mirip dengan am85c30, setidaknya melalui perangkat ini kami berkomunikasi melalui minicom. <br><br><h3>  Kartu jaringan </h3><br><h4>  Struktur umum </h4><br>  Sekarang mari kita ke kartu jaringan. <br><br>  Jika saya mengerti dengan benar, maka ini adalah kartu jaringan asli, sedikit mirip dalam operasi dengan e1000, tetapi hanya dalam operasi (seperti keberadaan deskriptor dalam antrian terima dan kirim). <br><br>  Sekarang lebih lanjut tentang poin penting yang kami temui. <br><br>  Kartu Jaringan PCI VID: PID 0x8086: 0x4D45.  Jangan kaget bahwa VID sama dengan Intel, MCST sering menggunakan VID khusus ini, lihat setidaknya pada perangkat port serial yang disebutkan di atas. <br><br>  BAR0 berisi basis register.  Register adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_E_CSR 0x00 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Ethernet Control/Status Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_MGIO_CSR 0x04 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* MGIO Control/Status Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_MGIO_DATA 0x08 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* MGIO Data Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_E_BASE_ADDR 0x0c </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* EthernetBase Address Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_DMA_BASE_ADDR 0x10 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* DMA Base Address Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_PSF_CSR 0x14 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Pause Frame Control/Status Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_PSF_DATA 0x18 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Pause Frame Data Register */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> L_E1000_INT_DELAY 0x1c </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Interrupt Delay Register */</span></span></span></span></code> </pre> <br>  Tiga yang terakhir (L_E1000_PSF_CSR, L_E1000_PSF_DATA, L_E1000_INT_DELAY) tidak kami gunakan, jadi kami tidak akan membicarakannya.  Mari kita mulai dengan MGIO, semuanya sederhana: baca-tulis menggunakan protokol MII, yaitu komunikasi dengan chip PHY.  Secara khusus, kami memiliki chip DP83865. <br><br>  Prosedurnya tidak terlalu luar biasa, saya hanya akan daftar mereka. <br><br>  Membaca: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e1000_mii_readreg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct net_device *dev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> phy_id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reg_num)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l_e1000_priv</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ep</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">netdev_priv</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> rd; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> val_out = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; rd = <span class="hljs-number"><span class="hljs-number">0</span></span>; rd |= <span class="hljs-number"><span class="hljs-number">0x2</span></span> &lt;&lt; MGIO_CS_OFF; rd |= <span class="hljs-number"><span class="hljs-number">0x1</span></span> &lt;&lt; MGIO_ST_OF_F_OFF; rd |= <span class="hljs-number"><span class="hljs-number">0x2</span></span> &lt;&lt; MGIO_OP_CODE_OFF; <span class="hljs-comment"><span class="hljs-comment">/* Read */</span></span> rd |= (phy_id &amp; <span class="hljs-number"><span class="hljs-number">0x1f</span></span>) &lt;&lt; MGIO_PHY_AD_OFF; rd |= (reg_num &amp; <span class="hljs-number"><span class="hljs-number">0x1f</span></span>) &lt;&lt; MGIO_REG_AD_OFF; e1000_write_mgio_data(ep, rd); rd = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != <span class="hljs-number"><span class="hljs-number">1000</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e1000_read_mgio_csr(ep) &amp; MGIO_CSR_RRDY) { rd = (<span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span>)e1000_read_mgio_data(ep); val_out = rd &amp; <span class="hljs-number"><span class="hljs-number">0xffff</span></span>; log_debug(<span class="hljs-string"><span class="hljs-string">"reg 0x%x &gt;&gt;&gt; 0x%x"</span></span>, reg_num, val_out); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val_out; } usleep(<span class="hljs-number"><span class="hljs-number">100</span></span>); } log_error(<span class="hljs-string"><span class="hljs-string">"mdio_read: Unable to read from MGIO_DATA reg\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val_out; }</code> </pre> <br>  Rekam: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e1000_mii_writereg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct net_device *dev, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> phy_id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> reg_num, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l_e1000_priv</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ep</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">netdev_priv</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dev</span></span></span><span class="hljs-class">);</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> wr; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; wr = <span class="hljs-number"><span class="hljs-number">0</span></span>; wr |= <span class="hljs-number"><span class="hljs-number">0x2</span></span> &lt;&lt; MGIO_CS_OFF; wr |= <span class="hljs-number"><span class="hljs-number">0x1</span></span> &lt;&lt; MGIO_ST_OF_F_OFF; wr |= <span class="hljs-number"><span class="hljs-number">0x1</span></span> &lt;&lt; MGIO_OP_CODE_OFF; <span class="hljs-comment"><span class="hljs-comment">/* Write */</span></span> wr |= (phy_id &amp; <span class="hljs-number"><span class="hljs-number">0x1f</span></span>) &lt;&lt; MGIO_PHY_AD_OFF; wr |= (reg_num &amp; <span class="hljs-number"><span class="hljs-number">0x1f</span></span>) &lt;&lt; MGIO_REG_AD_OFF; wr |= val &amp; <span class="hljs-number"><span class="hljs-number">0xffff</span></span>; log_debug(<span class="hljs-string"><span class="hljs-string">"reg 0x%x &lt;&lt;&lt; 0x%x"</span></span>, reg_num, val); e1000_write_mgio_data(ep, wr); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i != <span class="hljs-number"><span class="hljs-number">1000</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e1000_read_mgio_csr(ep) &amp; MGIO_CSR_RRDY) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } usleep(<span class="hljs-number"><span class="hljs-number">100</span></span>); } log_error(<span class="hljs-string"><span class="hljs-string">"Unable to write MGIO_DATA reg: val = 0x%x"</span></span>, wr); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br>  Sekarang L_E1000_DMA_BASE_ADDR dan L_E1000_E_BASE_ADDR, sebenarnya mereka menggambarkan satu parameter, alamat blok deskripsi kartu jaringan.  Yaitu, alamat di Elbrus adalah 64-bit, dan registernya 32-bit. <br><br>  Sebenarnya kode: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">/* low 32 bits */</span></span> init_block_addr_part = (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)((<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>)ep-&gt;init_block &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>); e1000_write_e_base_addr(ep, init_block_addr_part); log_debug(<span class="hljs-string"><span class="hljs-string">"Init Block Low DMA addr: 0x%x"</span></span>, init_block_addr_part); <span class="hljs-comment"><span class="hljs-comment">/* high 32 bits */</span></span> init_block_addr_part = (<span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span>)(((<span class="hljs-keyword"><span class="hljs-keyword">uintptr_t</span></span>)(ep-&gt;init_block) &gt;&gt; <span class="hljs-number"><span class="hljs-number">32</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xffffffff</span></span>); e1000_write_dma_base_addr(ep, init_block_addr_part); log_debug(<span class="hljs-string"><span class="hljs-string">"Init Block High DMA addr: 0x%x"</span></span>, init_block_addr_part); <span class="hljs-comment"><span class="hljs-comment">/************************************************************************/</span></span></code> </pre><br>  Dari mana dapat dilihat bahwa L_E1000_DMA_BASE_ADDR adalah bagian atas, dan L_E1000_DMA_BASE_ADDR adalah bagian bawah dari alamat blok inisialisasi tertentu (sebenarnya blok deskripsi peta). <br><br>  Struktur deskripsi adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l_e1000_init_block</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> mode; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> paddr[<span class="hljs-number"><span class="hljs-number">6</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> laddrf; <span class="hljs-comment"><span class="hljs-comment">/* 31:4 = addr of rx desc ring (16 bytes align) + * 3:0 = number of descriptors (the power of two) * 0x09 is max value (desc number = 512 if [3:0] &gt;= 0x09) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> rdra; <span class="hljs-comment"><span class="hljs-comment">/* 31:4 = addr of tx desc ring (16 bytes align) + * 3:0 = number of descriptors (the power of two) * 0x09 is max value (desc number = 512 if [3:0] &gt;= 0x09) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> tdra; } __attribute__((packed));</code> </pre> <br>  C laddrf - tidak mengerti, untuk beberapa alasan itu dimasukkan ke nol, kami melakukan hal yang sama. <br><br>  paddr - seperti yang Anda duga, mac adalah alamat kartu jaringan. <br><br>  rdra dan tdra berisi alamat cincin deskriptor memori, 4 bit lebih rendah dialokasikan ke ukuran cincin, dan ini adalah logaritma ukuran.  Artinya, jika ada 8, maka jumlah deskriptor di atas ring adalah 2 ^ 8 (1 &lt;&lt; 8 == 256). <br><br>  mode adalah mode operasi kartu, bit adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DRX (1 &lt;&lt; 0) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Receiver disable */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DTX (1 &lt;&lt; 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Transmitter disable */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LOOP (1 &lt;&lt; 2) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* loopback */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DTCR (1 &lt;&lt; 3) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* disable transmit crc */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> COLL (1 &lt;&lt; 4) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* force collision */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DRTY (1 &lt;&lt; 5) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* disable retry */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> INTL (1 &lt;&lt; 6) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Internal loopback */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EMBA (1 &lt;&lt; 7) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* enable modified back-off algorithm */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EJMF (1 &lt;&lt; 8) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* enable jambo frame */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> EPSF (1 &lt;&lt; 9) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* enable pause frame */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> FULL (1 &lt;&lt; 10) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* full packet mode */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PROM (1 &lt;&lt; 15) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* promiscuous mode */</span></span></span></span></code> </pre> <br>  Artinya, ketika semuanya sudah dikonfigurasi, Anda perlu mengatur bit 10. Jika Anda ingin mode promiscuous, maka juga 15. <br><br><h4>  Deskriptor paket </h4><br>  Sekarang tentang format deskriptor paket. <br><br>  Di resepsi: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l_e1000_rx_desc</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> base; <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> buf_length; <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> status; <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> msg_length; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> reserved1; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> etmr; } __attribute__((packed));</code> </pre> <br>  base - mungkin mengerti bahwa ini adalah alamat buffer untuk paket <br>  buf_length - ukuran buffer <br>  msg_length - setelah menerima, berisi panjang paket yang diterima <br>  status - status deskriptor.  Ketika paket disiapkan dan diberikan ke DMA (kartu), Anda perlu mengatur bit 15 (RD_OWN).  Jika semuanya baik-baik saja, maka setelah menerima paket dalam deskriptor ini, bit ini akan direset dan 9 (RD_STP) dan 8 (RD_ENP) akan ditetapkan. <br><br>  Semua bit status adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* RX Descriptor status bits */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_OWN (1 &lt;&lt; 15) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_ERR (1 &lt;&lt; 14) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_FRAM (1 &lt;&lt; 13) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_OFLO (1 &lt;&lt; 12) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_CRC (1 &lt;&lt; 11) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_BUFF (1 &lt;&lt; 10) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_STP (1 &lt;&lt; 9) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_ENP (1 &lt;&lt; 8) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_PAM (1 &lt;&lt; 6) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_LAFM (1 &lt;&lt; 4) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RD_BAM (1 &lt;&lt; 3)</span></span></code> </pre> <br>  Saat transfer: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">l_e1000_tx_desc</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> base; <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> buf_length; <span class="hljs-keyword"><span class="hljs-keyword">int16_t</span></span> status; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> misc; <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> etmr; } __attribute__((packed));</code> </pre><br>  Hampir sama dengan menerima, bit status adalah sebagai berikut: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* TX Descriptor status bits */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_OWN (1 &lt;&lt; 15) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_ERR (1 &lt;&lt; 14) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_AFCS (1 &lt;&lt; 13) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_NOINTR (1 &lt;&lt; 13) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_MORE (1 &lt;&lt; 12) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_ONE (1 &lt;&lt; 11) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_DEF (1 &lt;&lt; 10) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_STP (1 &lt;&lt; 9) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> TD_ENP (1 &lt;&lt; 8)</span></span></code> </pre> <br>  Ketika sebuah paket dikirim, perlu untuk mengatur 15 (TD_OWN), 9 (TD_STP) dan 8 (TD_ENP) sesuai.  Bit 8 berarti bahwa ini adalah paket terakhir yang akan diproses, oleh karena itu, jika suatu paket dikirimkan, maka Anda hanya perlu menginstal yang terakhir. <br><br>  Saya juga lupa fitur penting, panjang buffer dalam deskriptor ditulis dengan tanda minus, mungkin dalam kode tambahan.  Bahkan dalam little-endian, tetapi karena Elbrus memiliki urutan byte yang sama, ini mungkin tidak penting. <br><br><h4>  Daftar manajemen </h4><br>  Sekarang kami jelaskan daftar L_E1000_E_CSR yang belum dirangkai terakhir: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* E_CSR register bits */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 31:21 unused, readed as 0 */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_ATME (1 &lt;&lt; 24) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW, Add Timer Enable */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_TMCE (1 &lt;&lt; 23) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW, Timer Clear Enable */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_DRIN (1 &lt;&lt; 22) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW, Disable RX Interrupt */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_DTIN (1 &lt;&lt; 21) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW, Disable TX Interrupt */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_ESLE (1 &lt;&lt; 20) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW, Enable Slave Error */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_SLVE (1 &lt;&lt; 19) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Slave Error */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_PSFI (1 &lt;&lt; 18) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Pause Frame Interrupt */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* 17 unused, read as 0 */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_SINT (1 &lt;&lt; 16) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* R, Status Interrupt */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_ERR (1 &lt;&lt; 15) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* R, Error */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_BABL (1 &lt;&lt; 14) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Babble */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_CERR (1 &lt;&lt; 13) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Collision Error */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_MISS (1 &lt;&lt; 12) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Missed Packet */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_MERR (1 &lt;&lt; 11) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Memory Error */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_RINT (1 &lt;&lt; 10) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Receiver Interrupt */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_TINT (1 &lt;&lt; 9) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Transmiter Interrupt */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_IDON (1 &lt;&lt; 8) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1c, Initialization Done */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_INTR (1 &lt;&lt; 7) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* R, Interrupt Flag */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_INEA (1 &lt;&lt; 6) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW, Interrupt Enable */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_RXON (1 &lt;&lt; 5) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* R, Receiver On */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_TXON (1 &lt;&lt; 4) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* R, Transmiter On */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_TDMD (1 &lt;&lt; 3) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1, Transmit Demand */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_STOP (1 &lt;&lt; 2) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1, Stop */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_STRT (1 &lt;&lt; 1) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1, Start */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> E_CSR_INIT (1 &lt;&lt; 0) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* RW1, Initialize */</span></span></span></span></code> </pre><br><h4>  Inisialisasi </h4><br>  Ada urutan inisialisasi yang agak tidak biasa: <br><blockquote>  STOP-&gt; INIT-&gt; IDON-&gt; STRT </blockquote><br>  Dalam hal ini, bit RXON &amp; TXON naik secara independen. <br>  Rincian lebih lanjut dapat ditemukan di driver kami. <br><br><h2>  Kartu video </h2><br>  Seperti yang telah disebutkan, perangkat kami menggunakan vidyah Silicon Motion yang disebut SM718 LynxSE +.  Oleh karena itu, semuanya sederhana, ada <a href="https://github.com/torvalds/linux/tree/master/drivers/staging/sm750fb">sumber driver di Linux</a> dan tidak ada yang bisa dijelaskan sebenarnya. <br><br>  Yah, kecuali bahwa video menunjukkan bahwa ternyata fps sangat rendah, rasanya seperti akses lambat ke memori.  Tapi ini tanpa optimasi kompiler, dan secara umum, mungkin ini adalah masalah kita yang terkait dengan penggunaan arsitektur e2k yang salah. <br><br><h3>  Nah, apa lagi yang harus dikatakan tentang <s>Sakhalin</s> Elbrus? </h3><br>  Pada prinsipnya, cuacanya normal :) <br><br>  Rupanya, Elbrus ada, bekerja.  Secara pribadi, saya melihat masalah utama pengembangan arsitektur yang menarik ini sebagai kedekatannya.  Sulit dipercaya bahwa perusahaan yang relatif kecil dapat membuat prosesor, kompiler, memberikan dukungan, dan yang lainnya.  Ya, pengembang perangkat lunak pihak ketiga mulai muncul, Basalt-SPO yang sama mendukung <a href="https://www.altlinux.org/%25D0%25AD%25D0%25BB%25D1%258C%25D0%25B1%25D1%2580%25D1%2583%25D1%2581">Alt-Linux, yang dapat diinstal pada Elbrus</a> . <br><br>  Ya, ada laporan bahwa pengembang pihak ketiga membuat perangkat keras berdasarkan prosesor Elbrus, misalnya <a href="https://m.vk.com/wall-71796881_858">Fastwel</a> .  Tetapi semua ini hanyalah kemajuan kecil menuju keterbukaan.  Contoh yang sangat sederhana, untuk mereproduksi apa yang telah kami katakan dan perlihatkan di sini, kami memerlukan kompiler, dan hanya <a href="http://www.mcst.ru/">MCST yang memilikinya</a> , informasi yang diberikan dalam artikel adalah tambahan untuk informasi yang diterima dari, sekali lagi, <a href="http://www.mcst.ru/">MCST</a> , dan saya masih belum mengatakan bahwa sepotong besi tidak mungkin ditemukan bahkan di MCST.  Cukup lama, dan <a href="http://www.mcst.ru/">ICST</a> menawarkan model yang lebih baru. <br><br>  PS Secara alami, Anda dapat melihat semua yang ada di <a href="https://github.com/embox/embox">repositori Embox</a> . <br><br>  PPS Datang ke saluran telegram Rusia melalui Embox ( <a href="https://t.me/embox_chat">https://t.me/embox_chat</a> ). <br><br>  PPS Embox telah memperbarui komponen kedua dalam versi, sekarang <a href="">0.4.0</a> saat ini </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id485694/">https://habr.com/ru/post/id485694/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id485664/index.html">Membuat parameter dinamis dalam pekerjaan Jenkins, atau cara membuat tugas Anda lebih mudah digunakan</a></li>
<li><a href="../id485672/index.html">Redis Praktik Terbaik, Bagian 1</a></li>
<li><a href="../id485682/index.html">Manajemen waktu tidak akan membantu: penundaan adalah masalah mengatur emosi, bukan waktu</a></li>
<li><a href="../id485688/index.html">Myapp memperpanjang liburan</a></li>
<li><a href="../id485692/index.html">Saran spesialis TI kepada pelanggan, atau cara mengotomatisasi kekacauan</a></li>
<li><a href="../id485702/index.html">Pertemuan FunCorp iOS # 2</a></li>
<li><a href="../id485704/index.html">Seni pixel untuk pemula: memperbaiki kesalahan umum</a></li>
<li><a href="../id485706/index.html">Kami mengundang Anda ke pertemuan "Transformasi Digital dan Peran Baru dalam Ilmu Data"</a></li>
<li><a href="../id485708/index.html">Blockchain Mengubah Cara Kerja Industri Rel</a></li>
<li><a href="../id485710/index.html">Solusi sederhana untuk pengujian regresi visual di Java + Selenium Webdriver + aShot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>