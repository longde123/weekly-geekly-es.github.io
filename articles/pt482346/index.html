<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úäüèª üö† üëã ASP.NET MVC - trabalhando com o MySQL atrav√©s do ADO.NET üçù ‚öñÔ∏è ü•¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tecnologia herdada  Aviso: o ASP.NET MVC est√° obsoleto e o ADO.NET tamb√©m. √â recomend√°vel usar o ASP.NET Core com ORM moderno. Mas se voc√™ estiver int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ASP.NET MVC - trabalhando com o MySQL atrav√©s do ADO.NET</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/482346/"><div class="spoiler">  <b class="spoiler_title">Tecnologia herdada</b> <div class="spoiler_text">  <b>Aviso: o ASP.NET MVC est√° obsoleto e o ADO.NET tamb√©m.</b>  <b>√â recomend√°vel usar o ASP.NET Core com ORM moderno.</b>  <b>Mas se voc√™ estiver interessado, leia.</b> <br></div></div><br>  J√°, provavelmente, tr√™s vezes chego ao ASP.NET MVC.  Ap√≥s dez anos com o ASP.NET WebForms, √© um pouco dif√≠cil mudar para a tecnologia MVC, pois h√° tantas diferen√ßas que √© mais f√°cil listar o que essas tecnologias t√™m em comum - exceto as bibliotecas do .NET Framework.  N√£o vou escrever aqui - o MVC √© melhor ou pior que o WebForms, eles s√£o bons e voc√™ pode criar um bom aplicativo nas duas tecnologias.  Tamb√©m deixo meus pensamentos sobre a necessidade de TDD comigo, embora os tenha. <br><br>  E agora vou falar sobre a tarefa mais padr√£o - o trabalho usual com dados: visualizar a lista de registros em um formul√°rio tabular, adicionar, alterar e excluir dados (opera√ß√µes CRUD).  No entanto, em quase todos os livros e em muitas solu√ß√µes da Internet para o ASP.NET MVC, por algum motivo, a op√ß√£o √© considerada exclusivamente por meio do ORM (Object Relation Mapping): Entity Framework (EF) ou LINQ for SQL.  As tecnologias s√£o excelentes, sem d√∫vida, finalmente, o programador pode n√£o entender - mas como esse DBMS muito relacional (que ele provavelmente usa) geralmente funciona, e mesmo o SQL, em teoria, n√£o √© mais necess√°rio: colocar na forma de EF e conectores para o DBMS se entender√£o.  "Aqui est√° a felicidade - n√£o h√° mais beleza para ela."  Mas para os programadores que n√£o t√™m medo de trabalhar diretamente com o banco de dados por meio do mecanismo ADO.NET, muitas vezes n√£o √© claro - e por onde come√ßar com o ASP.NET MVC em geral e se √© necess√°rio. <br><a name="habracut"></a><br>  Al√©m disso, para mim, por exemplo, no in√≠cio, causou uma quebra violenta com a falta de um componente conveniente para exibir dados em uma tabela de grade.  Entende-se que o pr√≥prio desenvolvedor deve implementar tudo isso ou obter algo adequado do gerenciador de pacotes.  Se voc√™, como eu, ficou mais do que satisfeito com o componente GridView no ASP.NET WebForms, ent√£o para o MVC √© dif√≠cil encontrar algo mais ou menos compar√°vel, exceto o Grid.mvc.  Mas minha confian√ßa nesses componentes n√£o √© suficiente para us√°-los em um projeto suficientemente grande.  Se forem usados, o programador come√ßa a depender de outro desenvolvedor que, em primeiro lugar, n√£o sabe escrever esse componente (√© qualitativo?). Em segundo lugar, n√£o se sabe quando e como ser√° finalizado.  √Äs vezes parece at√© poss√≠vel expandir o componente e enxerg√°-lo ainda mais, mas, se o desenvolvedor o concluir, somos for√ßados a refazer nosso c√≥digo novamente ou congelar a atualiza√ß√£o do componente em uma determinada vers√£o.  E se o desenvolvedor corrigir uma vulnerabilidade, voc√™ ainda precisar√° atualizar para a nova vers√£o.  At√© a transi√ß√£o para novas vers√µes do conector MySQL causa alguns problemas, embora ainda esteja sendo desenvolvida por uma grande empresa, mas e as in√∫meras "bicicletas" no gerenciador de pacotes Nuget? <br><br>  Ent√£o, vamos tentar aprender a escrever no ASP.NET MVC, enquanto trabalhamos com dados processados ‚Äã‚Äãpelo MySQL DBMS.  Todo o c√≥digo pode ser obtido aqui <a href="https://yadi.sk/d/EArrZdGh_iVaJg" rel="nofollow">neste endere√ßo</a> , abaixo deste c√≥digo ser√° parcialmente apresentado com pequenos links e explica√ß√µes.  E <a href="https://example-mvc.azurewebsites.net/" rel="nofollow">aqui</a> voc√™ pode ver o aplicativo. <br><br><h2>  Crie um banco de dados no MySQL </h2><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SCHEMA</span></span> <span class="hljs-string"><span class="hljs-string">`example`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">USE</span></span> <span class="hljs-string"><span class="hljs-string">`example`</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`users`</span></span> ( <span class="hljs-string"><span class="hljs-string">`UserID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`SupporterTier`</span></span> enum(<span class="hljs-string"><span class="hljs-string">'None'</span></span>,<span class="hljs-string"><span class="hljs-string">'Silver'</span></span>,<span class="hljs-string"><span class="hljs-string">'Gold'</span></span>,<span class="hljs-string"><span class="hljs-string">'Platinum'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'None'</span></span>, <span class="hljs-string"><span class="hljs-string">`Loginname`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">`Email`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`LastLoginDate`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`UserID`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`i_Loginname`</span></span> (<span class="hljs-string"><span class="hljs-string">`Loginname`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> <span class="hljs-string"><span class="hljs-string">`i_Language_idx`</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">`i_Language`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`languages`</span></span> ( <span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`LanguageName`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">`Culture`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`LanguageID`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8;</code> </pre> <br>  O banco de dados (DB) ser√° simples e representado por apenas duas tabelas, com um relacionamento um para muitos no campo <code>LanguageID</code> .  Dessa forma, vou complicar a situa√ß√£o pela necessidade de usar a lista suspensa de um dos idiomas para o usu√°rio.  Al√©m disso, para complicar, para o usu√°rio, tamb√©m apresentaremos o campo <code>SupporterTier</code> , que determinar√° o n√≠vel de suporte do usu√°rio por meio da enumera√ß√£o.  E, para usar quase todos os tipos de dados em nosso projeto, adicionamos o campo <code>LastLoginDate</code> do tipo "data / hora", que ser√° preenchido pelo pr√≥prio aplicativo quando o usu√°rio efetuar login (n√£o refletido neste projeto). <br><br><h2>  Crie um projeto </h2><br><img src="https://habrastorage.org/webt/sm/4a/07/sm4a07w8etetdgvtnkhd5i-wjcu.png"><br><br>  Escolha "MVC".  √â poss√≠vel usar ‚ÄúVazio‚Äù, mas temos um treinamento, n√£o um aplicativo real, portanto, isso nos ajudar√° imediatamente, sem gestos desnecess√°rios, a integrar o Bootstrap e o JQuery em nosso aplicativo. <br><br><img src="https://habrastorage.org/webt/lg/yv/rn/lgyvrneaxmudgq9mx1ijk36jjqs.png"><br><br>  J√° recebemos as pastas <i>Conte√∫do</i> , <i>Fontes</i> , <i>Scripts</i> , bem como os <i>arquivos</i> <i>BundleConfig.cs</i> e <i>FilterConfig.cs</i> no diret√≥rio <i>App_Start</i> com os pacotes ASP.NET MVC e registros de filtros.  Em um projeto vazio, h√° apenas registro de rotas no arquivo <i>RouteConfig.cs</i> .  No <i>Global.asax.cs, as</i> chamadas de m√©todo descritas nesses arquivos tamb√©m ser√£o adicionadas: <br><br><pre> <code class="cpp hljs">FilterConfig.RegisterGlobalFilters(GlobalFilters.Filters); RouteConfig.RegisterRoutes(RouteTable.Routes); BundleConfig.RegisterBundles(BundleTable.Bundles);</code> </pre> <br><h2>  Montamos a infraestrutura e todo o pacote </h2><br>  Para trabalhar com o MySQL DBMS, adicione a biblioteca <i>MySql.Data</i> : manualmente, se o <b>conector mysql-connector-net-8.0.18</b> j√° <b>estiver</b> instalado no computador ou no gerenciador de pacotes Nuget: <br><br><img src="https://habrastorage.org/webt/mk/b_/fh/mkb_fhxg6d8kx2pdnrithceoaf4.png"><br><br>  Adicione a configura√ß√£o da cadeia de conex√£o ao MySQL DBMS <i>no</i> arquivo <i>Web.config</i> : <br><br><pre> <code class="cpp hljs">&lt;connectionStrings&gt; &lt;add name=<span class="hljs-string"><span class="hljs-string">"example"</span></span> providerName=<span class="hljs-string"><span class="hljs-string">"MySql.Data.MySqlClient"</span></span> connectionString=<span class="hljs-string"><span class="hljs-string">"server=localhost;Port=3306;user id=develop;Password=develop;persistsecurityinfo=True;database=example;CharSet=utf8;SslMode=none"</span></span> /&gt; &lt;/connectionStrings&gt;</code> </pre> <br>  Adicione uma linha √† se√ß√£o <code>&lt;appSettings&gt;</code> com um link para a cadeia de conex√£o adicionada: <code>&lt;add key="ConnectionString" value="example" /&gt;</code> <br>  Adicionamos um novo diret√≥rio <i>Dom√≠nio</i> ao aplicativo, nele criamos uma nova classe <code>Base</code> est√°tica (no arquivo <i>Base.cs</i> ), na qual <i>acessamos</i> esses par√¢metros: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> ConnectionString { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Configuration.ConfigurationManager.AppSettings[<span class="hljs-string"><span class="hljs-string">"ConnectionString"</span></span>]; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strConnect { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> System.Configuration.ConfigurationManager.ConnectionStrings[ConnectionString].ConnectionString; } } }</code> </pre> <br>  Eu gosto de ter uma certa classe base no aplicativo com links para par√¢metros do aplicativo e algumas fun√ß√µes padr√£o que podem ser chamadas de todo o aplicativo. <br>  O nome da cadeia de conex√£o √© definido nas configura√ß√µes do aplicativo, para que no futuro seja mais f√°cil trabalhar com a cadeia de conex√£o com o DBMS: alterne rapidamente entre diferentes bancos de dados e altere os par√¢metros de conex√£o.  Al√©m disso, √© conveniente usar o nome da string de conex√£o no par√¢metro application para public√°-lo no Microsoft Azure - voc√™ pode definir o par√¢metro para o servi√ßo de aplicativo usado para publica√ß√£o e determinar a string de conex√£o desejada, predefinida em <code>&lt;connectionStrings&gt;</code> .  Em seguida, ao publicar, voc√™ n√£o pode usar a transforma√ß√£o do <i>arquivo web.config</i> . <br><br>  Tamb√©m gosto de usar os valores do arquivo de recurso global no texto, para n√£o substitu√≠-los em v√°rios lugares, se voc√™ precisar de repente.  Por exemplo: <br><br><img src="https://habrastorage.org/webt/rc/8u/qz/rc8uqzdrz9hvnd-y7swirgoh4tm.png"><br><br>  No arquivo de layout da p√°gina <i>_Layout.cshtml</i> (ele est√° localizado no diret√≥rio <i>Views \ Shared</i> e mais tarde usado em todas as p√°ginas deste projeto), agora voc√™ pode usar essas vari√°veis ‚Äã‚Äã(consulte, por exemplo, <code>Example_Users.Properties.Resources.Title</code> ): <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=utf-8"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>@ViewBag.Title ‚Äì @Example_Users.Properties.Resources.Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> @Styles.Render("~/Content/css") @Scripts.Render("~/bundles/modernizr") <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container body-content"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"page-header"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span>@Example_Users.Properties.Resources.Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> @RenderBody() <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> @DateTime.Now.Year ‚Äì @Example_Users.Properties.Resources.Author<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">footer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @Scripts.Render("~/bundles/jquery") @Scripts.Render("~/bundles/bootstrap") @RenderSection("scripts", required: false) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Tamb√©m neste arquivo, vemos o anexo da folha de estilos em cascata do Bootstrap conectado e da biblioteca de scripts JQuery.  O conte√∫do de todas as visualiza√ß√µes ser√° gerado no local da chamada para a fun√ß√£o <code>RenderBody()</code> . <br><br><h2>  M significa modelo </h2><br>  Adicione o arquivo <i>UserClass.cs</i> ao diret√≥rio <i>Dom√≠nio</i> : <br><br><pre> <code class="cpp hljs">[DisplayName(<span class="hljs-string"><span class="hljs-string">"User"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserClass</span></span></span><span class="hljs-class"> {</span></span> [Key] [HiddenInput(DisplayValue=<span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UserID { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [Required(ErrorMessage=<span class="hljs-string"><span class="hljs-string">"Please enter a login name"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Login"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Loginname { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> LanguageClass Language { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [EmailAddress(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please enter a valid email"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Email { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [UIHint(<span class="hljs-string"><span class="hljs-string">"Enum"</span></span>)] [EnumDataType(typeof(Supporter))] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select supporter tier"</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Supporter"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Supporter SupporterTier { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] [ScaffoldColumn(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [Display(Name = <span class="hljs-string"><span class="hljs-string">"Last login"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DateTime? LastLoginDate { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsLastLogin { get { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> LastLoginDate != null &amp;&amp; LastLoginDate &gt; DateTime.MinValue; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> UserID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Loginname, LanguageClass Language, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, DateTime? LastLoginDate, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.UserID = UserID; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Loginname = Loginname; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Language = Language; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Email = Email; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LastLoginDate = LastLoginDate; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SupporterTier = SupporterTier; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Supporter { [Display(Name=<span class="hljs-string"><span class="hljs-string">""</span></span>)] None = <span class="hljs-number"><span class="hljs-number">1</span></span>, Silver = <span class="hljs-number"><span class="hljs-number">2</span></span>, Gold = <span class="hljs-number"><span class="hljs-number">3</span></span>, Platinum = <span class="hljs-number"><span class="hljs-number">4</span></span> }</code> </pre> <br>  E tamb√©m o arquivo <i>LanguageClass.cs</i> no mesmo diret√≥rio: <br><pre> <code class="cpp hljs">[DisplayName(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-class"> {</span></span> [Key] [HiddenInput(DisplayValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] [Required(ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select a language"</span></span>)] [Range(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.MaxValue, ErrorMessage = <span class="hljs-string"><span class="hljs-string">"Please select a language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> LanguageID { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } [Display(Name = <span class="hljs-string"><span class="hljs-string">"Language"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> LanguageName { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LanguageClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LanguageID = LanguageID; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.LanguageName = LanguageName; } }</code> </pre> <br>  Aqui voc√™ pode ver que as propriedades das classes repetem a estrutura da tabela <code>Users</code> e <code>Languages</code> no DBMS.  Um <code>enum Supporter</code> criado para o tipo de enumera√ß√£o, para que possa ser usado para a propriedade da classe <code>SupporterTier</code> de um campo semelhante na tabela de banco de dados.  Para os campos <code>UserID</code> , <code>LanguageID</code> , √© poss√≠vel ver que eles s√£o especificados como chave prim√°ria, assim como no banco de dados.  O atributo <code>[Key]</code> √© usado para isso. <br><br>  Todos os outros atributos est√£o mais provavelmente relacionados a visualiza√ß√µes usando esta classe.  E se vamos usar ajudantes para formar tags HTML para essas propriedades (que eu pessoalmente recomendaria), teremos que definir esses atributos com muito cuidado para obter o que precisamos.  Em particular, eis o que era necess√°rio para este projeto: <br><br><ul><li>  <b><code>[DisplayName]</code></b> - Usado como o nome de exibi√ß√£o da classe.  √Äs vezes, pode ser √∫til, neste projeto eu adicionei especialmente o uso do auxiliar <code>Html.DisplayNameForModel</code> para demonstra√ß√£o. </li><li>  <b><code>[Display]</code></b> com a propriedade <code>Name</code> - usada como o nome da propriedade da classe exibida na tela.  H√° tamb√©m uma propriedade Order √∫til que permite que voc√™ ordene a sequ√™ncia de exibi√ß√£o das propriedades da classe em um formul√°rio usando helpers (por padr√£o, classificando pela ordem em que as propriedades da classe s√£o definidas, portanto a propriedade Order n√£o foi usada neste projeto). </li><li>  <b><code>[HiddenInput]</code></b> com a propriedade <code>DisplayValue</code> .  √â usado para propriedades que nem precisam ser exibidas em formul√°rios e listas ( <code>DisplayValue=false</code> , s√£o desenhadas como tags de <code>input</code> com o tipo <code>hidden</code> ) ou para propriedades que ainda precisam ser exibidas, mas na forma de texto imut√°vel ( <code>DisplayValue=true</code> , √© desenhado como texto limpo, sem tags) </li><li>  <b><code>[ScaffoldColumn]</code></b> - indica se o campo deve ser exibido nos <code>Html.EditorForModel</code> edi√ß√£o (por exemplo, <code>Html.EditorForModel</code> ).  Se <code>false</code> , nem a descri√ß√£o da propriedade da classe nem seu valor ser√£o exibidos no formul√°rio.  <code>[HiddenInput(DisplayValue = false)]</code> n√£o pode ser usado <code>[HiddenInput(DisplayValue = false)]</code> , porque nesse caso os valores dessa propriedade de classe n√£o ser√£o exibidos, n√£o apenas nos formul√°rios de entrada de informa√ß√µes, mas tamb√©m nos displays de tabela.  Nesse caso, isso era necess√°rio para a propriedade <code>LastLoginDate</code> , que n√£o √© inserida manualmente, mas √© preenchida em algum lugar automaticamente, mas ainda precisamos v√™-la. </li><li>  <b><code>[Required]</code></b> - para verificar se um valor foi inserido para uma propriedade de classe, com o texto da mensagem de erro na propriedade <code>ErrorMessage</code> e na propriedade <code>AllowEmptyStrings</code> permite inserir linhas em branco. </li><li>  <b><code>[EmailAddress]</code></b> - essencialmente o mesmo atributo para verificar a exatid√£o do endere√ßo de correspond√™ncia. </li></ul><br>  As classes do modelo de banco de dados est√£o prontas, passamos para as representa√ß√µes (as classes de modelos para representa√ß√µes ser√£o descritas abaixo). <br><br><h2>  V - significa desempenho da <s>vingan√ßa</s> </h2><br>  No diret√≥rio <i>Views</i> , crie o diret√≥rio <i>Users</i> para nossos views.  Todas as nossas visualiza√ß√µes usam o layout padr√£o (definido no arquivo <i>_ViewStart.cshtml</i> no diret√≥rio <i>Views</i> ) <i>_Layout.cshtml</i> localizado no diret√≥rio <i>Views \ Shared</i> .  Crie uma exibi√ß√£o de <code>Index</code> (arquivo <i>Index.cshtml</i> no diret√≥rio <i>Usu√°rios</i> ): <br><br><img src="https://habrastorage.org/webt/jh/es/jn/jhesjnicwj2g1acx7yziv4f6wqy.png"><br><br>  E escreva o c√≥digo: <br><br><pre> <code class="xml hljs">@model Example_Users.Models.UsersGrid @{ ViewBag.Title = "Users page"; } @using (@Html.BeginForm()) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span>Users list:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> @if (TempData["message"] != null) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-success"</span></span></span><span class="hljs-tag">&gt;</span></span>@TempData["message"]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>} @if (TempData["error"] != null) {<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text-warning"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert"</span></span></span><span class="hljs-tag">&gt;</span></span>ERROR:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> @TempData["error"]<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>} @Html.Partial("List") <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onNewUser"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"New user"</span></span></span><span class="hljs-tag"> /&gt;</span></span> @*@Html.ActionLink("New user", "New", "Users")*@ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br>  Se quisermos que essa exibi√ß√£o inicie por padr√£o, fa√ßa uma altera√ß√£o no <code>Default</code> no arquivo <i>RouteConfig.cs</i> : <br><br><pre> <code class="cpp hljs">routes.MapRoute(name: <span class="hljs-string"><span class="hljs-string">"Default"</span></span>, url: <span class="hljs-string"><span class="hljs-string">"{controller}/{action}/{id}"</span></span>, defaults: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { controller = <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, action = <span class="hljs-string"><span class="hljs-string">"Index"</span></span>, id = UrlParameter.Optional });</code> </pre> <br>  Na exibi√ß√£o em si, voc√™ precisa prestar aten√ß√£o √† linha com <code>Html.Partial("List")</code> .  √â necess√°rio desenhar nesse local uma exibi√ß√£o parcial geral separada e especial localizada no arquivo <i>List.cshtml</i> no diret√≥rio <i>Views \ Shared</i> .  Na verdade, √© uma tabela de grade para exibir dados da tabela de banco de dados de nossos <code>users</code> : <br><br><pre> <code class="xml hljs">@model Example_Users.Models.UsersGrid @using Example_Users.Domain <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table-responsive"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"table table-bordered table-hover"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Loginname).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Loginname).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Loginname).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Language.LanguageName).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Language).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Language).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().Email).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().Email).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().Email).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().SupporterTier).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().SupporterTier).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().SupporterTier).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(Html.DisplayNameFor(m =&gt; Model.Users.First().LastLoginDate).ToString(), "Index", Request.QueryString.ToRouteValueDictionary("sortOrder", Model.SortingInfo.NewOrder(Html.NameFor(m =&gt; Model.Users.First().LastLoginDate).ToString()))) @Html.SortIdentifier(Model.SortingInfo.currentSort, Html.NameFor(m =&gt; Model.Users.First().LastLoginDate).ToString()) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">thead</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Users) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink(item.Loginname, "Edit", "Users", new { UserID = item.UserID }, null)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelitem =&gt; item.Language.LanguageName)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelitem =&gt; item.Email)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@Html.DisplayFor(modelitem =&gt; item.SupporterTier)"</span></span></span><span class="hljs-tag">&gt;</span></span>@if (item.SupporterTier != Supporter.None) {@Html.DisplayFor(modelitem =&gt; item.SupporterTier);}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@if (item.IsLastLogin) {@Html.DisplayFor(modelitem =&gt; item.LastLoginDate)}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tbody</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> @if (Model.PagingInfo.totalPages &gt; 1) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pagination"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.PageLinks(Model.PagingInfo, x =&gt; Url.Action("Index", new { page = x, sortOrder = Model.SortingInfo.currentSort })) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> }</code> </pre> <br>  Pode-se observar que, no cabe√ßalho da tabela de dados, os auxiliares <code>Html.DisplayNameFor</code> s√£o <code>Html.DisplayNameFor</code> para exibir os nomes das colunas e, para isso, √© necess√°rio especificar uma refer√™ncia √† propriedade do objeto de classe.  Como ao formar o t√≠tulo da tabela, temos apenas um objeto <code>Model.Users</code> , que √© uma lista de objetos do tipo <code>UserClass</code> , precisamos usar o seguinte m√©todo: selecione a primeira linha desta lista como um objeto da classe <code>UserClass</code> .  Por exemplo, para o nome de usu√°rio: <code>Model.Users.First().Loginname</code> .  Como o atributo <code>Loginname</code> da classe <code>Users</code> possui o atributo <code>[Display(Name = "Login")]</code> , ele ser√° exibido "Login" no nome da coluna: <br><br><img src="https://habrastorage.org/webt/hv/kf/dv/hvkfdvojevmzacuid51wurye8ik.png"><br><br>  O que mais √© interessante na exibi√ß√£o de <code>List</code> ?  O bloco <code>foreach</code> , √© claro, renderiza objetos da classe <code>UserClass</code> que est√£o na lista <code>Users</code> recebidos do controlador.  E os <code>PagingInfo</code> e <code>PagingInfo</code> em nosso modelo <code>UsersGrid</code> s√£o interessantes aqui.  E precisamos desses objetos para organizar a classifica√ß√£o dos dados (usada no cabe√ßalho da tabela nas tags <code>&lt;th&gt;</code> ) e organizar a pagina√ß√£o das informa√ß√µes (usadas na parte inferior da p√°gina, abaixo da tabela).  √â por isso que n√£o usamos como modelo uma lista pura de objetos do tipo <code>IEnumerable&lt;UserClass&gt;</code> .  E como modelo, usamos a classe <code>UsersGrid</code> , localizada no arquivo <i>UsersGrid.cs</i> no diret√≥rio <i>Model</i> . <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersGrid</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;UserClass&gt; Users { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PagingInfo PagingInfo { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SortingInfo SortingInfo { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } }</code> </pre> <br>  E as classes <code>SortingInfo</code> e <code>SortingInfo</code> elas pr√≥prias no arquivo <code>GridInfo.cs</code> no mesmo local. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PagingInfo</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//     public int totalItems { get; set; } //     public int itemsPerPage { get; set; } //   public int currentPage { get; set; } //         public int showPages { get; set; } //   public int totalPages { get { return (int)Math.Ceiling((decimal)totalItems / itemsPerPage); } } //           public int pagesSide { get { return (int)Math.Truncate((decimal)showPages / 2); } } } public class SortingInfo { //  ,     public string currentOrder { get; set; } //   public SortDirection currentDirection { get; set; } //      public string currentSort { get { return currentDirection != SortDirection.Descending ? currentOrder : currentOrder + "_desc"; } } //       (      -   ) public string NewOrder(string columnName) { return columnName == currentOrder &amp;&amp; currentDirection != SortDirection.Descending ? columnName + "_desc" : columnName; } }</span></span></code> </pre> <br>  E para uso em visualiza√ß√µes, foram adicionados auxiliares especiais ao arquivo <i>GridHelpers.cs</i> (diret√≥rio <i>HtmlHelpers</i> ): <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GridHelpers</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-comment"><span class="hljs-comment">//     1 ... 3 4 5 ... Last public static MvcHtmlString PageLinks(this HtmlHelper html, PagingInfo pagingInfo, Func&lt;int, string&gt; pageUrl) { StringBuilder result = new StringBuilder(); if (pagingInfo.currentPage &gt; pagingInfo.pagesSide + 1) {//   TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("a"); tag.MergeAttribute("href", pageUrl(1)); tag.InnerHtml = "1"; li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } int page1 = pagingInfo.currentPage - pagingInfo.pagesSide; int page2 = pagingInfo.currentPage + pagingInfo.pagesSide; if (page1 &lt; 1) { page2 = page2 - page1 + 1; page1 = 1; } if (page2 &gt; pagingInfo.totalPages) page2 = pagingInfo.totalPages; if (page1 &gt; 2) {// ... TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("span"); tag.InnerHtml = "..."; tag.AddCssClass("page-item"); tag.AddCssClass("disabled"); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } for (int i = page1; i &lt;= page2; i++) {//  TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); if (i == pagingInfo.currentPage) li.AddCssClass("active"); TagBuilder tag = new TagBuilder("a"); tag.AddCssClass("page-link"); tag.MergeAttribute("href", pageUrl(i)); tag.InnerHtml = i.ToString(); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } if (page2 &lt; pagingInfo.totalPages) {// ...    TagBuilder li = new TagBuilder("li"); li.AddCssClass("page-item"); TagBuilder tag = new TagBuilder("span"); tag.InnerHtml = "..."; tag.AddCssClass("page-item"); tag.AddCssClass("disabled"); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); li = new TagBuilder("li"); li.AddCssClass("page-item"); tag = new TagBuilder("a"); tag.MergeAttribute("href", pageUrl(pagingInfo.totalPages)); tag.InnerHtml = pagingInfo.totalPages.ToString(); li.InnerHtml = tag.ToString(); result.Append(li.ToString()); } return MvcHtmlString.Create(result.ToString()); } public static IHtmlString SortIdentifier(this HtmlHelper htmlHelper, string sortOrder, string field) { if (string.IsNullOrEmpty(sortOrder) || (sortOrder.Trim() != field &amp;&amp; sortOrder.Replace("_desc", "").Trim() != field)) return null; string glyph = "glyphicon glyphicon-chevron-up"; if (sortOrder.ToLower().Contains("desc")) { glyph = "glyphicon glyphicon-chevron-down"; } var span = new TagBuilder("span"); span.Attributes["class"] = glyph; return MvcHtmlString.Create(span.ToString()); } public static RouteValueDictionary ToRouteValueDictionary(this NameValueCollection collection, string newKey, string newValue) { var routeValueDictionary = new RouteValueDictionary(); foreach (var key in collection.AllKeys) { if (key == null) continue; if (routeValueDictionary.ContainsKey(key)) routeValueDictionary.Remove(key); routeValueDictionary.Add(key, collection[key]); } if (string.IsNullOrEmpty(newValue)) { routeValueDictionary.Remove(newKey); } else { if (routeValueDictionary.ContainsKey(newKey)) routeValueDictionary.Remove(newKey); routeValueDictionary.Add(newKey, newValue); } return routeValueDictionary; } }</span></span></code> </pre> <br>  Como uma grade com dados sem classifica√ß√£o e sem informa√ß√µes de pagina√ß√£o √© uma coisa bastante in√∫til e n√£o existe um auxiliar padr√£o para uma tabela de dados inteira no ASP.NET MVC, voc√™ deve cri√°-lo voc√™ mesmo (ou criar um criado por outra pessoa).  Nesse caso, espiei v√°rias implementa√ß√µes nos livros e solu√ß√µes ASP.NET MVC apresentados na Internet.  Al√©m disso, por algum motivo, as solu√ß√µes que combinam pelo menos classifica√ß√£o e pagina√ß√£o de dados n√£o s√£o de todo ou n√£o foram encontradas.  Eu tive que entender tudo isso, combinar e modific√°-lo para um estado normal.  Por exemplo, a pagina√ß√£o nessas implementa√ß√µes geralmente n√£o fornece a sa√≠da de uma lista mais ou menos longa de p√°ginas - bem, e se houver milhares de p√°ginas?  Dou um exemplo de exibi√ß√£o para a solu√ß√£o apresentada acima: <br><br><img src="https://habrastorage.org/webt/wj/dt/yr/wjdtyrmtbxm5f_5jfj7til_iqy0.png"><br><br>  Tamb√©m precisamos de visualiza√ß√µes para criar e modificar dados.  Vista para criar um objeto do tipo <code>UserClass</code> : <br><br><img src="https://habrastorage.org/webt/0u/80/-i/0u80-itckfou4ciyyxremebrqy8.png"><br><br>  E o c√≥digo de exibi√ß√£o ficar√° assim: <br><br><pre> <code class="cpp hljs">@model Example_Users.Models.UserModel @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"New "</span></span> + Html.DisplayNameForModel().ToString().ToLower(); } &lt;h2&gt;@ViewBag.Title&lt;/h2&gt; @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (@Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"New"</span></span>, <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, FormMethod.Post)) { @Html.EditorFor(m =&gt; m.User); @Html.LabelFor(m =&gt; Model.User.Language)&lt;br /&gt; @Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages()) &lt;span/&gt;@Html.ValidationMessageFor(m =&gt; Model.User.Language.LanguageID)&lt;br /&gt; &lt;br /&gt; &lt;p&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Add"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"button"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"history.go(-1)"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span> /&gt;&lt;/p&gt; @*&lt;p&gt;@Html.ActionLink(<span class="hljs-string"><span class="hljs-string">"Back to list"</span></span>, <span class="hljs-string"><span class="hljs-string">"Index"</span></span>)&lt;/p&gt;*@ }</code> </pre> <br>  Essa visualiza√ß√£o mostra, por exemplo, o uso do auxiliar <code>Html.EditorFor</code> como um meio de gerar tags para editar todas as propriedades dos objetos na classe <code>UserClass</code> .  √â exibido da seguinte maneira: <br><br><img src="https://habrastorage.org/webt/v-/rz/kw/v-rzkwz4dtui-xhs4lo2vbjyf3s.png"><br><br>  Essa visualiza√ß√£o usa a classe <code>UserModel</code> como modelo, n√£o a <code>UserClass</code> diretamente.  A pr√≥pria classe <code>UserModel</code> localizada no arquivo <i>UserModel.cs</i> no diret√≥rio <i>Models</i> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserModel</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UserClass User { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> IList&lt;LanguageClass&gt; Languages { get; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UserModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user, IList&lt;LanguageClass&gt; languages)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.User = user; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Languages = languages; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IEnumerable&lt;SelectListItem&gt; SelectLanguages() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Languages != null) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectList(Languages, <span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, <span class="hljs-string"><span class="hljs-string">"LanguageName"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } }</code> </pre> <br>  O objeto <code>UserClass</code> si e uma lista adicional de objetos do tipo <code>LanguageClass</code> inclu√≠dos nesta classe.  Precis√°vamos dessa lista para criar uma lista suspensa de idiomas, com o idioma do usu√°rio atual selecionado: <code>@Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages(), "")</code> <br><br>  Esse auxiliar usa a chamada para a fun√ß√£o <code>SelectLanguages()</code> , que converte a lista de idiomas em um objeto do tipo <code>SelectList</code> com os par√¢metros de identificador e nome da linha j√° definidos.  Colocar a gera√ß√£o desse objeto na visualiza√ß√£o seria errado, porque a id√©ia era n√£o saber sobre essas liga√ß√µes aos nomes dos campos.  <code>SelectList</code> , √© poss√≠vel, √© claro, gerar imediatamente um <code>SelectList</code> pronto no controlador, mas eu gosto da op√ß√£o com uma lista particular de objetos de classe de dom√≠nio e uma fun√ß√£o mais. <br><br>  Para gerar uma lista suspensa, precisamos usar auxiliares separados, porque o auxiliar <code>Html.EditorFor(m =&gt; m.User)</code> n√£o gerar√° marca√ß√£o de edi√ß√£o para um objeto incorporado do tipo <code>LanguageClass</code> (isso pode ser ignorado escrevendo um modelo geral para listas suspensas, mas aqui n√≥s n√≥s n√£o faremos isso ...). <br><br>  E, como usamos um objeto da classe <code>UserClass</code> , que inclui outro objeto da classe <code>UserClass</code> , n√£o poderemos usar o auxiliar <code>Html.EditorForModel()</code> , porque os auxiliares n√£o s√£o recursivos e n√£o funcionar√£o nessa situa√ß√£o, portanto, o auxiliar <code>Html.EditorFor()</code> √© usado <code>Html.EditorFor()</code> para o objeto <code>User</code> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m quero prestar aten√ß√£o √† tag comentada: </font></font><code>Html.ActionLink("Back to list", "Index")</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">geralmente, um retorno da exibi√ß√£o para edi√ß√£o na lista de dados geralmente √© implementado dessa maneira. De fato, em primeiro lugar, na minha opini√£o, parece estranho - quando voc√™ usa bot√µes de tipo em um formul√°rio </font></font><code>button</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, e o bot√£o de retorno √©, por algum motivo, implementado por um link. Em segundo lugar, se usarmos a classifica√ß√£o e a sa√≠da p√°gina por p√°gina - teremos que ser s√°bios ao retornar √† mesma p√°gina na mesma exibi√ß√£o - e transmitir a exibi√ß√£o n√£o apenas ao objeto </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, mas tamb√©m aos par√¢metros para retornar √† p√°gina. Existe uma maneira muito mais simples - use a op√ß√£o com um bot√£o como:</font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, que enviar√° o usu√°rio de volta √† p√°gina de hist√≥rico do navegador. Aqui, √© claro, existem nuances (por exemplo, voc√™ j√° tentou salvar o objeto nesta p√°gina, ele n√£o funcionou e agora - voc√™ j√° precisa clicar duas vezes no bot√£o Cancelar), mas essa op√ß√£o como um todo funciona bem. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E a vis√£o para editar um objeto do tipo </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/webt/a2/eo/xh/a2eoxhk3nzvbvs0h7s_nmjxuems.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E seu c√≥digo:</font></font><br><br><pre> <code class="cpp hljs">@model Example_Users.Models.UserModel @{ ViewBag.Title = <span class="hljs-string"><span class="hljs-string">"Edit "</span></span> + Html.DisplayNameForModel().ToString().ToLower(); } &lt;h2&gt;@ViewBag.Title @Model.User.Loginname&lt;/h2&gt; @<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (@Html.BeginForm(<span class="hljs-string"><span class="hljs-string">"Edit"</span></span>, <span class="hljs-string"><span class="hljs-string">"Users"</span></span>, FormMethod.Post)) { @Html.HiddenFor(m =&gt; Model.User.UserID) &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Loginname) @Html.EditorFor(m =&gt; Model.User.Loginname) @Html.ValidationMessageFor(m =&gt; Model.User.Loginname) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Language) @Html.DropDownListFor(m =&gt; Model.User.Language.LanguageID, Model.SelectLanguages()) @Html.ValidationMessageFor(m =&gt; Model.User.Language.LanguageID) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.Email) @Html.EditorFor(m =&gt; Model.User.Email) @Html.ValidationMessageFor(m =&gt; Model.User.Email) &lt;/div&gt; &lt;div&gt; @Html.LabelFor(m =&gt; Model.User.SupporterTier) @Html.EditorFor(m =&gt; Model.User.SupporterTier) @*@Html.EnumDropDownListFor(m =&gt; Model.User.SupporterTier)*@ @*@Html.DropDownListFor(m =&gt; m.Model.User.SupporterTier, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SelectList(Enum.GetNames(typeof(Example_Users.Domain.Supporter))))*@ @Html.ValidationMessageFor(m =&gt; Model.User.SupporterTier) &lt;/div&gt; &lt;br /&gt; &lt;p&gt;&lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Save"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Remove"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"javascript:return confirm('Are you sure?');"</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"action"</span></span> value=<span class="hljs-string"><span class="hljs-string">"Cancel"</span></span> /&gt;&lt;/p&gt; }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E nessa vis√£o, √© apresentada a op√ß√£o de usar ajudantes diferentes para gerar tags separadamente para cada propriedade desejada de um objeto de classe. </font><font style="vertical-align: inherit;">Nesse caso, voc√™ j√° pode fazer a exibi√ß√£o de uma maneira um pouco diferente e mais bonita: </font></font><br><br><img src="https://habrastorage.org/webt/3g/ew/as/3gewasn6m2whqy9odk4gvrn2l0c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e nessa exibi√ß√£o, outra maneira √© usada para retornar √† lista. </font><font style="vertical-align: inherit;">Em vez de usar um bot√£o como: </font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o mesmo bot√£o √© usado como os outros bot√µes de a√ß√£o ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salvar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remover</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ): </font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e o retorno √© realizado dentro do m√©todo do controlador que processa as a√ß√µes desses bot√µes (consulte a implementa√ß√£o do m√©todo abaixo).</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Enum </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E havia uma nuance associada ao uso de uma propriedade de classe do tipo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">O fato √© que, se apenas usarmos o auxiliar </font></font><code>Html.EditorFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, o campo de entrada de informa√ß√µes de texto (tag de tipo </font></font><code>&lt;input type=‚Äùtext‚Äù/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font><font style="vertical-align: inherit;">ser√° </font><font style="vertical-align: inherit;">exibido no formul√°rio </font><font style="vertical-align: inherit;">, mas na verdade precisamos de um campo com uma escolha entre um conjunto de valores (ou seja, uma tag </font></font><code>&lt;select&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um conjunto de op√ß√µes </font></font><code>&lt;option&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. linha recta √© resolvido usando o tipo de ajudante </font></font><code>Html.DropDownListFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>Html.ListBoxFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, por exemplo, no nosso caso </font></font><code>@Html.DropDownListFor(m =&gt; m.Model.User.SupporterTier, new SelectList(Enum.GetNames(typeof(Example_Users.Domain.Supporter))))</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Existem dois pontos negativos - cada vez que ele deve ser prescrito individualmente para o ajudante </font></font><code>Html.EditorForModel()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>Html.EditorFor()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o funciona. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. Voc√™ pode criar um modelo de tipo personalizado </font></font><code>Editor</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Crie o arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Supporter.cshtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasta Views \ Shared \ EditorTemplates</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><pre> <code class="xml hljs">@model Example_Users.Domain.Supporter @Html.DropDownListFor(m =&gt; m, new SelectList(Enum.GetNames(Model.GetType()), Model.ToString()))</code> </pre> <br>      ,     <code>Html.EditorFor(m =&gt; Model.SupporterTier)</code> ,  <code>Html.EditorFor(m =&gt; Model.SupporterTier, "Supporter")</code> .    -,           <code>[UIHint("Supporter")]</code> .     ,    <code>Html.EditorForModel()</code> ‚Äì     <code>Html.EditorFor(m =&gt; Model.SupporterTier, "Supporter")</code>  . <br><br>      -  ,     (  <code>New</code> )    <code>Html.EditorFor()</code>  <code>Html.EditorForModel()</code>   : ¬´ <i> ,   ,   NULL,         ¬´Example_Users.Domain.Supporter¬ª,    NULL.</i> ¬ª   ‚Äì       ,       .    . <br><br> 3.    <code>Html.EnumDropDownListFor()</code> ,    .    ,     ,   ,        .   ¬´¬ª:  <code>Html.EditorForModel()</code>       <code>Html.EditorFor()</code> , ,   <code>Html.EnumDropDownListFor()</code> . ,   ,          ‚Äì <code>[UIHint]</code> , <code>[DataType]</code>  <code>[EnumDataType]</code>   .        ,    None  , ,   ,       <code>Supporter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Como resultado, criei uma op√ß√£o de solu√ß√£o </font></font><a href="https://odetocode.com/Blogs/scott/archive/2012/08/29/working-with-enums-and-templates-in-asp-net-mvc.aspx" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encontrada na Internet</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : criar um modelo comum para transfer√™ncias. </font><font style="vertical-align: inherit;">Crie o arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enum.cshtml</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> na </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pasta Views \ Shared \ EditorTemplates</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="xml hljs">@using System.ComponentModel.DataAnnotations @model Enum @{ Func<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object,</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">string</span></span></span><span class="hljs-tag">&gt;</span></span> GetDisplayName = o =&gt; { var result = null as string; var display = o.GetType() .GetMember(o.ToString()).First() .GetCustomAttributes(false) .OfType<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DisplayAttribute</span></span></span><span class="hljs-tag">&gt;</span></span>() .LastOrDefault(); if (display != null) result = display.GetName(); return result ?? o.ToString(); }; var values = Enum.GetValues(ViewData.ModelMetadata.ModelType).Cast<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span>() .Select(v =&gt; new SelectListItem { Selected = v.Equals(Model), Text = GetDisplayName(v), // v.ToString(), Value = v.ToString() }); } @Html.DropDownList("", values)</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui, em geral, tudo saiu bem: o modelo funciona muito bem sempre que poss√≠vel. </font><font style="vertical-align: inherit;">Voc√™ ainda </font></font><code>[UIHint("Enum")]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n√£o pode adicionar. </font><font style="vertical-align: inherit;">Al√©m disso, este modelo geral l√™ o atributo </font></font><code>[Display(Name)]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para valores de enumera√ß√£o usando uma fun√ß√£o especial.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C significa controlador </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicione o arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UsersController.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao diret√≥rio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Controladores</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> :</span></span> Controller { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pageSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> showPages = <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    public ViewResult Index(string sortOrder, int page = 1) { string sortName = null; System.Web.Helpers.SortDirection sortDir = System.Web.Helpers.SortDirection.Ascending; sortOrder = Base.parseSortForDB(sortOrder, out sortName, out sortDir); UsersRepository rep = new UsersRepository(); UsersGrid users = new UsersGrid { Users = rep.List(sortName, sortDir, page, pageSize, out count), PagingInfo = new PagingInfo { currentPage = page, itemsPerPage = pageSize, totalItems = count, showPages = showPages }, SortingInfo = new SortingInfo { currentOrder = sortName, currentDirection = sortDir } }; return View(users); } [ReferrerHold] [HttpPost] public ActionResult Index(string onNewUser) { if (onNewUser != null) { TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View("New", new UserModel(new UserClass(), Languages())); } return View(); } [ReferrerHold] public ActionResult New() { TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View("New", new UserModel(new UserClass(), Languages())); } [HttpPost] public ActionResult New(UserModel model) { if (ModelState.IsValid) { if (model.User == null || model.User.Language == null || model.User.Language.LanguageID == 0) RedirectToAction("Index"); UsersRepository rep = new UsersRepository(); if (rep.AddUser(model.User)) TempData["message"] = string.Format("{0} has been added", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been added!", model.User.Loginname); if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } else { model = new UserModel(model.User, Languages()); // -          model.Languages,   return View(model); } } [ReferrerHold] public ActionResult Edit(int UserID) { UsersRepository rep = new UsersRepository(); UserClass user = rep.FetchByID(UserID); if (user == null) return HttpNotFound(); TempData["referrer"] = ControllerContext.RouteData.Values["referrer"]; return View(new UserModel(user, Languages())); } [HttpPost] public ActionResult Edit(UserModel model, string action) { if (action == "Cancel") { if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } if (ModelState.IsValid) { if (model.User == null || model.User.Language == null || model.User.Language.LanguageID == 0) RedirectToAction("Index"); UsersRepository rep = new UsersRepository(); if (action == "Save") { if (rep.ChangeUser(model.User)) TempData["message"] = string.Format("{0} has been saved", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been saved!", model.User.Loginname); } if (action == "Remove") { if (rep.RemoveUser(model.User)) TempData["message"] = string.Format("{0} has been removed", model.User.Loginname); else TempData["error"] = string.Format("{0} has not been removed!", model.User.Loginname); } if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString()); return RedirectToAction("Index"); } else { model = new UserModel(model.User, Languages()); return View(model); } } public IList&lt;LanguageClass&gt; Languages() { IList&lt;LanguageClass&gt; languages = new List&lt;LanguageClass&gt;(); LanguagesRepository rep = new LanguagesRepository(); languages = rep.List(); return languages; } }</span></span></code> </pre> <br>   : <br><br> 1)  <code>Index</code> <br><br>     : <code>public ViewResult Index(string sortOrder, int page = 1)</code> <br><br>     <code>sortOrder</code>  <code>page</code> .  <code>page</code>  - ,    <code>sortOrder</code>       ,       SQL-     .        (     ,     <i>Base.cs</i> ): <code>sortOrder = Base.parseSortForDB(sortOrder, out sortName, out sortDir);</code> <br><br>   ,    <code>UsersRepository</code> (   ,    ),   <code>List</code>         <code>UsersGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">da lista real de usu√°rios e das informa√ß√µes necess√°rias para organizar a pagina√ß√£o das informa√ß√µes e a classifica√ß√£o. Al√©m disso, o valor de totalItem √© obtido quando o m√©todo √© chamado </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, simultaneamente com a cria√ß√£o do objeto de classe </font></font><code>UsersGrid</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Al√©m disso, esse objeto √© transferido para exibi√ß√£o em representa√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">H√° tamb√©m outro m√©todo Index com o atributo </font></font><code>[HttpPost]</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">que precisamos para trabalhar com o bot√£o, </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na visualiza√ß√£o </font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><code>public ActionResult Index(string onNewUser)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O par√¢metro de entrada tem </font></font><code>onNewUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">algo em comum com o elemento </font></font><code>/&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na visualiza√ß√£o </font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e, quando clicamos nesse bot√£o, passa o valor para a fun√ß√£o que comparamos com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nula</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Se os bot√µes de tipo </font></font><code>submit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">estivessem na exibi√ß√£o</font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v√°rios, voc√™ precisaria verificar o pr√≥prio valor (nesse caso, o valor seria "Novo usu√°rio"). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ap√≥s a verifica√ß√£o, formamos um objeto de classe </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, consistindo em um novo objeto </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e uma lista de idiomas para selecion√°-los na lista suspensa e pass√°-los para a apresenta√ß√£o </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A lista de idiomas √© obtida no reposit√≥rio </font></font><code>LanguageRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chamando o m√©todo da </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seguinte maneira:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;LanguageClass&gt; Languages() { LanguagesRepository rep = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguagesRepository(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rep.List(); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) M√©todos </font></font><code>New</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um m√©todo </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sem um par√¢metro √© criado para dar um clique no link </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novo Usu√°rio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para uma linha comentada </font></font><code>Html.ActionLink("New user", "New", "Users")</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">na exibi√ß√£o </font></font><code>Index</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. A a√ß√£o (abrindo a visualiza√ß√£o </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) √© executada de maneira semelhante √† anterior, mas n√£o h√° verifica√ß√£o no bot√£o pressionado, porque clicar no link est√° sendo elaborado. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O m√©todo </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com o par√¢metro de modelo do tipo </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para processar o evento de envio de dados do formul√°rio para salvar o novo usu√°rio no banco de dados: </font></font><code>public ActionResult New(UserModel model)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Recupera o objeto de classe preenchido na visualiza√ß√£o Novo </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, verifica a corre√ß√£o dos dados (de acordo com os requisitos descritos em </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>LanguageClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), cria o objeto de reposit√≥rio </font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e tenta adicionar uma nova linha ao banco de dados, chamando uma fun√ß√£o</font></font><code>AddUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em seguida, ele retorna √† p√°gina anterior (de onde a visualiza√ß√£o foi chamada </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e uma mensagem √© exibida indicando o sucesso da opera√ß√£o ou a falha. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3) M√©todos </font></font><code>Edit</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um m√©todo </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com um par√¢metro de entrada </font></font><code>UserID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(identificador do usu√°rio) clica no nome do usu√°rio na lista para abrir a visualiza√ß√£o de edi√ß√£o dos dados do usu√°rio: </font></font><code>public ActionResult Edit(int UserID)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No m√©todo, um reposit√≥rio √© criado novamente </font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e uma fun√ß√£o √© chamada a partir dele </font></font><code>FetchByID(UserID)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para obter um objeto do tipo </font></font><code>UserClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Em caso de sucesso, um modelo √© criado - um objeto de classe do objeto </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">recebido e uma lista de idiomas e passado para a exibi√ß√£o </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para exibi√ß√£o. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo com um par√¢metro de entrada do tipo </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">modelo de </font><font style="vertical-align: inherit;">linha </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><code>public ActionResult Edit(UserModel model, string action)</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Um objeto de tipo √© passado para esse m√©todo </font></font><code>UserModel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e processa as a√ß√µes quando os bot√µes s√£o clicados (processando eventos para o envio de dados do formul√°rio) da exibi√ß√£o </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para entender qual bot√£o √© pressionado, √© usado o par√¢metro de entrada </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, indicado no nome das tags de tipo HTML </font></font><code>input</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Portanto, o m√©todo compara os valores desse par√¢metro com os valores </font></font><code>value</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">desses </font><font style="vertical-align: inherit;">par√¢metros </font><font style="vertical-align: inherit;">. Antes de verificar a validade do modelo, o valor √© verificado </font></font><code>Cancel</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para executar a√ß√µes para cancelar a edi√ß√£o do usu√°rio. Esta op√ß√£o √© usada em vez de retornar ao hist√≥rico do navegador, que √© usado na visualiza√ß√£o </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e usa o armazenamento do endere√ßo da p√°gina da qual a visualiza√ß√£o foi passada</font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Para fazer isso, o controlador demonstrou a tecnologia para usar seu atributo </font></font><code>ActionFilter</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: a classe </font></font><code>ReferrerHoldAttribute</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReferrerHoldAttribute.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (diret√≥rio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HtmlAttribute</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ReferrerHoldAttribute</span></span></span><span class="hljs-class"> :</span></span> ActionFilterAttribute { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnActionExecuting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ActionExecutingContext filterContext)</span></span></span><span class="hljs-function"> </span></span>{ var referrer = filterContext.RequestContext.HttpContext.Request.UrlReferrer; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (referrer != null) filterContext.RouteData.Values.Add(<span class="hljs-string"><span class="hljs-string">"referrer"</span></span>, referrer); base.OnActionExecuting(filterContext); } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√â usado para armazenar informa√ß√µes sobre a p√°gina em que voc√™ precisa retornar depois de clicar no bot√£o " </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Novo usu√°rio</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> " ou em um link para alterar o usu√°rio: </font></font><code>TempData["referrer"] = ControllerContext.RouteData.Values["referrer"];</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Precisamos dela para que cada vez que n√£o escrevemos o mesmo c√≥digo em m√©todos diferentes. Seria poss√≠vel escrever uma fun√ß√£o separada no controlador, mas se v√°rios controladores forem usados, √© mais pr√°tico usar um tipo de atributo especial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Posteriormente, no corpo do m√©todo que processa as a√ß√µes das visualiza√ß√µes </font></font><code>New</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, as informa√ß√µes armazenadas s√£o extra√≠das e usadas para redirecionar de volta √† p√°gina de onde essas visualiza√ß√µes foram chamadas: </font></font><code>if (TempData["referrer"] != null) return Redirect(TempData["referrer"].ToString());</code> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para determinar se o usu√°rio precisa ser salvo ou exclu√≠do, o par√¢metro √© comparado </font></font><code>action</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Salvar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remova,</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> respectivamente, e as </font></font><code>UsersRepository</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fun√ß√µes </font></font><code>ChangeUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font><font style="vertical-align: inherit;">s√£o chamadas do reposit√≥rio </font></font><code>RemoveUser(model.User)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Depois, retornamos √† p√°gina anterior (de onde veio a chamada de visualiza√ß√£o </font></font><code>Edit</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) e uma mensagem √© exibida indicando o sucesso da opera√ß√£o ou a falha.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ADO.NET e MySQL - reposit√≥rio </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aqui finalmente conseguimos trabalhar com o DBMS. </font><font style="vertical-align: inherit;">Precisamos implementar as fun√ß√µes de adicionar um usu√°rio a uma tabela </font></font><code>Users</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, fazer altera√ß√µes nos dados do usu√°rio, remover um usu√°rio da tabela, obter o usu√°rio por ID, obter uma lista de usu√°rios e obter uma lista de idiomas da tabela </font></font><code>Languages</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constru√ß√µes principalmente padr√£o s√£o usadas para a classe </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL.Data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> usando </font></font><code>MySqlCommand</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection( )) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">" "</span></span>,  ).Value =  ; connect.Open(); result = cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//        (INSERT, UPDATE, DELETE)   cmd.ExecuteScalar()         SELECT } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ou </font></font><code>MySqlDataReader</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para ler as linhas da tabela como resultado de uma consulta:</font></font><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection( )) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">" "</span></span>,  ).Value =  ; objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (dr.Read()) {<span class="hljs-comment"><span class="hljs-comment">//       } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crie o arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserRepository.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no diret√≥rio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Models</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersRepository</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ user.UserID = AddUser(Name: user.Loginname, LanguageID: user.Language.LanguageID, Email: user.Email, SupporterTier: user.SupporterTier); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user.UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO `Users` (`Loginname`, `LanguageID`, `Email`, `SupporterTier`) VALUES (@Loginname, @LanguageID, @Email, @SupporterTier)"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>, MySqlDbType.String).Value = Name; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, MySqlDbType.Int32).Value = LanguageID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>, MySqlDbType.String).Value = Email; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>, MySqlDbType.Int32).Value = SupporterTier; connect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { sql = <span class="hljs-string"><span class="hljs-string">"SELECT LAST_INSERT_ID() AS ID"</span></span>; cmd.CommandText = sql; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>.TryParse(cmd.ExecuteScalar().ToString(), out ID); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ID; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ChangeUser(ID: user.UserID, Name: user.Loginname, LanguageID: user.Language.LanguageID, Email: user.Email, SupporterTier: user.SupporterTier); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChangeUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> LanguageID, </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Email, Supporter SupporterTier)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"UPDATE `Users` SET `Loginname`=@Loginname, `LanguageID`=@LanguageID, `Email`=@Email, `SupporterTier`=@SupporterTier WHERE UserID=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>, MySqlDbType.String).Value = Name; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>, MySqlDbType.Int32).Value = LanguageID; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>, MySqlDbType.String).Value = Email; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>, MySqlDbType.Int32).Value = SupporterTier; connect.Open(); result = cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(UserClass user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RemoveUser(user.UserID); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RemoveUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection connect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sql = <span class="hljs-string"><span class="hljs-string">"DELETE FROM `Users` WHERE `UserID`=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(sql, connect)) { cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; connect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cmd.ExecuteNonQuery() &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UserClass </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FetchByID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ID)</span></span></span><span class="hljs-function"> </span></span>{ UserClass user = null; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection objConnect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strSQL = <span class="hljs-string"><span class="hljs-string">"SELECT u.`UserID`, u.`Loginname`, l.`LanguageID`, l.`LanguageName`, u.`Email`, u.`LastLoginDate`, CAST(u.`SupporterTier` AS UNSIGNED) as `SupporterTier` FROM `Users` u LEFT JOIN `Languages` l ON l.LanguageID=u.LanguageID WHERE `UserID`=@UserID"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(strSQL, objConnect)) { objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> UserID = <span class="hljs-number"><span class="hljs-number">0</span></span>, LanguageID = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> Loginname = null, LanguageName= null, Email = String.Empty; Supporter SupporterTier = Supporter.None; DateTime? LastLoginDate = null; cmd.Parameters.Add(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>, MySqlDbType.Int32).Value = ID; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dr.Read()) { UserID = dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"UserID"</span></span>); Loginname = dr.GetString(<span class="hljs-string"><span class="hljs-string">"Loginname"</span></span>).ToString(); LanguageID = dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>); LanguageName = dr.GetString(<span class="hljs-string"><span class="hljs-string">"LanguageName"</span></span>).ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>))) Email = dr.GetString(<span class="hljs-string"><span class="hljs-string">"Email"</span></span>).ToString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"LastLoginDate"</span></span>))) LastLoginDate = dr.GetDateTime(<span class="hljs-string"><span class="hljs-string">"LastLoginDate"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!dr.IsDBNull(dr.GetOrdinal(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>))) SupporterTier = (Supporter)dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"SupporterTier"</span></span>); } LanguageClass language = null; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LanguageID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) language = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguageClass(LanguageID: LanguageID, LanguageName: LanguageName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; language != null &amp;&amp; language.LanguageID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) user = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UserClass(UserID: UserID, Loginname: Loginname, Language: language, Email: Email, LastLoginDate: LastLoginDate, SupporterTier: (Supporter)SupporterTier); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> user; } <span class="hljs-comment"><span class="hljs-comment">//       ASP.NET WebForms,             ObjectDataSource      //     ,         " "         //public IEnumerable&lt;DataRow&gt; List() //{ // using (MySqlConnection objConnect = new MySqlConnection(Base.strConnect)) // { // string strSQL = "select * from users"; // using (MySqlCommand objCommand = new MySqlCommand(strSQL, objConnect)) // { // objConnect.Open(); // using (MySqlDataAdapter da = new MySqlDataAdapter(objCommand)) // { // DataTable dt = new DataTable(); // da.Fill(dt); // return dt.AsEnumerable(); // } // } // } //} public IList&lt;UserClass&gt; List(string sortOrder, System.Web.Helpers.SortDirection sortDir, int page, int pagesize, out int count) { List&lt;UserClass&gt; users = new List&lt;UserClass&gt;(); using (MySqlConnection objConnect = new MySqlConnection(Base.strConnect)) { //     string sort = " ORDER BY "; //   ,               (inject) // ,  , MySQL        //    ,         (       ) //        ,    if (sortOrder != null &amp;&amp; sortOrder != String.Empty) { sort += "`" + sortOrder + "`"; if (sortDir == System.Web.Helpers.SortDirection.Descending) sort += " DESC"; sort += ","; } sort += "`UserID`"; //   //        ( ) string limit = ""; if (pagesize &gt; 0) { int start = (page - 1) * pagesize; limit = string.Concat(" LIMIT ", start.ToString(), ", ", pagesize.ToString()); } string strSQL = "SELECT SQL_CALC_FOUND_ROWS u.`UserID`, u.`Loginname`, l.`LanguageID`, l.`LanguageName` as `Language`, u.`Email`, u.`LastLoginDate`, CAST(u.`SupporterTier` AS UNSIGNED) as `SupporterTier` FROM `Users` u LEFT JOIN `Languages` l ON l.LanguageID=u.LanguageID" + sort + limit; using (MySqlCommand cmd = new MySqlCommand(strSQL, objConnect)) { objConnect.Open(); cmd.Parameters.Add("page", MySqlDbType.Int32).Value = page; cmd.Parameters.Add("pagesize", MySqlDbType.Int32).Value = pagesize; using (MySqlDataReader dr = cmd.ExecuteReader()) { while (dr.Read()) { LanguageClass language = new LanguageClass(LanguageID: dr.GetInt32("LanguageID"), LanguageName: dr.GetString("Language").ToString()); users.Add(new UserClass( UserID: dr.GetInt32("UserID"), Loginname: dr.GetString("Loginname"), Language: language, Email: dr.IsDBNull(dr.GetOrdinal("Email")) ? String.Empty : dr.GetString("Email"), LastLoginDate: dr.IsDBNull(dr.GetOrdinal("LastLoginDate")) ? (DateTime?) null : dr.GetDateTime("LastLoginDate"), SupporterTier: dr.IsDBNull(dr.GetOrdinal("SupporterTier")) ? (Supporter) Supporter.None : (Supporter)dr.GetInt32("SupporterTier"))); } } } using (MySqlCommand cmdrows = new MySqlCommand("SELECT FOUND_ROWS()", objConnect)) { int.TryParse(cmdrows.ExecuteScalar().ToString(), out count); } } return users; } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele cont√©m um m√©todo </font></font><code>AddUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para adicionar um usu√°rio, atualizar dados do usu√°rio ( </font></font><code>ChangeUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), excluir ( </font></font><code>RemoveUser</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), procurar usu√°rio ( </font></font><code>FetchByID</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) por identificador e o m√©todo mais interessante </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">para exibir uma lista paginada de usu√°rios com classifica√ß√£o. </font><font style="vertical-align: inherit;">Gostaria de comentar adicionalmente sobre a fun√ß√£o </font></font><code>List</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">N√£o vale a pena retornar a tabela ( </font></font><code>DataTable</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) como tal - nesse caso, perderemos a capacidade de acessar os elementos da classe na visualiza√ß√£o e seremos for√ßados a usar constantes de cadeia para se referir aos valores na linha da tabela.</font></font> I.e.          SQL-.       <code>UserClass</code> . </li><li>          <code>LIMIT</code>  SQL- <code>SELECT</code> .  ,  MySQL      ,   <code>LIMIT</code>       .   ,     ,       <code>ORDER BY</code>           . ,         SQL-,     SQL   ,       ,     .       ,      ,          :         . </li><li>           SQL  <code>SELECT FOUND_ROWS()</code> ,          ,     <code>SELECT SQL_CALC_FOUND_ROWS</code>     <code>LIMIT</code> . </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Todos os outros m√©todos s√£o completamente comuns, consistentes com o c√¢non acima. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">E o arquivo </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LanguageRepository.cs</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no diret√≥rio </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Models</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LanguagesRepository</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IList&lt;LanguageClass&gt; List() { List&lt;LanguageClass&gt; languages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;LanguageClass&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlConnection objConnect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlConnection(Base.strConnect)) { <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> strSQL = <span class="hljs-string"><span class="hljs-string">"SELECT `LanguageID`, `LanguageName` as `Language` FROM `Languages` ORDER BY `LanguageName`"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlCommand cmd = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySqlCommand(strSQL, objConnect)) { objConnect.Open(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MySqlDataReader dr = cmd.ExecuteReader()) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (dr.Read()) { LanguageClass language = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LanguageClass(LanguageID: dr.GetInt32(<span class="hljs-string"><span class="hljs-string">"LanguageID"</span></span>), LanguageName: dr.GetString(<span class="hljs-string"><span class="hljs-string">"Language"</span></span>).ToString()); languages.Add(language); } } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> languages; } }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ele possui apenas uma fun√ß√£o para obter uma lista de idiomas do banco de dados, criando uma lista de elementos de classe </font></font><code>LanguageClass</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h2>  Total </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isso √© tudo - a tarefa est√° resolvida. </font><font style="vertical-align: inherit;">√â claro que muitos problemas n√£o foram abordados: cont√™iner de inje√ß√£o de depend√™ncia, teste de unidade, ferramentas para zombar, localiza√ß√£o etc.</font></font> etc.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Algumas coisas podem ser feitas de maneira diferente ou simplesmente melhor. </font><font style="vertical-align: inherit;">Mas o "bloco" acabou completo o suficiente para entender como o ASP.NET MVC funciona e que n√£o √© t√£o assustador trabalhar com ADO.NET e DBMSs que n√£o s√£o MS SQL. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS E finalmente: voc√™ pode ver como este projeto funciona </font></font><a href="http://example-mvc.azurewebsites.net/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">neste endere√ßo</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">E </font></font><a href="https://yadi.sk/d/EArrZdGh_iVaJg" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqui</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> voc√™ pode baixar o projeto inteiro. </font><font style="vertical-align: inherit;">Bem, para a pilha - um link para o </font></font><a href="https://dukeyusupov.wordpress.com/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meu blog</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482346/">https://habr.com/ru/post/pt482346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482332/index.html">Como um entusiasta criou uma rede Wi-Fi no DOS</a></li>
<li><a href="../pt482336/index.html">Os comerciantes t√™m acesso a coletivas de imprensa do Banco Central da Inglaterra antes de sua transmiss√£o p√∫blica</a></li>
<li><a href="../pt482338/index.html">Visual Studio para Mac: controle seu IDE com chaves</a></li>
<li><a href="../pt482340/index.html">De Junior'a a Middle'a: Analisador</a></li>
<li><a href="../pt482344/index.html">Prepare-se para a introdu√ß√£o de uma classifica√ß√£o social na R√∫ssia</a></li>
<li><a href="../pt482348/index.html">Topologia e an√°lise abrangente para um desenvolvedor de jogos desavisado: compactando vetores 3D √∫nicos</a></li>
<li><a href="../pt482352/index.html">Como eu quase joguei 150k no vento ou na hist√≥ria da instala√ß√£o de ventila√ß√£o for√ßada no apartamento</a></li>
<li><a href="../pt482354/index.html">ConfigureAwait: perguntas freq√ºentes</a></li>
<li><a href="../pt482358/index.html">Como funciona o p√¢nico em Rust</a></li>
<li><a href="../pt482360/index.html">Detetive Habra: eles s√£o amigos dos OVNIs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>