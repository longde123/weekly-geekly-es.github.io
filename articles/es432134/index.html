<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üî• üé¥ üòÆ Generaci√≥n de entornos basados ‚Äã‚Äãen sonido y m√∫sica en Unity3D. Parte 2. Crear una pista 2D a partir de m√∫sica üö¥üèª üõ†Ô∏è üóø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anotaci√≥n 


 Hola a todos Hace relativamente poco tiempo, escrib√≠ un art√≠culo Generando un entorno basado en sonido y m√∫sica en Unity3D , en el que d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Generaci√≥n de entornos basados ‚Äã‚Äãen sonido y m√∫sica en Unity3D. Parte 2. Crear una pista 2D a partir de m√∫sica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/digital-ecosystems/blog/432134/"><h2 id="annotaciya">  Anotaci√≥n </h2><br><p>  Hola a todos  Hace relativamente poco tiempo, escrib√≠ un art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Generando un entorno basado en sonido y m√∫sica en Unity3D</a> , en el que di varios ejemplos de juegos que utilizan la mec√°nica de generar contenido basado en m√∫sica, y tambi√©n habl√© sobre los aspectos b√°sicos de dichos juegos.  Pr√°cticamente no hab√≠a c√≥digo en el art√≠culo y promet√≠ que habr√≠a una secuela.  Y aqu√≠ est√°, frente a ti.  Esta vez intentaremos crear una pista para una carrera en 2D, al estilo de Hill Climb, a partir de tu m√∫sica.  Veamos que tenemos ... </p><br><p><img src="https://habrastorage.org/webt/wp/6y/jk/wp6yjkpyoal7a3bzsg0ugeiuyvs.png"></p><a name="habracut"></a><br><h2 id="vvedenie">  Introduccion </h2><br><p>  Les recuerdo que esta serie de art√≠culos est√° dise√±ada para desarrolladores principiantes y para aquellos que recientemente comenzaron a trabajar con sonido.  Si est√° haciendo una r√°pida transformaci√≥n de Fourier en su mente, entonces probablemente se aburrir√°. </p><br><p>  Aqu√≠ est√° nuestra hoja de ruta para hoy: </p><br><ol><li>  Considere qu√© es la discretizaci√≥n. </li><li>  Descubra qu√© datos podemos obtener de Audio Clip Unity </li><li>  Comprenda c√≥mo podemos trabajar con estos datos. </li><li>  Descubra lo que podemos generar a partir de estos datos. </li><li>  Aprende a hacer un juego con todo esto (bueno, o algo similar a un juego) </li></ol><br><p>  ¬°Entonces vamos! </p><br><h2 id="diskretizaciya-analogovogo-singala">  Discretizaci√≥n de cingal√©s anal√≥gico </h2><br><p>  Como mucha gente sabe, para usar una se√±al en sistemas digitales, necesitamos convertirla.  Uno de los pasos de conversi√≥n es el muestreo de se√±al, en el que la se√±al anal√≥gica se divide en partes (informes temporales), despu√©s de lo cual a cada informe se le asigna el valor de amplitud que estaba en el momento seleccionado. <br><img src="https://habrastorage.org/webt/k-/r4/_0/k-r4_0pvvu8sxhcdxaybjnpsn0q.png"></p><br><p>  La letra T indica el per√≠odo de muestreo.  Cuanto m√°s corto sea el per√≠odo, m√°s precisa ser√° la conversi√≥n de la se√±al.  Pero la mayor√≠a de las veces hablan de la inversa: frecuencia de muestreo (es l√≥gico que sea F = 1 / T).  8,000 Hz es suficiente para una se√±al telef√≥nica y, por ejemplo, una de las opciones para el formato DVD-Audio requiere una frecuencia de muestreo de 192,000 Hz.  El est√°ndar en grabaci√≥n digital (en editores de juegos, editores de m√∫sica) es 44 100 Hz: esta es la frecuencia de CD de audio. </p><br><p>  Los valores num√©ricos de la amplitud se almacenan en las llamadas muestras y con ellos trabajaremos.  El valor de la muestra es flotante y puede ser de -1 a 1. Simplificado, se ve as√≠. </p><br><p><img src="https://habrastorage.org/webt/sj/rg/r7/sjrgr7njjj7iwmyi6nebdtpfxze.png"></p><br><h2 id="otrisovka-zvukovoy-volny-statichno">  Representaci√≥n de ondas sonoras (est√°tica) </h2><br><h3 id="bazovaya-informaciya">  Informaci√≥n b√°sica </h3><br><p>  La forma de onda (o forma de audio, y en la gente com√∫n: "pez") es una representaci√≥n visual de la se√±al de sonido a lo largo del tiempo.  La forma de onda puede mostrarnos en qu√© punto del sonido ocurre la fase activa y d√≥nde ocurre la atenuaci√≥n.  A menudo, la forma de onda se presenta para cada canal por separado, por ejemplo, as√≠: </p><br><p><img src="https://habrastorage.org/webt/hj/xr/vm/hjxrvm-bdrgt-myieappnmqxgb0.png"></p><br><p>  Imagine que ya tenemos un AudioSource y un script en el que trabajamos.  Veamos qu√© nos puede dar la Unidad. </p><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//  AudioSource    AudioSource myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); //     .     44100. int freq = myAudio.clip.frequency;</span></span></code> </pre> <br><h3 id="vybor-kol-va-otchetov">  Seleccionar n√∫mero de informes </h3><br><p>  Antes de continuar, necesitamos hablar un poco sobre la profundidad de renderizado de nuestro sonido.  Con una frecuencia de muestreo de 44100 Hz por segundo, podemos procesar 44100 informes.  Digamos que necesitamos renderizar una pista de 10 segundos de duraci√≥n.  Dibujaremos cada informe con una l√≠nea en un p√≠xel de ancho.  Resulta que nuestra forma de onda tendr√° 441,000 p√≠xeles de largo.  Obtienes una onda de sonido muy larga, alargada y poco comprendida.  ¬°Pero, en √©l puedes ver cada informe espec√≠fico!  Y cargar√° terriblemente el sistema, sin importar c√≥mo lo dibuje. </p><br><p><img src="https://habrastorage.org/webt/qr/yf/j6/qryfj6qyv0v5mrbzjfqz6qcws_y.png"></p><br><p>  Si no crea un software de audio profesional, no necesita tal precisi√≥n.  Para una imagen de audio general, podemos dividir todas las muestras en per√≠odos m√°s largos y tomar, por ejemplo, el promedio de cada 100 muestras.  Entonces nuestra ola tendr√° una forma muy distinta: </p><br><p><img src="https://habrastorage.org/webt/2v/yk/kz/2vykkzw2wtewvjzcwsfsz_h1zvq.png"></p><br><p>  Por supuesto, esto no es del todo exacto, ya que puede omitir los picos de volumen que pueda necesitar, por lo que puede probar no el valor promedio, sino el m√°ximo de este segmento.  Esto dar√° una imagen ligeramente diferente, pero sus picos no desaparecer√°n. </p><br><h3 id="podgotovka-k-polucheniyu-audiodannyh">  Preparando para recibir audio </h3><br><p>  Definamos la precisi√≥n de nuestra muestra como calidad y el n√∫mero final de informes como sampleCount. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; sampleCount = freq / quality;</code> </pre> <br><p>  Un ejemplo de c√°lculo de todos los n√∫meros estar√° debajo. </p><br><p>  Luego, necesitamos obtener las muestras nosotros mismos.  Esto se puede hacer desde un clip de audio utilizando el m√©todo <strong>GetData</strong> . </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> offsetSamples</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br><p>  Este m√©todo toma una matriz en la que escribe muestras.  offsetSamples: par√°metro responsable del punto de inicio de la lectura de la matriz de datos.  Si lees la matriz desde el principio, entonces deber√≠a haber cero. </p><br><p>  Para registrar muestras, necesitamos preparar una matriz para ellas.  Por ejemplo, as√≠: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-comment"><span class="hljs-comment">//      samples = new float[myAudio.clip.samples * myAudio.clip.channels];</span></span></code> </pre> <br><p>  ¬øPor qu√© multiplicamos la longitud por el n√∫mero de canales?  Ahora te dir√© ... </p><br><h3 id="informaciya-ob-audiokanalah-v-unity">  Informaci√≥n del canal de audio de Unity </h3><br><p>  Mucha gente sabe que en el sonido usualmente usamos dos canales: izquierdo y derecho.  Alguien sabe que hay sistemas 2.1, as√≠ como 5.1, 7.1 en los que las fuentes de sonido rodean desde todos los lados.  El tema de los canales est√° bien descrito <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la wiki</a> .  ¬øC√≥mo funciona esto en Unity? </p><br><p>  Al descargar un archivo, al abrir un clip, puede encontrar la siguiente imagen: </p><br><p><img src="https://habrastorage.org/webt/us/hy/tu/ushytu2q3jhyyl8sbx9tclnaf9i.png"></p><br><p>  Aqu√≠ se muestra que tenemos dos canales, e incluso puedes notar que son diferentes entre s√≠.  Unity graba muestras de estos canales uno tras otro.  Resulta esta imagen: <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mo" id="MJXp-Span-2" style="margin-left: 0em; margin-right: 0em;">[</span><span class="MJXp-msubsup" id="MJXp-Span-3"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-5" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-7"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-9" style="vertical-align: -0.4em;">1</span></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-11"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-13" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-14" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-17" style="vertical-align: -0.4em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-18" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-19"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-21" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-25" style="vertical-align: -0.4em;">3</span></span><span class="MJXp-mo" id="MJXp-Span-26" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-29" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-31"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-33" style="vertical-align: -0.4em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-34" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-35"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-37" style="vertical-align: -0.4em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-38" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-39"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-41" style="vertical-align: -0.4em;">5</span></span><span class="MJXp-mo" id="MJXp-Span-42" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-43"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-45" style="vertical-align: -0.4em;">6</span></span><span class="MJXp-mo" id="MJXp-Span-46" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-47"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-49" style="vertical-align: -0.4em;">6</span></span><span class="MJXp-mo" id="MJXp-Span-50" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-51"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-53" style="vertical-align: -0.4em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-54" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-55"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-57" style="vertical-align: -0.4em;">7</span></span><span class="MJXp-mo" id="MJXp-Span-58" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60" style="margin-right: 0.05em;">L</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-61" style="vertical-align: -0.4em;">8</span></span><span class="MJXp-mo" id="MJXp-Span-62" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-63"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-64" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-65" style="vertical-align: -0.4em;">8</span></span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-67" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-68" style="margin-left: 0em; margin-right: 0.222em;">.</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">]</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="63.547ex" height="2.66ex" viewBox="0 -832 27360.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-5B" x="0" y="0"></use><g transform="translate(278,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-31" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="1413" y="0"></use><g transform="translate(1859,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-31" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="3072" y="0"></use><g transform="translate(3517,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-32" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="4653" y="0"></use><g transform="translate(5098,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-32" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="6311" y="0"></use><g transform="translate(6756,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-33" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="7892" y="0"></use><g transform="translate(8337,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-33" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="9550" y="0"></use><g transform="translate(9995,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-34" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="11131" y="0"></use><g transform="translate(11576,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-34" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="12789" y="0"></use><g transform="translate(13235,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-35" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="14370" y="0"></use><g transform="translate(14815,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-35" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="16029" y="0"></use><g transform="translate(16474,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-36" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="17609" y="0"></use><g transform="translate(18054,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-36" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="19268" y="0"></use><g transform="translate(19713,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-37" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="20848" y="0"></use><g transform="translate(21293,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-37" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="22507" y="0"></use><g transform="translate(22952,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-38" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2C" x="24087" y="0"></use><g transform="translate(24533,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMATHI-52" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-38" x="1074" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2E" x="25746" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2E" x="26191" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-2E" x="26636" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=https://habr.com/ru/company/digital-ecosystems/blog/432134/&amp;usg=ALkJrhgKjLzDwv5MQr9mWKakEoFaYTV3eA#MJMAIN-5D" x="27082" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> [L_1, R_1, L_2, R_2, L_3, R_3, L_4, R_4, L_5, R_5, L_6, R_6, L_7, R_7, L_8, R_8 ...] </script></p><br><p>  Es por eso que necesitamos el doble de espacio en la matriz que solo para la cantidad de muestras. </p><br><p>  Si selecciona la opci√≥n de clip Forzar a mono, el canal ser√° uno y todo el sonido estar√° en el centro.  La vista previa de su ola cambiar√° de inmediato. </p><br><p><img src="https://habrastorage.org/webt/fx/pk/-f/fxpk-fvqtdsvhfvfyyvl1mjrjla.png"></p><br><p><img src="https://habrastorage.org/webt/po/62/s8/po62s86xpcbainozvupbpekwdig.png"></p><br><h3 id="poluchenie-audiodannyh">  Recibir datos de audio </h3><br><p>  Esto es lo que obtenemos: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,    .       waveFormArray = new float[(samples.Length / sampleCount)]; //             for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { //Abs     ""    . .  waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } }</span></span></code> </pre> <br><p>  Total, si la pista dura 10 segundos y tiene dos canales, obtenemos lo siguiente: </p><br><ul><li>  El n√∫mero de muestras en el clip (myAudio.clip.sample) = 44100 * 10 = 441000 </li><li>  La matriz de muestras para dos canales es larga (samples.Length) = 441000 * 2 = 882000 </li><li>  N√∫mero de informes (sampleCount) = 44100/100 = 441 </li><li>  La longitud de la matriz final = samples.Length / sampleCount = 2000 </li></ul><br><p>  Como resultado, trabajaremos con 2000 puntos, que es suficiente para dibujar la ola.  Ahora debe incluir la imaginaci√≥n y pensar en c√≥mo podemos usar estos datos. </p><br><h3 id="otrisovka-audioinformacii">  Representaci√≥n de informaci√≥n de audio </h3><br><h4 id="sozdanie-prostoy-audiodorozhki-s-pomoschyu-debug-sredstv">  Cree una pista de audio simple con las herramientas de depuraci√≥n </h4><br><p>  Como mucha gente sabe, Unity tiene medios convenientes para mostrar todo tipo de informaci√≥n de depuraci√≥n.  Un desarrollador inteligente basado en estas herramientas puede hacer, por ejemplo, extensiones muy potentes para el editor.  Nuestro caso muestra un uso muy at√≠pico de los m√©todos de depuraci√≥n. </p><br><p>  Para dibujar, necesitamos una l√≠nea.  Podemos hacerlo con la ayuda de un vector que se crear√° a partir de los valores de nuestra matriz.  Tenga en cuenta que para hacer una hermosa forma de audio espejo, necesitamos "pegar" las dos mitades de nuestra visualizaci√≥n. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length - <span class="hljs-number"><span class="hljs-number">1</span></span>; i++) { <span class="hljs-comment"><span class="hljs-comment">//      Vector3 upLine = new Vector3(i * .01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * .01f, -waveFormArray[i] * 10, 0); }</span></span></code> </pre> <br><p>  Luego, solo usa Debug.DrawLine para dibujar nuestros vectores.  Cualquier color puede elegir.  Todos estos m√©todos deben llamarse en Actualizaci√≥n, por lo que actualizaremos la informaci√≥n en cada cuadro. </p><br><pre> <code class="cs hljs">Debug.DrawLine(upLine, downLine, Color.green);</code> </pre> <br><p>  Si lo desea, puede agregar un "control deslizante" que mostrar√° la posici√≥n actual de la pista que se est√° reproduciendo.  Esta informaci√≥n se puede obtener del campo "AudioSource.timeSamples". </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white);</span></span></code> </pre> <br><p>  Total, aqu√≠ est√° nuestro script: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormDebug</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> debugLineWidth = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-comment"><span class="hljs-comment">//  freq = myAudio.clip.frequency; sampleCount = freq / quality; //  samples = new float[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, 0); //       waveFormArray = new float[(samples.Length / sampleCount)]; for (int i = 0; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = 0; for (int j = 0; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount; } } private void Update() { for (int i = 0; i &lt; waveFormArray.Length - 1; i++) { //      Vector3 upLine = new Vector3(i * 0.01f, waveFormArray[i] * 10, 0); //      Vector3 downLine = new Vector3(i * 0.01f, -waveFormArray[i] * 10, 0); // Debug  Debug.DrawLine(upLine, downLine, Color.green); } // ""  .       int currentPosition = (myAudio.timeSamples / quality) * 2; Vector3 drawVector = new Vector3(currentPosition * 0.01f, 0, 0); Debug.DrawLine(drawVector - Vector3.up * debugLineWidth, drawVector + Vector3.up * debugLineWidth, Color.white); } }</span></span></code> </pre> <br><p>  Y aqu√≠ est√° el resultado: </p><br><p><img src="https://habrastorage.org/webt/gq/ij/fd/gqijfdc9d3b6t1nemd-wqsxqn70.png"></p><br><h4 id="sozdanie-plavnogo-zvukovogo-landshafta-s-pomoschyu-polygoncollider2d">  Cree un paisaje sonoro suave con PolygonCollider2D </h4><br><p>  Antes de continuar con esta secci√≥n, quiero se√±alar lo siguiente: por supuesto, conducir por la pista generada por la m√∫sica es divertido, pero desde el punto de vista del juego es pr√°cticamente in√∫til.  Y aqu√≠ est√° el por qu√©: </p><br><ol><li>  Para que la pista sea transitable, necesitamos suavizar nuestros datos.  Todos los picos desaparecen y pr√°cticamente dejas de "sentir tu m√∫sica" </li><li>  Por lo general, las pistas de m√∫sica est√°n muy comprimidas y representan un ladrillo de sonido, que no es adecuado para un juego en 2D. </li><li>  El problema no resuelto de la velocidad de nuestro transporte, que deber√≠a ser adecuado para la velocidad de la pista.  Quiero considerar este problema en el pr√≥ximo art√≠culo. </li></ol><br><p>  Por lo tanto, como experimento, este tipo de generaci√≥n es bastante divertido, pero es dif√≠cil crear una funci√≥n de juego real basada en √©l.  En cualquier caso, continuamos. </p><br><p>  Entonces, necesitamos hacer PolygonCollider2D usando nuestros datos.  Esto es f√°cil de hacer.  PolygonCollider2D tiene un campo de puntos p√∫blicos que acepta Vector2 [].  Primero, necesitamos transferir nuestros puntos a los vectores del tipo deseado.  Hagamos una funci√≥n para traducir la matriz de nuestras muestras en una matriz de vectores: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Vector2[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreatePath</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] src</span></span></span><span class="hljs-function">)</span></span> { Vector2[] result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2[src.Length]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; size; i++) { result[i] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Vector2(i * <span class="hljs-number"><span class="hljs-number">0.01f</span></span>, Mathf.Abs(src[i] * lineScale)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre> <br><p>  Despu√©s de eso, simplemente pase nuestra matriz de vectores resultante al colisionador: </p><br><pre> <code class="cs hljs">path = CreatePath(waveFormArray); poly.points = path;</code> </pre> <br><p>  Nos fijamos en el resultado.  Aqu√≠ est√° el comienzo de nuestra pista ... hmm ... no parece muy aceptable (no pienses en la visualizaci√≥n todav√≠a, los comentarios vendr√°n m√°s tarde). </p><br><p><img src="https://habrastorage.org/webt/e-/3e/ry/e-3eryzi385zy3f4r-hvnsi0iwc.png"></p><br><p>  Tenemos una forma de audio demasiado n√≠tida, por lo que la pista resulta extra√±a.  Necesito suavizarlo.  Aqu√≠ usamos el algoritmo de promedio m√≥vil.  Puede leer m√°s al respecto en Habr, en el art√≠culo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El algoritmo de la media m√≥vil (media m√≥vil simple)</a> . </p><br><p>  En Unity, el algoritmo se implementa de la siguiente manera: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MovingAverage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> frameSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgPoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[data.Length - frameSize + <span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> counter = <span class="hljs-number"><span class="hljs-number">0</span></span>; counter &lt;= data.Length - frameSize; counter++) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> innerLoopCounter = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index = counter; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += <span class="hljs-number"><span class="hljs-number">1</span></span>; index += <span class="hljs-number"><span class="hljs-number">1</span></span>; } avgPoints[counter] = sum / frameSize; sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> avgPoints; }</code> </pre> <br><p>  Modificamos nuestra creaci√≥n de ruta: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path;</code> </pre> <br><p>  Comprobando ... </p><br><p><img src="https://habrastorage.org/webt/m5/rk/sb/m5rksbekvjfd45482gbgprvnmn0.png"></p><br><p>  Ahora nuestra pista se ve bastante normal.  Utilic√© un ancho de ventana de 10. Puede modificar este par√°metro para elegir el suavizado que necesita. </p><br><p>  Aqu√≠ est√° la secuencia de comandos completa para esta secci√≥n: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WaveFormTest</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> frameSize = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size = <span class="hljs-number"><span class="hljs-number">2048</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PolygonCollider2D poly; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lineScale = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> quality = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> sampleCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] waveFormArray; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] samples; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Vector2[] path; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioSource myAudio; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { myAudio = gameObject.GetComponent&lt;AudioSource&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> freq = myAudio.clip.frequency; sampleCount = freq / quality; samples = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[myAudio.clip.samples * myAudio.clip.channels]; myAudio.clip.GetData(samples, <span class="hljs-number"><span class="hljs-number">0</span></span>); waveFormArray = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(samples.Length / sampleCount)]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; waveFormArray.Length; i++) { waveFormArray[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; j &lt; sampleCount; j++) { waveFormArray[i] += Mathf.Abs(samples[(i * sampleCount) + j]); } waveFormArray[i] /= sampleCount * <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  ,    frameSize float[] avgArray = MovingAverage(frameSize, waveFormArray); path = CreatePath(avgArray); poly.points = path; } private Vector2[] CreatePath(float[] src) { Vector2[] result = new Vector2[src.Length]; for (int i = 0; i &lt; size; i++) { result[i] = new Vector2(i * 0.01f, Mathf.Abs(src[i] * lineScale)); } return result; } private float[] MovingAverage(int frameSize, float[] data) { float sum = 0; float[] avgPoints = new float[data.Length - frameSize + 1]; for (int counter = 0; counter &lt;= data.Length - frameSize; counter++) { int innerLoopCounter = 0; int index = counter; while (innerLoopCounter &lt; frameSize) { sum = sum + data[index]; innerLoopCounter += 1; index += 1; } avgPoints[counter] = sum / frameSize; sum = 0; } return avgPoints; } }</span></span></code> </pre> <br><p>  Como dije al comienzo de la secci√≥n, con este suavizado, dejamos de sentir la pista, adem√°s, la velocidad de la m√°quina no est√° vinculada a la velocidad de la m√∫sica (BPM).  Analizaremos este problema en la siguiente parte de esta serie de art√≠culos.  Adem√°s, all√≠ tocaremos el tema de los especiales.  efectos bajo el ritmo.  Por cierto, tom√© una m√°quina de escribir de este <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">activo gratuito</a> . </p><br><p>  Probablemente muchos de ustedes, mirando las capturas de pantalla, se preguntaron c√≥mo dibuj√© la pista en s√≠.  Despu√©s de todo, los colisionadores no son visibles. </p><br><p>  Utilic√© la sabidur√≠a de Internet y encontr√© una manera por la cual puedes convertir un colisionador de pol√≠gonos en una malla a la que puedes asignar cualquier material, y el renderizador de l√≠neas har√° un contorno elegante.  Este m√©todo se describe en detalle <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> .  Triangulator puedes enfrentarte a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Unity Community</a> . </p><br><h2 id="zavershenie">  Finalizaci√≥n </h2><br><p>  Lo que aprendimos en este art√≠culo es un boceto b√°sico para juegos musicales.  S√≠, de esta forma es, hasta ahora, un poco feo, pero puedes decir con seguridad "¬°Chicos, hice que la m√°quina siguiera la pista de audio!".  Para que este sea un juego real, debes hacer un gran esfuerzo.  Aqu√≠ hay una lista de lo que podemos hacer aqu√≠: </p><br><ol><li>  Ate la velocidad de la m√°quina a la pista BPM.  El jugador solo puede controlar la inclinaci√≥n del autom√≥vil, pero no la velocidad.  Entonces la m√∫sica se sentir√° mucho m√°s fuerte durante el curso. </li><li>  Haga un detector de bits y agregue especiales.  efectos que funcionar√°n bajo el ritmo.  Adem√°s, puede agregar animaci√≥n a la carrocer√≠a del autom√≥vil, que rebotar√° al ritmo de un latido.  Todo depende de tu imaginaci√≥n. </li><li>  En lugar de la media m√≥vil, debe procesar la pista de manera m√°s competente y obtener una matriz de datos para que los picos no desaparezcan, pero fue f√°cil crear una traza. </li><li>  Bueno, y, por supuesto, debes hacer que el juego sea interesante.  Puedes colocar una moneda en cada golpe, agregar zonas de peligro, etc. </li></ol><br><p>  Estudiaremos todo esto y mucho m√°s en las partes restantes de esta serie de art√≠culos.  Gracias a todos por leer! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es432134/">https://habr.com/ru/post/es432134/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es432120/index.html">Lenovo pagar√° a los propietarios de computadoras port√°tiles $ 8.3 millones de compensaci√≥n por instalar el malware Superfish</a></li>
<li><a href="../es432122/index.html">Xcode y depuraci√≥n avanzada en LLDB: parte 2</a></li>
<li><a href="../es432128/index.html">Muletas, Narnia, Procrustes Ninja: tres dolores t√≠midos en una startup</a></li>
<li><a href="../es432130/index.html">Autumn Mitaps sobre desarrollo m√≥vil en la oficina de Tutu.ru</a></li>
<li><a href="../es432132/index.html">William Shakespeare: dificultades para traducir sonetos al ruso</a></li>
<li><a href="../es432136/index.html">Enfr√≠e la CPU en el centro de datos: la impresi√≥n l√°ser 3D ayudar√°</a></li>
<li><a href="../es432138/index.html">Hablemos de las m√©tricas como una forma de evaluar el trabajo de un programador.</a></li>
<li><a href="../es432142/index.html">Monitoreo de colmena y proyecto abierto</a></li>
<li><a href="../es432144/index.html">C√≥mo nos integramos para las tiendas SAP en Europa con cajas en Rusia a trav√©s de 1C</a></li>
<li><a href="../es432146/index.html">Zimbra Collaboration Suite como un digno reemplazo para Microsoft Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>