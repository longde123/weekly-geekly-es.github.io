<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§∂üèø üë∑üèº üíû nanoFOX - un simple noyau compatible RISC-V üì∞ üë®üèæ‚Äçü§ù‚Äçüë®üèΩ üìä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Une petite introduction: 


 L'id√©e d'√©crire votre propre noyau est venue apr√®s avoir pass√© un s√©minaire-√©cole sur les circuits num√©riques dans la vil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>nanoFOX - un simple noyau compatible RISC-V</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/451388/"><h3 id="nebolshoe-vstuplenie">  Une petite introduction: </h3><br><p> L'id√©e d'√©crire votre propre noyau est venue apr√®s avoir pass√© un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">s√©minaire-√©cole sur les circuits num√©riques dans la ville de Tomsk</a> .  Lors de cet √©v√©nement, familiarisation avec les langages de description du mat√©riel actuels (Verilog HDL et VHDL), ainsi qu'avec un petit processeur core <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">schoolMIPS</a> .  Pour comprendre la structure des noyaux, il a √©t√© d√©cid√© d'inventer leur propre v√©lo, en suivant le chemin du d√©veloppement de schoolMIPS, mais en prenant un autre syst√®me de commande comme base.  En raison de la popularit√© croissante de RISC-V et de l'ouverture de son syst√®me de commande (MIPS n'avait pas de syst√®me de commande ouvert au moment de l'√©criture du noyau), un ensemble d'instructions RISC-V, √† savoir RV32I, a √©t√© choisi pour le d√©veloppement du futur noyau.  RV32I poss√®de un petit ensemble d'instructions de base (37 √† l'exception des instructions sp√©ciales) et, si vous le souhaitez, il peut √™tre √©tendu, par exemple, en ajoutant des instructions de multiplication et de division enti√®res (RV32M) ou la prise en charge des instructions compress√©es (RV32C).  De plus, ce projet a √©t√© con√ßu comme √©ducatif, il a donc √©t√© d√©cid√© de maximiser la visibilit√© du noyau pour d√©montrer efficacement son travail. </p><br><p>  Par analogie avec schoolMIPS, les versions de noyau suivantes ont √©t√© impl√©ment√©es: </p><br><ol><li>  Version √† cycle unique (00_simple_risc_v_cpu). </li><li>  Une version √† cycle unique avec prise en charge des instructions lw / sw (mot de chargement / mot de stockage) (01_simple_risc_v_cpu_lwsw). </li><li>  Version pipeline (convoyeur √† 5 √©tages) (02_pipe_risc_v_cpu). </li></ol><br><p>  Actuellement, la prochaine version du noyau est d√©crite (03_pipe_risc_v_cpu_fc) avec un ensemble complet de commandes RV32I (sans prendre en compte certaines sp√©ciales). </p><a name="habracut"></a><br><h3 id="kratkaya-informaciya">  Br√®ve information: </h3><br><p>  Au cours de la description du noyau, des moyens d'am√©liorer la visibilit√© du travail, le d√©bogage et la v√©rification ont √©t√© pens√©s.  Actuellement mis en ≈ìuvre les m√©thodes suivantes: </p><br><ol><li><p>  Ajout d'un module VGA de texte de d√©bogage (pour deux branches de noyau √† cycle unique).  L'inclusion de ce module vous permet de suivre simultan√©ment la valeur de 32 registres sur l'√©cran du moniteur, ce qui n'est pas possible lorsque vous utilisez la sortie d'informations sur des indicateurs √† sept segments.  Dans les figures pr√©sent√©es ci-dessous, le noyau calcule les nombres Leonardo et affiche des informations sur le module de d√©bogage correspondant; <br><br></p><br><div class="spoiler">  <b class="spoiler_title">hex_display et DebugScreenCore</b> <div class="spoiler_text"><p>  Production d'informations sur les indicateurs √† sept segments: <a href=""><img src="https://habrastorage.org/webt/7r/at/zo/7ratzo8oi49q1f_ek3jt-ruzds4.gif" alt="image"></a> <br>  Sortie d'informations sur l'√©cran VGA: <a href=""><img src="https://habrastorage.org/webt/_z/bf/ya/_zbfyafwvt-iiqcyldocwdejy9u.gif" alt="image"></a> </p></div></div><br></li><li><p>  Ajout de messages au terminal de simulation sur l'√©tat du fichier de registre et l'ex√©cution actuelle des instructions.  Cette m√©thode vous permet de mieux analyser le fonctionnement du noyau dans les premiers stades de d√©veloppement, mais n'est pas toujours pratique; <br><br></p><br><div class="spoiler">  <b class="spoiler_title">Terminal</b> <div class="spoiler_text"><p>  Initialisation du fichier de registre: <a href=""><img src="https://habrastorage.org/webt/od/27/en/od27enfo2ibej0nvimcacjcdrco.png" alt="image"></a> <br>  Modifier la valeur sp: <a href=""><img src="https://habrastorage.org/webt/dx/5v/mo/dx5vmozlintg2jroatbavwu5vm4.png" alt="image"></a> </p></div></div><br></li><li><p>  Ajout de variables de cha√Æne √† la forme d'onde avec l'affichage d'instructions ex√©cutables.  En utilisant ces variables de cha√Æne, le d√©veloppeur peut suivre le r√©glage correct des signaux de contr√¥le √† toutes les √©tapes du pipeline; <br><br></p><br><div class="spoiler">  <b class="spoiler_title">Forme d'onde</b> <div class="spoiler_text"><p>  Initialisation du fichier de registre: <a href=""><img src="https://habrastorage.org/webt/4f/u2/qt/4fu2qtvi_h4om4jam78ly4zk-vg.png" alt="image"></a> <br>  Modifier la valeur sp: <a href=""><img src="https://habrastorage.org/webt/fm/di/fk/fmdifk9sfizk1tdf1rkcwpf_7yu.png" alt="image"></a> </p></div></div><br></li><li><p>  Ajout de la possibilit√© d'√©crire des informations de d√©bogage sur l'√©tat du noyau dans un fichier texte.  L'√©tat du fichier de registre est pr√©sent√© sous forme de tableau, et les instructions actuellement ex√©cut√©es par le noyau sont √©galement indiqu√©es.  C'est un analogue de 2 points, mais permet plus de manipulations avec les informations re√ßues; <br><br></p><br><div class="spoiler">  <b class="spoiler_title">Fichier texte</b> <div class="spoiler_text"><p>  Initialisation du fichier de registre: <a href=""><img src="https://habrastorage.org/webt/ob/wp/i_/obwpi_h38heumilss3rumhiau8i.png" alt="image"></a> <br>  Modifier la valeur sp: <a href=""><img src="https://habrastorage.org/webt/ua/wa/qb/uawaqbhqgb3v_rsn0i9re3hkaas.png" alt="image"></a> </p></div></div><br></li><li><p>  Ajout de la possibilit√© d'√©crire des informations de d√©bogage sur l'√©tat du noyau dans un fichier HTML.  L'√©tat du fichier de registre est pr√©sent√© sous forme de tableau avec des notes sur la modification des valeurs des cellules, ainsi que les instructions en cours d'ex√©cution par le noyau sont affich√©es.  Il s'agit d'un analogue des paragraphes 2 et 4, mais en plus de cela, il vous permet d'indiquer facilement une modification des donn√©es.  Comme on peut le voir sur les images ci-dessous, si la valeur du registre n'a pas √©t√© d√©finie, les registres sont surlign√©s en rouge (registres s0 / fp - t6).  Au cycle 17, la valeur du registre s0 / fp change et la cellule est surlign√©e en vert. <br>  Au cycle 41, la valeur 0x00010000 est charg√©e dans le registre sp. <br><br></p><br><div class="spoiler">  <b class="spoiler_title">Fichier HTML</b> <div class="spoiler_text"><p>  Initialisation du fichier de registre: <a href=""><img src="https://habrastorage.org/webt/d7/96/v4/d796v4kj0t_pcfhbepzqndka8ny.png" alt="image"></a> <br>  Modifier la valeur sp: <a href=""><img src="https://habrastorage.org/webt/dc/dd/9c/dcdd9c7vu-rd8tkzfjggwffwhe0.png" alt="image"></a> </p></div></div><br></li></ol><br><div class="spoiler">  <b class="spoiler_title">Comparaison des branches du noyau:</b> <div class="spoiler_text"><p>  Instructions du noyau actuellement prises en charge pour diff√©rentes branches: </p><br><div class="scrollable-table"><table><thead><tr><th>  Manuel d'instructions </th><th>  00_simple_risc_v_cpu </th><th>  01_simple_risc_v_cpu_lwsw </th><th>  02_pipe_risc_v_cpu </th></tr></thead><tbody><tr><td>  ajouter </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  et </td><td>  - </td><td>  - </td><td>  + </td></tr><tr><td>  sll </td><td>  - </td><td>  - </td><td>  + </td></tr><tr><td>  ou </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  addi </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  ori </td><td>  - </td><td>  - </td><td>  + </td></tr><tr><td>  slli </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  lw </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  jalr </td><td>  - </td><td>  - </td><td>  + </td></tr><tr><td>  lui </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  beq </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  bne </td><td>  - </td><td>  - </td><td>  + </td></tr><tr><td>  sw </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  jal </td><td>  - </td><td>  - </td><td>  + </td></tr><tr><td>  sous </td><td>  + </td><td>  + </td><td>  - </td></tr></tbody></table></div><br><p>  P√©riph√©riques pris en charge: </p><br><div class="scrollable-table"><table><thead><tr><th>  P√©riph√©riques </th><th>  00_simple_risc_v_cpu </th><th>  01_simple_risc_v_cpu_lwsw </th><th>  02_pipe_risc_v_cpu </th></tr></thead><tbody><tr><td>  RAM </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  Pwm </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  GPIO </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  UART </td><td>  - </td><td>  - </td><td>  + </td></tr></tbody></table></div><br><p>  Langues prises en charge pour l'√©criture de programmes: </p><br><div class="scrollable-table"><table><thead><tr><th>  La langue </th><th>  00_simple_risc_v_cpu </th><th>  01_simple_risc_v_cpu_lwsw </th><th>  02_pipe_risc_v_cpu </th></tr></thead><tbody><tr><td>  Assembleur </td><td>  + </td><td>  + </td><td>  + </td></tr><tr><td>  C </td><td>  - </td><td>  - </td><td>  + </td></tr></tbody></table></div><br><p>  Ressources FPGA requises pour le noyau (nf_cpu): </p><br><p>  EP4CE22F17C6 (de0_nano): </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  01_simple_risc_v_cpu_lwsw </th><th>  02_pipe_risc_v_cpu </th><th>  03_pipe_risc_v_cpu_fc </th></tr></thead><tbody><tr><td>  Nombre total de bits de m√©moire </td><td>  0/608 256 (0%) </td><td>  2.048 / 608.256 (&lt;1%) </td><td>  2.144 / 608.256 (&lt;1%) </td></tr><tr><td>  Total √©l√©ments logiques </td><td>  3,645 / 22,320 (16%) </td><td>  1 739/22 320 (8%) </td><td>  2 058/22 320 (9%) </td></tr><tr><td>  Fonctions combinatoires totales </td><td>  2,653 / 22,320 (12%) </td><td>  1 472/22 320 (7%) </td><td>  1 838/22 320 (8%) </td></tr><tr><td>  Registres logiques d√©di√©s </td><td>  1.055 / 22.320 (5%) </td><td>  575/22 320 (3%) </td><td>  606/22 320 (3%) </td></tr></tbody></table></div><br><p>  10M50DAF484C7G (de10_lite): </p><br><div class="scrollable-table"><table><thead><tr><th></th><th>  00_simple_risc_v_cpu </th><th>  01_simple_risc_v_cpu_lwsw </th><th>  02_pipe_risc_v_cpu </th><th>  03_pipe_risc_v_cpu_fc </th></tr></thead><tbody><tr><td>  Nombre total de bits de m√©moire </td><td>  0/1 677 312 (0%) </td><td>  0/1 677 312 (0%) </td><td>  2 048/1 677 312 (&lt;1%) </td><td>  2.144 / 1.677.312 (&lt;1%) </td></tr><tr><td>  Total √©l√©ments logiques </td><td>  2.851 / 49.760 (6%) </td><td>  2.881 / 49.760 (6%) </td><td>  1 629/49 760 (3%) </td><td>  1,927 / 49,760 (4%) </td></tr><tr><td>  Fonctions combinatoires totales </td><td>  2,613 / 49,760 (5%) </td><td>  2,653 / 49,760 (5%) </td><td>  1 473/49 760 (3%) </td><td>  1 849/49 760 (4%) </td></tr><tr><td>  Registres logiques d√©di√©s </td><td>  1 055/49 760 (2%) </td><td>  1 055/49 760 (2%) </td><td>  575/49 760 (1%) </td><td>  606/49 760 (1%) </td></tr></tbody></table></div></div></div><br><h3 id="razvitie-proekta">  D√©veloppement de projet. </h3><br><p>  Ce qui devrait √™tre fait √† l'avenir: </p><br><ol><li>  ajouter toutes les instructions RV32I (au stade de la description); </li><li>  impl√©menter le d√©bogage; </li><li>  ajouter un contr√¥leur DMA (DMA); </li><li>  ajouter le support pour d'autres pneus AXI, Avalon, Wishbone; </li><li>  ajouter de la m√©moire cache (cache); </li><li>  int√©grer divers p√©riph√©riques (SPI, TWI (I2C), Ethernet (10 base-t)); </li><li>  ajouter un contr√¥leur d'interruption; </li><li>  porter diff√©rentes versions sur d'autres cartes de d√©bogage; </li><li>  ajouter d'autres m√©thodes pour augmenter la visibilit√© du noyau; </li><li>  ex√©cutant RTOS, par exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zephyr</a> . </li></ol><br><p>  Les recommandations et suggestions pour le d√©veloppement du noyau sont √©galement accept√©es. </p><br><p>  Lien vers le r√©f√©rentiel: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nanoFOX</a> . </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr451388/">https://habr.com/ru/post/fr451388/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr451378/index.html">Likbez de m√©moire: ce qu'il se passe et ce qu'il nous apporte</a></li>
<li><a href="../fr451380/index.html">J'avais une vision ... R√©v√©lations du nouveau Nostradamus</a></li>
<li><a href="../fr451382/index.html">Deux en un: Intel Optane Memory H10 (Partie 1)</a></li>
<li><a href="../fr451384/index.html">Partie 5. Programmeur de carri√®re. Au milieu. La crise. Premi√®re version</a></li>
<li><a href="../fr451386/index.html">Deux en un: Intel Optane Memory H10 (partie 2)</a></li>
<li><a href="../fr451390/index.html">√âteinte il y a 136 mille ans, l'esp√®ce d'oiseaux "Cuvier berg√®re" a repris vie aux Seychelles</a></li>
<li><a href="../fr451392/index.html">Opus sur Sa Majest√© Clay. Premi√®re partie - Introduction</a></li>
<li><a href="../fr451394/index.html">Pourquoi les graphiques vectoriels 2D sont beaucoup plus complexes que la 3D</a></li>
<li><a href="../fr451396/index.html">Comment √©quiper un m√©gaphone</a></li>
<li><a href="../fr451400/index.html">Brillance et pauvret√©: comment gagner sa vie si vous √™tes musicien</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>