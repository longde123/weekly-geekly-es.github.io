<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÖüèæ üéµ üò£ Tableau de bord Grafana pour syst√®me de bi√®re BeerTender ‚ò™Ô∏è üß¶ ‚úÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Explication. BeerTender - un appareil pour refroidir et mettre en bouteille la bi√®re de Krups et Heineken. Selon les fabricants, il maintient la quali...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Tableau de bord Grafana pour syst√®me de bi√®re BeerTender</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/itsumma/blog/477870/">  <i>Explication.</i>  <i>BeerTender - un appareil pour refroidir et mettre en bouteille la bi√®re de Krups et Heineken.</i>  <i>Selon les fabricants, il maintient la qualit√© de la bi√®re fra√Æche pendant 30 jours apr√®s l'ouverture du f√ªt.</i>  <i>Bien s√ªr, il est pratique pour les administrateurs syst√®me et les d√©veloppeurs de surveiller la temp√©rature et le niveau de bi√®re dans leur f√ªt en utilisant les tableaux de bord en ligne habituels.</i>  <i>L'article pr√©c√©dent d√©crivait <a href="https://blog.senx.io/connecting-a-beertender-to-warp-10-using-mqtt-on-lorawan-with-thethingsnetwork/">comment connecter BeerTender √† Warp 10</a> , et maintenant nous allons configurer le tableau de bord Grafana</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/edf/3a3/ce5/edf3a3ce53ae1323eb8697358f0256bd.png"><br><br>  OVHcloud, le plus grand h√©bergeur et fournisseur de cloud europ√©en, utilise activement la plate-forme Warp 10. Toutes leurs donn√©es de surveillance circulent dans un cluster Warp 10.  Ce sont 400 000 serveurs, 27 centres de donn√©es, un total de plusieurs millions de m√©triques par seconde! <br><br>  Ils ont de nombreux tableaux de bord, et maintenant OVHcloud est le mainteneur du <a href="https://github.com/ovh/ovh-warp10-datasource">plugin</a> open source <a href="https://github.com/ovh/ovh-warp10-datasource">Warp 10 Grafana</a> , que nous avons commenc√© √† d√©velopper il y a quelque temps.  Nous allons parler de lui.  Si vous voulez l'essayer vous-m√™me, les donn√©es sont dans le domaine public - vous pouvez copier WarpScript ci-dessous. <br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1d3/a63/100/1d3a631002ed21c5c17014adf259d785.png"></div><br>  <i><font color="gray"><a href="https://blog.senx.io/connecting-a-beertender-to-warp-10-using-mqtt-on-lorawan-with-thethingsnetwork/">Nous avons d√©j√† expliqu√©</a> comment connecter BeerTender √† Warp 10.</font></i> <br><br><h2>  L'installation </h2><br>  Tout d'abord, installez Grafana.  Suivez les <a href="https://grafana.com/grafana/download">instructions sur leur site Web</a> . <br><br>  Nous nous connectons √† l' <code>http://localhost:3000/</code> par d√©faut <code>http://localhost:3000/</code> , acc√©dez au mot de passe par d√©faut admin / admin, puis changez le mot de passe administrateur. <br><br>  Pour la derni√®re version de Grafana, le plug-in devra √™tre install√© manuellement.  La m√©thode avec <code>grafana-cli</code> ne fonctionnera pas.  Il vous suffit de cloner le r√©f√©rentiel de plugins dans le r√©pertoire des plugins de Grafana et de fixer les autorisations partout. <br><br><pre> <code class="bash hljs">sudo systemctl stop grafana-server.service sudo chown -R grafana:mygroup /var/lib/grafana/ sudo chmod g+rw /var/lib/grafana/plugins git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git@github.com:ovh/ovh-warp10-datasource.git /var/lib/grafana/plugins/ovh-warp10-datasource sudo chown -R grafana:mygroup /var/lib/grafana/plugins sudo systemctl start grafana-server.service</code> </pre> <br><h2>  La configuration </h2><br>  Dans la configuration Grafana, acc√©dez √† la section Sources de donn√©es et ajoutez une source de donn√©es de type Warp 10. Assurez-vous qu'elle pointe vers l'instance souhait√©e de Warp 10. Vous pouvez sp√©cifier les m√™mes param√®tres que les n√¥tres: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/458/542/267/458542267fe277be0e54ab6ac358df53.png"></div><br><br>  Il est temps de prendre les donn√©es du BeerTender ... <br><br><h2>  Affichage de la temp√©rature </h2><br>  Cr√©ez un nouveau tableau de bord, ajoutez un panneau avec le type de visualisation Graphique et passez en mode Requ√™tes: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/04c/4c2/c72/04c4c2c72c65f5ba669aca9d86f7c401.png"><br>  <i><font color="gray">Temp√©rature initiale (valeurs enti√®res du capteur)</font></i> <br><br><ul><li>  Dans la source de donn√©es, s√©lectionnez Warp 10 (ou la valeur par d√©faut) <br></li><li>  Activez l'√©diteur WarpScript <br></li><li>  Copiez WarpScript ci-dessous <br></li><li>  Dans le coin sup√©rieur droit, s√©lectionnez "30 derniers jours" <br></li><li>  Enregistrez le r√©sultat </li></ul><br><pre> <code class="plaintext hljs">"gCA1SVjbDkaxtmTx9ydI4TI2iGc5hFgcbCWnzMRZSt45XW8dZ53Z7VK_if28i0kXwNDLazXHgLrXUKgxLK0RbS79eJmBCpyBlIxw9US7bPfdWH4Fta51.kXN.D4Hsk5OZOwl.vLRBzMpP7F2pAMfclMXSGtCOT6F" 'rt' STORE [ $rt 'beertender.rawtemperature' {} NOW 30 d ] FETCH 0 GET</code> </pre> <br>  Ce script affichera les valeurs initiales du capteur ADC.  Veuillez noter que l'√©diteur WarpScript dans Grafana n'est pas aussi puissant qu'auparavant, il n'y a plus de saisie automatique ici.  Vous pouvez √©crire un script dans WarpStudio ou VSCode, vous aurez donc la coloration syntaxique et la documentation en ligne, puis copiez et collez le r√©sultat dans Grafana. <br><br><h4>  Espacement automatique </h4><br>  Dans cet exemple, s√©lectionnez l'intervalle de 30 jours et d√©finissez le mode d'affichage dans graphan au cours des 30 derniers jours.  Si nous s√©lectionnons le mode d'affichage pour le dernier jour ou l'ann√©e, WarpScript demandera toujours des donn√©es tous les 30 jours.  Le plugin r√©sout ce probl√®me: deux variables sont disponibles pour une utilisation dans WarpScript - <code>$end</code> et <code>$interval</code> . <br><br><pre> <code class="plaintext hljs">[ $rt 'beertender.rawtemperature' {} $end $interval ] FETCH 0</code> </pre> <br><h2>  Temp√©rature de la bi√®re </h2><br>  J'ai pris plusieurs mesures d'eau, de glace et d'eau chaude, en comparant avec un capteur de r√©f√©rence ... Le r√©sultat √©tait le suivant: <br><br><pre>  T (¬∞ C) valeur initiale
 18,3 680
 41,5 870
 37,6 841
 10 586
 11 596
 8 559
 1,467
 4,500
 6.5 535 </pre><br>  Ins√©rez ces valeurs dans la s√©rie temporelle <a href="https://www.warp10.io/content/04_Tutorials/01_WarpScript/20_Master_GTS">GTS</a> et triez le r√©sultat selon les valeurs initiales du capteur: <br><br><pre> <code class="plaintext hljs">NEWGTS 'linearInterpolation' RENAME 680 NaN NaN NaN 18.3 ADDVALUE 870 NaN NaN NaN 41.5 ADDVALUE 841 NaN NaN NaN 37.6 ADDVALUE 586 NaN NaN NaN 10 ADDVALUE 596 NaN NaN NaN 11 ADDVALUE 559 NaN NaN NaN 8 ADDVALUE 467 NaN NaN NaN 1 ADDVALUE 500 NaN NaN NaN 4.5 ADDVALUE 535 NaN NaN NaN 6.5 ADDVALUE SORT</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/140/dcb/8ed/140dcb8ede7c3f8a3a7da87baeaa2ab6.png"><br>  <i><font color="gray">Interpolation attendue</font></i> <br><br>  Les donn√©es source du capteur se pr√©sentent sous la forme d'entiers.  La fa√ßon la plus simple d'interpoler consiste √† cr√©er d'abord la courbe, puis √† utiliser la fonction <a href="https://www.warp10.io/doc/ATTICK">ATTICK</a> pour en lire les valeurs en degr√©s. <br><br>  L'interpolation dans WarpScript est facile.  <a href="https://www.warp10.io/doc/BUCKETIZE">Nous cr√©ons un bucket</a> pour d√©finir la p√©riode souhait√©e, puis commen√ßons l'interpolation, en remplissant les valeurs manquantes. <br><br><pre> <code class="plaintext hljs">[ $linearInterpolation bucketizer.last 0 1 0 ] BUCKETIZE 0 GET INTERPOLATE 'truthtableGTS' STORE</code> </pre> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f14/6d7/6a9/f146d76a90bca0b87a2b2c54779214e1.png"><br><br>  Super.  Vous devez maintenant √©crire votre propre mappeur afin de remplacer chaque valeur du capteur par une vraie valeur de temp√©rature physique et amener le r√©sultat au format utilis√© par le graphane. <br><br>  <u>Avertissement</u> : les valeurs arrivent toutes les 10 secondes.  En trois mois, 270 000 valeurs s'accumuleront.  Trop pour Grafana ... Il suffit de garder la valeur maximale de chaque heure.  Dans WarpScript, c'est <a href="https://www.warp10.io/doc/BUCKETIZE">BUCKETIZE</a> avec le bucketizer.max <a href="">bucketizer</a> . <br><br>  Vous pouvez copier ce WarpScript dans Grafana: <br><br><pre> <code class="plaintext hljs">// raw value interpolation "gCA1SVjbDkaxtmTx9ydI4TI2iGc5hFgcbCWnzMRZSt45XW8dZ53Z7VK_if28i0kXwNDLazXHgLrXUKgxLK0RbS79eJmBCpyBlIxw9US7bPfdWH4Fta51.kXN.D4Hsk5OZOwl.vLRBzMpP7F2pAMfclMXSGtCOT6F" 'rt' STORE NEWGTS 'linearInterpolation' RENAME 680 NaN NaN NaN 18.3 ADDVALUE 870 NaN NaN NaN 41.5 ADDVALUE 841 NaN NaN NaN 37.6 ADDVALUE 586 NaN NaN NaN 10 ADDVALUE 596 NaN NaN NaN 11 ADDVALUE 559 NaN NaN NaN 8 ADDVALUE 467 NaN NaN NaN 1 ADDVALUE 500 NaN NaN NaN 4.5 ADDVALUE 535 NaN NaN NaN 6.5 ADDVALUE SORT 'linearInterpolation' STORE [ $linearInterpolation bucketizer.last 0 1 0 ] BUCKETIZE 0 GET INTERPOLATE 'truthtableGTS' STORE [ $rt 'beertender.rawtemperature' {} NOW $end $interval ] FETCH // subsampling, keep max of every hour [ SWAP bucketizer.max 0 1 h 0 ] BUCKETIZE UNBUCKETIZE // do not try to interpolate missing buckets. // interpolation [ SWAP &lt;% 'l' STORE [ $l 0 GET //same tick NaN NaN NaN //no latitude/longitude/elevation $truthtableGTS $l 7 GET 0 GET ATTICK 4 GET //take the interpolated value ] %&gt; MACROMAPPER 0 0 0 ] MAP 'temperature (¬∞C)' RENAME</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/b90/1de/947/b901de94794350e3a1b01a04f24a69e4.png"><br>  <i><font color="gray">5 ¬∞ C, normal pour la bi√®re</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7af/e0a/744/7afe0a744272dd6d75b6ea949b0d414e.png"><br>  <i><font color="gray">Tableau de bord BeerTender, premi√®re version</font></i> <br><br><h2>  Niveau baril </h2><br>  La jauge de contrainte mesure le niveau dans le baril ... Mais il s'agit d'un capteur √† trois fils bon march√© sur un support en m√©tal rouill√©.  Il n'est pas possible d'obtenir des informations pr√©cises de ces √©quipements.  Par cons√©quent, il n'est pas surprenant que la sortie soit vraiment un r√©sultat bruyant et que les valeurs absolues ne soient pas fiables.  Pour notre BeerTender, j'ai trouv√© une formule exp√©rimentale pour Grafana pour afficher le niveau actuel en pourcentage. <br><br>  <i>Astuce: le plugin Warp 10 ne r√©cup√®re que les donn√©es de GTS.</i>  <i>M√™me si vous souhaitez afficher une seule valeur, vous devez la pr√©senter √† un moment donn√© dans les donn√©es GTS.</i> <br><br>  Voici WarpScript, qui prend le dernier point de donn√©es et le transforme en valeur de pourcentage, et cr√©e √©galement une s√©rie chronologique avec un point: <br><br><pre> <code class="plaintext hljs">"gCA1SVjbDkaxtmTx9ydI4TI2iGc5hFgcbCWnzMRZSt45XW8dZ53Z7VK_if28i0kXwNDLazXHgLrXUKgxLK0RbS79eJmBCpyBlIxw9US7bPfdWH4Fta51.kXN.D4Hsk5OZOwl.vLRBzMpP7F2pAMfclMXSGtCOT6F" 'rt' STORE //read for beer level [ $rt 'beertender.rawvalue' {} NOW -1 ] FETCH 0 GET VALUES 0 GET 'rawSensorValue' STORE //raw correction: // empty: 30.8e6 // full (and cold): 30.5e6 30.8e6 $rawSensorValue - 0 MAX 2800 / 100 MIN 'beerlevelPercent' STORE $beerlevelPercent NEWGTS 'Barre Level (%25)' RENAME 1 NaN NaN NaN $beerlevelPercent ADDVALUE</code> </pre> <br>  Utilisez ce WarpScript comme demande pour un panneau avec un type de visualisation Gauge: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/576/5fc/72c/5765fc72c3dd8525d1174cb84eda5f43.png"><br>  <i><font color="gray">Bel indicateur</font></i> <br><br>  Si vous √™tes int√©ress√©, vous pouvez consulter les donn√©es sources ... Nous avons maintenant un jeton pour acc√©der √† des statistiques uniques sur la consommation de bi√®re! <br><br><h2>  Conclusions </h2><br><ul><li>  Si les donn√©es de surveillance √©taient r√©cemment sous votre contr√¥le, Grafana peut facilement int√©grer la source de donn√©es Warp 10. <br></li><li>  Le plugin Grafana attend une s√©rie chronologique GTS ou une liste GTS. <br></li><li>  OVHcloud est le mainteneur actuel du plugin.  <a href="https://github.com/ovh/ovh-warp10-datasource">N'h√©sitez pas √† contribuer!</a> <br></li><li>  Lisez la <a href="https://github.com/ovh/ovh-warp10-datasource/wiki/Make-a-simple-graph">documentation</a> pour plus d'informations. <br></li><li>  Si vous souhaitez enrichir la visualisation des donn√©es, vous pouvez prendre <a href="https://blog.senx.io/warpview-introduction/">nos composants Web pr√™ts √† l'emploi</a> . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/1d3/a63/100/1d3a631002ed21c5c17014adf259d785.png"></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr477870/">https://habr.com/ru/post/fr477870/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr477854/index.html">Que se passe-t-il lors de la connexion √† l'int√©rieur et √† l'ext√©rieur d'un tunnel VPN</a></li>
<li><a href="../fr477856/index.html">Acc√©l√©rateurs flash PCI-E de 800 Go √† 6,4 To: de l'aube √† la vie sur un PC / serveur classique</a></li>
<li><a href="../fr477858/index.html">Travail hors table: quels projets sont vraiment apparus apr√®s la pr√©-acc√©l√©ration?</a></li>
<li><a href="../fr477860/index.html">Comment les services de base de donn√©es g√©r√©s sont-ils organis√©s dans Yandex?</a></li>
<li><a href="../fr477864/index.html">TabPy pour travailler avec des donn√©es dans ClickHouse de Tableau</a></li>
<li><a href="../fr477874/index.html">CDN dynamique pour le streaming WebRTC avec faible latence et transcodage</a></li>
<li><a href="../fr477878/index.html">Comment les jeux comp√©titifs vous aident √† mieux travailler</a></li>
<li><a href="../fr477882/index.html">40 canaux et chats pour les personnes int√©ress√©es par DevOps</a></li>
<li><a href="../fr477892/index.html">DevOps: r√©sultats 2019 et prochaine pr√©diction de la communaut√© DevOps</a></li>
<li><a href="../fr477894/index.html">travail et plaisir de dev (damentals) # 0. √Ä quoi s'attendre et comment aider un d√©veloppeur stagiaire √† devenir un junior confiant?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>