<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôç üë¥üèæ üèçÔ∏è Protocolo MQTT e MQTT abrem projeto de cliente no Delphi ‚ò¢Ô∏è üë∂üèª üõµ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="O protocolo MQTT √© usado para mensagens na Internet das coisas. Antes de tudo, √© interessante porque √© suportado pelos maiores provedores de servi√ßos ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Protocolo MQTT e MQTT abrem projeto de cliente no Delphi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/388231/"><img align="left" src="https://habrastorage.org/files/335/d26/6d4/335d266d4c4943fcb2b3dd3c3aec0cef.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O protocolo </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> √© usado para mensagens na Internet das coisas. </font><font style="vertical-align: inherit;">Antes de tudo, √© interessante porque √© suportado pelos maiores provedores de servi√ßos em nuvem, como IBM, Microsoft, Amazon. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Voc√™ pode obter uma conta nesses servi√ßos gratuitamente, configurar um servi√ßo para receber mensagens MQTT l√° e assistir a vida √∫til de seus dispositivos por meio desses servi√ßos, por exemplo, em uma casa inteligente. </font><font style="vertical-align: inherit;">Al√©m disso, por meio desses servi√ßos, os dispositivos podem se comunicar entre si. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Uma demonstra√ß√£o da conex√£o do cliente com o servi√ßo MQTT da nuvem IBM Bluemix est√° inclu√≠da.</font></font><br>
<br>
<a name="habracut"></a><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Breve descri√ß√£o.</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O MQTT √© extremamente primitivo: com um cabe√ßalho curto, sem controle de integridade, n√£o imp√µe restri√ß√µes √† estrutura, codifica√ß√£o ou esquema de dados. </font><font style="vertical-align: inherit;">O √∫nico requisito de dados em cada pacote √© que eles devem ser acompanhados por um identificador para o canal de informa√ß√µes. </font><font style="vertical-align: inherit;">Esse identificador na especifica√ß√£o √© chamado Nome do T√≥pico ou um t√≥pico mais simples. </font><font style="vertical-align: inherit;">Os dados s√£o transmitidos para pacotes atrav√©s de TCP. </font><font style="vertical-align: inherit;">A quantidade de dados em um pacote pode variar de um byte a 268.435.455 bytes. </font><font style="vertical-align: inherit;">Muito flex√≠vel! </font><font style="vertical-align: inherit;">Embora os servi√ßos de nuvem p√∫blica imponham restri√ß√µes mais rigorosas, at√© v√°rios kilobytes.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O protocolo MQTT requer um intermedi√°rio de dados. </font><font style="vertical-align: inherit;">Essa √© a ideia central da tecnologia. </font><font style="vertical-align: inherit;">Todos os dispositivos enviam dados apenas para o corretor e tamb√©m recebem dados dele. </font><font style="vertical-align: inherit;">Um broker √© um programa que atua como um servidor TCP com um banco de dados din√¢mico.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O banco de dados do broker, em particular, cont√©m uma tabela com todos os pacotes recebidos com indexa√ß√£o por t√≥picos desses pacotes. </font><font style="vertical-align: inherit;">Ao receber o pacote, o broker o envia a todos os dispositivos na rede de acordo com sua assinatura. </font><font style="vertical-align: inherit;">Para que o dispositivo receba algo do intermedi√°rio, ele deve se inscrever no t√≥pico. </font><font style="vertical-align: inherit;">Os t√≥picos surgem dinamicamente na assinatura ou na chegada de um pacote com este t√≥pico. </font><font style="vertical-align: inherit;">Voc√™ tamb√©m pode cancelar a inscri√ß√£o no t√≥pico. </font><font style="vertical-align: inherit;">Assim, os t√≥picos s√£o um mecanismo conveniente para organizar relacionamentos de diferentes tipos: um para muitos, muitos para um e muitos para muitos. </font><font style="vertical-align: inherit;">Se o pacote n√£o tiver um assinante, ele ser√° descartado. </font><font style="vertical-align: inherit;">Se o assinante n√£o estiver conectado, o pacote ser√° exclu√≠do imediatamente no banco de dados do broker ou aguardar√° que o assinante se conecte por algum tempo especificado na configura√ß√£o. </font><font style="vertical-align: inherit;">O comportamento √© determinado pelo atributo QoS do pacote.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O que mais √© importante aqui.</font></font></h1> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Os dispositivos s√£o os primeiros a estabelecer contato com um corretor. I.e. os dispositivos podem estar localizados atr√°s de NATs (Network Address Translators) e podem n√£o ter endere√ßos IP est√°ticos, o que n√£o interfere na comunica√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ SSL pode ser usado para criptografar o tr√°fego. Mas voc√™ pode trabalhar sem SSL, mesmo com os servi√ßos IBM, o que facilita a depura√ß√£o. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Em casos extremamente dif√≠ceis, os agentes do MQTT permitem conectar-se a eles atrav√©s do protocolo WebSocket na porta 80. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ A porta do protocolo MQTT padr√£o tamb√©m pode ser alterada arbitrariamente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ O cliente / clientes com uma interface gr√°fica com o usu√°rio e o broker podem estar localizados no mesmo computador. I.e. a solu√ß√£o pode ser absolutamente local e escalar para global com um clique.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ Diferentes corretores podem se conectar assinando mensagens um do outro. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ O conceito de t√≥picos se encaixa bem com a tecnologia de banco de dados NoSQL. </font><font style="vertical-align: inherit;">Para o mesmo objetivo, os servi√ßos em nuvem incentivam os usu√°rios a usar a codifica√ß√£o de dados JSON.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Projetos abertos</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A escolha dos corretores MQTT √© bastante grande. Mas, estranhamente, praticamente n√£o h√° clientes convenientes com uma interface de usu√°rio de janela no Windows. E esse cliente para dominar o protocolo MQTT √© simplesmente necess√°rio, porque h√° muitas nuances pr√°ticas do trabalho dos corretores al√©m do escopo das especifica√ß√µes, e todas elas precisam ser estudadas e testadas de alguma forma. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Foi decidido implementar o cliente MQTT no Delphi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Google para Delphi pode oferecer apenas o componente TMQTTClient. Mas este √© um componente antigo e n√£o funciona. A maioria dos outros clientes escritos em Java, Erlang, Haskell, Javscript no Delphi s√£o muito dif√≠ceis de integrar. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Encontrado o √∫nico projeto adequado - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Escrito em puro C-i. </font><font style="vertical-align: inherit;">Compila para diferentes sistemas operacionais. </font><font style="vertical-align: inherit;">Possui scripts de gera√ß√£o de projeto para o Visual Studio. </font><font style="vertical-align: inherit;">Na sa√≠da do Windows, obtemos arquivos DLL com a implementa√ß√£o da funcionalidade do cliente e do broker. </font><font style="vertical-align: inherit;">O uso de C √© encorajador em termos de velocidade. </font><font style="vertical-align: inherit;">E bibliotecas din√¢micas escritas em C se conectam facilmente aos programas Delphi. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O pr√≥prio Delphi, representado pelo Embarcadero RAD Studio XE8, √© uma ferramenta muito poderosa para criar interfaces de usu√°rio flex√≠veis e convenientes para o Windows, especialmente se estiver equipado com DevExpress, TeeChart, RxLib, FireDAC, etc.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas necess√°rias</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Vamos precisar do ambiente de desenvolvimento do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MS Visual Studio 2015</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Ele ir√° compilar o projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e todos os projetos de apoio dos quais o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> depende </font><font style="vertical-align: inherit;">. Como alternativa, o </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> para </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> pode ser compilado usando o pacote </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cygwin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , mas o Visual Studio parecia mais conveniente. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para gerar arquivos de projeto do Visual Studio, voc√™ precisa baixar e instalar o utilit√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cmake</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fonte </font></font><b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmake.org</font></font></a></b><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
E √© claro que voc√™ precisa do </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RAD Studio XE8</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Al√©m disso, no RAD Studio, a </font><font style="vertical-align: inherit;">vers√£o do </font><font style="vertical-align: inherit;">pacote do componente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DevExpress VCL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o inferior a </font><b><font style="vertical-align: inherit;">14.2.2</font></b><font style="vertical-align: inherit;"> deve ser instalada</font></font><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Embora isso n√£o seja de import√¢ncia fundamental, o design da interface do usu√°rio pode ser facilmente refazido para os componentes padr√£o do RAD Studio.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Procedimento de instala√ß√£o do software</font></font></h1><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O Mosquitto depende de v√°rios projetos de terceiros, s√£o eles: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
‚Ä¢ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSL v 1.0.2e</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fonte - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://slproweb.com/download/Win32OpenSSL-1_0_2e.exe</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
‚Ä¢ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pthreads v 2.9.1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fonte - </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp://sourceware.org/pub/pthreads-win32/pthreads-w32-2-9-1-release.zip</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
‚Ä¢ </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libwebsockets v 1.4</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Fonte - </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/warmcat/libwebsockets</font></font></a><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Fa√ßa o download desses projetos. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o compilar, e imediatamente demorar de dois para o arquivo desejado: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libeay32.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssleay32.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do diret√≥rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Muitas vezes acontece que eles j√° est√£o instalados no computador de outros projetos. Isso deve ser verificado. </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pthreads</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tamb√©m n√£o compilar, e tomar o arquivo j√° compilado </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pthreadVC2.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do diret√≥rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dll \ x86</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Libwebsockets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vem sem arquivos pr√©-compilados e sem um projeto para o Visual Studio, mas possui um arquivo de configura√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMakeLists.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nesse caso, usando o utilit√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cmake</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">geramos o arquivo de projeto do Visual Studio em um diret√≥rio separado (diret√≥rio libwebsockets_VS_proj). E, em seguida, abrindo o arquivo de projeto gerado no Visual Studio, compilamos. N√≥s </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">obtemos o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font><b><font style="vertical-align: inherit;">websockets.dll que precisamos</font></b><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s todas as etapas anteriores, voc√™ pode compilar o projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Aqui, voc√™ tamb√©m precisa primeiro gerar o arquivo de projeto do Visual Studio (diret√≥rio Mosquitto_VS_proj) a partir do arquivo de configura√ß√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMakeLists.txt</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> anexado </font><font style="vertical-align: inherit;">. O projeto gerado n√£o funciona muito bem, voc√™ precisar√° alterar os caminhos para alguns arquivos e bibliotecas de cabe√ßalho externos, incluir algumas macros no projeto e modificar levemente os textos de origem. Como resultado, obtemos o arquivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para simplificar, todos os arquivos e a estrutura de diret√≥rios dos projetos mencionados est√£o contidos no arquivo anexado ao artigo. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Juntamente com a biblioteca do cliente, a compila√ß√£o do projeto </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> nos fornece o arquivo execut√°vel do broker do MQTT - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Assim, obtemos imediatamente o cliente e o broker MQTT, ou seja, </font><font style="vertical-align: inherit;">quase tudo o que voc√™ precisa para organizar uma Internet eficaz das coisas.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criando um projeto de cliente MQTT no Delphi</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para integrar a biblioteca </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.dll</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ao Delphi, </font><b><font style="vertical-align: inherit;">voc√™</font></b><font style="vertical-align: inherit;"> precisa criar um m√≥dulo de declara√ß√£o de fun√ß√£o de biblioteca no </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Object Pascal</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Para fazer isso, a convers√£o de arquivos tem sido realizada </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto.h</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> arquivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOSQUITTO.PAS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O projeto do cliente √© muito simples, consiste em apenas 4 arquivos de origem. </font><font style="vertical-align: inherit;">O cliente demonstra a conex√£o e a desconex√£o, formando uma vontade ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vontade</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), enviando dados com o pacote </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLISH ao</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> intermedi√°rio, recebendo dados com o pacote </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLISH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> do intermedi√°rio, assinando e cancelando a inscri√ß√£o.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
O programa salva todos os atributos de conex√£o, referidos pelo termo perfil na tabela de perfis armazenados no disco. </font><font style="vertical-align: inherit;">Os logs dos pacotes </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUBLISH</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> recebidos e enviados tamb√©m s√£o salvos no disco separadamente </font><font style="vertical-align: inherit;">.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√©todo de Uso do Cliente</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Execute o arquivo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMQTTC.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para ter algu√©m para comunicar a equipe corretor de execu√ß√£o de teste </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run_mosquitto.cmd</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no diret√≥rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto_1_4_5_bin</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Por conveni√™ncia, o broker est√° configurado para conectar-se sem </font><font style="vertical-align: inherit;">verifica√ß√£o de </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e senha. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Preencha os campos como na captura de tela. </font></font><br>
<br>
<img width="1000" src="https://habrastorage.org/files/6df/303/805/6df303805cb246feb6acc16236e0277a.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Senha e nome de usu√°rio s√£o opcionais. No navegador, clique no bot√£o de confirma√ß√£o para salvar os dados na tabela. Em seguida, clique no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conectar</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s a conex√£o, os comandos de publica√ß√£o e assinatura ficam dispon√≠veis. Comandos </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PING</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cliente </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mosquitto</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> gera automaticamente.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Para que o cliente obtenha alguma coisa, voc√™ deve executar novamente o programa </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TMQTTC.exe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> com um identificador de cliente diferente e assinar um cliente para receber dados de outro.</font></font><br>
<br>
<h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conecte-se ao IBM Bluemix</font></font></h1><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
A primeira coisa a fazer √© obter uma conta no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Depois de receber uma conta, vamos ao nosso painel de controle no </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aqui voc√™ deve mudar imediatamente para a regi√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sul</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dos </font><b><font style="vertical-align: inherit;">EUA</font></b><font style="vertical-align: inherit;"> . Para fazer isso, clique no √≠cone da conta no canto superior direito e altere o valor no campo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Regi√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Existem tr√™s regi√µes no total, mas </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o sul dos EUA</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oferece a oportunidade de experimentar a maioria dos servi√ßos. Em seguida, crie </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">espa√ßo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . A tela deve parecer uma imagem abaixo. Aqui, a organiza√ß√£o </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEMSYS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Space </font></font></b><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INDEMSYS SPACE s√£o criadas</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<img width="800" src="https://habrastorage.org/files/e8e/a9d/daf/e8ea9ddaf89c47b299f6766b5012948c.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Agora clique em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CATALOG</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> no menu superior. Descemos para o fundo e escolhemos</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funda√ß√£o Internet das Coisas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<img width="800" src="https://habrastorage.org/files/b34/edd/4d1/b34edd4d15b848cb9a70d5b53a218538.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por padr√£o, n√£o </font><b><font style="vertical-align: inherit;">alteramos</font></b><font style="vertical-align: inherit;"> os campos propostos e clique em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criar </font></font></b><br>
<img width="800" src="https://habrastorage.org/files/615/b4f/d12/615b4fd125b44adebeba93ec77725d8e.png"><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Funda√ß√£o da Internet das Coisas</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - este √© um servi√ßo que inclui o intermedi√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> e a interface com o usu√°rio. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ap√≥s criar na janela exibida, clique no bot√£o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Iniciar painel</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br>
<img width="800" src="https://habrastorage.org/files/b9e/00f/6e1/b9e00f6e1f7d4381ab7d95220998f722.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Este √© um painel de controle da IoT. Agora precisamos criar dispositivos. Clique em </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adicionar dispositivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Nas caixas de di√°logo exibidas, crie um tipo de dispositivo ( </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criar tipo de dispositivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ). D√™ a ele o nome Tipo1, n√£o preencha os campos restantes para simplificar. Clique em Avan√ßar -&gt; Avan√ßar -&gt; Criar -&gt; Avan√ßar. Atribua o nome ao dispositivo Device1. Pr√≥ximo Pr√≥ximo -&gt; Pr√≥ximo -&gt; Pr√≥ximo -&gt; Adicionar. Como resultado, obtemos a seguinte janela:</font></font><br>
<img width="800" src="https://habrastorage.org/files/ce8/dcc/0b2/ce8dcc0b2a7f41d39f1545be3a0ee014.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
√â isso a√≠, temos todos os detalhes para conectar nosso primeiro dispositivo ao </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix do</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> broker do </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MQTT</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Testaremos se nosso cliente pode se conectar a ele. Digite os detalhes na janela do cliente. </font></font><br>
<img width="1000" src="https://habrastorage.org/files/23e/469/94b/23e46994b94b4621b8aeb93a17fd5c5e.png"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Como voc√™ pode ver, o cliente se conectou com sucesso ao </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Aqui voc√™ deve prestar aten√ß√£o ao nome do host. Come√ßa com o </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> da </font><b><font style="vertical-align: inherit;">organiza√ß√£o</font></b><font style="vertical-align: inherit;"> obtido ao criar a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet of Things Foundation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . O campo </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID do usu√°rio</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> tamb√©m </font><font style="vertical-align: inherit;">√© </font><font style="vertical-align: inherit;">composto e √© codificado como: </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID da organiza√ß√£o</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;: &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tipo de dispositivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;: &lt; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID do dispositivo</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt;. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> campo </font><b><font style="vertical-align: inherit;">Nome do usu√°rio</font></b><font style="vertical-align: inherit;"> cont√©m uma sequ√™ncia fixa</font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use-token-auth</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Os t√≥picos de mensagens para o intermedi√°rio </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bluemix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , diferentemente do intermedi√°rio </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mosquitto,</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> n√£o podem conter dados arbitr√°rios. </font><font style="vertical-align: inherit;">Eles s√£o codificados de acordo com certas regras. </font><font style="vertical-align: inherit;">Essas regras devem ser estudadas na documenta√ß√£o da </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet of Things Foundation</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">A captura de tela mostra um dos poss√≠veis t√≥picos v√°lidos. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Reposit√≥rio do projeto: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/Indemsys/Delphi_MQTT_mosquitto</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt388231/">https://habr.com/ru/post/pt388231/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt388221/index.html">Seagate: Winchesters ficar√° conosco por mais 20 anos</a></li>
<li><a href="../pt388223/index.html">Mem√≥rias de um rob√¥ subumano, cap√≠tulos 1-2, segunda tentativa</a></li>
<li><a href="../pt388225/index.html">O que √© cristalografia evolutiva e por que o futuro est√° por tr√°s disso. Quase complicado</a></li>
<li><a href="../pt388227/index.html">Pesquisa infogr√°fico: compras on-line na v√©spera de Ano Novo</a></li>
<li><a href="../pt388229/index.html">Usando o iRidium para controlar sistemas de automa√ß√£o com base no protocolo Z-Wave</a></li>
<li><a href="../pt388233/index.html">Viaje pela R√∫ssia microeletr√¥nica (parte acad√™mica)</a></li>
<li><a href="../pt388235/index.html">A Volkswagen prop√¥s medidas corretivas para motores a diesel adotadas por autoridades europeias</a></li>
<li><a href="../pt388237/index.html">A pol√≠cia do Reino Unido criou uma ‚Äúgangue de karaok√™‚Äù de tr√™s entusiastas idosos de karaok√™</a></li>
<li><a href="../pt388241/index.html">Por que as empresas realizam IPOs: Pr√≥s e Contras</a></li>
<li><a href="../pt388243/index.html">Vigil√¢ncia dom√©stica e visualiza√ß√£o remota pela Internet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>