<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨🏿‍🚀 ⛵️ 🤟🏿 Dank Kubernetes und Automatisierung in zwei Stunden in die Cloud migrieren 🙏🏾 👨🏿‍🚒 ✋🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="URUS hat Kubernetes in verschiedenen Formen ausprobiert: eine eigenständige Bare-Metal-Bereitstellung in Google Cloud und dann seine Plattform auf Mai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dank Kubernetes und Automatisierung in zwei Stunden in die Cloud migrieren</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/467163/"><img src="https://habrastorage.org/webt/ms/rd/xs/msrdxsvvp0ml1objxiaw2lfb1b4.jpeg"><br><br>  URUS hat Kubernetes in verschiedenen Formen ausprobiert: eine eigenständige Bare-Metal-Bereitstellung in Google Cloud und dann seine Plattform auf Mail.ru Cloud Solutions (MCS) verschoben.  Igor Shishkin ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">t3ran</a> ), Senior System Administrator von URUS, erklärt, wie man einen neuen Cloud-Anbieter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=" class="user_link">auswählt</a> und wie man es schafft, innerhalb von zwei Stunden zu diesem zu migrieren. <br><a name="habracut"></a><br><h2>  Was macht Urus? </h2><br>  Es gibt viele Möglichkeiten, die Qualität der städtischen Umwelt zu verbessern, und eine davon besteht darin, sie umweltfreundlich zu gestalten.  Genau daran arbeitet das Unternehmen URUS - Smart Digital Services.  Es implementiert Lösungen, mit denen Unternehmen wichtige Umweltindikatoren überwachen und negative Umweltauswirkungen reduzieren können.  Sensoren erfassen Daten zur Luftzusammensetzung, zum Geräuschpegel und zu anderen Parametern und senden sie zur Analyse und Erstellung von Empfehlungen an eine einzige Plattform „Urus-Ekomon“. <br><br><h2>  Wie ist die Arbeit von "Urus" im Inneren </h2><br>  Ein typischer Kunde von URUS ist ein Unternehmen in oder in der Nähe eines Wohngebiets.  Es kann sich um eine Fabrik, einen Hafen, ein Eisenbahndepot oder eine andere Einrichtung handeln.  Wenn unser Kunde bereits eine Warnung erhalten hat, wegen Umweltverschmutzung mit einer Geldstrafe belegt wurde oder weniger Lärm machen und die Menge der schädlichen Emissionen reduzieren möchte, kommt er zu uns und wir bieten ihm bereits eine schlüsselfertige Lösung für die Umweltüberwachung an. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3c/j3/-c/3cj3-cvukgqpsktqzuiehm_2ioo.jpeg"></div><br>  <i>Ein Diagramm der Überwachung der H <sub>2</sub> S-Konzentration zeigt die regelmäßigen Nachtemissionen einer nahe gelegenen Anlage</i> <br><br>  Die Geräte, die wir bei URUS verwenden, enthalten mehrere Sensoren, die Informationen über den Inhalt bestimmter Gase, Geräuschpegel und andere Daten zur Beurteilung der Umweltsituation erfassen.  Die genaue Anzahl der Sensoren wird immer von einer bestimmten Aufgabe bestimmt. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/u1/um/w4/u1umw4ptjdkbc8zymwy2qimgwr0.jpeg"></div><br>  Geräte mit Sensoren können je nach Maß an den Wänden von Gebäuden, Masten und anderen beliebigen Stellen angebracht werden.  Jedes dieser Geräte sammelt Informationen, aggregiert sie und sendet sie an das Datenempfangs-Gateway.  Dort speichern wir Daten für die Langzeitspeicherung und verarbeiten sie für die anschließende Analyse vor.  Das einfachste Beispiel für das, was wir nach der Analyse erhalten, ist ein Luftqualitätsindex, auch bekannt als AQI. <br><br>  Gleichzeitig arbeiten viele andere Dienste auf unserer Plattform, aber im Grunde sind sie Dienstcharakter.  Beispielsweise sendet ein Benachrichtigungsdienst Benachrichtigungen an Kunden, wenn einer der überwachten Parameter (z. B. der Gehalt an CO <sub>2</sub> ) den zulässigen Wert überschritten hat. <br><br><h2>  Wie speichern wir Daten?  Die Geschichte von Kubernetes auf Bare Metal </h2><br>  Das URUS-Öko-Monitoring-Projekt verfügt über mehrere Data Warehouses.  In einem halten wir die "Rohdaten" - was wir direkt von den Geräten selbst erhalten haben.  Dieser Speicher ist wie bei alten Kassetten ein „Magnetband“ mit einer Historie aller Anzeigen.  Die zweite Art der Speicherung wird für vorverarbeitete Daten verwendet - Daten von Geräten, die mit Metadaten über Sensorverbindungen und Messwerte von Geräten selbst angereichert sind, Zugehörigkeit zu Organisationen, Standorten usw. Mit diesen Informationen können Sie dynamisch bewerten, wie sich ein bestimmter Indikator über einen bestimmten Zeitraum geändert hat .  Wir verwenden die Speicherung von Rohdaten, auch als Backup und zur Wiederherstellung vorverarbeiteter Daten, falls dies erforderlich ist. <br><br>  Als wir vor einigen Jahren nach Möglichkeiten suchten, das Speicherproblem zu lösen, hatten wir zwei Möglichkeiten, eine Plattform auszuwählen: Kubernetes und OpenStack.  Aber da letzteres ziemlich monströs aussieht (sehen Sie sich nur die Architektur an, um dies zu sehen), haben wir uns für Kubernetes entschieden.  Ein weiteres Argument für ihn war die relativ einfache Softwaresteuerung, die es ermöglicht, selbst Eisenknoten flexibler in Ressourcen zu schneiden. <br><br>  Parallel zur Entwicklung von Kubernetes selbst haben wir auch Möglichkeiten zum Speichern von Daten untersucht. Während wir alle unsere Speicher in Kubernetes auf unserer Hardware gespeichert haben, haben wir hervorragendes Fachwissen erhalten.  Alles, was wir damals auf Kubernetes gelebt hatten: Statefull Storage, Monitoring System, CI / CD.  Kubernetes ist zu unserer All-in-One-Plattform geworden. <br><br>  Wir wollten jedoch mit Kubernetes als Service zusammenarbeiten und uns nicht auf dessen Unterstützung und Entwicklung einlassen.  Außerdem hat uns nicht gefallen, wie viel uns der Inhalt auf Bare Metal gekostet hat, und für uns war immer eine Entwicklung erforderlich!  Eine der ersten Aufgaben war beispielsweise die Integration von Kubernetes Ingress-Controllern in die Netzwerkinfrastruktur unserer Organisation.  Dies ist eine mühsame Aufgabe, insbesondere wenn Sie sich vorstellen, dass zu diesem Zeitpunkt nichts für die programmatische Ressourcenverwaltung wie DNS-Einträge oder IP-Zuweisung bereit war.  Später haben wir angefangen, mit einem externen Data Warehouse zu experimentieren.  Wir sind nicht zur Implementierung des PVC-Reglers gekommen, aber selbst dann wurde klar, dass dies ein großes Arbeitsfeld war, für das es notwendig war, einzelne Spezialisten herauszusuchen. <br><br><h2>  Migration auf die temporäre Lösung der Google Cloud Platform </h2><br>  Wir haben festgestellt, dass dies nicht weitergehen kann, und haben unsere Daten von Bare Metal auf die Google Cloud Platform übertragen.  Tatsächlich gab es für das russische Unternehmen nicht viele interessante Optionen: Zusätzlich zur Google Cloud Platform bot nur Amazon einen ähnlichen Dienst an, aber wir entschieden uns dennoch für eine Lösung von Google.  Dann schien es uns wirtschaftlich rentabler, näher an Upstream, ganz zu schweigen von der Tatsache, dass Google selbst eine Art PoC Kubernetes in der Produktion ist. <br><br>  Das erste ernsthafte Problem zeichnete sich parallel zum Wachstum unserer Kundenbasis ab.  Als es für uns notwendig wurde, personenbezogene Daten zu speichern, standen wir vor der Wahl: Entweder arbeiten wir mit Google zusammen und verstoßen gegen russische Gesetze, oder wir suchen nach einer Alternative in der Russischen Föderation.  Die Wahl war im Allgemeinen vorhersehbar.  :) :) <br><br><h2>  Wie wir den perfekten Cloud-Service gesehen haben </h2><br>  Zu Beginn der Suche wussten wir bereits, was wir vom zukünftigen Cloud-Anbieter erhalten wollten.  Welchen Service suchten wir: <br><br><ul><li>  <b>Schnell und flexibel</b> .  Damit wir jederzeit schnell einen neuen Knoten hinzufügen oder etwas bereitstellen können. <br></li><li>  <b>Preiswert</b> .  Wir waren sehr besorgt über das finanzielle Problem, da wir nur über begrenzte Ressourcen verfügten.  Wir wussten bereits, dass wir mit Kubernetes arbeiten wollten, und jetzt bestand die Aufgabe darin, die Kosten zu minimieren, um die Effektivität der Verwendung dieser Lösung zu erhöhen oder zumindest aufrechtzuerhalten. <br></li><li>  <b>Automatisiert</b> .  Wir wollten mit dem Service über die API arbeiten, ohne Manager und Telefonanrufe oder Situationen, in denen Sie im Notfallmodus mehrere zehn Knoten manuell anheben müssen.  Da die meisten unserer Prozesse automatisiert sind, haben wir dasselbe von einem Cloud-Service erwartet. <br></li><li>  <b>Mit Servern in der Russischen Föderation</b> .  Natürlich wollten wir das russische Recht und das gleiche 152-FZ einhalten. <br></li></ul><br>  Zu dieser Zeit gab es in Russland nur wenige Kubernetes aaS-Anbieter. Bei der Auswahl eines Anbieters war es für uns wichtig, unsere Prioritäten nicht zu gefährden.  Das Team von Mail.ru Cloud Solutions, mit dem wir bereits begonnen haben und noch arbeiten, hat uns einen vollautomatisierten Service mit API-Unterstützung und einem praktischen Control Panel zur Verfügung gestellt, in dem sich Horizon befindet. Damit können wir schnell eine beliebige Anzahl von Knoten erhöhen. <br><br><h2>  Wie wir es geschafft haben, in zwei Stunden auf MCS zu migrieren </h2><br>  Bei solchen Umzügen sind viele Unternehmen mit Schwierigkeiten und Misserfolgen konfrontiert, in unserem Fall jedoch nicht.  Wir hatten Glück: Da wir bereits vor Beginn der Migration an Kubernetes gearbeitet haben, haben wir nur drei Dateien repariert und unsere Dienste auf einer neuen Cloud-Plattform in MCS gestartet.  Ich möchte Sie daran erinnern, dass wir zu diesem Zeitpunkt endlich Bare Metal verlassen hatten und auf der Google Cloud Platform lebten.  Da der Umzug selbst nicht länger als zwei Stunden dauerte, plus etwas mehr Zeit (ungefähr eine Stunde), um Daten von unseren Geräten zu kopieren.  Dann haben wir bereits Spinnaker verwendet (einen Multi-Cloud-CD-Service für die kontinuierliche Lieferung).  Wir haben es auch schnell zum neuen Cluster hinzugefügt und wie gewohnt weitergearbeitet. <br><br>  Dank der Automatisierung von Entwicklungsprozessen und CI / CD wird Kubernetes in URUS von einem Spezialisten (und das bin ich) besetzt.  Irgendwann arbeitete ein anderer Systemadministrator mit mir zusammen, aber dann stellte sich heraus, dass wir bereits die gesamte Hauptroutine automatisiert hatten, und von der Seite unseres Hauptprodukts gab es immer mehr Aufgaben, und es war sinnvoll, Ressourcen darauf zu lenken. <br><br>  Wir haben vom Cloud-Anbieter das erhalten, was wir erwartet hatten, da wir ohne Illusionen mit der Zusammenarbeit begonnen haben.  Wenn es irgendwelche Zwischenfälle gab, dann meistens technische, die leicht durch die relative Frische des Dienstes erklärt werden können.  Die Hauptsache ist, dass das MCS-Team Fehler schnell beseitigt und Fragen in Instant Messenger schnell beantwortet. <br><br>  Wenn wir die Erfahrung mit der Google Cloud Platform vergleichen, wusste ich in ihrem Fall nicht einmal, wo sich die Feedback-Schaltfläche befindet, da dies einfach nicht erforderlich war.  Und wenn irgendwelche Probleme auftraten, verschickte Google selbst einseitig Benachrichtigungen.  Aber im Fall von MCS, einem großen Plus, glaube ich, dass sie den russischen Kunden so nahe wie möglich sind - sowohl geografisch als auch mental. <br><br><h2>  Wie wir sehen, arbeiten wir in Zukunft mit Wolken </h2><br>  Jetzt ist unsere Arbeit eng mit Kubernetes verbunden und passt in Bezug auf Infrastrukturaufgaben vollständig zu uns.  Daher planen wir keine Migration von irgendwoher, obwohl wir ständig neue Praktiken und Dienste einführen, um Routineaufgaben zu vereinfachen und neue zu automatisieren, die Stabilität und Zuverlässigkeit von Diensten zu erhöhen ... Jetzt starten wir den Chaos Monkey-Dienst (insbesondere verwenden wir Chaoskube, aber dies ändert nichts am Konzept: ), die ursprünglich in Netflix erstellt wurde.  Chaos Monkey macht eine einfache Sache: Zu einer beliebigen Zeit löscht es ein beliebiges Unter in Kubernetes.  Dies ist notwendig, damit unser Dienst normal mit der Anzahl der Instanzen n - 1 leben kann. Daher sind wir es gewohnt, auf Fehlfunktionen vorbereitet zu sein. <br><br>  Jetzt sehe ich die Verwendung von Lösungen von Drittanbietern - denselben Cloud-Plattformen - als die einzig richtige für junge Unternehmen.  Normalerweise sind die personellen und finanziellen Ressourcen zu Beginn der Reise begrenzt, und der Aufbau und die Wartung einer eigenen Cloud oder eines eigenen Rechenzentrums sind zu teuer und zeitaufwändig.  Cloud-Anbieter können diese Kosten minimieren, schnell die Ressourcen abrufen, die erforderlich sind, damit die Dienste hier und jetzt funktionieren, und diese Ressourcen tatsächlich bezahlen.  Was die Firma Urus betrifft, werden wir Kubernetes in der Cloud vorerst treu bleiben.  Aber wer weiß, vielleicht müssen wir geografisch expandieren oder Lösungen implementieren, die auf bestimmten Geräten basieren.  Oder vielleicht rechtfertigt die Menge der verbrauchten Ressourcen seine eigenen Kubernetes auf Bare Metal, wie in den guten alten Zeiten.  :) :) <br><br><h2>  Was wir aus unseren Erfahrungen mit Cloud-Diensten gelernt haben </h2><br>  Wir haben angefangen, Kubernetes auf Bare Metal zu verwenden, und selbst dort war es auf seine Weise gut.  Seine Stärken zeigten sich jedoch gerade als aaS-Komponente in der Cloud.  Wenn Sie sich ein Ziel setzen und alles so weit wie möglich automatisieren, können Sie vermeiden, dass Anbieter gesperrt werden. Der Wechsel zwischen Cloud-Anbietern dauert einige Stunden, und die Nervenzellen bleiben bei uns.  Wir können andere Unternehmen beraten: Wenn Sie Ihren (Cloud-) Service mit begrenzten Ressourcen und maximaler Entwicklungsgeschwindigkeit starten möchten, mieten Sie sofort Cloud-Ressourcen und bauen Sie Ihr Rechenzentrum auf, nachdem Forbes über Sie geschrieben hat. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de467163/">https://habr.com/ru/post/de467163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de467149/index.html">Antiquitäten: 1992 in der Computerpresse</a></li>
<li><a href="../de467151/index.html">Umgang mit Einwänden: Die statische Analyse nimmt einen Teil der Arbeitszeit in Anspruch</a></li>
<li><a href="../de467153/index.html">Mit Einwänden arbeiten: Die statische Analyse nimmt einen Teil der Arbeitszeit in Anspruch</a></li>
<li><a href="../de467155/index.html">Best Practices für Kubernetes-Container: Gesundheitschecks</a></li>
<li><a href="../de467161/index.html">Webanwendung auf Kotlin + Spring Boot + Vue.js</a></li>
<li><a href="../de467165/index.html">Auf den Spuren der russischen Scala-Bewegung. Teil 2</a></li>
<li><a href="../de467169/index.html">Lehren aus dem Testen von über 200.000 Zeilen Infrastrukturcode</a></li>
<li><a href="../de467171/index.html">Was ich durch Testen von 200.000 Zeilen Infrastrukturcode gelernt habe</a></li>
<li><a href="../de467173/index.html">Architekt sichere ERP-Implementierung</a></li>
<li><a href="../de467175/index.html">Überlegen Sie zweimal, bevor Sie Game Engines verwenden</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>