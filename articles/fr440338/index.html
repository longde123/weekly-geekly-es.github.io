<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêπ üëéüèΩ ‚óΩÔ∏è Comment garantir la disponibilit√© d'un service Web dans le cloud en cas de panne du centre de donn√©es üíü üèµÔ∏è üë®üèæ‚Äçüöí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="L'article d√©crit la possibilit√© d'assurer la disponibilit√© d'un service Web d√©ploy√© dans le cloud en cas de dysfonctionnement du datacenter. La soluti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comment garantir la disponibilit√© d'un service Web dans le cloud en cas de panne du centre de donn√©es</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440338/">  L'article d√©crit la possibilit√© d'assurer la disponibilit√© d'un service Web d√©ploy√© dans le cloud en cas de dysfonctionnement du datacenter.  La solution propos√©e repose sur un compromis consistant en <i><b>une duplication partielle</b></i> : un syst√®me de sauvegarde est d√©ploy√© dans un autre datacenter, qui peut fonctionner dans un mode de fonctionnalit√© limit√©e lorsque le datacenter principal n'est pas disponible.  Ce sch√©ma est principalement destin√© √† l'application pour les d√©faillances √† court terme, mais offre √©galement la possibilit√© de transformer rapidement le syst√®me de sauvegarde en syst√®me principal en cas de probl√®mes √† grande √©chelle. <br><br><img src="https://habrastorage.org/webt/hr/hj/5f/hrhj5fooksh9x_safy_rures5zu.png"><br><a name="habracut"></a><br><h2>  Description du probl√®me </h2><br>  L'ann√©e derni√®re, nous avons √©t√© touch√©s par un incident dans le centre de donn√©es d'un c√©l√®bre fournisseur de cloud - l'un de nos services n'a pas √©t√© accessible aux utilisateurs pendant une demi-heure.  Ensuite, nous avons vu de nos propres yeux qu'en cas de probl√®mes dans le centre de donn√©es cloud, il n'y a pratiquement pas de leviers pour restaurer l'application au travail, et pour l'√©quipe responsable de l'application, il ne reste plus qu'√† mettre en place et attendre.  Cette exp√©rience nous a fait s√©rieusement r√©fl√©chir √† l'utilisation du cloud pour nos produits. <br><br>  Ce qui s'est exactement pass√© ce jour-l√† n'a jamais √©t√© d√©couvert.  Nous sommes habitu√©s √† percevoir les nuages ‚Äã‚Äãcomme un avant-poste indestructible, mais ce n'est pas le cas.  La v√©rit√© est qu'il n'y a pas de garantie √† cent pour cent de la disponibilit√© des services dans le cloud, comme dans tout autre endroit.  Les nuages ‚Äã‚Äãsont une abstraction derri√®re laquelle se cachent tous les m√™mes racks de fer dans les centres de donn√©es et le facteur humain.  Tout mat√©riel tombe t√¥t ou tard en panne (bien que les pannes mat√©rielles des centres de donn√©es soient plus susceptibles de se produire r√©guli√®rement).  En outre, il <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">existe des cas de</a> probl√®mes plus graves conduisant √† l'inaccessibilit√© des centres de donn√©es: incendies, attaques DDoS, catastrophes naturelles, coupures d'√©lectricit√© et d'Internet, etc. <br><br>  Si nous parlons du facteur humain, ce n'est pas la derni√®re cause d'accidents: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">"selon les statistiques, dans 80% des d√©faillances de l'infrastructure r√©seau, les gens sont √† bl√¢mer"</a> .  Peu importe √† quel point ils sont bien intentionn√©s, les gens ne sont pas fiables.  M√™me vous et vos coll√®gues - des personnes directement int√©ress√©es par la stabilit√© des produits pris en charge - avez probablement fait des erreurs, sans parler du personnel de la soci√©t√© de quelqu'un d'autre, pour qui vos instances ne sont pas diff√©rentes de milliers d'autres.  Quelle que soit l'√©quipe professionnelle derri√®re l'infrastructure, un nouveau probl√®me est une question de temps. <br><br>  Tout a un prix.  Lorsque vous passez au cloud, vous obtenez une abstraction simple, pratique √† utiliser, une faible d√©pendance √† l'√©gard de votre service des op√©rations en √©change d'un contr√¥le total sur la situation.  Dans ce cas, si vous ne prenez pas soin de vous √† l'avance, ayant pr√©vu la possibilit√© d'erreurs d'autrui, personne ne le fera. <br><br><h2>  Options de solution </h2><br>  Pour nous, l'indisponibilit√© du service, m√™me pendant plusieurs minutes, est d√©j√† critique.  Par cons√©quent, nous avons d√©cid√© de trouver un moyen de nous assurer contre des probl√®mes similaires √† l'avenir, sans abandonner les nuages. <br><br>  Lorsque l'on commence √† r√©soudre le probl√®me de la disponibilit√© des services dans le cloud, il convient de garder √† l'esprit que l'accessibilit√© est un concept assez large et, en fonction de ce qu'il signifie, diff√©rents sc√©narios de sa fourniture sont envisag√©s.  Bien que cet article ne traite que du probl√®me d'accessibilit√© √† la suite d'une d√©faillance du centre de donn√©es, il serait appropri√© de dire quelques mots sur les solutions √† d'autres probl√®mes d'accessibilit√©. <br><br>  La disponibilit√© comme une opportunit√© technique pour donner acc√®s √† une ressource pendant un temps sp√©cifique √† une certaine charge.  Le probl√®me se produit lorsque le service est en cours d'ex√©cution, mais en raison des ressources limit√©es et du cadre architectural du syst√®me, tous les utilisateurs ne peuvent pas y acc√©der dans un certain temps de r√©ponse.  La t√¢che est le plus souvent r√©solue en d√©ployant des instances suppl√©mentaires avec l'application.  Avec cette mise √† l'√©chelle, les nuages ‚Äã‚Äãfont un excellent travail. <br><br>  L'accessibilit√© comme la disponibilit√© d'un service Web pour les utilisateurs d'une r√©gion sp√©cifique.  La solution √©vidente ici est le sharding.  En d'autres termes, diviser le syst√®me en plusieurs applications ind√©pendantes dans diff√©rents centres de donn√©es avec ses propres donn√©es et affecter chaque utilisateur √† son instance de syst√®me, par exemple, en fonction de sa g√©olocalisation.  Lors du partage, la d√©faillance d'un centre de donn√©es dans le pire des cas entra√Ænera l'indisponibilit√© du service pour une partie seulement des utilisateurs li√©s √† ce centre de donn√©es.  Pas le dernier argument en faveur du partage - c'est un temps de ping diff√©rent du centre de donn√©es dans diff√©rentes r√©gions. <br><br>  Cependant, les restrictions impos√©es √† l'utilisation du cloud et le besoin de d√©centralisation sont souvent des exigences l√©gislatives qui sont g√©n√©ralement prises en compte m√™me au stade de la conception du syst√®me.  Ces exigences comprennent: la loi Yarovaya - le stockage des donn√©es personnelles (PD) des utilisateurs en Russie;  R√®glement g√©n√©ral sur la protection des donn√©es (RGPD) - restrictions sur le transfert transfrontalier de PD des utilisateurs de l'UE vers certains pays;  et la censure chinoise sur Internet, o√π TOUTES les communications et TOUTES les parties de l'application doivent √™tre situ√©es en Chine et, de pr√©f√©rence, sur leurs serveurs. <br><br>  Le probl√®me de l'inaccessibilit√© technique du centre de donn√©es est r√©solu en dupliquant le service dans un autre centre de donn√©es.  Ce n'est pas une t√¢che technique facile.  Le principal obstacle au d√©ploiement parall√®le de services dans diff√©rents centres de donn√©es est la base de donn√©es.  En r√®gle g√©n√©rale, les petits syst√®mes utilisent une architecture √† assistant unique.  Dans ce cas, la d√©faillance du centre de donn√©es avec le ma√Ætre rend l'ensemble du syst√®me inop√©rant.  Un sch√©ma de r√©plication ma√Ætre de r√©plication est possible, mais il impose de fortes limitations que tout le monde ne comprend pas.  En fait, il ne met pas √† l'√©chelle l'enregistrement dans la base de donn√©es, mais donne m√™me une petite p√©nalit√© de temps, car il est n√©cessaire de confirmer √† tous les n≈ìuds que la transaction a √©t√© accept√©e.  Le temps de l'op√©ration d'√©criture augmente encore plus lorsque les n≈ìuds doivent √™tre espac√©s dans diff√©rents centres de donn√©es. <br><br><h2>  Justification de la d√©cision </h2><br>  L'analyse de la charge sur notre service a montr√© qu'en moyenne environ 70% des appels √† l'API sont effectu√©s par des m√©thodes GET.  Ces m√©thodes utilisent une base de donn√©es en lecture seule. <br><br><img src="https://habrastorage.org/webt/g5/in/cy/g5incy6f1zpx1mpsv5ejbl04hqq.png" alt="Distribution d'appels de m√©thode HTTP de service Web"><br>  <i>Distribution d'appels de m√©thode HTTP de service Web</i> <br><br>  Je pense que ces r√©sultats refl√®tent l'ensemble des services Web g√©n√©ralement disponibles.  Par cons√©quent, nous pouvons dire que <i><u>dans l'API de service Web moyenne, les m√©thodes de lecture sont appel√©es beaucoup plus souvent que les m√©thodes d'√©criture</u></i> . <br><br>  La deuxi√®me d√©claration que je voudrais faire valoir est que <i><u>si nous parlons d'accessibilit√© absolue, les clients du service ont vraiment besoin d'une telle accessibilit√© non seulement de la richesse des m√©thodes d'API disponibles, mais seulement de celles qui sont n√©cessaires pour continuer le travail ¬´habituel¬ª avec le syst√®me. et effectuer des requ√™tes "normales"</u></i> .  Personne ne sera contrari√© si une m√©thode √† laquelle on acc√®de plusieurs fois par mois n'est pas disponible pendant plusieurs minutes.  Souvent, le flux ¬´normal¬ª est couvert par des m√©thodes de lecture. <br><br>  <b>Par cons√©quent, garantir la disponibilit√© absolue de m√©thodes de lecture uniquement peut d√©j√† √™tre consid√©r√© comme une option possible pour une solution √† court terme au probl√®me de la disponibilit√© du syst√®me en cas de d√©faillance du centre de donn√©es.</b> <br><br><h2>  Que voulons-nous mettre en ≈ìuvre </h2><br>  En cas de pannes dans le centre de donn√©es, nous souhaitons transf√©rer le trafic vers un syst√®me de sauvegarde dans un autre centre de donn√©es.  Dans le syst√®me de sauvegarde, toutes les m√©thodes de lecture doivent √™tre disponibles, et lors de l'appel des m√©thodes restantes, s'il est impossible de se passer de l'√©criture dans la base de donn√©es, l'erreur correcte doit √™tre affich√©e. <br><br>  En fonctionnement normal, la demande de l'utilisateur est envoy√©e √† l'√©quilibreur, qui √† son tour la redirige vers l'API principale.  Si le service principal n'est pas disponible, l'√©quilibreur d√©termine ce fait et redirige les demandes vers le syst√®me de sauvegarde fonctionnant en mode de fonctionnalit√© limit√©e.  √Ä ce moment, l'√©quipe analyse le probl√®me et d√©cide d'attendre la restauration du centre de donn√©es ou de basculer le syst√®me de sauvegarde en mode principal. <br><br><img src="https://habrastorage.org/webt/om/cw/8n/omcw8n1zd8rehycoeiy0qdahemy.png"><br><br><h2>  Algorithme d'impl√©mentation </h2><br><h4>  Changements d'infrastructure n√©cessaires </h4><br><ol><li>  Cr√©ation d'une r√©plication esclave de base de donn√©es dans un autre centre de donn√©es. </li><li>  Configuration d'un d√©ploiement de service Web, collecte de journaux, de m√©triques dans le deuxi√®me centre de donn√©es. </li><li>  La configuration de l'√©quilibreur pour la commutation du trafic vers un centre de donn√©es de rechange au cas o√π le premier ne serait pas disponible. </li></ol><br><h4>  Modifications du code: </h4><br><ol><li>  Ajout d'une connexion distincte √† la r√©plique dans le service Web. </li><li>  Migrez toutes les routes d'API en lecture seule vers une r√©plique. </li><li>  Pour les m√©thodes restantes, l'introduction du mode lecture seule via une variable d'environnement ou un autre d√©clencheur, dans lequel ils fonctionneront partiellement au lieu d'√©crire dans la base de donn√©es, ou si leur fonctionnalit√© se casse sans √©crire dans la base de donn√©es, donne une erreur correcte. </li><li>  Am√©liorations sur le frontend pour afficher l'erreur correcte lors de l'appel des m√©thodes d'enregistrement. </li></ol><br><h2>  Avantages et inconv√©nients de la solution d√©crite </h2><br><h4>  Les avantages </h4><br><ul><li>  Le principal avantage du sch√©ma propos√© est qu'il existe toujours un service en double, √† tout moment pr√™t √† servir les utilisateurs.  En cas de probl√®me avec le centre de donn√©es principal, vous n'aurez pas √† √©crire de scripts de d√©ploiement sur une autre infrastructure et √† tout ex√©cuter √† la h√¢te. </li><li>  La solution est peu co√ªteuse √† mettre en ≈ìuvre et √† entretenir.  Si vous avez une architecture de microservices et que le produit a besoin non pas d'un mais de plusieurs services, alors dans ce cas, il ne devrait pas y avoir de probl√®mes particuliers avec le transfert de tous les microservices vers ce sch√©ma. </li><li>  Il n'y a aucune menace de perte de donn√©es, car il existe toujours une copie compl√®te de la base de donn√©es sur la r√©plique dans un autre centre de donn√©es. </li><li>  La solution est principalement destin√©e √† la commutation temporaire du trafic, jusqu'√† une demi-heure.  C'est cette demi-heure qui ne suffit pas pour naviguer en cas de probl√®me avec l'infrastructure.  Si pendant cette p√©riode, le premier centre de donn√©es n'est pas restaur√©, la r√©plique esclave de la base de donn√©es se transforme en ma√Ætre et le service en double devient le principal. </li><li>  Dans le sch√©ma propos√©, l'application et la base de donn√©es se trouvent dans le m√™me centre de donn√©es.  Si vous avez une API et une base de donn√©es dans diff√©rents centres de donn√©es, il est pr√©f√©rable de les transf√©rer vers un seul: cela r√©duira consid√©rablement le temps d'ex√©cution des requ√™tes.  Par exemple, nos mesures ont montr√© que pour Google Cloud, la demande de l'API √† la base de donn√©es dans un centre de donn√©es est en moyenne de 6 ms, et lorsque vous allez pour des donn√©es vers un autre centre de donn√©es, le temps augmente de dizaines de millisecondes. </li></ul><br><h4>  Inconv√©nients </h4><br><ul><li>  L'inconv√©nient principal de l'ensemble du syst√®me est que pour la commutation instantan√©e du trafic, un √©quilibreur est requis qui n'est pas situ√© dans le m√™me centre de donn√©es avec le service principal.  L'√©quilibreur est le point d'√©chec: si le centre de donn√©es avec l'√©quilibreur tombe en panne, votre service devient de toute fa√ßon indisponible. </li><li>  La n√©cessit√© de d√©ployer le code sur un autre serveur, de surveiller des ressources suppl√©mentaires - par exemple, de surveiller la r√©plique afin qu'il n'y ait pas de d√©calage. </li></ul><br><h2>  Conclusion </h2><br>  Vous ne pouvez pas cr√©er un syst√®me r√©sistant √† tous les types de pannes.  N√©anmoins, vous prot√©ger contre certains types est une t√¢che r√©alisable.  La solution d√©crite dans l'article, qui permet d'assurer la disponibilit√© de l'application en cas de dysfonctionnements dans le datacenter, peut √™tre int√©ressante et utile dans de nombreuses applications pratiques. <br><br>  La conversion d'un service Web ordinaire en un syst√®me enti√®rement distribu√© afin de se prot√©ger contre les d√©faillances hypoth√©tiques dans le centre de donn√©es est tr√®s probablement impossible.  √Ä premi√®re vue, m√™me le sch√©ma propos√© semble redondant et ¬´lourd¬ª, mais ces inconv√©nients sont plus que chevauch√©s par ses avantages et sa facilit√© de mise en ≈ìuvre.  Vous pouvez faire une analogie avec l'assurance-accidents: il est fort probable que vous n'aurez jamais besoin d'une telle assurance, mais si un accident se produit, ce sera le bienvenu.  Avec le sch√©ma propos√©, vous serez s√ªr d'avoir toujours un syst√®me de sauvegarde pr√™t, qui, pour les probl√®mes √† court terme, garantira la disponibilit√© de la plupart des m√©thodes de service, et en cas de longues pannes, il peut devenir compl√®tement le principal en quelques minutes.  Beaucoup accepteront de payer ce prix pour une telle confiance. <br><br>  Chaque syst√®me a ses propres param√®tres de charge et exigences d'accessibilit√©.  C'est pourquoi il n'y a pas de bonne ou de mauvaise r√©ponse √† la question: "Pouvez-vous faire enti√®rement confiance √† Google Cloud ou AWS?"  - dans chaque situation sp√©cifique, il sera le sien. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr440338/">https://habr.com/ru/post/fr440338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr440328/index.html">La probabilit√© de gagner un match avec la probabilit√© connue de gagner un point II</a></li>
<li><a href="../fr440330/index.html">En bref sur les abstractions</a></li>
<li><a href="../fr440332/index.html">Base de donn√©es dans les nuages: √† qui et pourquoi - l'avis des sp√©cialistes de Data Egret</a></li>
<li><a href="../fr440334/index.html">Webinaire ouvert "D√©veloppement de syst√®mes hautement charg√©s en PHP"</a></li>
<li><a href="../fr440336/index.html">HTML que nous avons perdu</a></li>
<li><a href="../fr440342/index.html">Code C # universel pour NET et JavaScript</a></li>
<li><a href="../fr440350/index.html">Flying Bear Tornado 2 - un nouvel ours est arriv√©</a></li>
<li><a href="../fr440352/index.html">Piratage de masse VKontakte [ver XSS]</a></li>
<li><a href="../fr440354/index.html">√âv√©nements num√©riques √† Moscou du 18 au 24 f√©vrier</a></li>
<li><a href="../fr440356/index.html">Comment Habr aide √† r√©aliser ses r√™ves et √† collecter des balles</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>