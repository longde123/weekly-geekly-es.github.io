<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§µüèø üê© üí≤ PyDERASN: como escrib√≠ la biblioteca ASN.1 con slots y blobs ü§• üë©üèΩ‚Äçüè≠ üí†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ASN.1 es un est√°ndar (ISO, ITU-T, GOST) de un lenguaje que describe informaci√≥n estructurada, as√≠ como reglas de codificaci√≥n para esta informaci√≥n. P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PyDERASN: como escrib√≠ la biblioteca ASN.1 con slots y blobs</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444272/">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ASN.1</a> es un est√°ndar (ISO, ITU-T, GOST) de un lenguaje que describe informaci√≥n estructurada, as√≠ como reglas de codificaci√≥n para esta informaci√≥n.  Para m√≠, como programador, este es solo otro formato para serializar y presentar datos, junto con JSON, XML, XDR y otros.  Es extremadamente com√∫n en nuestra vida cotidiana, y muchas personas lo encuentran: en comunicaciones celulares, telef√≥nicas, VoIP (UMTS, LTE, WiMAX, SS7, H.323), en protocolos de red (LDAP, SNMP, Kerberos), en todo En cuanto a la criptograf√≠a (X.509, CMS, est√°ndares PKCS), en tarjetas bancarias y pasaportes biom√©tricos, y mucho m√°s. <br><br>  Este art√≠culo analiza <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PyDERASN</a> : la biblioteca Python ASN.1 utilizada activamente en proyectos relacionados con la criptograf√≠a en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atlas</a> . <br><br><div style="text-align:center;"><img alt="Mi propio" src="https://habrastorage.org/getpro/habr/post_images/7da/d0f/755/7dad0f755070999a4333d0206e830205.jpg"></div><a name="habracut"></a><br>  De hecho, no vale la pena recomendar ASN.1 para tareas criptogr√°ficas: ASN.1 y sus c√≥decs son complejos.  Esto significa que el c√≥digo no ser√° simple, pero siempre es un vector de ataque adicional.  Solo mire <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la lista de</a> vulnerabilidades en las bibliotecas ASN.1.  Bruce Schneier, en su <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ingenier√≠a de criptograf√≠a,</a> tampoco recomienda usar este est√°ndar debido a su complejidad: "La codificaci√≥n TLV m√°s conocida es ASN.1, pero es incre√≠blemente compleja y nos alejamos de ella".  Pero, desafortunadamente, hoy tenemos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">infraestructuras de clave p√∫blica</a> en las que se utilizan activamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">certificados X.509</a> , mensajes CRL, OCSP, TSP, CMP, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CMC</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CMS</a> y muchos est√°ndares <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PKCS</a> .  Por lo tanto, debe poder trabajar con ASN.1 si est√° haciendo algo relacionado con la criptograf√≠a. <br><br>  ASN.1 se puede codificar de varias formas / c√≥decs: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">BER</a> (Reglas b√°sicas de codificaci√≥n) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CER</a> (Reglas de codificaci√≥n can√≥nica) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">DER</a> (Reglas de codificaci√≥n distinguidas) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GSER</a> (Reglas de codificaci√≥n de cadenas gen√©ricas) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JER</a> (Reglas de codificaci√≥n JSON) </li><li>  LWER (reglas de codificaci√≥n de peso ligero) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">REA</a> (reglas de codificaci√≥n de octeto) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PER</a> (Reglas de codificaci√≥n empaquetadas) </li><li>  SER (Reglas de codificaci√≥n espec√≠ficas de se√±alizaci√≥n) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XER</a> (Reglas de codificaci√≥n XML) </li></ul><br>  y varios otros.  Pero en las tareas criptogr√°ficas en la pr√°ctica, se utilizan dos: BER y DER.  Incluso en documentos XML firmados ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XMLDSig</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">XAdES</a> ) todav√≠a habr√° objetos ASN.1 DER codificados en Base64, as√≠ como en el protocolo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ACME</a> basado en JSON de Let's Encrypt.  Puede comprender mejor todos estos c√≥decs y los principios de codificaci√≥n BER / CER / DER en art√≠culos y libros: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ASN.1 en palabras simples</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ASN.1 - Comunicaci√≥n entre sistemas heterog√©neos por Olivier Dubuisson</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ASN.1 Completo por el profesor John Larmouth</a> . <br><br>  BER es un formato TLV binario orientado a bytes (por ejemplo, PER, popular en comunicaciones m√≥viles - orientado a bits).  Cada elemento se codifica en forma de: una etiqueta ( <strong>T</strong> ag) que identifica el tipo de elemento que se codifica (entero, cadena, fecha, etc.), la longitud ( <strong>L</strong> ength) del contenido y el contenido en s√≠ ( <strong>V</strong> alue).  BER opcionalmente le permite no especificar un valor de longitud estableciendo un valor de longitud indefinido especial y terminando con un mensaje de Fin de Octetos.  Adem√°s de la codificaci√≥n de longitud, BER tiene mucha variabilidad en el m√©todo de codificaci√≥n de tipos de datos, como: <br><br><ul><li>  INTEGER, IDENTIFICADOR DE OBJETO, BIT STRING y la longitud del elemento pueden no normalizarse (no codificarse en forma m√≠nima); </li><li>  BOOLEAN es verdadero para cualquier contenido que no sea cero; </li><li>  BIT STRING puede contener cero bits "extra"; </li><li>  BIT STRING, OCTET STRING y todos sus tipos de cadenas derivados, incluida la fecha / hora, se pueden dividir en partes (trozos) de longitud variable, cuya longitud durante la (des) codificaci√≥n no se conoce de antemano; </li><li>  UTCTime / GeneralizedTime puede tener diferentes m√©todos para configurar el desplazamiento de zona horaria y las fracciones de cero "extra" de segundos; </li><li>  Los valores de SECUENCIA PREDETERMINADA pueden o no estar codificados; </li><li>  Los valores nombrados de los √∫ltimos bits en BIT STRING pueden codificarse opcionalmente; </li><li>  SECUENCIA (OF) / SET (OF) puede tener un orden arbitrario de elementos. </li></ul><br>  Para todo lo anterior, no siempre es posible codificar datos para que sean id√©nticos al formulario original.  Por lo tanto, se invent√≥ un subconjunto de las reglas: DER es una regulaci√≥n estricta de un solo m√©todo de codificaci√≥n v√°lido, que es fundamental para las tareas criptogr√°ficas, donde, por ejemplo, cambiar un bit invalidar√° la firma o la suma de verificaci√≥n.  DER tiene un inconveniente significativo: las longitudes de todos los elementos deben conocerse de antemano durante la codificaci√≥n, lo que no permite la serializaci√≥n de datos.  El c√≥dec CER no tiene este inconveniente, lo que garantiza una presentaci√≥n inequ√≠voca de los datos.  Desafortunadamente (o afortunadamente, ¬øno tenemos decodificadores a√∫n m√°s complejos?), No se hizo popular.  Por lo tanto, en la pr√°ctica, encontramos un uso "mixto" de datos codificados BER y DER.  Dado que tanto CER como DER son un subconjunto de BER, cualquier decodificador BER es capaz de procesarlos. <br><br><h2>  Problemas con pyasn1 </h2><br>  En el trabajo, escribimos muchos programas de Python relacionados con la criptograf√≠a.  Y hace unos a√±os, pr√°cticamente no hab√≠a elecci√≥n de bibliotecas gratuitas: estas son bibliotecas de muy bajo nivel que le permiten simplemente codificar / decodificar, por ejemplo, un entero y un encabezado de estructura, o esta es la biblioteca <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pyasn1</a> .  Vivimos en √©l durante varios a√±os y al principio est√°bamos muy satisfechos, ya que le permite trabajar con estructuras ASN.1 como objetos de alto nivel: por ejemplo, un objeto de certificado X.509 decodificado le permite acceder a sus campos a trav√©s de la interfaz del diccionario: cert ["tbsCertificate"] ["SerialNumber"] nos mostrar√° el n√∫mero de serie de este certificado.  Del mismo modo, puede "recopilar" objetos complejos trabajando con ellos como con listas, diccionarios, y luego simplemente llamar a la funci√≥n pyasn1.codec.der.encoder.encode y obtener una representaci√≥n serializada del documento. <br><br>  Sin embargo, se revelaron debilidades, problemas y limitaciones.  Hubo, y desafortunadamente a√∫n persiste, errores en pyasn1: al momento de escribir, en pyasn1, uno de los tipos b√°sicos, GeneralizedTime, est√° decodificado y codificado <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">incorrectamente</a> . <br><br>  En nuestros proyectos, para ahorrar espacio, a menudo almacenamos solo la ruta al archivo, el desplazamiento y la longitud en bytes del objeto al que queremos referirnos.  Por ejemplo, un archivo firmado arbitrariamente se ubicar√° en la estructura ASN.1 SignedData de CMS: <br><br><pre><code class="plaintext hljs">0 [1,3,1018] ContentInfo SEQUENCE 4 [1,1, 9] . contentType: ContentType OBJECT IDENTIFIER 1.2.840.113549.1.7.2 (id_signedData) 19-4 [0,0,1003] . content: [0] EXPLICIT [UNIV 16] ANY 19 [1,3, 999] . . DEFINED BY id_signedData: SignedData SEQUENCE 23 [1,1, 1] . . . version: CMSVersion INTEGER v3 (03) 26 [1,1, 19] . . . digestAlgorithms: DigestAlgorithmIdentifiers SET OF [...] 47 [1,3, 769] . . . encapContentInfo: EncapsulatedContentInfo SEQUENCE 51 [1,1, 8] . . . . eContentType: ContentType OBJECT IDENTIFIER 1.3.6.1.5.5.7.12.2 (id_cct_PKIData) 65-4 [1,3, 751] . . . . eContent: [0] EXPLICIT OCTET STRING 751 bytes OPTIONAL      751  820 [1,2, 199] . . . signerInfos: SignerInfos SET OF 823 [1,2, 196] . . . . 0: SignerInfo SEQUENCE 826 [1,1, 1] . . . . . version: CMSVersion INTEGER v3 (03) 829 [0,0, 22] . . . . . sid: SignerIdentifier CHOICE subjectKeyIdentifier [...] 956 [1,1, 64] . . . . . signature: SignatureValue OCTET STRING 64 bytes . . . . . . C1:B3:88:BA:F8:92:1C:E6:3E:41:9B:E0:D3:E9:AF:D8 . . . . . . 47:4A:8A:9D:94:5D:56:6B:F0:C1:20:38:D2:72:22:12 . . . . . . 9F:76:46:F6:51:5F:9A:8D:BF:D7:A6:9B:FD:C5:DA:D2 . . . . . . F3:6B:00:14:A4:9D:D7:B5:E1:A6:86:44:86:A7:E8:C9</code> </pre> <br>  y podemos obtener el archivo original firmado con un desplazamiento de 65 bytes, 751 bytes de longitud.  pyasn1 no almacena esta informaci√≥n en sus objetos decodificados.  El llamado TLVSeeker fue escrito: una peque√±a biblioteca que le permite decodificar las etiquetas y las longitudes de los objetos, en cuya interfaz le ordenamos "ir a la siguiente etiqueta", "ir dentro de la etiqueta" (ir dentro de la SECUENCIA del objeto), "ir a la siguiente etiqueta", "decirle a su desplazamiento y la longitud del objeto donde estamos ".  Fue una caminata "manual" sobre los datos serializados DER de ASN.1.  Pero no era posible trabajar con datos serializados BER de esta manera, porque, por ejemplo, la cadena de bytes OCTET STRING podr√≠a codificarse como varios fragmentos. <br><br>  Otro inconveniente para nuestras tareas pyasn1 es la incapacidad de comprender a partir de objetos decodificados si un campo dado estaba presente en SECUENCIA o no.  Por ejemplo, si la estructura contiene el campo OPCIONAL SECUENCIA DE CAMPO, podr√≠a estar completamente ausente de los datos recibidos (OPCIONAL), pero podr√≠a estar presente, pero podr√≠a ser de longitud cero (lista vac√≠a).  En el caso general, esto no pudo aclararse.  Y esto es necesario para una verificaci√≥n rigurosa de la validez de los datos recibidos.  ¬°Imag√≠nese que alguna autoridad de certificaci√≥n emitir√≠a un certificado con datos "no enteramente" v√°lidos desde el punto de vista de los esquemas ASN.1!  Por ejemplo, la autoridad de certificaci√≥n T√úRKTRUST Elektronik Sertifika Hizmet Saƒülayƒ±cƒ±sƒ± en su certificado ra√≠z super√≥ los l√≠mites permisibles de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">RFC 5280</a> para la longitud del componente sujeto; no se puede decodificar honestamente de acuerdo con el esquema.  El c√≥dec DER requiere que un campo cuyo valor sea DEFAULT no se codifique durante la transmisi√≥n; tales documentos se encuentran en la vida, y la primera versi√≥n de PyDERASN incluso permiti√≥ conscientemente ese comportamiento no v√°lido (desde el punto de vista de DER) en aras de la compatibilidad con versiones anteriores. <br><br>  Otra limitaci√≥n es la incapacidad de descubrir f√°cilmente en qu√© forma (BER / DER) se codific√≥ uno u otro objeto en la estructura.  Por ejemplo, el est√°ndar CMS dice que el mensaje est√° codificado con BER, pero el campo firmadoAttrs, sobre el cual se forma la firma criptogr√°fica, debe estar en DER.  Si decodificamos con el DER, entonces recaeremos en el procesamiento del CMS en s√≠, si decodificamos con el BER, no sabremos en qu√© forma se firm√≥ el atributo.  Como resultado, ser√° necesario que TLVSeeker (el an√°logo de los cuales no est√° en pyasn1) busque la ubicaci√≥n de cada uno de los campos firmadosAttrs, y DER debe decodificarlo por separado desde la vista serializada. <br><br>  La posibilidad de procesamiento autom√°tico de los campos DEFINED BY, que son muy comunes, fue muy deseable para nosotros.  Despu√©s de decodificar la estructura ASN.1, es posible que nos queden muchos CUALQUIER campo, que deben procesarse m√°s de acuerdo con el esquema seleccionado en funci√≥n del IDENTIFICADOR DE OBJETO especificado en el campo de estructura.  En el c√≥digo Python, esto significa escribir un if y luego llamar al decodificador para CUALQUIER campo. <br><br><h2>  El advenimiento de PyDERASN </h2><br>  En Atlas, regularmente, despu√©s de encontrar problemas o modificar los programas gratuitos utilizados, enviamos parches a la parte superior.  En pyasn1, enviamos mejoras varias veces, pero el c√≥digo pyasn1 no es el m√°s f√°cil de entender, y a veces se produjeron cambios de API incompatibles, lo que nos golpe√≥ en las manos.  Adem√°s, estamos acostumbrados a escribir pruebas con pruebas generativas, que no era el caso en pyasn1. <br><br>  ¬°Un buen d√≠a, decid√≠ que ten√≠a que soportar esto y era hora de intentar escribir mi propia biblioteca con __slot __s, offset y blobs bellamente exhibidos!  Simplemente crear un c√≥dec ASN.1 no ser√≠a suficiente: debe transferirle todos nuestros proyectos dependientes, y esto es cientos de miles de l√≠neas de c√≥digo en las que hay mucho trabajo con estructuras ASN.1.  Ese es uno de los requisitos para ello: facilidad de traducci√≥n del c√≥digo pyasn1 actual.  Despu√©s de pasar todas mis vacaciones, escrib√≠ esta biblioteca, le transfer√≠ todos los proyectos.  Dado que tienen una cobertura de pruebas de casi el 100%, esto tambi√©n significaba que la biblioteca estaba en pleno funcionamiento. <br><br>  PyDERASN, del mismo modo, tiene casi el 100% de cobertura de prueba.  Las pruebas generativas se utilizan con la maravillosa biblioteca de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hip√≥tesis</a> .  Tambi√©n se llev√≥ a cabo un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">fuzzing</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pypy</a> en 32 m√°quinas nucleares.  A pesar de que casi no nos queda ning√∫n c√≥digo Python2, PyDERASN a√∫n mantiene la compatibilidad con √©l y, debido a esto, tiene una sola dependencia de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">seis</a> .  Adem√°s, se <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">prueba con el conjunto de pruebas de cumplimiento ASN.1: 2008</a> . <br><br>  El principio de trabajar con √©l es similar a pyasn1: trabajar con objetos Python de alto nivel.  La descripci√≥n de los circuitos ASN.1 es similar. <br><br><pre> <code class="plaintext hljs">class TBSCertificate(Sequence): schema = ( ("version", Version(expl=tag_ctxc(0), default="v1")), ("serialNumber", CertificateSerialNumber()), ("signature", AlgorithmIdentifier()), ("issuer", Name()), ("validity", Validity()), ("subject", Name()), ("subjectPublicKeyInfo", SubjectPublicKeyInfo()), ("issuerUniqueID", UniqueIdentifier(impl=tag_ctxp(1), optional=True)), ("subjectUniqueID", UniqueIdentifier(impl=tag_ctxp(2), optional=True)), ("extensions", Extensions(expl=tag_ctxc(3), optional=True)), )</code> </pre><br>  Sin embargo, PyDERASN tiene una apariencia de tipeo fuerte.  En pyasn1, si el campo era de tipo CMSVersion (INTEGER), se le podr√≠a asignar un int o INTEGER.  PyDERASN requiere estrictamente que el objeto asignado sea exactamente CMSVersion.  Adem√°s de escribir c√≥digo Python3, utilizamos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">anotaciones de tipeo</a> , por lo que nuestras funciones no tendr√°n argumentos incomprensibles como def func (serial, contenido), pero def func (serial: CertificateSerialNumber, contenido: EncapsulatedContentInfo), y PyDERASN ayuda a realizar un seguimiento de tales c√≥digo <br><br>  Al mismo tiempo, PyDERASN tiene concesiones extremadamente convenientes para este tipo de escritura.  pyasn1 no permiti√≥ que SubjectKeyIdentifier (). subtype (impllicitTag = Tag (...)) asignara un objeto SubjectKeyIdentifier () (sin la ETIQUETA IMPLICIT requerida) y a menudo tuvo que copiar y recrear objetos solo debido a las etiquetas IMPLICIT / EXPLICIT cambiadas.  PyDERASN observa estrictamente solo el tipo b√°sico: sustituir√° autom√°ticamente las etiquetas de una estructura ASN.1 existente.  Esto simplifica enormemente el c√≥digo de la aplicaci√≥n. <br><br>  Si se produce un error durante la decodificaci√≥n, en pyasn1 no es f√°cil entender exactamente d√≥nde ocurri√≥.  Por ejemplo, en el certificado turco ya mencionado obtenemos este error: UTF8String (tbsCertificate: issuer: rdnSequence: 3: 0: value: DEFINED BY 2.5.4.10:utf8String) (at 138) l√≠mites insatisfechos: 1 ‚áê 77 ‚áê 64 Al escribir ASN .1 las estructuras de las personas pueden cometer errores, y es m√°s f√°cil depurar aplicaciones o descubrir problemas de documentos codificados del lado opuesto. <br><br>  La primera versi√≥n de PyDERASN no era compatible con la codificaci√≥n BER.  Apareci√≥ mucho m√°s tarde y el procesamiento UTCTime / GeneralizedTime con zonas horarias a√∫n no es compatible.  Esto vendr√° en el futuro, porque el proyecto est√° escrito principalmente en el tiempo libre. <br><br>  Tambi√©n en la primera versi√≥n no hubo trabajo con los campos DEFINED BY.  Unos meses m√°s tarde, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">apareci√≥</a> esta <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">oportunidad</a> y comenz√≥ a utilizarse activamente, lo que redujo significativamente el c√≥digo de la aplicaci√≥n: en una operaci√≥n de decodificaci√≥n, fue posible desmontar toda la estructura a la profundidad misma.  Para hacer esto, en el esquema, qu√© campos est√°n definidos que "determinan".  Por ejemplo, una descripci√≥n de un esquema CMS: <br><br><pre> <code class="plaintext hljs">class ContentInfo(Sequence): schema = ( ("contentType", ContentType(defines=((("content",), { id_authenticatedData: AuthenticatedData(), id_digestedData: DigestedData(), id_encryptedData: EncryptedData(), id_envelopedData: EnvelopedData(), id_signedData: SignedData(), }),))), ("content", Any(expl=tag_ctxc(0))), )</code> </pre><br>  dice que si contentType contiene un OID con id_signedData, entonces el campo de contenido (ubicado en la misma SECUENCIA) debe decodificarse utilizando el esquema SignedData.  ¬øPor qu√© hay tantos corchetes?  Un campo puede "definir" varios campos al mismo tiempo, como es el caso en las estructuras de EnvelopedData.  Los campos definidos se identifican mediante la llamada ruta de decodificaci√≥n: establece la ubicaci√≥n exacta de cualquier elemento en todas las estructuras. <br><br>  No siempre es deseable o no siempre es posible introducir inmediatamente estas definiciones en el circuito.  Puede haber casos espec√≠ficos de aplicaciones en los que los OID y las estructuras solo se conocen en un proyecto de terceros.  PyDERASN proporciona la capacidad de especificar estas definiciones justo en el momento de decodificar la estructura: <br><br><pre> <code class="plaintext hljs">ContentInfo().decode(data, ctx={"defines_by_path": (( ( "content", DecodePathDefBy(id_signedData), "certificates", any, "certificate", "tbsCertificate", "extensions", any, "extnID", ), ((("extnValue",), { id_ce_authorityKeyIdentifier: AuthorityKeyIdentifier(), id_ce_basicConstraints: BasicConstraints(), [...] id_ru_subjectSignTool: SubjectSignTool(), }),), ),)})</code> </pre><br>  Aqu√≠ decimos que en CMS SignedData para todos los certificados adjuntos, decodifica todas sus extensiones (AuthorityKeyIdentifier, BasicConstraints, SubjectSignTool, etc.).  A trav√©s de la ruta de decodificaci√≥n, indicamos qu√© elemento "sustituir" define, como si estuviera definido en el circuito. <br><br>  Finalmente, PyDERASN tiene la capacidad de trabajar desde la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">l√≠nea de comandos</a> para decodificar archivos ASN.1 y tiene <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">una impresi√≥n bastante</a> rica.  Puede decodificar un ASN.1 arbitrario, o puede especificar un esquema claramente definido y ver algo como esto: <br><br><img alt="Bonito ejemplo de impresi√≥n" src="https://habrastorage.org/getpro/habr/post_images/3dc/981/000/3dc981000f30512bf2ca9488332345d4.png"><br><br>  Informaci√≥n mostrada: desplazamiento de objeto, longitud de etiqueta, longitud de longitud, longitud de contenido, presencia de EOC (fin de octetos), bandera de codificaci√≥n BER, bandera de codificaci√≥n de longitud indefinida, longitud de etiqueta EXPLICIT y compensaci√≥n (si existe), profundidad de anidamiento de objeto en estructuras, valor de etiqueta IMPLICIT / EXPLICIT, nombre de objeto de acuerdo con el esquema, su tipo ASN.1 b√°sico, n√∫mero de serie dentro de SECUENCIA / CONJUNTO, valor CHOICE (si lo hay), nombre legible para humanos INTEGER / ENUMERATED / BIT STRING de acuerdo con el esquema, valor de cualquier tipo b√°sico , Indicador POR DEFECTO / OPCIONAL del circuito, una se√±al de que el objeto fue decodificado autom√°ticamente como DEFINIDO POR y despu√©s  gm de OID-y sucedi√≥, OID chelovekochitaemy. <br><br>  El bonito sistema de impresi√≥n est√° hecho especialmente para generar una secuencia de objetos PP que ya se visualizan por medios separados.  La captura de pantalla muestra el renderizador en texto plano.  Hay renderizadores en formato JSON / HTML para que esto se pueda ver resaltado en el navegador ASN.1 como en el proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">asn1js</a> . <br><br><h2>  Otras bibliotecas </h2><br>  Este no era el objetivo, pero PyDERASN fue significativamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">m√°s r√°pido</a> que pyasn1.  Por ejemplo, decodificar archivos CRL de megabytes puede llevar tanto tiempo que tenga que pensar en formatos intermedios para almacenar datos (r√°pido) y cambiar la arquitectura de las aplicaciones.  pyasn1 decodifica CRL <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">CACert.org</a> en mi computadora port√°til durante m√°s de 20 minutos, ¬°mientras que PyDERASN en solo 28 segundos!  Hay un proyecto <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">asn1crypto</a> destinado a trabajar r√°pidamente con estructuras criptogr√°ficas: decodifica (completamente, no perezosamente) la misma CRL en 29 segundos, pero consume casi el doble de RAM cuando se ejecuta en Python3 (983 MiB versus 498), y 3.5 veces con Python2 (1677 contra 488), mientras que pyasn1 consume hasta 4.3 veces m√°s (2093 contra 488). <br><br>  asn1crypto, que mencion√©, no lo consideramos, porque el proyecto estaba reci√©n en pa√±ales y no hab√≠amos o√≠do hablar de √©l.  Ahora tampoco comenzar√≠an a mirar en su direcci√≥n, ya que descubr√≠ de inmediato que el mismo GeneralizedTime no tiene un aspecto arbitrario, y al serializar, elimina silenciosamente fracciones de un segundo.  Esto es aceptable para trabajar con certificados X.509, pero en general no funcionar√°. <br><br>  Por el momento, PyDERASN es el decodificador Py DER / Go DER m√°s estricto que conozco.  En la biblioteca de codificaci√≥n / asn1 de mi Go favorito, no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hay una verificaci√≥n estricta de las</a> cadenas IDENTIFICADOR DE OBJETO y UTCTime / GeneralizedTime.  A veces, la rigidez puede interferir (principalmente debido a la compatibilidad con aplicaciones anteriores que nadie solucionar√°), por lo que en PyDERASN durante la decodificaci√≥n puede pasar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">varias configuraciones que</a> debilitan las verificaciones. <br><br>  El c√≥digo del proyecto intenta ser lo m√°s simple posible.  Toda la biblioteca es un solo archivo.  El c√≥digo est√° escrito con √©nfasis en la facilidad de comprensi√≥n, sin rendimiento innecesario y optimizaciones de c√≥digo DRY.  Como ya dije, no admite la decodificaci√≥n BER completa de las cadenas UTCTime / GeneralizedTime, as√≠ como los tipos de datos REAL, RELATIVE OID, EXTERNAL, INSTANCE OF, EMBEDDED PDV, CHARACTER STRING.  En todos los dem√°s casos, personalmente, no veo ninguna raz√≥n para usar otras bibliotecas en Python. <br><br>  Al igual que todos mis proyectos, como <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">PyGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GoGOST</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NNCP</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GoVPN</a> , PyDERASN es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">un software</a> completamente <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">gratuito</a> distribuido bajo los t√©rminos de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">LGPLv3 +</a> , y est√° disponible para su descarga gratuita.  Ejemplos de uso est√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">las pruebas PyGOST</a> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Sergey Matveev</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">banco de cifrado</a> , miembro de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">la</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Open Society</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Foundation Foundation</a> , Python / Go-developer, jefe especialista de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">FSUE "STC Atlas"</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/444272/">https://habr.com/ru/post/444272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444260/index.html">Estamos desarrollando un sistema para evaluar el trabajo de los agentes de soporte.</a></li>
<li><a href="../444262/index.html">C√≥digo fuente de Markdown2pdf para Linux</a></li>
<li><a href="../444264/index.html">¬øC√≥mo convertirse en un committer y realmente lo necesita?</a></li>
<li><a href="../444268/index.html">Semana de la seguridad 12: ataques de teclado</a></li>
<li><a href="../444270/index.html">Webinar grupal del IB ‚ÄúEnfoque grupal del IB para la educaci√≥n cibern√©tica: una visi√≥n general de los programas actuales y casos pr√°cticos‚Äù</a></li>
<li><a href="../444274/index.html">Una respuesta detallada al comentario, as√≠ como un poco sobre la vida de los proveedores en la Federaci√≥n Rusa</a></li>
<li><a href="../444276/index.html">Introducci√≥n para reaccionar la arquitectura de fibra</a></li>
<li><a href="../444278/index.html">C√≥mo hacer que decenas de miles de personas lean su art√≠culo en ingl√©s para Habr: 3 consejos simples</a></li>
<li><a href="../444282/index.html">7 extensiones de Chrome para aprender ingl√©s</a></li>
<li><a href="../444284/index.html">compositor y terminaci√≥n de l√≠nea de comando</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>