<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©üèø‚Äç‚úàÔ∏è üíô üç∫ Int√©gration de Git dans un syst√®me de d√©veloppement d'entreprise üèåÔ∏è üíÇüèº ü§Ωüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Les d√©veloppeurs qui savent et savent travailler avec git ont grandi ces derniers temps d'un ordre de grandeur. Vous vous habituez √† la vitesse d'ex√©c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Int√©gration de Git dans un syst√®me de d√©veloppement d'entreprise</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412787/"><p><img src="https://habrastorage.org/webt/vt/fp/ou/vtfpoukjlruesmucbjvwrgshncc.jpeg"></p><br><p>  Les d√©veloppeurs qui savent et savent travailler avec git ont grandi ces derniers temps d'un ordre de grandeur.  Vous vous habituez √† la vitesse d'ex√©cution des commandes.  Vous vous habituez √† la commodit√© des succursales et √† l'annulation facile des modifications.  La r√©solution des conflits est si courante que les programmeurs sont habitu√©s √† r√©soudre h√©ro√Øquement les conflits l√† o√π ils ne devraient pas l'√™tre. </p><br><p> Notre √©quipe chez Directum d√©veloppe un outil de d√©veloppement pour les solutions de plate-forme.  Si vous avez vu 1C, vous pouvez imaginer √† peu pr√®s l'environnement de travail de nos ¬´clients¬ª - les d√©veloppeurs d'applications.  √Ä l'aide de cet outil de d√©veloppement, un d√©veloppeur d'applications cr√©e une solution d'application pour les clients. </p><br><p>  Notre √©quipe a eu pour t√¢che de simplifier la vie de nos candidats.  Nous sommes g√¢t√©s avec des puces modernes de Visual Studio, ReSharper et IDEA.  Les candidats ont exig√© que nous int√©grions git out of the box dans l'outil. </p><a name="habracut"></a><br><p>  Telle est la difficult√©.  Dans l'outil pour chaque type d'entit√© (contrat, rapport, annuaire, module), un verrou pourrait √™tre pr√©sent.  Un d√©veloppeur a commenc√© √† modifier le type d'entit√© et l'a bloqu√© jusqu'√† ce qu'il ait termin√© les modifications et les ait valid√©es sur le serveur.  √Ä l'heure actuelle, d'autres d√©veloppeurs voient le m√™me type d'entit√© en lecture seule.  Le d√©veloppement rappelait quelque peu le travail en SVN ou l'envoi d'un document Word par mail entre plusieurs utilisateurs.  Je veux tout √† la fois, mais peut-√™tre un seul. </p><br><p>  Chaque type d'entit√© peut avoir de nombreux gestionnaires (ouverture d'un document, validation avant l'enregistrement, √©criture dans la base de donn√©es), dans lesquels vous souhaitez √©crire du code qui fonctionne avec une instance sp√©cifique de l'entit√©.  Par exemple, verrouillez les boutons, affichez un message √† l'utilisateur ou cr√©ez une nouvelle t√¢che pour les interpr√®tes.  Tout le code dans le cadre de l'API fourni par la plateforme.  Les gestionnaires sont des classes dans lesquelles se trouvent de nombreuses m√©thodes.  Lorsque deux personnes devaient r√©parer le m√™me fichier avec le code, cela n'√©tait pas possible, car la plate-forme bloquait tout le type d'entit√© avec le code d√©pendant. </p><br><p>  Nos pratiquants sont all√©s jusqu'au bout.  Ils se sont tranquillement fourr√©s une copie ¬´ill√©gale¬ª de notre environnement de d√©veloppement, ont comment√© la partie bloquante et ont fusionn√© nos engagements avec eux-m√™mes.  Le code de l'application a √©t√© conserv√© sous git, engag√© via des outils tiers (git bash, SourceTree et autres).  Nous avons tir√© nos conclusions: </p><br><ol><li>  Notre √©quipe a sous-estim√© la volont√© des d√©veloppeurs d'applications de s'int√©grer √† la plateforme.  Un immense respect et honneur! </li><li>  La solution qu'ils ont propos√©e n'est pas adapt√©e √† la production.  Avec git, les mains d'une personne sont d√©li√©es et elle est capable de cr√©er n'importe quoi.  Pour supporter toute la diversit√© sera stupide, ne d√©tournez pas.  De plus, il sera n√©cessaire d'√©duquer les clients de la plateforme.  La documentation de toutes les commandes git pour la plateforme rendrait l'√©quipe de documentation folle. </li></ol><br><p><img src="https://habrastorage.org/webt/2o/o9/ik/2oo9ikx4h9ctyrdh86yktmh-waa.jpeg"></p><br><h1 id="chego-hochetsya-ot-git">  Ce que vous voulez de Git </h1><br><p>  Donc, donner pour la production avec un git out n'est pas bon.  Nous avons d√©cid√© de r√©sumer en quelque sorte la logique des principales op√©rations et d'en limiter le nombre.  Au moins pour la premi√®re version.  La liste des √©quipes a √©t√© r√©duite au fur et √† mesure et peut rester: </p><br><ul><li>  statut </li><li>  commettre </li><li>  tirer </li><li>  pousser </li><li>  r√©initialiser --hard √† HEAD </li><li>  r√©initialiser au dernier commit "serveur" </li></ul><br><p>  Pour la premi√®re version, ils ont d√©cid√© de refuser de travailler avec des succursales.  Non pas que ce soit tr√®s difficile, mais l'√©quipe n'a pas respect√© les ressources en temps. </p><br><p>  P√©riodiquement, nos partenaires envoient leur d√©veloppement d'application et demandent: "Quelque chose ne fonctionne pas pour nous. Que faisons-nous de mal?".  Dans ce cas, l'application se charge du d√©veloppement de quelqu'un d'autre et examine le code.  Cela fonctionnait comme ceci: </p><br><ol><li>  Le d√©veloppeur a emport√© l'archive avec le d√©veloppement; </li><li>  Modification de la base de donn√©es locale dans les configurations; </li><li>  Vers√© le d√©veloppement de quelqu'un d'autre √† sa base; </li><li>  D√©bogu√©, trouv√© des erreurs; </li><li>  Recommandations √©mises; </li><li>  Il a rendu son d√©veloppement. </li></ol><br><p>  La nouvelle m√©thodologie ne cadrait pas avec l'ancienne approche.  J'ai d√ª me casser la t√™te.  L'√©quipe a propos√© deux approches pour r√©soudre ce probl√®me: </p><br><ol><li>  Stockez tous les d√©veloppements dans un r√©f√©rentiel git.  Si n√©cessaire, travaillez avec la d√©cision de quelqu'un d'autre de cr√©er une branche temporaire. </li><li>  Stocker le d√©veloppement de diff√©rentes √©quipes dans diff√©rents r√©f√©rentiels.  D√©placez les param√®tres des dossiers charg√©s dans l'environnement dans le fichier de configuration. </li></ol><br><p>  Nous avons d√©cid√© de suivre la deuxi√®me voie.  Le premier semblait plus difficile √† mettre en ≈ìuvre et, de plus, il √©tait plus facile de se tirer une balle dans le pied avec un changement de branche. </p><br><p>  Mais le second n'est pas non plus sucr√©.  Les commandes d√©crites ci-dessus devraient fonctionner non seulement dans le m√™me r√©f√©rentiel, mais avec plusieurs √† la fois.  Y a-t-il un changement dans les types d'entit√©s des diff√©rents r√©f√©rentiels?  Nous les montrons dans une seule fen√™tre.  Ceci est plus pratique et transparent pour le d√©veloppeur d'applications.  En appuyant sur le bouton de validation, l'outil valide les modifications dans chacun des r√©f√©rentiels.  Par cons√©quent, les commandes pull / push / reset ¬´sous le capot¬ª fonctionnent avec des r√©f√©rentiels physiquement diff√©rents. </p><br><p><img src="https://habrastorage.org/webt/cj/jx/hc/cjjxhctyhbggbu0zuy2-tfw1zhs.jpeg"></p><br><h1 id="libgit2sharp">  Libgit2sharp </h1><br><p>  Pour travailler avec git, nous avons choisi entre deux options: </p><br><ol><li>  Travaillez avec git install√© sur le syst√®me, en le faisant passer par Process.Start et en analysant la sortie. </li><li>  Utilisez libgit2sharp, qui via pinvoke extrait la biblioth√®que libgit2. </li></ol><br><p>  Il nous a sembl√© que l'utilisation d'une biblioth√®que pr√™te √† l'emploi est une solution raisonnable.  En vain.  Je vous dirai un peu plus tard pourquoi.  Au d√©but, la biblioth√®que nous a donn√© l'occasion de d√©ployer rapidement un prototype fonctionnel. </p><br><h1 id="pervaya-iteraciya-razrabotki">  Premi√®re it√©ration de d√©veloppement </h1><br><p> Il a √©t√© possible de l'impl√©menter en un mois environ.  En fait, visser le git a √©t√© rapide, et la plupart du temps, nous avons essay√© de gu√©rir les blessures qui avaient √©t√© ouvertes parce que nous avions supprim√© l'ancien m√©canisme de stockage des fichiers source.  Tout ce que l' <code>git status</code> renvoy√© a √©t√© renvoy√© √† l'interface.  Cliquer sur chaque fichier affiche diff.  Cela ressemblait √† une interface git gui. </p><br><h1 id="vtoraya-iteraciya-razrabotki">  Deuxi√®me it√©ration de d√©veloppement </h1><br><p>  La premi√®re option √©tait trop informative.  Avec chaque type d'entit√©, de nombreux fichiers sont associ√©s √† la fois.  Ces fichiers ont cr√©√© du bruit et il est devenu difficile de savoir quels types d'entit√©s ont chang√© et quoi exactement. </p><br><p>  Fichiers group√©s par type d'entit√©.  Chaque fichier a re√ßu un nom lisible par l'homme, le m√™me que dans l'interface graphique.  Les m√©tadonn√©es de type d'entit√© sont d√©crites dans JSON.  Ils devaient √©galement √™tre pr√©sent√©s dans un format lisible par l'homme.  L'analyse des changements dans les versions json "avant" et "apr√®s" a √©t√© lanc√©e √† l'aide de la biblioth√®que jsondiffpatch, puis ils ont √©crit leur propre impl√©mentation de la comparaison JSON (ci-apr√®s, j'appellerai jsondiff).  Nous ex√©cutons les r√©sultats de la comparaison via des analyseurs qui produisent des enregistrements lisibles par l'homme.  De nombreux fichiers ont √©t√© masqu√©s, laissant une simple entr√©e dans l'arborescence des modifications. </p><br><p>  Le r√©sultat final est le suivant: </p><br><p><img src="https://habrastorage.org/webt/g7/pl/3k/g7pl3ku4bqatgba2u9t6_msyxlc.png"></p><br><h1 id="voznikshie-slozhnosti-s-libgit2">  Avoir des probl√®mes avec libgit2 </h1><br><p>  Libgit2 a g√©n√©r√© un grand nombre de surprises inattendues.  S'occuper de certains d√©passait le pouvoir d'un d√©lai raisonnable.  Je vais vous dire ce dont je me souviens. </p><br><p>  Chutes inattendues et difficiles √† reproduire sur certaines op√©rations standard.  "Aucune erreur fournie par la biblioth√®que native" nous dit le wrapper.  Super.  Vous maudissez, vous reconstruisez la biblioth√®que native en d√©bogage, vous r√©p√©tez un cas pr√©c√©demment abandonn√©, mais il ne plante pas en mode d√©bogage.  Reconstruisez dans la version et retombez. </p><br><p>  Si un outil tiers, par exemple SourceTree, s'ex√©cute en parall√®le avec libgit2sharp, alors commit peut ne pas valider certains fichiers.  Ou se fige lors de l'affichage des diff√©rences sur certains fichiers.  D√®s que vous essayez de d√©boguer, vous ne pouvez pas reproduire. </p><br><p>  Dans l'une de nos applications, la mise en ≈ìuvre de l'analogue <code>git status</code> pris 40 secondes.  Quarante Carl!  Dans le m√™me temps, le git lanc√© depuis la console a fonctionn√© comme il se doit pendant une seconde.  J'ai pass√© quelques jours pour r√©gler le probl√®me.  Lors de la recherche de modifications, Libgit2 examine les attributs de fichier des dossiers et les compare avec l'entr√©e de l'index.  Si l'heure de modification est diff√©rente, alors quelque chose a chang√© dans le dossier et vous devez regarder √† l'int√©rieur et / ou regarder dans les fichiers.  Et si rien n'a chang√©, vous ne devez pas monter √† l'int√©rieur.  Cette optimisation est apparemment √©galement dans la console git.  Je ne sais pas pour quelle raison, mais juste pour une personne dans l'index git mtime a chang√©.  Pour cette raison, git a v√©rifi√© le contenu de TOUS les fichiers dans le r√©f√©rentiel √† chaque fois pour des modifications. </p><br><p>  Plus pr√®s de la sortie, notre √©quipe a c√©d√© aux souhaits de l'√©quipe d'application et a remplac√© <code>git pull</code> par <code>fetch + rebase + autostash</code> .  Et puis un tas de bugs nous est parvenu, y compris avec "Aucune erreur fournie par la biblioth√®que native". </p><br><p>  status, pull et rebase fonctionnent beaucoup plus longtemps que d'appeler des commandes de console. </p><br><h1 id="avtomaticheskiy-merzh">  Fusion automatique </h1><br><p>  Les fichiers en d√©veloppement sont divis√©s en deux types: </p><br><ol><li>  Fichiers que l'application voit dans l'outil de d√©veloppement.  Par exemple, du code, des images, des ressources.  Ces fichiers doivent √™tre fusionn√©s comme le fait git. </li><li>  Fichiers JSON cr√©√©s par l'environnement de d√©veloppement, mais le d√©veloppeur de l'application ne les voit que sous la forme d'une interface graphique.  Ils doivent r√©soudre automatiquement les conflits. </li><li>  Fichiers g√©n√©r√©s qui sont automatiquement recr√©√©s lorsque vous travaillez avec l'outil de d√©veloppement.  Ces fichiers n'entrent pas dans le r√©f√©rentiel, l'outil place imm√©diatement soigneusement .gitignore. </li></ol><br><p>  Avec une nouvelle fa√ßon, deux applicateurs diff√©rents ont pu changer le m√™me type d'entit√©. </p><br><p>  Par exemple, Sasha modifiera les informations sur la fa√ßon de stocker le type d'une entit√© dans la base de donn√©es et d'√©crire un gestionnaire pour l'√©v√©nement d'enregistrement, et Sergey stylisera la repr√©sentation de l'entit√©.  D'un point de vue git, ce ne sera pas un conflit et les deux changements fusionneront sans complexit√©. </p><br><p>  Et puis Sasha a chang√© la propri√©t√© Property1 et a d√©fini un gestionnaire pour cela.  Sergey a cr√©√© la propri√©t√© Property2 et d√©fini le gestionnaire.  Si vous regardez la situation ci-dessus, leurs modifications n'entrent pas en conflit, bien que du point de vue de git, les m√™mes fichiers soient affect√©s. <br>  Je voulais que l'instrument soit en mesure de r√©soudre seul cette situation. </p><br><p>  Un exemple d'algorithme pour fusionner deux JSON en cas de conflit: </p><br><ol><li><p>  T√©l√©chargez depuis le git de base JSON. </p><br></li><li><p>  T√©l√©chargez depuis notre gita JSON. </p><br></li><li><p>  T√©l√©chargement de leur JSON √† partir d'un git. </p><br></li><li><p>  En utilisant jsondiff, nous formons les correctifs logiciels de base et les n√¥tres et nous les appliquons.  Le JSON r√©sultant est appel√© P1. </p><br></li><li><p>  En utilisant jsondiff, nous formons les correctifs logiciels de base et les appliquons aux n√¥tres.  Le JSON r√©sultant est appel√© P2. </p><br></li><li><p>  Id√©alement, apr√®s application des patchs P1 === P2.  Si c'est le cas, √©crivez P1 sur le disque. </p><br></li><li>  Dans un cas imparfait (lorsqu'un conflit existe r√©ellement), nous sugg√©rons √† l'utilisateur de choisir entre P1 et P2 avec la possibilit√© de terminer avec ses mains.  Nous √©crivons la s√©lection sur le disque. </li></ol><br><p>  Apr√®s la fusion, nous v√©rifions si l'√©tat sans erreur de validation est atteint.  Si vous n'√™tes pas arriv√©, annulez la fusion et demandez √† l'utilisateur de la r√©p√©ter.  Ce n'est pas la meilleure solution, mais cela garantit au moins qu'√† partir de la deuxi√®me ou de la troisi√®me tentative, la fusion se fera sans cons√©quences d√©sagr√©ables. </p><br><h1 id="itogi">  R√©sum√© </h1><br><ol><li>  Les bouchers sont heureux de pouvoir les utiliser l√©galement. </li><li>  L'introduction de git a acc√©l√©r√© le d√©veloppement. </li><li>  Les fusions automatiques ressemblent g√©n√©ralement √† de la magie. </li><li>  Nous pla√ßons le rejet futur de libgit2 en faveur de l'invocation du processus git. </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr412787/">https://habr.com/ru/post/fr412787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es436936/index.html">Dep√≥sito nuclear japon√©s en Primorye o el sitio de disposici√≥n de los submarinos nucleares de la Flota del Pac√≠fico</a></li>
<li><a href="../es436938/index.html">Guix es el sistema operativo m√°s avanzado.</a></li>
<li><a href="../fr412781/index.html">Un fan de NES a permis de lancer des jeux SNES sur la console</a></li>
<li><a href="../fr412783/index.html">Installation du proxy MTProto Telegram √† partir de la source sur Centos 7</a></li>
<li><a href="../fr412785/index.html">Master of Management et Freelancer. L'histoire en trois parties</a></li>
<li><a href="../fr412789/index.html">¬´Aide au travail¬ª: comment rendre les robots de chat plus intelligents</a></li>
<li><a href="../fr412791/index.html">Am√©lioration des performances du syst√®me de vid√©osurveillance et pr√©vention des plantages</a></li>
<li><a href="../fr412793/index.html">MassTransit, Saga et RabbitMQ pour l'impl√©mentation d'un gestionnaire de processus</a></li>
<li><a href="../fr412795/index.html">Et tirons les conclusions de la discussion de l'article "Qu'est-ce qui ne va pas avec le retour des Geektimes √† Habr"</a></li>
<li><a href="../fr412797/index.html">√Ä propos des dangers du CDN, des services et des polices de Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>