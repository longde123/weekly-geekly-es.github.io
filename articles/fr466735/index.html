<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßõüèΩ üë®üèæ‚Äçüç≥ üñêüèª Un moyen simple de cr√©er une alerte vocale dans le syst√®me domotique (¬´Smart Home¬ª) üë©üèø‚ÄçüöÄ üîù ‚ùï</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apr√®s avoir test√© la console client SIP Linphonec, j'y ai vu la possibilit√© d'un moyen simple et rapide de mettre en place des alertes vocales sur un ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Un moyen simple de cr√©er une alerte vocale dans le syst√®me domotique (¬´Smart Home¬ª)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/466735/">  Apr√®s avoir test√© la console client SIP Linphonec, j'y ai vu la possibilit√© d'un moyen simple et rapide de mettre en place des alertes vocales sur un t√©l√©phone mobile, pour un syst√®me domotique. <br><br>  Je pense que cette m√©thode convient √† de nombreux syst√®mes de domotique DIY, je donnerai ma propre version. <br><br>  J'ai un syst√®me domotique MajorDoMo Smart Home install√© sur un ordinateur monocarte Raspberry Pi (ex√©cutant Raspbian (Debian 9). <br><br>  Nous cr√©erons la possibilit√© de notification de MajorDoMo √† un smartphone sans utiliser d'√©quipement suppl√©mentaire et notre serveur VoIP. <br><br>  Un bref principe de l'alerte: en cas d'accident critique (chacun peut d√©terminer sa propre liste d'accidents), le syst√®me d'automatisation g√®re le client VoIP de la console et appelle le propri√©taire via le protocole SIP, apr√®s la r√©ponse, il lit le fichier son pr√©c√©demment enregistr√© avec le message d'accident. <br><a name="habracut"></a><br>  Tout d'abord, nous avons besoin de deux comptes du fournisseur SIP avec des entr√©es / sorties gratuites au sein du r√©seau.  Par exemple, prenez le service de t√©l√©phonie cloud Zadarma.com. <br><br>  Premi√®re √©tape: nous nous inscrivons aupr√®s du fournisseur, tout en acc√©dant √† votre compte personnel et √† votre compte SIP.  Nous pouvons nous inscrire avec plusieurs bo√Ætes aux lettres, mais nous pouvons reconstituer le compte et obtenir des num√©ros suppl√©mentaires.  Dans tous les cas, nous devons avoir 2 num√©ros (comptes) et un mot de passe. <br><br>  Sur un smartphone (cela fonctionne pour moi sous Androd OS) nous installons une application mobile du march√©, n'importe quel client SIP fera l'affaire.  Pour plus de commodit√© et en minimisant les param√®tres initiaux, nous pouvons utiliser l'application propri√©taire pour les appels Zadarma, mais nous pouvons √™tre plus fonctionnels. <br>  Apr√®s l'installation, nous proc√©dons √† l'enregistrement en lui indiquant votre num√©ro et votre mot de passe, ceci termine la configuration du smartphone.  Nous avons donc utilis√© un num√©ro. <br><br>  Sur le Raspberry Home Automation Server, nous avons besoin d'un client terminal Linphonec SIP.  Lors de l'installation √† partir du r√©f√©rentiel Raspbian, une version 3.6.1 assez ancienne est install√©e, qui ne fonctionne pas correctement avec le syst√®me audio ALSA, mais comme il n'est pas n√©cessaire d'utiliser directement la voix, allons-y le long du chemin facile. <br><br>  <i>Installer la version actuelle du paquet Linphone (3.12.0) sans interface graphique pour Debian 9, je l'ai d√©crit dans un article pr√©c√©dent: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bouton d'appel DIY.</a></i>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Raspberry Pi, MajorDoMo, Freeswitch et Linphonec</a> .</i>  <i>Vous y trouverez des informations sur l'installation d'une carte son USB et les param√®tres audio du Raspberry Pi.</i> <br><br>  Dans le terminal, ex√©cutez la commande suivante: <br><br><pre><code class="plaintext hljs">sudo apt-get install linphone-nogtk</code> </pre> <br>  L'installation de l'utilitaire client de console linphonec et linphonecsh est effectu√©e - un programme de console pour g√©rer linphonec ex√©cut√© en arri√®re-plan dans le r√©pertoire / usr / bin. <br>  Faisons la premi√®re manche en tapant: <br><br><pre> <code class="plaintext hljs">linphonec</code> </pre> <br>  Nous le lan√ßons, le client SIP jure chez ALSA, nous n'y pr√™tons pas attention. <br><br>  Nous ex√©cutons la commande d'enregistrement client (Linphonec) sur le serveur zadarma, sp√©cifiez votre deuxi√®me num√©ro et mot de passe: <br><br><pre> <code class="plaintext hljs">register sip:xxxxxx@sip.zadarma.com sip.zadarma.com PASSWORD</code> </pre> <br>  Si l'entr√©e est correcte, alors nous voyons la r√©ponse concernant l'enregistrement r√©ussi: <br><br><img src="https://habrastorage.org/webt/sd/jj/wc/sdjjwcmmgdfsfklr4flza5tcnp8.png" alt="image"><br><br>  Nous quittons le client (Ctrl + c, tandis que le client enregistre les param√®tres dans le fichier .linphonerc de l'utilisateur actuel, dans mon cas, le r√©pertoire / home / pi /. La prochaine fois que SIP d√©marre, le client est automatiquement enregistr√© sur le serveur du fournisseur. <br><br>  Nous enregistrons un message vocal (par exemple: ¬´Attention du syst√®me a √©t√© red√©marr√©, l'√©tat est maintenant en fonctionnement¬ª: <br><br><pre> <code class="plaintext hljs">arecord -D plughw:1,0 -f cd /home/pi/alarm_restart.wav</code> </pre><br>  Pour ex√©cuter et contr√¥ler Linphonec en mode d√©mon, l'utilitaire Linphonecsh est utilis√©.  Initialement, au d√©marrage, l'initialisation du client linphonecsh -init est requise.  Lorsque cette commande est ex√©cut√©e, le client de console d√©marre sans charger le fichier de configuration. <br><br>  Pour qu'au d√©marrage la configuration soit lue, ex√©cutez avec l'indicateur avec: <br><br><pre> <code class="plaintext hljs"> linphonecsh init -c /home/pi/.linphonerc</code> </pre><br>  Nous pouvons maintenant g√©rer le client de console √† partir du terminal. <br><br><div class="spoiler">  <b class="spoiler_title">Liste des commandes Linphonecsh</b> <div class="spoiler_text"><pre> <code class="xml hljs">Usage: linphonecsh <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag">&gt;</span></span> [arguments] where action is one of init : spawn a linphonec daemon (first step to make other actions) followed by the arguments sent to linphonec generic : sends a generic command to the running linphonec daemon followed by the generic command surrounded by quotes, for example "call sip:joe@example.net" register : register; arguments are --host <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">host</span></span></span><span class="hljs-tag">&gt;</span></span> --username <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">username</span></span></span><span class="hljs-tag">&gt;</span></span> --password <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">password</span></span></span><span class="hljs-tag">&gt;</span></span> unregister : unregister dial : dial <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sip</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">uri</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">or</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">number</span></span></span><span class="hljs-tag">&gt;</span></span> status : can be 'status register', 'status autoanswer' or 'status hook' soundcard : can be 'soundcard capture', 'soundcard playback', 'soundcard ring', followed by an optional number representing the index of the soundcard, in which case the soundcard is set instead of just read. exit : make the linphonec daemon to exit.</code> </pre> <br><br></div></div><br>  Essayons les commandes suivantes: <br><br><pre> <code class="plaintext hljs">linphonecsh generic 'soundcard use files'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh generic 'play alarm.wav'</code> </pre> <br><pre> <code class="plaintext hljs">linphonecsh dial sip:@sip.zadarma.com</code> </pre> <br>  O√π sont g√©n√©riques les √©quipes du programme Linphonec lui-m√™me.  XXXXXX est notre num√©ro SIP install√© sur le smartphone. <br><br>  Dans ce cas, un appel se produit, lorsque vous r√©pondez - vous pouvez entendre la lecture d'un fichier pr√©c√©demment enregistr√© avec un accident. <br><br>  Manuellement, cela a fonctionn√©.  Pour s'int√©grer au syst√®me domotique bas√© sur MajorDoMo, par exemple, prenez l'urgence de red√©marrer le serveur. <br>  Nous √©crivons la ligne suivante dans crontab (lors du chargement du PC, le client de la console se charge: <br><br><pre> <code class="plaintext hljs">crontab -e</code> </pre> <br><pre> <code class="xml hljs">@reboot sudo -u pi linphonecsh init -c /home/pi/.linphonerc</code> </pre> <br>  Ensuite, acc√©dez √† la page Web du syst√®me DD, acc√©dez au <b>Panneau de configuration - Scripts - √âv√©nements - D√©marrage.</b>  . <br><br><img src="https://habrastorage.org/webt/3i/ui/ec/3iuiec-as4d75jtddxvsmdgbgme.png"><br><br>  Les scripts sont impl√©ment√©s dans le langage de programmation PHP.  Il y a d√©j√† une ligne dans le code qui, lors du d√©marrage du syst√®me, prononce une phrase avec l'adresse IP du serveur. <br><br>  Ajoutez-en quelques autres: <br><br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'soundcard use files'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh generic 'play alarm.wav'"</span></span>);</code> </pre> <br><pre> <code class="php hljs">exec (<span class="hljs-string"><span class="hljs-string">"sudo -u pi linphonecsh dial sip:576935@sip.zadarma.com "</span></span>);</code> </pre> <br>  Nous installons <i>pour ex√©cuter apr√®s avoir enregistr√©</i> , nous √©conomisons, en m√™me temps qu'un appel √† un t√©l√©phone mobile se produit. <br><br>  Nous red√©marrons le syst√®me MajorDoMo, via le <b>Service - Reboot / shutdown</b> . <br>  Apr√®s un red√©marrage, une notification vocale arrive sur le t√©l√©phone.  Le m√™me algorithme d'actions peut √™tre effectu√© pour un autre accident critique pour vous. <br><br>  Apr√®s avoir l√©g√®rement modifi√© la s√©quence d'actions, vous pouvez installer votre propre serveur de t√©l√©phonie IP (Asterisk, Freeswitch, etc.) dans votre syst√®me domotique, y connecter une passerelle VoIP et acc√©der directement √† un op√©rateur mobile ou PSTN.  Cette option est plus fonctionnelle, a plus de fonctionnalit√©s, mais n√©cessite √©galement quelques co√ªts importants, √† la fois en mat√©riel et pour la configuration du syst√®me. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr466735/">https://habr.com/ru/post/fr466735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr466725/index.html">La dague 2 est √©l√©mentaire (partie 1)</a></li>
<li><a href="../fr466727/index.html">Mise √† niveau paresseuse: comment PostgreSQL 12 am√©liore les performances</a></li>
<li><a href="../fr466729/index.html">Le livre "Data mining. R√©cup√©ration d'informations sur Facebook, Twitter, LinkedIn, Instagram, GitHub ¬ª</a></li>
<li><a href="../fr466731/index.html">Extravagance. Septembre se l√®ve</a></li>
<li><a href="../fr466733/index.html">Bienvenue √† DINS Java EVENING le 18 septembre</a></li>
<li><a href="../fr466737/index.html">Pourquoi le r√©seau social Google+ a √©chou√©</a></li>
<li><a href="../fr466739/index.html">Le meilleur est l'ennemi du bien</a></li>
<li><a href="../fr466741/index.html">Le meilleur est l'ennemi du bien</a></li>
<li><a href="../fr466745/index.html">Le premier lieu de travail ou comment commencer √† d√©velopper une API sur Node.js</a></li>
<li><a href="../fr466747/index.html">D√©veloppeurs Mitap iOS chez Redmadrobot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>