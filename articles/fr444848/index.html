<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üîî üëÜüèª üèïÔ∏è Comme il est facile de livrer une commande en connaissant l'adresse du client (pas tr√®s) üöÜ üå∏ üõ©Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous! Je m'appelle Denis Girko, je suis l'architecte syst√®me de la plateforme e-commerce de Lamoda. L'ann√©e derni√®re, j'ai pris la parole √† ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comme il est facile de livrer une commande en connaissant l'adresse du client (pas tr√®s)</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/lamoda/blog/444848/"><p>  Bonjour √† tous!  Je m'appelle Denis Girko, je suis l'architecte syst√®me de la plateforme e-commerce de Lamoda.  L'ann√©e derni√®re, j'ai pris la parole √† la conf√©rence DevConf avec un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">rapport</a> que je veux partager avec vous. </p><br><p> Il s'agit d'un rapport d'examen sur les difficult√©s rencontr√©es par une grande boutique en ligne dans le processus de livraison des commandes et sur les solutions techniques qui peuvent aider √† les surmonter (en utilisant les solutions que nous avons test√©es chez Lamoda √† titre d'exemple). </p><br><p><img src="https://habrastorage.org/webt/vc/1p/24/vc1p24p8id79oozynnspkyikg0k.jpeg" alt="image"></p><br><p>  De quoi s'agit-il?  Je vais vous dire: </p><br><ul><li>  √Ä propos du processus de livraison et identifier les probl√®mes; </li><li>  comment stocker efficacement les territoires de livraison dans la base de donn√©es; </li><li>  comment am√©liorer la qualit√© des donn√©es que nous recevons du client; </li><li>  comment rechercher le destinataire dans la base de donn√©es d'adresses pour trouver des r√©sultats plus pr√©cis. </li></ul><a name="habracut"></a><br><h3 id="obschaya-shema-dostavki-zakaza-lamoda">  Sch√©ma g√©n√©ral de livraison des commandes Lamoda </h3><br><p>  Lamoda est une boutique en ligne avec quatre pays de livraison: Russie, Ukraine, Kazakhstan, Bi√©lorussie.  Nous livrons les marchandises d√®s le lendemain du fait que nous avons notre propre service de livraison et une dizaine de partenaires tiers dont nous utilisons les services.  La livraison est une grande partie de notre activit√©. </p><br><p>  Lamoda accepte la commande, demande l'adresse du client au moment de l'inscription et la transmet au service de messagerie. </p><br><p><img src="https://habrastorage.org/webt/ng/2d/i1/ng2di1movib3pmlisotbmwq-ffq.png" alt="image"></p><cut></cut><br><p>  Et si nous n'avons pas un service de messagerie, mais plusieurs?  Ensuite, l'√©tape suivante est ajout√©e - pour d√©terminer quel service de livraison nous prendrons la commande. </p><br><p><img src="https://habrastorage.org/webt/1v/6z/7c/1v6z7ceacbfmk5kctkqh1ss1jeg.png" alt="image"></p><br><p>  Il peut y avoir des crit√®res de s√©lection d'entreprises.  Mais la premi√®re chose √† penser est de savoir si ce service de messagerie a la livraison √† la ville choisie par le client ou non.  Par cons√©quent, la premi√®re √©tape de l'int√©gration d'une entreprise de messagerie dans notre syst√®me consiste √† d√©couvrir sa zone de couverture. <br><img src="https://habrastorage.org/webt/_n/xx/wv/_nxxwvl8qncwmm8vhqhgd2g_qo4.png" alt="image"><br>  Ensuite, vous devez apprendre √† v√©rifier si l'adresse du client appartient ou non √† ce territoire. </p><br><p>  Le sch√©ma g√©n√©ral sera am√©lior√© et ressemblera √† ceci: </p><br><ul><li>  demander une adresse; </li><li>  savoir quels services de messagerie peuvent le livrer; </li><li>  s√©lectionnez celui que vous voulez parmi ceux disponibles. </li></ul><br><p><img src="https://habrastorage.org/webt/7r/av/xo/7ravxognqcj0njydxoauolhxsbk.png" alt="image"></p><br><p>  Maintenant, un peu plus sur ces √©tapes. </p><br><h3 id="sprashivaem-u-klienta-adres">  Nous demandons l'adresse au client </h3><br><p>  Comment puis-je lui demander? </p><br><ol><li>  Demandez de remplir un grand champ.  Le client mart√®le son adresse, qui n'a en outre pas besoin de manipulations d√©licates.  L'adresse peut √™tre imprim√©e sur un morceau de papier, remis au courrier √† pied, qui le d√©couvrira lui-m√™me. </li><li>  La deuxi√®me option est plus compliqu√©e.  Nous demandons au client de remplir chaque composante de l'adresse dans son champ.  Ici, vous pouvez d√©j√† faire quelque chose.  Par exemple, comparez la ville de Moscou avec une liste donn√©e de villes.  Mais cela fonctionnera mal, car la ville de Moscou peut s'√©crire de plusieurs mani√®res: ¬´g.  Moscou ¬ª,¬´ ville de Moscou ¬ª,¬´ ville de Moscou ¬ªsans espace, etc. </li><li>  Par cons√©quent, il existe une option encore plus avanc√©e.  Comme la liste des villes que nous avons est limit√©e, vous pouvez pr√©-compiler une liste de villes et sugg√©rer au client de s√©lectionner celle dont il a besoin.  Le bonus est qu'√† chaque √©l√©ment d'une telle liste, nous pouvons d√©j√† associer un identifiant ici.  Nous, les d√©veloppeurs, aimons travailler non pas avec des cha√Ænes, mais avec des identifiants qui peuvent √™tre utilis√©s dans tous nos syst√®mes comme l'√©quivalent de la ville s√©lectionn√©e.  J'ai un index du bureau de poste central sur la diapositive comme identifiant. <br><img src="https://habrastorage.org/webt/cz/q9/sy/czq9syl4hieoqj8h88c7trupbim.png" alt="image"></li></ol><br><h3 id="kakoy-sluzhboy-dostavki-vezem">  Quel service de livraison transportons-nous? </h3><br><p>  Puisque nous avons un identifiant (index), alors laissez le territoire stock√© dans notre base de donn√©es √™tre repr√©sent√© par une liste d'index.  Dans ce cas, l'algorithme de v√©rification de l'entr√©e de la ville sur le territoire est tr√®s simple.  Alors faisons-le: nous placerons les territoires de livraison re√ßus des services de messagerie dans la base de donn√©es sous forme d'indices. </p><br><p>  Les indices ont leurs avantages et leurs inconv√©nients.  Je dirai √† l'avance que Lamoda a fait exactement cela au d√©but: le r√©sultat du choix d'un client de la ville √©tait un index, et nos index √©taient stock√©s dans la base de donn√©es.  Pourquoi un plus?  Comme je l'ai dit, un indice est une chose que tout le monde comprend.  Tout gestionnaire qui vient de travailler sait ce qu'est un index.  Il peut recevoir de la soci√©t√© de messagerie de la ville, les convertir en quelque sorte en index et les utiliser.  L'inconv√©nient est que l'indice est l'identifiant de la poste de la poste russe.  Et les colonies voisines peuvent partager le m√™me indice. </p><br><h3 id="pochemu-perestalo-hvatat-indeksov">  Pourquoi les index manquent-ils? </h3><br><p>  Un exemple simple: Lyubertsy.  A proximit√© se trouve le village de Marusino.  Marusino n'a pas de bureau de poste; leur correspondance est envoy√©e √† l'un des bureaux de poste de Lyubertsy.  Si nous voulions ajouter la livraison √† Lyubertsy, mais pas √† Marusino, car cela pourrait ne pas √™tre financi√®rement rentable pour nous, nous ne pourrions le faire que par index. <br><img src="https://habrastorage.org/webt/xy/5d/am/xy5damiwrmj4accagb5uckr8bma.png" alt="image"></p><br><p>  Un autre exemple est lorsque Lamoda s'est agrandi et a ouvert un deuxi√®me entrep√¥t de transit √† Moscou.  Il fallait diviser Moscou en deux moiti√©s nord et sud.  Et d√©j√† au moment de passer la commande, sachez √† partir de quel entrep√¥t de transit la livraison sera effectu√©e.  Dans ce cas, un indice par ville ne serait pas suffisant. </p><br><p>  Nous avons d√©cid√© d'utiliser des g√©o-coordonn√©es avec des index.  Nous prenons l'adresse du client, l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ex√©cutons</a> via le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">g√©ocodeur Yandex</a> .  En sortie, on obtient non seulement l'index, mais aussi les coordonn√©es.  Nous utilisons des index dans les cas o√π le d√©tail n'est pas important.  Et les coordonn√©es sp√©cifient les cas o√π vous devez faire une fine division du territoire. </p><br><p>  Ils ont fourni une interface dans leur programme d'installation pour les logisticiens, qui vous permet de dessiner un polygone au-dessus de la carte.  C'est simple: le point tombe dans la d√©charge - il y a livraison, ne tombe pas - non. <br><img src="https://habrastorage.org/webt/_2/t3/pk/_2t3pkebkcck78k3imgkk6w8cdi.png" alt="image"><br>  <em>Interface de cr√©ation de zone de polygone</em> </p><br><p>  Le bonus que nous avons des coordonn√©es g√©ographiques pour chaque commande a √©t√© l'occasion d'am√©liorer l'interface que les logisticiens utilisent pour cr√©er des itin√©raires pour les commerciaux.  L'interface affiche une carte sur laquelle les commandes des clients sont marqu√©es.  Le logisticien utilise l'outil lasso, qui combine les ordres adjacents en un seul itin√©raire.  De plus, cette route va √† un repr√©sentant des ventes, c'est-√†-dire qu'une personne n'a pas besoin d'aller d'un bout √† l'autre de la ville pendant la journ√©e pour prendre toutes ses commandes - elles sont toutes g√©ographiquement proches. <br><img src="https://habrastorage.org/webt/4d/aq/ar/4daqar6z4vmutjh3mdumdwn-6ma.png" alt="image"><br>  <em>Interface de routage</em> </p><br><p>  L'adresse saisie par le client est convertie en coordonn√©es.  La probabilit√© d'obtenir directement les coordonn√©es d'une adresse donn√©e d√©pend de la qualit√© de l'adresse saisie par le client.  Par cons√©quent, la premi√®re chose √† laquelle nous avons pens√© est de savoir comment augmenter le nombre d'adresses bien reconnues.  Par cons√©quent, vous devez aider le client √† saisir la bonne adresse. </p><br><p>  Le fait est que les clients ne suivent souvent pas les sc√©narios que nous leur proposons, nous avons donc acquis des bases de donn√©es d'adresses pour chacun des 4 pays dans lesquels nous livrons des commandes.  Et ils ont fait un sajest non seulement pour la ville, mais aussi pour la rue, et m√™me pour le num√©ro de la maison.  Pour faire une liste de maisons, nous avons analys√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">les</a> donn√©es ouvertes <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">de openstreetmap.org</a> . <br><img src="https://habrastorage.org/webt/bb/4n/bd/bb4nbdspyc75buacqdxmmi3jibk.png" alt="image"><br>  <em>Le formulaire de paiement propose des conseils pour formaliser les donn√©es d'adresse</em> </p><br><h3 id="adresnaya-baza">  Base d'adresses </h3><br><p>  Pour faire une demande √† la base d'adresses, vous devez la garder √† la maison.  O√π avons-nous obtenu toutes les bases d'adresses pour nos quatre pays?  En Russie, c'est <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FIAS</a> , la base d'adresses qui est compil√©e et maintenue par notre service fiscal.  Il est assez complet, mais pas sans d√©fauts.  Nos partenaires de livraison nous ont aid√©s avec d'autres pays. <br><img src="https://habrastorage.org/webt/tp/bi/_m/tpbi_m-s0oxwiiddhd_i5rrw-l8.png" alt="image"></p><br><p>  Nous avons √©galement un ensemble de scripts PHP qui prennent le format avec lequel la base d'adresses nous parvient, et de la m√™me mani√®re qu'il l'ajoute √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">PostgreSQL</a> .  Pourquoi sous la m√™me forme?  Parce que l'une des t√¢ches consiste √† mettre √† jour p√©riodiquement ces bases de donn√©es √† partir des m√™mes sources.  Cela signifie que si nous pr√©voyions une conversion, elle devrait √™tre r√©p√©t√©e √† chaque mise √† jour. Ainsi, les donn√©es vont √† PostgreSQL, et √† partir de l√† elles sont converties et stock√©es dans <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Apache Solr</a> ;  Solr vous permet de les rechercher rapidement et de faire des sajest.  Un petit serveur web PHP est capable de construire des requ√™tes dans Solr, en fonction de leurs r√©sultats, une liste est cr√©√©e pour le client sur le site pour une suggestion. </p><br><div class="spoiler">  <b class="spoiler_title">Exemple vivant</b> <div class="spoiler_text"><p><img src="https://habrastorage.org/webt/ko/s4/cz/kos4czfszfi2egrtx2mnwxcaqwo.png" alt="image"></p></div></div><br><p><img src="https://habrastorage.org/webt/py/z_/pw/pyz_pw_qs26ypndty6qpowgilsi.png" alt="image"></p><br><p>  Nous t√©l√©chargeons les donn√©es de la source sous la m√™me forme que celle dans laquelle elles nous sont parvenues.  Autrement dit, avec le m√™me ensemble de champs, avec les m√™mes types de colonnes, etc.  Ajoutez-les tels quels.  Nous avons essay√© d'utiliser les donn√©es sous cette forme d√®s le d√©but, et afin de les transformer en ces structures avec lesquelles nous pouvons travailler, nous avons √©crit plusieurs vues.  Puisque nous avons 4 pays, tout cela a √©t√© multipli√© par 4, et il a √©t√© tr√®s difficile et co√ªteux √† supporter.  Il fallait donc faire quelque chose. </p><br><p>  La premi√®re chose dont nous nous sommes d√©barrass√©s est une structure non structur√©e, ou plut√¥t <em>une structure sp√©cifique</em> , √† un stade pr√©coce.  Autrement dit, d√®s que les donn√©es brutes ont √©t√© t√©l√©charg√©es, √† l'aide de vues, nous les transformons en un format unifi√©, avec lequel toutes nos autres transformations sont davantage configur√©es.  Cela nous a √©vit√© de multiplier par 4. Et c'est √† ce moment que nous oublions la structure dans laquelle les donn√©es nous sont parvenues, et nous ne travaillons qu'avec ce que nous avons invent√© pour nous-m√™mes. <br><img src="https://habrastorage.org/webt/1s/zp/rn/1szprnn0rmejrvuop8uawdzwvaa.png" alt="image"></p><br><p>  Si vous avez besoin de deux sources - veuillez t√©l√©charger.  L'essentiel est que le format de cette sortie de donn√©es apr√®s la conversion en vues soit le m√™me. <br><img src="https://habrastorage.org/webt/we/ru/dm/werudmivgvezc6ytbrgpmdr0ojm.png" alt="image"></p><br><p>  Une autre exigence pour les bases de donn√©es d'adresses charg√©es √©tait qu'il √©tait n√©cessaire d'y apporter des corrections ponctuelles.  Un exemple simple: dans la FIAS, la R√©publique tchouvache s'appelle ¬´Tchouvachie Rep.  "Tchouvachie."  Eh bien, nous voulons juste la R√©publique Tchouvache.  Pourquoi avons-nous besoin de ce tiret?  Et en m√™me temps, nous ne pouvons toujours pas √©viter les mises √† jour p√©riodiques des sources. </p><br><p>  Voici les couches suivantes que nous avons dans PostgreSQL. <br><img src="https://habrastorage.org/webt/gf/is/a2/gfisa2hm2svx2gkehzy5raekpim.png" alt="image"></p><br><p>  Les tableaux de gauche sont des donn√©es brutes t√©l√©charg√©es depuis la source. </p><br><p>  Derri√®re eux se trouvent des vues qui convertissent les donn√©es dans un format standard. </p><br><p>  <em>Red√©finitions locales</em> - nous avons un ensemble de tables qui red√©finissent ponctuellement certains attributs des donn√©es d'adresse charg√©es.  Nous avons inclus ici, par exemple, qu'un enregistrement avec un tel identifiant devrait recevoir √† la place de ¬´Chuvash rep.  - Tchouvachie ¬ªest notre nom choisi. </p><br><p> <em>La table de mappage</em> est notre r√©f√©rentiel d'identifiants, que nous avons nous-m√™mes attribu√©s aux objets d'adresse que nous avons t√©l√©charg√©s - cela a permis √† nos syst√®mes d'√™tre extraits de la source, des identifiants utilis√©s dans la source, et de ne cacher aucune source, mais m√™me plusieurs derri√®re un ID. Je le dirai un peu plus tard.  Tout cela est combin√© et fix√© dans une vue mat√©rialis√©e.  Ainsi, nous obtenons presque l'√©quivalent de la table finale, qui peut √™tre mise √† jour en ex√©cutant une vue SQL <code>REFRESH MATERIALIZED VIEW</code> . </p><br><p>  <em>Objets d'adresse</em> - base d'adresses form√©e avec toutes les corrections et ajouts. </p><br><p>  Ainsi, en sortie, nous avons d√©j√† corrig√© des objets d'adresse, d√©j√† avec de nouveaux noms et nos identifiants.  Tout cela est transform√© et d√©normalis√©, comme pratique pour la recherche, et additionn√© dans Solr. </p><br><p>  Puisque nous avons maintenant des bases de donn√©es d'adresses, il serait int√©ressant de les utiliser non seulement pour faire une demande de bon de commande, mais aussi pour effectuer une recherche.  O√π une recherche peut-elle √™tre utile?  Il s'av√®re beaucoup o√π.  Les m√™mes zones de livraison que nous recevons des services de messagerie sont tr√®s souvent repr√©sent√©es simplement par une liste de villes.  Et la liste des villes est confront√©e aux m√™mes probl√®mes que pour la saisie des utilisateurs: les villes peuvent avoir des interpr√©tations diff√©rentes, des noms diff√©rents, etc. </p><br><p>  J'ai une diapositive sp√©ciale ici, une telle histoire d'horreur - que ferions-nous si nous prenions tout manuellement pour le convertir en PHP: en Tch√©tch√©nie, en R√©publique tch√©tch√®ne, et donc pour chaque source de donn√©es - l'enfer est l'enfer. </p><br><p><img src="https://habrastorage.org/webt/7t/p4/eo/7tp4eoy0jtxnevev1-0pgdk_axi.png" alt="image"></p><br><blockquote>  Ajout: sur l'√©cran - un morceau de code r√©el du service, qui est devenu inutile uniquement en raison des solutions d√©crites. </blockquote><p>  Nous avons class√© ces probl√®mes. </p><br><p>  1) Noms √©quivalents des m√™mes objets.  Par exemple, des synonymes communs comme Tchouvachie et la R√©publique tchouvache. </p><br><p>  2) Villes renomm√©es.  L'Ukraine est maintenant dans une phase active pour se d√©barrasser du pass√© communiste, c'est pourquoi ils modifient litt√©ralement chaque jour le nom de leurs colonies.  Pour cette raison, il peut s'av√©rer que dans une base de donn√©es nous avons d'anciens noms et dans une autre - de nouveaux. </p><br><p>  3) Beaucoup d'erreurs.  Souvent tromp√© sur le statut des colonies.  Il y a un village, voici un village ou ici est un village, il y a une ferme. </p><br><p>  4) Mots √©trangers translitt√©r√©s en russe, souvent le m√™me nom est translitt√©r√© de diff√©rentes mani√®res. </p><br><p>  5) Il y a beaucoup d'erreurs dans la hi√©rarchie: Zelenograd, par habitude, appartient √† la r√©gion de Moscou, bien que formellement il soit √©galement r√©pertori√© √† Moscou comme FIAS.  √âcrivez correctement ¬´Ville de Moscou, Zelenograd¬ª. </p><br><p>  Comment en est-on arriv√© l√†? </p><br><p>  La premi√®re chose que nous faisons est de s√©parer tous les composants insignifiants de l'adresse des noms.  Nous ne les jetons pas, ils participent √† la recherche, mais s√©par√©ment des parties importantes. <br><img src="https://habrastorage.org/webt/pj/l-/hm/pjl-hmgtn30iryqakbsqjrll6qy.png" alt="image"></p><br><p>  Ensuite, nous avons fait une courte liste de synonymes et d'abr√©viations communs qui sont utilis√©s dans les noms.  Lorsque la source le permettait, nous avons charg√© et mis tous les noms dans Solr.  Non seulement les synonymes et les noms historiques les plus pertinents, mais aussi possibles. </p><br><p>  Pour une meilleure recherche, nous jetons toutes les lettres qui peuvent introduire des √©carts.  Cela s'applique √† la langue russe et aux langues avec lesquelles nous devons encore traiter. </p><br><p>  Nous corrigeons les fautes de frappe et corrigeons la mise en page. </p><br><p>  Enfin, nous avons trouv√© des parents fant√¥mes - ce sont des parents affect√©s √† des objets.  Ils sont pertinents dans la recherche, mais ne participent pas au r√©sultat de la recherche.  Par exemple, pour Zelenograd, nous avons ajout√© la r√©gion de Moscou.  Maintenant, vous pouvez rechercher ¬´R√©gion de Moscou, Zelenograd¬ª et trouver l'objet dont nous avons besoin, mais dans les r√©sultats de recherche, ce sera toujours le bon ¬´Moscou, Zelenograd¬ª. </p><br><p><img src="https://habrastorage.org/webt/rw/kh/qm/rwkhqme_rixhx9dz1du34m0hrqy.png" alt="image"></p><br><p>  Selon les besoins de l'entreprise, une gradation diff√©rente de la pr√©cision de la recherche est n√©cessaire.  Par cons√©quent, nous avons 4 degr√©s, chacun d'eux donne un r√©sultat avec une probabilit√© plus √©lev√©e, mais avec une probabilit√© plus faible, ce sera exactement le r√©sultat recherch√©. <br><img src="https://habrastorage.org/webt/hn/hw/lh/hnhwlh7kyr55fbn5b-eqqqlsxtc.png" alt="image"></p><br><p>  Et o√π avons-nous trouv√© une telle application de recherche? </p><br><ul><li>  Encore une fois, nous ex√©cutons l'adresse saisie par le client via une telle recherche.  S'il n'a pas utilis√© nos conseils sur la page de paiement, nous avons encore une chance de transformer les lignes qu'il a entr√©es en identifiants.  Nous obtenons une adresse officielle. </li><li>  Nous parcourons cette recherche tout ce que les services de messagerie nous envoient - nous reconnaissons les villes qu'ils nous transmettent.  Cela nous a permis de lancer seulement 10 pi√®ces par jour, ce qui est pertinent pour B2B - Lamoda fournit sa livraison √† des soci√©t√©s tierces, il y a donc beaucoup de nouveaux services de messagerie connect√©s par unit√© de temps. </li><li>  Cela nous a permis de ¬´cha√Æne¬ª diverses informations utiles dans nos identifiants dans les bases de donn√©es d'adresses.  Par exemple, nous avons t√©l√©charg√© des fuseaux horaires, des adresses IP, pour rechercher des villes par les adresses IP des clients. </li><li>  Nous avons maintenant la possibilit√© de masquer la base d'adresses combin√©e de deux sources avec l'un de nos identifiants.  Autrement dit, cela a permis d'√©viter les doublons et de faire correspondre les m√™mes objets d'adresse dans les deux bases. </li></ul><br><p>  Nous ne nous arr√™tons pas.  C'est un processus que nous pouvons encore am√©liorer. </p><br><p>  Tout d'abord, Lamoda travaille sur les index.  Autrement dit, nos identifiants sont des indices, dont nous connaissons les inconv√©nients.  Presque tous nos syst√®mes sont pass√©s √† la nouvelle API; ils ne fonctionnent pas avec des index, mais avec les identifiants m√™mes que nous avons nous-m√™mes attribu√©s √† nos objets d'adresse.  Le plus est que la recherche d'une ville sur le territoire est aussi simple qu'avec des index.  Cependant, il n'y a aucun inconv√©nient dans le fait que plusieurs colonies peuvent se cacher derri√®re une seule carte d'identit√©. </p><br><blockquote>  Addition: Le temps a pass√© depuis le moment de mon discours, et maintenant je suis heureux de me corriger: nos index ne restent maintenant que dans le cas, lorsque le courrier nous donne son territoire sous la forme d'une liste d'entre eux, par exemple, la poste russe.  Dans d'autres cas, les index ont √©t√© supplant√©s par nos identifiants d'adresse internes. </blockquote><p>  Sur la diapositive est un morceau de l'interface qui vous permet de configurer manuellement le territoire, mais en fait tout est configur√© √† partir de listes d'objets d'adresse charg√©es par lots sous forme de cha√Ænes. <br><img src="https://habrastorage.org/webt/n9/-1/rn/n9-1rnlutwkmd8-tpnyfaxiwuxg.png" alt="image"></p><br><p>  Nous avons t√©l√©charg√© les coordonn√©es g√©ographiques de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">openstreetmap.org</a> pour les maisons.  Maintenant, dans un grand pourcentage de cas, nous n'avons pas besoin d'aller √† un service externe pour conna√Ætre l'emplacement.  Cela nous a permis de r√©duire de 10 fois le nombre de voyages √† Yandex, ce qui a naturellement √©conomis√© de l'argent. </p><br><p>  Nous nous d√©barrassons de PHP dans la cha√Æne de recherche des donn√©es d'adresse.  Nous avons r√©√©crit le code qui acc√©dait √† Solr sur Lua.  Nginx remplac√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Openresty</a> , maintenant tout est tr√®s rapide et peut supporter de lourdes charges.  95% des r√©ponses de notre service de recherche tiennent en 10 millisecondes, ce qui est plus que suffisant pour nous. </p><br><p><img src="https://habrastorage.org/webt/6b/th/wm/6bthwmdw9aq79khamwrwrqfgbqc.png" alt="image"></p><br><blockquote>  Addition: Utiliser Openresty et Lua, qui ont s√©duit par leurs performances, a √©t√© une sorte d'exp√©rience qui a port√© ses fruits: le service fonctionne rapidement, est stable sous charge, et est facilement maintenu.  Mais depuis lors, Lamoda a adopt√© Golang, qui a les m√™mes qualit√©s, que l'un des langages de programmation pour le backend charg√©.  Si la d√©cision de d√©velopper le service √©tait prise maintenant, nous la pr√©f√©rerions. </blockquote><br><h3 id="vyvod">  Conclusion </h3><br><p>  Ma moralit√© personnelle de tout le travail effectu√© est que les donn√©es d'adresse sont un domaine o√π vous ne pouvez pas vous attendre √† une qualit√© de donn√©es id√©ale.  Cela n'arrivera jamais.  Nous ne recevrons jamais de donn√©es parfaites d'un client ou de sources externes.  Par cons√©quent, vous devez tirer le maximum de ce qui est. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444848/">https://habr.com/ru/post/fr444848/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444838/index.html">Meetup OWASP Russia</a></li>
<li><a href="../fr444840/index.html">3. Check Point Getting Started R80.20. Pr√©paration de la mise en page</a></li>
<li><a href="../fr444842/index.html">Le premier ordinateur programmable ADN</a></li>
<li><a href="../fr444844/index.html">Y a-t-il une marque √† enregistrer? ou Comment nous avons √©t√© oblig√©s de changer le nom de l'application</a></li>
<li><a href="../fr444846/index.html">ML.NET 0.11 - Apprentissage automatique pour .Net</a></li>
<li><a href="../fr444850/index.html">M√©canique quantique: la fin de la guerre des interpr√©tations</a></li>
<li><a href="../fr444852/index.html">Smart Home - Repenser</a></li>
<li><a href="../fr444854/index.html">Cr√©ation d'√©l√©ments d'interface par programme √† l'aide de PureLayout (partie 1)</a></li>
<li><a href="../fr444858/index.html">A la recherche du meilleur rem√®de</a></li>
<li><a href="../fr444860/index.html">OFFZONE 2.0</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>