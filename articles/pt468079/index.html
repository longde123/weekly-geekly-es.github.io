<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üèÇüèø „ÄΩÔ∏è ü•© Dimens√µes personalizadas no Google Analytics que nos salvaram mais de uma vez üë©üèæ‚ÄçüöÄ üíë üßïüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ao configurar a an√°lise por meio do Google Analytics (GA), os par√¢metros do usu√°rio ou o CD ( dimens√µes personalizadas ) geralmente s√£o ignorados. Iss...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Dimens√µes personalizadas no Google Analytics que nos salvaram mais de uma vez</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/468079/">  Ao configurar a an√°lise por meio do Google Analytics (GA), os par√¢metros do usu√°rio ou o CD ( <i>dimens√µes personalizadas</i> ) geralmente s√£o ignorados.  Isso se deve √† dificuldade de entender seu escopo: n√£o est√° claro exatamente como os CDs podem ajudar na coleta e an√°lise de dados e como eles est√£o configurados.  Este artigo fala sobre os principais CDs que usamos no Adventum em muitos projetos e sobre o processo de instala√ß√£o. <br><br><h1>  O que s√£o op√ß√µes de usu√°rio </h1><br>  Para criar um relat√≥rio no Google Analytics, est√£o dispon√≠veis mais de 200 par√¢metros e m√©tricas diferentes, como "origem", "cidade", "navegador", "sistema operacional" e muitos outros.  Como os par√¢metros padr√£o nem sempre s√£o suficientes para an√°lise, o Google oferece aos usu√°rios a capacidade de criar seus pr√≥prios.  O valor do CD pode ser transferido com qualquer ocorr√™ncia do usu√°rio.  Por exemplo, usando par√¢metros personalizados, voc√™ pode analisar o desempenho do site no contexto de adaptativos. <br><br>  Existem 4 √°reas de a√ß√£o de CD no total: <br><br><ul><li>  Hit </li><li>  Sess√£o </li><li>  Usu√°rio </li><li>  Produto </li></ul><br>  Por exemplo, temos um CD no qual o par√¢metro de autoriza√ß√£o do usu√°rio est√° armazenado (0 - n√£o autorizado, 1 - autorizado).  No in√≠cio da sess√£o, todos os usu√°rios n√£o est√£o autorizados.  Vamos ver o que acontece quando esse par√¢metro muda ap√≥s a entrada, dependendo do escopo do CD. <br><br><img src="https://habrastorage.org/webt/yo/ef/tr/yoeftruoaljptzlnl3xtngigfbq.jpeg"><br><br><ul><li>  para um CD com o escopo Hit, a unidade √© atribu√≠da ao par√¢metro de autoriza√ß√£o no hit em que a autoriza√ß√£o ocorreu; </li><li>  para um CD com o escopo da Sess√£o, o par√¢metro de autoriza√ß√£o se tornar√° igual a 1 para todos os hits da sess√£o em que o evento ocorreu (substituindo os valores antigos do CD nesta sess√£o); </li><li>  para um CD com o escopo de Usu√°rio, o par√¢metro de autoriza√ß√£o se tornar√° igual a 1 para todas as sess√µes do usu√°rio, a partir daquela em que o logon foi feito. </li></ul><a name="habracut"></a><br>  √Äs vezes, voc√™ precisa analisar as caracter√≠sticas de um produto cujo suporte n√£o est√° estabelecido nos par√¢metros b√°sicos do Google Analytics: por exemplo, peso.  Como informa√ß√µes sobre v√°rios produtos podem ser transmitidas em uma ocorr√™ncia, precisaremos de um escopo adicional com detalhes mais profundos.  √â por essa granularidade que o escopo "Produto" √© usado: <br><br><img src="https://habrastorage.org/webt/me/9m/s4/me9ms4-kjwvsn-pgj1yzdn6uxbi.jpeg"><br><br><h1>  Configura√ß√£o do CD </h1><br>  A configura√ß√£o de um par√¢metro do usu√°rio consiste em duas etapas: criar um par√¢metro no GA e enviar dados do site.  A seguir, descrevemos a sequ√™ncia de etapas para a instala√ß√£o do CD. <br><br><h2>  Criando um CD no Google Analytics </h2><br><ol><li>  V√° para a se√ß√£o "Administrador" </li><li>  Nas configura√ß√µes de recurso na se√ß√£o "Par√¢metros do usu√°rio", selecione a subse√ß√£o "Par√¢metros especiais": <br><img src="https://habrastorage.org/webt/pc/b3/pp/pcb3ppb_6lwiyyxpe8ctui2qe18.jpeg"></li><li>  Clique no bot√£o "+ Par√¢metro especial" <br><img src="https://habrastorage.org/webt/ak/k8/iy/akk8iyzg0rbrvrq-tawj3u-uwue.jpeg"></li><li>  O formul√°rio √© aberto: <br><img src="https://habrastorage.org/webt/82/jf/3o/82jf3oy-kbvheuwjrntj4ooxecw.jpeg"><br>  Selecione o escopo do par√¢metro: <br><br><ul><li>  Hit </li><li>  Sess√£o </li><li>  Usu√°rio </li><li>  Produto </li></ul><br>  E deixe a marca de sele√ß√£o ao lado de "Ativo" para que os dados comecem a ser coletados e o CD seja refletido nos relat√≥rios. </li></ol><blockquote>  <b>Recomenda√ß√µes para o t√≠tulo do CD</b> <br>  N√≥s desenvolvemos nosso pr√≥prio sistema para nomear par√¢metros do usu√°rio. <br>  No in√≠cio de cada CD, adicionamos um s√≠mbolo para o escopo.  Para acerto, √© h_ (por exemplo, h_hitId), para session - s_ (por exemplo, s_sessionId).  Isso nos ajuda a navegar pelos par√¢metros do usu√°rio e a conhecer sempre seu escopo, sem verificar as configura√ß√µes do contador.  √Äs vezes, torna-se necess√°rio criar dois par√¢metros com o mesmo nome, mas com um escopo diferente.  Por exemplo, realizamos um teste A / B e queremos verificar se ele est√° configurado corretamente, a variante de teste muda durante a sess√£o.  Para fazer isso, crie dois par√¢metros com o mesmo valor: nome + vers√£o de teste, na qual o usu√°rio entrou, mas um deles foi atingido, na segunda sess√£o.  Nesse caso, a nomea√ß√£o proposta ser√° muito conveniente. <br></blockquote><br><h2>  Configurando o Gerenciador de tags do Google </h2><br>  H√° duas maneiras de configurar os par√¢metros de envio do site: <br><br><ul><li>  diretamente atrav√©s do c√≥digo HTML no site. </li><li>  via Gerenciador de tags do Google (GTM). </li></ul><br>  Para ambos os m√©todos, precisamos do √≠ndice do CD no Google Analytics.  Voc√™ pode v√™-lo na se√ß√£o "Configura√ß√µes especiais": <br><br><img src="https://habrastorage.org/webt/z3/el/gs/z3elgs7abwc7vnaibkvlssffe08.jpeg"><br><br>  <b>Enviando via HTML no site</b> <br><br>  Atualize a configura√ß√£o do recurso no c√≥digo de acompanhamento do Google Analytics adicionando <font color="green">custom_map</font> (voc√™ precisa adicionar o que √© destacado em ambos os lados pelos coment√°rios): <br><br><pre><code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'GA_MEASUREMENT_ID'</span></span> , <span class="hljs-comment"><span class="hljs-comment">//  { 'custom_map': {'dimension&lt;Index&gt;': 'dimension_name'} } //  );</span></span></code> </pre> <br>  onde <font color="green">GA_MEASUREMENT_ID</font> √© seu identificador de contador do Google Analytics.  Substitua <font color="green">&lt;Index&gt;</font> pelo √≠ndice do par√¢metro no GA e, em vez de <font color="green">dimension_name,</font> especifique seu nome. <br><br>  Se voc√™ tiver v√°rios par√¢metros de Usu√°rio, <font color="green">'dimens√£o &lt;Index&gt;'</font> : <font color="green">'dimension_name'</font> deve ser especificado com uma v√≠rgula para cada um deles. <br><br>  Por exemplo: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'config'</span></span>, <span class="hljs-string"><span class="hljs-string">'UA-XXXXXXXXX'</span></span>, { <span class="hljs-string"><span class="hljs-string">'custom_map'</span></span>: {<span class="hljs-string"><span class="hljs-string">'dimension1'</span></span>: <span class="hljs-string"><span class="hljs-string">'projectName'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension2'</span></span>: <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension3'</span></span>: <span class="hljs-string"><span class="hljs-string">'sessionId'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension4'</span></span>: <span class="hljs-string"><span class="hljs-string">'screenWindow'</span></span>} });</code> </pre> <br>  Para enviar um CD junto com uma visualiza√ß√£o de p√°gina, voc√™ precisa atribuir esses par√¢metros ao valor desejado <b>antes do c√≥digo indicado acima</b> : <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, { <span class="hljs-string"><span class="hljs-string">'dimension_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'dimension_value'</span></span>});</code> </pre> <br>  onde <font color="green">dimension_name</font> deve corresponder aos especificados em <font color="green">'custom_map'</font> e <font color="green">dimension_value deve</font> ser o valor que voc√™ deseja transferir para o CD. <br><br>  Por exemplo: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'set'</span></span>, {<span class="hljs-string"><span class="hljs-string">'projectName'</span></span>: <span class="hljs-string"><span class="hljs-string">'shop'</span></span>, <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>: <span class="hljs-string"><span class="hljs-string">'1121243'</span></span>});</code> </pre> <br>  Ao enviar um valor de CD junto com o evento, voc√™ deve enviar o c√≥digo: <br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-string"><span class="hljs-string">'action_value'</span></span>, {<span class="hljs-string"><span class="hljs-string">'event_category'</span></span>: <span class="hljs-string"><span class="hljs-string">'category_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'event_label'</span></span>: <span class="hljs-string"><span class="hljs-string">'label_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span>: <span class="hljs-string"><span class="hljs-string">'event_value'</span></span>, <span class="hljs-string"><span class="hljs-string">'dimension_name'</span></span>: <span class="hljs-string"><span class="hljs-string">'dimension_value'</span></span>});</code> </pre> <br>  onde em vez de: <br><br>  <font color="green">action_value</font> - a√ß√£o do evento <br>  <font color="green">category_value</font> - categoria do evento <br>  <font color="green">label_value</font> - r√≥tulo de evento <br>  <font color="green">event_value</font> - valor do evento (n√∫mero inteiro n√£o negativo) <br>  <font color="green">dimension_name</font> - o nome do par√¢metro que especificamos no c√≥digo anterior <br>  <font color="green">dimension_value</font> - valor do CD <br><br>  Um exemplo: <br><br><pre> <code class="javascript hljs">gtag(<span class="hljs-string"><span class="hljs-string">'event'</span></span>, <span class="hljs-string"><span class="hljs-string">'clickButton'</span></span>, {<span class="hljs-string"><span class="hljs-string">'event_category'</span></span>: <span class="hljs-string"><span class="hljs-string">'conversion'</span></span>, <span class="hljs-string"><span class="hljs-string">'event_label'</span></span>: <span class="hljs-string"><span class="hljs-string">'registration'</span></span>, <span class="hljs-string"><span class="hljs-string">'projectName'</span></span>: <span class="hljs-string"><span class="hljs-string">'shop'</span></span>, <span class="hljs-string"><span class="hljs-string">'hitId'</span></span>: <span class="hljs-string"><span class="hljs-string">'1121243'</span></span>});</code> </pre> <br>  Em nossos projetos, usamos a segunda op√ß√£o - o ajuste atrav√©s do GTM.  Vamos considerar com mais detalhes. <br><br>  <b>Enviando CDs com hits para o GA via GTM</b> <br><br>  A configura√ß√£o do envio de CD junto com hits (visualiza√ß√µes de p√°gina, eventos) no GA √© feita em uma vari√°vel do tipo "Configura√ß√µes do Google Analytics".  Se voc√™ j√° configurou essa vari√°vel, abra-a.  Caso contr√°rio, voc√™ precisar√° cri√°-lo.  V√° para a se√ß√£o "Configura√ß√µes avan√ßadas", a subse√ß√£o "Configura√ß√µes especiais".  Aqui voc√™ deve adicionar todos os par√¢metros de usu√°rio que voc√™ criou anteriormente no GA: <br><br><img src="https://habrastorage.org/webt/v5/u2/jc/v5u2jc6kqqsi7e1zwozl71iy2yc.jpeg"><br><br>  O ID de rastreamento deve incluir o n√∫mero do contador do GA.  No campo "√çndice", escreva o identificador do CD do GA para o qual deseja transferir dados. <br><br>  No campo "Valor do par√¢metro", voc√™ deve especificar o valor que ser√° transferido para o CD com o √≠ndice especificado.  Este valor pode ser especificado de duas maneiras: <br><br><ul><li>  manualmente, se ser√° o mesmo para todos os eventos; </li><li>  usando a vari√°vel na qual o valor desse par√¢metro est√° armazenado (seu nome √© escrito entre colchetes duplos).  Por exemplo, {{SCREEN_WINDOW}} - ‚ÄúTamanho da janela do navegador‚Äù. </li></ul><br><img src="https://habrastorage.org/webt/ov/we/fi/ovwefildb093dmfjzur0duaxfvk.jpeg"><br><br>  Com essa configura√ß√£o de par√¢metros do usu√°rio, √© importante considerar: <br><br><ol><li>  Quando a tag √© processada pela primeira vez, um cookie com o ID do usu√°rio do Google (ID do cliente) ainda n√£o ser√° criado.  Se quisermos configurar a transfer√™ncia desse par√¢metro para CD, n√£o poderemos fazer isso na primeira visualiza√ß√£o de p√°ginas. </li><li>  Se quisermos usar a mesma vari√°vel ao enviar dados para diferentes par√¢metros do usu√°rio, essa vari√°vel ser√° calculada novamente para cada par√¢metro do usu√°rio.  Por exemplo, ao enviar uma marca de tempo de processamento de tags para dois par√¢metros diferentes do usu√°rio, voc√™ pode notar uma diferen√ßa nos valores de alguns milissegundos. </li></ol><br>  Voc√™ pode evitar essas dificuldades com o customTask. <br><br><h3>  Usando customTask </h3><br>  customTask √© a fun√ß√£o com a maior prioridade, o c√≥digo e a l√≥gica dos quais voc√™ se define.  H√° pouco tempo, o Google deu a oportunidade de usar esse recurso no GTM. <br><br>  customTask usa dados do objeto de modelo (que inclui todos os campos do contador de rastreamento), cookie etc.  A prioridade desta fun√ß√£o √© maior que a de todas as outras e funciona com a tag.  Gra√ßas a isso, voc√™ pode configurar o envio do ID do usu√°rio a partir da primeira visualiza√ß√£o da p√°gina. <br><br>  Para configurar o CD atrav√©s do customTask, crie uma vari√°vel GTM com o nome JS_customTask e o tipo "C√≥digo JavaScript nativo": <br><br><img src="https://habrastorage.org/webt/mt/xt/m3/mtxtm3rarxslutrgoniz_ynobig.jpeg"><br><br>  Agora adicione o JS_customTask que criamos √† vari√°vel Configura√ß√µes do Google Analytics, na se√ß√£o "Campos a definir": <br><br><ul><li>  Em "Nome do campo", escreva <b>customTask</b> ; </li><li>  No "Valor", escreva o nome da vari√°vel que criamos acima.  Todas as vari√°veis ‚Äã‚Äãdevem ser escritas entre chaves. </li></ul><br><img src="https://habrastorage.org/webt/qp/tg/pc/qptgpciskueuoh_81xbxicmdjbi.jpeg"><br><br>  Somente uma customTask pode ser definida em uma tag GTM.  Portanto, todos os CDs que podem ser determinados por esse m√©todo ser√£o gravados na vari√°vel JS_customTask criada anteriormente. <br><br><h1>  CDs usados ‚Äã‚Äãcom freq√º√™ncia </h1><br><h2>  ID do usu√°rio </h2><br>  <b>Desafio.</b>  O contador registrou um grande salto no n√∫mero de sess√µes.  Ao mesmo tempo, o n√∫mero de usu√°rios cresceu um pouco.  Havia uma hip√≥tese sobre o tr√°fego de bot que vem de alguns usu√°rios.  Por padr√£o, n√£o √© poss√≠vel visualizar as caracter√≠sticas de usu√°rios individuais no GA em um formato conveniente. <br><br>  <b>Solu√ß√£o.</b>  O Google Analytics atribui um identificador exclusivo para cada visitante do site - ID do cliente.  Voc√™ pode v√™-lo na interface do Google Analytics apenas em um relat√≥rio - "Estat√≠sticas do usu√°rio" (User Explorer).  √â inconveniente us√°-lo, porque em uma tela voc√™ pode ver a sequ√™ncia de a√ß√µes de apenas um usu√°rio e n√£o pode adicionar par√¢metros adicionais ao relat√≥rio. <br><br>  Uma solu√ß√£o ideal seria a capacidade de exibir a identifica√ß√£o do cliente como um par√¢metro separado em um relat√≥rio padr√£o ou de usu√°rio.  E isso pode ser feito usando o GTM. <br><br>  <b>Configura√ß√µes de t√©cnica.</b>  Como ClientId, usamos a sequ√™ncia de d√≠gitos do ID do usu√°rio no GA (ele √© armazenado em um cookie com o nome _ga. Por exemplo, _ga = GA1.2.1111111111.111111111, em que ClientId = 111111111.111111111).  Para ver esse valor, clique com o bot√£o direito do mouse na p√°gina do site e selecione "Visualizar c√≥digo": <br><br><img src="https://habrastorage.org/webt/e2/fn/ew/e2fnewovy0uvqtij9k4krzez1ve.jpeg"><br><br>  Em seguida, na guia Aplicativo, no menu √† esquerda, selecione Cookies e o nome do site e procure a vari√°vel _ga na tabela: <br><br><img src="https://habrastorage.org/webt/g8/gs/qi/g8gsqiboktqwl0qw0bdmvzabn64.jpeg"><br><br>  Al√©m do cookie, o ID do usu√°rio do GA √© armazenado no objeto de modelo e pode ser recuperado usando o m√©todo .get ('clientId').  Usamos customTask para recuperar esse valor e pass√°-lo para o GA.  Adicione o seguinte c√≥digo √† vari√°vel denominada JS_customTask: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customDimensionIndex_client = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">model</span></span></span><span class="hljs-function">) </span></span>{ model.set(<span class="hljs-string"><span class="hljs-string">'dimension'</span></span> + customDimensionIndex_client, model.get(<span class="hljs-string"><span class="hljs-string">'clientId'</span></span>)); } }</code> </pre> <br>  Ap√≥s o sinal de igual para a vari√°vel customDimensionIndex_client, voc√™ precisa especificar o √≠ndice do CD correspondente ao ClientId no GA.  Dessa forma, obtivemos o ID do cliente do contador e o enviamos ao par√¢metro do usu√°rio. <br><br>  <b>Resultado.</b>  Criamos um relat√≥rio sobre usu√°rios individuais e descobrimos que alguns deles realmente tinham mil sess√µes.  Todas as sess√µes tiveram uma taxa de rejei√ß√£o de 100% e claramente n√£o traziam nenhum valor para n√≥s.  Configuramos um segmento para excluir esses usu√°rios e pudemos analisar a din√¢mica do tr√°fego sem visitas desnecess√°rias. <br><br><h2>  ID da ocorr√™ncia </h2><br>  <b>Desafio.</b>  Voc√™ precisa ver como o usu√°rio se comporta no site, quais a√ß√µes ele executa e em qual sequ√™ncia.  Com base nesses dados, hip√≥teses para o desenvolvimento de neg√≥cios podem ser apresentadas. <br><br>  <b>Solu√ß√£o.</b>  Crie seu pr√≥prio CD com o n√∫mero de hits do usu√°rio em cada sess√£o.  Classificando em ordem crescente de ocorr√™ncias, podemos ver as formas dos usu√°rios. <br><br>  <b>Configura√ß√µes de t√©cnica.</b>  Por conveni√™ncia, como HitId, passamos o tempo de ocorr√™ncia do ClientId + no formato de carimbo de data e hora.  Portanto, para cada evento, visualiza√ß√£o de p√°gina, transa√ß√£o, haver√° um valor.  Este par√¢metro pode ser configurado atrav√©s do customTask (semelhante ao ClientId). <br><br>  Somente uma customTask pode ser definida em uma √∫nica tag GTM.  Portanto, adicionamos √† vari√°vel "JavaScript personalizado" criada anteriormente o c√≥digo destacado em ambos os lados pelos coment√°rios, onde o √≠ndice do CD chamado h_HitId do GA ser√° armazenado na vari√°vel customDimensionIndex_hit: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> customDimensionIndex_client = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    var customDimensionIndex_hit = 2; var now = new Date(); //    return function(model) { model.set('dimension' + customDimensionIndex_client, model.get('clientId')); //    model.set('dimension' + customDimensionIndex_hit, model.get('clientId').concat('_', now.getTime())); //    } }</span></span></code> </pre> <br>  O tipo de par√¢metro √© atingido.  Como tamb√©m cont√©m tempo no formato de registro de data e hora, todos os hits de usu√°rio / sess√£o podem ser classificados pela ordem de sua execu√ß√£o, sem o uso de par√¢metros adicionais. <br><br>  Se voc√™ fizer exatamente as mesmas configura√ß√µes, apenas no GA escolher√° o escopo do par√¢metro - sess√£o, obteremos um CD que armazenar√° o identificador da sess√£o do usu√°rio. <br><br>  <b>Resultado.</b>  Construiu dois relat√≥rios: <br><br><ul><li>  Identificador de usu√°rio, identificador de ocorr√™ncia, categoria do evento, a√ß√£o do evento, r√≥tulo do evento, adicionar.  par√¢metros. </li><li>  ID do usu√°rio, ID da ocorr√™ncia, adicionar.  par√¢metros. </li></ul><br>  Em seguida, eles descarregaram esses dados do GA e os combinaram no Excel (ou em um banco de dados).  Se ordenarmos as linhas por ClientId e, em seguida, por HitId, obteremos o caminho de cada usu√°rio no site.  Agora podemos criar tabelas din√¢micas e visualiz√°-las. <br><br><h2>  Testes A / B </h2><br>  <b>Desafio.</b>  A empresa decidiu realizar um teste AB.  As configura√ß√µes foram feitas pelos desenvolvedores, sem o uso do Google Optimize.  Surgiu a quest√£o: como transferir op√ß√µes de teste para o Google Analytics para analisar a efic√°cia do experimento. <br><br>  <b>Solu√ß√£o.</b>  Nesse caso, os CDs nos ajudar√£o a comparar os resultados do teste no GA.  Basta configurar um par√¢metro do usu√°rio, que aceita valores com o identificador do teste e a op√ß√£o em que o usu√°rio se enquadra.  Assim, podemos dividir o p√∫blico em grupos de acordo com as op√ß√µes de teste e comparar os resultados. <br><br>  <b>Configura√ß√µes de t√©cnica.</b>  Crie um par√¢metro personalizado no GA, semelhante ao que configuramos anteriormente.  Selecionamos como um "escopo" - uma ocorr√™ncia, para que seja poss√≠vel dividir os eventos em eventos confirmados pelo usu√°rio antes e depois do teste.  Chame-o, por exemplo, h_AB-Test.  √â poss√≠vel transferir dados para um CD por v√°rios testes ao mesmo tempo.  Voc√™ pode separ√°-los com um s√≠mbolo que n√£o apare√ßa no nome e na vers√£o do teste, por exemplo, ‚Äú|‚Äù. <br><br>  Se voc√™ mesmo fizer o teste e armazenar os dados em um cookie, precisar√° de uma vari√°vel como "C√≥digo JavaScript nativo" para extra√≠-los: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cookie_name =<span class="hljs-string"><span class="hljs-string">'{{test_variant}}'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> matches = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.cookie.match(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">RegExp</span></span>( <span class="hljs-string"><span class="hljs-string">"(?:^|; )"</span></span> + cookie_name.replace(<span class="hljs-regexp"><span class="hljs-regexp">/([\.$?*|{}\(\)\[\]\\\/\+^])/g</span></span>, <span class="hljs-string"><span class="hljs-string">'\\$1'</span></span>) + <span class="hljs-string"><span class="hljs-string">"=([^;]*)"</span></span> )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> matches ? <span class="hljs-built_in"><span class="hljs-built_in">decodeURIComponent</span></span>(matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]) : <span class="hljs-string"><span class="hljs-string">'(not set)'</span></span>; }</code> </pre> <br>  onde, em vez de {{test_variant}}, voc√™ deve especificar o nome do cookie no qual o nome e a variante do teste s√£o armazenados.  N√£o se esque√ßa de adicion√°-lo √† vari√°vel de configura√ß√µes do GA. <br><br>  Ao adicionar o par√¢metro h_AB-Test ao relat√≥rio, veremos no Google Analytics a qual op√ß√£o de teste a sess√£o pertence.  Dependendo do valor desse par√¢metro, voc√™ pode segmentar usu√°rios. <br><br>  <b>Resultado.</b>  Criamos tantos segmentos quanto houve casos de teste com a condi√ß√£o h_AB-Test.  Ele deve corresponder ao valor "nome + caso de teste".  Analisamos os eventos que nos interessam nos relat√≥rios. <br><br><h2>  Endere√ßo da p√°gina inteira </h2><br>  <b>Desafio.</b>  O gerente de publicidade contextual lan√ßou uma campanha publicit√°ria no Yandex.Direct.  Alguns dias depois, ele entrou no relat√≥rio de fontes do GA e descobriu que o n√∫mero de sess√µes de usu√°rio provenientes da campanha publicit√°ria criada por ele era muito menor do que os cliques nos an√∫ncios no Yandex.Direct. <br><br>  <b>Solu√ß√£o.</b>  O Google Analytics possui um par√¢metro necess√°rio para rastrear an√∫ncios - utm_source.  Se for, seu valor ser√° adicionado ao par√¢metro padr√£o "Origem da campanha".  Da mesma forma, o Google faz com outras tags UTM para gravar nos par√¢metros correspondentes. <br><br>  Todas as tags UTM s√£o exclu√≠das automaticamente do relat√≥rio nas p√°ginas do site e voc√™ n√£o pode analis√°-las l√°.  Nesse caso, se o r√≥tulo utm_source n√£o foi definido, o Google simplesmente remove todas as tags UTM encontradas do relat√≥rio nas p√°ginas e n√£o registra seu conte√∫do nos par√¢metros internos correspondentes. <br><br>  Vamos configurar o par√¢metro com o endere√ßo da p√°gina inteira para ver todas as tags, mesmo que o an√∫ncio esteja configurado incorretamente.  Vamos cham√°-lo de h_fullPage. <br><br>  <b>Configura√ß√µes de t√©cnica.</b>  Vamos criar uma vari√°vel com o tipo "Vari√°vel JavaScript" na se√ß√£o "Nome da vari√°vel global" e especificar o documento.URL: <br><br><img src="https://habrastorage.org/webt/bp/pw/ww/bppwwwv7021ewdjqxxhaymypmzs.jpeg"><br><br>  Como o escopo da vari√°vel set - hit. <br><br>  <b>Resultado.</b>  A seguinte sequ√™ncia de tags UTM foi usada em toda a campanha publicit√°ria: utm_medium, utm_source, utm_campaign.  Depois de analisar o endere√ßo completo das p√°ginas, percebemos que um e comercial foi pulado entre an√∫ncios entre utm_medium e utm_source.  Como utm_source √© uma tag utm obrigat√≥ria para qualquer campanha publicit√°ria e o Google Analytics n√£o a encontrou ap√≥s caracteres especiais (?, &amp;), O clique neste an√∫ncio foi registrado no tr√°fego direto.  Gra√ßas ao par√¢metro h_fullPage, foi poss√≠vel detectar o problema e corrigi-lo nas configura√ß√µes do painel de publicidade. <br><br><h2>  Op√ß√µes de Eventos </h2><br>  Dois outros par√¢metros √∫teis (sem uma descri√ß√£o de suas configura√ß√µes): <br><br><ul><li>  <b>Desafio.</b>  Marcamos o site por conta pr√≥pria atrav√©s do GTM.  Foi encontrado um erro, corrigido rapidamente, mas os eventos com o erro continuam chegando no GA. <br><br>  <b>Solu√ß√£o.</b>  Para encontrar rapidamente a raiz do problema, voc√™ pode transferir um CD com cada evento: <br>  O nome do cont√™iner (se houver v√°rios no site) - a vari√°vel interna GTM; <br>  A vers√£o do cont√™iner √© a vari√°vel interna do GTM; <br>  Nome da etiqueta - voc√™ precisa configur√°-lo. <br><br>  Voc√™ pode passar esses tr√™s par√¢metros por qualquer separador em uma vari√°vel do tipo "Constant": <br><br><img src="https://habrastorage.org/webt/2m/j4/dp/2mj4dpgyy_ierrk8-ndngyd17rk.jpeg"><br><br>  O escopo do par√¢metro √© atingido. <br><br>  <b>Resultado.</b>  Usando a vari√°vel configurada, descobrimos que alguns usu√°rios ainda t√™m a vers√£o antiga do cont√™iner, portanto os eventos continuam sendo enviados.  Provavelmente, os usu√°rios simplesmente n√£o atualizaram a p√°gina ou ela foi armazenada em cache; portanto, √© preciso esperar um pouco. </li><li>  <b>Desafio.</b>  Marcamos o site atrav√©s dos desenvolvedores.  Eles introduziram uma nova instru√ß√£o escrita por n√≥s.  Ap√≥s a verifica√ß√£o, alguns eventos foram enviados com um erro. <br><blockquote>  <b>Importante:</b> <br><br><ul><li>  N√£o envie eventos de teste para a exibi√ß√£o de trabalho do GA quando verificarmos eventos no site de teste; </li><li>  se, ap√≥s o lan√ßamento da batalha, notamos que verificamos eventos marcados incorretamente / algo quebrou ap√≥s a atualiza√ß√£o do site, √© importante parar rapidamente de enviar eventos para a visualiza√ß√£o de trabalho. </li></ul><br></blockquote>  <b>Solu√ß√£o.</b>  Dividiremos os eventos em novos / incorretos e marcados corretamente.  O primeiro pode ser marcado como teste, o segundo - prod. <br><br>  Para fazer isso, permita que os desenvolvedores adicionem dados ao dataLayer, e n√≥s os obteremos e os enviaremos para o GA.  Qualquer push ser√° assim: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> dataLayer.push({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'event'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'event_id'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{id }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventCategory'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventAction'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{  }}'</span></span></span><span class="actionscript">, </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'eventLabel'</span></span></span><span class="actionscript">: </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'{{ }}'</span></span></span><span class="actionscript">, }); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  onde entre colchetes duplos s√£o os nomes das vari√°veis ‚Äã‚Äãnas quais os dados s√£o armazenados ao lado dos desenvolvedores. <br><br>  Precisamos criar a vari√°vel "Tabela de pesquisa" para separar eventos: <br><br><img src="https://habrastorage.org/webt/uz/ct/9j/uzct9jqlhgg1u0neld1n9zljzao.jpeg"><br><br>  {{event_id}} √© uma vari√°vel que recupera o identificador de evento do DataLayer. <br><br>  Colocamos uma marca de sele√ß√£o na frente de "Definir valor padr√£o" e na coluna "Valor padr√£o" teste de grava√ß√£o.  Portanto, inicialmente para todos os eventos, essa vari√°vel ser√° igual a teste.  Depois de verificar se o evento est√° marcado corretamente, adicione seu event_id √† c√©lula "Input".  No campo "Resultado", enviamos prod. <br><br>  Ent√£o, dividimos todos os eventos em marcados corretamente e novos / marcados incorretamente.  Recomendamos que voc√™ crie uma visualiza√ß√£o separada no Google Analytics, onde haver√° eventos apenas com o r√≥tulo do produto (isso pode ser feito usando o filtro Visualiza√ß√µes). L√°, voc√™ ver√° apenas os eventos marcados corretamente. <br><br>  <b>Resultado.</b>  Como os erros na marca√ß√£o de eventos das instru√ß√µes foram eliminados, alteramos o valor do par√¢metro para esses eventos no GTM de teste para prod.  Gra√ßas a esse par√¢metro, inclu√≠mos nos relat√≥rios apenas eventos marcados corretamente com o r√≥tulo prod. </li></ul><br>  A funcionalidade das dimens√µes personalizadas √© ampla e n√£o se limita aos m√©todos descritos de configura√ß√£o e aplica√ß√£o.  Para cada tipo de neg√≥cio, an√°lise e hip√≥tese, voc√™ pode encontrar sua pr√≥pria aplica√ß√£o de par√¢metros definidos pelo usu√°rio, e os m√©todos de customiza√ß√£o descritos ajudar√£o a tornar esse processo mais f√°cil. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt468079/">https://habr.com/ru/post/pt468079/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt468067/index.html">Como a composi√ß√£o alfa funciona</a></li>
<li><a href="../pt468071/index.html">Eduard Medvedev, CTO da Tungsten Labs: ‚ÄúCrescemos at√© o ponto em que a tecnologia pode causar grandes danos‚Äù</a></li>
<li><a href="../pt468073/index.html">Andrei Terekhov: "Voc√™ pode dizer o quanto quiser que o americano √© melhor, mas nosso carro nunca quebra"</a></li>
<li><a href="../pt468075/index.html">O uso de redes neurais siamesas na busca</a></li>
<li><a href="../pt468077/index.html">Posit testes de forma adulta. An√°lise espectral</a></li>
<li><a href="../pt468081/index.html">"Dados an√¥nimos" ou o que est√° planejado no 152-FZ</a></li>
<li><a href="../pt468083/index.html">API Camera2 do Android da chaleira</a></li>
<li><a href="../pt468085/index.html">O livro "Safe DevOps. Opera√ß√£o eficiente do sistema</a></li>
<li><a href="../pt468087/index.html">M√©todo de divis√£o bissecional em testes</a></li>
<li><a href="../pt468089/index.html">Redefini√ß√£o baseada em edi√ß√£o: √© poss√≠vel na produ√ß√£o?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>