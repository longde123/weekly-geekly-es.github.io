<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📺 🍠 🍏 Membuat hook UsePosition () reaktif untuk mendapatkan dan melacak koordinat browser 🕵🏿 🍤 🤹🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jika singkat 


 Pada artikel ini, kami akan membuat usePosition() hook reaktif untuk melacak geolokasi browser. Di bawah kap, kait ini akan menggunak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membuat hook UsePosition () reaktif untuk mendapatkan dan melacak koordinat browser</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/458614/"><p><img src="https://habrastorage.org/getpro/habr/post_images/b2e/801/b0c/b2e801b0c809c1b2059b4e0d712a71b1.jpg" alt="gambar"></p><br><h2 id="esli-vkratce">  Jika singkat </h2><br><p> Pada artikel ini, kami akan membuat <code>usePosition()</code> hook reaktif untuk melacak geolokasi browser.  Di bawah kap, kait ini akan menggunakan metode <code>getCurrentPosition()</code> dan <code>watchPosition()</code> dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">navigator.geolocation</a> objek browser asli.  Saya menerbitkan versi final dari hook <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>pada GitHub</b></a> dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>NPM</b></a> . </p><br><h2 id="zachem-sozdavat-huk-useposition-v-principe">  Mengapa membuat hook <code>usePosition()</code> pada prinsipnya </h2><br><p>  Salah satu keuntungan penting dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">kait</a> dalam Bereaksi adalah kemampuan untuk mengisolasi fragmen kode yang terkait secara logis di satu tempat (di hook), sambil menghindari kebutuhan untuk mencampur fragmen kode yang tidak berhubungan secara logis, misalnya, dalam metode <code>componentDidMount()</code> komponen. </p><br><p>  Misalkan kita ingin mendapatkan koordinat browser ( <code>latitude</code> dan <code>longitude</code> ) dan setelah menerima koordinat, minta ramalan cuaca atau suhu saat ini di wilayah ini dari layanan pihak ketiga.  Kode dari dua fungsi ini (memperoleh koordinat dan suhu permintaan) dalam Bereaksi sering ditempatkan di dalam satu metode <code>componentDidMount()</code> .  Dalam hal ini, metode <code>componentWillUnmount()</code> biasanya "dibersihkan" dengan sendirinya, memanggil metode <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">clearWatch ()</a> untuk berhenti memantau lokasi browser.  Pendekatan semacam itu meningkatkan ukuran metode, membagi bagian-bagian kode yang terhubung secara logis menjadi beberapa bagian (berlangganan dan berhenti berlangganan secara terpisah dari pemantauan lokasi browser), dan menggabungkan bagian-bagian kode yang terhubung secara logis lemah menjadi satu metode (memperoleh koordinat dan suhu).  Membaca kode sulit, seperti debugging dan dukungan. </p><br><p>  Selanjutnya, kami akan mencoba mentransfer fungsionalitas yang terkait dengan memperoleh koordinat browser ke hook <code>usePosition()</code> terpisah untuk menghindari kesulitan yang tercantum di atas. </p><a name="habracut"></a><br><h2 id="kak-my-budem-ispolzovat-huk-useposition">  Bagaimana kita akan menggunakan hook <code>usePosition()</code> </h2><br><p>  Mari kita “dari kebalikan” dan sebelum mengimplementasikan hook itu sendiri, mari kita rencanakan bagaimana kita akan menggunakannya.  Ini akan membantu kami menentukan antarmuka pengait (apa yang akan diterima dan apa yang harus dikembalikan). </p><br><p>  Contoh paling sederhana untuk mendapatkan koordinat dan menampilkannya di layar mungkin terlihat seperti ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    . import { usePosition } from './usePosition'; export const UsePositionDemo = () =&gt; { //    ( ) . const { latitude, longitude, error } = usePosition(); //       (   ). return ( &lt;&gt; latitude: {latitude}, longitude: {longitude}, error: {error} &lt;/&gt; ); };</span></span></code> </pre> <br><p>  Hanya satu baris dengan hook <code>usePosition()</code> dan kita dapat beroperasi dengan <code>latitude</code> dan <code>longitude</code> .  Kami bahkan belum pernah menggunakan <code>useState()</code> atau <code>useEffect()</code> secara eksplisit di sini.  Berlangganan koordinat pelacakan, serta menghapus pelanggan, dienkapsulasi dalam satu hook <code>usePosition()</code> .  Lebih jauh, keajaiban komponen ulang Bereaksi akan melakukan segalanya untuk kita.  Pada awalnya, koordinat akan menjadi <code>null</code> atau <code>undefined</code> .  Segera setelah koordinat diterima, komponen akan digambar ulang dan kita akan melihatnya di layar. </p><br><h2 id="realizaciya-huka-useposition">  Implementasi <code>usePosition()</code> </h2><br><p>  <code>usePosition()</code> adalah fungsi JavaScript biasa yang terlihat seperti ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  . export const usePosition = () =&gt; { //    . }</span></span></code> </pre> <br><p>  Kami akan menggunakan kait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">useState ()</a> untuk penyimpanan internal koordinat dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">useEffect ()</a> untuk berlangganan dan berhenti berlangganan dari koordinat pelacakan.  Untuk melakukan ini, kita harus mengimpornya. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     . }</span></span></code> </pre> <br><p>  Kami akan membuat variabel status di mana kami akan menyimpan koordinat atau kesalahan dalam memperoleh koordinat (misalnya, jika pengguna menolak untuk membagikan lokasinya). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ... }</span></span></code> </pre> <br><p>  Juga pada tahap ini kita dapat mengembalikan variabel yang diharapkan dari hook.  Sejauh ini, tidak ada yang berguna dalam variabel-variabel ini, tetapi kami akan segera memperbaikinya. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">// other code goes here... return { ...position, error }; }</span></span></code> </pre> <br><p>  Dan sekarang momen kunci implementasi adalah mendapatkan koordinat. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     ,    .. useEffect(() =&gt; { const geo = navigator.geolocation; if (!geo) { setError('   '); return; } //     . watcher = geo.watchPosition(onChange, onError); //  ,       //    ,    . return () =&gt; geo.clearWatch(watcher); }, []); return {...position, error}; }</span></span></code> </pre> <br><p>  Dalam kait <code>useEffect()</code> , pertama-tama kita periksa untuk melihat apakah browser mendukung fungsi deteksi koordinat.  Jika fungsi tidak didukung, kami keluar dari kail dengan kesalahan.  Jika tidak, kami berlangganan untuk mengubah geolokasi browser menggunakan callback onChange <code>onChange()</code> dan <code>onError()</code> (kami akan menambahkan kode mereka di bawah).  Perhatikan bahwa dari kait <code>useEffect()</code> , kami mengembalikan fungsi anonim yang akan dieksekusi jika komponen dihapus dari layar.  Dalam fungsi anonim ini, kami berhenti berlangganan dari pengawasan agar tidak menyumbat memori.  Dengan demikian, seluruh logika berlangganan dan berhenti berlangganan dari pelacakan adalah dalam satu hook <code>usePosition()</code> . </p><br><p>  Mari tambahkan callback yang hilang: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{latitude, longitude}</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        position,   //    ,    . setPosition({latitude, longitude}); }; const onError = (error) =&gt; { setError(error.message); }; useEffect(() =&gt; { const geo = navigator.geolocation; if (!geo) { setError('   '); return; } //     . watcher = geo.watchPosition(onChange, onError); //  ,       //    ,    . return () =&gt; geo.clearWatch(watcher); }, []); return {...position, error}; }</span></span></code> </pre> <br><p>  <code>usePosition()</code> siap digunakan. </p><br><h2 id="naposledok">  Pada akhirnya </h2><br><p>  Anda dapat menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">demonstrasi hook</a> dan implementasinya yang lebih terperinci dengan kemampuan untuk mengatur parameter pelacakan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><b>GitHub</b></a> . </p><br><p>  Saya harap artikel ini bermanfaat bagi Anda.  Pengodean yang berhasil! </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458614/">https://habr.com/ru/post/id458614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id458602/index.html">Bagaimana kami menembus Great Chinese Firewall (Bagian 1)</a></li>
<li><a href="../id458604/index.html">Mengapa dua produsen elektronik terbesar bergabung dalam proyek GPU baru</a></li>
<li><a href="../id458606/index.html">Jalankan OpenVPN di Docker dalam 2 detik</a></li>
<li><a href="../id458608/index.html">Alat Pengembang Node.js Antrian pekerjaan</a></li>
<li><a href="../id458612/index.html">Kosmos 7 tahun</a></li>
<li><a href="../id458622/index.html">Otomasi Untuk Yang Terkecil. Bagian satu (yang setelah nol). Virtualisasi jaringan</a></li>
<li><a href="../id458624/index.html">Bagaimana kami belajar menggambar teks di atas kanvas</a></li>
<li><a href="../id458626/index.html">StealthWatch: konsep dasar dan persyaratan minimum. Bagian 1</a></li>
<li><a href="../id458630/index.html">Sedikit sejarah mengembangkan game Anda di Windows Forms + C # murni dalam 16 tahun saya</a></li>
<li><a href="../id458632/index.html">Benar-benar mengetik vue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>