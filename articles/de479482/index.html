<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üôÑ ü§¥üèº ü§üüèΩ SARIF SDK und seine Fehler üíáüèæ üíÉ üëáüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Heute testen wir ein weiteres qualitativ hochwertiges Microsoft-Projekt, in dem wir immer noch versuchen, mithilfe von PVS-Studio heldenhaft nach Fehl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SARIF SDK und seine Fehler</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/479482/"><p><img src="https://habrastorage.org/getpro/habr/post_images/895/fa2/6ea/895fa26ea315d6cb73f0f5fcd0d569e5.png" alt="Bild 2" align="left"></p><br>  Heute testen wir ein weiteres qualitativ hochwertiges Microsoft-Projekt, in dem wir immer noch versuchen, mithilfe von PVS-Studio heldenhaft nach Fehlern zu suchen.  SARIF steht f√ºr Static Analysis Results Interchange Format (Austauschformat f√ºr statische Analyseergebnisse). Dies ist ein Standard (Dateiformat), das f√ºr die Interaktion und den Austausch der Ergebnisse von statischen Analyseger√§ten mit anderen Tools entwickelt wurde: IDEs, umfassende Tools zur Code√ºberpr√ºfung und -analyse (z. B. SonarQube) und Systeme zur kontinuierlichen Integration usw.  Das SARIF-SDK enth√§lt die .NET-Entwicklertools zur Unterst√ºtzung von SARIF sowie unterst√ºtzende Dateien. <br><a name="habracut"></a>  SARIF hat seinen Ursprung bei Microsoft und ist heute ein Standard, der von OASIS (einem gemeinn√ºtzigen Konsortium, das sich mit offenen Standards befasst) entwickelt wurde.  SARIF wurde entwickelt, um nicht nur die Ergebnisse des Analysators zu √ºbertragen, sondern auch Metadaten √ºber das Tool sowie Daten zu dessen Start, Zeitstempeln usw.  Weitere Details zum Standard finden Sie auf der <a href="https://www.oasis-open.org/committees/tc_home.php%3Fwg_abbrev%3Dsarif">OASIS-</a> Website.  Der SARIF SDK-Quellcode kann aus dem Repository von <a href="https://github.com/microsoft/sarif-sdk">GiHub heruntergeladen werden</a> .  Die Projekthomepage finden Sie <a href="http://sarifweb.azurewebsites.net/">hier</a> . <br><br><h2>  √úber das Projekt </h2><br>  Das SARIF SDK-Projekt war klein: 799 .cs-Dateien (ca. 98.000 nicht leere Codezeilen).  Das Projekt enth√§lt Tests, die ich immer von der √úberpr√ºfung ausschlie√üen.  Der Teil des Codes, der uns interessiert, waren also 642 .cs-Dateien (ungef√§hr 79.000 nicht leere Codezeilen).  Das reicht nat√ºrlich nicht aus.  Die √úberpr√ºfung und Analyse verlief jedoch schnell und einfach zwischen den Dingen, die ich zu Beginn des Artikels im Bild zu reflektieren versuchte.  Trotzdem wurden einige interessante Fehler gefunden.  Schauen wir sie uns an. <br><br><h2>  Fehler </h2><br>  <a href="https://www.viva64.com/ru/w/v3070/">V3070</a> [CWE-457] Nicht initialisierte Variable 'Bin√§r' wird beim Initialisieren der 'Standard'-Variablen verwendet.  MimeType.cs 90 <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MimeType</span></span> { .... <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">The MIME type to use when no better MIME type is known.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public static readonly string Default = Binary; .... </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">The MIME type for binaries.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> public static readonly string Binary = "application/octet-stream"; .... }</span></span></code> </pre> <br>  Das <i>Standardfeld</i> wird mit dem Wert eines anderen Feldes initialisiert, das noch keinen Wert erhalten hat.  Als Ergebnis erh√§lt Default den Standardwert f√ºr den Typ <i>string</i> - null.  Wahrscheinlich wurde der Fehler nicht bemerkt, da das Feld <i>Standard</i> nirgendwo verwendet wird.  Aber alles kann sich √§ndern, und dann wird der Entwickler auf ein unerwartetes Ergebnis oder einen Programmabsturz sto√üen. <br><br>  <a href="https://www.viva64.com/ru/w/v3061/">V3061 Der</a> Parameter 'logicalLocationToIndexMap' wird vor der Verwendung immer im Methodentext neu geschrieben.  PrereleaseCompatibilityTransformer.cs 1963 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> JArray </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertLogicalLocationsDictionaryToArray</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> .... Dictionary&lt;LogicalLocation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; logicalLocationToIndexMap, ....</span></span></span><span class="hljs-function">)</span></span> { .... logicalLocationToIndexMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;LogicalLocation, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(LogicalLocation.ValueComparer); .... }</code> </pre><br>  Der Parameter <i>logicalLocationToIndexMap</i> wird in keiner Weise verwendet und schreibt einen anderen Wert in ihn.  Seltsamerweise ist der alte Wert genau dasselbe leere W√∂rterbuch, das in der aufrufenden Methode erstellt wurde: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ApplyChangesFromTC25ThroughTC30</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... Dictionary&lt;LogicalLocation, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; logicalLocationToIndexMap = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; .... logicalLocationToIndexMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;LogicalLocation, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(LogicalLocation.ValueComparer); run[<span class="hljs-string"><span class="hljs-string">"logicalLocations"</span></span>] = ConvertLogicalLocationsDictionaryToArray( ...., logicalLocationToIndexMap, ....); }</code> </pre> <br>  Seltsamer und verd√§chtiger Code. <br><br>  <a href="https://www.viva64.com/ru/w/v3008/">V3008</a> [CWE-563] Der Variablen 'run.Tool' werden nacheinander zweimal Werte zugewiesen.  Vielleicht ist das ein Fehler.  √úberpr√ºfen Sie die Zeilen: 116, 114. ExportRulesMetadataCommandBase.cs 116 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Run</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Tool Tool { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Tool</span></span> : .... { .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Tool</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OutputSarifRulesMetada</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> run = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Run(); run.Tool = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tool(); run.Tool = Tool.CreateFromAssemblyData(....); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  Der run.Tool- <i>Eigenschaft wird</i> zweimal ein Wert zugewiesen.  Wie beim Erstellen des <i>Tool-</i> Objekts und beim Schreiben in die <i>Tool-</i> Eigenschaft werden keine zus√§tzlichen Arbeiten ausgef√ºhrt.  Neuzuweisung sieht daher verd√§chtig aus. <br><br>  <a href="https://www.viva64.com/ru/w/v3042/">V3042</a> [CWE-476] M√∂gliche NullReferenceException.  Das '?.'  und '.'  Operatoren werden verwendet, um auf Mitglieder des 'loc'-Objekts WhereComparer.cs 152 zuzugreifen <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Uri </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ArtifactUri</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ArtifactLocation loc, Run run</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loc?.Uri ?? loc.Resolve(run)?.Uri; }</code> </pre> <br>  Wenn sich herausstellt, dass die Variable <i>loc</i> den Wert <i>null hat</i> , wird versucht, den Wert von der rechten Seite des Operators ?? zur√ºckzugeben, was zum Zugriff durch eine Nullreferenz f√ºhrt. <br><br>  <a href="https://www.viva64.com/ru/w/v3042/">V3042</a> [CWE-476] M√∂gliche NullReferenceException.  Das '?.'  und '.'  Operatoren werden f√ºr den Zugriff auf Mitglieder des 'formatString'-Objekts InsertOptionalDataVisitor.cs 194 verwendet <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Message </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VisitMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Message node</span></span></span><span class="hljs-function">)</span></span> { .... node.Text = node.Arguments?.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(...., formatString.Text, ....) : formatString?.Text; .... }</code> </pre> <br>  In zwei parallelen Zweigen der bedingten Anweisung ?: Sie verwenden unsichere und sichere Zugriffsoptionen unter Verwendung einer m√∂glicherweise <i>leeren formatString-</i> Referenz. <br><br>  <a href="https://www.viva64.com/ru/w/v3042/">V3042</a> [CWE-476] M√∂gliche NullReferenceException.  Das '?.'  und '.'  Operatoren werden f√ºr den Zugriff auf Mitglieder des 'messageText'-Objekts FortifyFprConverter.cs 1210 verwendet <br><br>  <a href="https://www.viva64.com/ru/w/v3042/">V3042</a> [CWE-476] M√∂gliche NullReferenceException.  Das '?.'  und '.'  Operatoren werden f√ºr den Zugriff auf Mitglieder des 'messageText'-Objekts FortifyFprConverter.cs 1216 verwendet <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddMessagesToResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Result result</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> messageText = (rule.ShortDescription ?? rule.FullDescription)?.Text; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { <span class="hljs-comment"><span class="hljs-comment">// Replace the token with an embedded hyperlink. messageText = messageText.Replace(....); } else { // Replace the token with plain text. messageText = messageText.Replace(....); } .... }</span></span></code> </pre> <br>  Hier gab der Analysator sofort zwei Warnungen √ºber einen m√∂glichen Zugriff per <i>messageText</i> null reference aus.  Es sieht trivial aus, aber der Fehler daraus h√∂rt nicht auf, ein Fehler zu sein. <br><br>  <a href="https://www.viva64.com/ru/w/v3080/">V3080</a> [CWE-476] M√∂gliche Null-Dereferenzierung.  Sehen Sie sich 'fileDataVersionOne.Uri' an.  SarifCurrentToVersionOneVisitor.cs 1030 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> IDictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, FileDataVersionOne&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateFileDataVersionOneDictionary</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... FileDataVersionOne fileDataVersionOne = CreateFileDataVersionOne(v2File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileDataVersionOne.Uri.OriginalString.Equals(key)) { .... } .... }</code> </pre> <br>  Der Analysator vermutete, dass beim Arbeiten mit dem Link <i>fileDataVersionOne.Uri</i> eine <i>NullReferenceException</i> m√∂glich war.  Mal sehen, woher diese Variable kommt und ob der Analysator richtig ist.  Untersuchen Sie dazu den Body der <i>CreateFileDataVersionOne-</i> Methode: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> FileDataVersionOne </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateFileDataVersionOne</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Artifact v2FileData</span></span></span><span class="hljs-function">)</span></span> { FileDataVersionOne fileData = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v2FileData != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... fileData = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileDataVersionOne { .... Uri = v2FileData.Location?.Uri, .... }; .... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fileData; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FileDataVersionOne</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Uri Uri { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... }</code> </pre> <br>  In der Tat kann beim Erstellen eines Objekts der Klasse <i>FileDataVersionOne die</i> <i>Uri-</i> Eigenschaft auf <i>null gesetzt werden</i> .  Ein gutes Beispiel f√ºr die Zusammenarbeit von Datenflussanalyse und interproceduralen Analysemechanismen. <br><br>  <a href="https://www.viva64.com/ru/w/v3080/">V3080</a> [CWE-476] M√∂gliche Null-Dereferenzierung.  Betrachten Sie '_jsonTextWriter'.  SarifLogger.cs 242 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_closeWriterOnDispose) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_textWriter != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _textWriter.Dispose(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_jsonTextWriter == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { _jsonTextWriter.Close(); } <span class="hljs-comment"><span class="hljs-comment">// &lt;= } .... }</span></span></code> </pre> <br>  Dies ist ein Tippfehler.  Offensichtlich muss die Bedingung des zweiten <i>if-</i> Blocks <i>_jsonTextWriter! = Null sein</i> .  Die Gefahr dieses Codes besteht darin, dass er h√∂chstwahrscheinlich nicht abst√ºrzt, da <i>_jsonTextWriter</i> nicht genau <i>null ist</i> .  Gleichzeitig bleibt der Durchfluss aber offen. <br><br>  <a href="https://www.viva64.com/ru/w/v3083/">V3083</a> [CWE-367] Unsicherer Aufruf des Ereignisses 'RuleRead', NullReferenceException ist m√∂glich.  √úberlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen m√∂chten, bevor Sie sie aufrufen.  FxCopConverter.cs 897 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadRule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RuleRead != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { RuleRead(....); } .... }</code> </pre> <br>  Sie arbeiten nicht sicher mit der Veranstaltung.  Ein nicht kritischer Fehler, der leicht behoben werden kann, z. B. nach der Aufforderung von Visual Studio.  Hier bietet eine Ersatz-IDE: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ReadRule</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... RuleRead?.Invoke(....); .... }</code> </pre> <br>  Es funktioniert einige Sekunden lang, aber der Analysator schw√∂rt nicht mehr und die IDE hebt den Code nicht hervor.  Ein weiterer √§hnlicher Fehler: <br><br><ul><li>  V3083 [CWE-367] Unsicherer Aufruf des Ereignisses 'ResultRead', NullReferenceException ist m√∂glich.  √úberlegen Sie, ob Sie einer lokalen Variablen ein Ereignis zuweisen m√∂chten, bevor Sie sie aufrufen.  FxCopConverter.cs 813 </li></ul><br>  <a href="https://www.viva64.com/ru/w/v3095/">V3095</a> [CWE-476] Das Objekt 'v1Location' wurde verwendet, bevor es gegen null verifiziert wurde.  √úberpr√ºfen Sie die Zeilen: 333, 335. SarifVersionOneToCurrentVisitor.cs 333 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> Location </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateLocation</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LocationVersionOne v1Location</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> key = v1Location.LogicalLocationKey ?? v1Location.FullyQualifiedLogicalName; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v1Location != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { .... } .... }</code> </pre> <br>  Der Autor des Codes schlug vor, dass der <i>v1Location-</i> Link m√∂glicherweise null ist, und f√ºgte daher die entsprechende Pr√ºfung hinzu.  Zur gleichen Zeit, im Code etwas h√∂her, aus irgendeinem Grund funktioniert es mit diesem Link ohne Pr√ºfung.  Unaufmerksamkeit beim Refactoring?  Schwer zu sagen. <br><br>  <a href="https://www.viva64.com/ru/w/v3125/">V3125</a> [CWE-476] Das Objekt 'v1StackFrame' wurde verwendet, nachdem es gegen null verifiziert wurde.  Zeilen pr√ºfen: 1182, 1171. SarifVersionOneToCurrentVisitor.cs 1182 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> StackFrame </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateStackFrame</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">StackFrameVersionOne v1StackFrame</span></span></span><span class="hljs-function">)</span></span> { StackFrame stackFrame = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (v1StackFrame != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { stackFrame = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StackFrame { .... }; } stackFrame.Location = CreateLocation(v1StackFrame.FullyQualifiedLogicalName, v1StackFrame.LogicalLocationKey, ....); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stackFrame; }</code> </pre> <br>  Traditionell ist das Gegenteil der Fall.  Zuerst wird der <i>v1StackFrame-</i> Link auf <i>null</i> √ºberpr√ºft und dann vergessen, dies zu √ºberpr√ºfen.  Es gibt jedoch eine wichtige Einschr√§nkung: Die <i>Variablen</i> <i>v1StackFrame</i> und <i>stackFrame sind</i> logisch miteinander verkn√ºpft.  Wenn <i>v1StackFrame</i> = <i>null ist</i> , wird das <i>StackFrame-</i> Objekt nicht erstellt und <i>stackFrame</i> bleibt = <i>null</i> .  In diesem Fall erh√§lt das Programm einen Aufruf von <i>stackFrame.Location</i> , da hier keine Pr√ºfungen durchgef√ºhrt werden.  Das hei√üt, die gef√§hrliche Verwendung von <i>v1StackFrame</i> , auf die der Analysator hingewiesen hat, erreicht nicht einmal den Punkt.  Dieser Code <i>funktioniert</i> nur, <i>wenn</i> <i>v1StackFrame-</i> Werte ungleich Null <i>an die CreateStackFrame-Methode √ºbergeben werden</i> .  Ich vermutete, dass dies irgendwie im aufrufenden Code kontrolliert wurde.  <i>CreateStackFrame-</i> Aufrufe sehen folgenderma√üen aus: <br><br><pre> <code class="cs hljs">Frames = v1Stack.Frames?.Select(CreateStackFrame).ToList()</code> </pre> <br>  <i>CreateStackFrame wird</i> als Selektor verwendet.  Es findet keine √úberpr√ºfung der √ºbergebenen <i>Null-</i> Gleichheitsreferenzen statt.  Vielleicht wird dies irgendwo beim Ausf√ºllen der <i>Frames-</i> Sammlung (Aufnahme von Nullreferenzen) kontrolliert, aber ich habe nicht so weit gegraben.  Die Schlussfolgerung ist bereits offensichtlich - der Code erfordert die Aufmerksamkeit der Autoren. <br><br><h2>  Fazit </h2><br>  Der Artikel erwies sich als klein, aber niemand hatte Zeit, sich zu langweilen :) Ich erinnere Sie daran, dass Sie unseren Analyzer jederzeit <a href="https://www.viva64.com/ru/pvs-studio-download/">herunterladen</a> k√∂nnen, um unabh√§ngig nach Fehlern in Ihren eigenen oder fremden Projekten zu suchen. <br><br>  Zum Schluss noch eine kleine Ank√ºndigung: In meinem n√§chsten Artikel geht es um die interessantesten Fehler, die ich und meine Kollegen 2019 in C # -Projekten gefunden haben.  Folgen Sie unserem <a href="https://www.viva64.com/ru/b/">Blog</a> .  Bis dann! <br><br>  Um mehr √ºber neue Blog-Posts zu erfahren, k√∂nnen Sie die folgenden Kan√§le abonnieren: <br><br><ul><li>  Twitter: <a href="https://twitter.com/pvsstudio_rus/">@pvsstudio_rus</a> </li><li>  VK.com: <a href="https://vk.com/pvsstudio_rus">PVS-Studio-Analysator</a> </li><li>  Telegramm: <a href="https://t.me/pvsstudio_rus">@pvsstudio_rus</a> </li><li>  Instagram: <a href="https://www.instagram.com/pvsstudio_rus/">pvsstudio_rus</a> </li><li>  Guter alter RSS: <a href="http://feeds.feedburner.com/viva64-blog-ru">viva64-blog-de</a> </li></ul><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/479480/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  Wenn Sie diesen Artikel mit einem englischsprachigen Publikum teilen m√∂chten, verwenden Sie bitte den Link zur √úbersetzung: Sergey Khrenov.  <a href="https://habr.com/en/company/pvs-studio/blog/479480/">SARIF SDK und seine Fehler</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de479482/">https://habr.com/ru/post/de479482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de479466/index.html">Habraiting 2019: Statistik und Ranking der besten Artikel f√ºr 2019</a></li>
<li><a href="../de479468/index.html">Edge of Honesty und John Doe</a></li>
<li><a href="../de479474/index.html">Warum ist die Selbstorganisation von Teams in Scrum so wichtig und warum kann es keine Manager geben?</a></li>
<li><a href="../de479478/index.html">Java-Plug-In ohne Schmerzen</a></li>
<li><a href="../de479480/index.html">SARIF SDK und seine Fehler</a></li>
<li><a href="../de479486/index.html">Heterogene Programmierung und oneAPI Toolkit. Der improvisierte Vortrag von Intel-Experten beantwortet Ihre Fragen</a></li>
<li><a href="../de479488/index.html">Von einem Laptop - ein Heimserver mit redundanter Stromversorgung f√ºr den Mikrotik-Router</a></li>
<li><a href="../de479492/index.html">Serverloses Rechnen basierend auf OpenWhisk, Teil 3</a></li>
<li><a href="../de479496/index.html">Analysieren von WTF-Aufgaben in JavaScript</a></li>
<li><a href="../de479498/index.html">Wie aus linearer Zeit Windows in O (n¬≤) wird</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>