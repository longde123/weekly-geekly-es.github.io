<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ üÜò üë®üèæ‚Äçüéì Angular 9 et Ivy: chargement de composants paresseux üë©üèΩ‚Äçüè≠ üë©üèΩ‚Äç‚öñÔ∏è ‚ôäÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chargement de composants paresseux dans Angular? Peut-√™tre que nous parlons de modules de chargement paresseux utilisant le routeur angulaire? Non, no...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Angular 9 et Ivy: chargement de composants paresseux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ruvds/blog/484618/">  Chargement de composants paresseux dans Angular?  Peut-√™tre que nous parlons de modules de chargement paresseux utilisant le routeur angulaire?  Non, nous parlons des composants.  La version actuelle d'Angular ne prend en charge que le chargement de module paresseux.  Mais Ivy donne au d√©veloppeur de nouvelles opportunit√©s pour travailler avec des composants. <br><br> <a href="https://habr.com/ru/company/ruvds/blog/484618/"><img src="https://habrastorage.org/webt/ox/8d/ub/ox8dubshhrdlijoson4_gyjtarw.png"></a> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">La charge paresseuse que nous avons utilis√©e jusqu'√† pr√©sent: les routes</font> </h2><br>  Le chargement paresseux est un excellent m√©canisme.  Dans Angular, vous pouvez utiliser ce m√©canisme sans avoir √† faire presque aucun effort en d√©clarant des itin√©raires qui prennent en charge le chargement paresseux.  Voici un exemple de la <a href="https://angular.io/guide/lazy-loading-ngmodules">documentation</a> Angular <a href="https://angular.io/guide/lazy-loading-ngmodules">qui le</a> d√©montre: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> routes: Routes = [     { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">'customer-list'</span></span>,       <span class="hljs-attr"><span class="hljs-attr">loadChildren</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./customers/customers.module'</span></span>).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">m</span></span></span><span class="hljs-function"> =&gt;</span></span> m.CustomersModule) }     ];</code> </pre> <br>  Gr√¢ce au code ci-dessus, un fragment s√©par√© pour le <code>customers.module</code> sera cr√©√©, qui sera charg√© lorsque l'utilisateur naviguera le long de l'itin√©raire de la <code>customer-list</code> des <code>customer-list</code> . <br><br>  C'est un tr√®s bon moyen de r√©duire la taille du bundle principal du projet et d'acc√©l√©rer le chargement initial de l'application. <br><br>  Mais malgr√© cela, ne serait-il pas agr√©able de pouvoir contr√¥ler plus pr√©cis√©ment le chargement paresseux?  Par exemple, que faire si nous pouvions organiser le chargement paresseux de composants individuels? <br><br>  Jusqu'√† pr√©sent, cela n'a pas √©t√© possible.  Mais tout a chang√© avec l'av√®nement d'Ivy. <br><br><h2>  <font color="#3AC1EF">Ivy et le concept de "localit√©"</font> </h2><br>  Les modules sont le concept de base et le bloc de construction de base de chaque application angulaire.  Les modules d√©clarent des composants, des directives, des tuyaux, des services. <br><br>  Une application angulaire moderne ne peut exister sans modules.  Une des raisons √† cela est le fait que ViewEngine ajoute toutes les m√©tadonn√©es n√©cessaires aux modules. <br><br>  Ivy, en revanche, adopte une approche diff√©rente.  Dans Ivy, un composant peut exister sans module.  Cela est possible gr√¢ce au concept de localit√©.  Son essence est que toutes les m√©tadonn√©es sont locales au composant. <br><br>  Expliquons cela en analysant le bundle es2015 g√©n√©r√© √† l'aide d'Ivy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/02b/775/370/02b7753703a0599491c3f9076527168f.png"></div><br>  <i><font color="#999999">Ensemble Es2015 g√©n√©r√© √† l'aide de Ivy</font></i> <br><br>  Dans la section <code>Component code</code> du <code>Component code</code> , vous pouvez voir que le syst√®me Ivy a enregistr√© le code du composant.  Il n'y a rien de sp√©cial ici.  Mais Ivy ajoute ensuite des m√©tadonn√©es au code. <br><br>  La premi√®re partie des m√©tadonn√©es est repr√©sent√©e sur la figure comme une <code>Component factory</code> .  L'usine sait instancier un composant.  Dans la section <code>Component metadata</code> du <code>Component metadata</code> , Ivy place des attributs suppl√©mentaires, tels que le <code>type</code> et les <code>selectors</code> , c'est-√†-dire tout ce dont le composant a besoin pendant l'ex√©cution du programme. <br><br>  Il convient de mentionner qu'Ivy ajoute ici la fonction de <code>template</code> .  Il est affich√© dans la <code>Compiled version of your template</code> section de <code>Compiled version of your template</code> .  Arr√™tons-nous plus en d√©tail sur ce fait int√©ressant. <br><br>  La fonction <code>template</code> est une version compil√©e de notre code HTML.  Elle suit les instructions Ivy pour cr√©er un DOM.  Ceci est diff√©rent du fonctionnement de ViewEngine. <br><br>  Le syst√®me ViewEngine prend le code et le contourne.  Angular ex√©cutera alors le code si nous l'utilisons. <br><br>  Et avec l'approche utilis√©e par Ivy, le composant qui invoque les commandes angulaires est en charge de tout.  Cette modification permet aux composants d'exister ind√©pendamment, ce qui conduit au fait que l'algorithme de tremblement d'arbre peut √™tre appliqu√© au code de base angulaire. <br><br><h2>  <font color="#3AC1EF">Un vrai exemple de chargement de composants paresseux</font> </h2><br>  Maintenant que nous savons que le chargement de composants paresseux est possible, consid√©rons-le avec un exemple r√©el.  √Ä savoir, nous allons cr√©er une application Quiz qui pose des questions √† l'utilisateur avec des options de r√©ponse. <br><br>  L'application affiche une image de la ville et des options √† partir desquelles vous devez choisir le nom de cette ville.  D√®s que l'utilisateur s√©lectionne une option en cliquant sur le bouton correspondant, ce bouton change imm√©diatement, indiquant si la r√©ponse √©tait bonne ou mauvaise.  Si l'arri√®re-plan du bouton devient vert, la r√©ponse √©tait correcte.  Si l'arri√®re-plan devient rouge, cela signifie que la r√©ponse √©tait incorrecte. <br><br>  Une fois la r√©ponse √† la question en cours re√ßue, le programme affiche la question suivante.  Voici √† quoi √ßa ressemble. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fc/768/ece/2fc768ecebd5c52399030c0d2dc47c66.gif"></div><br>  <i><font color="#999999">D√©mo du quiz</font></i> <br><br>  Les questions que le programme pose √† l'utilisateur sont repr√©sent√©es par le composant <code>QuizCardComponent</code> . <br><br><h2>  <font color="#3AC1EF">Concept de chargement de composants paresseux</font> </h2><br>  Illustrons d'abord l'id√©e g√©n√©rale du chargement paresseux du composant <code>QuizCardComponent</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ab/45a/b2b/4ab45ab2b677ce0d886d2f26a5645edb.png"></div><br>  <i><font color="#999999">Le processus du composant QuizCardComponent</font></i> <br><br>  Apr√®s que l'utilisateur a commenc√© le quiz en cliquant sur le bouton <code>Start quiz</code> , nous commen√ßons le chargement paresseux du composant.  Une fois le composant √† notre disposition, nous le pla√ßons dans un conteneur. <br><br>  Nous r√©agissons aux √©v√©nements <code>questionAnsvered</code> d'un composant ¬´paresseux¬ª de la m√™me mani√®re que nous r√©agirions aux √©v√©nements d'un composant r√©gulier.  √Ä savoir, apr√®s l'occurrence de l'√©v√©nement, nous affichons √† l'√©cran la prochaine carte avec la question. <br><br><h2>  <font color="#3AC1EF">Analyse de code</font> </h2><br>  Afin de comprendre ce qui se passe lors du chargement paresseux d'un composant, nous commen√ßons par une version simplifi√©e de <code>QuizCardComponent</code> , qui affiche les propri√©t√©s de la question. <br><br>  Ensuite, nous d√©velopperons ce composant en utilisant des composants de mat√©riau angulaire.  Et √† la fin, nous ajusterons la r√©action aux √©v√©nements g√©n√©r√©s par le composant. <br><br>  <code>QuizCardComponent</code> le chargement paresseux d'une version simplifi√©e du composant <code>QuizCardComponent</code> , qui a le mod√®le suivant: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Here's the question<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Image: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.image }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Possible selections: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.possibleSelections.toString() }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>Correct answer: <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> {{ question.correctAnswer }}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  La premi√®re √©tape consiste √† cr√©er un √©l√©ment conteneur.  Pour ce faire, nous pouvons soit utiliser un √©l√©ment r√©el, comme <code>&lt;div&gt;</code> , ou - recourir √† <code>ng-container</code> , ce qui nous permet de nous passer d'un niveau suppl√©mentaire de code HTML.  Voici √† quoi ressemble la d√©claration de l'√©l√©ment conteneur dans laquelle nous pla√ßons le composant ¬´paresseux¬ª: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-toolbar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>City quiz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-toolbar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngIf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!quizStarted"</span></span></span><span class="hljs-tag">        </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-raised-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">        </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start-quiz-button"</span></span></span><span class="hljs-tag">        (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"startQuiz()"</span></span></span><span class="hljs-tag">&gt;</span></span>Start quiz<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ng-container</span></span></span><span class="hljs-tag"> #</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">quizContainer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-card-container"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ng-container</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Dans le composant, vous devez acc√©der au conteneur.  Pour ce faire, nous utilisons l'annotation <code>@ViewChild</code> et nous faisons savoir que nous voulons lire <code>ViewContainerRef</code> . <br><br>  Notez que dans Angular 9, la propri√©t√© <code>static</code> dans l'annotation <code>@ViewChild</code> est d√©finie sur <code>false</code> par d√©faut: <br><br><pre> <code class="javascript hljs">@ViewChild(<span class="hljs-string"><span class="hljs-string">'quizContainer'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">read</span></span>: ViewContainerRef}) quizContainer: ViewContainerRef;</code> </pre> <br>  Nous avons maintenant un conteneur dans lequel nous voulons ajouter le composant "paresseux".  Ensuite, nous avons besoin de <code>ComponentFactoryResolver</code> et <code>Injector</code> .  Les deux peuvent √™tre acquis en recourant √† la m√©thodologie de l'injection de d√©pendance. <br><br>  L'entit√© <code>ComponentFactoryResolver</code> est un simple registre qui √©tablit la relation entre les composants et les classes <code>ComponentFactory</code> g√©n√©r√©es automatiquement qui peuvent √™tre utilis√©es pour instancier des composants: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private quizservice: QuizService,            private cfr: ComponentFactoryResolver,            private injector: Injector) { }</code> </pre> <br>  Nous avons maintenant tout ce qui est n√©cessaire pour atteindre l'objectif.  Travaillons sur le contenu de la m√©thode <code>startQuiz</code> et organisons le chargement paresseux du composant: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {QuizCardComponent} = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>(<span class="hljs-string"><span class="hljs-string">'./quiz-card/quiz-card.component'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> quizCardFactory = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cfr.resolveComponentFactory(QuizCardComponent); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {instance} = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quizContainer.createComponent(quizCardFactory, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.injector); instance.question = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.quizservice.getNextQuestion();</code> </pre> <br>  Nous pouvons utiliser la commande <code>import</code> ECMAScript pour organiser le chargement paresseux de <code>QuizCardComponent</code> .  Une expression d'importation renvoie une promesse.  Vous pouvez travailler avec lui soit en utilisant la construction <code>async/await</code> <code>.then</code> soit en utilisant le gestionnaire <code>.then</code> .  Apr√®s avoir r√©solu la promesse, nous utilisons la d√©structuration pour cr√©er une instance du composant. <br><br>  De nos jours, vous devez utiliser <code>ComponentFactory</code> pour fournir une compatibilit√© descendante.  √Ä l'avenir, la ligne correspondante n'est plus n√©cessaire, car nous pourrons travailler directement avec le composant. <br><br>  L'usine <code>ComponentFactory</code> nous donne <code>componentRef</code> .  Nous passons <code>componentRef</code> et <code>Injector</code> √† la m√©thode <code>createComponent</code> du conteneur. <br><br>  La m√©thode <code>createComponent</code> renvoie un <code>ComponentRef</code> o√π l'instance de composant est contenue.  Nous utilisons l' <code>instance</code> pour transmettre les <code>@Input</code> du composant <code>@Input</code> . <br><br>  √Ä l'avenir, tout cela peut probablement √™tre fait en utilisant la m√©thode Angular <code>renderComponent</code> .  Cette m√©thode est encore exp√©rimentale.  Cependant, il est tr√®s probable que cela deviendra une m√©thode angulaire r√©guli√®re.  <a href="https://github.com/LayZeeDK/ivy-dynamic-rendering">Voici</a> des documents utiles sur ce sujet. <br><br>  C'est tout ce qui est n√©cessaire pour organiser le chargement paresseux d'un composant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d4/2bd/4bc/2d42bd4bc38ee01c427c94286e060cbb.png"></div><br>  <i><font color="#999999">Chargement de composants paresseux</font></i> <br><br>  Apr√®s avoir appuy√© <code>Start quiz</code> bouton <code>Start quiz</code> , le chargement paresseux du composant commence.  Si vous ouvrez l'onglet <code>Network</code> des outils de d√©veloppement, vous pouvez voir le processus de chargement paresseux du fragment de code repr√©sent√© par le fichier <code>quiz-card-quiz-card-component.js</code> .  Apr√®s le chargement et le traitement du composant est affich√©, l'utilisateur voit une carte de question. <br><br><h2>  <font color="#3AC1EF">Extension de composant</font> </h2><br>  Nous <code>QuizCardComponent</code> actuellement le composant <code>QuizCardComponent</code> .  C‚Äôest tr√®s bien.  Mais notre application n'est pas encore particuli√®rement fonctionnelle. <br><br>  Corrigeons cela en y ajoutant des fonctionnalit√©s et des composants suppl√©mentaires de mat√©riau angulaire: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-card"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-header</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-card-avatar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"quiz-header-image"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-title</span></span></span><span class="hljs-tag">&gt;</span></span>Which city is this?<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-title</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-subtitle</span></span></span><span class="hljs-tag">&gt;</span></span>Click on the correct answer below<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-subtitle</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-header</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-card-image</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'assets/' + question.image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">alt</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Photo of a Shiba Inu"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-actions</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answer-section"</span></span></span><span class="hljs-tag">&gt;</span></span>    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">disabled</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answeredCorrectly !== undefined"</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let selection of question.possibleSelections"</span></span></span><span class="hljs-tag">            </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mat-stroked-button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primary"</span></span></span><span class="hljs-tag">            [</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngClass</span></span></span><span class="hljs-tag">]=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{              'correct': answeredCorrectly &amp;&amp; selection === question.correctAnswer,              'wrong': answeredCorrectly === false &amp;&amp; selection === question.correctAnswer             }"</span></span></span><span class="hljs-tag">            (</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">)=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"answer(selection)"</span></span></span><span class="hljs-tag">&gt;</span></span>      {{selection}}    <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card-actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mat-card</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Nous avons inclus de beaux composants mat√©riels dans le composant.  Et les modules correspondants? <br><br>  Ils peuvent bien s√ªr √™tre ajout√©s √† l' <code>AppModule</code> .  Mais cela signifie que ces modules se chargeront en mode "gourmand".  Et ce n'est pas une bonne id√©e.  De plus, l'assemblage du projet √©chouera, avec le message suivant: <br><br><pre> <code class="javascript hljs">ERROR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> src/app/quiz-card/quiz-card.component.html:<span class="hljs-number"><span class="hljs-number">9</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span> - error TS<span class="hljs-number"><span class="hljs-number">-998001</span></span>: <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is not a known element: <span class="hljs-number"><span class="hljs-number">1.</span></span> If <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is an Angular component, then verify that it is part <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>. <span class="hljs-number"><span class="hljs-number">2.</span></span> If <span class="hljs-string"><span class="hljs-string">'mat-card'</span></span> is a Web Component then add <span class="hljs-string"><span class="hljs-string">'CUSTOM_ELEMENTS_SCHEMA'</span></span> to the <span class="hljs-string"><span class="hljs-string">'@NgModule.schemas'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> component to suppress <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> message.</code> </pre> <br>  Que faire  Comme vous l'avez probablement d√©j√† compris, ce probl√®me est compl√®tement r√©soluble.  Cela peut √™tre fait √† l'aide de modules. <br><br>  Mais cette fois, nous les utiliserons un peu diff√©remment qu'auparavant.  Nous allons ajouter un petit module dans le m√™me fichier que <code>QuizCardComponent</code> (dans le fichier <code>quizcard.component.ts</code> ): <br><br><pre> <code class="javascript hljs">@NgModule({  <span class="hljs-attr"><span class="hljs-attr">declarations</span></span>: [QuizCardComponent],  <span class="hljs-attr"><span class="hljs-attr">imports</span></span>: [CommonModule, MatCardModule, MatButtonModule] }) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QuizCardModule</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Notez qu'il n'y a pas de d√©claration d' <code>export</code> . <br><br>  Cette sp√©cification de module appartient exclusivement √† notre composant, charg√© en mode paresseux.  Par cons√©quent, le seul composant d√©clar√© dans le module sera <code>QuizCardComponent</code> .  La section d'importation importe uniquement les modules dont notre composant a besoin. <br><br>  Nous n'exportons pas le nouveau module afin que les modules charg√©s en mode gourmand ne puissent pas l'importer. <br><br>  Red√©marrez l'application et regardez comment elle se comporte lorsque vous cliquez sur le <code> Start quiz</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/bc5/4bf/c60/bc54bfc6057cc6707e4f01a5bf871de9.png"></div><br>  <i><font color="#999999">Analyse d'application modifi√©e</font></i> <br><br>  Super!  Le composant <code>QuizCardComponent</code> charg√© en mode <code>ViewContainer</code> et ajout√© au <code>ViewContainer</code> .  Toutes les d√©pendances n√©cessaires en sont charg√©es. <br><br>  Nous analyserons le bundle d'application √† l'aide de l' <code>webpack-bundle-analyze</code> fourni par le module npm correspondant.  Il vous permet de visualiser le contenu des fichiers produits par Webpack et d'examiner le sch√©ma r√©sultant. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d2a/a5a/2aa/d2aa5a2aae380755aca3872db6d068f9.png"></div><br>  <i><font color="#999999">Analyse du bundle d'applications</font></i> <br><br>  La taille du bundle principal de l'application est d'environ 260 Ko.  Si nous t√©l√©chargions le composant <code>QuizCardComponent</code> avec lui, la taille des donn√©es t√©l√©charg√©es serait d'environ 270 Ko.  Il s'av√®re que nous avons pu r√©duire la taille du paquet principal de 10 Ko, en ne chargeant qu'un seul composant en mode paresseux.  Bon r√©sultat! <br><br>  Le code de <code>QuizCardComponent</code> apr√®s l'assemblage obtient un fichier s√©par√©.  Si vous analysez le contenu de ce fichier, il s'av√®re qu'il n'y a pas seulement le code <code>QuizCardComponent</code> , mais aussi les modules Material utilis√©s dans ce composant. <br><br>  M√™me si <code>QuizCardComponent</code> utilise <code>MatButtonModule</code> et <code>MatCardModule</code> , seul <code>MatCardModule</code> p√©n√®tre dans le <code>MatCardModule</code> code fini.  La raison en est que nous utilisons √©galement le <code>MatButtonModule</code> dans l' <code>AppModule</code> , affichant le bouton <code>Start quiz</code> .  En cons√©quence, le code correspondant tombe dans un autre fragment du bundle. <br><br>  Nous avons maintenant organis√© le chargement paresseux de <code>QuizCardComponent</code> .  Ce composant affiche une carte, con√ßue dans le style du mat√©riel, contenant une image, une question et des boutons avec des options de r√©ponse.  Que se passe-t-il maintenant si vous cliquez sur l'un de ces boutons? <br><br>  Le bouton, selon qu'il contient la bonne ou la mauvaise r√©ponse, devient vert ou rouge lorsqu'il est enfonc√©.  Que se passe-t-il d'autre?  Rien.  Et nous avons besoin qu'apr√®s avoir r√©pondu √† une question, une carte d'une autre question soit affich√©e.  R√©parez-le. <br><br><h2>  <font color="#3AC1EF">Gestion des √©v√©nements</font> </h2><br>  L'application n'affiche pas de nouvelle carte de question lorsque vous cliquez sur le bouton de r√©ponse car nous n'avons pas encore mis en place de m√©canismes pour r√©pondre aux √©v√©nements des composants charg√©s en mode paresseux.  Nous savons d√©j√† que le composant <code>QuizCardComponent</code> g√©n√®re des √©v√©nements √† l'aide de <code>EventEmitter</code> .  Si vous regardez la d√©finition de la classe <code>EventEmitter</code> , vous pouvez d√©couvrir qu'il s'agit d'un descendant de <code>Subject</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> declare <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EventEmitter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">any</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Subject</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre> <br>  Cela signifie que <code>EventEmitter</code> a une m√©thode d' <code>subscribe</code> , qui vous permet de configurer la r√©ponse du syst√®me aux √©v√©nements qui se produisent: <br><br><pre> <code class="javascript hljs">instance.questionAnswered.pipe(    takeUntil(instance.destroy$) ).subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showNewQuestion());</code> </pre> <br>  Ici, nous nous <code>showNextQuestion</code> au flux <code>questionAnswered</code> et appelons la m√©thode <code>showNextQuestion</code> , qui ex√©cute la logique <code>lazyLoadQuizCard</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">async</span></span> showNewQuestion() {  <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.lazyLoadQuizCard(); }</code> </pre> <br>  La construction <code>takeUntil(instance.destroy$)</code> est n√©cessaire pour effacer l'abonnement qui est ex√©cut√© apr√®s la destruction du composant.  Si le hook <code>ngOnDestroy</code> du cycle de vie du composant <code>ngOnDestroy</code> est appel√©, <code>destroy$</code> est appel√© avec <code>next</code> et <code>complete</code> . <br><br>  Le composant √©tant d√©j√† charg√©, le syst√®me n'effectue pas de requ√™te HTTP suppl√©mentaire.  Nous utilisons le contenu du fragment de code que nous avons d√©j√†, cr√©ons un nouveau composant et le mettons dans le conteneur. <br><br><h2>  <font color="#3AC1EF">Crochets de cycle de vie des composants</font> </h2><br>  Presque tous les crochets du cycle de vie des composants sont automatiquement appel√©s lorsque vous travaillez avec le composant <code>QuizCardComponent</code> √† l'aide de la technique de chargement paresseux.  Mais un crochet ne suffit pas.  Pouvez-vous comprendre lequel? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ceb/4f7/b2a/ceb4f7b2a34bbed6ced31f69713e4f68.png"></div><br>  <i><font color="#999999">Crochets de cycle de vie des composants</font></i> <br><br>  C'est le <code>ngOnChanges</code> plus important de <code>ngOnChanges</code> .  Puisque nous mettons nous-m√™mes √† jour les propri√©t√©s d'entr√©e de l'instance de composant, nous sommes √©galement responsables de l'appel du <code>ngOnChanges</code> cycle de vie <code>ngOnChanges</code> . <br><br>  Pour appeler le hook <code>ngOnChanges</code> de l'instance de <code>ngOnChanges</code> , vous devez construire vous-m√™me un objet <code>SimpleChange</code> : <br><br><pre> <code class="javascript hljs">(instance <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> any).ngOnChanges({    <span class="hljs-attr"><span class="hljs-attr">question</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleChange(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, instance.question, <span class="hljs-literal"><span class="hljs-literal">true</span></span>) });</code> </pre> <br>  Nous appelons manuellement <code>ngOnChanges</code> instance de composant et lui passons un objet <code>SimpleChange</code> .  Cet objet indique que cette modification est la premi√®re, que la valeur pr√©c√©dente est <code>null</code> et que la valeur actuelle est une question. <br><br>  Super!  Nous avons charg√© le composant avec des modules tiers, r√©pondu aux √©v√©nements qu'il a g√©n√©r√©s et configur√© l'appel des hooks n√©cessaires du cycle de vie du composant. <br><br>  <a href="https://github.com/kreuzerk/city-quiz">Voici le</a> code source du projet fini sur lequel nous travaillions ici. <br><br><h2>  <font color="#3AC1EF">R√©sum√©</font> </h2><br>  Le chargement de composants paresseux offre aux d√©veloppeurs Angular de grandes opportunit√©s pour optimiser les performances des applications.  √Ä sa disposition se trouvent les outils pour affiner tr√®s finement la composition des mat√©riaux charg√©s en mode paresseux.  Auparavant, lorsqu'il √©tait possible de charger uniquement des itin√©raires en mode paresseux, nous n'avions pas une telle pr√©cision. <br><br>  Malheureusement, lorsque vous utilisez des modules tiers dans le composant, nous devons √©galement prendre soin des modules.  Cependant, il convient de rappeler qu'√† l'avenir, cela pourrait changer. <br><br>  Le moteur Ivy a introduit le concept de localit√©, gr√¢ce auquel les composants peuvent exister ind√©pendamment.  Ce changement est le fondement de l'avenir d'Angular. <br><br>  <b>Chers lecteurs!</b>  Envisagez-vous d'utiliser la technique de chargement de composants paresseux dans vos projets Angular? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484618/">https://habr.com/ru/post/fr484618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484604/index.html">Nouvelle ann√©e, nouveau navigateur: Microsoft Edge hors de l'√©valuation pr√©liminaire et maintenant disponible en t√©l√©chargement</a></li>
<li><a href="../fr484610/index.html">Au revoir le code propre</a></li>
<li><a href="../fr484612/index.html">Optimisation du temps de construction du projet</a></li>
<li><a href="../fr484614/index.html">6 recommandations pour d√©velopper des applications Go s√©curis√©es</a></li>
<li><a href="../fr484616/index.html">6 le√ßons tir√©es de l'exp√©rience d'optimisation des performances du service Node.js</a></li>
<li><a href="../fr484620/index.html">Nouveau rendu graphique PS1 pour l'√©mulateur Omega Red</a></li>
<li><a href="../fr484624/index.html">Mod√®les de je√ªne √† intervalle et d'extension de la dur√©e de vie</a></li>
<li><a href="../fr484628/index.html">Eric Ciaramella comme exemple de censure sur Wikipedia / Google</a></li>
<li><a href="../fr484630/index.html">CES 2020: il est temps de surprendre</a></li>
<li><a href="../fr484634/index.html">Node.js VS Python: quel est le meilleur?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>