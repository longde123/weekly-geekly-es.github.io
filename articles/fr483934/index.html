<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèæ üèè ‚åöÔ∏è Autorisations de fichiers Linux üèîÔ∏è üë©‚Äçüéì ‚ò†Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour √† tous. Nous nous joignons activement aux travaux et en janvier, nous pr√©parons de nombreux lancements puissants. Entre autres, un ensemble a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Autorisations de fichiers Linux</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/otus/blog/483934/">  <i>Bonjour √† tous.</i>  <i>Nous nous joignons activement aux travaux et en janvier, nous pr√©parons de nombreux lancements puissants.</i>  <i>Entre autres, un ensemble a √©t√© annonc√© pour un nouveau flux du cours <a href="https://otus.pw/rbVT/">Administrateur Linux</a> que tout le monde aime.</i>  <i>En pr√©vision du lancement, nous partageons traditionnellement la traduction de mat√©riel utile.</i> <br><br><img src="https://habrastorage.org/webt/tx/al/mo/txalmou0on51si-w3_nicm-3ovo.png"><br><hr><br><blockquote>  <i>Les autorisations de fichiers offrent une alternative s√ªre aux ex√©cutables SUID, mais elles peuvent sembler un peu d√©routantes au premier abord.</i> </blockquote><a name="habracut"></a><br>  Nous savons tous que les binaires <a href="http://en.wikipedia.org/wiki/Setuid">SUID</a> sont une <a href="http://en.wikipedia.org/wiki/Setuid">mauvaise solution de s√©curit√©</a> .  Heureusement, si votre application n√©cessite des privil√®ges limit√©s, il existe un moyen plus efficace appel√© <a href="http://www.linuxjournal.com/article/5737">autorisations de fichiers</a> . <br><br>  Je vous ferai gagner du temps si vous voulez √©viter une lecture d√©taill√©e de l'article ci-dessus: en substance, les autorisations de fichiers autorisent les processus qui s'ex√©cutent en tant que root et, par cons√©quent, ont le droit de faire quelque chose, pour enregistrer certaines fonctionnalit√©s limit√©es par <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/capabilities.7.html">cette liste</a> quand elles r√©initialiser les privil√®ges et ex√©cuter en tant qu'utilisateur non privil√©gi√©.  Cela signifie que si un attaquant parvient √† compromettre un processus en d√©bordant d'un tampon ou d'un autre exploit, il ne pourra pas profiter d'autre chose que de certains privil√®ges minimaux dont le processus a r√©ellement besoin. <br><br>  Les autorisations sont id√©ales pour les services qui s'ex√©cutent g√©n√©ralement en tant que root, mais qu'en est-il des utilitaires de ligne de commande?  Heureusement, cela est √©galement pris en charge √† condition que les utilitaires corrects soient install√©s.  Si vous utilisez Ubuntu, par exemple, vous aurez besoin du <code>libcap2-bin</code> .  Vous devrez √©galement ex√©cuter un noyau non archa√Øque (√† partir de la version <b>2.6.24</b> ). <br><br>  Ces fonctions vous permettent d'associer des autorisations √† des fichiers ex√©cutables de la m√™me mani√®re que la d√©finition du bit SUID, mais uniquement pour un ensemble sp√©cifique d'autorisations.  L'utilitaire <code>setcap</code> utilis√© pour ajouter et supprimer des autorisations d'un fichier. <br><br>  La premi√®re √©tape consiste √† s√©lectionner les autorisations dont vous avez besoin.  Pour cet article, je suppose qu'il existe un outil de diagnostic r√©seau appel√© <code>tracewalk</code> qui devrait pouvoir utiliser <a href="http://man7.org/linux/man-pages/man7/raw.7.html">des sockets bruts</a> .  Cela n√©cessite g√©n√©ralement que l'application soit ex√©cut√©e en tant que root, mais lors de l'affichage de la <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/capabilities.7.html">liste,</a> il s'av√®re que seule l'autorisation <code>CAP_NET_RAW</code> est <code>CAP_NET_RAW</code> . <br><br>  En supposant que vous √™tes dans le r√©pertoire o√π se trouve le binaire <code>tracewalk</code> , vous pouvez ajouter cette autorisation comme suit: <br><br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> cap_net_raw=eip tracewalk</code> </pre> <br>  Pour l'instant, ignorez le suffixe <code>=eip</code> pour la permission, je vais en parler dans quelques secondes.  Veuillez noter que le nom de l'autorisation est en minuscules.  Vous pouvez maintenant v√©rifier si vous avez correctement configur√© les autorisations avec: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> -v cap_new_raw=eip tracewalk</code> </pre> <br>  Ou vous pouvez r√©pertorier toutes les autorisations d√©finies pour ce fichier ex√©cutable: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">getcap</span></span> tracewalk</code> </pre><br>  Pour r√©f√©rence, vous pouvez √©galement supprimer toutes les autorisations de l'ex√©cutable en utilisant: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> -r tracewalk</code> </pre> <br>  √Ä ce stade, vous devriez √™tre en mesure d'ex√©cuter l'ex√©cutable en tant qu'utilisateur non privil√©gi√©, et il devrait √™tre en mesure de travailler avec des sockets bruts, mais ne pas avoir d'autres privil√®ges que l'utilisateur root. <br><br>  Alors, que signifie ce suffixe √©trange <code>=eip</code> ?  Cela n√©cessitera un peu de compr√©hension de la nature des autorisations.  Chaque processus poss√®de trois ensembles d'autorisations - <i>effectifs, h√©ritables et autoris√©s (effectifs, h√©ritables et autoris√©s)</i> : <br><br><ul><li>  <b>Les</b> autorisations <b>effectives</b> sont celles qui d√©terminent ce qu'un processus peut r√©ellement faire.  Par exemple, il ne peut pas traiter les sockets bruts si <code>CAP_NET_RAW</code> pas dans un ensemble efficace. </li><li>  <b>Les</b> autorisations <b>autoris√©es</b> sont celles qu'un processus est autoris√© √† avoir s'il les demande via un appel appropri√©.  Ils ne permettent pas √† un processus de faire quoi que ce soit, sauf s'il a √©t√© sp√©cifiquement √©crit pour demander l'autorisation sp√©cifi√©e.  Cela vous permet d'√©crire des processus pour ajouter des autorisations critiques √† l'ensemble effectif uniquement pour la p√©riode o√π ils sont vraiment n√©cessaires. </li><li>  <b>Les</b> autorisations <b>h√©ritables</b> sont celles qui peuvent √™tre h√©rit√©es dans la collection disponible du processus enfant.  Pendant l'op√©ration <code>fork()</code> ou <code>clone()</code> , le processus enfant re√ßoit toujours une copie des autorisations du processus parent, car √† ce moment il ex√©cute toujours le m√™me fichier ex√©cutable.  Un ensemble h√©rit√© est utilis√© lorsque <code>exec()</code> (ou un √©quivalent) est appel√© pour remplacer l'ex√©cutable par un autre.  √Ä ce stade, l'ensemble de processus disponible est masqu√© par l'ensemble h√©rit√© pour obtenir l'ensemble disponible qui sera utilis√© pour le nouveau processus. </li></ul><br>  Ainsi, l'utilitaire <code>setcap</code> nous permet d'ajouter des autorisations de ces trois ensembles ind√©pendamment pour un fichier ex√©cutable donn√©.  Notez que la signification des groupes est interpr√©t√©e un peu diff√©remment pour les autorisations de fichier: <br><br><ul><li>  <b>Les</b> autorisations de fichier <b>disponibles</b> sont celles qui sont toujours disponibles pour l'ex√©cutable, m√™me si le processus parent qui l'a appel√© ne les avait pas.  Auparavant, ils √©taient appel√©s autorisations "forc√©es". </li><li>  <b>Les</b> autorisations de fichiers <b>h√©rit√©es</b> d√©finissent un masque suppl√©mentaire qui peut √©galement √™tre utilis√© pour supprimer les autorisations de l'ensemble du processus appelant.  Ils sont utilis√©s en plus de l'ensemble h√©rit√© du processus appelant, donc l'autorisation n'est h√©rit√©e que si elle existe dans les deux ensembles. </li><li>  <b>Les</b> autorisations de fichiers <b>efficaces</b> ne sont en fait qu'un seul bit, pas un ensemble, et s'il est install√©, cela signifie que l'ensemble complet disponible est √©galement copi√© dans l'ensemble effectif du nouveau processus.  Cela peut √™tre utilis√© pour ajouter des autorisations √† des processus qui n'ont pas √©t√© sp√©cifiquement √©crits pour les demander.  Comme il s'agit d'un bit, si vous le d√©finissez pour une autorisation, il doit √™tre d√©fini pour toutes les autorisations.  Vous pouvez le consid√©rer comme un bit h√©rit√© car il est utilis√© pour autoriser les autorisations pour les applications qui ne les prennent pas en charge. </li></ul><br>  Lorsque vous sp√©cifiez des autorisations via <code>setcap</code> trois lettres <code>e</code> , <code>i</code> et <code>p</code> font respectivement r√©f√©rence √† des ensembles <i>efficaces, h√©rit√©s et accessibles</i> .  Donc, une sp√©cification ant√©rieure: <br><br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> cap_net_raw=eip tracewalk</code> </pre> <br>  ... indique que l'autorisation <code>CAP_NET_RAW</code> doit √™tre ajout√©e aux ensembles disponibles et h√©rit√©s et que le bit effectif doit √©galement √™tre d√©fini.  Cela remplacera toutes les autorisations pr√©c√©demment d√©finies dans le fichier.  Pour d√©finir plusieurs autorisations √† la fois, utilisez une liste s√©par√©e par des virgules: <br><br><pre> <code class="bash hljs">sudo <span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> cap_net_admin,cap_net_raw=eip tracewalk</code> </pre> <br>  <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/capabilities.7.html">Le guide des autorisations</a> discute de tout cela plus en d√©tail, mais j'esp√®re que ce post a un peu d√©mystifi√© l'incident.  Il ne reste √† mentionner que quelques avertissements et astuces. <br><br>  Tout d'abord, les capacit√©s de fichier ne fonctionnent pas avec les liens symboliques - vous devez les appliquer au binaire lui-m√™me (c'est-√†-dire √† la cible du lien symbolique). <br><br>  Deuxi√®mement, ils ne fonctionnent pas avec des scripts interpr√©t√©s.  Par exemple, si vous disposez d'un script Python auquel vous souhaitez attribuer une autorisation, vous devez l'attribuer √† l'interpr√©teur Python lui-m√™me.  √âvidemment, c'est un probl√®me de s√©curit√© potentiel, car alors tous les scripts ex√©cut√©s avec cet interpr√®te auront l'autorisation sp√©cifi√©e, bien que ce soit encore mieux que de faire le SUID.  La solution de contournement la plus courante, apparemment, consiste √† √©crire un fichier ex√©cutable s√©par√© en C ou un analogue qui peut effectuer les op√©rations n√©cessaires et l'appeler √† partir d'un script.  Ceci est similaire √† l'approche utilis√©e par Wireshark, qui utilise le fichier binaire <code>/usr/bin/dumpcap</code> pour effectuer des op√©rations privil√©gi√©es: <br><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">getcap</span></span> /usr/bin/dumpcap /usr/bin/dumpcap = cap_net_admin,cap_net_raw+eip</code> </pre> <br>  Troisi√®mement, les autorisations de fichiers sont d√©sactiv√©es si vous utilisez la <code>LD_LIBRARY_PATH</code> environnement <code>LD_LIBRARY_PATH</code> pour des raisons de s√©curit√© √©videntes <i>(1)</i> .  La m√™me chose s'applique √† <code>LD_PRELOAD</code> , pour autant que je sache. <br><br>  <i>1. √âtant donn√© que l'attaquant peut √©videmment remplacer l'une des biblioth√®ques standard et utiliser <code>LD_LIBRARY_PATH</code> pour forcer sa biblioth√®que √† √™tre appel√©e de pr√©f√©rence sur le syst√®me, et donc avoir son propre code arbitraire ex√©cut√© avec les m√™mes privil√®ges que l'application appelante.</i> <i><br></i> <br><br>  <i><b>C‚Äôest tout.</b></i>  <i><b>Les d√©tails du programme du cours peuvent √™tre consult√©s lors du <a href="https://otus.pw/rbVT/">webinaire, qui se tiendra le 24 janvier.</a></b></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr483934/">https://habr.com/ru/post/fr483934/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr483916/index.html">DJI n'a pas √©t√© en mesure de patcher les applications DJI Fly pour Android 10 depuis un mois maintenant</a></li>
<li><a href="../fr483918/index.html">Formation en entreprise: les leaders enseignent aux leaders</a></li>
<li><a href="../fr483920/index.html">Chaos de d√©pendance Python</a></li>
<li><a href="../fr483922/index.html">Maison intelligente sur roues ... Alice</a></li>
<li><a href="../fr483930/index.html">6 projets de d√©veloppement Web GitHub qui valent le d√©tour</a></li>
<li><a href="../fr483936/index.html">Conf√©rence sur le d√©veloppement de jeux</a></li>
<li><a href="../fr483938/index.html">Nakamichi: √† propos des dieux de l'√®re de la cassette et des temps o√π le soleil levant brillait plus fort</a></li>
<li><a href="../fr483940/index.html">70 ans de st√©r√©otypes: comment vaincre la m√©fiance √† l'√©gard de l'Office du logement √† l'aide des technologies informatiques et am√©liorer la qualit√© de service</a></li>
<li><a href="../fr483944/index.html">Comment et pourquoi faire la queue sur deux piles</a></li>
<li><a href="../fr483946/index.html">GPU Bound. Deuxi√®me partie For√™t sans fin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>