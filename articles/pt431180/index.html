<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëáüèø üëÉüèΩ üè† JS ext no servidor ü§π üë®‚Äçüîß üßïüèº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quando se trata da biblioteca Ext JS, os especialistas ouviram bastante negatividade: pesado, caro, com erros. Como regra, a maioria dos problemas est...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JS ext no servidor</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/431180/"><img src="https://habrastorage.org/webt/wl/0h/yu/wl0hyunbvr2q-wqwydwamsfk804.png" width="250" align="left" alt="foto daqui https://github.com/tj/palette">  Quando se trata da biblioteca Ext JS, os especialistas ouviram bastante negatividade: pesado, caro, com erros.  Como regra, a maioria dos problemas est√° relacionada √† incapacidade de cozinh√°-lo.  Um projeto montado corretamente usando o Sencha Cmd com todos os css, as imagens pesam na produ√ß√£o na regi√£o de 1Mb, compar√°vel √† mesma Angular.  Sim, e falhas n√£o s√£o muito mais ... <br><br>  A ideia de Sencha pode ser tratada de maneira diferente, mas mesmo seus oponentes de princ√≠pios admitem que √© dif√≠cil encontrar a melhor solu√ß√£o para a cria√ß√£o de projetos s√©rios na intranet. <br><br>  Na minha opini√£o, a coisa mais valiosa no Ext JS n√£o √© uma cole√ß√£o de componentes da interface do usu√°rio, mas uma boa arquitetura OOP.  Mesmo levando em considera√ß√£o o r√°pido desenvolvimento do JS nos √∫ltimos anos, muitas das coisas necess√°rias que foram implementadas no Ext JS h√° 7 anos ainda est√£o ausentes nas classes nativas (namespaces, mixins, propriedades est√°ticas, chamada conveniente dos m√©todos pai).  Isso foi o que me levou, h√° alguns anos, a experimentar o lan√ßamento das classes Ext JS no back-end.  Sobre os primeiros experimentos semelhantes, eu j√° fiz posts sobre Habr√©.  Este artigo descreve uma nova implementa√ß√£o de id√©ias antigas e v√°rias novas. <br><br>  Antes de come√ßar, aten√ß√£o √† pergunta: o que voc√™ acha, onde √© executado e o que o trecho de c√≥digo abaixo faz? <br><br><pre><code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Module.message.model.Message'</span></span>, { .... <span class="hljs-comment"><span class="hljs-comment">/* scope:server */</span></span> ,<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> newMessage() { ......... this.fireEvent(<span class="hljs-string"><span class="hljs-string">'newmessage'</span></span>, data); ...... } ... })</code> </pre> <a name="habracut"></a><br>  Esse c√≥digo √© executado no servidor e gera o evento "newmessage" em todas as inst√¢ncias da classe "Module.message.model.Message" em todas as m√°quinas clientes conectadas ao servidor. <br><br>  Para ilustrar as possibilidades de usar Ext JS do lado do servidor, analisaremos um projeto de bate-papo simples.  N√£o faremos nenhum login, apenas quando voc√™ digitar o usu√°rio digitar um apelido.  Voc√™ pode postar mensagens gerais ou privadas.  O bate-papo deve funcionar em tempo real.  Os interessados ‚Äã‚Äãpodem experimentar imediatamente toda essa economia nos neg√≥cios. <br><br><h2>  Instala√ß√£o </h2><br>  Para come√ßar, precisamos do nodejs 9+ e do redis-server (presume-se que eles j√° estejam instalados). <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/Kolbaskin/extjs-backend-example <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> extjs-backend-example npm i</code> </pre><br>  Iniciamos o servidor: <br><br><pre> <code class="bash hljs">node server</code> </pre><br>  No navegador, abra a p√°gina <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">localhost</a> : 3000 / www / auth / <br>  Digite um apelido e pressione enter. <br><br>  O projeto √© uma demonstra√ß√£o, portanto, n√£o h√° suporte para navegadores antigos (existem modelos ES8), use o novo Chrome ou FF. <br><br><h2>  Servidor </h2><br>  Vamos em ordem. <br><br>  C√≥digo do servidor (server.js) <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   http-  express //   Ext JS     express const express = require('express'); const staticSrv = require('extjs-express-static'); const app = express(); const bodyParser = require('body-parser'); //    global = { config: require('config') } //     Ext JS require('extjs-on-backend')({ //     express app, //         wsClient: 'Base.wsClient' }); //    Ext.Loader.setPath('Api', 'protected/rest'); Ext.Loader.setPath('Base', 'protected/base'); Ext.Loader.setPath('Www', 'protected/www'); //   http   app.use( bodyParser.json() ); app.use(bodyParser.urlencoded({ extended: true })); //     Ext JS  app.use('/api/auth', Ext.create('Api.auth.Main')); app.use('/www/auth', Ext.create('Www.login.controller.Login')); //    app.use(staticSrv(__dirname + '/static')); //   const server = app.listen(3000, () =&gt; { console.log('server is running at %s', server.address().port); });</span></span></code> </pre><br>  Como voc√™ pode ver, aqui tudo √© mais ou menos padr√£o para o servidor no express.  √â interessante a inclus√£o de classes Ext JS para servir as rotas correspondentes: <br><br><pre> <code class="javascript hljs">app.use(<span class="hljs-string"><span class="hljs-string">'/api/auth'</span></span>, Ext.create(<span class="hljs-string"><span class="hljs-string">'Api.auth.Main'</span></span>)); app.use(<span class="hljs-string"><span class="hljs-string">'/www/auth'</span></span>, Ext.create(<span class="hljs-string"><span class="hljs-string">'Www.login.controller.Login'</span></span>));</code> </pre><br><h3>  Implementa√ß√£o da API REST </h3><br>  A classe Api.auth.Main atende solicita√ß√µes √† API REST (protected / rest / auth / Main.js). <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Api.auth.Main'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Api.Base'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   //     routes: [ { path: '/', get: 'login'}, { path: '/restore', post: 'restoreLogin' }, { path: '/registration', post: 'newuser'}, { path: '/users', get: 'allUsers'} ] //     : // {query: &lt;...&gt;, params: &lt;...&gt;, body: &lt;...&gt;} ,async login(data) { return {data:[{ id:1, subject: 111, sender:222, }]} } ,async restoreLogin() { ... } ,async newuser() { ... } ,async allUsers() { .... } })</span></span></code> </pre><br><h3>  Gera√ß√£o de p√°gina HTML, usando XTemplate no servidor </h3><br>  A segunda classe, Www.login.controller.Login, cria uma p√°gina html comum com um formul√°rio de login (protected / www / login / controller / controller / Login.js). <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Www.login.controller.Login'</span></span>, { <span class="hljs-comment"><span class="hljs-comment">//      "" : // ,    .. extend: 'Www.Base' //    //   ,   .. ,baseTpl: 'view/inner' //     // ,   ,loginFormTpl: 'login/view/login' //  ,routes: [ { path: '/', get: 'loginForm', post: 'doLogin'} ] //  html   //       ,async loginForm () { return await this.tpl(this.loginFormTpl, { pageTitle: 'Login page', date: new Date() }); } ,async doLogin (params, res) { if(params.body.name &amp;&amp; /^[a-z0-9]{2,10}$/i.test(params.body.name)) { this.redirect(`/index.html?name=${params.body.name}`, res); return; } return await this.tpl(this.loginFormTpl, { pageTitle: 'Login page', date: new Date() }); } })</span></span></code> </pre><br>  Os modelos usam o XTemplate padr√£o (protected / www / login / view / login.tpl) <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span>{pageTitle} (date: {[Ext.Date.format(values.date,'dmY')]})<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"name"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag">&gt;</span></span>enter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Tudo o que foi descrito acima √© um conjunto completamente padr√£o, dir√° um leitor meticuloso, e para isso n√£o havia necessidade de bloquear esse jardim com a transfer√™ncia Ext JS para o servidor.  Portanto, passamos para a segunda parte do artigo, que mostrar√° para que tudo foi planejado. <br><br><h2>  Cliente </h2><br>  Vamos criar o aplicativo Ext JS usual do cliente no diret√≥rio est√°tico.  Neste exemplo, eu deliberadamente n√£o considero o uso do cmd, usei o ext-all j√° constru√≠do e o tema padr√£o.  Quest√µes de montagem √© um t√≥pico separado, que, talvez, dedique um post separado. <br><br>  Tudo come√ßa com app.js <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   Ext.Loader.setConfig({ enabled: true, paths: { "Core": "app/core", "Admin": "app/admin", "Module": "app/admin/modules", "Ext.ux": "ext/ux" } }); //    this.token = Ext.data.identifier.Uuid.createRandom()(); //      //    () //    (   ) Ext.WS = Ext.create('Core.WSocket', { token: this.token, user: new URLSearchParams(document.location.search).get("name") }); //   Ext.application({ name: 'Example', extend: 'Ext.app.Application', requires: ['Admin.*'], autoCreateViewport: 'Admin.view.Viewport' })</span></span></code> </pre><br>  A presen√ßa de um soquete da Web √© um ponto crucial, √© o que permite implementar toda a m√°gica descrita abaixo. <br><br>  O layout dos elementos na p√°gina est√° contido na classe Admin.view.Viewport (static / app / view / Viewport.js).  Nada de interessante por l√°. <br><br>  Os principais elementos funcionais (lista de usu√°rios, barra de mensagens e formul√°rio de envio) s√£o implementados como m√≥dulos separados. <br><br><h3>  Lista de Usu√°rios </h3><br>  O algoritmo simples desta lista √© o seguinte: no momento da abertura da p√°gina, os usu√°rios atuais s√£o carregados do servidor.  Quando novos usu√°rios se conectam, o servidor gera um evento "add" na classe "Module.users.model.UserModel", quando desconectado, na mesma classe, o evento "remove" √© gerado.  A quest√£o √© que o evento √© disparado no lado do servidor e voc√™ pode rastre√°-lo no cliente. <br><br>  Agora, as primeiras coisas primeiro.  No lado do cliente, a loja manipula dados (static / app / modules / users / store / UsersStore.js) <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Module.users.store.UsersStore'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.data.Store'</span></span> ,<span class="hljs-attr"><span class="hljs-attr">autoLoad</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> ,<span class="hljs-attr"><span class="hljs-attr">total</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> ,<span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-comment"><span class="hljs-comment">//         this.dataModel = Ext.create('Module.users.model.UserModel'); //      this.dataModel.on({ add: (records) =&gt; { this.onDataAdd(records) }, remove: (records) =&gt; { this.onDataRemove(records) } }) this.callParent(arguments) } //   load ,async load() { //      const data = await this.dataModel.$read(); //   this.total = data.total; //    UI this.loadData(data.data); } ,getTotalCount() { return this.total; } //          ,onDataAdd(records) { this.add(records[0]); } //   --  ,onDataRemove(records) { this.remove(this.getById (records[0].id)) } });</span></span></code> </pre><br>  Existem 2 pontos interessantes.  Primeiramente, na linha ‚Äúconst data = aguardam this.dataModel. $ Read ();‚Äù  O m√©todo do servidor do modelo √© chamado.  Agora voc√™ n√£o precisa usar o Ajax, protocolos de suporte etc., basta chamar o m√©todo do servidor como local.  Ao mesmo tempo, a seguran√ßa n√£o √© sacrificada (mais sobre isso abaixo). <br><br>  Em segundo lugar, a constru√ß√£o padr√£o de this.dataModel.on (...) permite rastrear eventos que ser√£o gerados pelo servidor. <br><br>  O modelo √© uma ponte entre as partes cliente e servidor do aplicativo.  √â como o dualismo da luz - implementa as propriedades do front-end e do back-end.  Vamos olhar o modelo com cuidado. <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Module.users.model.UserModel'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Core.data.DataModel'</span></span> <span class="hljs-comment"><span class="hljs-comment">/* scope:client */</span></span> ,testClientMethod() { ... } ,testGlobalMethod() { ... } <span class="hljs-comment"><span class="hljs-comment">/* scope:server */</span></span> ,privateServerMethod() { .... } <span class="hljs-comment"><span class="hljs-comment">/* scope:server */</span></span> ,<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> $read(params) { <span class="hljs-comment"><span class="hljs-comment">//      redis const keys = await this.getMemKeys('client:*'); let data = [], name; for(let i = 0;i&lt;keys.length;i++) { //         name = await this.getMemKey(keys[i]); if(name) { data.push({ id: keys[i].substr(7), name }) } } //    return { total: data.length, data } } })</span></span></code> </pre><br>  Preste aten√ß√£o aos coment√°rios / * scope: server * / e / * scope: client * / - essas constru√ß√µes s√£o r√≥tulos para o servidor pelo qual ele determina o tipo de m√©todo. <br><br>  testClientMethod - esse m√©todo √© executado exclusivamente no cliente e est√° dispon√≠vel apenas no lado do cliente. <br>  testGlobalMethod - esse m√©todo √© executado no cliente e no servidor e est√° dispon√≠vel para uso no cliente e no servidor. <br>  privateServerMethod - o m√©todo √© executado no servidor e est√° dispon√≠vel para chamar apenas no servidor. <br>  $ read √© o tipo de m√©todo mais interessante que √© executado apenas no lado do servidor, mas voc√™ pode cham√°-lo no cliente e no servidor.  O prefixo $ disponibiliza qualquer m√©todo do lado do servidor no lado do cliente. <br><br>  Voc√™ pode rastrear a conex√£o e desconex√£o do cliente usando um soquete da web.  Uma inst√¢ncia da classe Base.wsClient √© criada para cada conex√£o do usu√°rio (protected / base / wsClient.js) <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Base.wsClient'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Core.WsClient'</span></span> <span class="hljs-comment"><span class="hljs-comment">//      ,usersModel: Ext.create('Module.users.model.UserModel') //       ,async onStart() { //   "add"    this.usersModel.fireEvent('add', 'all', [{id: this.token, name: this.req.query.user}]); //     redis await this.setMemKey(`client:${this.token}`, this.req.query.user || ''); //   ""      , //     await this.queueProcess(`client:${this.token}`, async (data, done) =&gt; { const res = await this.prepareClientEvents(data); done(res); }) } //      ,onClose() { //   "remove"    this.usersModel.fireEvent('remove', 'all', [{id: this.token, name: this.req.query.user}]) this.callParent(arguments); } })</span></span></code> </pre><br>  O m√©todo fireEvent, diferente do padr√£o, possui um par√¢metro adicional, onde √© passado para qual cliente o evento deve ser acionado.  √â aceit√°vel passar um √∫nico identificador de cliente, uma matriz de identificadores ou a string "all".  Neste √∫ltimo caso, o evento ser√° acionado em todos os clientes conectados.  Caso contr√°rio, este √© um fireEvent padr√£o. <br><br><h3>  Enviando e recebendo mensagens </h3><br>  O controlador de formul√°rio (static / app / admin / modules / messages / view / FormController.js) √© respons√°vel pelo envio de mensagens. <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Module.messages.view.FormController'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.app.ViewController'</span></span> ,init(view) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.view = view; <span class="hljs-comment"><span class="hljs-comment">//     this.model = Ext.create('Module.messages.model.Model'); //      this.msgEl = this.view.down('[name=message]'); //     this.usersGrid = Ext.getCmp('users-grid') //    "" this.control({ '[action=submit]' : {click: () =&gt; {this.newMessage() }} }) } //     ,newMessage() { let users = []; //     const sel = this.usersGrid.getSelection(); if(sel &amp;&amp; sel.length) { sel.forEach((s) =&gt; { users.push(s.data.id) }) } //        if(users.length &amp;&amp; users.indexOf(Ext.WS.token) == -1) users.push(Ext.WS.token); //       this.model.$newmessage({ to: users, user: Ext.WS.user, message: this.msgEl.getValue() }) //    this.msgEl.setValue(''); } });</span></span></code> </pre><br>  A mensagem n√£o √© salva em nenhum lugar do servidor, o evento "newmessage" √© simplesmente acionado.  De interesse √© a chamada ‚Äúthis.fireEvent ('newmessage', data.to, msg);‚Äù, onde os identificadores de clientes s√£o enviados como destinat√°rios da mensagem.  Assim, a distribui√ß√£o de mensagens privadas √© implementada (static / app / admin / modules / messages / model / Model.js). <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Module.messages.model.Model'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Core.data.DataModel'</span></span> <span class="hljs-comment"><span class="hljs-comment">/* scope:server */</span></span> ,<span class="hljs-keyword"><span class="hljs-keyword">async</span></span> $newmessage(data) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> msg = { <span class="hljs-attr"><span class="hljs-attr">user</span></span>: data.user, <span class="hljs-attr"><span class="hljs-attr">message</span></span>: data.message } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data.to &amp;&amp; Ext.isArray(data.to) &amp;&amp; data.to.length) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fireEvent(<span class="hljs-string"><span class="hljs-string">'newmessage'</span></span>, data.to, msg); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.fireEvent(<span class="hljs-string"><span class="hljs-string">'newmessage'</span></span>, <span class="hljs-string"><span class="hljs-string">'all'</span></span>, msg); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } })</code> </pre><br>  Assim como os usu√°rios, os dados da lista de mensagens s√£o controlados pela loja (static / app / admin / modules / messages / store / MessagesStore.js) <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'Module.messages.store.MessagesStore'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.data.Store'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fields</span></span>: [<span class="hljs-string"><span class="hljs-string">'user'</span></span>, <span class="hljs-string"><span class="hljs-string">'message'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() { <span class="hljs-comment"><span class="hljs-comment">//       Ext.create('Module.messages.model.Model', { listeners: { newmessage: (mess) =&gt; { this.add(mess) } } }) this.callParent(arguments); } });</span></span></code> </pre><br>  Em geral, isso √© tudo o que √© interessante neste exemplo. <br><br><h2>  Poss√≠veis perguntas </h2><br>  <b>A disponibilidade de m√©todos de servidor no cliente √©, obviamente, boa, mas e a seguran√ßa?</b>  <b>Acontece que um hacker malvado pode ver o c√≥digo do servidor e tentar quebrar o back-end?</b> <br><br>  N√£o, ele n√£o ter√° sucesso.  Primeiro, todos os m√©todos do servidor s√£o removidos do c√≥digo da classe quando enviados ao navegador do cliente.  Para esse fim, os coment√°rios / diretrizes / * escopo destinam-se: ... * /.  Em segundo lugar, o c√≥digo do m√©todo mais p√∫blico do lado do servidor √© substitu√≠do por uma constru√ß√£o intermedi√°ria que implementa o mecanismo de chamada remota no lado do cliente. <br><br>  <b>Mais uma vez sobre seguran√ßa.</b>  <b>Se os m√©todos do servidor puderem ser chamados no cliente, posso chamar um desses m√©todos?</b>  <b>E se esse for um m√©todo de limpeza de banco de dados?</b> <br><br>  No cliente, voc√™ pode chamar apenas m√©todos que tenham o prefixo $ no nome.  Para esses m√©todos, voc√™ mesmo determina a l√≥gica de verifica√ß√µes e acessos.  Um usu√°rio externo n√£o tem acesso aos m√©todos do servidor sem $, ele nem os ver√° (veja a resposta anterior) <br><br>  <b>Parece que voc√™ possui um sistema monol√≠tico no qual o cliente e o servidor est√£o inextricavelmente vinculados.</b>  <b>A escala horizontal √© poss√≠vel?</b> <br><br>  O sistema, de fato, parece monol√≠tico, mas n√£o √©.  O cliente e o servidor podem "viver" em m√°quinas diferentes.  O cliente pode ser executado em qualquer servidor Web de terceiros (Nginx, Apache, etc.).  A quest√£o da separa√ß√£o de cliente e servidor √© resolvida com muita facilidade pelo criador de projeto autom√°tico (posso escrever um post separado sobre isso).  Para implementar o mecanismo interno do sistema de mensagens, o sistema utiliza filas (a saber, Redis √© necess√°rio para isso).  Assim, a parte do servidor pode ser facilmente dimensionada horizontalmente simplesmente adicionando novas m√°quinas. <br><br>  <b>Com a abordagem usual de desenvolvimento, como regra, o back-end fornece um determinado conjunto de APIs √†s quais voc√™ pode se conectar com diversos aplicativos clientes (site, aplicativo m√≥vel).</b>  <b>No seu caso, verifica-se que apenas um cliente escrito em Ext JS pode trabalhar com um back-end?</b> <br><br>  No servidor, em particular nos modelos de m√≥dulo, uma certa l√≥gica de neg√≥cios √© implementada.  Para fornecer acesso a ele por meio da API REST, basta um pequeno "wrapper".  Um exemplo correspondente √© apresentado na primeira parte deste artigo. <br><br><h2>  Conclus√µes </h2><br>  Como voc√™ pode ver, para uma codifica√ß√£o confort√°vel de aplicativos bastante complexos, √© bem poss√≠vel fazer isso com uma biblioteca no front-end e no back-end.  Isso tem benef√≠cios significativos. <br><br>  <b>Acelerando o processo de desenvolvimento.</b>  Cada um dos membros da equipe pode trabalhar no backend e no frontend.  O tempo de inatividade pelo motivo "Estou aguardando a exibi√ß√£o desta API no servidor" n√£o se torna relevante. <br><br>  <b>Menos c√≥digo.</b>  As mesmas se√ß√µes de c√≥digo podem ser usadas no cliente e no servidor (verifica√ß√µes, verifica√ß√µes etc.). <br><br>  <b>Manter esse sistema √© muito mais simples e mais barato.</b>  Em vez de dois programadores diversos, o sistema poder√° suportar um (ou os mesmos dois, mas intercambi√°veis).  Pelo mesmo motivo, os riscos associados √† rotatividade de equipes tamb√©m s√£o mais baixos. <br><br>  <b>A capacidade de criar sistemas em tempo real prontos para uso.</b> <br><br>  <b>Usando um √∫nico sistema de teste para back-end e frontent.</b> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt431180/">https://habr.com/ru/post/pt431180/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt431170/index.html">Cientista da China anunciou o nascimento de crian√ßas geneticamente modificadas</a></li>
<li><a href="../pt431172/index.html">O que podemos esperar da Blizzard? O passado, presente e futuro da s√©rie Diablo</a></li>
<li><a href="../pt431174/index.html">Teoria da simula√ß√£o: a rela√ß√£o dos c√°lculos qu√≠micos qu√¢nticos e a realidade</a></li>
<li><a href="../pt431176/index.html">Microsservi√ßos, APIs e inova√ß√µes: o poder das APIs</a></li>
<li><a href="../pt431178/index.html">Palavras parasitas em ingl√™s</a></li>
<li><a href="../pt431184/index.html">Redes mesh WIFI multi-hop usando a tecnologia Mesh Connex</a></li>
<li><a href="../pt431186/index.html">Design por tipos: Como tornar estados inv√°lidos inexprim√≠veis em C #</a></li>
<li><a href="../pt431188/index.html">Aspectos t√©cnicos do bloqueio da Internet na R√∫ssia. Desafios e perspectivas</a></li>
<li><a href="../pt431190/index.html">Como avaliar o n√≠vel da empresa de SEO sem concluir um acordo com ela</a></li>
<li><a href="../pt431192/index.html">AWC apresenta Firecracker - micro-virtualiza√ß√£o para Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>