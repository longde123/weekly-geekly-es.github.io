<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•Ä üë®‚Äçüë¶‚Äçüë¶ ü•à Membuat kamera termal DIY berdasarkan Raspberry Pi üèê üë®üèø‚Äçüè´ ‚ÜîÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai semuanya! 

 Musim dingin telah tiba, jadi saya harus memeriksa isolasi termal dacha tempat tinggal saya di luar kota . Dan ternyata pasar China y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Membuat kamera termal DIY berdasarkan Raspberry Pi</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/441050/"><img src="https://habrastorage.org/webt/ei/lx/7g/eilx7ge_qfo9qu0xnwi1wvhjajs.jpeg" alt="gambar"><br><br>  Hai semuanya! <br><br>  Musim dingin telah tiba, jadi saya harus memeriksa isolasi termal dacha <s>tempat tinggal</s> saya di <s>luar kota</s> .  Dan ternyata pasar China yang terkenal mulai menjual modul kamera termal murah.  Jadi saya memutuskan untuk membuat DIY dan membangun hal yang agak eksotis dan berguna - pelindung panas untuk rumah.  Kenapa tidak  Terutama karena aku punya Raspberry Pi yang berbaring di sekitar ... Hasilnya di bawah. <br><a name="habracut"></a><br><h2>  MLX90640.  Apa itu </h2><br>  Ini adalah matriks kamera termal dengan mikrokontroler onboard, dibuat oleh perusahaan yang tidak dikenal (untuk saya) bernama Melexis.  Matriksnya berukuran 32x24 piksel, yang tidak banyak, tetapi setelah interpolasi cukup untuk melihat tren umum. <br><br><img src="https://habrastorage.org/webt/vg/dz/aj/vgdzajxguwnre-4onijasyukl8o.jpeg" alt="gambar"><br><br>  Sensor ini hadir dalam dua versi, satu-satunya perbedaan adalah casing dan FoV kamera.  Model A yang lebih membumi mengamati dunia dengan 110 derajat horizontal dan 75 vertikal.  Model B masing-masing memiliki 55 dan 37,5 derajat.  Kasing ini memiliki empat keluaran - dua untuk daya dan dua untuk berbicara ke perangkat pengontrol melalui I2C.  Lembar data dapat ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br><h2>  Apa GY-MCU90640, kalau begitu? </h2><br>  Rekan Cina kami juga mengirimkan chip MLX90640 dengan mikrokontroler lain di papan (STM32F103), mungkin untuk kontrol matriks yang lebih mudah.  Seluruh unit disebut GY-MCU90640, dan biayanya sekitar 5.000 RUB (sekitar $ 80) pada Desember 2018. Sepertinya ini: <br><br><img src="https://habrastorage.org/webt/jd/h9/w4/jdh9w4phuzdtcccd8gsgcd5_gjk.jpeg" alt="gambar"><br><br>  Seperti yang bisa kita lihat, ada juga dua versi model ini, dengan sensor yang berbeda <br><br>  Mana yang terbaik?  Sayangnya, saya hanya bertanya pada diri sendiri pertanyaan ini setelah modul telah dipesan, dikirim dan diterima.  Saya belum memikirkannya saat memilih. <br><br>  Versi sudut yang lebih luas paling cocok untuk robot yang bisa mengemudi sendiri atau sistem CCTV (karena bidang pandangnya lebih baik).  Lembar data mengatakan itu juga kurang berisik dan lebih akurat. <br><br><img src="https://habrastorage.org/webt/_r/f1/vw/_rf1vwk_urgqftzfjdsy9lucsxo.jpeg" alt="gambar"><br><br>  Tetapi untuk visualisasi saya akan merekomendasikan model B yang lebih "eagle-eyed", untuk satu alasan yang sangat penting.  Dapat diputar di tempat (secara manual atau melalui drive) untuk membuat gambar gabungan jauh lebih rinci daripada resolusi 32x24.  Tapi saya tidak punya, jadi nanti saya akan berbicara tentang model A bersudut lebih luas. <br><br><h2>  Menghubungkan ke Raspberry Pi </h2><br>  Kami dapat mengontrol kamera termal dengan dua cara: <br><br><ul><li>  Ringkas pin "SET" di papan tulis dan gunakan protokol I2C untuk mengontrol mikrokontroler MLX90640 secara langsung </li><li>  Biarkan pin dan gunakan controller STM32F103 melalui RS-232 atau antarmuka serupa. </li></ul><br>  Jika Anda kode dalam C ++, Anda mungkin lebih baik mengabaikan pengontrol tambahan, pin pendek dan gunakan API pabrikan, ditemukan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . <br><br>  Pythonists yang rendah hati juga bisa menggunakan opsi pertama.  Tampaknya ada beberapa perpustakaan Python (di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> ), tetapi tidak ada yang bekerja di luar kotak untuk saya. <br><br>  Pythonists yang maju secara teoritis dapat menulis driver controller mereka sendiri.  Lembar data menjelaskan cara mengekstrak bingkai darinya.  Tetapi Anda harus menggambarkan semua prosedur kalibrasi secara manual, yang menurut saya terlalu sulit.  Jadi saya menggunakan opsi 2. Ternyata agak berbelit-belit, tetapi masih bisa dikelola. <br><br>  Berkat kecerdikan Cina (atau keberuntungan), konfigurasi output di papan tulis ternyata sangat nyaman: <br><br><img src="https://habrastorage.org/webt/wr/t1/iu/wrt1iuw0xxqw0cze8sb0wg4bl54.jpeg" alt="gambar"><br><br>  Yang perlu saya lakukan adalah memasukkan papan ke port Raspberry.  Papan memiliki konverter 5V-3V bawaan, sehingga output Rx dan Tx yang halus dari Pi tidak dalam bahaya. <br><br>  Saya juga menambahkan bahwa Anda dapat menghubungkannya dengan cara yang sama saat menggunakan opsi 1, tetapi Anda harus sangat berhati-hati dan mahir dalam menyolder.  Papan harus dipasang di sisi lain Pi (contohnya ada di foto header). <br><br><h2>  Perangkat lunak </h2><br>  Pasar Cina yang terkenal menawarkan perangkat lunak yang luar biasa ini untuk mengakses GY-MCU90640: <br><br><img src="https://habrastorage.org/webt/ri/fo/pq/rifopqyhbfzldcrxujqgobydntm.jpeg" alt="gambar"><br><br>  Rupanya juga harus ada beberapa deskripsi protokol komunikasi yang digunakan untuk mengakses mikrokontroler, dan setelah obrolan singkat dengan penjual (sangat menghormati dia), saya telah mengatakan protokol di tangan saya.  Dalam PDF dan dalam bahasa Cina murni, murni. <br><br>  Berkat Google Translate dan dosis copy-paste yang sehat, sekitar 90 menit kemudian protokolnya telah diterjemahkan.  Saya mengunggahnya di <img src="https://github.com/vvkuryshev/GY-MCU90640-RPI-Python" alt="gambar">  Github  Ternyata papan memahami 6 perintah dasar, termasuk satu untuk meminta bingkai saat ini melalui port COM. <br><br>  Setiap piksel dari matriks pada dasarnya adalah pembacaan suhu objek.  Nilai suhu dalam derajat Celsius dikalikan dengan 100 (angka 2-byte).  Bahkan ada mode khusus ketika papan mengirim frame ke Pi secara otomatis 4 kali per detik. <br><br><div class="spoiler">  <b class="spoiler_title">Skrip lengkap untuk menerima gambar termal:</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""MIT License Copyright (c) 2019 Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software. THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> serial, time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> dt <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> cv2 <span class="hljs-comment"><span class="hljs-comment"># function to get Emissivity from MCU def get_emissivity(): ser.write(serial.to_bytes([0xA5,0x55,0x01,0xFB])) read = ser.read(4) return read[2]/100 # function to get temperatures from MCU (Celsius degrees x 100) def get_temp_array(d): # getting ambient temperature T_a = (int(d[1540]) + int(d[1541])*256)/100 # getting raw array of pixels temperature raw_data = d[4:1540] T_array = np.frombuffer(raw_data, dtype=np.int16) return T_a, T_array # function to convert temperatures to pixels on image def td_to_image(f): norm = np.uint8((f/100 - Tmin)*255/(Tmax-Tmin)) norm.shape = (24,32) return norm ########################### Main cycle ################################# # Color map range Tmax = 40 Tmin = 20 print ('Configuring Serial port') ser = serial.Serial ('/dev/serial0') ser.baudrate = 115200 # set frequency of module to 4 Hz ser.write(serial.to_bytes([0xA5,0x25,0x01,0xCB])) time.sleep(0.1) # Starting automatic data colection ser.write(serial.to_bytes([0xA5,0x35,0x02,0xDC])) t0 = time.time() try: while True: # waiting for data frame data = ser.read(1544) # The data is ready, let's handle it! Ta, temp_array = get_temp_array(data) ta_img = td_to_image(temp_array) # Image processing img = cv2.applyColorMap(ta_img, cv2.COLORMAP_JET) img = cv2.resize(img, (320,240), interpolation = cv2.INTER_CUBIC) img = cv2.flip(img, 1) text = 'Tmin = {:+.1f} Tmax = {:+.1f} FPS = {:.2f}'.format(temp_array.min()/100, temp_array.max()/100, 1/(time.time() - t0)) cv2.putText(img, text, (5, 15), cv2.FONT_HERSHEY_SIMPLEX, 0.45, (0, 0, 0), 1) cv2.imshow('Output', img) # if 's' is pressed - saving of picture key = cv2.waitKey(1) &amp; 0xFF if key == ord("s"): fname = 'pic_' + dt.datetime.now().strftime('%Y-%m-%d_%H-%M-%S') + '.jpg' cv2.imwrite(fname, img) print('Saving image ', fname) t0 = time.time() except KeyboardInterrupt: # to terminate the cycle ser.write(serial.to_bytes([0xA5,0x35,0x01,0xDB])) ser.close() cv2.destroyAllWindows() print(' Stopped') # just in case ser.close() cv2.destroyAllWindows()</span></span></code> </pre> <br></div></div><br><h2>  Hasil </h2><br>  Skrip melakukan polling pada matriks termal dan menghasilkan frame ke konsol monitor yang terhubung, 4 kali per detik, yang cukup untuk tidak mengalami terlalu banyak ketidaknyamanan.  Untuk visualisasi, ia menggunakan paket OpenCV.  Saat Anda menekan S, "peta panas" dari kamera diunggah sebagai JPG ke folder skrip. <br><br><img src="https://habrastorage.org/webt/6n/9o/gw/6n9ogwhkr1klkw_qvcaej45vqnw.jpeg" alt="gambar"><br><br>  Untuk visibilitas yang lebih baik, saya juga membuat tampilan aplikasi suhu minimum dan maksimum dalam bingkai.  Jadi, dengan melihat peta panas kita dapat memperkirakan suhu benda yang paling dingin dan terpanas (dalam derajat, biasanya di sisi yang lebih tinggi), dalam kisaran 20-40 derajat.  Ctrl + C keluar dari skrip. <br><br><img src="https://habrastorage.org/webt/ik/e9/cy/ike9cyyu4h3wbdde2tfubq6yhwu.jpeg" alt="gambar"><br><br>  Script bekerja sama pada Raspberry Pi Zero W dan Pi 3 B +.  Saya memasang server VNC pada ponsel cerdas saya, jadi, dengan membawa Pi yang terhubung ke bank daya dengan ponsel cerdas yang berkemampuan VNC kita bisa mendapatkan kamera termal saku yang menyimpan gambar.  Mungkin tidak terlalu nyaman, tetapi berhasil. <br><br>  Setelah boot pertama mungkin menampilkan suhu maksimum tidak benar, dalam hal ini hanya me-reboot skrip yang harus melakukan pekerjaan. <br><br>  Itu saja untuk hari ini.  Eksperimen dapat dianggap sukses.  Anda pasti dapat melakukan pemindaian termal rumah menggunakan perangkat ini.  Jika seseorang dapat menemukan kegunaan lain untuk ini, silakan tulis di komentar. <br><br>  Selamat bekerja minggu dan sampai jumpa lagi! <br><br>  UPD: Saya diminta komentar untuk mengambil gambar rumah dari luar.  Ini dia.  Foto-foto itu berakhir tidak terlalu informatif karena suhu yang lebih rendah.  Dua foto atas adalah seluruh rumah dari dua sudut.  Dua foto yang lebih rendah adalah jendela yang berbeda. <br><br><img src="https://habrastorage.org/webt/-y/ww/kd/-ywwkdovoeqvolceev0zu--0bi4.jpeg" alt="gambar"><br><br>  Satu-satunya perubahan yang saya lakukan pada kode adalah kisaran suhu: dari +20 ... + 40 hingga -10 ... + 5. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id441050/">https://habr.com/ru/post/id441050/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id441040/index.html">Menghasilkan ikon multi-platform multi-merek dengan Sketch dan skrip Node.js - Bagian # 1</a></li>
<li><a href="../id441042/index.html">Menghasilkan ikon multi-platform multi-merek dengan Sketch dan skrip Node.js - Bagian # 2</a></li>
<li><a href="../id441044/index.html">Kisah bagaimana kami mengubah ikon PVS-Studio</a></li>
<li><a href="../id441046/index.html">Kisah bagaimana kami mengubah ikon PVS-Studio</a></li>
<li><a href="../id441048/index.html">Kantor yang pro agresif</a></li>
<li><a href="../id441052/index.html">16 Maret Badoo PHP Meetup: Tes dan kualitas kode. Pendaftaran terbuka</a></li>
<li><a href="../id441058/index.html">Kontes online untuk memecahkan masalah dari teori permainan</a></li>
<li><a href="../id441060/index.html">Ikhtisar Pemindai Metronor 3D</a></li>
<li><a href="../id441062/index.html">Tertanam dunia 2019 di Pusat Pameran Nuremberg</a></li>
<li><a href="../id441064/index.html">Komputer terkecil</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>