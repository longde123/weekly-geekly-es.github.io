<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëéüèΩ üë®‚Äçüëß‚Äçüë¶ üéã Automatizaci√≥n con Pebble conveniente, Noolite estable y esp8266 asequible üë∫ üí¶ üå†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Desde el √∫ltimo art√≠culo (el enlace dur√≥ casi un a√±o. Y durante este a√±o, repens√© algunas cosas, Internet y result√≥ algo as√≠ como IoT :) ‚Üí Internet de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Automatizaci√≥n con Pebble conveniente, Noolite estable y esp8266 asequible</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403273/"> Desde el √∫ltimo art√≠culo (el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> dur√≥ casi un a√±o. Y durante este a√±o, repens√© algunas cosas, Internet y result√≥ algo as√≠ como IoT :) ‚Üí Internet de las cosas). <br><br>  Intentar√© resumir una nueva porci√≥n del conocimiento acumulado, describir d√≥nde me estoy esforzando y lo que quiero lograr ‚Üí Le pido que lo lea. <br><a name="habracut"></a><br><h2>  Noolite F v2.0 </h2><br>  <b>En el titular, recib√≠ las palabras: guijarro y noolita.</b>  <b>¬°Pasemos a ellos!</b> <br>  Todav√≠a manejo con guijarros mi luz noolita, garaje y puerta.  Ya se ha escrito mucha informaci√≥n √∫til sobre noolita, la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">b√∫squeda</a> muestra nuevos art√≠culos. <br><br>  Adem√°s de las unidades de primera generaci√≥n del sistema noolite, tengo nuevas: una unidad de potencia SLF-1-200 (nooLite-F) con retroalimentaci√≥n ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">y cifrado de nueva generaci√≥n</a> ). <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/312/be1/be5/312be1be5d922ebcc46d307015f01eb0.png" alt="imagen"><br><br>  bloque de alimentaci√≥n SB-1-150 <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/0a1/575/b81/0a1575b813bdd72fa22800bf8b33374d.png" alt="imagen"><br><br>  y adaptador usb actualizado MTRF-64 USB. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/61e/842/1de/61e8421deaa8155d33aba9f064002a3b.png" alt="imagen"><br><br>  Toda la luz en mi casa en el sistema de noolita. <br><br>  Hasta hace poco, ten√≠a un adaptador USB de primera generaci√≥n con 16 dispositivos y ahora 64 canales (MTRF-64 USB) en el "calambre dom√©stico del sistema", y tambi√©n para dispositivos de nueva generaci√≥n con retroalimentaci√≥n (noolite F).  Pero la tecnolog√≠a se est√° moviendo en la direcci√≥n correcta, creando dispositivos nuevos y modernos. <br><br>  <b>Hay 2 opciones m√°s importantes para los nuevos dispositivos: retroalimentaci√≥n y el principio de identificaci√≥n de dispositivos por direcciones: ID.</b>  Ahora no tiene que escribir dispositivos en el canal 1 y controlar el canal.  Ahora puede acceder a un dispositivo espec√≠fico en un canal por su ID y enviarle un comando de ejecuci√≥n. <br><br>  La documentaci√≥n para los bloques de nueva generaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">est√° disponible</a> en el sitio web del fabricante. <br><br><div class="spoiler">  <b class="spoiler_title">Todo funciona a trav√©s del puerto serie usando c√≥digo python.</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># -*- coding: utf-8 -*- #!/usr/bin/env python import serial import time class NooLiteCommand: def __init__(self, ch, cmd, mode=0, ctr=0, res=0, fmt=0, d0=0, d1=0, d2=0, d3=0, id0=0, id1=0, id2=0, id3=0): self.st = 171 self.mode = mode self.ctr = ctr self.res = res self.ch = ch self.cmd = cmd self.fmt = fmt self.d0 = d0 self.d1 = d1 self.d2 = d2 self.d3 = d3 self.id0 = id0 self.id1 = id1 self.id2 = id2 self.id3 = id3 self.sp = 172 @property def crc(self): crc = sum([ self.st, self.mode, self.ctr, self.res, self.ch, self.cmd, self.fmt, self.d0, self.d1, self.d2, self.d3, self.id0, self.id1, self.id2, self.id3, ]) return crc if crc &lt; 256 else divmod(crc, 256)[1] def to_bytes(self): return bytearray([ self.st, self.mode, self.ctr, self.res, self.ch, self.cmd, self.fmt, self.d0, self.d1, self.d2, self.d3, self.id0, self.id1, self.id2, self.id3, self.crc, self.sp ]) class NooliteSerial: def __init__(self, tty_name): self.tty = self._get_tty(tty_name) def on(self, ch): self.send_command(ch, 2, 2, 0) pass def off(self, ch): self.send_command(ch, 0, 2, 0) pass def status(self, ch): m = self.send_command(ch, 128, 2, 0) pass def send_command(self, ch, cmd, mode=0, ctr=0, res=0, fmt=0, d0=0, d1=0, d2=0, d3=0, id0=0, id1=0, id2=0, id3=0): command = NooLiteCommand(ch, cmd, mode, ctr, res, fmt, d0, d1, d2, d3, id0, id1, id2, id3) self.tty.write(command.to_bytes()) while True: bytes_response = list(self.tty.read(117)) if bytes_response: all_responses.append(bytes_response) if bytes_response[3] == 0: break else: break return all_responses @staticmethod def _get_tty(tty_name): serial_port = serial.Serial(tty_name, timeout=0.1) if not serial_port.is_open: serial_port.open() serial_port.flushInput() serial_port.flushOutput() return serial_port noo_serial = NooliteSerial('/dev/ttyUSB0') #ch, cmd, mode, ctr #noo_serial.send_command(1, 15, 2, 0) #    1 #noo_serial.send_command(0, 4, 2, 0) #switch #noo_serial.send_command(0, 2, 2, 0) #turn on #noo_serial.send_command(0, 3, 2, 0) #   #noo_serial.send_command(0, 0, 2, 0) #turn off #noo_serial.send_command(0, 15, 2, 0) #  #noo_serial.send_command(0, 128, 2, 0,0,1) #CMD_Read_State + fmt = 1 #noo_serial.on(0) #noo_serial.status(0) #noo_serial.off(0) #noo_serial.off(0) #noo_serial.status(0) #noo_serial.send_command(ch=0,ctr=8, cmd=4, id0=0,id1=0,id2=48,id3=114) #switch noolite ID 0.0.48.114</span></span></code> </pre> <br></div></div><br>  Usando las funciones necesarias en el momento adecuado, podemos controlar los bloques de noolita y recibir el estado de los nuevos.  Como tengo el 99% de estos bloques antiguos, me queda usar el viejo esquema de escribir 1 bloque en 1 canal, teniendo en cuenta el hecho de que el adaptador usb admite bloques antiguos y nuevos (gracias a los desarrolladores por la compatibilidad sin bailar pandereta).  Sobre la marcha, puede administrar y recibir el estado de los nuevos bloques y administrar los antiguos. <br><br>  Hasta hace poco, no hab√≠a un solo interruptor de bot√≥n en la casa.  Tuve que agregar luz al garaje (acabo de llegar para poner las cosas en orden: D), y tambi√©n apareci√≥ un interruptor en la luz de fondo del espejo de maquillaje.  Sabiendo que hay <b>una unidad de potencia SB-1-150</b> , configur√© el interruptor normal y conect√© la unidad.  La retroiluminaci√≥n del espejo estaba hecha de una placa blanca, bombillas de 3w 4000 K, luz blanca.  El SB-1-150 es √∫nico porque puede colocarse en la caja del interruptor de pared (interruptor) en el contexto del circuito existente y al conectar un interruptor de bot√≥n a la unidad misma. <br><br><div class="spoiler">  <b class="spoiler_title">Exactamente lo que mis chicas necesitan para maquillarse :)</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/geektimes/post_images/63d/97d/4ff/63d97d4ff9ed73ee3fe00abba6a94fed.png" alt="imagen"><br></div></div><br><h2>  Guijarro </h2><br>  Cuando comenc√© a involucrarme en la automatizaci√≥n, uno de los principales factores fue: una gesti√≥n competente y conveniente. <br><br>  Parece conveniente controlar desde un tel√©fono inteligente, pero ... y no es conveniente cargar la aplicaci√≥n cada vez, donde hay peque√±os botones inc√≥modos, publicidad zurda, o hasta que presionas el bot√≥n ... todo deseo desaparece.  El control por voz desaparece, ya que tambi√©n es inconveniente y extra√±o :): d√©jalo en las tramas de las pel√≠culas de ciencia ficci√≥n. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/5ea/226/ba7/5ea226ba78a2e6fb2e61a63458aa88af.png" alt="imagen"><br><br>  Y resolv√≠ el problema de otra manera: a trav√©s de un reloj de pulsera, que CONSTANTEMENTE conmigo, no ocupa espacio y combina todas las comodidades, movilidad y velocidad de control.  En general, ¬°Pebble est√° vivo!  Pero lo m√°s importante es que, para el reloj, a√∫n puede escribir aplicaciones, sus propias aplicaciones, para administrar sus sistemas de automatizaci√≥n.  En realidad es una bomba. <br><br><div class="spoiler">  <b class="spoiler_title">Guijarro est√° vivo!</b> <div class="spoiler_text">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Video de control de puerta</a> <br></div></div><br>  La tragedia de cerrar la compa√±√≠a pebble.com (Fitbit compr√≥ todas las patentes de pebble.com) no afect√≥ su desempe√±o y desempe√±o.  Recientemente hubo una actualizaci√≥n de iOS, Android: el reloj se desat√≥ de los servicios de nube de guijarros (en caso de finalizaci√≥n del soporte) y autorizaci√≥n. <br><br>  Visualmente, nada ha cambiado, pero el servicio <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">permanece</a> : <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">cloudpebble.net</a> - WTF?  Esto es algo muy √∫til.  Si puede escribir c√≥digo en JS (y no desea pasar mucho tiempo en C ++), por favor, sea bienvenido a bordo :): el guijarro en la nube le permite "lanzar" r√°pidamente la aplicaci√≥n.  Bueno, as√≠ es como lo hice.  Por supuesto, el rendimiento de JS no debe compararse con C ++ (esto es sagrado), debe empantanarse.  si! <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo JS de Pebble Cloud para trabajar con API</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> UI = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ui'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ajax = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'ajax'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> noolite = [ [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/mqtt/gate/slidegate'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/gate.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/mqtt/gate/garage'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/door.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'!'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/103'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/100'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/system2.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'1  '</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'2  '</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/101'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2'</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/102'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/system/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/system1.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> water = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/2'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/20'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/21'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 3 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/22'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 4 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/23'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 5 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/5'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 6 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/6'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 7 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/7'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 8 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/8'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 9 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/admin/poliv/switch/9'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/water.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light1 = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/6'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/0'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/1'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/7'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/8'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/2'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/3'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 1 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/4'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/5'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/9'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> light2 = [ [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/15'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/16'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/10'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/11'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' 2 '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/12'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/13'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], [<span class="hljs-string"><span class="hljs-string">'  '</span></span>,<span class="hljs-string"><span class="hljs-string">'http://your-home-server-ip-address:1183/noolite/switch/14'</span></span>, <span class="hljs-string"><span class="hljs-string">'images/light.png'</span></span>], ]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> menu3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UI.Menu({ <span class="hljs-attr"><span class="hljs-attr">sections</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span> }] }] }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;noolite.length; i++) { items[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: noolite[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: noolite[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items1 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;light1.length; i++) { items1[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: light1[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: light1[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items2 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;light2.length; i++) { items2[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: light2[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: light2[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> items3 = []; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;water.length; i++) { items3[i] = { <span class="hljs-attr"><span class="hljs-attr">title</span></span>: water[i][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-attr"><span class="hljs-attr">subtitle</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">icon</span></span>: water[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] }; } menu.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items); menu1.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items1); menu2.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items2); menu3.items(<span class="hljs-number"><span class="hljs-number">0</span></span>, items3); menu.show(); menu.on(<span class="hljs-string"><span class="hljs-string">'select'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex == <span class="hljs-number"><span class="hljs-number">4</span></span>) { menu1.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex == <span class="hljs-number"><span class="hljs-number">5</span></span>) { menu2.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.itemIndex ==<span class="hljs-number"><span class="hljs-number">8</span></span>) { menu3.show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = noolite[e.itemIndex][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(url); ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">'get'</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'switched OK'</span></span>); }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Failure! console.log('error'); } ); } }); menu1.on('select', function(e) { var url = light1[e.itemIndex][1]; console.log(url); ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); }); menu2.on('select', function(e) { var url = light2[e.itemIndex][1]; console.log(url); ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); }); menu3.on('select', function(e) { var url = water[e.itemIndex][1]; ajax({ url: url, method: 'get' }, function(data) { console.log('switched OK'); }, function(error) { // Failure! console.log('error'); } ); });</span></span></code> </pre><br></div></div><br>  El c√≥digo est√° escrito, compilado directamente en el sitio web de Pebble en la nube, y a trav√©s del tel√©fono, descargando la aplicaci√≥n compilada, puede instalarse en el reloj, en segundos.  Todo es tan simple que cualquier joven ingeniero de automatizaci√≥n puede manejarlo;) <br><br>  Es una pena ... es una pena que Pebble haya dejado de existir y por el momento no veo una alternativa.  Pebble Time siempre estar√° en nuestros corazones! <br><br><h2>  MQTT </h2><br>  El a√±o pasado, conoc√≠ un protocolo tan maravilloso como MQTT (Historia: la primera versi√≥n del protocolo fue desarrollada por el Dr. Andy Stanford-Clark (IBM) y Arlene Nipper (Arcom) en 1999 y publicada bajo una licencia libre de regal√≠as. La especificaci√≥n MQTT 3.1.1 fue estandarizado por el consorcio OASIS en 2014. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace</a> ). <br><br>  Hay mucha informaci√≥n sobre c√≥mo funciona el protocolo y qu√© son los clientes ... y me decepcion√≥ mucho que no haya clientes reales para aplicaciones m√≥viles, solo en Android. <br><br>  Entendiendo que la falta de una buena aplicaci√≥n m√≥vil es un gran problema (agujero) en el campo de IoT (muchas personas dicen, pero hacen muy poco ...) - Yo y mi equipo, en el trabajo, decidimos crear un cliente para Android, iOS, WP para que cumpla con todos los criterios y sea c√≥modo.  Escribir√© sobre el cliente un poco m√°s tarde, as√≠ como sobre c√≥mo hicimos amigos ESP8266 + MTRF64 (Noolite) y preparamos el firmware de Nodemcu.  ¬°Ser√° genial, conveniente, barato y hermoso!  Sigue las noticias de la aplicaci√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> . <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/96c/60d/e63/96c60de63c38253cccee7ddb9aad0b4b.png" alt="imagen"><br><br>  <s>¬°Ahora puede controlar la iluminaci√≥n Noolite sin servidores dom√©sticos y adaptadores usb por $ 50-100!</s> <br><br><h2>  Esquema general de dom√≥tica </h2><br>  El siguiente esquema todav√≠a existe: <br><br><blockquote>  Video vigilancia: video vigilancia xeoma [c√°mara ip] <br>  Servidor en la unidad del sistema: nginx + gunicorn + python + mqtt broker <br>  Gesti√≥n: reloj Pebble + cliente MQTT <br>  M√≥dulos de control (nodos del sistema): ESP8266 + optoacopladores \ ds18b20, sensores dht11 [22] </blockquote><br>  Debido al hecho de que vi muchas comodidades en el protocolo MQTT, comenzando por la arquitectura de suscripci√≥n y la comunicaci√≥n instant√°nea con dispositivos IoT finales, terminando con el hecho de que los mensajes MQTT pueden volar a trav√©s del enrutador sin "reenviar" ning√∫n puerto all√≠ y bailar con una pandereta.  Convenientemente!  Divi√©rtete!  Fervientemente :) <br><br>  Todo esto me llev√≥ a descentralizar el sistema, es decir, evitar un "korchvagen casero" y cambiar a muchos de los llamados nodos y usar un agente MQTT en la nube (hay agentes MQTT gratuitos, por ejemplo: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mqtt.ximxim.com</a> (en el sitio de inicio de sesi√≥n y pase para acceder) )) - dado que esp8266 resuelve todos los problemas y, a su vez, funciona a trav√©s de wifi utilizando el protocolo MQTT. <br><br>  Dado que MQTT Buddy proporcionar√° un servicio de secuencias de comandos, no pensar√© en escribir ninguna secuencia de comandos de inicio, simplemente las crear√© en una soluci√≥n en la nube y esto ser√° un IoT real y funcionar√°.  De las palabras a los hechos! <br><br><h2>  ESP8266 </h2><br>  Cuando me familiaric√© con esta placa de desarrollo, me impresion√≥ de inmediato el hecho de que la placa es peque√±a, hay soporte para el lenguaje de programaci√≥n LUA en el firmware Nodemcu.  Lo que necesitas es un m√≥dulo MQTT.  En automatizaci√≥n, las soluciones simples y confiables son la base.  El costo de $ 2 a $ 5 por una tarifa (para el quinto modelo inmediatamente con un adaptador USB a bordo) le permite implementar r√°pidamente subsistemas. <br><br>  La conexi√≥n WiFi es r√°pida, con muchas posibilidades.  Por ejemplo: puerta / garaje \ riego \ control de iluminaci√≥n.  Tengo un 30% de riego de c√©sped con el sistema Noolite (bloques de contacto seco), el 70% restante de la placa de desarrollo esp8266 controlada a trav√©s del lenguaje LUA utilizando el protocolo MQTT. <br><br><div class="spoiler">  <b class="spoiler_title">C√≥digo LUA de muestra para esp8266, obteniendo ip y llamando al archivo de trabajo con MQTT</b> <div class="spoiler_text"><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--load credentials dofile("credentials.lua") function init(name, pass) wifi.setmode(wifi.STATION) wifi.sta.config(name, pass) wifi.sta.connect() tmr.alarm(0, 1000, 1, function() if wifi.sta.getip()== nil then print("IP unavaiable, Waiting...") else tmr.stop(0) print("Config done, IP is "..wifi.sta.getip()) print("mac : "..wifi.sta.getmac()) dofile("mqtt.lua") end end) end print("START!") init(SSID,PASSWORD)</span></span></code> </pre><br><br>  - archivo mqtt.lua <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> door = <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-comment"><span class="hljs-comment">-- gpio13 local window = 6 -- gpio12 local cooler = 5 --gpio14 local led = 4 --GPIO2 board led! LOW == turn ON local light1 = 8 --gpio 15 local light2 = 1 --gpio 5 local light3 = 2 -- gpio 4 function register_myself() m:subscribe("mqtt_buddy/#",0,function(conn) print ("subscribed to Xim mqtt.ximxim.com server") end) end m = mqtt.Client("MQTT_BUDDY_SHOW_ROOM", 120, MQTT_USER, MQTT_PASS) m:on("connect", function(client) print ("connected to Xim mqtt.ximxim.com server") end) m:on("offline", function(client) reconnect_mqtt() end) m:on("message", function(client, topic, data) --print(topic.." data:"..data) if topic == "mqtt_buddy/window" and data == "1" then print "open-close window..." gpio.write(window, gpio.HIGH) gpio.write(led, gpio.LOW) tmr.alarm(1, 1000, tmr.ALARM_SINGLE, function() gpio.write(window, gpio.LOW) gpio.write(led, gpio.HIGH) print "command to close\open window is sent!" end) elseif topic == "mqtt_buddy/door" and data == "1" then print "open-close door..." gpio.write(door, gpio.HIGH) gpio.write(led, gpio.LOW) tmr.alarm(2, 1000, tmr.ALARM_SINGLE, function() gpio.write(door, gpio.LOW) gpio.write(led, gpio.HIGH) print "command to close\open door is sent!" end) elseif topic == "mqtt_buddy/cooler" then if data == "1" then print "switch on fan..." gpio.write(cooler, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch off fan..." gpio.write(cooler, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light1" then if data == "1" then print "switch light1 ON..." gpio.write(light1, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light1 off..." gpio.write(light1, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light2" then if data == "1" then print "switch light2 ON..." gpio.write(light2, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light2 off..." gpio.write(light2, gpio.LOW) gpio.write(led, gpio.HIGH) end elseif topic == "mqtt_buddy/light3" then if data == "1" then print "switch light3 ON..." gpio.write(light3, gpio.HIGH) gpio.write(led, gpio.LOW) else print "switch light3 off..." gpio.write(light3, gpio.LOW) gpio.write(led, gpio.HIGH) end end end) m:connect(MQTT_SERVER, MQTT_SERVER_PORT, 0, function(conn) register_myself() end)</span></span></code> </pre><br></div></div><br><h3>  El problema </h3><br>  En cuanto a una gran comunidad de <b>personas pensantes</b> , quer√≠a tocar un tema extremadamente importante, o m√°s bien el problema que quiero resolver, pero no hay suficiente tiempo para una investigaci√≥n / conocimiento m√°s profundo. <br><br>  El resultado final: con la descentralizaci√≥n, la videovigilancia permanece, lo que de una forma u otra requiere una m√°quina host para (m√≠nimo) transferir im√°genes de origen a un servidor de videovigilancia (por ejemplo, ivideon) o incluso procesar video en una m√°quina dom√©stica, como xeoma (aunque tambi√©n tienen una nube). de una forma u otra: necesita "AVANZAR" las transmisiones de video, las im√°genes para la potencia inform√°tica final (soluciones en la nube), o viceversa, para simplificar la transmisi√≥n. <br><br>  Hay pensamientos de recibir im√°genes de origen de la c√°mara (tambi√©n hay un problema aqu√≠, no todas las c√°maras tienen una URL para recibir una imagen de la c√°mara y generalmente no est√° claro c√≥mo otros reconocer√°n esta URL ...) y reenv√≠an al canal MQTT donde se admiten datos binarios (que hay una imagen que se puede transmitir f√°cilmente a trav√©s del protocolo mqtt en forma binaria). <br><br>  ¬øQuiz√°s alguien ya ha intentado implementar tales cosas = ESP8266 + c√°mara web IP? <br>  Responda por favor (bogdanovich.alex [@] gmail.com).  Estar√© muy agradecido! <br><br>  Al implementar probros, la pregunta del servidor dom√©stico desaparecer√°.  Por qu√©  Porque √©l come electricidad y calienta mi horno :) <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/148/bfb/eab/148bfbeab6e37921aa198344af6564de.png" alt="imagen"><br><br>  ¬°Todo un d√≠a positivo y buen humor! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es403273/">https://habr.com/ru/post/es403273/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es403255/index.html">Se crea el primer bloqueador de anuncios "perceptual", que no depende del dise√±o de la p√°gina</a></li>
<li><a href="../es403263/index.html">C√≥mo se organiza el trabajo en el centro de servicio "NAG"</a></li>
<li><a href="../es403265/index.html">La industria hotelera declara la guerra a Airbnb</a></li>
<li><a href="../es403267/index.html">Para sistemas en un chip a trav√©s de FPGA: semana de microelectr√≥nica digital en Kiev - 24-29 de abril de 2017</a></li>
<li><a href="../es403271/index.html">Tiro de helic√≥ptero</a></li>
<li><a href="../es403275/index.html">La b√∫squeda de la antimateria desaparecida en el universo permanece en un molesto estado de incertidumbre.</a></li>
<li><a href="../es403277/index.html">Estas cient√≠ficas indias enviaron un cohete a Marte por una cantidad inferior al presupuesto de la pel√≠cula "Marciano"</a></li>
<li><a href="../es403279/index.html">Noticias RFID: las ventas de abrigos de piel astillados se han roto ... techos</a></li>
<li><a href="../es403281/index.html">Windows 10 suprimir√° las aplicaciones en segundo plano</a></li>
<li><a href="../es403283/index.html">Impresora 3D Funtastique EVO v1.0: primera introducci√≥n</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>