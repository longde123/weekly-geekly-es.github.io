<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§±üèæ üèüÔ∏è üë©üèª‚Äçüöí Comme l'√©crit le surnom de bot Telegram d'iOS, sur Swift üë©üèæ‚Äçüíº üë† üçß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Il s'agira de Telegrammer, framework Telegram Bot pour Linux / macOS , enti√®rement √©crit en Swift 4.1 



 Exposition: Comment une telle pens√©e vous e...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Comme l'√©crit le surnom de bot Telegram d'iOS, sur Swift</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/416023/"><p>  Il s'agira de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Telegrammer, framework Telegram Bot pour Linux / macOS</a> , enti√®rement √©crit en Swift 4.1 </p><br><p><img src="https://habrastorage.org/webt/uh/8_/do/uh8_do0h1mqyeeyheidwr3c-daw.png"></p><a name="habracut"></a><br><h1 id="ekspoziciya-kak-zhe-prishla-v-golovu-takaya-mysl">  Exposition: Comment une telle pens√©e vous est-elle venue √† l'esprit? </h1><br><p>  Un de mes projets pour animaux de compagnie (une application iOS li√©e √† Telegram, mais maintenant il ne s'agit pas de lui) avait besoin d'une interface Web pour que le gestionnaire de contenu cr√©e une description, une balise et plus encore.  √âtant donn√© que l'application √©tait d√©j√† li√©e id√©ologiquement √† Telegram, il m'est imm√©diatement venu √† l'esprit d'envoyer du contenu directement au messager et d'effectuer d√©j√† les actions ci-dessus. </p><br><p>  Il s'est av√©r√© que vous pouvez envoyer ces donn√©es via des bots (comment les <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">bots</a> sont organis√©s <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">dans Telegram</a> ). </p><br><h1 id="zavyazka-iskal-gotovoe-reshenie-podhodyaschego-ne-nashel">  Au d√©part: je cherchais une solution toute faite, je n'ai pas trouv√© de solution adapt√©e. </h1><br><p> Et puis toutes les √©toiles align√©es, maintenant vous comprendrez ce que je veux dire ... </p><br><p>  Il existe de nombreux frameworks c√¥t√© serveur fiables et √©prouv√©s en Java, Go, Python, PHP et autres qui vous permettent d√©j√† de cr√©er un bot sans aucun probl√®me.  Mais cela ne nous concerne pas (t√©moins <del>  De J√©hovah </del>  Apple), nous ne recherchons pas de moyens simples. </p><br><p>  Et si vous √©crivez un bot dans Swift? </p><br><p>  Plus r√©cemment (selon les standards des langages de programmation), la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">communaut√© Server Side Swift a</a> commenc√© √† se d√©velopper activement, et plusieurs frameworks sont apparus, tels que Vapor, Perfect, Kitura, qui ont r√©ussi √† gagner une renomm√©e suffisante. </p><br><p>  De plus, Apple a jet√© du bois de chauffage dans le four, facilitant la vie des d√©veloppeurs avec un cadre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">SwiftNIO de</a> bas niveau et hautes performances </p><br><div class="spoiler">  <b class="spoiler_title">Pourquoi SwiftNIO est-il cool?</b> <div class="spoiler_text"><p>  SwiftNIO est un cadre d'application r√©seau asynchrone multiplateforme bas√© sur des √©v√©nements pour le d√©veloppement rapide de serveurs et de clients de protocole hautes performances maintenables. </p><br><p>  C'est comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Netty</a> , mais √©crit pour Swift. </p><br><p>  SwiftNIO est fondamentalement un outil de bas niveau pour cr√©er des applications de mise en r√©seau hautes performances dans Swift.  Il cible particuli√®rement les cas d'utilisation o√π l'utilisation d'un mod√®le de concurrence par threads par connexion est inefficace ou intenable.  Il s'agit d'une limitation courante lors de la cr√©ation de serveurs qui utilisent un grand nombre de connexions √† relativement faible utilisation, telles que les serveurs HTTP. </p><br><p>  Pour atteindre ses objectifs, SwiftNIO utilise largement les "E / S non bloquantes": d'o√π le nom!  Les E / S non bloquantes diff√®rent du mod√®le d'E / S de blocage le plus courant car l'application n'attend pas que des donn√©es soient envoy√©es ou re√ßues du r√©seau: √† la place, SwiftNIO demande au noyau de le notifier lorsque les op√©rations d'E / S peuvent √™tre effectu√©e sans attendre. </p><br><p>  SwiftNIO n'a pas pour objectif de fournir des solutions de haut niveau comme, par exemple, les frameworks Web.  Au lieu de cela, SwiftNIO se concentre sur la fourniture des blocs de construction de bas niveau pour ces applications de niveau sup√©rieur.  Lorsqu'il s'agit de cr√©er une application Web, la plupart des utilisateurs ne voudront pas utiliser SwiftNIO directement: ils voudront plut√¥t utiliser l'un des nombreux excellents cadres Web disponibles dans l'√©cosyst√®me Swift.  Ces frameworks Web peuvent toutefois choisir d'utiliser SwiftNIO sous les couvertures pour fournir leur support r√©seau. </p></div></div><br><h4 id="chto-ya-rassmatrival-iz-gotovyh-telegram-bot-swift-bibliotek">  Ce que j'ai consid√©r√© des biblioth√®ques Telegram Bot Swift termin√©es: </h4><br><ol><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zmeyc / telegram-bot-swift</a> - Une biblioth√®que assez avanc√©e, l'int√©gralit√© de l'API Telegram Bot est analys√©e √† partir du site, √† la fois les m√©thodes et les mod√®les, le routage avanc√©, fonctionne √† la fois sur macOS et Linux. <br>  Les inconv√©nients li√©s au fait qu'il a √©t√© √©crit il y a longtemps, et √† cette √©poque, tous les frameworks Apple (en particulier Foundation) fonctionnaient sous Linux tr√®s instables: </p><br><ul><li>  Envoie des demandes via curl </li><li>  Au moment de l'√©tude, la biblioth√®que elle-m√™me et les biblioth√®ques d√©pendantes n'√©taient pas port√©es vers swift 4 </li><li>  Non pris en charge par les webhooks </li><li>  Un r√©f√©rentiel qui n'a pas √©t√© mis √† jour depuis longtemps, par cons√©quent, certaines fonctionnalit√©s de l'API Telegram Bot mise √† jour ne sont pas prises en charge. </li></ul><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">FabrizioBrancati / SwiftyBot</a> - Pardonnez-moi, je ne comprends pas pourquoi ce bot a le plus d'√©toiles, le Vapor 2.4.0 obsol√®te est sous le capot et le solitaire main.swift, qui d√©montre simplement le travail le plus simple avec le bot.  Pas de mod√®les, d'aides, de files d'attente de r√©partition, rien.  Oh non!  Contrairement aux concurrents, il prend en charge les WebHooks. </p><br></li><li><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ShaneQi / ZEGBot</a> - Une impl√©mentation tr√®s simple, les m√©thodes de base, les mod√®les, et encore seulement LongPolling sont impl√©ment√©s. </p><br></li></ol><br><p>  Donc, c'est d√©cid√©, nous allons √©crire notre propre framework.  Honn√™tement, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Andrey Fidrya</a> m'a inspir√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">avec</a> son bot, mais j'ai d√©cid√© que je pouvais essayer de faire mieux. </p><br><h1 id="kulminaciya-dobro-pozhalovat-v-mir-bekenda-swiftnio-spasibo-za-vzorvannyy-mozg">  Climax: Bienvenue dans le monde du backend.  SwiftNIO, merci pour le cerveau √©clat√©. </h1><br><p>  J'avoue, apr√®s les applications iOS, √©crire une application pour Server Side est assez difficile, je dois penser diff√©remment. </p><br><p>  Au moment o√π le framework a √©t√© √©crit, les gars de Vapor avaient annonc√© une b√™ta et √©taient d√©j√† bas√©s sur SwiftNIO.  Vapor a une architecture modulaire, chaque couche vit dans son propre r√©f√©rentiel, ce qui est tr√®s pratique, vous ne pouvez utiliser qu'une partie des impl√©mentations. </p><br><h4 id="ya-reshil-ispolzovat">  J'ai d√©cid√© d'utiliser: </h4><br><ul><li>  <a href="https://github.com/vapor/">vapor / http</a> - pour HTTPClient, HTTPServer </li><li>  <a href="">vapeur / crypto</a> - pour https </li><li>  <a href="">vapeur / multipartie</a> - pour convertir le mod√®le -&gt; multipart / form-data </li></ul><br><p>  Dans le processus, certains bogues ont √©t√© trouv√©s dans Vapor HTTPClient, r√©solus avec succ√®s, le HTTPServer a √©t√© am√©lior√©, pour fonctionner avec https hors de la bo√Æte, sans avoir besoin d'utiliser nginx et autres. </p><br><h4 id="chto-poluchilos">  Que s'est-il pass√©: </h4><br><ul><li>  L'API du bot a √©t√© con√ßue avec un ≈ìil fort sur un acteur de confiance dans ce domaine <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">python-telegram-bot</a> </li><li>  Comme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">zmeyc / telegram-bot-swift,</a> tous les mod√®les et m√©thodes de bots de l' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">API Telegram Bot</a> peuvent √™tre g√©n√©r√©s en ex√©cutant un script. </li><li>  Impl√©mentation des modes Longpolling et WebHooks </li><li>  Gestionnaires impl√©ment√©s: CommandHandler, CallbackQueryHandler, RegexpHandler, MessageHandler </li><li>  De nombreux filtres pour les mises √† jour </li><li>  Deux robots simples, par exemple, EchoBot standard et HelloBot </li></ul><br><h1 id="razvyazka-pishem-bota-obschepoleznogo-pust-proveryaet-orfografiyu">  √âchange: Nous √©crivons un bot qui est g√©n√©ralement utile, laissez-le v√©rifier l'orthographe. </h1><br><p>  Bot: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">@yandex_spell_checker_bot</a> <br>  Code source: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https://github.com/givip/YandexSpellCheckerBot</a> </p><br><p>  <em>main.swift</em> ressemble √† ceci: </p><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Foundation <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Telegrammer ///   enviroment variable ( , ) guard let token = Enviroment.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>("SPELL_CHECKER_BOT_TOKEN") <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { ///   let bot = try Bot(token: token) ///    let dispatcher = Dispatcher(bot: bot) ///    let controller = SpellCheckerController(bot: bot) ///    /<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>,   let commandHandler = CommandHandler(commands: ["/start"], callback: controller.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>) dispatcher.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>: commandHandler) ///    ,        let textHandler = MessageHandler(filters: .private, callback: controller.spellCheck) dispatcher.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>: textHandler) ///   ,    . let inlineHandler = CallbackQueryHandler(pattern: "\\w+", callback: controller.<span class="hljs-keyword"><span class="hljs-keyword">inline</span></span>) dispatcher.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">handler</span></span>: inlineHandler) ///     Longpolling _ = try Updater(bot: bot, dispatcher: dispatcher).startLongpolling().wait() } catch { print(error.localizedDescription) }</code> </pre> <br><h1 id="epilog-ios-razrabotchiki-i-ne-tolko-polzuytes">  √âpilogue: d√©veloppeurs iOS et plus, utilisez-le! </h1><br><p>  Le cadre est en version b√™ta, et tout le monde peut l'utiliser pour leurs besoins. </p><br><p>  Apr√®s un mois de tests et d'am√©liorations, il y avait quelques lacunes, liste de souhaits et beaucoup de probl√®mes d'am√©lioration, mais n√©anmoins, "Spell Checking" tourne depuis longtemps sur Ubuntu. </p><br><p>  Je serais reconnaissant pour toute r√©troaction et pour lancer le ventilateur. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr416023/">https://habr.com/ru/post/fr416023/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr416013/index.html">Comment commencer √† investir et √©conomiser de l'argent: les experts de Dow Jones ont nomm√© les cinq principales erreurs des traders d√©butants</a></li>
<li><a href="../fr416015/index.html">Jouer avec les threads dans Node.JS 10.5.0</a></li>
<li><a href="../fr416017/index.html">Nous collectons l'analyse de cohorte / analyse des flux sur l'exemple d'Excel</a></li>
<li><a href="../fr416019/index.html">Quelle est la qualit√© de l'√©cosyst√®me open source de R pour r√©soudre les probl√®mes commerciaux?</a></li>
<li><a href="../fr416021/index.html">D√©velopper votre propre framework et la croissance professionnelle d'un programmeur JS</a></li>
<li><a href="../fr416025/index.html">Impl√©mentation de la navigation dans les applications Android √† l'aide du composant Architecture de navigation</a></li>
<li><a href="../fr416027/index.html">Le HI-FI sovi√©tique et ses cr√©ateurs: les passions de Hale - Electronique 150AC - 001</a></li>
<li><a href="../fr416029/index.html">Ordinateur liquide: capture d'ions dans le graph√®ne</a></li>
<li><a href="../fr416035/index.html">Scanner 3D dentaire Shining 3D Autoscan DS EX (Unboxing) by 3Dtool</a></li>
<li><a href="../fr416037/index.html">D√©marrage de la journ√©e (avril-juin 2018)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>