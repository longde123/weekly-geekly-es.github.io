<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>游땸 游꾼游 游꾻 Gu칤a completa de CMake. Tercera parte: pruebas y empaques 游꽅 游냨 游눆游낕</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduccion 


 Este art칤culo trata sobre los programas de prueba y empaquetado que utilizan CMake, un conjunto flexible y vers치til de utilidades par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Gu칤a completa de CMake. Tercera parte: pruebas y empaques</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/433822/"><p><img src="https://habrastorage.org/webt/lf/se/70/lfse70sjifxiyddiuym73hdvcho.png"></p><br><h1 id="vvedenie">  Introduccion </h1><br><p>  Este art칤culo trata sobre los programas de prueba y empaquetado que utilizan CMake, un conjunto flexible y vers치til de utilidades para desarrollar diversos productos de software.  Se recomienda encarecidamente que lea la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">primera</a> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">segunda</a> parte del manual para evitar malentendidos sobre la sintaxis y c칩mo funciona CMake. </p><a name="habracut"></a><br><h1 id="zapusk-cmake">  Lanzamiento de CMake </h1><br><p>  Los siguientes son ejemplos del uso del lenguaje CMake que debe practicar.  Experimente con el c칩digo fuente modificando los comandos existentes y agregando otros nuevos.  Para ejecutar estos ejemplos, instale CMake desde el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">sitio web oficial</a> . </p><br><h1 id="primer-testirovaniya">  Ejemplo de prueba </h1><br><p> Como se mencion칩 anteriormente, CMake admite pruebas autom치ticas de programas.  Esta caracter칤stica es muy f치cil de usar: simplemente escriba algunos comandos en el <code>CMakeLists.txt</code> habitual y luego ejecute las pruebas usando <code>ctest</code> o <code>make test</code> .  A su disposici칩n hay una comprobaci칩n de la salida de programas, an치lisis din치mico de memoria y mucho m치s. </p><br><p>  Consideraremos el proceso de probar el programa con un ejemplo espec칤fico.  El archivo fuente <code>Multiply.c</code> contiene el siguiente c칩digo: </p><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; #define ARG_COUNT 3 int main(const int argc, const char *argv[]) { if (argc != ARG_COUNT) { fprintf(stderr, "Error!\n"); return EXIT_FAILURE; } const int first = atoi(argv[1]); const int second = atoi(argv[2]); printf("The result is: %d\n", first * second); return EXIT_SUCCESS; }</span></span></span></span></code> </pre> <br><p>  Este c칩digo muestra el resultado de multiplicar dos argumentos a la consola.  Tenga en cuenta que una situaci칩n de ocurrencia de un error tambi칠n es posible si el n칰mero real de argumentos no satisface lo esperado: en este caso, 춰El error se enviar치 a la secuencia de errores <code>Error!</code>  . </p><br><p>  En el mismo directorio est치 el archivo <code>CMakeLists.txt</code> con una descripci칩n del proceso de compilaci칩n, que contiene el siguiente c칩digo: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">cmake_minimum_required</span></span>(VERSION <span class="hljs-number"><span class="hljs-number">3.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">project</span></span>(MyProgram) <span class="hljs-keyword"><span class="hljs-keyword">add_executable</span></span>(Multiply Multiply.c) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(MULTIPLY_TIMEOUT <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   : enable_testing() #  : add_test(FirstTest Multiply 15 207) add_test(SecondTest Multiply -54 -785) add_test(ThirdTest Multiply 85234) #   : set_tests_properties(FirstTest SecondTest ThirdTest PROPERTIES TIMEOUT ${MULTIPLY_TIMEOUT}) set_tests_properties(FirstTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 3105" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(SecondTest PROPERTIES PASS_REGULAR_EXPRESSION "The result is: 42390" FAIL_REGULAR_EXPRESSION "Error!") set_tests_properties(ThirdTest PROPERTIES PASS_REGULAR_EXPRESSION "Error!")</span></span></code> </pre> <br><p>  Consideremos todo en orden.  Los primeros cuatro comandos deben ser familiares para usted del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">art칤culo anterior</a> , y el siguiente comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>enable_testing</code></a> plantea una serie de preguntas.  En esencia, este comando solo notifica a CMake de su intenci칩n de probar el programa, generando simult치neamente algunos archivos de configuraci칩n, cuya existencia no necesita saber. </p><br><p>  Los siguientes tres <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>add_test</code></a> agregan pruebas al proyecto actual.  La forma abreviada de este comando toma el nombre de la prueba como primer argumento, y los argumentos posteriores forman un comando de shell para ejecutar la prueba. </p><br><p>  Una serie de comandos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>set_tests_properties</code></a> establece el comportamiento de las pruebas individuales.  Despu칠s de la lista de elementos de prueba, sigue la palabra clave <code>PROPERTIES</code> , que indica el comienzo de la lista de propiedades, que tiene la forma <code>&lt; &gt; &lt; &gt;</code> y se establece para las pruebas seleccionadas.  Una lista completa de propiedades disponibles est치 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu칤</a> . </p><br><p>  Para todas las pruebas, el tiempo de ejecuci칩n m치ximo se establece en un segundo con la propiedad <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>TIMEOUT</code></a> , y luego para las pruebas posteriores, la salida esperada se establece con las <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>FAIL_REGULAR_EXPRESSION</code></a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>PASS_REGULAR_EXPRESSION</code></a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>FAIL_REGULAR_EXPRESSION</code></a> (por ejemplo, si la expresi칩n regular <code>The result is: 3105</code> coincide, luego la prueba <code>FirstTest</code> contin칰a, y si coincide con la expresi칩n <code>Error!</code> prueba se detiene y se considera fallida). </p><br><h1 id="sposoby-vklyucheniya-testirovaniya">  Formas de habilitar las pruebas </h1><br><p>  Existe un an치logo del <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>enable_testing</code></a> : esta es la inclusi칩n del m칩dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>CTest</code></a> trav칠s del comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>include</code></a> .  En general, la inclusi칩n de un m칩dulo es m치s universal, pero todav칤a hay una diferencia entre ellos. </p><br><p>  El comando <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>enable_testing</code></a> permite realizar pruebas para el directorio actual, as칤 como para todos los posteriores.  Debe ubicarse en la ra칤z <code>CMakeLists.txt</code> , ya que CTest espera un archivo de prueba en la ra칤z del ensamblado. </p><br><p>  Habilitar el m칩dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>CTest</code></a> configura el proyecto para la prueba usando CTest / CDash, y tambi칠n determina autom치ticamente la opci칩n <code>BUILD_TESTING</code> , que acepta verdadero cuando la prueba es posible (el valor predeterminado es <code>ON</code> ).  Por lo tanto, cuando se utiliza este comando, es razonable describir el proceso de prueba de esta manera: </p><br><pre> <code class="cmake hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(BUILD_TESTING) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(FirstTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(SecondTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">add_test</span></span>(ThirdTest <span class="hljs-keyword"><span class="hljs-keyword">Test</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-comment"><span class="hljs-comment">#  ... endif()</span></span></code> </pre> <br><h1 id="ispolnenie-testirovaniya">  Prueba de ejecuci칩n </h1><br><p>  Una serie de comandos <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; ctest .</code>  se ejecutan las tres pruebas.  El <code>ctest -R &lt;RegularExpression&gt;</code> ejecuta un conjunto de pruebas que satisfacen una expresi칩n regular dada.  Por ejemplo, el <code>ctest -R ThirdTest</code> ejecuta solo la tercera prueba. </p><br><h1 id="primer-paketirovaniya">  Ejemplo de embalaje </h1><br><p>  Para crear un paquete de archivos fuente, bibliotecas y archivos ejecutables, solo tiene que describir la instalaci칩n de los archivos necesarios con el comando de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>install</code></a> y luego habilitar el m칩dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>CPack</code></a> el comando de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>include</code></a> : </p><br><pre> <code class="cmake hljs"><span class="hljs-comment"><span class="hljs-comment">#    "Multiply"   "bin": install(TARGETS Multiply DESTINATION bin) #    : set(CPACK_PACKAGE_NAME "Multiply") set(CPACK_PACKAGE_VENDOR "MyCompany") set(CPACK_PACKAGE_CONTACT "https://myprojectsite.org") set(CPACK_DEBIAN_PACKAGE_MAINTAINER "mycontacts@gmail.com") set(CPACK_PACKAGE_DESCRIPTION "The most stupid program ever written") #    : set(CPACK_GENERATOR "DEB") #    "CPack": include(CPack)</span></span></code> </pre> <br><p>  En este caso, el comando de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>install</code></a> notifica al generador de paquetes del directorio de instalaci칩n de destino <code>Multiply</code> .  Sin escribir comandos de instalaci칩n, la generaci칩n de paquetes no es posible. </p><br><p>  A continuaci칩n se enumeran las caracter칤sticas del paquete estableciendo varias variables.  De hecho, hay muchas variables de este tipo que empaquetan correctamente los paquetes.  La mayor칤a de ellos son opcionales, pero algunos generadores de paquetes requieren su definici칩n.  Una lista de variables comunes a todos los generadores de paquetes est치 disponible <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu칤</a> . </p><br><p>  La definici칩n de la variable <code>CPACK_GENERATOR</code> es <code>CPACK_GENERATOR</code> : es una lista de generadores de paquetes invocados por la utilidad <code>cpack</code> .  En este caso, toma el valor <code>DEB</code> , por lo tanto, se genera un paquete debian en el directorio ra칤z de la aplicaci칩n de resumen. </p><br><p>  Finalmente, el m칩dulo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>CPack</code></a> est치 <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>CPack</code></a> , configurando el futuro paquete del proyecto utilizando las variables previamente definidas y el comando de instalaci칩n para el archivo ejecutable, adem치s de agregar dos objetivos de ensamblaje: <code>package</code> y <code>package_source</code> (ensamblaje binario y ensamblaje de origen, respectivamente). </p><br><h1 id="ispolnenie-paketirovaniya">  Ejecuci칩n de embalaje </h1><br><p>  Una serie de comandos <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package</code> inicia para ejecutar el generador seleccionado para crear un paquete binario y comandos <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code>  <code>cmake . &amp;&amp; cmake --build . &amp;&amp; cmake --build . --target package_source</code> genera un paquete fuente directamente en el directorio ra칤z. </p><br><h1 id="zavershenie">  Finalizaci칩n </h1><br><p>  En este punto, la serie completa de tutoriales CMake ha terminado.  Espero que hayas aprendido mucho material 칰til y que hayas mejorado tus habilidades de programaci칩n.  Buena suerte <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es433822/">https://habr.com/ru/post/es433822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es433810/index.html">Un enfoque orientado a problemas para proyectos en marketing en Internet</a></li>
<li><a href="../es433814/index.html">C칩mo escalar bases de datos en Yandex. Cloud sin tiempo de inactividad. Tres ejemplos de host</a></li>
<li><a href="../es433816/index.html">D칩nde publicar la aplicaci칩n m칩vil</a></li>
<li><a href="../es433818/index.html">Compilar y ejecutar C # y Blazor dentro de un navegador</a></li>
<li><a href="../es433820/index.html">Propuesta de ECMAScript: Array.prototype. {Flat, flatMap}</a></li>
<li><a href="../es433824/index.html">Habro suicidio. 쯇or qu칠 los programadores de 1C salvar치n el mundo?</a></li>
<li><a href="../es433826/index.html">Instrucciones de uso de Persimmon 2.0</a></li>
<li><a href="../es433828/index.html">Uso del mapa QML para construir v칤as a칠reas - Parte 1</a></li>
<li><a href="../es433830/index.html">Nuevas l치mparas LED Diall</a></li>
<li><a href="../es433832/index.html">Formateo del c칩digo fuente de ClangFormat en Linux: problemas y soluciones</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>