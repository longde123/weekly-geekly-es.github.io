<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👆🏻 🤥 🧑‍🤝‍🧑 Anschließen eines Nintendo Classic Mini Gamepad an den Raspberry Pi 🙆🏾 👨🏼‍🔬 👋🏿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=", . . , Dendy ( , , , . .) geektimes.ru/post/281520, Raspberry pi. , Nintendo Classic Mini, — . 4 , . , . , , , .
 
  , .
 
 
 
 Es gibt kein Geheimni...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anschließen eines Nintendo Classic Mini Gamepad an den Raspberry Pi</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/400445/">   ,        .        .  ,      Dendy (  ,   ,   ,      . .) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">geektimes.ru/post/281520</a>,       Raspberry pi.        ,         Nintendo Classic Mini,    —  .      4  ,       .     ,    . ,  ,    ,      .<br>
<br>
  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">  </a>,    .<br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/c3a/89c/5a4/c3a89c5a4ceae503f25e700e9cd79a45.jpg" alt="Bild"><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Es gibt kein Geheimnis, dass dieses Gamepad sowohl mit Wii als auch mit Wii U verbunden werden kann, was bedeutet, dass es über die i2c-Schnittstelle abgefragt werden kann. Erfreulich ist, dass das Gamepad mit 3,3 V betrieben wird, sodass Sie sich nicht um die Anpassung der Spannungspegel kümmern müssen. Um das Gamepad mit dem Raspberry Pi zu verbinden, habe ich beschlossen, Anschlüsse für Wiimote auf Aliexpress zu kaufen, die von ihm auf die Platine gelötet werden. Obwohl das Paket zwei Anschlüsse enthielt und diese sich in einer gemeinsamen Blase befanden, war einer der Anschlüsse in einem schlechten Zustand. Keine Dose kann hier nicht. Nachdem alles gelötet war, musste überprüft werden, ob dies funktioniert. Dafür habe ich mich entschieden, die Dienstprogramme aus dem i2c-tools-Paket zu verwenden. Die Idee war, das Gerät unter der Adresse 52 zu bestimmen. Nachdem ich i2cdetect gestartet hatte, sah ich den Schatz:</font></font><br>
<br>
<pre><code class="cpp hljs">i2cdetect -y <span class="hljs-number"><span class="hljs-number">1</span></span>
     <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">2</span></span>  <span class="hljs-number"><span class="hljs-number">3</span></span>  <span class="hljs-number"><span class="hljs-number">4</span></span>  <span class="hljs-number"><span class="hljs-number">5</span></span>  <span class="hljs-number"><span class="hljs-number">6</span></span>  <span class="hljs-number"><span class="hljs-number">7</span></span>  <span class="hljs-number"><span class="hljs-number">8</span></span>  <span class="hljs-number"><span class="hljs-number">9</span></span>  a  b  c  d  e  f
<span class="hljs-number"><span class="hljs-number">00</span></span>:          <span class="hljs-number"><span class="hljs-number">03</span></span> <span class="hljs-number"><span class="hljs-number">04</span></span> <span class="hljs-number"><span class="hljs-number">05</span></span> <span class="hljs-number"><span class="hljs-number">06</span></span> <span class="hljs-number"><span class="hljs-number">07</span></span> -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">10</span></span>: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">20</span></span>: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">30</span></span>: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">40</span></span>: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">50</span></span>: -- -- <span class="hljs-number"><span class="hljs-number">52</span></span> -- -- -- -- -- -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">60</span></span>: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
<span class="hljs-number"><span class="hljs-number">70</span></span>: -- -- -- -- -- -- -- --</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Mein Herz wurde sofort wärmer (als ob ein unbekanntes Mädchen dich im Frühjahr auf einer Straße anlächelte), also funktioniert es. Als nächstes mussten Sie googeln, um Peripheriegeräte mit der Wii zu verbinden. Ich habe ein Beispiel gefunden, wie sich ein Wii-Nunchak mit einem Himbeer-Pi verbindet. In diesem Beispiel habe ich herausgefunden, dass das Gamepad initialisiert werden muss, indem Null in das 0x40-Register geschrieben wird und dann jedes Mal kurz vor dem Lesen, wenn Sie nur eine Null schreiben und die ersten 6 Bytes lesen müssen.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In diesem Fall stand ich auch vor der Wahl einer Bibliothek für i2c. Da ich mit der bcm2835-Bibliothek nicht erfolgreich war, habe ich mich für die im Beispiel verwendete Bibliothek entschieden - dies ist die WirinPi-Bibliothek. Alles hat mit ihr geklappt. Empirisch fand ich heraus, dass die Schaltflächeninformationen in 4 und 5 Bytes enthalten sind (wenn Sie Bytes von Null zählen). Informationen zu den Schaltflächen Auswählen, Starten, Abwärts, Rechts befinden sich im vierten Byte, und Informationen zu den Schaltflächen A, B, Aufwärts und Links befinden sich im fünften Byte. Darüber hinaus befinden sich die Informationen zu den Auswahltasten unten rechts in den oberen 4 Bits des Bytes und die Informationen zu den Starttasten unten. Gleiches gilt für das 5. Byte, die Informationen zu den Schaltflächen A, B befinden sich in den oberen 4 Bits des Bytes und die Informationen zu den Schaltflächen oben links in den unteren. Hier sind die Schaltflächencodes: A - 0xcf, B - 0xbf, up - 0xf0, left - 0xf1, select - 0xcf, start - 0xf3, down - 0xbf, right - 0x7f.Das Ergebnis des gemeinsamen Drückens von Tasten, deren Informationen sich in einem Byte und in denselben Bits befinden, ist ein logisches „UND“ ihrer Codes. Wenn Sie beispielsweise die Tasten A und B gleichzeitig drücken, erhalten Sie den Wert 0x8f.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hier ist ein </font></font><a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> zur Tabelle: </font></font><br>
<br>
<img src="https://habrastorage.org/getpro/geektimes/post_images/77c/166/6b1/77c1666b13f7f2b7e71554e5e9f2d690.jpg" alt="Bild"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes habe ich ein kleines Testprogramm zum Lesen von Schaltflächen geschrieben. Im Folgenden werde ich es vollständig auflisten und erklären, was damit passiert:</font></font><br>
<br>
<pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;unistd.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wiringPi.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;wiringPiI2C.h&gt;</span></span></span></span>
<span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;errno.h&gt;</span></span></span></span>
<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> i, a, b, c, d, state;
<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> bytes[<span class="hljs-number"><span class="hljs-number">6</span></span>];
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{<font></font>
wiringPiSetup();<font></font>
<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd = wiringPiI2CSetup(<span class="hljs-number"><span class="hljs-number">0x52</span></span>);<font></font>
wiringPiI2CWriteReg8(fd, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>);<font></font>
delayMicroseconds(<span class="hljs-number"><span class="hljs-number">20</span></span>);
<span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) <font></font>
{<font></font>
	state = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
	wiringPiI2CWrite(fd, <span class="hljs-number"><span class="hljs-number">0x00</span></span>);<font></font>
        delayMicroseconds(<span class="hljs-number"><span class="hljs-number">100</span></span>);
        <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">6</span></span>; i++)<font></font>
	{<font></font>
           bytes[i] = wiringPiI2CRead(fd);<font></font>
        }<font></font>
	a = bytes[<span class="hljs-number"><span class="hljs-number">5</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
	b = bytes[<span class="hljs-number"><span class="hljs-number">5</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
	c = bytes[<span class="hljs-number"><span class="hljs-number">4</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
	d = bytes[<span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-number"><span class="hljs-number">0xc</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a == <span class="hljs-number"><span class="hljs-number">0xb</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-number"><span class="hljs-number">0xc</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (d == <span class="hljs-number"><span class="hljs-number">0x30</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-number"><span class="hljs-number">0x00</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-number"><span class="hljs-number">0xb</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (b == <span class="hljs-number"><span class="hljs-number">0x10</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c == <span class="hljs-number"><span class="hljs-number">0x7</span></span>)<font></font>
	state ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>);
	<span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"%x \n"</span></span>, state);<font></font>
	}<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
}</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu Beginn werden Variablen deklariert, mit deren Hilfe der Status einer bestimmten Schaltfläche ermittelt wird. </font><font style="vertical-align: inherit;">Es ist wichtig, dass die Variablen vom Typ char sind. Andernfalls werden bei einer bitweisen Verschiebung nach links nur 4 Nullen hinzugefügt, und das war's. </font><font style="vertical-align: inherit;">Die Interpretation wird falsch sein. </font><font style="vertical-align: inherit;">Egal wie lustig es klingt, Sie müssen den </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zauber verwenden</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Als nächstes wird im Hauptteil des Programms die WiringPi-Bibliothek initialisiert - wiringPiSetup (); und dann wird die i2c-Adresse des Geräts auf 0x52 gesetzt. </font><font style="vertical-align: inherit;">Als nächstes wird die Steuerung initialisiert:</font></font><br>
<br>
<pre><code class="cpp hljs">
wiringPiI2CWriteReg8(fd, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>);<font></font>
delayMicroseconds(<span class="hljs-number"><span class="hljs-number">20</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, dann werden bereits im Hauptteil der Schleife 6 Bytes gelesen, und vor dem Lesen wird jedes Mal Null geschrieben. </font><font style="vertical-align: inherit;">Danach wird der gedrückte Knopf bestimmt. </font><font style="vertical-align: inherit;">Im Allgemeinen wurde der gesamte Code in die Emulatordateien migriert. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Wie beim letzten Mal wird die Initialisierung der Bibliothek in der Datei fceu.c registriert:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FCEUI_Initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">
</span></span>{
    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!FCEU_InitVirtualVideo())
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;
    <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;FSettings,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(FSettings));<font></font>
    FSettings.UsrFirstSLine[<span class="hljs-number"><span class="hljs-number">0</span></span>]=<span class="hljs-number"><span class="hljs-number">8</span></span>;<font></font>
    FSettings.UsrFirstSLine[<span class="hljs-number"><span class="hljs-number">1</span></span>]=<span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
    FSettings.UsrLastSLine[<span class="hljs-number"><span class="hljs-number">0</span></span>]=<span class="hljs-number"><span class="hljs-number">231</span></span>;<font></font>
    FSettings.UsrLastSLine[<span class="hljs-number"><span class="hljs-number">1</span></span>]=<span class="hljs-number"><span class="hljs-number">239</span></span>;<font></font>
    FSettings.SoundVolume=<span class="hljs-number"><span class="hljs-number">100</span></span>;<font></font>
    FCEUPPU_Init();<font></font>
    X6502_Init();<font></font>
    wiringPiSetup();<font></font>
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>;<font></font>
}<font></font>
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun und weiter betreffen alle Änderungen nur die Datei input.c. </font><font style="vertical-align: inherit;">Zunächst werden in der Funktion FCEUI_Initialize (void) int die Betriebsmodi des GPIO-Ports für die Arbeit mit dem alten Gamepad (von Simba) festgelegt und das Gamepad initialisiert.</font></font><br>
<br>
<pre><code class="cpp hljs">
pinMode (<span class="hljs-number"><span class="hljs-number">0</span></span>, OUTPUT);<font></font>
pinMode (<span class="hljs-number"><span class="hljs-number">2</span></span>, OUTPUT);<font></font>
pinMode (<span class="hljs-number"><span class="hljs-number">3</span></span>, INPUT);<font></font>
digitalWrite (<span class="hljs-number"><span class="hljs-number">0</span></span>, HIGH);<font></font>
digitalWrite (<span class="hljs-number"><span class="hljs-number">2</span></span>, LOW);<font></font>
fd = wiringPiI2CSetup(<span class="hljs-number"><span class="hljs-number">0x52</span></span>);<font></font>
wiringPiI2CWriteReg8(fd, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>);<font></font>
usleep(<span class="hljs-number"><span class="hljs-number">20</span></span>);
</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Zu Beginn müssen Sie auch Variablen deklarieren, die das Drücken der Taste bestimmen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In der statischen DECLFW (B4016) -Funktion wird ein Strobe für das alte Gamepad mitgeliefert, der neue Strobe wird nicht benötigt:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (LastStrobe==<span class="hljs-number"><span class="hljs-number">0</span></span>)<font></font>
{<font></font>
	digitalWrite (<span class="hljs-number"><span class="hljs-number">0</span></span>, LOW);<font></font>
}<font></font>
</code></pre><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Beim Erstellen eines Testprogramms konnte ich das Problem der Identifizierung von zusammengedrückten Tasten, deren Informationen sich in einem Byte und in einem Bit befinden, nicht lösen. Am Ende habe ich das Switch-Case-Konstrukt anstelle von if else angewendet. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Nun, die Funktion selbst ist die Funktion zum Lesen des Status der Tasten:</font></font><br>
<br>
<pre><code class="cpp hljs">
<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FCEU_UpdateInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">
</span></span>{<font></font>
joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">0</span></span>;<font></font>
joy[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">0xff</span></span>;<font></font>
wiringPiI2CWrite(fd, <span class="hljs-number"><span class="hljs-number">0x00</span></span>);<font></font>
usleep(<span class="hljs-number"><span class="hljs-number">100</span></span>);
<span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">7</span></span>; i++)<font></font>
	{<font></font>
	bytes[i] = wiringPiI2CRead(fd);<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">1</span></span>] ^= digitalRead(<span class="hljs-number"><span class="hljs-number">3</span></span>) &lt;&lt; i;<font></font>
	digitalWrite (<span class="hljs-number"><span class="hljs-number">2</span></span>, HIGH);<font></font>
	delayMicroseconds (<span class="hljs-number"><span class="hljs-number">20</span></span>);<font></font>
	digitalWrite (<span class="hljs-number"><span class="hljs-number">2</span></span>, LOW);<font></font>
	delayMicroseconds (<span class="hljs-number"><span class="hljs-number">20</span></span>);<font></font>
	}<font></font>
	a = bytes[<span class="hljs-number"><span class="hljs-number">5</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
	b = bytes[<span class="hljs-number"><span class="hljs-number">5</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
	c = bytes[<span class="hljs-number"><span class="hljs-number">4</span></span>] &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>;<font></font>
	d = bytes[<span class="hljs-number"><span class="hljs-number">4</span></span>] &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (a){
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xc</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xb</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x8</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">0</span></span>);<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
	}<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (b){
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x00</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x10</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x20</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>);<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">6</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
	}<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (c){
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xc</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0xb</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x7</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x8</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>);<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x4</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">2</span></span>);<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x3</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">5</span></span>);<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">7</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
	}<font></font>
	<span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (d){
	<span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0x30</span></span>:<font></font>
	joy[<span class="hljs-number"><span class="hljs-number">0</span></span>] ^= (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>);
	<span class="hljs-keyword"><span class="hljs-keyword">break</span></span>;<font></font>
	}<font></font>
	digitalWrite (<span class="hljs-number"><span class="hljs-number">0</span></span>, HIGH);<font></font>
	}<font></font>
	</code></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
In einem Zyklus habe ich das Lesen von Schaltflächen von beiden Gamepads kombiniert. Nun, denken Sie, dass 2 zusätzliche Bytes gelesen werden. Es spielt keine Rolle, aber alles geschieht gleichzeitig. </font><font style="vertical-align: inherit;">Und es gibt keine Verzögerungen. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Im Allgemeinen ist alles in Ordnung. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Soweit ich mich erinnere, morgen bei der Arbeit schon verzerrt. </font></font><br>
<br>
<b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PPS Ich habe</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> vergessen, dass Sie für eine erfolgreiche Kompilierung im Makefile (das nach Ausführung des Befehls Configure erstellt wurde) im Verzeichnis src -lwiringPi -lm -lrt an der Stelle hinzufügen müssen, an der die Bibliotheksabhängigkeiten geschrieben werden. </font><font style="vertical-align: inherit;">Zeile:</font></font><br>
<br>
<pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">LIBS</span></span> =</code></pre></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de400445/">https://habr.com/ru/post/de400445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de400433/index.html">SpaceX im Jahr 2017: Riesige Pläne</a></li>
<li><a href="../de400435/index.html">Im Jahr 2017 wird es scheitern, ein einsames Genie zu sein</a></li>
<li><a href="../de400439/index.html">Drahtloser Heimkino-Sound: Das Mehl der Wahl - eine Fülle von Formaten, Möglichkeiten und Herausforderungen</a></li>
<li><a href="../de400441/index.html">Handwerker in NES Classic gehackt, jetzt können Spiele über USB heruntergeladen werden</a></li>
<li><a href="../de400443/index.html">Solarbetriebene stratosphärische Flugzeuge, die der Welt gezeigt werden</a></li>
<li><a href="../de400447/index.html">Acer C710: Installation von Windows 10</a></li>
<li><a href="../de400449/index.html">2016 Geek Hits</a></li>
<li><a href="../de400451/index.html">IBM 5 in 5: fünf Innovationen, die unser Leben in den nächsten fünf Jahren verändern werden</a></li>
<li><a href="../de400453/index.html">Warum sind die Überreste von Sternen grün?</a></li>
<li><a href="../de400455/index.html">Vor 10 Jahren sah die Welt das iPhone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>