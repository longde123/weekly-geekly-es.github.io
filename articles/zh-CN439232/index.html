<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>⏰ 👨🏽‍🌾 🏂🏻 JAMstack：如何使用Gatsby + Contentful + Netlify创建自己的博客 ☠️ ↙️ 💶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="您是否听说过新的JAMstack方法？ 能够在您喜欢的框架上编写Web应用程序，从管理面板管理内容以及输出根据SEO，PWA和a11y的最新建议构建的完全有效的HTML页面的功能。 


 有意思吗 然后是本文要考虑的问题列表： 


- 这个新堆栈是什么，为什么需要它？ 
- 如何使用Gatsby...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>JAMstack：如何使用Gatsby + Contentful + Netlify创建自己的博客</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439232/"><p><img src="https://habrastorage.org/webt/ap/fg/uw/apfguwd5gvfztoa2etpeg4m9thq.jpeg"></p><br><p>您是否听说过新的JAMstack方法？ 能够在您喜欢的框架上编写Web应用程序，从管理面板管理内容以及输出根据SEO，PWA和a11y的最新建议构建的完全有效的HTML页面的功能。 </p><br><p> 有意思吗 然后是本文要考虑的问题列表： </p><br><ul><li> 这个新堆栈是什么，为什么需要它？ </li><li> 如何使用Gatsby运行基本应用程序？ </li><li> 处理内容丰富并创建第一批数据 </li><li> 如何使用GraphQL链接Content和Gatsby？ </li><li> 使用Netlify设置自动部署 </li></ul><a name="habracut"></a><br><h2 id="jamstack"> 果酱堆 </h2><br><p> 如您所知：“所有新事物都早已被遗忘了”，这是另一个确认-mod返回静态站点。 十年前的互联网是什么？ 这是一个PHP服务器渲染，将数据库中的数据替换为HTML模板并将其发送到客户端。 </p><br><p><img src="https://habrastorage.org/webt/nk/4j/lr/nk4jlri46dpf-yeilgloknxtx8o.png" alt="服务器渲染"></p><br><p> 这种方法已被JavaScript框架所取代，JavaScript框架近年来以<em>React Angular Vue</em>网站的三位一体为代表。 <del> 阿门 </del>  。 基本区别是什么？ 界面的速度和响应能力，因为现在网站的所有逻辑都在客户端上，并且对于鼠标的任何移动，您都可以调用内容不断变化的精美动画，并向API发送请求。 </p><br><p><img src="https://habrastorage.org/webt/yz/yl/yd/yzylydcklduuinekhlfcf6lqwmk.png" alt="客户渲染"></p><br><p> 接下来是什么？  JAM提供： </p><br><ul><li> 没有服务器端渲染，并且确实删除了服务器本身 </li><li>没有客户端渲染，向下显示<code>&lt;div id=”root”&gt;&lt;/div&gt;</code> </li><li> 内容更改时，一次将网站编译为常规HTML代码 </li><li> 网站托管于任何文件托管 </li></ul><br><p><img src="https://habrastorage.org/webt/s_/cl/8x/s_cl8xgwabvmmlr8yp7rssmwg48.png" alt="卡纸"></p><br><p> 客户端始终会收到具有完全有效布局的预渲染页面，而性能问题现在仅涉及Internet连接的速度（但是，当然，请不要忘记开发人员的直接性系数）。 </p><br><h2 id="instrumentariy"> 工具包 </h2><br><p>  JAM只是市场上已经有足够资金的一种方法，但是如您所知，钉子可以用任何东西锤打，但我更喜欢锤子。 </p><br><p><img src="https://habrastorage.org/webt/xi/vo/pj/xivopjhctvjyvgk2dsyftct1kfq.gif" alt="锤钉"></p><br><p>  <strong>2019年最佳工具列表：</strong> </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gatsby</a>是来自<em>React + GraphQL</em>应用程序的静态站点生成器。 为什么我选择不知所措而不是<em>Angular</em>或<em>Vue</em>是一个选择，但最有可能的问题在于邪恶的统计数据，它说尽管有所有争议，但<em>React是</em>过去三年中最受欢迎的框架（对于此声明，请不要在评论中向我扔石头，对此声明，实际付给我）。 为了提供更直观的呈现， <code>create-react-app</code>编译JavaScript构建中的代码，以在页面启动时进一步呈现，Gatsby生成具有有效布局的完整HTML页面，这些页面按原样显示，即使关闭JS也是如此。 </p><br><p> 内容<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">丰富</a> -静态页面上的内容管理系统。 这是<em>WordPress</em> ，它不会保留模板与数据库中数据之间的关系，而是直接在HTML文件中更改数据。 </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Netlify</a>是一个非常易于使用的部署系统，它使您可以将最流行的文件托管服务与JAM应用程序甚至HTTPS协议连接。 </p><br><h2 id="ot-teorii-k-praktike"> 从理论到实践 </h2><br><p> 现在您已经确定了工具-您可以继续。 </p><br><h3 id="contentful"> 有满足感 </h3><br><p> 我们创建了一个帐户，并看到默认情况下该服务会生成一个模型项目，我建议立即删除该模型项目，因为从我的主观观点来看，它比帮助解决它更多。 我们创建了一个新的免费项目，而没有生成示例。 </p><br><p> 内容管理系统基于两个实体- <strong>内容模型</strong> （用于描述结构和数据类型）以及<strong>内容本身</strong> 。 首先，为我们的博客创建一个简单的模型。  <strong>内容模型</strong>由数据类型组成，例如，对于博客，数据类型为： <em>Article</em> ， <em>Person</em> 。 </p><br><p><img src="https://habrastorage.org/webt/tf/h_/ae/tfh_aezqyltilbnfometsxytrfg.gif"></p><br><blockquote> 当然，您可以选择自己喜欢的任何抽象级别，例如，可以消除<em>Person</em>并在<em>Article</em>内部指定有关作者的信息，例如<em>Article.author_name。</em> </blockquote><br><div class="spoiler">  <b class="spoiler_title">我的模型的结构</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> article/ ├── title (Short text) ├── text (Long text) ├── banner (Single media) └── publishedAt (Date &amp; Time) person/ ├── fullName (Short text) └── avatar (Single media)</code> </pre> </div></div><br><p> 接下来，使用已经创建的数据类型，添加内容，对于文本，您可以使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">SaganIpsum</a>来<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">生成Unsplash</a>图像。 </p><br><p><img src="https://habrastorage.org/webt/t_/je/1u/t_je1uev3db2j6-io_f7xpnq9fm.gif" alt="有内容的添加内容"></p><br><h3 id="gatsby"> 盖茨比 </h3><br><p> 我们打开终端并创建工作环境 </p><br><pre> <code class="plaintext hljs">##  npm install --global gatsby-cli ##   gatsby new personal-blog ##      Hello World  ## gatsby new minimal-gatsby https://github.com/gatsbyjs/gatsby-starter-hello-world ##    cd personal-blog</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">项目结构</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> personal-blog/ ├── gatsby-browser.js ├── gatsby-config.js ├── gatsby-node.js ├── gatsby-ssr.js ├── LICENSE ├── node_modules ├── package.json ├── README.md └── src ├── components │ ├── header.js │ ├── image.js │ ├── layout.css │ ├── layout.js │ └── seo.js ├── images │ ├── gatsby-astronaut.png │ └── gatsby-icon.png └── pages ├── 404.js ├── index.js └── page-2.js</code> </pre> </div></div><br><pre> <code class="plaintext hljs">##    hot-reloading gatsby develop</code> </pre> <br><p> 怎么了 使用<em>Gatsby</em>构建了<em>React + GraphQL</em>应用程序，这意味着您可以将需要很长时间的任何旧项目转换为静态HTML网站，并可以将速度提高数倍。 </p><br><h3 id="gatsbycontentful"> 盖茨比+知足 </h3><br><pre> <code class="plaintext hljs">##    npm install gatsby-source-contentful dotenv</code> </pre> <br><p> 在应用程序的根目录中创建具有以下内容的<em>.env</em>文件： </p><br><pre> <code class="plaintext hljs">/* 12-    Contentful → Settings → API keys → Example key 1→ Space ID */ CONTENTFUL_SPACE_ID=xxxxxxxxxxxx /* 64-    Contentful → Settings → API keys → Example key 1→ Content Delivery API - access token */ CONTENTFUL_ACCESS_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</code> </pre> <br><p>  <em>扩展gatsby-config.js中的</em>配置： </p><br><pre> <code class="plaintext hljs">if (process.env.NODE_ENV === "development") { require("dotenv").config(); } module.exports = { /* other settings */ plugins: [ /* other plugins */ { resolve: `gatsby-source-contentful`, options: { spaceId: process.env.CONTENTFUL_SPACE_ID, accessToken: process.env.CONTENTFUL_ACCESS_TOKEN, }, } ] }</code> </pre> <br><p> 我们重新启动Gatsby服务器，如果控制台未显示任何错误，则表明与Contentful的连接已建立，您可以继续进行。 </p><br><h3 id="gatsbygraphqlcontentful">  Gatsby + GraphQL +内容丰富 </h3><br><p> 如果您不熟悉GraphQL，请不要担心，因为它非常简单。 我们的网站现在位于： </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">http：//本地主机：8000 /</a> </p><br><p> 但现在，我们将其保留并打开第二个选项卡： </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">HTTP：// //本地主机：8000 / ___ graphql</a> </p><br><p> 在我们<em>面前</em>的是浏览器中的<em>GraphQL</em> IDE。 有了它，构建查询和测试它们非常方便。 单击右上角的“ <strong>文档</strong> ”以展开包含文档的侧栏，但是令人惊讶的是，这不是<em>GraphQL</em>文档，这是您的API文档。 展开<strong>查询</strong>列表以查看所有可用的查询模式及其数据类型。 </p><br><p> 我们感兴趣的电路大致具有以下名称： </p><br><p>  <strong>内容</strong> <em>丰富的YourDataType-</em>一个实例 <br>  <strong>allContentful</strong> <em>YourDataType-</em>实例列表 </p><br><div class="spoiler">  <b class="spoiler_title">我的数据示例</b> <div class="spoiler_text"><ul><li> 充实的文章 </li><li> 满意的人 </li><li>  allContentfulArticle </li><li>  allContentfulPerson </li></ul></div></div><br><p> 使用左侧面板，我们将为数据构建正确的查询（尝试自动完成，非常方便）。 </p><br><div class="spoiler">  <b class="spoiler_title">请求一个Person类型的实例和Article中的列表的示例</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> { contentfulPerson { fullName avatar { file { url } } } allContentfulArticle { edges { node { title text { text } banner { file { url } } publishedAt } } } }</code> </pre> </div></div><br><p> 从查询结构可以注意到什么： </p><br><ul><li> 要获取文件的URL，您需要转到路径<code>typeName.file.url</code> </li><li> 要从长文本类型获取文本，请沿着路径<code>typeName.typeName</code> </li><li> 要获取某种类型的实例的列表，您需要使用以下路径<code>allContentfulName.edges</code> </li></ul><br><p> 我们将请求方案转移到项目中，并像在React应用程序中的常规数据一样呈现它。 通常公认的最佳实践是使用<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">gatsby</a>软件包中的<code>&lt;StaticQuery /&gt;</code>组件，该组件已安装在项目中。 </p><br><div class="spoiler">  <b class="spoiler_title">示例index.js文件</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react" import { StaticQuery, graphql } from "gatsby" import Layout from "../components/layout" import Article from "../components/article" const IndexPage = () =&gt; ( &lt;Layout&gt; &lt;StaticQuery query={graphql` { allContentfulArticle { edges { node { id title text { text } banner { file { url } } publishedAt } } } } `} render={({ allContentfulArticle: { edges } }) =&gt; ( edges.map(({ node }) =&gt; ( &lt;Article key={node.id} content={node} /&gt; )) )} /&gt; &lt;/Layout&gt; ) export default IndexPage</code> </pre> </div></div><br><p> 如何运作？  <em>graphQL</em> <code>query</code>模式传递给查询，而我们最喜欢的JSX传递给。 使用解构使代码更具可读性。 </p><br><div class="spoiler">  <b class="spoiler_title">通过组件/ article.js的示例进行重组</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> import React from "react" const Article = ({ content: { title, text, banner: { file: { url } }, publishedAt } }) =&gt; ( &lt;div&gt; &lt;h2&gt;{title}&lt;/h2&gt; &lt;img src={url} alt={title}/&gt; &lt;p&gt; {text} &lt;/p&gt; &lt;h5&gt;{publishedAt}&lt;/h5&gt; &lt;/div&gt; ) export default Article</code> </pre> </div></div><br><p> 现在已经很清楚如何获取和呈现数据，您可以开始开发了，但是由于本文不是关于如何使站点发生反应，因此我们将省略这一时刻，并假设站点已准备就绪。 </p><br><p> 我们将把项目发布在GitHub上，从那里可以在下一步进行部署。 </p><br><div class="spoiler">  <b class="spoiler_title">对于那些仍然不知道该怎么做的人</b> <div class="spoiler_text"><pre> <code class="plaintext hljs"> ##         git init ##    git add . git commit -m “initial commit” ##    GitHub   git remote add origin git@github.com:yourname/my-repository-name.git ##   git push origin master</code> </pre> </div></div><br><h3 id="nastraivaem-netlify"> 配置Netlify </h3><br><p> 我们使用您计划在其上放置项目的服务创建一个帐户。 我选择了GitHub，因此在成功授权后，我们将配置一个新项目，单击<strong>Git中的New site</strong> 。 我们连接存储库， <em>Netlify</em>将自动确定这是一个<em>Gatsby</em>项目，并配置所有脚本进行汇编。 </p><br><p> 我们选择所需的分支，不要忘记环境变量，为此，我们打开“ <strong>高级设置”</strong>菜单并添加本地<em>.env</em>文件的内容并确认设置。 </p><br><p> 几分钟的魔术和一个现场： <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">https://tender-liskov-ce3ad0.netlify.com</a> </p><br><p> 仍然需要添加一个钩子来更新内容。 转到设置： </p><br><p>  <strong>部署设置→构建挂钩→添加构建挂钩</strong> <br><img src="https://habrastorage.org/webt/qp/ry/1o/qpry1oyehcw2wvh9v9yq--odrgg.gif" alt="netlify webhook"><br> 我们设置任何友好的名称，例如<em>“ Contentful hook”</em> ，选择用于构建并确认的分支。 结果是一个链接，复制并转到<em>内容</em>面板： </p><br><p>  <strong>设置→Webhooks</strong> <br><img src="https://habrastorage.org/webt/he/en/i8/heeni8del9_aw7o-wlgkypmb6b0.gif" alt="有意思的网络挂钩"><br> 我们正在右侧面板上寻找<em>Netlify</em>的模板， <em>然后</em>单击两次以连接两个系统。 我们正在尝试更改内容，并查看新数据在网站上的显示方式。 </p><br><h2 id="itogo"> 合计 </h2><br><p>  JAM-stack结合了解决以前方法问题的解决方案，似乎冒充了实力和在世界范围内的知名度，但这是一场革命吗？ 没有什么新奇的东西，但这是过去两年中最先进的方法， <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">在国外</a> ，在我们这里吗？ 我们刚刚开始将项目从<em>WordPress</em>转移到<em>React，</em>这肯定是进步，但是为了不跟传说中的印度外包一样落伍，是时候采取更具决定性的步骤了吗？ </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">链接到项目的存储库</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439232/">https://habr.com/ru/post/zh-CN439232/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439218/index.html">VK机器人跪在地上，或如何在2月14日取悦人们</a></li>
<li><a href="../zh-CN439220/index.html">Unity上移动设备的大城市。 开发和优化经验</a></li>
<li><a href="../zh-CN439222/index.html">什么是API管理？</a></li>
<li><a href="../zh-CN439224/index.html">关于Voronoi图</a></li>
<li><a href="../zh-CN439226/index.html">Scala + MXNet =产品中带有神经元的微服务</a></li>
<li><a href="../zh-CN439234/index.html">开源开发人员在GIF中的生活</a></li>
<li><a href="../zh-CN439236/index.html">xenvman：灵活的微服务测试环境（以及更多）</a></li>
<li><a href="../zh-CN439238/index.html">Play商店现在接受渐进式Web应用程序（PWA）</a></li>
<li><a href="../zh-CN439240/index.html">2019年1月的Joomla摘要</a></li>
<li><a href="../zh-CN439244/index.html">FAS强烈建议在俄罗斯联邦出售的智能手机和笔记本电脑上预装俄语软件</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>