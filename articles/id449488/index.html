<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¼â€ğŸ³ ğŸ“« ğŸ•œ Cataclysm Dark Days Ahead: Analisis Statis dan Permainan Roguelike ğŸ¤ğŸ¿ ğŸ‘ˆ ğŸ¤°ğŸ½</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anda pasti sudah menebak dari judul bahwa artikel hari ini akan berfokus pada bug dalam kode sumber perangkat lunak. Tapi tidak hanya itu. Jika Anda t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cataclysm Dark Days Ahead: Analisis Statis dan Permainan Roguelike</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/449488/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f8/70b/ef1/2f870bef158597577eac654a524b00ac.png" alt="Gambar 5"></div><br>  Anda pasti sudah menebak dari judul bahwa artikel hari ini akan berfokus pada bug dalam kode sumber perangkat lunak.  Tapi tidak hanya itu.  Jika Anda tidak hanya tertarik pada C ++ dan membaca tentang bug dalam kode pengembang lain, tetapi juga menggali video game yang tidak biasa dan bertanya-tanya apa itu "roguelikes" dan bagaimana Anda memainkannya, maka selamat datang untuk membaca! <br><a name="habracut"></a><br>  Saat mencari gim yang tidak biasa, saya menemukan <i>Cataclysm Dark Days Ahead</i> , yang menonjol di antara gim lain berkat grafisnya yang didasarkan pada karakter ASCII dengan berbagai warna yang tersusun pada latar belakang hitam. <br><br>  Satu hal yang mengherankan Anda tentang hal ini dan permainan serupa lainnya adalah seberapa banyak fungsionalitas yang dibangun di dalamnya.  Khususnya di <i>Cataclysm</i> , misalnya, Anda bahkan tidak dapat membuat karakter tanpa merasakan dorongan untuk google beberapa panduan karena lusinan parameter, sifat, dan skenario awal yang tersedia, belum lagi berbagai variasi peristiwa yang terjadi sepanjang permainan. <br><br>  Karena ini adalah permainan dengan kode sumber terbuka, dan yang ditulis dalam C ++, kami tidak bisa berjalan tanpa memeriksanya dengan penganalisa kode statis kami PVS-Studio, yang dalam perkembangannya saya berpartisipasi aktif.  Kode proyek ini ternyata berkualitas tinggi, tetapi masih memiliki beberapa cacat kecil, beberapa di antaranya akan saya bahas dalam artikel ini. <br><br>  Cukup banyak game yang sudah diperiksa dengan PVS-Studio.  Anda dapat menemukan beberapa contoh di artikel kami " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Analisis Statis dalam Pengembangan Video Game: 10 Bug Perangkat Lunak Teratas</a> ". <br><br><h2>  Logika </h2><br>  <b>Contoh 1:</b> <br><br>  Contoh ini menunjukkan kesalahan salin-tempel klasik. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V501</a> Ada sub-ekspresi identik ke kiri dan ke kanan '||'  operator: rng (2, 7) &lt;abs (z) ||  rng (2, 7) &lt;abs (z) overmap.cpp 1503 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> overmap::generate_sub( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> z ) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( rng( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) &lt; <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>( z ) || rng( <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span> ) &lt; <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>( z ) ) { .... } .... }</code> </pre> <br>  Kondisi yang sama diperiksa dua kali.  Pemrogram menyalin ekspresi tetapi lupa untuk memodifikasi salinan.  Saya tidak yakin apakah ini bug yang kritis, tetapi faktanya cek itu tidak berfungsi sebagaimana mestinya. <br><br>  Kesalahan serupa lainnya: <br><br><ul><li>  V501 Ada sub-ekspresi identik 'one_in (100000 / to_turns &lt;int&gt; (dur))' di sebelah kiri dan di sebelah kanan operator '&amp;&amp;'.  player_hardcoded_effects.cpp 547 </li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d92/a93/7ac/d92a937ac860e5f2fb5ded04b8e05683.png" alt="Gambar 11"></div><br>  <b>Contoh 2:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V728</a> Pemeriksaan berlebihan dapat disederhanakan.  The '(A &amp;&amp; B) ||  Ekspresi (! A &amp;&amp;! B) 'sama dengan ekspresi' bool (A) == bool (B) '.  inventory_ui.cpp 199 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> inventory_selector_preset::sort_compare( .... ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> left_fav = g-&gt;u.inv.assigned.count( lhs.location-&gt;invlet ); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> right_fav = g-&gt;u.inv.assigned.count( rhs.location-&gt;invlet ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ( left_fav &amp;&amp; right_fav ) || ( !left_fav &amp;&amp; !right_fav ) ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> .... } .... }</code> </pre> <br>  Kondisi ini secara logis benar, tetapi terlalu rumit.  Siapa pun yang menulis kode ini seharusnya mengasihani sesama programmer yang akan mempertahankannya.  Itu dapat ditulis ulang dalam bentuk yang lebih sederhana: <i>if (left_fav == right_fav)</i> . <br><br>  Kesalahan serupa lainnya: <br><br><ul><li>  V728 Pemeriksaan berlebihan dapat disederhanakan.  The '(A &amp;&amp;! B) ||  Ekspresi (! A &amp;&amp; B) 'sama dengan ekspresi' bool (A)! = Bool (B) '.  iuse_actor.cpp 2653 </li></ul><br><h2>  Digresi i </h2><br>  Saya terkejut menemukan bahwa game yang menggunakan nama "roguelikes" saat ini hanyalah perwakilan yang lebih moderat dari genre lama game roguelike.  Semuanya dimulai dengan game cult <i>Rogue</i> of 1980, yang menginspirasi banyak siswa dan programmer untuk membuat game mereka sendiri dengan elemen serupa.  Saya kira banyak pengaruh juga datang dari komunitas game meja <i>DnD</i> dan variasinya. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4dc/d85/de3/4dcd85de3509609962cab730653f7ed1.png" alt="Gambar 8"></div><br><h2>  Optimalisasi mikro </h2><br>  <b>Contoh 3:</b> <br><br>  Peringatan pada grup ini menunjukkan titik-titik yang berpotensi dioptimalkan daripada bug. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V801</a> Menurunkan Kinerja.  Lebih baik mendefinisikan kembali argumen fungsi kedua sebagai referensi.  Pertimbangkan untuk mengganti 'const ... ketik' dengan 'const ... &amp; ketik'.  map.cpp 4644 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Stack&gt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;item&gt; use_amount_stack( Stack <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> itype_id type ) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;item&gt; ret; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>.begin(); a != <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>.end() &amp;&amp; quantity &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( a-&gt;use_amount( type, ret ) ) { a = <span class="hljs-built_in"><span class="hljs-built_in">stack</span></span>.erase( a ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ++a; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }</code> </pre><br>  Dalam kode ini, <i>itype_id</i> sebenarnya adalah <i>std :: string yang</i> disamarkan.  Karena argumen dilewatkan sebagai konstanta, yang artinya tidak dapat diubah, hanya dengan memberikan referensi ke variabel akan membantu meningkatkan kinerja dan menghemat sumber daya komputasi dengan menghindari operasi penyalinan.  Dan meskipun string itu tidak mungkin panjang, menyalinnya setiap kali tanpa alasan yang baik adalah ide yang buruk - terlebih lagi karena fungsi ini dipanggil oleh berbagai penelepon, yang, pada gilirannya, juga mendapatkan <i>tipe</i> dari luar dan memiliki untuk menyalinnya. <br><br>  Masalah serupa: <br><br><ul><li>  V801 Menurunkan Kinerja.  Lebih baik mendefinisikan kembali argumen fungsi ketiga sebagai referensi.  Pertimbangkan untuk mengganti 'const ... evt_filter' dengan 'const ... &amp; evt_filter'.  input.cpp 691 </li><li>  V801 Menurunkan Kinerja.  Lebih baik mendefinisikan kembali argumen fungsi kelima sebagai referensi.  Pertimbangkan untuk mengganti 'const ... color' dengan 'const ... &amp; color'.  output.h 207 </li><li>  Penganalisa mengeluarkan total 32 peringatan dari jenis ini. </li></ul><br>  <b>Contoh 4:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V813</a> Menurunkan Kinerja.  Argumen 'str' mungkin harus diterjemahkan sebagai referensi konstan.  catacharset.cpp 256 <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base64_encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> str )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( str.length() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; str[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">'#'</span></span> ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> input_length = str.length(); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encoded_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( output_length, </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'\0'</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; input_length; ) { .... } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; mod_table[input_length % <span class="hljs-number"><span class="hljs-number">3</span></span>]; i++ ) { encoded_data[output_length - <span class="hljs-number"><span class="hljs-number">1</span></span> - i] = <span class="hljs-string"><span class="hljs-string">'='</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"#"</span></span> + encoded_data; }</code> </pre> <br>  Meskipun argumennya tidak konstan, ia tidak berubah dalam fungsi tubuh dengan cara apa pun.  Oleh karena itu, demi optimasi, solusi yang lebih baik adalah memberikannya dengan referensi konstan daripada memaksa kompiler untuk membuat salinan lokal. <br><br>  Peringatan ini tidak datang sendiri juga;  jumlah total peringatan jenis ini adalah 26. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ff/557/9b3/4ff5579b36733a7bd46f4c3df6f30d90.png" alt="Gambar 7"></div><br>  Masalah serupa: <br><br><ul><li>  V813 Menurunkan Kinerja.  Argumen 'pesan' mungkin harus diterjemahkan sebagai referensi konstan.  json.cpp 1452 </li><li>  V813 Menurunkan Kinerja.  Argumen 's' mungkin harus diterjemahkan sebagai referensi konstan.  catacharset.cpp 218 </li><li>  Dan seterusnya ... </li></ul><br><h2>  Digresi ii </h2><br>  Beberapa game roguelike klasik masih dalam pengembangan aktif.  Jika Anda memeriksa gudang GitHub dari <i>Cataclysm DDA</i> atau <i>NetHack</i> , Anda akan melihat bahwa perubahan dikirimkan setiap hari.  <i>NetHack</i> sebenarnya adalah game tertua yang masih dikembangkan: dirilis pada Juli 1987, dan versi terakhir kembali ke 2018. <br><br>  <i>Dwarf Fortress</i> adalah salah satu permainan genre yang paling populer - meskipun lebih muda.  Pengembangan dimulai pada tahun 2002 dan versi pertama dirilis pada tahun 2006. Moto nya "Kehilangan menyenangkan" mencerminkan fakta bahwa tidak mungkin untuk menang dalam permainan ini.  Pada tahun 2007, <i>Dwarf Fortress</i> dianugerahi "Game Roguelike Terbaik Tahun Ini" dengan pemungutan suara yang diadakan setiap tahun di situs ASCII GAMES. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e39/7fb/efa/e397fbefa4204777cc74d97e2b8e52e9.png" alt="Gambar 6"></div><br>  Ngomong-ngomong, penggemar mungkin senang mengetahui bahwa <i>Dwarf Fortress</i> datang ke Steam dengan grafis 32-bit yang ditingkatkan ditambah oleh dua modder berpengalaman.  Versi premium juga akan mendapatkan trek musik tambahan dan dukungan Steam Workshop.  Pemilik salinan berbayar akan dapat beralih ke grafik ASCII lama jika mereka mau.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Lebih banyak</a> <br><br><h2>  Mengganti operator penugasan </h2><br>  <b>Contoh 5, 6:</b> <br><br>  Berikut beberapa peringatan menarik. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V690</a> Kelas 'JsonObject' mengimplementasikan copy constructor, tetapi tidak memiliki operator '='.  Berbahaya menggunakan kelas semacam itu.  json.h 647 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonObject</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: .... JsonIn *jsin; .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: JsonObject( JsonIn &amp;jsin ); JsonObject( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JsonObject &amp;jsobj ); JsonObject() : positions(), start( <span class="hljs-number"><span class="hljs-number">0</span></span> ), end( <span class="hljs-number"><span class="hljs-number">0</span></span> ), jsin( <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) {} ~JsonObject() { finish(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// moves the stream to the end of the object .... void JsonObject::finish() { .... } .... }</span></span></code> </pre> <br>  Kelas ini memiliki konstruktor salinan dan destruktor tetapi tidak menimpa operator penugasan.  Masalahnya adalah bahwa operator penugasan yang dibuat secara otomatis dapat menetapkan penunjuk hanya untuk <i>JsonIn</i> .  Akibatnya, kedua objek kelas <i>JsonObject</i> akan menunjuk ke <i>JsonIn yang</i> sama.  Saya tidak bisa mengatakan dengan pasti apakah situasi seperti itu dapat terjadi dalam versi saat ini, tetapi seseorang pasti akan jatuh ke dalam perangkap ini suatu hari nanti. <br><br>  Kelas selanjutnya memiliki masalah yang sama. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V690</a> Kelas 'JsonArray' mengimplementasikan copy constructor, tetapi tidak memiliki operator '='.  Berbahaya menggunakan kelas semacam itu.  json.h 820 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonArray</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: .... JsonIn *jsin; .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: JsonArray( JsonIn &amp;jsin ); JsonArray( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> JsonArray &amp;jsarr ); JsonArray() : positions(), ...., jsin( <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ) {}; ~JsonArray() { finish(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finish</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// move the stream position to the end of the array void JsonArray::finish() { .... } }</span></span></code> </pre> <br>  Bahaya tidak mengesampingkan operator penugasan di kelas yang kompleks dijelaskan secara rinci dalam artikel " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Hukum Dua Besar</a> ". <br><br>  <b>Contoh 7, 8:</b> <br><br>  Keduanya juga menangani penugasan operator penugasan, tetapi kali ini implementasi spesifik dari itu. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V794</a> Operator penugasan harus dilindungi dari kasus 'this == &amp; other'.  mattack_common.h 49 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringRef</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">friend</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StringRefTestAccess</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>* m_start; size_type m_size; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* m_data = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> = ( StringRef <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> &amp;other ) <span class="hljs-keyword"><span class="hljs-keyword">noexcept</span></span> -&gt; StringRef&amp; { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] m_data; m_data = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; m_start = other.m_start; m_size = other.m_size; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br>  Implementasi ini tidak memiliki perlindungan terhadap penugasan potensial, yang merupakan praktik yang tidak aman.  Artinya, melewatkan <i>*</i> referensi ini ke operator ini dapat menyebabkan kebocoran memori. <br><br>  Berikut adalah contoh yang mirip dari operator penugasan yang ditimpa secara tidak benar dengan efek samping yang aneh: <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V794</a> Operator penugasan harus dilindungi dari kasus 'this == &amp; rhs'.  player_activity.cpp 38 <br><br><pre> <code class="cpp hljs">player_activity &amp;player_activity::<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>=( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> player_activity &amp;rhs ) { type = rhs.type; .... targets.clear(); targets.reserve( rhs.targets.size() ); <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::transform( rhs.targets.begin(), rhs.targets.end(), <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::back_inserter( targets ), []( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> item_location &amp; e ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e.clone(); } ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre><br>  Kode ini tidak memiliki pengecekan terhadap penugasan sendiri, dan selain itu, memiliki vektor yang harus diisi.  Dengan implementasi operator penugasan ini, menetapkan objek untuk dirinya sendiri akan menghasilkan penggandaan vektor di bidang <i>target</i> , dengan beberapa elemen menjadi rusak.  Namun, <i>transformasi</i> diawali dengan <i>jelas</i> , yang akan menghapus vektor objek, sehingga menyebabkan hilangnya data. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/618/b4e/dd8/618b4edd868317d8e9e6a0e5d82cb5d0.png" alt="Gambar 3"></div><br><h2>  Digresi iii </h2><br>  Pada 2008, roguelikes bahkan mendapat definisi formal yang dikenal dengan judul epik "Berlin Interpretation".  Menurutnya, semua game tersebut berbagi elemen berikut: <br><br><ul><li>  Dunia yang dihasilkan secara acak, yang meningkatkan replayability; </li><li>  Permadeath: jika karakter Anda mati, mereka mati untuk selamanya, dan semua barang mereka hilang; </li><li>  Gameplay berbasis giliran: setiap perubahan hanya terjadi bersamaan dengan tindakan pemain;  aliran waktu ditangguhkan sampai pemain melakukan suatu tindakan; </li><li>  Kelangsungan hidup: sumber daya sangat sedikit. </li></ul><br>  Akhirnya, fitur paling penting dari roguelikes adalah fokus utamanya pada penjelajahan dunia, menemukan kegunaan baru untuk barang-barang, dan merangkak di bawah tanah. <br><br>  Ini adalah situasi umum dalam <i>Cataclysm DDA</i> agar karakter Anda berakhir beku sampai ke tulang, kelaparan, haus, dan, untuk melengkapi semuanya, kedua kaki mereka diganti dengan enam tentakel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8fe/f8e/b69/8fef8eb69a48050011726fe47ec1da35.png" alt="Gambar 15"></div><br><h2>  Detail itu penting </h2><br>  <b>Contoh 9:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V1028</a> Kemungkinan meluap.  Pertimbangkan casting operan dari operator 'mulai + lebih besar' ke tipe 'size_t', bukan hasilnya.  worldfactory.cpp 638 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> worldfactory::draw_mod_list( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> &amp;start, .... ) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> larger = ....; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iNum = ....; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( .... ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( iNum &gt;= <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;( start ) &amp;&amp; iNum &lt; <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span>&gt;( start + larger ) ) { .... } .... } .... }</code> </pre> <br>  Sepertinya programmer ingin mengambil tindakan pencegahan terhadap overflow.  Namun, mempromosikan jenis jumlah tidak akan membuat perbedaan karena limpahan akan terjadi sebelum itu, pada langkah menambahkan nilai, dan promosi akan dilakukan di atas nilai yang tidak berarti.  Untuk menghindari ini, hanya satu dari argumen yang harus dilemparkan ke tipe yang lebih luas: <i>(static_cast &lt;size_t&gt; (start) + lebih besar)</i> . <br><br>  <b>Contoh 10:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V530</a> Nilai balik fungsi 'ukuran' diperlukan untuk digunakan.  worldfactory.cpp 1340 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> worldfactory::world_need_lua_build( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> world_name ) { <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> LUA .... #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Prevent unused var error when LUA and RELEASE enabled. world_name.size(); return false; }</span></span></span></span></code> </pre> <br>  Ada satu trik untuk kasus seperti ini.  Jika Anda berakhir dengan variabel yang tidak digunakan dan Anda ingin menekan peringatan kompiler, cukup tulis <i>(kosong) world_name</i> alih-alih memanggil metode pada variabel itu. <br><br>  <b>Contoh 11:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V812</a> Menurunkan Performa.  Penggunaan fungsi 'hitungan' yang tidak efektif.  Itu mungkin dapat diganti dengan panggilan ke fungsi 'temukan'.  player.cpp 9600 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> player::read( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> inventory_position, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> continuous ) { .... player_activity activity; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !continuous || !<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::all_of( learners.begin(), learners.end(), [&amp;]( <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::pair&lt;npc *, <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; elem ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::count( activity.values.begin(), activity.values.end(), elem.first-&gt;getID() ) != <span class="hljs-number"><span class="hljs-number">0</span></span>; } ) { .... } .... }</code> </pre> <br>  Fakta bahwa <i>hitungan</i> dibandingkan dengan nol menunjukkan bahwa programmer ingin mengetahui apakah <i>aktivitas</i> mengandung setidaknya satu elemen yang diperlukan.  Tetapi <i>hitungan</i> harus berjalan melalui seluruh wadah karena menghitung semua kejadian elemen.  Pekerjaan dapat dilakukan lebih cepat dengan menggunakan <i>find</i> , yang berhenti setelah kejadian pertama ditemukan. <br><br>  <b>Contoh 12:</b> <br><br>  Bug ini mudah ditemukan jika Anda mengetahui satu detail rumit tentang tipe <i>char</i> . <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V739</a> EOF tidak boleh dibandingkan dengan nilai tipe 'char'.  'Ch' harus dari tipe 'int'.  json.cpp 762 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> JsonIn::skip_separator() { <span class="hljs-keyword"><span class="hljs-keyword">signed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> ch; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == <span class="hljs-string"><span class="hljs-string">','</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( ate_separator ) { .... } .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ch == EOF) { .... }</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/76e/830/467/76e830467157aab1aad9e710c195b03d.png" alt="Gambar 13"></div><br>  Ini adalah salah satu kesalahan yang tidak akan Anda temukan dengan mudah kecuali Anda tahu bahwa <i>EOF</i> didefinisikan sebagai -1.  Oleh karena itu, ketika membandingkannya dengan variabel tipe <i>char yang ditandatangani</i> , kondisi tersebut bernilai <i>false</i> di hampir setiap kasus.  Satu-satunya pengecualian adalah dengan karakter yang kodenya 0xFF (255).  Ketika digunakan dalam perbandingan, itu akan berubah menjadi -1, sehingga membuat kondisi ini benar. <br><br>  <b>Contoh 13:</b> <br><br>  Bug kecil ini mungkin menjadi kritis suatu hari nanti.  Bagaimanapun, ada alasan bagus bahwa itu ditemukan dalam daftar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE</a> sebagai <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CWE-834</a> .  Perhatikan bahwa proyek telah memicu peringatan ini lima kali. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V663</a> Infinite loop dimungkinkan.  Kondisi 'cin.eof ()' tidak cukup untuk memutuskan dari loop.  Pertimbangkan untuk menambahkan pemanggilan fungsi 'cin.fail ()' ke ekspresi kondisional.  action.cpp 46 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_keymap</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::istream &amp;keymap_txt, .... )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !keymap_txt.eof() ) { .... } }</code> </pre> <br>  Seperti peringatan itu katakan, itu tidak cukup untuk memeriksa EOF saat membaca dari file - Anda juga harus memeriksa kegagalan input dengan memanggil <i>cin.fail ()</i> .  Mari kita perbaiki kode untuk membuatnya lebih aman: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !keymap_txt.eof() ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(keymap_txt.fail()) { keymap_txt.clear(); keymap_txt.ignore(numeric_limits&lt;streamsize&gt;::max(),<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  Tujuan <i>keymap_txt.clear ()</i> adalah untuk menghapus status kesalahan (tanda) pada aliran setelah kesalahan baca terjadi sehingga Anda bisa membaca sisa teks.  Memanggil <i>keymap_txt.ignore</i> dengan parameter <i>numeric_limits &lt;streamsize&gt; :: max ()</i> dan karakter baris baru memungkinkan Anda untuk melewatkan bagian string yang tersisa. <br><br>  Ada cara yang lebih sederhana untuk menghentikan pembacaan: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( !keymap_txt ) { .... }</code> </pre> <br>  Ketika dimasukkan ke dalam konteks logika, stream akan mengubah dirinya menjadi nilai yang setara dengan <i>true</i> hingga <i>EOF</i> tercapai. <br><br><h2>  Digresi iv </h2><br>  Game-game terkait roguelike paling populer saat ini menggabungkan unsur-unsur roguelike asli dan genre lain seperti platformer, strategi, dan sebagainya.  Game seperti itu dikenal sebagai "roguelike-like" atau "roguelite".  Di antara ini adalah judul terkenal seperti <i>Don't Starve</i> , <i>The Binding of Isaac</i> , <i>FTL: Faster Than Light</i> , <i>Darkest Dungeon</i> , dan bahkan <i>Diablo</i> . <br><br>  Namun, perbedaan antara roguelike dan roguelite kadang-kadang bisa sangat kecil sehingga Anda tidak bisa memastikan kategori mana yang termasuk dalam game.  Beberapa berpendapat bahwa <i>Dwarf Fortress</i> bukan roguelike dalam arti yang ketat, sementara yang lain percaya <i>Diablo</i> adalah gim klasik roguelike. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/330/a83/895/330a838954a71a90e8bd65764a9169a8.png" alt="Gambar 1"></div><br><h2>  Kesimpulan </h2><br>  Meskipun proyek ini terbukti berkualitas tinggi secara umum, dengan hanya beberapa cacat serius, itu tidak berarti dapat dilakukan tanpa analisis statis.  Kekuatan analisis statis digunakan secara teratur daripada pemeriksaan satu kali seperti yang kami lakukan untuk mempopulerkan.  Ketika digunakan secara teratur, analisa statis membantu Anda mendeteksi bug pada tahap pengembangan paling awal dan, karenanya, membuatnya lebih murah untuk diperbaiki.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Contoh perhitungan</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18d/90c/4b5/18d90c4b57268f6f55e2721a68fc017c.png" alt="Gambar 2"></div><br>  Gim ini masih terus dikembangkan, dengan komunitas modder aktif sedang mengerjakannya.  Omong-omong, itu telah porting ke beberapa platform, termasuk iOS dan Android.  Jadi, jika Anda tertarik, cobalah! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id449488/">https://habr.com/ru/post/id449488/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id449476/index.html">Jenis penyimpanan SSD baru akan mengurangi konsumsi daya di pusat data - cara kerjanya</a></li>
<li><a href="../id449478/index.html">Menambahkan UICollectionViews ke UITableViewCell khusus yang dilakukan melalui Xib</a></li>
<li><a href="../id449480/index.html">Pilih pelacakan bug yang sesuai</a></li>
<li><a href="../id449484/index.html">Kami membuat sensor kontrol kualitas udara pada InfluxDB, Grafana, Docker dan Raspberry Pi</a></li>
<li><a href="../id449486/index.html">Eksodus massal game browser</a></li>
<li><a href="../id449490/index.html">Slurm: Intens oleh Kubernetes. Program dan bonus</a></li>
<li><a href="../id449494/index.html">Antarmuka AI dan di mana mereka tinggal</a></li>
<li><a href="../id449496/index.html">Hackathon DevDays'19 (bagian 2): parser pesan suara untuk Telegram dan pemeriksaan tata bahasa di IntelliJ IDEA</a></li>
<li><a href="../id449498/index.html">Analis: Perkiraan Microsoft akan segera melebihi $ 1 triliun</a></li>
<li><a href="../id449500/index.html">Bagaimana tidak panik jika banyak programmer datang berkunjung?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>