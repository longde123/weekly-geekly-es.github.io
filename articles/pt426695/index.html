<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üëã üßñüèæ üëéüèΩ C√¢meras de vis√£o de m√°quina para entusiastas. Como usar a c√¢mera para navega√ß√£o offline? üîè üôÜüèº üö£</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fizemos uma c√¢mera para detectar AprilTag e ArTag com o mROS. Conecte-se via Uart ou Ethernet. 

 Tentamos o JeVois e o OpenMV, apreciamos os pr√≥s e o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>C√¢meras de vis√£o de m√°quina para entusiastas. Como usar a c√¢mera para navega√ß√£o offline?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/robogazon/blog/426695/"><h2>  Fizemos uma c√¢mera para detectar AprilTag e ArTag com o mROS.  Conecte-se via Uart ou Ethernet. </h2><br><br>  Tentamos o JeVois e o OpenMV, apreciamos os pr√≥s e os contras e montamos nossa c√¢mera. <br><br><img src="https://habrastorage.org/webt/lp/nb/qx/lpnbqx9egbtr4id5i-oftxtjpj4.jpeg"><br><br>  Procure por tags visuais e a orienta√ß√£o do rob√¥ com base nos dados.  Estamos desenvolvendo um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">rob√¥ para coletar bolas de golfe no driving range</a> .  Agora, no mundo, apenas uma empresa vende um rob√¥ para resolver esse problema.  O mercado √© muito promissor, nos incentivou a transformar o projeto de DIY em uma startup de tecnologia. <br><a name="habracut"></a><br>  Usando o GPS sem RTK para navegar no rob√¥, √© dif√≠cil obter a precis√£o necess√°ria para pesquisar corretamente uma base e estacionamento.  Usando a cinem√°tica em tempo real, terei problemas ao abordar edif√≠cios.  Tentamos v√°rias op√ß√µes e decidimos fazer nossa pr√≥pria c√¢mera para procurar uma marca visual na entrada da base. <br><br>  Parte do desenvolvimento do rob√¥ foi o estacionamento na esta√ß√£o de acoplamento para descarregar o compartimento da bola e carregar as baterias.  Pensamos durante muito tempo sobre como estacion√°-lo, concordamos que o rob√¥ encontraria um objeto √≥ptico brilhante e o seguiria. <br><br>  As tags AprilTag ou ArTag foram escolhidas como destino, dependendo de como elas foram exibidas no campo.  Porque  n√£o sofremos da s√≠ndrome do <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">NIH</a> - a busca por c√¢meras de vis√£o de m√°quina com suporte para esses marcadores e com suporte de script diretamente na c√¢mera j√° come√ßou. <br><br><h3>  Primeiro JeVois </h3><br>  Do que foi rapidamente encontrado - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">JeVois</a> , desenvolvido pelo laborat√≥rio da Universidade do Sul da Calif√≥rnia.  Infelizmente, eu tive que fazer um pedido para a R√∫ssia atrav√©s da Amazon, n√£o havia revendedores internos e, aparentemente, n√£o haver√° - aparentemente o marketing e as vendas s√£o realizados pelos pr√≥prios desenvolvedores (ficamos surpresos quando tivemos que mudar de Jevois para Jevois inc para comprar uma c√¢mera e, em seguida, procurando um link para o diret√≥rio - selecione a c√¢mera em algum lugar no meio de 10 a 12 posi√ß√µes). <br><br><img src="https://habrastorage.org/webt/2i/b6/yp/2ib6ypwgyxfvfswidighr735btq.png"><br><br>  As primeiras execu√ß√µes no computador foram bastante animadoras; em geral, tudo funcionou imediatamente e parecia bastante interessante.  No entanto, ap√≥s os testes de conex√£o ao painel de controle, quatro s√©rios problemas ficaram claros: <br><br>  Os 60-90 FPS indicados nos materiais de publicidade s√£o para resolu√ß√µes de 160x120 ou 320x240, o que n√£o √© de todo adequado para estacionamento - a captura ainda √© desej√°vel a uma dist√¢ncia de pelo menos 5 metros.  E para que um quadrado caia no gr√£o de 160x120 de 6 a 8 metros - voc√™ precisa torn√°-lo com pelo menos meio metro de tamanho e, ao se aproximar dele, primeiro fecha completamente o quadro e depois para de detectar. <br><br>  Consumo de 800mA, enquanto a energia √© apenas via cabos USB com mini USB, que podem suportar essa corrente sem muita queda de tens√£o.  Foi muito dif√≠cil encontrar um cabo com pelo menos meio metro com essas caracter√≠sticas - foram selecionadas cerca de 15 op√ß√µes e o resultado n√£o foi muito satisfat√≥rio. <br><br>  A c√¢mera est√° cega √† noite ou pisca durante o dia.  O equil√≠brio autom√°tico funciona al√©m do bem e do mal. <br><br>  A c√¢mera √© resfriada por um ventilador.  O ventilador √© muito pequeno, a velocidade √© alta - ru√≠do de alta frequ√™ncia ou simplesmente um guincho. <br><br><blockquote>  O rob√¥ estridente √© a √∫ltima coisa que queremos fazer. </blockquote><br>  Escrever o c√≥digo de execu√ß√£o dentro da c√¢mera √© um entretenimento separado - instalar o ambiente √© um assunto bastante confuso, e montar e fazer o upload para o cart√£o SD leva pelo menos 2-5 minutos.  Sim, n√£o h√° flash - tudo est√° no cart√£o SD. <br><br>  Conclus√£o: uma c√¢mera para brincar com entusiastas em ambientes fechados e com boa ilumina√ß√£o.  Ao mesmo tempo, seria desej√°vel que os entusiastas fossem estudantes - a interface, a documenta√ß√£o e os m√©todos de trabalho com a c√¢mera me lembraram vividamente o trabalho de laborat√≥rio do aluno, onde quase nenhuma aten√ß√£o foi dada √† conveni√™ncia de trabalhar com o sistema e outros excessos.  Trata-se de m√≥dulos C ++, √© claro.  Os scripts Python podem ser editados atrav√©s do Jevois Inventor, mas o FPS tamb√©m √© significativamente menor.  Fora das instala√ß√µes, a c√¢mera nem sobreviveu a duas chuvas, e o ventilador entupiu a sujeira no campo com a velocidade do espa√ßo. <br><br>  O resultado - n√£o √© adequado para uso no rob√¥, mas a possibilidade fundamental de estacionamento foi comprovada. <br><br><h3>  OpenMV 3 e todas as suas variantes </h3><br><img src="https://habrastorage.org/webt/jl/0l/xr/jl0lxryl0tksfb1vyvdomcyh8wm.jpeg"><br><br>  No momento da primeira pesquisa, ele simplesmente n√£o estava dispon√≠vel - havia uma campanha no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Kickstarter</a> . <br><br>  Depois que jogamos o suficiente com JeVois e 100 d√≥lares foram jogados no lixo - um vendedor com a√ß√µes foi encontrado e duas pe√ßas foram compradas. <br><br>  Em geral, as impress√µes s√£o extremamente agrad√°veis ‚Äã‚Äã- uma interface notavelmente pensada no OpenMV IDE, compila√ß√£o transparente em python, √© conveniente assistir o algoritmo funcionar e depur√°-lo.  No entanto, houve problemas aqui: <br><br><ul><li>  A resolu√ß√£o poderia ser qualquer, mas a AprilTag s√≥ p√¥de ser pesquisada em uma √°rea de n√£o mais que 200x200 pixels.  Voltamos ao problema dos gr√£os, etc.  O desenvolvedor <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">recomendou</a> primeiro puxar blobs e, em seguida, examinar os c√≥digos neles.  Mas em algo que n√£o seja um plano de fundo simples (idealmente uma parede branca) isso n√£o funciona, a grama verde e o sol brilhante contra o fundo transformam tudo em mingau.  Al√©m disso, o FPS cai para um m√°ximo de 5. </li><li>  Sensor Omnivision barato + √≥ptica barata = imagem com sab√£o.  Visualmente, isso n√£o √© muito percept√≠vel ao exibir um fluxo de v√≠deo, mas ao exibir quadros individuais, ele √© claramente vis√≠vel. </li><li>  N√£o h√° cortina de infravermelho, mas h√° ilumina√ß√£o por infravermelho.  [WHAAAAT?] </li><li>  N√£o h√° prote√ß√£o contra o ambiente externo.  Nem um pouco. </li></ul><br><img src="https://habrastorage.org/webt/wk/fw/pk/wkfwpkju7byid4w9pqq6g0iggpo.png"><br><br>  O script foi depurado nesta c√¢mera, v√°rias dezenas de corridas de estacionamento foram feitas.  No entanto, depois que o rob√¥ rolou de Moscou para S√£o Petersburgo e voltou, a c√¢mera parou de ligar - o regulador de energia foi nocauteado.  A a√ß√£o √≥bvia foi empacotamento e estabiliza√ß√£o de energia.  E aqui a coisa mais interessante foi descoberta - o caso com o IP certo para esta c√¢mera simplesmente n√£o p√¥de ser encontrado, ou foram caixas com tampas transparentes, sem montagens internas e entradas / sa√≠das de cabo apertadas.  Como resultado da busca, foram encontradas uma grande quantidade de c√¢meras de vigil√¢ncia chinesas baratas com os casos certos.  A c√¢mera foi comprada e destru√≠da, uma segunda c√≥pia do OpenMV estava no lugar do quadro, tudo funcionou. <br>  Mas a noite e a noite se tornaram um obst√°culo quase intranspon√≠vel - n√£o h√° cortina de infravermelho. <br><br>  Resultados: a c√¢mera √© MUITO conveniente para prototipagem, os recursos s√£o limitados, n√£o h√° prote√ß√£o contra o ambiente externo (a segunda c√¢mera foi para um freezer industrial e n√£o sobreviveu a -30).  N√£o √© bom <br><br>  E ent√£o ficou muito interessante para n√≥s que tipo de placas receb√≠amos das c√¢meras chinesas <br><br><h4>  HiSilicon Clones </h4><br>  Em uma inspe√ß√£o mais minuciosa, verificou-se que a placa possui um ARM de 2 n√∫cleos, processador DSP, cortina de infravermelho, ilumina√ß√£o infravermelha, um sensor decente da Sony, a placa √© coberta com um composto de prote√ß√£o + compartimento para a rua.  Exatamente o que voc√™ precisa - resta coletar o software. <br><br>  Por dentro, acabou sendo um clone do Linux bastante √∫til do HiSilicon + u-boot. <br>  Eu tive que baixar o SDK de recursos chineses e lidar com assemblies.  Em princ√≠pio, nada terr√≠vel foi encontrado ao longo do caminho, exceto que era necess√°rio consertar v√°rios arquivos dentro do SDK - a distribui√ß√£o Linux na qual o SDK seria bastante antigo e alguns arquivos de cabe√ßalho foram alterados desde ent√£o.  Bem, eu tive que mudar o shell do zsh para o bash.  Omitirei os detalhes; para o bem, este deve ser um artigo separado. <br><br>  <b>Esses recursos ajudaram:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Analisando, conectando-se √† c√¢mera</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Exemplo de diagrama de montagem de software</a> <br><br>  Ent√£o tudo correu de acordo com o esquema bem conhecido: <br><br><img src="https://habrastorage.org/webt/ce/nx/u5/cenxu5leurcipqbzgfmzyxhdhhq.jpeg"><br><br>  Na maioria das vezes, para tirar a foto do sensor, eu terminei o resto em apenas 4 horas, apenas portando o algoritmo depurado do Python para o C ++. <br>  O trabalho com o sensor levou cerca de uma semana e meia.  √â claro que n√£o h√° / dev / video0 nesses dispositivos, hardware quase vazio com trabalho direto com mem√≥ria e portas. <br>  Devemos dizer imediatamente que as amostras do SDK funcionam sem modifica√ß√£o apenas nas placas de depura√ß√£o desses SDKs, caso contr√°rio, s√£o necess√°rias muitas edi√ß√µes menores.  Por mais engra√ßado que possa parecer, o principal problema √© determinar qual sensor est√° na c√¢mera, porque  os chineses escrevem um na descri√ß√£o, outro √© marcado no quadro, o terceiro modelo √© inicializado no software.  Por exemplo, a c√¢mera possui um sensor IMX323 na descri√ß√£o, o quadro √© marcado como SC2235, quando iniciado nos scripts init, inicia como AR130 e o software da c√¢mera o inicializa como SC2235P. <br><br>  As raz√µes para tudo isso s√£o bastante simples: para o usu√°rio final, o IMX323, o SC2235 s√£o todos iguais, a imagem √© muito semelhante.  O kernel e o rootfs com scripts int foram montados no SDK com altera√ß√µes m√≠nimas e n√£o se incomodaram com um script de inicializa√ß√£o separado para cada modelo - apenas os par√¢metros de inicializa√ß√£o est√£o corretos e o nome foi deixado como estava.  No software para trabalhar com a c√¢mera, a segunda parte da inicializa√ß√£o do DSP com o sensor j√° foi lan√ßada e o modelo exato da c√¢mera j√° √© cr√≠tico l√° - portanto, os registros j√° t√™m o modelo exato - SC2235P.  P - isso √© importante, √© um sensor diferente em caracter√≠sticas, que funciona at√© com uma frequ√™ncia de barramento ligeiramente diferente e uma resolu√ß√£o diferente em compara√ß√£o com SC2235. <br><br>  A segunda parte da busca s√£o folhas de dados sobre sensores, que geralmente n√£o s√£o.  Portanto, tive que reconstruir o m√≥dulo hi_i2c com a impress√£o no log via printk e substitu√≠-lo no despejo removido da c√¢mera, gravar o amortecedor de configura√ß√£o DSP do processador de v√≠deo e remover as configura√ß√µes da c√¢mera em funcionamento, al√©m de v√°rias vezes para examinar os drivers do projeto DafangSoftware.  Em detalhes, isso desenha 3-4 artigos separados, que pretendo escrever depois do NG. <br><br>  No final, tudo ficou ainda melhor do que o esperado - trabalho confiante para capturar o AprilTag a partir de 6 metros, mesmo na escurid√£o quase completa, 25-12 fps, controlador de controle de estacionamento PID, etc. <br>  O resultado - √© o m√°ximo para trabalhar em campo, muitas coisas foram levadas em considera√ß√£o para proteger contra condi√ß√µes externas.  A √∫nica coisa que n√£o p√¥de ser totalmente verificada foi o trabalho ao sol, o clima desde outubro se deteriorou. <br><br><h3>  Ideia para o desenvolvimento </h3><br>  E aqui tivemos uma id√©ia - temos em nossas m√£os um an√°logo do OpenMV com recursos de hardware e produ√ß√£o em massa muito melhores.  Resta levar o trabalho com a c√¢mera para o n√≠vel OpenMV, para o micropython, criar um IDE conveniente e verificar novamente como os scripts atuais do OpenMV funcionar√£o.  Al√©m disso, o mRos √© completamente portado para l√°, e isso imediatamente expande o uso dessas c√¢meras para sistemas ROS. <br><br>  Como resultado, planejamos entregar an√°logos OpenMV em mar√ßo e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">mROS</a> at√© maio. <br><br>  Para reduzir o pre√ßo da personaliza√ß√£o da c√¢mera, estamos prontos para oferecer a voc√™.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Preencha o formul√°rio</a> e entraremos em contato quando estiver pronto para pedir o primeiro lote. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt426695/">https://habr.com/ru/post/pt426695/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt426685/index.html">Controlamos centenas de diferentes dispositivos dom√©sticos inteligentes com voz e texto de um smartphone. Alexa Echo no messenger</a></li>
<li><a href="../pt426687/index.html">Fazendo um estojo de rob√¥ com um or√ßamento limitado. Forma√ß√£o de v√°cuo</a></li>
<li><a href="../pt426689/index.html">Somos respons√°veis ‚Äã‚Äãpelo mercado de outra pessoa: o que as redes sociais dizem sobre CRM</a></li>
<li><a href="../pt426691/index.html">Programador em licen√ßa m√©dica</a></li>
<li><a href="../pt426693/index.html">Preste servi√ßos de manuten√ß√£o √† navega√ß√£o do rob√¥ em um campo de golfe. Construindo um caminho e evitando obst√°culos</a></li>
<li><a href="../pt426697/index.html">Trabalhando com dispositivos LibUsb no Android</a></li>
<li><a href="../pt426699/index.html">Teste de Python com pytest. Simples, r√°pido, eficiente e escal√°vel. Pref√°cio e Introdu√ß√£o</a></li>
<li><a href="../pt426701/index.html">Flutter - uma nova vis√£o do desenvolvimento de plataforma cruzada</a></li>
<li><a href="../pt426703/index.html">O que foi interessante no DataVizDay em Minsk</a></li>
<li><a href="../pt426705/index.html">Desenvolvimento e teste inteligentes de contratos do Hyperledger Fabric</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>