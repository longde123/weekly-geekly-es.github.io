<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ùî üëåüèø üõåüèº Toler√¢ncia a falhas do aplicativo ao atualizar o cluster Kubernetes ‚ö´Ô∏è üë®üèæ‚Äçüî¨ üë©‚Äçüëß‚Äçüë¶</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="De alguma forma, nos coment√°rios, eles fizeram a pergunta de como a participa√ß√£o no Slurm difere da leitura de manuais no Kubernetes. Pedi a Pavel Sel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Toler√¢ncia a falhas do aplicativo ao atualizar o cluster Kubernetes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/425217/"><blockquote>  De alguma forma, nos coment√°rios, eles fizeram a pergunta de como a participa√ß√£o no Slurm difere da leitura de manuais no Kubernetes.  Pedi a Pavel Selivanov, palestrante do Slurm-2 e MegaSlurm, para dar um pequeno exemplo do que ele vai contar sobre o Slurm.  Eu dou a palavra a ele. </blockquote><p><img src="https://habrastorage.org/webt/g4/ll/wx/g4llwxjq6-ru2ik7vb2mi4fdyow.jpeg"></p><br><p>  Estou administrando o cluster Kubernetes.  Recentemente, eu precisava atualizar a vers√£o do k8s e, inclusive, reiniciar todas as m√°quinas no cluster.  Comecei o processo √†s 12:00 e, no final do dia √∫til, tudo estava pronto.  E pela primeira vez, eu ainda acompanhei o andamento da atualiza√ß√£o, e na segunda vez sa√≠ para almo√ßar por 1,5 horas (para ser justo, pegando um laptop).  O cluster foi atualizado automaticamente, sem a minha participa√ß√£o e invisivelmente para os clientes, o desenvolvimento n√£o percebeu nada, as implanta√ß√µes continuaram, o servi√ßo funcionou normalmente. </p><br><p>  Como era. </p><a name="habracut"></a><br><h2 id="veroyatnye-problemy">  Problemas prov√°veis </h2><br><p>  Ao reiniciar m√°quinas, h√° dois cen√°rios ruins. </p><br><ol><li>  O desenvolvedor lan√ßou o aplicativo / redis em uma inst√¢ncia.  N√£o importa o qu√£o cuidadosamente voc√™ tire o carro de servi√ßo, o tempo de inatividade ocorrer√°. </li><li>  Existem 2 r√©plicas do aplicativo e uma √© implantada.  Ela saiu, havia apenas uma r√©plica e, em seguida, o administrador aparece e apaga a √∫ltima r√©plica.  Novamente, at√© a r√©plica aumentar ap√≥s a implanta√ß√£o, haver√° um tempo de inatividade. </li></ol><br><p>  Eu poderia coordenar a reinicializa√ß√£o com o desenvolvimento, dizem eles, interromper a implanta√ß√£o, verificar as inst√¢ncias, reiniciaremos as m√°quinas, mas gosto da ideia do DevOps de que a comunica√ß√£o humana deve ser minimizada.  √â melhor configurar a automa√ß√£o uma vez do que coordenar suas a√ß√µes a cada vez. </p><br><h2 id="usloviya-zadachi">  Condi√ß√µes da tarefa </h2><br><p>  Eu uso a Amazon com sua conveni√™ncia e estabilidade.  Tudo √© automatizado, voc√™ pode criar e extinguir m√°quinas virtuais, verificar sua disponibilidade, etc. </p><br><p>  O cluster Kubernetes √© implantado, gerenciado e atualizado por meio do utilit√°rio kops, que eu realmente amo. <br>  Ao atualizar o kops, ele drena automaticamente um n√≥ (n√≥ de drenagem kubectl), aguarda at√© que tudo tenha sido evacuado desse n√≥, o remove, cria um novo n√≥ no Amazon com a vers√£o correta dos componentes do Kubernetes, o anexa ao cluster, verifica se o n√≥ entrou bem no cluster, e assim com todos os n√≥s em um c√≠rculo at√© que a vers√£o desejada do Kubernetes esteja em todo lugar. </p><br><h2 id="reshenie">  Solu√ß√£o </h2><br><p>  No CI, eu uso o kube-lint para verificar todos os manifestos que ser√£o lan√ßados no Kubernetes.  O Helm Template lan√ßa tudo o que ser√° lan√ßado, eu defino um linter para descarregar, que avalia tudo de acordo com as regras especificadas. </p><br><p>  Por exemplo, uma das regras diz que, para qualquer aplicativo no cluster Kubernetes, o n√∫mero de r√©plicas deve ser pelo menos 2. <br>  Se n√£o houver r√©plicas (o padr√£o √© 1), existem 0 ou 1, o kube-lint pro√≠be a implanta√ß√£o no cluster para evitar problemas futuros. </p><br><p> Digamos que a implanta√ß√£o por design foi projetada para que haja apenas uma r√©plica.  Nesse caso, h√° um or√ßamento de interrup√ß√£o do pod, em que max_unavailable e min_available s√£o definidos para um aplicativo em execu√ß√£o no Kubernetes.  Se voc√™ quiser sempre ter pelo menos 1 r√©plica, defina min_available = 1. <br>  Havia duas r√©plicas, a implanta√ß√£o come√ßou, uma r√©plica morreu, e uma permaneceu 1. Na m√°quina em que a r√©plica vive, o administrador inicia o n√≥ de drenagem kubectl.  Em teoria, o Kubernetes deve come√ßar a remover essa r√©plica ativa e transport√°-la para outro n√≥.  Mas o or√ßamento de interrup√ß√£o do pod funciona.  O Kubernetes diz ao administrador: desculpe, a r√©plica mora aqui. Se a excluirmos, violaremos o or√ßamento de interrup√ß√£o do pod.  O n√≥ de drenagem inteligente trava antes que o tempo limite expire e tenta desviar o n√≥.  Se a implanta√ß√£o estiver conclu√≠da e as duas r√©plicas estiverem dispon√≠veis, a r√©plica neste n√≥ ser√° exibida. </p><br><p>  No MegaSlerme, mostrarei um conjunto completo de regras que me permitem tomar caf√© em um caf√© enquanto o cluster Kubernetes √© atualizado com uma reinicializa√ß√£o de todos os n√≥s. </p><br><p>  Meus t√≥picos sobre <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Slurm</a> : </p><br><ul><li>  Apresentando o Kubernetes, principais componentes </li><li>  Dispositivo de cluster, componentes principais, toler√¢ncia a falhas, rede k8s </li><li>  Abstra√ß√µes avan√ßadas do Kubernetes </li><li>  Registro e Monitoramento </li></ul><br><p>  Meus t√≥picos no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">MegaSlerme</a> : </p><br><ul><li>  Processo interno do cluster de failover </li><li>  Autoriza√ß√£o de cluster usando um provedor externo </li><li>  Aplicativos seguros e altamente dispon√≠veis no cluster </li><li>  Implementando estrat√©gias de implanta√ß√£o diferentes de RollingUpdate </li><li>  Solu√ß√£o de problemas em Kubernetes </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt425217/">https://habr.com/ru/post/pt425217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt425207/index.html">Design Testing: As 10 principais palestras do Heisenbug 2018 Piter</a></li>
<li><a href="../pt425209/index.html">Sunrise Manually # 2: De acordo com o hardcore do IDE, Cmake e minha decep√ß√£o com os animais</a></li>
<li><a href="../pt425211/index.html">286 e rede</a></li>
<li><a href="../pt425213/index.html">Planos para a pr√≥xima vers√£o do Vue.js</a></li>
<li><a href="../pt425215/index.html">4 dicas para otimizar seu aplicativo webpack</a></li>
<li><a href="../pt425219/index.html">O que √© sa√∫de mental: uma perspectiva da psicologia / psicoterapia</a></li>
<li><a href="../pt425221/index.html">Como fazer pl√°stico para impress√£o 3D</a></li>
<li><a href="../pt425223/index.html">JPHP Aplicativos para Android</a></li>
<li><a href="../pt425225/index.html">Como ver os links dentro do seu m√≥dulo PowerShell</a></li>
<li><a href="../pt425227/index.html">Os pesquisadores descobriram uma maneira de detectar e ignorar as chaves Honeytoken em v√°rios servi√ßos da Amazon.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>