<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèº‚Äçüíº üë®‚Äçüëß‚Äçüëß üôéüèø Batalla de MERGE. Cr√≥nica con conclusiones y moralidad. üëäüèº üë®üèæ‚Äçüîß ü§ü</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unas pocas semanas antes del importante festival de compromiso , el √∫ltimo antes de la versi√≥n feature freeze de PostgreSQL 11 , los boletines informa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Batalla de MERGE. Cr√≥nica con conclusiones y moralidad.</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/postgrespro/blog/412605/"> Unas pocas semanas antes del importante <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">festival de compromiso</a> , el √∫ltimo antes de la versi√≥n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>feature freeze</code></a> de <b>PostgreSQL 11</b> , los boletines informativos de los <b>piratas inform√°ticos</b> , comprimiendo el conjunto de chips en el paquete de la izquierda, vieron el thriller <b>MERGE</b> .  El director de suspenso y CEO de <b>2ndQuadrant, <i>Simon Riggs</i></b> , trat√≥ con impresionante perseverancia e ingenio para introducir un parche que implemente la sintaxis del comando MERGE en la versi√≥n.  Riggs ha sido comediante desde 2009, y con el estatus de comediante puede aprobar los parches usted mismo.  Se le opusieron no menos respetados comit√©s y veteranos de PostgreSQL.  Las pasiones estaban hirviendo clara e impl√≠citamente, ni siquiera lleg√≥ a insultar directamente, un hecho sorprendente para los clientes habituales en muchos foros nacionales.  Sin embargo, a√∫n quedaba algo de tensi√≥n cuando se resolvi√≥ la cuesti√≥n, y no hay nada de qu√© discutir. <a name="habracut"></a><br><br>  Pero las pasiones son pasiones (se discutir√°n m√°s adelante), y me gustar√≠a resolver desapasionadamente la esencia de este problema completamente descabellado. <br><br><img src="https://habrastorage.org/webt/t5/zc/ra/t5zcramwnjffszncwjkkkl9xt2g.jpeg"><br><h3>  MERGE afuera </h3><br>  Si se est√° simplificando por completo, la cuesti√≥n es esta: tenemos 2 tablas con los mismos campos y datos diferentes.  Asumir nombre y edad.  Necesitamos combinarlos en uno.  Pero ser√≠a necesario decidir qu√© hacer con esas personalidades que est√°n en ambas tablas.  Lo m√°s probable es que queramos todo en la tabla final y actualizar la informaci√≥n para que coincida con las personas.  Est√° claro que incluso en este contexto, esta es una tarea muy com√∫n.  Se puede resolver sin <code>MERGE</code> , haciendo una solicitud compleja, puede usar disparadores, etc.  Pero es inconveniente.  Sin embargo, la versi√≥n no can√≥nica de MERGE, que se llama UPSERT (UPdate + inSERT), resuelve este problema. <br><br>  El operador MERGE est√° en el est√°ndar SQL-2003 y ya est√° en todo su esplendor en SQL-2008.  Se implementa en Oracle, DB2 y en MS SQL, lo que significa que la falta de MERGE molestar√° a aquellos que est√°n considerando pasar de estos DBMS a PostgreSQL.  El deseo anhelante de Simon Riggs lo m√°s r√°pido posible, ya en PostgreSQL 11, fue alimentado por los deseos de los clientes de 2ndQuadrant, y no por la ambici√≥n o la disputa. <br><br>  De hecho, MERGE tiene capacidades ricas, los datos no tienen que ser tomados de tablas, especialmente de estructuras similares. <br><br>  La sintaxis del comando es la siguiente: <br><br><pre> <code class="sql hljs"> <span class="hljs-keyword"><span class="hljs-keyword">MERGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> tablename <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> table_reference <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (condition) <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCHED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> column1 = value1 [, column2 = value2 ...] <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCHED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> (column1 [, column2 ...]) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (value1 [, value2 ...]);</code> </pre> <br>  Sin embargo, puedes hacer esto: <br><br><pre> <code class="hljs powershell">MERGE <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">hint</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">INTO</span></span></span></span> <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">schema</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">.</span></span></span><span class="hljs-function">] {</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">table</span></span></span></span> | view} <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">table_alias</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">USING</span></span></span></span> { subquery | <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">schema</span></span></span><span class="hljs-function"> </span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">.</span></span></span><span class="hljs-function">] { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">table</span></span></span></span> | view}} <span class="hljs-function"><span class="hljs-function">[</span><span class="hljs-type"><span class="hljs-function"><span class="hljs-type">table_alias</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ON</span></span></span></span> ( condition ) [ <span class="hljs-type"><span class="hljs-type">merge_update_clause</span></span> ] [ <span class="hljs-type"><span class="hljs-type">merge_insert_clause</span></span> ] [ <span class="hljs-type"><span class="hljs-type">error_logging_clause</span></span> ] ;</code> </pre> <br>  Esta sintaxis se implementa en Oracle.  En palabras, MERGE realiza acciones que modifican los registros en la tabla de destino target_table_name usando data_source en un solo comando SQL, que puede, seg√∫n las condiciones, hacer INSERT, UPDATE o DELETE con respecto a los registros en target_table_name.  En este caso, target_table_name puede ser una vista, y data_source puede ser un conjunto de <b>tablas o vistas, el resultado de una subconsulta</b> . <br><br>  Primero, la <code>MERGE</code> realiza una <code>left outer join</code> en el <code>data_source</code> con <code>target_table_name</code> , lo que sugiere 0 o m√°s registros de cambios candidatos;  <code>WHEN</code> cl√°usulas se calculan en el orden especificado;  tan pronto como se cumpla la condici√≥n, se realiza la acci√≥n correspondiente.  Palabras clave <code>WHEN [NOT] MATCH THEN</code> no es muy com√∫n en <code>SQL</code> , por lo que le recordamos que esta es una construcci√≥n de control como <code>if-else</code> en otros idiomas.  <code>MERGE</code> act√∫a de la misma manera que <code>UPDATE, INSERT</code> o <code>DELETE</code> con respecto a <code>target_table_name</code> , solo la sintaxis de todo el comando es diferente. <br><br>  Una cl√°usula con <code>ON</code> debe establecer una conexi√≥n en todas las columnas de la clave primaria o, si se especifican otras columnas, se debe usar alg√∫n √≠ndice √∫nico para que las condiciones <code>[NOT] MATCHED</code> determinen inmediatamente las acciones para el registro candidato para excluir la interacci√≥n con otras transacciones. <br><br>  Comando determinista <code>MERGE</code> : no puede actualizar el mismo registro varias veces en el mismo comando MERGE. <br>  Un ejemplo: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">MERGE</span></span> CustomerAccount CA <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> RecentTransactions T <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> T.CustomerId = CA.CustomerId <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCHED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> Balance = Balance + TransactionValue <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCHED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> (CustomerId, Balance) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (T.CustomerId, T.TransactionValue);</code> </pre> <br>  o con una subconsulta: <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">MERGE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> bonuses D <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> employee_id, salary, department_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> employees <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> department_id = <span class="hljs-number"><span class="hljs-number">80</span></span>) S <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> (D.employee_id = S.employee_id) <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCHED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> D.bonus = D.bonus + S.salary*<span class="hljs-number"><span class="hljs-number">.01</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DELETE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (S.salary &gt; <span class="hljs-number"><span class="hljs-number">8000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">MATCHED</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> (D.employee_id, D.bonus) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (S.employee_id, S.salary*<span class="hljs-number"><span class="hljs-number">.01</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (S.salary &lt;= <span class="hljs-number"><span class="hljs-number">8000</span></span>);</code> </pre> <br>  En <b>IBM DB2, la</b> sintaxis tambi√©n funcionar√°.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Como dicen</a> , "bajo el cap√≥" esto se har√° de manera similar a la construcci√≥n <code>UPDATE FROM</code> . <br>  Desde 2008, <b>MS SQL</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tambi√©n tiene</a> <code>MERGE</code> . <br><br>  Pero incluso detr√°s de una sintaxis est√°ndar √∫nica, comienza el problema de elegir entre un n√∫mero considerable de mecanismos y m√©todos de implementaci√≥n.  El equipo debe trabajar en diferentes niveles de aislamiento de transacciones, con diferentes algoritmos de bloqueo, centr√°ndose en un modo de operaci√≥n altamente competitivo o no tan competitivo.  Y, como puede suponer, para implementar esta l√≥gica complicada, necesita tocar muchos componentes DBMS. <br><br><h3>  UPSERT, pseudo-MERGE </h3><br>  Est√° claro que los desarrolladores de DBMS estaban buscando soluciones de compromiso, neg√°ndose a reproducir literalmente la sintaxis est√°ndar.  La ventaja de este enfoque es la libertad.  Puede usar mecanismos org√°nicos para un DBMS en particular, puede optimizar la implementaci√≥n para las tareas que considere m√°s relevantes para sus usuarios. <br><br>  Por ejemplo, en <b>MySQL</b> hay un comando <code>REPLACE</code> que funciona como <code>INSERT</code> , pero si las filas nuevas y antiguas tienen los mismos valores en el √≠ndice <code>PRIMARY KEY</code> o <code>UNIQUE</code> , la fila anterior se elimina antes de insertar la nueva.  Pero tambi√©n hay <code>INSERT ... ON DUPLICATE KEY UPDATE</code> donde <code>INSERT</code> y <code>UPDATE</code> ocurren (en lugar de <code>DELETE</code> en <code>REPLACE</code> ).  Esto es <code>UPSERT</code> .  Y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">hay</a> <code>INSERT IGNORE</code> , que simplemente no realiza la inserci√≥n, sin arrojar un error (pero advertencia) bajo ciertas restricciones en la tabla de destino. <br><br><h3>  Cr√≥nicas de PG MERGE </h3><br>  En la comunidad PostgreSQL, la conversaci√≥n sobre MERGE comenz√≥ en 2005 cuando Jaime Casanova pregunt√≥ <i>si alguien en la comunidad hab√≠a comenzado a desarrollar</i> <code>MERGE</code> .  <i>Peter Eisentraut</i> <a href="">sugiri√≥ discutir</a> <i>si valdr√≠a la pena desarrollar alg√∫n tipo de opci√≥n MERGE para PostgreSQL: una implementaci√≥n similar en MySQL, o ser√≠a mejor dirigir sus esfuerzos hacia una versi√≥n Oracle del tipo <code>MERGE</code> liviana en funcionalidad.</i>  <i>Sin embargo, ¬øvale la pena hacer esfuerzos en esta direcci√≥n?</i> <br><br>  En medio de una breve discusi√≥n, el protagonista de esta narraci√≥n <i>Simon Riggs</i> aparece con las palabras: <br>  <i>MERGE es √∫til tanto para sistemas OLTP como para DW (Data Warehouse - data warehouse, es decir, aplicaciones anal√≠ticas donde las consultas complejas, pero el entorno y los datos no demasiado competitivos rara vez se actualizan, y si se actualizan, por lo general generalmente en grandes bloques. &lt;...&gt; Podemos implementar MERGE como una variante de COPY FROM, ser√° muy bueno.</i> <br><br>  Todos est√°n de acuerdo: s√≠, genial.  M√°s precisamente, casi todo: <i>Stephen Frost</i> : <i>Creo que no soy el √∫nico que dice que necesito un est√°ndar MERGE completo y compatible.</i> <br><br>  Bruce Momjian tiene una propuesta diferente y m√°s pragm√°tica: <i>me parece que necesitamos implementar en</i> <code>MERGE</code> <i>algunas opciones que podamos implementar, y en el resto daremos un error (y en los casos en que ser√° necesario bloquear toda la tabla).</i>  <i>Y despu√©s de recibir los comentarios de los usuarios y pensaremos qu√© hacer a continuaci√≥n.</i> <br><br>  Pero hasta ahora no pasa nada. <br><br><h3>  El hielo se ha roto </h3><br>  En <b>2008,</b> <i>Simon Riggs</i> nuevamente inst√≥ a lidiar con MERGE, cu√°l de las formas de elegir (para entonces, ya est√° apareciendo una nueva versi√≥n de MERGE en el est√°ndar SQL-2008, que todav√≠a est√° en borrador).  Pinta en detalle la implementaci√≥n actual de Oracle, IBM y MS SQL y la sintaxis alternativa de MySQL y Teradata.  Y un poco m√°s tarde ya menciona el <b>comienzo del trabajo en 2ndQuadrant</b> en esta direcci√≥n. <br><br>  Peter Eisentraut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">escribe en su blog</a> : <i>Por supuesto, Riggs es uno de los especialistas m√°s calificados, puede liderar el trabajo en la implementaci√≥n de MERGE.</i> <br><br>  Pero aqu√≠ llega el primer giro inesperado: un <b>estudiante</b> est√° involucrado en el problema, un participante en el desarrollo del programa <b>GSoC</b> , es decir, Google Summer of Code.  Se llama <i>Boxuan Bxzhai</i> . No presumo transcribir el apellido.  Pronto escribe que el trabajo est√° casi terminado. <br><br>  Pero casi no cuenta.  <i>Greg Smith</i> de 2ndQuadrant (es decir, aliado de Simon Riggs) escribe: <br>  <i>Entonces, tenemos un parche en el c√≥digo de los cuales media docena de problemas serios no resueltos.</i>  <i>Estoy en silencio sobre los mezquinos.</i>  <i>Los problemas son demasiado profundos para finalizar el c√≥digo para el commitfest.</i>  <i>Mientras tanto, no se ha sabido nada de Boxuan durante mucho tiempo.</i>  <i>Podr√≠amos ayudarlo, pero ¬ød√≥nde est√° √©l?</i>  <i>¬øQui√©n est√° en el saber?</i> <br><br>  Una discusi√≥n sobre las rutas de implementaci√≥n se reanuda en <b>2014</b> , pero nuevamente no sucede nada: no hay c√≥digo. <br><br>  Finalmente, ya en <b>2017,</b> <i>Simon Riggs</i> escribe: <br>  <i>Estoy trabajando en el c√≥digo para comprometer <code>MERGE</code> a <b>PostgreSQL</b> versi√≥n <b>11</b> .</i>  <i>Utilizamos los mismos mecanismos que subyacen al <code>INSERT ON CONFLICT</code> , que ya funciona, para que no se necesiten cambios en la infraestructura, b√°sicamente solo implementando la sintaxis adem√°s de lo que est√° disponible.</i>  <i>Pero escribo mi c√≥digo desde cero, no uso desarrollos anteriores.</i> <br><br>  Estamos hablando de Peter Geoghegan ( <b>VMware</b> ) implementado para ese momento ya en la sintaxis alternativa <code>INSERT .. ON CONFLICT UPDATE</code> 9.5 <code>INSERT .. ON CONFLICT UPDATE</code> , diferente del est√°ndar SQL, pero a√∫n relacionado con <code>MERGE</code> y <code>REPLACE</code> en MySQL. <br><br>  Al principio, el trabajo de Simon se encontr√≥ con exclamaciones de ¬°Buen trabajo!  Sin embargo, <i>Robert Haas</i> , aunque de apoyo, advierte sobre posibles anomal√≠as de serializaci√≥n.  Por ejemplo, para lidiar con <code>INSERT .. ON CONFLICT UPDATE</code> , sin MERGE en su base, de alguna manera es m√°s tranquilo. <br><br>  <code>UPSERT</code> autor de PostgreSQL <code>UPSERT</code> , <code>UPSERT</code> mismo: <br>  <i>No mezclar√≠a el <code>MERGE</code> <code>ON CONFLICT DO UPDATE</code> y <code>MERGE</code> .</i>  <i>&lt;...&gt; Para cargar grandes cantidades de datos ( <code>bulk load</code> ), por ejemplo, usar√≠a el algoritmo de <code>merge join</code> .</i>  <i>&lt;...&gt; En general, las ventajas de <code>MERGE</code> estar√≠an relacionadas con el hecho de que las conexiones normales funcionar√≠an all√≠ de la manera habitual: <code>nested loop, hash, merge</code> .</i>  <i>Y en <code>INSERT ‚Ä¶ ON CONFLICT</code> no hay uniones en absoluto.</i> <br><br>  Haas: <i>Al igual que Peter, creo que si se hace de esta manera, entonces un bloqueo tan fuerte al ejecutar una solicitud <code>DML</code> ve m√°s o menos.</i>  <i>Es poco probable que alguien est√© contento de que solo una persona pueda trabajar con <code>MERGE</code> a la vez.</i> <br><br>  Para aquellos que tienen curiosidad: Geigan analiza las sutilezas y las <code>UPSERT</code> diferencias entre <code>MERGE</code> y <code>MERGE</code> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aqu√≠</a> (almacenamos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">correspondencia archivada de</a> PostgreSQL en nuestro sitio web). <br><br>  Simon se resiste.  Apela a la historia reciente.  Al igual que sobre el seccionamiento, tambi√©n dijeron "una nueva sintaxis, nada m√°s".  Pero result√≥ ser algo muy √∫til.  <i>Pero no propongo darme cuenta de inmediato de todo lo que est√° en MERGE.</i>  <i>Haremos lo mismo que con la partici√≥n: dividimos el desarrollo en fases.</i> <br><br>  Y un argumento m√°s, en mi opini√≥n es muy convincente: <i>bueno.</i>  <i>Pero vamos a elegir.</i>  <i>Sugiero una opci√≥n pr√°ctica.</i>  <i><b>Pronto vendr√°n 10 a√±os</b> desde el primer intento serio de desarrollar <code>MERGE</code> .</i>  <i>¬øNo es hora de comenzar a hacer algo, de obtener una soluci√≥n √∫til, en lugar de esperar otros 10 a√±os de la soluci√≥n perfecta?</i>  <i>Asumiendo que existe en absoluto.</i> <br><br>  Finalmente, el parche llega a la comunidad.  Que fecha  Imagina por favor.  No, no lo adivinaron: Simon lo env√≠a el 30 de diciembre de 2017.  Y estipula que este es un parche WIP, es decir, Work in Progress, un parche en el trabajo. <br><br>  Simon, enero: <br>  <i>El parche se completa sin ning√∫n error especial.</i>  <i><b>1200 l√≠neas de c√≥digo</b> m√°s pruebas y documentaci√≥n.</i>  <i>Voy a comprometerlo a este commitfest, y completaremos el RLS (Seguridad de nivel de fila - protecci√≥n en el nivel de grabaci√≥n) y el soporte de particionamiento m√°s adelante.</i> <br><br><h3>  Casta de comit√©s </h3><br>  Aqu√≠ tenemos que dar un paso al costado y explicar el papel del comisionado en la comunidad.  Las funciones del comisionado, es decir, el que est√° facultado para aceptar el parche en la pr√≥xima versi√≥n, han cambiado hist√≥ricamente.  √ârase una vez, cuando hab√≠a pocos desarrolladores, el derecho a comprometerse se distribu√≠a generosamente.  Por ejemplo, el famoso (en un campo completamente diferente) <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><b>Julian Assange</b></a> recibi√≥ el t√≠tulo de comandante, siendo el autor de solo seis parches.  Ahora no es f√°cil convertirse en comisionado, no hay nuevas empresas en la lista de un par de docenas de personas.  Boyus Momdjan ( <b>EnterpriseDB</b> ) tiene 13,363 commits, Tom Lane (Tom Lane, <b>Crunchy Data</b> ) 13127, Robert Haas ( <b>EnterpriseDB</b> ) - 2074. Por cierto, el <b>√∫nico committer de Rusia</b> es <i>Fedor Sigaev</i> ( <b>Postgres Professional</b> ) con sus 383 commits .  Simon Riggs tiene 449. Repito: √©l, como comisionado, tiene suficiente autoridad para tomar y cometer parches, tanto √©l como sus empleados.  Otra cosa es que apenas vale la pena hacerlo, descuidando francamente las opiniones de otros comit√©s y luminarias l√≠deres.  Tambi√©n pueden privar el estado de comisionado, pero al menos <code>revert</code> parche. <br><br><h3>  Fractura en batalla </h3><br>  Por supuesto, en el parche "desesperado", realizado, en general, apresuradamente, encuentran nuevos errores.  Nuevas versiones ruedan en respuesta. <br><br>  A finales de enero, aparece un nuevo personaje: el desarrollador de 2ndQuadrant <i>Pavan</i> (su nombre es todos por su nombre; completamente Pavan Deolasee).  Ahora la comunidad est√° lidiando con un t√°ndem: Pavan env√≠a nuevas versiones y agradece las cr√≠ticas, y Simon las rompe con una notable presi√≥n de marketing. <br><br>  Haas: <i>No creo que valga la pena tomar decisiones unilaterales para excluir funciones que funcionan en todas partes.</i>  <i>Si aceptamos que algunas caracter√≠sticas no se incluir√°n en este parche, esto es una cosa.</i>  <i>Y es completamente diferente que en los comentarios en esta ocasi√≥n todos expresaron su desacuerdo.</i>  <i>Y en realidad no escuchamos las razones por las cuales estas caracter√≠sticas deber√≠an ser excluidas.</i> <br><br>  La l√≥gica se present√≥ de la siguiente manera: <br><br><ul><li>  a priori, hay problemas serios porque no pueden sino estar en los desarrollos en el estilo de "ataque de caballer√≠a". </li><li>  Incluso se puede completar la compatibilidad con caracter√≠sticas importantes como la nueva partici√≥n en las versiones 10-11, CTE (expresiones de tabla comunes = CON consultas) o RLS (seguridad de nivel de fila) incluso despu√©s de que se acepte el parche en la versi√≥n actual, pero solo si la arquitectura propuesta es adecuada para construir en la parte superior Su funcionalidad deseada. </li></ul><br>  El segundo Peter Geigan formula esto: <br>  <i>Por lo general, presto atenci√≥n al <b>soporte de varias funciones, ya que si lo es, fortalece la creencia general de que el dise√±o se hace como deber√≠a</b> .</i>  <i>Y si tales problemas son causados ‚Äã‚Äãpor el soporte de expresiones <code>WITH</code> [es decir, <code>CTE</code> ], entonces tengo la idea de que la arquitectura subyacente es tal que causar√° problemas aqu√≠ y all√°.</i> <br><br>  Mientras tanto, se acerca la hora X (la √∫ltima fiesta del comit√©) y las nubes sobre MERGE se est√°n acumulando.  No es que los padres fundadores buscaran espec√≠ficamente problemas serios en la arquitectura de los parches hechos por Simon y luego Pavan.  No tuve que buscar problemas; ellos se abrieron voluntariamente. <br><br><h3>  El desenlace se acerca </h3><br>  La trama se est√° acelerando.  A pesar de la actitud fr√≠a de otros comit√©s hacia su empresa, <b>el 2 de abril,</b> Simon decide cometer el <b>comando siguiente SQL:</b> parche <b>2016</b> , agrega los archivos, Depesz (Hubert Lubachevsky) logra <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">anunciarlo</a> en su blog, pero el mismo d√≠a Simon revierte todo porque errores <br><br>  Al d√≠a siguiente, comprom√©tase nuevamente agregando soporte <code>WITH</code> . <br><br>  En respuesta, las acusaciones son realmente graves.  <i>Andres Freund</i> ( <b>EnterpriseDB</b> ) escribe: <br>  <i>La arquitectura de MERGE en el analizador y el ejecutor no me impresion√≥ de manera confiable.</i>  <i>Crear uniones ocultas durante el an√°lisis de an√°lisis es una muy mala idea.</i>  <i>Esta estructura del ejecutor debe ser completamente cambiada.</i> <br><br>  Tom Lane: <br>  <i>El dise√±o del √°rbol de an√°lisis es d√©bil.</i> <br><br><br><br>  <i>Sobrecarga la funci√≥n <code>InsertStmt</code> , contin√∫a, no hace <code>INSERT</code> en absoluto, pero al azar tiene los mismos campos que el original.</i>  <i>Y no todos, pero algunos.</i>  <i>Esto es malo, conduce a la confusi√≥n.</i> <br><br>  <i>Agreguemos</i> observaciones de <i>Fedor Sigayev</i> : <br>  <i>En el analizador, aparecieron nodos <code>INSERT</code> relacionados con <code>MERGE</code> , colgados con un mont√≥n de campos adicionales.</i>  <i>Si observa el plan de ejecuci√≥n en <code>ANALIZE</code> , no comprender√° de inmediato si se trata de un <code>INSERT</code> regular o de <code>MERGE</code> : para comprenderlo, debe buscar campos adicionales.</i> <br><br><br>  Simon, calmadamente: <i>OK, cambiaremos eso y enviaremos un nuevo archivo ma√±ana</i> . <br>  Haas: <i>Estoy de acuerdo con Peter.</i>  <i>La elecci√≥n de la arquitectura no tiene √©xito.</i> <br><br>  Simon no se rinde.  <b>El 6 de abril,</b> en respuesta a las cr√≠ticas de Tom Lane, comete un nuevo parche modificado en el analizador. <br><br><h3>  Negociaci√≥n y rendici√≥n </h3><br>  Bruce Momjan <b>6 de abril</b> : <br>  <i>Quiero se√±alar que la gente no te pidi√≥ que trabajaras duro para arreglar algo urgentemente.</i>  <i>Le pidieron que retire el parche.</i>  <i>Puedes, por supuesto, trabajar duro, esperando que cambien de opini√≥n, pero, una vez m√°s, no te preguntaron sobre eso.</i> <br><br>  Simon: <i>Si Tom [Lane] y Andres [Freund] durante los d√≠as restantes a√∫n sienten que sus temores no se han disipado, <b>estar√© feliz de revertir el parche</b> sin m√°s pre√°mbulos.</i> <br><br>  Tom Lane: <i>Todav√≠a voto para que el parche se revierta.</i>  <i>Incluso si √©l fuera perfecto ahora, ahora la gente no tiene tiempo para convencerse de esto, a la garganta de otros asuntos urgentes.</i> <br><br>  Eso es todo. <br><br>  Simon dijo que s√≠, y la batalla en <code>MERGE</code> terminado.  Se han devuelto todos los parches, el tema se ha movido al siguiente commitfest con el estado "En espera de la finalizaci√≥n del autor".  Los participantes en el espect√°culo hicieron las paces. <br><br><img src="https://habrastorage.org/webt/ad/zw/ry/adzwryarovhxoldwxewpneljyms.jpeg"><br>  Sin embargo, a juzgar por la correspondencia de las √∫ltimas semanas, parece existir cierta tensi√≥n. <br><br><h3>  Moralidad Prometida </h3><br><ul><li>  Afortunadamente, la comunidad PostgreSQL tiene mecanismos naturales y formales para la detecci√≥n (casi) libre de conflictos de intentos de soluciones inmaduras.  Incluso si son golpeados por desarrolladores respetados en el rango de jefe de la compa√±√≠a, cuya contribuci√≥n al desarrollo de PostgreSQL es enorme.  Y los clientes que carecen de funcionalidad est√°n presionando para invertir. </li><li>  Desafortunadamente, la comunidad a menudo se detiene.  Es inercial en la adopci√≥n de desarrollos incluso inequ√≠vocamente relevantes.  A veces se incluye el perfeccionismo irracional.  La experiencia de Postgres Professional, donde trabajo, lo confirma.  Perforamos un parche grande e importante de <b>√≠ndices INCLUDE</b> durante 3 a√±os.  <b>Todav√≠a</b> est√° esperando una serie √∫til de parches para trabajar con <b>JSON / JSONB</b> .  La expresi√≥n "entrega tu desarrollo a la comunidad" <b>no</b> significa <b>realmente dar, sino golpear</b> : el invitado es recibido con los brazos abiertos y escoltado a cuarentenas. </li></ul><br>  PD: <i>Descargo de responsabilidad del autor</i> : solo quer√≠amos mostrar una parte de la vida comunitaria.  Todas las coincidencias de nombres son aleatorias :) <br>  PPS: Samurai <i>Natalia Levshina</i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es412605/">https://habr.com/ru/post/es412605/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es412591/index.html">Construyendo un jetpack: el 29 de mayo es el D√≠a de los Ca√≠dos de Wendell Moore</a></li>
<li><a href="../es412593/index.html">Nuevos productos, plataformas y todo como servicio: seminarios web de HPE</a></li>
<li><a href="../es412595/index.html">Informe del Club de Roma 2018, Cap√≠tulo 1.1.2: ‚ÄúFinanciaci√≥n‚Äù</a></li>
<li><a href="../es412597/index.html">Jeff Bezos va a construir una colonia en la superficie de la luna</a></li>
<li><a href="../es412603/index.html">Extra√±as declaraciones de php</a></li>
<li><a href="../es412607/index.html">Estaci√≥n de soldadura reversible clase HI-END</a></li>
<li><a href="../es412609/index.html">10 consejos para la productividad en CLion, un IDE C / C ++ multiplataforma</a></li>
<li><a href="../es412615/index.html">Presencia de destino de ruta en anuncios de BGP entre PE y CE</a></li>
<li><a href="../es412617/index.html">Wi-Fi para exteriores para mayor productividad y m√°s</a></li>
<li><a href="../es412619/index.html">myDribbble Meetup 2017 en Mosc√∫</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>