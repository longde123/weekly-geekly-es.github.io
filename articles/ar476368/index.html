<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐คฒ๐ฝ ๐คธ๐ฝ โ๐ป ุจูุงุก CI ุงูุฑุฆูุณูุฉ / CD ูุน GitHub Actions ู Python ๐ โ๏ธ ๐</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ูู ุฅุญุฏู ุงูููุงูู ุ ุนูุฏูุง ุนุฏุช ุฅูู ุงูููุฒู ูู ุงูุนูู ุ ูุฑุฑุช ุฃุฏุงุก ูุงุฌุจุงุช ููุฒููุฉ ุตุบูุฑุฉ. ููุฏ ุฃุฌุฑูุช ุนุฏุฉ ุชุนุฏููุงุช ูุฃุฑุฏุช ุนูู ุงูููุฑ ุชุฌุฑุจุชูุง. ูููู ูุจู ุงูุชุฌุงุฑุจ ุ ูุงู...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุจูุงุก CI ุงูุฑุฆูุณูุฉ / CD ูุน GitHub Actions ู Python</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/476368/" style=";text-align:right;direction:rtl"><p style=";text-align:right;direction:rtl"> ูู ุฅุญุฏู ุงูููุงูู ุ ุนูุฏูุง ุนุฏุช ุฅูู ุงูููุฒู ูู ุงูุนูู ุ ูุฑุฑุช ุฃุฏุงุก ูุงุฌุจุงุช ููุฒููุฉ ุตุบูุฑุฉ.  ููุฏ ุฃุฌุฑูุช ุนุฏุฉ ุชุนุฏููุงุช ูุฃุฑุฏุช ุนูู ุงูููุฑ ุชุฌุฑุจุชูุง.  ูููู ูุจู ุงูุชุฌุงุฑุจ ุ ูุงู ุนูู ุฃู ุฃุฐูุจ ุฅูู VPS ุ ูุงุฏูุน ุงูุชุบููุฑุงุช ุ ูุฃุนุฏ ุจูุงุก ุงูุญุงููุฉ ูุชุดุบูููุง.  ุซู ูุฑุฑุช ุฃู ุงูููุช ูุฏ ุญุงู ููุชุนุงูู ูุน ุงูุชุณููู ุงููุณุชูุฑ. <br><img src="https://habrastorage.org/webt/xa/l4/dm/xal4dmowtxwpuoxxrutujwwy4fm.jpeg"></p><a name="habracut"></a><br><p style=";text-align:right;direction:rtl">  ูู ุงูุจุฏุงูุฉ ุ ูุงู ูุฏู ุฎูุงุฑ ุจูู Circle CI ุฃู Travis ุฃู Jenkins.  ููุฏ ุงุณุชุจุนุฏุช ุฌููููุฒ ุนูู ุงูููุฑ ุชูุฑูุจูุง ุจุณุจุจ ุนุฏู ุงูุญุงุฌุฉ ุฅูู ูุซู ูุฐู ุงูุฃุฏุงุฉ ุงููููุฉ.  ุนูุฏูุง ูุฑุฃุช ุจุณุฑุนุฉ ุนู ุชุฑุงููุณ ุ ุชูุตูุช ุฅูู ุงุณุชูุชุงุฌ ููุงุฏู ุฃูู ูู ุงูููุงุณุจ ุชุฌููุนูุง ูุงุฎุชุจุงุฑูุง ุ ููู ูุง ููููู ุฃู ุชุชุฎูู ุฃู ุชุณููู ุจูุง.  ููุฏ ุนููุช ุนู Circle CI ูู ุงูุฅุนูุงูุงุช ุงููุชุทููุฉ ุจุดูู ููุฑุท ุนูู ูููุน youtube.  ุจุฏุฃุช ุจุชุฌุฑุจุฉ ุงูุฃูุซูุฉ ุ ููู ูู ูุฑุญูุฉ ูุง ููุช ูุฎุทุฆูุง ูุฃุฌุฑู ุงุฎุชุจุงุฑูุง ุฃุจุฏูุฉ ุ ุงุณุชุบุฑู ุงูุฃูุฑ ูุซูุฑูุง ูู ุงูุฏูุงุฆู ุงูุซูููุฉ ููุชุฌููุน (ุจุดูู ุนุงู ุ ููุงู ุญุฏ ูุงูู ูุง ูุฏุนู ููููู ุ ููููู ุฃุตุงุจูู).  ุฃุซูุงุก ุงูุจุญุซ ูุฑุฉ ุฃุฎุฑู ุ ุนุซุฑุช ุนูู Github Actions.  ุจุนุฏ ุงููุนุจ ุจุฃูุซูุฉ Get Started ุ ูุงู ูุฏู ุงูุทุจุงุน ุฅูุฌุงุจู ุ ูุจุนุฏ ุฅููุงุก ูุธุฑุฉ ุณุฑูุนุฉ ุนูู ุงููุซุงุฆู ุ ุชูุตูุช ุฅูู ุงุณุชูุชุงุฌ ููุงุฏู ุฃูู ูู ุงูุฑุงุฆุน ููุบุงูุฉ ุฃู ุฃุชููู ูู ุงูุงุญุชูุงุธ ุจุฃุณุฑุงุฑ ุงูุชุฌููุน ูุฌูุน ุงููุดุงุฑูุน ููุดุฑูุง ุนููููุง ูู ููุงู ูุงุญุฏ.  ูุน ุนููู ูุชููุฌุฉ ุ ุณุฑุนุงู ูุง ุฑุณู ุงููุฎุทุท ุงููุทููุจ ุ ูุชุฏูุฑ ุงูุชุฑูุณ. </p><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/h1/fp/rv/h1fprvm3jru4em3vj0ae6xruu5i.jpeg" alt="ุฎุทุฉ"></div><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุณูุญุงูู ุฅุฌุฑุงุก ุงูุงุฎุชุจุงุฑ.  ูุชุฌุฑุจุฉ ุ ูุชุจุช ุฎุงุฏู ููุจ ุจุณูุท ุนูู Flask ูุน ููุทุชู ุงูููุงูุฉ: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุณุฑุฏ ุชุทุจูู ููุจ ุจุณูุท</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request, jsonify app = Flask(__name__) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate_post_data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: dict)</span></span></span><span class="hljs-function"> -&gt; bool:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(data, dict): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> data.get(<span class="hljs-string"><span class="hljs-string">'name'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(data[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], str): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data.get(<span class="hljs-string"><span class="hljs-string">'age'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(data[<span class="hljs-string"><span class="hljs-string">'age'</span></span>], int): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> @app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hello</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span> @app.route(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" /api entpoint GET - returns json= {'status': 'test'} POST - { name - str not null age - int optional } :return: """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> request.method == <span class="hljs-string"><span class="hljs-string">'GET'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonify({<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> request.method == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> validate_post_data(request.json): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonify({<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> jsonify({<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}), <span class="hljs-number"><span class="hljs-number">400</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> app.run(host=<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, port=<span class="hljs-number"><span class="hljs-number">8080</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: main()</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุจุนุถ ุงูุงุฎุชุจุงุฑุงุช: </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงุฆูุฉ ุงุฎุชุจุงุฑ ุงูุชุทุจูู</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> tested_app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FlaskAppTests</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> tested_app.app.config[<span class="hljs-string"><span class="hljs-string">'TESTING'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.app = tested_app.app.test_client() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_get_hello_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) self.assertEqual(r.data, <span class="hljs-string"><span class="hljs-string">b'Hello World!'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_post_hello_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">405</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_get_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.get(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>}) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_correct_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">200</span></span>) r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'OK'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_not_dict_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps([{<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>}])) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_no_name_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_bad_age_post_api_endpoint</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> r = self.app.post(<span class="hljs-string"><span class="hljs-string">'/api'</span></span>, content_type=<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>, data=json.dumps({<span class="hljs-string"><span class="hljs-string">'name'</span></span>: <span class="hljs-string"><span class="hljs-string">'Den'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>: <span class="hljs-string"><span class="hljs-string">'100'</span></span>})) self.assertEqual(r.json, {<span class="hljs-string"><span class="hljs-string">'status'</span></span>: <span class="hljs-string"><span class="hljs-string">'bad input'</span></span>}) self.assertEqual(r.status_code, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: unittest.main()</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุฅุฎุฑุงุฌ ุงูุชุบุทูุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">coverage report Name Stmts Miss Cover ------------------------------------------------------------------ src/app.py 28 2 93% src/tests.py 37 0 100% ------------------------------------------------------------------ TOTAL 65 2 96%</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฅูุดุงุก ุฃูู ุนูู ูุฏููุง ุ ูุงูุชู ุณุชุฌุฑู ุงูุงุฎุชุจุงุฑุงุช.  ููููุง ูููุซุงุฆู ุ ูุฌุจ ุชุฎุฒูู ุฌููุน ุงูุฅุฌุฑุงุกุงุช ูู ุฏููู ุฎุงุต: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ mkdir -p .github/workflows $ touch .github/workflows/test_on_push.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฃุฑูุฏ ุชุดุบูู ูุฐุง ุงูุฅุฌุฑุงุก ุนูู ุฃู ุญุฏุซ ุฏูุน ูู ุฃู ูุฑุน ุ ุจุงุณุชุซูุงุก ุงูุฅุตุฏุงุฑุงุช (ุงูุนูุงูุงุช ุ ูุฃูู ุณูููู ููุงู ุงุฎุชุจุงุฑ ูููุตู): </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">on: push: tags: - '!refs/tags/*' branches: - '*'</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุซู ูููู ุจุฅูุดุงุก ูููุฉ ุณุชุนูู ูู ุฃุญุฏุซ ุฅุตุฏุงุฑ ูุชููุฑ ูู Ubuntu: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">jobs: run_tests: runs-on: [ubuntu-latest]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูู ุงูุฎุทูุงุช ุงูุชุงููุฉ ุ ุณูู ูุชุญูู ูู ุงูููุฏ ุ ููููู ุจุชุซุจูุช python ุ ูุชุซุจูุช ุงูุชุจุนูุงุช ุ ูุฅุฌุฑุงุก ุงูุงุฎุชุจุงุฑุงุช ุ ูุชุบุทูุฉ ุงูุนุฑุถ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">steps: #   - uses: actions/checkout@master #  python   - uses: actions/setup-python@v1 with: python-version: '3.8' architecture: 'x64' - name: Install requirements #   run: pip install -r requirements.txt - name: Run tests run: coverage run src/tests.py - name: Tests report run: coverage report</code> </pre> <br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูู ุฐูู ูุนุง</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">name: Run tests on any Push event #    push    ,    . #      on: push: tags: - '!refs/tags/*' branches: - '*' jobs: run_tests: runs-on: [ubuntu-latest] steps: #   - uses: actions/checkout@master #  python   - uses: actions/setup-python@v1 with: python-version: '3.8' architecture: 'x64' - name: Install requirements #   run: pip install -r requirements.txt - name: Run tests run: coverage run src/tests.py - name: Tests report run: coverage report</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุฏุนููุง ูุญุงูู ุฅูุดุงุก ุงูุชุฒุงู ููุฑู ููู ูุนูู ุนูููุง. <br><img src="https://habrastorage.org/webt/qy/v7/by/qyv7byybfnvpnkurriqvydsp_xk.png"><br>  <em>ุงุฌุชูุงุฒ ุงูุงุฎุชุจุงุฑุงุช ูู ูุงุฌูุฉ ุงูุฅุฌุฑุงุกุงุช</em> </p><br><p style=";text-align:right;direction:rtl">  ููุฑุงู ุ ุชูููุง ูู ุฅูุดุงุก ุงูุฅุฌุฑุงุก ุงูุฃูู ูุชุดุบููู!  ุฏุนููุง ูุญุงูู ูุณุฑ ููุน ูู ุงูุงุฎุชุจุงุฑ ูุฅููุงุก ูุธุฑุฉ ุนูู ุงูุฅุฎุฑุงุฌ: <br><img src="https://habrastorage.org/webt/dr/vn/_s/drvn_sgrq-esw6sgxjiylhhy02w.png"><br>  <em>ุงุฎุชุจุงุฑุงุช ุชุนุทู ูู ูุงุฌูุฉ ุงูุฅุฌุฑุงุกุงุช</em> </p><br><p style=";text-align:right;direction:rtl">  ูุดูุช ุงูุงุฎุชุจุงุฑุงุช.  ุชุญูู ุงููุคุดุฑ ุฅูู ุงูููู ุงูุฃุญูุฑ ูุชููู ุฅุดุนุงุฑูุง ูู ุงูุจุฑูุฏ.  ูุง ุชุญุชุงุฌู!  3 ูู 8 ููุงุท ูู ุงููุฎุทุท ุงููุณุชูุฏู ูููู ุงุนุชุจุงุฑูุง ูุณุชููุงุฉ.  ุงูุขู ุฏุนููุง ูุญุงูู ุงูุชุนุงูู ูุน ุงูุชุฌููุน ูุชุฎุฒูู ุตูุฑ ุนุงูู ุงููููุงุก. </p><br><p style=";text-align:right;direction:rtl">  <strong>ููุงุญุธุฉ!</strong>  <strong>ุจุนุฏ ุฐูู ูุญุชุงุฌ ุฅูู ุญุณุงุจ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุนุงูู ูููุงุก</a></strong> </p><br><p style=";text-align:right;direction:rtl">  ุฃููุงู ุ ุณููุชุจ Dockerfile ุจุณูุท ุณูุชู ููู ุชูููุฐ ุทูุจูุง. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">Dockerfile</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">#     FROM python:3.8-alpine #        /app  COPY ./ /app #    RUN apk update &amp;&amp; pip install -r /app/requirements.txt --no-cache-dir #   (  Distutils) RUN pip install -e /app #      EXPOSE 8080 #       CMD web_server #    distutils      #CMD python /app/src/app.py</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ูุฅุฑุณุงู ุญุงููุฉ ุฅูู ุงููุญูุฑ ุ ุณูููู ูู ุงูุถุฑูุฑู ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุนุงูู ุงูุฅุฑุณุงุก ุ ููู ุจูุง ุฃููู ูุง ุฃุฑูุฏ ููุนุงูู ููู ูุนุฑูุฉ ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจุงูุญุณุงุจ ุ ูุณุฃุณุชุฎุฏู ุงูุฃุณุฑุงุฑ ุงููุถูููุฉ ูู GitHub.  ุจุดูู ุนุงู ุ ูููู ูุถุน ูููุงุช ุงููุฑูุฑ ููุท ูู ุงูุฃุณุฑุงุฑ ุ ูุณูุชู ุชุฑููุฒ ุงูุจุงูู ูู * .yaml ุ ูุณูุนูู ูุฐุง.  ููููู ุฃุฑุบุจ ูู ูุณุฎ ุงูุฅุฌุฑุงุกุงุช ุงูุฎุงุตุฉ ุจู ุฏูู ูุตููุง ุ ูุณุญุจ ุฌููุน ุงููุนูููุงุช ุงููุญุฏุฏุฉ ูู ุงูุฃุณุฑุงุฑ. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/2c/h8/5t/2ch85tdbuovsc7ywejh5gmrmvgw.png"><br>  <em>ุฃุณุฑุงุฑ ุฌูุซุจ</em> </p><br><p style=";text-align:right;direction:rtl">  DOCKER_LOGIN - ุชุณุฌูู ุงูุฏุฎูู ูู hub.docker.com <br>  DOCKER_PWD - ูููุฉ ุงููุฑูุฑ <br>  DOCKER_NAME - ุงุณู ูุณุชูุฏุน ุงููุณุชูุฏุน ููุฐุง ุงููุดุฑูุน (ูุฌุจ ุฅูุดุงุคู ูุณุจููุง) </p><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุฏ ุชู ุงูุฅุนุฏุงุฏ ุ ููููู ุงูุขู ุจุฅูุดุงุก ุนูููุง ุงูุซุงูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ touch .github/workflows/pub_on_release.yaml</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูููู ุจูุณุฎ ุงูุงุฎุชุจุงุฑ ูู ุงูุฅุฌุฑุงุก ุงูุณุงุจู ุ ุจุงุณุชุซูุงุก ูุดุบู ุงูุฅุทูุงู (ูู ุฃุฌุฏ ููููุฉ ุงุณุชูุฑุงุฏ ุงูุฅุฌุฑุงุกุงุช).  ูุณุชุจุฏููุง ุจู "Launch on release": </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">on: release: types: [published]</code> </pre> <br><p style=";text-align:right;direction:rtl">  <strong>! ูุงู</strong>  <strong>ูู ุงูููู ุฌุฏุง ูุฌุนู ุงูุดุฑุท ุงูุตุญูุญ on.event</strong> <br>  ุนูู ุณุจูู ุงููุซุงู ุ ุฅุฐุง ูู ูุญุฏุฏ on.release ุฃููุงุนูุง ุ ูุณูุดุบู ูุฐุง ุงูุญุฏุซ ุญุฏุซูู ุนูู ุงูุฃูู: ุชู ูุดุฑู ูุฅูุดุงุฆู.  ููุฐุง ูู ุ ุณูุชู ุฅุทูุงู ุนูููุงุช ุงูุชุฌููุน 2 ุนูู ุงูููุฑ. </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ูู ููุณ ุงูููู ุณููุนู ูููุฉ ุฃุฎุฑู ุญุณุจ ุงูุฃูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">build_and_pub: needs: [run_tests]</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุญุชุงุฌ - ูููู ุฃู ูุฐู ุงููููุฉ ูู ุชุจุฏุฃ ุญุชู ุชูุชูู run_tests </p><br><p style=";text-align:right;direction:rtl">  <strong>! ูุงู</strong>  <strong>ุฅุฐุง ูุงู ูุฏูู ุงูุนุฏูุฏ ูู ูููุงุช ุงูุฅุฌุฑุงุกุงุช ุ ูุฏุงุฎููุง ุงูุนุฏูุฏ ูู ุงูููุงู ุ ูุณุชุนูู ุฌููุนูุง ูู ููุช ูุงุญุฏ ูู ุจูุฆุงุช ูุฎุชููุฉ.</strong>  ูุชู ุฅูุดุงุก ุจูุฆุฉ ูููุตูุฉ ููู ูููุฉ ุ ุจุบุถ ุงููุธุฑ ุนู ุงูููุงู ุงูุฃุฎุฑู.  ุฅุฐุง ูู ุชุญุฏุฏ ุงูุงุญุชูุงุฌุงุช ุ ูุณูุชู ุชุดุบูู ูููุฉ ุงูุงุฎุชุจุงุฑ ูุงูุชุฌูุนุงุช ูู ููุช ูุงุญุฏ ูุจุดูู ูุณุชูู ุนู ุจุนุถูุง ุงูุจุนุถ. </p><br><p style=";text-align:right;direction:rtl">  ุฃุถู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุงูุชู ุณุชููู ูููุง ุฃุณุฑุงุฑูุง: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">env: LOGIN: ${{ secrets.DOCKER_LOGIN }} NAME: ${{ secrets.DOCKER_NAME }}</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุงูุขู ุฎุทูุงุช ูููุชูุง ุ ุญูุซ ูุฌุจ ุนูููุง ุชุณุฌูู ุงูุฏุฎูู ุฅูู ุนุงูู ุงููููุงุก ุ ูุฌูุน ุงูุญุงููุฉ ููุดุฑูุง ูู ุงูุชุณุฌูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">steps: - name: Login to docker.io run: echo ${{ secrets.DOCKER_PWD }} | docker login -u ${{ secrets.DOCKER_LOGIN }} --password-stdin - uses: actions/checkout@master - name: Build image run: docker build -t $LOGIN/$NAME:${GITHUB_REF:11} -f Dockerfile . - name: Push image to docker.io run: docker push $LOGIN/$NAME:${GITHUB_REF:11}</code> </pre> <br><p style=";text-align:right;direction:rtl">  $ {GITHUB_REF: 11} ุนุจุงุฑุฉ ุนู ูุชุบูุฑ github ูุฎุฒู ุฎุทูุง ูุน ุงูุฅุดุงุฑุฉ ุฅูู ุงูุญุฏุซ ุงูุฐู ุนูู ุงููุดุบู ูู ุฃุฌูู (ุงุณู ุงููุฑุน ุฃู ุงูุนูุงูุฉ ุฃู ูุง ุฅูู ุฐูู) ุ ุฅุฐุง ูุงู ูุฏููุง ุนูุงูุงุช ุจุงูุชูุณูู "v0.0.0" ูุฃูุช ุจุญุงุฌุฉ ุฅูู ูุต ุฃูู 11 ุงูุดุฎุตูุงุช ุ ุซู "0.0.0" ูุง ูุฒุงู ูุงุฆูุง. </p><br><p style=";text-align:right;direction:rtl">  ุงุฏูุน ุงูููุฏ ููู ุจุฅูุดุงุก ุนูุงูุฉ ุฌุฏูุฏุฉ.  ููุฑู ุฃู ุงูุญุงููุฉ ุงูุฎุงุตุฉ ุจูุง ูุฏ ุชู ุชุฌููุนูุง ูุฅุฑุณุงููุง ุจูุฌุงุญ ุฅูู ุงูุณุฌู ุ ููู ูุถูุก ูููุฉ ุงููุฑูุฑ ุงูุฎุงุตุฉ ุจูุง ูู ุฃู ููุงู. </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/mg/yt/i-/mgyti-mww_fcqsmbiqk6zli7swo.png"><br>  <em>ุจูุงุก ูุดุญู ุงูุญุงููุงุช ูู ูุงุฌูุฉ ุงูุฅุฌุฑุงุกุงุช</em> </p><br><p style=";text-align:right;direction:rtl">  ุชุญูู ูู ุงููุญูุฑ: </p><br><p style=";text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/ut/nw/vd/utnwvdtcprbqfpavnnirqmqim0s.png"><br>  <em>ุงูุญุงููุฉ ุงููุฎุฒูุฉ ูู ุนุงูู ูููุงุก</em> </p><br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ูุนูู ุ ูููู ุงููููุฉ ุงูุฃุตุนุจ ุชุจูู - ุงููุดุฑ.  ููุง ุณุชุญุชุงุฌ ุจุงููุนู ุฅูู VPS ูุนููุงู IP ุฃุจูุถ ุญูุซ ุณูููู ุจูุดุฑ ุงูุญุงููุฉ ุญูุซ ููููู ุฅุฑุณุงู ุงูุฎุทุงู.  ูู ุงููุงุญูุฉ ุงููุธุฑูุฉ ุ ุนูู ุฌุงูุจ VPS ุฃู ุงูุฎุงุฏู ุงูุฑุฆูุณู ุ ููููู ุชุดุบูู ุจุฑูุงูุฌ ูุตู ุนูู ุงูุชุงุฌ ุ ูุงูุฐู ูู ุญุงูุฉ ูุฌูุฏ ุตูุฑุฉ ุฌุฏูุฏุฉ ุณุชุทููู ุ ุฃู ุชูุนุจ ุจุทุฑููุฉ ูุง ูุน ุฑูุจูุช ุงูุชูุบุฑุงู.  ุจุงูุชุฃููุฏ ููุงู ุงููุซูุฑ ูู ุงูุทุฑู ููููุงู ุจุฐูู.  ูููู ุณูู ุฃุนูู ูุน ุงูููููุฉ ุงูููุฑูุฉ ุงูุฎุงุฑุฌูุฉ.  ููู ูุง ุฃููู ุฐูููุง ุ ูุชุจุช ุฎุฏูุฉ ููุจ ุตุบูุฑุฉ ูู Flask ูุน ูุงุฌูุฉ ุจุฑูุฌุฉ ุชุทุจููุงุช ุจุณูุทุฉ. <br>  ุจุงุฎุชุตุงุฑ ุ ููุงู ููุทุฉ ููุงูุฉ ูุงุญุฏุฉ / /. <br>  ุฅุฑุฌุงุน ุทูุจ GET json ูุน ูุงูุฉ ุงูุญุงููุงุช ุงููุดุทุฉ ุนูู ุงููุถูู. <br>  POST - ูุณุชูุจู ุงูุจูุงูุงุช ุจุงูุชูุณูู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"owner"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"repository"</span></span>: <span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>: <span class="hljs-string"><span class="hljs-string">"v0.0.1"</span></span>, #    <span class="hljs-attr"><span class="hljs-attr">"ports"</span></span>: {<span class="hljs-attr"><span class="hljs-attr">"8080"</span></span>: <span class="hljs-number"><span class="hljs-number">8080</span></span>, โ443โ: <span class="hljs-number"><span class="hljs-number">443</span></span>} #      }</code> </pre> <br><p style=";text-align:right;direction:rtl">  ูุง ูุญุฏุซ ุนูู ุงููุถูู: </p><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ูู json ุงููุณุชููุฉ ูุชู ุฌูุน ุงุณู ุงูุตูุฑุฉ ุงูุฌุฏูุฏุฉ </li><li style=";text-align:right;direction:rtl">  ุตูุฑุฉ ุฌุฏูุฏุฉ ููุชูุฎุฉ </li><li style=";text-align:right;direction:rtl">  ุฅุฐุง ุชู ุชูุฒูู ุงูุตูุฑุฉ ุ ูุณูุชู ุฅููุงู ุงูุญุงููุฉ ุงูุญุงููุฉ ูุญุฐููุง </li><li style=";text-align:right;direction:rtl">  ุฅุทูุงู ุญุงููุฉ ุฌุฏูุฏุฉ ุ ูุน ูุดุฑ ุงูููุงูุฐ (ุนูุงูุฉ ุงูุนูู) </li></ol><br><p style=";text-align:right;direction:rtl">  ูุชู ูู ุงูุนูู ูุน ุนุงูู ูููุงุก ุจุงุณุชุฎุฏุงู ููุชุจุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุต ุงูุงุชูุงู</a> </p><br><p style=";text-align:right;direction:rtl">  ุณูููู ูู ุงูุฎุทุฃ ุฌุฏูุง ูุดุฑ ูุซู ูุฐู ุงูุฎุฏูุฉ ุนูู ุงูุฅูุชุฑูุช ุฏูู ุฃุฏูู ุญูุงูุฉ ุ ููุฏ ููุช ุจุนูู ุชุดุงุจู ูู API KEY ุ ุญูุซ ุชูุฑุฃ ุงูุฎุฏูุฉ ุงูุฑูุฒ ุงููููุฒ ูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุ ุซู ุชูุงุฑููุง ุจุงูุฑุฃุณ {Authorization: CI_TOKEN} </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ูุงุฆูุฉ ุฎุงุฏู ุงูููุจ ูููุดุฑ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># coding=utf-8 import os import sys import logging import logging.config import logging.handlers from flask import Flask from flask import request, jsonify import docker log = logging.getLogger(__name__) app = Flask(__name__) docker_client = docker.from_env() MY_AUTH_TOKEN = os.getenv('CI_TOKEN', None) #       def init_logging(): """   :return: """ log_format = f"[%(asctime)s] [ CI/CD server ] [%(levelname)s]:%(name)s:%(message)s" formatters = {'basic': {'format': log_format}} handlers = {'stdout': {'class': 'logging.StreamHandler', 'formatter': 'basic'}} level = 'INFO' handlers_names = ['stdout'] loggers = { '': { 'level': level, 'propagate': False, 'handlers': handlers_names }, } logging.basicConfig(level='INFO', format=log_format) log_config = { 'version': 1, 'disable_existing_loggers': False, 'formatters': formatters, 'handlers': handlers, 'loggers': loggers } logging.config.dictConfig(log_config) def get_active_containers(): """     :return: """ containers = docker_client.containers.list() result = [] for container in containers: result.append({ 'short_id': container.short_id, 'container_name': container.name, 'image_name': container.image.tags, 'created': container.attrs['Created'], 'status': container.status, 'ports': container.ports, }) return result def get_container_name(item: dict) -&gt; [str, str]: """   image  POST  :param item: :return: """ if not isinstance(item, dict): return '' owner = item.get('owner') repository = item.get('repository') tag = item.get('tag', 'latest').replace('v', '') if owner and repository and tag: return f'{owner}/{repository}:{tag}', repository if repository and tag: return f'{repository}:{tag}', repository return '', '' def kill_old_container(container_name: str) -&gt; bool: """    ,   :param container_name: :return: """ try: #    container = docker_client.containers.get(container_name) #  container.kill() except Exception as e: #       log.warning(f'Error while delete container {container_name}, {e}') return False finally: #   ,     log.debug(docker_client.containers.prune()) log.info(f'Container deleted. container_name = {container_name}') return True def deploy_new_container(image_name: str, container_name: str, ports: dict = None): try: #   image  docker hub'a log.info(f'pull {image_name}, name={container_name}') docker_client.images.pull(image_name) log.debug('Success') kill_old_container(container_name) log.debug('Old killed') #    docker_client.containers.run(image=image_name, name=container_name, detach=True, ports=ports) except Exception as e: log.error(f'Error while deploy container {container_name}, \n{e}') return {'status': False, 'error': str(e)}, 400 log.info(f'Container deployed. container_name = {container_name}') return {'status': True}, 200 @app.route('/', methods=['GET', 'POST']) def MainHandler(): """ GET -      POST -      : { "owner": "gonfff", "repository": "ci_example", "tag": "v0.0.1", "ports": {"8080": 8080} } :return: """ if request.headers.get('Authorization') != MY_AUTH_TOKEN: return jsonify({'message': 'Bad token'}), 401 if request.method == 'GET': return jsonify(get_active_containers()) elif request.method == 'POST': log.debug(f'Recieved {request.data}') image_name, container_name = get_container_name(request.json) ports = request.json.get('ports') if request.json.get('ports') else None result, status = deploy_new_container(image_name, container_name, ports) return jsonify(result), status def main(): init_logging() if not MY_AUTH_TOKEN: log.error('There is no auth token in env') sys.exit(1) app.run(host='0.0.0.0', port=5000) if __name__ == '__main__': main()</span></span></code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุฐุง ุงูุชุทุจูู ุ ูุนูุช ุฃูุถูุง setup.py ูุชุซุจูุชู ุนูู ุงููุธุงู.  ููููู ุชุซุจูุชู ุจุงุณุชุฎุฏุงู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ python3 setup.sy install</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุดุฑูุทุฉ ุฃู ุชููู ูุฏ ููุช ุจุชูุฒูู ุงููููุงุช ูุชููู ูู ุฏููู ูุฐุง ุงูุชุทุจูู. <br>  ุจุนุฏ ุงูุชุซุจูุช ุ ูุฌุจ ุชูููู ุงูุชุทุจูู ูุฎุฏูุฉ ุจุญูุซ ูุจุฏุฃ ุชุดุบููู ูู ุญุงูุฉ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู ุ ูุฐูู ูุณุชุฎุฏู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">systemd</a> <br>  ูููุง ููู ูุซุงู ูููู ุงูุชูููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">[Unit] Description=Deployment web server After=network-online.target [Service] Type=simple RestartSec=3 ExecStart=/usr/local/bin/ci_example Environment=CI_TOKEN=#&lt;I generate it with $(openssl rand -hex 20)&gt; [Install] WantedBy=multi-user.target</code> </pre><br><p style=";text-align:right;direction:rtl">  ูุจูู ููุท ูุชุดุบููู: </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ sudo systemctl daemon-reload $ sudo systemctl <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> ci_example.service $ sudo systemctl start ci_example.service</code> </pre> <br><p style=";text-align:right;direction:rtl">  ููููู ุนุฑุถ ุณุฌู ุฎุงุฏู ุชุณููู ุงูููุจ ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ </p><br><pre style=";text-align:right;direction:rtl"> <code class="bash hljs">$ sudo systemctl status ci_example.service</code> </pre> <br><p style=";text-align:right;direction:rtl">  ุฌุฒุก ุงูุฎุงุฏู ุฌุงูุฒ ุ ููุธู ููุท ูุฅุถุงูุฉ ุฑุจุท ูุนูููุง.  ููููุงู ุจุฐูู ุ ุฃุถู ุฃุณุฑุงุฑ ุนููุงู IP ุงูุฎุงุต ุจุฎุงุฏููุง ู CI_TOKEN ุงูุชู ุฃูุดุฃูุงูุง ุนูุฏ ุชุซุจูุช ุงูุชุทุจูู. <br>  ูู ุงูุจุฏุงูุฉ ููุช ุฃุฑุบุจ ูู ุงุณุชุฎุฏุงู ุฅุฌุฑุงุก ุฌุงูุฒ ููุชุฌุนูุฏ ูู ุณูู ุฌูุซุจ ุ ููู ูุณูุก ุงูุญุธ ุ ูุฅูู ูุฒูู ุนูุงูุงุช ุงูุงูุชุจุงุณ ูู ูุต ุทูุจ POST ุ ููุง ูุฌุนู ูู ุงููุณุชุญูู ุชุญููู json.  ูู ุงููุงุถุญ ุฃู ูุฐุง ูู ููุงุณุจูู ุ ููุฑุฑุช ุงุณุชุฎุฏุงู ุงูุถููุฑุฉ ุงููุฏูุฌุฉ ูู ุฃูุจููุชู (ุงูุชู ุฃุฌูุน ุนูููุง ุญุงููุงุช) ุ ูุงูุชู ูุงู ููุง ุจุงูููุงุณุจุฉ ุชุฃุซูุฑ ุฅูุฌุงุจู ุนูู ุงูุฃุฏุงุก ุ ูุฃููุง ูุง ุชุชุทูุจ ุชุฌููุน ุญุงููุฉ ุฅุถุงููุฉ: </p><br><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">deploy: needs: [build_and_pub] runs-on: [ubuntu-latest] steps: - name: Set tag to env run: echo ::set-env name=TAG::$(echo ${GITHUB_REF:11}) - name: Send webhook for deploy run: "curl --silent --show-error --fail -X POST ${{ secrets.DEPLOYMENT_SERVER }} -H 'Authorization: ${{ secrets.DEPLOYMENT_TOKEN }}' -H 'Content-Type: application/json' -d '{\"owner\": \"${{ secrets.DOCKER_LOGIN }}\", \"repository\": \"${{ secrets.DOCKER_NAME }}\", \"tag\": \"${{ env.TAG }}\", \"ports\": {\"8080\": 8080}}'"</code> </pre><br><p style=";text-align:right;direction:rtl">  <strong>ููุงุญุธุฉ: ูู ุงูููู ุฌุฏูุง ุชุญุฏูุฏ ุฑูุฒ ุงูุชุจุฏูู --fail ุ ูุฅูุง ุณููุฌุญ ุฃู ุทูุจ ุ ุญุชู ูู ุชู ุชููู ุฎุทุฃ ุงุณุชุฌุงุจุฉ.</strong> <br>  ุชุฌุฏุฑ ุงูุฅุดุงุฑุฉ ุฃูุถูุง ุฅูู ุฃู ุงููุชุบูุฑุงุช ุงููุณุชุฎุฏูุฉ ูู ุงูุทูุจ ููุณุช ูุชุบูุฑุงุช ุญููุง ุ ูููู ูุธุงุฆู ุฎุงุตุฉ ุชุณูู ุจุงุณุชุซูุงุก GITHUB_REF ุ ููุฐุง ูู ุงูุณุจุจ ูู ุฃููู ูู ุฃุณุชุทุน ุฃู ุฃููู ูููุช ุทููู ุณุจุจ ุนุฏู ุนูู ุงูุทูุจ ุจุดูู ุตุญูุญ.  ููู ุจุนุฏ ุฃู ูุฌุญุช ูู ุฃุฏุงุก ุงููููุฉ ุ ูุฌุญ ูู ุดูุก. </p><br><div class="spoiler" style=";text-align:right;direction:rtl">  <b class="spoiler_title">ุงูุนูู ูุจูู ููุดุฑ</b> <div class="spoiler_text" style=";text-align:right;direction:rtl"><pre style=";text-align:right;direction:rtl"> <code class="plaintext hljs">name: Publish on Docker Hub and Deploy on: release: types: [published] #       jobs: run_tests: #          runs-on: [ubuntu-latest] steps: #   - uses: actions/checkout@master #  python   - uses: actions/setup-python@v1 with: python-version: '3.8' architecture: 'x64' - name: Install requirements #   run: pip install -r requirements.txt - name: Run tests #   run: coverage run src/tests.py - name: Tests report run: coverage report build_and_pub: #      needs: [run_tests] runs-on: [ubuntu-latest] env: LOGIN: ${{ secrets.DOCKER_LOGIN }} NAME: ${{ secrets.DOCKER_NAME }} steps: - name: Login to docker.io #     docker.io run: echo ${{ secrets.DOCKER_PWD }} | docker login -u ${{ secrets.DOCKER_LOGIN }} --password-stdin #   - uses: actions/checkout@master - name: Build image #  image        hub.docker .. login/repository:version run: docker build -t $LOGIN/$NAME:${GITHUB_REF:11} -f Dockerfile . - name: Push image to docker.io #    registry run: docker push $LOGIN/$NAME:${GITHUB_REF:11} deploy: #         registry,      #    curl   needs: [build_and_pub] runs-on: [ubuntu-latest] steps: - name: Set tag to env run: echo ::set-env name=RELEASE_VERSION::$(echo ${GITHUB_REF:11}) - name: Send webhook for deploy run: "curl --silent --show-error --fail -X POST ${{ secrets.DEPLOYMENT_SERVER }} -H 'Authorization: ${{ secrets.DEPLOYMENT_TOKEN }}' -H 'Content-Type: application/json' -d '{\"owner\": \"${{ secrets.DOCKER_LOGIN }}\", \"repository\": \"${{ secrets.DOCKER_NAME }}\", \"tag\": \"${{ env.RELEASE_VERSION }}\", \"ports\": {\"8080\": 8080}}'"</code> </pre> </div></div><br><p style=";text-align:right;direction:rtl">  ุญุณููุง ุ ููุฏ ุฌูุนูุงูุง ุฌููุนูุง ุ ุงูุขู ุณููุดุฆ ุฅุตุฏุงุฑูุง ุฌุฏูุฏูุง ูููุธุฑ ุฅูู ุงูุฅุฌุฑุงุกุงุช. <br><img src="https://habrastorage.org/webt/07/dn/5q/07dn5qrqodyyfaulm6gpey7w8my.png"><br>  <em>Webhook ููุดุฑ ุชุทุจูู ุฅุฌุฑุงุกุงุช ูุงุฌูุฉ</em> </p><br><p style=";text-align:right;direction:rtl">  ูู ุดูุก ุชู ุฅููุงูู ุ ูููู ุจุชูุฏูู ุทูุจ GET ุฅูู ุฎุฏูุฉ ุงููุดุฑ (ูุนุฑุถ ุฌููุน ุงูุญุงููุงุช ุงููุดุทุฉ ุนูู ุงููุถูู): <br><img src="https://habrastorage.org/webt/gq/1w/yg/gq1wygbewjefugj8itjchn2ucki.png"><br>  <em>ูุดุฑ ุนูู ุญุงููุฉ VPS</em> </p><br><p style=";text-align:right;direction:rtl">  ุงูุขู ุณูู ูุฑุณู ุงูุทูุจุงุช ุฅูู ุงูุชุทุจูู ุงูููุดูุฑ: <br><img src="https://habrastorage.org/webt/hs/9x/hz/hs9xhzawrwliyoptcccjd-48bco.png"><br>  <em>ุงูุญุตูู ุนูู ุทูุจ ููุญุงููุฉ ุงูููุดูุฑุฉ</em> </p><br><img src="https://habrastorage.org/webt/jf/fy/xc/jffyxcdf8zyzfylylyufv8wlcp0.png" alt="ุทูุจ ุขุฎุฑ ููุญุงููุฉ ุงูููุดูุฑุฉ"><br><p style=";text-align:right;direction:rtl">  <em>ุทูุจ ุขุฎุฑ ููุญุงููุฉ ุงูููุดูุฑุฉ</em> </p><br><p style=";text-align:right;direction:rtl">  <strong>ุงููุชุงุฆุฌ</strong> <br>  GitHub Actions ูู ุฃุฏุงุฉ ูุฑูุญุฉ ููุบุงูุฉ ููุฑูุฉ ููููู ูู ุฎูุงููุง ุงูููุงู ุจุงูุนุฏูุฏ ูู ุงูุฃุดูุงุก ุงูุชู ูููู ุฃู ุชุจุณุท ุญูุงุชู ุฅูู ุญุฏ ูุจูุฑ.  ูู ูุฐุง ูุชููู ุนูู ุงูุฎูุงู. <br>  ุฃููุง ุชุฏุนู ุงุฎุชุจุงุฑ ุงูุชูุงูู ูุน ุงูุฎุฏูุงุช. <br>  ููุชูุงุตู ููุทูู ููุฐุง ุงููุดุฑูุน ุ ููููู ุฅุถุงูุฉ ุงููุฏุฑุฉ ุนูู ุชูุฑูุฑ ุงููุนููุงุช ุงููุฎุตุตุฉ ูุชุดุบูู ุงูุญุงููุฉ ุฅูู webhook. <br>  ูู ุงููุณุชูุจู ุ ุณุฃุญุงูู ุฃู ุฃุถุน ูุฐุง ุงููุดุฑูุน ูุฃุณุงุณ ููุดุฑ ูุฎุทุทุงุช ุงูุฏูุฉ ุนูุฏูุง ุฃุฏุฑุณ ูุฃุฌุฑู ุชุฌุฑุจุฉ ูุน K8s </p><br><p style=";text-align:right;direction:rtl">  ุฅุฐุง ูุงู ูุฏูู ููุน ูู ุงููุดุงุฑูุน ุงูููุฒููุฉ ุ ููููู ูู GitHub Actions ุชุจุณูุท ุงูุนูู ุฅูู ุญุฏ ูุจูุฑ ูุน ุงููุณุชูุฏุน. </p><br><p style=";text-align:right;direction:rtl">  ุชูุงุตูู ุจูุงุก ุงูุฌููุฉ ูููู ุงูุนุซูุฑ ุนูููุง <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง.</a> <br>  ุฌููุน ูุตุงุฏุฑ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุงููุดุฑูุน</a> </p><cut text=" "></cut></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar476368/">https://habr.com/ru/post/ar476368/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar476348/index.html">ููู ุฃุฏุฎู ุงูููููุงุฆููู ูู ุฌุงูุนุฉ ุญููููุฉ ูุจุงุฏุฆ ุชูููููุฌูุง ุงููุนูููุงุช ูู ุนูููู ูุฃุตุจุญูุง ูุงุฏุฉ ุงููุฑู</a></li>
<li><a href="../ar476352/index.html">ุฅุฏุงุฑุฉ ุงูุฎุฏูุฉ ุงูููุฏุงููุฉ ูุงูุฎุฏูุฉ ุงูููุฏุงููุฉ. ูู ูุตูุช ุฑูุณูุง ุฅูู ููุทุฉ ุฅุฏุงุฑุฉ ูููุฏุณู ุงูุฎุฏูุฉ ุงูููุฏุงููุฉุ</a></li>
<li><a href="../ar476354/index.html">ุซูุงุซ ุฎุทูุงุช ุนูููุฉ ูุชูููุฑ ููุงุฑุฏ ุจุฏุก ุงูุชุดุบูู ุงูุฎุงุต ุจู</a></li>
<li><a href="../ar476358/index.html">ุดุจูุฉ ุฎุฏูุฉ ูู microservices. ุงูุฌุฒุก ุงูุฃูู</a></li>
<li><a href="../ar476366/index.html">ุฐูุจ ุงูุณูู: ููู ูููู ุฃู ุงูููุช ูุฏ ุญุงู ุจุงููุณุจุฉ ูููุนุงูุฌ ูููููุฉ ุงูุนุซูุฑ ุนููู</a></li>
<li><a href="../ar476370/index.html">ูุชููุฑ ูููุน JetBrains ุงูุฑุณูู ุจุงููุบุฉ ุงูุฑูุณูุฉ</a></li>
<li><a href="../ar476372/index.html">ูุธุฑูุฉ ุงููุฆุฉ ุชุณูุญ ููุฑูุงุถูุงุช ุจุงูุชุฎูู ุนู ุงููุณุงูุงุฉ</a></li>
<li><a href="../ar476374/index.html">ุงูุฃุฎูุงู ุฑุงูุช: ุจุฑุงุกุงุช ุงูุงุฎุชุฑุงุน ุงูุฃููู ุงููุชุตูุฏูู</a></li>
<li><a href="../ar476378/index.html">Recoverุ CUDA - Intel ุชุนูู ุนู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช 7nm ููุฑุงูุฒ ุงูุจูุงูุงุช</a></li>
<li><a href="../ar476380/index.html">ุชุฏุงูู ุงูุนููุงุช ุงููุดูุฑุฉ - ููููุฉ ุชุทููุฑ ุงุณุชุฑุงุชูุฌูุฉ ูุณุชุฏุงูุฉ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>