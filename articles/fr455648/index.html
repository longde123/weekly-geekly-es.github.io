<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚úåüèª üîí üÜó Cycle de vie ML üçé ü§ñ üêÖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans une v√©ritable impl√©mentation ML, l'apprentissage lui-m√™me prend un quart de l'effort. Les trois quarts restants sont la pr√©paration des donn√©es p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cycle de vie ML</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/oleg-bunin/blog/455648/">  Dans une v√©ritable impl√©mentation ML, l'apprentissage lui-m√™me prend un quart de l'effort.  Les trois quarts restants sont la pr√©paration des donn√©es par la douleur et la bureaucratie, un d√©ploiement complexe souvent en boucle ferm√©e sans acc√®s √† Internet, la configuration de l'infrastructure, les tests et la surveillance.  Documents sur des centaines de feuilles, mode manuel, conflits de version de mod√®le, open source et entreprise s√©v√®re - tout cela attend un data scientist.  Mais il n'est pas int√©ress√© par de tels probl√®mes op√©rationnels ¬´ennuyeux¬ª, il veut d√©velopper un algorithme, atteindre une haute qualit√©, redonner et ne plus se souvenir. <br><br>  Peut-√™tre, quelque part ML est impl√©ment√© plus facilement, plus simplement, plus rapidement et avec un seul bouton, mais nous n'avons pas vu de tels exemples.  Tout ce qui pr√©c√®de est l‚Äôexp√©rience de Front Tier en fintech et en t√©l√©communications.  Sergey Vinogradov, expert en architecture de syst√®mes fortement charg√©s, en grands stockages et en analyse de donn√©es lourdes, a parl√© de lui √† <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HighLoad ++</a> . <br><br><img src="https://habrastorage.org/webt/ss/7n/cm/ss7ncmtdsij0wncwt-uuzxneit8.jpeg"><br><a name="habracut"></a><br><h2>  Cycle de vie du mod√®le </h2><br>  Habituellement, le cycle de vie dans notre domaine comprend trois parties.  Dans le premier <strong>, une t√¢che vient de l'entreprise</strong> .  Dans le second, un <strong>ing√©nieur de donn√©es et / ou un scientifique des donn√©es pr√©parent des donn√©es</strong> , construisent un mod√®le.  Dans la troisi√®me partie, le <strong>chaos</strong> commence.  Dans les deux derniers, diff√©rentes situations int√©ressantes se produisent. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/7GM9ac6ojtw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  Jack de tous les m√©tiers </h3><br>  La premi√®re situation fr√©quente est qu'un data scientist ou data engineer a acc√®s aux produits, alors ils lui disent: "Tu as fait tout √ßa, tu paries." <br><br>  Une personne prend un <strong>bloc-notes Jupyter</strong> ou un ensemble de blocs-notes, les consid√®re exclusivement comme un artefact de d√©ploiement et commence √† se r√©pliquer avec joie sur certains serveurs. <br><br>  Tout semble aller bien, mais pas toujours.  Je te dirai plus tard pourquoi. <br><br><h3>  Exploitation impitoyable </h3><br>  La deuxi√®me histoire est plus complexe et se produit g√©n√©ralement dans les entreprises o√π l'exploitation a atteint un √©tat de folie l√©g√®re.  Le data scientist met sa solution en service.  Ils ouvrent cette bo√Æte noire et voient quelque chose de terrible: <br><br><ul><li>  cahiers </li><li>  cornichon de diff√©rentes versions; </li><li>  tas de scripts: il n'est pas clair o√π et quand les ex√©cuter, o√π enregistrer les donn√©es qu'ils g√©n√®rent. </li></ul><br>  Dans ce puzzle, l'exploitation rencontre l'incompatibilit√© de version.  Par exemple, un data scientist n'a pas sp√©cifi√© de version sp√©cifique de la biblioth√®que et l'op√©ration a pris la derni√®re version.  Apr√®s un certain temps, le data scientist recourt: <br><br>  <em>- Vous d√©finissez scikit-learn sur la mauvaise version, maintenant toutes les mesures ont disparu!</em>  <em>Besoin de revenir √† la version pr√©c√©dente.</em> <br><br>  Cela casse compl√®tement la prod et l'exploitation en souffre. <br><br><h3>  Bureaucratie </h3><br>  Dans les entreprises avec des logos verts, lorsque le Data Scientist entre en service et apporte le mod√®le, il re√ßoit g√©n√©ralement un document de 800 feuilles en r√©ponse: ¬´Suivez ces instructions, sinon votre produit ne verra jamais le jour¬ª. <br><br>  Le triste scientifique des donn√©es part, jette tout √† mi-chemin, puis quitte - il n'est pas int√©ress√© √† faire cela. <br><br><h3>  D√©ployer </h3><br>  Supposons qu'un data scientist ait parcouru tous les cercles et finalement tout a √©t√© d√©ploy√©.  Mais il ne pourra pas comprendre que tout fonctionne comme il se doit.  D'apr√®s mon exp√©rience, dans les m√™mes banques b√©nies, il n'y a pas de surveillance des produits de science des donn√©es. <br><br>  C'est bien si le sp√©cialiste √©crit les r√©sultats de son travail dans la base de donn√©es.  Au bout d'un moment, il les recevra et verra ce qui se passe √† l'int√©rieur.  Mais cela ne se produit pas toujours.  Lorsqu'une entreprise et un data scientist croient simplement que tout fonctionne correctement et √† merveille, cela se traduit par des cas infructueux. <br><br><h3>  MFI </h3><br>  D'une mani√®re ou d'une autre, nous avons d√©velopp√© un moteur de notation pour une grande organisation de microfinance.  Ils ne les ont pas laiss√©s aller au prod, mais ont simplement pris une cascade de mod√®les de nous, l'ont install√© et l'ont lanc√©.  Les r√©sultats des tests des mod√®les les ont satisfaits.  Mais apr√®s 6 mois, ils sont revenus: <br><br>  <em>- C'est tout mauvais.</em>  <em>Les affaires ne vont pas, nous allons de pire en pire.</em>  <em>Il semble que les mod√®les soient excellents, mais les r√©sultats baissent, les fraudes et les d√©fauts de plus en plus, et moins d'argent.</em>  <em>Pourquoi t'avons-nous pay√©?</em>  <em>Faisons les choses correctement.</em> <br><br>  De plus, l'acc√®s au mod√®le n'est √† nouveau pas donn√©.  Les journaux ont √©t√© d√©charg√©s pendant un mois, d'ailleurs, il y a six mois.  Nous avons √©tudi√© le d√©chargement pendant un autre mois et sommes arriv√©s √† la conclusion qu'√† un moment donn√©, le service informatique de l'IMF a modifi√© les donn√©es d'entr√©e et qu'au lieu de documents en json, ils ont commenc√© √† envoyer des documents en xml.  Le mod√®le attendait json, mais a re√ßu xml, √©tait triste et pensait qu'il n'y avait pas de donn√©es √† l'entr√©e. <br><br><blockquote>  S'il n'y a pas de donn√©es, alors l'√©valuation de ce qui se passe est diff√©rente.  Sans surveillance, cela ne peut pas √™tre d√©tect√©. </blockquote><br><h3>  Nouvelle version, cascade et tests </h3><br>  Souvent, nous sommes confront√©s au fait que le mod√®le fonctionne bien, mais pour une raison quelconque, une <strong>nouvelle version a √©t√©</strong> d√©velopp√©e.  Le mod√®le doit √† nouveau √™tre introduit d'une mani√®re ou d'une autre, et √† nouveau parcourir tous les cercles de l'enfer.  C'est bien si les versions de la biblioth√®que sont les m√™mes que dans le mod√®le pr√©c√©dent, et sinon, le d√©ploiement recommence ... <br><br>  Parfois, avant de mettre une nouvelle version au combat, nous voulons la <strong>tester</strong> - mettez-la sur la prod, regardez le m√™me flux de trafic, assurez-vous qu'elle est bonne.  Il s'agit l√† encore de la cha√Æne de d√©ploiement compl√®te.  De plus, nous avons mis en place les syst√®mes de sorte que selon ce mod√®le, les r√©sultats r√©els ne se produisent pas, si nous parlons de notation, mais il n'y avait que le suivi et l'analyse des r√©sultats pour une analyse plus approfondie. <br><br>  Il existe des situations o√π une <strong>cascade de mod√®les est utilis√©e.</strong>  Lorsque les r√©sultats des mod√®les suivants d√©pendent des pr√©c√©dents, vous devez d'une mani√®re ou d'une autre √©tablir une interaction entre eux et quelque part, tout cela devrait √™tre enregistr√©. <br><br><h2>  Comment r√©soudre de tels probl√®mes? </h2><br>  Souvent, une personne r√©sout les probl√®mes <strong>manuellement</strong> , en particulier dans les petites entreprises.  Il sait comment tout fonctionne, garde √† l'esprit toutes les versions des mod√®les et des biblioth√®ques, sait o√π et quels scripts fonctionnent, quelles vitrines ils construisent.  Tout cela est merveilleux.  Les histoires que le mode manuel laisse derri√®re elles sont particuli√®rement belles. <br><br>  <strong>L'histoire de l'h√©ritage</strong> .  Un homme bon travaillait dans une petite banque.  Une fois, il est all√© dans un pays du sud et n'est pas revenu.  Apr√®s cela, nous avons obtenu un h√©ritage: un tas de code qui g√©n√®re des vitrines sur lesquelles les mod√®les de mod√®les fonctionnent.  Le code est beau, il fonctionne, mais nous ne connaissons pas la version exacte du script qui g√©n√®re telle ou telle vitrine.  Dans la bataille, toutes les vitrines sont pr√©sentes et toutes sont lanc√©es.  Nous avons pass√© deux mois √† essayer de distinguer cet enchev√™trement complexe et de le structurer en quelque sorte. <br><br>  <strong>Dans une entreprise difficile, les</strong> gens ne veulent pas se soucier de toutes sortes de Python, Jupiters, etc. Ils disent: <br><br>  <em>- Achetons IBM SPSS, installons et tout ira bien.</em>  <em>Les probl√®mes de versionnage, de sources de donn√©es et de d√©ploiement y ont √©t√© r√©solus.</em> <br><br>  Cette approche a le droit d'exister, mais tout le monde ne peut pas se le permettre.  Dans tous les cas, il s'agit d'une telle aiguille dentel√©e de haute qualit√©.  Ils sont assis dessus, mais √ßa ne marche pas pour descendre - des encoches.  Et cela co√ªte g√©n√©ralement beaucoup. <br><br>  <strong>L'Open Source est l'</strong> oppos√© de l'approche pr√©c√©dente.  Les d√©veloppeurs ont surf√© sur Internet, ont trouv√© de nombreuses solutions Open Source qui r√©solvent leurs t√¢ches √† des degr√©s divers.  C'est un excellent moyen, mais pour nous, nous n'avons pas trouv√© de solutions qui satisferaient √† 100% nos exigences. <br><br>  Par cons√©quent, nous avons choisi l'option classique - <strong>notre d√©cision</strong> .  Ses b√©quilles, ses v√©los, tous les leurs, natifs. <br><br><h2>  Que voulons-nous de notre d√©cision? </h2><br><br>  <strong>N'√©crivez pas tout vous-m√™me</strong> .  Nous voulons prendre des composants, en particulier des infrastructures, qui ont fait leurs preuves et qui connaissent bien le fonctionnement des institutions avec lesquelles nous travaillons.  Nous venons d'√©crire un environnement qui isolera facilement le travail du data scientist du travail de DevOps. <br><br>  <strong>Traitez les donn√©es en deux modes: en mode batch - Batch et en temps r√©el</strong> .  Nos t√¢ches incluent les deux modes de fonctionnement. <br><br>  <strong>Facilit√© de d√©ploiement et dans un p√©rim√®tre ferm√©</strong> .  Lorsque vous travaillez avec des donn√©es priv√©es sensibles, il n'y a pas de connexion Internet.  √Ä ce stade, tout doit arriver rapidement et avec pr√©cision √† la production.  Par cons√©quent, nous avons commenc√© √† regarder vers Gitlab, le pipeline CI / CD √† l'int√©rieur et Docker. <br><br><blockquote>  Un mod√®le n'est pas une fin en soi.  Nous ne r√©solvons pas le probl√®me de la construction d'un mod√®le, nous r√©solvons un probl√®me commercial. </blockquote><br>  √Ä l'int√©rieur du pipeline, il doit y avoir des r√®gles et une conglom√©ration de mod√®les avec prise en charge de la <strong>gestion</strong> des <strong>versions de tous</strong> les composants du pipeline. <br><br>  Qu'entend-on par pipeline?  En Russie, la loi f√©d√©rale 115 sur la lutte contre le blanchiment d'argent et le financement du terrorisme est en vigueur.  Seule la table des mati√®res des recommandations de la Banque centrale occupe 16 √©crans.  Ce sont des r√®gles simples qu'une banque peut respecter si elle dispose de telles donn√©es, ou ne peut pas le faire si elle n'a pas de donn√©es. <br><br>  L'√©valuation d'un emprunteur, d'une transaction financi√®re ou d'un autre processus op√©rationnel est un flux de donn√©es que nous traitons.  Un flux doit passer par ce type de r√®gle.  Ces r√®gles sont d√©crites de mani√®re simple par l'analyste.  Ce n'est pas un scientifique des donn√©es, mais il conna√Æt bien la loi ou d'autres instructions.  L'analyste s'assoit et, en langage clair, d√©crit les v√©rifications des donn√©es. <br><br>  <strong>Construisez des cascades de mod√®les</strong> .  Souvent, une situation se pr√©sente lorsque le mod√®le suivant utilise pour son travail les valeurs obtenues dans les mod√®les pr√©c√©dents. <br><br>  <strong>Testez rapidement les hypoth√®ses.</strong>  Je r√©p√®te la th√®se pr√©c√©dente: un scientifique des donn√©es a fait une sorte de mod√®le, il tourne au combat et fonctionne bien.  Pour une raison quelconque, le sp√©cialiste a trouv√© une meilleure solution, mais ne veut pas ruiner le flux de travail √©tabli.  Le data scientist suspend un nouveau mod√®le sur le m√™me trafic de combat dans le syst√®me de combat.  Elle ne participe pas directement √† la prise de d√©cision, mais sert le m√™me trafic, consid√®re certaines conclusions et ces conclusions sont stock√©es quelque part. <br><br>  <strong>Fonction de r√©utilisation facile.</strong>  De nombreuses t√¢ches ont le m√™me type de composants, en particulier celles li√©es √† l'extraction de fonctionnalit√©s ou de r√®gles.  Nous voulons faire glisser ces composants dans d'autres pipelines. <br><br><h2>  Qu'avez-vous d√©cid√© de faire? </h2><br>  Nous voulons d'abord une surveillance.  Et deux du genre. <br><br><h3>  Suivi </h3><br>  <strong>Suivi technique.</strong>  Si des composants de pipeline sont d√©ploy√©s, en fonctionnement, ils devraient voir ce qui arrive au composant: comment il consomme de la m√©moire, du processeur, du disque. <br><br>  <strong>Suivi des affaires.</strong>  Il s'agit d'un outil de data scientist qui vous permet de faire abstraction des nuances techniques de la mise en ≈ìuvre.  Au niveau de la conception, la construction permet de d√©terminer les m√©triques de mod√®le qui doivent √™tre disponibles dans la surveillance, par exemple, la distribution des fonctionnalit√©s ou les r√©sultats du service de notation. <br><br>  Un data scientist d√©finit des m√©triques et ne doit pas se soucier de la mani√®re dont elles entrent dans le syst√®me de surveillance.  La seule chose importante est qu'il a d√©fini ces m√©triques et l'apparence du tableau de bord sur lequel les m√©triques seront affich√©es.  Ensuite, le sp√©cialiste a tout lanc√© sur la production, d√©ploy√©, et apr√®s un certain temps, les mesures ont √©t√© vers√©es dans la surveillance.  Ainsi, un data scientist sans acc√®s au produit peut voir ce qui se passe √† l'int√©rieur du mod√®le. <br><br><h3>  Test </h3><br>  Testez la <strong>coh√©rence</strong> du <strong>pipeline</strong> .  Compte tenu des sp√©cificit√©s du pipeline, il s'agit d'une sorte de graphe informatique.  Nous voulons comprendre que nous mettons en ≈ìuvre un graphique, nous pouvons le contourner et trouver un moyen de s'en sortir. <br><br>  Le graphique a des composants - modules.  Tous les modules doivent r√©ussir les tests unitaires et d'int√©gration.  Le processus doit √™tre transparent et facile pour un scientifique des donn√©es. <br><br>  Le d√©veloppeur d√©crit le mod√®le et teste seul ou avec l'aide de quelqu'un d'autre.  Met tout dans Gitlab, le pipeline configur√© par l'int√©gration continue soul√®ve, teste, voit les r√©sultats.  Si tout va bien - √ßa va plus loin, non - √ßa recommence. <br><br>  Le data scientist se concentre sur le mod√®le et ne sait pas ce qu'il y a sous le capot.  Pour cela, on lui donne plusieurs choses. <br><br><ul><li>  <strong>Une API pour l'int√©gration avec le c≈ìur du</strong> <strong>syst√®me lui-m√™me</strong> via le bus de donn√©es - bus de messages.  Dans ce cas, le sp√©cialiste doit d√©crire ce qui entre et ce qui sort de son mod√®le, le point d'entr√©e et la jonction avec diff√©rents composants √† l'int√©rieur du pipeline. </li><li>  Apr√®s avoir entra√Æn√© le mod√®le, un <strong>artefact</strong> appara√Æt <strong>- un fichier XGBoost</strong> ou <strong>pickle</strong> .  Le data scientist a un ex√©cuteur pour travailler avec les artefacts - il doit int√©grer les composants du pipeline √† l'int√©rieur. </li><li>  API simple et transparente pour le scientifique des donn√©es pour surveiller le fonctionnement des composants du pipeline - surveillance technique et commerciale. </li><li>  <strong>Une infrastructure simple et transparente</strong> pour l'int√©gration avec les sources de donn√©es et la pr√©servation des r√©sultats de travail. </li></ul><br>  Souvent, les mod√®les fonctionnent pour nous, et apr√®s un certain temps arrive un audit qui veut retracer toute l'histoire du service.  L'audit veut v√©rifier l'exactitude des travaux, l'absence de fraude de notre part.  Des outils simples sont n√©cessaires pour que tout auditeur connaissant SQL puisse acc√©der √† un r√©f√©rentiel sp√©cial et voir comment tout a fonctionn√©, quelles d√©cisions ont √©t√© prises et pourquoi. <br><br>  Nous avons jet√© les bases de deux histoires importantes pour nous. <br><br>  <strong>Parcours client.</strong>  C'est l'occasion d'utiliser les m√©canismes de pr√©servation de l'historique complet du client - ce qui est arriv√© au client dans le cadre des processus m√©tier mis en ≈ìuvre sur ce syst√®me. <br><br>  Nous pouvons avoir des sources de donn√©es externes, par exemple, des plates-formes DMP.  Nous obtenons d'eux des informations sur le comportement humain sur le r√©seau et sur les appareils mobiles.  Cela peut avoir un effet sur le LTV et les mod√®les de score de son mod√®le.  Si l'emprunteur est en retard de paiement, nous pouvons pr√©dire qu'il ne s'agit pas d'une intention malveillante - il y a simplement des probl√®mes.  Dans ce cas, nous appliquons des m√©thodes douces d'exposition √† l'emprunteur.  Lorsque les probl√®mes sont r√©solus, le client cl√¥turera le pr√™t.  Quand il viendra la prochaine fois, nous conna√Ætrons toute son histoire.  Le scientifique des donn√©es obtiendra un historique visuel du mod√®le et effectuera la notation en mode lumi√®re. <br><br>  <strong>Identification des anomalies</strong> .  Nous sommes constamment confront√©s √† un monde tr√®s complexe.  Par exemple, les points faibles de l'√©valuation acc√©l√©r√©e des IMF peuvent √™tre une source de fraude automatique. <br><br>  Customer Journey est un concept d'acc√®s rapide et facile au flux de donn√©es qui traverse le mod√®le.  Le mod√®le permet de d√©tecter facilement les anomalies caract√©ristiques de la fraude au moment de son apparition massive. <br><br><h2>  Comment tout est-il arrang√©? </h2><br>  Sans h√©sitation, nous avons pris <strong>Kafka</strong> comme un patch Message Bus.  C'est une bonne solution qui est utilis√©e par beaucoup de nos clients, l'op√©ration est en mesure de travailler avec elle. <br><br><img src="https://habrastorage.org/webt/uu/5k/3r/uu5k3rnxw7lu4iulruewhzmif8w.jpeg"><br><br><blockquote>  Certains composants du syst√®me peuvent d√©j√† √™tre utilis√©s dans l'entreprise elle-m√™me.  Nous ne reconstruisons pas le syst√®me, mais r√©utilisons ce qu'ils ont d√©j√†. </blockquote><br>  <strong>Le stockage de donn√©es</strong> dans ce cas est le stockage que le client poss√®de g√©n√©ralement d√©j√†.  Il peut s'agir de bases de donn√©es Hadoop, relationnelles et non relationnelles.  Nous pouvons travailler nativement hors de la bo√Æte avec HDFS, Hive, Impala, Greenplum et PostgreSQL.  Nous consid√©rons ces stockages comme une source de vitrines. <br><br>  Les donn√©es arrivent √† l'entrep√¥t, transitent par notre ETL ou l'ETL du client, s'il en a un.  Nous construisons des vitrines qui sont davantage utilis√©es √† l'int√©rieur des mod√®les.  Le stockage des donn√©es est utilis√© en mode lecture seule. <br><br><h3>  Nos d√©veloppements </h3><br>  <strong>Tableau noir</strong>  Le nom est tir√© d'une pratique assez √©trange des math√©maticiens des ann√©es 30-40.  Il s'agit du gestionnaire des pipelines qui vivent dans le syst√®me d'administration.  Blackboard a une sorte de m√©ta-stockage.  Il stocke les pipelines eux-m√™mes et les configurations n√©cessaires pour initialiser tous les composants. <br><br>  Tout le travail sur le syst√®me commence par le Blackboard.  Par miracle, le pipeline s'est retrouv√© dans Meta Storage, Blackboard apr√®s un certain temps comprend cela, sort la version actuelle du pipeline, l'initialise et envoie un signal √† l'int√©rieur de Kafka. <br><br>  Il existe un <strong>environnement d'ex√©cution</strong> .  Il est construit sur Dockers et peut √™tre r√©pliqu√© sur des serveurs, y compris dans le cloud priv√© du client. <br><br>  De la bo√Æte vient le principal <strong>Actor :: Init</strong> - c'est l'initialiseur.  C'est un g√©nie qui ne peut faire que deux choses: <strong>construire</strong> et <strong>d√©truire des composants</strong> .  Il re√ßoit une commande de Blackboard: "Voici le pipeline, il faut le lancer sur tel ou tel serveur avec telle ou telle ressource en telle ou telle quantit√© - √ßa marche!"  Ensuite, l'acteur commence tout. <br><br>  Math√©matiquement, un acteur est une fonction qui prend un ou plusieurs objets en entr√©e, √† l'int√©rieur il modifie l'√©tat des objets selon un algorithme, √† la sortie il cr√©e un nouvel objet ou change l'√©tat d'un existant. <br><br>  Techniquement, un acteur est un programme Python.  S'ex√©cute dans un conteneur Docker avec son environnement. <br><br>  L'acteur ne conna√Æt pas l'existence d'autres acteurs.  La seule entit√© qui sait qu'en plus de l'acteur existe l'ensemble du pipeline dans son ensemble - c'est Blackboard.  Il surveille l'√©tat d'ex√©cution de tous les acteurs du syst√®me et maintient l'√©tat actuel, qui s'exprime dans la surveillance comme une image de l'ensemble du processus m√©tier dans son ensemble. <br><br>  Actor :: Init g√©n√®re de nombreux conteneurs Docker.  De plus, les acteurs peuvent travailler avec le stockage de donn√©es. <br><br>  Le syst√®me lui-m√™me poss√®de un composant de <strong>stockage d'√©v√©nements</strong> .  En tant que stockage d'√©v√©nements, nous utilisons <strong>ClickHouse</strong> .  Sa t√¢che est simple: toutes les informations √©chang√©es entre l'acteur via Kafka sont stock√©es dans ClickHouse.  Ceci est fait <strong>pour un audit suppl√©mentaire</strong> .  Il s'agit du journal des op√©rations du pipeline. <br><br>  Des acteurs peuvent √©galement √™tre d√©velopp√©s pour le <strong>parcours client</strong> .  Ils voient les modifications dans le journal du pipeline et peuvent reconstruire √† la vol√©e les fen√™tres n√©cessaires pour que les mod√®les ou les composants fonctionnent avec les r√®gles, d√©j√† √† l'int√©rieur du pipeline.  Il s'agit d'un processus continu de modification des donn√©es. <br><br>  La surveillance est plut√¥t bas√©e primitivement sur <strong>Prom√©th√©e</strong> .  L'acteur re√ßoit une API de base, et en mode ferm√©, mais suffisamment transparent pour le d√©veloppeur, il envoie des messages avec des m√©triques √† Kafka.  Prometheus lit les m√©triques de Kafka et les enregistre dans son r√©f√©rentiel. <br><br>  Pour la visualisation, nous utilisons <strong>Grafana</strong> . <br><br><h3>  Deux points d'int√©gration </h3><br>  Le premier est le point d'int√©gration avec les sources de donn√©es qui passent par des ETL √† l'entrep√¥t de donn√©es.  Deuxi√®me point d'int√©gration lorsqu'un service est d√©j√† utilis√© par un consommateur de donn√©es, par exemple un service de scoring. <br><br>  Nous avons pris <strong>Apache ServiceMix.</strong>  Par exp√©rience, ces points d'int√©gration sont du m√™me type avec le m√™me type de protocoles: SOAP, RESTful, moins souvent les files d'attente.  Chaque fois, nous ne voulons pas d√©velopper notre propre constructeur ou service afin de g√©n√©rer le prochain service SOAP.  Par cons√©quent, nous prenons ServiceMix, le d√©crivons dans le SDL, dans lequel les mod√®les de donn√©es de ce service et les m√©thodes qui y existent sont construits.  Ensuite, nous poussons le routeur √† l'int√©rieur de ServiceMix, et il g√©n√®re le service lui-m√™me. <br><br>  De nous-m√™mes, nous avons ajout√© une conversion synchrone-asynchrone d√©licate.  Toutes les demandes qui vivent √† l'int√©rieur du syst√®me sont asynchrones et passent par le bus de messages. <br><br>  La plupart des services de notation sont synchrones.  Les demandes ServiceMix proviennent de REST ou SOAP.  √Ä ce stade, il passe par notre passerelle, qui conserve la connaissance de la session HTTP.  Ensuite, il envoie un message √† Kafka, il passe par un pipeline et une solution est g√©n√©r√©e. <br><br>  Cependant, il n'y a peut-√™tre toujours pas de solution.  Par exemple, quelque chose est tomb√©, ou il y a un SLA difficile √† prendre, et Gateway surveille: ¬´OK, j'ai re√ßu une demande, il est venu vers moi dans un autre sujet Kafka, ou rien ne m'est venu, mais mon d√©clencheur de d√©lai d'attente a fonctionn√©.¬ª  L√† encore, la conversion de synchrone en asynchrone va, et au sein de la m√™me session HTTP, il y a une r√©ponse au consommateur avec le r√©sultat du travail.  Cela peut √™tre une erreur ou une pr√©vision normale. <br><br>  Dans ce lieu, d'ailleurs, nous avons mang√© un chien insipide gr√¢ce √† la grande et puissante Open Source.  Nous avons utilis√© ServiceMix de l'une des derni√®res versions et Kafka des versions pr√©c√©dentes et tout fonctionnait parfaitement.  Nous avons √©crit dans cette passerelle, sur la base de ces cubes qui √©taient d√©j√† dans ServiceMix.  Lorsque la nouvelle version de Kafka est sortie, nous l'avons heureusement saisie, mais il s'est av√©r√© que le soutien aux headders dans le message √† Kafka qui existait auparavant avait chang√©.  La passerelle √† l'int√©rieur de ServiceMix ne peut plus fonctionner avec eux.  Pour comprendre cela, nous avons pass√© beaucoup de temps.  En cons√©quence, nous avons construit notre passerelle, qui peut fonctionner avec de nouvelles versions de Kafka.  Nous avons √©crit sur le probl√®me aux d√©veloppeurs de ServiceMix et avons re√ßu la r√©ponse: "Merci, nous vous aiderons certainement dans les prochaines versions!" <br><br>  Par cons√©quent, nous sommes oblig√©s de surveiller les mises √† jour et de changer r√©guli√®rement quelque chose. <br><br>  <strong>L'infrastructure est Gitlab.</strong>  Nous utilisons presque tout ce qui s'y trouve. <br><br><ul><li>  D√©p√¥t de code. </li><li>  Poursuite de l'int√©gration / Poursuite du pipeline de livraison. </li><li>  Registre pour g√©rer un registre de conteneurs Docker. </li></ul><br><h3>  Composants </h3><br>  Nous avons d√©velopp√© 5 composants: <br><br><ul><li>  <strong>Tableau noir</strong> - gestion du cycle de vie du pipeline.  O√π, quoi et avec quels param√®tres s'ex√©cuter √† partir du pipeline. </li><li>  <strong>L'extracteur de</strong> fonctionnalit√©s fonctionne simplement - nous informons l'extracteur de fonctionnalit√©s que nous obtenons tel ou tel mod√®le de donn√©es √† l'entr√©e, s√©lectionnons les champs n√©cessaires dans les donn√©es, les mappons √† certaines valeurs.  Par exemple, nous obtenons la date de naissance du client, la convertissons en √¢ge, l'utilisons comme fonctionnalit√© dans notre mod√®le.  L'extracteur de fonctionnalit√©s est responsable de l'enrichissement des donn√©es. </li><li>  <strong>Moteur bas√©</strong> sur des r√®gles - v√©rification des donn√©es selon les r√®gles.  Il s'agit d'un langage de description simple qui permet √† une personne familiaris√©e avec la construction des blocs &lt;code&gt; if, else &lt;code /&gt; de d√©crire les r√®gles de v√©rification au sein du syst√®me. </li><li>  <strong>Moteur d'apprentissage automatique</strong> - vous permet d'ex√©cuter l'ex√©cuteur, d'initialiser le mod√®le form√© et de le soumettre aux donn√©es d'entr√©e.  En sortie, le mod√®le prend des donn√©es. </li><li>  <strong>Moteur de</strong> d√©cision - <strong>moteur de</strong> d√©cision, sortie du graphique.  Ayant une cascade de mod√®les, par exemple, diff√©rentes branches de l'√©valuation de l'emprunteur, vous devez d√©cider quelque part de la question de l'argent.  L'ensemble de r√®gles pour la solution doit √™tre simple. ,     LTV- ‚Äî     ,     ,  . </li></ul><br><br><h3>   </h3><br>         .  ‚Äî  ,    .  ‚Äî      ,      . <br><br>   pipeline    . <br><img src="https://habrastorage.org/webt/o7/vy/dj/o7vydjrruyfittwhwzumh_gc_rq.jpeg"><br><ul><li>   <strong>Feature extractor</strong> :  ,        ,      . </li><li> <strong> </strong> . ,  -:  , ,       18. </li><li>  <strong> .</strong>    ,    .     ,      ,        pipeline. </li><li>  <strong>Decision engine</strong> .             . </li><li>  <strong></strong> . </li></ul><br>      yaml.         .    ,  ,        .           yaml. <br><br>  pipeline,   ,   : feature extractor, rules, models, decision engine,    .   ‚Äî <strong>      Docker-</strong> .    Registry,   Docker-. -,   ,    . ,  ,      Docker-       . <br><br><h3>  Pipeline </h3><br>     ,     <strong>Python</strong> ‚Äî         . Feature extractor, ,   decision engine   Python. <br><br> Pipeline   <strong>yaml.</strong>      meta storage     ‚Äî   <strong></strong> . <br><br>  Runtime environment   10 ,  Blackboard  ,    pipeline    10 .  ,      : , , IP-    Kafka, , .       . <br><br>     GitLab.      Ansible. ,    .           ,      50 000    Ansible  . <br><br><h2>   ? </h2><br>  GitLab  pipeline.    GitLab. CI  ,   ,  ,  .   <strong>GitLab Runner</strong> ,    Docker-  ,    pipeline.    ‚Äî    Registry. <br><br><img src="https://habrastorage.org/webt/gz/dx/hr/gzdxhruymhjm2_wejqybqizdp0i.jpeg"><br><br>  Docker  ,       .   Docker-        .   CI pipeline    pipeline  -  Meta Storage,    Blackboard. <br><br> Blackboard    Meta Storage ‚Äî   , , ,   -.   Docker-     , , . <br><br> -   Blackboard  Meta Storage      :   ,  Kafka,   .  ,    ,   Docker-    ,     . <br><br>  ,    Docker-,  ‚Äî pipeline ! <br><br>      DigitalOcean.     AWS  Scaleway,     . <br><br>    ,        .  pipeline         . ,    . <br><br><h3>    ? </h3><br>   ‚Äî   .  ,   pipeline,     real-time   . <br><br><ul><li> 2 Feature extractor  .     1 , .. json    . </li><li> 8  ‚Äî 8  ML engine.      XGBoost. </li><li> 18     RB engine (115 ).   1000     . </li><li> 1 decision engine. </li></ul><br>       200   .  2 Feature extractor, 8 , 18   1 decision engine      1,2 . <br><br><h3>  </h3><br> <strong>Discovery .</strong>  ,   -   .  ,      ,    .    .      Meta Storage. <br><br> <strong>  pipeline</strong> .    ,  <strong>BPM</strong> .        yaml      ,     ,      . <br><br> <strong>    .</strong>       Java, Scala, R.    Python,       ,     .    API   ,   pipeline      . <br><br><h2>  Quel est le r√©sultat? </h2><br>    ‚Äî     .    ‚Äî   .   <strong> </strong> ,      .  ,         .     ‚Äî     2018 . <br><br>         ,      .    ‚Äî    ,   ,    . <br><br> <strong>    ,   </strong> .     ,    ,    notebook   ,     . <br><br><blockquote> , -      ,  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="></a> ,           .  ,     , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="> </a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">UseData Conf</a> .  ,    ,       ,   16 . </blockquote></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr455648/">https://habr.com/ru/post/fr455648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr455638/index.html">Alan Kay n'a pas invent√© d'objets</a></li>
<li><a href="../fr455640/index.html">¬´La machine √† √©motions¬ª de Marvin Minsky: Chapitre 4. ¬´Comment nous reconnaissons la conscience¬ª</a></li>
<li><a href="../fr455642/index.html">L'architecture du service de file d'attente de messages distribu√©s dans Yandex.Cloud</a></li>
<li><a href="../fr455644/index.html">Nous utilisons les donn√©es dans la pratique</a></li>
<li><a href="../fr455646/index.html">Semaine de s√©curit√© 24: portes d√©rob√©es d'usine sur les smartphones Android</a></li>
<li><a href="../fr455650/index.html">Comment nous avons form√© un r√©seau de neurones pour classer les vis</a></li>
<li><a href="../fr455652/index.html">Deep Learning vs bon sens: d√©velopper un chat bot</a></li>
<li><a href="../fr455658/index.html">Intel Core i7-2600K l√©gendaire: test de Sandy Bridge en 2019 (partie 3)</a></li>
<li><a href="../fr455662/index.html">Grand √©cran m√©canique avec m√©canisme √† came comme d√©codeur</a></li>
<li><a href="../fr455666/index.html">G√©n√©rer des ventes sortantes dans une entreprise de services informatiques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>