<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üç§ üê∫ üöú Kit de inicia√ß√£o para testes de seguran√ßa na Web üë®‚Äç‚ù§Ô∏è‚Äçüë® üöµ üê≥</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ol√° pessoal! 

 Meu nome √© Andrey. Por 10 anos, tenho procurado vulnerabilidades em v√°rios servi√ßos da web. e pronto para compartilhar meu conheciment...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kit de inicia√ß√£o para testes de seguran√ßa na Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/semrush/blog/441966/">  Ol√° pessoal! <br><br>  Meu nome √© Andrey.  Por 10 anos, tenho procurado vulnerabilidades em v√°rios servi√ßos da web.  e pronto para compartilhar meu conhecimento com voc√™.  Em maio passado, fiz um relat√≥rio sobre isso na confer√™ncia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Heisenbug</a> e agora estou pronto para compartilhar meu conhecimento aqui tamb√©m nos espa√ßos abertos da Habr.  Ent√£o, vamos come√ßar. <br><br>  Uma vez <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">encontrei uma vulnerabilidade</a> nos servidores da not√≥ria empresa Facebook.  Os caras se esqueceram de atualizar o ImageMagick (a biblioteca para processamento de imagens) e pagaram por isso :) Com este exemplo, eu queria mostrar que somos todos pessoas e que todos podemos cometer erros, n√£o importa em que empresa e em que posi√ß√£o trabalhamos.  O √∫nico problema √© que esses erros podem levar a todos os tipos de riscos. <br>  Quanto mais complicado seu aplicativo / site / ferramenta, maior a probabilidade de que algo d√™ errado. <br>  Voc√™ precisa verificar se h√° vulnerabilidades.  √â tolice n√£o fazer isso. <br><a name="habracut"></a><br>  Os seguintes itens podem ser est√°gios de verifica√ß√£o de aplicativos da web: <br><ul><li>  Prepara√ß√£o: <ul><li>  Definir pontos de entrada - de fato, de onde os dados podem ser obtidos no aplicativo; </li><li>  Identificar estoque de tecnologia; </li><li>  Determine quais vulnerabilidades faz sentido verificar; </li></ul></li><li>  Verifica√ß√£o  Voc√™ precisa verificar todas as vulnerabilidades que se aplicam ao escopo da tecnologia do seu aplicativo da web; </li><li>  An√°lise de c√≥digo.  N√£o seja pregui√ßoso, n√£o pule este item.  Em alguns casos, sem acesso ao c√≥digo, √© dif√≠cil encontrar vulnerabilidades, e isso tamb√©m permite ignorar a filtragem que pode estar incorporada ao seu aplicativo. </li></ul><br>  Eu vou falar sobre tudo isso em detalhes. <br><br>  Ent√£o, prepara√ß√£o.  N√£o vou me concentrar em todos os tipos de vulnerabilidades, caso contr√°rio, a quantidade de texto no artigo exceder√° todos os tamanhos conceb√≠veis e inconceb√≠veis.  Aconselho que voc√™ comece a aprender com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">lista dos dez melhores projetos</a> da <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">OWASP</a> .  A cada poucos anos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">o cons√≥rcio OWASP</a> faz uma lista das vulnerabilidades mais relevantes no momento.  Vamos considerar alguns deles em detalhes. <br><br><h2>  Xss </h2><br>  <i>XSS (script entre sites)</i> √© um ataque a um usu√°rio que permite que um invasor execute um script arbitr√°rio no contexto do navegador de sua v√≠tima.  Na maioria das vezes, isso implica a implementa√ß√£o de tags <i>HTML</i> e scripts <i>JS</i> . <br>  Exemplo: uma vez houve um servi√ßo como o <i>Yahoo!</i>  <i>Ad Exchange</i>  O formul√°rio de recupera√ß√£o de senha tinha um par√¢metro " <i>Return URL</i> ".  Pode indicar a qual p√°gina retornar ap√≥s o processo de redefini√ß√£o de senha.  Se voc√™ inserir um ou outro vetor que leve √† execu√ß√£o do c√≥digo <i>JS</i> , poder√° obter todos os <i>cookies</i> do usu√°rio.  Vamos analisar como isso acontece e por qu√™. <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Aqui est√° o pr√≥prio vetor.  De repente: <br><img src="https://habrastorage.org/webt/ua/ko/8l/uako8l_hpqr4bov7qmzhm97xwj4.png"><br>  Para fazer uma inje√ß√£o, voc√™ precisa sair do contexto da vari√°vel em que est√°vamos por padr√£o (por padr√£o - √© isso que o programador assumiu quando escreveu o c√≥digo). <br>  Abaixo est√° o valor original.  Este √© um comportamento v√°lido. <br><img src="https://habrastorage.org/webt/v4/rm/l7/v4rml7dzf1rqpkyvgq8yxdnl3oi.png"><br>  Vemos que returnURL = / login.jsp <br>  Isso se enquadra no valor da <i>tag &lt;input&gt;</i> . <br>  Se adicionarmos aspas ap√≥s <i>jsp</i> , veremos que a sintaxe <i>HTML</i> foi derramada.  Felizmente, a linguagem <i>HTML</i> n√£o √© rigorosa, o analisador ir√° pular e n√£o haver√° problemas: <br><img src="https://habrastorage.org/webt/3o/s6/z1/3os6z130clrrtkshbktmqgkguto.png"><br>  Adicione outro caractere.  Aqui estamos completamente fora do contexto da <i>tag &lt;input&gt;</i> : <br><img src="https://habrastorage.org/webt/lg/x9/av/lgx9avfst6nskdlowyzx0uasgyy.png"><br>  Agora adicionamos a abertura da <i>tag &lt;svg&gt;</i> e obtemos duas tags v√°lidas em termos de sintaxe: <br><img src="https://habrastorage.org/webt/u8/pe/tg/u8petg6ghf1gajt49dvsvtfnzn0.png"><br>  Em seguida, adicione todo o vetor de ataque: <br><img src="https://habrastorage.org/webt/o2/t5/n8/o2t5n8-li9jpdao1cbzghum-mhe.png"><br>  Nesse caso, a imagem <i>svg</i> √© desenhada.  Usando o manipulador <i>JavaScript</i> " <i>onload</i> ", executamos um alerta com os <i>cookies do</i> documento.  Isso √© tudo!  O atacante recebeu seus <i>cookies</i> . <br>  Se na prova mostrarmos apenas o alerta em si, n√£o ser√° dif√≠cil para um invasor enviar cookies para um servidor controlado por ele e, na pior das hip√≥teses, apreender sua conta.  Vamos ver como fica novamente: <br><img src="https://habrastorage.org/webt/0m/uz/t0/0muzt08lkueaenx2gle8ydaidce.png"><br><br>  Tamb√©m h√° mais vetores de ataque ao cliente.  Vou dar alguns exemplos com uma breve descri√ß√£o.  Mas primeiro voc√™ precisa entender como sair do contexto: <br><ul><li>  Fora de contexto.  Esses 6 caracteres ajudar√£o a sair n√£o apenas do contexto do valor do par√¢metro HTML, mas tamb√©m de muitos outros: <br>  -&gt; '"&gt; <br></li></ul><br>  Bem, de fato, os dois vetores mais simples de ataque: <br><ul><li>  Inserir links em particular.  Mas, no caso geral - mudando a apar√™ncia da p√°gina.  Por exemplo, eles podem incorporar c√≥digo html √† sua p√°gina e exibir uma janela falsa solicitando dados: <br><img src="https://habrastorage.org/webt/dt/-p/yz/dt-pyzv0wcrhgxqihw3iuoccbnc.png"><br>  A sequ√™ncia " <i>aaaa</i> " aponta para <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">google.com</a> .  Voc√™ pode ver que o link √© renderizado na p√°gina, mas voc√™ pode n√£o v√™-lo, mas isso n√£o cancela sua presen√ßa no c√≥digo.  Nos dois casos, o caso pode ser considerado conclu√≠do; </li><li>  Execu√ß√£o de script, por exemplo, interceptando <i>cookies do</i> usu√°rio: <br><img src="https://habrastorage.org/webt/w8/yd/yb/w8ydybkf9oucxuawq_vumapupda.png"><br></li></ul><br><br><h3>  Onde e como procurar o XSS? </h3><br>  Primeiro, encontre as fun√ß√µes de sa√≠da de informa√ß√µes / dados na p√°gina.  Analisar quais dados chegam l√°?  A√≠ vem o conceito de uma <i>fonte n√£o confi√°vel</i> .  E assim, primeiro de tudo, √© <i>seu usu√°rio</i> .  Os vetores de ataque podem estar contidos em outras fontes: feeds RSS, outros servi√ßos, externos e internos. <br>  Aqui est√° um exemplo da vida real: trabalho para o SEMrush IT.  Estamos desenvolvendo uma plataforma online, que √© uma ferramenta universal para profissionais de marketing online.  Portanto, um servi√ßo salvou os dados e o outro deduziu, cada uma das equipes confiou uma na outra, resultou que no segundo servi√ßo o <i>XSS</i> surgiu devido √† falta de processamento adequado dos dados de sa√≠da, e o primeiro comando n√£o considerou necess√°rio filtrar os dados recebidos de qualquer maneira e os manteve " <i>como est√£o</i> ".  Conclus√£o: se voc√™ n√£o souber como esses dados s√£o armazenados, eles devem ser considerados n√£o confi√°veis.  Ou concorde com anteced√™ncia sobre quem armazena e como, filtra, exibe dados. <br><br>  Se voc√™ j√° possui dados de fontes n√£o confi√°veis, recomendo: <br><ul><li>  Estudar a filtragem de dados recebidos; </li><li>  Examine o contexto da sa√≠da.  Nem sempre o <i>XSS</i> pode ser executado, mesmo na aus√™ncia de filtragem.  Por exemplo, se o <i>tipo de conte√∫do da</i> resposta for: <i>texto / sem formata√ß√£o;</i> </li><li>  N√£o confie na filtragem de estruturas de sistemas de seguran√ßa incorporadas. </li></ul><br><br><h2>  Inje√ß√£o de SQL </h2><br><img src="https://habrastorage.org/webt/do/b8/ry/dob8ryjj2vifp3w1th18oroewis.png"><br><br>  <i>Implementa√ß√£o do c√≥digo SQL (inje√ß√£o SQL em ingl√™s)</i> - a introdu√ß√£o na consulta do banco de dados de instru√ß√µes que n√£o estavam impl√≠citas l√°. <br><br>  Exemplo (n√£o da vida, mas tamb√©m bom): <br>  Vemos um script que exibe uma tabela de usu√°rio.  Nesse caso, ele pode pesquisar por nome de usu√°rio. <br>  √Ä direita √© mostrada a apar√™ncia da consulta ao banco de dados e √† esquerda √© o resultado do script no navegador. <br><img src="https://habrastorage.org/webt/ng/u2/ou/ngu2ouq8da3jtb18gkjj2amzxss.png"><br>  Al√©m disso, para testar e obter pelo menos algum resultado prim√°rio, inserimos duas aspas no valor do par√¢metro name.  Simples e duplo: <br><img src="https://habrastorage.org/webt/0a/fd/ck/0afdckohg1xuacw-7olxyrzifha.png"><br>  Vemos que, do ponto de vista da produ√ß√£o, tudo desmoronou, a mesa desapareceu completamente.  A solicita√ß√£o tamb√©m recebe as 2 aspas extras.  A sintaxe inteira da consulta <i>SQL</i> √© violada. <br>  Se pegarmos e adicionarmos essa constru√ß√£o ao valor do par√¢metro ( <i>ed .: procure na caixa amarela</i> ), receberemos uma solicita√ß√£o absolutamente v√°lida.  A sa√≠da da p√°gina √© completamente id√™ntica √† primeira solicita√ß√£o, que n√£o incluiu uma inje√ß√£o: <br><img src="https://habrastorage.org/webt/nh/9q/gu/nh9qguk8d0unxfz1bsxlfb0n8vo.png"><br>  Para verificar completamente se h√° uma vulnerabilidade, adicionamos um empate em vez de unidade: <br><img src="https://habrastorage.org/webt/lx/je/a6/lxjea6hv3hebohiv96gpauuo4o0.png"><br>  Acontece que a solicita√ß√£o se torna falsa, do ponto de vista da l√≥gica booleana e, como resultado, n√£o cont√©m dados.  No entanto, ao contr√°rio do momento em que ocorreu um erro, temos a sa√≠da da pr√≥pria tabela. <br><br>  Para n√£o listar tudo o que pode estar em diferentes mecanismos de banco de dados e consultas de diferentes tipos, reduzi tudo a uma linha: <br><img src="https://habrastorage.org/webt/xz/ok/mn/xzokmnhyzqdepnyax-n1bzd8siq.png"><br>  Isso √© algo que voc√™ pode tentar inserir no par√¢metro e, de acordo com as diferen√ßas nas respostas, tentar entender o que est√° acontecendo, h√° uma vulnerabilidade ou n√£o.  Cerca de 80% dos casos voc√™ pode cobrir com esta manipula√ß√£o. <br>  Restam 20% de situa√ß√µes dif√≠ceis nas quais ela n√£o fornece nenhuma informa√ß√£o, por exemplo: consultas / filtros aninhados e assim por diante.  Na minha pr√°tica, encontrei um similar apenas uma vez.  Ent√£o eu tive que ignorar a filtragem no lado do servi√ßo. <br><br>  Qual √© o perigo no SQL? <br><ul><li>  Do √≥bvio - <i>vazamento de informa√ß√µes</i> .  Se um invasor foi capaz de gerar consultas em seus bancos de dados, ele pode, de uma forma ou de outra, obter valores que n√£o deveriam ser gerados (hashes de senha, endere√ßos de clientes etc.); </li><li>  <i>Altera√ß√£o de dados</i> .  Agora, muitos desenvolvedores usam bancos de dados atrav√©s de sistemas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ORM</a> .  Esses sistemas, por padr√£o, permitem fazer v√°rias consultas por vez; a sintaxe SQL tamb√©m permite fazer isso.  Se houver uma vulnerabilidade, tudo pode se concentrar n√£o apenas na sele√ß√£o dos dados, mas tamb√©m na altera√ß√£o (at√© a exclus√£o de tabelas, altera√ß√£o da estrutura do banco de dados etc.). <br>  Na mesma situa√ß√£o, √© poss√≠vel um aumento nos privil√©gios do usu√°rio.  Altere os campos em determinadas tabelas (por exemplo, coloque <i>is_admins = true</i> no banco de dados de <i>usu√°rios</i> ) e, assim, aumente seus direitos ao administrador; </li><li>  <i>DoS</i> .  Em alguns casos, uma inje√ß√£o pode levar a uma nega√ß√£o de servi√ßo.  V√°rias consultas pesadas no banco de dados s√£o geradas, iniciadas em v√°rios threads, e seu servi√ßo pode parar de funcionar por algum tempo; </li><li>  <i>A leitura dos arquivos do sistema</i> √© outro desastre que a inje√ß√£o SQL pode trazer.  A ocorr√™ncia desse risco depende de qual sistema de banco de dados voc√™ usa, bem como de qual usu√°rio trabalha com ele (privilegiado ou n√£o); </li><li>  <i>RCE (Execu√ß√£o Remota de C√≥digo)</i> √© a execu√ß√£o de c√≥digo.  Depende diretamente do tipo de banco de dados usado (anteriormente isso era poss√≠vel por padr√£o, com configura√ß√µes padr√£o do banco de dados, no MSSQL). </li></ul><br>  A tabela abaixo mostra as vulnerabilidades na consulta <i>SQL</i> .  Claro, voc√™ n√£o precisa memoriz√°-lo.  Al√©m disso, essas n√£o s√£o todas as op√ß√µes poss√≠veis, mas apenas exemplos.  Apenas preste aten√ß√£o ao fato de que os locais onde a inje√ß√£o na consulta <i>SQL</i> pode ocorrer se os dados brutos chegarem est√£o destacados em vermelho.  Um invasor experiente pode encontrar uma maneira de explorar isso.  Tenha cuidado e aten√ß√£o. <br><img src="https://habrastorage.org/webt/gz/bt/xh/gzbtxhbbrkng9axlc2av07rax9o.png"><br><br><h2>  SSRF (falsifica√ß√£o de solicita√ß√£o do lado do servidor) </h2><br>  Tradu√ß√£o literal - solicita√ß√µes falsas no lado do servidor.  Ou seja, um ataque que permite manipular os dados que voc√™ envia para o aplicativo, for√ßando voc√™ a fazer a solicita√ß√£o para n√£o onde a l√≥gica de neg√≥cios planejou originalmente. <br>  A opera√ß√£o do <i>SSRF √©</i> mostrada na imagem abaixo: <br><img src="https://habrastorage.org/webt/cn/3m/xc/cn3mxclin9jb7tr5fdg6zcowez8.png"><br>  H√° um invasor, o servidor, que √© fechado pelo <i>Firewall</i> , mas ao mesmo tempo h√° uma funcionalidade que permite fazer solicita√ß√µes em nome do servidor. <br>  Se essa funcionalidade n√£o estiver adequadamente protegida e / ou incorretamente, como geralmente acontece :), processa os dados recebidos, o invasor pode recorrer ao <i>Memcached</i> , <i>Redis</i> ou obter acesso a quaisquer recursos internos da v√≠tima. <br><br>  Para um exemplo mais ilustrativo, considere a posi√ß√£o que o SEMrush usa para treinamento interno de funcion√°rios. <br>  √â importante prestar aten√ß√£o ao significado do " <i>URL do avatar</i> ": <br><img src="https://habrastorage.org/webt/yi/yp/fr/yiypfrzdsu-pqg0adlbup1ziqgk.png"><br>  Aqui prestamos aten√ß√£o a 2 pontos: <br><ul><li>  URL do avatar em si </li><li>  e a capacidade de fazer o download usando um arquivo. </li></ul><br>  Observe que o campo " <i>URL do avatar</i> " √© um campo de texto para entrada, o que significa que podemos manipular esse valor.  Vamos tentar colocar no avatar, talvez, a imagem mais famosa da Internet - Googlebot na p√°gina de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">erro 404</a> . <br>  Fa√ßa uma vez: <br><img src="https://habrastorage.org/webt/hg/8d/oa/hg8doavbzbji9apfewlydlpxhyq.png"><br>  Fa√ßa dois - clique em " <i>Salvar</i> ".  Temos um rob√¥ em vez da minha foto: <br><img src="https://habrastorage.org/webt/kf/4x/lr/kf4xlr2atwvebex_dmsiqlxvmbi.png"><br>  Aqui vale a pena prestar aten√ß√£o ao fato de que o valor da " <i>URL do avatar</i> " mudou para algum caminho local - aparentemente, o aplicativo solicitou uma imagem, salvou-a no servidor e substituiu um novo valor. <br><br>  N√≥s seguimos em frente.  No campo " <i>URL avatar</i> ", insira o <i>arquivo de</i> valor <i>: /// etc / passwd</i> .  Esse design permite acessar a estrutura do arquivo.  Em algumas bibliotecas que costumam trabalhar com <i>HTTP</i> , por padr√£o, o trabalho com a estrutura de arquivos √© ativado e recebe dados dos servidores nos quais foram iniciados: <br><img src="https://habrastorage.org/webt/_j/2i/jb/_j2ijbofjimkfmd2tjxmoegkh4k.png"><br>  O que acontece depois de clicar no bot√£o " <i>Salvar</i> "? .. <br>  Em primeiro lugar, a imagem se tornou " <i>bat</i> " e, em segundo lugar, o caminho para o arquivo mudou. <br><img src="https://habrastorage.org/webt/bn/ro/d5/bnrod5bxckue0avxxbvvktglimg.png"><br>  Se tentarmos solicitar esta imagem no navegador, eles n√£o nos mostrar√£o nada (o arquivo est√° " <i>quebrado</i> ").  Mas n√£o somos o primeiro dia em seguran√ßa da informa√ß√£o, sabemos o que fazer :) Com simples manipula√ß√µes, obtemos o conte√∫do do arquivo em nosso computador: <br><img src="https://habrastorage.org/webt/vd/sw/97/vdsw97u1ce8abtqa2aqcp_zb2ac.png"><br>  Assim, com a ajuda dessa vulnerabilidade, eu, como invasor, posso obter todos os c√≥digos-fonte do seu servi√ßo e outros dados dispon√≠veis para leitura para o usu√°rio que est√° executando o servi√ßo da web. <br>  Vejamos os perigos do SSRF: <br><ul><li>  Verifica√ß√£o de porta.  Para uma rede externa, seu servi√ßo √© um ponto de entrada e 2 portas (http e https).  Ao verificar as portas de dentro da sua infraestrutura, um invasor pode detectar portas abertas; </li><li>  Ignore a autentica√ß√£o baseada em host.  Qual √© o objetivo?  √â poss√≠vel que, dentro da sua estrutura, haja servi√ßos dispon√≠veis apenas para determinados recursos (leia-se: lista de permiss√µes de IP).  Portanto, se seu servidor vulner√°vel estiver na lista branca, voc√™ ter√° acesso aos servi√ßos que est√£o dispon√≠veis para ele e, como resultado, poder√° manipul√°-los; </li><li>  Continuando o desenvolvimento do ataque mencionado acima, voc√™ pode continuar a explorar programas vulner√°veis ‚Äã‚Äãem execu√ß√£o na intranet ou no servidor local.  Muitas vezes, h√° situa√ß√µes em que a infraestrutura interna, inacess√≠vel do lado de fora, √© mal monitorada (vers√µes / patches de seguran√ßa, etc. nem sempre s√£o atualizados).  Isso tamb√©m pode levar a ataques e roubo de dados; </li><li>  Lendo dados locais.  Eu mostrei acima com um exemplo.  Suas configura√ß√µes podem ser lidas e acessadas, tokens e senhas. </li></ul><br><br><h3>  Onde procurar por SSRF? </h3><br>  Esta n√£o √© uma vulnerabilidade padr√£o.  Pode ser encontrado em locais diferentes, geralmente nos lugares mais inesperados.  Nessa situa√ß√£o, a t√©cnica ‚Äúolhe aqui, mas voc√™ nem pode olhar aqui‚Äù n√£o funciona. <br>  Sinais de um poss√≠vel <i>SSRF</i> : <br><ul><li>  <i>Webhook</i> .  Se eles estiverem mal configurados, se o Firewall estiver configurado incorretamente nos servidores dos quais os Webhooks fazem solicita√ß√µes, √© poss√≠vel obter uma vulnerabilidade; </li><li>  <i>Convers√£o HTML</i> .  Tente incorporar uma constru√ß√£o de <i>URL</i> <i>&lt;iframe&gt;</i> , <i>&lt;img&gt;</i> , <i>&lt;base&gt;</i> , <i>&lt;script&gt;</i> ou <i>CSS</i> que aponte para um servi√ßo interno; </li><li>  <i>Baixe arquivos exclu√≠dos</i> .  Lembra do exemplo de avatar?  Quando um usu√°rio tem a oportunidade de fazer upload de dados por URL para o servidor, isso envolve grandes problemas.  Tente enviar o URL com a porta e veja o conte√∫do carregado. </li></ul><br><br><h3>  Como procurar por SSRF? </h3><br><ul><li>  Levante o servidor e execute o <i>ouvinte</i> : <br><pre><code class="bash hljs">user$ nc -1 -n -vv -p 8080 -k</code> </pre> <br>  Dessa forma, voc√™ ver√° todas as solicita√ß√µes que chegam ao seu servidor na porta <i>8080</i> .  Por um lado, √© uma porta desocupada pelos servidores da Web e, por outro lado, √© uma porta que geralmente n√£o √© filtrada pelo <i>Firewall</i> .  Acredita-se que seja usado para o protocolo <i>http</i> e a proibi√ß√£o parece opcional; </li><li>  No aplicativo em estudo, encontre o par√¢metro para o qual voc√™ pode passar o caminho para solicitar dados do nosso host (ao nosso <i>ouvinte</i> ); </li><li>  Examine a sa√≠da <i>do ouvinte</i> ou a resposta retornada. </li></ul><br><br><h2>  XXE (entidade externa XML) </h2><br>  Vou come√ßar a hist√≥ria, como sempre com um exemplo, para que fique mais claro: <br>  No servi√ßo SEMrush mencionado anteriormente, existe uma ferramenta que lida com a an√°lise de conte√∫do.  O usu√°rio dirige na URL do site ou de um site concorrente e, antes de analis√°-lo, o servi√ßo baixa esse mesmo conte√∫do.  Veja como isso acontece no v√≠deo: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/WS3pJoyWwto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Para baixar, o servi√ßo acessa o site especificado e o rastreador baixa o arquivo <i>sitemap.xml</i> .  E este √© o pr√≥prio <i>XML sobre o</i> qual estamos falando neste bloco. <br>  No v√≠deo, podemos observar como o site atacante adicionou uma defini√ß√£o da entidade externa <i>XXE</i> ao <i>sitemap.xml</i> , que aponta para " <i>file: /// etc / hosts</i> ".  Nos sistemas Linux, este √© um arquivo que descreve qual IP corresponde aos hosts, se n√£o houver registros <i>DNS</i> para eles. <br>  Em seguida, o invasor indica na <i>tag &lt;loc&gt; a</i> expans√£o dessa vari√°vel.  Ap√≥s analisar o <i>XML,</i> depois de processar todo o <i>XML</i> no compartimento, ele inserir√° o valor que estava em " <i>file: /// etc / hosts</i> " na vari√°vel <i>location</i> (destacada em vermelho no v√≠deo). <br>  O atacante inicia o lan√ßamento do nosso analisador, vai para os logs e aqui aparece uma linha, destacada em branco no v√≠deo.  Este √© o conte√∫do do arquivo " <i>file: /// etc / hosts</i> " obtido na solicita√ß√£o <i>GET</i> nos logs de um servidor controlado por ele. <br>  O que vem a seguir?  O atacante verificar√° se ele estava certo.  Ele mudar√° o nome do arquivo para " <i>file: /// etc / fstab</i> ", execute o analisador novamente e obtenha estat√≠sticas sobre os processos em execu√ß√£o. <br><br>  E finalmente: " <i>file: /// etc / hostname</i> ", inicie o analisador, acesse os logs e obtenha o <i>nome do host da</i> m√°quina em que estamos. <br>  Este √© um bug real descoberto por uma pessoa real que n√£o est√° relacionada √† nossa empresa.  Eu tive que espalhar cinzas na minha cabe√ßa e pagar dinheiro :) <br><br>  Outro exemplo de <i>XXE</i> : <br><img src="https://habrastorage.org/webt/3t/va/i9/3tvai98kmgwwmpjwh0wjjuzodk0.png"><br>  Suponha que tenhamos um determinado <i>ponto de extremidade</i> , chamado - <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">exemplo.com/xxe</a></i> . <br>  N√≥s enviamos a estrutura <i>XML</i> para ela ‚Üí em <i>XML,</i> declaramos a entidade <i></i> ‚Üí a entidade <i></i> refere-se ao arquivo do sistema <i>/ etc / passwd</i> e abre mais no corpo da resposta ‚Üí obtemos o conte√∫do desse arquivo em resposta. <br>  Vale a pena notar que isso n√£o ocorre com a frequ√™ncia que desejamos. <br><br><h3>  Por que isso funciona? </h3><br>  <i>Os</i> documentos <i>XML</i> s√£o um formato de dados estruturado que, entre outras coisas, permite descrever os tipos de dados que eles podem conter usando uma tag especial <i>DOCTYPE</i> . <br>  <i>Data Type Definition (DTD)</i> - A defini√ß√£o de tipos de dados dentro deste documento <i>XML</i> .  Existem tr√™s op√ß√µes para como isso pode ser feito: <br><ul><li>  Se o documento suportar <i>DTD</i> .  O exemplo abaixo mostra um <i>XML</i> no qual existe uma estrutura de pedido, existe um elemento de <i>produto</i> e um elemento de <i>contagem</i> (presumivelmente: o n√∫mero de estoque do produto e o n√∫mero de itens no pedido).  <i>Order</i> √© o pai desses dois elementos: <br><img src="https://habrastorage.org/webt/ft/to/kb/fttokbp3vkqsknatvo8yql9p5h4.png"></li><li>  DTDs externos no servidor local. <br>  Fazemos o mesmo que na primeira modalidade, mas fazemos todas as defini√ß√µes em um arquivo separado, localizado no servidor local: <br><img src="https://habrastorage.org/webt/qy/re/3m/qyre3m2bfjatzni4bdq6t-3opko.png"><br></li><li>  DTDs externas em um servidor de terceiros: <br><img src="https://habrastorage.org/webt/wf/dj/tp/wfdjtpme3bh_lnhgiyr56m-p5si.png"></li></ul><br>  Se voc√™ √© um leitor atento, provavelmente correlacionou o fato de que a capacidade de fazer essas solicita√ß√µes em seu servi√ßo e solicitar esquemas <i>DTD</i> externos √© uma vulnerabilidade em si mesma, sobre a qual falamos acima, a vulnerabilidade do <i>SSRF</i> . <br>  Uma ocorr√™ncia comum: os desenvolvedores corrigem a vulnerabilidade <i>XXE</i> , mas esquecem de proibir o processamento de <i>DTDs</i> externas e obter <i>SSRF</i> .  Consequ√™ncias fatais n√£o se seguir√£o disso, mas voc√™ n√£o deve esquecer. <br><br><h3>  O que s√£o entidades em XML? </h3><br>  <i>Entidades</i> em <i>XML</i> .  O que √© isso  Esta √© uma oportunidade para definir certos valores e direcion√°-los para vari√°veis.  As entidades t√™m tr√™s tipos diferentes: <br><img src="https://habrastorage.org/webt/er/lb/h7/erlbh7l8z_adl4nla3ll_tir1rm.png"><br>  <i>Predefinido</i> - predefinido.  Semelhante ao c√≥digo <i>HTML</i> , possibilita o uso dos caracteres que fazem parte da sintaxe da linguagem, como uma estrutura de texto.  Aqui eles s√£o dados como exemplo, para que voc√™ entenda o que √©.  Sim, na maioria dos ataques, eles n√£o s√£o usados, mas podem ser necess√°rios em alguns casos excepcionais. <br>  <i>Geral</i> e <i>Par√¢metro</i> .  √â a mesma coisa, apenas a sintaxe da declara√ß√£o muda e como elas podem ser chamadas ap√≥s a declara√ß√£o <br><br><h3>  Onde procurar por <i>XXE</i> ? </h3><br>  V√°rias op√ß√µes: <br><ul><li>  Processamento <i>XML</i> em qualquer manifesta√ß√£o: <br><ul><li>  <i>SVG;</i> </li><li>  <i>mapa do site;</i> </li></ul></li><li>  Converta <i>HTML</i> para outros formatos; </li><li>  Manipulando <i>docx</i> , <i>xlsx</i> e formatos similares. </li></ul><br><br><h3>  Como procur√°-los? </h3><br><img src="https://habrastorage.org/webt/eo/ce/tl/eocetlpzyfdgocqc2qwv1hbxnhe.png"><br>  A imagem mostra apenas um exemplo para come√ßar.  N√£o √© uma chave universal.  Ele precisa ser otimizado para os formatos que voc√™ usa no servi√ßo em estudo. <br><br>  A primeira coisa que fazemos: declarar uma determinada entidade <i>Z</i> , que acessa o host controlado pelo host atacante, a expande dentro do corpo do documento <i>XML</i> . <br>  Aqui a segunda op√ß√£o √© poss√≠vel - apenas a ess√™ncia do <i>par√¢metro</i> .  Difere do primeiro an√∫ncio (sinal de <i>%</i> ).  E, para voltar a essa ess√™ncia, o corpo do documento n√£o √© mais necess√°rio.  Podemos acess√°-lo diretamente na estrutura <i>DOCTYPE</i> e expor esta entidade: <br><img src="https://habrastorage.org/webt/3-/hc/xo/3-hcxohtjre3dee0mbed39vlfzq.png"><br>  O terceiro cen√°rio √© verificar se a capacidade de solicitar <i>DOCTYPE</i> de servi√ßos externos est√° ativada ou desativada: <br><img src="https://habrastorage.org/webt/xn/yo/nj/xnyonjotk9gmb4l1ba-d818g3k4.png"><br>  A seguir, analisamos a sa√≠da de um servidor controlado por n√≥s.  Se virmos uma chamada para <i>URL</i> <i>/ verifica√ß√£o</i> de v√°rios endere√ßos <i>IP</i> , isso significa que, com um alto grau de probabilidade, a vulnerabilidade passou e, ent√£o, precisamos descobrir como obter dados mais interessantes para n√≥s. <br><img src="https://habrastorage.org/webt/xl/7d/oz/xl7dozt94jtm9zf3c_zfr39kacq.png"><br>  Qual √© o perigo do <i>XXE</i> ?  Escreverei brevemente e ponto por ponto: <br><ul><li>  Lendo arquivos locais; </li><li>  Acesso a recursos locais; </li><li>  Verifica√ß√£o de porta / host </li><li>  <i>Wrappers de texto sem formata√ß√£o</i> .  Esta √© uma oportunidade para acessar seus servi√ßos que operam no protocolo de texto sem formata√ß√£o; </li><li>  <i>Execu√ß√£o remota de c√≥digo</i> (n√£o frequentemente).  Est√° desativado por padr√£o; </li><li>  <i>DoS</i> .  Devido ao fato de que as entidades podem ser concatenadas, √© poss√≠vel obter facilmente um aumento exponencial na quantidade de mem√≥ria ocupada por esses par√¢metros.  O resultado √© um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">ataque de bilh√µes de risos</a> .  Em outras palavras, voc√™ est√° simplesmente sobrecarregando a mem√≥ria do servidor atacado. </li></ul><br>  Concluindo, direi que tudo isso (o artigo e qualquer conhecimento adquirido) n√£o faz sentido sem aplica√ß√£o pr√°tica.  Portanto, perguntarei a voc√™ um pouco: pense no aplicativo que voc√™ escreveu / testou ontem e tente verificar se h√° vulnerabilidades.  Existem formul√°rios de entrada ou processamento <i>XML</i> ?  Este aplicativo est√° protegido?  A filtragem foi adicionada e o <i>DTD</i> desativado? <br>  Abra o manual do <i>SQLmap</i> e descubra como verificar seu aplicativo com ele.  Se ele n√£o encontrar nada, pegue outra ferramenta, examine-a e teste seu aplicativo em busca de outras vulnerabilidades.  Como eu disse no come√ßo, o artigo examina apenas algumas vulnerabilidades, mas <i>milhares delas</i> . <br>  N√£o acredito que voc√™ possa escrever um c√≥digo absolutamente seguro.  Sempre existem vulnerabilidades, voc√™ <i><u>ainda n√£o as encontrou</u></i> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt441966/">https://habr.com/ru/post/pt441966/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt441952/index.html">Escolhendo um sistema de armazenamento de arquivos para o trabalho em equipe</a></li>
<li><a href="../pt441954/index.html">Recompensa do usu√°rio aos autores de Habr</a></li>
<li><a href="../pt441956/index.html">Tratamento de erro unificado (op√ß√£o C ++ para microcontroladores)</a></li>
<li><a href="../pt441962/index.html">√çndices no PostgreSQL - 1</a></li>
<li><a href="../pt441964/index.html">Dicas e truques do Kubernetes: movendo recursos de cluster para o Helm 2</a></li>
<li><a href="../pt441968/index.html">Desenvolvimento de um novo ramo de produtos: como se livrar do impratic√°vel e se manter √∫til</a></li>
<li><a href="../pt441970/index.html">An√°lise do Butkit FinFisher</a></li>
<li><a href="../pt441972/index.html">Invidious - front-end alternativo do YouTube</a></li>
<li><a href="../pt441974/index.html">O caminho do historiador de RH para programadores Java: um pouco de sorte e perseveran√ßa</a></li>
<li><a href="../pt441976/index.html">Com voc√™ FizTech.Science: estamos procurando par√¢metros ocultos e mergulhando no maravilhoso mundo qu√¢ntico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>