<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçè üëèüèø üëéüèΩ Guardar color del elemento en la base de datos de Navisworks üëª üë©üèº‚Äçüîß üßóüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Tarea de fondo 


 Por ejemplo, surgi√≥ un problema para el cliente: 


- Deseche los elementos del modelo de construcci√≥n en 1C. 
- En 1C, use estas p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Guardar color del elemento en la base de datos de Navisworks</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/450248/"><h2 id="predystoriya-zadachi">  Tarea de fondo </h2><br><p>  Por ejemplo, surgi√≥ un problema para el cliente: </p><br><ul><li>  Deseche los elementos del modelo de construcci√≥n en 1C. </li><li>  En 1C, use estas partes del modelo en los contratos; bueno, digamos, indique que tal y tal elemento ya se ha construido, tal y tal solo est√° planeado, etc. </li><li>  En Navisworks, puede ver esto de alguna manera en un dibujo, por ejemplo, al mostrar elementos del modelo en diferentes colores.  Para hacer esto, crearon un complemento para Navisworks que puede copiar datos de tablas de cuantificaci√≥n (tablas de despegue) a 1C, as√≠ como recuperarlos de 1C y ponerlos en las tablas de despegue. <br>  Y en 1C, se supon√≠a que los elementos del modelo (habitaciones) utilizados en el contrato deber√≠an cambiar de color. </li></ul><br><p>  Solo ahora result√≥ que despu√©s de cambiar estos datos tabulares en 1C, Navisworks no entiende que han cambiado, y ser√≠a necesario actualizarlos.  Por lo tanto, yo, el programador, necesito decirle esto. </p><br><h2 id="itak-zadacha-dlya-programmista">  Entonces, la tarea para el programador </h2><br><p>  Despu√©s del intercambio con 1C, los datos en la tabla TK_Item cambiaron, en particular, el campo Color.  Es necesario traer los colores en el dibujo mostrado de acuerdo con los indicados en la tabla. </p><a name="habracut"></a><br><p>  Estamos buscando c√≥mo hacerlo.  Cavamos la descripci√≥n.  Encontramos la funci√≥n - </p><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OverridePermanentColor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IEnumerable&lt;ModelItem&gt; items, Color color</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p>  Bueno, c√≥mo encontrar elementos del modelo que correspondan al elemento TK_Item seleccionado es otra historia, te contar√© en otro momento si es interesante.  Pero qui√©n lo necesita, y √©l lo resolver√°.  Pero con el color, todo result√≥ ser m√°s interesante. <br>  En primer lugar, el Color especificado en los par√°metros de la funci√≥n no es System.Drawing.Color, sino incluso Autodesk.Navisworks.Api.Color, con su blackjack y ... bueno, ya entiendes.  Bueno, d√©jalo ser, pero √©l tiene un constructor as√≠: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">unsafe</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromByteRGB</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> red, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> green, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params"> blue</span></span></span><span class="hljs-function">)</span></span></code> </pre> <br><p>  Por lo tanto, sin problemas, crearemos el color que necesite la API de Autodesk. <br>  (En realidad, lo primero que deber√≠a intentar es encontrar los elementos que corresponden al elemento seleccionado, seleccionar un color y establecerlo en este color). </p><br><p>  Pero  En la tabla, tenemos en el campo Color un valor de tipo Int64.  Y c√≥mo compararlo con un objeto de tipo Color no est√° claro. </p><br><p>  Adem√°s, ni en la documentaci√≥n, ni en el foro, ni en los ejemplos pude encontrar c√≥mo est√° escrito en la base de datos. </p><br><p>  OK, cavaremos experimentalmente. </p><br><p>  Tomamos Navisworks, abrimos cuantificaci√≥n, cambiamos el color de un elemento.  Digamos, en un honesto, limpio rojo. </p><br><p><img src="https://pp.userapi.com/c846017/v846017649/1f3a4c/v2x4VoIrW1E.jpg" alt="imagen"></p><br><p>  Despu√©s de eso, tomamos nuestro complemento, les enviamos los datos de la tabla TK_Item y miramos, ¬øqu√© hay en la tabla? </p><br><p>  (Afortunadamente, el complemento para fines de depuraci√≥n proporcion√≥ esa opci√≥n: descargar datos y mostrarlos en el formulario). </p><br><p>  Resulta que hay -65536. </p><br><p><img src="https://pp.userapi.com/c846017/v846017649/1f3a45/7Q1YusQG91I.jpg" alt="imagen"></p><br><p>  Repita el procedimiento varias veces y reduzca los resultados a un archivo de texto. </p><br><div class="scrollable-table"><table><thead><tr><th>  Titulo </th><th>  Color </th><th>  Valor de color en la tabla </th><th>  Representaci√≥n binaria de color en una tabla. </th></tr></thead><tbody><tr><td>  Tipo de pared 1.1 sobre la marca  0,000 </td><td>  Rojo </td><td>  -65536 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0000 0000 0000 0000 </td></tr><tr><td>  Tipo de pared 1.2 sobre la marca  0,000 </td><td>  Verde </td><td>  -16711936 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0000 0000 1111 1111 0000 0000 </td></tr><tr><td>  Tipo de pared 2.1 sobre la marca  0,000 </td><td>  Azul </td><td>  -16776961 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0000 0000 0000 0000 1111 1111 </td></tr><tr><td>  Tipo de pared 0.1 debajo de la marca  0,000 </td><td>  Rojo = 16 </td><td>  -15728640 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0001 0000 0000 0000 0000 0000 </td></tr><tr><td>  Tipo de pared 0.2 debajo de la marca  0,000 </td><td>  Rojo = 17 </td><td>  -15663104 </td><td>  1111 1111 1111 1111 1111 1111 1111 1111 1111 1111 0001 0001 0000 0000 0000 0000 </td></tr><tr><td>  Lazos en un elev.  0,000 </td><td>  Rojo = 193 Verde = 32 Azul = 74 </td><td>  12 656 714 </td><td>  0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 1100 0001 0010 0000 0100 1010 </td></tr></tbody></table></div><br><p>  Al principio, me sorprendieron mucho los n√∫meros en la tabla, y especialmente la presencia de valores positivos y negativos. </p><br><p>  Despu√©s de experimentar con los valores de los componentes R, G, B, me di cuenta de que estos tres componentes se muestran con los √∫ltimos tres bytes del n√∫mero. </p><br><p>  Pero entonces es extra√±o: ¬øpor qu√© los bytes altos est√°n llenos de unidades, no ceros? <br>  Sin embargo, si suponemos que siempre est√°n llenos de unidades, entonces la presencia de n√∫meros negativos obtiene una explicaci√≥n.  Simplemente complete el byte alto, que determina el signo del n√∫mero. <br>  ¬°Pero no siempre hay n√∫meros negativos! </p><br><p>  Y solo recordando c√≥mo funcionan las funciones &gt;&gt; y &lt;&lt;, me di cuenta de que pueden completar est√∫pidamente los bits altos con n√∫meros, incluido el bit de signo.  Y como los bits m√°s significativos no son necesarios, no importa lo que haya all√≠. </p><br><p>  Entonces la pregunta es: ¬øpara qu√© necesitaban tanta importancia para el color?  ¬øYa tienes 64 bits?  Observ√© la estructura de las tablas en las que se almacenan estos datos: solo usa Int64 para todos los enteros.  Realmente, ¬øpor qu√© bagatela? </p><br><h2 id="itog">  Resumen </h2><br><p>  El valor del color registrado en la tabla se obtiene de la siguiente manera: </p><br><pre> <code class="cs hljs">Int64 dbColor = Rb&lt;&lt;<span class="hljs-number"><span class="hljs-number">16</span></span> + Gb&lt;&lt;<span class="hljs-number"><span class="hljs-number">8</span></span> + Bb;</code> </pre> <br><p>  La transformaci√≥n inversa, el color de la tabla al color utilizado para los elementos del modelo, hacemos esto: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> R = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(dbColorValue &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> % <span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> G = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(dbColorValue &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> % <span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span> B = (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) (dbColorValue % <span class="hljs-number"><span class="hljs-number">256</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> color = Autodesk.Navisworks.Api.Color.FromByteRGB(R, G, B);</code> </pre> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/450248/">https://habr.com/ru/post/450248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../450238/index.html">Validaci√≥n de la interfaz TypeScript con Joi</a></li>
<li><a href="../450240/index.html">Walmart abre la primera tienda impulsada por IA</a></li>
<li><a href="../450242/index.html">¬øPor qu√© necesitabas otro framework PHP?</a></li>
<li><a href="../450244/index.html">¬øC√≥mo escribir y promover el Libro Blanco?</a></li>
<li><a href="../450246/index.html">El m√≥dulo de supresi√≥n de rebote de tubo de la computadora IBM 705. ¬øQu√© sucede si intenta encenderlo?</a></li>
<li><a href="../450252/index.html">La misi√≥n Chang'e-4 es el quinto d√≠a lunar para el m√≥dulo de aterrizaje y el rover Yutu-2.</a></li>
<li><a href="../450256/index.html">Redes de TV por cable para los m√°s peque√±os. Parte 3: componente de se√±al anal√≥gica</a></li>
<li><a href="../450258/index.html">Redes de TV por cable para los m√°s peque√±os. Parte 4: Se√±al digital</a></li>
<li><a href="../450260/index.html">Mi experiencia de digitalizaci√≥n del estado o la historia del nacimiento de la plataforma Digit</a></li>
<li><a href="../450262/index.html">Automatizaci√≥n de la biblioteca mecanografiada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>