<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üè• üë©üèæ‚Äçü§ù‚Äçüë®üèº üïß Umpacken von Paketen in Gradle üî™ ‚ôâÔ∏è ‚è©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In meinem Artikel m√∂chte ich √ºber einen weiteren Trick sprechen, der mit Gradle ganz einfach implementiert werden kann - das Umpacken von Bibliotheksp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Umpacken von Paketen in Gradle</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/472002/"><p>  In meinem Artikel m√∂chte ich √ºber einen weiteren Trick sprechen, der mit Gradle ganz einfach implementiert werden kann - das Umpacken von Bibliothekspaketen.  Jeder, der sogar ein wenig mit diesem Build-System gearbeitet hat, wei√ü, dass es automatisch wei√ü, wie Konflikte verschiedener Versionen von Bibliotheken gel√∂st werden k√∂nnen. Wenn Sie dies w√ºnschen, k√∂nnen Sie dies beeinflussen, indem Sie beispielsweise eine bestimmte Version einer Bibliothek √ºberfixieren: </p><br><pre><code class="java hljs">configurations.all { resolutionStrategy { force <span class="hljs-string"><span class="hljs-string">"org.ow2.asm:asm:7.2"</span></span> } }</code> </pre> <br><p>  Leider hilft dies nicht immer, das Problem des Versionskonflikts zu l√∂sen.  Beispielsweise ist ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Problem bekannt,</a> dass einige HTC-Ger√§te in der Firmware bereits √ºber eine Gson-Bibliothek verf√ºgen. Wenn sich Ihre Version von Gson von der integrierten unterscheidet, k√∂nnen Probleme auftreten, da ClassLoader nur eine Klasse in den Speicher l√§dt. In diesem Fall handelt es sich um eine Systemklasse. </p><br><p>  Dieses Problem kann auch bei der Entwicklung von Bibliotheken auftreten.  Wenn Sie zwei Bibliotheken mit Ihrem Projekt verbinden, die dieselbe Drittanbieter-Bibliothek mit verschiedenen Versionen verwenden, z. B. 1 und 2, wird Gradle die neueste Version, die zweite, aufl√∂sen und verwenden.  Wenn diese Bibliothek von Drittanbietern jedoch keine Abw√§rtskompatibilit√§t aufweist und die zweite Version nicht einfach anstelle der ersten verwendet werden kann, gibt es Probleme, die mit der Ablaufverfolgung sicherlich nur sehr schwer zu verfolgen sind.  Eine Bibliothek, die auf die erste Version wartet, erh√§lt die zweiten Klassen und st√ºrzt einfach ab. </p><br><p>  Beim Schreiben eines <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grad-Plugins</a> ist ein Versionskonflikt aufgetreten. Es verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">asm-</a> Bibliothek, die in Konflikt geraten ist.  Nachdem ich das Plugin geschrieben hatte, √ºberpr√ºfte ich seine Leistung bei einem Testprojekt: Alles ist in Ordnung, ich √ºberpr√ºfte bei einem Haustierprojekt, alles ist auch in Ordnung, aber als ich es mit einer Reihe von Abh√§ngigkeiten von Drittanbietern mit einem echten Arbeitsprojekt verband, stie√ü ich auf ein Problem. </p><br><p><img src="https://habrastorage.org/webt/ln/ed/ar/lnedary9es3gxlyadwfs1yn5xqg.png"></p><br><p>  Die L√∂sung des Problems unter dem Schnitt. </p><a name="habracut"></a><br><h2 id="vse-zhe-rabotalo-chto-poshlo-ne-tak">  Aber es hat funktioniert, was ist schief gelaufen? </h2><br><p>  Wir erhalten die vollst√§ndige Fehlersuche: </p><br><p><img src="https://habrastorage.org/webt/v6/xa/9h/v6xa9hz9b1ajpbztmtlbbowrbko.png"></p><br><p>  Wir sehen, dass der Fehler im Konstruktor der asm <code>ClassVisitor</code> Bibliothek in Zeile 79 liegt.  Schauen wir uns das an, aber beim Versuch, <code>ClassVisitor</code> zu √∂ffnen, bot das Studio zwei Optionen </p><br><p><img src="https://habrastorage.org/webt/hv/v5/hw/hvv5hwcacmqoj7nompdir2xpxlk.png"></p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Mein Plugin</a> verwendet asm Version <code>7.2</code> , also gehen wir dorthin und in Zeile 79 sehen wir Folgendes: </p><br><p><img src="https://habrastorage.org/webt/rp/88/uj/rp88ujzc58f15b-qwwqtvyikvze.png"></p><br><p>  Dies ist eindeutig nicht das, was wir brauchen.  Gehen <code>ClassVisitor</code> jetzt zu <code>ClassVisitor</code> Version 6: </p><br><p><img src="https://habrastorage.org/webt/tb/gw/j9/tbgwj9rxcgnfpmeururnlpwftoe.png"></p><br><p>  Nur unsere <code>IllegalArgumentException</code> ohne Nachricht.  Mein Plugin verwendet die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ASM-API-7-Version von</a> <code>Opcodes.ASM7</code> , und in der 6-Version der Bibliothek ist diese API noch nicht vorhanden, daher wird eine <code>IllegalArgumentException</code> im Konstruktor ausgef√ºhrt.  Wir k√∂nnen daraus schlie√üen, dass das Plugin eine falsche Version der Bibliothek erh√§lt. </p><br><p>  M√ºllfrage, dachte ich und tat dies: </p><br><pre> <code class="java hljs">configurations.all { resolutionStrategy { force <span class="hljs-string"><span class="hljs-string">"org.ow2.asm:asm:7.2"</span></span> } }</code> </pre> <br><p>  Zu meinem Bedauern hatte dies absolut keine Wirkung.  Ich konnte immer noch nicht herausfinden, warum es nicht m√∂glich ist, die asm-Version zu √ºberfixieren, obwohl der <code>./gradlew app:dependencies</code> anzeigt, dass die Version durch 7.2 ersetzt wurde.  Wenn jemand Gedanken oder Annahmen hat, w√ºrde ich mich freuen, eine Meinung zu h√∂ren. </p><br><h2 id="problemu-nado-kak-to-reshat">  Das Problem muss irgendwie gel√∂st werden </h2><br><p>  Eine Reihe von googeln und vertiefen in die Arbeit des Hagels begann.  Infolgedessen bin ich auf die asm-Website gegangen, vielleicht wissen sie etwas dar√ºber.  Es stellte sich heraus, dass sie wirklich wissen, dass die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Antwort auf meine Frage</a> im FAQ-Bereich war.  Sie sagen, um das asm-Paket durch ein anderes zu ersetzen, bieten sie sogar ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Dienstprogramm</a> daf√ºr an.  Ok, lass es uns versuchen.  Sie m√ºssen nur das Plug-In anschlie√üen und ein kleines Setup vornehmen: </p><br><pre> <code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'org.anarres.jarjar'</span></span> ... dependencies { <span class="hljs-function"><span class="hljs-function">implementation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'build/jarjar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span><span class="hljs-function"> implementation jarjar.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">repackage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'asm'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ from <span class="hljs-string"><span class="hljs-string">'org.ow2.asm:asm:7.2'</span></span> classRename <span class="hljs-string"><span class="hljs-string">"org.objectweb.asm.**"</span></span>, <span class="hljs-string"><span class="hljs-string">"stater.org.objectweb.asm.@1"</span></span> } }</code> </pre> <br><p>  <code>build/jarjar</code> In diesem Fall das Verzeichnis, in das die JAR-Datei der ASM-Bibliothek mit neu gepackten Paketen generiert wird. Sie m√ºssen daher den Abh√§ngigkeitszugriff auf dieses Verzeichnis √ºber <code>fileTree</code> .  Die Bibliothek ist jetzt mit dem Import <code>stater.org.objectweb.asm.*</code> verf√ºgbar <code>stater.org.objectweb.asm.*</code> Anstelle von <code>org.objectweb.asm.*</code> .  Dieses Plugin hat verschiedene Einstellungen, aber in meinem Beispiel hat es gereicht, nur die Pakete zu √§ndern. </p><br><p>  Gehen Sie als N√§chstes das gesamte Projekt durch und √§ndern Sie den Import √ºberall von <code>org.objectweb.asm</code> in <br>  <code>stater.org.objectweb.asm</code> .  Meiner Meinung nach, ein sehr praktisches Dienstprogramm, das um ein Vielfaches einfacher ist als <code>from 'org.ow2.asm:asm:7.2'</code> , insbesondere beim Aktualisieren der Bibliothek, wechseln wir einfach <code>from 'org.ow2.asm:asm:7.2'</code> zur neuen Version, und der neu <code>from 'org.ow2.asm:asm:7.2'</code> jar-Spitzname mit der neuen Version wird am generiert automatische Maschine. </p><br><p>  Wenn Sie nur ein Projekt haben (keine Bibliothek), reicht dies aus, um unl√∂sbare Konflikte zu l√∂sen, wie sie am Anfang des Artikels erw√§hnt wurden.  Aber wenn Sie wie ich eine Bibliothek schreiben, ist das noch nicht alles. </p><br><p>  Wir haben das Problem beim erneuten Packen gel√∂st, aber jetzt ist <code>asm</code> nicht √ºber die Abh√§ngigkeit vom Remote-Maven-Repository mit dem Projekt verbunden, sondern √ºber die lokale JAR-Datei, die einfach verloren geht, wenn Ihre Bibliothek bereitgestellt wird, und es tritt ein solcher <code>NoClassDefFoundError</code> Fehler auf.  Dieses Problem ist jedoch recht einfach zu l√∂sen: </p><br><ol><li><p>  Erstellen Sie in unserer Gradle-Datei eine neue Konfiguration: </p><br><pre> <code class="java hljs">configurations { extraLibs implementation.extendsFrom(extraLibs) }</code> </pre> <br></li><li><p>  Als n√§chstes √§ndern wir uns </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">implementation </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'build/jarjar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span></code> </pre> <br><p>  auf </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">extraLibs </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fileTree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dir: </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'build/jarjar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">, include: [</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'*.jar'</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span></code> </pre> <br></li><li><p>  Definieren Sie die Aufgabe, die f√ºr das Sammeln Ihrer endg√ºltigen JAR-Datei verantwortlich ist, neu und schreiben Sie alle Bibliotheken mit unserer neuen Konfiguration in den endg√ºltigen JAR-Spitznamen: </p><br><pre> <code class="plaintext hljs">jar { from { configurations.extraLibs.collect { it.isDirectory() ? it : zipTree(it) } } }</code> </pre> <br></li></ol><br><p>  Das ist alles, stellen Sie unser Plugin wie zuvor bereit, stellen Sie eine Verbindung zu dem Projekt her, bei dem es unl√∂sbare Konflikte gab und alles gut funktioniert. <br>  Ein solches Umpacken macht unsere Bibliothek fehlertoleranter, wenn sie mit verschiedenen Arten von Projekten mit anderen Bibliotheken verbunden ist. </p><br><h3 id="a-esli-prosto-podklyuchit-jar-fayl-konfliktuyuschey-biblioteki-k-plaginu-bez-pereupakovki">  Und wenn Sie nur die JAR-Datei der in Konflikt stehenden Bibliothek mit dem Plugin verbinden, ohne sie neu zu verpacken? </h3><br><p>  Schlechte Idee, es wird zu nichts Gutem f√ºhren.  W√§hrend des Projektaufbaus gibt es eine so interessante Aufgabenpr√ºfung <code>check...DuplicateClasses</code> , bei der einfach Dateien mit denselben Paketen gek√ºrzt werden.  Das hei√üt, Dateien, die aus der JAR-Datei der verbundenen Bibliothek abgerufen wurden, und Dateien aus derselben Bibliothek, die √ºber das Remote-Repository verbunden sind.  Das Ergebnis ist dieser Fehler: </p><br><p><img src="https://habrastorage.org/webt/9-/jo/y7/9-joy7dsnaqekwwqseztj_7hgsm.png"></p><br><p>  Das ist alles.  Vielen Dank an alle, die gelesen haben! </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tulsa zum Umpacken</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Beispiel Plugin</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de472002/">https://habr.com/ru/post/de472002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de471990/index.html">Meta-Grammatik f√ºr PEG-Parser</a></li>
<li><a href="../de471992/index.html">Implementierung der verbleibenden Funktionen von PEG</a></li>
<li><a href="../de471994/index.html">Arbeiten Sie an PEG im Core Developer Sprint</a></li>
<li><a href="../de471998/index.html">F # 10: Listen</a></li>
<li><a href="../de472000/index.html">‚ÄûF√ºr die Community ist es wichtig, Standards zu setzen‚Äú: Marchin Moskala √ºber Kotlin</a></li>
<li><a href="../de472004/index.html">Boost.Spirit oder Hinzuf√ºgen von ‚ÄûSpiritualit√§t‚Äú zu Listenfiltern</a></li>
<li><a href="../de472006/index.html">Warum es n√ºtzlich ist, die R√§der neu zu erfinden</a></li>
<li><a href="../de472012/index.html">Kanban in einer halben Stunde</a></li>
<li><a href="../de472014/index.html">OTUS. Unsere Lieblingsfehler</a></li>
<li><a href="../de472018/index.html">Bibliothekskontrollsystem f√ºr Flask-Potion, Teil 0: Alles vorbereiten, was Sie brauchen</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>