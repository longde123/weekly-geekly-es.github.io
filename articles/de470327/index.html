<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèª‚Äçüè´ üë©üèª‚Äçüç≥ ‚ò¢Ô∏è Anwendung von MATLAB / Simulink mit Ger√§ten von InSys JSC üòÆ üéóÔ∏è üé∂</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Eine wichtige praktische Aufgabe ist die Verwendung von Matlab / Simulink mit realen Ger√§ten, mit denen Sie ein Signal aus der realen Welt empfangen k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anwendung von MATLAB / Simulink mit Ger√§ten von InSys JSC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/470327/"> Eine wichtige praktische Aufgabe ist die Verwendung von Matlab / Simulink mit realen Ger√§ten, mit denen Sie ein Signal aus der realen Welt empfangen k√∂nnen.  Dies ist sehr n√ºtzlich zum Debuggen von Algorithmen.  In diesem Dokument wird die Technologie zum Verbinden von ADC-Ger√§ten von InSys JSC mit Simulink vorgestellt.  Zum Verbinden wird eine DLL verwendet, die in Simulink als sm_adc-Komponente angezeigt wird.  F√ºr die Arbeit mit dem Ger√§t wird ein separates Konsolenprogramm verwendet.  Die Kommunikation mit der DLL erfolgt √ºber den gemeinsamen Speicher.  Gem√§√ü dieser Technologie k√∂nnen alle ADCs an beliebigen tragenden Modulen von InSys JSC angeschlossen werden.  Die Arbeit pr√§sentiert ein System aus einem A7_DAC-Generator und einem FMC128E / FM412x500M-Erfassungsmodul. <br><br>  Diese Arbeit wurde auf der Konferenz ‚ÄûTechnologien zur Entwicklung und zum Debuggen komplexer technischer Systeme‚Äú vom 27. bis 28. M√§rz 2018 demonstriert. <br><br><img src="https://habrastorage.org/webt/2q/2y/7a/2q2y7ajg2jcoezpe6x1ptohzjia.png"><br><br><a name="habracut"></a><br><br>  <b>Erkl√§rung des Problems</b> <br><br>  Es erfordert die Entwicklung eines Systems aus einem Signalgenerator und einem ADC, das ein Signal mit den angegebenen Parametern erzeugt und digitalisiert.  Die empfangenen Daten m√ºssen zur Verarbeitung an Simulink √ºbertragen werden. <br><br>  <b>Ausr√ºstung</b> <br><br>  F√ºr die Arbeit wurde ein St√§nder aus dem ADC-Modul und dem Generator zusammengebaut.  Als ADC wird das Submodul FM412x500M verwendet, in dem vier ADC-Kan√§le mit einer Abtastfrequenz von 500 MHz vorhanden sind.  Das Submodul ist auf dem FMC128E-Tr√§germodul installiert, in dem sich ein Artix 7-FPGA und eine USB 3.0-Schnittstelle befinden.  Beide Ger√§te sind an einen Laptop angeschlossen, auf dem Simulink ausgef√ºhrt wird.  Zur √úberwachung der Leistung wird nat√ºrlich ein Oszilloskop verwendet. <br><br>  <b>Aussehen des Standes:</b> <br><br><img src="https://habrastorage.org/webt/i_/tg/pt/i_tgptlp8qd0txtxts7qlwlnjls.jpeg"><br><br>  <b>Strukturdiagramm des Standes:</b> <br><br><img src="https://habrastorage.org/webt/bf/_x/n4/bf_xn4xf3dirqyym-6pugnunsqo.png"><br><br>  <b>Signal erzeugt:</b> <br><br><img src="https://habrastorage.org/webt/r7/ww/rr/r7wwrrzr0ce7s6ba9iavxqzarlu.png"><br><br>  <b>Der Algorithmus des Standes:</b> <br><br><ol><li>  Simulink bereitet den Start des ADC und des Generators vor </li><li>  Simulink weist den Generator an, zu starten </li><li>  Der Generator bildet einen Blitz (gelbes Signal) und das eigentliche Signal (blau) </li><li>  Der ADC an der Vorderseite des Tors beginnt mit der Datenerfassung </li><li>  Der ADC sammelt das Array und leitet es an Simulink weiter </li><li>  Simulink zeigt das vom ADC empfangene Signal an </li></ol><br><br>  Dies ist ein klassischer einmaliger Erfassungsmodus.  Seine Besonderheit ist genau die Einzigartigkeit.  Das Ger√§t entlang der Signalfront sammelt ein bestimmtes Datenarray.  Die Phase der Datenerfassung erfolgt im "harten Echtzeit" -Modus, aber die Verarbeitung ist, wie man sie erh√§lt.  Die Erfassungsrate wird durch die Anzahl der ausgew√§hlten Kan√§le und die Abtastrate bestimmt.  F√ºr vier ADC-Kan√§le und eine Abtastfrequenz von 500 MHz betr√§gt die Datenrate 4 GB / s.  Mit dieser Geschwindigkeit k√∂nnen Daten in das SODIMM des FMC128E geschrieben werden.  Das hei√üt, ein 4-GB-Beispiel kann gespeichert werden. <br><br>  Ferner sollten die Daten zum Computer √ºbertragen werden.  Das FMC128E-Modul ist √ºber die USB 3.0-Schnittstelle mit dem Computer verbunden.  Die Daten√ºbertragungsrate betr√§gt 300 MB / s. <br><br>  Simulink empf√§ngt ein Array von Daten und gibt sie zur weiteren Verarbeitung weiter.  Die Zeit f√ºr diese Verarbeitung wird bereits durch die Komplexit√§t des Modells bestimmt.  In diesem Beispiel wird das Array einfach im Oszilloskopfenster angezeigt. <br><br>  Irgendwann entscheidet Simulink, dass es notwendig ist, den n√§chsten Zyklus durchzuf√ºhren, und alles wiederholt sich.  Wieder werden USB-Befehle gesendet, um den ADC vorzubereiten, den Generator zu starten und Daten zu sammeln. <br><br>  Dieser Modus ist sehr praktisch zum Debuggen von Hardware und Algorithmen.  Sie k√∂nnen nirgendwo hetzen.  Sammeln Sie ein Array von Daten.  Sie k√∂nnen es ruhig betrachten, auf eine CD brennen und Kaffee trinken.  Wenn aber alles gekl√§rt ist, ist es bereits m√∂glich, in einen kontinuierlichen Erfassungsmodus zu wechseln. <br><br>  <b>DLL-Verbindung</b> <br><br>  Mit Matlab k√∂nnen Sie Funktionen verbinden, die in externen DLLs implementiert sind.  Simulink kann auch externe DLLs verbinden, w√§hrend einige Anforderungen hinzugef√ºgt werden.  In Simulink sieht die externe DLL wie ein S-Funktionsblock aus. <br><br><img src="https://habrastorage.org/webt/vi/ln/ov/vilnovzdl8eg7r3kqxbwgwcgh5a.png"><br><br>  MATLAB bietet eine Vielzahl von Beispielen, einschlie√ülich der Erstellung externer DLLs.  Die von MATLAB angebotene Methode ist jedoch nicht sehr praktisch.  Es gibt ein OpenSource <b><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">easyLink-</a></b> Projekt.  Dieses Projekt hat eine Klassenbibliothek f√ºr die Verbindung mit Simulink entwickelt. <br><br>  Um eine Komponente zu erstellen, m√ºssen Sie eine von BaseBlock abgeleitete Klasse erstellen und Ports deklarieren: <br><br><img src="https://habrastorage.org/webt/_m/p-/rb/_mp-rbn7ntlkvgxwf3xnoibmhlm.png"><br><br><img src="https://habrastorage.org/webt/qn/94/th/qn94tho2jxf3nlnhaarxwosshxq.png"><br><br>  <b>DLL-Verbindungsprobleme</b> <br><br>  Externe DLLs erlauben viel, aber es gibt eine Reihe von Problemen bei der Arbeit mit ihnen.  Die wichtigsten f√ºr mich pers√∂nlich sind die folgenden: <br><br><ol><li>  Das Debuggen von DLLs ist schwierig </li><li>  Es ist umst√§ndlich, die Ausgabe von printf () zu sehen </li><li>  Das Neukompilieren einer DLL erfordert das Beenden von MATLAB </li></ol><br>  Beim Debuggen eines Programms ist ein schrittweises Debuggen erforderlich.  Bei einer DLL ist es m√∂glich, eine Verbindung zu einer bereits in den Speicher geladenen DLL herzustellen, dort einen Haltepunkt zuzuweisen und eine Debugging-Sitzung durchzuf√ºhren.  Es ist jedoch notwendig, den Moment des Ladens der DLL √ºber Simulink zu erfassen und den Arbeitsbeginn irgendwie zu verz√∂gern.  All dies kann getan werden, ist aber unpraktisch. <br><br>  Dabei m√∂chte ich unbedingt die Debug-Ausgabe sehen, die als Standard-Standard-Stream erstellt wird.  Im Fall der DLL kann dieser Thread irgendwie abgefangen werden, aber es ist mir nicht gelungen. <br><br>  Und schlie√ülich ist die wichtigste Unannehmlichkeit die Notwendigkeit, MATLAB beim Neukompilieren der DLL zu beenden.  Andernfalls k√∂nnen Sie einfach keine neue Datei schreiben.  Das Beenden und anschlie√üende Starten von MATLAB nimmt viel Zeit in Anspruch. <br><br>  Um diese Probleme zu l√∂sen, gibt es einen klassischen Weg, komplexe Softwaresysteme zu erstellen.  Dies ist die Interaktion zwischen Programmen √ºber den gemeinsamen Speicher. <br><br>  <b>Shared Memory-Verbindung</b> <br><br>  Mit modernen Betriebssystemen, sowohl Windows als auch Linux, k√∂nnen Sie gemeinsame Speicherbereiche organisieren.  Auf diese Weise k√∂nnen Sie zuverl√§ssige Programme erstellen.  Beispielsweise kann ein Programm eine grafische Oberfl√§che enthalten und mit dem Bediener interagieren, und ein anderes Programm kann mit dem Ger√§t interagieren.  In diesem Fall f√ºhrt das Einfrieren des Programms, das mit dem Ger√§t interagiert, nicht zum Einfrieren des Interaktionsprogramms mit dem Bediener.  Im Fall von Simulink bietet dieser Ansatz auch einige Vorteile.  Das Programm f√ºr die Arbeit mit dem Ger√§t wird einmal gestartet, bereitet das Ger√§t vor und wartet √ºber den gemeinsam genutzten Speicher auf den Befehl.  Die DLL wird jedes Mal geladen, wenn Sie Simulink in der Simulation ausf√ºhren.  Da die DLL nicht direkt mit der Hardware funktioniert, erfolgt dieser Start schnell. <br><br>  F√ºr diesen Stand wurden zwei Programme und zwei DLLs entwickelt: <br><br><ol><li>  simulink_a7dac - Generatorsteuerungsprogramm </li><li>  simulink_adc - ADC-Steuerprogramm </li><li>  sm_ctrl - Generatorsteuerungs-DLL </li><li>  sm_adc - ADC-Steuer-DLL </li></ol><br><br>  Das Blockdiagramm ist in der folgenden Abbildung dargestellt: <br><br><img src="https://habrastorage.org/webt/1u/vq/ec/1uvqecetd2an7yzazp2z2p2idma.png"><br><br>  Das Programm simulink_adc basiert auf der Bardy-Bibliothek.  Mit diesem Programm k√∂nnen Sie mit jedem von InSys JSC hergestellten ADC arbeiten.  Die Abstimmung auf einen bestimmten ADC und ein bestimmtes Tr√§germodul erfolgt √ºber Initialisierungsdateien. <br><br>  <b>Schemaansicht in Simulink</b> <br><br>  Und schlie√ülich, wie es in Simulink aussieht: <br><br><img src="https://habrastorage.org/webt/mb/w8/aq/mbw8aq0g8ddsb2wnkbk9p6dhr8c.png"><br><br>  In Simulink sieht alles so aus wie es ist.  Eine Einheit f√ºr die ADC-Steuerung.  Der zweite Block zur Steuerung des Generators.  Zur Steuerung des Generators stehen eine Reihe von Parametern zur Verf√ºgung.  F√ºr den ADC erfolgt alles √ºber die Initialisierungsdatei.  Bei Bedarf kann auch eine Reihe von ADC-Parametern auf Blockebene angezeigt werden. <br><br>  Beachten Sie die beiden Master-Oszillatoren.  In Bezug auf die Modellzeit geben sie die Startzeit und den Zeitpunkt der Datenerfassung an.  Diese Punkte sind sehr wichtig.  Sie stellen tats√§chlich die Verbindung zwischen dem Modell und der realen Welt her.  Das Startsignal tritt in den ADC-Block ein und wird in der DLL verarbeitet.  √úber den gemeinsamen Speicher gelangt er in das ADC-Programm.  Dann wird es in eine Folge von Schreibbefehlen in die Register umgewandelt, die √ºber USB in das FPGA gelangen.  Und innerhalb des FPGA ist die Suchvorderkante des Startsignals gespannt.  Und erst wenn die Maschine in die entgegengesetzte Richtung gespannt ist, durchl√§uft die Best√§tigung dieselbe Kette.  Wenn die Best√§tigung Simulink erreicht, erscheint das start_out-Signal am Ausgang des sm_adc-Blocks, der an den sm_ctrl-Block √ºbergeben wird.  Und es wird der gleiche Moment der Modellzeit sein.  Im sm_ctrl-Block wird entlang derselben Kette das Signal an das FPGA des Generators √ºbertragen und bildet das Signal.  Der ADC erfasst dieses Signal in seinem Speicher.  Ein Datenerfassungssignal wird vom zweiten Masteroszillator erzeugt.  Auf die gleiche Weise gehen die Daten an Simulink und an die Datenausgabe des sm_adc-Blocks.  Im Moment wird ein Block mit 16384 Z√§hlungen zur√ºckgegeben.  Der empfangene Block wird auf dem Oszilloskop angezeigt. <br><br><img src="https://habrastorage.org/webt/ov/u3/uk/ovu3uklgq_xzvvjpkfcpoopqzec.png"><br><br>  <b>Ergebnisse</b> <br><br>  Die Arbeit mit gemeinsam genutztem Speicher hat sich als effektiv erwiesen.  Mit dem ADC-Verwaltungsprogramm k√∂nnen Sie mit jedem unserer ADCs arbeiten.  Gleichzeitig bleibt eine bequeme M√∂glichkeit, Parameter √ºber die Konfigurationsdatei zu konfigurieren.  Das Programm ist als Konsolenanwendung konzipiert, w√§hrend die gesamte Debug-Ausgabe sichtbar ist.  Es gibt einen Hinweis auf die Funktionsf√§higkeit.  Mit der SM_CTRL-Komponente k√∂nnen Sie verschiedene externe Anwendungen zur Steuerung von Ger√§ten verbinden.  Das Debuggen des ADC-Steuerprogramms verursacht keine Schwierigkeiten.  Dies ist ein g√§ngiges Programm, mit dem Sie Haltepunkte setzen und Fehler beheben k√∂nnen.  Mit der gleichen Technologie k√∂nnen andere Programme f√ºr die Interaktion zwischen Matlab / Simulink und der Au√üenwelt entwickelt werden. <br><br>  Die Arbeit wird auf der Website <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hub.exponenta.ru ver√∂ffentlicht</a> ; <br><br>  Referenzen: <br><ol><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">SIMULINK_SM-Projekt - Programmquellcode: https://github.com/dsmv/simulink_sm</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">EasyLink-Projekt: https://sourcesup.renater.fr/frs/?group_id=1500</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Tr√§germodul FMC128E http://insys.ru/fmc/fmc128e</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Submodul FM412x500M http://insys.ru/mezzanine/fm412x500m</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Telegrammkanal InSys Research</a> </li></ol></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de470327/">https://habr.com/ru/post/de470327/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de470311/index.html">Holzspielzeug, Teil Sieben - 1993</a></li>
<li><a href="../de470313/index.html">Holzspielzeug, Teil Acht - 1994</a></li>
<li><a href="../de470317/index.html">C ++ Abk√ºrzung Spickzettel und mehr. Teil 2: "und nicht nur"</a></li>
<li><a href="../de470321/index.html">Holzspielzeug, Teil Neun - 1995</a></li>
<li><a href="../de470323/index.html">DIY DeepFake [Teil 1]</a></li>
<li><a href="../de470331/index.html">Wie identifiziere ich indizierte ISI-, Scopus- oder Scimago-Protokolle?</a></li>
<li><a href="../de470333/index.html">Programmierer-, Manager-, MVC- und Akzeptanzkriterien</a></li>
<li><a href="../de470337/index.html">Wie ich 3 Monate in Y. Market gearbeitet und gek√ºndigt habe</a></li>
<li><a href="../de470347/index.html">Wie man HERE API in kurzer Zeit lernt</a></li>
<li><a href="../de470349/index.html">Automatisieren Sie Routinen zur automatischen Generierung von SOAP-Clients mit WSDL-Import f√ºr SBT und Scala</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>