<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🖖🏻 🥤 🛏️ Sur la question de la construction de vélos dans le domaine du stockage du courrier électrique 🤷🏿 🧘🏿 👨🏿‍🚒</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Par ma volonté, il y a un serveur de messagerie sous ma garde. Petit, ~ 20 utilisateurs. Cela fonctionne de manière stable, il n'est pas souhaitable d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sur la question de la construction de vélos dans le domaine du stockage du courrier électrique</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/420371/">  Par ma volonté, il y a un serveur de messagerie sous ma garde.  Petit, ~ 20 utilisateurs.  Cela fonctionne de manière stable, il n'est pas souhaitable de changer de logiciel.  Et ce ne serait pas nécessaire, mais une fois que les journaux de sauvegarde ont laissé entendre sans équivoque - si vous continuez dans le même esprit, toute la nuit ira à une sauvegarde complète.  Et le problème réside dans le volume des boîtes aux lettres des utilisateurs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/1e/lg/ef/1elgefhundgzt-huf1mhs5fgj1u.jpeg"></div><a name="habracut"></a><br>  Le problème est indiqué, il faut le résoudre.  La voie à suivre - pour acheter du fer encore plus puissant - n'est pas mon genre et le budget n'est pas en caoutchouc.  L'option évidente: les quotas.  Mais en pratique, cela n'aide pas beaucoup.  Les serments de «J'ai tout nettoyé», après un examen plus approfondi, se transforment en sceaux, en images drôles et en archives de photos de famille (dans le courrier de l'entreprise, oui).  Et le nombre de cris «J'ai une lumière urgente ne fonctionne pas, faites-le immédiatement» augmente d'un ordre de grandeur.  Donc, pas pour longtemps et perdez confiance dans les gens. <br><br>  Heureusement, je ne suis ni psychologue, ni coach, ni mentor.  Mon entreprise est la technologie.  Nous allons donc venir du côté technique. <br><br>  La première chose que j'ai pensé était des messages autodestructeurs.  En gros, tout ce qui n'est pas marqué "important" est supprimé après N jours.  À mon goût, il devrait être "cousu" dans les normes de stockage du courrier électrique.  Mais jusqu'à présent ce n'est pas le cas et la mise en œuvre m'a paru trop ambitieuse. <br><br>  La deuxième pensée était des copies.  Connaissez ces messages dont vous n'êtes pas le destinataire principal.  Vient à vous juste pour information.  Certains de ces messages pourraient être supprimés automatiquement.  Mais, tout à coup, ici, les utilisateurs étaient divisés en deux camps: «ils ont tous besoin de quoi» et «qu'est-ce que c'est».  Je n'ai pas maîtrisé l'algorithme de tri automatique dans de telles conditions. <br><br>  Eh bien, ne supprimez pas, alors copiez!  Prenez toutes les copies et faites des liens symboliques.  Une analyse rapide a montré que même le traitement des doublons FULL de cette manière permet d'économiser TROIS référentiels.  Mais, mais, mais.  Malheureusement, il s'agit d'une voie sans issue en raison de nombreuses limitations techniques. <br><br><div class="spoiler">  <b class="spoiler_title">Détails pour ceux intéressés par le spoiler</b> <div class="spoiler_text">  - tous les archiveurs ne comprennent pas les liens symboliques; <br>  - Le logiciel serveur devient fou par endroits; <br>  - complexité org.  caractère et droits d'accès. <br></div></div><br>  Soit dit en passant, dans mes paramètres de serveur de messagerie et les sauvegardes générales, et le stockage d'archives pour les utilisateurs sont très rares.  L'espace de manœuvre était donc réduit. <br><br>  Que reste-t-il?  Avec tristesse j'ai regardé les phoques <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/3_/lg/nh/3_lgnhen33bf-iilsfejxyfrpuo.jpeg"></div><br>  et se demandait déjà un simple réseau de neurones qui nettoierait le courrier pour l'utilisateur.  Et puis ... Excusez-moi, excusez-moi, mais que font les chats dans la lettre?  Je me souviens qu'une lettre avec une pièce jointe pèse près d'un tiers de plus qu'une pièce jointe!  Mais puis-je déplacer la pièce jointe? .. <br><br>  Ainsi a commencé le chemin où il y avait "beaucoup de merveilleuses découvertes".  Si je savais ... Eh bien, tu comprends.  Une goutte d'ignorance et de courage nous mène à la victoire! <br><br>  Donc: nous faisons le <b>stockage des pièces jointes séparément des lettres</b> . <br><br>  La principale erreur que vous pouvez faire ici est d'ouvrir le fichier eml dans un éditeur de texte et de décider qu'il y a du texte brut.  Alors je l'ai fait.  Et était ravi.  Pour l'instant, je vais écrire un fichier de commandes.  Les utilitaires de ligne de commande pour l'extraction des pièces jointes sont complets: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/erikvdv1/eml-attachments</a> ou <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">github.com/maiken2051/uudeview</a> , à la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">main</a> .  Il y a des problèmes avec les encodages, mais ce n'est pas la chose la plus importante. <br><br>  La chose la plus importante: retirer le fichier et créer un lien vers celui-ci est une affaire insignifiante.  Mais pour pousser ce lien dans la lettre d'origine ... Parce qu'il n'y a pas de texte.  Il y a <b>MIME</b> . <br><br>  Un lecteur expérimenté, bien sûr, glousse maintenant contre l'auteur malheureux.  L'auteur a cependant découvert les délices de la «norme».  La chose la plus importante que j'ai comprise: les champignons agaric volants ne sont pas nécessaires pour tomber dans un berserk. <br><br><div class="spoiler">  <b class="spoiler_title">Exemples et abus - sous le spoiler:</b> <div class="spoiler_text"><br>  charset = utf-8 <br>  charset = "UTF-8" <br>  charset = "UTF-8" <br>  charset = UTF-8; <br>  charset = "UTF-8"; <br>  charset = "UTF-8"; <br>  C'est une seule et même chose. <br><br>  Les sauts de ligne au milieu d'un flux Base64.  D'où ils viennent est encore un mystère pour moi. <br><br>  Et vice versa: l'absence de \ r \ n \ r \ n après la partie en-tête. <br><br>  Dans l'en-tête lui-même, l'ordre des champs est à la demande du talon gauche. <br><br>  Les lettres plus anciennes autorisent une longueur de ligne ne dépassant pas 80 caractères, y compris les caractères de service. <br><br>  Il peut y avoir des sauts de ligne dans les noms de fichiers (dans le corps du message et non dans le nom lui-même). <br><br>  En général, les sauts de ligne peuvent être n'importe où, malgré le fait que dans le saut de ligne standard est déclaré comme la fin du paramètre actuel. <br><br>  Le texte de la lettre lui-même est codé.  Comment est-il exactement encodé, reste dans la conscience d'un serveur particulier, il y a un tas d'options (puant). <br><br>  Et, dans la lettre, il y a presque toujours une partie html.  Autrement dit, si vous envoyez "Bonjour" et qu'il y a une balise br ou p, alors dans la lettre il y aura toujours DEUX sections: avec du texte simple et avec des balises.  Et le texte est dupliqué.  Et ici, ils ont "économisé" la puissance de calcul ... Juste une ménagerie avec Frankenstein. <br><br>  Le nom des fichiers dont ils disposent est le suivant: filename = "=? Encoding? Type?; Et cela se produit comme ceci: filename * 0 * = encoding '' (STA ?? !!). Le second est une norme plus récente, RFC5987. La norme indique explicitement ce nom de fichier * 0 * = ENC et nom de fichier = "=?  même chose.  À cet endroit, j'ai finalement été convaincu qu'ils se moquaient de moi.  Comment cela peut être géré normalement, je ne sais pas. <br><br>  Séparément, comme d'habitude, Apple a marqué.  Ils ont généralement une sorte de norme qui leur est propre.  Pour l'avenir, de longues tentatives de traitement de leur code ont conduit à la seule solution correcte: «Erreur: le courrier Apple n'est pas pris en charge.» <br><br>  Thunderbird le fait cependant.  Avec chagrin, je suis monté dans ses sources, mais je n'ai pas pu trouver la section nécessaire dans un gigaoctet et demi de code pour un mélange de python et de dialectes de Java.  Aidé dans leur IRC, où ils m'ont gentiment dit où chercher, mais ne pouvaient toujours pas le trouver. <br></div></div><br>  Mais il n'a pas perdu courage.  Ne lisez pas la documentation @ écrivez le code, et vous avez terminé.  Non, sérieusement, j'ai dû faire quelque chose pour rapprocher la fin du MIME. <br><br>  Le script batch n'était pas suffisant.  Le résultat a été <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">un utilitaire de ligne de commande en C # et dotNet</a> . <br><br>  L'utilitaire a deux modes de fonctionnement: <br>  Premièrement: extrait simplement les pièces jointes.  En même temps, il fonctionne correctement avec les encodages pour Windows. <br><br>  Deuxièmement: et ici le principal plaisir.  Maintenant, nous pouvons toujours stocker les pièces jointes séparément du courrier!  L'utilitaire <b>crée une nouvelle lettre au lieu de l'ancienne</b> : la <b>pièce jointe est découpée, la lettre est reformatée en HTML brut avec encodage UTF</b> sans limiter la longueur de la ligne.  La section texte / simple est prise comme base.  S'il y a des tableaux dans la section html, il les transfère tout en conservant la mise en forme à l'intérieur du tableau, mais cette fonctionnalité fonctionne à peu près.  À la fin du texte de la lettre en cours (s'il s'agit d'une réponse ou d'un transfert), des liens vers les ressources réseau sont insérés avec le chemin d'accès aux fichiers extraits, dans les formats file: /// et ftp: //. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cad/324/3b7/cad3243b7a0c78597fddcc3f4162c563.png" alt="image"><br><br>  Le système est testé sur plus de 10000 lettres et est déployé sur l'infrastructure existante. <br><br>  <b>Avantages identifiés:</b> <br>  + était: <br><blockquote>  Sauvegarde <br>  Elle a commencé à 01:00:08 <br>  et terminé avec succès 03:26:32 <br></blockquote><br>  est devenu: <br><blockquote>  Sauvegarde <br>  Cela a commencé à 01:00:09 <br>  et terminé avec succès 01:40:36 <br></blockquote><br>  + 30% d'économie de stockage +: les fichiers passent du lourd Base64 et d'autres au format de système de fichiers normal, en plus de nombreux doublons ont été trouvés même dans des boîtes aux lettres individuelles. <br><br>  + La vitesse de traitement des boîtes aux lettres par le serveur et les programmes de messagerie est augmentée. <br><br>  + Disparaît "J'ai ouvert une lettre du bureau de poste, l'ai éditée pendant 10 heures et elle n'a pas survécu" <br><br>  + Vous pouvez refuser des quotas. <br><br>  + Il reste possible de trouver une pièce jointe dans l'e-mail, au lieu de simplement la transférer dans le stockage de fichiers. <br><br>  + Vers la fin de MIME.  Repentez-vous, auteurs! <br><br>  <b>Inconvénients de la décision:</b> <br><br>  - certaines lettres (mais pas les pièces jointes) battent toujours.  Fondamentalement pas en interne, mais vu par certains clients; <br>  - en ftp certains démons se brisent constamment; <br>  - tous les clients de messagerie ne prennent pas en charge l'ouverture via un fichier: /// <br><br>  <b>Problèmes controversés:</b> <br><br>  ?  Courrier Apple non pris en charge.  Pour moi - et le Bouddha est avec lui; <br>  ?  Battez des lettres avec un formatage complexe.  Habituellement, ce sont des dépliants de réservation ou de publicité; <br>  ?  Si le serveur ftp est sur un port non standard, il peut y avoir des problèmes d'accès.  Décidé par un bot de messagerie. <br><br>  D'une manière si épineuse, le problème a été résolu. <br><br>  Merci de votre attention! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr420371/">https://habr.com/ru/post/fr420371/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr420359/index.html">Var, let ou const? Problèmes de portée variable et ES6</a></li>
<li><a href="../fr420361/index.html">Bogue lors de l'exécution de TextBox.GetLineText dans .NET WPF</a></li>
<li><a href="../fr420363/index.html">Webinaires HPE en août-octobre: ​​nouveaux sujets (+ SHD, pratique de l'IA, stockage clé en main de pétaoctets)</a></li>
<li><a href="../fr420367/index.html">Apocalypse climatisée: scénario de panne de réseau intelligent</a></li>
<li><a href="../fr420369/index.html">Extreme Extended Edge ou commutation IEEE 802.1BR</a></li>
<li><a href="../fr420373/index.html">Presque OCR pour obtenir le mot de passe VPNBook. PHP + Mikrotik</a></li>
<li><a href="../fr420375/index.html">Apprenez OpenGL. Leçon 5.8 - Bloom</a></li>
<li><a href="../fr420377/index.html">Comment nous avons commencé les appels vidéo</a></li>
<li><a href="../fr420381/index.html">Pourquoi suffit-il de considérer les réseaux de neurones comme une boîte noire?</a></li>
<li><a href="../fr420383/index.html">"Yandex.Money ne vous intéresse pas pour saisir votre candidature."</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>