<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>๐ ๐คธ๐ผ ๐คต๐พ ุชูููุฐ PPPOS ุนูู stm32f4-discovery ๐ถ๐ป ๐ก ๐ณ๏ธ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ุฐุงุช ูุฑุฉ ุ ูุงูุช ููุงู ูููุฉ ูุชูููุฑ ุงููุตูู ุฅูู ุงูุฅูุชุฑูุช ุนูู STM32 ุจุนุฏ ุฃู ูุงู ููุฐุง ูููุฐ COM ููุท. ูุญู ูุฐู ุงููุดููุฉ ุ ููุช ุจุญุงุฌุฉ ุฅูู PPP ุ ุฃู ุ ุนูู ูุฌู ุงูุฏูุฉ ุ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ุชูููุฐ PPPOS ุนูู stm32f4-discovery</h1><div class="post__body post__body_full" style=";text-align:right;direction:rtl"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/419037/" style=";text-align:right;direction:rtl">  ุฐุงุช ูุฑุฉ ุ ูุงูุช ููุงู ูููุฉ ูุชูููุฑ ุงููุตูู ุฅูู ุงูุฅูุชุฑูุช ุนูู STM32 ุจุนุฏ ุฃู ูุงู ููุฐุง ูููุฐ COM ููุท.  ูุญู ูุฐู ุงููุดููุฉ ุ ููุช ุจุญุงุฌุฉ ุฅูู PPP ุ ุฃู ุ ุนูู ูุฌู ุงูุฏูุฉ ุ PPPoS (ุจุฑูุชูููู ููุทุฉ ุฅูู ููุทุฉ ุนุจุฑ ุงููุณูุณู - ุฅุญุฏู ุทุฑู ุชูููุฐ PPP ุ ูุชู ุงุณุชุฎุฏุงูู ุนูุฏ ุงูุงุชุตุงู ุนุจุฑ ูููุฐ COM). <br><br>  ูู ุนูููุฉ ุญู ุงููููุฉ ุงูุชู ุชู ุชุนููููุง ูุจูู ุ ูุงุฌูุช ุจุนุถ ุงูุตุนูุจุงุช ุ ุฃุญุฏูุง ุ ูู ุฑุฃูู ุ ูู ุนุฏู ููุงูุฉ ุชุบุทูุฉ ุงููุถุงูุง ุงููุชุนููุฉ ุจู PPPoS ุนูู ุงูุฅูุชุฑูุช.  ูุน ูุฐุง ุงูููุดูุฑ ุ ุณุฃุญุงูู ุฅุบูุงู ุงููุฌูุฉ ุงููุญุฏุฏุฉ ุ ุจูุฏุฑ ูุง ุชุณูุญ ูุนุฑูุชู ุงููุชูุงุถุนุฉ. <br><br>  ุชูุถุญ ูุฐู ุงูููุงูุฉ ููููุฉ ุฅูุดุงุก ูุดุฑูุน ูู System Workbench ูู STM32 ูู ุงูุจุฏุงูุฉ.  ูุนุฑุถ ูุซุงูุง ููุนูู ูุน UART.  ููุงู ุฃูุซูุฉ ุจุฑูุฌูุฉ ูุชุทุจูู PPP.  ูุจุงูุทุจุน ุ ูุซุงู ุนูู ุฅุฑุณุงู ุฑุณุงูุฉ ุฅูู ููุจููุชุฑ ูุฌุงูุฑ. <br><a name="habracut"></a><br><h3 style=";text-align:right;direction:rtl">  ููุฏูุฉ </h3><br>  PPP (ุจุฑูุชูููู ููุทุฉ ุฅูู ููุทุฉ) ูู ุจุฑูุชูููู ุฑุจุท ุจูุงูุงุช ูู ููุทุชูู ููููุฐุฌ ุดุจูุฉ OSI.  ูุชู ุงุณุชุฎุฏุงูู ุนุงุฏุฉ ูุฅูุดุงุก ุงุชุตุงู ูุจุงุดุฑ ุจูู ุนูุฏุชูู ููุดุจูุฉ ุ ููููู ุฃู ูููุฑ ูุตุงุฏูุฉ ุงูุงุชุตุงู ูุงูุชุดููุฑ ูุถุบุท ุงูุจูุงูุงุช.  ุชุณุชุฎุฏู ุนูู ุฃููุงุน ูุซูุฑุฉ ูู ุงูุดุจูุงุช ุงููุงุฏูุฉ: ูุจู ููุฏู ุ ุฎุท ูุงุชู ุ ุดุจูุฉ ุฎูููุฉ ุ ุฅูุฎ. <br><br>  ุบุงูุจูุง ูุง ุชูุฌุฏ ุฃููุงุน ูุฑุนูุฉ ูู ุจุฑูุชูููู PPP ุ ูุซู ุจุฑูุชูููู ููุทุฉ ุฅูู ููุทุฉ ุนุจุฑ ุฅูุซุฑูุช (PPPoE) ุ ุชุณุชุฎุฏู ููุงุชุตุงู ุนุจุฑ ุฅูุซุฑูุช ุ ูุฃุญูุงููุง ูู ุฎูุงู DSL ุ  ูุจุฑูุชูููู ููุทุฉ ุฅูู ููุทุฉ ุนุจุฑ ATM (PPPoA) ุ ูุงูุฐู ูุณุชุฎุฏู ููุงุชุตุงู ุนุจุฑ ATM Adaptation Layer 5 (AAL5) ุ ููู ุงูุจุฏูู ุงูุฑุฆูุณู ูู PPPoE ูู DSL. <br><br>  PPP ูู ูุฌููุนุฉ ูู ุงูุจุฑูุชููููุงุช: ุจุฑูุชูููู ุงูุชุญูู ูู ุงูุงุฑุชุจุงุท (LCP) ูุจุฑูุชูููู ุงูุชุญูู ูู ุงูุดุจูุฉ (NCP) ูุจุฑูุชููููุงุช ุงููุตุงุฏูุฉ (PAP ู CHAP) ู PPP ูุชุนุฏุฏ ุงููููุงุช (MLPPP). <br><br>  <i>ูู ููููุจูุฏูุง</i> . <br><br><h3 style=";text-align:right;direction:rtl">  ุชุญุถูุฑ </h3><br>  ูุญู ุงููุดููุฉ ูุญุชุงุฌ ุฅูู: <br><br><h4 style=";text-align:right;direction:rtl">  ุงูุญุฏูุฏ: </h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ููุญุฉ ุงูุชุตุญูุญ stm32f4_discovery: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/u1/0k/6-/u10k6-una1bkmaphl4wlazibaca.jpeg"></div></li><li style=";text-align:right;direction:rtl">  ูุญูู USB ุฅูู miniUSB ูุชูุตูู ุงูููุญุฉ ุจุฌูุงุฒ ููุจููุชุฑ. </li><li style=";text-align:right;direction:rtl">  ุงุซูุงู ูู ูุญููุงุช USBtoUART FT232: <br><br><div style="text-align:center;;text-align:right;direction:rtl"><img src="https://habrastorage.org/webt/uh/uk/mo/uhukmolq4_t-pckn8h2rjofspnu.png"></div></li><li style=";text-align:right;direction:rtl">  ููุง ุฃู ูุจูู ุชูุฏูุฏ USB ูููุฏุงู ุฃูุถูุง ุ ูููุณ ุจุงูุถุฑูุฑุฉ ุ ููููููุง ููุงุณุจุงู. </li></ol><br><h4 style=";text-align:right;direction:rtl">  ูุงุนู: </h4><br><ol style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl">  ุงูุขูุฉ ุงูุงูุชุฑุงุถูุฉ VirtualBox.  ููููู ุชูุฒููู ูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ูููู ุฃูุถูุง ุจุชูุฒูู ูุชุซุจูุช <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ุญุฒูุฉ</a> ุงูููุญูุงุช ูู VirtualBox. </li><li style=";text-align:right;direction:rtl">  ูุฑุตุงู ููุชุซุจูุช ูุน ุฃูุธูุฉ ุงูุชุดุบูู Windows ู Linux.  ูุฃุฎุฐ Windows <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> ุ ููููุณ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> . <br><br>  ุจุนุฏ ุชุซุจูุช ูุธุงู ุงูุชุดุบูู ุ ุณุชุญุชุงุฌ ุฅูู ุชุซุจูุช ุงููุธุงุฆู ุงูุฅุถุงููุฉ ููุธุงู ุงูุชุดุบูู ุงูุถูู.  ูููููุฉ ูุฏููุง ูุง ูููู ูู ุฃูุธูุฉ 32x ุ ูุง ููููู ุฃู ุชุฎุฏุน ุจุชุถููู ุงููุญุงูุงุฉ ุงูุงูุชุฑุงุถูุฉ. </li><li style=";text-align:right;direction:rtl">  ุจุงููุณุจุฉ ููุธุงู ุงูุชุดุบูู Windows ุ ูุญุชุงุฌ ุฅูู ุจุฑูุงูุฌ ููููู ูุจูู ุงูุทูุจุงุช ูุงูุงุณุชุฌุงุจุฉ ููุง ุนุจุฑ TCP / IP ุ ูุจุฑูุงูุฌ ุทุฑูู ููุนูู ูุน ูููุฐ COM.  ูู ุจุชูุฒูู PacketSender <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> (ุงููุฑ ููู "ูุง ุดูุฑูุง ุ ููุท ุฏุนูู ุฃุญูู") ุ ุงููุญุทุฉ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> .  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุญุชุงุฌ ุฅูู STM32CubeMX ููุฅุนุฏุงุฏ ุงูุฃููู ูููุดุฑูุน.  ุงูุชูุฒูู ูู st.com (ุจุนุฏ ุงูุชุณุฌูู ุ ุณูุฃุชู ุงูุฑุงุจุท ุนู ุทุฑูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู). </li><li style=";text-align:right;direction:rtl">  ูุถุน System Workbench ูู STM32 ุนูู ูุธุงู ุงูุชุดุบูู ุงูุฑุฆูุณู.  ุงูุชูุฒูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ูู ููุง</a> (ุงูุชุณุฌูู ูุทููุจ). </li></ol><br><h3 style=";text-align:right;direction:rtl">  ุงููุฑุญูุฉ 1. ุฅูุดุงุก ูุดุฑูุน </h3><br>  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ุงูุชุญ STM32CubeMX ููู ุจุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ ููุงู ูููุญุฉ ุงูุงูุชุดุงู stm32f4.  ูู ุจุชุดุบูู RCC ู Ethernet (ETH) ู SYS ู USART2 ู USART3 ุ ุซู ูู ุจุชุดุบูู FREERTOS ู LWIP. <br><br><img src="https://habrastorage.org/webt/vr/jk/ve/vrjkveavft5ry-oasa7h2e07rwe.png"><br><img src="https://habrastorage.org/webt/9c/v2/rv/9cv2rv-_8yf5w67mr7bw7ynp1vk.png"><br><br>  ููุชุดุฎูุต ุ ูุญุชุงุฌ ุฅูู ูุตุงุจูุญ LED ุนูู ุงูููุญุฉ.  ููุฐุง ุ ูู ุจุชูููู ุฃุฑุฌู PD12-PD15 ูู GPIO_Output. <br><br><img src="https://habrastorage.org/webt/-s/bb/lk/-sbblkybmbdz1wrftiow38tq4eg.png"><br><br>  ูู ุนูุงูุฉ ุงูุชุจููุจ ุชูููู ุงูุณุงุนุฉ ุ ูู ุจุชุนููู ุงูุชุฑุฏุฏ ุ ููุง ูู ุงูุตูุฑุฉ ุฃุฏูุงู. <br><br><img src="https://habrastorage.org/webt/sd/cc/qy/sdccqyreetba7g_m8yq_gypc-ge.png"><br><br>  ุจุนุฏ ุฐูู ุ ูู ุนูุงูุฉ ุงูุชุจููุจ "ุชูููู" ุ ูู ุจุชูููู ููุงูุฐ USART.  ุณูุนูู ูุนูู ูู ูุถุน DMA.  ูุฏููุง ูููุฐูู USART ุ ุฃุญุฏููุง ุณูู ูุณุชุฎุฏูู ูุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุจูุงูุงุช ุนุจุฑ PPP ุ ูุงูุซุงูู ูุชุณุฌูู ุงูุฏุฎูู.  ูุฌุนููุง ุชุนูู ุ ูุญุชุงุฌ ุฅูู ุชูููู DMA ุนูู RX ู TX ูููุง ุงููููุฐูู.  ูุฌููุน ุฃุฑุฌู ุชูููู DMA ุ ุงุถุจุท ูุชูุณุท โโุนูู ุงูุฃููููุฉ.  ู USART2 leg RX ุงุถุจุท ุงููุถุน ุนูู "ุฏุงุฆุฑู".  ูุชู ุชุฑู ุจููุฉ ุงูุฅุนุฏุงุฏุงุช ุจุดูู ุงูุชุฑุงุถู. <br><br><img src="https://habrastorage.org/webt/96/s8/9u/96s89uloxfrdtxd0scqvcyb-zng.png"><br><br>  ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุชูููู ุงูููุงุทุนุฉ ุงูุดุงููุฉ ูููุง ุงููููุฐูู ูู ุนูุงูุฉ ุงูุชุจููุจ "ุฅุนุฏุงุฏุงุช NVIC". <br><br>  ูุฐุง ูููู ุงูุฅุนุฏุงุฏ ุงูุฃููู ูููุดุฑูุน ูู STM32CubeMX.  ูููู ุจุญูุธ ููู ุงููุดุฑูุน ููููู ุจุฅูุดุงุก ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูู System Workbench ูู STM32. <br><br><img src="https://habrastorage.org/webt/ss/_d/8l/ss_d8lzdxneoj5mjasvmyhhhxiu.png"><br><br><h4 style=";text-align:right;direction:rtl">  ุงูุชูููุฐ </h4><br>  ุงูุขู ุฏุนููุง ูุชุญูู ูู ุฃู ุงูููุฏ ุงูุฐู ุชู ุชูุฒููู ูุนูู ููุนูู.  ููููุงู ุจุฐูู ุ ูู ููู main.c ูู ูุธููุฉ "StartDefaultTask" ุ ูุณุชุจุฏู ูุต ุงูุญููุฉ ุงููุงูุญุฏูุฏุฉ (ุุ) ุจูุตุงุจูุญ LED ููุชุดุบูู ูุฅููุงู ุงูุชุดุบูู. <br><br>  ูุฌุจ ุฃู ูููู ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* StartDefaultTask function */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartDefaultTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* init code for LWIP */</span></span> MX_LWIP_Init(); <span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN 5 */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Infinite loop */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(;;) { HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_SET); osDelay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_RESET); osDelay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-comment"><span class="hljs-comment">/* USER CODE END 5 */</span></span> }</code> </pre> <br>  ูุญู ุชุฌููุน ุงูุจุฑุงูุฌ ุงูุซุงุจุชุฉ ูุงููุธุฑ.  ูุฌุจ ุฃู ุชููุถ ุฌููุน ุงููุตุงุจูุญ ุงูุฃุฑุจุนุฉ ุนูู ุงูููุญุฉ. <br><br><h3 style=";text-align:right;direction:rtl">  ุงููุฑุญูุฉ 2. ุงูุนูู ูุน USART </h3><br>  ูููุชูุง ุงูุชุงููุฉ ูู ุงูุชุญูู ูู ุตุญุฉ ุชุดุบูู USART. <br><br>  ุฃูู ุดูุก ูุชุนูู ุนูููุง ุงูููุงู ุจู ูู ุฑุจุท FT232 ุจุงููุดู.  ููููุงู ุจุฐูู ุ ุงูุธุฑ ุฅูู ุงูุฃุฑุฌู ุงููุทููุฉ ููุงุฌูุฉ USART.  ูุฏู PD6 ู PD5 ูู USART2_RX ู USART2_TX ุนูู ุงูุชูุงูู. <br><br><img src="https://habrastorage.org/webt/qj/yh/yo/qjyhyoohdofxtqedphuhzq7qcac.png"><br><br>  ุจุงูุฅุถุงูุฉ ุฅูู PD9 ู PD8 ูู USART3_RX ู USART3_TX ุ ุนูู ุงูุชูุงูู. <br><br><img src="https://habrastorage.org/webt/37/bf/om/37bfomzqqcapediljrf14flpuiu.png"><br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุญุชุงุฌ ุฅูู ูุฏู GND. <br><br>  ูุฌุฏ ูุฐู ุงูุฏุจุงุจูุณ ุนูู ุงูููุญุฉ ูููุตููุง ุจุฏุจุงุจูุณ FT232 ุ ูู ุญูู ุฃู ุฏุจูุณ GND ุนูู ุงูููุญุฉ ูููู ุฃู ูููู ุฃููุง ุ ููุฌุจ ุชูุตูู ุฏุจูุณ RX ุนูู ุงูููุญุฉ ุจุฏุจูุณ TX ุนูู FT232 ุ ููุฌุจ ุชูุตูู ุฏุจูุณ TX ุนูู ุงูููุญุฉ ุจุฏุจูุณ RX ุนูู FT232.  ูุง ูุชู ุงุณุชุฎุฏุงู ุงูุงุณุชูุชุงุฌุงุช ุงููุชุจููุฉ. <br><br>  ูุจูู ุชูุตูู FT232 ุงูุฎุงุต ุจูุง ุจููุงูุฐ USB ููููุจููุชุฑ ุ ููุฐูู ุชูุตูู ููุญุฉ ุงูุงูุชุดุงู ููุณูุง ุนุจุฑ ููุตู miniUSB ุจุงูููุจููุชุฑ (ูุฌุจ ุนุฏู ุงูุฎูุท ุจููู ูุจูู microUSB). <br><br>  ุจุนุฏ ุชูุตูู FT232 ุ ุณูููู ูุธุงู ุงูุชุดุบูู ุงูุฑุฆูุณู ุจุชุซุจูุช ุจุฑุงูุฌ ุงูุชุดุบูู ุงูุฎุงุตุฉ ุจูู ุ ูุจุนุฏ ุฐูู ุณุชุญุชุงุฌ ูุฐู ุงูุฃุฌูุฒุฉ ุฅูู ุฅุนุงุฏุฉ ุชูุฌูููุง ุฅูู ุถูู Windows ุนูู ุงูุฌูุงุฒ ุงูุธุงูุฑู. <br><br>  ุงูุขู ูุถูู ุฑูุฒ ุงูุจุฑูุงูุฌ ุงููุทููุจ ูุชุดุบูู USART ุงูุฎุงุต ุจูุง.  ููููุงู ุจุฐูู ุ ุณูุถูู ุฃุฑุจุนุฉ ูููุงุช: usart.h ุ usart.c ุ logger.h ุ logger.c. <br><br>  ูุญุชููุงุช ุงูููู: <br><br>  <b>ููู usart.h</b> <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _USART_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _USART_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f4xx_hal.h"</span></span></span><span class="hljs-meta"> void usart_Open(void); bool usart_Send(char* bArray, int size_bArray); uint16_t usart_Recv(char* bArray, uint16_t maxLength); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* _USART_ */</span></span></span></span></code> </pre><br>  <b>ููู usart.c</b> <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"usart.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"logger.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"cmsis_os.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> Q_USART2_SIZE 200 xQueueHandle g_qUsart; osThreadId g_usart_rxTaskHandle; extern UART_HandleTypeDef huart2; void usart_rxTask(void); uint8_t bGet[Q_USART2_SIZE] = {0}; uint16_t g_tail = 0; void usart_Open(void) { g_qUsart = xQueueCreate( Q_USART2_SIZE, sizeof( unsigned char ) ); osThreadDef(usart_rxTask_NAME, usart_rxTask, osPriorityNormal, 0, Q_USART2_SIZE/4+128); g_usart_rxTaskHandle = osThreadCreate(osThread(usart_rxTask_NAME), NULL); HAL_UART_Receive_DMA(&amp;huart2, bGet, Q_USART2_SIZE); } void usart_rxTask(void) { for(;;) { uint16_t length = Q_USART2_SIZE - huart2.hdmarx-&gt;Instance-&gt;NDTR; while(length - g_tail) { uint8_t tmp = bGet[g_tail]; xQueueSendToBack( g_qUsart, &amp;tmp, 100 ); g_tail++; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (g_tail == Q_USART2_SIZE) g_tail = 0; } } } bool usart_Send(char* bArray, int size_bArray) { HAL_StatusTypeDef status; status = HAL_UART_Transmit_DMA(&amp;huart2, bArray, size_bArray); while (HAL_UART_GetState(&amp;huart2) != HAL_UART_STATE_READY) { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (HAL_UART_GetState(&amp;huart2) == HAL_UART_STATE_BUSY_RX) break; osDelay(1); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (status == HAL_OK) return true; return false; } uint16_t usart_Recv(char* bArray, uint16_t maxLength) { uint8_t tmp = 0; uint16_t length = 0; while(uxQueueMessagesWaiting(g_qUsart)) { xQueueReceive( g_qUsart, &amp;tmp, 100 ); bArray[length] = tmp; length++; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (length &gt;= maxLength) break; } return length; }</span></span></code> </pre><br>  <b>ููู logger.h</b> <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _LOGGER_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _LOGGER_ void logger(const char *format, ...); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* _LOGGER_ */</span></span></span></span></code> </pre><br>  <b>ููู logger.c</b> <br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"logger.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stm32f4xx_hal.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdarg.h&gt; extern UART_HandleTypeDef huart3; #define MAX_STRING_SIZE 1024 HAL_StatusTypeDef logger_Send(char* bArray, uint32_t size_bArray) { HAL_StatusTypeDef status; for(int i=0;i&lt;5;i++) { status = HAL_UART_Transmit_DMA(&amp;huart3, bArray, size_bArray); if (status == HAL_OK) break; osDelay(2); } while (HAL_UART_GetState(&amp;huart3) != HAL_UART_STATE_READY) { osDelay(1); } return status; } void logger(const char *format, ...) { char buffer[MAX_STRING_SIZE]; va_list args; va_start (args, format); vsprintf(buffer, format, args); va_end(args); buffer[MAX_STRING_SIZE-1]=0; logger_Send(buffer, strlen(buffer)); }</span></span></span></span></code> </pre><br>  ูุญู ุจุญุงุฌุฉ ุฅูู usart ูุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุจูุงูุงุช ุนูู usart2.  ุณุชููู ุงููุงุฌูุฉ ุงูุฑุฆูุณูุฉ ููุชูุงุตู ูุน ุฎุงุฏู PPP. <br><br>  ูุญุชุงุฌ ุฅูู Logger ูุชูููุฐ ุงูุชุณุฌูู ุนู ุทุฑูู ุฅุฑุณุงู ุฑุณุงุฆู ุฅูู ุงูุฌูุงุฒ ุงูุทุฑูู.  ุชุดูู ุงูุฏุงูุฉ usart_Open (void) ุงููุงุฑุบุฉ ูุงุฆูุฉ ุงูุชุธุงุฑ ูุชุจุฏุฃ ูููุฉ ุฎุฏูุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ูุฐู.  ูุฌุจ ุฅููุงู ูุฐู ุงููุธููุฉ ูุจู ุงุณุชุฎุฏุงู USART.  ุซู ูู ุดูุก ุจุณูุท ุ ุชููู ูุธููุฉ usart_Send ุงูููุทููุฉ (char * bArray ุ int size_bArray) ุจุฅุฑุณุงู ุงูุจูุงูุงุช ุฅูู ุงููููุฐ ุ ู <br>  uint16_t usart_Recv (char * bArrayุ uint16_t maxLength) ุชุญุตู ุนูููุง ูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุงูุชู ุฃุถุงูุชูุง ุฅูููุง ุฏุงูุฉ usart_rxTask (void). <br><br>  ุจุงููุณุจุฉ ูููุณุฌูู ุ ูุง ูุฒุงู ุงูุฃูุฑ ุฃุจุณุท ุ ููุณุช ููุงู ุญุงุฌุฉ ููุญุตูู ุนูู ุงูุจูุงูุงุช ุ ูุจุงูุชุงูู ุ ูุง ุญุงุฌุฉ ุฅูู ูุงุฆูุฉ ุงูุงูุชุธุงุฑ ุฃู ูููุฉ ุตูุงูุฉ ูุงุฆูุฉ ุงูุงูุชุธุงุฑ. <br><br>  ูู ุจุฏุงูุฉ ุงูููู <b>main.h</b> ุ ุชุญุชุงุฌ ุฅูู ุฅุถุงูุฉ ุนุฏุฉ <b>ุชุนุฑููุงุช</b> ุชุตู ููุน ููุทูู ุ ููู ุบูุฑ ูุชููุฑ ูู C. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN Includes */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> true 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> false 0 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE END Includes */</span></span></span></span></code> </pre><br>  ุญุงู ุงูููุช ุงูุขู ููุชุญูู ูู ูุธุงุฆู ุงูุดูุฑุฉ ุงููุงุชุฌุฉ.  ููููุงู ุจุฐูู ุ ูู ููู <b>main.c</b> ุ ูู ุจุชุบููุฑ ุฑูุฒ ุงููููุฉ ุงููุนุฑููุฉ ุจุงููุนู "StartDefaultTask" <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN 4 */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"usart.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"logger.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MAX_MESSAGE_LENGTH 100 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE END 4 */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* StartDefaultTask function */</span></span></span><span class="hljs-meta"> void StartDefaultTask(void const * argument) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* init code for LWIP */</span></span></span><span class="hljs-meta"> MX_LWIP_Init(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE BEGIN 5 */</span></span></span><span class="hljs-meta"> usart_Open(); </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Infinite loop */</span></span></span><span class="hljs-meta"> uint8_t send[] = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Send message\r\n"</span></span></span><span class="hljs-meta">; uint8_t recv[MAX_MESSAGE_LENGTH] = {0}; uint16_t recvLength = 0; for(;;) { HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_SET); osDelay(1000); HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_RESET); osDelay(1000); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (usart_Send(send, sizeof(send)-1)) logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"SEND - %s"</span></span></span><span class="hljs-meta">, send); recvLength = usart_Recv(recv, MAX_MESSAGE_LENGTH-1); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (recvLength) { recv[recvLength] = 0; logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"RECV - %s\r\n"</span></span></span><span class="hljs-meta">, recv); } } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE END 5 */</span></span></span><span class="hljs-meta"> }</span></span></code> </pre><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ูุญุชุงุฌ ุฅูู ุฅุนุทุงุก ุงููุฒูุฏ ูู ุงูุฐุงูุฑุฉ ููุฌููุนุฉ ุงูููุงู ุงูุฎุงุตุฉ ุจูุง.  ููููุงู ุจุฐูู ุ ูู ุงุณุชุฏุนุงุก ูุธููุฉ osThreadDef () ุ ุงูููู main.c ุ ุชุญุชุงุฌ ุฅูู ุฅุตูุงุญ 128 ร 128 * 10 ููุญุตูู ุนูู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs lisp">osThreadDef(<span class="hljs-name"><span class="hljs-name">defaultTask</span></span>, StartDefaultTask, osPriorityNormal, <span class="hljs-number"><span class="hljs-number">0</span></span>, &lt;b&gt;128*10&lt;/b&gt;)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  ูุญู ูุฌูุน ููููุถ.  ุชููุถ ูุคุดุฑุงุช LED ุจููุณ ุงูุทุฑููุฉ ููุง ูู ุงููููุฉ ุงูุณุงุจูุฉ. <br><br>  ููุนุฑูุฉ ูุชูุฌุฉ ุนูููุง ุ ุชุญุชุงุฌ ุฅูู ุชุดุบูู ุจุฑูุงูุฌ Terminal ูู ุฃุฌูุฒุชูุง ุงูุงูุชุฑุงุถูุฉ.  ูุซูู ูุงุญุฏ ูู ุงูุจุฑูุงูุฌ ููููุฐ ุงูุชุณุฌูู ุ ูุงูุซุงูู ููููุชุงุญ ุงูุฑุฆูุณู.  ุงุจุญุซ ูู ุฅุฏุงุฑุฉ ุงูุฃุฌูุฒุฉ ุนู ุฃุฑูุงู ุงูููุงูุฐ ุงูุชู ุชู ุชุนููููุง ูู FT232.  ุฅุฐุง ุชู ุชุนููู ุฃุฑูุงู ุฃูุซุฑ ูู 10 ุ ุฅุนุงุฏุฉ ุชุนููู. <br><br>  ุนูุฏ ุจุฏุก ุชุดุบูู ุงููุซูู ุงูุซุงูู ูู ุงูุจุฑูุงูุฌ ุ ูุฏ ูุญุฏุซ ุฎุทุฃ ุ ุฃุบูู ุงููุงูุฐุฉ ุงูุชู ุจูุง ุงูุฎุทุฃ ูุงุณุชูุฑ ูู ุงูุนูู ูุน ุงูุจุฑูุงูุฌ. <br><br>  ุจุงููุณุจุฉ ูููุง ุงููููุฐูู ุ ูููู ุจุฅูุดุงุก ุงุชุตุงู ุนูู 115200 ุจูุฏ ุ ุจุชุงุช ุงูุจูุงูุงุช - 8 ุ ุงูุชูุงุซู - ูุง ุดูุก ุ ุจุชุงุช ุงูุชููู - 1 ุ ุงููุตุงูุญุฉ - ูุง ุดูุก. <br><br>  ุฅุฐุง ููุช ุจูู ุดูุก ุจุดูู ุตุญูุญ ุ ูุนูุฏุฆุฐู ูู ุงููุงูุฐุฉ ุงูุทุฑููุฉ ูู usart2 ุ ุณูุชู ุฅุฑุณุงู ุงูุฑุณุงูุฉ "ุฅุฑุณุงู ุฑุณุงูุฉ".  ุณูุชู ุชูุฑุงุฑ ููุณ ุงูุฑุณุงูุฉ ูู ูุงูุฐุฉ ุงููุญุฏุฉ ุงูุทุฑููุฉ ูููุณุฌู ููุท ุจุงูุจุงุฏุฆุฉ "ุฅุฑุณุงู -" <br><br>  ุฅุฐุง ููุช ูู ูุงูุฐุฉ ุงููุญุทุฉ ุงูุทุฑููุฉ ูู usart2 ุจูุชุงุจุฉ ุจุนุถ ุงููุต ูู ุญูู "ุฅุฑุณุงู" ูุงูููุฑ ููู ุงูุฒุฑ ุงูููุงุจู ุนูู ูููู ูุฐุง ุงูุญูู ุ ูุญููุฆุฐู ุณุชุฑู ููุณ ุงูุฑุณุงูุฉ ูู ูุงูุฐุฉ ุงููุณุฌู ุจุงูุจุงุฏุฆุฉ "RECV -" <br><br>  ูู ุงูุตูุฑุฉ ุฃุฏูุงู: ุนูู ุงููุณุงุฑ ูู ุงููุณุฌู ุ ุนูู ุงููููู ูู usart2. <br><br><img src="https://habrastorage.org/webt/k5/v6/hc/k5v6hcxebj6hfdgbitfwyzs1ffw.png"><br><br><h3 style=";text-align:right;direction:rtl">  ุงููุฑุญูุฉ 3. ุงูุจุฏุก ุจุงุณุชุฎุฏุงู PPP </h3><br>  ูุฌุฒุก ูู ูุฐู ุงููููุฉ ุ ุณูุฑูุน ุงุชุตุงู PPP.  ุจุงุฏุฆ ุฐู ุจุฏุก ุ ูู ุจุชูููู ุงุณุชุฎุฏุงู PPP ุ ููู ุจุชุบููุฑ ูููุฉ PPP_SUPPORT ุงููุญุฏุฏุฉ ูู ููู ppp_opts.h ุฅูู 1. ุซู ูุนูุฏ ุชุนุฑูู ุงูุชุนุฑููุงุช ุงูุถุฑูุฑูุฉ ูู ููู lwipopts.h ุ <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN 1 */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MEMP_NUM_SYS_TIMEOUT 8 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CHECKSUM_GEN_IP 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CHECKSUM_GEN_TCP 1 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE END 1 */</span></span></span></span></code> </pre><br>  ูู ุงูููุช ููุณู ุ ูุฌุจ ุงูุชุนููู ุนูู ุงูุชุนุฑููุงุช ุงููุฏููุฉ. <br><br>  ุงูุขู ูููู ุจุชุนุฏูู ููู lwip.c ุ ูู ุจุฅุฏุฑุงุฌ ุงูููุฏ ุงูุชุงูู ูู ูุชูุฉ โ/ * USER CODE BEGIN 0 * /โ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN 0 */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"usart.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"pppos.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sio.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"dns.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp.h"</span></span></span><span class="hljs-meta"> static ppp_pcb *ppp; struct netif pppos_netif; void PppGetTask(void const * argument) { uint8_t recv[2048]; uint16_t length = 0; for(;;) { length=usart_Recv(recv, 2048); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (length) { pppos_input(ppp, recv, length); logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"read - PppGetTask() len = %d\n"</span></span></span><span class="hljs-meta">, length); } osDelay(10); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ip4_addr.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"dns.h"</span></span></span><span class="hljs-meta"> static void ppp_link_status_cb(ppp_pcb *pcb, int err_code, void *ctx) { struct netif *pppif = ppp_netif(pcb); LWIP_UNUSED_ARG(ctx); switch(err_code) { case PPPERR_NONE: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* No error. */</span></span></span><span class="hljs-meta"> { logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_NONE\n\r"</span></span></span><span class="hljs-meta">); logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" our_ip4addr = %s\n\r"</span></span></span><span class="hljs-meta">, ip4addr_ntoa(netif_ip4_addr(pppif))); logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" his_ipaddr = %s\n\r"</span></span></span><span class="hljs-meta">, ip4addr_ntoa(netif_ip4_gw(pppif))); logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">" netmask = %s\n\r"</span></span></span><span class="hljs-meta">, ip4addr_ntoa(netif_ip4_netmask(pppif))); } break; case PPPERR_PARAM: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Invalid parameter. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_PARAM\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_OPEN: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Unable to open PPP session. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_OPEN\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_DEVICE: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Invalid I/O device for PPP. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_DEVICE\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_ALLOC: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Unable to allocate resources. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_ALLOC\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_USER: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* User interrupt. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_USER\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_CONNECT: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Connection lost. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_CONNECT\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_AUTHFAIL: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Failed authentication challenge. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_AUTHFAIL\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_PROTOCOL: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Failed to meet protocol. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_PROTOCOL\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_PEERDEAD: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Connection timeout. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_PEERDEAD\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_IDLETIMEOUT: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Idle Timeout. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_IDLETIMEOUT\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_CONNECTTIME: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* PPPERR_CONNECTTIME. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_CONNECTTIME\n"</span></span></span><span class="hljs-meta">); break; case PPPERR_LOOPBACK: </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* Connection timeout. */</span></span></span><span class="hljs-meta"> logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: PPPERR_LOOPBACK\n"</span></span></span><span class="hljs-meta">); break; default: logger(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"ppp_link_status_cb: unknown errCode %d\n"</span></span></span><span class="hljs-meta">, err_code); break; } } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// Callback used by ppp connection static u32_t ppp_output_cb(ppp_pcb *pcb, u8_t *data, u32_t len, void *ctx) { LWIP_UNUSED_ARG(pcb); LWIP_UNUSED_ARG(ctx); if (len &gt; 0) { if (!usart_Send(data, len)) return 0x05; } logger("write - ppp_output_cb() len = %d\n", len); return len; } void pppConnect(void) { ppp = pppos_create(&amp;pppos_netif, ppp_output_cb, ppp_link_status_cb, NULL); ppp_set_default(ppp); osThreadId PppGetTaskHandle; osThreadDef(PPP_GET_TASK_NAME, PppGetTask, osPriorityNormal, 0, 128*10); PppGetTaskHandle = osThreadCreate(osThread(PPP_GET_TASK_NAME), NULL); err_t err = ppp_connect(ppp,0); if (err == ERR_ALREADY) { logger("Connected successfully"); } for(int i=0;i&lt;40;i++) { osDelay(500); if (ppp-&gt;phase &gt;= PPP_PHASE_RUNNING) break; } } /* USER CODE END 0 */</span></span></span></span></code> </pre><br>  ุจุนุฏ ุฐูู ุ ูู ุงููุธููุฉ MX_LWIP_Init () ุ ูู ุงููุชูุฉ "/ * ุฑูุฒ ุงููุณุชุฎุฏู BEGIN 3 * /" ุ ูุถูู ููุงููุฉ ุฅูู ูุธููุฉ pppConnect (). <br><br>  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุฒูุงุฏุฉ ุญุฌู ุงููููุฉ ุ ูุฐูู ุ ูู ุงูููู FreeRTOSConfig.h ุชุญุชุงุฌ ุฅูู ุงูุชุนููู ุนูู ุชุนุฑูู configTOTAL_HEAP_SIZE ุ ููู ููุงูุฉ ุงูููู ุ ูู / * ุฑูุฒ ุงููุณุชุฎุฏู BEGIN ูุญุฏุฏ * / ูุชูุฉ ุ ุฃุนูู ุนูู ุจูููุฉ ุฌุฏูุฏุฉ. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN Defines */</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Section where parameter definitions can be added (for instance, to override default ones in FreeRTOS.h) */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> configTOTAL_HEAP_SIZE ((size_t)1024*30) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE END Defines */</span></span></span></span></code> </pre><br>  ุฃูุถูุง ุ ูู ููู usart.c ุ ูู ุจุชุบููุฑ ูููุฉ ุชุนุฑูู Q_USART2_SIZE ุฅูู 2048. <br><br>  ูุจุฏุฃ ุฅุนุฏุงุฏ ุงูุงุชุตุงู ุจูุธููุฉ MX_LWIP_Init () ุ ุชู ุฅูุดุงุคู ุชููุงุฆููุง ุ ููุฏ ุฃุถููุง ููุชู ูุธููุฉ pppConnect () ุฅูููุง.  ูู ูุฐู ุงููุธููุฉ ุ ูุชู ุชุดุบูู ุงูููุงู ุงูุชู ุชุฎุฏู ุงุชุตุงู PPPOS.  ูุฌุจ ุชูุฑูุฑ ุฏุงูุงุช pppos_create () ุนูุงููู ุงููุธุงุฆู ุงูุชู ุณุชุฎุฏู ุฅุฑุณุงู ุงูุฑุณุงุฆู ูุฅุฎุฑุงุฌ ุงููุนูููุงุช ุญูู ุชุบููุฑ ุญุงูุฉ ุงูุงุชุตุงู.  ุจุงููุณุจุฉ ููุง ุ ูุฐู ูู ุงูุฏุงูุชุงู ppp_output_cb () ู ppp_link_status_cb () ุ ุนูู ุงูุชูุงูู.  ุจุงูุฅุถุงูุฉ ุฅูู ุฐูู ุ ุณุชุจุฏุฃ ูุธููุฉ pppConnect () ูููุฉ ุฎุฏูุฉ ุงูุฑุณุงุฆู ุงููุณุชููุฉ.  ูู ููุงูุฉ ุนูููุง ุ ุณุชูุชุธุฑ ูุธููุฉ pppConnect () ุญุชู ูุชู ุชุฃุณูุณ ุงูุงุชุตุงู ุจุงูุฎุงุฏู ุ ุซู ุชูููู ุนูููุง. <br><br>  ุณูุชู ุชูููุฐ ุงูุนูู ูุน ุงูุดุจูุฉ ุนูู ูุณุชูู ุฃุนูู ุ ุจูุฌุฑุฏ ุฃู ููุฑุฑ LWIP ุฃูู ูู ุงูุถุฑูุฑู ุฅุฑุณุงู ุฑุณุงูุฉ ุฅูู ุงูุดุจูุฉ ุ ุณูุชู ุงุณุชุฏุนุงุก ูุธููุฉ ppp_output_cb () ุชููุงุฆููุง.  ุณูุชู ุชููู ุงุณุชุฌุงุจุฉ ูู ุงูุดุจูุฉ ุจูุงุณุทุฉ ูุธููุฉ PppGetTask () ุ ูุฌุฒุก ูู ูููุฉ ุฎุฏูุฉ ุงูุฑุณุงุฆู ุงููุงุฑุฏุฉ ุ ูุณูุชู ููููุง ุฅูู ุฃุญุดุงุก LWIP.  ุฅุฐุง ุชุบูุฑุช ุญุงูุฉ ุงูุงุชุตุงู ุ ูุณูุชู ุงุณุชุฏุนุงุก ูุธููุฉ ppp_link_status_cb () ุชููุงุฆููุง. <br><br>  ุฃุฎูุฑูุง ุ ุณูููู ุจุชุนุฏูู ูููุฉ StartDefaultTask.  ุงูุขู ูุฌุจ ุฃู ูุจุฏู ูุซู ูุฐุง: <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartDefaultTask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * argument)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* init code for LWIP */</span></span> <span class="hljs-comment"><span class="hljs-comment">// MX_LWIP_Init(); /* USER CODE BEGIN 5 */ usart_Open(); MX_LWIP_Init(); /* Infinite loop */ for(;;) { HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_SET); osDelay(1000); HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_RESET); osDelay(1000); } /* USER CODE END 5 */ }</span></span></code> </pre><br>  ุชู ุ ููููู ุชุฌููุน ูููุงุด. <br><br>  ุนูุฏ ูุฐู ุงูููุทุฉ ุ ุชุญุชุงุฌ ุฅูู ุจุฏุก ุฎุงุฏู PPP.  ููููุงู ุจุฐูู ุ ูุฌุจ ุนููู ุฃููุงู ูุดุฑ ุฌูุงุฒ ุงูุชุฑุงุถู ูุน Linux.  ุงุณุชุฎุฏูุช Ubuntu 16.04 x32.  ุจุนุฏ ุชุซุจูุช ูุธุงู ุงูุชุดุบูู ุ ุชุญุชุงุฌ ุฅูู ุชูููู ุงุณุชุฎุฏุงู ูููุฐ COM. <br><br>  ูู ูุฐุง ุงูุฌุฒุก ุ ูุง ูุญุชุงุฌ ุฅูู ุฌูุงุฒ ุงูุชุฑุงุถู ูุนูู ุจูุธุงู Windows ุ ูููููุง ุฅููุงู ุชุดุบููู ุจุฃูุงู.  ูุฑุจุท ููุงู ูู FT232 ูู Linux. <br><br>  ูู Linux ุ ูุจู ุงูุจุฏุก ูู ุงูุนูู ูุน ูููุฐ COM ุ ุชุญุชุงุฌ ุฅูู ุงูุณูุงุญ ูููุณุชุฎุฏู ุจุงุณุชุฎุฏุงูู.  ููููุงู ุจุฐูู ุ ูู ุจุชูููุฐ ุงูุฃูุฑ ุงูุชุงูู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sudo</span></span> addgroup USERNAME dialout</code> </pre> <br>  ุญูุซ USERNAME ูู ุงุณู ุงููุณุชุฎุฏู ุงูุญุงูู. <br><br>  ูุฑุคูุฉ ุงูููุงูุฐ ุงููุชููุฑุฉ ูู ูุธุงู COM ุ ุชุญุชุงุฌ ุฅูู ุชุดุบูู ุงูุฃูุฑ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs perl">dmesg | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> tty</code> </pre> <br><img src="https://habrastorage.org/webt/zc/h4/mp/zch4mpfwyybln76dl1jnhpxjt0s.png"><br><br>  ูุฑู ุฃู ููุงู ูููุฐูู ttyUSB ูู ุงููุธุงู.  ูุง ูููููุง ุฃู ูููู ุนูู ุงูููุฑ ุฃู ูุงุญุฏ ูู ุงููุณุฌู ูุฃู usart2.  ุชุญุชุงุฌ ููุท ุฅูู ุงูุชุญูู ูููุง ุจุฏูุฑูุง. <br><br>  ุฃููุงู ุ ูููุฐ ุงูุฃูุงูุฑ ููุฑุงุกุชูุง ูู ูููุฐ ูุงุญุฏ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">stty</span></span> -F /dev/ttyUSB0 <span class="hljs-number"><span class="hljs-number">115200</span></span> cat /dev/ttyUSB0</code> </pre> <br>  ุซู ูู ุฌูุฉ ุฃุฎุฑู: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">stty</span></span> -F /dev/ttyUSB1 <span class="hljs-number"><span class="hljs-number">115200</span></span> cat /dev/ttyUSB1</code> </pre> <br>  ุญูุซ ูุฑู ูุซู ูุฐู ุงูุตูุฑุฉ ุ ูุฐุง ูู ุงููุณุฌู. <br><br><img src="https://habrastorage.org/webt/u0/cu/zc/u0cuzcnbhzppwdhpibm2o6zelpk.png"><br><br>  ููููู ุชุฑู ูุฐู ุงููุงูุฐุฉ ุ ูู ูุฒุนุฌูุง. <br><br>  ุจุนุฏ ุฐูู ุ ุชุญุชุงุฌ ุฅูู ุงูุณูุงุญ ููุญุฒู ุงููุฑุณูุฉ ูู ูุฌูุณูุง ุจุชุฑู ุญุฏูุฏ ุงูุดุจูุฉ ุงููุฑุนูุฉ ุงูุฎุงุตุฉ ุจูู.  ููููุงู ุจุฐูู ุ ูู ุจุชูููู iptables.  ูููู ุจุชูููุฐ ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ: <br><br>  1. ุงูุชุญ ูุงูุฐุฉ ูุญุฏุฉ ุชุญูู ุฌุฏูุฏุฉ <br>  2. ุชุญุชุงุฌ ุฅูู ูุนุฑูุฉ ุนููุงู IP ุงูุฎุงุต ุจู ูุงุณู ูุงุฌูุฉ ุงูุดุจูุฉ (ูู ุจุชุดุบูู ุงูุฃูุฑ <b>ifconfig</b> ) <br><br><img src="https://habrastorage.org/webt/jy/d4/9s/jyd49satpc3erdlzeddi44gwcy4.png"><br><br>  3. ูู ุจุชุดุบูู ุฃูุงูุฑ ุงูุชูููู nat <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs powershell">sudo echo <span class="hljs-number"><span class="hljs-number">1</span></span> | sudo tee <span class="hljs-literal"><span class="hljs-literal">-a</span></span> /proc/sys/net/ipv4/ip_forward &gt; /dev/null sudo echo <span class="hljs-number"><span class="hljs-number">1</span></span> | sudo tee <span class="hljs-literal"><span class="hljs-literal">-a</span></span> /proc/sys/net/ipv4/ip_dynaddr &gt; /dev/null sudo iptables <span class="hljs-operator"><span class="hljs-operator">-F</span></span> FORWARD sudo iptables <span class="hljs-operator"><span class="hljs-operator">-F</span></span> <span class="hljs-literal"><span class="hljs-literal">-t</span></span> nat sudo iptables <span class="hljs-literal"><span class="hljs-literal">-t</span></span> nat <span class="hljs-literal"><span class="hljs-literal">-A</span></span> POSTROUTING <span class="hljs-literal"><span class="hljs-literal">-o</span></span> enp0s3 <span class="hljs-literal"><span class="hljs-literal">-j</span></span> SNAT -<span class="hljs-literal"><span class="hljs-literal">-to</span></span><span class="hljs-literal"><span class="hljs-literal">-source</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span>.<span class="hljs-number"><span class="hljs-number">10.196</span></span> sudo iptables <span class="hljs-literal"><span class="hljs-literal">-t</span></span> nat <span class="hljs-literal"><span class="hljs-literal">-L</span></span></code> </pre> <br>  ุญูุซ enp0s3 ูู ุงุณู ูุงุฌูุฉ ุงูุดุจูุฉ <br>  192.168.10.196 - ุนููุงู IP ุงูุฎุงุต ุจู <br>  / proc / sys / net / ipv4 / - ุงููุณุงุฑ ุฅูู ุงูููู ุงูููุงุจู. <br><br>  ูููู ุฅุนุงุฏุฉ ูุชุงุจุฉ ูุฐู ุงูุฃูุงูุฑ ูู ููู ุฏูุนู ูุชุดุบูููุง ูู ูู ูุฑุฉ ูุจู ุจุฏุก ุชุดุบูู ุฎุงุฏู PPP.  ููููู ุฅุถุงูุชู ุฅูู ุงูุชุดุบูู ุงูุชููุงุฆู ุ ูููู ูู ุฃูุนู ุฐูู. <br><br>  ุงูุขู ูุญู ุฌุงูุฒูู ูุจุฏุก ุงูุฎุงุฏู ุ ูุจูู ููุท ูุฅูุดุงุก ููู ุฅุนุฏุงุฏุงุช.  <b>ุฃุณููุชู</b> " <b>pppd.conf</b> " ุ ุฃูุชุฑุญ ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุชุงููุฉ: <br><br><pre style=";text-align:right;direction:rtl"> <code class="hljs pgsql">nodetach noauth passive <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> <span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.250</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> /dev/ttyUSB1 <span class="hljs-number"><span class="hljs-number">115200</span></span> lcp-echo-<span class="hljs-type"><span class="hljs-type">interval</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> lcp-echo-failure <span class="hljs-number"><span class="hljs-number">1</span></span> cdtrcts</code> </pre> <br>  ูุนูุฏ ูุชุงุจุฉ ุงูุฅุนุฏุงุฏุงุช ูู ููู ุซู ููููู ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู.  ูุชู ุฐูู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ <b>sudo pppd ./pppd.conf</b> <br><br>  ูุฌุจ ุฃู ูุจุฏุฃ ุฎุงุฏู PPPD ูุจู ุจุฏุก ุงูุงูุชุดุงู ุ ูุฐูู ุจุนุฏ ุจุฏุก PPPD ุชุญุชุงุฌ ุฅูู ุงูููุฑ ุนูู ุฒุฑ "ุฅุนุงุฏุฉ ุงูุถุจุท" ุงูููุฌูุฏ ุนูู ุงูููุญุฉ. <br><br>  ุฅุฐุง ููุช ุจูู ุดูุก ุจุดูู ุตุญูุญ ุ ุณุชุฑู ุงูุตูุฑุฉ ุงูุชุงููุฉ: <br><br><img src="https://habrastorage.org/webt/kv/-p/lj/kv-pljob3duk3bigzj3iazcsasa.png"><br><br>  ุชุดุบูู pppd ุนูู ุงููุณุงุฑ ุ ูุณุฌู ุนูู ุงููููู. <br><br><h3 style=";text-align:right;direction:rtl">  ุงููุฑุญูุฉ 4. ูุฑุณู ุญููุจุฉ </h3><br>  ูู ูุฐู ุงููุฑุญูุฉ ุ ูุญุชุงุฌ ุฅูู ููุง ุงูุฌูุงุฒูู ุงูุงูุชุฑุงุถููู.  ููููุณ ู pppd ููููุฏูุฒ ูุงุณุชูุงู ุงูุญุฒูุฉ.  ูุชุจุณูุท ุงููููุฉ ุ ูู ุงูุถุฑูุฑู ุฃู ูููู ููุง ุงูุฌูุงุฒูู ุนูู ููุณ ุงูุดุจูุฉ ุงููุฑุนูุฉ ุ ูุงูุญู ุงููุซุงูู ูู ุชุญุฏูุฏ ุงุชุตุงู ุฌุณุฑ ุงูุดุจูุฉ ูููุง ุงูุฌูุงุฒูู ูู ุฅุนุฏุงุฏุงุช ุดุจูุฉ VirtualBox ุ ูุชุนุทูู ุฌุฏุงุฑ ุงูุญูุงูุฉ ูู Windows. <br><br>  ูุจุฏุฃ ูู ุชุดุบูู ุงูุฃุฌูุฒุฉ ุงูุงูุชุฑุงุถูุฉ ูุชูููู ุงุชุตุงู ppp ูููุญุฉ ุงูุงูุชุดุงู ุจุงุณุชุฎุฏุงู pppd.  ูู ูุธุงู ุงูุชุดุบูู Windows ุ ุงูุชุดููุง ุนููุงู IP ุงูุฎุงุต ุจุงูุฌูุงุฒ (ุงูุฃูุฑ ipconfig) ุ ููุฏ ุญุตูุช ุนููู 192.168.10.97. <br><br>  ูู ุจุชุดุบูู Packet Sender ููู ุจุชููููู ููุง ููู: <br><br><img src="https://habrastorage.org/webt/k8/zt/uv/k8ztuv4eccjueyvlk8gigjbmkj0.png"><br><br>  ุงูุขู ูุฑุฉ ุฃุฎุฑู ุ ูู ุจุชุนุฏูู ูููุฉ StartDefaultTask ูู ููู main.c. <br><br><pre style=";text-align:right;direction:rtl"> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* USER CODE BEGIN 4 */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"logger.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"sockets.h"</span></span></span><span class="hljs-meta"> typedef uint32_t SOCKET; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* USER CODE END 4 */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* StartDefaultTask function */</span></span></span><span class="hljs-meta"> void StartDefaultTask(void const * argument) { </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/* init code for LWIP */</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// MX_LWIP_Init(); /* USER CODE BEGIN 5 */ usart_Open(); MX_LWIP_Init(); /* Infinite loop */ uint8_t sendStr[]="Test message TCP/IP."; uint8_t resvStr[100]={0}; int resvLength = 0; struct sockaddr_in sockAddr; sockAddr.sin_family = AF_INET; sockAddr.sin_port = htons( 6565 ); uint32_t addr = inet_addr("192.168.10.97"); sockAddr.sin_addr.s_addr = addr; SOCKET socket = NULL; int nError = 0; /* Infinite loop */ for(;;) { HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_SET); osDelay(1000); HAL_GPIO_WritePin(GPIOD, GPIO_PIN_12|GPIO_PIN_13|GPIO_PIN_14|GPIO_PIN_15, GPIO_PIN_RESET); osDelay(1000); socket = socket( AF_INET, SOCK_STREAM, 0 ); nError = connect( socket, (struct sockaddr*)&amp;sockAddr, sizeof(sockAddr) ); if ( nError == 0 ) { nError = send( socket, sendStr, sizeof(sendStr)-1, 0 ); if ( nError &lt; 0 ) logger("SEND ERROR %d\n", nError); else { logger("SEND - %s\n", sendStr); resvLength = 0; while(resvLength &lt; 1) resvLength = lwip_recv( socket, resvStr, sizeof(resvStr), MSG_WAITALL); resvStr[resvLength]=0; logger("GET - %s\n", resvStr); } lwip_close(socket); } else logger("CONNECT ERROR %d\n", nError); } /* USER CODE END 5 */ }</span></span></span></span></code> </pre><br>  ููููุฉ ููุชุบูุฑ addr ุ ูุณุชุฎุฏู ุนููุงู ุฌูุงุฒ Windows ุ ูููุฐ ุฑูู 6565. <br>  ุงูุฑุณุงูุฉ ุงููุฑุณูุฉ "ุงุฎุชุจุงุฑ ุงูุฑุณุงูุฉ TCP / IP" ุ ุฑุฏ "ุชู ุงุณุชูุงู ุงูุฑุณุงูุฉ". <br><br>  ููุง ููููู ุฃู ุชุฑู ุฃู ูุธุงุฆู PPP ูุง ุชุณุชุฎุฏู ูุจุงุดุฑุฉ ูุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู.  ุชุชู ุฌููุน ุงูุฃุนูุงู ุนูู ูุณุชูู ุฃุนูู ุ ููุชู ุงุณุชุฏุนุงุก ูุธุงุฆููุง ุชููุงุฆููุง. <br><br>  ูุญู ูุฌูุน ููููุถ. <br><br>  ุชุธูุฑ ูุชูุฌุฉ ุงูุงุชุตุงู ุจู pppd ุนูู ุฌูุงุฒ Linux: <br><br><img src="https://habrastorage.org/webt/il/og/h6/ilogh6wuak7zym8unedcnddcjr4.png"><br><br>  ูููู ุฑุคูุฉ ุงูุทูุจุงุช ุงููุณุชููุฉ ูุงูุฑุฏูุฏ ุงููุฑุณูุฉ ูู ุจุฑูุงูุฌ Packet Sender ุนูู ุฌูุงุฒ Windows: <br><br><img src="https://habrastorage.org/webt/30/yh/4m/30yh4m_l52nvlkdixrv9zmivehc.png"><br><br>  ุญุณููุง ุ ูุฐุง ูู ุดูุก ุ ุงูุญุฒูุฉ ุงูุชู ุฃุฑุณููุงูุง ูู ููุญุฉ ุงูุงูุชุดุงู ุฐูุจุช ุฅูู ูููุฐ COM ุ ูุตูุช ุฅูู ุฎุงุฏู pppd ุ ุชู ุฅุฑุณุงููุง ุฅูู ูููุฐ Windows 6565 ููุฌูุงุฒ ุ ููุงู ุชู ุงุณุชูุงููุง ุจูุฌุงุญ ุ ุฑุฏูุง ุนูู ุฐูู ุชู ุฅุฑุณุงู ุญุฒูุฉ ุฃุฎุฑู ุงุฌุชุงุฒุช ูุฐุง ุงูุทุฑูู ูู ุงูุงุชุฌุงู ุงููุนุงูุณ ูุชู ุงุนุชูุงุฏู ุจูุฌุงุญ ุนูู ุงูุณุจูุฑุฉ.  ูุฏ ุชุชููู ุฃูุถูุง ูู ุฅุฑุณุงู ุฑุณุงุฆู ุฅูู ุฃู ุฌูุงุฒ ุนูู ุงูุฅูุชุฑูุช. <br><br>  โ ูููู ุชุญููู ููุฏ ุงููุดุฑูุน ุงููุงูู <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=ar&amp;u=">ููุง</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/ar419037/">https://habr.com/ru/post/ar419037/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../ar419025/index.html">ุชุฌููุนPythonetc ุ ููููู 2018</a></li>
<li><a href="../ar419027/index.html">ุฃูู ุงููุนูููุงุช ูููุฏููุนุงุช ุงููุตุฑููุฉ ุบูุฑ ุงูููุฏูุฉ. ุงูุฌุฒุก 6 - ุชุญููู ุงูุฌุฑุงุฆู ุงููุตุฑููุฉ</a></li>
<li><a href="../ar419029/index.html">ุฃุตุจุญุช Fortnite ุธุงูุฑุฉ ุงุฌุชูุงุนูุฉ. ูููู ุงูุขุจุงุก ุจุดูู ูุชุฒุงูุฏ ุจุชูุธูู ุงููุฏุฑุจูู ูุฃุทูุงููู ูุงููุนุจ ูุนูู</a></li>
<li><a href="../ar419033/index.html">ููุงุญุธุฉ ุตุบูุฑุฉ ุญูู ููุถูุน ุชุดุบูู vue.js ูู ูุฌููุนุฉ kubernetes</a></li>
<li><a href="../ar419035/index.html">ูุชุงุจ โHead First Agile. ุฅุฏุงุฑุฉ ูุฑูุฉ ูููุดุฑูุน "</a></li>
<li><a href="../ar419041/index.html">ุชุณุน ูุดุงูุงุช ุงููุทุงุทูุฉ ุงูุชู ุฎุทูุช ุนูููุง</a></li>
<li><a href="../ar419043/index.html">ูุดููุฉ ุชูููุช ุงูุฅุทุงุฑ ุงููุฑุงูุบ</a></li>
<li><a href="../ar419047/index.html">ุชู ุงุฎุชุฑุงู ูุงุนุฏุฉ ุจูุงูุงุช Reddit ุ ูุงูุชู ุชู ุชุณุฑูุจูุง ุจุงุณุชุฎุฏุงู ูููุงุช ุงููุฑูุฑ ูุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุชุฑุฉ 2005-2007</a></li>
<li><a href="../ar419049/index.html">GeekBrains ุชุทูู ูุงุฑุงุซูููุง ุชุนูููููุง ูุฌุงูููุง ุนุจุฑ ุงูุฅูุชุฑูุช ูุฌุงูููุง</a></li>
<li><a href="../ar419051/index.html">ููู ูุณุงุนุฏ Flant ุงููุจุชุฏุฆูู</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>