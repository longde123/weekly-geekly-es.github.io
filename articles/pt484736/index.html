<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚õ™Ô∏è üå®Ô∏è üö¥üèø Linux: removendo o conjunto de bloqueios / dev / random üìç üå∑ üèñÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Como voc√™ sabe, / dev / random, um gerador de n√∫meros pseudo-aleat√≥rios criptograficamente fortes (CSPRNG), tem um problema desagrad√°vel - o bloqueio....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Linux: removendo o conjunto de bloqueios / dev / random</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/ua-hosting/blog/484736/"> Como voc√™ sabe, / dev / random, um gerador de n√∫meros pseudo-aleat√≥rios criptograficamente fortes (CSPRNG), tem um problema desagrad√°vel - o bloqueio.  Este artigo descreve como resolv√™-lo. <br><br>  Nos √∫ltimos meses, os meios de gerar n√∫meros aleat√≥rios no kernel foram ligeiramente reformulados, mas os problemas nesse subsistema foram resolvidos em um <a href="https://lwn.net/Kernel/Index/">per√≠odo</a> mais amplo.  As <a href="https://lwn.net/Articles/802360/">altera√ß√µes</a> mais <a href="https://lwn.net/Articles/802360/">recentes</a> foram feitas para impedir que a chamada do sistema getrandom () seja bloqueada por um longo tempo durante a inicializa√ß√£o do sistema, mas a raz√£o por tr√°s disso foi o comportamento do pool aleat√≥rio de bloqueio.  Um patch recente removeria esse pool e era de se esperar que fosse para o n√∫cleo principal. <br><br>  Andy Lutomirski lan√ßou a terceira vers√£o do patch no final de dezembro.  Faz <i>"duas altera√ß√µes sem√¢nticas b√°sicas nas APIs aleat√≥rias do Linux"</i> .  O patch adiciona o novo sinalizador GRND_INSECURE √† chamada do sistema getrandom () (embora Lutomirsky se refira a ele como getentropy (), que √© implementado no glibc usando getrandom () com sinalizadores fixos);  esse sinalizador for√ßa a chamada a sempre retornar a quantidade de dados solicitados, mas sem garantir que os dados sejam aleat√≥rios.  O kernel simplesmente far√° o poss√≠vel para fornecer os melhores dados aleat√≥rios que possui em um determinado momento.  <i>‚ÄúProvavelmente a melhor coisa que voc√™ pode fazer √© cham√°-lo de‚Äú INSEGURO ‚Äù</i> (inseguro) para impedir que seja usado para coisas que precisam de seguran√ßa.‚Äù <a name="habracut"></a><br><br>  Os patches tamb√©m removem o pool de bloqueio.  Atualmente, o kernel suporta dois conjuntos de dados aleat√≥rios, um dos quais corresponde a / dev / random e o outro a / dev / urandom, conforme descrito neste <a href="https://lwn.net/Articles/658497/">artigo de</a> 2015.  Um pool de bloqueio √© um pool para / dev / random;  a leitura deste dispositivo ser√° bloqueada (ou seja, seu nome) at√© que a entropia "suficiente" seja coletada do sistema para atender √† solicita√ß√£o.  Leituras adicionais deste arquivo tamb√©m ser√£o bloqueadas se n√£o houver entropia suficiente no pool. <br><br>  A remo√ß√£o do conjunto de bloqueios significa que a leitura de / dev / random se comporta como getrandom () com o valor de sinalizadores definido como zero (e transforma o sinalizador GRND_RANDOM em noop).  Ap√≥s inicializar o gerador de n√∫meros aleat√≥rios criptogr√°ficos (CRNG), a leitura de / dev / random e a chamada getrandom (..., 0) n√£o ser√£o bloqueadas e retornar√£o a quantidade solicitada de dados aleat√≥rios. <br><br>  Lutomirsky diz: <i>‚ÄúEu acredito que o pool de bloqueio do Linux se tornou obsoleto.</i>  <i>O CRNG Linux gera uma sa√≠da que √© boa o suficiente para usar, mesmo na gera√ß√£o de chaves.</i>  <i>O pool de bloqueio n√£o √© mais forte em nenhum sentido material e requer muita infraestrutura de valor duvidoso para mant√™-lo. ‚Äù</i> <br><br>  As mudan√ßas foram feitas com o objetivo de garantir que os programas existentes n√£o sofram realmente e, de fato, os problemas com a longa espera por coisas como gerar chaves do GnuPG se tornar√£o menores. <br><br>  <i>‚ÄúEssas s√©ries n√£o devem violar nenhum programa existente.</i>  <i>/ dev / urandom permanece inalterado.</i>  <i>/ dev / random ainda bloqueia imediatamente ap√≥s o carregamento, mas bloqueia menos que antes.</i>  <i>getentropy () com sinalizadores existentes retornar√° um resultado que ser√° t√£o pr√°tico para a finalidade quanto antes. ‚Äù</i> <br><br>  Lutomirsky observou que permanece em aberto a quest√£o de saber se o n√∫cleo deve fornecer os chamados "n√∫meros aleat√≥rios verdadeiros", que at√© certo ponto deveriam ter sido feitos pelo n√∫cleo de bloqueio.  Ele v√™ apenas uma raz√£o para isso: "conformidade com os padr√µes do estado".  Lutomirsky sugeriu que, se o kernel fornecer isso, isso deve ser feito por meio de uma interface completamente diferente ou deve ser transferido para o espa√ßo do usu√°rio, permitindo recuperar padr√µes de eventos n√£o processados ‚Äã‚Äãque podem ser usados ‚Äã‚Äãpara criar um pool de bloqueios. <br><br>  Stephan M√ºller sugeriu que seu conjunto de <a href="https://lwn.net/ml/linux-kernel/2722222.P16TYeLAVu%40positron.chronox.de/">patches</a> para o gerador de n√∫meros aleat√≥rios do Linux (LRNG) (a vers√£o 26 est√° atualmente liberada) pode ser uma maneira de fornecer n√∫meros aleat√≥rios verdadeiros para aplicativos que precisam dele.  O LRNG "cumpre totalmente os requisitos das" Recomenda√ß√µes sobre as fontes de entropia usadas para gerar bits aleat√≥rios "SP800-90B", o que o torna uma solu√ß√£o para o problema dos padr√µes estaduais. <br>  Matthew Garrett op√¥s-se ao termo "dados aleat√≥rios verdadeiros", observando que dispositivos selecion√°veis ‚Äã‚Äãpodem, em princ√≠pio, ser modelados com precis√£o suficiente para torn√°-los previs√≠veis: "n√£o estamos recebendo eventos qu√¢nticos aqui". <br><br>  Muller respondeu que o termo vem do padr√£o alem√£o AIS 31 para descrever um gerador de n√∫meros aleat√≥rios que produz apenas o resultado "na mesma velocidade que a fonte de ru√≠do subjacente produz entropia". <br><br>  Al√©m dos mal-entendidos da terminologia, a presen√ßa de um pool de bloqueios, conforme sugerido pelos patches do LRNG, simplesmente levar√° a v√°rios problemas, pelo menos se estiver dispon√≠vel sem privil√©gios. <br><br>  Como Lutomirsky disse: <i>‚ÄúIsso n√£o resolve o problema.</i>  <i>Se dois usu√°rios diferentes executam programas est√∫pidos, como o gnupg, eles simplesmente se esgotam.</i>  <i>Vejo que atualmente existem dois problemas principais com / dev / random: ele √© suscet√≠vel a DoS (ou seja, esgotamento de recursos, influ√™ncias prejudiciais ou algo semelhante) e, como n√£o requer privil√©gios para us√°-lo, tamb√©m sujeito a abuso.</i>  <i>Gnupg est√° errado, √© um colapso completo.</i>  <i>Se adicionarmos uma nova interface n√£o privilegiada que o gnupg e programas similares usar√£o, perderemos novamente. ‚Äù</i> <br><br>  Muller observou que a adi√ß√£o de getrandom () agora permitir√° que o GnuPG use essa interface, pois fornecer√° a garantia necess√°ria de que o pool foi inicializado.  Com base nas discuss√µes com o desenvolvedor do GnuPG Werner Koch, Muller acredita que a garantia √© a √∫nica raz√£o pela qual o GnuPG atualmente l√™ diretamente em / dev / random.  Mas se houver uma interface sem privil√©gios que esteja sujeita a uma nega√ß√£o de servi√ßo (a partir de hoje / dev / random), ent√£o, de acordo com Lutomirsky, ela ser√° mal utilizada por alguns aplicativos. <br><br>  Theodore Yue Tak Ts'o, o desenvolvedor do subsistema de n√∫meros aleat√≥rios do Linux, parece ter mudado de id√©ia sobre a necessidade de um pool de bloqueio.  Ele disse que a exclus√£o desse pool eliminaria efetivamente a id√©ia de que o Linux tem um verdadeiro gerador de n√∫meros aleat√≥rios (TRNG): <i>"isso n√£o √© bobagem, pois √© exatamente isso que o * BSD sempre fez".</i> <br><br>  Ele tamb√©m est√° preocupado com o fato de que o fornecimento do mecanismo TRNG sirva simplesmente de chamariz para os desenvolvedores de aplicativos e acredita que, na realidade, considerando os v√°rios tipos de hardware suportados pelo Linux, n√£o √© poss√≠vel garantir o TRNG no kernel.  Mesmo a capacidade de trabalhar com equipamentos baseados em privil√©gios de root n√£o resolver√° o problema: <i>‚ÄúOs desenvolvedores de aplicativos especificam que seus aplicativos sejam instalados como raiz por raz√µes de seguran√ßa, porque esta √© a √∫nica maneira de acessar n√∫meros aleat√≥rios‚Äú realmente bons ‚Äù‚Äù.</i> <br><br>  Muller perguntou se Cao se recusara a implementar o pool de bloqueio, que ele pr√≥prio havia proposto h√° muito tempo.  Cao respondeu que planejava usar os patches de Lutomirsky e se op√¥s ativamente a adicionar uma interface de bloqueio ao kernel. <br><br>  <i>‚ÄúO kernel n√£o pode dar nenhuma garantia sobre se a fonte de ru√≠do foi adequadamente caracterizada.</i>  <i>A √∫nica coisa que um desenvolvedor de GPG ou OpenSSL pode obter √© a vaga sensa√ß√£o de que o TRUERANDOM √© "melhor" e, como eles querem mais seguran√ßa, sem d√∫vida tentar√£o us√°-lo.</i>  <i>Em algum momento, ele ser√° bloqueado e, quando outro usu√°rio inteligente (talvez um especialista em distribui√ß√£o) o inserir no script init e os sistemas pararem de funcionar, os usu√°rios ter√£o apenas que reclamar com o pr√≥prio Linus Torvalds. ‚Äù</i> <br><br>  Cao tamb√©m defende fornecer aos criptografadores e √†queles que realmente precisam do TRNG uma maneira de coletar sua pr√≥pria entropia no espa√ßo do usu√°rio, para que possam us√°-lo como entenderem.  Ele diz que a coleta de entropia n√£o √© um processo que pode ser executado pelo kernel em todos os tipos de hardware suportados por ele; al√©m disso, o pr√≥prio kernel n√£o pode estimar a quantidade de entropia fornecida por v√°rias fontes. <br><br>  <i>‚ÄúO kernel n√£o deve misturar diferentes fontes de ru√≠do e, √© claro, n√£o deve tentar afirmar que sabe quantos bits de entropia recebe quando tenta executar algum tipo de‚Äú jogo brusco de entropia ‚Äùem uma arquitetura de CPU simples para o usu√°rio feio. "Casos IOT / Embutidos, quando tudo est√° fora de sincronia com um √∫nico gerador mestre, quando n√£o h√° instru√ß√µes da CPU para reordenar ou renomear o registro, etc."</i> <i><br><br></i>  <i>‚ÄúPodemos falar sobre o fornecimento de ferramentas que tentam fazer esses c√°lculos, mas essas coisas devem ser realizadas no equipamento de cada usu√°rio, o que para a maioria dos usu√°rios do kit de distribui√ß√£o √© simplesmente impratic√°vel.</i>  <i>Se isso for destinado apenas a criptografadores, fa√ßa-o no espa√ßo do usu√°rio.</i>  <i>E n√£o vamos simplificar o GPG, o OpenSSL etc., para que todos digam: "queremos" verdadeira aleatoriedade "e n√£o concordemos com nada menos".</i>  <i>Podemos falar sobre como fornecemos interfaces para os criptografadores, para que eles possam obter as informa√ß√µes necess√°rias atrav√©s do acesso a fontes de ru√≠do prim√°rias, separadas e nomeadas e, possivelmente, de alguma forma, a fonte de ru√≠do pode se autenticar em uma biblioteca ou aplicativo de espa√ßo do usu√°rio. ‚Äù</i> <br><br>  Houve uma pequena discuss√£o sobre como essa interface pode parecer, porque, por exemplo, para alguns eventos, pode haver implica√ß√µes de seguran√ßa.  Cao observou que os c√≥digos de verifica√ß√£o do teclado (ou seja, pressionamentos de tecla) s√£o misturados no pool como parte da cole√ß√£o de entropia: "Transferir isso para o espa√ßo do usu√°rio, mesmo atrav√©s de uma chamada privilegiada do sistema, seria pelo menos irracional".  √â poss√≠vel que outros tempos de eventos possam criar algum tipo de vazamento de informa√ß√µes atrav√©s dos canais laterais. <br><br>  Portanto, parece que o problema de longa data do subsistema de n√∫meros aleat√≥rios do Linux est√° a caminho de uma solu√ß√£o.  As mudan√ßas pelas quais o subsistema de n√∫meros aleat√≥rios passou recentemente, de fato, levaram apenas a problemas de DoS no processo de seu uso.  Agora, existem maneiras eficazes de obter os melhores n√∫meros aleat√≥rios que o kernel pode fornecer.  Se o TRNG ainda for desej√°vel para o Linux, essa falha precisar√° ser resolvida no futuro, mas provavelmente n√£o ser√° feita dentro do pr√≥prio kernel. <br><br><h3>  Um pouco de publicidade :) </h3><br>  Obrigado por ficar conosco.  Voc√™ gosta dos nossos artigos?  Deseja ver materiais mais interessantes?  Ajude-nos fazendo um pedido ou recomendando aos seus amigos <a href="https://ua-hosting.company/cloudvps/nl">VPS baseado em nuvem para desenvolvedores a partir de US $ 4,99</a> , um <b>anal√≥gico exclusivo de servidores</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">b√°sicos</a> <b>que foi inventado por n√≥s para voc√™:</b> <a href="https://habr.com/company/ua-hosting/blog/347386/">Toda a verdade sobre o VPS (KVM) E5-2697 v3 (6 n√∫cleos) 10GB DDR4 480GB SSD 1Gbps de 10GB de US $ 19 ou como dividir o servidor?</a>  (as op√ß√µes est√£o dispon√≠veis com RAID1 e RAID10, at√© 24 n√∫cleos e at√© 40GB DDR4). <br><br>  <b>Dell R730xd 2 vezes mais barato no data center Equinix Tier IV em Amsterd√£?</b>  Somente temos <b><a href="https://ua-hosting.company/serversnl">2 TVs Intel TetraDeca-Core Xeon 2x E5-2697v3 2.6GHz 14C 64GB DDR4 4x960GB SSD 1Gbps 100 TV a partir de US $ 199</a> na Holanda!</b>  <b><b>Dell R420 - 2x E5-2430 2.2Ghz 6C 128GB DDR3 2x960GB SSD 1Gbps 100TB - a partir de US $ 99!</b></b>  Leia sobre <a href="https://habr.com/company/ua-hosting/blog/329618/">Como criar um pr√©dio de infraestrutura.</a>  <a href="https://habr.com/company/ua-hosting/blog/329618/">classe usando servidores Dell R730xd E5-2650 v4 custando 9.000 euros por um centavo?</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt484736/">https://habr.com/ru/post/pt484736/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt484724/index.html">Not√≠cias do mundo do OpenStreetMap n¬∫ 494 (31.12.2019-06.01.2020)</a></li>
<li><a href="../pt484728/index.html">Cliente misterioso do CityMobile</a></li>
<li><a href="../pt484730/index.html">Dell Inspiron 7490: laptop de metal leve para todos os dias com excelente autonomia</a></li>
<li><a href="../pt484732/index.html">O que √© o VMware e por que √© importante a compatibilidade com SSDs?</a></li>
<li><a href="../pt484734/index.html">O que poderia ter sido apresentado na CES nos s√©culos XIX e XX</a></li>
<li><a href="../pt484738/index.html">Passo a passo de integra√ß√£o cont√≠nua para o Laravel 6 no Google Cloud Run</a></li>
<li><a href="../pt484740/index.html">Semana 04 de seguran√ßa: problemas de criptografia no Windows 10</a></li>
<li><a href="../pt484744/index.html">Como eu fiz sombras 2D no Unity</a></li>
<li><a href="../pt484750/index.html">Esquizofrenia: um cuidado</a></li>
<li><a href="../pt484752/index.html">Escrever um driver de laptop para divers√£o e lucro ou Como se comprometer com o kernel, mesmo que voc√™ n√£o seja t√£o inteligente</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>