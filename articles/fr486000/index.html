<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∏ üïï üêÅ ADSM3. Syst√®mes IPAM / DCIM ‚ÑπÔ∏è üç∫ üî¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans la s√©rie ADSM pr√©c√©dente, nous avons d√©velopp√© le cadre d'automatisation, compris pourquoi la virtualisation est apparue et comment elle fonction...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ADSM3. Syst√®mes IPAM / DCIM</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/486000/"> Dans la s√©rie ADSM pr√©c√©dente, nous avons d√©velopp√© le cadre d'automatisation, compris pourquoi la virtualisation est apparue et comment elle fonctionne.  Dans la <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">derni√®re partie,</a> nous avons s√©lectionn√© et justifi√© la conception du r√©seau, les r√¥les des appareils, des fabricants, d√©cid√©s du LLD (adressage, routage, nombre de syst√®mes autonomes). <br><br>  Nous sommes maintenant pr√™ts √† r√©fl√©chir √† la fa√ßon de stocker toute cette montagne d'informations, puis de les r√©cup√©rer facilement. <br><br>  Non, bien s√ªr, il existe aujourd'hui des entreprises qui gardent une trace des adresses IP attribu√©es dans une feuille de calcul Excel.  Mais ce n'est pas notre chemin. <br><br>  M√™me pour les bureaux de plus petite taille dans quelques succursales, la pr√©sence d'un syst√®me de gestion centralis√©e de l'espace IP ne nuira pas. <br><br>  La n√©cessit√© d'un syst√®me d'inventaire est √©vidente sans un mot. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b44/a21/5cc/b44a215cc7c93ecf6eeca48c41d721d9.svg" width="800"><br><br>  Tous les num√©ros de l'ADSM: <br><br>  <a href="https://habr.com/ru/post/453516/">0. ADSM.</a>  <a href="https://habr.com/ru/post/453516/">Partie z√©ro.</a>  <a href="https://habr.com/ru/post/453516/">Planification</a> <br>  <a href="https://habr.com/ru/post/458622/">1. ADSM.</a>  <a href="https://habr.com/ru/post/458622/">Premi√®re partie (qui est apr√®s z√©ro).</a>  <a href="https://habr.com/ru/post/458622/">Virtualisation du r√©seau</a> <br>  <a href="https://habr.com/ru/post/475614/">2. ADSM.</a>  <a href="https://habr.com/ru/post/475614/">Deuxi√®me partie.</a>  <a href="https://habr.com/ru/post/475614/">Conception du r√©seau</a> <br>  <a href="https://habr.com/ru/post/485618/">3. ADSM.</a>  <a href="https://habr.com/ru/post/485618/">Troisi√®me partie.</a>  <a href="https://habr.com/ru/post/485618/">Syst√®me IPAM / DCIM</a> <br><br>  Je vais consacrer cette question aux syst√®mes int√©gr√©s dans l'automatisation des r√©seaux - le syst√®me de gestion de l'espace d'adressage et le syst√®me d'inventaire. <br><br>  Nous le s√©lectionnerons et l'installerons, nous traiterons de l'architecture, du sch√©ma de la base de donn√©es, des interfaces d'interaction et le remplirons.  Et dans les parties suivantes, nous allons commencer √† √©crire des scripts simples qui automatisent les op√©rations r√©p√©titives, comme l'ajout de nouveaux racks. <br><br>  De plus, j'ai d√©j√† publi√© un article s√©par√© sur l' <a href="https://habr.com/ru/post/485618/">API RESTful</a> , dans lequel j'ai fait un bref examen de ses principes et de son travail, nous en aurons besoin. <br><a name="habracut"></a><br><h1>  Table des mati√®res </h1><br><ul><li>  <b>Architecture du syst√®me</b> </li><li>  <b>Sch√©ma de donn√©es NetBox</b> </li><li>  <b>Conclusion</b> </li><li>  <b>Quelques nuances d'installation de NetBox</b> </li><li>  <b>Un peu sur PostgreSQL</b> </li><li>  <b>Liens utiles</b> </li></ul><br>  Aujourd'hui, le march√© propose une dizaine d'outils qui mettent en ≈ìuvre cette t√¢che: √† la fois payants et Open Source. <br><br>  Pour les t√¢ches de cette s√©rie d'articles, j'ai choisi NetBox pour les raisons suivantes: <br><br><ol><li>  C'est gratuit </li><li>  Il contient les deux parties n√©cessaires - l'inventaire et la gestion de l'espace IP. </li><li>  Il a une API RESTful. </li><li>  Il a √©t√© d√©velopp√© par Digital Ocean (et plus particuli√®rement, aim√© de tout le monde Jeremy Stretch) pour lui-m√™me, c'est-√†-dire pour les centres de donn√©es.  Par cons√©quent, il y a presque tout ce dont vous avez besoin, et presque rien de plus. </li><li>  Il est activement pris en charge (Slack, Github, Google Newsletters) et est en cours de mise √† jour. </li><li>  C'est open source </li></ol><br><blockquote>  Pour les besoins de l'ADSM, j'ai d√©ploy√© NetBox dans une virtualochka sur notre serveur (merci √† Anton Klochkov et <a href="https://miran.ru/" rel="nofollow">Miran</a> ): <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">http://netbox.linkmeup.ru:45127</a> <br>  De plus, j'ai rempli presque toutes les donn√©es dont nous aurons besoin √† l'avenir. <br>  Par cons√©quent, vous pouvez essayer presque tous les exemples et √©tudier le sch√©ma de donn√©es en mode lecture jusqu'√† ce que vous d√©ployiez votre installation. <br></blockquote>  Un peu utile avant de commencer: <br><br><ul><li>  <a href="https://github.com/netbox-community/netbox" rel="nofollow">NetBox lui-m√™me sur github</a> </li><li>  <a href="https://github.com/netbox-community/netbox-docker" rel="nofollow">Version conteneur</a> </li><li>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Instructions d'installation compl√®tes et toute la documentation produit</a> </li><li>  <a href="https://github.com/digitalocean/pynetbox" rel="nofollow">SDK Python NetKox</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/api/docs/" rel="nofollow">Documentation API</a> </li><li>  <a href="https://groups.google.com/forum/" rel="nofollow">Liste de diffusion</a> </li><li>  <a href="https://networktocode.slack.com/" rel="nofollow">NetworkToCode Slack Channel</a> </li><li>  <a href="https://habr.com/ru/post/485618/">Qu'est-ce que REST?</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">Installation de NetBox pour ADSM</a> </li></ul><br><hr><br><h1>  Architecture du syst√®me </h1><br><ul><li>  NetBox est √©crit en Python3.  Ce qui est bien, car un certain nombre d'autres solutions sont √©crites en php et les changer si n√©cessaire n'est pas si simple. </li><li>  Le cadre du site lui-m√™me est Django. </li><li>  PostgreSQL est utilis√© comme base de donn√©es. </li><li>  WEB-frontend (service HTTP) - NGINX - il envoie des requ√™tes par procuration √† Gunicron. </li><li>  WSGI - Gunicorn - l'interface entre Nginx et l'application elle-m√™me. </li><li>  Cadre de documentation de l'API - Swagger. </li><li>  Pour diaboliser NetBox - Systemd. </li></ul><br><blockquote>  NetBox est un projet jeune et rapide.  Par exemple, dans 2.7, ils ont abandonn√© supervisord et Python 2.7 pour atteindre en faveur de systemd.  Il n'y a pas si longtemps, il n'y avait ni mise en cache ni Webhook. <br><br>  Par cons√©quent, tout change rapidement et les informations contenues dans l'article peuvent devenir obsol√®tes au moment de la lecture. <br></blockquote><br>  En d'autres termes, tous les composants sont matures et test√©s. <br><br>  Selon l'auteur, NetBox ne refl√®te pas l'√©tat r√©el du r√©seau, mais la cible.  Par cons√©quent, rien n'est charg√© dans la NetBox √† partir du r√©seau - ce r√©seau est configur√© conform√©ment au contenu de la NetBox. <br>  Ainsi, NetBox agit comme la seule source de v√©rit√© (papier calque avec source unique de v√©rit√©). <br><br>  Et les modifications sur le r√©seau doivent √™tre d√©clench√©es par des modifications de la NetBox. <br><br>  Et cela correspond tr√®s bien √† l'id√©ologie que je professe dans cette s√©rie d'articles - si vous voulez faire des changements sur le r√©seau - faites-les d'abord dans le syst√®me. <br><br><hr><br><h1>  Sch√©ma de donn√©es NetBox </h1><br>  Les deux t√¢ches principales que NetBox r√©sout sont la gestion de l'espace d'adressage et l'inventaire. <br><br>  NetBox est peu susceptible de devenir le seul syst√®me d'inventaire de l'entreprise; il s'agira plut√¥t d'un syst√®me suppl√©mentaire sp√©cifique pour inventorier le r√©seau, en prenant les donn√©es du principal. <br><br>  √âvidemment, dans notre cas, il n'y aura que NetBox √† des fins ADSM. <br><blockquote>  √Ä ce stade, la plupart des donn√©es initiales dans NetBox ont d√©j√† √©t√© entr√©es. <br>  Sur ces donn√©es, je vais d√©montrer divers exemples de travail via l'API. <br>  Vous pouvez simplement grimper et voir: <a href="http://netbox.linkmeup.ru/" rel="nofollow">netbox.linkmeup.ru</a> : 45127 <br>  Et les m√™mes donn√©es seront n√©cessaires √† l'avenir, lorsque nous passerons √† l'automatisation. <br></blockquote>  De mani√®re g√©n√©rale, le sch√©ma de donn√©es peut √™tre vu par le sch√©ma de base de donn√©es dans Postgres. <br><br><pre><code class="bash hljs">List of relations Schema | Name | Type | Owner --------+------------------------------------+-------+-------- public | auth_group | table | netbox public | auth_group_permissions | table | netbox public | auth_permission | table | netbox public | auth_user | table | netbox public | auth_user_groups | table | netbox public | auth_user_user_permissions | table | netbox public | circuits_circuit | table | netbox public | circuits_circuittermination | table | netbox public | circuits_circuittype | table | netbox public | circuits_provider | table | netbox public | dcim_cable | table | netbox public | dcim_consoleport | table | netbox public | dcim_consoleporttemplate | table | netbox public | dcim_consoleserverport | table | netbox public | dcim_consoleserverporttemplate | table | netbox public | dcim_device | table | netbox public | dcim_devicebay | table | netbox public | dcim_devicebaytemplate | table | netbox public | dcim_devicerole | table | netbox public | dcim_devicetype | table | netbox public | dcim_frontport | table | netbox public | dcim_frontporttemplate | table | netbox public | dcim_interface | table | netbox public | dcim_interface_tagged_vlans | table | netbox public | dcim_interfacetemplate | table | netbox public | dcim_inventoryitem | table | netbox public | dcim_manufacturer | table | netbox public | dcim_platform | table | netbox public | dcim_powerfeed | table | netbox public | dcim_poweroutlet | table | netbox public | dcim_poweroutlettemplate | table | netbox public | dcim_powerpanel | table | netbox public | dcim_powerport | table | netbox public | dcim_powerporttemplate | table | netbox public | dcim_rack | table | netbox public | dcim_rackgroup | table | netbox public | dcim_rackreservation | table | netbox public | dcim_rackrole | table | netbox public | dcim_rearport | table | netbox public | dcim_rearporttemplate | table | netbox public | dcim_region | table | netbox public | dcim_site | table | netbox public | dcim_virtualchassis | table | netbox public | django_admin_log | table | netbox public | django_content_type | table | netbox public | django_migrations | table | netbox public | django_session | table | netbox public | extras_configcontext | table | netbox public | extras_configcontext_platforms | table | netbox public | extras_configcontext_regions | table | netbox public | extras_configcontext_roles | table | netbox public | extras_configcontext_sites | table | netbox public | extras_configcontext_tags | table | netbox public | extras_configcontext_tenant_groups | table | netbox public | extras_configcontext_tenants | table | netbox public | extras_customfield | table | netbox public | extras_customfield_obj_type | table | netbox public | extras_customfieldchoice | table | netbox public | extras_customfieldvalue | table | netbox public | extras_customlink | table | netbox public | extras_exporttemplate | table | netbox public | extras_graph | table | netbox public | extras_imageattachment | table | netbox public | extras_objectchange | table | netbox public | extras_reportresult | table | netbox public | extras_tag | table | netbox public | extras_taggeditem | table | netbox public | extras_webhook | table | netbox public | extras_webhook_obj_type | table | netbox public | ipam_aggregate | table | netbox public | ipam_ipaddress | table | netbox public | ipam_prefix | table | netbox public | ipam_rir | table | netbox public | ipam_role | table | netbox public | ipam_service | table | netbox public | ipam_service_ipaddresses | table | netbox public | ipam_vlan | table | netbox public | ipam_vlangroup | table | netbox public | ipam_vrf | table | netbox public | secrets_secret | table | netbox public | secrets_secretrole | table | netbox public | secrets_secretrole_groups | table | netbox public | secrets_secretrole_users | table | netbox public | secrets_sessionkey | table | netbox public | secrets_userkey | table | netbox public | taggit_tag | table | netbox public | taggit_taggeditem | table | netbox public | tenancy_tenant | table | netbox public | tenancy_tenantgroup | table | netbox public | users_token | table | netbox public | virtualization_cluster | table | netbox public | virtualization_clustergroup | table | netbox public | virtualization_clustertype | table | netbox public | virtualization_virtualmachine | table | netbox</code> </pre> <br>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Caract√©ristiques de NetBox</a> : <br><br><ul><li>  <b>Gestion des adresses IP (IPAM)</b> - Pr√©fixes IP, adresses, VRF et VLAN </li><li>  <b>Supports d'√©quipement</b> - <b>Supports d'√©quipement</b> organis√©s par site, groupe et r√¥le </li><li>  <b>Appareils</b> - Appareils, leurs mod√®les, r√¥les, composants et d√©ploiement </li><li>  <b>Connexions</b> - <b>Connexions</b> r√©seau, console et alimentation entre les appareils </li><li>  <b>Virtualisation</b> - Machines virtuelles et clusters de calcul </li><li>  <b>Circuits de donn√©es</b> - Connexions des fournisseurs </li><li>  <b>Secrets</b> - Stockage des informations d'identification de l'utilisateur crypt√© </li></ul><br>  Dans cet article, je vais aborder les choses suivantes: DCIM - Gestion de l'infrastructure du centre de donn√©es, IPAM - Gestion des adresses IP, Virtualisation, Autres belles choses. <br><br><hr><br>  Tout d'abord. <br><br><h2>  DCIM </h2><br>  La partie la plus importante est sans aucun doute quel √©quipement nous avons et comment il est connect√© les uns aux autres.  Mais tout commence <b>l√† o√π</b> il en est. <br><br><h3>  R√©gions et sites (r√©gions / sites) </h3><br>  Dans le paradigme NetBox, un appareil est install√© sur un site, un site appartient √† une r√©gion, les r√©gions peuvent √™tre imbriqu√©es.  Cependant, l'appareil ne peut pas √™tre install√© simplement dans la r√©gion.  S'il y a un tel besoin, un site s√©par√© devrait √™tre cr√©√©. <br><br>  Pour notre cas, cela peut (et ressemblera) √† ceci: <br><br><ul><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dru" rel="nofollow">Russie</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/msk/" rel="nofollow">Moscou</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/kzn/" rel="nofollow">Kazan</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dsp" rel="nofollow">Espagne</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/bcn/" rel="nofollow">Barcelone</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/mlg/" rel="nofollow">Malaga</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/dcim/sites/%3Fregion%3Dcn" rel="nofollow">Chine</a> : <a href="http://netbox.linkmeup.ru:45127/dcim/sites/sha/" rel="nofollow">Shanghai</a> , <a href="http://netbox.linkmeup.ru:45127/dcim/sites/Sia/" rel="nofollow">Xi'an</a> . </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/703/ab7/358/703ab73587ab4d1fe9079aa548ba93d1.png" width="800"><br><br>  Je vous rappelle o√π et comment nous avons planifi√© notre r√©seau: <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">ADSM2.</a>  <a href="https://linkmeup.ru/blog/479.html" rel="nofollow">Conception du r√©seau</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1df/012/888/1df0128888e0708959f6108e176a0de9.png" width="700"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/b34/709/d5db34709814c8e1fe07f74b8c9f96fd.png" width="800"><br><br>  Voyons ce que l'API permet. <br><br>  Voici une liste de toutes les r√©gions: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/regions/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.regions.all()</code> </pre> <br><blockquote>  Ci-apr√®s, je donnerai des exemples de curl et de pynetbox sans sortir le r√©sultat. <br>  <b>N'oubliez pas la</b> barre oblique √† la fin de l'URL - sans elle, cela ne fonctionnera pas. <br>  J'ai expliqu√© comment utiliser pynetbox dans un article sur l' <a href="https://habr.com/ru/post/485618/">API RESTful</a> . <br></blockquote>  Obtenez la liste des sites: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/sites/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.sites.all()</code> </pre><br>  Liste des sites dans une r√©gion sp√©cifique: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/sites/?region=ru"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.sites.filter(region=<span class="hljs-string"><span class="hljs-string">"ru"</span></span>)</code> </pre><br><blockquote>  Veuillez noter que la recherche n'est pas par nom complet, mais par le soi-disant <a href="https://qna.habr.com/q/375615" rel="nofollow">slug</a> . <br>  <b>Slug</b> est un identifiant contenant uniquement des caract√®res s√ªrs: [0-9A-Za-z-_], qui peut √™tre utilis√© dans l'URL.  Il est d√©fini lors de la cr√©ation d'un objet, par exemple, ¬´bcn¬ª au lieu de ¬´Barcelone¬ª. <br><img src="https://habrastorage.org/getpro/habr/post_images/3db/6cc/f89/3db6ccf89097c571900457aebbc922fe.png" width="400"><br></blockquote><br><hr><br><h3>  Appareils </h3><br>  L'appareil lui-m√™me a un <a href="http://netbox.linkmeup.ru:45127/dcim/device-roles/" rel="nofollow">r√¥le</a> , par exemple, feuille, colonne vert√©brale, bord, bordure. <br><br>  C'est, √©videmment, une sorte de <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/" rel="nofollow">mod√®le d'</a> un <a href="http://netbox.linkmeup.ru:45127/dcim/manufacturers/" rel="nofollow">fournisseur</a> . <br>  Par exemple, <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/%3Fmanufacturer%3Darista" rel="nofollow">Arista</a> . <br><br>  Ainsi, un fournisseur est d'abord cr√©√©, puis √† l'int√©rieur du mod√®le. <br><br>  <a href="http://netbox.linkmeup.ru:45127/dcim/device-types/2/" rel="nofollow">Le mod√®le est</a> caract√©ris√© par un nom, un ensemble d'interfaces de service, une interface de t√©l√©commande, un port de console et un ensemble de modules d'alimentation. <br><br>  En plus des commutateurs, des routeurs et des h√¥tes avec des interfaces Ethernet, vous pouvez cr√©er des serveurs de console. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/826/9a4/f9f/8269a4f9ffb7f7e66096eff89dc19013.png" width="800"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c81/cce/0f9/c81cce0f9d543eedd4f7c1e1ede5f43f.png" width="500"><br><br>  Obtenez une liste de tous les appareils: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.all()</code> </pre><br>  Tous les appareils pour un site particulier: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?site=mlg"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>)</code> </pre><br>  Tous les appareils d'un certain mod√®le <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?model=veos"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(device_type_id=<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br>  Tous les appareils avec un r√¥le sp√©cifique: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?role=leaf"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(role=<span class="hljs-string"><span class="hljs-string">"leaf"</span></span>)</code> </pre><br>  L'appareil peut avoir diff√©rents statuts: Actif, Hors ligne, Planifi√©, etc. <br><br>  Tous les appareils actifs: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?status=active"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(status=<span class="hljs-string"><span class="hljs-string">"active"</span></span>)</code> </pre><br><hr><br><h3>  Interfaces </h3><br>  NetBox prend en charge de nombreux types d' <a href="http://netbox.linkmeup.ru:45127/api/dcim/_choices/" rel="nofollow">interfaces</a> physiques et de LAG, cependant, tous les virtuels tels que Vlan / IRB et le bouclage sont combin√©s sous un seul type - virtuel. <br>  Chaque interface est li√©e √† un appareil. <br><br>  Les interfaces des appareils peuvent √™tre connect√©es les unes aux autres.  Celui-ci sera affich√© √† la fois dans l'interface et dans les r√©ponses API (attribut connected_endpoint). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aea/c56/b47/aeac56b47e58145211f5726c8e48cb91.png" width="800"><br><br>  L'interface peut √™tre dans diff√©rents modes: Tagged ou Access. <br><br>  En cons√©quence, il peut √™tre lanc√© dans la balise avec ou sans VLAN - ce site ou global. <br><br>  Obtenez une liste de toutes les interfaces des appareils: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>)</code> </pre><br>  Obtenez une liste des VLAN d'une interface sp√©cifique. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet7"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Ethernet7"</span></span>).untagged_vlan.vid</code> </pre><br><blockquote>  Notez qu'ici j'utilise d√©j√† la m√©thode <b>get</b> au lieu du <b>filtre</b> .  Le filtre renvoie une liste, m√™me si le r√©sultat est un seul objet.  Get - renvoie un seul objet ou √©choue si le r√©sultat de la requ√™te est une liste d'objets. <br><br>  Par cons√©quent, get ne doit √™tre utilis√© que lorsque vous √™tes absolument s√ªr que le r√©sultat sera en une seule copie. <br><br>  Ici, juste apr√®s la demande, je passe aux attributs de l'objet.  Strictement parlant, c'est faux: si rien n'a √©t√© trouv√© par la requ√™te, alors pynetbox retournera None, et il n'aura pas l'attribut "untagged_vlan". <br><br>  Et notez √©galement que pynetbox n'attend pas partout une limace, quelque part et un nom. <br></blockquote>  D√©couvrez √† quelle interface de quel appareil une interface particuli√®re est connect√©e: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;name=Ethernet1"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">iface = nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, name=<span class="hljs-string"><span class="hljs-string">"Ethernet1"</span></span>) iface.connected_endpoint.device iface.connected_endpoint.name</code> </pre><br>  D√©couvrez le nom de l'interface de gestion: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/interfaces/?device=mlg-leaf-0&amp;mgmt_only=true"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.interfaces.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, mgmt_only=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre><br><hr><br><h3>  Ports de console </h3><br>  Les ports de console ne sont pas des interfaces, ils sont donc rendus comme des points de terminaison distincts. <br>  Les ports de p√©riph√©rique peuvent √™tre associ√©s aux ports de serveur de console. <br><br>  D√©couvrez √† quel port sur quel serveur de console un p√©riph√©rique sp√©cifique est connect√©. <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/console-ports/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.console_ports.get(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>).serialize()</code> </pre><br><blockquote>  La m√©thode de <b>s√©rialisation</b> dans pynetbox vous permet de convertir les attributs d'une instance d'une classe en dictionnaire. <br></blockquote><hr><br><h2>  Ipam </h2><br><h3>  VLAN et VRF </h3><br>  Ils peuvent √™tre li√©s √† un emplacement - utile pour le VLAN. <br><br>  Lors de la cr√©ation d'un VRF, vous pouvez sp√©cifier si l'espace d'adressage est autoris√© √† se croiser avec d'autres VRF. <br><br>  Obtenez une liste de tous les VLAN: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/vlans/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.vlans.all()</code> </pre><br>  Obtenez une liste de tous les VRF: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/vrfs/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.vrfs.all()</code> </pre><br><hr><br><h3>  Pr√©fixes IP </h3><br>  Ils ont une structure hi√©rarchique.  Il peut appartenir √† n'importe quel VRF (sinon, Global). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/94b/ea6/8c4/94bea68c425c9a8bd601c9a0da74193e.png" width="800"><br><br>  NetBox a une repr√©sentation visuelle tr√®s pratique des pr√©fixes gratuits: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1be/90e/14d/1be90e14da8f4c3bedc4bcb892cb5156.png" width="800"><br><br>  Vous pouvez le s√©lectionner simplement en cliquant sur la ligne verte. <br><br>  Il peut √™tre attach√© √† un emplacement.  Vous pouvez s√©lectionner le prochain sous-pr√©fixe gratuit de la taille requise ou la prochaine adresse IP gratuite via l'API. <br><br>  La coche / param√®tre ¬´Is a pool¬ª d√©termine si la 0-√®me adresse de ce pr√©fixe sera mise en √©vidence lors de la s√©lection automatique, ou si elle commencera √† partir du 1er. <br><br>  Obtenez une liste des pr√©fixes IP du site de Malaga avec le r√¥le Underlay et une longueur de 19: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/?site=mlg&amp;role=underlay&amp;mask_length=19"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">prefix = nb.ipam.prefixes.get(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>, role=<span class="hljs-string"><span class="hljs-string">"underlay"</span></span>, mask_length=<span class="hljs-string"><span class="hljs-string">"19"</span></span>)</code> </pre><br>  Obtenez une liste de pr√©fixes gratuits dans la r√©gion de la Russie avec le r√¥le Underlay: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_prefixes.list()</code> </pre> <br>  Mettez en surbrillance le pr√©fixe gratuit 24 suivant: <br><br><pre> <code class="bash hljs">curl -X POST <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/40/available-prefixes/"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f"</span></span> \ -d <span class="hljs-string"><span class="hljs-string">"{\"prefix_length\": 24}"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_prefixes.create({<span class="hljs-string"><span class="hljs-string">"prefix_length"</span></span>:24})</code> </pre> <br><blockquote>  Lorsque nous devons s√©lectionner un enfant dans un objet, la m√©thode POST est utilis√©e et nous devons sp√©cifier l'ID de l'objet parent - dans ce cas - <b>40</b> .  Nous l'avons d√©couvert en appelant √† partir de l'exemple pr√©c√©dent. <br>  Dans le cas de pynetbox, nous avons d'abord (dans l'exemple pr√©c√©dent) enregistr√© le r√©sultat dans la variable <b>pr√©fixe</b> , puis nous nous sommes tourn√©s vers son attribut <b>available_prefixes</b> et la m√©thode <b>create</b> . <br>  Cet exemple <b>ne fonctionnera pas</b> pour vous, car le jeton avec le droit d'√©criture est d√©j√† invalide. <br></blockquote><hr><br><h3>  Adresses IP </h3><br>  S'il existe un pr√©fixe incluant cette adresse, il en fera partie.  Ils peuvent √™tre seuls. <br>  Peut appartenir √† n'importe quel VRF ou √™tre dans Global. <br>  Ils peuvent √™tre attach√©s √† l'interface, mais peuvent pendre en l'air. <br>  Vous pouvez s√©lectionner la prochaine adresse IP libre dans le pr√©fixe. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a1/c4d/442/4a1c4d4428f703d9a90766ffa9351fe8.png" width="800"><br><br>  Pour ce faire, cliquez simplement sur la ligne verte. <br><br>  Obtenez une liste d'adresses IP pour une interface sp√©cifique: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?interface_id=8"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(interface_id=<span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre><br>  Ou: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0&amp;interface=Ethernet1"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>, interface=<span class="hljs-string"><span class="hljs-string">"Ethernet1"</span></span>)</code> </pre><br>  Obtenez une liste de toutes les adresses IP des appareils: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/ip-addresses/?device=mlg-leaf-0"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.ipam.ip_addresses.filter(device=<span class="hljs-string"><span class="hljs-string">"mlg-leaf-0"</span></span>)</code> </pre><br>  Obtenez une liste des adresses IP de pr√©fixe disponibles: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">prefix = nb.ipam.prefixes.get(site=<span class="hljs-string"><span class="hljs-string">"mlg"</span></span>, role=<span class="hljs-string"><span class="hljs-string">"leaf-loopbacks"</span></span>) prefix.available_ips.list()</code> </pre><br><blockquote>  Ici encore, vous devez sp√©cifier l'ID du pr√©fixe dans l'URL √† partir de laquelle nous s√©lectionnons l'adresse - cette fois, c'est 28. <br></blockquote>  Mettez en surbrillance l'adresse IP gratuite suivante dans le pr√©fixe: <br><br><pre> <code class="bash hljs">curl -X POST <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/ipam/prefixes/28/available-ips/"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"accept: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ -H <span class="hljs-string"><span class="hljs-string">"Authorization: TOKEN a9aae70d65c928a554f9a038b9d4703a1583594f"</span></span></code> </pre> <br><pre> <code class="bash hljs">prefix.available_ips.create()</code> </pre> <br><hr><br><h2>  Virtualisation </h2><br>  Nous nous battons toujours pour le titre de DC moderne.  O√π sans virtualisation. <br><br>  NetBox n'a pas l'air et n'est pas un endroit o√π il vaut la peine de stocker des informations sur les machines virtuelles (vous pouvez m√™me sp√©culer sur la n√©cessit√© d'y stocker des machines physiques).  Cependant, cela peut nous √™tre utile, par exemple, vous pouvez entrer des informations sur les r√©flecteurs de route, les machines de service, telles que NTP, Syslog, les serveurs S-Flow et les machines de contr√¥le. <br><br>  La machine virtuelle a sa propre liste d'interfaces - elles sont diff√©rentes des interfaces des p√©riph√©riques physiques et ont leur propre point de terminaison distinct. <br><br>  Vous pouvez donc lister toutes les machines virtuelles: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/virtualization/virtual-machines/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.virtualization.virtual_machines.all()</code> </pre><br>  Donc - de toutes les interfaces de toutes les VM: <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/virtualization/interfaces/"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.virtualization.interfaces.all()</code> </pre><br>  Pour une machine virtuelle, vous ne pouvez pas sp√©cifier l'hyperviseur / la machine physique sp√©cifique sur laquelle elle s'ex√©cute, mais vous pouvez sp√©cifier un cluster.  Bien que tout ne soit pas si d√©sesp√©r√©.  Continuez √† lire. <br><br><hr><br><h2>  Tr√®s belles choses </h2><br>  La fonctionnalit√© de base de NetBox couvre la plupart des t√¢ches de nombreux utilisateurs, mais pas toutes.  Pourtant, le produit a √©t√© initialement √©crit pour r√©soudre les probl√®mes d'une entreprise particuli√®re.  Cependant, il se d√©veloppe activement et les nouvelles versions sortent assez <a href="https://github.com/netbox-community/netbox/releases" rel="nofollow">souvent</a> .  En cons√©quence, de nouvelles fonctions apparaissent. <br><br>  Ainsi, par exemple, depuis ma premi√®re installation de NetBox il y a quelques ann√©es, des balises y sont apparues, des contextes de configuration, des webhooks, la mise en cache, supervord chang√© en systemd, un stockage de fichiers externe. <br><br>  Attention. <br><br><h3>  Champs personnalis√©s </h3><br>  Parfois, vous souhaitez ajouter un champ √† toute entit√© dans laquelle vous pouvez placer des donn√©es arbitraires. <br><br>  Par exemple, indiquez le num√©ro de l'accord d'approvisionnement par lequel le commutateur a √©t√© achet√© ou le nom de la machine physique sur laquelle la machine virtuelle s'ex√©cute. <br><br>  C'est l√† que les champs personnalis√©s viennent √† la rescousse - juste un tel champ avec une valeur de texte qui peut √™tre ajout√©e √† presque n'importe quelle entit√© dans NetBox. <br><br>  Cr√©er des champs personnalis√©s dans le panneau d'administration <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1cf/10e/568/1cf10e56808f227ce7f7270581b84a31.png" width="600"><br><br>  Voici √† quoi cela ressemble lors de la modification de l'appareil pour lequel le champ personnalis√© a √©t√© cr√©√©: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3a/c2b/c78/d3ac2bc78d80acccc3895463f7ed7295.png" width="450"><br><br>  Demander une liste d'appareils par valeur custom_field <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?cf_contract_number=0123456789"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><pre> <code class="python hljs">nb.dcim.devices.filter(cf_contract_number=<span class="hljs-string"><span class="hljs-string">"0123456789"</span></span>)</code> </pre><br><hr><br><h3>  Contexte de configuration </h3><br>  Parfois, vous voulez quelque chose de plus qu'un texte non structur√©.  Ensuite, le <a href="http://netbox.linkmeup.ru:45127/extras/config-contexts/1/" rel="nofollow">contexte de configuration</a> vient √† la rescousse. <br><br>  C'est l'occasion d'introduire un ensemble de donn√©es structur√©es au format JSON, qui n'a nulle part ailleurs √† mettre. <br><br>  Il peut s'agir, par exemple, d'un ensemble de communaut√©s BGP ou d'une liste de serveurs Syslog. <br><br>  Le contexte de configuration peut √™tre local - configur√© pour un objet particulier - ou global, lorsqu'il est configur√© une fois, puis s'applique √† tous les objets qui remplissent certaines conditions (par exemple, situ√©s sur le m√™me site ou s'ex√©cutant sur la m√™me plate-forme). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97a/406/224/97a406224499ed35e9c471c3709a8d98.png" width="800"><br><br>  Le contexte de configuration est automatiquement ajout√© aux r√©sultats de la requ√™te.  En m√™me temps, les contextes local et mondial se confondent. <br><br>  Par exemple, pour un appareil juste une simple fille russe, pour laquelle il existe un contexte local, la sortie contiendra la cl√© "config_context": <br><br><pre> <code class="bash hljs">curl -X GET <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices/?q=russian"</span></span> -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/031/608/4bd/0316084bd52d028434631298a22ba33e.png" width="204"><br><br><hr><br><h3>  Balises </h3><br>  Il est difficile de dire quelque chose de nouveau sur les balises.  Ils le sont.  Ils sont pratiques pour ajouter une fonction.  Par exemple, vous pouvez √©tiqueter les commutateurs ¬´byada¬ª du lot dans lequel la m√©moire √©choue. <br><br><hr><br><h3>  Webhooks </h3><br>  Une chose irrempla√ßable lorsque vous avez besoin d'autres services pour en savoir plus sur les changements dans NetBox. <br>  Par exemple, lors du d√©marrage d'un nouveau commutateur, un crochet est envoy√© au syst√®me d'automatisation, qui d√©marre le processus de configuration et de mise en service de l'appareil. <br><br><hr><br><h1>  Conclusion </h1><br>  Dans cet article, je n'ai pas pour objectif de consid√©rer toutes les fonctionnalit√©s de NetBox, je vais donc vous donner tout le reste.  Comprenez, essayez. <br><br>  De plus, dans le cadre de la construction du syst√®me d'automatisation, je ne parlerai que des pi√®ces dont nous avons vraiment besoin. <br><br>  Donc, ci-dessus, j'ai bri√®vement parl√© de ce qu'est NetBox et de la fa√ßon dont les donn√©es y sont stock√©es. <br><br>  Je r√©p√®te que j'y ai d√©j√† entr√© presque toutes les donn√©es n√©cessaires, et vous pouvez faire glisser un <a href="" rel="nofollow">vidage de base de donn√©es pour</a> vous-m√™me. <br><br>  Tout est pr√™t pour la prochaine √©tape de l'automatisation: √©crire un syst√®me (ahaha, juste des scripts) pour initialiser les appareils et g√©rer la configuration. <br><br><hr><br>  Mais, avant de terminer l'article, je vais dire quelques mots sur l'installation et le fonctionnement des composants NetBox. <br><br><h1>  Quelques nuances d'installation de NetBox </h1><br>  Je ne d√©crirai pas le processus d'installation en d√©tail - il est plus que c√©l√®bre d√©crit dans la <a href="https://netbox.readthedocs.io/en/stable/installation/" rel="nofollow">documentation officielle</a> . <br><br>  Vous pouvez regarder le processus de lancement de l'image docker NetBox et de travailler dans l'interface graphique dans la vid√©o de Dima Figol ( <a href="https://www.youtube.com/watch%3Fv%3DGGXgAlWm9aY%26t%3D9655s" rel="nofollow">une</a> et <a href="https://www.youtube.com/watch%3Fv%3Da3yK_WAisPw" rel="nofollow">deux fois</a> ) et <a href="https://www.youtube.com/watch%3Fv%3DI_Ra3PIR2Lc%26feature%3Dyoutu.be" rel="nofollow">Emil Garipov</a> . <br><br>  En g√©n√©ral, si vous suivez strictement les √©tapes d'installation / d√©marrage, tout se passera bien. <br>  Mais voici les nuances que vous pouvez oublier accidentellement. <br><br><ul><li>  Dans le fichier configuration.py, le param√®tre <a href="https://netbox.readthedocs.io/en/stable/installation/2-netbox/" rel="nofollow">ALLOWED_HOSTS</a> doit √™tre renseign√©: <br><pre> <code class="bash hljs">ALLOWED_HOSTS = [<span class="hljs-string"><span class="hljs-string">'netbox.linkmeup.ru'</span></span>, <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>]</code> </pre> <br>  Ici, vous devez sp√©cifier tous les noms de NetBox possibles auxquels vous acc√©derez, par exemple, il peut y avoir une adresse IP externe ou 127.0.0.1 ou un alias DNS. <br>  Si cela n'est pas fait, le site Web NetBox ne s'ouvrira pas et affichera 400. </li><li>  Dans le m√™me fichier, <a href="https://netbox.readthedocs.io/en/stable/installation/2-netbox/" rel="nofollow">SECRET_KEY</a> doit √™tre sp√©cifi√©, que vous pouvez inventer vous-m√™me ou g√©n√©rer un script. </li><li>  La page principale affichera 502 Bad Gateway si quelque chose ne va pas avec la configuration de la base de donn√©es PostgreSQL: v√©rifiez l'h√¥te (s'il est install√© sur une autre machine), le port, le nom de la base de donn√©es, le nom d'utilisateur, le mot de passe. </li><li>  Depuis <a href="" rel="nofollow">quelque temps,</a> NetBox n'accorde par d√©faut aucun droit de lecture sans autorisation. <br><br>  Tout cela change dans la m√™me configuration.py: <br><br><pre> <code class="bash hljs">EXEMPT_VIEW_PERMISSIONS = [<span class="hljs-string"><span class="hljs-string">'*'</span></span>]</code> </pre> </li><li>  Et les demandes d'API renverront √©galement 200 et ne fonctionneront pas s'il n'y a pas de barre oblique dans l'URL d'API √† la fin. <br><pre> <code class="bash hljs">curl -X GET -H <span class="hljs-string"><span class="hljs-string">"Accept: application/json; indent=4"</span></span> <span class="hljs-string"><span class="hljs-string">"http://netbox.linkmeup.ru:45127/api/dcim/devices"</span></span></code> </pre> <br></li></ul><br><hr><br><h1>  Un peu sur PostgreSQL </h1><br>  Pour vous connecter au serveur: <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt;</code> </pre> <br>  Par exemple: <br><br><pre> <code class="bash hljs">psql -U netbox -h localhost netbox</code> </pre> <br>  Pour afficher tous les tableaux: <br><br><pre> <code class="bash hljs">/dt</code> </pre> <br>  Pour quitter: <br><br><pre> <code class="bash hljs">/q</code> </pre> <br>  Pour un vidage de base de donn√©es: <br><br><pre> <code class="bash hljs">pg_dump -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; &gt; netbox.sql</code> </pre> <br>  Si vous ne souhaitez pas saisir de mot de passe √† chaque fois: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> *:*:*:&lt;i&gt;username&lt;/i&gt;:&lt;i&gt;password&lt;/i&gt; &gt; ~/.pgpass chmod 600 ~/.pgpass</code> </pre> <br>  Si vous avez votre propre installation et que vous ne voulez pas tout faire √† la main, vous pouvez simplement le faire en effectuant un vidage de la base de donn√©es NetBox actuelle <a href="" rel="nofollow">ici</a> : <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; &lt; netbox_initial_db.sql</code> </pre> <br>  Si vous devez d'abord supprimer toutes les tables (et vous devez le faire), vous pouvez pr√©parer le fichier √† l'avance: <br><br><pre> <code class="bash hljs">psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; \o drop_all_tables.sql select <span class="hljs-string"><span class="hljs-string">'drop table '</span></span> || tablename || <span class="hljs-string"><span class="hljs-string">' cascade;'</span></span> from pg_tables; \q psql -U &lt;i&gt;username&lt;/i&gt; -h &lt;i&gt;hostname&lt;/i&gt; &lt;i&gt;db_name&lt;/i&gt; -f drop_all_tables.sql</code> </pre> <br><hr><br><h1>  Liens utiles </h1><br><ul><li>  <a href="https://github.com/netbox-community/netbox" rel="nofollow">NetBox lui-m√™me sur guthub</a> </li><li>  <a href="https://github.com/netbox-community/netbox-docker" rel="nofollow">Version conteneur</a> </li><li>  <a href="https://netbox.readthedocs.io/en/stable/" rel="nofollow">Instructions d'installation compl√®tes et toute la documentation produit</a> </li><li>  <a href="http://karneliuk.com/2019/04/documenting-your-network-infrastructure-in-netbox-integrating-with-ansible-over-rest-api-and-automating-provisioning-of-cumulus-linux-arista-eos-nokia-sr-os-and-cisco-ios-xr/" rel="nofollow">Documentation de votre infrastructure r√©seau dans NetBox, int√©gration avec Ansible sur l'API REST</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3DGGXgAlWm9aY%26t%3D9655s" rel="nofollow">IPAM NetBox et son API, Docker, Postman</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3Da3yK_WAisPw" rel="nofollow">IPAM NetBox et son API, mod√®les de configuration avec Python</a> </li><li>  <a href="https://github.com/digitalocean/pynetbox" rel="nofollow">SDK Python NetKox</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/api/docs/" rel="nofollow">Documentation API</a> </li><li>  <a href="https://groups.google.com/forum/" rel="nofollow">Liste de diffusion</a> </li><li>  <a href="https://networktocode.slack.com/" rel="nofollow">NetworkToCode Slack Channel</a> </li><li>  <a href="https://habr.com/ru/post/485618/">Qu'est-ce que REST?</a> </li><li>  <a href="http://netbox.linkmeup.ru:45127/" rel="nofollow">Installation de NetBox pour ADSM</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr486000/">https://habr.com/ru/post/fr486000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485986/index.html">Top 5 des tendances de localisation en 2020</a></li>
<li><a href="../fr485988/index.html">[Case Locomizer] Comment acc√©l√©rer le calcul d'une carte thermique de 20 000 fois en deux ans et demi</a></li>
<li><a href="../fr485990/index.html">L'automatisation tue?</a></li>
<li><a href="../fr485996/index.html">APM √©lastique dans l'application</a></li>
<li><a href="../fr485998/index.html">LyX: Remarques g√©n√©rales. 2e partie</a></li>
<li><a href="../fr486006/index.html">Stocker l'√©tat du chat sur la pile</a></li>
<li><a href="../fr486010/index.html">Faire une d√©mo pour un vieux t√©l√©phone - AONDEMO</a></li>
<li><a href="../fr486014/index.html">Visite SLAC: Laboratoire national des acc√©l√©rateurs du D√©partement am√©ricain de l'√©nergie √† Stanford</a></li>
<li><a href="../fr486018/index.html">R√©sultats de l'enqu√™te de session</a></li>
<li><a href="../fr486024/index.html">Graphismes vraiment simples en R pour la science et le journalisme</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>