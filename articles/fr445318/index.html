<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üå∫ üë©üèª‚Äçüåæ ü§üüèΩ Interruption (tarp) pour les connexions SSH entrantes üëù üé∑ üèáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ce n'est un secret pour personne qu'Internet est un environnement tr√®s hostile. D√®s que vous soulevez le serveur, il subit instantan√©ment des attaques...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Interruption (tarp) pour les connexions SSH entrantes</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/445318/">  Ce n'est un secret pour personne qu'Internet est un environnement tr√®s hostile.  D√®s que vous soulevez le serveur, il subit instantan√©ment des attaques massives et plusieurs analyses.  Sur l'exemple <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">d'un hanipot d'agent de s√©curit√©,</a> on peut estimer l'ampleur de ce trafic ind√©sirable.  En effet, sur un serveur moyen, 99% du trafic peut √™tre malveillant. <br><br>  Tarpit est un port d'interruption qui est utilis√© pour ralentir les connexions entrantes.  Si un syst√®me tiers se connecte √† ce port, il ne fonctionnera pas pour fermer la connexion rapidement.  Elle devra d√©penser ses ressources syst√®me et attendre que la connexion soit interrompue par un d√©lai d'attente, ou la rompre manuellement. <br><br>  Le plus souvent, des b√¢ches sont utilis√©es pour la protection.  La technique a d'abord √©t√© d√©velopp√©e pour prot√©ger contre les vers informatiques.  Et maintenant, il peut √™tre utilis√© pour g√¢cher la vie des spammeurs et des chercheurs qui sont engag√©s dans une large analyse de toutes les adresses IP d'affil√©e (exemples sur Habr√©: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Autriche</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Ukraine</a> ). <br><a name="habracut"></a><br>  L'un des administrateurs syst√®me nomm√© Chris Wellons, apparemment fatigu√© de regarder cette honte - et il a √©crit un petit programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Endlessh</a> , tarpit pour SSH, ralentissant les connexions entrantes.  Le programme ouvre le port (par d√©faut, le port 2222 est sp√©cifi√© pour les tests) et pr√©tend √™tre un serveur SSH, mais √©tablit en fait une connexion sans fin avec le client entrant jusqu'√† ce qu'il se rende.  Cela peut durer plusieurs jours ou plus jusqu'√† ce que le client tombe. <br><br>  Installation de l'utilitaire: <br><br><pre><code class="bash hljs">$ make $ ./endlessh &amp; $ ssh -p2222 localhost</code> </pre> <br>  Un tarpit correctement implant√© enl√®vera plus de ressources √† l'attaquant que vous.  Mais la question n'est m√™me pas dans les ressources.  L'auteur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">√©crit</a> que le programme cr√©e une d√©pendance.  √Ä l'heure actuelle, 27 clients sont pi√©g√©s, certains √©tant connect√©s depuis des semaines.  Au plus fort de l'activit√©, 1378 clients sont rest√©s dans le pi√®ge pendant 20 heures! <br><br>  En mode de fonctionnement, le serveur Endlessh doit √™tre install√© sur le port r√©gulier 22, o√π les hooligans frappent massivement.  Les recommandations de s√©curit√© standard conseillent toujours de d√©placer SSH vers un port diff√©rent, ce qui r√©duit imm√©diatement la taille des journaux d'un ordre de grandeur. <br><br>  Chris Wellons dit que son programme exploite un paragraphe de la sp√©cification <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">RFC 4253</a> pour le protocole SSH.  Imm√©diatement apr√®s avoir √©tabli une connexion TCP, mais avant d'appliquer la cryptographie, les deux parties doivent envoyer une cha√Æne d'identification.  Et il y a une note: <i>"Le serveur PEUT envoyer d'autres lignes de donn√©es avant d'envoyer la ligne avec la version</i> . <i>"</i>  Et <b>il n'y a pas de limite</b> sur la quantit√© de ces donn√©es, chaque ligne ne doit pas commencer par <code>SSH-</code> . <br><br>  C'est exactement ce que fait Endlessh: il <b>envoie un flux <i>sans fin</i> de donn√©es g√©n√©r√©es al√©atoirement</b> qui sont conformes √† la RFC 4253, c'est-√†-dire envoy√©es avant l'identification, et chaque ligne ne commence pas par <code>SSH-</code> et ne d√©passe pas 255 caract√®res, y compris le caract√®re de terminaison de ligne.  En g√©n√©ral, tout est standard. <br><br>  Par d√©faut, le programme attend 10 secondes entre l'envoi des paquets.  Cela emp√™che un d√©lai d'attente afin que le client soit pi√©g√© pour toujours. <br><br>  √âtant donn√© que les donn√©es sont envoy√©es avant l'application de la cryptographie, le programme est exceptionnellement simple.  Il n'a pas besoin d'impl√©menter de chiffrement et de prendre en charge plusieurs protocoles. <br><br>  L'auteur a essay√© de faire en sorte que l'utilitaire consomme un minimum de ressources et fonctionne de mani√®re absolument transparente sur la machine.  Contrairement aux antivirus modernes et autres "syst√®mes de s√©curit√©", il ne devrait pas ralentir l'ordinateur.  Il a r√©ussi √† minimiser √† la fois le trafic et la consommation de m√©moire gr√¢ce √† une impl√©mentation logicielle l√©g√®rement plus astucieuse.  S'il commen√ßait simplement un processus distinct sur une nouvelle connexion, les attaquants potentiels pourraient mener une attaque DDoS, ouvrant de nombreuses connexions pour √©puiser les ressources de la machine.  Un thread par connexion n'est pas non plus la meilleure option, car le noyau d√©pensera des ressources pour la gestion des threads. <br><br>  Par cons√©quent, Chris Wellons a choisi l'option la plus l√©g√®re pour Endlessh: un serveur d'interrogation √† un seul thread <code>poll(2)</code> , o√π les clients dans le pi√®ge ne consomment pratiquement pas de ressources inutiles, sans compter l'objet socket dans le noyau et 78 autres octets pour le suivi dans Endlessh.  Afin de ne pas allouer de tampons de r√©ception et d'envoi pour chaque client, Endlessh ouvre un socket d'acc√®s direct et traduit directement les paquets TCP, ignorant la quasi-totalit√© de la pile TCP / IP du syst√®me d'exploitation.  Le tampon d'entr√©e n'est pas du tout n√©cessaire, car les donn√©es d'entr√©e ne nous int√©ressent pas. <br><br>  L'auteur dit qu'au moment de son programme, il <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ignorait</a> l'existence du Python Asycio et d'autres b√¢ches.  S'il connaissait asycio, il pourrait impl√©menter son utilitaire en seulement 18 lignes en Python: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_reader, writer)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>) writer.write(<span class="hljs-string"><span class="hljs-string">b'%x\r\n'</span></span> % random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">32</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionResetError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> server = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.start_server(handler, <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">2222</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> server: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> server.serve_forever() asyncio.run(main())</code> </pre> <br><br>  Asyncio est parfait pour √©crire tarpit.  Par exemple, un tel pi√®ge bloquera Firefox, Chrome ou un autre client qui essaie de se connecter √† votre serveur HTTP pendant plusieurs heures: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_reader, writer)</span></span></span><span class="hljs-function">:</span></span> writer.write(<span class="hljs-string"><span class="hljs-string">b'HTTP/1.1 200 OK\r\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>) header = random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">32</span></span>) value = random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">32</span></span>) writer.write(<span class="hljs-string"><span class="hljs-string">b'X-%x: %x\r\n'</span></span> % (header, value)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionResetError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> server = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.start_server(handler, <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">8080</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> server: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> server.serve_forever() asyncio.run(main())</code> </pre> <br><br>  Tarpit est un excellent outil pour punir les intimidateurs en ligne.  Certes, il existe un risque, au contraire, d'attirer leur attention sur le comportement inhabituel d'un serveur particulier.  Quelqu'un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">pourrait penser √† la vengeance</a> et √† une attaque DDoS cibl√©e sur votre IP.  Cependant, jusqu'√† pr√©sent, il n'y a pas eu de tels cas, et tarpit fonctionne tr√®s bien. <br><br><hr><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/rw/hk/1y/rwhk1y-msfqaknqu2kbktqf6g7a.jpeg"></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><img src="https://habrastorage.org/webt/od/n-/xe/odn-xebtl8a5lexzip_kkkezr6s.jpeg"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr445318/">https://habr.com/ru/post/fr445318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr445308/index.html">Caract√©ristiques des tests d'hypoth√®ses pour les applications mobiles</a></li>
<li><a href="../fr445310/index.html">Sovereign Runet a augment√© de prix √† to30 milliards</a></li>
<li><a href="../fr445312/index.html">Allocation de m√©moire JVM</a></li>
<li><a href="../fr445314/index.html">Pourquoi l'extraction des ast√©ro√Ødes est-elle difficile?</a></li>
<li><a href="../fr445316/index.html">DevDay G√©rer l'informatique. Enregistrement de performances</a></li>
<li><a href="../fr445320/index.html">Les disques roulent et roulent</a></li>
<li><a href="../fr445322/index.html">Grand choix de ressources utiles pour les chefs de produit</a></li>
<li><a href="../fr445326/index.html">Automatisation impitoyable. Coupure du r√©alisateur</a></li>
<li><a href="../fr445328/index.html">Repenser la robotique pour enfants</a></li>
<li><a href="../fr445330/index.html">Cryptographie en Java. Classe de signature</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>