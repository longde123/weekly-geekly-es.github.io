<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏐 🤜 🌠 Cámaras de visión artificial para entusiastas. ¿Cómo usar la cámara para la navegación fuera de línea? 🤛🏿 🈵 🗿</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hicimos una cámara para detectar AprilTag y ArTag con mROS. Conéctese a través de Uart o Ethernet. 

 Probamos JeVois y OpenMV, apreciamos los pros y ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cámaras de visión artificial para entusiastas. ¿Cómo usar la cámara para la navegación fuera de línea?</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/robogazon/blog/426695/"><h2>  Hicimos una cámara para detectar AprilTag y ArTag con mROS.  Conéctese a través de Uart o Ethernet. </h2><br><br>  Probamos JeVois y OpenMV, apreciamos los pros y los contras, y montamos nuestra cámara. <br><br><img src="https://habrastorage.org/webt/lp/nb/qx/lpnbqx9egbtr4id5i-oftxtjpj4.jpeg"><br><br>  Busque etiquetas visuales y la orientación del robot en función de los datos.  Estamos desarrollando un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">robot para recoger pelotas de golf en el campo de prácticas</a> .  Ahora, en el mundo, solo una compañía vende un robot para resolver este problema.  El mercado es muy prometedor, nos animó a convertir el proyecto de bricolaje en una startup tecnológica. <br><a name="habracut"></a><br>  Al usar GPS sin RTK para navegar por el robot, es difícil lograr la precisión necesaria para buscar correctamente una base y estacionamiento.  Usando Real Time Kinematic, tendré problemas al acercarme a los edificios.  Probamos varias opciones y decidimos hacer nuestra propia cámara para buscar una marca visual en la entrada de la base. <br><br>  Parte del desarrollo del robot fue su estacionamiento en la estación de acoplamiento para descargar el compartimento de bolas y cargar las baterías.  Durante mucho tiempo pensamos en cómo estacionarlo, acordamos que el robot encontraría un objeto óptico brillante y lo seguiría. <br><br>  Las etiquetas AprilTag o ArTag fueron elegidas como el objetivo, dependiendo de cómo se mostraran en el campo.  Porque  no sufrimos el síndrome <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">NIH</a> : ha comenzado la búsqueda de cámaras de visión artificial con soporte para estos marcadores y con soporte para guiones directamente en la cámara. <br><br><h3>  First JeVois </h3><br>  De lo que se encontró rápidamente: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">JeVois</a> , desarrollado por el laboratorio de la Universidad del Sur de California.  Desafortunadamente, tuve que hacer un pedido a Rusia a través de Amazon, no había revendedores internos y aparentemente no habrá ninguno, aparentemente el marketing y las ventas son llevados a cabo por los propios desarrolladores (nos sorprendió bastante cuando tuvimos que cambiar de Jevois a Jevois inc para comprar una cámara y luego busque un enlace al directorio: seleccione la cámara en algún lugar en el medio de 10-12 posiciones). <br><br><img src="https://habrastorage.org/webt/2i/b6/yp/2ib6ypwgyxfvfswidighr735btq.png"><br><br>  Las primeras ejecuciones en la computadora fueron bastante alentadoras, en general, todo salió de la caja y parecía bastante interesante.  Sin embargo, después de las pruebas de conexión a la placa de control, se pusieron de manifiesto cuatro problemas graves: <br><br>  Los 60-90 FPS indicados en los materiales publicitarios son para resoluciones de 160x120 o 320x240, lo que no es en absoluto adecuado para el estacionamiento; la captura aún es deseable desde una distancia de al menos 5 metros.  Y para que un cuadrado caiga en el grano 160x120 de 6-8 metros, debe hacerlo al menos de medio metro de tamaño y al acercarse, primero cierra completamente el marco y luego deja de detectarlo. <br><br>  Consumo de 800 mA, mientras que la alimentación es solo a través de cables USB con mini USB, que pueden soportar esta corriente sin mucha caída de voltaje.  Resultó ser muy difícil encontrar un cable con una longitud de al menos medio metro con tales características: se seleccionaron unas 15 opciones y, de todos modos, el resultado no fue muy satisfactorio. <br><br>  La cámara está ciega por la noche o parpadea durante el día.  El equilibrio automático funciona más allá del bien y del mal. <br><br>  La cámara es enfriada por un ventilador.  El ventilador es muy pequeño, la velocidad es alta: ruido de alta frecuencia o simplemente un chirrido. <br><br><blockquote>  El robot chirriante es lo último que queríamos hacer. </blockquote><br>  Escribir el código de ejecución dentro de la cámara es un entretenimiento separado: instalar el entorno es un asunto bastante confuso, y ensamblar y cargar en la tarjeta SD lleva al menos 2-5 minutos.  Sí, no hay flash: todo está en la tarjeta SD. <br><br>  Conclusión: una cámara para jugar con entusiastas en interiores y con buena iluminación.  Al mismo tiempo, sería deseable que los entusiastas fueran estudiantes: la interfaz, la documentación y los métodos de trabajo con la cámara me recordaron vívidamente el trabajo de laboratorio de los estudiantes, donde casi no se prestó atención a la conveniencia de trabajar con el sistema y otros excesos.  Esto se trata de módulos C ++, por supuesto.  Los scripts de Python se pueden editar a través de Jevois Inventor, pero el FPS también es significativamente más bajo.  Fuera de las instalaciones, la cámara ni siquiera sobrevivió a dos lluvias, y el ventilador obstruyó la tierra en el campo con velocidad espacial. <br><br>  El resultado: no es adecuado para su uso en el robot, pero se ha demostrado la posibilidad fundamental de estacionamiento. <br><br><h3>  OpenMV 3 y todas sus variantes </h3><br><img src="https://habrastorage.org/webt/jl/0l/xr/jl0lxryl0tksfb1vyvdomcyh8wm.jpeg"><br><br>  En el momento de la primera búsqueda, simplemente no estaba disponible: había una campaña en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Kickstarter</a> . <br><br>  Después de jugar lo suficiente con JeVois y tirar 100 dólares a la basura, se encontró un vendedor con acciones y se compraron 2 piezas. <br><br>  En general, las impresiones son extremadamente agradables: una interfaz extraordinariamente pensada en el IDE de OpenMV, una compilación transparente de Python, es conveniente ver el algoritmo funcionar y depurarlo.  Sin embargo, hubo problemas aquí: <br><br><ul><li>  La resolución puede ser cualquiera, pero AprilTag solo se puede buscar en un área de no más de 200x200 píxeles.  Volvemos al problema del grano, etc.  El desarrollador <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">recomendó</a> primero extraer blobs, luego mirar los códigos en ellos.  Pero en algo que no sea un fondo liso (idealmente una pared blanca) esto no funciona, la hierba verde y el sol brillante contra el fondo convierten todo en gachas.  Además, el FPS se reduce a un máximo de 5. </li><li>  Sensor Omnivision barato + óptica barata = imagen jabonosa.  Visualmente, esto no es muy notable cuando se ve una transmisión de video, pero cuando se ven cuadros individuales es claramente visible. </li><li>  No hay cortina IR, pero hay iluminación IR.  [WHAAAAT?] </li><li>  No hay protección contra el entorno externo.  En absoluto </li></ul><br><img src="https://habrastorage.org/webt/wk/fw/pk/wkfwpkju7byid4w9pqq6g0iggpo.png"><br><br>  El script fue depurado en esta cámara, se realizaron varias docenas de estacionamientos.  Sin embargo, después de que el robot rodó de Moscú a San Petersburgo y regresó, la cámara dejó de encenderse: el regulador de potencia se apagó.  La acción obvia fue el empaque y la estabilización de potencia.  Y aquí se descubrió lo más interesante: el caso con la IP correcta para esta cámara simplemente no se pudo encontrar, o eran cajas con cubiertas transparentes, sin montajes internos y entradas / salidas de cable apretadas.  Como resultado de la búsqueda, se encontraron una gran cantidad de cámaras de vigilancia chinas baratas con los casos correctos.  La cámara fue comprada y destripada, una segunda copia de OpenMV estaba en lugar del tablero, todo funcionó. <br>  Pero la tarde y la noche se convirtieron en un obstáculo casi insuperable: no hay cortina de infrarrojos. <br><br>  Resultados: la cámara es MUY conveniente para la creación de prototipos, los recursos son limitados, no hay protección contra el entorno externo (la segunda cámara fue a un congelador industrial y no sobrevivió -30).  No bueno <br><br>  Y luego se volvió muy interesante para nosotros qué tipo de tableros obtuvimos de las cámaras chinas <br><br><h4>  Clones HiSilicon </h4><br>  En una inspección más cercana, resultó que la placa tiene un ARM de 2 núcleos, procesador DSP, cortina IR, iluminación IR, un sensor decente de Sony, la placa está cubierta con un compuesto protector + carcasa para la calle.  Justo lo que necesita: queda por recopilar software. <br><br>  Inside resultó ser un clon de Linux bastante funcional de HiSilicon + u-boot. <br>  Tuve que descargar el SDK de los recursos chinos y tratar con ensamblajes.  En principio, no se encontró nada terrible en el camino, excepto que era necesario arreglar varios archivos dentro del SDK: la distribución de Linux en la que el SDK iba a ser bastante antiguo, y algunos archivos de encabezado han cambiado desde entonces.  Bueno, tuve que cambiar el shell de zsh a bash.  Omitiré los detalles; para bien, este debería ser un artículo separado. <br><br>  <b>Estos recursos ayudaron:</b> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Analizando, conectando a la cámara</a> <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Ejemplo de diagrama de ensamblaje de software</a> <br><br>  Entonces todo salió de acuerdo con el conocido esquema: <br><br><img src="https://habrastorage.org/webt/ce/nx/u5/cenxu5leurcipqbzgfmzyxhdhhq.jpeg"><br><br>  La mayor parte del tiempo que tardé en obtener la imagen del sensor, terminé el resto en solo 4 horas, simplemente transfiriendo el algoritmo depurado de Python a C ++. <br>  Trabajar con el sensor tomó aproximadamente una semana y media.  Por supuesto, no hay / dev / video0 en estos dispositivos, hardware casi desnudo con trabajo directo con memoria y puertos. <br>  Debemos decir de inmediato que las muestras del SDK funcionan sin modificación solo en los paneles de depuración para estos SDK, de lo contrario, se requieren muchas ediciones menores.  Por extraño que parezca, el problema principal es determinar qué sensor está en la cámara, porque  los chinos escriben uno en la descripción, otro está marcado en la pizarra, el tercer modelo se inicializa en el software.  Como ejemplo, la cámara tiene un sensor IMX323 en la descripción, la placa está marcada SC2235, cuando se inicia en scripts de inicio, comienza como AR130, y el software de la cámara lo inicializa como SC2235P. <br><br>  Las razones de todo esto son bastante simples: para el usuario final, que IMX323, que SC2235 son todos iguales, la imagen es muy similar.  El kernel y rootfs con scripts int se ensamblaron desde el SDK con cambios mínimos y no se molestaron con un script de inicialización separado para cada modelo, solo los parámetros de inicio correctos, y el nombre se dejó como estaba.  En el software para trabajar con la cámara, la segunda pieza de inicialización del DSP con el sensor ya se lanzó y el modelo exacto de la cámara ya es crítico allí, por lo tanto, los registros ya tienen el modelo exacto: SC2235P.  P: esto es importante, es un sensor diferente en términos de características, que incluso funciona con una frecuencia de bus ligeramente diferente y una resolución diferente en comparación con SC2235. <br><br>  La segunda parte de la búsqueda son las hojas de datos de los sensores, que en general no lo son.  Por lo tanto, tuve que reconstruir el módulo hi_i2c con la impresión en el registro a través de printk y reemplazarlo en el volcado eliminado de la cámara, escribir el amortiguador de configuración DSP del procesador de video y eliminar las configuraciones de la cámara en funcionamiento, y varias veces para ver los controladores del proyecto DafangSoftware.  En detalle, esto dibuja 3-4 artículos separados, que tengo la intención de escribir después de NG. <br><br>  Al final, todo resultó incluso mejor de lo esperado: trabajo seguro para capturar AprilTag desde 6 metros incluso en la oscuridad casi completa, 25-12 fps, controlador de control de estacionamiento PID, etc. <br>  El resultado: es lo máximo para trabajar en el campo, se han tenido en cuenta muchas cosas para protegerse contra las condiciones externas.  Lo único que no pudo verificarse completamente fue el trabajo en el sol brillante, el clima desde octubre se ha deteriorado. <br><br><h3>  Idea para el desarrollo </h3><br>  Y aquí tuvimos una idea: tenemos en nuestras manos un análogo de OpenMV con características de hardware y producción en masa mucho mejores.  Queda por llevar el trabajo con la cámara al nivel OpenMV, a micropython allí, hacer un IDE conveniente y verificar dos veces cómo funcionarán los scripts actuales de OpenMV.  Además, mRos está completamente portado allí, y esto inmediatamente expande el uso de tales cámaras para sistemas ROS. <br><br>  Como resultado, planeamos entregar análogos de OpenMV en marzo y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mROS</a> en mayo. <br><br>  Para reducir el precio de personalizar la cámara, estamos listos para ofrecérselo.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Complete el formulario</a> y nos pondremos en contacto con usted cuando estemos listos para ordenar el primer lote. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es426695/">https://habr.com/ru/post/es426695/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es426685/index.html">Controlamos cientos de diferentes dispositivos domésticos inteligentes con voz y texto desde un teléfono inteligente. Alexa Echo en el mensajero</a></li>
<li><a href="../es426687/index.html">Hacer una carcasa de robot con un presupuesto limitado. Formación de vacío</a></li>
<li><a href="../es426689/index.html">Somos responsables del mercado de otra persona: lo que dicen las redes sociales sobre CRM</a></li>
<li><a href="../es426691/index.html">Programador en baja por enfermedad</a></li>
<li><a href="../es426693/index.html">Servicio de navegación robotizada en un campo de golf. Construyendo un camino y evitando obstáculos</a></li>
<li><a href="../es426697/index.html">Trabajar con dispositivos LibUsb desde Android</a></li>
<li><a href="../es426699/index.html">Prueba de Python con pytest. Simple, rápido, eficiente y escalable. Prólogo e Introducción</a></li>
<li><a href="../es426701/index.html">Flutter: una nueva mirada al desarrollo multiplataforma</a></li>
<li><a href="../es426703/index.html">Lo que fue interesante en DataVizDay en Minsk</a></li>
<li><a href="../es426705/index.html">Hyperledger Fabric Desarrollo y prueba de contratos inteligentes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>