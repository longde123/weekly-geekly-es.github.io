<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üõå üèë üêë Checkliste: Was musste vor dem Start von Microservices in Prod getan werden? üéÖüèæ üë©üèø‚Äçü§ù‚Äçüë©üèΩ üê´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dieser Artikel enth√§lt einen kurzen Auszug aus meiner eigenen Erfahrung und der Erfahrung meiner Kollegen, mit denen ich Tage und N√§chte damit verbrac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Checkliste: Was musste vor dem Start von Microservices in Prod getan werden?</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/438064/"><p><img src="https://habrastorage.org/webt/y7/-a/th/y7-ath7wga1jfx9issm1rhog2lg.jpeg" width="45%" align="right">  Dieser Artikel enth√§lt einen kurzen Auszug aus meiner eigenen Erfahrung und der Erfahrung meiner Kollegen, mit denen ich Tage und N√§chte damit verbracht habe, Vorf√§lle zu harken.  Und viele Vorf√§lle w√§ren niemals aufgetreten, wenn alle ihre Microservices geliebt h√§tten und zumindest ein wenig genauer geschrieben worden w√§ren. </p><br><p>  Leider glauben einige <s>Low-</s> Level-Programmierer ernsthaft, dass eine Docker-Datei mit einem Befehl selbst ein Mikroservice ist und bereits jetzt bereitgestellt werden kann.  Hafenarbeiter drehen sich, die Bank ist schlammig.  Dieser Ansatz ist mit Problemen behaftet, die von einem Leistungsabfall √ºber die Unf√§higkeit zum Debuggen und Denial-of-Service bis hin zu einem Albtraum namens Dateninkonsistenz reichen. </p><br><p>  Wenn Sie der Meinung sind, dass es an der Zeit ist, eine weitere App in Kubernetes / ECS / was auch immer zu starten, habe ich etwas zu beanstanden. </p><br><p> <strong>Die englische Version <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ist ebenfalls verf√ºgbar</a></strong> . </p><a name="habracut"></a><br><p>  Ich habe mir eine Reihe von Kriterien f√ºr die Beurteilung der Bereitschaft von Antr√§gen f√ºr den Start in der Produktion gebildet.  Einige Punkte dieser Checkliste k√∂nnen nicht auf alle Anwendungen angewendet werden, sondern nur auf spezielle.  Andere gelten im Allgemeinen f√ºr alles.  Ich bin sicher, Sie k√∂nnen Ihre Optionen in den Kommentaren hinzuf√ºgen oder einige dieser Punkte bestreiten. </p><br><p>  Wenn Ihr Mikrodienst nicht mindestens eines der Kriterien erf√ºllt, kann ich nicht zulassen, dass er sich in meinem idealen Cluster befindet, der in einem 2000 Meter unterirdischen Bunker mit Fu√übodenheizung und einem geschlossenen, in sich geschlossenen Internetversorgungssystem gebaut wurde. </p><br><p>  Lass uns gehen ... </p><br><p>  <i>Hinweis: Die Reihenfolge der Artikel spielt keine Rolle.</i>  <i>Jedenfalls f√ºr mich.</i> </p><br><h2 id="korotkoe-opisanie-v-readme">  Readme Kurzbeschreibung </h2><br><blockquote>  Es enth√§lt eine kurze Beschreibung seiner selbst ganz am Anfang von Readme.md in seinem Repository. </blockquote><p>  Gott, es scheint so einfach.  Aber wie oft bin ich darauf gesto√üen, dass das Repository nicht die geringste Erkl√§rung enth√§lt, warum es ben√∂tigt wird, welche Aufgaben es l√∂st und so weiter.  Es ist nicht erforderlich, √ºber etwas Komplizierteres wie Konfigurationsoptionen zu sprechen. </p><br><h2 id="integraciya-s-sistemoy-monitoringa">  Integration in ein √úberwachungssystem </h2><br><blockquote>  Sendet Metriken an DataDog, NewRelic, Prometheus usw. </blockquote><p>  Analyse des Ressourcenverbrauchs, Speicherlecks, Stacktraces, Service-Interdependenz, Fehlerrate - ohne all dies (und nicht nur) zu verstehen, ist es √§u√üerst schwierig zu steuern, was in einer gro√üen verteilten Anwendung geschieht. </p><br><h2 id="opovescheniya-nastroeny">  Warnungen konfiguriert </h2><br><blockquote>  Der Service umfasst Warnungen, die alle Standardsituationen sowie bekannte eindeutige Situationen abdecken. </blockquote><p>  Metriken sind gut, aber niemand wird ihnen folgen.  Daher erhalten wir automatisch Anrufe / Push / SMS, wenn: </p><br><ul><li>  Der CPU- / Speicherverbrauch hat dramatisch zugenommen. </li><li>  Der Verkehr nahm stark zu / ab. </li><li>  Die Anzahl der verarbeiteten Transaktionen pro Sekunde hat sich in jede Richtung dramatisch ge√§ndert. </li><li>  Die Gr√∂√üe des Artefakts nach dem Zusammenbau hat sich dramatisch ge√§ndert (exe, app, jar, ...). </li><li>  Der Prozentsatz der Fehler oder deren H√§ufigkeit hat den zul√§ssigen Schwellenwert √ºberschritten. </li><li>  Der Dienst hat das Senden von Metriken eingestellt (h√§ufig √ºbersehene Situation). </li><li>  Die Regelm√§√üigkeit bestimmter erwarteter Ereignisse wird verletzt (Cron-Job funktioniert nicht, nicht alle Ereignisse werden verarbeitet usw.) </li><li>  ... </li></ul><br><h2 id="runbooks-sozdany">  Runbooks erstellt </h2><br><blockquote>  F√ºr den Dienst wurde ein Dokument erstellt, das bekannte oder erwartete Eventualit√§ten beschreibt. </blockquote><br><ul><li>  Wie kann sichergestellt werden, dass der Fehler intern ist und nicht von Dritten abh√§ngt? </li><li>  ob es darauf ankommt, wo, an wen und was zu schreiben ist; </li><li>  wie man es sicher neu startet; </li><li>  wie man aus dem Backup wiederherstellt und wo Backups liegen; </li><li>  Welche speziellen Dashboards / Abfragen werden erstellt, um diesen Dienst zu √ºberwachen? </li><li>  Verf√ºgt der Dienst √ºber ein eigenes Admin-Panel und wie kommt man dorthin? </li><li>  Gibt es eine API / CLI und wie kann man damit bekannte Probleme beheben? </li><li>  usw. </li></ul><br><p>  Die Liste kann zwischen den Organisationen sehr unterschiedlich sein, aber zumindest grundlegende Dinge sollten vorhanden sein. </p><br><h2 id="vse-logi-pishutsya-v-stdoutstderr">  Alle Protokolle werden in STDOUT / STDERR geschrieben </h2><br><blockquote>  Der Dienst erstellt im Produktionsmodus keine Protokolldateien, sendet sie nicht an externe Dienste, enth√§lt keine redundanten Abstraktionen f√ºr die Protokollrotation usw. </blockquote><p>  Wenn eine Anwendung Protokolldateien erstellt, sind diese Protokolle unbrauchbar.  Sie werden nicht in 5 Container laufen, die parallel laufen, in der Hoffnung, den Fehler zu finden, den Sie brauchen (und hier sind Sie, <em>weinen</em> ...).  Ein Neustart des Containers f√ºhrt zum vollst√§ndigen Verlust dieser Protokolle. </p><br><p>  Wenn eine Anwendung ihre eigenen Protokolle in ein System eines Drittanbieters schreibt, z. B. in Logstash, f√ºhrt dies zu nutzloser Redundanz.  Der benachbarte Dienst wei√ü nicht, wie das geht, weil  Hat es einen anderen Rahmen?  Du bekommst einen Zoo. </p><br><p>  Die Anwendung schreibt einen Teil der Protokolle in Dateien und einen Teil in stdout, da es f√ºr den Entwickler praktisch ist, INFO in der Konsole und DEBUG in Dateien zu sehen.  Dies ist im Allgemeinen die schlechteste Option.  Niemand ben√∂tigt Komplexit√§t und vollst√§ndig redundanten Code und Konfigurationen, die Sie kennen und warten m√ºssen. </p><br><h2 id="logi---eto-json">  Protokolle sind Json </h2><br><blockquote>  Jede Protokollzeile ist im Json-Format geschrieben und enth√§lt einen konsistenten Satz von Feldern </blockquote><p>  Bisher schreibt fast jeder Protokolle im Klartext.  Dies ist eine echte Katastrophe.  Ich w√ºrde mich freuen, nie etwas √ºber <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Grok Patterns</a> zu erfahren.  Ich tr√§ume manchmal von ihnen und friere ein, versuche mich nicht zu bewegen, um ihre Aufmerksamkeit nicht zu erregen.  Versuchen Sie einfach, Java-Ausnahmen in den Protokollen einmal zu analysieren. </p><br><p>  Json ist gut, es ist Feuer vom Himmel.  F√ºgen Sie einfach dort hinzu: </p><br><ul><li>  <strong>Millisekunden-</strong> Zeitstempel gem√§√ü <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">RFC 3339</a> ; </li><li>  Level: Info, Warnung, Fehler, Debug </li><li>  user_id; </li><li>  app_name </li><li>  und andere Felder. </li></ul><br><p>  Laden Sie es auf ein geeignetes System herunter (z. B. korrekt konfigurierte ElasticSearch) und genie√üen Sie es.  Verbinden Sie die Protokolle vieler Microservices und f√ºhlen Sie wieder, <em>was</em> gute monolithische Anwendungen waren. </p><br><p>  <em>(Und Sie k√∂nnen Request-ID hinzuf√ºgen und verfolgen ...)</em> </p><br><h2 id="logi-s-urovnyami-verbosity">  Protokolle mit Ausf√ºhrlichkeitsstufen </h2><br><blockquote>  Die Anwendung muss eine Umgebungsvariable, z. B. LOG_LEVEL, mit mindestens zwei Betriebsmodi unterst√ºtzen: ERRORS und DEBUG. </blockquote><p>  Es ist w√ºnschenswert, dass alle Dienste im selben √ñkosystem dieselbe Umgebungsvariable unterst√ºtzen.  Keine Konfigurationsoption, keine Option in der Befehlszeile (obwohl dies nat√ºrlich umkehrbar ist), sondern standardm√§√üig sofort aus der Umgebung.  Sie sollten in der Lage sein, so viele Protokolle wie m√∂glich zu erhalten, wenn etwas schief geht, und so wenige Protokolle wie m√∂glich, wenn alles in Ordnung ist. </p><br><h2 id="fiksirovannye-versii-zavisimostey">  Abh√§ngigkeitsversionen behoben </h2><br><blockquote>  Abh√§ngigkeiten f√ºr Paketmanager sind behoben, einschlie√ülich kleinerer Versionen (z. B. cool_framework = 2.5.3). </blockquote><p>  Dies wurde nat√ºrlich schon viel diskutiert.  Einige Fix-Abh√§ngigkeiten von Hauptversionen, in der Hoffnung, dass nur kleinere Fehlerkorrekturen und Sicherheitskorrekturen in kleineren Versionen enthalten sind.  Das ist nicht richtig. <br>  Jede √Ñnderung in jeder Abh√§ngigkeit sollte in einem <em>separaten Commit</em> widergespiegelt <em>werden</em> .  Damit es bei Problemen storniert werden kann.  Ist es schwer mit den H√§nden zu kontrollieren?  Es gibt n√ºtzliche Roboter <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wie diesen</a> , die Aktualisierungen verfolgen und Pull-Anfragen f√ºr jeden von Ihnen erstellen. </p><br><h2 id="dockerized">  Dockerisiert </h2><br><blockquote>  Das Repository enth√§lt die produktionsbereite Docker-Datei und die Datei docker-compose.yml </blockquote><p>  Docker ist seit langem der Standard f√ºr viele Unternehmen.  Es gibt Ausnahmen, aber selbst wenn Sie Docker nicht in der Produktion haben, sollte jeder Ingenieur in der Lage sein, Docker-Kompositionen durchzuf√ºhren und an nichts anderes zu denken, um eine Entwickler-Assembly f√ºr die lokale √úberpr√ºfung zu erhalten.  Und der Systemadministrator muss die Assembly bereits von den Entwicklern mit den erforderlichen Versionen von Bibliotheken, Dienstprogrammen usw. √ºberpr√ºfen lassen, in denen die Anwendung <em>zumindest irgendwie funktioniert</em> , um sie an die Produktion anzupassen. </p><br><h2 id="konfiguraciya-cherez-okruzhenie">  Umgebungskonfiguration </h2><br><blockquote>  Alle wichtigen Konfigurationsoptionen werden aus der Umgebung gelesen, und die Umgebung hat Vorrang vor Konfigurationsdateien (jedoch niedriger als Befehlszeilenargumente beim Start). </blockquote><p>  Niemand wird jemals Ihre Konfigurationsdateien lesen und deren Format studieren wollen.  Akzeptiere es einfach. </p><br><p>  Weitere Details hier: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://12factor.net/config</a> </p><br><h2 id="readiness-and-liveness-probes">  Bereitschafts- und Lebendigkeitssonden </h2><br><blockquote>  Enth√§lt geeignete Endpunkte oder CLI-Befehle, um die Bereitschaft zu testen, Anforderungen beim Start und bei der Verf√ºgbarkeit w√§hrend des gesamten Lebens zu bearbeiten. </blockquote><p>  Wenn die Anwendung HTTP-Anforderungen bearbeitet, sollte sie standardm√§√üig zwei Schnittstellen haben: </p><br><ol><li><p>  Um zu √ºberpr√ºfen, ob die Anwendung aktiv ist und nicht einfriert, wird ein Liveness-Test verwendet.  Wenn die Anwendung nicht reagiert, wird sie m√∂glicherweise automatisch von Orchestratoren wie Kubernetes gestoppt, " <em>aber dies ist nicht korrekt</em> ."  Tats√§chlich kann das Beenden einer eingefrorenen Anwendung einen Dominoeffekt verursachen und Ihren Service dauerhaft beeintr√§chtigen.  Dies ist jedoch kein Entwicklerproblem. F√ºhren Sie einfach diesen Endpunkt aus. </p><br></li><li><p>  Um zu √ºberpr√ºfen, ob die Anwendung nicht gerade gestartet wurde, sondern bereit ist, Anforderungen anzunehmen, wird ein Bereitschaftstest durchgef√ºhrt.  Wenn die Anwendung eine Verbindung zur Datenbank, zum Warteschlangensystem usw. hergestellt hat, sollte sie mit einem Status von 200 bis 400 (f√ºr Kubernetes) antworten. </p><br></li></ol><br><h2 id="ogranicheniya-resursov">  Ressourcenlimits </h2><br><blockquote>  Enth√§lt Beschr√§nkungen f√ºr den Verbrauch von Speicher, CPU, Speicherplatz und anderen verf√ºgbaren Ressourcen in einem konsistenten Format. </blockquote><p>  Die spezifische Implementierung dieses Elements wird in verschiedenen Organisationen und f√ºr verschiedene Orchestratoren sehr unterschiedlich sein.  Diese Grenzwerte m√ºssen jedoch f√ºr alle Dienste in einem einzigen Format festgelegt werden, f√ºr verschiedene Umgebungen (prod, dev, test, ...) unterschiedlich sein und sich <em>au√üerhalb des Repositorys mit Anwendungscode befinden</em> . </p><br><h2 id="sborka-i-dostavka-avtomatizirovana">  Montage und Lieferung erfolgen automatisiert </h2><br><blockquote>  Das in Ihrer Organisation oder Ihrem Projekt verwendete CI / CD-System ist konfiguriert und kann die Anwendung gem√§√ü dem akzeptierten Workflow an die gew√ºnschte Umgebung liefern. </blockquote><p>  <em>Nichts wird jemals manuell an die Produktion geliefert.</em> </p><br><p>  Unabh√§ngig davon, wie schwierig es ist, die Montage und Lieferung Ihres Projekts zu automatisieren, muss dies erfolgen, bevor dieses Projekt in Produktion geht.  Dieser Artikel umfasst das Erstellen und Ausf√ºhren von Ansible / Chef-Kochb√ºchern / Salt / ..., das Erstellen von Anwendungen f√ºr mobile Ger√§te, das Erstellen einer Verzweigung des Betriebssystems und das Erstellen von Images virtueller Maschinen usw. <br>  Kann nicht automatisieren?  Sie k√∂nnen dies also nicht in die Welt bringen.  Nach dir wird niemand es sammeln. </p><br><h2 id="graceful-shutdown--korrektnoe-vyklyuchenie">  Anmutiges Herunterfahren - korrektes Herunterfahren </h2><br><blockquote>  Die Anwendung kann SIGTERM und andere Signale verarbeiten und ihre Arbeit nach dem Ende der Verarbeitung der aktuellen Aufgabe systematisch unterbrechen. </blockquote><p>  Dies ist ein √§u√üerst wichtiger Punkt.  Docker-Prozesse werden verwaist und arbeiten monatelang im Hintergrund, wo niemand sie sieht.  Nichttransaktionsvorg√§nge werden w√§hrend der Ausf√ºhrung unterbrochen und f√ºhren zu Dateninkonsistenzen zwischen Diensten und Datenbanken.  Dies f√ºhrt zu Fehlern, die nicht vorhersehbar und sehr, sehr teuer sein k√∂nnen. </p><br><p>  Wenn Sie keine Abh√§ngigkeiten kontrollieren und nicht garantieren k√∂nnen, dass Ihr Code SIGTERM korrekt verarbeitet, verwenden Sie etwas wie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dummes Init</a> . </p><br><p>  Mehr Infos hier: </p><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://12factor.net/disposability</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">https://kubernetes.io/docs/concepts/workloads/pods/pod/#termination-of-pods</a> </li></ul><br><h2 id="soedinenie-s-bazoy-dannyh-regulyarno-proveryaetsya">  Die Datenbankverbindung wird regelm√§√üig √ºberpr√ºft </h2><br><blockquote>  Die Anwendung pingt st√§ndig einen Ping an die Datenbank und reagiert automatisch auf die Ausnahme ‚ÄûVerbindungsverlust‚Äú f√ºr alle Anforderungen. Sie versucht, diese selbst wiederherzustellen oder beendet ihre Arbeit ordnungsgem√§√ü </blockquote><p>  Ich habe viele F√§lle gesehen (dies ist nicht nur eine Wendung), in denen Dienste, die f√ºr die Verarbeitung von Warteschlangen oder Ereignissen erstellt wurden, ihre Verbindung durch Zeit√ºberschreitung verloren und endlos Fehler in die Protokolle eingaben, Nachrichten an Warteschlangen zur√ºckgaben, sie an die Warteschlange f√ºr tote Briefe schickten oder einfach ihre Arbeit nicht erledigten. </p><br><h2 id="masshtabiruetsya-gorizontalno">  Horizontal skaliert </h2><br><blockquote>  Mit zunehmender Auslastung reicht es aus, mehr Anwendungsinstanzen auszuf√ºhren, um sicherzustellen, dass alle Anforderungen oder Aufgaben verarbeitet werden. </blockquote><p>  Nicht alle Anwendungen k√∂nnen horizontal skaliert werden.  Ein markantes Beispiel sind die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Kafka-Verbraucher</a> .  Dies ist nicht unbedingt schlecht, aber wenn eine bestimmte Anwendung nicht zweimal gestartet werden kann, m√ºssen alle interessierten Parteien dies im Voraus wissen.  Diese Informationen sollten ein Dorn im Auge sein, in der Readme-Datei h√§ngen und wo immer m√∂glich.  Einige Anwendungen k√∂nnen im Allgemeinen unter keinen Umst√§nden parallel gestartet werden, was zu ernsthaften Schwierigkeiten bei der Unterst√ºtzung f√ºhrt. </p><br><p>  Es ist viel besser, wenn die Anwendung selbst diese Situationen steuert oder ein Wrapper daf√ºr geschrieben wird, der "Konkurrenten" effektiv √ºberwacht und es dem Prozess einfach nicht erlaubt, die Arbeit zu starten oder zu starten, bis ein anderer Prozess seine Arbeit abgeschlossen hat oder bis eine externe Konfiguration N Prozesse gleichzeitig arbeiten l√§sst. </p><br><h2 id="dead-letter-queues-i-ustoychivost-k-plohim-soobscheniyam">  Warteschlangen f√ºr tote Briefe und schlechte Ausfallsicherheit von Nachrichten </h2><br><blockquote>  Wenn der Dienst auf Warteschlangen wartet oder auf Ereignisse reagiert, f√ºhrt das √Ñndern des Formats oder Inhalts von Nachrichten nicht zu deren Ausfall.  Nicht erfolgreiche Versuche, die Aufgabe zu verarbeiten, werden N-mal wiederholt. Danach wird die Nachricht an die Dead Letter Queue gesendet. </blockquote><p>  Oft habe ich gesehen, wie Verbraucher und Leitungen, die so gro√ü geworden sind, dass ihre anschlie√üende Verarbeitung viele Tage dauerte, endlos neu gestartet wurden.  Jeder Warteschlangen-Listener sollte darauf vorbereitet sein, das Format zu √§ndern, zuf√§llige Fehler in der Nachricht selbst (z. B. Eingabe von Daten in JSON) oder wenn diese vom untergeordneten Code verarbeitet werden.  Ich bin sogar auf eine Situation gesto√üen, in der die Standard-RabbitMQ-Bibliothek f√ºr ein √§u√üerst beliebtes Framework keine Wiederholungsversuche, Versuchsz√§hler usw. unterst√ºtzte. </p><br><p>  Schlimmer noch, wenn eine Nachricht im Fehlerfall einfach zerst√∂rt wird. </p><br><h2 id="ogranichenie-na-kolichestvo-obrabatyvaemyh-soobscheniy-i-zadach-odnim-processom">  Begrenzung der Anzahl der verarbeiteten Nachrichten und Aufgaben pro Prozess </h2><br><blockquote>  Es unterst√ºtzt eine Umgebungsvariable, die gezwungen werden kann, die maximale Anzahl verarbeiteter Aufgaben zu begrenzen. Danach wird der Dienst ordnungsgem√§√ü heruntergefahren. </blockquote><p>  Alles flie√üt, alles √§ndert sich, besonders die Erinnerung.  Das stetig wachsende Diagramm des Speicherverbrauchs und des am Ende get√∂teten OOM ist die Norm in modernen kubernetischen K√∂pfen.  Die Implementierung eines primitiven Tests, der Ihnen sogar die Notwendigkeit erspart, all diese Speicherlecks zu untersuchen, w√ºrde Ihnen das Leben erleichtern.  Ich habe oft gesehen, dass Leute viel Zeit und M√ºhe (und Geld) aufwenden, um diesen Umsatz zu stoppen, aber es gibt keine Garantie daf√ºr, dass das n√§chste Engagement Ihres Kollegen ihn nicht verschlimmert.  Wenn die Anwendung eine Woche √ºberleben kann, ist dies ein guter Indikator.  Lassen Sie es dann einfach von selbst enden und neu gestartet werden.  Dies ist besser als SIGKILL (zu SIGTERM siehe oben) oder die Ausnahme "Nicht gen√ºgend Speicher".  F√ºr ein paar Jahrzehnte reicht dieser Stecker f√ºr Sie. </p><br><h2 id="ne-ispolzuet-third-party-integracii-s-filtraciey-po-ip-adresam">  Verwendet keine Drittanbieter-Integration mit Filterung nach IP-Adressen </h2><br><blockquote>  Wenn die Anwendung Anforderungen an einen Drittanbieter-Dienst stellt, der den Zugriff von begrenzten IP-Adressen erm√∂glicht, f√ºhrt der Dienst diese Aufrufe indirekt √ºber einen Reverse-Proxy aus. </blockquote><p>  Dies ist ein seltener Fall, aber √§u√üerst unangenehm.  Es ist sehr unpraktisch, wenn ein winziger Dienst die M√∂glichkeit blockiert, den Cluster zu √§ndern oder die gesamte Infrastruktur in eine andere Region zu verlagern.  Wenn Sie mit jemandem kommunizieren m√ºssen, der nicht wei√ü, wie man oAuth oder VPN verwendet, konfigurieren Sie den <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Reverse-Proxy</a> im Voraus.  Implementieren Sie in Ihrem Programm nicht das dynamische Hinzuf√ºgen / Entfernen solcher externer Integrationen, da Sie sich dadurch in die einzig verf√ºgbare Laufzeit einnageln.  Es ist besser, diese Prozesse sofort zu automatisieren, um Nginx-Konfigurationen zu verwalten, und ihn in Ihrer Anwendung zu kontaktieren. </p><br><h2 id="ochevidnyy-http-user-agent">  Offensichtlicher HTTP-Benutzeragent </h2><br><blockquote>  Der Dienst ersetzt den User-Agent-Header durch einen benutzerdefinierten f√ºr alle Anforderungen an eine API, und dieser Header enth√§lt gen√ºgend Informationen √ºber den Dienst selbst und seine Version. </blockquote><p>  Wenn 100 verschiedene Anwendungen miteinander kommunizieren, k√∂nnen Sie verr√ºckt werden, wenn Sie in den Protokollen etwas wie "Go-http-client / 1.1" und die dynamische IP-Adresse des Kubernetes-Containers sehen.  Identifizieren Sie Ihre Anwendung und ihre Version immer explizit. </p><br><h2 id="ne-narushaet-licenzii">  Verst√∂√üt nicht gegen die Lizenz </h2><br><blockquote>  Es enth√§lt keine Abh√§ngigkeiten, die die Anwendung √ºberm√§√üig einschr√§nken, es ist keine Kopie des Codes einer anderen Person und so weiter. </blockquote><p>  Dies ist ein selbstverst√§ndlicher Fall, aber es stellte sich heraus, dass selbst der Anwalt, der die NDA schrieb, jetzt Schluckauf hat. </p><br><h2 id="ne-ispolzuet-nepodderzhivaemye-zavisimosti">  Verwendet keine nicht unterst√ºtzten Abh√§ngigkeiten </h2><br><blockquote>  Wenn Sie den Dienst zum ersten Mal starten, enth√§lt er keine bereits veralteten Abh√§ngigkeiten. </blockquote><p>  Wenn die Bibliothek, die Sie in das Projekt aufgenommen haben, von niemandem mehr unterst√ºtzt wird, suchen Sie nach einem anderen Weg, um das Ziel zu erreichen, oder entwickeln Sie die Bibliothek selbst. </p><br><h2 id="zaklyuchenie">  Fazit </h2><br><p>  Es gibt einige sehr spezifische √úberpr√ºfungen auf meiner Liste f√ºr bestimmte Technologien oder Situationen, aber ich habe nur vergessen, etwas hinzuzuf√ºgen.  Ich bin sicher, Sie werden auch etwas finden, an das Sie sich erinnern k√∂nnen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de438064/">https://habr.com/ru/post/de438064/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de438050/index.html">Kalman-Filter zur Minimierung des Entropiewertes eines zuf√§lligen Fehlers mit einer nicht-Gau√üschen Verteilung</a></li>
<li><a href="../de438052/index.html">Interaktor, Betriebsmuster</a></li>
<li><a href="../de438058/index.html">"Datenanalyse in Python" in zwei Teilen</a></li>
<li><a href="../de438060/index.html">Einsch√§tzung der r√§umlichen Ausrichtung oder Wie man keine Angst vor Mahoney- und Majwik-Filtern hat</a></li>
<li><a href="../de438062/index.html">Meine Adresse ist kein Haus oder eine Stra√üe, meine Adresse ist die Sowjetunion?</a></li>
<li><a href="../de438066/index.html">10 lehrreiche YouTube-Kan√§le auf Englisch, von denen Sie noch nie geh√∂rt haben</a></li>
<li><a href="../de438070/index.html">Wie wurde aus der Generation Y eine ausgebrannte Generation?</a></li>
<li><a href="../de438074/index.html">[Ank√ºndigung f√ºr Jekaterinburg, Nowosibirsk, St. Petersburg] QAutomationstestsitzung: Wir werden alles von der Newa bis zum Ob mit Tests abdecken</a></li>
<li><a href="../de438078/index.html">Facebook zahlt 20 US-Dollar pro Monat f√ºr die Einrichtung seines Pseudo-VPN</a></li>
<li><a href="../de438080/index.html">Elektronik mit Wi-Fi-Signal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>