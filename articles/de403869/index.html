<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üöâ üö∑ üèê Meine Erfahrung mit der Schaffung eines ‚Äûno smart‚Äú -Hauses üê† üí≠ üõ•Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Meine Zeit ist gekommen, um meine Erfahrungen mit der Schaffung eines ‚Äûohne ein intelligentes‚Äú Zuhause zu teilen. Ich m√∂chte mich nicht wirklich auf P...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Meine Erfahrung mit der Schaffung eines ‚Äûno smart‚Äú -Hauses</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403869/">  Meine Zeit ist gekommen, um meine Erfahrungen mit der Schaffung eines ‚Äûohne ein intelligentes‚Äú Zuhause zu teilen.  Ich m√∂chte mich nicht wirklich auf Polemik einlassen, was ein Smart Home √ºberhaupt ist und was es tun sollte.  In meinem Fall werden wir die WLAN-Module Sonoff von ITEAD z√§hmen und lernen, das "Laden" vom Telefon aus ein- und auszuschalten.  In der Ver√∂ffentlichung wird erl√§utert, wie Sie ein Modul flashen, einen Temperatur- / Feuchtigkeitssensor an das Modul anschlie√üen und wie Sie das Modul √ºber die Anwendungen HomeKit ("Home") und Siri steuern.  Hinzu kommt das Domoticz Smart Home Management System auf Himbeer-Pi.  F√ºgen Sie der Kaffeemaschine WLAN hinzu und bringen Sie Siri bei, die Gegensprechanlage zu √∂ffnen. <br><a name="habracut"></a><br>  Ich habe drei herk√∂mmliche Sonoff-Module und ein SV (Safe Voltage) zum Testen bestellt.  Zum Zeitpunkt der Bestellung ist das √ºbliche 4,85-Modul nach Lagerbestand immer gr√ºn, obwohl der Lagerbestand unbefristet aussieht.  SV zu einem √§hnlichen Preis von 4,85.  Bei Lieferung in die Ukraine betrugen die Gesamtkosten 26 gr√ºne.  China und China in Afrika, China, das Geld ist weg, und die Waren haben noch drei Wochen zu erwarten, und vielleicht noch mehr.  Man k√∂nnte sicher in der Ukraine kaufen und nicht warten, aber dann etwas teurer. <br><br><h2>  Die Freuden der ersten Schritte in Richtung eines ‚Äûohne intelligentes‚Äú Zuhause </h2><br>  Es kamen vier Module, die √ºblichen sind in Kartons verpackt, und der SV befindet sich nur in einer antistatischen Tasche.  Der Fall und die Gr√∂√üe zufrieden. <br><br><img src="https://habrastorage.org/web/b03/b90/90e/b03b9090e5f2437fa0fc84260c747fff.jpg"><br><br>  Ich werde den Prozess der Installation nativer e-Welink-Software und des Verbindens des Moduls mit dem Heimnetzwerk nicht beschreiben, Anweisungen in beliebigen Sprachen im Internet, nimm es - ich m√∂chte nicht. <br><br>  Ohne nachzudenken, gehen wir in den Korridor und f√ºgen dieses Modul der Deckenlampe hinzu.  Das Modul ist klein, es ist viel Platz in der Lampe.  Das Licht im Korridor bleibt oft an, und jetzt k√∂nnen Sie das Licht im Bett vor dem Fernseher ausschalten.  Die Wohnung wurde bereits √ºberall repariert und konventionelle Schalter installiert.  Ber√ºhren Sie nicht die Reparatur und verwenden Sie die vorhandene Verkabelung. <br><br>  Es stellt sich folgende Arbeitslogik heraus: <br><br>  - Der Schalter ist ausgeschaltet, dann funktioniert das Modul auch nicht; <br>  - Wenn der Schalter eingeschaltet ist, kann das Licht von der Anwendung aus ausgeschaltet werden. <br>  - Der Schalter ist eingeschaltet und das Licht wurde w√§hrend der Anwendung ausgeschaltet. Um das Licht einzuschalten, muss der Schalter ein- und ausgeschaltet werden, nachdem das Modul ‚ÄûStromversorgung im Abschnitt‚Äú auf EIN gestellt wurde (wenn das Relaismodul eingeschaltet ist, wird das Licht eingeschaltet). <br><br>  Freut euch. <br><br>  Das zweite Modul wurde der Lampe im Schlafzimmer hinzugef√ºgt.  Dann war die Lampe nicht so ger√§umig wie im Korridor.  Ich musste den Fall ein wenig feilen und den Knopf reduzieren / abschneiden, er passte nicht in die H√∂he.  Dann ist das Modul ordentlich in der Lampe versteckt. <br><br><h3>  Wir machen den Schalter unter dem Knopf neu </h3><br>  In der Wohnung sind Schalter der Schneider Unica-Serie installiert.  Sie k√∂nnen einen solchen Schalter neu herstellen, indem Sie eine Feder unter den Schl√ºssel stellen, und der Ort wurde bereits im Voraus vorbereitet. <br><br>  W√§hrend sie im Internet schreiben, k√∂nnen Sie die Feder aus Kugelschreibern ausprobieren.  Meine Versuche, eine Feder mit einem Kugelschreiber zu installieren, schlugen fehl.  Eine sehr schwache Feder und mangelnde Steifigkeit bringen den Schl√ºssel wieder in seine urspr√ºngliche Position. <br><br>  Die urspr√ºngliche Schneider-Feder hat die folgenden Eigenschaften: d = 3,6 mm, Drahtst√§rke 0,6 mm, H√∂he 10 mm.  Ich habe es nicht selbst gehalten, ich habe es nicht zum Verkauf gefunden, ich habe Informationen √ºber den Fr√ºhling in einem der Foren gefunden. <br><br>  Nach dem Durchsuchen des Hauses wurde eine √§hnliche Feder gefunden, die ziemlich elastisch war und erfolgreich zum Schalter hinzugef√ºgt wurde.  Ohne einen Cent auszugeben, bekommen wir einen Knopf anstelle eines Schalters. <br><br><img src="https://habrastorage.org/web/092/72f/5ea/09272f5ea6f34969a9ce5c4774039141.jpg"><br>  <i>Es sieht aus wie ein Schalter mit einer installierten Feder.</i> <br><br>  Jetzt haben wir immer das Modul mit Strom und im Netzwerk.  In den Einstellungen legen wir fest, dass das Modul beim Einschalten des Moduls den Status des Relais √§ndert. <br><br>  Die Logik der Arbeit in diesem Fall: <br><br>  - Am Sonoff-Modul ist immer Strom vorhanden, wodurch das Licht w√§hrend der Anwendung ein- und ausgeschaltet wird. <br>  - Durch Dr√ºcken der Taste wird die Stromversorgung unterbrochen und das Relais wechselt in den entgegengesetzten Zustand. <br><br>  Wir k√∂nnen die Last sowohl am Switch als auch √ºber die Anwendung steuern.  Die native Anwendung und das native Modul arbeiten √ºber einen chinesischen Server. <br><br>  Ja, ja, ich wei√ü, w√§hrend der Nacht gibt es einen Sprung / eine Unterbrechung, das Einschalten der Spannung und das Licht geht an.  W√§hrend des Betriebs des Moduls war dies noch nie zuvor passiert, aber wir leben in der Ukraine und die Schlagzeilen sind voller Versprechungen von Stromausf√§llen. <br><br>  Auf dem Tisch liegt das dritte Modul.  Wo bist du lieb  Und wir werden Ihren Eingeborenen ausw√§hlen und sp√∂ttisch sein! <br><br><h2>  Alternative Firmware installieren </h2><br>  Eine Autopsie ergab, <s>dass der Patient an einer Autopsie gestorben ist und</s> dass unter dem Kamm Platz f√ºr 5 Stifte ist. <br><br><img src="https://habrastorage.org/web/643/e5a/1f4/643e5a1f425645aab6056fce519173d8.jpg"><br><br>  √úber die Schaltfl√§che am Geh√§use (3,3 V Rx, Tx, GND, GPIO 14).  L√∂tkolben in der Hand und USB-zu-TTL-Adapter anschlie√üen.  In meinem USB-zu-TTL-Adapter sind 3,3 V vorhanden. Ich habe nicht versucht, das Modul mit 5 V zu versorgen, und ich empfehle es nicht. <br><br>  Als n√§chstes kommt der Software-Teil.  F√ºr solche Module gibt es <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Firmware</a> auf dem Github.  Jetzt ist bereits eine neue Version der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Firmware</a> erschienen.  Was n√ºtzt diese Firmware?  Es gibt Web Control, MQTT-Protokoll, OTA (Over the Air) - Firmware √ºber Funk.  Was die native Firmware betrifft, das mqtt-Protokoll in den Versprechungen hinzuzuf√ºgen, ist OTA ebenfalls vorhanden, jedoch nur f√ºr sich.  Der Nachteil der nativen Firmware besteht darin, dass sie nur funktioniert, wenn sie mit dem globalen Netzwerk verbunden ist.  Warum brauchen wir das?  Zu diesem Zeitpunkt ist dies nicht erforderlich, zumal wir nicht wissen, was und wohin unser Modul sendet. <br><br>  Installieren Sie die Arduino IDE.  Ich habe die tragbare Version 1.8.1 installiert.  F√ºr die Firmware ist die Version IDE 1.6.10 oder h√∂her erforderlich. <br><br>  - Unterst√ºtzung f√ºr ESP8266-Module hinzuf√ºgen <br>  - Installieren Sie <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">pubsubclient</a> <br>  ‚óã Suchen Sie die Datei src \ PubSubClient.h und √§ndern Sie den Wert von MQTT_MAX_PACKET_SIZE auf 400 oder mehr (jetzt fordern Tasmot-Versionen einen Wert von 500 oder h√∂her an). <br><br>  Laden Sie die Skizze herunter, stellen Sie sie mit gekreuzten Fingern zusammen und hoffen Sie, dass alles reibungslos verlief.  Dies war nicht mein Fall, wir haben den Fehler gelesen und die erforderlichen Bibliotheken hinzugef√ºgt, die nicht vorhanden waren.  Ein paar Stunden qu√§len und Firmware ohne Fehler haben.  (Das Hauptproblem war, dass ich die Arduino IDE unter Win XP installiert habe).  Bearbeiten Sie die Konfigurationsdatei und geben Sie unsere Firmware ein. <br><br>  Das paar Minimum, das ich in User_config.h regiert habe. <br><br><div class="spoiler">  <b class="spoiler_title">User_config.h</b> <div class="spoiler_text"><code>#define PROJECT "bath" //   -         <br> #define STA_SSID1 "your_wifi_station_id" //    <br> #define STA_PASS1 "your_pass" //     <br> #define STA_SSID2 "your_wifi_station_id_plus" //      <br> #define STA_PASS2 " " //      <br> <br> #define SYS_LOG_HOST "192.168.." //  ,    raspberry pi,    <br> //#define USE_I2C //      <br> //#define USE_IR_REMOTE <br> //#define USE_WS2812</code> <br> </div></div><br>  Abh√§ngig von der Version k√∂nnen andere Einstellungen hinzugef√ºgt werden, die ich unn√∂tig ausschalten w√ºrde.  In der neuesten Firmware (Tasmota) k√∂nnen immer mehr Einstellungen √ºber das Webeinstellungsmen√º vorgenommen und mit User_config.h dupliziert werden. <br><br><h3>  Skizzenf√ºllung: </h3><br>  - Schalten Sie das Modul aus (auf bequeme Weise). <br>  - Halten Sie die Taste am Modul gedr√ºckt und schlie√üen Sie die Stromversorgung an.  Das Modul ist bereit, Firmware zu empfangen. <br>  - Klicken Sie in der IDE auf OK und dr√ºcken Sie erneut die Daumen. Wir warten, bis die Firmware auf das Modul hochgeladen wird. <br><br>  Im Falle eines Fehlers √ºberpr√ºfen wir die Dr√§hte und ob √ºberall alles fest verschraubt ist oder ob nicht gen√ºgend Strom von USB zu TTL vorhanden ist und wir eine externe Quelle ben√∂tigen.  Wir tanzen mit einem Tamburin und wiederholen den Vorgang. <br><br>  <b>Wichtig: Die</b> <i>Stromversorgung des Moduls erfolgt nur √ºber 3,3-V-Pins.</i>  <i>Es kann nicht √ºber die Stromversorgung des Moduls selbst an die Stromlast angeschlossen werden.</i>  <i>Erfahrene Benutzer schreiben, dass die Versorgung des Moduls mit 220 V mit Firmware zu einem kleinen, aber feinen Baustein wird.</i>  Ich habe es nicht versucht, ich wei√ü es nicht.  Daher werden beim Flashen des Moduls nur vier Kabel an die Pins angeschlossen, und wir entfernen alles andere. <br><br>  Wenn alles in Ordnung ist, sollte das Modul nach dem Neustart eine Verbindung zum Access Point herstellen, die IP-Adresse suchen und im Browser darauf zugreifen. <br><br><img src="https://habrastorage.org/web/c96/316/9a0/c963169a05594c6791d9dfdd706b365e.png"><br>  <i>Das Erscheinungsbild der Startseite.</i> <br><br>  Wenn das Modul keine Verbindung zu Ihrem Zugangspunkt herstellt, tanzen Sie mit einem Tamburin weiter.  Es gibt verschiedene L√∂sungen, im Rahmen dieses Artikels werde ich nicht beschreiben.  Ich habe die Konfigurationen √ºberpr√ºft und das Modul einfach erneut geflasht. <br><br>  Jetzt haben wir Webzugriff auf das Modul und seine Einstellungen, mqtt, die Dr√§hte k√∂nnen in eine Schublade gelegt werden, Firmware / Update auf dem Luftweg durchgef√ºhrt. <br><br><h3>  Und wo ist Siri? </h3><br>  All dies ist sicherlich wunderbar, es ist Zeit zu lernen, wie man mit dem Guten vom Telefon aus umgeht.  Ich habe mehrere Programme aus der App f√ºr das iPhone ausprobiert und nichts Interessantes bekommen.  Es wurde beschlossen, auf die Home-Anwendung oder das HomeKit zuzugreifen, mit denen auch Module √ºber Siri gesteuert werden k√∂nnen. <br><br>  Wir finden im Regal Raspberry Pi und verbinden uns mit dem Netzwerk.  In meinem Fall war bereits eine "Himbeere" mit dem Netzwerk verbunden.  Wie man das Betriebssystem installiert und die "Himbeeren" anschlie√üt, um es zu beschreiben, macht keinen Sinn. <br><br>  Um mit HomeKit zu kommunizieren, m√ºssen Sie Homebridge installieren.  Homebridge ist ein NodeJS-Server, der in Ihrem lokalen Netzwerk ausgef√ºhrt wird und die iOS HomeKit-API emuliert. <br><br><pre> <code class="bash hljs">sudo apt-get update sudo apt-get upgrade sudo apt-get install git make sudo apt-get install g++</code> </pre><br>  Abh√§ngig von Ihrem System m√ºssen Sie m√∂glicherweise den C ++ - Compiler aktualisieren. <br><br>  Installieren Sie Nodejs.  Wir gehen in den Laden und w√§hlen den passenden <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">dist aus</a> .  Kopieren Sie die Adresse der Distribution und weiter im Bild <br><br><pre> <code class="bash hljs">wget https://nodejs.org/dist/v4.0.0/node-v4.0.0-linux-armv6l.tar.gz tar -xvf node-v4.0.0-linux-armv6l.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> node-v4.0.0-linux-armv6l sudo cp -R * /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/</code> </pre> <br>  Ich habe v6.9.4 f√ºr mich installiert, jetzt gibt es neuere. <br><br>  F√ºgen Sie weitere erforderliche Pakete hinzu: <br><br><pre> <code class="bash hljs">sudo apt-get install libavahi-compat-libdnssd-dev</code> </pre> <br>  Installieren Sie Homebridge selbst: <br><br><pre> <code class="bash hljs">sudo npm install -g --unsafe-perm homebridge</code> </pre><br>  Wenn dies nicht funktioniert, versuchen Sie: <br><br><pre> <code class="bash hljs">sudo npm install -g --unsafe-perm homebridge hap-nodejs node-gyp <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/node_modules/homebridge/ sudo npm install --unsafe-perm bignum <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/lib/node_modules/hap-nodejs/node_modules/mdns sudo node-gyp BUILDTYPE=Release rebuild</code> </pre> <br>  Nach der Installation von Homebridge m√ºssen Sie einige weitere Plugins installieren und anschlie√üend die Einstellungen des Homebridge-Servers √§ndern. <br><br>  Die Installation der Plugins erfolgt auf die gleiche Weise wie bei der Homebridge <br><br><pre> <code class="bash hljs">sudo npm install -g --unsafe-perm homebridge-plugin-name</code> </pre> <br>  Das gew√ºnschte Plugin finden wir im <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Paketmanager</a> .  Dort finden wir ein Beispiel f√ºr Einstellungen, die zu unseren Einstellungen hinzugef√ºgt werden m√ºssen. <br><br>  F√ºr einen einfachen Wechsel. <br><br><pre> <code class="bash hljs">npm install -g homebridge-mqttswitch</code> </pre> <br>  Gehen Sie zu den Einstellungen und erstellen Sie die Konfigurationsdatei, falls diese noch nicht erstellt wurde: <br><br><pre> <code class="bash hljs">sudo nano .homebridge/config.json</code> </pre> <br>  Die Konfigurationsdatei lautet wie folgt: <br><br><div class="spoiler">  <b class="spoiler_title">config.json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"bridge"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Homebridge"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"CC:22:3D:E3:CE:30"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-number"><span class="hljs-number">51826</span></span>, <span class="hljs-attr"><span class="hljs-attr">"pin"</span></span>: <span class="hljs-string"><span class="hljs-string">"031-45-154"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"platforms"</span></span>: [ ], <span class="hljs-attr"><span class="hljs-attr">"accessories"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"accessory"</span></span>: <span class="hljs-string"><span class="hljs-string">"mqttswitch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"mqtt://192.168.178.123:1883"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"admin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"admin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"caption"</span></span>: <span class="hljs-string"><span class="hljs-string">"room"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"topics"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"statusGet"</span></span>: <span class="hljs-string"><span class="hljs-string">"stat/sleeping/POWER"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statusSet"</span></span>: <span class="hljs-string"><span class="hljs-string">"cmnd/sleeping/power"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"onValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"offValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"integerValue"</span></span>: <span class="hljs-string"><span class="hljs-string">"true"</span></span> } ] }</code> </pre><br></div></div><br>  √úberpr√ºfen Sie beispielsweise <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">hier,</a> bevor Sie die Einstellungsdatei speichern.  Versuchen Sie nach dem Speichern Folgendes auszuf√ºhren: <br><br><pre> <code class="bash hljs">Homebridge</code> </pre> <br>  Wenn alles beginnt, wird es uns schreiben, so etwas wie: <br><br><pre> <code class="bash hljs"> 11:27:43 PM] [] Initializing mqttswitch accessory...</code> </pre><br>  Dort wird der Code 031-45-154 f√ºr die Verbindung angezeigt, wenn er in den Einstellungen nicht ge√§ndert wurde. <br><br>  Schalten Sie nun das Telefon / Planest mit iOS ein.  Wir finden die Anwendung ‚ÄûHome‚Äú oder ‚ÄûHomeKit‚Äú ‚Üí F√ºgen Sie ein Zubeh√∂r hinzu und warten Sie, bis unser Zubeh√∂r ‚ÄûHomebridge‚Äú angezeigt wird. F√ºgen Sie es hinzu, geben Sie den Code ein und weisen Sie dem Switch einen Raum zu.  Und voila, "Hallo Siri, schalte das Licht im Raum ein / aus" - es hat funktioniert.  "Hi Siri" auf Telefonen der 5. Serie und darunter funktioniert nur, wenn eine Verbindung zum Laden besteht. <br><br>  Wenn bei uns alles richtig funktioniert, muss Homebridge zum Start hinzugef√ºgt werden.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vollst√§ndige Anleitung</a> in Englisch.  In meinem Fall erstellen Sie √ºber <code>init.d</code> die Datei <code>sudo nano /etc/init.d/homebridge</code> <br>  Kopieren Sie die <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Vorlage</a> in eine Datei in dieser Datei und √§ndern Sie sie unter Homebridge <br><br><div class="spoiler">  <b class="spoiler_title">/etc/init.d/homebridge</b> <div class="spoiler_text"> <code>#!/bin/sh <br> ### BEGIN INIT INFO <br> # Provides: homebridge <br> # Required-Start: $network $remote_fs $syslog <br> # Required-Stop: $remote_fs $syslog <br> # Default-Start: 2 3 4 5 <br> # Default-Stop: 0 1 6 <br> # Short-Description: Start daemon at boot time <br> # Description: Enable service provided by daemon. <br> ### END INIT INFO <br> <br> dir="/home/pi" <br> cmd="DEBUG=* /usr/local/bin/homebridge" <br> user="pi" <br></code> <br></div></div><br>  Speichern, beenden. <br><br><pre> <code class="bash hljs">sudo chmod 755 /etc/init.d/homebridge sudo update-rc.d homebridge defaults</code> </pre> <br>  Jetzt startet Homebridge beim Systemstart. <br><br><h3>  Wir befestigen den DHT22 Sensor (Temperatur / Luftfeuchtigkeit) </h3><br>  Ein aufmerksamer Leser bemerkte, dass der Kamm 5 Stifte hat und einer davon ist GPIO 14. Wieder nehmen wir den L√∂tkolben in die Hand und l√∂ten die drei Dr√§hte f√ºr den Feuchtigkeitstemperatursensor DHT22 auf 3,3 V, GND, GPIO 14.  Sie k√∂nnen einen anderen Sensor verwenden (ds18b20, DHT 11 oder einen anderen, der von der Firmware unterst√ºtzt wird), aber es war DHT22 in meiner Box.  Der Sensor wurde √ºber einen Stecker angeschlossen, der an der Seite des nativen Geh√§uses befestigt war.  Bei Bedarf kann ein weiterer Sensor ohne Skalpell und L√∂tkolben angeschlossen werden. <br><br><img src="https://habrastorage.org/web/b68/643/a1f/b68643a1f956407286a799bb1b03d223.jpg"><br><br>  Auf dem Bild habe ich gerade den Stecker repariert, ich habe die Dr√§hte noch nicht angeschlossen.  In der Sonoff-MQTT-OTA-Arduino-Firmware m√ºssen Sie die folgenden Einstellungen √ºberpr√ºfen: <br><br><pre> <code class="hljs lisp">#define DHT_PIN <span class="hljs-number"><span class="hljs-number">14</span></span> // GPIO <span class="hljs-number"><span class="hljs-number">14</span></span> = AM2301 (<span class="hljs-name"><span class="hljs-name">Sonoff_TH10A</span></span>(<span class="hljs-number"><span class="hljs-number">16</span></span>A), Sonoff SV) #define DHT_TYPE AM2301 // DHT module type (<span class="hljs-name"><span class="hljs-name">DHT11</span></span>, DHT21, DHT22, AM2301, AM2302 or AM2321)</code> </pre> <br>  F√ºr die Tasmota-Firmware k√∂nnen der Pin- und Sensortyp in den Webeinstellungen angegeben werden. <br><br>  Wenn alles richtig angeschlossen und konfiguriert ist, werden auf der Weboberfl√§che der Status des Relais und die Sensorwerte angezeigt.  In den Einstellungen k√∂nnen Sie die Abfragerate des Sensors einstellen.  Der Standardwert betr√§gt 300 Sekunden (5 Minuten). <br><br><img src="https://habrastorage.org/web/3a2/4a3/3fb/3a24a33fbb3647979f69354039fb808c.png"><br><br>  Wir suchen nach einem Plug-In f√ºr Homebridge, das mit einem Temperatur- und Feuchtigkeitssensor funktioniert.  Wir m√ºssen diese Messwerte jetzt im Anhang anzeigen.  Ich habe das alles geschafft, aber meiner Meinung nach war es mein Rechen und sollte nicht gemacht werden. <br><br>  Und warum?  Alles ist sehr einfach, nur das Anschrauben des Sensors an den Sonoff macht keinen Sinn. Sie m√ºssen etwas basierend auf diesen Messwerten ein- und ausschalten.  In den Firmware-Einstellungen gibt es jedoch keine solche M√∂glichkeit. Es ist m√∂glich, die Home / HomeKit-Anwendung f√ºr solche Zwecke zu konfigurieren. Sie ben√∂tigen jedoch ein Tablet, das st√§ndig zu Hause ist, oder Apple TV.  Das Vorhandensein der F√§higkeit, mit Domoticz zu kommunizieren, in der Firmware f√ºhrte mich auf diesen schwierigen Weg zur Installation des Domoticz Smart Home-Steuerungssystems. <br><br>  In Form eines kleinen Exkurses habe ich versucht, Plugins mit der Homebridge zu verbinden, mit denen Sie RTSP-Streams von einer Webcam √ºbertragen k√∂nnen.  Ich habe eine IP-Kamera TOP-201 von meinen chinesischen Kollegen. <br><br>  Installieren Sie das Plugin: <br><br><pre> <code class="bash hljs">npm install -g --unsafe-perm homebridge-camera-ffmpeg</code> </pre> <br>  Zur Einstellungsdatei hinzuf√ºgen: <br><br><div class="spoiler">  <b class="spoiler_title">config.json</b> <div class="spoiler_text"><pre> <code class="hljs perl"><span class="hljs-string"><span class="hljs-string">"platforms"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"Camera-ffmpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"cameras"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"top-201"</span></span>, <span class="hljs-string"><span class="hljs-string">"videoConfig"</span></span>: { <span class="hljs-string"><span class="hljs-string">"source"</span></span>: <span class="hljs-string"><span class="hljs-string">"-re -i rtsp://admin@192.168.178.10:554/user=admin_password=tlJwpbo6_channel=1_stream=0.sdp?real_stream"</span></span>, <span class="hljs-string"><span class="hljs-string">"maxStreams"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"maxWidth"</span></span>: <span class="hljs-number"><span class="hljs-number">640</span></span>, <span class="hljs-string"><span class="hljs-string">"maxHeight"</span></span>: <span class="hljs-number"><span class="hljs-number">480</span></span>, <span class="hljs-string"><span class="hljs-string">"maxFPS"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> } } ]</code> </pre> <br></div></div><br>  Dar√ºber hinaus wird in der HomeKit-Anwendung ein Bild von der Kamera angezeigt. Dies alles funktionierte jedoch sehr langsam, und diese Kamera wurde nicht ben√∂tigt.  Um das System nicht unn√∂tig zu laden, habe ich die IP-Kamera gel√∂scht.  Kehren wir zur Installation eines Systems f√ºr die Verwaltung ‚Äûohne intelligentes Zuhause‚Äú zur√ºck. <br><br><h3>  Installieren und konfigurieren Sie Domoticz f√ºr Sonoff-Module </h3><br>  Kitt ‚Üí ssh ‚Üí und wieder pfl√ºcken wir die Himbeere.  √úberraschenderweise erforderte die Installation in meinem Fall kein Tanzen mit einem Tamburin und es war genug <br><br><pre> <code class="bash hljs">sudo curl -L install.domoticz.com | sudo bash</code> </pre><br>  Autostart hinzuf√ºgen: <br><br><pre> <code class="bash hljs">sudo cp domoticz.sh /etc/init.d sudo chmod +x /etc/init.d/domoticz.sh sudo update-rc.d domoticz.sh defaults</code> </pre><br>  √Ñndern Sie gegebenenfalls einige Einstellungen: <br><br><pre> <code class="bash hljs">sudo nano /etc/init.d/domoticz.sh</code> </pre> <br>  √ñffnen Sie die Adresse der Himbeeren <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">192.168.xxx.xxx</a> : 8080.  Und sie sollten zur Domotics-Seite gehen.  Dar√ºber hinaus erfolgt die Konfiguration und Hinzuf√ºgung von Sensoren bereits √ºber das Web. <br><br><img src="https://habrastorage.org/web/130/93c/ab8/13093cab88b54ac498fbd15d17d4536a.png"><br>  <i>Sonoff-Sensoren und ein Stra√üensensor wurden dem Screenshot bereits hinzugef√ºgt.</i> <br><br>  Um Sensoren / Schalter hinzuzuf√ºgen, gehen Sie zu Setup ‚Üí Hardware und f√ºgen Sie Dummy hinzu (funktioniert nicht, nur f√ºr virtuelle Schalter).  Unser "Dummy" erscheint in der Liste der Ger√§te.  Wenn Sie auf Virtuellen Sensor erstellen klicken, rufen Sie unseren Sensor / Schalter an und w√§hlen Sie den gew√ºnschten Typ aus der Liste aus.  Jetzt wird auf der Registerkarte Setup ‚Üí Ger√§te ein neues Ger√§t angezeigt und Sie k√∂nnen dort auch die Ger√§te-IDX sehen. <br><br>  Wir rei√üen die Web-Seite unseres Schalters / Sensors ab und speichern die Konfiguration ‚Üí domoticz ‚Üí idx unseres Schalters.  In der neuen Tasmota-Firmware k√∂nnen mehrere IDX angegeben werden.  F√ºr Relais / Schalter und separat f√ºr GPIO.  Je nach Modul kann dies ein zus√§tzlicher Sensor oder mehr sein, da in der SV-Version zus√§tzlich drei Pins vorhanden sind, denen ihre Rolle in Ihrem System zugewiesen werden kann (Relais / Sensoren). <br><br>  In der alten Firmware (Sonoff-MQTT-OTA-Arduino) f√ºr das Modul musste ich einige T√§nze mit einem Tamburin ausf√ºhren, damit Domoticz die Messwerte f√ºr Feuchtigkeit und Temperatur sah.  Ich denke, es macht hier keinen Sinn, es zu beschreiben, f√ºr die neue Firmware (Tasmota) wird es nicht ben√∂tigt. <br><br>  Entsprechend den Feuchtigkeitswerten k√∂nnen Sie die Haube im Badezimmer steuern.  Wo es einen Abluftventilator gibt, ist genug Platz f√ºr das Modul und wir haben bereits alles, was wir brauchen.  Es bleibt nur die Einstellung der Steuerung f√ºr Feuchtigkeitswerte. <br><br>  Setup ‚Üí Weitere Optionen ‚Üí Ereignisse <br><br><img src="https://habrastorage.org/web/6ec/865/203/6ec865203b894f579e3fb3c1f0d62261.png"><br><br>  Mit dem Konstruktor erstellen wir die Haubenoperationslogik (wie im Bild).  Du kannst immer noch auf Lua, aber das ist nicht mein Fall.  Weitere Erfahrungen haben gezeigt, dass 5 Minuten Abfrage des Sensors zu gro√ü sind und ich ihn auf 3 Minuten reduziert habe.  Wenn Sie jetzt duschen und die Luftfeuchtigkeit √ºber 70% steigt, schaltet sich die Haube ein.  Wenn es anschlie√üend unter 45% reduziert wird, wird es ausgeschaltet.  Feuchtigkeitsdaten experimentell ausgew√§hlt.  Das einzig Negative, oder vielleicht ist dies kein Minus, sondern eine Funktion des Systems. Wenn Sie das Einschalten der Haube durch Dr√ºcken einer Taste erzwingen, wird das System nach 3 Minuten nach Abfrage des Feuchtigkeitssensors ausgeschaltet. <br><br>  Aber was ist mit Siri?  Es stellte sich heraus, dass alles sehr einfach ist. <br><br><pre> <code class="bash hljs">sudo npm install -g -g --unsafe-perm homebridge-edomoticz</code> </pre><br>  Und zu den Einstellungen hinzuf√ºgen <br><br><pre> <code class="bash hljs">sudo nano .homebridge/config.json</code> </pre><br><pre> <code class="hljs objectivec"> <span class="hljs-string"><span class="hljs-string">"platform"</span></span>: <span class="hljs-string"><span class="hljs-string">"mqtt"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"mqtt"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"mqtt://127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"topic_prefix"</span></span>: <span class="hljs-string"><span class="hljs-string">"homebridge"</span></span>, <span class="hljs-string"><span class="hljs-string">"username"</span></span>: <span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"password"</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span></code> </pre><br>  Und wenn Sie Homebridge starten, bekommen wir <br><br><pre> <code class="bash hljs">[5/8/2017, 11:42:30 PM] [eDomoticz] You have 10 devices defined <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Domoticz. [5/8/2017, 11:42:30 PM] [eDomoticz] Initializing platform accessory <span class="hljs-string"><span class="hljs-string">'bath-temp'</span></span>... [5/8/2017, 11:42:30 PM] [eDomoticz] Initializing platform accessory <span class="hljs-string"><span class="hljs-string">' '</span></span>... [5/8/2017, 11:42:30 PM] [eDomoticz] Initializing platform accessory <span class="hljs-string"><span class="hljs-string">' '</span></span>... [5/8/2017, 11:42:30 PM] [eDomoticz] Initializing platform accessory <span class="hljs-string"><span class="hljs-string">''</span></span>...</code> </pre><br>  Alle Ger√§te, die wir zu Domotics hinzugef√ºgt haben, werden jetzt in Homekit unter unseren Ger√§ten angezeigt, und Sie k√∂nnen sie √ºber einen Freund Siri steuern.  Der Bedarf an anderen Plugins f√ºr Homebridge ist irgendwie verschwunden. <br><br>  Wir haben ein paar Domoticz-Homebridge und alles funktioniert sehr gut und stabil.  Bereits nicht im ersten Monat getestet. <br><br>  Ein Temperatur- / Feuchtigkeitssensor DHT22 aus fr√ºheren Handwerken wird am Raspberry Pi befestigt und die Daten werden alle 10 Minuten mit einem Python-Skript an narodmon.ru √ºbertragen.  F√ºgen Sie einem vorhandenen Skript einige Zeilen hinzu. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#domoticz settings IP = '192.168..' #IP domoticz PORT = '8080' #port of server IDX_1 = '7' #IDX of the DHT temp sensor //‚Ä¶. ,        narodmon.ru url = 'http://{}:{}/json.htm?type=command¬∂m=udevice&amp;nvalue=0&amp;idx={}&amp;svalue={}'.format(IP, PORT, IDX_1, sensor_value_1) request = urllib2.Request(url) response = urllib2.urlopen(request)</span></span></code> </pre><br>  In Domoticz f√ºgen wir einen weiteren virtuellen Sensor hinzu.  Und jetzt k√∂nnen wir zus√§tzlich die Temperatur und Luftfeuchtigkeit auf der Stra√üe sehen, sowohl √ºber das Internet auf unserer lokalen Homehouse-Seite als auch in der iOS-Anwendung. <br><br>  Wem mqtt n√§her ist, k√∂nnen die Sensorwerte √ºber mqtt gesendet werden. <br><br><pre> <code class="python hljs"> playload = <span class="hljs-string"><span class="hljs-string">'{{ "idx": {} , "nvalue" : {}, "svalue" : "1" }}'</span></span>.format(IDX_1, humidity) client.publish(TOPIC_DOMOTICZ, playload, qos =<span class="hljs-number"><span class="hljs-number">0</span></span> , retain =<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-comment"><span class="hljs-comment">#publish</span></span></code> </pre><br><h2>  F√ºgen Sie Wifi zur Kaffeemaschine hinzu. </h2><br>  W√§hrend meine Maschine repariert wird und darauf wartet, dass das Steuerger√§t aus Deutschland ankommt, habe ich eine Delonghi-Kaffeemaschine als Geschenk bekommen.  Auf dem Panel haben wir einen Ein / Aus-Knopf, um kleinen, doppelten Kaffee und zwei weitere zuzubereiten, die ich da nicht benutze  Ich peitsche keine Milch mit Dampf, ich trinke keinen Latte und keine anderen Getr√§nke.  Der Nachteil ist, dass der Kaffee nicht selbst mahlt, sondern mit gemahlenem und einer Tasse gef√ºllt werden muss. <br><br>  F√ºr eine Kaffeemaschine verwende ich Sonoff SV.  Die Pins 3,3 V, Rx, Tx, GND sind signiert.  Separat wird der GPIO 4, 5, 14 weiterhin auf der Karte angezeigt. Firmware f√ºr das gleiche Verfahren wie oben beschrieben. <br><br>  Wir √∂ffnen das Ger√§t und gelangen mit Kn√∂pfen an die Tafel. <br><br>  Das Board verf√ºgt √ºber 5 V Strom, was ausreicht, um unser drahtloses Sonoff SV-Modul mit Strom zu versorgen.  Es war nicht schwer zu finden, wo wir den gesch√§tzten 5c hatten. <br><br>  Durch Dr√ºcken der Tasten wird das Signal einfach gegen Masse kurzgeschlossen.  Wir verbinden unser Modul nach dem Schema. <br><br><img src="https://habrastorage.org/web/a3c/559/ba5/a3c559ba5c1f48d6b552aaddaa448209.png"><br><br>  Wie Sie dem Diagramm entnehmen k√∂nnen, habe ich nur zwei Tasten angeschlossen: Ein / Aus und Kaffee kochen.  Analog k√∂nnten Sie alle anderen Tasten machen.  Auf sonoff sv haben wir 3 Pins auf der Karte, ein Relais, und Sie k√∂nnen auch Rx, Tx (in der neuesten Tasmota-Firmware) verwenden. <br><br><img src="https://habrastorage.org/web/a62/efb/5b0/a62efb5b0ea54284b0406b4f16595145.png"><br><br>  Wir sammeln alles nach dem Schema, wir finden einen geeigneten Platz in der Kaffeemaschine.  F√ºgen Sie in den Moduleinstellungen der Weboberfl√§che ein zweites Relais zu GPIO5 hinzu.  Stellen Sie im Men√º "Konsole" folgende Einstellungen ein: <br><br><pre> <code class="hljs ruby">PowerOnState <span class="hljs-number"><span class="hljs-number">0</span></span> /<span class="hljs-regexp"><span class="hljs-regexp">/   ,     . PulseTime1 10 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   0,1 ,      PulseTime2 10 /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     1 . 1  2     .</span></span></code> </pre> <br>  Erstellen Sie in den Domotics-Einstellungen zwei weitere ‚Äûvirtuelle Sensoren‚Äú und f√ºgen Sie deren IDX zu den Moduleinstellungen im Domotics-Einstellungsmen√º hinzu (Konfiguration ‚Üí Domoticz konfigurieren ‚Üí IDX 1 und IDX 2). <br><br>  Als Ergebnis erhalten wir zwei weitere Schalter, von denen einer die Ein / Aus-Taste der Kaffeemaschine und der zweite die Taste zum Zubereiten von Kaffee dr√ºckt. <br><br>  Um Kaffee zu machen, muss man sowieso mit den Beinen gehen, aber man muss Kaffee einschenken.  Es ist jedoch praktisch, die Maschine einzuschalten.  Ab dem Moment, in dem Sie es einschalten und bevor Sie Kaffee kochen, ben√∂tigen Sie einige Zeit, um die Maschine aufzuw√§rmen.  Wenn Sie also im Zimmer arbeiten, k√∂nnen Sie die Kaffeemaschine aus der Ferne einschalten und nach einer Weile bereits mit den Beinen stampfen und sich etwas zu trinken machen. <br><br>  Bei einem solchen Schalter an einer vollautomatischen Maschine in einer Kaffeemaschine ist dies n√ºtzlicher. Sie m√ºssen nur daran denken, die Tasse im Voraus zu stellen.  Wir warten auf die Steuerplatine. <br><br><h2>  F√ºgen Sie WLAN hinzu, um die T√ºr mit der Vizit-Gegensprechanlage zu √∂ffnen </h2><br>  Im gemeinsamen Korridor wird der Vorraum in der N√§he des Aufzugs durch eine T√ºr mit Magnetschloss und einem Vizit-Zugangssystem verschlossen.  Das System wurde nach der Reparatur installiert und der Knopf zum √ñffnen der Vorraumt√ºr zur Wohnung wurde nicht gehalten.  Um G√§ste zu starten, m√ºssen Sie zur T√ºr gehen und mit dem Knopf √∂ffnen, um die T√ºr im Korridor zu √∂ffnen.  Steuerger√§t KTM-602M. <br><br><img src="https://habrastorage.org/web/771/ea1/9ab/771ea19abd1144e4b95e39f8ffbe2c73.jpg"><br><br>  Durch Schlie√üen von OP + GND wird die T√ºr ge√∂ffnet / der Magnet f√ºr 7 Sekunden getrennt. <br><br>  Wir teilen die Stromversorgung des sonoff sv-Moduls und des Relais, indem wir zwei Widerst√§nde entfernen, wie unten in der Abbildung gezeigt. <br><br><img src="https://habrastorage.org/web/c31/85f/644/c3185f6440db4066bf6cf3fd1336d4af.png"><br><br>  Wir verbinden OP mit dem Eingangsrelais ‚ÄûEingang +‚Äú, am Ausgang des Relais ‚ÄûAusgang +‚Äú befestigen wir GND.  Zwischen ELC und GND der 18-V-Steuereinheit, von der aus wir das Modul selbst mit Strom versorgen. <br><br>  Wir f√ºgen den Domotiks die T√ºrklingel ‚ÄûT√ºrklingel‚Äú hinzu und jetzt kann Siri uns helfen, die T√ºren f√ºr G√§ste zu √∂ffnen. <br><br>  Assistent Siri erkennt den Sprachbefehl "T√ºr √∂ffnen" besser als "Kaffeemaschine einschalten". <br><br>  Ich habe dort mit der Dekoration der Sonoff-Module angehalten. <br><br><h2>  Kleiner Bonus </h2><br>  Sobald ein solcher Alkohol verschwunden ist, schalten wir auch den Fernseher aus / ein.  Das Ausschalten und Einschalten des Fernsehger√§ts hat nichts mit WLAN-Modulen zu tun.  Der Fernseher befindet sich in unmittelbarer N√§he von Himbeer-Pi.  Hier helfen uns eine IR-LED und ein Paar Widerst√§nde mit unterschiedlichen Nennwerten.  Wir installieren lirc, dort finden wir in den Datenbanken die Einstellungen f√ºr Ihre Fernbedienung / Ihren Fernseher. <br><br>  Um mit Domotics zu arbeiten, f√ºhren wir ein kleines Python-Skript aus, das unsere W√ºnsche zum Ein- und Ausschalten des Fernsehger√§ts von mqtt nach lirc √ºbersetzt. <br><br><div class="spoiler">  <b class="spoiler_title">mqtt in lirc</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> paho.mqtt.client <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> mqtt <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json IP = <span class="hljs-string"><span class="hljs-string">'192.168..'</span></span> PORT = <span class="hljs-string"><span class="hljs-string">'1883'</span></span> device = {<span class="hljs-number"><span class="hljs-number">18</span></span> : <span class="hljs-string"><span class="hljs-string">'OpenBox'</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span> : <span class="hljs-string"><span class="hljs-string">'PHILIPS'</span></span>, <span class="hljs-number"><span class="hljs-number">22</span></span> : <span class="hljs-string"><span class="hljs-string">'air'</span></span>} TOPIC_DOMOTICZ = <span class="hljs-string"><span class="hljs-string">'domoticz/in'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(device, command)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># """ Sends IR-signal to the device """ os.system("irsend SEND_ONCE '" + device + "' '" + command + "'") # The callback for when the client receives a CONNACK response from the server. def on_connect(client, userdata, flags, rc): print("Connected with result code "+str(rc)) # Subscribing in on_connect() means that if we lose the connection and # reconnect then subscriptions will be renewed. client.subscribe(TOPIC_DOMOTICZ,0) def on_publish(client,userdata,result): #create function for callback print("data published \n") pass # The callback for when a PUBLISH message is received from the server. def on_message(client, userdata, msg): domoticz = json.loads(msg.payload) if domoticz ['idx'] in device.keys(): idx = domoticz ['idx'] dev = device [idx] command = 'KEY_POWER' send (dev, command) client = mqtt.Client() client.on_connect = on_connect client.on_message = on_message client.on_publish = on_publish client.connect(IP, PORT, 60) client.loop_forever()</span></span></code> </pre> <br></div></div><br>  In Domoticz f√ºgen wir drei weitere virtuelle Tasten f√ºr Fernseher, Receiver und Klimaanlage hinzu. <br>  Es ist nicht bequem, den Fernseher vom Telefon aus zu steuern, trotzdem ist die Fernbedienung irgendwie verwandt.  Aber schalten Sie den Fernseher aus, wenn ich vergessen habe und bereits den Raum verlassen habe, ein sch√∂ner Bonus. <br><br>  Eine sch√∂ne Erg√§nzung dazu ist die Verf√ºgbarkeit der Pebble-Uhr der Pemoticz-Anwendung.  Die Adresse wurde in den Einstellungen hinzugef√ºgt und die Anwendung zog alle Schalter.  Kein einziger Siri kann jetzt die Kaffeemaschine einschalten / die T√ºren √∂ffnen und das Licht ausschalten.  Die Uhr ist normalerweise zur Hand und das Telefon befindet sich m√∂glicherweise nicht in unmittelbarer N√§he.  Das hat auch seine Vorteile.  Ich habe mich stundenlang nicht mit dem Thema Spracherkennung beim Flashen befasst, aber das ist auch m√∂glich. <br><br><img src="https://habrastorage.org/web/651/e3d/d81/651e3dd81b654be3b0fc324f44dc8b9e.png"><br><br>  Vielleicht k√∂nnen Sie damit die Geschichte "ohne ein intelligentes" Zuhause beenden. <br><br><h2>  Fazit </h2><br>  In Form einer Schlussfolgerung, und was dann? <br><br>  Todo Liste: <br><br>  - Klimaanlage, es war nicht m√∂glich, die Einstellungen f√ºr die Fernbedienung f√ºr lirc zu finden und die ersten Versuche, Klicks zu kopieren, f√ºhrten ebenfalls nicht zum Erfolg.  Weiter s√§gen. <br>  - Wir warten auf eine Bestellung des chinesischen Unternehmens Mi c gateway und mehrere Sensoren.  T√ºr√∂ffnungssensoren werden durch knifflige Manipulationen zu Lecksensoren.  Wir werden unser System erweitern.  Wenn ausgel√∂st, senden Sensoren Benachrichtigungen an den Eigent√ºmer. <br>  "Die Gedanken enden dort ..." <br><br><h3>  Verwendete Quellen </h3><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">HomeBridge auf einem Raspberry Pi ausf√ºhren</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Sonoff-Tasmota Wiki</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Installation von Domoticz auf einem bereits laufenden Pi</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Gewusst wie: F√ºgen Sie Ihrer Kaffeemaschine WLAN hinzu</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de403869/">https://habr.com/ru/post/de403869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de403855/index.html">Nach 11.500 Unf√§llen lernte ein KI-Quadrocopter, in Innenr√§umen zu fliegen</a></li>
<li><a href="../de403857/index.html">Oticon f√ºhrte die nicht implantierbare Knochenleitungstechnologie f√ºr Kinder ein</a></li>
<li><a href="../de403861/index.html">Mit Masterhost passiert etwas nicht</a></li>
<li><a href="../de403865/index.html">Auchan LED-Lampen</a></li>
<li><a href="../de403867/index.html">Informationsfreiheit</a></li>
<li><a href="../de403871/index.html">BBC Micro - der Computer, der das ZX Spectrum √ºbertrifft</a></li>
<li><a href="../de403873/index.html">Solarbatterie auf dem Balkon: Batterietest und BMS</a></li>
<li><a href="../de403875/index.html">Intelligente Uhren und neuronale Netze erkennen Vorhofflimmern mit einer Genauigkeit von 97%</a></li>
<li><a href="../de403877/index.html">Der Preis der superschweren NASA-Rakete wird um mindestens 500 Millionen US-Dollar steigen, und ihr Start wird um ein weiteres Jahr verschoben</a></li>
<li><a href="../de403881/index.html">Die sch√∂nste Rakete</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>