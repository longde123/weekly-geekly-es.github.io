<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë©‚Äçüëß ü§∞üèø ü¶é Como fazer amigos PHPstorm, xDebug e ramifica√ß√µes remotas compiladas pelo Docker? Muito simples ... üò† üéõÔ∏è ‚õëÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bom dia, Habr! 

 H√° um ano, meu processo de depura√ß√£o de c√≥digo no PHP consistia em duas linhas: 



var_dump($variable); die();  
 De tempos em temp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Como fazer amigos PHPstorm, xDebug e ramifica√ß√µes remotas compiladas pelo Docker? Muito simples ...</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/423337/">  Bom dia, Habr! <br><br>  H√° um ano, meu processo de depura√ß√£o de c√≥digo no PHP consistia em duas linhas: <br><br><pre><code class="php hljs">var_dump($variable); <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>();</code> </pre> <br>  De tempos em tempos, √© claro, eu precisava usar constru√ß√µes mais "complexas": <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data);</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($variable, JSON_UNESCAPED_UNICODE); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>();</code> </pre> <br>  N√£o, o que voc√™ √©!  Eu sabia - em nosso tempo, n√£o √© apropriado que um programador cultural fa√ßa isso <br><br><div class="spoiler">  <b class="spoiler_title">artesanato antigo</b> <div class="spoiler_text">  uma piada sobre outro of√≠cio antigo <br></div></div><br>  Mas, honestamente, eu sempre tive medo do que n√£o entendi.  Incluindo <s>impressoras</s> xDebug, especialmente como configurar tudo isso.  Um belo dia, consegui faz√™-lo no meu carro e em um projeto local - n√£o havia limite para a alegria.  Muitos meses depois, me deparei com um novo problema, como depurar no PHPstorm via xDebug, se o projeto for constru√≠do remotamente pelo docker via CI. <br><br>  Se voc√™, como eu, tiver dificuldade em configurar coisas diferentes, seja bem-vindo ao gato, falarei sobre minha experi√™ncia na cria√ß√£o de um ambiente de depura√ß√£o com palavras assustadoras como Docker, xDebug, CI. <br><a name="habracut"></a><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Para quem n√£o gosta de √°gua e quer ir diretamente para a ess√™ncia do cen√°rio.</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u="><br></a> <br><h3>  Por que voc√™ deve se afastar dos m√©todos de depura√ß√£o bolorentos e mudar para as tecnologias adequadas? </h3><br>  Enganei um pouco o gato, estava envolvido na depura√ß√£o artesanal, n√£o apenas porque tinha medo de configurar alguma coisa, e n√£o porque era muito est√∫pido, mas simplesmente porque n√£o precisava de algo mais conveniente.  Na maioria das vezes, eu trabalhava em projetos localmente no meu computador bastante poderoso, e as tarefas n√£o eram t√£o complicadas que o processo de depura√ß√£o come√ßou a ocupar uma posi√ß√£o bastante significativa. <br><br>  Em algum momento, percebi por mim mesmo que estava desconfort√°vel e tentei fazer amigos xDebug e PHPstorm ao trabalhar em um projeto local.  O problema √© que a maioria das documenta√ß√µes e guias que eu achei sugerem que a pessoa que os l√™ √© bastante versada na √°rea de assunto e entende tudo, no meu caso, esse n√£o foi o caso e passei 4-5 na minha primeira instala√ß√£o do xDebug horas em duas horas.  Era moral bastante dif√≠cil, me senti infinitamente idiota.  No entanto, acabou por configurar, tudo funcionou! <br><br>  Sim, tornou-se mais conveniente, localmente, em casa, mas no trabalho principal eu fiz os sites remotamente e, na maioria das vezes, n√£o consegui descarregar o site localmente (devido a uma m√°quina fraca ou processo de implanta√ß√£o inconveniente) ou afetar as configura√ß√µes do servidor devido a a hospedagem, portanto, tornou as edi√ß√µes "ao vivo" e a depura√ß√£o envolvidas no print_r com coment√°rios em html (naquele trabalho era "normal", embora n√£o se orgulhasse dessa experi√™ncia). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffd/cd1/3af/ffdcd13af6a976ca99ff2f26976458e9.jpg" alt="imagem"><br><br>  No entanto, h√° tr√™s meses, mudei para uma empresa mais fria e comecei a me envolver em um projeto realmente s√©rio com uma carga alta.  E aqui muita coisa mudou para mim.  O processo de infraestrutura e desenvolvimento √© aproximadamente o seguinte: existe um servidor GitLab, cada projeto tem seu pr√≥prio reposit√≥rio, as tarefas s√£o enviadas ao Jira, voc√™ cria uma filial por n√∫meros de tarefas, ao criar uma filial usando o CI, sua pr√≥pria sandbox com o site onde voc√™ trabalha silenciosamente √© criada automaticamente, a cada push remontar a ramifica√ß√£o; no final do trabalho que voc√™ fornece √† revis√£o de c√≥digo, despeje a ramifica√ß√£o no mestre. <br><br>  Tudo √© legal, exceto por um MAS, cada reconstru√ß√£o de um ramo no meu caso leva cerca de 10 segundos.  No processo de desenvolvimento em si, esse √© um momento insignificante, j√° que j√° passei do est√°gio em que tive que verificar a operacionalidade do c√≥digo em quase todas as linhas devido √† incerteza e √† pouca experi√™ncia.  No entanto, quando mudei para a depura√ß√£o, esses 10 segundos come√ßaram a desempenhar um papel tang√≠vel.  O processo dessa depura√ß√£o teve a seguinte apar√™ncia: <br><br><ul><li>  Adicione 2 linhas </li><li>  Pushu commit </li><li>  Eu espero 10 segundos </li><li>  Verifique, veja o que h√° de errado </li><li>  Repetir </li></ul><br>  De acordo com estimativas aproximadas, um ramo pronto para mesclagem tinha aproximadamente 20% de confirma√ß√µes √∫teis e 80% de confirma√ß√µes de depura√ß√£o.  Suponha que eu terminei o trabalho em uma ramifica√ß√£o com 300 confirma√ß√µes, das quais 240 confirma√ß√µes basicamente consumiram apenas 40 minutos do meu tempo de trabalho (e esse √© apenas o tempo de espera para a montagem da ramifica√ß√£o, sem levar em considera√ß√£o os segundos que somam minutos, para adicionar duas linhas e exclua-os). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9a/810/70f/b9a81070f5d6091988cee3ff3ac88463.png" alt="imagem"><br><br>  Em algum momento, eu estava cansado disso e decidi configurar o xDebug para tornar o processo de depura√ß√£o mais barato.  Infelizmente, meus colegas atuais n√£o usaram essa tecnologia (estou esperando uma piada sobre "Eu tenho uma empresa legal onde ningu√©m usa xDebug") ou n√£o sabiam / n√£o se lembravam de como fazer amizade com o xDebug IDE quando a filial indo remotamente via CI e, como nunca desenvolvi DevOps e, como mencionei acima, o processo de cria√ß√£o de algo √© um processo doloroso para mim, levou cerca de 6 horas de tempo puro para finalmente funcionar e entendi o processo, e isso seria conveniente o suficiente. <br><a name="process"></a><br><h3>  Processo de instala√ß√£o </h3><br>  N√£o entrarei em detalhes sobre como fixar a CI, o Docker, em geral, como montar a infraestrutura, presume-se que tudo isso esteja feito e o que resta √© configurar o seu ambiente pessoal. <br><br>  Digamos que nosso reposit√≥rio tenha algo como esta estrutura: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/3ea/285/56d3ea285e90fed97ea116ac79715381.jpg" alt="imagem"><br><br>  Primeiro precisamos verificar se o pr√≥prio xDebug est√° na imagem atual, para isso voc√™ pode usar o <b>phpinfo ();</b> <br><br>  Se o xDebug j√° estiver inclu√≠do na montagem - tudo bem, se n√£o estiver, verifique <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">esta fonte</a> , o que me ajudou diretamente na instala√ß√£o em si, no entanto, eu fui um pouco diferente. <br><br><h4>  Configurar o php.ini </h4><br>  Para que tudo funcione no final, duas configura√ß√µes de xDebug s√£o importantes para n√≥s: <br><br><ul><li>  xdebug.remote_enable </li><li>  xdebug.remote_host </li></ul><br>  Na montagem final da ramifica√ß√£o remota, <b>remote_enable</b> deve estar ativado e, em <b>remote_host, o</b> IP do seu computador na rede deve ser atribu√≠do.  Vamos incluir essas configura√ß√µes em nossa compila√ß√£o. <br><br>  Primeiro, voc√™ precisa descobrir onde as configura√ß√µes do php est√£o armazenadas, elas podem ser localizadas em <b>/usr/local/etc/php/conf.d/php.ini</b> ou o pr√≥prio arquivo .ini pode ter um nome diferente, no meu caso, √© <b>/ usr / local / etc / php / conf.d / php-settings.ini</b> .  Voc√™ pode descobrir nas configura√ß√µes da imagem coletada. <br><br>  Criamos nossas configura√ß√µes adicionais em nosso ramo atrav√©s do mesmo arquivo php-settings.ini e o colocamos em <b>./build_env/php/php-settings.ini</b> <br>  Escrevemos nele 2 das configura√ß√µes acima: <br> <code>xdebug.remote_enable = on <br> xdebug.remote_host = IP...</code> <br> <br>  Em seguida, precisamos adicionar esse arquivo √†s configura√ß√µes de imagem "pai".  Eu fa√ßo isso atrav√©s dos volumes adicionando a linha a ./build_env/docker-compose/docker-compose.tmpl: <br> <code>- ${PROJECT_DIR}/build_env/php/php-settings.ini:/usr/local/etc/php/conf.d/php-settings.ini</code> <br> <br>  Isto √© como o docker-compose.tmpl se parece no meu projeto: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a9/dfc/03d/6a9dfc03d0adf60127a3c03ede9b0f3e.jpg" alt="imagem"><br><br>  Na pr√≥xima vez que voc√™ criar o ramo, poder√° verificar se as novas configura√ß√µes est√£o vinculadas pelo mesmo <b>phpinfo ();</b>  se sim - excelente, se n√£o - voc√™ est√° sem sorte e ter√° que seguir o mesmo caminho que fiz na primeira vez :( <br><br><h4>  Personalizando mapeamentos no PHPstorm </h4><br>  Em seguida, voc√™ precisa configurar o pr√≥prio PHPstorm.  Decidi n√£o usar o DBgp Proxy, para n√£o configurar sempre os mapeamentos no pop-up.  No meu caso, eu uso um modelo de servidor que conter√° os mapeamentos necess√°rios. <br><br>  V√° para <b>Configura√ß√µes / Prefer√™ncias |</b>  <b>Idiomas e estruturas |</b>  <b>Php |</b>  <b>Servidores</b> <br><br><ol><li>  Crie um modelo de servidor </li><li>  Nome: FILIAL </li><li>  host: any, n√£o afeta </li><li>  porta: qualquer, n√£o afeta </li><li>  Depurador: xDebug </li><li>  Coloque um daw em Use mapeamentos de caminho </li><li>  Colocamos os mapeamentos apropriados; as pastas locais de trabalho devem corresponder √†s pastas no servidor em que as ramifica√ß√µes coletadas est√£o localizadas; no meu caso, as compila√ß√µes coletadas est√£o na pasta / var / www / builds / your_namespace / your_project / your_branch </li></ol><br><img src="https://habrastorage.org/getpro/habr/post_images/c0b/fb9/268/c0bfb9268a256e387f3464e7ce100cc0.jpg" alt="imagem"><br><br>  Salvamos essas configura√ß√µes e as alteramos toda vez que trabalhamos com uma nova ramifica√ß√£o.  Por exemplo, se hoje eu trabalho com a ramifica√ß√£o web-2233, alterarei o mapeamento para <b>/ var / www / builds / build_path / web-2233</b> <br><br><h4>  Adicione uma nova vari√°vel de ambiente para que o IDE puxe automaticamente os mapeamentos </h4><br>  Agora, um ponto bastante importante e n√£o o mais √≥bvio.  Quando iniciamos a depura√ß√£o, o PHPstorm precisa entender quais arquivos locais correspondem aos arquivos no servidor remoto.  Se o servidor n√£o forneceu uma instala√ß√£o espec√≠fica, aparecer√° uma janela pop-up na qual voc√™ precisar√° mapear manualmente os caminhos.  Para que o PHPstorm obtenha imediatamente mapeamentos de um servidor com o nome BRANCH, voc√™ precisa adicionar a vari√°vel de ambiente <b>PHP_IDE_CONFIG</b> ao nosso assembly <br><br>  Em <b>./build_env/docker-compose/docker-compose.tmpl,</b> crie uma nova vari√°vel de ambiente no ambiente: <br> <code>PHP_IDE_CONFIG: ${PHP_IDE_CONFIG}</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/793/5d1/274/7935d1274fadf298d10e57a2b6d6aba8.jpg" alt="imagem"><br><br>  Em <b>.gitlab-ci.yml,</b> definimos esta vari√°vel: <br> <code>- export PHP_IDE_CONFIG="serverName=BRANCH"</code> <br> <br><img src="https://habrastorage.org/getpro/habr/post_images/336/529/676/336529676de2d579e86a5820e02f06dc.jpg" alt="imagem"><br><br><h4>  Feito! </h4><br>  N√£o precisamos de extens√µes do navegador, n√£o precisamos passar o URL XDEBUG_SESSION_START = IDE_KEY para obter par√¢metros, n√£o precisamos adicionar configura√ß√µes adicionais. <br><br>  Basta ligar a escuta <img src="https://habrastorage.org/getpro/habr/post_images/f5f/cb7/dbd/f5fcb7dbd0b27a12b5be3ce65f1e9936.jpg" alt="imagem">  e atualize a p√°gina do site, assim que encontrarmos o primeiro ponto de interrup√ß√£o, o aplicativo ser√° interrompido <br><br><img src="https://habrastorage.org/getpro/habr/post_images/457/99c/352/45799c352fe12908ae598f93d1271aeb.jpg" alt="imagem"><br><br>  Obrigado pela aten√ß√£o, espero que este artigo seja √∫til e que algu√©m economize tempo sem pisar no mesmo rake que eu :) <br><br>  Fontes que eu usei durante a configura√ß√£o inicial: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://gist.github.com/chadrien/c90927ec2d160ffea9c4</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://confluence.jetbrains.com/display/PhpStorm/Docker+Support+in+PhpStorm#DockerSupportinPhpStorm-DebuggingthePHPwebapplicationrunningintheDockercontainer</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt423337/">https://habr.com/ru/post/pt423337/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt423319/index.html">Integra√ß√£o de c√≥digo Vivaldi. Nossos desenvolvedores dizem</a></li>
<li><a href="../pt423321/index.html">Protegendo reposit√≥rios GitHub de confirma√ß√µes maliciosas</a></li>
<li><a href="../pt423323/index.html">"Voc√™ precisa ter pregui√ßa de se tornar um bom testador."</a></li>
<li><a href="../pt423329/index.html">Preparando-se para uma entrevista com uma empresa Big Five</a></li>
<li><a href="../pt423335/index.html">Como vencer o clique em Y. Direct e AdWords por 600 mil rublos por m√™s</a></li>
<li><a href="../pt423339/index.html">Existe vida no Windows 98, parte um - sobre hardware</a></li>
<li><a href="../pt423341/index.html">Sob press√£o do p√∫blico, a Sony admitiu que os trabalhos de Bach n√£o pertencem a ela.</a></li>
<li><a href="../pt423343/index.html">Valores culturais feitos de pl√°stico come√ßam a decair</a></li>
<li><a href="../pt423345/index.html">La√ßo de medo</a></li>
<li><a href="../pt423347/index.html">Onde est√° o meu dinheiro: design, pacotes e localiza√ß√£o do Steam, localiza√ß√£o e distribuidores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>