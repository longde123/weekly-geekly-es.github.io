<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👨‍🎤 👨🏿‍🤝‍👨🏼 👩🏿‍💼 E para nós tudo é "vertical" - DBMS Vertica 🤷🏾 👌🏾 👆🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Oi Meu nome é Sergey, trabalho como engenheiro-chefe em Sbertekh. Estou no campo de TI há cerca de 10 anos, dos quais 6 estão envolvidos em bancos de ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>E para nós tudo é "vertical" - DBMS Vertica</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/sberbank/blog/414895/">  Oi  Meu nome é Sergey, trabalho como engenheiro-chefe em Sbertekh.  Estou no campo de TI há cerca de 10 anos, dos quais 6 estão envolvidos em bancos de dados, processos ETL, DWH e tudo relacionado a dados.  Neste artigo, falarei sobre o Vertica - um DBMS analítico e verdadeiramente colunar que compacta, armazena, entrega rapidamente dados e é ótimo como uma solução de big data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e1/e72/d1c/6e1e72d1cca80f6339ea76e0c27eedec.png"><br><a name="habracut"></a><br><h2>  Informação geral </h2><br>  O big data começou a se desenvolver nos anos 2000, e eram necessários mecanismos que pudessem digerir tudo.  Em resposta a isso, vários DBMS colunares destinados a esse fim apareceram - incluindo o Vertica. <br><br>  A Vertica não apenas armazena seus dados em colunas, mas racionalmente, com um alto grau de compactação, também agenda com eficiência consultas e fornece dados rapidamente.  As informações, que em um DBMS clássico em minúsculas ocupam cerca de 1 TB de espaço em disco, no Vertica levarão de 200 a 300 GB, assim, obtemos boas economias em discos. <br><br>  O Vertica foi originalmente projetado como uma coluna DBMS.  Outras bases basicamente tentam imitar vários mecanismos de coluna, mas nem sempre são bem-sucedidas porque o mecanismo ainda é projetado para processar seqüências de caracteres.  Como regra, os imitadores simplesmente transpõem a tabela e depois a processam com o mecanismo de linha usual. <br><br>  O Vertica é tolerante a falhas, não possui um nó de controle - todos os nós são iguais.  Se houver problemas com um dos servidores no cluster, ainda receberemos os dados.  Muitas vezes, o recebimento de dados no prazo é fundamental para os clientes comerciais, especialmente no momento em que os relatórios são fechados e você precisa fornecer informações às autoridades financeiras. <br><br><h2>  Áreas de aplicação </h2><br>  Vertica é principalmente um armazém de dados analíticos.  Você não deve escrever em pequenas transações, não deve estragar em nenhum site, etc.  O Vertica deve ser considerado como um tipo de camada em lote, onde vale a pena imergir dados em pacotes grandes.  Se necessário, a Vertica está pronta para fornecer esses dados rapidamente - consultas para milhões de linhas são concluídas em segundos. <br><br>  Onde isso pode ser útil?  Tomemos, por exemplo, uma empresa de telecomunicações.  O Vertica pode ser usado nele para geoanalítica, desenvolvimento de rede, gerenciamento de qualidade, marketing direcionado, estudando informações de centros de contato, gerenciando saídas de clientes e soluções antifraude / antispam. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ef/913/bfe/0ef913bfe1510fd3aee6de4bb52e3175.png"><br><br>  Em outros setores de negócios, tudo é o mesmo - análises oportunas e confiáveis ​​são importantes para o lucro.  No comércio, por exemplo, todo mundo está tentando personalizar de alguma forma os clientes, distribuir cartões de desconto para isso, coletar dados sobre onde, o que e quando uma pessoa comprou, etc.  Ao analisar as matrizes de informações de todos esses canais, podemos compará-las, criar modelos e tomar decisões que levem ao crescimento do lucro. <br><br><h2>  Limiar de entrada </h2><br>  Hoje, qualquer empregador exige que um analista entenda o que é SQL.  Se você conhece o ANSI SQL, pode ser chamado de usuário confiável da Vertica.  Se você pode criar modelos em Python e R, então você é apenas um "massagista" de dados.  Se você domina o Linux e possui conhecimentos básicos de administração da Vertica, poderá trabalhar como administrador.  Em geral, o limiar de entrada no Vertica é baixo, mas, é claro, todas as nuances podem ser encontradas apenas com o auxílio de uma mão durante a operação. <br><br><h2>  Arquitetura de hardware </h2><br>  Considere o Vertica em nível de cluster.  Esse DBMS fornece processamento de dados massivamente paralelo (MPP) em uma arquitetura de computação distribuída - “nada compartilhado” - onde, em princípio, qualquer nó está pronto para captar as funções de qualquer outro nó.  Propriedades principais: <br><br><ul><li>  Não há um ponto único de falha <br></li><li>  cada nó é independente e independente, <br></li><li>  Não há um único ponto de conexão para todo o sistema, <br></li><li>  nós de infraestrutura são duplicados, <br></li><li>  os dados nos nós do cluster são copiados automaticamente. <br></li></ul><br>  O cluster é dimensionado linearmente sem problemas.  Simplesmente colocamos os servidores em uma prateleira e os conectamos através de uma interface gráfica.  Além de servidores seriais, a implantação em máquinas virtuais é possível.  O que pode ser alcançado com a extensão? <br><br><ul><li>  Aumento de volume para novos dados <br></li><li>  Aumentar a carga de trabalho máxima <br></li><li>  Melhorando a resiliência.  Quanto mais nós no cluster, menor a probabilidade de falha do cluster devido a falha e, portanto, mais próximos estamos de garantir a disponibilidade 24/7. <br></li></ul><br>  Mas há algumas coisas a considerar.  Periodicamente, os nós devem ser removidos do cluster para manutenção.  Outro caso bastante comum em grandes organizações é que os servidores ficam fora da garantia e passam de produtivos para algum tipo de ambiente de teste.  Em seu lugar, há novos que estão sob a garantia do fabricante.  Com base nos resultados de todas essas operações, é necessário reequilibrar.  Esse é um processo em que os dados são redistribuídos entre os nós - portanto, a carga de trabalho é redistribuída.  Este é um processo que consome muitos recursos e, em clusters com uma grande quantidade de dados, pode reduzir bastante o desempenho.  Para evitar isso, você precisa selecionar a janela de serviço - o momento em que a carga é mínima, caso em que os usuários não notarão. <br><br><h2>  Projeções </h2><br>  Para entender como os dados são armazenados no Vertica, você precisa lidar com um dos conceitos básicos - projeção. <br><br>  As unidades lógicas de armazenamento de informações são diagramas, tabelas e visualizações.  Unidades físicas são projeções.  As projeções são de vários tipos: <br><br><ul><li>  Superprojeção <br></li><li>  Projeções específicas de consulta <br></li><li>  Projeções Agregadas <br></li></ul><br>  Ao criar qualquer tabela, é criada automaticamente uma <i>super projeção</i> que contém todas as colunas da nossa tabela.  Se você precisar acelerar qualquer um dos processos regulares, podemos criar uma <i>projeção orientada a consultas</i> especial que conterá, por exemplo, 3 das 10 colunas. <br><br>  O terceiro tipo também se destina <i>a projeções agregadas</i> por aceleração.  Não vou entrar nas subclasses deles - isso não é muito interessante.  Quero avisar imediatamente que não vale a pena resolver constantemente seus problemas com a execução de consultas, criando novas projeções.  Eventualmente, o cluster começará a ficar mais lento. <br><br>  Ao criar projeções, precisamos avaliar se nossas consultas têm superprojeções suficientes.  Se ainda queremos experimentar, adicionamos estritamente uma nova projeção.  Se surgirem problemas, será mais fácil encontrar a causa raiz.  Para tabelas grandes, crie uma projeção segmentada.  Ele é dividido em segmentos que são distribuídos por vários nós, o que aumenta a tolerância a falhas e minimiza a carga em um nó.  Se os tablets forem pequenos, é melhor fazer projeções não segmentadas.  Eles são completamente copiados para cada nó e, portanto, o desempenho é aumentado.  Farei uma reserva: em termos de Vertica, uma tabela "pequena" tem cerca de 1 milhão de linhas. <br><br><h2>  Tolerância a falhas </h2><br>  A tolerância a falhas no Vertica é implementada usando o mecanismo K-Safety.  É bastante simples em termos de descrição, mas complexo em termos de trabalho no nível do motor.  Pode ser controlado usando o parâmetro K-Safety - pode ter um valor de 0, 1 ou 2. Este parâmetro define o número de cópias dos dados de projeção segmentados. <br><br>  Cópias de projeções são chamadas de projeções de amigos.  Eu tentei traduzir essa frase através do tradutor Yandex e resultou em algo como uma "projeção de ajudante".  Google ofereceu opções e mais interessante.  Normalmente, essas projeções são chamadas de parceiras ou vizinhas, de acordo com sua finalidade funcional.  Essas são projeções que são simplesmente armazenadas em nós vizinhos e, portanto, reservadas.  Projeções não segmentadas não têm projeções de amigos - elas são copiadas completamente. <br><br>  Como isso funciona?  Considere um cluster de cinco máquinas.  Seja K-safety igual a 1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f6b/af4/969/f6baf4969fb15ab90df2d68def4862dd.png"><br><br>  Os nós são numerados e, abaixo deles, são projetadas gravações de parceiros que são armazenadas neles.  Suponha que tenhamos um nó desconectado.  O que vai acontecer? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5c/adc/696/f5cadc696f5683b45591e3d597ae5cdc.png"><br><br>  O nó 1 contém uma projeção amigável do nó 2. Portanto, a carga no nó 1 aumentará, mas o cluster não parará de funcionar.  E agora esta situação: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b4/414/8af/2b44148afc4c57bf863e966d527ffa36.png"><br><br>  O nó 3 contém a projeção do nó 4 e os nós 1 e 3 serão sobrecarregados. <br><br>  Nós complicamos a tarefa.  K-Safety = 2, desative dois nós adjacentes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bd/741/a31/1bd741a3183af8ec14fa2f953b99dc8a.png"><br><br>  Aqui os nós 1 e 4 serão sobrecarregados (o nó 2 contém a projeção do nó 1 e o nó 3 contém a projeção do nó 4). <br><br>  Nessas situações, o mecanismo do sistema reconhece que um dos nós não está respondendo e a carga é transferida para o nó vizinho.  Ele será usado até que o nó seja restaurado novamente.  Quando isso acontece, a carga e os dados são redistribuídos novamente.  Assim que perdemos mais da metade do cluster ou nós que contêm todas as cópias de alguns dados, o cluster é ativado. <br><br><h2>  Armazenamento de dados lógicos </h2><br>  A Vertica possui áreas de armazenamento otimizadas para gravação, áreas otimizadas para leitura e um mecanismo de Tuple Mover que permite que os dados fluam do primeiro para o segundo. <br><br>  Ao usar as operações COPY, INSERT, UPDATE, terminamos automaticamente no WOS (Write Optimized Store), uma área em que os dados não são otimizados para leitura e classificados apenas quando solicitados, armazenados sem compactação ou indexação.  Se os volumes de dados forem muito grandes para a área WOS, usando a instrução DIRECT adicional, eles deverão ser gravados imediatamente no ROS.  Caso contrário, o WOS estará cheio e nós travaremos. <br><br>  Após o tempo especificado nas configurações expirar, os dados do WOS fluem para o ROS (Read Optimized Store) - uma estrutura otimizada e orientada para a leitura do armazenamento em disco.  O ROS armazena a maior parte dos dados, aqui eles são classificados e compactados.  Os dados do ROS são divididos em contêineres de armazenamento.  Um contêiner é um conjunto de linhas criadas por operadores de tradução (COPY DIRECT) e é armazenado em um grupo específico de arquivos. <br><br>  Independentemente de onde os dados são gravados - no WOS ou no ROS - eles estão disponíveis imediatamente.  Mas a leitura do WOS é mais lenta porque os dados não estão agrupados lá. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00e/c1e/e0d/00ec1ee0d4605f51f009febe686c4a44.png"><br><br>  O Tuple Mover é uma ferramenta de limpeza que executa duas operações: <br><br><ul><li>  Mudança - compacta e classifica dados no WOS, move-os para o ROS e cria novos contêineres para eles no ROS. <br></li><li>  Mergeout - varrendo para trás quando usamos DIRECT.  Nem sempre conseguimos carregar tanta informação para obter grandes contêineres ROS.  Portanto, periodicamente combina pequenos contêineres ROS em outros maiores, limpa os dados marcados para exclusão enquanto trabalha em segundo plano (de acordo com o tempo especificado na configuração). <br></li></ul><br><h2>  Quais são os benefícios do armazenamento em coluna? </h2><br>  Se lermos linhas, por exemplo, para executar um comando <br><br> <code>SELECT 1,11,15 from table1 <br></code> <br>  teremos que ler a tabela inteira.  Esta é uma enorme quantidade de informações.  Nesse caso, a abordagem de coluna é mais lucrativa.  Permite contar apenas as três colunas necessárias, economizando memória e tempo. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ee/1b5/69e/6ee1b569e3daa80c154912e1ca3ac6ed.png"><br><br><h2>  Alocação de recursos </h2><br>  Para evitar problemas, o usuário precisa ser um pouco limitado.  Sempre há uma chance de o usuário escrever uma solicitação pesada que consome todos os recursos.  Por padrão, a Vertica ocupa uma parte significativa da área Geral e, além disso, são destacadas áreas separadas para o Tuple Mover, o WOS e os processos do sistema (recuperação, etc.). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e7/008/498/7e70084981be49bb1f041743d31521a1.png"><br><br>  Vamos tentar compartilhar esses recursos.  Criamos áreas para escritores, leitores e consultas lentas e de baixa prioridade. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/be5/895/add/be5895add6099324995b81d8a39f670a.png"><br><br>  Se olharmos para as tabelas do sistema em que nossos recursos estão armazenados - pools de recursos -, veremos muitos parâmetros com os quais você pode ajustar tudo de maneira mais precisa.  No início, você não deve se aprofundar nisso, é melhor simplesmente limitar-se a cortar a memória para determinadas tarefas.  Quando você ganha experiência e tem 100% de certeza de que está fazendo tudo corretamente, será possível experimentar. <br><br>  As configurações finas incluem prioridade de execução, sessões competitivas e a quantidade de memória alocada.  E mesmo com processadores, podemos consertar alguma coisa: para trabalhar com essas configurações, você precisa de total confiança na correção de suas ações, para que seja melhor contar com o apoio dos negócios e ter o direito de cometer um erro. <br><br>  Abaixo está um exemplo de uma solicitação pela qual você pode ver as configurações do pool Geral: <br><br> <code>dbadmin =&gt; select * FROM resource_pools WHERE NAME = 'general'; <br> <br> -[ RECORD 1 ]------------+--------------- <br> pool_id | 45035996273721212 <br> name | general <br> is_internal | t <br> memorysize | <br> maxmemorysize | 30G <br> executionparallelism | AUTO <br> priority | 0 <br> runtimepriority | MEDIUM <br> runtimeprioritythreshold | 2 <br> queuetimeout | 0:05 <br> plannedconcurrency | 10 <br> maxconcurrency | 20 <br> runtimecap | <br> singleinitiator | f <br> cpuaffinityset | <br> cpuaffinitymode | ANY <br> cascadeto |</code> <br> <br><h2>  ANSI SQL e outros recursos </h2><br><ul><li>  O Vertica permite escrever no SQL-99 - todas as funcionalidades são suportadas. <br></li><li>  A Verica possui excelentes recursos analíticos - até ferramentas de aprendizado de máquina estão incluídas <br></li><li>  Vertica pode indexar textos <br></li><li>  Vertica processa dados semiestruturados <br></li></ul><br><h2>  Integração </h2><br>  O Vertica, como todas as ferramentas atuais, está seriamente integrado com outros sistemas.  Capaz de funcionar bem com o HDFS (Hadoop).  Nas versões anteriores, o Vertica só podia baixar dados do HDFS de determinados formatos, mas agora ele pode fazer tudo, funciona com todos os formatos, por exemplo, ORC e ​​Parquet.  Pode até anexar arquivos como tabelas externas e armazenar seus dados em contêineres ROS diretamente no HDFS.  Na oitava versão do Vertica, uma otimização significativa da velocidade de trabalho com o HDFS, foi realizado um catálogo de metadados e a análise desses formatos.  Você pode criar um cluster Vertica diretamente em um cluster Hadoop. <br><br>  A partir da versão 7.2, o Vertica pode funcionar com o Apache Kafka - se alguém precisar de um intermediário de mensagens. <br><br>  O Vertica 8 tem suporte completo para o Spark.  É possível copiar dados do Spark para o Vertica e vice-versa. <br><br><h2>  Conclusão </h2><br>  O Vertica é uma boa opção para trabalhar com big data que não requer muito conhecimento de entrada.  Este DBMS possui amplos recursos analíticos.  Dos pontos negativos - essa solução não é de código aberto, mas você pode tentar implantar gratuitamente com um limite de 1 TB e três nós - isso é suficiente para entender se você precisa do Vertica ou não. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt414895/">https://habr.com/ru/post/pt414895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt414885/index.html">Lidamos com erros e “muletas” no Registro Estadual Unificado de Pessoas Jurídicas - o registro estadual de pessoas jurídicas</a></li>
<li><a href="../pt414887/index.html">Criando um gancho para gatos no Unity. Parte 1</a></li>
<li><a href="../pt414889/index.html">Quando as agências digitais precisam de IaaS</a></li>
<li><a href="../pt414891/index.html">Hábitos do desenvolvedor</a></li>
<li><a href="../pt414893/index.html">Viber, WhatsApp, Telegram - o que é melhor?</a></li>
<li><a href="../pt414897/index.html">Acesso a dados em aplicativos multiusuários</a></li>
<li><a href="../pt414899/index.html">Como coletar análises e não matar a produtividade</a></li>
<li><a href="../pt414901/index.html">Dell e DROVA: como jogar jogos exigentes, mesmo em um laptop fraco</a></li>
<li><a href="../pt414905/index.html">Componentes da Web Parte 3: modelos e importações de html</a></li>
<li><a href="../pt414907/index.html">O que liga a teoria dos números à trajetória da luz?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>