<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üï¢ üë∞üèæ üñ•Ô∏è Zur Frage von AVR und Weltrekorden üí• ü§±üèª üå∑</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mach es gut, es wird schlecht 
 Der Grund f√ºr den Beitrag war ein k√ºrzlich ver√∂ffentlichter Artikel (als ich anfing, diesen Beitrag zu schreiben, war ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Zur Frage von AVR und Weltrekorden</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/412959/"><h3>  Mach es gut, es wird schlecht </h3><br>  Der Grund f√ºr den Beitrag war ein k√ºrzlich ver√∂ffentlichter Artikel (als ich anfing, diesen Beitrag zu schreiben, war er wirklich neu, aber im Ordner "Unfinished" ging lange etwas weiter) √ºber Habr in Bezug auf Aspekte der Implementierung von Software UART auf AVRs MK.  Die von sich selbst aufgeworfenen Fragen sind nicht ohne Interesse, aber es werden so seltsame Antworten gegeben, dass sie es f√ºr seine Pflicht hielten, die notwendigen Erkl√§rungen abzugeben.  Das Thema ist markiert. Wer etwas √ºber ‚ÄûK√∂nige, Kohl und Schuhe‚Äú lesen m√∂chte, dh die Anforderungen der Normen, die (korrekte) technische Dokumentation und Aufzeichnungen in der Assembler-Programmierung f√ºr AVR lesen m√∂chte, kann auf die Schaltfl√§che unten klicken. <br><a name="habracut"></a><br>  Lassen Sie uns die Frage genauer skizzieren: Ist es m√∂glich, IRPS (der √ºbliche Name f√ºr die Schnittstelle im Namen von UART) auf einem AVR-Typ MK (insbesondere Tiny13) zu implementieren, wenn von einem internen Generator aus gearbeitet wird?  Tatsache ist, dass dieser Generator keine sehr guten Indikatoren f√ºr die Frequenzerhaltungsgenauigkeit hat, weshalb diese Frage auftaucht.  Ich muss sofort reservieren, dass es keine Rolle spielt, ob wir eine Software-Implementierung (wie im urspr√ºnglichen Beitrag vorgeschlagen) in Betracht ziehen oder MK-Hardware-Bl√∂cke verwenden.  Die Ergebnisse einer Methode (in Bezug auf zeitliche Genauigkeitsparameter) werden fast vollst√§ndig in eine andere √ºbersetzt. <br><br>  Die grundlegende Frage ist, ob der interne Generator die erforderliche Betriebsgenauigkeit liefern kann, da bei einer negativen Antwort auf diese Frage weitere Studien bedeutungslos werden.  Um die beiden unabh√§ngigen Gr√∂√üen zu vergleichen, m√ºssen wir beide kennen. Zun√§chst bestimmen wir die erforderliche Genauigkeit der Frequenzbegrenzung und die F√§higkeiten, die dieser bestimmte MK in diesem Teil bietet.  Eine wichtige Bemerkung zum vorherigen Satz - dies bedeutet nicht einen bestimmten Fall, ‚Äûder uns in Empfindungen gegeben wurde‚Äú, sondern einen bestimmten Typ von MK, der durch seine technische Beschreibung dargestellt wird. <br><br>  Zun√§chst werden wir etwas finden, das leichter zu finden ist (nun, ich dachte schon) - Anforderungen an die Genauigkeit der Zeitparameter der Schnittstelle.  Wir √∂ffnen den Standard f√ºr RS232 und sehen sofort alles, was Sie brauchen.  Es stellte sich heraus, dass "Sie es nicht einfach nehmen k√∂nnen und ...", weil der Standard bezahlt wird und alle Kopien im Web illegal sind.  Okay, wir bringen die inl√§ndische Version von GOST zum Gelenk C2 und finden dort √ºberhaupt keine Zeitparameter, mit Ausnahme der Dauer der Front und der Unterbrechung des Pulses.  Dies verursachte zun√§chst eine leichte Unruhe - wie es sein k√∂nnte -, aber dann wurde klar, dass das C2-Gelenk nur den Schnittstellenteil des IRPS beschreibt und die Anforderungen in letzterem sein sollten.  Im Prinzip ist alles logisch, es ist nicht nur klar, warum dies in GOST nicht explizit beschrieben wird, aber am Ende kann man manchmal selbst denken, obwohl es immer noch "irgendwie nicht ordentlich erhalten" ist. <br><br>  Wenn Sie das √úbertragungsprotokoll kennen, ist es nat√ºrlich aus allgemeinen √úberlegungen m√∂glich, die maximal zul√§ssige Nicht√ºbereinstimmung zwischen Sender- und Empf√§ngergeschwindigkeit (0,5 / 9,5 = 5,2%) zu ermitteln. Dies ist jedoch eine Untersuchung des sph√§rischen Pferdes, von dem Sie wissen, wo: <br><br><ol><li>  Die Anforderungen der Norm k√∂nnen und sollten strenger sein als eine √§hnliche theoretische Berechnung der maximal zul√§ssigen Nicht√ºbereinstimmung. </li><li>  Wenn wir die endg√ºltige Nicht√ºbereinstimmungszahl kennen, erhalten wir in keiner Weise das Budget des Senders und Empf√§ngers. </li></ol><br>  Das Wandern im Internet f√ºhrte zu Atmels AppNote (nun, da wir immer noch das MK dieser Firma verwenden), es spricht direkt von einer zul√§ssigen Nicht√ºbereinstimmung von 2% bei gleichem Budget, was zu einer Anforderung an die Genauigkeit der Aufrechterhaltung der Senderfrequenz von 1% f√ºhrt.  Wir werden einem seri√∂sen Unternehmen vertrauen und davon ausgehen, dass es Zugang zu klassifizierten Materialien hat und diese Zahl korrekt ist, zumal sie plausibel erscheint.  Ich verstehe die Verwundbarkeit einer solchen Position, aber um ehrlich zu sein, bin ich es leid, nach der genauen Antwort auf eine so einfache Frage zu suchen, und kann es kaum erwarten, mit dem n√§chsten Teil fortzufahren. <br><br>  Die n√§chste H√§lfte der Antwort liegt im MK und wird durch die technische Dokumentation daf√ºr bestimmt.  Zun√§chst ein wenig √ºber das Ger√§t des internen Generators, zumal es mehr oder weniger beschrieben wird.  Der Generator verwendet eine RC-Kette als Zeitsteuerungselement, und da die Aufgabe, einen integrierten Kondensator aus einem exakten Kondensator und einem exakten Widerstand zu bilden, sehr nicht trivial ist, variiert die Endfrequenz von Instanz zu Instanz des MC erheblich.  Um diesen Parameter vorhersehbarer zu machen, haben die Hersteller einen Hardwareknoten hinzugef√ºgt, der √ºber ein Kalibrierungsbyte gesteuert wird.  Mit diesem Ger√§t k√∂nnen Sie die Frequenz des Generators √ºber einen weiten Bereich √§ndern und dementsprechend den gew√ºnschten Wert mit viel h√∂herer Genauigkeit erhalten. <br><br>  Es w√§re interessant herauszufinden, wie genau die Steuerung in der Hardware implementiert ist. Ich sehe eine Option, entweder die Ladespannung des Kondensators √ºber den DAC zu steuern oder die Vergleichsspannung am Komparator zu steuern.  Beide Optionen f√ºhren jedoch zu einer signifikanten Nichtlinearit√§t der Steuereigenschaften, obwohl sie einfach zu implementieren sind.  Die interne Implementierung des Generators ist jedoch nicht Teil unserer Aufgabe, wir interessieren uns f√ºr seine externen Parameter. <br><br>  Also √∂ffnen wir die Dokumentation (Sie k√∂nnen die Datei im Viewer √∂ffnen, aber ich habe eine typografische Version der Beschreibung, die vom Hersteller selbst gedruckt wurde - ja, fr√ºher) und suchen nach dem entsprechenden Abschnitt.  Die Parameter, an denen wir interessiert sind, befinden sich im Abschnitt ‚ÄûKalibrierter interner RC-Oszillator‚Äú. Folgen Sie dann gegebenenfalls den Links.  Und hier haben wir (ich bin mir nicht sicher, ob Sie es sind) auf die erste Entt√§uschung gewartet - ich habe lange Zeit (ungef√§hr 15 Jahre) mit Atmel-Produkten gearbeitet und immer geglaubt, dass sie eine gute Dokumentation f√ºr MK haben.  Laut Psychiatern ‚Äûgibt es keine gesunden Menschen, es gibt keine unerforschten Menschen‚Äú und eine sorgf√§ltige Untersuchung des entsprechenden Abschnitts best√§tigte diese Wahrheit, da ich solche Fehler in der Dokumentation zuvor nicht feststellen konnte.  Zu meiner Verteidigung kann ich nur Folgendes sagen: <br><br><ol><li>  Ich habe in den MK-Daten nie einen internen Generator verwendet, daher habe ich ihn nicht besonders sorgf√§ltig studiert. </li><li>  Als ich anfing, mit diesen MKs zu arbeiten (vor viel mehr als 10 Jahren), war ich jung (nun ja, definitiv j√ºnger als jetzt) ‚Äã‚Äãund dumm und verstand die Notwendigkeit einer guten (verst√§ndlichen, umfassenden und eindeutigen) Dokumentation nicht vollst√§ndig. </li><li>  Ich bin bereit, mir viel zu vergeben, einfach weil ich mir viel vergebe und alle meine M√§ngel nicht fatal sind (das letzte Argument ist besonders √ºberzeugend, nicht wahr). </li></ol><br>  Nachdem ich meinen Kopf mit Asche best√§ubt habe, werde ich meine Anspr√ºche an die Dokumentation geltend machen, und es kann keine Entschuldigung f√ºr den Hersteller geben.  Wir √∂ffnen den obigen Abschnitt und beginnen ihn sorgf√§ltig zu studieren. Gegebenenfalls gehen wir zu den erforderlichen Seiten (Sie klicken immer noch auf die Links).  Gemeinsam werden wir nach den folgenden Parametern suchen, die die Zeitcharakteristik des Generators charakterisieren: Nenngenauigkeit, Einfluss der Versorgungsspannung, Einfluss der Temperatur und Alterungsparameter - dies ist der Mindestsatz, der zur Bewertung der Genauigkeitsparameter eines Generators erforderlich ist. <br><br>  Der erste Teil des Marleson-Balletts ist die nominelle Genauigkeit. <br><br>  Sofort finden wir den gew√ºnschten Parameter - die Generator-Abstimmgenauigkeitstabelle, in der zwei Zeilen ‚ÄûWerkskalibriert‚Äú mit dem angegebenen Wert ¬± 10% und ‚ÄûManuelle Kalibrierung‚Äú mit demselben Parameter ¬± 2% angezeigt werden. <br><br>  In Bezug auf diese Daten stellen sich sofort eine Reihe von Fragen: Was bedeuten sie und wie werden diese Parameter gemessen?  In der ersten Zeile gibt die Tabelle selbst die Temperatur (der Umgebung oder des MK selbst an - es ist unklar, aber dies ist eine Laune von meiner Seite) und die Versorgungsspannung. Au√üerdem hei√üt es in der Notiz (meiner Meinung nach ist dies nicht erforderlich), dass diese Messung an einem bestimmten Punkt im Raum durchgef√ºhrt wird √§u√üere Bedingungen.  Man kann davon ausgehen, dass wir in diesem Fall den beim Hersteller aufgezeichneten Kalibrierungsfaktor verwenden sollten, obwohl es besser w√§re, dies im Hinweis explizit anzugeben.  Alles ist mehr oder weniger klar und wird fast eindeutig interpretiert (obwohl im Zusammenhang mit dem Studium der technischen Dokumentation gesagt werden sollte, dass alles verschwommen ist und Variationen in der Interpretation zul√§sst, und dies ist inakzeptabel, aber wenn wir dies tun, verschwindet das Thema der weiteren Diskussion einfach (und was kommt als n√§chstes) schreiben, es ist nicht klar, daher Nachsicht zeigen). <br><br>  Bei der zweiten Zeile des Falls ist es jedoch schlimmer: Die Grenzen f√ºr √Ñnderungen der Temperatur und der Versorgungsspannung sind angegeben, und es wird argumentiert, dass Sie mit einem magischen Kalibrierungsverfahren im gesamten Bereich deutlich bessere Ergebnisse erzielen k√∂nnen als im Werk.  Meine Frage stellt sich sofort: Wenn dies √ºberall erreicht werden kann (zu jedem Zeitpunkt der Temperatur- und Stromversorgung) und der Hersteller wei√ü, wie dies zu tun ist, warum hat sie dies dann nicht selbst bei der Werkskalibrierung zu einem bestimmten Zeitpunkt unter den Bedingungen getan?  Wir wenden uns der Beschreibung des Kalibrierungsbytes zu und sehen, dass es 128 Werte annimmt. Dies deckt den Bereich von 50% bis 200% des Nennwerts ab, was 150/128 ~ 1,17% der Frequenz√§nderung pro Kalibrierungseinheit entspricht, was die erwartete Genauigkeit besser als in ergeben sollte 1%  Aber dann sollten wir ber√ºcksichtigen, dass die Anpassungskennlinie eindeutig nicht linear ist und im Bereich gro√üer Kalibrierungswerte 60% / 32 ~ 2% des Schritts liegen (Daten aus der Grafik, ich habe wiederholt meine Einstellung zu einer √§hnlichen Methode zur Darstellung technischer Parameter zum Ausdruck gebracht, aber ich wiederhole - dies ist inakzeptabel Die Methode ist nat√ºrlich besser als nichts), was eine Genauigkeit von 1% ergibt. Wenn wir die Monotonie der Anpassungskennlinie ber√ºcksichtigen (ja, das steht in der Dokumentation, wird sie nicht in der Grafik gezeichnet, sondern im Text klar angegeben. Ich weigere mich kategorisch zu verstehen zu  zu, und vor allem, warum wollte das Unternehmen ihm ein Gesetz der Anpassung machen, aber es geschaffen), die eindeutig in den Richtlinien angegeben ist, ist es notwendig, die Genauigkeit von 2% ist durchaus erreichbar zu betrachten.  Ich mag es nicht wirklich, dass ich mir das Diagramm ansehen musste, aber das ist nicht notwendig und die tabellarischen Daten sind ausreichend.  In diesem Teil sollte die Dokumentation als vollst√§ndig verst√§ndlich und konsistent angesehen werden. Das Kriterium der Richtigkeit liegt au√üerhalb unseres Kompetenzbereichs. <br><br>  Der zweite Teil des Marleson-Balletts.  - der Einfluss √§u√üerer Bedingungen. <br><br>  Und dann beginnt "M√ºll, D√§mpfe und Sodomie".  Anstelle von Wertetabellen sind wir eingeladen, Bilder anzusehen (aus irgendeinem Grund werden sie in der Dokumentation als Diagramme typischer Werte bezeichnet). Wie Sie wissen, "besteht der Hauptvorteil der grafischen Darstellung von Informationen in ihrer Sichtbarkeit und hat keine weiteren Vorteile."  Es w√§re m√∂glich, auch solche Informationen zu verwenden und Grenzwerte aus dem Diagramm zu entfernen (‚Äûobwohl dies f√ºr das Team anst√∂√üig ist‚Äú), wenn dieses Diagramm nicht im Abschnitt ‚ÄûTypische Merkmale‚Äú angegeben w√§re.  Ich wei√ü nicht, wie jemand pers√∂nlich zutiefst davon √ºberzeugt ist, dass die Angabe typischer (oder typischer, ich wei√ü nicht, wie man korrekter ist, in einem Film sagten sie "typisches Aussehen") Bedeutungen, zumindest in Form eines Diagramms, selbst in der Tabelle, einfach nichts anzeigt.  Sie k√∂nnen im Design nicht gef√ºhrt werden, da diese Parameter nicht klar sind, was sie bedeuten, und jede Abweichung von den typischen Werten akzeptabel ist, im Gegensatz zu den Minimal- und Maximalwerten, deren √úbergang auf eine Fehlfunktion des Ger√§ts hinweist. <br><br>  Nun, wir haben bestanden, wir werden versuchen, zumindest einige Informationen zu extrahieren und festzustellen, dass sich die Frequenz des Generators um ¬± 4% √§ndert, wenn sich die Temperatur von -40 auf + 80 ¬∞ C √§ndert.  Ein √§hnliches Bild mit der Versorgungsspannung - nur typische Grafiken und der daraus resultierende Fehler in -6 + 2% von 3,3 bis 5,5.  Daten zur Alterung des Generators werden einfach nicht angegeben, was im Allgemeinen logisch ist, da vor dem Hintergrund der bereits angegebenen Parameter die Genauigkeit von einem Prozent f√ºr 5 Jahre (ein charakteristischer Wert f√ºr Silizium) niemanden st√∂rt. <br><br>  Jetzt haben wir alle Daten, um unsere erste Frage zu beantworten: W√§hrend der Werkskalibrierung erf√ºllt der Generator nicht die Schnittstellenanforderungen f√ºr die Genauigkeit, wenn er f√ºr bestimmte Anwendungsbedingungen kalibriert wird. Er erf√ºllt die Grenzanforderungen, entspricht jedoch nicht dem Standard.  Es sollte auch beachtet werden, dass, wenn die Kalibrierung der Versorgungsspannung und eines bestimmten MK bei der Herstellung des Ger√§ts durchgef√ºhrt werden kann und gehofft wird, dass sie sich nicht zeitlich √§ndern, die Temperatur nur im laufenden Betrieb ber√ºcksichtigt werden kann und einen externen Zeitstandard mit angemessener Genauigkeit erfordert.  Da die Entwicklung von Ger√§ten von der Regel ‚ÄûWir glauben an Gott, alles andere erfordert Beweise‚Äú geleitet werden sollte und wir die M√∂glichkeit der Erf√ºllung der Anforderungen nicht bewiesen haben, ist die richtige Antwort, dass es unm√∂glich ist, die Implementierung von IRPS, das die Anforderungen des Standards in diesem MC erf√ºllt, mit einem internen Generator zu garantieren.  Beachten Sie, dass wir bei der Analyse der Dokumentation die obige Schlussfolgerung gezogen und sie so formuliert haben, dass betont wird, dass bei einer bestimmten Instanz von MK alles m√∂glich ist und wird, wenn die Sterne erfolgreich aufgehen.  Das hei√üt, unsere Schlussfolgerung widerspricht dem zuvor erw√§hnten Beitrag, wie k√∂nnte dies geschehen, weil f√ºr eine Person alles gut funktioniert - lassen Sie es uns herausfinden. <br><br>  Nun beginnt die Kritik am obigen Beitrag.  Lassen Sie uns zun√§chst √ºberlegen, wie wir sicherstellen k√∂nnen, dass das Ger√§t auf die Anforderungen einer bestimmten Schnittstelle √ºberpr√ºft wird.  Ich kann folgende M√∂glichkeiten vorschlagen: <br><br><ol><li>  Eine gute M√∂glichkeit besteht darin, die kritischen Parameter der Ger√§teschnittstelle zu messen und mit den Anforderungen des Standards zu vergleichen. Dies kann mit universellen Instrumenten (in unserem Fall dem Oszilloskop und der L√§nge des Bitintervalls oder der vollst√§ndigen √úbertragung) oder mit einem speziellen Ger√§t erfolgen, das zum Testen dieser Schnittstelle zertifiziert ist. </li><li>  So lala - Organisation der Interaktion mit einem anderen Ger√§t, das den Antwortteil der Schnittstelle implementiert und bew√§hrt ist (entspricht den Anforderungen des Standards).  Nat√ºrlich ist eine solche Pr√ºfung v√∂llig unzureichend und kann eher angewendet werden, um die Fehlfunktion des zu testenden Ger√§ts zu best√§tigen, tut aber zumindest etwas. </li><li>  Der schlechte Weg besteht darin, den Antwortteil der Schnittstelle (auf demselben oder einem anderen Ger√§t) unabh√§ngig zu implementieren und mit ihm zu interagieren.  Da beide Ger√§te offensichtlich nicht bewiesen sind, ist die N√ºtzlichkeit einer solchen Pr√ºfung sehr, sehr zweifelhaft.  Ein gutes Beispiel f√ºr diesen Ansatz ist das ‚ÄûEcho‚Äú auf einem seriellen Kanal, das nichts anderes beweist als die Tatsache, dass das Ger√§t im Grunde kaputt ist und etwas √ºbertragen kann, und kaum mehr als nichts √ºber die √úbertragungsgeschwindigkeit meldet. </li><li>  Ein schrecklicher Weg ist es, als Tester ein Ger√§t zu nehmen, das die Anforderungen des Standards √ºberhaupt nicht erf√ºllt (oder vielmehr widerspricht) und wie im vorherigen Absatz zu arbeiten. </li></ol><br>  Es ist die letztere Methode, die in der betrachteten Post verwendet wurde - ein serieller Kanalsoftwareempf√§nger ist implementiert, der entgegen den Anforderungen des Standards seine Frequenz √§ndert, um sich an das Eingangssignal (insbesondere die L√§nge des Startbits) anzupassen, was einen stabilen Empfang eines Signals schlechter Qualit√§t in Bezug auf Zeitparameter erm√∂glicht.  Dies bedeutet nicht, dass dies niemals durchgef√ºhrt werden sollte. Au√üerdem wurde bei analogen Modems die Abstimmung auf die eingehende Geschwindigkeit √ºbernommen, die auf √§hnliche Weise implementiert wurde, aber die Frequenz durch √Ñndern des Teilers genau umgeschaltet wurde, und dies ist eindeutig nicht unser Fall.  Und in dieser Version wird alles perfekt erhalten und Informationen werden unter allen √§u√üeren Bedingungen stabil √ºbertragen.  Wenn wir also √ºber die M√∂glichkeit sprechen, Informationen zwischen zwei MCs zu √ºbertragen, die von internen Generatoren √ºber eine Schnittstelle arbeiten, die entfernt an IRPS erinnert, lautet die Antwort Ja.  Wenn wir √ºber die Interaktion mit externen Ger√§ten sprechen, die den Anforderungen des Standards entsprechen, und nicht mehr, dann erwarten wir viele unangenehme √úberraschungen. <br><br>  Die allgemeine Schlussfolgerung aus dem Obigen: <br><br><ol><li>  Beim Entwerfen von Ger√§ten sollten Sie sich auf die Dokumentation (RTFM) konzentrieren. </li><li>  Sie m√ºssen die Dokumentation studieren und richtig interpretieren, was Sie lesen (RTFMF). </li><li>  Denken Sie daran, dass Dokumentation in unserer Zeit daher zu Missverst√§ndnissen, Ungenauigkeiten (und sogar Fehlern) f√ºhren kann </li><li>  √úberpr√ºfen Sie die erhaltenen Informationen auf Konsistenz und Glaubw√ºrdigkeit </li><li>  Verwenden Sie die experimentell erhaltenen Informationen nur, um die Schlussfolgerungen aus der Analyse der Dokumentation zu best√§tigen </li><li>  W√§hlen Sie die Versuchsmethoden f√ºr Pr√ºfger√§te sorgf√§ltig aus, um ein zuverl√§ssiges Ergebnis zu erhalten. </li></ol><br>  Nun, abschlie√üend, wie versprochen, ein kleiner Monteur.  Ich habe mir erlaubt, das vom Autor angegebene Codefragment in normaler Form umzuschreiben, da der in das GCC eingebaute Assembler nichts anderes als ein Spott √ºber den Programmierer ist, den ich nennen kann.  Nein, nat√ºrlich verstehe ich, dass die Entwickler des Compilers von guten Gr√ºnden geleitet wurden, aber das Ergebnis √§hnelt schmerzlich dem Satz "Nun, es funktioniert". <br><br><pre><code class="hljs vhdl">.equ delay=<span class="hljs-number"><span class="hljs-number">15</span></span> TX_Byte: cli ; ld r18,Z+ ; cp r18,r1 ; breq Exit_Transmit ; dec r1 cbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>, TX_line Delay_TX: ldi r16,delay Do_Delay_TX: nop dec r16 brne Do_Delay_TX TX_Bit: sbrc r18,<span class="hljs-number"><span class="hljs-number">0</span></span> sbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>,TX_line sbrs r18,<span class="hljs-number"><span class="hljs-number">0</span></span> cbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>,TX_line lsr r18 lsr r17 brcs Delay_TX sbi <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>, TX_line ldi r16,delay Stop_Bit_TX: nop dec r16 brne Stop_Bit_TX Sei</code> </pre> <br>  Und sofort f√§llt ein Fehler im Programm auf - in Zeile 3 (auskommentiert) sollte der Wert von Register 1 Null sein, aber die Zuordnung wird nicht explizit in die Funktion geschrieben.  Nach Abschluss eines Einzelbyte-√úbertragungszyklus wird dieser Wert durch Zeile 12 garantiert, jedoch nicht beim ersten Durchgang.  Daher muss eine Initialisierung hinzugef√ºgt werden, die eine Erh√∂hung der Codegr√∂√üe erfordert. <br><br>  Der zweite Nachteil ist die tats√§chliche Bildung des Pegels in den Zeilen 4 bis 7, da das vom Autor angewendete Verfahren zum Ausgeben des n√§chsten Bits zu Front-Jitter f√ºr 2 Taktzyklen bei verschiedenen √úberg√§ngen (0-1 und 1-0) f√ºhrt, was eine Erh√∂hung der Anforderungen an die Genauigkeit des Haltens der Frequenz zur Folge hat.  Nicht, dass dies einen sehr starken Einfluss h√§tte, aber wenn Sie einen Fehler korrigieren k√∂nnen, ohne das Programm zu erweitern, warum nicht - siehe Epigraph.  Die urspr√ºngliche Version bestand aus 4 W√∂rtern und wurde in 4 Takten ausgef√ºhrt, die neue aus 4 W√∂rtern und wurde in denselben 4 Takten ausgef√ºhrt.  Ja, die korrigierte Version erfordert eine eingehendere Untersuchung der MK-Architektur, aber wer hat gesagt, dass dies einfach ist?  Andererseits ist in der ersten Version die Portmodifikation atomar und in der zweiten nicht, in diesem Fall spielt es keine Rolle (wir haben Unterbrechungen ausdr√ºcklich verboten), aber das Sediment bleibt.  Wenn der fragliche MK einen echten Bitprozessor h√§tte, wie in Architektur 51, dann k√∂nnten wir ein ideales Fragment schreiben, das alle Vorteile beider Ans√§tze kombiniert (und sogar etwas k√ºrzer ist), aber was k√∂nnen wir von einem Wunschtraum tr√§umen ... <br><br>  Der dritte Nachteil ist das Thema mehr Stil.  Ich habe wiederholt meine Einstellung zu den magischen Konstanten zum Ausdruck gebracht, die wir in der Pr√§ambel dieses Programms sehen.  Ich betone noch einmal - von der Tatsache, dass der Autor in der Pr√§ambel des Programms eine Konstante setzt und nicht direkt im Operator, geht "gew√∂hnliche Stra√üenmagie" nirgendwo hin.  Tatsache ist, dass wir dem Leser die Methode zur Bildung eines bestimmten Wertes explizit vorstellen m√ºssen und kein Synonym f√ºr den auf unbekannte Weise erhaltenen Wert erstellen m√ºssen.  Sie k√∂nnen nat√ºrlich einen Kommentar in eine Zeile mit einem Wert schreiben, in dem die Berechnungsformel angegeben werden soll. Es ist jedoch besser, die Berechnungsformel explizit zur Bildung der Konstante zu verwenden, und dann ben√∂tigen Sie nur keinen Kommentar (nat√ºrlich mit den sprechenden Namen der angewendeten Konstanten).  Dies geschieht im folgenden Text. Beachten Sie, dass wir erst im letzten Moment in eine Ganzzahl konvertieren und diese korrekt abrunden, damit wir die Genauigkeit des Ergebnisses nicht verlieren. <br><br>  Es gibt einen weiteren Fehler: Die L√§nge des Startbits unterscheidet sich etwas vom Bitintervall f√ºr die Daten.  Obwohl die Abweichung nicht zu signifikant ist (3 Taktzyklen), ist dies bei hohen Bitraten, bei denen das Bitintervall etwa 90 Taktzyklen dauert, bereits ein Fehler von einigen Prozent, was nicht akzeptabel ist.  Dieser Fehler kann leicht durch Hinzuf√ºgen von Befehlen zum Erzeugen einer zus√§tzlichen Verz√∂gerung behoben werden. Dies erh√∂ht jedoch die L√§nge des Programms, sodass wir nur dessen Vorhandensein beheben und dann sicherstellen, dass die korrekte Architektur des Programms (dh auch diese kurzfristige Anwendung) automatisch beseitigt wird. <br><br>  Nun, da wir die Fehler behoben haben (mit Ausnahme des letzten), werden wir versuchen, das Programm im Sinne des Hauptkriteriums (um in diesem speziellen Fall einen Datensatz zu erzielen) zu verbessern - der L√§nge des Codes.  Das erste, was auff√§llt, ist das Vorhandensein von zwei Zeitverz√∂gerungen, was schlecht ist, da es gegen das DRY-Prinzip (allgemeine Anforderung) verst√∂√üt und die Codegr√∂√üe erh√∂ht (spezifische Anforderung).  Es w√§re m√∂glich, dieses Fragment in Form eines Unterprogramms anzuordnen, und wir w√ºrden immer noch an L√§nge gewinnen, da wir 3 Codew√∂rter hinzuf√ºgen (1 f√ºr jeden Aufruf an zwei Stellen und 1 f√ºr die R√ºckgabe) und 4 speichern, aber es gibt einen viel sch√∂neren Weg - ordentlich die Organisation des Byte√ºbertragungszyklus, die im folgenden Text zu sehen ist. <br><br><pre> <code class="hljs vhdl">.equ delay=<span class="hljs-number"><span class="hljs-number">15</span></span> TX_Byte: cli sec ;   - clt ;  - TransBit: ;    <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r17,<span class="hljs-keyword"><span class="hljs-keyword">port</span></span> bld r17,Tx_line <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span>,r17 Delay_TX: ;     ldi r17,delay Do_Delay_TX: nop dec r17 brne Do_Delay_TX TX_Bit: bst r16,<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ror</span></span> r16 clc brne TransBit ;    brcs TransBit ;  - Exit_Transmit: Sei</code> </pre><br>  Beachten Sie, wie wir das √ºbertragene Byte zusammen mit dem √úbertragsbit als Bitz√§hler verwenden, eine sch√∂ne L√∂sung, aber es hat einen Nachteil: Die Dauer des letzten Datenbits ist aufgrund der Verz√∂gerung des √úbergangs mehrere (2 Zyklen) l√§nger als der Rest.  Wenn wir √ºber ein Stoppbit gesprochen haben, dann ‚Äûegal und vergessen‚Äú, da wir nicht das Mindestintervall zwischen den √úbertragungen erhalten haben, aber dies ist ein bedeutendes Bit, und wir haben gerade das urspr√ºngliche Programm f√ºr ein solches Verhalten kritisiert.  Wir werden nicht mit dem biblischen Charakter aus dem Gleichnis vom Mote in den Augen anderer verglichen und Ma√ünahmen ergreifen, um ihn zu beseitigen.  Dieses Ph√§nomen k√∂nnte leicht durch die Einf√ºhrung einer Verz√∂gerung von 2 Takten kompensiert werden, aber die Codel√§nge nimmt zu, und dies ist ein Schl√ºsselparameter.  Gehen wir also den klassischen Weg und √§ndern die Zeit f√ºr den Speicher - wir verwenden ein separates Register zum Organisieren des Z√§hlers der √ºbertragenen Bits und erhalten genau die gleichen Bitintervalle mit der gleichen Codegr√∂√üe. <br><br>  Die n√§chste Verbesserung ist mit der Bildung der Dauer des Bitintervalls verbunden, das im urspr√ºnglichen Programm in einem 4-Zyklus-Zyklus ausgef√ºhrt wird.  Wenn wir es 3-Takt machen (das kleinstm√∂gliche in diesem MK), k√∂nnen wir ein Byte Code speichern und m√∂glicherweise die Genauigkeitsparameter verbessern, da die Diskretion der Verz√∂gerung geringer wird (die Abweichung √ºberschreitet bei korrekter Rundung nicht die halbe Gr√∂√üe des Diskreten).  Es sollte jedoch ber√ºcksichtigt werden, dass in einem bestimmten Fall die Genauigkeit verloren gehen kann. Dies h√§ngt alles von den Quelldaten ab.  Ein weiterer Umstand, der die Auswahl einer solchen Zyklusdauer beeinflussen k√∂nnte - die maximale Verz√∂gerungsgr√∂√üe f√ºr einen Bytez√§hler betr√§gt 256 Werte -, k√∂nnen Sie f√ºr die verf√ºgbare Option Geschwindigkeiten ab 9600 Baud und h√∂her verwenden. Bei einer Verz√∂gerung von 3 Zyklen ist dies jedoch nicht m√∂glich.  Es w√§re sehr sch√∂n, diesen Umstand (die minimal zul√§ssige Portgeschwindigkeit) in den Kommentaren zum Programm wiederzugeben und gleichzeitig eine Warnmeldung anzuzeigen, falls diese Anforderung verletzt wird.  Nehmen Sie die entsprechenden √Ñnderungen an den Parameterbildungsmakros vor, um eine Verz√∂gerung zu bilden, und vergessen Sie nicht, "sprechende" Namen zur Angabe von Variablen zu verwenden. <br><br><pre> <code class="hljs dos">.<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> Freq = <span class="hljs-number"><span class="hljs-number">8000000</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> BaudRate = <span class="hljs-number"><span class="hljs-number">115200</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> PayLoad = <span class="hljs-number"><span class="hljs-number">9</span></span> ;     .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> CycleTime = <span class="hljs-number"><span class="hljs-number">3</span></span> ;    .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> delay=((Freq*<span class="hljs-number"><span class="hljs-number">2</span></span>/BaudRate - PayLoad*<span class="hljs-number"><span class="hljs-number">2</span></span>)+CycleTime)/(CycleTime*<span class="hljs-number"><span class="hljs-number">2</span></span>) TX_Byte: cli ldi r18,<span class="hljs-number"><span class="hljs-number">10</span></span> sec ;   - clt ;  - TransBit: <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> r17,port bld r17,Tx_line out port,r17 Delay_TX: ldi r17,delay Do_Delay_TX: dec r17 brne Do_Delay_TX TX_Bit: bst r16,<span class="hljs-number"><span class="hljs-number">0</span></span> ror r16 dec r18 brne TransBit Exit_Transmit: sei</code> </pre><br>  Schauen wir uns nun das Ergebnis an - die Codegr√∂√üe verringerte sich von 20 auf 16 W√∂rter (wenn wir nur die √úbertragung selbst ber√ºcksichtigen, dann noch auff√§lliger - von 18 auf 14 verschwand der Jitter der Fronten (nat√ºrlich nur die Jitterkomponente, die durch die Programmfunktionen verursacht wird, auf der Hardwarekomponente, wir Wir verletzen nicht), die Genauigkeit der Einhaltung von Zeitintervallen hat sich verbessert, das Programm ist sichtbarer und verst√§ndlicher geworden (aufgrund von Kommentaren, da selbst ein gut geschriebenes Assembler-Programm normalerweise nicht selbst dokumentiert ist). <br><br>  Die Schlussfolgerung aus dem letzten Teil lautet: Wenn wir Weltrekorde in der Assembler-Programmierung aufstellen wollen, sollten wir die Architektur eines bestimmten MK sehr gr√ºndlich studieren und das gewonnene Wissen anwenden, um das ideale Ergebnis zu erzielen, wobei wir alle Feinheiten ber√ºcksichtigen. <br><br>  Gut und abschlie√üend - die Aufgabe, Code mit der Mindestgr√∂√üe zu schreiben, sieht heutzutage etwas kompliziert aus, erh√§lt aber ganz unerwartet eine Best√§tigung seiner Vitalit√§t.  Ende letzten Jahres (2016, so lange hat dieser Beitrag auf seinen Einsatz gewartet) wurde ein neuer MK aus der MSP430-Familie angek√ºndigt, der neben dem einzigartig niedrigen Preis (26 Cent - wir warten auf das Erscheinen chinesischer Ger√§te, die darauf basieren) auch eine einzigartig kleine Programmspeichergr√∂√üe hat - 512 Byte (nein, ich habe mich nicht geirrt, der Buchstabe "k" unmittelbar nach der Nummer ist nicht).  Daher kann sich die Gr√∂√üe des Codes bei der Verwendung dieses Ger√§ts als kritisch herausstellen, und das Schreiben derart extremer Programme erfordert im Allgemeinen eine eingehende Untersuchung von MK, und "die Arbeit selbst ist ein Segen". </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de412959/">https://habr.com/ru/post/de412959/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de412949/index.html">Astrologen k√ºndigen eine Woche iOS-Entwicklung in Avito an</a></li>
<li><a href="../de412951/index.html">DotVVM - Kommunikation zwischen Client und Server</a></li>
<li><a href="../de412953/index.html">Intel RealSense d435 Kamerakalibrierung mit OpenCV2 und ROS</a></li>
<li><a href="../de412955/index.html">UI-Tests in Xcode mit Embassy und Succulent</a></li>
<li><a href="../de412957/index.html">Mi Band 4 und Mi Band 5: Die Zukunft der Xiaomi Smart Bracelets</a></li>
<li><a href="../de412961/index.html">Sharing Economy in der Telekommunikation</a></li>
<li><a href="../de412963/index.html">New Fallout: Was ist √ºber Vault 76 bekannt?</a></li>
<li><a href="../de412967/index.html">Erstellen eines sch√∂nen Widgets zur Helligkeitsanpassung</a></li>
<li><a href="../de412969/index.html">Gesichtserkennungssysteme erscheinen in US-Schulen, aber ihre Wirksamkeit ist fraglich</a></li>
<li><a href="../de412971/index.html">Erstellen einer Farbanwendung auf Unity3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>