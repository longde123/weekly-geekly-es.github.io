<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ü üë©üèø‚Äçüîß ‚úçüèæ Overclockeamos la copia de seguridad. Conferencia de Yandex üí¶ üà∫ üò¢</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Varias conferencias futuras se basar√°n en la primera Y. Subbotnik en bases de datos que se realizar√°n en la primavera . Primero, el desarrollador Andr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Overclockeamos la copia de seguridad. Conferencia de Yandex</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/415817/">  Varias conferencias futuras se basar√°n en la primera Y. Subbotnik en bases de datos que se realizar√°n <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">en la primavera</a> .  Primero, el desarrollador Andrei Borodin habl√≥ en Y. Subbotnik.  Habl√≥ sobre WAL-G, una herramienta simple y efectiva para hacer copias de seguridad de PostgreSQL en la nube, as√≠ como sobre algoritmos y tecnolog√≠as que permiten a WAL-G crear copias de seguridad m√°s r√°pido.  La caracter√≠stica principal de WAL-G son las copias de seguridad delta.  En la conferencia aprender√° acerca de su implementaci√≥n y c√≥mo se est√° desarrollando el soporte para esta tecnolog√≠a en PostgreSQL. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bXuN4Na0cEo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  - hola!  Soy un desarrollador de Yandex de Ekaterimburgo.  A la tecnolog√≠a de respaldo r√°pido.  Hemos estado haciendo copias de seguridad durante bastante tiempo; hubo informes de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Vladimir Borodin</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Evgeny Dyukov</a> sobre c√≥mo investigamos y qu√© desarrollamos para almacenar datos de manera segura, confiable, conveniente y eficiente.  Esta serie est√° dedicada a los √∫ltimos desarrollos en esta √°rea. <br><br>  Hablemos de las copias de seguridad en PostgreSQL en principio.  La utilidad est√°ndar para transferir datos, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">pg_dump</a> , se define como una utilidad de consola que crea un archivo con una representaci√≥n l√≥gica de sus datos. <br><a name="habracut"></a><br>  Que es una copia l√≥gica es bastante conveniente.  Siempre puede transferir datos entre diferentes versiones, puede cortar su base de datos en pedazos, y esta es una herramienta est√°ndar que, por ejemplo, viene en un cuadro con la utilidad de administraci√≥n PgAdmin. <br><br><img src="https://habrastorage.org/webt/3j/zs/kh/3jzskhrdbobeb5pfvdyebjvv9bi.jpeg"><br>  En primer lugar, sobre pg_dump necesita saber que esta es una herramienta para desarrolladores. <br><br>  Esta no es una herramienta de mantenimiento de bases de datos.  pg_dump no est√° dise√±ado para funcionar con una base de datos altamente cargada. <br><br><img src="https://habrastorage.org/webt/rb/sk/yf/rbskyfdmcwqb9ctu6-idvcj6ywm.jpeg"><br>  Suponga que todo es serio y desea utilizar la tecnolog√≠a de "recuperaci√≥n en un punto en el tiempo", que utiliza la API PostgreSQL para trabajar con copias de seguridad en l√≠nea.  Llama a la funci√≥n pg_start_backup y realiza una copia de archivo de la base de datos.  De hecho, pg_start_backup obliga a la base de datos a hacer CHECKPOINT;  y habilite las escrituras de p√°gina completa en el registro de escritura anticipada.  La copia de la base de datos que realiza cuando llama a la API no es una copia coherente de los datos.  Tambi√©n necesita un registro de escritura anticipada para poder restaurar su base de datos durante la llamada pg_stop_backup, es decir, al final de la copia de seguridad. <br><br><img src="https://habrastorage.org/webt/0a/aw/v1/0aawv1w0gp9okkkbjuja0k-ywg4.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Despu√©s del tiempo de finalizaci√≥n de la eliminaci√≥n de la copia de seguridad y en presencia de un registro l√≠der, puede recuperarse hasta el punto deseado en el tiempo de vida de su base de datos. <br><br>  La utilidad pg_basebackup se suministra en el cuadro, que implementa toda esta tecnolog√≠a en forma can√≥nica y le permite realizar copias de seguridad con la funcionalidad m√≠nima necesaria. <br><br>  Si a√∫n eres m√°s serio que antes, entonces usas alg√∫n tipo de software de administraci√≥n de copias de seguridad, y generalmente es Barman. <br><br>  El tiene varias ventajas.  La ventaja principal es una utilidad muy com√∫n, tiene una gran comunidad, una gran cantidad de preguntas sobre Stack Overflow. <br><br><img src="https://habrastorage.org/webt/hk/_s/xx/hk_sxxzzua_byoapw4kvxdexymm.jpeg"><br><br>  Solo necesita elegir un servidor de respaldo y hacer una copia de seguridad de todos sus PostgreSQL all√≠.  Esto es muy conveniente, siempre y cuando un servidor de respaldo sea suficiente para usted. <br><br>  Tan pronto como tenga muchos servidores de respaldo, debe monitorear si alguno de ellos est√° lleno.  En caso de falla de alg√∫n servidor de respaldo, debe comprender cu√°les de sus bases de datos est√°n ahora en peligro.  En principio, debe comprender d√≥nde copiar un nuevo cl√∫ster de base de datos al crearlo. <br><br>  Hay una utilidad de eliminaci√≥n de copias de seguridad mucho m√°s simple llamada WAL-E. <br><br><img src="https://habrastorage.org/webt/jf/l1/a0/jfl1a07ymxdr0luksh1zg_cb7ii.jpeg"><br>  WAL-E ejecuta cuatro comandos principales.  El comando WAL-PUSH env√≠a un archivo WAL a la nube, y el WAL-FETCH toma un archivo WAL si debe restaurar restore_command. <br><br>  Tambi√©n hay BACKUP-PUSH (implementa la eliminaci√≥n de la API de respaldo) y BACKUP-FETCH (toma todos los datos de la nube).  Los datos se almacenan en la nube, por lo que no necesita monitorear nada, esto ya es un problema del servicio en la nube, c√≥mo garantizar la disponibilidad de sus datos cuando los necesite.  Esta es probablemente la principal ventaja de WAL-E. <br><br><img src="https://habrastorage.org/webt/tz/2e/h5/tz2eh51uc_vtsp-oylcltmgep1i.jpeg"><br>  Hay bastante funcionalidad.  Hay una lista de copias de seguridad, hay una pol√≠tica de retenci√≥n, es decir, queremos almacenar copias de seguridad de los √∫ltimos siete d√≠as, por ejemplo, o las √∫ltimas cinco copias de seguridad, algo as√≠.  Y WAL-E puede realizar copias de seguridad en una gran variedad de servicios en la nube: S3, Azure, Google, puede llamar al sistema de archivos local la nube. <br><br><img src="https://habrastorage.org/webt/n9/wj/uz/n9wjuz9n4tg_w8cvkkbp4g7_imi.jpeg"><br>  Tiene varias propiedades.  En primer lugar, est√° escrito en Python y utiliza activamente la canalizaci√≥n de Unix, en parte debido a esto, tiene dependencias y no es muy productivo.  Esto es normal porque WAL-E se enfoca en la facilidad de uso, la facilidad de configuraci√≥n para que no pueda cometer un error al hacer un plan de respaldo.  Y esa es una muy buena idea. <br><br>  Hay muchas caracter√≠sticas escritas en WAL-E, y donde los autores lo desarrollaron a√∫n m√°s no fue muy claro para los autores.  Se me ocurri√≥ la idea de que necesito una nueva herramienta. <br><br><img src="https://habrastorage.org/webt/ov/tj/ed/ovtjeduv1bhofpvnrbv2oong4ok.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Su caracter√≠stica principal es que se reescribe en Go, casi no tiene dependencias externas, si no usa cifrado externo, y es mucho m√°s productivo. <br><br><img src="https://habrastorage.org/webt/fl/pl/h2/flplh2x6ugfya5ydixenji9hmxg.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  WAL-G fue creado originalmente por dos autores de Citus Data, y la ventaja principal se muestra en este histograma: la velocidad de env√≠o de "ejes".  Vemos que WAL-E es r√°pido, puede ser cualquier cosa, puede ser una gran columna cerca de cero. <br><br><img src="https://habrastorage.org/webt/r_/si/dn/r_sidnqgiipagw5sosfzo8ze90e.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  WAL-G tiene un ancho de banda bastante estable.  En las pruebas realizadas en Citus Data, demostr√≥ que env√≠a de manera estable unos 800 Mb / s de "ejes". <br><br>  Adem√°s, en WAL-G, por ejemplo, escrib√≠ una funci√≥n que implementa una copia de seguridad de una r√©plica.  No necesita cargar su maestro de base de datos con una carga de lectura, puede eliminar la copia de seguridad de la r√©plica. <br><br><img src="https://habrastorage.org/webt/ck/bl/jj/ckbljjqa0ujh35rnlmncx5guauw.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  Pero hay un peque√±o problema.  En el momento en que comience a hacer la copia de seguridad, debe nombrarla de alguna manera.  El nombre incluye una l√≠nea de tiempo, que se cambiar√° si se promociona una r√©plica.  Si se produce una conmutaci√≥n por error en la cadena de r√©plicas antes de la r√©plica con la que est√° realizando una copia de seguridad, notar√° algunas de las r√©plicas, la l√≠nea de tiempo cambiar√°.  WAL-G entiende que esta situaci√≥n no es consistente, ya que al tener un nombre en la l√≠nea de tiempo anterior, el nombre le promete que puede continuar el desarrollo del historial de la base de datos en cualquier direcci√≥n existente.  Pero esto no es as√≠.  Ya ha ido a una de las direcciones; no puede saltar a otra l√≠nea de tiempo con el autom√≥vil de atr√°s.  Por lo tanto, WAL-G comprende esta situaci√≥n y no carga un archivo JSON fiscal en la nube.  Creas una copia f√≠sica.  Pero se requiere la intervenci√≥n del administrador para poder utilizar esta copia. <br><br><img src="https://habrastorage.org/webt/no/yo/nv/noyonvp7l8d-0myokmscgjts31w.jpeg"><br><br>  Hemos implementado copias delta en WAL-G, tambi√©n trabaj√© en este desarrollo.  Esto le permite tomar menos datos en la pr√≥xima copia de seguridad base, no puede hacer una copia de esas p√°ginas de datos que no han cambiado desde la copia de seguridad anterior. <br><br><img src="https://habrastorage.org/webt/dt/cn/ag/dtcnaglkk_z3i6rsm_hvs56m28o.jpeg"><br>  Al configurar WAL-G, especifica el n√∫mero de pasos que est√°n m√°s lejos de la copia de seguridad base, la copia de seguridad delta, y especifica la pol√≠tica de copia delta.  O haces una copia desde el √∫ltimo delta existente o haces un delta desde la copia de seguridad completa original.  Esto es necesario en el caso de que el mismo componente de la base de datos siempre cambie en su base de datos, los mismos datos cambian constantemente. <br><br>  ¬øPor qu√©, en principio, necesitamos copias delta de la base de datos?  En teor√≠a, tiene un WAL, por lo que puede rodar a cualquier lugar. <br><br>  En un servidor ocupado, jugar el WAL de cinco segundos f√≠sicos del pasado puede tomar cuatro segundos f√≠sicos del presente.  Si se le pide que retire el WAL en cuatro d√≠as, esto significa que es posible que la persona que lo solicite espere otros tres d√≠as.  No siempre es una situaci√≥n aceptable. <br><br>  Necesita copias de seguridad b√°sicas para todos los d√≠as, pero, sin embargo, no puede guardar all√≠ 7 o 14 copias completas de su base de datos, aunque WAL-G las archivar√°, seguir√° siendo bastante grande.  Y en este caso, las copias delta ayudan. <br><br><img src="https://habrastorage.org/webt/xw/aw/-l/xwaw-ll2y9911p6gjynx3dxhfb0.jpeg"><br>  Al desarrollar copias delta, se discutieron varios posibles formatos de archivos de datos.  En primer lugar, se propuso el formato, cuando no desestabilizamos la p√°gina, simplemente la anulamos.  Pero llegamos a la conclusi√≥n de que esta no es una forma muy efectiva, los ceros se comprimen efectivamente, pero luego rechazamos este m√©todo de almacenamiento, porque es dif√≠cil depurarlo en caso de situaciones de emergencia. <br><br><img src="https://habrastorage.org/webt/y1/cd/m-/y1cdm-xvhv7sq-4wt8e3y_xzaia.jpeg"><br>  La siguiente tecnolog√≠a que se consider√≥ es primero almacenar el n√∫mero de bloque y luego el bloque modificado.  Pero aqu√≠ nos enfrentamos con la peculiaridad del almacenamiento en archivos TAR, que primero debemos indicar el tama√±o de los archivos TAR en los que almacenamos nuestra copia delta, y luego comenzar a grabarla.  Quer√≠a implementar la tecnolog√≠a con un m√≠nimo de RAM consumida, por lo que tuvimos que usar el tercer formato en el que primero le√≠amos completamente cada archivo de datos, buscamos las p√°ginas de datos modificadas, primero almacenamos los n√∫meros de los bloques modificados en el archivo TAR, y solo entonces los bloques modificados mismos. <br><br><img src="https://habrastorage.org/webt/ew/le/eo/ewleeouqovcrezeke5wv6nndmby.jpeg"><br><img src="https://habrastorage.org/webt/mj/qx/rg/mjqxrg9h-jhu0nlatbxarh1jaaw.jpeg"><br><br>  Esta caracter√≠stica a√∫n no se ha implementado.  La estoy mirando o buscando a alguien que quiera hacer una solicitud de extracci√≥n en WAL-G.  Al recuperarse de una copia delta, la base de datos sobrevive a cada una de las reencarnaciones de la base de datos en cada paso de la copia de seguridad delta.  A veces, en la mitad de la vida, se eliminan algunos archivos.  Al mismo tiempo, no tendr√≠amos que preocuparnos por su condici√≥n si se eliminan de todos modos, y luego se recrean a partir de la copia delta.  Esto no parece ser una caracter√≠stica muy complicada, por lo que si est√° interesado en escribir algo en Go, eche un vistazo a esta caracter√≠stica. <br><br><img src="https://habrastorage.org/webt/g3/fa/7d/g3fa7d6otwscpktvrov045nvmni.jpeg"><br>  Programe sobre el uso de red, CPU y disco.  En WAL-E, como vemos, el respaldo aqu√≠ a√∫n no ha terminado, comenz√≥ a la una de la ma√±ana en Mosc√∫, y no termin√≥ en el √∫ltimo informe que vemos.  El cronograma WAL-G ha terminado, funciona m√°s r√°pido y es mucho m√°s parejo en t√©rminos de consumo de recursos. <br><br>  Lo m√°s interesante es el gr√°fico del consumo de recursos durante una copia delta.  Vemos que todos los recursos se han vuelto casi nulos.  La carga en la CPU es casi la carga est√°ndar en la base de datos; por la noche, se ejecutan algunas consultas.  Vemos una gran punta de lectura.  Tambi√©n me ocupo de eso, tambi√©n me gustar√≠a retirar la solicitud o lo har√© yo mismo en el verano.  La conclusi√≥n es que todav√≠a tenemos que leer nuestros datos para descubrir qu√© ha cambiado en ellos.  Esta lectura podr√≠a haberse evitado. <br><br><img src="https://habrastorage.org/webt/6g/bz/w7/6gbzw7p2zf7bbczdq3hnc-z1ni8.jpeg"><br><br>  Hay una eliminaci√≥n en WAL-G cuando indicamos el n√∫mero de copias de seguridad o la fecha a partir de la cual necesitamos almacenar todas las WAL y todas las copias de seguridad base.  Y WAL-G ya est√° lidiando con la pregunta de qu√© WAL y copias de seguridad base se necesitan.  Hasta ahora no tenemos caracter√≠sticas que eliminen todo.  En WAL-E es, tambi√©n, una ocasi√≥n para una solicitud de extracci√≥n.  A√∫n no se ha implementado un interesante comando DELETE EVERYTHING. <br><br><img src="https://habrastorage.org/webt/5q/1t/aw/5q1tawrrz1gj-l4wu1igxubfd4q.jpeg"><br><br>  Hay una lista de copias de seguridad. <br><br><img src="https://habrastorage.org/webt/kq/gs/mw/kqgsmwqqiezwwifwb8puxmzlugm.jpeg"><br>  Establecemos la variable de entorno necesaria para que WAL-G funcione y llamamos a la utilidad de consola WAL-G.  Se muestran las copias de seguridad que necesitamos ver. <br><br><img src="https://habrastorage.org/webt/id/uv/rg/iduvrgdmb1nca0nbfcpvs0cxfc8.jpeg"><br>  WAL-G implementa muchas tecnolog√≠as para paralelizar las copias de seguridad y, en general, diversas operaciones.  Por ejemplo, esta tecnolog√≠a se utiliza para enviar "ejes" al archivo.  Tan pronto como PostgreSQL llame a archive_command para enviar un archivo, WAL-G busca si hay m√°s archivos listos cerca. <br><br>  En general, esta no es una caracter√≠stica muy documentada, es muy estable en las √∫ltimas versiones de PostgreSQL, muchas tecnolog√≠as lo usan.  Analizamos si hay archivos WAL listos para usar en estado de archivo, y tambi√©n los enviamos junto con el que solicit√≥ enviar la base de datos al archivo.  Y cuando PostgreSQL les pide que env√≠en, ya los hemos enviado, estamos listos.  Esto acelera significativamente el env√≠o de WAL en bases cargadas y le permite hacer que no sea de un solo subproceso.  Normalmente, PostgreSQL prepara un archivo, luego espera a que se vaya y prepara el siguiente.  Logramos evitar este trabajo constante. <br><br><img src="https://habrastorage.org/webt/pc/3k/5f/pc3k5fkukjj7o5zqxm7hsjr3way.jpeg"><br>  Durante WAL-FETCH, cuando se restaura el cl√∫ster, tambi√©n intentamos descargar los siguientes archivos N que ser√°n necesarios, y tratamos de equilibrar las pausas entre el inicio de la b√∫squeda previa de nuevos archivos WAL para que podamos utilizar todos los recursos que tenemos tanto como sea posible: ejecutar en la red o correr en un disco en casos raros. <br><br><img src="https://habrastorage.org/webt/pd/v2/mn/pdv2mnfn4_ne1jbp00nhl35n7y4.jpeg"><br>  Todo esto est√° establecido por variables de entorno. <br><br><img src="https://habrastorage.org/webt/oe/ro/k5/oerok5u-varh4b3rcwq4dgwarmm.jpeg"><br>  Tambi√©n hay concurrencia de hacer una copia.  Si bien esta caracter√≠stica no est√° presente en varias versiones, A. B. se lanz√≥ en la versi√≥n 0.1.10 en junio de 2018, ya que el paralelismo de la lectura desde el disco le permite garantizar que se ejecute en una red o en un disco.  Esto no es muy bueno con una base de datos cargada.  WAL-E ten√≠a una caracter√≠stica que permit√≠a el estrangulamiento.  Hasta ahora, no tenemos esto.  Es necesario limitar la velocidad de eliminaci√≥n de copias de seguridad para que la base pueda vivir su propia vida y servir la carga. <br><br>  Nuestra caracter√≠stica principal no es realmente sobre tecnolog√≠a. <br><br>  Hace dos a√±os, Zhenya Dyukov implement√≥ la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">tecnolog√≠a delta-backup</a> para Barman, a√∫n no se ha llevado a cabo, la comunidad todav√≠a lo est√° discutiendo. <br><br>  Hace casi un a√±o, Zhenya corrigi√≥ el error WAL-E, y lo enviamos durante seis meses ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace a GitHub</a> - aprox. Ed.).  Muy a menudo en las soluciones de c√≥digo abierto hay un problema con el hecho de que no est√°n muy bien mantenidas. <br><br><img src="https://habrastorage.org/webt/jy/hg/mf/jyhgmfxdz_srayrm8vsxdnq-a3q.jpeg"><br>  Con WAL-G, todo es bastante simple: lo usamos y lo mantengo.  Si nosotros o usted necesitamos algo, simplemente informe que tiene un problema.  Intentaremos resolverlo. <br><br>  La solicitud est√°ndar de la comunidad es simple: "hag√°moslo m√°s". <br><br>  M√°s criptograf√≠a, m√°s plataformas.  ¬øTal vez no solo PostgreSQL, sino MySQL todav√≠a copia de seguridad o algo m√°s?  Veo algunas otras cosas. <br><br><img src="https://habrastorage.org/webt/yi/sg/ck/yisgckbaa1bhbae-ixrx_u-fetm.jpeg"><br>  En primer lugar, ahora al enviar el "eje" podr√≠amos entender qu√© bloques de la base de datos han cambiado, escanear estos archivos WAL y guardar informaci√≥n sobre lo que ha cambiado. <br><br>  Y cuando cron llega con otra copia de seguridad delta, no pudimos escanear toda la base de datos, archivar ese diente de lectura de disco y simplemente saber qu√© p√°ginas necesitamos arrastrar a la nube. <br><br>  Intentamos usar la tecnolog√≠a de seguimiento de p√°gina.  Implementa el seguimiento de los cambios de p√°gina en el nivel del n√∫cleo de la base de datos.  La copia de seguridad se elimina muy r√°pidamente.  El principal problema con PTRACK es que es muy invasivo.  Contiene muchos cambios en el n√∫cleo de PostgreSQL en lugares muy sensibles, por lo que es poco probable que se adopte pronto. <br><br><img src="https://habrastorage.org/webt/4z/ea/px/4zeapxt_ji4odqmc57wnjpxilik.jpeg"><br>  Adem√°s, sus deltas son ligeramente diferentes de los que tenemos ahora.  Al eliminar el delta basado en LSN, eliminamos todos los cambios en el archivo delta que ocurrieron desde el inicio anterior hasta la hora actual. <br><br><img src="https://habrastorage.org/webt/ul/oh/pi/ulohpi0sz8mtyz5g018fxactms8.jpeg"><br>  En el caso de PTRACK, obtenemos cambios en el archivo delta, comenzando desde el delta anterior recibido.  No tenemos el tiempo exacto delta antes del inicio de la copia de seguridad, antes del inicio de los cambios.  Este no es el principal problema de PTRACK, en general funciona bien, pero hasta ahora es dif√≠cil de aceptar. <br><br><img src="https://habrastorage.org/webt/9-/qv/ou/9-qvouutaphuo35-ag0q_w1nnww.jpeg"><br>  PTRACK no permite la eliminaci√≥n delta en modo LATEST_FULL, porque almacena un mapa de bloques modificados de la eliminaci√≥n anterior de este mapa.  Oracle tiene una tecnolog√≠a interesante, hay 8 tarjetas anteriores que guardan por si acaso.  Tal vez podr√≠amos hacer algo similar, pero hasta ahora no estamos trabajando en esta direcci√≥n. <br><br><img src="https://habrastorage.org/webt/bx/do/z-/bxdoz-i2yzsnya6y6kzqbc30e3y.jpeg"><br><h5>  <sub><sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Enlace desde la diapositiva</a></sup></sub> </h5><br>  En septiembre pasado, intent√© ofrecer a la comunidad una tecnolog√≠a basada en el hecho de que solo agregamos los ganchos que necesitamos al n√∫cleo, e implementamos el seguimiento de las p√°ginas modificadas en extensi√≥n para que el parche de seguimiento de la p√°gina no sea demasiado invasivo.  Despu√©s de discutir esta tecnolog√≠a, llegamos a la conclusi√≥n de que necesitamos varios prototipos, y agregaremos ganchos cuando haya prototipos.  Quiz√°s veamos c√≥mo funcionan.  Actualmente estoy trabajando en prototipos de estas extensiones que podr√≠an usar ganchos de kernel para rastrear cambios en la base de datos. <br><br>  Existe una expresi√≥n en la comunidad de que cada postgresista debe tener su propia herramienta de respaldo.  Esto es malo  Cada uno hace lo suyo, lo que hace una tarea de misi√≥n cr√≠tica.  Debe haber una cosa en la que todo estar√° en la caja, todo ser√° perfecto en un mundo ideal. <br><br>  ¬øQu√© me gustar√≠a ver en una caja en basebackup?  Nos gustar√≠a ver, probablemente, archivar en la nube.  Y copias delta. <br><br><img src="https://habrastorage.org/webt/6w/ea/zh/6weazhzi3fkxbhvzz2tlrdj4ujg.jpeg"><br>  Tambi√©n me gustar√≠a compresi√≥n, concurrencia, encriptaci√≥n, aceleraci√≥n, listado de copias de seguridad, verificaci√≥n, validaci√≥n de copias de seguridad ... Muchas cosas.  Entendemos que si todo esto se ofrece ahora a la comunidad, dar√° como resultado varias docenas de parches, que son bastante dif√≠ciles de discutir e implementar a trav√©s de commitfest.  Por lo tanto, ahora todav√≠a estamos usando una herramienta separada, pero existe el deseo de dedicar tiempo y tecnolog√≠a a la comunidad para mejorar PostgreSQL. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es415817/">https://habr.com/ru/post/es415817/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es415805/index.html">Modificaci√≥n del m√≥dulo de barrera GSM Doorhan para control de Internet</a></li>
<li><a href="../es415809/index.html">C√≥mo usar soja, requirejs, backbone js en complementos para Atlassian Jira</a></li>
<li><a href="../es415811/index.html">AI, curso pr√°ctico. Descripci√≥n general de las redes neuronales para la clasificaci√≥n de im√°genes</a></li>
<li><a href="../es415813/index.html">Algunas notas sobre el estado actual de Cloud Gaming</a></li>
<li><a href="../es415815/index.html">A la vanguardia de la ciencia: un an√°lisis de los art√≠culos de arxiv.org</a></li>
<li><a href="../es415819/index.html">Informe del Club de Roma 2018, Cap√≠tulo 3.16: Gobierno global</a></li>
<li><a href="../es415821/index.html">La forma de organizar una casa "inteligente" con el control el√©ctrico m√°s amplio posible</a></li>
<li><a href="../es415823/index.html">FindFace cierra por simples mortales</a></li>
<li><a href="../es415829/index.html">Introducci√≥n a las clases de datos</a></li>
<li><a href="../es415831/index.html">Los nuevos diez mandamientos de Roskosmos</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>