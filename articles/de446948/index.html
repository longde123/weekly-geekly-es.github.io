<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üì° ü•ó ‚ÜòÔ∏è Wie der Android Gustuff-Trojaner Sahne (Fiat und Krypto) von Ihren Konten entfernt üî´ üê¥ üßöüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Erst neulich berichtete Group-IB √ºber die Aktivit√§ten des Android-Handys Trojan Gustuff. Es funktioniert ausschlie√ülich auf internationalen M√§rkten un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Wie der Android Gustuff-Trojaner Sahne (Fiat und Krypto) von Ihren Konten entfernt</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/group-ib/blog/446948/"><img src="https://habrastorage.org/webt/b9/hn/wr/b9hnwrlclblkmurq29bkezeanui.png"><br><br>  Erst neulich <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">berichtete</a> Group-IB <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">√ºber</a> die Aktivit√§ten des Android-Handys Trojan Gustuff.  Es funktioniert ausschlie√ülich auf internationalen M√§rkten und greift Kunden der 100 gr√∂√üten ausl√§ndischen Banken, Benutzer von 32 mobilen Krypto-Geldb√∂rsen sowie gro√üe E-Commerce-Ressourcen an.  Aber der Entwickler von Gustuff ist ein russischsprachiger Cyberkrimineller unter dem Spitznamen Bestoffer.  Bis vor kurzem lobte er seinen Trojaner als "ein ernstes Produkt f√ºr Menschen mit Wissen und Erfahrung". <br><br>  <b>Ivan Pisarev, ein</b> Spezialist f√ºr die Analyse von Group-IB-Schadcode, berichtet in seiner Forschung ausf√ºhrlich dar√ºber, wie Gustuff funktioniert und welche Gefahr es birgt. <a name="habracut"></a><br><br><h2>  F√ºr wen jagt Gustuff? </h2><br>  Gustuff ist eine neue Generation von Malware mit vollautomatischen Funktionen.  Laut dem Entwickler ist der Trojaner eine neue, verbesserte Version der AndyBot-Malware, die seit November 2017 Android-Telefone angreift und Geld durch Phishing-Webformulare stiehlt, die sich als mobile Anwendungen bekannter internationaler Banken und Zahlungssysteme tarnen.  Bestoffer berichtete, dass der Mietpreis f√ºr Gustuff Bot 800 USD pro Monat betrug. <br><br>  Die Analyse der Gustuff-Stichprobe ergab, dass der Trojaner potenziell auf Kunden ausgerichtet ist, die mobile Anwendungen der gr√∂√üten Banken wie der Bank of America, der Bank of Scotland, JP Morgan, Wells Fargo, Capital One, der TD Bank, der PNC Bank sowie der Bitcoin Wallet- und BitPay-Krypto-Geldb√∂rsen verwenden , Cryptopay, Coinbase usw. <br><br>  Urspr√ºnglich als klassischer Bankentrojaner entwickelt, hat die aktuelle Version von Gustuff die Liste der potenziellen Angriffsziele erheblich erweitert.  Neben Android-Anwendungen von Banken, Fintech-Unternehmen und Kryptodiensten richtet sich Gustuff an Benutzer von Marktplatzanwendungen, Online-Shops, Zahlungssystemen und Instant Messenger.  Insbesondere PayPal, Western Union, eBay, Walmart, Skype, WhatsApp, Gett Taxi, Revolut und andere. <br><br><h2>  Einstiegspunkt: Berechnung f√ºr Masseninfektion </h2><br>  Gustuff zeichnet sich durch den "klassischen" Vektor des Eindringens in Android-Smartphones durch SMS-Mailing mit Links zu APKs aus.  Wenn das Android-Ger√§t auf Befehl des Servers mit einem Trojaner infiziert ist, kann sich Gustuff √ºber die Kontaktdatenbank des infizierten Telefons oder √ºber die Serverdatenbank weiter verbreiten.  Die Funktionalit√§t von Gustuff ist auf Masseninfektion und maximale Kapitalisierung des Gesch√§fts seiner Betreiber ausgelegt. Es hat die einzigartige Funktion, legitime Mobile-Banking-Anwendungen und Crypto-Wallets automatisch auszuf√ºllen, wodurch Sie den Diebstahl von Geld beschleunigen und skalieren k√∂nnen. <br><br>  Die Studie des Trojaners zeigte, dass die Auto-Fill-Funktion mithilfe des Accessibility Service - eines Dienstes f√ºr Menschen mit Behinderungen - implementiert wurde.  Gustuff ist nicht der erste Trojaner, der den Schutz vor Interaktion mit Fensterelementen anderer Anwendungen mithilfe dieses Android-Dienstes erfolgreich umgeht.  Die Verwendung des Eingabehilfedienstes in Verbindung mit dem automatischen Laden ist jedoch immer noch recht selten. <br><br>  Nach dem Herunterladen des Opfers auf das Telefon erh√§lt Gustuff √ºber den Accessibility Service die M√∂glichkeit, mit Fensterelementen anderer Anwendungen (Banking, Kryptow√§hrung sowie Anwendungen f√ºr Online-Shopping, Messaging usw.) zu interagieren und die erforderlichen Aktionen f√ºr die Angreifer auszuf√ºhren.  Auf Befehl des Servers kann der Trojaner beispielsweise auf Schaltfl√§chen klicken und die Werte von Textfeldern in Bankanwendungen √§ndern.  Durch die Verwendung des Accessibility Service-Mechanismus kann der Trojaner die Schutzmechanismen umgehen, mit denen Banken mobilen Trojanern der vorherigen Generation entgegenwirken, sowie √Ñnderungen der Sicherheitsrichtlinien, die Google in neuen Versionen des Android-Betriebssystems eingef√ºhrt hat.  Gustuff "wei√ü also", wie man den Google Protect-Schutz deaktiviert: Laut Autor funktioniert diese Funktion in 70% der F√§lle. <br><br><img src="https://habrastorage.org/webt/ih/x4/1k/ihx41k2p4hqubcaaisklwvdyoy8.png"><br><br>  Gustuff kann auch gef√§lschte PUSH-Benachrichtigungen mit Symbolen legitimer mobiler Anwendungen anzeigen.  Der Benutzer klickt auf die PUSH-Benachrichtigung und sieht ein vom Server heruntergeladenes Phishing-Fenster, in das er selbst die angeforderten Daten einer Bankkarte oder einer Krypto-Brieftasche eingibt.  In einem anderen Gustuff-Szenario wird eine Anwendung ge√∂ffnet, f√ºr die eine PUSH-Benachrichtigung angezeigt wurde.  In diesem Fall kann das Schadprogramm auf Befehl des Servers √ºber den Accessibility Service die Formularfelder der Bankanwendung f√ºr eine betr√ºgerische Transaktion ausf√ºllen. <br><br>  Zu den Funktionen von Gustuff geh√∂ren auch das Senden von Informationen √ºber ein infiziertes Ger√§t an den Server, das Lesen / Senden von SMS-Nachrichten, das Senden von USSD-Anforderungen, das Starten von SOCKS5 Proxy, das Folgen des Links sowie das Senden von Dateien (einschlie√ülich Fotoscans von Dokumenten, Screenshots, Fotos) an den Server Setzen Sie das Ger√§t auf die Werkseinstellungen zur√ºck. <br><br><h2>  Malware-Analyse </h2><br>  Vor der Installation einer sch√§dlichen Anwendung zeigt das Android-Betriebssystem dem Benutzer ein Fenster mit einer Liste der von Gustuff angeforderten Rechte an: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ku/th/ac/kuthacuzh0webqtrwhgktysougi.png" alt="Bild alt"></div><br>  Die Installation der Anwendung erfolgt erst nach Zustimmung des Benutzers.  Nach dem Start der Anwendung zeigt der Trojaner dem Benutzer ein Fenster: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hj/uq/xa/hjuqxaw2ezubek_xmd3clywhpsw.png" alt="Bild alt"></div><br>  Dann wird das Symbol gel√∂scht. <br><br>  Gustuff wird laut Autor von einem FTT-Packer verpackt.  Nach dem Start greift die Anwendung regelm√§√üig auf den CnC-Server zu, um Befehle zu empfangen.  In mehreren untersuchten Dateien wurde die IP-Adresse <b>88.99.171 [.] 105</b> als Steuerungsserver verwendet (im Folgenden wird sie als <b>&lt;% CnC%&gt; bezeichnet</b> ). <br><br>  Nach dem Start sendet das Programm Nachrichten an den Server <b>http: // &lt;% CnC%&gt; /api/v1/get.php</b> . <br><br>  Als Antwort wird JSON im folgenden Format erwartet: <br><br><pre><code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;%id%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%command%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:<span class="hljs-string"><span class="hljs-string">"&lt;%Server Timestamp%&gt;"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ &lt;%Command parameters as JSON%&gt; }, }, }</code> </pre> <br>  Jedes Mal, wenn die Anwendung Informationen √ºber ein infiziertes Ger√§t sendet.  Das Format der Nachricht ist unten dargestellt.  Es ist zu beachten, dass die <b>vollst√§ndigen</b> , <b>zus√§tzlichen</b> , <b>Apps-</b> und <b>Berechtigungsfelder</b> optional sind und nur im Falle eines Anforderungsbefehls von CnC gesendet werden. <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"info"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"cell"</span></span>:&lt;%Sim operator name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%Country ISO%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%IMEI%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1Number"</span></span>:&lt;%Phone number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"advertisementId"</span></span>:&lt;%ID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"admin"</span></span>:&lt;%Has admin rights%&gt;, <span class="hljs-attr"><span class="hljs-attr">"source"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"needPermissions"</span></span>:&lt;%Application needs permissions%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByName"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accesByService"</span></span>:&lt;%Boolean%&gt;, <span class="hljs-attr"><span class="hljs-attr">"safetyNet"</span></span>:&lt;%String%&gt;, <span class="hljs-attr"><span class="hljs-attr">"defaultSmsApp"</span></span>:&lt;%Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"isDefaultSmsApp"</span></span>:&lt;%Current application is Default Sms Application%&gt;, <span class="hljs-attr"><span class="hljs-attr">"dateTime"</span></span>:&lt;%Current date time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"batteryLevel"</span></span>:&lt;%Battery level%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"socks"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Proxy module ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"enabled"</span></span>:&lt;%Is enabled%&gt;, <span class="hljs-attr"><span class="hljs-attr">"active"</span></span>:&lt;%Is active%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"versionName"</span></span>:&lt;%Package Version Name%&gt;, <span class="hljs-attr"><span class="hljs-attr">"versionCode"</span></span>:&lt;%Package Version Code%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lastUpdateTime"</span></span>:&lt;%Package Last Update Time%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>:&lt;%Tag, default value: <span class="hljs-string"><span class="hljs-string">"TAG"</span></span>%&gt;, <span class="hljs-attr"><span class="hljs-attr">"targetSdkVersion"</span></span>:&lt;%Target Sdk Version%&gt;, <span class="hljs-attr"><span class="hljs-attr">"buildConfigTimestamp"</span></span>:<span class="hljs-number"><span class="hljs-number">1541309066721</span></span> }, }, <span class="hljs-attr"><span class="hljs-attr">"full"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Device Model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeCountry"</span></span>:&lt;%Country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"localeLang"</span></span>:&lt;%Locale language%&gt;, <span class="hljs-attr"><span class="hljs-attr">"accounts"</span></span>:&lt;%JSON array, contains from <span class="hljs-attr"><span class="hljs-attr">"name"</span></span> and <span class="hljs-attr"><span class="hljs-attr">"type"</span></span> of accounts%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lockType"</span></span>:&lt;%Type of lockscreen password%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"extra"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"serial"</span></span>:&lt;%Build serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"board"</span></span>:&lt;%Build Board%&gt;, <span class="hljs-attr"><span class="hljs-attr">"brand"</span></span>:&lt;%Build Brand%&gt;, <span class="hljs-attr"><span class="hljs-attr">"user"</span></span>:&lt;%Build User%&gt;, <span class="hljs-attr"><span class="hljs-attr">"device"</span></span>:&lt;%Build Device%&gt;, <span class="hljs-attr"><span class="hljs-attr">"display"</span></span>:&lt;%Build Display%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%Build ID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%Build manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%Build model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"product"</span></span>:&lt;%Build product%&gt;, <span class="hljs-attr"><span class="hljs-attr">"tags"</span></span>:&lt;%Build tags%&gt;, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>:&lt;%Build type%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"line1number"</span></span>:&lt;%phonenumber%&gt;, <span class="hljs-attr"><span class="hljs-attr">"iccid"</span></span>:&lt;%Sim serial number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mcc"</span></span>:&lt;%Mobile country code of operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"mnc"</span></span>:&lt;%Mobile network codeof operator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"cellid"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"lac"</span></span>:&lt;%GSM-data%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidid"</span></span>:&lt;%Android Id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"ssid"</span></span>:&lt;%Wi-Fi SSID%&gt; }, <span class="hljs-attr"><span class="hljs-attr">"apps"</span></span>:{&lt;%List of installed applications%&gt;}, <span class="hljs-attr"><span class="hljs-attr">"permission"</span></span>:&lt;%List of granted permissions%&gt; }</code> </pre> <br><h3>  Konfigurationsdatenspeicher </h3><br>  Gustuff speichert wichtige Arbeitsinformationen in einer Einstellungsdatei.  Der Dateiname sowie die darin enthaltenen Parameternamen sind das Ergebnis der Berechnung der MD5-Summe aus der Zeile <b>15413090667214.6.1 &lt;% name%&gt;</b> , wobei <b>&lt;% name%&gt;</b> der urspr√ºngliche Namenswert ist.  Python-Interpretation der Namensgenerierungsfunktion: <br><br><pre> <code class="json hljs"> nameGenerator(input): output = md<span class="hljs-number"><span class="hljs-number">5</span></span>(<span class="hljs-string"><span class="hljs-string">"15413090667214.6.1"</span></span> + input)</code> </pre> <br>  Im Folgenden werden wir es als <b>nameGenerator (Eingabe) bezeichnen</b> . <br><br>  Daher lautet der Name der ersten Datei: <b>nameGenerator ("API_SERVER_LIST")</b> und enth√§lt Werte mit den folgenden Namen: <br><br><table><tbody><tr><th width="400">  <b>Variablenname</b> </th><th>  <b>Wert</b> </th></tr><tr><td>  <b>nameGenerator ("API_SERVER_LIST")</b> </td><td>  Enth√§lt eine Liste von CnC-Adressen als Array. </td></tr><tr><td>  <b>nameGenerator ("API_SERVER_URL")</b> </td><td>  Enth√§lt eine CnC-Adresse. </td></tr><tr><td>  <b>nameGenerator ("SMS_UPLOAD")</b> </td><td>  Das Flag ist standardm√§√üig gesetzt.  Wenn das Flag gesetzt ist - sendet SMS-Nachrichten an CnC. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER")</b> </td><td>  Die Telefonnummer, an die vom infizierten Ger√§t empfangene SMS-Nachrichten gesendet werden.  Der Standardwert ist null. </td></tr><tr><td>  <b>nameGenerator ("SMS_ROOT_NUMBER_RESEND")</b> </td><td>  Das Flag ist standardm√§√üig gel√∂scht.  Wenn ein infiziertes Ger√§t installiert ist und eine SMS empf√§ngt, wird diese an die Stammnummer gesendet. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_APP_SMS")</b> </td><td>  Das Flag ist standardm√§√üig gel√∂scht.  Wenn dieses Flag gesetzt ist, verarbeitet die Anwendung eingehende SMS-Nachrichten. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ADMIN")</b> </td><td>  Das Flag ist standardm√§√üig gel√∂scht.  Wenn das Flag gesetzt ist, verf√ºgt die Anwendung √ºber Administratorrechte. </td></tr><tr><td>  <b>nameGenerator ("DEFAULT_ACCESSIBILITY")</b> </td><td>  Das Flag ist standardm√§√üig gel√∂scht.  Wenn das Flag gesetzt ist, wird ein Dienst gestartet, der den Eingabehilfedienst verwendet. </td></tr><tr><td>  <b>nameGenerator ("APPS_CONFIG")</b> </td><td>  Das JSON-Objekt enth√§lt eine Liste von Aktionen, die ausgef√ºhrt werden m√ºssen, wenn das einer bestimmten Anwendung zugeordnete Accessibility-Ereignis ausgel√∂st wird. </td></tr><tr><td>  <b>nameGenerator ("APPS_INSTALLED")</b> </td><td>  Speichert eine Liste der auf dem Ger√§t installierten Anwendungen. </td></tr><tr><td>  <b>nameGenerator ("IS_FIST_RUN")</b> </td><td>  Das Flag wird beim ersten Start zur√ºckgesetzt. </td></tr><tr><td>  <b>nameGenerator ("UNIQUE_ID")</b> </td><td>  Enth√§lt eine eindeutige Kennung.  Es wird beim ersten Start des Bots generiert. </td></tr></tbody></table><br><h3>  Serverbefehlsverarbeitungsmodul </h3><br>  Die Anwendung speichert die Adressen von CnC-Servern als Array von <b>Base85-</b> codierten Zeichenfolgen.  Die Liste der CnC-Server kann nach Erhalt des entsprechenden Befehls ge√§ndert werden. In diesem Fall werden die Adressen in einer Einstellungsdatei gespeichert. <br><br>  Als Antwort auf die Anforderung sendet der Server einen Befehl an die Anwendung.  Es ist erw√§hnenswert, dass die Befehle und Parameter im JSON-Format dargestellt werden.  Eine Anwendung kann die folgenden Befehle verarbeiten: <br><table><tbody><tr><th width="150">  <b>Das Team</b> </th><th>  <b>Beschreibung</b> </th></tr><tr><td>  <b>forwardStart</b> </td><td>  Beginnen Sie mit dem Senden von SMS-Nachrichten, die vom infizierten Ger√§t empfangen wurden, an den CnC-Server. </td></tr><tr><td>  <b>forwardStop</b> </td><td>  Senden Sie keine vom infizierten Ger√§t empfangenen SMS-Nachrichten mehr an den CnC-Server. </td></tr><tr><td>  <b>ussdRun</b> </td><td>  F√ºhren Sie die USSD-Anforderung aus.  Die Nummer, an die Sie eine USSD-Anfrage stellen m√∂chten, befindet sich im JSON-Feld "Nummer". </td></tr><tr><td>  <b>sendSms</b> </td><td>  Senden Sie eine SMS-Nachricht (falls erforderlich, wird die Nachricht in Teile "aufgeteilt").  Als Parameter verwendet der Befehl ein JSON-Objekt, das die Felder "to" - die Zielnummer und "body" - den Nachrichtentext enth√§lt. </td></tr><tr><td>  <b>sendSmsAb</b> </td><td>  Senden Sie SMS-Nachrichten (falls erforderlich, die Nachricht wird in Teile aufgeteilt) an alle Personen aus der Kontaktliste des infizierten Ger√§ts.  Das Intervall zwischen dem Senden von Nachrichten betr√§gt 10 Sekunden.  Der Nachrichtentext befindet sich im JSON-Feld "body". </td></tr><tr><td>  <b>sendSmsMass</b> </td><td>  Senden Sie SMS-Nachrichten (falls erforderlich, die Nachricht wird in Teile aufgeteilt) an die in den Befehlsparametern angegebenen Kontakte.  Das Intervall zwischen dem Senden von Nachrichten betr√§gt 10 Sekunden.  Als Parameter akzeptiert der Befehl ein JSON-Array (Feld "sms"), dessen Elemente die Felder "to" - die Zielnummer und "body" - den Textk√∂rper der Nachricht enthalten. </td></tr><tr><td>  <b>changeServer</b> </td><td>  Dieser Befehl als Parameter kann einen Wert mit dem Schl√ºssel "url" annehmen - dann √§ndert der Bot den Wert von nameGenerator ("SERVER_URL") oder "array" - dann schreibt der Bot das Array in nameGenerator ("API_SERVER_LIST"). Daher √§ndert die Anwendung die Adresse von CnC-Servern. </td></tr><tr><td>  <b>adminNumber</b> </td><td>  Der Befehl arbeitet mit der Stammnummer.  Der Befehl akzeptiert ein JSON-Objekt mit den folgenden Parametern: "number" - NameGenerator ("ROOT_NUMBER") in den empfangenen Wert √§ndern, "resend" - nameGenerator ("SMS_ROOT_NUMBER_RESEND"), "sendId" - an nameGenerator ("ROOT_NUMBER") senden. </td></tr><tr><td>  <b>updateInfo</b> </td><td>  Senden Sie Informationen zu einem infizierten Ger√§t an den Server. </td></tr><tr><td>  <b>wipeData</b> </td><td>  Der Befehl dient zum L√∂schen von Benutzerdaten.  Je nachdem, unter welchem ‚Äã‚ÄãNamen die Anwendung gestartet wurde, werden entweder die Daten beim Neustart des Ger√§ts vollst√§ndig gel√∂scht (prim√§rer Benutzer) oder nur Benutzerdaten werden gel√∂scht (sekund√§rer Benutzer). </td></tr><tr><td>  <b>socksStart</b> </td><td>  Starten Sie das Proxy-Modul.  Die Funktionsweise des Moduls wird in einem separaten Abschnitt beschrieben. </td></tr><tr><td>  <b>socksStop</b> </td><td>  Stoppen Sie das Proxy-Modul. </td></tr><tr><td>  <b>openLink</b> </td><td>  Folgen Sie dem Link.  Der Link befindet sich im JSON-Parameter √ºber den Schl√ºssel "url".  Verwenden Sie "android.intent.action.VIEW", um den Link zu √∂ffnen. </td></tr><tr><td>  <b>uploadAllSms</b> </td><td>  Senden Sie alle vom Ger√§t empfangenen SMS-Nachrichten an den Server. </td></tr><tr><td>  <b>uploadAllPhotos</b> </td><td>  Senden Sie Bilder von einem infizierten Ger√§t an die URL.  Die URL kommt als Parameter. </td></tr><tr><td>  <b>uploadFile</b> </td><td>  Senden Sie die Datei vom infizierten Ger√§t an die URL.  Die URL kommt als Parameter. </td></tr><tr><td>  <b>uploadPhoneNumbers</b> </td><td>  Senden Sie Telefonnummern aus der Kontaktliste an den Server.  Wenn ein JSON-Objekt mit dem Schl√ºssel ‚Äûab‚Äú als Parameter angegeben wird, erh√§lt die Anwendung die Liste der Kontakte aus dem Telefonbuch.  Wenn ein JSON-Objekt mit dem Schl√ºssel "sms" als Parameter kommt, liest die Anwendung die Kontaktliste von den Absendern von SMS-Nachrichten. </td></tr><tr><td>  <b>changeArchive</b> </td><td>  Die Anwendung l√§dt die Datei von der Adresse herunter, die als Parameter mit dem Schl√ºssel "url" geliefert wird.  Die heruntergeladene Datei wird unter dem Namen "archive.zip" gespeichert.  Danach entpackt die Anwendung die Datei bei Bedarf mit dem Kennwort f√ºr das Archiv ‚Äûb5jXh37gxgHBrZhQ4j3D‚Äú.  Entpackte Dateien werden im Verzeichnis [externer Speicher] / hgps gespeichert.  In diesem Verzeichnis speichert die Anwendung Web-F√§lschungen (sp√§ter beschrieben). </td></tr><tr><td>  <b>Aktionen</b> </td><td>  Der Befehl funktioniert mit dem Aktionsdienst, der in einem separaten Abschnitt beschrieben wird. </td></tr><tr><td>  <b>Test</b> </td><td>  Es macht nichts. </td></tr><tr><td>  <b>herunterladen</b> </td><td>  Der Befehl dient zum Herunterladen einer Datei von einem Remote-Server und zum Speichern im Download-Verzeichnis.  Die URL und der Dateiname werden als Parameter angegeben, die Felder im JSON-Objektparameter: "url" und "fileName". </td></tr><tr><td>  <b>entfernen</b> </td><td>  L√∂scht eine Datei aus dem Download-Verzeichnis.  Der Dateiname kommt im JSON-Parameter mit dem Schl√ºssel "Dateiname".  Der Standarddateiname lautet "tmp.apk". </td></tr><tr><td>  <b>Benachrichtigung</b> </td><td>  Zeigen Sie eine Benachrichtigung mit vom Verwaltungsserver definierten Beschreibungs- und Titeltexten an. </td></tr></tbody></table><br>  Das Format des <b>Benachrichtigungsbefehls</b> lautet: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"results"</span></span> : <span class="hljs-string"><span class="hljs-string">"OK"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: &lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:<span class="hljs-string"><span class="hljs-string">"notification"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timestamp"</span></span>:&lt;%Server Timestamp%&gt;, <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"openApp"</span></span>:&lt;%Open original app or not%&gt;, <span class="hljs-attr"><span class="hljs-attr">"array"</span></span>:[ {<span class="hljs-attr"><span class="hljs-attr">"title"</span></span>:&lt;%Title text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"desc"</span></span>:&lt;%Description text%&gt;, <span class="hljs-attr"><span class="hljs-attr">"app"</span></span>:&lt;%Application name%&gt;} ] }, }, }</code> </pre> <br>  Die von der untersuchten Datei generierte Benachrichtigung sieht identisch aus mit den Benachrichtigungen, die von der im Feld " <b>App"</b> angegebenen Anwendung erstellt wurden.  Wenn der Wert des <b>openApp-</b> Felds True ist, wird beim √ñffnen der Benachrichtigung die im <b>App-</b> Feld angegebene Anwendung <b>gestartet</b> .  Wenn der Wert des <b>openApp-</b> Felds False ist, gilt <b>Folgendes</b> : <br><br><ul><li>  Es √∂ffnet sich ein Phishing-Fenster, dessen Inhalt aus dem Verzeichnis <b>&lt;% external storage%&gt; / hgps / &lt;% filename%&gt; heruntergeladen wird</b> </li><li>  Es √∂ffnet sich ein Phishing-Fenster, dessen Inhalt vom Server heruntergeladen wird. <b>&lt;% url%&gt;? id = &lt;% Bot id%&gt; &amp; app = &lt;% Anwendungsname%&gt;</b> </li><li>  Ein als Google Play Card getarntes Phishing-Fenster mit der M√∂glichkeit, Karteninformationen einzugeben, wird ge√∂ffnet. </li></ul><br>  Die Anwendung sendet das Ergebnis der Ausf√ºhrung eines <b>Befehls</b> als JSON-Objekt im folgenden Format an <b>&lt;% CnC%&gt; \ set_state.php</b> : <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"command"</span></span>:&lt;%command%&gt;, <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%command_id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"state"</span></span>:&lt;%command_state%&gt; } <span class="hljs-string"><span class="hljs-string">"id"</span></span>:&lt;%bot_id%&gt; }</code> </pre> <br>  <b>ActionsService</b> <br><br>  Die Liste der Befehle, die die Anwendung verarbeitet, enth√§lt <b>Aktionen</b> .  Nach Erhalt eines Befehls greift das Befehlsverarbeitungsmodul auf diesen Dienst zu, um einen erweiterten Befehl auszuf√ºhren.  Der Dienst akzeptiert ein JSON-Objekt als Parameter.  Ein Dienst kann die folgenden Befehle ausf√ºhren: <br><br>  <b>1.</b> <b>PARAMS_ACTION</b> - Nach Erhalt eines solchen Befehls empf√§ngt der Dienst zun√§chst vom JSON-Parameter den Wert √ºber den Typschl√ºssel. <b>Dies</b> kann wie folgt sein: <br><br><ul><li>  <b>serviceInfo</b> - Der Unterbefehl empf√§ngt vom JSON-Parameter den Wert des Schl√ºssels <b>includeNotImportant</b> .  Wenn das Flag True ist, setzt die Anwendung das <b>FLAG_ISOLATED_PROCESS-</b> Flag auf einen Dienst, der den Accessibility Service verwendet.  Daher wird der Dienst in einem separaten Prozess gestartet. </li><li>  <b>root</b> - Informationen √ºber das Fenster abrufen und an den Server senden, das jetzt im Fokus steht.  Eine Anwendung ruft Informationen mithilfe der AccessibilityNodeInfo-Klasse ab. </li><li>  <b>admin</b> - <b>Administratorrechte</b> anfordern. </li><li>  <b>delay</b> - Unterbricht den ActionsService f√ºr die Anzahl der Millisekunden, die im Parameter mit dem Schl√ºssel "data" angegeben sind. </li><li>  <b>Windows</b> - Senden Sie eine Liste der f√ºr den Benutzer sichtbaren Fenster. </li><li>  <b>install</b> - Installiert die Anwendung auf einem infizierten Ger√§t.  Der Name des Paketarchivs befindet sich im Schl√ºssel "Dateiname".  Das Archiv selbst befindet sich im Download-Verzeichnis. </li><li>  <b>global</b> - Der Unterbefehl dient zum √úbergang vom aktuellen Fenster: <br><ul><li>  im Men√º Schnelleinstellungen </li><li>  zur√ºck </li><li>  nach Hause </li><li>  zu Benachrichtigungen </li><li>  zum Fenster der k√ºrzlich ge√∂ffneten Anwendungen </li></ul><br></li><li>  <b>Starten</b> - Starten Sie die Anwendung.  Der Name der Anwendung wird vom <b>Datenschl√ºssel</b> als Parameter angegeben. </li><li>  <b>Sounds</b> - √Ñndern Sie den Soundmodus in Stille. </li><li>  <b>entsperren</b> - schaltet die Hintergrundbeleuchtung des Bildschirms und der Tastatur bei voller Helligkeit ein.  Die Anwendung f√ºhrt diese Aktion mit WakeLock aus, der Zeichenfolge [Application lable]: INFO </li><li>  <b>Berechtigungs√ºberlagerung</b> - Die Funktion ist nicht implementiert (die Antwort auf die Befehlsausf√ºhrung lautet {"message": "Not support"} oder {"message": "low sdk"}). </li><li>  <b>Geste</b> - Die Funktion ist nicht implementiert (die Antwort auf die Ausf√ºhrung des Befehls lautet {"message": "Not support"} oder {"message": "Low API"}). </li><li>  <b>Berechtigungen</b> - Dieser Befehl ist erforderlich, um Berechtigungen f√ºr die Anwendung anzufordern.  Die Abfragefunktion ist jedoch nicht implementiert, sodass der Befehl keinen Sinn ergibt.  Die Liste der angeforderten Rechte wird als JSON-Array mit dem Schl√ºssel "Berechtigungen" geliefert.  Standardliste: <br><br><ul><li>  android.permission.READ_PHONE_STATE </li><li>  android.permission.READ_CONTACTS </li><li>  android.permission.CALL_PHONE </li><li>  android.permission.RECEIVE_SMS </li><li>  android.permission.SEND_SMS </li><li>  android.permission.READ_SMS </li><li>  android.permission.READ_EXTERNAL_STORAGE </li><li>  android.permission.WRITE_EXTERNAL_STORAGE </li></ul><br></li><li>  <b>√ñffnen</b> - Zeigt ein Phishing-Fenster an.  Abh√§ngig vom vom Server kommenden Parameter zeigt die Anwendung m√∂glicherweise die folgenden Phishing-Fenster an: <br><br><ul><li>  Zeigen Sie ein Phishing-Fenster an, dessen Inhalt in die Datei im Verzeichnis <b>&lt;% externes Verzeichnis%&gt; / hgps / &lt;% param_filename%&gt; geschrieben ist</b> .  Das Ergebnis der Benutzerinteraktion mit dem Fenster wird an <b>&lt;% CnC%&gt; / records.php</b> gesendet </li><li>  Zeigen Sie ein Phishing-Fenster an, dessen Inhalt von der Adresse <b>&lt;% url_param%&gt;</b> vorinstalliert ist <b>. Id = &lt;% bot_id%&gt; &amp; app = &lt;% packagename%&gt;</b> .  Das Ergebnis der Benutzerinteraktion mit dem Fenster wird an <b>&lt;% CnC%&gt; / records.php</b> gesendet </li><li>  Phishing-Fenster als Google Play Card verkleidet anzeigen. </li></ul></li><li>  <b>Interaktiv</b> - Der Befehl dient zur Interaktion mit Fensterelementen anderer Anwendungen mithilfe von AcessibilityService.  F√ºr die Interaktion ist ein spezieller Service im Programm implementiert.  Die untersuchte Anwendung kann mit den Fenstern interagieren: <br><ul><li>  Im Moment aktiv.  In diesem Fall enth√§lt der Parameter die ID oder den Text (Namen) des Objekts, mit dem interagiert werden muss. </li><li>  Sichtbar f√ºr den Benutzer zum Zeitpunkt der Ausf√ºhrung des Befehls.  Die Anwendung w√§hlt Fenster anhand ihrer ID aus. </li></ul><br>  Nachdem die Anwendung <b>AccessibilityNodeInfo-</b> Objekte f√ºr interessierende Fensterelemente erhalten hat, kann sie abh√§ngig von den Parametern folgende Aktionen ausf√ºhren: <br><ul><li>  Fokus - Setzen Sie den Fokus auf das Objekt. </li><li>  Klicken - Klicken Sie auf ein Objekt. </li><li>  actionId - f√ºhrt eine Aktion nach ID aus. </li><li>  setText - √Ñndert den Text des Objekts.  Sie k√∂nnen den Text auf zwei Arten √§ndern: <b>F√ºhren Sie die</b> Aktion <b>ACTION_SET_TEXT aus</b> (wenn die Android-Version des infizierten Ger√§ts j√ºnger oder gleich <b>LOLLIPOP ist</b> ) oder indem Sie eine Zeile in die Zwischenablage <b>einf√ºgen</b> und in das Objekt <b>einf√ºgen</b> (f√ºr √§ltere Versionen).  Mit diesem Befehl k√∂nnen Sie Daten in einer Bankanwendung √§ndern. </li></ul></li></ul><br>  <b>2.</b> <b>PARAMS_ACTIONS</b> - Wie bei <b>PARAMS_ACTION</b> wird nur das JSON-Befehlsarray <b>geliefert</b> . <br><br>  Es scheint, dass viele daran interessiert sein werden, wie die Funktion der Interaktion mit Fensterelementen einer anderen Anwendung aussieht.  So wird diese Funktionalit√§t in Gustuff implementiert: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">interactiveAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List aiList, JSONObject action, JsonObject res)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = action.optInt(<span class="hljs-string"><span class="hljs-string">"repeat"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); Iterator aiListIterator = ((Iterable)aiList).iterator(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(aiListIterator.hasNext()) { Object ani = aiListIterator.next(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;= count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(index = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; ++index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"focus"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"click"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(<span class="hljs-number"><span class="hljs-number">16</span></span>)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(((AccessibilityNodeInfo)ani).performAction(action.optInt(<span class="hljs-string"><span class="hljs-string">"actionId"</span></span>))) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(action.has(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>)) { customHeader ch = CustomAccessibilityService.a; Context context = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getApplicationContext(); String text = action.optString(<span class="hljs-string"><span class="hljs-string">"setText"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(performSetTextAction(ch, context, ((AccessibilityNodeInfo)ani), text)) { ++count; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(index == count) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } ((AccessibilityNodeInfo)ani).recycle(); } res.addPropertyNumber(<span class="hljs-string"><span class="hljs-string">"res"</span></span>, Integer.valueOf(count)); }</code> </pre> <br>  Textersetzungsfunktion: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performSetTextAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, AccessibilityNodeInfo ani, String text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> result; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Build$VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">21</span></span>) { Bundle b = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bundle(); b.putCharSequence(<span class="hljs-string"><span class="hljs-string">"ACTION_ARGUMENT_SET_TEXT_CHARSEQUENCE"</span></span>, ((CharSequence)text)); result = ani.performAction(<span class="hljs-number"><span class="hljs-number">0x200000</span></span>, b); <span class="hljs-comment"><span class="hljs-comment">// ACTION_SET_TEXT } else { Object clipboard = context.getSystemService("clipboard"); if(clipboard != null) { ((ClipboardManager)clipboard).setPrimaryClip(ClipData.newPlainText("autofill_pm", ((CharSequence)text))); result = ani.performAction(0x8000); // ACTION_PASTE } else { result = false; } } return result; }</span></span></code> </pre> <br>  Wenn der Steuerungsserver korrekt konfiguriert ist, kann Gustuff die Textfelder in der Bankanwendung ausf√ºllen und auf die f√ºr die Transaktion erforderlichen Schaltfl√§chen klicken.  Der Trojaner muss nicht einmal in der Anwendung autorisiert sein. Senden Sie einfach einen Befehl, um die PUSH-Benachrichtigung zu demonstrieren, und √∂ffnen Sie anschlie√üend die zuvor installierte Bankanwendung.  Der Benutzer durchl√§uft eine Autorisierung, nach der Gustuff automatisch ausf√ºllen kann. <br><br><h3>  SMS-Verarbeitungsmodul </h3><br>  Die Anwendung legt fest, dass der Ereignishandler SMS-Nachrichten vom infizierten Ger√§t akzeptiert.  Die untersuchte Anwendung kann Befehle vom Bediener empfangen, die in SMS-Nachrichten enthalten sind.  Befehle kommen im Format: <br><br>  <b>7! 5 = &lt;% Base64-codierter Befehl%&gt;</b> <br><br>  Die Anwendung sucht in allen eingehenden SMS-Nachrichten nach der Zeichenfolge <b>7! 5 =</b> Wenn sie eine Zeichenfolge erkennt, dekodiert sie eine Base64-Zeichenfolge mit Offset 4 und f√ºhrt den Befehl aus.  Befehle √§hneln Befehlen mit CnC.  Das Ergebnis der Ausf√ºhrung wird an dieselbe Nummer gesendet, von der der Befehl stammt.  Antwortformat: <br><br>  <b>7 * 5 = &lt;% Base64-Codierung des Befehls "result_code"%&gt;</b> <br><br>  Optional kann die Anwendung alle empfangenen Nachrichten an die Stammnummer senden.  Dazu muss in der Voreinstellungsdatei eine Stammnummer angegeben und das Flag f√ºr die Nachrichtenumleitung gesetzt sein.  Eine SMS-Nachricht wird im folgenden Format an die Angreifernummer gesendet: <br><br>  <b>&lt;% Von Nummer%&gt; - &lt;% Zeit, Format: TT / MM / JJJJ HH: MM: SS%&gt; &lt;% SMS-Text%&gt;</b> <br><br>  Optional kann die Anwendung auch Nachrichten an CnC senden.  Die SMS-Nachricht wird im JSON-Format an den Server gesendet: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%BotID%&gt;, <span class="hljs-attr"><span class="hljs-attr">"sms"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"text"</span></span>:&lt;%SMS body%&gt;, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:&lt;%From number%&gt;, <span class="hljs-attr"><span class="hljs-attr">"date"</span></span>:&lt;%Timestamp%&gt; } }</code> </pre> <br>  Wenn das Flag <b>nameGenerator ("DEFAULT_APP_SMS")</b> gesetzt ist, beendet die Anwendung die Verarbeitung von SMS-Nachrichten und l√∂scht die Liste der eingehenden Nachrichten. <br><br><h3>  Proxy-Modul </h3><br>  In der untersuchten Anwendung gibt es ein Backconnect-Proxy-Modul (im Folgenden als Proxy-Modul bezeichnet), das eine separate Klasse enth√§lt, die statische Felder mit Konfiguration enth√§lt.  Die Konfigurationsdaten werden in offener Form im Beispiel gespeichert: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g-/4f/mi/g-4fmidam6alfsjuhw1ltmcodhy.png" alt="Bild alt"></div><br><br>  Alle vom Proxy-Modul ausgef√ºhrten Aktionen werden in Dateien protokolliert.  Zu diesem Zweck erstellt die Anwendung im externen Speicher ein Verzeichnis mit dem Namen "logs" (das Feld ProxyConfigClass.logsDir in der Konfigurationsklasse), in dem die Protokolldateien gespeichert werden.  Die Protokollierung erfolgt in Dateien mit Namen: <br><br><ol><li>  <b>main.txt</b> - Diese Klasse <b>protokolliert den</b> Betrieb der Klasse mit dem Namen CommandServer.  Die weitere Protokollierung des Strings str in dieser Datei wird als mainLog (str) bezeichnet. </li><li>  <b>session - &lt;% id%&gt;. txt</b> - Die einer bestimmten Proxy-Sitzung zugeordneten Protokolldaten werden in dieser Datei gespeichert.  Die weitere Protokollierung der Zeichenfolge str in dieser Datei wird als sessionLog (str) bezeichnet. </li><li>  <b>server.txt</b> - Diese Daten protokollieren alle Daten, die in die oben genannten Dateien geschrieben wurden. </li></ol><br>  Protokolldatenformat: <br><br>  &lt;% Date%&gt; [Thread [&lt;% Thread-ID%&gt;], ID []]: Protokollzeichenfolge <br><br>  Ausnahmen, die w√§hrend des Betriebs des Proxy-Moduls auftreten, werden ebenfalls in einer Datei protokolliert.  Hierzu generiert die Anwendung ein JSON-Objekt im Format: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"uncaughtException"</span></span>:&lt;%short description of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"thread"</span></span>:&lt;%thread%&gt; <span class="hljs-string"><span class="hljs-string">"message"</span></span>:&lt;%detail message of throwable%&gt; <span class="hljs-string"><span class="hljs-string">"trace"</span></span>: //Stack trace info [ { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: }, { <span class="hljs-attr"><span class="hljs-attr">"ClassName"</span></span>: <span class="hljs-string"><span class="hljs-string">"FileName"</span></span>: <span class="hljs-string"><span class="hljs-string">"LineNumber"</span></span>: <span class="hljs-string"><span class="hljs-string">"MethodName"</span></span>: } ] }</code> </pre> <br>  Anschlie√üend wird es in eine Zeichenfolgendarstellung konvertiert und protokolliert. <br><br>  Das Proxy-Modul wird nach Erhalt des entsprechenden Teams gestartet.  Wenn ein Befehl zum Starten des Proxy-Moduls <b>eingeht</b> , startet die Anwendung einen Dienst namens <b>MainService</b> , der f√ºr die Steuerung des Betriebs des Proxy-Moduls verantwortlich ist - dessen Start und Stopp. <br><br>  Phasen des Starts des Dienstes: <br><br>  <b>1.</b> Startet einen Timer, der einmal pro Minute arbeitet und die Aktivit√§t des Proxy-Moduls √ºberpr√ºft.  Wenn das Modul nicht aktiv ist, wird es gestartet. <br>  Wenn das Ereignis <b>android.net.conn.CONNECTIVITY_CHANGE</b> ausgel√∂st wird, wird das Proxy-Modul <b>gestartet</b> . <br><br>  <b>2. Die</b> Anwendung erstellt mit dem Parameter <b>PARTIAL_WAKE_LOCK</b> eine <b>Wecksperre</b> und erfasst diese.  Daher kann die CPU des Ger√§ts nicht in den Ruhemodus wechseln. <br><br>  <b>3.</b> Startet die Befehlsverarbeitungsklasse f√ºr das Proxy-Modul, indem zuerst die mainLog-Zeile <b>(‚ÄûServer starten‚Äú)</b> und protokolliert werden <br><br>  <b>Server :: start () Host [&lt;% proxy_cnc%&gt;], commandPort [&lt;% command_port%&gt;], proxyPort [&lt;% proxy_port%&gt;]</b> <br><br>  Dabei sind <b>proxy_cnc, command_port und proxy_port</b> die Parameter, die aus der Proxy-Server-Konfiguration erhalten werden. <br><br>  Die Befehlsverarbeitungsklasse hei√üt <b>CommandConnection</b> .  Unmittelbar nach dem Start werden die folgenden Aktionen ausgef√ºhrt: <br><br>  <b>4.</b> <b>Stellt eine</b> <b>Verbindung</b> zu <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.commandPort her</b> und sendet dort die Daten √ºber das infizierte Ger√§t im JSON-Format: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%id%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imei"</span></span>:&lt;%imei%&gt;, <span class="hljs-attr"><span class="hljs-attr">"imsi"</span></span>:&lt;%imsi%&gt;, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:&lt;%model%&gt;, <span class="hljs-attr"><span class="hljs-attr">"manufacturer"</span></span>:&lt;%manufacturer%&gt;, <span class="hljs-attr"><span class="hljs-attr">"androidVersion"</span></span>:&lt;%androidVersion%&gt;, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:&lt;%country%&gt;, <span class="hljs-attr"><span class="hljs-attr">"partnerId"</span></span>:&lt;%partnerId%&gt;, <span class="hljs-attr"><span class="hljs-attr">"packageName"</span></span>:&lt;%packageName%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkType"</span></span>:&lt;%networkType%&gt;, <span class="hljs-attr"><span class="hljs-attr">"hasGsmSupport"</span></span>:&lt;%hasGsmSupport%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simReady"</span></span>:&lt;%simReady%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simCountry"</span></span>:&lt;%simCountry%&gt;, <span class="hljs-attr"><span class="hljs-attr">"networkOperator"</span></span>:&lt;%networkOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"simOperator"</span></span>:&lt;%simOperator%&gt;, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>:&lt;%version%&gt; }</code> </pre> <br>  Wo: <br><br><ul><li>  id - Bezeichner, der versucht, den Wert mit dem Feld "id" aus der Shared Preference-Datei mit dem Namen "x" abzurufen.  Wenn dieser Wert nicht erhalten werden konnte, wird ein neuer generiert.  , Proxy-  ÃÜ , ÃÜ   Bot ID. </li><li> imei ‚Äî IMEI ÃÜ.        ‚Äî         . </li><li> imsi ‚Äî International Mobile Subscriber Identity ÃÜ.        ‚Äî         . </li><li> model ‚Äî The end-user-visible name for the end product. </li><li> manufacturer ‚Äî The manufacturer of the product/hardware (Build.MANUFACTURER). </li><li> androidVersion ‚Äî    "&lt;%release_version%&gt; (&lt;%os_version%&gt;),&lt;%sdk_version%&gt;" </li><li> country ‚Äî   ÃÜ. </li><li> partnerId ‚Äì  . </li><li> packageName ‚Äì package name. </li><li> networkType ‚Äî     (: ¬´WIFI¬ª, ¬´MOBILE¬ª).     null. </li><li> hasGsmSupport ‚Äì true ‚Äì    GSM,  false. </li><li> simReady ‚Äì  SIM-. </li><li> simCountry ‚Äî ISO-  (  ÃÜ -). </li><li> networkOperator ‚Äî  .        ‚Äî         . </li><li> simOperator ‚Äî The Service Provider Name (SPN).        ‚Äî         . </li><li> version ‚Äî     -,   ÃÜ     ¬´1.6¬ª. </li></ul><br> <b>5.</b>       .      : <br><br><ul><li> 0 offset ‚Äì command </li><li> 1 offset ‚Äì sessionId </li><li> 2 offset ‚Äì length </li><li> 4 offset ‚Äî data </li></ul><br>     : <br><br> <b>mainLog(¬´Header { sessionId&lt;%id%&gt;], type[&lt;%command%&gt;], length[&lt;%length%&gt;] }¬ª)</b> <br><br>     : <br><br><table><tbody><tr><th>  Name </th><th> Command </th><th>  Daten </th><th>  Beschreibung </th></tr><tr><td> <b>connectionId</b> </td><td>  0 </td><td> Connection ID </td><td>    </td></tr><tr><td> <b>SLEEP</b> </td><td>  3 </td><td>  Zeit </td><td>   Proxy- </td></tr><tr><td> <b>PING_PONG</b> </td><td>  4 </td><td>  - - </td><td>  PONG- </td></tr></tbody></table><br> PONG-   4     : <b>0x04000000</b> . <br><br>    connectionId (   ) <b>CommandConnection</b>    <b>ProxyConnection</b> . <br><br><ul><li>      : <b>ProxyConnection</b>  <b>end</b> .    <b>ProxyConnection</b>     <b>ProxyConfigClass.host</b> : <b>ProxyConfigClass.proxyPort</b>   JSON-: </li></ul><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:&lt;%connectionId%&gt; }</code> </pre> <br>     SOCKS5-,     ,     . ÃÜ       <b>end</b> .       : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/hz/ed/y7/hzedy7sapdijp20ayiacbiwarc8.png" alt="Bild alt"></div><br><h2>  ÃÜ </h2><br>       ÃÜ  CnC-        SSL.             JSON-.       : <br><br><ul><li> <b>http://&lt;%CnC%&gt;/api/v1/set_state.php</b> ‚Äî   . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/get.php</b> ‚Äî  . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_sms.php</b> ‚Äî  SMS-ÃÜ   ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/load_ab.php</b> ‚Äî      ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/aevents.php</b> ‚Äì     ,   preference-ÃÜ. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_card.php</b> ‚Äî  ,    -,   Google Play Market. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/logs.php</b> ‚Äì  -. </li><li> <b>http://&lt;%CnC%&gt;/api/v1/records.php</b> ‚Äì  ,     . </li><li> <b>http://&lt;%CnC%&gt;/api/v1/set_error.php</b> ‚Äì   ÃÜ . </li></ul><br><h2>  Empfehlungen </h2><br>              ,          ,     . <br><br>              ,    .               ,   ,             . <br><br>    ‚Äì   - ,      ,      -,    , ,     ,       ,     . <br><br><h3>    : </h3><br><ul><li>         Android  - ,  Google Play; </li><li>     <b> </b>    ; </li><li>     Android; </li><li>      ; </li><li>    ; </li><li>    ,   SMS-. </li></ul><br>   <b> </b> ,          Group-IB. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de446948/">https://habr.com/ru/post/de446948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de446932/index.html">TDMS Fairway und BIM</a></li>
<li><a href="../de446938/index.html">Partikelsystem in der Kernanimation. Weihnachtsgeschichte</a></li>
<li><a href="../de446940/index.html">QS auf prod. Warum ist es cool?</a></li>
<li><a href="../de446942/index.html">Server, kannst du mich h√∂ren? BROP-Angriff am Beispiel der Aufgabe NeoQUEST-2019</a></li>
<li><a href="../de446944/index.html">Warum in unrentable Unternehmen investieren?</a></li>
<li><a href="../de446950/index.html">76% der Hersteller haben keine Erfahrung mit der Implementierung von Additiven - warum ist es gut?</a></li>
<li><a href="../de446952/index.html">Erstellen Sie animierte Histogramme mit R.</a></li>
<li><a href="../de446956/index.html">Es ist sch√§dlich f√ºr Licht oder wie man die Ladung einer Autobatterie h√§lt</a></li>
<li><a href="../de446958/index.html">Tricky Perl Quine</a></li>
<li><a href="../de446960/index.html">Das Haus, das Jack gebaut hat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>