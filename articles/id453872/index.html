<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘ˆ ğŸ˜¼ ğŸ‘¸ğŸ½ Mengembalikan foto menggunakan jaringan saraf ğŸ† ğŸ§—ğŸ¼ ğŸ¹</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hai semuanya, saya bekerja sebagai programmer riset di tim visi komputer Mail.ru Group. Untuk Hari Kemenangan tahun ini, kami memutuskan untuk membuat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Mengembalikan foto menggunakan jaringan saraf</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/453872/"><img src="https://habrastorage.org/getpro/habr/post_images/333/44a/c78/33344ac788b63200841180799417f934.jpg"><br><br>  Hai semuanya, saya bekerja sebagai programmer riset di tim visi komputer Mail.ru Group.  Untuk Hari Kemenangan tahun ini, kami memutuskan untuk membuat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">proyek untuk pemulihan foto-foto militer</a> .  Apa itu restorasi foto?  Ini terdiri dari tiga tahap: <br><br><ul><li>  kami menemukan semua cacat gambar: istirahat, pertengkaran, lubang; <br></li><li>  mengecat cacat yang ditemukan berdasarkan nilai piksel di sekitarnya; <br></li><li>  mewarnai gambar. <br></li></ul><br>  Dalam artikel ini, saya akan membahas setiap tahap pemulihan secara terperinci dan memberi tahu Anda bagaimana dan di mana kami mengambil data, jaringan apa yang kami pelajari, apa yang kami lakukan, garu apa yang kami injak. <br><a name="habracut"></a><br><h1>  Pencarian cacat </h1><br>  Kami ingin menemukan semua piksel yang terkait dengan cacat pada foto yang diunggah.  Pertama, kita perlu memahami jenis foto tahun perang yang akan diunggah orang.  Kami berpaling ke penyelenggara proyek Resimen Immortal, yang berbagi data dengan kami.  Setelah menganalisisnya, kami perhatikan bahwa orang-orang sering mengunggah potret, tunggal atau grup, yang memiliki sejumlah cacat sedang atau besar. <br><br>  Maka perlu untuk mengumpulkan sampel pelatihan.  Sampel pelatihan untuk tugas segmentasi adalah gambar dan topeng tempat semua cacat ditandai.  Cara termudah adalah memberi foto ke spidol ke spidol.  Tentu saja, orang pandai menemukan cacat, tetapi masalahnya adalah bahwa markup adalah proses yang sangat panjang. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d5d/a19/892/d5da1989220f10bcaac3944d27d64276.png"><br><br>  Diperlukan waktu dari satu jam hingga satu hari kerja untuk menandai piksel terkait cacat dalam satu foto, sehingga sulit untuk mengumpulkan sampel lebih dari 100 foto dalam beberapa minggu.  Karena itu, kami mencoba menambah data kami dan menulis cacat pada diri kami sendiri: kami mengambil foto yang bersih, menerapkan cacat buatan padanya dan mendapatkan topeng yang menunjukkan bagian-bagian tertentu dari gambar yang rusak.  Bagian utama dari sampel pelatihan kami adalah 79 foto yang ditandai secara manual, yang 11 ditransfer ke sampel uji. <br><br>  Pendekatan yang paling populer untuk masalah segmentasi: ambil Unet dengan pembuat enkode yang sudah terlatih dan minimalkan jumlahnya <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3">M</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.941ex" height="2.057ex" viewBox="0 -780.1 1697 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-4D" x="645" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> SM </script>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">binary cross-entropy</a> ) dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-4"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">E</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.638ex" height="2.057ex" viewBox="0 -780.1 2858 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-49" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-43" x="1333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-45" x="2093" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> DICE </script>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">SÃ¸rensen - Koefisien dadu</a> ). <br><br>  Masalah apa yang muncul dengan pendekatan ini dalam masalah segmentasi cacat? <br><br><ul><li>  Sekalipun tampak bagi kita bahwa ada banyak cacat dalam foto, bahwa itu sangat kotor dan sangat compang-camping oleh waktu, area yang ditempati oleh cacat masih jauh lebih kecil daripada bagian gambar yang tidak rusak.  Untuk mengatasi masalah ini, Anda dapat menambah bobot kelas positif di <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-10">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-11">M</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.941ex" height="2.057ex" viewBox="0 -780.1 1697 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-4D" x="645" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> SM </script>  , dan bobot optimal akan menjadi rasio dari jumlah semua piksel murni dengan jumlah piksel yang dimiliki cacat. <br></li><li>  Masalah kedua adalah bahwa jika kita menggunakan Unet out of the box dengan pra-terlatih encoder, misalnya Albunet-18, maka kita kehilangan banyak informasi posisi.  Lapisan pertama Albunet-18 terdiri dari konvolusi dengan inti 5 dan berjalan sama dengan dua.  Ini memungkinkan jaringan bekerja dengan cepat.  Kami mengorbankan waktu operasi jaringan untuk lokalisasi cacat yang lebih baik: kami menghapus kumpulan maksimum setelah lapisan pertama, mengurangi langkah ke 1 dan mengurangi inti konvolusi menjadi 3. <br></li><li>  Jika kita bekerja dengan gambar kecil, misalnya, mengompres gambar ke 256 x 256 atau 512 x 512, maka cacat kecil akan hilang begitu saja karena interpolasi.  Karena itu, Anda perlu bekerja dengan gambar besar.  Sekarang dalam produksi kami melakukan segmentasi cacat pada foto 1024 x 1024. Oleh karena itu, perlu untuk melatih jaringan saraf pada potongan besar gambar besar.  Dan karena ini, ada masalah dengan ukuran kecil batch pada satu kartu video. <br></li><li>  Selama pelatihan, kami memiliki sekitar 20 gambar yang ditempatkan pada satu kartu.  Karena itu, estimasi rata-rata dan varians di lapisan BatchNorm tidak akurat.  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">BatchNorm di tempat</a> membantu kami mengatasi masalah ini, yang, pertama, menghemat memori, dan kedua, ia memiliki versi BatchNorm yang Disinkronkan, yang menyinkronkan statistik antara semua kartu.  Sekarang kami mempertimbangkan rata-rata dan varians bukan dengan 20 gambar pada satu kartu, tetapi dengan 80 gambar dari 4 kartu.  Ini meningkatkan konvergensi jaringan. <br></li></ul><br>  Pada akhirnya, berat badan bertambah <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">S</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">M</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.941ex" height="2.057ex" viewBox="0 -780.1 1697 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-53" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-4D" x="645" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> SM </script>  Dengan mengubah arsitektur dan menggunakan BatchNorm Di Tempat, kami mulai mencari cacat pada foto.  Tetapi dengan murah Anda bisa melakukan sedikit lebih baik dengan menambahkan Test Time Augmentation.  Kita dapat menjalankan jaringan sekali di gambar input, lalu mirror itu dan jalankan jaringan lagi, ini dapat membantu kita menemukan cacat kecil. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c75/95b/702/c7595b702dcb921dac612b0218ce13e4.png"><br><br>  Akibatnya, jaringan kami melakukan konvergensi pada empat GeForce 1080Ti dalam 18 jam.  Inferensi membutuhkan waktu 290 ms.  Ternyata cukup lama, tetapi ini adalah harga untuk fakta bahwa kami sedang mencari cacat kecil.  Validasi <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-15"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">D</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">I</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">E</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.638ex" height="2.057ex" viewBox="0 -780.1 2858 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-49" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-43" x="1333" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-45" x="2093" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> DICE </script>  sama dengan 0,35, dan <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-20"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">R</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">O</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">C</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">A</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">U</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">C</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.596ex" height="2.057ex" viewBox="0 -780.1 4562 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-4F" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-43" x="1523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-41" x="2283" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-55" x="3034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=https://habr.com/ru/company/mailru/blog/453872/&amp;usg=ALkJrhiUeqY90bmR2zMpuYgOY8GibRTl4A#MJMATHI-43" x="3801" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> ROCAUC </script>  - 0,93. <br><br><h1>  Restorasi fragmen </h1><br>  Unet membantu kami memecahkan masalah ini lagi.  Untuk input, kami memberinya gambar asli dan topeng di mana kami menandai ruang bersih dengan unit, dan piksel yang ingin kita lukis dengan nol.  Kami mengumpulkan data sebagai berikut: kami mengambil set data besar dengan gambar dari Internet, misalnya, OpenImagesV4, dan cacat buatan yang dibuat serupa dengan yang ditemukan dalam kehidupan nyata.  Dan setelah itu mereka melatih jaringan untuk memperbaiki bagian yang hilang. <br><br>  Bagaimana kita bisa memodifikasi Unet untuk tugas ini? <br><br>  Anda dapat menggunakan Konvolusi Parsial alih-alih konvolusi biasa.  Idenya adalah bahwa ketika kita menciutkan suatu wilayah gambar dengan kernel, kita tidak memperhitungkan nilai piksel yang terkait dengan cacat.  Ini membantu membuat lukisan lebih akurat.  Contoh dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">artikel NVIDIA</a> .  Dalam gambar pusat, mereka menggunakan Unet dengan konvolusi biasa, dan di sebelah kanan - dengan Konvolusi Parsial: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a5/280/a4b/5a5280a4be71695d16ab08af876c5d23.png"><br><br>  Kami melatih jaringan selama 5 hari.  Pada hari terakhir, kami membekukan BatchNorm, ini membantu membuat batas bagian gambar yang dicat kurang terlihat. <br><br>  Jaringan memproses gambar 512 x 512 dalam 50 ms.  Validasi PSNR adalah 26,4.  Namun, metrik tidak dapat dipercaya tanpa syarat dalam tugas ini.  Oleh karena itu, kami pertama-tama menjalankan beberapa model bagus pada data kami, menganonimkan hasilnya, dan kemudian memilih model yang kami sukai.  Jadi kami memilih model final. <br><br>  Saya menyebutkan bahwa kami menambahkan cacat buatan untuk membersihkan gambar.  Saat berlatih, Anda perlu memonitor dengan hati-hati ukuran maksimum cacat yang ditumpangkan, karena dengan cacat yang sangat besar yang belum pernah dilihat jaringan dalam proses pembelajaran, ia akan secara liar berfantasi dan memberikan hasil yang benar-benar tidak pantas.  Jadi, jika Anda perlu mengecat cacat besar, juga menerapkan cacat besar selama pelatihan. <br><br>  Berikut adalah contoh algoritme: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abd/6cb/c8c/abd6cbc8c05396042bf83c00516b630e.png"><br><br><h1>  Mewarnai </h1><br>  Kami mengelompokkan cacat dan mengecatnya, langkah ketiga adalah rekonstruksi warna.  Biarkan saya mengingatkan Anda bahwa di antara foto-foto "Resimen Abadi" ada banyak potret tunggal atau kelompok.  Dan kami ingin jaringan kami bekerja dengan baik dengan mereka.  Kami memutuskan untuk membuat pewarnaan sendiri, karena tidak ada layanan yang kami kenal yang melukis potret dengan cepat dan baik. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/015/bce/bf1/015bcebf15ef1ee069fdf08f16e00542.png"><br><br>  GitHub memiliki <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">repositori</a> populer untuk mewarnai foto.  Rata-rata, dia melakukan pekerjaan ini dengan baik, tetapi dia memiliki beberapa masalah.  Misalnya, ia suka melukis pakaian dengan warna biru.  Karena itu, kami juga menolaknya. <br><br>  Jadi, kami memutuskan untuk membuat jaringan saraf untuk pewarnaan.  Ide yang paling jelas: ambil gambar hitam putih dan prediksi tiga saluran, merah, hijau dan biru.  Tetapi, secara umum, kita dapat menyederhanakan pekerjaan kita.  Kita dapat bekerja bukan dengan representasi warna RGB, tetapi dengan representasi YCbCr.  Komponen Y adalah kecerahan (luma).  Gambar hitam putih yang diunduh adalah saluran Y, kami akan menggunakannya kembali.  Tetap untuk memprediksi Cb dan Cr: Cb adalah perbedaan dalam warna biru dan kecerahan, dan Cr adalah perbedaan dalam warna merah dan kecerahan. <br><br><img src="https://habrastorage.org/webt/k8/ke/l_/k8kel_xrjco6euolh8ypkchjm8g.jpeg"><br><br>  Mengapa kami memilih tampilan YCbCr?  Mata manusia lebih rentan terhadap perubahan kecerahan daripada perubahan warna.  Oleh karena itu, kami menggunakan kembali komponen-Y (kecerahan), sesuatu yang pada awalnya mudah diterima mata, dan memprediksi Cb dan Cr, di mana kita dapat membuat sedikit lebih banyak kesalahan, karena orang-orang melihat lebih sedikit "salah" dalam warna.  Fitur ini mulai aktif digunakan pada awal televisi berwarna, ketika bandwidth saluran tidak cukup untuk mengirimkan semua warna secara penuh.  Gambar dipindahkan ke YCbCr, ditransfer ke komponen Y tidak berubah, dan Cb dan Cr dikompresi dua kali. <br><br><h1>  Cara merakit garis dasar </h1><br>  Anda dapat kembali menggunakan Unet dengan encoder pra-terlatih dan meminimalkan Kehilangan L1 antara CbCr nyata dan yang diprediksi.  Kami ingin mewarnai potret, jadi selain foto dari OpenImages, kami perlu menambahkan foto khusus untuk tugas kami. <br><br>  Di mana saya bisa mendapatkan foto berwarna orang-orang berseragam militer?  Ada orang di internet yang melukis foto-foto lama sebagai hobi atau untuk memesan.  Mereka melakukan ini dengan sangat hati-hati, berusaha untuk sepenuhnya mematuhi semua nuansa.  Mewarnai seragam, tanda pangkat, medali, mereka beralih ke bahan arsip, sehingga hasil karya mereka dapat dipercaya.  Secara total, kami menggunakan 200 foto yang dilukis dengan tangan.  Sumber data kedua yang bermanfaat adalah situs <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Tentara Merah Buruh dan Petani</a> .  Salah satu penciptanya difoto di hampir semua varian seragam militer selama Perang Patriotik Besar. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f72/999/7d9/f729997d9fd02755fd95967ff09d27ca.png"><br><br>  Dalam beberapa foto, ia mengulangi pose orang-orang dari foto arsip terkenal.  Sangat bagus dia memotret dengan latar belakang putih, ini memungkinkan kami untuk menambah data dengan sangat baik, menambahkan berbagai objek alami ke latar belakang.  Kami juga menggunakan potret orang modern biasa, melengkapi mereka dengan lencana dan atribut pakaian perang lainnya. <br><br>  Kami melatih AlbuNet-50 - ini adalah Unet, di mana AlbuNet-50 digunakan sebagai encoder.  Jaringan mulai memberikan hasil yang memadai: kulit berwarna merah muda, mata biru abu-abu, tali bahu berwarna kekuningan.  Tapi masalahnya adalah dia melukis gambar-gambar itu dengan bintik-bintik.  Hal ini disebabkan oleh fakta bahwa dari sudut pandang kesalahan L1 terkadang lebih menguntungkan untuk tidak melakukan apa pun daripada mencoba memprediksi warna. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/435/4a9/63c/4354a963c4cd2789c434002e44fdda26.png"><br>  <i>Kami membandingkan hasil kami dengan foto Ground Truth - pewarnaan manual dari artis dengan julukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Klimbim</a></i> <br><br>  Bagaimana cara mengatasi masalah ini?  Kita membutuhkan pembeda: jaringan saraf, di mana kita akan memasok gambar ke input, dan itu akan mengatakan seberapa realistis gambar ini terlihat.  Di bawah, satu foto dilukis dengan tangan, dan yang kedua oleh jaringan saraf.  Menurutmu yang mana? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/253/86a/abd/25386aabd9080c14daf71b60d9968453.png"><br><br><div class="spoiler">  <b class="spoiler_title">Jawabannya</b> <div class="spoiler_text">  Foto kiri dilukis secara manual. <br></div></div><br>  Sebagai diskriminator, kami menggunakan diskriminator dari artikel <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Self-Attention GAN</a> .  Ini adalah jaringan konvolusional kecil, di lapisan terakhir yang disebut Self-Attention.  Ini memungkinkan Anda untuk lebih "memperhatikan" detail gambar.  Kami juga menggunakan normalisasi spektral.  Penjelasan dan motivasi yang tepat dapat ditemukan di artikel.  Kami melatih jaringan dengan kombinasi kehilangan-L1 dan kesalahan yang dikembalikan oleh diskriminator.  Sekarang jaringan mengecat detail gambar dengan lebih baik, dan latar belakang lebih konsisten.  Contoh lain: di sebelah kiri adalah hasil dari jaringan hanya dilatih dengan kehilangan-L1, di sebelah kanan - dengan kehilangan-L1 dan kesalahan diskriminator. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa4/724/ada/aa4724ada4e0bbdc52dbcaadd5bb3fdc.png"><br><br>  Pada empat Geforce 1080Ti, pelatihan butuh dua hari.  Jaringan bekerja dalam 30 ms dalam gambar 512 x 512. MSE validasi adalah 34,4.  Seperti pada masalah pewarnaan, metrik tidak dapat sepenuhnya dipercaya.  Karenanya, kami memilih 6 model yang memiliki metrik terbaik untuk validasi, dan memilih secara buta untuk model terbaik. <br><br>  Setelah meluncurkan model dalam produksi, kami melanjutkan percobaan dan sampai pada kesimpulan bahwa lebih baik untuk meminimalkan bukan per-pixel L1-loss, tetapi kerugian perseptual.  Untuk menghitungnya, Anda perlu menjalankan prediksi jaringan dan foto sumber melalui jaringan VGG-16, mengambil peta atribut pada lapisan bawah dan membandingkannya sesuai dengan MSE.  Pendekatan ini melukis lebih banyak area dan membantu mendapatkan gambar yang lebih berwarna. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db9/303/509/db93035094c4906cf82c246151432cbc.jpg"><br><br><h1>  Kesimpulan dan Kesimpulan </h1><br>  Unet adalah model yang keren.  Dalam masalah segmentasi pertama, kami mengalami masalah dalam pelatihan dan bekerja dengan gambar resolusi tinggi, jadi kami menggunakan BatchNorm Di Tempat.  Dalam tugas kedua (Inpainting), alih-alih konvolusi biasa, kami menggunakan Konvolusi Parsial, ini membantu mencapai hasil yang lebih baik.  Dalam masalah pewarnaan untuk Unet, kami menambahkan jaringan diskriminator kecil yang mendenda generator untuk gambar tampak tidak realistis dan menggunakan kerugian persepsi. <br><br>  Kesimpulan kedua adalah bahwa pengakses itu penting.  Dan tidak hanya pada tahap menandai gambar sebelum pelatihan, tetapi juga untuk memvalidasi hasil akhir, karena dalam masalah cacat lukisan atau pewarnaan, Anda masih perlu memvalidasi hasil dengan bantuan seseorang.  Kami memberikan pengguna tiga foto: yang asli dengan cacat yang dihapus, diwarnai dengan cacat yang dihapus, dan hanya foto berwarna jika algoritma untuk mencari dan melukis cacat salah. <br><br>  Kami mengambil beberapa foto proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Album Militer</a> dan memprosesnya dengan jaringan saraf kami.  Inilah hasil yang didapat: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a51/ade/15e/a51ade15e9cee54ec8269dc1e22df0af.jpg"><br><br>  Dan di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> Anda dapat melihatnya dalam resolusi asli dan pada setiap tahap pemrosesan. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id453872/">https://habr.com/ru/post/id453872/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id453862/index.html">Mengapa Anda harus menggunakan pathlib</a></li>
<li><a href="../id453864/index.html">Menggunakan mouse dan keyboard di konsol curang?</a></li>
<li><a href="../id453866/index.html">Permintaan API dengan React Hooks, HOC, atau Render Prop</a></li>
<li><a href="../id453868/index.html">Sentuh sakelar mini dengan panel kaca di nRF52832</a></li>
<li><a href="../id453870/index.html">Kami menulis Reverse socks5 proxy di PowerShell</a></li>
<li><a href="../id453874/index.html">Dari Roulette Rusia ke LOTO Aman: Cara Melindungi Personil Pusat Data</a></li>
<li><a href="../id453876/index.html">Seperti di Yandex.Practicum, desync front-end menang: angka akrobatik dengan Redux-Saga, postMessage dan Jupyter</a></li>
<li><a href="../id453882/index.html">Panduan hebat tentang profesi arsitek solusi (+ daftar tautan berguna)</a></li>
<li><a href="../id453884/index.html">Penggantian HYIP Kamera atau DSLR?</a></li>
<li><a href="../id453888/index.html">Pembelajaran Alat Berat dengan Kecepatan Tinggi: Perawatan Prediktif Empat Bulan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>