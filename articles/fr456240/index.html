<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü•© üßúüèº üö¶ D√©veloppement de chatbot (laravel + botman) üíÖüèº üïò üë©üèæ‚Äçüíª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bienvenue! En tant que d√©veloppeur junior full stack, j'ai rencontr√© de nombreux probl√®mes en essayant d'√©crire un bot en utilisant laravel et botman....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>D√©veloppement de chatbot (laravel + botman)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/456240/"><p>  Bienvenue!  En tant que d√©veloppeur junior full stack, j'ai rencontr√© de nombreux probl√®mes en essayant d'√©crire un bot en utilisant laravel et botman.  Tout d'abord, je ne connais pas beaucoup l'anglais, mais il y a tr√®s peu d'articles sur ce sujet en russe, et ceux qui ne m'ont pas aid√© √† r√©soudre mes probl√®mes.  L'article racontera et montrera comment d√©velopper un chatbot sur laravel + botman pour t√©l√©gramme.  J'ai moi-m√™me d√©velopp√© des bots (commerciaux) pour viber et t√©l√©gramme.  En tant que d√©veloppeur de t√©l√©grammes, j'aime le plus. </p><br><p><img src="https://habrastorage.org/webt/lt/zr/fm/ltzrfmykbxry39tsl6ni82onor8.png" alt="image"></p><br><p> Je ne montrerai pas comment installer laravel et configurer le serveur pour qu'il fonctionne.  Si vous ne l'avez jamais fait auparavant, il sera plus facile d'installer openserver, composer (gestionnaire de paquets pour php) y est int√©gr√© et le serveur local pour laravel est d√©j√† configur√©.  Il vous suffit d'√©crire du code en .htaccess.  C'est exactement ce que je travaille √† la maison.  Dans l'article, je montrerai l'une des fa√ßons de d√©velopper un chatbot, de configurer le bot pour qu'il fonctionne dans les t√©l√©grammes, et enfin, je laisserai des liens vers des articles utiles sur laravel'e et botman'e. </p><br><h2>  Conception / pr√©paration </h2><br><p>  Je propose le d√©veloppement d'un bot, comme tous les d√©veloppeurs normaux, avec la conception, la d√©finition d'une t√¢che et l'explication du fonctionnement de laravel.  Avant cela, je dirai que j'√©cris du code dans phpStrom.  Vous pouvez √©crire dans n'importe quel autre IDE, mais je l'utilise. </p><br><p>  Laravel impl√©mente le mod√®le MVC (Model View Controller).  Cela ne signifie pas que vous avez seulement besoin d'√©crire sous mvc, vous pouvez √©crire de la merde, mais il est pr√©f√©rable d'utiliser les avantages fournis par le framework.  Si vous connaissez le mvc, mais que vous ne l'avez pas utilis√© comme moi, le d√©veloppement avec laravel est le meilleur moyen de consolider les connaissances. </p><a name="habracut"></a><br><h3>  Que doit faire notre bot: </h3><br><ul><li>  Demander un nom d'utilisateur √† l'utilisateur </li><li>  Demandez si l'utilisateur aime la m√©t√©o ou non. </li><li>  √âcrivez √©galement la r√©ponse dans la base de donn√©es </li><li>  Dites au revoir et envoyez une photo </li></ul><br><p>  Un peu sur MVC.  Lors de l'acc√®s √† notre logiciel, via des commandes (URL URL), nous devons accepter ces commandes et traiter, comprendre ce dont l'utilisateur a besoin.  Il existe des itin√©raires pour cela, appel√©s itin√©raires.  Routes d√©termine quel contr√¥leur doit √™tre utilis√©, √† son tour, si n√©cessaire, le contr√¥leur acc√®de √† la base de donn√©es via le mod√®le.  Le mod√®le contacte la base de donn√©es et renvoie le r√©sultat dont nous avons besoin.  Dans le bot, la vue n'est pas n√©cessaire, car  tout le travail passe par l'interface messenger.  Ainsi, apr√®s r√©ception des donn√©es du mod√®le, le contr√¥leur donne ces donn√©es de vue, dans notre cas il s'agit d'un mod√®le de lame (il est utilis√© par laravel).  Les donn√©es peuvent √™tre envoy√©es √† une page php r√©guli√®re, mais il est pr√©f√©rable de le faire via des mod√®les de lame.  Nous utilisons l'interface de messagerie, puis nous lui enverrons imm√©diatement des donn√©es. </p><br><h2>  D√©veloppement </h2><br><p>  Pour cr√©er un projet, entrez simplement la commande suivante dans la console </p><br><p><code>composer create-project --prefer-dist botman/studio botelegram</code> </p> <br><p>  Le point d'entr√©e sera rout "/ start".  Il existe plusieurs impl√©mentations de routes dans Botman.  Parce que  nous acc√®derons aux routes via un bot dans un t√©l√©gramme, puis nous avons besoin de "botman.php". </p><br><p><img src="https://habrastorage.org/webt/hs/mw/tj/hsmwtj9-twdd9ktlk6ve5py4iwq.png" alt="image"></p><br><p>  Nous devons y √©crire la ligne suivante </p><br><pre> <code class="php hljs">$botman-&gt;hears(<span class="hljs-string"><span class="hljs-string">'/start'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( $bot )</span></span></span><span class="hljs-function"> </span></span>{ $bot-&gt;startConversation ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> mainConversation ); } );</code> </pre> <br><p>  le t√©l√©gramme lui-m√™me propose de commencer √† travailler avec le bot via la commande "start", et si c'est le cas, nous pouvons faciliter l'interaction avec le bot en d√©finissant le point d'entr√©e initial sur "/ start" et aller imm√©diatement travailler avec lui. </p><br><p>  Utilisation de $ bot-&gt; startConversation (nouveau mainConversation);  nous indiquons quel contr√¥leur sera responsable du travail.  De plus, nous enregistrerons l'utilisation de notre contr√¥leur, pour cela nous devons ajouter ce code dans le fichier de chemin: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">mainConversation</span></span>;</code> </pre> <br><p>  Continuons.  Nous devons cr√©er une base de donn√©es et le contr√¥leur lui-m√™me.  Je veux dire que vous utilisez openserver.  La base de donn√©es peut √™tre cr√©√©e via la console ou en utilisant phpMyAdmin, qui est int√©gr√© √† openserver. </p><br><p>  Maintenant quelques configurations.  Nous devons saisir les donn√©es de la base de donn√©es dans le fichier de configuration de laravel.  Il se trouve dans le r√©pertoire racine du projet et s'appelle .env </p><br><p><img src="https://habrastorage.org/webt/ya/j9/al/yaj9algdv_3ugct8rqt-ua2fy1a.png" alt="image"></p><br><p>  Trouver les lignes associ√©es √† la base de donn√©es </p><br><pre> <code class="plaintext hljs">DB_CONNECTION=mysql DB_HOST=127.0.0.1 DB_PORT=3306 DB_DATABASE=botelegram DB_USERNAME=root DB_PASSWORD=</code> </pre> <br><p>  Ici, nous ne sommes int√©ress√©s que par le nom de la base de donn√©es, le nom d'utilisateur et le mot de passe.  Si vous utilisez openserver, vous pouvez √©crire en root-name et laisser le mot de passe vide, le nom de la base de donn√©es d√©pend de vous. </p><br><p>  Maintenant, notre application a acc√®s √† la base de donn√©es.  La prochaine chose que nous devons faire est de cr√©er un mod√®le et une migration.  Nous √©crivons dans la console: </p><br><p> <code>php artisan make:model messengerUser -m</code> </p> <br><p>  L'indicateur -m cr√©era une migration pour la base de donn√©es et l'associera √† notre mod√®le.  Mettons tout de suite en place notre migration pour ne plus y revenir. </p><br><p>  Il vaut mieux ne pas le faire, mais pour ne pas cr√©er un tas de fichiers, nous √©crivons toutes les donn√©es dans une table. <br>  Nous avons besoin de: </p><br><ul><li>  identifiant de chat </li><li>  Identifiant </li><li>  Beau temps ou pas </li></ul><br><p>  Cela suffit pour d√©montrer les capacit√©s de base de Botman.  Ouvrez la migration nouvellement cr√©√©e, qui se trouve dans la base de donn√©es / migrations / creation_create_messanger_users_table.php </p><br><p><img src="https://habrastorage.org/webt/dz/kq/sv/dzkqsvxyblhrqhm62erj_cd2xao.png" alt="image"></p><br><p>  Compl√©tez la m√©thode up dans cette migration, elle devrait ressembler √† ceci: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">up</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Schema::create(<span class="hljs-string"><span class="hljs-string">'messenger_users'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Blueprint $table)</span></span></span><span class="hljs-function"> </span></span>{ $table-&gt;increments(<span class="hljs-string"><span class="hljs-string">'id'</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">"id_chat"</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">"name"</span></span>); $table-&gt;string(<span class="hljs-string"><span class="hljs-string">'response'</span></span>); $table-&gt;timestamps(); }); }</code> </pre> <br><p>  Nous devons maintenant d√©marrer la migration afin que notre table existe dans la base de donn√©es.  Dans la console, vous devez vous inscrire: </p><br><p> <code>php artisan migrate</code> </p> <br><p>  Astuce: si pendant le processus de d√©veloppement, vous devez modifier les champs de la table, mais qu'il y a des donn√©es dans la table et si vous n'en avez pas besoin, vous pouvez mettre √† jour les tables √† l'aide de la commande <code>php artisan migrate:refresh</code> . </p><br><p>  R√©sultat: </p><br><p><img src="https://habrastorage.org/webt/2k/wy/5e/2kwy5ennah0pz8us1oyljum6ftw.png" alt="image"></p><br><p>  laravel a effectu√© 3 migrations, mais nous ne sommes int√©ress√©s que par la 3e migration depuis  c'est l√† que nous enregistrerons nos donn√©es. </p><br><p>  Il est temps de cr√©er un contr√¥leur, d'y connecter notre mod√®le et d'√©crire la logique. </p><br><p>  En g√©n√©ral, il est pr√©f√©rable de cr√©er tous les fichiers via la console, mais puisque nous utilisons Botman, et je suis tellement habitu√©, nous allons cr√©er un contr√¥leur manuellement.  Dans Botman, le contr√¥leur est appel√© conversation, il y a peut-√™tre des diff√©rences importantes entre eux, mais je n'ai pas compris cela - il n'y avait pas besoin.  Dans le dossier app / Conversations, cr√©ez un fichier appel√© mainConversation.php. </p><br><p>  Sur l'√©cran, vous voyez une configuration minimale de conversation </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">Conversation</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mainConversation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conversation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  Votre classe doit avoir une m√©thode d'ex√©cution publique, c'est le point d'entr√©e du contr√¥leur. </p><br><p>  Connectez notre mod√®le au contr√¥leur: </p><br><p> <code>use app\messengerUser;</code> <br>  √âcrivons la logique initiale.  La m√©thode run ex√©cutera une m√©thode priv√©e qui demande quel est le nom de l'utilisateur, √©crit son id et son nom dans id_chat et le nom de notre table. </p><br><p>  Pour commencer, √©crivez: </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">messengerUser</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">database</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Attachments</span></span>\<span class="hljs-title"><span class="hljs-title">Image</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Conversations</span></span>\<span class="hljs-title"><span class="hljs-title">Conversation</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Incoming</span></span>\<span class="hljs-title"><span class="hljs-title">Answer</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BotManAnswer</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">Actions</span></span>\<span class="hljs-title"><span class="hljs-title">Button</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">OutgoingMessage</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">BotMan</span></span>\<span class="hljs-title"><span class="hljs-title">Messages</span></span>\<span class="hljs-title"><span class="hljs-title">Outgoing</span></span>\<span class="hljs-title"><span class="hljs-title">Question</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BotManQuestion</span></span>;</code> </pre> <br><p>  qui nous permettra d'utiliser les m√©thodes de Botman </p><br><p>  Et maintenant, nous allons apporter des modifications √† notre contr√¥leur: </p><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mainConversation</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">conversation</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $response = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setName(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $question = BotManQuestion::create(<span class="hljs-string"><span class="hljs-string">"!   ?"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ask( $question, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( BotManAnswer $answer )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( $answer-&gt;getText () != <span class="hljs-string"><span class="hljs-string">''</span></span> ){ array_push (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response, $answer-&gt;getText()); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;askWeather (); } }); } }</code> </pre> <br><p>  run () d√©marre la m√©thode dont nous avons besoin, c'est setName ().  D√©j√† dans setName (), nous demandons le nom d'utilisateur, √©crivons le nom dans le tableau, puis ex√©cutons la m√©thode suivante, qui demandera √† l'utilisateur la m√©t√©o. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">askWeather</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $question = BotManQuestion::create(<span class="hljs-string"><span class="hljs-string">"    ?"</span></span>); $question-&gt;addButtons( [ Button::create(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;value(<span class="hljs-number"><span class="hljs-number">1</span></span>), Button::create(<span class="hljs-string"><span class="hljs-string">''</span></span>)-&gt;value(<span class="hljs-number"><span class="hljs-number">2</span></span>) ]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ask($question, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BotManAnswer $answer)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      ,       array_push ($this-&gt;response, $answer); $this-&gt;exit(); }); }</span></span></code> </pre> <br><p>  askWeather () a une structure similaire, mais ici nous utilisons des boutons pour limiter les choix des utilisateurs et nous faciliter la vie.  Les boutons suppriment beaucoup d'erreurs qu'un utilisateur peut cr√©er.  Ici, nous cr√©ons √©galement une question, √† l'aide d'addButtons (), nous attachons des boutons √† la question, puis nous appelons la question donn√©e et traitons la r√©ponse, et passons √©galement √† la derni√®re m√©thode. </p><br><p>  La m√©thode exit () √©crit toutes les donn√©es dans la base de donn√©es (peut √™tre extraite dans une m√©thode distincte), dit au revoir √† l'utilisateur et lui envoie √©galement une image. </p><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $db = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> database(); $db-&gt;id_chat = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bot-&gt;getUser()-&gt;getId(); $db-&gt;name = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $db-&gt;response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;response[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $db-&gt;save(); $attachment = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(<span class="hljs-string"><span class="hljs-string">'https://gykov.ru/projects/botelegram.png'</span></span>); $message = OutgoingMessage::create(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>) -&gt;withAttachment($attachment); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;bot-&gt;reply($message); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre><br><p>  En utilisant OutgoingMessage :: create ('A bient√¥t!') -&gt; withAttachment ($ attachment), nous cr√©ons un nouveau message et y attachons une image.  En g√©n√©ral, tous les fichiers publics que l'utilisateur devrait voir sont plac√©s dans le dossier public, mais dans mon dernier bot, il y avait un probl√®me avec cela et j'ai d√ª les placer dans un dossier s√©par√© sur le serveur (non li√© au projet).  Ici, j'ai fait de m√™me. </p><br><p>  La logique de notre bot est pr√™te.  Pour le tester, ouvrez simplement le site via openserver, mais avant cela, vous devez cr√©er un fichier .htiaccess avec le contenu suivant </p><br><pre> <code class="plaintext hljs">&lt;IfModule mod_rewrite.c&gt; RewriteEngine On RewriteRule ^(.*)$ public/$1 [L] &lt;/IfModule&gt;</code> </pre> <br><p>  Le fichier doit se trouver √† la racine du site.  Maintenant, toutes les demandes seront transf√©r√©es vers le dossier public.  Voici comment fonctionne laravel.  Nous ouvrons le site et testons le bot, n'oubliez pas que vous devez d'abord saisir "/ start". </p><br><p>  Apr√®s vous √™tre assur√© que tout fonctionne, vous pouvez le joindre √† des t√©l√©grammes.  Pour ce faire, cr√©ez un nouveau bot sur @botfather, copiez la cl√© du bot √† la fin du fichier .env.  Cela ressemble √† ceci: </p><br><p> <code>TELEGRAM_KEY=key_bot</code> </p> <br><p>  Maintenant, nous devons mettre dans notre projet un pilote pour le travail conjoint de notre robot logique et t√©l√©gramme.  Cela se fait avec une seule commande dans la console: </p><br><p> <code>composer require botman/driver-telegram</code> </p> <br><p>  Vous devrez √©galement enregistrer le bot dans laravel. </p><br><p> <code>php artisan botman:telegram:register</code> </p> <br><p>  Il nous sera demand√© d'entrer l'adresse √† laquelle notre bot sera disponible. </p><br><p><img src="https://habrastorage.org/webt/7t/pg/uv/7tpguvu21qjnqlotwj3nbkmy6c8.png" alt="image"></p><br><p>  Si vous d√©veloppez un bot sur le serveur, ajoutez simplement <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">https: // url_site / botman</a> apr√®s ce bot, vous pouvez le tester dans le messager lui-m√™me.  Mais sachez que laravel a besoin de param√®tres de serveur sp√©ciaux et vous devrez probablement le configurer vous-m√™me.  Je vais laisser un lien sur la fa√ßon de configurer le serveur √† la fin de l'article. </p><br><p>  C‚Äôest peut-√™tre tout.  Si vous lisez jusqu'√† la fin, alors f√©licitations, vous pouvez maintenant d√©velopper des robots de discussion pour laravel en utilisant botman.  Si vous avez des questions, je me ferai un plaisir d'y r√©pondre dans les commentaires, ainsi que les liens promis: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Sources sur github</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Documentation Botman</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Configuration du serveur</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Un article sur lequel j'ai cr√©√© mon premier bot</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">En article sur Botman</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr456240/">https://habr.com/ru/post/fr456240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr456230/index.html">Iobroker quest for quests in reality games</a></li>
<li><a href="../fr456232/index.html">Guide: mise √† jour des interfaces avec les membres par d√©faut dans C # 8.0</a></li>
<li><a href="../fr456234/index.html">Pourquoi Cisco n'ach√®te-t-il pas Splunk ou une discussion sur le fonctionnement de la plate-forme Cisco pour la chasse aux menaces</a></li>
<li><a href="../fr456236/index.html">Peter - Insider Dev Tour: Conf√©rence Insider pour les d√©veloppeurs de Microsoft</a></li>
<li><a href="../fr456238/index.html">Tutoriel: Mettre √† jour les interfaces avec les membres d'interface par d√©faut dans C # 8.0</a></li>
<li><a href="../fr456242/index.html">Un peu plus sur le multit√¢che dans les microcontr√¥leurs</a></li>
<li><a href="../fr456246/index.html">√âl√©ment z√©ro</a></li>
<li><a href="../fr456248/index.html">Comment j'ai attrap√©: avant les styles pour un √©l√©ment de focus</a></li>
<li><a href="../fr456250/index.html">Localisation d'applications et prise en charge RTL. Signaler Yandex.Taxi</a></li>
<li><a href="../fr456256/index.html">Guide d'architecture d'application Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>