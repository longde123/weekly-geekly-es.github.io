<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßìüèº üè® üë©üèæ‚Äçüíª Entwicklung der einfachsten ‚ÄûFirmware‚Äú f√ºr in Redd installierte FPGAs und Debugging am Beispiel des Speichertests ‚úãüèª ‚ôªÔ∏è üÜî</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Irgendwie kann ich meine Gedanken nicht kurz ausdr√ºcken. Im vergangenen Herbst gab es den Wunsch, detaillierter √ºber die von mir beherrschte PSoC-Arch...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Entwicklung der einfachsten ‚ÄûFirmware‚Äú f√ºr in Redd installierte FPGAs und Debugging am Beispiel des Speichertests</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/452656/">  Irgendwie kann ich meine Gedanken nicht kurz ausdr√ºcken.  Im vergangenen Herbst gab es den Wunsch, detaillierter √ºber die von mir beherrschte PSoC-Architektur zu berichten, was zu einer Reihe von Artikeln dar√ºber f√ºhrte.  Jetzt bin ich an der Vorbereitung der Hardware f√ºr unseren Redd-Remote-Debugging-Komplex beteiligt, der hier beschrieben <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">wurde</a> , und ich m√∂chte die gesammelten Erfahrungen in Textform wegwerfen.  Ich bin mir noch nicht sicher, aber es scheint mir, dass es wieder nicht nur ein Artikel ist, sondern ein Zyklus.  Erstens werde ich auf diese Weise die entwickelten Entwicklungsmethoden dokumentieren, die f√ºr jemanden n√ºtzlich sein k√∂nnen, sowohl bei der Arbeit mit dem Komplex als auch im Allgemeinen, und zweitens ist das Konzept noch neu und nicht ganz etabliert.  Vielleicht erscheinen w√§hrend der Diskussion von Artikeln einige Kommentare, aus denen man etwas ziehen kann, um es zu erweitern (oder sogar zu √§ndern).  Deshalb fahren wir fort. <br><img src="https://habrastorage.org/webt/lk/xe/c9/lkxec9ijefezvvydvjbmi49ahny.jpeg"><br><a name="habracut"></a><br><br><h2>  Lange Einf√ºhrung </h2><br>  Ich mag es nicht wirklich zu theoretisieren und bevorzuge es, einige praktische Dinge auf einmal darzulegen.  Aber am Anfang des ersten Artikels, ohne eine lange Einf√ºhrung irgendwo.  Darin begr√ºnde ich den aktuellen Entwicklungsansatz.  Und alles dreht sich um eines: Arbeitsstunden sind eine sehr teure Ressource.  Und die Angelegenheit betrifft nicht nur die f√ºr das Projekt vorgesehenen Bedingungen.  Er ist k√∂rperlich teuer.  Wenn es f√ºr die Entwicklung des Endprodukts ausgegeben wird, was k√∂nnen Sie nirgendwo ohne es tun?  Aber wenn es f√ºr Hilfsarbeit ausgegeben wird, ist dies meiner Meinung nach schlecht.  Ich erinnere mich, dass ich einen Streit mit einem Entwickler hatte, der sagte, dass er, nachdem er selbst Prototypen hergestellt hatte, Geld f√ºr seine einheimische Firma sparen w√ºrde.  Ich machte das Argument, dass er ungef√§hr 3 Tage f√ºr die Herstellung aufwenden w√ºrde.  Das sind 24 Mannstunden.  Wir nehmen sein Gehalt f√ºr diese Stunden, addieren die Sozialsteuer, die "der Arbeitgeber zahlt", sowie die Miete des B√ºros f√ºr diese Stunden.  Und wir sind √ºberrascht zu sehen, dass Sie bei der Bestellung von Boards nebenbei niedrigere Kosten erzielen k√∂nnen.  Aber das bin ich, ich √ºbertreibe.  Wenn Arbeitskosten vermieden werden k√∂nnen, sollten sie im Allgemeinen vermieden werden. <br><br>  Was ist die Entwicklung der "Firmware" f√ºr den Redd-Komplex?  Dies ist ein Hilfsjob.  Das Hauptprojekt wird f√ºr immer gl√ºcklich leben, es sollte so effizient wie m√∂glich durchgef√ºhrt werden, mit ausgezeichneter Optimierung usw.  Es ist jedoch verschwenderisch, Zeit und Energie f√ºr Hilfsmittel aufzuwenden, die nach der Entwicklung in das Archiv gelangen.  Mit Blick auf dieses Prinzip wurde die Entwicklung von Redd-Ger√§ten durchgef√ºhrt.  Wenn m√∂glich, werden alle Funktionen als Standard implementiert.  Die SPI-, I2C- und UART-Busse sind auf Standard-FTDI-Mikroschaltungen implementiert und werden √ºber Standardtreiber ohne Schnickschnack programmiert.  Die Verwaltung von Rollen erfolgt im Format eines virtuellen COM-Ports.  Es kann modifiziert werden, aber zumindest wurde alles getan, damit ein solcher Wunsch nicht entsteht.  Im Allgemeinen wird alles Standard, wenn m√∂glich, auf standardm√§√üige Weise implementiert.  Von Projekt zu Projekt m√ºssen Entwickler lediglich schnell typischen Code f√ºr den PC schreiben, um auf diese Busse zugreifen zu k√∂nnen.  Die Entwicklungstechnik in C ++ sollte f√ºr diejenigen offensichtlich sein, die Programme f√ºr Mikrocontroller entwickeln (wir werden in einem anderen Artikel auf einige technische Details eingehen). <br><br>  Aber FPGA steht allein in der Anlage.  Es wird dem System f√ºr F√§lle hinzugef√ºgt, in denen nicht standardm√§√üige Protokolle mit hohen Leistungsanforderungen implementiert werden m√ºssen.  Wenn diese ben√∂tigt werden, m√ºssen Sie die "Firmware" daf√ºr machen.  Hier geht es um die FPGA-Programmierung, und ich m√∂chte speziell darauf eingehen, nur alle zum gleichen Zweck - um die Entwicklungszeit von Hilfsmitteln zu verk√ºrzen. <br><br>  Um den Leser nicht zu verwirren, werde ich den Gedanken in einem Rahmen formulieren: <br><blockquote>  Es ist nicht erforderlich, in jedem Projekt eine Entwicklung f√ºr FPGAs durchzuf√ºhren.  Wenn gen√ºgend Buscontroller direkt an den Zentralprozessor angeschlossen sind, um mit dem Zielger√§t zu arbeiten, sollten Sie diese verwenden. <br>  FPGA wurde dem Komplex f√ºr die Implementierung von nicht standardm√§√üigen Protokollen hinzugef√ºgt. </blockquote><br><br><h2>  Blockdiagramm des Komplexes </h2><br>  Schauen wir uns das Blockdiagramm des Komplexes an <br><br><img src="https://habrastorage.org/webt/vf/hv/da/vfhvda1kmsax-zkxaue4xu_ysmk.png"><br><br>  Am Ende der Schaltung befindet sich ein ‚ÄûTaschenrechner‚Äú.  Eigentlich ist dies ein Standard-PC mit Linux.  Entwickler k√∂nnen regul√§re Programme in C, C ++, Python usw. schreiben, die vom Computer ausgef√ºhrt werden.  Im oberen rechten Teil befinden sich die Standardanschl√ºsse von Standardreifen.  Auf der linken Seite befindet sich ein Schalter f√ºr Standardger√§te (SPI Flash, SD-Karte und mehrere Halbleiter-Halbleiterrelais, mit denen beispielsweise Tastendr√ºcke simuliert werden k√∂nnen).  Und im Zentrum steht genau der Teil, mit dem die Arbeit in dieser Artikelserie ber√ºcksichtigt werden soll.  Sein Herzst√ºck ist ein FPGA der FPGA-Klasse, von dem gerade Linien ausgehen (k√∂nnen als Differenzpaare oder normale ungepufferte Leitungen verwendet werden), GPIO-Leitungen mit konfigurierbarem Logikpegel sowie ein √ºber einen ULPI-Chip implementierter USB 2.0-Bus. <br><br><h2>  Fortsetzung der Einf√ºhrung zum FPGA-Programmieransatz </h2><br>  Bei der Entwicklung einer Hochleistungssteuerungslogik f√ºr FPGAs wird Seine Majest√§t normalerweise von einer Zustandsmaschine als erste Geige gespielt.  Auf den Maschinen ist es m√∂glich, eine schnelle, aber komplexe Logik zu implementieren.  Andererseits wird ein Automat langsamer entwickelt als ein Programm f√ºr einen Prozessor, und seine Modifikation ist ein anderer Prozess.  Es gibt Systeme, die die Entwicklung und Wartung von Maschinen vereinfachen.  Eine davon wurde sogar von unserer Firma entwickelt, aber der Entwurfsprozess f√ºr jede Art von komplexer Logik ist nicht schnell.  Wenn das entwickelte System das Endprodukt ist, ist es sinnvoll, eine gute Steuerungsmaschine vorzubereiten, zu entwerfen und Zeit f√ºr deren Implementierung aufzuwenden.  Wie bereits erw√§hnt, ist die Entwicklung f√ºr Redd eine Nebenaufgabe.  Es soll den Prozess erleichtern, nicht erschweren.  Daher wurde beschlossen, dass die Entwicklung nicht automatisch erfolgt, sondern durch Prozessorsysteme. <br><br>  Andererseits wurde bei der Entwicklung der Hardware die bislang modernste Option, FPGA mit dem ARM-Kern, abgelehnt.  Erstens aus Preisgr√ºnden.  Ein Cyclone V SoC-basiertes Prototyp-Board ist m√§√üig teuer, aber seltsamerweise ist ein separates FPGA viel teurer.  H√∂chstwahrscheinlich wird der Preis f√ºr Prototyping-Boards gesenkt, um Entwickler zur Verwendung von FPGA-Daten zu verleiten, und die Boards werden einzeln verkauft.  Die Serie muss einzelne Chips nehmen.  Dar√ºber hinaus gibt es aber auch eine "Sekunde".  Zweitens, als ich mit Cyclone V SoC experimentierte, stellte sich heraus, dass dieses Prozessorsystem nicht so ist und produktiv ist, wenn es um den Einzelzugriff auf Ports geht.  Batch - ja, da ist die Arbeit schnell.  Und bei Einzelzugriffen mit einer Taktfrequenz des Prozessorkerns von 925 MHz k√∂nnen Sie mit einer Frequenz von einigen Megahertz auf die Ports zugreifen.  Ich schlage allen vor, die Standardfunktion zum Eingeben von Daten in das FIFO des UART-Blocks aufzurufen, die den Warteschlangen√ºberlauf √ºberpr√ºft, sie jedoch aufruft, wenn die Warteschlange offensichtlich leer ist, dh nichts st√∂rt die Operationen.  Meine Produktivit√§t stieg von einer Million auf f√ºnfhunderttausend Anrufe pro Sekunde (nat√ºrlich verlief die Arbeit mit dem Speicher mit normaler Geschwindigkeit, alle Caches wurden optimiert, selbst die Funktionsvariante, bei der FIFO nicht auf √úberlauf √ºberpr√ºft wurde, funktionierte schneller, nur die diskutierte Funktion hat sich reichlich gemischt Schreiben und Lesen von Ports).  Das ist FIFO!  Tats√§chlich wurde FIFO erfunden, um Daten dort abzulegen und zu vergessen!  Schnell beenden!  Und nicht mit Leistung, weniger als ein Mega-Betrieb pro Sekunde bei einer Prozessorfrequenz von 925 MHz ... <br><br>  Latenz ist schuld.  Zwischen dem Prozessorkern und dem Ger√§t befinden sich drei oder mehr Br√ºcken.  Dar√ºber hinaus h√§ngt die Geschwindigkeit des Zugriffs auf die Ports vom Kontext ab (mehrere Datens√§tze in einer Reihe werden schnell ausgef√ºhrt, aber der erste Lesevorgang stoppt den Prozess, bis die zwischengespeicherten Daten vollst√§ndig entladen sind. Zu viele Datens√§tze in einer Reihe werden ebenfalls langsamer, da die Schreibpuffer ersch√∂pft sind).  Schlie√ülich ergab die Untersuchung der im Debugging-Puffer akkumulierten Traces, dass die <b>Cortex A-</b> Architektur aufgrund des komplexen Cache-Systems denselben Teil f√ºr eine unterschiedliche Anzahl von Taktzyklen ausf√ºhren kann.  Zusammenfassend wurde unter Ber√ºcksichtigung all dieser Faktoren (Preis, Leistungseinbu√üen bei der Arbeit mit dem Ger√§t, Instabilit√§t der Zugriffsgeschwindigkeit auf das Ger√§t, allgemeine Abh√§ngigkeit vom Kontext) beschlossen, einen solchen Chip nicht in den Komplex einzubauen. <br><br>  Experimente mit dem PSoC von Cypress zeigten, dass der <b>Cortex M-</b> Kern dort besser vorhersehbare und wiederholbare Ergebnisse liefert, die logische Kapazit√§t und die maximale Betriebsfrequenz dieser Steuerungen jedoch nicht den technischen Spezifikationen entsprachen und daher auch verworfen wurden. <br><br>  Es wurde beschlossen, ein kosteng√ºnstiges typisches Cyclone IV-FPGA zu installieren und die Verwendung eines synthetisierten NIOS II-Prozessorkerns zu empfehlen.  Nun, und wenn n√∂tig - um die Entwicklung mit anderen Methoden durchzuf√ºhren (automatische Maschinen, harte Logik usw.). <br><br><blockquote>  Ich werde diesen Absatz separat erw√§hnen (und sogar hervorheben), dass der Hauptprozessor des Komplexes x86 (x64) ist.  Er ist der zentrale Prozessor des Systems.  Darauf wird die Hauptlogik des Komplexes ausgef√ºhrt.  Das Prozessorsystem, auf das weiter unten eingegangen wird, ist so ausgelegt, dass es einfach die Logik des Betriebs des Ger√§ts liefert, das im FPGA "geflasht" ist.  Dar√ºber hinaus wird dieses Ger√§t nur verkauft, wenn die Entwickler nicht √ºber gen√ºgend Vollzeitmodule verf√ºgen, die direkt an den Zentralprozessor angeschlossen sind. </blockquote><br><br><h2>  Der Prozess des Entwickelns und Debuggens von "Firmware" </h2><br>  Wenn auf dem Redd-Komplex Linux ausgef√ºhrt wird, bedeutet dies nicht, dass die Entwicklung in diesem Betriebssystem durchgef√ºhrt werden sollte.  Redd ist ein Remote-Executor, und die Entwicklung sollte unabh√§ngig vom Betriebssystem auf Ihrem Computer durchgef√ºhrt werden.  Wer Linux hat, ist umso einfacher, aber wer ist an Windows gew√∂hnt (Fr√ºher mochte ich WIN 3.1 nicht sehr, aber ich musste arbeiten, aber irgendwann, als WIN95 OSR2, habe ich mich daran gew√∂hnt, und jetzt ist es nutzlos, damit umzugehen, es ist einfacher zu akzeptieren). k√∂nnen diese weiterhin die Entwicklung darin f√ºhren. <br><br>  Da meine Freundschaft mit Linux nicht geklappt hat, werde ich keine schrittweisen Anweisungen zum Einrichten der Umgebung geben, sondern mich auf allgemeine Worte beschr√§nken.  Wer mit diesem Betriebssystem arbeitet, wird daf√ºr ausreichen, und f√ºr den Rest ... Glauben Sie mir, es ist einfacher, Systemadministratoren zu kontaktieren.  Am Ende habe ich genau das getan.  Aber trotzdem. <br><br>  Sie sollten Quartus Prime Programmer und Tools derselben Version wie Ihre Entwicklungsumgebung herunterladen und installieren.  Wenn die Versionen nicht √ºbereinstimmen, kann es zu √úberraschungen kommen.  Ich habe den ganzen Abend damit verbracht, diese Tatsache zu verstehen.  Laden Sie daher einfach das Tool derselben Version wie die Entwicklungsumgebung herunter. <br><br>  Geben Sie nach der Installation das Verzeichnis ein, in dem das Programm installiert wurde, das Unterverzeichnis bin.  Im Allgemeinen sollte die wichtigste Datei jtagconfig sein.  Wenn Sie es ohne Argumente ausf√ºhren (ich habe √ºbrigens beharrlich die Eingabe von ./jtagconfig verlangt und nur so), wird eine Liste der im System verf√ºgbaren Programmierer und der damit verbundenen FPGAs angezeigt.  Es sollte einen USB-Blaster geben.  Und das erste Problem, das das System aufwirft, sind nicht gen√ºgend Zugriffsrechte, um mit USB zu arbeiten.  Wie man es l√∂st, ohne auf sudo zur√ºckzugreifen, wird hier beschrieben: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">radiotech.kz/threads/nastrojka-altera-usb-blaster-v-ubuntu-16-04.1244</a> <br><br>  Aber hier ist eine Liste der Ger√§te angezeigt.  Jetzt solltest du schreiben: <br><pre><code class="plaintext hljs">./jtagconfig --enableremote &lt;password&gt;</code> </pre> <br>  Danach wird der Server gestartet, auf den von √ºberall im Netzwerk zugegriffen werden kann. <br><br>  Alles w√§re in Ordnung, aber die System-Firewall l√§sst niemanden diesen Server sehen.  Eine √úberpr√ºfung bei Google ergab, dass f√ºr jeden Linux-Typ (von dem es viele gibt) die Ports in der Firewall auf ihre eigene Weise ge√∂ffnet werden und so viele Zauberspr√ºche gesprochen werden m√ºssen, dass ich lieber die Administratoren kontaktiere. <br>  Wenn jtagd nicht in autorun registriert wurde, wird Ihnen beim √ñffnen des Remotezugriffs mitgeteilt, dass es unm√∂glich ist, ein Kennwort festzulegen.  Um dies zu verhindern, muss jtagd nicht √ºber jtagconfig selbst, sondern davor gestartet werden. <br><br>  Im Allgemeinen geht es beim Schamanismus um Schamanismus.  Lassen Sie mich nur die These korrigieren: <br><ul><li>  Der eingehende Port 1309 muss im System ge√∂ffnet sein. Welches Protokoll habe ich aus Gr√ºnden der Zuverl√§ssigkeit nicht vollst√§ndig verstanden? Sie k√∂nnen sowohl TCP als auch UDP √∂ffnen. </li><li>  Wenn Sie jtagconfig ohne Argumente starten, sollten der USB-Blaster und das damit verbundene FPGA angezeigt werden und keine Fehlermeldung. </li><li>  Vor dem √ñffnen einer Remote-Arbeit muss jtagd mit ausreichenden Rechten ausgef√ºhrt werden.  Wenn jtagd mit unzureichenden Rechten bereits gestartet wurde, sollte der Vorgang vor einem Neustart abgeschlossen sein, da sonst kein Neustart stattfindet. </li><li>  Tats√§chlich wird der Fernzugriff mit der Leitung ge√∂ffnet <pre> <code class="plaintext hljs">jtagconfig --enableremote &lt;password&gt;</code> </pre> </li></ul><br>  Es gibt nat√ºrlich einen √§hnlichen Pfad, der √ºber die GUI-Oberfl√§che verl√§uft, aber es ist logischer, alles im Stapel zu erledigen.  Daher habe ich eine Batch-Version beschrieben.  Wenn alle diese Arbeiten abgeschlossen sind (und die Systemadministratoren sie abgeschlossen haben), starten wir den Programmierer auf unserem Computer und sehen eine Meldung √ºber den Mangel an Ausr√ºstung.  Klicken Sie auf Hardware-Setup: <br><img src="https://habrastorage.org/webt/cj/bq/jh/cjbqjhzydanq__godqnyhq8_ah8.png"><br><br>  Gehen Sie zur Registerkarte JTAG-Einstellungen und klicken Sie auf Server hinzuf√ºgen: <br><img src="https://habrastorage.org/webt/xn/36/8a/xn368ajq_d5kjx-nxyyvculmpus.png"><br><br>  Wir geben die Netzwerkadresse von Redd (f√ºr mich 192.168.1.100) und das Passwort ein: <br><img src="https://habrastorage.org/webt/kd/ro/7y/kdro7ya9kr8od0uwvcv6hycn0eu.png"><br><br>  Wir stellen sicher, dass die Verbindung erfolgreich war. <br><br>  Ich habe drei Maiferien verbracht, um dies zu erreichen, und dann haben die Administratoren alles entschieden. <br><img src="https://habrastorage.org/webt/8h/gp/x0/8hgpx0r19klfwbp7fqd0atfesvq.png"><br><br>  Wechseln Sie zur Registerkarte Hardwareeinstellungen, √∂ffnen Sie die Dropdown-Liste und w√§hlen Sie dort den Remote-Programmierer aus: <br><img src="https://habrastorage.org/webt/-2/cf/te/-2cfteubqycs6lr1h8bniz92epi.png"><br><br>  Alles, jetzt kann es verwendet werden.  Die Schaltfl√§che Start ist entsperrt. <br><img src="https://habrastorage.org/webt/a_/9m/t9/a_9mt9509lhs8muotyfcxh9wwtw.png"><br><br><h2>  Die erste "Firmware" </h2><br>  Na dann.  Damit der Artikel einen echten praktischen Wert hat, analysieren wir die einfachste ‚ÄûFirmware‚Äú, die mit den oben genannten Methoden erstellt wurde.  Das Einfachste, was ich wirklich f√ºr den Komplex implementieren konnte, ist ein Test des SDRAM-Chips.  Hier an diesem Beispiel und √ºben. <br><br>  Es gibt eine Reihe von Amateurkernen, die SDRAM unterst√ºtzen, aber alle schalten sich irgendwie schwierig ein.  Und alle Tricks zu erkl√§ren, ist Arbeit.  Wir werden versuchen, vorgefertigte L√∂sungen zu verwenden, die in das NIOS II-Computersystem eingef√ºgt werden k√∂nnen, daher werden wir den Standard-SDRAM-Controller-Core verwenden.  Der Kern selbst ist im Dokument <b>Embedded Peripherals IP User Guide beschrieben</b> , und in der Beschreibung ist viel Platz f√ºr die Taktverschiebung des SDRAM relativ zum Kerntakt vorgesehen.  Es werden komplexe theoretische Berechnungen und Formeln angegeben, aber was zu tun ist, wird nicht besonders berichtet.  Was zu tun ist, finden Sie im Dokument <b>Verwenden des SDRAM auf dem DE0-Board von Altera mit Verilog Designs</b> .  Im Verlauf der Analyse werde ich das Wissen aus diesem Dokument anwenden. <br><br>  Ich werde in der kostenlosen Version von Quartus Prime 17.0 entwickeln.  Ich konzentriere mich darauf, da sie mir w√§hrend der Montage mitteilen, dass in Zukunft der Kern des <b>SDRAM-Controllers</b> aus der kostenlosen Version herausgeschmissen wird.  Wenn dies in Ihrer Entwicklungsumgebung bereits geschehen ist, st√∂rt es niemanden, die kostenlose 17. Version herunterzuladen und auf einer virtuellen Maschine zu installieren.  Die Hauptarbeit wird √ºberall dort erledigt, wo Sie es gewohnt sind, und die Firmware f√ºr Redd mit SDRAM befindet sich in der 17. Version.  Nun, wenn Sie die kostenlosen Optionen verwenden.  Noch drohte niemand, es aus bezahlten herauszuwerfen.  Aber ich war abgelenkt.  Erstellen Sie ein neues Projekt: <br><img src="https://habrastorage.org/webt/qv/sw/eq/qvsweqv-lktrkcs5keaxu8q_5se.png"><br><br>  Nennen wir es SDRAM_DEMO.  Der Name sollte nicht vergessen werden: Ich werde eine superschnelle Entwicklung durchf√ºhren, daher sollte sich das Prozessorsystem selbst auf der obersten Ebene befinden, ohne Verilog-Schichten.  Dazu muss der Name des Prozessorsystems mit dem Namen des Projekts √ºbereinstimmen.  Also erinnere dich daran. <br><img src="https://habrastorage.org/webt/fv/yf/-p/fvyf-p3vwrjspjlvvd5tqdm2ndi.png"><br><br>  Wenn wir in wenigen Schritten mit den Standardwerten √ºbereinstimmen, entscheiden wir uns f√ºr einen Kristall.  Wir w√§hlen das im Komplex verwendete EP4CE10E22C7 aus. <br><img src="https://habrastorage.org/webt/n6/du/8e/n6du8ejpw_xysdx7dui4f_rc2qi.png"><br><br>  Im n√§chsten Schritt w√§hle ich aus Gewohnheit die Modellierung in ModelSim-Altera.  Heute werden wir nichts modellieren, aber alles kann n√ºtzlich sein.  Es ist besser, eine solche Gewohnheit zu entwickeln und ihr zu folgen: <br><img src="https://habrastorage.org/webt/ym/on/v2/ymonv28mmot9o4frulumjznujk8.png"><br><br>  Das Projekt wird erstellt.  Gehen Sie sofort zur Erstellung des Prozessorsystems (Tools-&gt; Platform Designer): <br><img src="https://habrastorage.org/webt/qv/tb/t8/qvtbt8vbulg78qybfcpdb1jqaja.png"><br><br>  Wir haben ein System erstellt, das ein Uhr- und R√ºcksetzmodul enth√§lt: <br><img src="https://habrastorage.org/webt/xg/bz/o3/xgbzo3yoi-jrtmaiqhd_fz1vp_q.png"><br><br>  Wie bereits erw√§hnt, ist f√ºr den SDRAM-Kern eine spezielle Taktung erforderlich.  Daher wird das Standardmodul r√ºcksichtslos weggeworfen <br><img src="https://habrastorage.org/webt/2e/yv/_0/2eyv_0ufhrwtnap8vdyryftspus.png"><br><br>  F√ºgen Sie stattdessen den Block Universit√§tsprogramm-&gt; System und SDRAM-Uhr f√ºr Karten der DE-Serie hinzu: <br><img src="https://habrastorage.org/webt/ho/tf/nd/hotfndwnreutxuoycv3rh-lhz_m.png"><br><br>  W√§hlen Sie in den Eigenschaften DE0-Nano aus, da die Inspiration f√ºr die SDRAM-Schaltschaltung von diesem Steckbrett stammt: <br><img src="https://habrastorage.org/webt/lc/0f/tl/lc0ftl82cyh0yjpj4baklxmyddc.png"><br><br>  Wir fangen an, unser Prozessorsystem zu stopfen.  Das erste, was hinzugef√ºgt werden muss, ist nat√ºrlich der Prozessorkern selbst.  Sei es Prozessor und Peripherieger√§te-&gt; Embedded-Prozessoren-&gt; NIOS II-Prozessor. <br><img src="https://habrastorage.org/webt/28/sl/n4/28sln4t0khej0gnfh9v9honohu4.png"><br><br>  F√ºr ihn f√ºllen wir noch keine Eigenschaften aus.  Klicken Sie einfach auf Fertig stellen, obwohl wir eine Reihe von Fehlermeldungen erstellt haben.  Bisher gibt es keine Ausr√ºstung, die diese Fehler beseitigt. <br><br>  F√ºgen Sie nun das eigentliche SDRAM hinzu.  Speicherschnittstellen und Controller-&gt; SDRAM-&gt; SDRAM-Controller. <br><img src="https://habrastorage.org/webt/ov/ro/fk/ovrofkityrsnw3vcttpjnwcwhzw.png"><br><br>  Hier m√ºssen wir uns daran halten, die Eigenschaften auszuf√ºllen.  W√§hlen Sie aus der Liste die n√§chstgelegene Mikroschaltung aus, die in der Organisation √§hnlich ist, und klicken Sie auf Apppy.  Seine Eigenschaften fallen in die Felder Speicherprofil: <br><img src="https://habrastorage.org/webt/de/hv/e_/dehve_t_smpdsm3ailji3mhf0u8.png"><br><br>  Jetzt √§ndern wir die Breite des Datenbusses auf 16, die Anzahl der Adressleitungen auf 13 und die Spalten auf 9. <br><img src="https://habrastorage.org/webt/2m/7h/0o/2m7h0otrg1pjp_jchcdmfa1uzvg.png"><br><br>  Ich korrigiere die Zeiten noch nicht, vielleicht wird diese Empfehlung in Zukunft ge√§ndert. <br>  Das Prozessorsystem impliziert ein Programm.  Das Programm muss irgendwo gespeichert sein.  Wir werden den SDRAM-Chip testen.  Im Moment k√∂nnen wir ihr nicht vertrauen.  F√ºgen Sie daher zum Speichern des Programms Speicher hinzu, der auf dem Block-RAM-FPGA basiert.  Grundfunktionen-&gt; On-Chip-Speicher-&gt; On-Chip-Speicher (RAM oder ROM): <br><img src="https://habrastorage.org/webt/ry/ot/-e/ryot-emahnalpamwnkyn1xwcihc.png"><br><br>  Volumen ... Nun, lassen Sie es 32 Kilobyte sein. <br><img src="https://habrastorage.org/webt/mk/jc/gb/mkjcgbjb57ibhy0xeob8mg84nfo.png"><br><br>  Dieser Speicher muss von irgendwoher geladen werden.  Aktivieren Sie dazu das Kontrollk√§stchen Nicht standardm√§√üige Initialisierungsdatei aktivieren und geben Sie einen aussagekr√§ftigen Dateinamen ein.  Sagen wir firmware.hex: <br><img src="https://habrastorage.org/webt/bh/mf/7a/bhmf7ajkwxp8gixms4bgvy9cp08.png"><br><br>  Der Artikel ist bereits kompliziert, sodass wir ihn nicht √ºberladen.  Wir werden einfach das physikalische Ergebnis des Tests in Form von PASS / FAIL-Zeilen ausgeben (und wir werden das logische Ergebnis mit meinem bevorzugten JTAG-Debugging sehen).  F√ºgen Sie dazu den GPIO-Port hinzu.  Prozessoren und Peripherieger√§te-&gt; Peripherieger√§te-&gt; PIO (Parallel IO): <br><img src="https://habrastorage.org/webt/_p/qn/tw/_pqntwmv-ivkyl3zkrwnxcb5wum.png"><br><br>  In den Eigenschaften, in denen wir 2 Bits setzen, m√∂chte ich auch das Kontrollk√§stchen f√ºr die individuelle Steuerung von Bits aktivieren.  Auch nur eine Gewohnheit. <br><img src="https://habrastorage.org/webt/a7/bk/j4/a7bkj4ophwwlkeog2laba81emds.png"><br><br>  Wir haben ein solches System mit einer Reihe von Fehlern: <br><img src="https://habrastorage.org/webt/w_/4p/o2/w_4po2omowqkf35ge_6-ygmdpl4.png"><br><br>  Wir beginnen sie zu beseitigen.  Zun√§chst werden wir die Uhr brechen und zur√ºcksetzen.  Bei der Clock- und Reset-Einheit m√ºssen die Eing√§nge weggeworfen werden.  Dazu gibt es Felder mit der Aufschrift "Zum Exportieren doppelklicken": <br><img src="https://habrastorage.org/webt/bw/gx/w1/bwgxw1cczmqvwzfy3iruazvzzn8.png"><br><br>  Wir klicken, geben aber mehr oder weniger kurze Namen. <br><img src="https://habrastorage.org/webt/be/xc/id/bexcidwci8wqdctpttm_uqnsgwo.png"><br><br>  Sie m√ºssen auch den SDRAM-Taktausgang wegwerfen: <br><img src="https://habrastorage.org/webt/bs/bp/6j/bsbp6j_uz7vlmsnpwvg17cbcqko.png"><br><br>  Jetzt teilen wir sys_clk auf alle Takteing√§nge und reset_source auf alle R√ºcksetzleitungen.  Sie k√∂nnen die Punkte, die die entsprechenden Linien verbinden, vorsichtig mit der ‚ÄûMaus‚Äú treffen oder zum entsprechenden Ausgang gehen, die rechte Maustaste dr√ºcken und dann zum Untermen√º Verbindungen im Dropdown-Men√º gehen und dort die Verbindungen ausw√§hlen. <br><img src="https://habrastorage.org/webt/8t/2q/v4/8t2qv4btxo3ygqw6q3bjqa23hae.png"><br><br><img src="https://habrastorage.org/webt/ag/as/sz/agasszsc45aobhbaephagupfwja.png"><br><br>  Dann verbinden wir die Reifen miteinander.  Wir verbinden Data Master mit allen Bussen aller Ger√§te und Inctruction Master mit fast allen.  Es ist nicht erforderlich, es an den PIO_0-Bus anzuschlie√üen.  Von dort werden Anweisungen definitiv nicht gelesen. <br><img src="https://habrastorage.org/webt/rb/fl/av/rbflavgwws5gsdpmtqrrqlp-v0s.png"><br><br>  Jetzt k√∂nnen Sie Adresskonflikte l√∂sen.  W√§hlen Sie dazu den Men√ºpunkt System-&gt; Basisadressen zuweisen: <br><img src="https://habrastorage.org/webt/ri/pk/te/ripkteta-ftnbrdgjtyj8cabtq8.png"><br><br>  Und wenn wir Adressen haben, k√∂nnen wir auch Vektoren zuweisen.  Gehen Sie dazu zu den Eigenschaften des Prozessorkerns (zeigen Sie darauf, dr√ºcken Sie die rechte Maustaste und w√§hlen Sie den Men√ºpunkt Bearbeiten) und konfigurieren Sie dort die Vektoren im Onchip-Speicher.  W√§hlen Sie einfach diesen Speichertyp in den Dropdown-Listen aus, die Nummern werden selbst ersetzt. <br><img src="https://habrastorage.org/webt/aj/om/nn/ajomnnjye5kuskwbtquacdxqbkw.png"><br><br>  Keine Fehler mehr.  Es bleiben jedoch zwei Warnungen.  Ich habe vergessen, die SDRAM- und PIO-Zeilen zu exportieren. <br><img src="https://habrastorage.org/webt/gn/ux/2m/gnux2mk6ikcgsuzin6xbpmyoiwe.png"><br><br>  Doppelklicken Sie, wie bereits beim Reset- und Clock-Block, auf die gew√ºnschten Beine und geben Sie ihnen die k√ºrzesten (aber verst√§ndlichen) Namen: <br><img src="https://habrastorage.org/webt/ea/bp/pq/eabppqnnarmd3fqbtytqbfoxteg.png"><br><br>  Alles, es gibt keine Fehler oder Warnungen mehr.  Speichern Sie das System.  Dar√ºber hinaus muss der Name mit dem Namen des Projekts √ºbereinstimmen, damit das Prozessorsystem zu einem Element der obersten Ebene des Projekts wird.  Haben Sie nicht vergessen, wie wir es nannten? <br><img src="https://habrastorage.org/webt/hc/gh/7v/hcgh7vmhtfvsziy7idu7pdgbbuo.png"><br><br><img src="https://habrastorage.org/webt/3w/pl/rr/3wplrrqclfbkfquzndakoonrmdw.png"><br><br>  Nun, wir dr√ºcken den wichtigsten Knopf - HDL generieren. <br><img src="https://habrastorage.org/webt/1t/hm/im/1thmimhmf_xc3taykvi8ct1t6ae.png"><br><br>  Alles, der Prozessorteil wird erstellt.  Klicken Sie auf Fertig stellen.  Wir werden daran erinnert, dass es sch√∂n w√§re, dieses Prozessorsystem zum Projekt hinzuzuf√ºgen: <br><img src="https://habrastorage.org/webt/d1/cf/lv/d1cflvqskri1-jrh1ybgflbmglg.png"><br><br>  Hinzuf√ºgen: <br><img src="https://habrastorage.org/webt/3n/yj/gl/3nyjglrcg5dxdngcghpufpgmot8.png"><br><br>  Und dort erreichen wir mit der Schaltfl√§che Hinzuf√ºgen das folgende Bild: <br><img src="https://habrastorage.org/webt/wm/jl/p8/wmjlp82jua7ilcvlosa65g98iqy.png"><br><br>  SIP-Datei wurde noch nicht erstellt.  Ja, und wir brauchen es im Rahmen dieses Artikels nicht. <br><br>  Uhhhh  Der erste Schritt wurde getan.  Wir entwerfen das Projekt so, dass das System die Projekthierarchie und die verwendeten Beine herausfindet.  Kompilierungsfehler sind nicht be√§ngstigend.  Nur in der kostenlosen Version der Umgebung wurden Kernel erstellt, die nur funktionieren, wenn der JTAG-Adapter verbunden ist.  Aber im Redd-Komplex ist es immer verbunden, da es auf einer gemeinsamen Tafel geschieden ist, das hei√üt, wir haben nichts zu bef√ºrchten.  Also ignorieren wir diese Fehler. <br><img src="https://habrastorage.org/webt/0b/hk/jo/0bhkjo904iqlqnjcpaf-iinssba.png"><br><br>  Nun zur√ºck zur Beschreibung des SDRAM-Kernels.  Es hei√üt, dass die CKE-Leitung nicht verwendet wird und immer mit dem Ger√§t verbunden ist.  Tats√§chlich sind FPGA-Strecken im Rahmen des Komplexes nicht nur teuer, sondern auch eine wertvolle Ressource.  Und es w√§re dumm, das Bein zu spreizen, das sich immer in der Einheit befindet (und auf dem DE0-NANO-Board ist es auch nicht geschieden).  Es w√ºrde eine Verilog-Schicht geben, die entsprechende Kette k√∂nnte dort geschnitten werden, aber ich spare Zeit (nerv√∂ses Lachen, wenn man das Volumen des bereits erhaltenen Dokuments betrachtet, aber ohne Speichern w√§re es noch mehr geworden).  Daher gibt es keine Schicht.  Wie man ist  Gehen Sie zum Zuweisungseditor.  Es ist drin, da es in Pin Planner nach den Beschreibungen keine √§hnliche Funktionalit√§t gibt. <br><img src="https://habrastorage.org/webt/wa/mn/li/wamnlimpfzqz8n4xguihx3jciwe.png"><br><br>  Es gibt noch keine Leitung.  Gut.  Erstellen Sie eine neue <br><img src="https://habrastorage.org/webt/nd/hr/b_/ndhrb_1xgzvlhllnqj2zjrrq50i.png"><br><br>  Wir w√§hlen das folgende Symbol: <br><img src="https://habrastorage.org/webt/_c/mg/o5/_cmgo53jkcsq4z4i5lzfdvn_s-a.png"><br><br>  Klicken Sie in dem von uns festgelegten Suchsystem auf Liste und in den Suchergebnissen finden Sie unsere CKE: <br><img src="https://habrastorage.org/webt/s2/r8/9t/s2r89tiymksz4ohpxv_6mudnqoy.png"><br><br>  F√ºgen Sie es der rechten Spalte hinzu und klicken Sie auf OK. <br><img src="https://habrastorage.org/webt/xv/fd/jy/xvfdjyxtnasndf8a_xara0wzpom.png"><br><br>  Wir bekommen folgende Liste: <br><img src="https://habrastorage.org/webt/g7/qn/-k/g7qn-kbokf172_5s4o0gvyjk2fk.png"><br><br>  Klicken Sie im gelben Feld auf die Dropdown-Liste und suchen Sie den virtuellen Pin.  Wir w√§hlen.  Die Gelbf√§rbung zog in eine andere Zelle: <br><img src="https://habrastorage.org/webt/x0/1h/4a/x01h4aaksdrgol8_wyoe3cnwaji.png"><br><br>  Dort w√§hlen wir Ein: <br><img src="https://habrastorage.org/webt/qw/5b/bl/qw5bblpjq2fswujalhmvlcgpew0.png"><br><br>  Alle Gelbf√§rbung ist weg.  Und die Kette ist jetzt als virtuell markiert, was bedeutet, dass kein physisches Bein erforderlich ist.  Daher k√∂nnen wir es nicht der physischen Schlussfolgerung des FPGA zuordnen.  Schlie√üen Sie den Zuweisungseditor und √∂ffnen Sie den Pin-Planer.  Sie k√∂nnen die Beine anhand der Abbildung zuweisen oder die Liste aus der * .qsf-Datei entnehmen, die Teil des Projekts ist, das ich dem Artikel anh√§ngen werde. <br><br><img src="https://habrastorage.org/webt/wn/aj/kc/wnajkcjd97ko1cd7hmasi67ifq0.png"><br><br>  Das war's, schlie√üen Sie Pin Planner, wir f√ºhren die endg√ºltige Zusammenstellung des Projekts durch.  Die Hardware ist fertig, wir fahren mit der Entwicklung der Software f√ºr das resultierende Prozessorsystem fort.  Aber der Artikel ist so gro√ü geworden, dass wir ihn das <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">n√§chste Mal machen werden</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de452656/">https://habr.com/ru/post/de452656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de452642/index.html">Die St√§rke der Menge. Wie Chicago einen M√ºllroboter entwickelte - einen Flussreiniger</a></li>
<li><a href="../de452644/index.html">DevConf X Web Developer Conference - 21. Juni</a></li>
<li><a href="../de452646/index.html">Was das neuronale Netz auf dem ersten Foto eines Schwarzen Lochs sah</a></li>
<li><a href="../de452648/index.html">PHP: Wie man eine komplexe XML-Datei analysiert und nicht in nativem Code ertrinkt</a></li>
<li><a href="../de452652/index.html">Sicherheitswoche 21: Eine L√ºcke in WhatsApp, eine neue Sicherheitsl√ºcke in Intel-Prozessoren, Zero-Day in Windows</a></li>
<li><a href="../de452662/index.html">HPE Server in Selectel</a></li>
<li><a href="../de452664/index.html">Ich habe 18.000 US-Dollar f√ºr eine statische Webseite in Rechnung gestellt ... und bin damit durchgekommen</a></li>
<li><a href="../de452666/index.html">So erm√∂glichen Sie Mikrozahlungen in Ihrer App</a></li>
<li><a href="../de452668/index.html">So √ºberpr√ºfen Sie Cookies auf Einhaltung der DSGVO - ein neues offenes Tool hilft dabei</a></li>
<li><a href="../de452670/index.html">Wer sind Dateningenieure und wie werden sie?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>