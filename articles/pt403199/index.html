<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèæ‚Äçüè´ üë®üèª‚Äç‚úàÔ∏è üë©üèø‚Äçüíª Anatomia e clonagem do adaptador USB para cart√£o SD üíÄ üåµ ü§πüèø</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="... ou como fornecer ao seu projeto DIY MIPS ou ARM leve com um cart√£o micro-SD r√°pido. 
 Bom dia a toda comunidade respeitada. Gostaria de continuar ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Anatomia e clonagem do adaptador USB para cart√£o SD</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/403199/"><div style="text-align:center;"><img src="https://habrastorage.org/files/f54/e21/451/f54e21451bfa4ed38bb087e1641cdf12.jpg"></div><br>  ... ou como fornecer ao seu projeto DIY MIPS ou ARM leve com um cart√£o micro-SD r√°pido. <br>  Bom dia a toda comunidade respeitada.  Gostaria de continuar minha hist√≥ria sobre o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">dispositivo de caixa</a> , ou seja, sobre como ela conseguiu conectar um cart√£o micro-SD √† porta USB 2. <br><a name="habracut"></a><br>  A raiz de todo o problema foi que o USB 2, e n√£o apenas um, possui seu m√≥dulo de processador, mas, infelizmente, nenhum QSPI (QuadSPI) ou uma interface de cart√£o.  Como esse triste fato est√° relacionado aos cart√µes SD?  Muito simples, qualquer cart√£o SD na base f√≠sica de sua conex√£o possui uma interface SPI (SerialPeripheral).  O SPI cl√°ssico usa uma linha f√≠sica para transmitir e receber dados seriais.  Simples e econ√¥mico, tanto em termos de dinheiro quanto em miliamperes.  No entanto, as desvantagens, como voc√™ sabe, s√£o uma continua√ß√£o das vantagens e, para o SPI, elas se tornaram principalmente uma taxa de troca de dados relativamente baixa.  Para resolver esse problema, foi inventado um modo de troca de dados de quatro bits com um cart√£o SD, que √© um parente pr√≥ximo do protocolo QSPI.  Ao usar esse modo, o controlador host e a placa primeiro concordam com os par√¢metros de troca no modo de bit √∫nico e depois mudam para o modo de quatro bits quando usam n√£o uma linha para receber e transmitir, mas quatro para tudo (mais uma para indicar o comando). <br><br>  O que fazer se o equipamento n√£o suportar diretamente o protocolo de quatro bits, mas ainda precisar de uma troca r√°pida?  A resposta √≥bvia √© fornecer ao projeto uma ponte de "interface r√°pida" - um "cart√£o SD de quatro bits". <br><br>  Para resolver esse problema, alguns adaptadores USB-SD foram comprados e submetidos a prepara√ß√£o (a vivissec√ß√£o n√£o foi usada - n√£o somos monstros).  Antes de aquecer o ferro de soldar e o secador de cabelo, uma verifica√ß√£o muito importante foi feita para verificar se o m√≥dulo do processador Debian v√™ o apito do adaptador oferecido a ele.  O teste foi um grande sucesso, bem-vindo √† sala de opera√ß√µes.  O apito comprado √© assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/899/740/5e7/8997405e7cdc4981aac38d2aad8b1c35.jpg"></div><br>  E assim: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a70/962/4bf/a709624bf49a44a1ac3ab97c63049c1c.jpg"></div><br>  Ap√≥s a desmontagem do gabinete, tornou-se poss√≠vel distinguir a placa de circuito impresso (dos dois lados). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/140/a2f/164/140a2f16457b41a6be2902e9dca08a5d.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2d9/48f/33d/2d948f33d59f4afc8fff7b97ebcb5a7e.png"></div><br>  O circuito √© simples, sua base √© o IC GL823F - um microcontrolador com sistema de comando 8051 e com uma mem√≥ria de m√°scara, equipada com uma unidade de interface de hardware USB 2, aparentemente sem qualidade muito alta (por que digo isso - n√£o vejo o resistor de polariza√ß√£o exato da parte anal√≥gica e o oscilador de cristal , o que significa restaurar a frequ√™ncia do sinal recebido com base no gerador calibrado interno).  Vai funcionar, mas n√£o HiFi, n√£o.  Tudo o resto √© um kit de corpo m√≠nimo: capacitores de bloqueio, resistores de pull-up e limitadores de corrente, LEDs e conectores, isso √© tudo de engenharia. <br><br>  Retiramos os componentes com um secador de cabelo e examinamos a placa de circuito impresso.  De v√°rias maneiras, a placa √© dupla face com orif√≠cios de revestimento.  Ap√≥s um breve exame da placa em um microsc√≥pio, esbo√ßando o diagrama de conex√£o e comparando-o com uma folha de dados sobre ICs relacionados √† GL, restauramos o diagrama de circuito. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d96/74e/a6e/d9674ea6ed584e8aa5566554642f4f18.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/454/79e/797/45479e797ffd47a5966944d5a3e4b88d.jpg"></div><br>  E aqui estamos agora come√ßando a ver um pequeno aborrecimento.  O que exatamente?  Nossa caixa √© alimentada por uma tens√£o garantida de 3,3V, e o circuito no GL823 requer 5 volts.  Bem, conforme necess√°rio - ela est√° t√£o acostumada com isso, porque √© muito que o USB oferece a ela.  O pr√≥prio Micro SD √© alimentado por 3,3V, ent√£o o estabilizador LDO embutido √© adicionado ao GL823.  Da√≠ a pergunta - e se o circuito √© alimentado a partir de 3.3V, ele pode funcionar?  Se o LDO conseguir n√£o deixar cair muita tens√£o, pode, mas nem todos os LDOs s√£o igualmente √∫teis.  A folha de dados fornece uma pequena dica - a sa√≠da que alimenta o cart√£o SD √© chamada PMOS.  Essa abrevia√ß√£o n√£o pode deixar de se alegrar - pode-se supor que o esquema HighSide PMOS seja usado, no qual a queda de tens√£o no elemento de controle pode ser muito pequena.  No entanto, tudo isso √© racioc√≠nio, e o √∫nico argumento decisivo √© a experi√™ncia: ele √© filho de erros dif√≠ceis. <br><br>  Ent√£o, que tipo de experi√™ncia ofereceremos?  Vamos tentar alimentar o IC com duas tens√µes comutadas - de 5 V USB ou de 3,3 V, obtidas por um estabilizador separado.  Agora, temos conhecimento suficiente para desenhar um diagrama esquem√°tico. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fb7/4bc/a0b/fb74bca0b27545c192d85f552f89d9f9.gif"></div><br>  A numera√ß√£o dos componentes no circuito √© um tanto estranha pelo motivo de uma ordem m√∫ltipla com v√°rios circuitos de teste ter sido encomendada no fabricante das placas de circuito impresso, e todos eles tiveram a numera√ß√£o dos componentes.  Enquanto preparava o artigo, trouxe o diagrama de circuito de acordo com a fotografia, e o resultado foi o que aconteceu. <br><br>  O que vemos no diagrama?  Claramente, o n√∫cleo √© GL823F.  O conector micro-SD est√° obviamente conectado a ele.  A √∫nica coisa que deve ser observada - o pino 9 no conector √© o contato deslizante da placa no slot, quando a placa est√° no lugar, ela est√° em curto-circuito.  C7-C10 - capacitores de bloqueio nos circuitos de pot√™ncia.  Se voc√™ deseja aumentar um pouco a imunidade a ru√≠dos, os pinos 2 e 16 DD1 podem ser conectados atrav√©s de um bloqueador de ferrite.  R4 limita a corrente atrav√©s de HL1, R5 puxa a linha GPIO para uma na aus√™ncia de um cart√£o no slot.  DA2, C11 e C12 formam um regulador de tens√£o linear de 3,3V. <br><br>  Como naquele momento em que o circuito estava sendo desenhado, por um lado, n√£o estava claro quanto consumiria e, por outro, houve uma experi√™ncia desagrad√°vel no uso de algumas unidades flash USB (que n√£o apontariam com um dedo) que consumiam 400 mA durante a grava√ß√£o, decidiu-se adicionar R6.  Em geral, essa √© uma t√©cnica padr√£o - com um consumo percept√≠vel de LDO linear no circuito (as palavras-chave aqui s√£o LowDropout), coloque um resistor de baixa resist√™ncia com maior pot√™ncia na entrada e dissipe parte do calor nele, e n√£o no estabilizador.  A experi√™ncia, no entanto, mostrou que n√£o h√° necessidade do R6, e voc√™ ainda o ver√° na foto do quadro. <br><br>  O XS4 foi projetado apenas para conduzir um experimento - alternando a pot√™ncia DD1 entre 5 e 3,3 Volts.  O XS2 √© um conector USBB padr√£o, para que voc√™ possa coloc√°-lo √† sua frente e n√£o subir para liberar portas USB sob a mesa para o PC. <br><br>  Aqui est√° o que aconteceu ap√≥s o rastreamento, fabrica√ß√£o de software e instala√ß√£o: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f54/e21/451/f54e21451bfa4ed38bb087e1641cdf12.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d3d/efa/490/d3defa4908c8471181c4c5a177f66a5a.jpg"></div><br>  Como voc√™ pode ver, o lado inferior do quadro √© completamente direto e o lado superior n√£o √© muito mais complicado. <br><br>  N√£o vou atrasar o final da plotagem, direi imediatamente que a experi√™ncia mostrou que √© poss√≠vel alimentar o GL823F a partir de uma fonte de 3,3 V, a comuta√ß√£o do XS4 n√£o afeta nada, exceto o consumo de energia (n√£o atual). <br><br>  Para garantir que a placa fabricada esteja funcionando corretamente, medimos a velocidade de grava√ß√£o e a corrente consumida ao mesmo tempo em tr√™s cart√µes micro-SD diferentes.  Concorrentes de fotos - no est√∫dio! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5d0/b44/93f/5d0b4493fa7b4383bf2209d97733a56f.jpg"></div><br>  A avalia√ß√£o do consumo de corrente (medindo o que foi feito, minha l√≠ngua n√£o pode ser chamada) foi realizada usando um medidor combinado da quantidade de tens√£o-corrente da carga da bateria.  Francamente falando, acabou por ser uma surpresa que ele tamb√©m transmita dados USB. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ccb/1ec/e7f/ccb1ece7f12d4f14b50c78a014df4dfc.jpg"></div><br>  Usamos apenas a indica√ß√£o da corrente consumida, o pre√ßo de divis√£o deste instrumento, por assim dizer, √© 0,01A, mais pelo menos um erro de amostragem de 1 unidade do d√≠gito menos significativo ainda √© 0,01A.  Portanto, a tabela mostra apenas as faixas de indica√ß√µes, entre as quais o n√∫mero da corrente consumida saltou.  Espero, no entanto, que para aqueles que est√£o interessados ‚Äã‚Äãem aplicar o GL823 em suas decis√µes, ainda seja poss√≠vel avaliar a barra de consumo superior. <br><br>  Al√©m de testar a placa feita, para aumentar a objetividade, algumas medidas de controle foram feitas usando outro leitor de cart√£o SD.  Aqui est√° um: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bb6/65a/79d/bb665a79dcfa41269e29baf219bb7977.jpg"></div><br>  Esta amostra n√£o foi preparada, peguei emprestada da minha filha por 5 minutos e, se a tivesse estripado, elas teriam me estripado imediatamente.  Uma coisa √© certa - o chip n√£o pertence √† fam√≠lia GL823, cujos membros s√£o capazes de trabalhar tanto com o padr√£o SD, um multi-padr√£o √© muito dif√≠cil para eles. <br><br>  As velocidades de leitura e grava√ß√£o foram medidas da maneira mais simples: o mesmo arquivo com um tamanho de 1.058.268 kB foi gravado e lido no cart√£o de teste.  O experimento de controle (em outro leitor) foi realizado apenas para excluir erros do sistema por uma ou outra ordem decimal; os dados n√£o foram processados; s√≥ fiquei convencido de que aproximadamente os tempos e as correntes de consumo superavam os obtidos no est√°gio anterior. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3c9/44d/ea0/3c944dea089342df93633cb585f542fa.png"></div><br>  Se voc√™ deseja aplicar o circuito descrito em seu projeto, ao estimar o consumo, corrija o fato de que a corrente de alimenta√ß√£o veio de uma voltagem USB de 5 Volts, mas o GL823 foi alimentado com uma voltagem de 3,3 V e a diferen√ßa √© de 5-3,3 = 1,7 (e isso √© 50 % de 3,3) foi perdida no DA2.  Quando alimentados por uma fonte centralizada (e, espero, pulsante) de 3,3 Volts, obtemos economias decentes. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt403199/">https://habr.com/ru/post/pt403199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt403185/index.html">Como o Uber manipula as pessoas</a></li>
<li><a href="../pt403189/index.html">Como tratar uma loucura. 1.1 - Farmacoterapia: o b√°sico e a esquizofrenia</a></li>
<li><a href="../pt403191/index.html">Efetuando Login no Programa ROS</a></li>
<li><a href="../pt403193/index.html">Como fizemos nosso show de √°udio e showroom</a></li>
<li><a href="../pt403197/index.html">Por que os f√≠sicos est√£o t√£o preocupados com o paradoxo do desaparecimento de informa√ß√µes em um buraco negro</a></li>
<li><a href="../pt403201/index.html">Col√¥nia. Cap√≠tulo 9: Um Ataque Inesperado</a></li>
<li><a href="../pt403203/index.html">VacuumTechExpo 2017</a></li>
<li><a href="../pt403209/index.html">Como abrir seu banco na Europa: escolha um pa√≠s para a resid√™ncia Polybius</a></li>
<li><a href="../pt403213/index.html">Hobbies + neg√≥cios ou como se colocar no lugar de um cliente</a></li>
<li><a href="../pt403215/index.html">Voc√™ n√£o pode mais emprestar no Uber</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>