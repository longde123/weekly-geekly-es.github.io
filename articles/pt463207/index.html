<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üö£üèª üë©üèΩ‚ÄçüöÄ ü¶É Desenvolvimento Chatbot (telegrama + youtube) üë®üèæ‚Äçü§ù‚Äçüë®üèª ‚òÑÔ∏è üéä</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Por que ele apareceu aqui? 

 Recentemente, escrevi um artigo sobre desenvolvimento de php bot usando laravel + botman para telegrama. A primeira cois...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Desenvolvimento Chatbot (telegrama + youtube)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/463207/">  Por que ele apareceu aqui? <br><br>  Recentemente, escrevi um artigo sobre desenvolvimento de php bot usando laravel + botman para telegrama.  A primeira coisa que escrevi, cito, √© "atirar de um canh√£o em pardais".  Eu concordo com isso, eu at√© percebi isso durante o desenvolvimento, mas estava interessado em laravel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ly/rl/ce/lyrlcenybn_v6he3q2rsxgymiok.jpeg" alt="imagem"></div><a name="habracut"></a><br>  Agora, eu estava desenvolvendo um bot em php puro (sem correias) e a API de telegrama. Como existem muitos artigos sobre um t√≥pico semelhante, tocaremos um pouco na API do Google (API do YouTube).  Espero que voc√™ ache interessante e √∫til aprender sobre a API do youtube. <br><br>  Uma pequena digress√£o.  No momento, trabalho como programador front-end e trabalho com php apenas para meu pr√≥prio prazer (embora seja um prazer).  Pode haver erros est√∫pidos no lado do servidor, mas funciona e para mim, no momento do treinamento, isso √© suficiente. <br><br><h4>  Declara√ß√£o do problema </h4><br>  Uma noite, tive a ideia de conectar o bot e o youtube, na √©poca nem suspeitava da exist√™ncia do api google.  Requer um bot que, quando um novo v√≠deo for lan√ßado no canal do youtube, enviar√° uma notifica√ß√£o no meu bot. <br><br>  Em princ√≠pio, a funcionalidade √© bastante simples, mas como trabalhar com o youtube?  Acontece que o pr√≥prio Google tem uma solu√ß√£o para esse problema e seu nome √© API do Google.  Ele permite que voc√™ trabalhe com todos os aplicativos da empresa, mas eu estava interessado apenas no youtube. <br><br><h4>  Personaliza√ß√£o e Desenvolvimento </h4><br>  Aconteceu que durante o estudo da API do YouTube, foi encontrada uma solu√ß√£o elegante para o meu problema, que foi oferecida pela pr√≥pria documenta√ß√£o da API.  Mas primeiro sobre a API.  Para come√ßar a trabalhar com ele, voc√™ precisa ir ao console do Google e selecionar a op√ß√£o API necess√°ria.  Ap√≥s o qual o caminho est√° apenas na documenta√ß√£o ou no stackoverflow.  Devo dizer imediatamente que n√£o existe uma vers√£o russa da documenta√ß√£o, tamb√©m n√£o h√° li√ß√µes.  √â aconselh√°vel ter um conhecimento m√≠nimo do idioma ingl√™s ou agir digitando. <br><br>  Parece assim.  Voc√™ entra no console do Google, cria seu projeto e seleciona a API desejada. <br><br><img src="https://habrastorage.org/webt/p1/aa/8v/p1aa8vsd_gsk_kbhgtvzdzdpqso.png" alt="imagem"><br><br>  E agora para resolver o problema.  Ao ler a documenta√ß√£o, encontrei (o google me mostrou) o servi√ßo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">pubsubhubbub.appspot.com/subscribe,</a> que permite vincular o youtube e seu aplicativo.  Como isso funciona?  Ele trabalha com o princ√≠pio do webhook.  Voc√™ insere o youtube do canal que deseja ouvir e, a cada a√ß√£o no canal (adicionar v√≠deo, excluir, alterar), recebe dados para o seu script. <br><br><img src="https://habrastorage.org/webt/hl/tb/yg/hltbygpefguy9khw5huwwer9au8.png" alt="imagem"><br><br>  URL de retorno de chamada - um script que receber√° dados do google. <br>  URL do t√≥pico √© o canal que voc√™ deseja ouvir. <br><br>  Bem, o campo Modo permite que voc√™ escolha o que deseja, assine ou cancele a assinatura da escuta. <br><br>  Vamos come√ßar a escrever o c√≥digo, para come√ßar, vamos configurar nosso script para trabalhar com o youtube.  Eu escrevi tudo em um arquivo desde  foi um c√≥digo de teste +, realmente n√£o √© suficiente.  Depois de enviar uma solicita√ß√£o de inscri√ß√£o, √© necess√°rio confirm√°-la.  No Google, voc√™ pode encontrar a resposta no site favorito de todos, sugere um dos coment√°rios no stackoverflow. <br><br><pre><code class="php hljs">$video = <span class="hljs-string"><span class="hljs-string">"null"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'hub_challenge'</span></span>])) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $_REQUEST[<span class="hljs-string"><span class="hljs-string">'hub_challenge'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $video = parseYoutubeUpdate(file_get_contents(<span class="hljs-string"><span class="hljs-string">'php://input'</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parseYoutubeUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($data)</span></span></span><span class="hljs-function"> </span></span>{ $xml = simplexml_load_string($data, <span class="hljs-string"><span class="hljs-string">'SimpleXMLElement'</span></span>, LIBXML_NOCDATA); $video_id = substr((string)$xml-&gt;entry-&gt;id, <span class="hljs-number"><span class="hljs-number">9</span></span>); $channel_id = substr((string)$xml-&gt;entry-&gt;author-&gt;uri, <span class="hljs-number"><span class="hljs-number">32</span></span>); $published = (string)$xml-&gt;entry-&gt;published; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'video_id'</span></span>=&gt;$video_id, <span class="hljs-string"><span class="hljs-string">'channel_id'</span></span>=&gt;$channel_id, <span class="hljs-string"><span class="hljs-string">'published'</span></span>=&gt;$published ); }</code> </pre> <br>  Aqui, criamos por conveni√™ncia uma vari√°vel na qual precisaremos das informa√ß√µes sobre o v√≠deo.  As pr√≥ximas duas linhas permitem determinar se √© poss√≠vel confirmar a solicita√ß√£o do pubsubhubbub; se sim, confirme, se n√£o, significa que os dados vieram do youtube e precisamos process√°-los.  Na fun√ß√£o parseYoutubeUpdate, processamos a resposta, obtemos todas as informa√ß√µes necess√°rias. <br><br>  Aqui vale a pena digerir e contar sobre uma forma especial (na minha opini√£o, posso estar enganada) de dados usados ‚Äã‚Äãpelo youtube (para obter respostas), que √© chamada, como eu a entendo, √°tomo (n√£o deve ser confundido com o IDE ou este √© um xml regular ... houve pouca experi√™ncia com ele) .  Parece algo assim (um pequeno peda√ßo da resposta do youtube): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>yt:video:eE5mpblYpdY<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:videoId</span></span></span><span class="hljs-tag">&gt;</span></span>eE5mpblYpdY<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:videoId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:channelId</span></span></span><span class="hljs-tag">&gt;</span></span>UCGqKr3O5ub-O7zEKx_qeHUQ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">yt:channelId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>20b3560a49 1080<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alternate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://www.youtube.com/watch?v=hgCQ378xNus"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>not Epic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uri</span></span></span><span class="hljs-tag">&gt;</span></span>https://www.youtube.com/channel/UCGqKr3O5ub-O7zEKx_qeHUQ<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uri</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span>2019-07-14T05:10:49+00:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span>2019-07-14T05:11:07.600177664+00:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Voltar para parseYoutubeUpdate (). <br><br>  Em uma fun√ß√£o, convertemos a resposta no formato xml. <br>  Escrevemos os dados que precisamos nas vari√°veis. <br>  E ent√£o retornamos uma matriz com esses dados. <br><br>  Passamos ao telegrama.  Para come√ßar, quero dizer, √© muito mais f√°cil trabalhar do que com o botman.  Se voc√™ deseja desenvolver bots apenas para telegrama, n√£o use bibliotecas que permitam desenvolver bots para plataformas diferentes ....  n√£o faz sentido ... haver√° mais problemas.  A API do telegrama √© muito clara e simples, mesmo para um iniciante que acabou de conhecer o php e possui um conhecimento m√≠nimo de OOP. <br><br>  Ent√£o, mais perto do ponto, mais perto do c√≥digo.  Precisamos criar um bot e vincul√°-lo ao nosso script.  Espero que voc√™ possa criar um bot.  N√≥s escrevemos um token do bot e criamos uma solicita√ß√£o <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> TOKEN = <span class="hljs-string"><span class="hljs-string">"6826815*******Yme99*****9kjzgVi*****3S******"</span></span>; $url = <span class="hljs-string"><span class="hljs-string">'https://api.telegram.org/bot'</span></span> . TOKEN . <span class="hljs-string"><span class="hljs-string">'/sendMessage'</span></span>;</code> </pre><br>  Agora, precisamos enviar apenas uma solicita√ß√£o ao servidor de telegrama. <br><br><pre> <code class="php hljs">$params = [ <span class="hljs-string"><span class="hljs-string">'chat_id'</span></span> =&gt;<span class="hljs-number"><span class="hljs-number">712531723</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span> =&gt; $linkVideo, ]; $url = $url . <span class="hljs-string"><span class="hljs-string">'?'</span></span> . http_build_query($params);</code> </pre><br>  Criamos os par√¢metros necess√°rios, para mim √© um ID de bate-papo (se ele exibir um bot em produ√ß√£o, √© necess√°rio salvar todo o ID do banco de dados em spam) e uma mensagem de texto. <br><br>  Como voc√™ deve ter notado, passo o link como uma mensagem simples, n√£o como um v√≠deo.  Pelo que entendi, um telegrama transmite um v√≠deo apenas se for carregado no servidor, caso contr√°rio n√£o ... + Preciso ver uma imagem de visualiza√ß√£o do v√≠deo. <br><br>  Agora, nosso bot receber√° notifica√ß√µes de edi√ß√£o de sa√≠da / v√≠deo.  Parece algo como isto: <br><br><img src="https://habrastorage.org/webt/yg/18/72/yg1872yqamevvqavsgu7hpfo-oc.png" alt="imagem"><br><br>  Fim do jogo  Eu tenho tudo.  A maior desvantagem desse c√≥digo √© que ele est√° em um √∫nico arquivo, mas n√£o fazia sentido separar o c√≥digo de 10 linhas. <br><br>  Fontes - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">github</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt463207/">https://habr.com/ru/post/pt463207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt463193/index.html">Converta imagens em preto e branco em gr√°ficos ASCII usando decomposi√ß√£o de matriz n√£o negativa</a></li>
<li><a href="../pt463195/index.html">O que est√° acontecendo com a Internet Tele2</a></li>
<li><a href="../pt463197/index.html">Blazor + MVVM = Silverlight ataca porque o mal antigo √© invenc√≠vel</a></li>
<li><a href="../pt463203/index.html">O pesado fardo do tempo. Relat√≥rio Yandex sobre erros comuns no trabalho com o tempo</a></li>
<li><a href="../pt463205/index.html">Inicialmente inoperante: como sobreviver com um laptop no Windows 10 e uma unidade de 32 gigabytes</a></li>
<li><a href="../pt463213/index.html">Conceitos errados para desenvolvedores iniciantes em C #. Tentando responder a perguntas padr√£o</a></li>
<li><a href="../pt463215/index.html">Engenheiros e arquitetos j√° est√£o projetando assentamentos lunares</a></li>
<li><a href="../pt463221/index.html">Watching the Sun: 5 tipos de gadgets, de US $ 5 a US $ 5.000</a></li>
<li><a href="../pt463223/index.html">O resumo de materiais interessantes para o desenvolvedor m√≥vel n¬∫ 310 (de 5 a 11 de agosto)</a></li>
<li><a href="../pt463225/index.html">Empresa WiFi. FreeRadius + FreeIPA + Ubiquiti</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>