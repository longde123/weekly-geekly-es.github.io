<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸï¸ ğŸ˜” ğŸ¦— ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ é…ç½®ï¼Œç¬¬6ç«  ğŸ‘©â€âš•ï¸ ğŸ‘ ğŸ”´</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="è¿”å› ä¸‹ä¸€ä¸ª 


 åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å½±å“pytestçš„é…ç½®æ–‡ä»¶ï¼Œè®¨è®ºpytestå¦‚ä½•åŸºäºå®ƒä»¬æ›´æ”¹å…¶è¡Œä¸ºï¼Œä»¥åŠå¯¹Tasksé¡¹ç›®çš„é…ç½®ä»»åŠ¡è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚ 





 æœ¬ä¹¦ä¸­çš„ç¤ºä¾‹æ˜¯ä½¿ç”¨Python 3.6å’Œpytest 3.2ç¼–å†™çš„ã€‚ pytest 3.2æ”¯æŒPython 2.6ã€2.7å’ŒPyt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ é…ç½®ï¼Œç¬¬6ç« </h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448796/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿”å›</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‹ä¸€ä¸ª</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶å½±å“pytestçš„é…ç½®æ–‡ä»¶ï¼Œè®¨è®ºpytestå¦‚ä½•åŸºäºå®ƒä»¬æ›´æ”¹å…¶è¡Œä¸ºï¼Œä»¥åŠå¯¹Tasksé¡¹ç›®çš„é…ç½®ä»»åŠ¡è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><p> æœ¬ä¹¦ä¸­çš„ç¤ºä¾‹æ˜¯ä½¿ç”¨Python 3.6å’Œpytest 3.2ç¼–å†™çš„ã€‚  pytest 3.2æ”¯æŒPython 2.6ã€2.7å’ŒPython 3.3+ã€‚ </p><br><blockquote>æœ¬ä¹¦ç½‘é¡µä¸Šçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">é“¾æ¥</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a>ä¸Šæä¾›äº†Tasksé¡¹ç›®ä»¥åŠæœ¬ä¹¦ä¸­æ˜¾ç¤ºçš„æ‰€æœ‰æµ‹è¯•çš„æºä»£ç ã€‚ æ‚¨æ— éœ€ä¸‹è½½æºä»£ç å³å¯äº†è§£æµ‹è¯•ä»£ç ã€‚ ç¤ºä¾‹ä¸­ä»¥æ–¹ä¾¿çš„å½¢å¼æä¾›äº†æµ‹è¯•ä»£ç ã€‚ ä½†æ˜¯ï¼Œä¸ºäº†è·Ÿä¸Šé¡¹ç›®çš„ä»»åŠ¡ï¼Œæˆ–è€…æ”¹ç¼–æµ‹è¯•ç¤ºä¾‹æ¥æµ‹è¯•è‡ªå·±çš„é¡¹ç›®ï¼ˆä¸è´¹åŠ›æ°”ï¼ï¼‰ï¼Œæ‚¨å¿…é¡»è½¬åˆ°æœ¬ä¹¦çš„ç½‘é¡µå¹¶ä¸‹è½½å·¥ä½œã€‚ åœ¨è¯¥ä¹¦çš„ç½‘é¡µä¸Šï¼Œæœ‰ä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://pragprog.com/titles/bopytest/errata">å‹˜è¯¯</a>ä¿¡æ¯é“¾æ¥å’Œä¸€ä¸ª<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=" title="https://forums.pragprog.com/forums/438">è®ºå›</a> ã€‚ </blockquote><p> åœ¨å‰§é€ä¸‹æ–¹æ˜¯è¯¥ç³»åˆ—æ–‡ç« çš„åˆ—è¡¨ã€‚ </p><br><div class="spoiler">  <b class="spoiler_title">ç›®å½•</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>å¼•è¨€</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬1ç« ï¼špytestå…¥é—¨</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬2ç« ï¼šç¼–å†™æµ‹è¯•å‡½æ•°</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬3ç« ï¼šPytestå›ºå®šè£…ç½®</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬4ç« ï¼šå†…ç½®ç¯å…·</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬5ç« ï¼šæ’ä»¶</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬6ç« ï¼šé…ç½®</strong></a> ï¼ˆæœ¬æ–‡ï¼‰ </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><strong>ç¬¬7ç« ï¼šä¸å…¶ä»–å·¥å…·ä¸€èµ·ä½¿ç”¨pytest</strong></a> </li></ul></div></div><br><h2 id="konfiguraciya"> æ„å‹ </h2><br><p> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨æœ¬ä¹¦ä¸­ï¼Œæˆ‘å·²ç»è®¨è®ºäº†å„ç§ä¸»è¦å½±å“pytestçš„éæµ‹è¯•æ–‡ä»¶ï¼Œé™¤äº†conftest.pyä¾‹å¤–ï¼Œæˆ‘åœ¨ç¬¬95é¡µçš„ç¬¬5ç« æ’ä»¶ä¸­å¯¹æ­¤è¿›è¡Œäº†è¯¦ç»†ä»‹ç»ã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»é…ç½®æ–‡ä»¶ï¼Œå½±å“pytestçš„å†…å®¹ï¼Œè®¨è®ºpytestå¦‚ä½•åŸºäºå®ƒä»¬æ›´æ”¹å…¶è¡Œä¸ºï¼Œå¹¶å¯¹Tasksé¡¹ç›®é…ç½®æ–‡ä»¶è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚ </p><br><h2 id="ponimanie-faylov-konfiguracii-pytest"> äº†è§£pytesté…ç½®æ–‡ä»¶ </h2><br><p> åœ¨æˆ‘å‘Šè¯‰æ‚¨å¦‚ä½•æ›´æ”¹pytestä¸­çš„é»˜è®¤è¡Œä¸ºä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹pytestä¸­çš„æ‰€æœ‰éæµ‹è¯•æ–‡ä»¶ï¼Œå°¤å…¶æ˜¯è°åº”è¯¥ç…§é¡¾å®ƒä»¬ã€‚ </p><br><p> æ‚¨åº”è¯¥äº†è§£ä»¥ä¸‹å†…å®¹ï¼š </p><br><ul><li> <em>pytest.ini</em> ï¼šè¿™æ˜¯ä¸»è¦çš„Pytesté…ç½®æ–‡ä»¶ï¼Œå…è®¸æ‚¨æ›´æ”¹é»˜è®¤è¡Œä¸ºã€‚ ç”±äºæ‚¨å¯ä»¥è¿›è¡Œå¾ˆå¤šé…ç½®æ›´æ”¹ï¼Œå› æ­¤æœ¬ç« çš„å¤§éƒ¨åˆ†å†…å®¹ä¸“é—¨ä»‹ç»æ‚¨å¯ä»¥åœ¨<code>pytest.ini</code>è¿›è¡Œçš„è®¾ç½®ã€‚ </li><li>  <em>conftest.py</em> ï¼šè¿™æ˜¯ä¸€ä¸ªæœ¬åœ°æ’ä»¶ï¼Œå…è®¸å°†é’©å­å‡½æ•°å’Œè£…ç½®è¿æ¥åˆ°<code>conftest.py</code>æ–‡ä»¶åŠå…¶æ‰€æœ‰å­ç›®å½•æ‰€åœ¨çš„ç›®å½•ã€‚  <code>conftest.py</code>æ–‡ä»¶åœ¨ç¬¬95é¡µç¬¬5ç« â€œæ’ä»¶â€ä¸­è¿›è¡Œäº†æè¿°ã€‚ </li><li>  <em><code>__init__.py</code></em> ï¼šæ”¾ç½®åœ¨æ¯ä¸ªæµ‹è¯•å­ç›®å½•ä¸­æ—¶ï¼Œæ­¤æ–‡ä»¶ä½¿æ‚¨å¯ä»¥åœ¨å¤šä¸ªæµ‹è¯•ç›®å½•ä¸­ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•æ–‡ä»¶åã€‚ æˆ‘ä»¬å°†åœ¨ç¬¬120é¡µä¸Šçš„æ–‡ç« â€œé¿å…æ–‡ä»¶åå†²çªâ€ä¸­æŸ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œè¯¥ç¤ºä¾‹åœ¨æµ‹è¯•ç›®å½•ä¸­æ²¡æœ‰<code>__init__.py</code>æ–‡ä»¶çš„æƒ…å†µä¸‹ä¼šå‡ºç°é—®é¢˜ã€‚ </li></ul><br><p> å¦‚æœæ‚¨ä½¿ç”¨æ¯’ç´ ï¼Œæ‚¨å°†å¯¹ä»¥ä¸‹å†…å®¹æ„Ÿå…´è¶£ï¼š </p><br><ul><li>  <em>tox.ini</em> ï¼šæ­¤æ–‡ä»¶ç±»ä¼¼äº<code>pytest.ini</code> ï¼Œä½†ç”¨äº<code>tox</code> ã€‚ ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥å°†<code>pytest</code>é…ç½®<code>pytest</code>è€Œä¸æ˜¯åŒæ—¶æ‹¥æœ‰<code>tox.ini</code>æ–‡ä»¶å’Œ<code>pytest.ini</code>æ–‡ä»¶ï¼Œä»è€Œä¸ºæ‚¨èŠ‚çœä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚ ç¬¬125é¡µç¬¬7ç« â€œä¸å…¶ä»–å·¥å…·ä¸€èµ·ä½¿ç”¨pytestâ€ä¸­è®¨è®ºäº†Toxã€‚ </li></ul><br><p> å¦‚æœæ‚¨è¦åˆ†å‘Pythonè½¯ä»¶åŒ…ï¼ˆä¾‹å¦‚Tasksï¼‰ï¼Œåˆ™éœ€è¦å…³æ³¨æ­¤æ–‡ä»¶ï¼š </p><br><ul><li>  <em>setup.cfg</em> ï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªä¼šå½±å“<code>setup.py</code>è¡Œä¸ºçš„INIæ–‡ä»¶ã€‚ æ‚¨å¯ä»¥åœ¨<code>setup.py</code>æ·»åŠ å‡ è¡Œä»¥è¿è¡Œ<code>python setup.py test</code>å¹¶è¿è¡Œæ‰€æœ‰pytestæµ‹è¯•ã€‚ å¦‚æœæ‚¨æ­£åœ¨åˆ†å‘è½¯ä»¶åŒ…ï¼Œåˆ™å¯èƒ½å·²ç»æœ‰äº†<code>setup.cfg</code>æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–‡ä»¶å­˜å‚¨Pytesté…ç½®ã€‚ æ‚¨å°†åœ¨ç¬¬175é¡µçš„é™„å½•4â€œæ‰“åŒ…å’Œåˆ†å‘Pythoné¡¹ç›®â€ä¸­çœ‹åˆ°å¦‚ä½•å®Œæˆæ­¤æ“ä½œã€‚ </li></ul><br><p> æ— è®ºæ‚¨å°†pytesté…ç½®æ”¾å…¥å“ªä¸ªæ–‡ä»¶ï¼Œæ ¼å¼éƒ½åŸºæœ¬ç›¸åŒã€‚ </p><br><p> å¯¹äº<code>pytest.ini</code> ï¼š </p><br><blockquote>  <strong>ch6 /æ ¼å¼/ pytest.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p> å¯¹äº<code>tox.ini</code> ï¼š </p><br><blockquote>  <strong>ch6 /æ ¼å¼/ tox.ini</strong> </blockquote><br><pre> <code class="plaintext hljs">... tox specific stuff ... [pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p> å¯¹äº<code>setup.cfg</code> ï¼š </p><br><blockquote>  <strong>ch6 /æ ¼å¼/ setup.cfg</strong> </blockquote><br><pre> <code class="plaintext hljs">... packaging specific stuff ... [tool:pytest] addopts = -rsxX -l --tb=short --strict xfail_strict = true ... more options ...</code> </pre> <br><p> å”¯ä¸€çš„åŒºåˆ«æ˜¯setup.cfgçš„èŠ‚å¤´æ˜¯<code>[tool:pytest]</code>è€Œä¸æ˜¯<code>[pytest]</code> ã€‚ </p><br><h3 id="list-the-valid-ini-file-options-with-pytest-help"> ä½¿ç”¨pytest â€“helpåˆ—å‡ºæœ‰æ•ˆçš„iniæ–‡ä»¶é€‰é¡¹ </h3><br><p> æ‚¨å¯ä»¥ä»<code>pytest --help</code>è·å–<code>pytest.ini</code>çš„æ‰€æœ‰æœ‰æ•ˆå‚æ•°çš„åˆ—è¡¨ï¼š </p><br><pre> <code class="plaintext hljs">$ pytest --help ... [pytest] ini-options in the first pytest.ini|tox.ini|setup.cfg file found: markers (linelist) markers for test functions empty_parameter_set_mark (string) default marker for empty parametersets norecursedirs (args) directory patterns to avoid for recursion testpaths (args) directories to search for tests when no files or directories are given in the command line. console_output_style (string) console output: classic or with additional progress information (classic|progress). usefixtures (args) list of default fixtures to be used with this project python_files (args) glob-style file patterns for Python test module discovery python_classes (args) prefixes or glob names for Python test class discovery python_functions (args) prefixes or glob names for Python test function and method discovery xfail_strict (bool) default for the strict parameter of xfail markers when not given explicitly (default: False) junit_suite_name (string) Test suite name for JUnit report junit_logging (string) Write captured log messages to JUnit report: one of no|system-out|system-err doctest_optionflags (args) option flags for doctests doctest_encoding (string) encoding used for doctest files cache_dir (string) cache directory path. filterwarnings (linelist) Each line specifies a pattern for warnings.filterwarnings. Processed after -W and --pythonwarnings. log_print (bool) default value for --no-print-logs log_level (string) default value for --log-level log_format (string) default value for --log-format log_date_format (string) default value for --log-date-format log_cli (bool) enable log display during test run (also known as "live logging"). log_cli_level (string) default value for --log-cli-level log_cli_format (string) default value for --log-cli-format log_cli_date_format (string) default value for --log-cli-date-format log_file (string) default value for --log-file log_file_level (string) default value for --log-file-level log_file_format (string) default value for --log-file-format log_file_date_format (string) default value for --log-file-date-format addopts (args) extra command line options minversion (string) minimally required pytest version xvfb_width (string) Width of the Xvfb display xvfb_height (string) Height of the Xvfb display xvfb_colordepth (string) Color depth of the Xvfb display xvfb_args (args) Additional arguments for Xvfb xvfb_xauth (bool) Generate an Xauthority token for Xvfb. Needs xauth. ...</code> </pre> <br><p> é™¤äº†<code>doctest_optionflags</code> ï¼ˆåœ¨ç¬¬125é¡µçš„ç¬¬7ç« â€œå°†pytestä¸å…¶ä»–å·¥å…·ä¸€èµ·ä½¿ç”¨â€ä¸­è®¨è®ºï¼‰å¤–ï¼Œæ‚¨å°†åœ¨æœ¬ç« ä¸­çœ‹åˆ°æ‰€æœ‰è¿™äº›è®¾ç½®ã€‚ </p><br><h3 id="plaginy-mogut-dobavlyat-opcii-ini-faylov"> æ’ä»¶å¯ä»¥æ·»åŠ iniæ–‡ä»¶é€‰é¡¹ </h3><br><p> å…ˆå‰çš„è®¾ç½®åˆ—è¡¨ä¸æ˜¯å¸¸æ•°ã€‚ å¯¹äºæ’ä»¶ï¼ˆå’Œconftest.pyæ–‡ä»¶ï¼‰ï¼Œå¯ä»¥æ·»åŠ iniæ–‡ä»¶é€‰é¡¹ã€‚ æ·»åŠ çš„é€‰é¡¹ä¹Ÿå°†æ·»åŠ åˆ°pytest --helpå‘½ä»¤çš„è¾“å‡ºä¸­ã€‚ <br> ç°åœ¨ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨æ ¸å¿ƒpytestä¸­å¯ç”¨çš„.iniæ–‡ä»¶çš„å†…ç½®è®¾ç½®å¯ä»¥è¿›è¡Œçš„ä¸€äº›é…ç½®æ›´æ”¹ã€‚ </p><br><h3 id="izmenenie-parametrov-komandnoy-stroki-po-umolchaniyu"> æ›´æ”¹é»˜è®¤å‘½ä»¤è¡Œé€‰é¡¹ </h3><br><p> æ‚¨å·²ç»ä¸º<em>pytest</em>ä½¿ç”¨äº†ä¸€äº›å‘½ä»¤è¡Œé€‰é¡¹ï¼Œä¾‹å¦‚<code>-v/--verbose</code>ç”¨äºè¯¦ç»†è¾“å‡º<code>-l/--showlocals</code>æ¥æŸ¥çœ‹å¸¦æœ‰å †æ ˆè·Ÿè¸ªçš„å±€éƒ¨å˜é‡ä»¥è¿›è¡Œå¤±è´¥çš„æµ‹è¯•ã€‚ æ‚¨å¯èƒ½ä¼šå‘ç°ï¼Œ <code>themâ€”for a project</code> ï¼Œæ‚¨å§‹ç»ˆä¼šä½¿ç”¨å…¶ä¸­ä¸€äº›<code>optionsâ€”or</code>æ›´å–œæ¬¢ä½¿ç”¨<code>themâ€”for a project</code> ã€‚ å¦‚æœåœ¨<code>pytest.ini</code>å®‰è£…äº†<code>pytest.ini</code>ä½œä¸ºæ‰€éœ€çš„å‚æ•°ï¼Œåˆ™æ— éœ€å†è¾“å…¥å®ƒä»¬ã€‚ è¿™æ˜¯æˆ‘å–œæ¬¢çš„ä¸€å¥—ï¼š </p><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict</code> </pre> <br><p>  <code>-rsxX</code>å…è®¸pytestæŠ¥å‘Šæ‰€æœ‰<code>skipped</code> ï¼Œ <code>xfailed</code>æˆ–<code>xpassed</code>æµ‹è¯•çš„åŸå› ã€‚  <code>-l</code>å¼€å…³å…è®¸pyteståœ¨æ¯æ¬¡å¤±è´¥çš„æƒ…å†µä¸‹æ˜¾ç¤ºå±€éƒ¨å˜é‡çš„å †æ ˆè·Ÿè¸ªã€‚  <code>--tb=short</code>å°†åˆ é™¤å¤§éƒ¨åˆ†å †æ ˆè·Ÿè¸ªã€‚ ä½†æ˜¯ï¼Œå®ƒå°†ä¿ç•™æ–‡ä»¶å’Œè¡Œå·ã€‚ å¦‚æœæœªåœ¨é…ç½®æ–‡ä»¶ä¸­æ³¨å†Œä»¤ç‰Œï¼Œåˆ™<code>--strict</code>ç¦æ­¢ä½¿ç”¨ä»¤ç‰Œã€‚ æ‚¨å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­çœ‹åˆ°å¦‚ä½•æ‰§è¡Œæ­¤æ“ä½œã€‚ </p><br><h3 id="registraciya-markerov-chtoby-izbezhat-opechatok-markera"> æ ‡è®°æ³¨å†Œï¼Œé¿å…æ ‡è®°è¾“å…¥é”™è¯¯ </h3><br><p> è‡ªå®šä¹‰æ ‡è®°ï¼ˆå¦‚ç¬¬31é¡µçš„â€œæ ‡è®°æµ‹è¯•åŠŸèƒ½â€ä¸­æ‰€è¿°ï¼‰éå¸¸é€‚åˆè®©æ‚¨æ ‡è®°è¦ä½¿ç”¨ç‰¹å®šæ ‡è®°è¿è¡Œçš„æµ‹è¯•å­é›†ã€‚ ä½†æ˜¯ï¼Œåœ¨æ ‡è®°ä¸­çŠ¯é”™è¯¯å¤ªå®¹æ˜“äº†ï¼Œæœ€ç»ˆæœ‰äº›æµ‹è¯•è¢«æ ‡è®°ä¸º<code>@pytest.mark.smoke</code> ï¼Œæœ‰äº›è¢«æ ‡è®°ä¸º<code>@pytest.mark.somke</code> ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯é”™è¯¯ã€‚  pyteståªæ˜¯è®¤ä¸ºæ‚¨åˆ›å»ºäº†ä¸¤ä¸ªæ ‡è®°ã€‚ ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡åœ¨pytest.iniä¸­æ³¨å†Œä»¤ç‰Œæ¥è§£å†³æ­¤é—®é¢˜ï¼Œä¾‹å¦‚ï¼š </p><br><pre> <code class="plaintext hljs">[pytest] ... markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get() ...</code> </pre> <br><p> é€šè¿‡æ³¨å†Œè¿™äº›æ ‡è®°ï¼Œæ‚¨ç°åœ¨è¿˜å¯ä»¥ä½¿ç”¨<code>pytest --markers</code>ä»¥åŠå®ƒä»¬çš„æè¿°æ¥æŸ¥çœ‹å®ƒä»¬ï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --markers @pytest.mark.smoke: Run the smoke test test functions @pytest.mark.get: Run the test functions that test tasks.get() @pytest.mark.skip(reason=None): skip the ... ...</code> </pre> <br><p> å¦‚æœæœªæ³¨å†Œæ ‡è®°ï¼Œåˆ™å®ƒä»¬ä¸ä¼šå‡ºç°åœ¨<code>--markers</code>åˆ—è¡¨ä¸­ã€‚ æ³¨å†Œå®ƒä»¬æ—¶ï¼Œå°†åˆ—å‡ºå®ƒä»¬ï¼Œå¦‚æœä½¿ç”¨<code>--strict</code> ï¼Œåˆ™ä»»ä½•å¸¦æœ‰é”™è¯¯æˆ–æœªæ³¨å†Œçš„ä»¤ç‰Œéƒ½å°†æ˜¾ç¤ºä¸ºé”™è¯¯ã€‚  <code>ch6/a/tasks_proj</code>å’Œ<code>ch6/b/tasks_proj</code>ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯pytest.iniæ–‡ä»¶çš„å†…å®¹ã€‚ åœ¨<code>ch6/a</code>ç©ºã€‚ è®©æˆ‘ä»¬å°è¯•åœ¨ä¸æ³¨å†Œä»»ä½•æ ‡è®°çš„æƒ…å†µä¸‹è¿è¡Œæµ‹è¯•ï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/a/tasks_proj/tests $ pytest --strict --tb=line ============================= test session starts ============================= collected 45 items / 2 errors =================================== ERRORS ==================================== ______________________ ERROR collecting func/test_add.py ______________________ 'smoke' not a registered marker ________________ ERROR collecting func/test_api_exceptions.py _________________ 'smoke' not a registered marker !!!!!!!!!!!!!!!!!!! Interrupted: 2 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 2 error in 1.10 seconds ===========================</code> </pre> <br><p> å¦‚æœæ‚¨åœ¨<code>pytest.ini</code>ä½¿ç”¨æ ‡è®°æ¥æ³¨å†Œæ ‡è®°ï¼Œåˆ™<code>pytest.ini</code>åœ¨ä½¿ç”¨æ—¶åœ¨<code>pytest.ini</code>ä¸­æ·»åŠ <code>--strict</code> ã€‚ å¾…ä¼šå„¿æˆ‘ä¼šè°¢è°¢ä½ çš„ã€‚ è®©æˆ‘ä»¬ç»§ç»­å¹¶å°†pytest.iniæ–‡ä»¶æ·»åŠ åˆ°ä»»åŠ¡é¡¹ç›®ï¼š </p><br><p> å¦‚æœæ‚¨åœ¨<code>pytest.ini</code>ä½¿ç”¨æ ‡è®°æ¥æ³¨å†Œæ ‡è®°ï¼Œåˆ™è¿˜å¯ä»¥åœ¨<code>addopts</code>æ·»åŠ <code>--strict</code> ã€‚ æ‚¨ç¨åä¼šæ„Ÿè°¢æˆ‘ã€‚ è®©æˆ‘ä»¬ç»§ç»­å¹¶å°†pytest.iniæ–‡ä»¶æ·»åŠ åˆ°ä»»åŠ¡é¡¹ç›®ä¸­ï¼š </p><br><p> å¦‚æœæ‚¨åœ¨<code>pytest.ini</code>ä½¿ç”¨ä»¤ç‰Œæ³¨å†Œä»¤ç‰Œï¼Œåˆ™è¿˜å¯ä»¥ä½¿ç”¨<code>addopts</code>å°†<code>--strict</code>æ·»åŠ åˆ°ç°æœ‰<code>addopts</code> ã€‚ é…·å—ï¼Ÿ  <code>pytest.ini</code>æ„Ÿè°¢ï¼Œå¹¶å°†<code>pytest.ini</code>æ–‡ä»¶æ·»åŠ åˆ°<code>tasks</code>é¡¹ç›®ï¼š </p><br><blockquote>  ch6 / b / task_proj /æµ‹è¯•/ pytest.ini </blockquote><br><pre> <code class="plaintext hljs">[pytest] addopts = -rsxX -l --tb=short --strict markers = smoke: Run the smoke test test functions get: Run the test functions that test tasks.get()</code> </pre> <br><p> è¿™æ˜¯é»˜è®¤æƒ…å†µä¸‹é¦–é€‰çš„æ ‡å¿—ç»„åˆï¼š </p><br><ul><li>  <code>-rsxX</code>è·³è¿‡ï¼Œxfailedæˆ–xpassçš„æµ‹è¯•ï¼Œ </li><li>  <code>--tb = short</code>ç”¨äºæ›´çŸ­åœ°è·Ÿè¸ªæ•…éšœï¼Œ </li><li>  <code>--strict</code>åªå…è®¸å£°æ˜çš„ä»¤ç‰Œã€‚ <br> ä»¥åŠè¯¥é¡¹ç›®çš„æ ‡è®°åˆ—è¡¨ã€‚ </li></ul><br><p> è¿™åº”è¯¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿè¿›è¡Œæµ‹è¯•ï¼ŒåŒ…æ‹¬çƒŸé›¾æµ‹è¯•ï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/b/tasks_proj/tests $ pytest --strict -m smoke ===================== test session starts ====================== collected 57 items func/test_add.py . func/test_api_exceptions.py .. ===================== 54 tests deselected ====================== =========== 3 passed, 54 deselected in 0.06 seconds ============</code> </pre> <br><h3 id="trebovanie-minimalnoy-versii-pytest"> æœ€ä½Pytestè¦æ±‚ </h3><br><p> ä½¿ç”¨<code>minversion</code>å‚æ•°å¯ä»¥æŒ‡å®šæµ‹è¯•æ‰€éœ€çš„æœ€ä½pytestç‰ˆæœ¬ã€‚ ä¾‹å¦‚ï¼Œæˆ‘æ‰“ç®—åœ¨æµ‹è¯•æµ®ç‚¹æ•°æ—¶ä½¿ç”¨<code>approx()</code>æ¥ç¡®å®šæµ‹è¯•ä¸­çš„â€œç›¸å½“æ¥è¿‘â€çš„ç›¸ç­‰æ€§ã€‚ ä½†æ˜¯ç›´åˆ°ç‰ˆæœ¬3.0æ‰åœ¨pytestä¸­å¼•å…¥æ­¤åŠŸèƒ½ã€‚ ä¸ºé¿å…æ··æ·†ï¼Œæˆ‘å‘ä½¿ç”¨<code>approx()</code>é¡¹ç›®æ·»åŠ äº†ä»¥ä¸‹å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">[pytest] minversion = 3.0</code> </pre> <br><p> å› æ­¤ï¼Œå¦‚æœæœ‰äººå°è¯•ä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„pytestè¿è¡Œæµ‹è¯•ï¼Œåˆ™ä¼šå‡ºç°é”™è¯¯æ¶ˆæ¯ã€‚ </p><br><h3 id="ostanovka-pytest-ot-poiska-v-nepravilnyh-mestah"> åœæ­¢pyteståœ¨é”™è¯¯çš„åœ°æ–¹æœç´¢ </h3><br><p> æ‚¨æ˜¯å¦çŸ¥é“â€œé€’å½’â€çš„å®šä¹‰ä¹‹ä¸€æ˜¯åœ¨è‡ªå·±çš„ä»£ç ä¸­å®£èª“ä¸¤æ¬¡ï¼Ÿ å¥½å§ï¼Œä¸ã€‚ å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€è¦è€ƒè™‘å­ç›®å½•ã€‚  pytestå°†é€šè¿‡é€’å½’æ£€æŸ¥ä¸€å †ç›®å½•æ¥å¯ç”¨æµ‹è¯•æ£€æµ‹ã€‚ ä½†æ˜¯æœ‰äº›ç›®å½•è¦ä»pytestä¸­æ’é™¤ã€‚ </p><br><p>  <code>norecurse</code>çš„é»˜è®¤å€¼ä¸º<code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code> <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>  <code>'. * Build dist CVS _darcs {arch} and *.egg. Having '.*'</code>æ˜¯å‘½åè™šæ‹Ÿç¯å¢ƒâ€œ .venvâ€çš„ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±ï¼Œå› ä¸ºæ‰€æœ‰ä»¥ç‚¹å¼€å¤´çš„ç›®å½•éƒ½å°†ä¸å¯è§ã€‚ </p><br><p> å¯¹äºTasksé¡¹ç›®ï¼Œ <code>src</code>å¯ä»¥è½»æ¾æŒ‡å®šï¼Œå› ä¸ºä½¿ç”¨pytestæœç´¢æµ‹è¯•æ–‡ä»¶å°†æµªè´¹æ—¶é—´ã€‚ </p><br><pre> <code class="plaintext hljs">[pytest] norecursedirs = .* venv src *.egg dist build</code> </pre> <br><p> å½“è¦†ç›–å·²ç»å…·æœ‰æœ‰ç”¨å€¼çš„å‚æ•°ï¼ˆä¾‹å¦‚è¯¥å‚æ•°ï¼‰æ—¶ï¼Œäº†è§£é»˜è®¤å€¼å¹¶è¿”å›æ‰€éœ€çš„å€¼éå¸¸æœ‰ç”¨ï¼Œå°±åƒæˆ‘åœ¨ä¸Šä¸€ä¸ªä»£ç ä¸­ä½¿ç”¨<code>*.egg dist build</code>æ‰€åšçš„é‚£æ ·ã€‚ <br>  <code>norecursedirs</code>æ˜¯æµ‹è¯•è·¯å¾„çš„ä¸€ç§ç»“æœï¼Œå› æ­¤è®©æˆ‘ä»¬ç¨åçœ‹ä¸€ä¸‹ã€‚ </p><br><h3 id="specifikaciya-dereva-testovogo-kataloga"> æµ‹è¯•ç›®å½•æ ‘è§„èŒƒ </h3><br><p> è™½ç„¶<code>norecursedirs</code>å‘Šè¯‰pytestçœ‹å“ªé‡Œï¼Œè€Œ<code>testpaths</code>å‘Šè¯‰pytestçœ‹å“ªé‡Œã€‚  <code>testspaths</code>æ˜¯ç›¸å¯¹äºç”¨äºæŸ¥æ‰¾æµ‹è¯•çš„æ ¹ç›®å½•çš„ç›®å½•åˆ—è¡¨ã€‚ ä»…å½“æœªå°†ç›®å½•ï¼Œæ–‡ä»¶æˆ–<code>nodeid</code>æŒ‡å®šä¸ºå‚æ•°æ—¶æ‰ä½¿ç”¨å®ƒã€‚ </p><br><p> å‡è®¾å¯¹äº<code>Tasks</code>é¡¹ç›®ï¼Œæˆ‘ä»¬å°†<code>pytest.ini</code>åœ¨<code>tasks_proj</code>ç›®å½•ä¸­è€Œä¸æ˜¯æµ‹è¯•ä¸­ï¼š </p><br><pre> <code class="plaintext hljs">\code\tasks_proj&gt;tree/f . â”‚ pytest.ini â”‚ â”œâ”€â”€â”€src â”‚ â””â”€â”€â”€tasks â”‚ api.py â”‚ ... â”‚ â””â”€â”€â”€tests â”‚ conftest.py â”‚ pytest.ini â”‚ â”œâ”€â”€â”€func â”‚ test_add.py â”‚ ... â”‚ â”œâ”€â”€â”€unit â”‚ test_task.py â”‚ __init__.py â”‚ ...</code> </pre> <br><p> ç„¶åå°†æµ‹è¯•æ”¾åœ¨æµ‹è¯•<code>testpaths</code>å¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ï¼š </p><br><pre> <code class="plaintext hljs">[pytest] testpaths = tests</code> </pre> <br><p> ç°åœ¨ï¼Œå¦‚æœæ‚¨ä»<code>tasks_proj</code>ç›®å½•è¿è¡Œpytestï¼Œpytestå°†ä»…åœ¨<code>tasks_proj/tests</code>æœç´¢ã€‚ è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œåœ¨æµ‹è¯•çš„å¼€å‘å’Œè°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ç»å¸¸éå†æµ‹è¯•ç›®å½•ï¼Œå› æ­¤æ— éœ€æŒ‡å®šå®Œæ•´è·¯å¾„å³å¯è½»æ¾æµ‹è¯•å­ç›®å½•æˆ–æ–‡ä»¶ã€‚ å› æ­¤ï¼Œæ­¤é€‰é¡¹å¯¹äº¤äº’å¼æµ‹è¯•æœ‰ä¸€å®šå¸®åŠ©ã€‚ </p><br><p> ä½†æ˜¯ï¼Œè¿™å¯¹äºä»è¿ç»­é›†æˆæœåŠ¡å™¨æˆ–Toxè¿è¡Œçš„æµ‹è¯•éå¸¸æœ‰ç”¨ã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ‚¨çŸ¥é“æ ¹ç›®å½•å°†æ˜¯å›ºå®šçš„ï¼Œå¹¶ä¸”å¯ä»¥åˆ—å‡ºç›¸å¯¹äºè¯¥å›ºå®šæ ¹ç›®å½•çš„ç›®å½•ã€‚ åœ¨æ‚¨ç¡®å®å¸Œæœ›å‡å°‘æµ‹è¯•æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‘†è„±å¯¹æµ‹è¯•çš„æœç´¢æ˜¯ä¸€ä»¶å¾ˆä¸é”™çš„äº‹æƒ…ã€‚ </p><br><p> ä¹ä¸€çœ‹ï¼ŒåŒæ—¶ä½¿ç”¨æµ‹è¯•è·¯å¾„å’Œ<code>norecursedirs</code>ä¼¼ä¹å¾ˆæ„šè ¢ã€‚ ä½†æ˜¯ï¼Œæ­£å¦‚æ‚¨å·²ç»çœ‹åˆ°çš„ï¼Œæµ‹è¯•è·¯å¾„åœ¨æ–‡ä»¶ç³»ç»Ÿä¸åŒéƒ¨åˆ†çš„äº¤äº’å¼æµ‹è¯•ä¸­å‡ ä¹æ²¡æœ‰å¸®åŠ©ã€‚ åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæ— <code>norecursedirs</code>å¯èƒ½ä¼šæœ‰æ‰€å¸®åŠ©ã€‚ å¦å¤–ï¼Œå¦‚æœæ‚¨çš„æµ‹è¯•ç›®å½•ä¸åŒ…å«æµ‹è¯•ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>norecursedirs</code>æ¥é¿å…ä½¿ç”¨å®ƒä»¬ã€‚ ä½†æ˜¯å®é™…ä¸Šï¼Œå°†å¤šä½™çš„ç›®å½•æ”¾åœ¨æ²¡æœ‰æµ‹è¯•çš„æµ‹è¯•ä¸­æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ </p><br><h2 id="izmenenie-pravil-obnaruzheniya-testov"> æ›´æ”¹æµ‹è¯•æ£€æµ‹è§„åˆ™ </h2><br><p>  pytestæ ¹æ®ç‰¹å®šçš„æµ‹è¯•å‘ç°è§„åˆ™æŸ¥æ‰¾è¦è¿è¡Œçš„æµ‹è¯•ã€‚ æ ‡å‡†æµ‹è¯•æ£€æµ‹è§„åˆ™ï¼š </p><br><p>  â€¢ä»ä¸€ä¸ªæˆ–å¤šä¸ªç›®å½•å¼€å§‹ã€‚ æ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸ŠæŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•çš„åç§°ã€‚ å¦‚æœæ‚¨æœªæŒ‡å®šä»»ä½•å†…å®¹ï¼Œåˆ™ä½¿ç”¨å½“å‰ç›®å½•ã€‚ <br>  â€¢åœ¨ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ä¸­æœç´¢æµ‹è¯•æ¨¡å—ã€‚ <br>  â€¢æµ‹è¯•æ¨¡å—æ˜¯ä¸€ä¸ªåç§°ç±»ä¼¼äº<code>test_*.py</code> <code>*_test.py</code>æˆ–<code>*_test.py</code> ã€‚ <br>  â€¢åœ¨æµ‹è¯•æ¨¡å—ä¸­æŸ¥æ‰¾ä»¥testå¼€å¤´çš„åŠŸèƒ½<em>ã€‚</em> <em><br></em>  <em>â€¢æŸ¥æ‰¾ä»¥Testå¼€å¤´çš„ç±»ã€‚</em>  <em>åœ¨ä»¥`testå¼€å§‹</em> <code>,    </code> <strong>init`</strong> <code>,    </code> <em>ç±»ä¸­å¯»æ‰¾</em> <code>,    </code> ã€‚ </p><br><p> è¿™äº›æ˜¯æ ‡å‡†çš„æ£€æµ‹è§„åˆ™ï¼› ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥æ›´æ”¹å®ƒä»¬ã€‚ </p><br><h3 id="python_classes">  python_classes </h3><br><p> æŸ¥æ‰¾pytestå’Œç±»æµ‹è¯•çš„é€šå¸¸è§„åˆ™æ˜¯ï¼Œå¦‚æœè¯¥ç±»ä»¥<code>Test*</code>å¼€å¤´ï¼Œåˆ™å°†å…¶è§†ä¸ºæ½œåœ¨çš„æµ‹è¯•ç±»ã€‚ è¯¥ç±»ä¹Ÿä¸èƒ½å…·æœ‰<code>__init__()</code>æ–¹æ³•ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¦å°†æµ‹è¯•ç±»å‘½åä¸º<code>&lt;something&gt;Test</code>æˆ–<code>&lt;something&gt;Suite</code>æ€ä¹ˆåŠï¼Ÿ è¿™æ˜¯<code>python_classes</code>å‡ºç°<code>python_classes</code> ï¼š </p><br><pre> <code class="plaintext hljs">[pytest] python_classes = *Test Test* *Suite</code> </pre> <br><p> è¿™ä½¿æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·å‘½åç±»ï¼š </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DeleteSuite</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">()</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_delete_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> ... ....</code> </pre> <br><h3 id="python_files">  python_files </h3><br><p> åƒ<code>pytest_classes</code>ä¸€æ ·ï¼Œ <code>python_files</code>ä¿®æ”¹é»˜è®¤çš„æµ‹è¯•æ£€æµ‹è§„åˆ™ï¼Œè¯¥è§„åˆ™åŒ…æ‹¬æŸ¥æ‰¾ä»¥<code>test_*</code>å¼€å¤´æˆ–ä»¥<code>*_test</code> <code>test_*</code>ç»“å°¾çš„æ–‡ä»¶ã€‚ <br> å‡è®¾æ‚¨æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„æµ‹è¯•æ¡†æ¶ï¼Œåœ¨å…¶ä¸­å°†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å‘½åä¸º<code>check_&lt;something&gt;.py</code> ã€‚ ä¼¼ä¹åˆç†ã€‚ æ— éœ€é‡å‘½åæ‰€æœ‰æ–‡ä»¶ï¼Œåªéœ€åœ¨<code>pytest.ini</code>æ·»åŠ ä¸€è¡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><pre> <code class="plaintext hljs">[pytest] python_files = test_* *_test check_*</code> </pre> <br><p> å¾ˆç®€å• ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€æ­¥è½¬ç§»å‘½åçº¦å®šï¼Œæˆ–è€…å°†å…¶ä¿ç•™ä¸º<code>check_*</code> ã€‚ </p><br><h3 id="python_functions">  python_functions </h3><br><p>  <code>python_functions</code>è¡Œä¸ºç±»ä¼¼äºä¹‹å‰çš„ä¸¤ä¸ªè®¾ç½®ï¼Œä½†ç”¨äºæµ‹è¯•å‡½æ•°å’Œæ–¹æ³•åç§°ã€‚ é»˜è®¤å€¼ä¸º<code>test_*</code> ã€‚ å¹¶æ·»åŠ <code>check_*</code>çŒœå¯¹äº†ï¼‰ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š </p><br><pre> <code class="plaintext hljs">[pytest] python_functions = test_* check_*</code> </pre> <br><p>  <code>pytest</code>å‘½å<code>pytest</code>ä¼¼ä¹æ²¡æœ‰é‚£ä¹ˆä¸¥æ ¼ï¼Œå¯¹å—ï¼Ÿ å› æ­¤ï¼Œå¦‚æœæ‚¨ä¸å–œæ¬¢é»˜è®¤çš„å‘½åçº¦å®šï¼Œåªéœ€å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚ ä¸è¿‡ï¼Œæˆ‘æ•¦ä¿ƒæ‚¨ä¸ºæ­¤ç±»å†³å®šæä¾›æ›´æœ‰è¯´æœåŠ›çš„ç†ç”±ã€‚ è¿ç§»æ•°ç™¾ä¸ªæµ‹è¯•æ–‡ä»¶ç»å¯¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±ã€‚ </p><br><h2 id="zapret-xpass">  XPASSç¦ä»¤ </h2><br><p> è®¾ç½®<code>xfail_strict = true</code>è¡¨ç¤ºæ ‡è®°ä¸º<code>@pytest.mark.xfail</code>çš„æµ‹è¯•æœªè¢«è¯†åˆ«ä¸ºå¯¼è‡´è¯¥é”™è¯¯ã€‚ æˆ‘è®¤ä¸ºæ­¤è®¾ç½®åº”å§‹ç»ˆå¦‚æ­¤ã€‚ æœ‰å…³<code>xfail</code>ä»¤ç‰Œçš„æ›´å¤šä¿¡æ¯<code>xfail</code>è¯·å‚é˜…ç¬¬37é¡µâ€œæ ‡è®°ç­‰å¾…å¤±è´¥çš„æµ‹è¯•â€ã€‚ </p><br><h2 id="predotvraschenie-konfliktov-imen-faylov"> é˜²æ­¢æ–‡ä»¶åå†²çª </h2><br><p> åœ¨é¡¹ç›®çš„æ¯ä¸ªæµ‹è¯•å­ç›®å½•ä¸­éƒ½æœ‰<code>__init__.py</code>æ–‡ä»¶çš„ä½œç”¨ä½¿æˆ‘å›°æƒ‘äº†å¾ˆé•¿æ—¶é—´ã€‚ ä½†æ˜¯ï¼Œæ‹¥æœ‰æˆ–ä¸æ‹¥æœ‰å®ƒä»¬çš„åŒºåˆ«å¾ˆç®€å•ã€‚ å¦‚æœæ‰€æœ‰æµ‹è¯•å­ç›®å½•ä¸­éƒ½æœ‰<code>__init__.py</code>æ–‡ä»¶ï¼Œåˆ™å¯ä»¥åœ¨å¤šä¸ªç›®å½•ä¸­ä½¿ç”¨ç›¸åŒçš„æµ‹è¯•æ–‡ä»¶åã€‚ å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆè¿™å°†è¡Œä¸é€šã€‚ </p><br><p> è¿™æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ ç›®å½•<code>a</code>å’Œ<code>b</code>éƒ½æœ‰æ–‡ä»¶<code>test_foo.py</code> ã€‚ è¿™äº›æ–‡ä»¶åŒ…å«ä»€ä¹ˆéƒ½æ²¡æœ‰å…³ç³»ï¼Œä½†æ˜¯åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œå®ƒä»¬çœ‹èµ·æ¥åƒè¿™æ ·ï¼š </p><br><blockquote>  <strong>ch6 / dups / a / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_a</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br><br>  <strong>ch6 / dups / b / test_foo.py</strong> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_b</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> <br></blockquote><p> ä½¿ç”¨æ­¤ç›®å½•ç»“æ„ï¼š </p><br><pre> <code class="plaintext hljs">dups â”œâ”€â”€ a â”‚ â””â”€â”€ test_foo.py â””â”€â”€ b â””â”€â”€ test_foo.py</code> </pre> <br><p> è¿™äº›æ–‡ä»¶ç”šè‡³æ²¡æœ‰ç›¸åŒçš„å†…å®¹ï¼Œä½†æ˜¯æµ‹è¯•å·²æŸåã€‚ æ‚¨å°†èƒ½å¤Ÿåˆ†åˆ«è¿è¡Œå®ƒä»¬ï¼Œä½†æ˜¯æ— æ³•ä»<code>dups</code>ç›®å½•è¿è¡Œ<code>pytest</code> ï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/dups $ pytest a ============================= test session starts ============================= collected 1 item a\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest b ============================= test session starts ============================= collected 1 item b\test_foo.py . ========================== 1 passed in 0.05 seconds =========================== $ pytest ============================= test session starts ============================= collected 1 item / 1 errors =================================== ERRORS ==================================== _______________________ ERROR collecting b/test_foo.py ________________________ import file mismatch: imported module 'test_foo' has this __file__ attribute: /path/to/code/ch6/dups/a/test_foo.py which is not the same as the test file we want to collect: /path/to/code/ch6/dups/b/test_foo.py HINT: remove __pycache__ / .pyc files and/or use a unique basename for your test file modules !!!!!!!!!!!!!!!!!!! Interrupted: 1 errors during collection !!!!!!!!!!!!!!!!!!! =========================== 1 error in 0.34 seconds ===========================</code> </pre> <br><p> ä¸æ¸…æ¥šï¼ <br> æ­¤é”™è¯¯æ¶ˆæ¯å¹¶ä¸è¡¨ç¤ºå‡ºäº†ä»€ä¹ˆé—®é¢˜ã€‚ </p><br><p> è¦ä¿®å¤æ­¤æµ‹è¯•ï¼Œåªéœ€å°†ç©ºçš„<code>__init__.py</code>æ–‡ä»¶æ·»åŠ åˆ°å­ç›®å½•ä¸­ã€‚ è¿™æ˜¯<code>dups_fixed</code>ç›®å½•çš„ç¤ºä¾‹ï¼Œè¯¥ç›®å½•å…·æœ‰ç›¸åŒçš„é‡å¤æ–‡ä»¶åï¼Œä½†æ·»åŠ äº†<code>__init__.py</code>æ–‡ä»¶ï¼š </p><br><pre> <code class="plaintext hljs">dups_fixed/ â”œâ”€â”€ a â”‚ â”œâ”€â”€ __init__.py â”‚ â””â”€â”€ test_foo.py â””â”€â”€ b â”œâ”€â”€ __init__.py â””â”€â”€ test_foo.py</code> </pre> <br><p> ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä»<code>dups_fixed</code>çš„é¡¶å±‚é‡<code>dups_fixed</code> ï¼š </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch6/ch6/dups_fixed/ $ pytest ============================= test session starts ============================= collected 2 items a\test_foo.py . b\test_foo.py . ========================== 2 passed in 0.15 seconds ===========================</code> </pre> <br><p> è¿™æ ·ä¼šæ›´å¥½ã€‚ </p><br><p> å½“ç„¶ï¼Œæ‚¨å¯ä»¥è¯´æœè‡ªå·±æ°¸è¿œä¸ä¼šæœ‰é‡å¤çš„æ–‡ä»¶åï¼Œæ‰€ä»¥æ²¡å…³ç³»ã€‚ ä¸€åˆ‡éƒ½æ­£å¸¸ã€‚ ä½†æ˜¯é¡¹ç›®åœ¨å¢é•¿ï¼Œæµ‹è¯•ç›®å½•ä¹Ÿåœ¨å¢é•¿ï¼Œæ‚¨è‚¯å®šè¦ç­‰å®ƒå‘ç”Ÿä¹‹åå†å¤„ç†å®ƒå—ï¼Ÿ æˆ‘è¯´ï¼Œå°±æ˜¯æŠŠè¿™äº›æ–‡ä»¶æ”¾åœ¨é‚£é‡Œã€‚ å…»æˆä¹ æƒ¯ï¼Œä¸å¿…æ‹…å¿ƒã€‚ </p><br><h2 id="uprazhneniya"> ç»ƒä¹ é¢˜ </h2><br><p> åœ¨ç¬¬95é¡µçš„ç¬¬5ç« ï¼Œæ’ä»¶ä¸­ï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸ºpytest-niceçš„æ’ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬--niceå‘½ä»¤è¡Œé€‰é¡¹ã€‚ è®©æˆ‘ä»¬å¯¹å…¶è¿›è¡Œæ‰©å±•ï¼Œä½¿å…¶åŒ…å«ä¸€ä¸ªåä¸ºniceçš„pytest.inié€‰é¡¹ã€‚ </p><br><p> åœ¨ç¬¬95é¡µç¬¬5ç« â€œæ’ä»¶â€ä¸­ï¼Œæ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º<code>pytest-nice</code>çš„æ’ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬<code>--nice</code>å‘½ä»¤è¡Œ<code>--nice</code> ã€‚ è®©æˆ‘ä»¬å°†å…¶æ‰©å±•ä¸ºåŒ…å«åä¸º<code>nice</code>çš„<code>pytest.ini</code>é€‰é¡¹ã€‚ </p><br><ol><li>  <code>pytest_addoption</code> <code>pytest_nice.py</code>æ·»åŠ åˆ°<code>pytest_addoption</code> <code>pytest_nice.py</code>æŒ‚é’©å‡½æ•°ä¸­ï¼š <code>parser.addini('nice', type='bool', help='Turn failures into opportunities.')</code> </li><li> æ’ä»¶ä¸­ä½¿ç”¨<code>getoption()</code>ä¹Ÿå¿…é¡»è°ƒç”¨<code>getini('nice')</code> ã€‚ è¿›è¡Œè¿™äº›æ›´æ”¹ã€‚ </li><li> é€šè¿‡å‘<code>pytest.ini</code>æ–‡ä»¶æ·»åŠ <code>nice</code>æ¥æ‰‹åŠ¨éªŒè¯ã€‚ </li><li> ä¸è¦å¿˜è®°æ’ä»¶æµ‹è¯•ã€‚ æ·»åŠ ä¸€ä¸ªæµ‹è¯•ä»¥éªŒè¯<code>pytest.ini</code>ä¸­çš„<code>nice</code>å‚æ•°<code>pytest.ini</code>æ­£å¸¸è¿è¡Œã€‚ </li><li> å°†æµ‹è¯•æ·»åŠ åˆ°æ’ä»¶ç›®å½•ã€‚ æ‚¨éœ€è¦æ‰¾åˆ°ä¸€äº›<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å…¶ä»–çš„PytesteråŠŸèƒ½</a> ã€‚ </li></ol><br><h2 id="chto-dalshe"> æ¥ä¸‹æ¥æ˜¯ä»€ä¹ˆ </h2><br><p> å°½ç®¡pytestæœ¬èº«éå¸¸å¼ºå¤§ï¼ˆå°¤å…¶æ˜¯æ’ä»¶ï¼‰ï¼Œä½†å®ƒä¹Ÿå¯ä»¥ä¸å…¶ä»–è½¯ä»¶å¼€å‘å’Œè½¯ä»¶æµ‹è¯•å·¥å…·å¾ˆå¥½åœ°é›†æˆã€‚ åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç»“åˆå…¶ä»–å¼ºå¤§çš„æµ‹è¯•å·¥å…·æ¥ç ”ç©¶pytestçš„ç”¨æ³•ã€‚ </p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿”å›</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä¸‹ä¸€ä¸ª</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN448796/">https://habr.com/ru/post/zh-CN448796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN448780/index.html">ä»€ä¹ˆä½¿è½¯ä»¶å¯ä»¥èµšé’±</a></li>
<li><a href="../zh-CN448782/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ pytestå…¥é—¨ï¼Œç¬¬1ç« </a></li>
<li><a href="../zh-CN448786/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ ç¬¬3ç« pytestå›ºå®šè£…ç½®</a></li>
<li><a href="../zh-CN448788/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ ç¬¬2ç« ï¼Œç¼–å†™æµ‹è¯•å‡½æ•°</a></li>
<li><a href="../zh-CN448790/index.html">SpaceVIL-ç”¨äºåœ¨.Net Coreï¼Œ.Net Standardå’ŒJVMä¸Šå¼€å‘çš„è·¨å¹³å°GUIæ¡†æ¶</a></li>
<li><a href="../zh-CN448798/index.html">ä½¿ç”¨pytestè¿›è¡ŒPythonæµ‹è¯•ã€‚ å°†pytestä¸å…¶ä»–å·¥å…·ç»“åˆä½¿ç”¨ï¼Œç¬¬7ç« </a></li>
<li><a href="../zh-CN448800/index.html">ä½¿ç”¨.vsconfigåœ¨æ•´ä¸ªç»„ç»‡ä¸­é…ç½®Visual Studio</a></li>
<li><a href="../zh-CN448802/index.html">å…³äºé—¨æˆ·ç½‘ç«™çš„æ€è€ƒï¼šåœ¨è™šå¹»å¼•æ“4ä¸­åˆ›å»ºé—¨æˆ·ç½‘ç«™</a></li>
<li><a href="../zh-CN448804/index.html">ä¸ºmacOSçš„å¼ºåŒ–è¿è¡Œæ—¶å’Œå…¬è¯åšå¥½å‡†å¤‡</a></li>
<li><a href="../zh-CN448806/index.html">åœ¨Qtåº“ä¸Šåˆ›å»ºæ‰©å±•ç³»ç»Ÿ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>