<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ù§Ô∏è üîê üëà Personnaliser le mappage des contr√¥leurs Spring MVC üß• üé® üï∫üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pr√©sentation 


 R√©cemment, j'ai √©t√© confront√© √† la t√¢che d'impl√©menter un contr√¥leur qui g√®re les situations de diff√©rentes mani√®res o√π il existe des...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Personnaliser le mappage des contr√¥leurs Spring MVC</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/478766/"><h2 id="vvedenie">  Pr√©sentation </h2><br><p>  R√©cemment, j'ai √©t√© confront√© √† la t√¢che d'impl√©menter un contr√¥leur qui g√®re les situations de diff√©rentes mani√®res o√π il existe des param√®tres de demande et o√π il n'y en a pas.  Le probl√®me √©tait aggrav√© par le fait qu'exactement deux m√©thodes diff√©rentes √©taient n√©cessaires dans le contr√¥leur.  Les fonctionnalit√©s standard de Spring MVC ne le permettaient pas.  J'ai d√ª creuser un peu plus profond√©ment.  Peu importe - bienvenue au chat. </p><a name="habracut"></a><br><h2 id="chto-my-hotim">  Que voulons-nous </h2><br><p>  Voici un court test qui d√©crit l'essence de la t√¢che. </p><br><div class="spoiler">  <b class="spoiler_title">TestControllerTest.java</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@SpringJUnitWebConfig</span></span>(WebConfig.class) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestControllerTest</span></span></span><span class="hljs-class"> </span></span>{     <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span>     WebApplicationContext webApplicationContext;     <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{         MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();         mockMvc.perform(MockMvcRequestBuilders.get(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>))                 .andExpect(status().isOk())                 .andExpect(result -&gt;                         assertEquals(TestController.HANDLE_REQUEST_WITHOUT_PARAMS, result.getResponse().getContentAsString()));     }     <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testHandleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{         MockMvc mockMvc = MockMvcBuilders.webAppContextSetup(webApplicationContext).build();         mockMvc.perform(MockMvcRequestBuilders                 .get(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>)                 .param(<span class="hljs-string"><span class="hljs-string">"someparam"</span></span>, <span class="hljs-string"><span class="hljs-string">"somevalue"</span></span>))                 .andExpect(status().isOk())                 .andExpect(result -&gt;                         assertEquals(TestController.HANDLE_REQUEST_WITH_PARAMS, result.getResponse().getContentAsString()));     } }</code> </pre> </div></div><br><h2 id="nadeemsya-chto-vse-razreshitsya-samo-soboy">  Nous esp√©rons que tout sera r√©solu par lui-m√™me </h2><br><div class="spoiler">  <b class="spoiler_title">TestController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITHOUT_PARAMS;    } }</code> </pre> </div></div><br><p>  Cependant, Spring n'√©tait pas aussi convivial que pr√©vu, et la sortie √©tait: </p><br><pre> <code class="plaintext hljs">java.lang.IllegalStateException: Ambiguous mapping. Cannot map 'getTestController' method public java.lang.String ru.pchurzin.spring.customannotations.TestController.handleRequestWithoutParams() to {GET /test}: There is already 'getTestController' bean method public java.lang.String ru.pchurzin.spring.customannotations.TestController.handleRequestWithParams(ru.pchurzin.spring.customannotations.SearchQuery) mapped.`</code> </pre> <br><h2 id="ne-sdaemsya">  N'abandonne pas </h2><br><p>  Des tentatives ont √©t√© faites pour s√©parer le mappage de ces m√©thodes via l' <code>@RequestMapping(params = "some condition")</code> , mais malheureusement dans la version utilis√©e de Spring 5.1.8 il n'y a aucun moyen de d√©finir la condition pour que la requ√™te contienne <strong>des</strong> param√®tres.  Vous pouvez sp√©cifier la pr√©sence de param√®tres avec des noms sp√©cifiques ou l'absence de param√®tres avec des noms sp√©cifiques.  Ni l'un ni l'autre ne convenaient, car  les param√®tres peuvent √™tre diff√©rents dans chaque demande.  Je voudrais √©crire quelque chose <code>@RequestMapping(params = "*")</code> pour indiquer que la demande doit contenir certains param√®tres ou @RequestMapping (params = "! *") `Pour indiquer ce qui ne devrait pas √™tre dans la demande √™tre aucun param√®tre. </p><br><h2 id="a-chto-v-dokumentacii">  Et que contient la documentation? </h2><br><p>  Apr√®s avoir fum√© la documentation, la section <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html">CustomAnnotations a</a> √©t√© trouv√©e, dans laquelle nous voyons: </p><br><pre> <code class="plaintext hljs">Spring MVC also supports custom request-mapping attributes with custom request-matching logic.</code> </pre> <br><p>  Il a √©t√© d√©cid√© de faire mon annotation, ce qui m'a permis de pr√©ciser les conditions dont j'avais besoin pour la disponibilit√© des param√®tres de requ√™te. <br></p><br><h2 id="cel">  But </h2><br><p>  Je veux ajouter l'annotation <code>@NoRequestParams</code> √† la m√©thode, indiquant que cette m√©thode traite les demandes sans param√®tres. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.METHOD) <span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> NoRequestParams { }</code> </pre> <br><p>  Contr√¥leur avec notre annotation: </p><br><div class="spoiler">  <b class="spoiler_title">Testcontoller.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-meta"><span class="hljs-meta">@NoRequestParams</span></span> <span class="hljs-comment"><span class="hljs-comment">//     public String handleRequestWithoutParams() {        return HANDLE_REQUEST_WITHOUT_PARAMS;    } }</span></span></code> </pre> </div></div><br><h2 id="pristupim">  Commen√ßons </h2><br><p>  La configuration Spring-MVC standard, activ√©e par l'annotation <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/EnableWebMvc.html">@EnableWebMvc</a> , <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/EnableWebMvc.html">est</a> d√©crite dans la classe <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurationSupport.html">WebMvcConfigurationSupport</a> .  Il instancie un bean de la classe <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html">RequestMappingHandlerMapping</a> , qui impl√©mente le mappage √† l'aide des objets de la classe <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/RequestMappingInfo.html">RequestMappingInfo</a> , qui √† leur tour encapsule des informations sur le mappage des demandes de m√©thode.  Ces informations sont pr√©sent√©es sous forme de conditions - objets de classe qui impl√©mentent l'interface <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">RequestCondition.</a>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">Spring a 6 impl√©mentations pr√™tes √† l'emploi:</a> <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html"><br><br></a> <br></p><ul><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/PatternsRequestCondition.html">PatternsRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestMethodsRequestCondition.html">RequestMethodsRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ParamsRequestCondition.html">ParamsRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/HeadersRequestCondition.html">HeadersRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ConsumesRequestCondition.html">ConsumesRequestCondition</a> </li><li>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/ProducesRequestCondition.html">ProducesRequestCondition</a> </li></ul><br><p>  En plus de ces impl√©mentations, nous pouvons d√©finir la n√¥tre.  Pour ce faire, nous devons impl√©menter l'interface <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">RequestCondition</a> et utiliser cette impl√©mentation pour nos besoins.  Vous pouvez impl√©menter l'interface directement ou utiliser une classe abstraite <br>  <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/AbstractRequestCondition.html">AbstractRequestCondition</a> . </p><br><div class="spoiler">  <b class="spoiler_title">NoRequestParamsCondition.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoRequestParamsCondition</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractRequestCondition</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoRequestParamsCondition</span></span></span><span class="hljs-class">&gt; </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> NoRequestParamsCondition NO_PARAMS_CONDITION = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NoRequestParamsCondition();    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Collection&lt;?&gt; getContent() {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Collections.singleton(<span class="hljs-string"><span class="hljs-string">"no params"</span></span>);    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getToStringInfix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NoRequestParamsCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">combine</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NoRequestParamsCondition other)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> NoRequestParamsCondition </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMatchingCondition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (request.getParameterMap().isEmpty()) {            <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;        }        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    }    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compareTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(NoRequestParamsCondition other, HttpServletRequest request)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>;    } }</code> </pre> </div></div><br><p>  Les deux premi√®res m√©thodes sont utilis√©es pour repr√©senter notre condition en cha√Æne. </p><br><p>  La m√©thode <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/condition/RequestCondition.html">T combine (T other)</a> est n√©cessaire pour combiner des conditions, par exemple, s'il y a une annotation sur la m√©thode et la classe.  Dans ce cas, la m√©thode combine est utilis√©e pour la combinaison.  Notre annotation n'implique pas une combinaison - par cons√©quent, nous renvoyons simplement notre instance actuelle de la condition. </p><br><p>  La <a href="&amp;xid=25657,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhiiFCupQg5GXsd1jsS1lEz5yS0LZQ#compareTo-T-javax.servlet.">m√©thode int compareTo (T other, HttpServletRequest request)</a> est utilis√©e pour comparer les conditions dans le contexte d'une certaine demande.  C'est-√†-dire  s'il existe plusieurs conditions du m√™me type pour la demande, il recherche celle qui est la plus sp√©cifique.  Mais encore une fois, notre condition est la seule possible, donc nous retournons simplement 0, c'est-√†-dire  Toutes nos conditions sont √©gales. </p><br><p>  La logique de base du travail est contenue dans la m√©thode <a href="&amp;xid=25657,15700021,15700186,15700191,15700259,15700271&amp;usg=ALkJrhiiFCupQg5GXsd1jsS1lEz5yS0LZQ#getMatchingCondition-javax.servlet.">T getMatchingCondition (requ√™te HttpServletRequest)</a> .  Dans cette m√©thode, nous devons d√©cider de demander si notre condition s'y applique ou non.  Si tel est le cas, renvoyez l'objet condition.  Sinon, retournez <code>null</code> .  Dans notre cas, nous retournons un objet condition si la requ√™te ne contient aucun param√®tre. </p><br><p>  Maintenant, nous devons inclure notre condition dans le processus de cartographie.  Pour ce faire, nous h√©riterons de l'impl√©mentation standard de <a href="https://docs.spring.io/spring/docs/5.1.8.RELEASE/javadoc-api/org/springframework/web/servlet/mvc/method/RequestMappingInfoHandlerMapping.html">RequestMappingHandlerMapping</a> <br>  et red√©finissez la <code>getCustomMethodCondition(Method method)</code> , qui vient d'√™tre cr√©√©e afin d'ajouter vos propres conditions personnalis√©es.  De plus, cette m√©thode est utilis√©e pour d√©terminer les conditions des <strong>m√©thodes du</strong> contr√¥leur.  Il existe √©galement une <code>getCustomTypeCondition(Class&lt;?&gt; handlerType)</code> , qui peut √™tre utilis√©e pour d√©terminer les conditions en fonction des informations sur la classe du contr√¥leur.  Dans notre cas, nous n'en avons pas besoin. </p><br><p>  En cons√©quence, nous avons l'impl√©mentation suivante: </p><br><div class="spoiler">  <b class="spoiler_title">CustomRequestMappingHandlerMapping.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CustomRequestMappingHandlerMapping</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequestMappingHandlerMapping</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> RequestCondition&lt;?&gt; getCustomMethodCondition(Method method) {        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> method.isAnnotationPresent(NoRequestParams.class) ? NO_PARAMS_CONDITION : <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>;    } }</code> </pre> </div></div><br><p>  La logique n'est pas compliqu√©e - on v√©rifie l'existence de notre annotation et, si elle est pr√©sente, on retourne l'objet de notre condition. </p><br><p>  Pour activer notre impl√©mentation de mappage, nous allons √©tendre la configuration Spring MVC standard: </p><br><div class="spoiler">  <b class="spoiler_title">Webconfig.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebMvcConfigurationSupport</span></span></span><span class="hljs-class"> </span></span>{       <span class="hljs-meta"><span class="hljs-meta">@Override</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> RequestMappingHandlerMapping </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createRequestMappingHandlerMapping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CustomRequestMappingHandlerMapping();    }    <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TestController </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTestController</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestController();    } }</code> </pre> </div></div><br><p>  Ajoutez notre annotation au contr√¥leur: </p><br><div class="spoiler">  <b class="spoiler_title">TestController.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Controller</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestMapping</span></span>(<span class="hljs-string"><span class="hljs-string">"/test"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestController</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITH_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithParams"</span></span>;    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String HANDLE_REQUEST_WITHOUT_PARAMS = <span class="hljs-string"><span class="hljs-string">"handleRequestWithoutParams"</span></span>;    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SearchQuery query)</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITH_PARAMS;    }    <span class="hljs-meta"><span class="hljs-meta">@GetMapping</span></span>    <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span>    <span class="hljs-meta"><span class="hljs-meta">@NoRequestParams</span></span>    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleRequestWithoutParams</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HANDLE_REQUEST_WITHOUT_PARAMS;    } }</code> </pre> </div></div><br><p>  et v√©rifiez le r√©sultat: </p><br><pre> <code class="plaintext hljs">Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.851 s - in ru.pchurzin.spring.customannotations.TestControllerTest Results: Tests run: 2, Failures: 0, Errors: 0, Skipped: 0</code> </pre> <br><p>  Ainsi, nous pouvons changer la logique de la cartographie en fonction de nos besoins et arriver √† nos propres conditions.  Par exemple, des conditions sur l'adresse IP ou sur l'agent utilisateur utilis√©.  Il peut y avoir des solutions plus simples, mais dans tous les cas, l'assemblage de votre v√©lo est √©galement parfois utile. </p><br><p>  Merci de votre attention. </p><br><p>  <a href="https://github.com/pchurzin/spring-mvc-custom-annotatations">Exemple de code Github</a> </p><p></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr478766/">https://habr.com/ru/post/fr478766/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr478750/index.html">Biblioth√®ques de visualisation de donn√©es r√©elles pour les d√©veloppeurs React</a></li>
<li><a href="../fr478752/index.html">Histoire des syst√®mes de contr√¥le de version</a></li>
<li><a href="../fr478758/index.html">Grand guide des balises UTM: comment savoir d'o√π viennent les utilisateurs</a></li>
<li><a href="../fr478760/index.html">L'enfer "z√©ro" et comment s'en sortir</a></li>
<li><a href="../fr478764/index.html">Erreurs JavaScript: correction, traitement, r√©paration</a></li>
<li><a href="../fr478772/index.html">Texture convolutionnelle</a></li>
<li><a href="../fr478774/index.html">Ambiance du Nouvel An d'Arduino et de b√¢tons</a></li>
<li><a href="../fr478788/index.html">Dans un certain royaume, pas dans un √©tat ¬´naissant¬ª. Rapport Yandex</a></li>
<li><a href="../fr478790/index.html">Julia et la s√©mantique de distribution</a></li>
<li><a href="../fr478796/index.html">Premier cycle aux √âtats-Unis: un moyen non conventionnel d'atteindre les meilleures √©coles secondaires</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>