<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🏡 🙄 🏴󠁧󠁢󠁥󠁮󠁧󠁿 Cara menulis ekstensi untuk GNOME Shell: Mode Jangan Ganggu 🉑 ✋🏽 🍔</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Semuanya dimulai dengan pindah ke versi baru dari satu distribusi Linux, dan di sana - GNOME Shell yang terkenal (singkatnya GH), dalam Javascript. Ba...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cara menulis ekstensi untuk GNOME Shell: Mode Jangan Ganggu</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/428187/"><p>  Semuanya dimulai dengan pindah ke versi baru dari satu distribusi Linux, dan di sana - GNOME Shell yang <em>terkenal</em> (singkatnya GH), dalam Javascript.  Baiklah, ok, di JS dan sebagainya, JS berfungsi - dan oke. </p><br><p> Pada saat yang sama, kecepatan pekerjaan saya telah lama menuntut untuk menemukan mailer yang normal, alih-alih mengerem dan menenggelamkan banyak megabita dari tab <code>outlook.office.com</code> di browser.  Dan sekarang saya menemukan, di zaman kita ada beberapa kandidat yang hampir sempurna, satu masalah - pengirim surat mulai memberi saya pemberitahuan tentang surat-surat baru - dan suara, serta tulisan pop-up. </p><br><p>  Apa yang harus dilakukan  Keputusan untuk menulis ekstensi Jangan Ganggu tidak datang segera, saya benar-benar tidak ingin menulis sepeda dan / atau terjebak dalam pengembangan / kode / ton kesalahan, tetapi saya memutuskan, dan sekarang saya ingin berbagi pengalaman saya dengan Habr  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">1</a></sup> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/737/175/2b5/7371752b5fb33b8858bff75857fbfa83.jpg"></p><a name="habracut"></a><br><h2 id="tehnicheskie-trebovaniya">  Persyaratan teknis </h2><br><p>  Saya ingin memilikinya <del>  satu besar </del>  tombol untuk mematikan notifikasi dan suara untuk waktu pilihan Anda: 20 menit, 40 menit, 1 jam, 2 jam, 4, 8 dan 24 jam.  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">2</a></sup> Ya, waktu seperti di Slack. </p><br><p>  Pada hamparan extensions.gnome.org ada ekstensi "Do Not Disturb Button", yang berfungsi sebagai model untuk menulis ekstensi. <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Do Not Disturb Time</a> . </p><br><h2 id="konechnyy-rezultat-do-not-disturb-timehttpsextensionsgnomeorgextension1484do-not-disturb-time">  Hasil akhir: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Jangan Ganggu Waktu</a> </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/104/41d/479/10441d479062c7540a2743c6fb0b852d.png" alt="Jangan ganggu waktu"></p><br><p>  Pasang dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">extensions.gnome.org</a> . <br>  Sumber di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">github</a> : pasang bintang, garpu, tawarkan peningkatan. </p><br><h3 id="kak-ustanovit-rasshirenie-gh-instrukciya">  Cara menginstal ekstensi GH: instruksi </h3><br><ol><li>  Instal paket <em>chrome-gnome-shell</em> , konektor browser, menggunakan Ubuntu sebagai contoh: <br> <code>sudo apt install chrome-gnome-shell</code> </li> <li>  Dengan menggunakan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan,</a> instal ekstensi browser: <br><ul><li>  ikuti tautannya <em>Klik di sini untuk menginstal ekstensi browser</em> </li><li>  di Ubuntu 18.04, ia bekerja untuk saya di browser Chrome / Chromium, di Fedora 28/29 - baik di Firefox maupun di Chromium </li></ul></li><li>  Kami mencari ekstensi yang diinginkan dalam daftar <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://extensions.gnome.org</a> : aktifkan, nonaktifkan, ubah pengaturan ekstensi. </li><li>  KEUNTUNGAN! </li></ol><br><h2 id="nachalo">  Mulai </h2><br><p>  Buat ekstensi dari awal: </p><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> gnome<span class="hljs-literal"><span class="hljs-literal">-shell</span></span><span class="hljs-literal"><span class="hljs-literal">-extension</span></span><span class="hljs-literal"><span class="hljs-literal">-tool</span></span> -<span class="hljs-literal"><span class="hljs-literal">-create</span></span><span class="hljs-literal"><span class="hljs-literal">-extension</span></span> Name: <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> Not Disturb Time Description: Disables notifications and sound <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a period Uuid: dnd@catbo.net Created extension <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'~/.local/share/gnome-shell/extensions/dnd@catbo.net'</span></span> <span class="hljs-comment"><span class="hljs-comment">#  gnome-shell Alt+F2, r, Enter #    https://extensions.gnome.org/local/      #   Gnome Shell - , gnome-shell   systemd,   journalctl -f /usr/bin/gnome-shell #    ,       gnome-shell journalctl -f /usr/bin/gnome-shell | grep -E 'dnd|$'</span></span></code> </pre> <br><p>  File <code>extension.js</code> di direktori yang sesuai adalah titik masuk dalam aplikasi kami, dalam versi minimal terlihat seperti ini: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{} <span class="hljs-comment"><span class="hljs-comment">//   ;    function disable() {} // --||-- ;     enable()</span></span></code> </pre> <br><h3 id="pervyy-kod">  Kode pertama </h3><br><p>  Pertama, kami ingin menambahkan tombol ke <code>Status Menu</code> kanan atas, seperti pada tangkapan layar di atas. </p><br><p>  Jadi dari mana harus memulai?  Oh, mari kita mulai dengan dokumentasinya.  Kami memiliki dokumentasi resmi, semuanya.  Tetapi tidak, dokumentasi resmi sangat kecil dan terfragmentasi, tetapi berkat <code>julio641742</code> dan dokumentasinya yang tidak resmi, kami mendapatkan yang kami butuhkan: </p><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">// 1 -    (1 - , 0 - , 0.5 -  ) // true,     let dndButton = new PanelMenu.Button(1, "DoNotDisturb", false); // `right` -      (left/center/right) Main.panel.addToStatusArea("DoNotDisturbRole", dndButton, 0, "right"); let box = new St.BoxLayout(); dndButton.actor.add_child(box); let icon = new St.Icon({ style_class: "system-status-icon" }); icon.set_gicon(Gio.icon_new_for_string("/tmp/bell_normal.svg")); box.add(icon);</span></span></code> </pre> <br><p>  Kode ini menciptakan objek kunci <code>dndButton</code> dari kelas <code>dndButton</code> - ini adalah tombol yang dirancang khusus untuk panel Status Menu.  Dan kami memasukkannya ke panel ini menggunakan fungsi Main.panel.addToStatusArea ().  <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">3</a></sup> </p><br><p>  Masukkan item menu dengan penangan yang dibaut padanya, misalnya: </p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> menuItem = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PopupMenu.PopupMenuItem(<span class="hljs-string"><span class="hljs-string">"hello, world!"</span></span>); menuItem.connect(<span class="hljs-string"><span class="hljs-string">"activate"</span></span>, (menuItem, event) =&gt; { log(<span class="hljs-string"><span class="hljs-string">"hello, world!"</span></span>); }); dndButton.menu.addMenuItem(menuItem);</code> </pre> <br><p>  Terima kasih, julio641742, untuk dokumentasinya!  Tautan: <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://github.com/julio641742/gnome-shell-extension-reference</a> </p><br><p>  Kode kerja terakhir ada di <a href="">sini</a> . </p><br><h2 id="osobennosti-raboty-gnome-shell-i-javascript">  Fitur Shell GNOME dan Javascript </h2><br><p>  Di luar adalah akhir 2018, dan Node.js / V8 adalah alat utama untuk menjalankan kode Javascript.  Semua pengembangan web modern bertumpu pada "simpul." </p><br><p>  Tetapi GNOME Shell dan seluruh infrastruktur di sekitarnya menggunakan mesin Javascript yang berbeda, SpiderMonkey Mozilla, dan ini membawa banyak perbedaan penting dalam kinerja. </p><br><h3 id="import-moduley">  Modul Impor </h3><br><p>  Tidak seperti Node.js, tidak ada keharusan () di sini, dan tidak ada impor ES6 mewah juga.  Sebagai gantinya, ada objek impor khusus, yang mengakses atribut yang mengarah ke pemuatan modul: </p><br><pre> <code class="hljs julia"> //<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PanelMenu = require(<span class="hljs-string"><span class="hljs-string">"ui/panelMenu"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PanelMenu = imports.ui.panelMenu;</code> </pre> <br><p>  Dalam hal ini, kami mengunduh modul js / ui / panelMenu.js dari pustaka paket GNOME Shell, yang mengimplementasikan fungsi tombol dengan menu pop-up. </p><br><p>  Ya, semua tombol di panel desktop Linux modern menggunakan GNOME didasarkan pada panelMenu.js.  Termasuk: tombol kanan yang sama dengan indikator baterai, Wi-fi, volume suara;  masukan bahasa saklar en-ru. </p><br><p>  Selanjutnya, ada atribut khusus <code>imports.searchPath</code> - ini adalah daftar jalur (baris) tempat modul JS kami akan dicari.  Sebagai contoh, kami mengalokasikan fungsi timer ke modul timeUtils.js yang terpisah dan meletakkannya di dekat titik input ekstensi kami, extension.js.  Impor timeUtils.js sebagai berikut: </p><br><pre> <code class="hljs pgsql">//     , -  ~/.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">share</span></span>/gnome-shell/extensions/&lt;your-<span class="hljs-keyword"><span class="hljs-keyword">extension</span></span>&gt;/ const Me = imports.misc.extensionUtils.getCurrentExtension(); //       imports.searchPath.unshift(Me.path); //   const timeUtils = imports.timeUtils;</code> </pre> <br><h3 id="logirovanie-otladka-javascript">  Logging, debugging Javascript </h3><br><p>  Yah, karena kita tidak punya Node.js, maka kita punya logging sendiri.  Alih-alih console.log (), beberapa fungsi logging tersedia dalam kode, lihat gjs /../ global.cpp, static_funcs: </p><br><ul><li>  "log" = g_message ("JS LOG:" + message) - masuk ke stderr, contoh: </li></ul><br><pre> <code class="hljs powershell"><span class="hljs-variable"><span class="hljs-variable">$</span></span> cat helloWorld.js log(<span class="hljs-string"><span class="hljs-string">"hello, world"</span></span>); <span class="hljs-variable"><span class="hljs-variable">$</span></span> gjs helloWorld.js Gjs<span class="hljs-literal"><span class="hljs-literal">-Message</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span>:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-number"><span class="hljs-number">21.048</span></span>: JS LOG: hello, world</code> </pre> <br><ul><li>  "logError" - mencatat tumpukan pengecualian: <br><ul><li>  argumen pertama yang diperlukan adalah pengecualian, kemudian koma memisahkan apa yang Anda inginkan </li><li>  contoh, jika Anda perlu mencetak tumpukan di tempat yang tepat: </li></ul></li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'bum!'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(e) { logError(e, <span class="hljs-string"><span class="hljs-string">"what a fuck"</span></span>); }</code> </pre> <br><p>  dan ini akan menarik stderr dalam gaya: </p><br><pre> <code class="hljs powershell">(gjs:<span class="hljs-number"><span class="hljs-number">28674</span></span>): Gjs<span class="hljs-literal"><span class="hljs-literal">-WARNING</span></span> **: <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span>:<span class="hljs-number"><span class="hljs-number">46.951</span></span>: JS ERROR: what a fuck: Error: bum! ggg<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>./gtk.js:<span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-number"><span class="hljs-number">15</span></span> ddd<span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>./gtk.js:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">@</span></span>./gtk.js:<span class="hljs-number"><span class="hljs-number">15</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><ul><li>  "print" = g_print ("% s \ n", txt);  - hanya teks + "\ n" di stdout, tanpa awalan dan pewarnaan, tidak seperti log () </li><li>  "printerr" = g_printerr ("% s \ n", txt) - perbedaan dari hasil cetak adalah di stderr </li></ul><br><p>  Tetapi tidak ada debugger untuk SpiderMonkey di luar kotak (itu tidak sia-sia bahwa saya susah payah menulis di atas semua alat yang tersedia untuk login, gunakan!).  Jika diinginkan, Anda dapat mencoba JSRDbg: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">satu</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dua</a> . </p><br><h2 id="a-est-li-zhizn-dlya-js-koda-vne-gnome-shell">  Apakah ada kehidupan untuk kode JS di luar GNOME Shell? </h2><br><p>  Ada.  Aplikasi berfitur lengkap, termasuk antarmuka pengguna grafis (GUI), dapat ditulis dalam Javascript!  Anda perlu menjalankannya menggunakan gjs binar, peluncur kode JS-GTK, contoh membuat jendela GUI: </p><br><pre> <code class="hljs vala">$ which gjs /usr/bin/gjs $ dpkg --search /usr/bin/gjs gjs: /usr/bin/gjs $ cat gtk.js <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Gtk</span></span> = imports.gi.<span class="hljs-built_in"><span class="hljs-built_in">Gtk</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">Gtk</span></span>.init(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); let win = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Gtk</span></span>.Window(); win.connect(<span class="hljs-string"><span class="hljs-string">"delete-event"</span></span>, () =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">Gtk</span></span>.main_quit(); }); win.show_all(); <span class="hljs-built_in"><span class="hljs-built_in">Gtk</span></span>.main(); $ gjs gtk.js</code> </pre> <br><p>  Di atas, saya menyebutkan kode pemisahan ke dalam modul dan memuatnya dari Javascript.  Muncul pertanyaan, tetapi bagaimana dalam modul itu sendiri untuk menentukan apakah itu diluncurkan sebagai modul "utama", atau diambil dari modul lain? </p><br><p>  Python memiliki konstruksi otentik: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: main()</code> </pre> <br><p>  Di Node.js - sama: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">require</span></span>.main === <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>) { main(); }</code> </pre> <br><p>  Saya tidak menemukan jawaban resmi untuk pertanyaan ini untuk Gjs / GH, tetapi saya datang dengan teknik sedemikian rupa sehingga saya cepat-cepat berbagi dengan pembaca (mengapa seseorang membaca "dosyudova"? Hormat!). </p><br><p>  Jadi, trik rumit didasarkan pada analisis tumpukan panggilan saat ini, jika terdiri dari 2 baris atau lebih, maka kita tidak berada dalam modul main (): </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>().stack.split(<span class="hljs-regexp"><span class="hljs-regexp">/\r\n|\r|\n/g</span></span>).filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">line</span></span></span><span class="hljs-function"> =&gt;</span></span> line.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) .length == <span class="hljs-number"><span class="hljs-number">1</span></span> ) { main(); }</code> </pre> <br><h2 id="uborka-za-soboy">  Rumah tangga </h2><br><p>  Setiap ekstensi GNOME Shell memiliki akses ke semua objek di seluruh Shell GNOME.  Misalnya, untuk menampilkan jumlah pemberitahuan yang masih belum dibaca, kami sampai di wadah bersama mereka di <code>Notification Area</code> , yang terletak di tengah di atas, nomor 4 di gambar (klik pada tulisan dengan waktu saat ini, itu dapat diklik dalam kehidupan nyata, bukan di sini): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/91e/eec/acc/91eeecaccdc67202335ce4d51d8d90d3.png" alt="Jangan ganggu waktu"></p><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> unseenlist = Main.panel.statusArea.dateMenu._messageList._notificationSection._list;</code> </pre> <br><p>  Anda dapat mengetahui berapa banyak, notifikasi yang belum dibaca, berlangganan acara penambahan dan penghapusan notifikasi: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> number = unseenlist.get_n_children(); unseenlist.connect(<span class="hljs-string"><span class="hljs-string">"actor-added"</span></span>, () =&gt; { log(<span class="hljs-string"><span class="hljs-string">"added!"</span></span>); }); unseenlist.connect(<span class="hljs-string"><span class="hljs-string">"actor-removed"</span></span>, () =&gt; { log(<span class="hljs-string"><span class="hljs-string">"removed!"</span></span>); });</code> </pre> <br><p>  Ini bagus, tetapi pengguna terkadang dapat memutuskan bahwa ia tidak lagi membutuhkan ekstensi X, dan mengklik tombol untuk menonaktifkan ekstensi.  Untuk ekstensi, ini sama dengan memanggil fungsi disable (), dan segala upaya harus dilakukan agar ekstensi yang dimatikan tidak merusak GH yang berfungsi: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dndButton.destroy(); }</code> </pre> <br><p>  Dalam hal ini, selain menghapus tombol itu sendiri, Anda harus berhenti berlangganan dari acara "aktor-ditambahkan" / "aktor-dihapus", misalnya: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> signal = unseenlist.connect(<span class="hljs-string"><span class="hljs-string">"actor-added"</span></span>, () =&gt; { log(<span class="hljs-string"><span class="hljs-string">"added!"</span></span>); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dndButton.destroy(); unseenlist.disconnect(signal); }</code> </pre> <br><p>  Jika ini tidak dilakukan, maka kode penangan akan terus dipanggil pada acara yang sesuai, cobalah untuk memperbarui status tombol menu yang belum ada dan ... GNOME Shell akan mulai gagal.  Ya, kami akan melakukannya, pengguna akan bersumpah, batu akan terbang ke pengembang Shell GNOME dan GNOME secara umum.  Gambaran nyata, Th. </p><br><p>  Jadi GNOME Shell / Gjs adalah simbiosis dari dua sistem, Glib / GTK dan Javascript, dan mereka memiliki pendekatan yang berbeda untuk manajemen sumber daya.  Glib / GTK membutuhkan pelepasan sumber dayanya secara eksplisit (tombol, timer, dll.).  Jika objek itu dibuat oleh mesin Javascript, maka kami bertindak seperti biasa (jangan melepaskan apa pun). </p><br><p>  Akibatnya, segera setelah ekstensi kami siap, dan tidak "mengalir", Anda dapat mempublikasikannya dengan aman di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">https://extensions.gnome.org</a> . </p><br><h2 id="rezhim-gnomesessionpresencestatusbusy-i-dbus">  Mode GnomeSession.PresenceStatus.BUSY dan DBus. </h2><br><p>  Jika Anda belum lupa, kami sedang melakukan ekstensi "Jangan Ganggu", yang mematikan tampilan pemberitahuan kepada pengguna. </p><br><p>  GNOME sudah memiliki bendera yang bertanggung jawab untuk keadaan ini.  Setelah pengguna login, proses gnome-session dibuat, di mana flag ini berada: ini adalah atribut GsmPresencePrivate.status, lihat sumber-sumber sesi-gnome, gnome-session / gsm-presence.c.  Kami mendapatkan akses ke flag ini melalui antarmuka DBus (komunikasi antarproses semacam itu). </p><br><p>  Bukan hanya kami, tetapi GH sendiri membutuhkan informasi tentang bendera ini agar tidak menampilkan pemberitahuan.  Ini cukup mudah ditemukan di sumber GH: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._presence = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GnomeSession.Presence(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">proxy, error</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onStatusChanged(proxy.status); }); ... this._presence.connectSignal(<span class="hljs-string"><span class="hljs-string">'StatusChanged'</span></span>, (proxy, senderName, [status]) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._onStatusChanged(status); });</code> </pre> <br><p>  Dalam kasus ini, metode _onStatusChanged adalah penangan yang merespons perubahan status.  Kami menyalin kode ini ke diri kami sendiri, mengadaptasinya - kami menemukan <sup><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">4</a></sup> pemberitahuan, ada suara. </p><br><h2 id="vyklyuchenievklyuchenie-zvuka">  Bungkam / bunyikan </h2><br><p>  Sebagian besar desktop Linux modern dikendalikan oleh PulseAudio, <del>  pekerjaan terkenal </del>  program kepengarangan dari Lennart Poettering yang terkenal kejam.  Sampai sekarang, saya belum sempat menulis kode PulseAudio, dan saya senang mendapat kesempatan untuk memahami PulseAudio pada tingkat tertentu. </p><br><p>  Akibatnya, ternyata untuk mute / unmute, satu utilitas <code>pactl</code> sudah <code>pactl</code> , atau lebih tepatnya tiga perintah berdasarkan itu: </p><br><ul><li>  "info pactl": cari tahu <code>default sink</code> - keluaran suara mana, jika ada beberapa, adalah bunyi default </li><li>  "pactl list sinks": cari tahu status bisu / bunyikan perangkat yang bersangkutan </li><li>  "pactl set-sink-mute% (defaultSink) s% (isMute) s": untuk mute / unmute itu sendiri </li></ul><br><p>  Jadi, tugas kita adalah menjalankan perintah / proses, membaca stdout keluaran mereka dan mencari nilai yang diinginkan secara teratur.  Singkatnya, tugas standar. </p><br><p>  Di GNOME, pustaka inti glib bertanggung jawab untuk membuat proses, dan ada <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">dokumentasi yang</a> sangat bagus di dalamnya.  Dan tentu saja dia di C. Dan kami memiliki JS.  Diketahui bahwa paket Gjs membuat lapisan pintar, "intuitif" antara C-API dan Javascript.  Tetapi Anda masih mengerti bahwa Anda membutuhkan contoh dan Anda tidak dapat melakukannya tanpa googling. </p><br><p>  Alhasil, berkat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">intinya yang</a> sangat baik <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">,</a> kami mendapatkan kode yang berfungsi: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> resList = GLib.spawn_command_line_sync(cmd); <span class="hljs-comment"><span class="hljs-comment">// res = true/false, /   // status = int,    // out/err = ,  stdout/stderr  let [res, out, err, status] = resList; if (res != true || status != 0) { print("not ok!"); } else { // do something useful }</span></span></code> </pre> <br><h2 id="sohranenie-nastroek-v-reestre">  Menyimpan Pengaturan <del>  dalam registri </del></h2><br><p>  Tidak, tentu saja, tidak ada registri di Linux.  Di sini Anda bukan Windows.  Ada yang lebih baik, yang disebut GSettings (ini adalah API), beberapa opsi implementasi tersembunyi di belakangnya, secara default GNOME menggunakan Dconf.  Inilah yang menjadi kerangka kerja GUI untuknya: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0fe/03c/eca/0fe03ceca6c7fc9338377fc5d0909024.png" alt="dconf-editor"></p><br><p>  - Apa yang lebih baik daripada menyimpan pengaturan dalam file teks biasa?  - Tanyakan pengguna Linux yang lama dan berjanggut.  Fitur utama GSettings adalah Anda dapat dengan mudah berlangganan perubahan pada pengaturan, misalnya: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Gio = imports.gi.Gio; settings = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Gio.Settings({ <span class="hljs-attr"><span class="hljs-attr">settings_schema</span></span>: schemaObj }); settings.connect(<span class="hljs-string"><span class="hljs-string">"changed::mute-audio"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ log(<span class="hljs-string"><span class="hljs-string">"I see, you changed it!"</span></span>); });</code> </pre> <br><p>  Satu-satunya pengaturan sejauh ini dalam "Jangan Ganggu" kami adalah opsi "bisu audio", yang memungkinkan pengguna untuk mematikan suara atau tidak selama durasi "jam tenang" atas permintaan pengguna. </p><br><h2 id="i-nemnogo-klassiki-gui-na-gtk">  Dan sedikit klasik, GTK GUI </h2><br><p>  Untuk memperlihatkan kepada pengguna pengaturan ekstensi kami dengan indah (dan tidak masuk ke dalam registri dengan cakar kotor), GH menawarkan kami untuk menulis kode GUI dan memasukkannya ke dalam fungsi buildPrefsWidget () dari file prefs.js.  Dalam hal ini, berlawanan dengan ekstensi kami dalam daftar "Ekstensi yang Dipasang" di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> kita akan melihat tombol tambahan "Konfigurasikan ekstensi ini", dengan mengeklik mana keindahan kami akan muncul. </p><br><p>  Mari kita buat tab About yang terpisah, karena diketahui bahwa tanpa Ebout, maaf, programnya tidak lengkap. </p><br><p>  Secara umum, untuk membangun antarmuka grafis klasik, GTK memiliki seluruh jajaran blok bangunan, <code></code> , yang dapat Anda lihat kuantitas dan kualitasnya di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> . </p><br><p>  Kami hanya akan menggunakan beberapa dari mereka: </p><br><ul><li>  Gtk.Notebook adalah tab, seperti di browser </li><li>  Gtk.VBox adalah wadah untuk menyusun daftar widget secara vertikal </li><li>  Gtk.Label adalah elemen dasar, sebuah prasasti, dengan kemampuan untuk memformat HTML </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildPrefsWidget</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    Gtk.Notebook    GUI let notebook = new Gtk.Notebook(); ... //  About,    VBox c   10 , //   margin/padding   let aboutBox = new Gtk.VBox({ border_width: 10 }); //     About notebook.append_page( aboutBox, new Gtk.Label({label: "About"}), ); //        , //      ,    (expand) aboutBox.pack_start( new Gtk.Label({ label: "&lt;b&gt;Do Not Disturb Time&lt;/b&gt;", use_markup: true, }), true, // expand true, // fill 0, ); ... notebook.show_all(); return notebook; }</span></span></code> </pre> <br><p>  Tangkapan layar akhir: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f87/554/787/f8755478763d159cbb9dfc1518881e60.png"></p><br><h2 id="dopolnitelno">  Opsional </h2><br><div class="spoiler">  <b class="spoiler_title">1. Mode pengoperasian: dukungan dan operasi</b> <div class="spoiler_text"><p>  Pekerjaan programmer melibatkan 2 mode dalam kasus saya: <br>  1) dalam mode dukungan, saat Anda perlu merespons acara dengan cepat - surat, Kendur, Skype, dan lainnya <br>  2) dalam mode operasi, ketika sangat penting untuk mengurangi pemberitahuan setidaknya selama 20 menit, jika tidak maka fokus akan hilang dan produktivitas tenaga kerja akhir dapat diabaikan.  Untuk ini, mode Do Not Disturb berguna. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">2. Cara mematikan suara</b> <div class="spoiler_text"><p>  Tampaknya bisu yang lengkap, bisu, terlalu banyak.  Memang, pada kenyataannya, idealnya, Anda ingin Slack / Skype didengar dalam mode Do Not Disturb, tetapi sisa suara (notifikasi nyata) tidak.  Tetapi untuk ini mereka perlu dibedakan entah bagaimana.  Anda tentu saja dapat membuat API suara khusus untuk notifikasi (dan ini sudah ada), hanya saja selalu ada program / programmer yang tidak menggunakan fungsionalitas tersebut.  Contohnya adalah mailer Mailspring: ia hanya memutar suara melalui tag <code>audio</code> , dan mereka tidak dapat dibedakan dengan cara apa pun, misalnya, dari ucapan dalam panggilan Slack. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">3. PanelMenu.Tombol</b> <div class="spoiler_text"><p>  PanelMenu.Button - ini adalah tombol aktual di menu panel + pop-up, dan Anda dapat mengetahuinya sendiri dan membuatnya dari awal, keduanya akan dihargai oleh <em>orang</em> - <em>orang yang terluka</em> !  Saya mengincar hasil yang cepat, dan karena itu saya menyalin kode dari dokumentasi tidak resmi. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">4. SetStatusRemote ()</b> <div class="spoiler_text"><p>  Sebenarnya memulai perubahan mode menggunakan SetStatusRemote (). </p></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id428187/">https://habr.com/ru/post/id428187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id428175/index.html">Implementasi Awalan Pohon C yang Cunning</a></li>
<li><a href="../id428177/index.html">Jadi apa yang salah dengan mencari pekerjaan / pekerja di bidang TI?</a></li>
<li><a href="../id428179/index.html">Pada pelelangan Jepang, prototipe Wii-controller, yang dikembangkan untuk GameCube</a></li>
<li><a href="../id428181/index.html">Mesin Moral: tanpa ampun atau tidak berarti?</a></li>
<li><a href="../id428183/index.html">Implementasi algoritma Levenberg-Marquardt untuk mengoptimalkan jaringan saraf pada TensorFlow</a></li>
<li><a href="../id428189/index.html">Siapakah Paladin?</a></li>
<li><a href="../id428191/index.html">Apa yang harus kita atur hackathon, atau Bagaimana kita melakukan hackathon internal</a></li>
<li><a href="../id428193/index.html">Tentang pergi wisata</a></li>
<li><a href="../id428197/index.html">Keuangan pribadi yang efektif. Level 1</a></li>
<li><a href="../id428201/index.html">Lubang mol dalam JavaScript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>