<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸŒ˜ ğŸ‘©â€âœˆï¸ ğŸ…ğŸ¿ SmartCard I2Cåè®®ã€‚ é€šè¿‡I2Cæ¥å£äº¤æ¢APDUå‘½ä»¤ ğŸ˜— ğŸ“» ğŸ‘¨ğŸ¿â€ğŸ¤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å¼•è¨€ 
 å‰ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å‚ä¸äº†ä¸€ç§è®¾å¤‡çš„å¼€å‘ï¼Œåœ¨è¯¥è®¾å¤‡ä¸­å¿…é¡»å®ç°ä¿„ç½—æ–¯å¯†ç å­¦ã€‚ ç”±äºå°†æ¥åº”è¯¥è¯æ˜è¿™ä¸€å†³å®šï¼Œå› æ­¤å¯¹å¯†ç å­¦çš„å®æ–½æå‡ºäº†æŸäº›è¦æ±‚ã€‚ ä½œä¸ºç®€åŒ–è¿™äº›è¦æ±‚çš„ä¸€ç§é€‰æ‹©ï¼Œæˆ‘ä»¬è€ƒè™‘äº†å°†æ™ºèƒ½å¡è¯»å–å™¨é›†æˆåˆ°è®¾å¤‡ä¸­æˆ–å®‰è£…æ™ºèƒ½å¡èŠ¯ç‰‡çš„å¯èƒ½æ€§ï¼Œå…¶ä¸­å·²ç»å®ç°äº†å¤„ç†å…³é”®ä¿¡æ¯çš„è®¸å¤šå¿…è¦æ–¹æ¡ˆã€‚ 

 ä¸å¹¸çš„æ˜¯ï¼Œå°½ç®¡æœ‰å¯...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>SmartCard I2Cåè®®ã€‚ é€šè¿‡I2Cæ¥å£äº¤æ¢APDUå‘½ä»¤</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/439574/"><h2> å¼•è¨€ </h2><br> å‰ä¸€æ®µæ—¶é—´ï¼Œæˆ‘å‚ä¸äº†ä¸€ç§è®¾å¤‡çš„å¼€å‘ï¼Œåœ¨è¯¥è®¾å¤‡ä¸­å¿…é¡»å®ç°ä¿„ç½—æ–¯å¯†ç å­¦ã€‚ ç”±äºå°†æ¥åº”è¯¥è¯æ˜è¿™ä¸€å†³å®šï¼Œå› æ­¤å¯¹å¯†ç å­¦çš„å®æ–½æå‡ºäº†æŸäº›è¦æ±‚ã€‚ ä½œä¸ºç®€åŒ–è¿™äº›è¦æ±‚çš„ä¸€ç§é€‰æ‹©ï¼Œæˆ‘ä»¬è€ƒè™‘äº†å°†æ™ºèƒ½å¡è¯»å–å™¨é›†æˆåˆ°è®¾å¤‡ä¸­æˆ–å®‰è£…æ™ºèƒ½å¡èŠ¯ç‰‡çš„å¯èƒ½æ€§ï¼Œå…¶ä¸­å·²ç»å®ç°äº†å¤„ç†å…³é”®ä¿¡æ¯çš„è®¸å¤šå¿…è¦æ–¹æ¡ˆã€‚ <br><br> ä¸å¹¸çš„æ˜¯ï¼Œå°½ç®¡æœ‰å¯èƒ½ä½¿ç”¨è¿™ç§ç°æˆçš„è§£å†³æ–¹æ¡ˆï¼Œä½†ç”±äºæŸç§åŸå› ï¼Œå°½ç®¡å¯ä»¥ä½¿ç”¨ç°æˆçš„ä¿„ç½—æ–¯ç¡¬ä»¶åŠ å¯†æŠ€æœ¯ï¼Œä½†è¿™æ ·å¯ä»¥å¤§å¤§åŠ å¿«æœ€ç»ˆäº§å“çš„å¼€å‘å’Œåç»­è®¤è¯çš„é€Ÿåº¦ã€‚ ä¸èƒ½ä½¿ç”¨USBä»¤ç‰Œæˆ–æ™ºèƒ½å¡çš„åŸå› éå¸¸æ™®éï¼šè¯¥è®¾å¤‡åº”è¯¥éå¸¸ç´§å‡‘ï¼ˆç”¨äºM2Mæˆ–IoTè®¾å¤‡çš„å°æ¨¡å—ï¼‰ï¼Œä¸»è¦åœ¨å…ç»´æŠ¤æ¨¡å¼ä¸‹è¿è¡Œï¼Œå¹¶ä¸”å¯åœ¨è¾ƒå®½çš„æ¸©åº¦èŒƒå›´å†…å·¥ä½œã€‚ <br><br> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³è°ˆè°ˆä½¿ç”¨A7001èŠ¯ç‰‡é’ˆå¯¹è¿™ç§æƒ…å†µçš„å¯èƒ½è§£å†³æ–¹æ¡ˆï¼Œè¯¥èŠ¯ç‰‡é€šè¿‡I2Cæ¥å£è¿æ¥åˆ°ç³»ç»Ÿã€‚ <br><br><img src="https://habrastorage.org/webt/e5/bw/lh/e5bwlh2fhtuxpwj7cdmmt7ujtjc.png"><br><a name="habracut"></a><br><h2> åœ¨PACä¸­å®æ–½åŠ å¯†çš„é—®é¢˜ </h2><br> æˆ‘ä¸æƒ³è¯¦ç»†è®¨è®ºå¯†ç è®¤è¯çš„é—®é¢˜ã€‚ ä¸æ­¤ç›¸å…³çš„äººæ— è®ºå¦‚ä½•éƒ½çŸ¥é“è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯å…¶ä»–äººä¼¼ä¹å¹¶ä¸éœ€è¦å®ƒã€‚ ä½†æ˜¯ä»ç„¶æœ‰ä¸€äº›é‡è¦çš„è§‚ç‚¹å€¼å¾—ä¸€æã€‚ <br><br> ä»ç†è®ºä¸Šè®²ï¼Œå¯†ç å­¦åº”è¯¥æ²¡æœ‰ä»»ä½•ç‰¹æ®Šçš„é—®é¢˜ã€‚ æ¯•ç«Ÿï¼Œé‡‡ç”¨å…¶ä¸­ä¸€ç§åŠ å¯†åº“å°±è¶³å¤Ÿäº†ï¼Œä¾‹å¦‚ï¼ŒOpenSSLæˆ–è®¸å¤šå…¶ä»–ç°æœ‰çš„åŠ å¯†åº“ã€‚ <br><br> å½“éœ€è¦è®¤è¯è¯¥è§£å†³æ–¹æ¡ˆæ—¶ï¼Œé—®é¢˜å°±å¼€å§‹äº†ã€‚ å›ºä»¶ä¸­åŠ å¯†çš„çº¯è½¯ä»¶å®ç°å°†è®¾å¤‡å˜æˆäº†æˆç†Ÿçš„åŠ å¯†ä¿¡æ¯ä¿æŠ¤è®¾å¤‡ï¼Œéœ€è¦åœ¨æµ‹è¯•å®éªŒå®¤è¿›è¡Œä»”ç»†ç ”ç©¶ã€‚ æ¯•ç«Ÿï¼Œåœ¨ä½¿ç”¨åŠ å¯†æŠ€æœ¯å¼€å‘è§£å†³æ–¹æ¡ˆæ—¶ï¼Œè¿Ÿæ—©æ‚¨å°†ä¸å¾—ä¸è€ƒè™‘è¯¸å¦‚å¯†é’¥æ–¹æ¡ˆï¼Œå­˜å‚¨å¯†é’¥ï¼Œç”Ÿæˆéšæœºæ•°ç­‰ç»†å¾®é—®é¢˜ã€‚ <br><br> å¯¹äºæŸäº›è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä¸€ç§ä¼˜é›…çš„æ–¹æ³•å¯ä»¥å®æ–½ç»è¿‡è®¤è¯çš„ä¿„ç½—æ–¯åŠ å¯†ç®—æ³•ï¼Œè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿç¨å¾®ç®€åŒ–åˆ›å»ºç»ˆç«¯è®¾å¤‡çš„è¿‡ç¨‹ï¼Œå¹¶å‡å°‘å…¶å¼€å‘å’Œåç»­è®¤è¯çš„æ—¶é—´ã€‚ å°†æ™ºèƒ½å¡æˆ–æ™ºèƒ½å¡èŠ¯ç‰‡åµŒå…¥è®¾å¤‡ä¸­å°±è¶³å¤Ÿäº†ï¼Œä»¥æ­¤ä½œä¸ºâ€œä¿¡å¿ƒçš„æ ¹æœ¬â€ï¼Œä»è€Œè§£å†³äº†è®¸å¤šç—›è‹¦çš„é—®é¢˜ï¼Œè¿™äº›é—®é¢˜éœ€è¦åœ¨æµ‹è¯•å®éªŒå®¤ä¸­è¿›è¡Œé•¿æ—¶é—´çš„ç ”ç©¶å’Œç¡®è®¤ã€‚ <br><br><img src="https://habrastorage.org/webt/e2/iq/6i/e2iq6i49c7ber2rkbgu6sv8fl3u.png"><br><br><h2> å…·æœ‰I2Cæ¥å£çš„æ™ºèƒ½å¡å¾®æ§åˆ¶å™¨ </h2><br> åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘ä½¿ç”¨äº†A7001èŠ¯ç‰‡ï¼Œè¯¥èŠ¯ç‰‡é€šè¿‡I2Cæ€»çº¿è¿æ¥åˆ°ç»ˆç«¯è®¾å¤‡ï¼Œè¯¥æ€»çº¿å‡ ä¹å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸­ä½¿ç”¨ã€‚ è¯¥èŠ¯ç‰‡ç”±<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Aladdin RD</a>æä¾›ï¼Œè¯¥å…¬å¸å·²ç»å®‰è£…äº†æ”¯æŒä¿„ç½—æ–¯å¯†ç çš„å›ºä»¶ã€‚ <br><br> å¾®æ§åˆ¶å™¨A7001AGï¼ˆå®‰å…¨è®¤è¯å¾®æ§åˆ¶å™¨ï¼‰ç”±NXPåˆ¶é€ ã€‚ æ ¹æ®èŠ¯ç‰‡ä¸Šçš„æ•°æ®è¡¨ï¼Œ <b>A7001AG</b>æ˜¯åŸºäºç»å…¸80C51æ¶æ„å’Œå¯†ç åå¤„ç†å™¨çš„å¾®æ§åˆ¶å™¨ï¼Œ <b>å¯é˜²æ­¢</b>æœªç»æˆæƒçš„è®¿é—®ã€‚ <br><br> åœ¨çœç”µæ¨¡å¼ä¸‹ï¼Œå¾®æ§åˆ¶å™¨æ¶ˆè€—50Î¼Aã€‚ å®ƒæ”¯æŒ1.62Vè‡³5.5Vçš„ç”µæºç”µå‹ï¼Œå¯åœ¨âˆ’25Â°Cè‡³+ 85Â°Cçš„æ¸©åº¦èŒƒå›´å†…å·¥ä½œã€‚ <br><br> ä¸ºäº†ä¸å¤–éƒ¨è®¾å¤‡è¿›è¡Œäº¤äº’ï¼ŒI2Cä»æ¥å£çš„ä½¿ç”¨é€Ÿåº¦é«˜è¾¾100 kbit / sã€‚ <br><br> è¯¥å¾®æ§åˆ¶å™¨æœ‰å‡ ç§å¤–å£³å¯ä¾›é€‰æ‹©ã€‚ æˆ‘æœ€ç»ˆä½¿ç”¨äº†HVQFN32æ ¼å¼ã€‚ è¿™æ˜¯ä¸€ä¸ªå¡‘æ–™å¤–å£³ï¼Œå°ºå¯¸ä¸º5x5x0.85 mmï¼Œå…·æœ‰32ä¸ªè§¦ç‚¹ï¼Œé—´è·ä¸º0.5 mmã€‚ <br><br> æ¡ˆä»¶å¤–è§‚ï¼š <br><br><img src="https://habrastorage.org/webt/tn/7r/mz/tn7rmzk8pbzw1ezupbdv7fxvqhm.png"><br><br> ä»–çš„é’ˆè„šï¼š <br><br><img src="https://habrastorage.org/webt/tr/bo/5r/trbo5rlj2_q0v-lxbs7wbqevlu0.png"><br><br><h2> ç”¨äºè¿æ¥A7001èŠ¯ç‰‡çš„ä¸»æœºç³»ç»Ÿ </h2><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Heltecçš„ESP32 WiFi Kit 32</a>æ¿è¢«ç”¨ä½œå…·æœ‰I2Cæ¥å£çš„ä¸»æœºç³»ç»Ÿçš„å¸ƒå±€ã€‚ å®ƒçš„ä»·æ ¼ä¸åˆ°1000å¢å¸ƒï¼Œå…·æœ‰æ‰€æœ‰å¿…éœ€çš„æœ‰çº¿å’Œæ— çº¿æ¥å£ï¼Œè¿˜æœ‰ä¸€ä¸ªç”¨äºè¿æ¥é”‚ç”µæ± å’Œå……ç”µç”µè·¯çš„è¿æ¥å™¨ä»¥åŠ0.96è‹±å¯¸çš„OLEDæ˜¾ç¤ºå±ã€‚ <br><br><img src="https://habrastorage.org/webt/uf/kq/li/ufkqlihfpi9w0692rq8junv0ybo.jpeg"><br><br> æˆ‘ä¸€ç›´æƒ³ä½¿ç”¨çš„å‡ ä¹å®Œç¾çš„ç³»ç»Ÿï¼Œç”¨äºä¸ºå„ç§IoTå’ŒM2Mè®¾å¤‡åˆ¶ä½œåŸå‹ã€‚ <br><br> è¯¥æ¿å¯åœ¨æœ¬æœºå¼€å‘ç¯å¢ƒå’ŒArduino IDEä¸­è¿›è¡Œç¼–ç¨‹ã€‚ æœ‰è®¸å¤šä½¿ç”¨å®ƒçš„ç¤ºä¾‹ã€‚ ä¸ºç®€å•èµ·è§ï¼Œæˆ‘é€‰æ‹©äº†æ ‡å‡†çš„Arduino IDEã€‚ <br><br><h2> ç”µè·¯å›¾ </h2><br> å›¾ä¸­æ˜¾ç¤ºäº†è¿æ¥A7001èŠ¯ç‰‡çš„ç”µè·¯å›¾ã€‚  <s>å®ƒä¸æ¨èçš„æ•°æ®è¡¨ç•¥æœ‰ä¸åŒã€‚</s>  <s>æ ¹æ®åˆ¶é€ å•†çš„æè¿°ï¼Œç«¯å­22ï¼ˆå¤ä½ä¿¡å·RST_Nï¼‰åº”å…·æœ‰é«˜ç”µåŠ¿ï¼Œä½†ç”µè·¯å¹¶æœªæŒ‰ç…§æ­¤æ–¹æ¡ˆå¯åŠ¨ã€‚</s>  <s>ä½œä¸ºâ€œç§‘å­¦æˆ³â€çš„ç»“æœï¼Œé€šè¿‡å°†ä¸Šæ‹‰ç”µé˜»å™¨R4è¿æ¥åˆ°è´Ÿæç”µæºçº¿å¯å®ç°å¯æ“ä½œæ€§ã€‚</s> <br><br>  <i>æ›´æ–°ï¼šå¦‚æ³¨é‡Šä¸­æ‰€å»ºè®®ï¼Œè¯¥æ¨¡å¼å¯¹åº”äºæ•°æ®è¡¨ï¼Œè€Œè¾“å‡ºæè¿°ä½¿æˆ‘æ„Ÿåˆ°å›°æƒ‘</i> <blockquote>  RST_N-å¤ä½è¾“å…¥ï¼Œ <b>ä½ç”µå¹³æœ‰æ•ˆ</b> </blockquote><br><br><img src="https://habrastorage.org/webt/ud/l3/nd/udl3nd7nz2ck8gtwkb3dhdudzqy.png"><br><br> è¯¥ç”µè·¯ç»„è£…åœ¨ä¸€ä¸ªå°é¢åŒ…æ¿ä¸Šã€‚ ç”µæºå’ŒI2Cä¿¡å·é€šè¿‡å››æ ¹è¿æ¥çº¿è¿æ¥ï¼ŒESP32æ¨¡å—æœ¬èº«é€šè¿‡USBè¿æ¥åˆ°è®¡ç®—æœºï¼Œä»¥ä¸ºæ•´ä¸ªç”µè·¯ä¾›ç”µå¹¶å¡«å……å›ºä»¶ã€‚ <br><br><img src="https://habrastorage.org/webt/de/xz/w1/dexzw1kvlnoixvk0ko-9svuvkbg.png"><br><br><h2> æ™ºèƒ½å¡I2Cåè®® </h2><br> å½“æˆ‘ç¬¬ä¸€æ¬¡å¬è¯´è¦é€šè¿‡I2Cæ€»çº¿è¿æ¥æ™ºèƒ½å¡å¾®æ§åˆ¶å™¨æ—¶ï¼Œä»–ä»¬å‘æˆ‘è§£é‡Šè¯´ï¼Œæ™ºèƒ½å¡æ¥å£çš„ç‰©ç†å±‚ï¼ˆGOST R ISO / IEC 7816-3-2013ï¼‰å·²è¢«I2Cï¼ˆSMBusï¼‰å–ä»£ï¼Œå…¶ä»–æ‰€æœ‰æ“ä½œéƒ½åƒå¾€å¸¸ä¸€æ ·ç¬¦åˆGOST R ISO / IEC 7816-4-2013çš„æ™ºèƒ½å¡ï¼Œå¹¶ä½¿ç”¨APDUå‘½ä»¤ã€‚ <br><br> äº‹å®è¯æ˜ï¼Œè¿™ä¸æ˜¯çœŸçš„ï¼Œæˆ–è€…æ ¹æœ¬ä¸æ˜¯ã€‚ ä½¿ç”¨å¸¸è§„çš„APDUå‘½ä»¤ç¡®å®ä¼šä¸å¾®æ§åˆ¶å™¨è¿›è¡Œé«˜å±‚äº¤äº’ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨ä¸€äº›â€œç¼ºç‚¹â€ã€‚ <br><br><ol><li>  I2Cæ¥å£ï¼ˆSMBusï¼‰ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ru.wikipedia.org/wiki/I%C2%B2C</a>æ˜¯å…·æœ‰ä»å±å¯»å€çš„æ€»çº¿ï¼Œå®ƒä¸ä¸²è¡ŒUARTæ¥å£æœ‰æ ¹æœ¬çš„ä¸åŒï¼Œä¸²è¡ŒUARTæ¥å£æ—¨åœ¨ç‚¹å¯¹ç‚¹é€šä¿¡ä¸¤ä¸ªè®¾å¤‡ï¼Œè€Œä¸ä½¿ç”¨å¯»å€ã€‚ è¿™æ„å‘³ç€å¿…é¡»å°†æ‰€æœ‰ä¼ è¾“çš„æ•°æ®ï¼ˆAPDUå‘½ä»¤ï¼‰â€œæ‰“åŒ…â€ä¸ºI2Cæ€»çº¿æ•°æ®æ ¼å¼ã€‚ </li><li> æ™ºèƒ½å¡çš„å·¥ä½œé€šå¸¸ä»å…³é—­ç”µæºå¼€å§‹ï¼Œä¾‹å¦‚ä»ç‰©ç†ä¸Šå°†å¡ä»è¯»å¡å™¨ä¸­å–å‡ºæ¥è¿›è¡Œå¤ä½ã€‚ é‡ç½®åï¼Œæ™ºèƒ½å¡é¦–å…ˆå‘é€ATRï¼ˆé‡ç½®å“åº”ï¼‰æ•°æ®å—ï¼Œå…¶ä¸­åŒ…å«é…ç½®ä¸æ™ºèƒ½å¡äº¤äº’æ‰€å¿…éœ€çš„é…ç½®ä¿¡æ¯ã€‚ <br>  I2Cæ€»çº¿ä¸Šçš„èŠ¯ç‰‡ä¹Ÿä¸ä¾‹å¤–ï¼Œä½†æ˜¯åœ¨å¾®æ§åˆ¶å™¨åº”ç„Šæ¥åˆ°å°åˆ·ç”µè·¯æ¿ä¸Šçš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½æ²¡æœ‰å¾®ç”µè·¯çš„ç”µæºç”µè·¯æˆ–å¤ä½è¾“å‡ºçš„è½¯ä»¶æ§åˆ¶ã€‚ å› æ­¤ï¼ŒåŒ…æ‹¬åœ¨I2Cåè®®å‘½ä»¤çº§åˆ«å®ç°èŠ¯ç‰‡çš„å¤ä½ã€‚ </li></ol><br> è¿™äº›é—®é¢˜å’Œå…¶ä»–é—®é¢˜åœ¨æ™ºèƒ½å¡I2Cåè®®æ¡†æ¶å†…å¾—åˆ°è§£å†³ï¼Œæœ‰å…³æè¿°ï¼Œè¯·è®¿é—®NXPç½‘ç«™<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.nxp.com/docs/en/supporting-information/AN12207.pdf</a> ã€‚ <br><br><h2> è½¯ä»¶éƒ¨åˆ† </h2><br> ä½¿ç”¨<i>æ™ºèƒ½å¡I2Cåè®®åè®®</i>çš„åº“æœç´¢æœªè¿”å›ä»»ä½•ç»“æœã€‚ å› æ­¤ï¼Œæˆ‘å¿…é¡»äº†è§£è§„èŒƒå¹¶å®ç°ç°æœ‰åŠŸèƒ½çš„åŸºæœ¬åŠŸèƒ½ã€‚ <br><br><div class="spoiler">  <b class="spoiler_title">Arduino IDEçš„è‰å›¾æº</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Wire.h&gt; #include &lt;vector&gt; // I2C address on chip A7001 #define ADDR_A7001 static_cast&lt;uint16_t&gt;(0x48) using namespace std; typedef std::vector&lt;uint8_t&gt; vect; //-------------------------------------------------------------------------- // Output dump data by serial port void vect_dump(const char * prefix, const vect &amp; v, const size_t start = 0, const size_t count = 0) { if(prefix) { Serial.print(prefix); } if(v.size() &lt; start) { Serial.println("Empty"); return; } for(size_t i=0; i &lt; (v.size()-start) &amp;&amp; (count == 0 || i &lt; count); i++) { uint8_t b = v[start + i]; // Format output HEX data if(i) Serial.print(" "); if(b &lt; 0x0F) Serial.print("0"); Serial.print(b, HEX); } Serial.println(""); } //-------------------------------------------------------------------------- // Send array bytes by I2C to address A7001 and read response result_size bytes vect sci2c_exchange(const vect data, const uint8_t result_size) { Wire.beginTransmission(ADDR_A7001); Wire.write(data.data(), data.size()); Wire.endTransmission(false); Wire.requestFrom(ADDR_A7001, result_size, true); //delay(1); vect result(result_size, 0); if(result_size &gt;= 2) { result[0] = Wire.read(); // Data size CDB result[1] = Wire.read(); // PCB for(size_t i=2; i&lt;result.size()-2 &amp;&amp; Wire.available(); i++) { result[i+2] = Wire.read(); } } return result; } //-------------------------------------------------------------------------- // Read Status Code uint8_t sci2c_status(const char * msg = nullptr) { vect v = sci2c_exchange({0b0111}, 2); uint8_t status = v[1] &gt;&gt; 4; if(msg) { Serial.print(msg); // Prefix switch(status) { case 0b0000: Serial.println("OK (Ready)"); break; case 0b0001: Serial.println("OK (Busy)"); break; case 0b1000: Serial.println("ERROR (Exception raised)"); break; case 0b1001: Serial.println("ERROR (Over clocking)"); break; case 0b1010: Serial.println("ERROR (Unexpected Sequence)"); break; case 0b1011: Serial.println("ERROR (Invalid Data Length)"); break; case 0b1100: Serial.println("ERROR (Unexpected Command)"); break; case 0b1101: Serial.println("ERROR (Invalid EDC)"); break; default: Serial.print("ERROR (Other Exception "); Serial.print(status, BIN); Serial.println("b)"); break; } } return status; } static uint8_t apdu_master_sequence_counter = 0; // Sequence Counter Master, Master to Slave //-------------------------------------------------------------------------- // Send APDU void sci2c_apdu_send(const vect apdu) { vect_dump("C-APDU =&gt; ", apdu); vect data(2, 0); // 0x00 - Master to Slave Data Transmission command + reserve to length data.insert(data.end(), std::begin(apdu), std::end(apdu)); data[0] |= (apdu_master_sequence_counter &lt;&lt; 4); if(++apdu_master_sequence_counter &gt; 0b111) { apdu_master_sequence_counter = 0; } data[1] = data.size() - 2; sci2c_exchange(data, 2); delay(10); sci2c_status(""); } //-------------------------------------------------------------------------- // Receive APDU vect sci2c_apdu_recv(uint8_t result_size) { Wire.beginTransmission(ADDR_A7001); Wire.write(0b0010); // 0010b - Slave to Master Data Transmission command Wire.endTransmission(false); Wire.requestFrom(ADDR_A7001, result_size, true); vect result(result_size, 0); for(size_t i=0; i&lt;result.size() &amp;&amp; Wire.available(); i++) { result[i] = Wire.read(); } vect_dump("R-APDU &lt;= ", result); return result; } //-------------------------------------------------------------------------- void setup(){ Wire.begin(); Serial.begin(9600); while (!Serial); Serial.println(""); Serial.println("Smart Card I2C Protocol Arduino demo on A7001"); Serial.println(""); sci2c_exchange({0b00001111}, 2); //The bits b0 to b5 set to 001111b indicate the Wakeup command. sci2c_status("Status Wakeup: "); sci2c_exchange({0b00001111}, 2); //The bits b0 to b5 set to 001111b indicate the Wakeup command. sci2c_status("Status Wakeup: "); // Soft Reset sci2c_exchange({0b00011111}, 2); //The bits b0 to b5 set to 011111b indicate the Soft Reset command. delay(5); // Wait at least tRSTG (time, ReSeT Guard) sci2c_status("Status SoftReset: "); // Read ATR vect ATR = sci2c_exchange({0b101111}, 29+2); //The bits b0 to b5 set to 101111b indicate the Read Answer to Reset command. sci2c_status("Status ATR: "); vect_dump("ATR: ", ATR, 2); // Parameter Exchange // The bits b0 to b5 set to 111111b of the PCB send by the master device indicate the Parameter Exchange command. // The bits b6 and b7 of the PCB send by the master device code the CDBIsm,max(Command Data Bytes Integer, Slave to Master, MAXimum) vect CDB = sci2c_exchange({0b11111111}, 2); sci2c_status("Status CDB: "); vect_dump("CDB: ", CDB, 1); // Further examples of the exchange of APDU // Exchanges APDU from exmaple chapter sci2c_apdu_send({0x00, 0xA4, 0x04, 0x04, 0x04, 0x54, 0x65, 0x73, 0x74, 0x00}); sci2c_status("Status Test send: "); sci2c_apdu_recv(3+1); // R-APDU size + 1 byte PBC sci2c_status("Status Test recv: "); // Read Card Production Life Cycle sci2c_apdu_send({0x80, 0xCA, 0x9F, 0x7F, 0x00}); sci2c_status("Status card LC send: "); sci2c_apdu_recv(0x30+1); // R-APDU size + 1 byte PBC sci2c_status("Status card LC recv: "); // Read Card Info sci2c_apdu_send({0x80, 0xCA, 0x00, 0x66, 0x00}); sci2c_status("Status card info send: "); sci2c_apdu_recv(0x51+1); // R-APDU size + 1 byte PBC sci2c_status("Status card info recv: "); // Read Key Info sci2c_apdu_send({0x80, 0xCA, 0x00, 0xE0, 0x00}); sci2c_status("Status key send: "); sci2c_apdu_recv(0x17+1); // R-APDU size + 1 byte PBC sci2c_status("Status key recv: "); // Again exchanges APDU from exmaple chapter sci2c_apdu_send({0x00, 0xA4, 0x04, 0x04, 0x04, 0x54, 0x65, 0x73, 0x74, 0x00}); sci2c_status("Status Test send: "); sci2c_apdu_recv(3+1); // R-APDU size + 1 byte PBC sci2c_status("Status Test recv: "); Serial.println("Done!\n"); } //-------------------------------------------------------------------------- void loop() { delay(100); }</span></span></span></span></code> </pre> <br></div></div><br> ä¸ºäº†ä½¿ç”¨I2Cç«¯å£ï¼Œæˆ‘ä½¿ç”¨äº†æ ‡å‡†çš„Wireåº“ã€‚ æˆ‘å¿…é¡»é©¬ä¸Šè¯´ï¼Œè¯¥åº“ä¸é€‚åˆå®Œå…¨å®ç°æ™ºèƒ½å¡I2Cåè®®ï¼Œå› ä¸º å½“å‘é€å’Œè¯»å–å•ä¸ªå­—èŠ‚æ—¶ï¼Œå®ƒä¸å…è®¸æ§åˆ¶ACKå’ŒNACKï¼Œè¿™æ˜¯å®ç°ä»æ™ºèƒ½å¡æ­£ç¡®æ¥æ”¶å¯å˜é•¿åº¦æ•°æ®æ‰€å¿…éœ€çš„ã€‚ <br><br> æ˜¯çš„ï¼Œå¹¶ä¸”Wireä»£ç çš„å¸¸è§„ç¤ºä¾‹ç¬¬ä¸€æ¬¡æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨<s>é“ƒé¼“</s>é”®ç›˜è·³èˆï¼Œå‡ å‡å’–å•¡ï¼Œåœ¨Yandexä¸­ä½¿ç”¨è°·æ­Œæœç´¢å’Œåœ¨Googleä¸­ä½¿ç”¨Yandexè¿›è¡Œæœç´¢ä¹‹åï¼Œæ‰¾åˆ°äº†è§£å†³æ–¹æ¡ˆã€‚ <br><br><pre> <code class="cpp hljs">Wire.write ( ); Wire.endTransmission (<span class="hljs-literal"><span class="hljs-literal">false</span></span>); Wire.requestFrom (ADDR_A7001, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br> ä»åº“æ–‡æ¡£åˆ¤æ–­ï¼Œæ­¤è®¾è®¡åœ¨è°ƒç”¨<i>endTransmission</i>ä¹‹åä¸ä¼šé‡Šæ”¾I2Cæ€»çº¿ã€‚ ä½†æ˜¯äº‹å®è¯æ˜ï¼Œå¯¹äºæˆ‘ä½¿ç”¨çš„åŸºäºESP32çš„æ¨¡å—ï¼Œåœ¨è°ƒç”¨<i>endTransmissionï¼ˆfalseï¼‰</i>æœŸé—´ï¼Œå®é™…ä¸Šä¸ä¼šå‘ç”Ÿæ•°æ®ä¼ è¾“ï¼Œå°±åƒåœ¨Wireåº“çš„æ–‡æ¡£ä¸­æ‰€å†™çš„é‚£æ ·ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨<i>requestFromï¼ˆtrueï¼‰æœŸé—´</i> ï¼Œè€Œæ•°æ®ä»…åœ¨æ­¤ä¹‹å‰æ’é˜Ÿè½¬ç§»ã€‚ <br><br> é‰´äºè¿™æ ·çš„é™åˆ¶ï¼Œæˆ‘ä¸å¾—ä¸åšä¸€äº›â€œæ‹æ–â€ï¼Œä½†æ˜¯æˆ‘çœŸçš„å¾ˆæƒ³åœ¨ä¸é‡å†™æ ‡å‡†åº“çš„æƒ…å†µä¸‹å¯åŠ¨A7001èŠ¯ç‰‡ã€‚ å› æ­¤ï¼Œæœªå®ç°åè®®é”™è¯¯å¤„ç†ï¼Œä¹Ÿæ— æ³•æ¥æ”¶å¯å˜é•¿åº¦çš„æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œæ‚¨å§‹ç»ˆéœ€è¦æŒ‡å®šè¦è¯»å–çš„ç¡®åˆ‡å­—èŠ‚æ•°ï¼‰ã€‚ <br><br> è¿™ç§é™åˆ¶åœ¨å®é™…ç³»ç»Ÿä¸­æ˜¯ä¸å…è®¸çš„ï¼Œä½†å¯¹äºåœ¨I2Cæ€»çº¿ä¸Šå·¥ä½œæ—¶æ¼”ç¤ºAPDUå‘½ä»¤çš„ä½¿ç”¨å¹¶ä¸æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ å› æ­¤ï¼Œå¦‚æœé€šè¿‡I2Cç«¯å£äº¤æ¢æ•°æ®æ—¶åœ¨äº¤æ¢åè®®ä¸­å‘ç”Ÿé”™è¯¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°†ä½¿ç”¨ç”µæºåˆ‡æ¢å¼€å…³ã€‚ <br> æ¢å¥è¯è¯´ï¼Œå¦‚æœåœ¨é‡å¤è¿™äº›å®éªŒè¿‡ç¨‹ä¸­ä¸€åˆ‡æ­£å¸¸å¹¶ä¸”çªç„¶åœæ­¢ï¼Œç„¶åå†å¯»æ‰¾ä»£ç é”™è¯¯ï¼Œè¯·å…³é—­ç”µæºç„¶åå†æ‰“å¼€ã€‚ å¾ˆæœ‰å¯èƒ½è§£å†³æ­¤é—®é¢˜ã€‚ <br><br><h2> ä½¿ç”¨A7001èŠ¯ç‰‡çš„ä»£ç ç¤ºä¾‹ </h2><br> åœ¨ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä½¿ç”¨äº†å‡ ä¸ªè¾…åŠ©å‡½æ•°ï¼š <br><br>  <b>vect_dump-</b>å°†åå…­è¿›åˆ¶æ ¼å¼çš„è½¬å‚¨æ•°æ®è¾“å‡ºåˆ°è°ƒè¯•ç«¯å£ï¼› <br>  <b>sci2c_exchange-</b>é€šè¿‡I2Cå‘é€æ•°æ®æ•°ç»„å¹¶è¯»å–æŒ‡å®šæ•°é‡çš„å“åº”å­—èŠ‚ï¼› <br>  <b>sci2c_status-</b>è¯»å–å¾®ç”µè·¯çš„å“åº”çŠ¶æ€ï¼Œå¹¶åœ¨å¿…è¦æ—¶åœ¨è°ƒè¯•ç«¯å£ä¸­æ˜¾ç¤ºå…¶çŠ¶æ€ï¼› <br>  <b>sci2c_apdu_send-</b>å‘é€APDUå‘½ä»¤; <br>  <b>sci2c_apdu_recv-</b>è¯»å–å¯¹APDUå‘½ä»¤çš„å“åº”ã€‚ <br><br><h3> å¾®èŠ¯ç‰‡åˆå§‹åŒ– </h3><br> æ ¹æ®å¯¹<i>æ™ºèƒ½å¡I2Cåè®®</i>çš„æè¿°ï¼Œåœ¨å¼€å§‹ä½¿ç”¨èŠ¯ç‰‡ä¹‹å‰ï¼Œåº”æŒ‰é¡ºåºæ‰§è¡Œä¸‰ä¸ªå‘½ä»¤ï¼šé‡æ–°å¼•å¯¼ï¼ˆå†·å¤ä½æˆ–è½¯å¤ä½ï¼‰ï¼Œè¯»å–ATRï¼ˆè¯»å–å¯¹å¤ä½çš„åº”ç­”ï¼‰å’Œè®¾ç½®äº¤æ¢å‚æ•°ï¼ˆä¸»è®¾å¤‡äº¤æ¢å‚æ•°ï¼‰ã€‚ å¹¶ä¸”åªæœ‰åœ¨æ­¤ä¹‹åï¼ŒèŠ¯ç‰‡æ‰å‡†å¤‡æ¥å—APDUå‘½ä»¤ã€‚ <br><br><h3> è½¯é‡ç½® </h3><br> è¿™é‡Œçš„ä¸€åˆ‡éƒ½å¾ˆç®€å•ï¼Œæˆ‘ä»¬å‘é€ä¸€ä¸ªé‡æ–°å¯åŠ¨å‘½ä»¤å¹¶ç­‰å¾…è®¾ç½®çš„æ—¶é—´ï¼š <br><br><pre> <code class="cpp hljs">sci2c_exchange ({<span class="hljs-number"><span class="hljs-number">0b00011111</span></span>}, <span class="hljs-number"><span class="hljs-number">2</span></span>); delay(<span class="hljs-number"><span class="hljs-number">5</span></span>); <span class="hljs-comment"><span class="hljs-comment">//      (tRSTG, time, ReSeT Guard)</span></span></code> </pre><br><h3> é˜…è¯»ç­”æ¡ˆä»¥é‡ç½® </h3><br> è¯»å–ATRæœ‰ç‚¹å¤æ‚ï¼Œå› ä¸º æ‚¨ä¸ä»…éœ€è¦å‘é€å‘½ä»¤ï¼Œè¿˜éœ€è¦è¯»å–å“åº”æ•°æ®ã€‚ æ ¹æ®åè®®æè¿°ï¼Œè¿”å›çš„æ•°æ®CDBATSçš„æœ€å¤§å¤§å°MAXï¼ˆå‘½ä»¤æ•°æ®å­—èŠ‚ï¼Œå¤ä½åº”ç­”ï¼ŒMAXimumï¼‰å¯ä»¥ä¸º29ä¸ªå­—èŠ‚ã€‚ <br><br><pre> <code class="cpp hljs">vect ATR = sci2c_exchange({<span class="hljs-number"><span class="hljs-number">0b101111</span></span>}, <span class="hljs-number"><span class="hljs-number">29</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 29  + 1  PCB + 1  â€”   vect_dump("ATR: ", ATR);</span></span></code> </pre><br> è¯»å–ATRæ•°æ®ï¼š <b>1E 00 00 00 B8 03 11 01 05 B9 02 01 01 BA 01 01 BB 0D 41 37 30 30 31 43 47 20 32 34 32 52 31</b> <br><br> å…¶ä¸­1Eæ˜¯è¿”å›æ•°æ®çš„å¤§å°ï¼ˆ29å­—èŠ‚+ 1å­—èŠ‚çš„PCBï¼‰ï¼Œ00æ˜¯PCBï¼ˆåè®®æ§åˆ¶å­—èŠ‚ï¼‰ï¼Œåº”ç­‰äº0ï¼Œå¹¶ä¸”æ˜¾ç„¶ï¼Œåœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ•°æ®æœªæ­£ç¡®è¯»å–ï¼ˆPCBåº”è¯¥æœ‰ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶ä¸”å…¶ä¸­æœ‰ä¸‰ä¸ªï¼‰ã€‚ <br><br> ä»¥ä¸‹æ˜¯ä»¥TLVæ ¼å¼ç¼–ç çš„æ•°æ®ï¼š <br><br>  <b>B8h-</b> <i>ä½çº§æ•°æ®å¯¹è±¡</i> ï¼Œå¤§å°ä¸º3ä¸ªå­—èŠ‚ï¼ˆ <i>11h 01h 05h</i> ï¼‰; <br>  <b>B9h-</b> <i>åè®®ç»‘å®šæ•°æ®å¯¹è±¡</i> ï¼Œå¤§å°ä¸º2ä¸ªå­—èŠ‚ï¼ˆ <i>01h 01h</i> ï¼‰ï¼› <br>  <b>BAh-</b> <i>é«˜å±‚æ•°æ®å¯¹è±¡</i> ï¼Œå¤§å°ä¸º1ä¸ªå­—èŠ‚ï¼ˆ <i>01h</i> ï¼‰ï¼› <br>  <b>BBh-</b> <i>æ“ä½œç³»ç»Ÿæ•°æ®å¯¹è±¡</i> ï¼Œ13ä¸ªå­—èŠ‚ï¼ˆ <i>41 37 30 30 31 43 47 20 32 34 32 52 31</i> ï¼‰ã€‚ <br><br>  <b>è§£å¯†èŠ¯ç‰‡çš„è¯»å–é…ç½®</b> <br>  <i>åº•å±‚æ•°æ®å¯¹è±¡</i> ï¼š <b>11h-</b>å—æ”¯æŒåè®®çš„<b>ä¸»è¦</b>ç‰ˆæœ¬å’Œæ¬¡è¦ç‰ˆæœ¬ã€‚ <br><br>  <i>é”™è¯¯æ£€æµ‹ä»£ç </i> ï¼š <b>01h-</b>æ”¯æŒä½¿ç”¨LRCï¼ˆçºµå‘å†—ä½™ä»£ç ï¼‰è¿›è¡Œé”™è¯¯æ£€æµ‹å’Œå·²ä¼ è¾“æ•°æ®çš„å®Œæ•´æ€§æ§åˆ¶ã€‚ <br><br>  <i>å¸§ç­‰å¾…æ•´æ•°ï¼ˆFWIï¼‰</i> ï¼š <b>05h-</b>ä¸¤ä¸ªå‘½ä»¤ä¹‹é—´çš„æœ€å¤§å»¶è¿Ÿã€‚ å€¼çš„èŒƒå›´å¯ä»¥ä»10æ¯«ç§’åˆ°5120æ¯«ç§’ï¼Œé»˜è®¤å€¼ä¸º5120æ¯«ç§’ã€‚ è¯¥å€¼ç”±å…¬å¼T = 10ms x 2 ^ FWIè®¡ç®—å¾—å‡ºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„å»¶è¿Ÿä¸º320æ¯«ç§’ï¼ˆ10æ¯«ç§’x 2 ^ 5ï¼‰ã€‚ <br><br>  <i>åè®®ç»‘å®šæ•°æ®å¯¹è±¡</i> -ç”±ä¸¤ä¸ªå€¼<b>01h 01hç»„æˆ</b> ï¼Œå®ƒä»¬å¯¹æ”¯æŒçš„åè®®å’Œé»˜è®¤åè®®è¿›è¡Œç¼–ç ã€‚ è¿™äº›å€¼è¡¨ç¤ºæ”¯æŒAPDUåè®®[GOST R ISO / IEC 7816-3-2013]ï¼Œå¹¶ä¸”ï¼Œæ‚¨å¯èƒ½ä¼šçŒœåˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šå®‰è£…ç›¸åŒçš„åè®®ã€‚ <br><br>  <i>é«˜å±‚æ•°æ®å¯¹è±¡</i> -æ•°å­—<b>01h</b>è¡¨ç¤ºæ”¯æŒçŸ­å’Œæ‰©å±•APDUæ ¼å¼ã€‚ <br><br> æ ¹æ®æ ‡å‡†[GOST R ISO / IEC 7816-4-2013]çš„å®šä¹‰ï¼Œ <i>æ“ä½œç³»ç»Ÿæ•°æ®å¯¹è±¡</i>æ˜¯æœ€å¤§15ä¸ªå­—èŠ‚çš„æ ‡è¯†ç¬¦ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¿™æ˜¯å­—ç¬¦ä¸²â€œ <i>A7001CG 242R1</i> â€ã€‚ <br><br><h3> ä¸»è®¾å¤‡äº¤æ¢å‚æ•° </h3><br> æœ€åä¸€ä¸ªåˆå§‹åŒ–äº¤æ¢è®¾ç½®çš„å‘½ä»¤ï¼š <br><br><pre> <code class="cpp hljs">vect CDB = sci2c_exchange({<span class="hljs-number"><span class="hljs-number">0b11111111</span></span>}, <span class="hljs-number"><span class="hljs-number">2</span></span>); sci2c_status(<span class="hljs-string"><span class="hljs-string">"Status CDB: "</span></span>); vect_dump(<span class="hljs-string"><span class="hljs-string">"CDB: "</span></span>, CDB, <span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br> è¿”å›å€¼ï¼šæ ¹æ®æ•°æ®æ‰‹å†Œï¼ŒCCh-ï¼ˆ11001100bï¼‰ï¼Œç¬¬4ä½å’Œç¬¬5ä½åº”ä¸ºç¬¬2ä½å’Œç¬¬3ä½çš„æŒ‰ä½å–åï¼ˆNNbå¯¹æŒ‰ä½å–åçš„CDBIMSï¼ŒMAXï¼‰è¿›è¡Œç¼–ç ï¼Œå¹¶ä¸”æ ¹æ®ç¼–ç åçš„å€¼ï¼ŒèŠ¯ç‰‡æ”¯æŒæœ€å¤§å¯èƒ½çš„å‘½ä»¤å¤§å°ä¸º252å­—èŠ‚CDBIMS ï¼ŒMAXï¼ˆå‘½ä»¤æ•°æ®å­—èŠ‚æ•´æ•°ï¼Œä»æœºåˆ°ä»æœºï¼ŒMAXimumï¼‰å€¼ã€‚ <br><br> æ ¹æ®åè®®æè¿°ï¼Œåœ¨æŒ‰é¡ºåºæ‰§è¡Œè¿™ä¸‰ä¸ªå‘½ä»¤ä¹‹åï¼Œå¾®ç”µè·¯å·²å‡†å¤‡å¥½æ‰§è¡Œå¸¸è§„çš„APDUå‘½ä»¤ï¼ˆå°½ç®¡å®ƒä¼¼ä¹æ— éœ€è®¾ç½®äº¤æ¢å‚æ•°å³å¯å·¥ä½œï¼Œå³è¶³ä»¥è¿›è¡Œè½¯å¤ä½å¹¶è¯»å–ATRï¼‰ã€‚ <br><br><h2> æ‰§è¡ŒAPDUå‘½ä»¤ </h2><br>  <b>æ¯ä¸ªæ‰§è¡ŒAPDUå‘½ä»¤çš„å‘¨æœŸåŒ…æ‹¬ä»¥ä¸‹æ­¥éª¤ï¼š</b> <br><br><ol><li> å‘é€APDUï¼ˆä¸»æœºåˆ°ä»æœºæ•°æ®ä¼ è¾“å‘½ä»¤ï¼‰ã€‚ </li><li> ç­‰å¾…ä¿æŠ¤æ—¶é—´ä»¥æ¥æ”¶å’Œå¤„ç†å‘½ä»¤ã€‚ </li><li> ç­‰å¾…å‘½ä»¤å¤„ç†ä»¥è¯»å–çŠ¶æ€ï¼ˆçŠ¶æ€å‘½ä»¤ï¼‰ã€‚ </li><li> è¯»å–å“åº”æ•°æ®ï¼ˆä»ç«™åˆ°ä¸»æ•°æ®ä¼ è¾“å‘½ä»¤ï¼‰ã€‚ </li></ol><br> æ­¤é€»è¾‘æ˜¯åœ¨<b>sci2c_apdu_send</b>å’Œ<b>sci2c_apdu_recvå‡½æ•°ä¸­å®ç°çš„</b> ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªé‡ç‚¹ï¼šåœ¨æ™ºèƒ½å¡I2Cåè®®åè®®çš„æ ¼å¼ä¸­ï¼Œæœ‰ä¼ è¾“çš„APDUå‘½ä»¤çš„è®¡æ•°å™¨ã€‚ è¿™äº›è®¡æ•°å™¨å¿…é¡»åŒæ—¶æ§åˆ¶ä¸»è®¾å¤‡å’Œä»è®¾å¤‡ï¼Œå¹¶ä¸”å®ƒä»¬è¢«è®¾è®¡ä¸ºæ§åˆ¶å‘é€æ•°æ®çš„é¡ºåºï¼Œä»¥ä¾¿åœ¨å‡ºç°æ¥æ”¶é”™è¯¯çš„æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½å†æ¬¡å‘é€æˆ–è¯·æ±‚APDUæ•°æ®ã€‚ <br><br> è¿™äº›åŠŸèƒ½çš„å®ç°ç¤ºä¾‹å¯åœ¨ä»£ç ä¸­æ‰¾åˆ°ï¼Œä»¥ä¸‹ä»…æ˜¯APDUå‘½ä»¤å’Œå“åº”æ•°æ®ã€‚ <br><br><h3> æ•°æ®è¡¨ä¸­çš„ç¤ºä¾‹ï¼š </h3><br>  C-APDU =&gt; <b>00 A4 04 04 04 54 65 73 74 00-</b>è¯»å–åç§°ä¸ºâ€œ Testâ€çš„æ–‡ä»¶ã€‚ <br>  R-APDU &lt;= <b>6A 86-</b>æ ¹æ®æ•°æ®è¡¨ï¼Œç­”æ¡ˆåº”ä¸º<b>64 82</b> ï¼ˆ <i>æœªæ‰¾åˆ°æ–‡ä»¶æˆ–åº”ç”¨ç¨‹åº</i> ï¼‰ï¼Œä½†åœ¨æˆ‘ä»¬è¿™ç§æƒ…å†µä¸‹ï¼Œå›ºä»¶å·²ä¸Šä¼ åˆ°å¾®ç”µè·¯ï¼Œç­”æ¡ˆä¸æ–‡æ¡£ä¸­æè¿°çš„ç¤ºä¾‹æœ‰æ‰€ä¸åŒã€‚ <br><br><h3> é˜…è¯»å¡ç”Ÿäº§ç”Ÿå‘½å‘¨æœŸ </h3><br>  C-APDU =&gt; <b>80 CA 9F 7F 00</b> <br>  R-APDU &lt;= <b>9F 7F 2A 47 90 51 67 47 91 12 10 38 00 53 56 00 40 39 93 73 50 50 12 35 63 00 00 00 00 00 13 2C 19 30 34 30 33 39 00 00 00 00 00 00 00 00 00 90 00</b> <br><br><h3> è¯»å–è¯»å–å¡ä¿¡æ¯ </h3><br><br>  C-APDU =&gt; <b>80 CA 00 66 00</b> <br>  R-APDU &lt;= <b>66 4C 73 4A 06 07 2A 86 48 86 FC 6B 01 60 0C 06 0A 2A 86 48 86 FC 6B 02 02 01 01 63 09 06 07 2A 86 48 86 FC 6B 03 64 0B 06 09 2A 86 48 86 FC 6B 04 02 55 65 0B 06 09 2B 85 10 86 48 64 02 01 03 66 0C 06 0A 2B 06 01 04 01 2A 02 6E 01 02 90 00</b> <br><br><h3> è¯»è¯»å…³é”®ä¿¡æ¯ </h3><br>  C-APDU =&gt; <b>80 CA 00 E0 00</b> <br>  R-APDU &lt;= <b>E0 12 C0 04 01 FF 80 10 C0 04 02 FF 80 10 C0 04 03 FF 80 10 90 00</b> <br><br><h2> æ€»ç»“ </h2><br> é€šè¿‡I2Cæ¥å£å®ç°APDUå›¢é˜Ÿäº¤æ¢çš„ç»éªŒéå¸¸æœ‰è¶£ã€‚ è‡ªä»äº”å¹´å¤šå‰æˆ‘ä¸å¾—ä¸æ‹¿èµ·çƒ™é“ä»¥æ¥ï¼Œæˆ‘ä»€è‡³å‘ç°è‡ªå·±æƒ³è¿‡å‡ æ¬¡ï¼Œæˆ‘å–œæ¬¢è§£å†³ç”µè·¯é¢†åŸŸä»¥åŠæ™®é€šç„Šæ¥æ–¹é¢çš„å„ç§é—®é¢˜ã€‚ <br><br> å¸Œæœ›æœ¬æ–‡å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œå¹¶ä¸”æœ‰åŠ©äºäº†è§£å¯¹æ­¤ä¸»é¢˜æ„Ÿå…´è¶£çš„äººã€‚ å¦‚æœæ‚¨æ„Ÿå…´è¶£ï¼Œè¯·å†™ä¿¡ã€‚ æˆ‘å°†å°è¯•å›ç­”æœ¬æ–‡ä¸­çš„æ‰€æœ‰é—®é¢˜ï¼Œå¦‚æœä½¿ç”¨æ™ºèƒ½å¡I2Cåè®®çš„ä¸»é¢˜å¾ˆæœ‰è¶£ï¼Œé‚£ä¹ˆæˆ‘å°†å°è¯•åœ¨ä»¥ä¸‹å‡ºç‰ˆç‰©ä¸­æ›´è¯¦ç»†åœ°æŠ«éœ²å®ƒã€‚ <br><br><h2> å‚è€ƒæ–‡çŒ®ï¼š </h2><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">I2Cæ¥å£è¯´æ˜ï¼ˆSMBusï¼‰</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¾®æ§åˆ¶å™¨A7001AGä¸Šçš„æ•°æ®è¡¨</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ™ºèƒ½å¡I2Cåè®®è¯´æ˜</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GOST R ISO / IEC 7816-3-2013</a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">GOST R ISO / IEC 7816-4-2013</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439574/">https://habr.com/ru/post/zh-CN439574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439564/index.html">ä»¥Pututä¸ºä¾‹çš„ASTæ ‘è½¬æ¢çš„å®é™…åº”ç”¨</a></li>
<li><a href="../zh-CN439566/index.html">ä¸ºä»€ä¹ˆSREæ–‡æ¡£å¾ˆé‡è¦ã€‚ ç¬¬ä¸‰éƒ¨åˆ†</a></li>
<li><a href="../zh-CN439568/index.html">åŸºäºQLCçš„SSD-ç¡¬ç›˜æ€æ‰‹?ï¼Ÿ ä¸æ˜¯çœŸçš„</a></li>
<li><a href="../zh-CN439570/index.html">IPythoné­”æœ¯æ¥ç¼–è¾‘Jupyterç»†èƒæ ‡è®°</a></li>
<li><a href="../zh-CN439572/index.html">ç”µå­è®¾å¤‡çš„è®¡ç®—æœºè¾…åŠ©è®¾è®¡</a></li>
<li><a href="../zh-CN439576/index.html">Pythoné‡‡è®¿çš„å¹¿æ³›æ¦‚è¿°ã€‚ æç¤ºä¸æŠ€å·§</a></li>
<li><a href="../zh-CN439578/index.html">å…³äºè½¬æ¢å’Œå…¶ä»–æ“ä½œçš„é—®é¢˜</a></li>
<li><a href="../zh-CN439580/index.html">ä½¿Git for Windowsåœ¨ReactOSä¸­å·¥ä½œ</a></li>
<li><a href="../zh-CN439584/index.html">Lenergyé¡¹ç›®æ˜¯å¯¹ä¾¿æºå¼ç”µæºçš„é‡æ–°æ€è€ƒ</a></li>
<li><a href="../zh-CN439586/index.html">SPBmåè®®æ˜¯æç«¯è‡ªåŠ¨åŒ–æ ¡å›­çš„åŸºç¡€</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>