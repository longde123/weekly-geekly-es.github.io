<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçá ‚å®Ô∏è üíÉüèº Sistema de protecci√≥n contra fugas ü•î ü§πüèæ üåà</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quiero compartir mi experiencia en la creaci√≥n de un dispositivo que no solo fue interesante de implementar, sino que tambi√©n podr√≠a ser beneficioso. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sistema de protecci√≥n contra fugas</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/382065/"><img src="https://habrastorage.org/files/055/477/b38/055477b3811b49e2b9123bdccca872f1.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Quiero compartir mi experiencia en la creaci√≥n de un dispositivo que no solo fue interesante de implementar, sino que tambi√©n podr√≠a ser beneficioso. </font><font style="vertical-align: inherit;">Quiz√°s alguien dir√° que era posible hacer algo m√°s simple, pero este no es nuestro camino ...</font></font><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo comenz√≥ con el hecho de que despu√©s de la reparaci√≥n del apartamento se descubri√≥ un problema potencial. </font><font style="vertical-align: inherit;">En el caso de una fuga en alg√∫n lugar, no funcionar√° llegar a las gr√∫as para ingresar al departamento sin cierto esfuerzo f√≠sico y destreza, ya que la escotilla que cierra las gr√∫as no est√° muy bien instalada. </font><font style="vertical-align: inherit;">Por lo tanto, en caso de necesidad urgente (accidente) cerrar los grifos r√°pidamente no funcionar√°. </font><font style="vertical-align: inherit;">Era necesario hacer algo con esto, y apareci√≥ una soluci√≥n: aprovechar la oportunidad de forma remota, es decir </font><font style="vertical-align: inherit;">sin abrir la escotilla, pare el suministro de agua. </font><font style="vertical-align: inherit;">Y como beneficio adicional, implementar todo lo dem√°s que se pueda confiar con la electr√≥nica. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
As√≠ es como se ve el dispositivo. </font></font><br>
<br>
<img src="https://habrastorage.org/files/9fa/6a7/137/9fa6a713753a403ab27be8f6c4ffe0da.JPG"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Caracter√≠sticas clave:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cierre el suministro de agua de forma independiente en caso de fuga.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cierre el suministro de agua en modo "manual": en el panel frontal hay un "bot√≥n rojo" y un interruptor de palanca de dos posiciones</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar lecturas de medidor en pantalla propia</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar otra informaci√≥n √∫til en la pantalla</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No puede, pero planea:</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabajar desde una fuente de energ√≠a de respaldo. </font><font style="vertical-align: inherit;">Ahora, en caso de un corte de energ√≠a, el dispositivo es in√∫til.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Trabaja con sensores de fugas inal√°mbricos</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Grifos limpios usted mismo. </font><font style="vertical-align: inherit;">Para no "volverse √°cido", es recomendable abrirlos / cerrarlos una vez al mes</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notificar sobre eventos en un tel√©fono inteligente y ser controlado por "aire"</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
No puede (y por muy necesario que sea):</font></font><br>
<ul>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tiene varios canales para leer diferentes sensores de fuga con cable, ahora todos los sensores (5 piezas) est√°n conectados en paralelo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gestionar gr√∫as individualmente. </font><font style="vertical-align: inherit;">Hay dos de ellos (uno en agua caliente, el segundo en agua fr√≠a), y est√°n conectados en paralelo</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control de rotura a sensores</font></font></li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La siguiente es una descripci√≥n de los componentes y su prop√≥sito (precios a julio de 2015).</font></font><br>
<ul>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">    1/2 " DN15 DC5V</a> ( CR02,  ,     ) ‚Äî 3080   </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Maple Mini (  stm32f103c8t6)</a>    ‚Äî 233 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SPI TFT LCD  ILI9341</a> ‚Äî 302 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="> Ds3231 + AT24C32</a>   ,  ,   ‚Äî 4  EEPROM ‚Äî 38 </li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ULN2003 DIP-16</a> ‚Äî    ‚Äî 123 /10  ( )</li>
<li>      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a> ‚Äî 239 /10  (  )</li>
<li><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="></a>     ‚Äî 164 /5  ( )</li>
<li>  ,  : ,  (    ), ,  , </li>
</ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, tambi√©n necesitaba un programador / emulador, utilic√© este: </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ARM Emulator, compatible con ARM7, ARM9, ARM11, Cortex-M3 core, ADS, IAR, STM32, interfaz JTAG, versi√≥n V8 de doble b√∫fer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">De las caracter√≠sticas, es posible mencionar que, adem√°s de los </font><font style="vertical-align: inherit;">cables </font><font style="vertical-align: inherit;">est√°ndar para la </font><font style="vertical-align: inherit;">programaci√≥n </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SW</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , tuve que aplicar el voltaje de suministro de corriente del chip programable, 3,3 voltios en mi caso. </font><font style="vertical-align: inherit;">Es necesario que el programador comprenda los niveles de voltaje de los valores l√≥gicos. </font><font style="vertical-align: inherit;">Sin esto, el chip programable no quer√≠a ser detectado. </font><font style="vertical-align: inherit;">Adem√°s, este programador tiene la capacidad de alimentar un dispositivo programable, se proporciona un pin para esto, el voltaje se enciende / apaga mediante la utilidad JLink.exe.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√°s sobre hierro</font></font></h2><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microcontrolador</font></font></h3><img src="https://habrastorage.org/files/73d/47b/3b3/73d47b3b3ca9476dafadf503b3162931.jpg" width="300" align="right"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El cerebro de todo el sistema es un microcontrolador de 32 bits de </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ST</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> perfectamente soldado por trabajadores chinos en f√°bricas chinas a una placa que es "compatible" con </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Leaf Maple Mini</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre Leaf Maple Mini</font></font></b><div class="spoiler_text">   <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" class="user_link">eta4ever</a> <blockquote>  ,  </blockquote>        ¬´¬ª     ,    ‚Ä¶<br>
</div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tiene 48 conclusiones. </font><font style="vertical-align: inherit;">El n√∫cleo funciona a 72MHz, tiene SRAM integrado - 20KB y Flash - 128KB. </font><font style="vertical-align: inherit;">M√°s detalles </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aqu√≠</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Tales par√°metros definitivamente fomentan el uso de herramientas y herramientas de alto nivel, es decir, </font><font style="vertical-align: inherit;">Estos son </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FreeRTOS</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , pantalla gr√°fica en color, C ++, etc. </font><font style="vertical-align: inherit;">(y no dos LED y ensamblador). </font><font style="vertical-align: inherit;">En general, no te niegues nada ... excepto C ++, pero esto no es un problema de chip.</font></font><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øPor qu√©?</font></font></b><div class="spoiler_text">       C++ ,  ,     ,     . ,     C++      ,   ,  ,   , ..      <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">STM32CubeMX</a>      ,   FreeRTOS.     ,      .<br>
</div></div><br>
<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Usando las conclusiones del microcontrolador. </font><font style="vertical-align: inherit;">Desde aqu√≠ puedes adivinar a qu√© est√° conectado.</font></font></b><div class="spoiler_text"><img src="https://habrastorage.org/files/173/70e/067/17370e0676c64b75b9ddf7ec11a1ae29.png"><br>
</div></div><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Monitor</font></font></h3><br>
<img src="https://habrastorage.org/files/c09/361/5b6/c093615b66774fb7969845db6584ee70.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√≥dulo con una pantalla TFT de 320x240 p√≠xeles construido en un controlador compatible con ILI9341 es responsable de mostrar informaci√≥n; funciona por </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SPI</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a la frecuencia m√°xima posible para este paquete (18MHz). </font><font style="vertical-align: inherit;">SPI est√° conectado al microcontrolador solo en una direcci√≥n, la salida para leer datos del m√≥dulo de visualizaci√≥n permanece suspendida en el aire, porque </font><font style="vertical-align: inherit;">No se me ocurri√≥ esta funcionalidad, pero la guard√© en las patas libres del microcontrolador. </font><font style="vertical-align: inherit;">La transferencia de datos funciona en </font></font><abbr title="DMA o acceso directo a la memoria: tecnolog√≠a de acceso directo a la memoria sin pasar por el procesador central"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DMA</font></font></abbr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Un conector para conectar una tarjeta SD est√° soldado al m√≥dulo en la parte posterior, no he probado trabajar con una tarjeta SD y el conector no est√° involucrado en este proyecto.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo RTC y EEPROM</font></font></h3><br>
<img src="https://habrastorage.org/files/527/406/51e/52740651ee344478a84c0a15f43c3c51.jpg" width="300" align="right"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El reloj en el m√≥dulo se implementa con un chip DS3231. No caus√© ning√∫n problema especial, el √∫nico inconveniente fue que todos los valores (fecha, hora) se almacenan en registros en </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">formato BCD</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , cuando dos d√≠gitos decimales se reflejan en un byte (en los cuatro bits superiores, el d√≠gito m√°s significativo, en el inferior, el d√≠gito menos significativo) . Por ejemplo, el valor "38 minutos" se almacena como el valor decimal 56 (esto es "38" en la notaci√≥n hexadecimal). No fue posible averiguar si es posible cambiar al formato binario.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El m√≥dulo tiene su propia bater√≠a, por lo que cada vez que pierde energ√≠a, no tiene que establecer la hora y la fecha. Adem√°s, el microcircuito AT24C32 est√° soldado en la placa del m√≥dulo, ¬°con hasta 32768 bits EEPROM! En pocas palabras, son 4 Kbytes de memoria no vol√°til. Tanto el reloj como la memoria se encuentran en el mismo bus I2C. Por el momento, la memoria se usa solo para almacenar la configuraci√≥n del dispositivo, el valor actual de las lecturas de los contadores y algo m√°s. finalmente ocupado ... 25 bytes. M√°s tarde se usar√° para mantener registros de varios eventos y posiblemente para mantener estad√≠sticas de consumo (no s√© por qu√©, pero habr√° una ocasi√≥n para programar la visualizaci√≥n de gr√°ficos).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Adem√°s de los contactos y la alimentaci√≥n del bus I2C, hay dos m√°s en el tablero. </font><font style="vertical-align: inherit;">"SQW" es la se√±al del despertador que se puede programar a trav√©s de los registros y "32K" es la frecuencia generada por el DS3231 para otros dispositivos. </font><font style="vertical-align: inherit;">Este proyecto no aplica.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">M√≥dulo con sensor de humedad</font></font></h3><br>
<img src="https://habrastorage.org/files/6a9/b19/bc1/6a9b19bc17f64a42bc008a3c5a3fe058.jpg" align="right" width="300"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se utiliza como amortiguador entre el mundo exterior y el microcontrolador. </font><font style="vertical-align: inherit;">Los cables que van a las sondas en total tienen una longitud de unos 10 metros, sin pantalla. </font><font style="vertical-align: inherit;">Cables telef√≥nicos convencionales de dos hilos. </font><font style="vertical-align: inherit;">En el caso de un golpe est√°tico, espero que solo este m√≥dulo muera, pero no el microcontrolador. </font><font style="vertical-align: inherit;">Es capaz de medir la resistencia entre dos electrodos y proporcionar esta informaci√≥n en forma anal√≥gica (voltaje de 0 a voltaje de suministro) y en digital (0/1, el m√≥dulo tiene una resistencia variable que se puede ajustar al l√≠mite de operaci√≥n).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Hubo problemas menores con este m√≥dulo. Al aplicar y eliminar la tensi√≥n de alimentaci√≥n, el m√≥dulo en la salida digital se√±al√≥ un disparo, esto tambi√©n podr√≠a verse por el parpadeo del LED durante una fracci√≥n de segundo (en la placa del m√≥dulo, se instala un LED en paralelo con la salida digital). El microcontrolador logr√≥ leer una se√±al anormal cuando se aplic√≥ / restableci√≥ la alimentaci√≥n del sistema (problema No. 1). La soluci√≥n se implement√≥ omitiendo pulsos de operaci√≥n cortos, en anticipaci√≥n de una condici√≥n fijada por un tiempo.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La resistencia variable tiene un √°ngulo de ajuste muy peque√±o, en el cual no pude encontrar el l√≠mite entre la ausencia de falsos positivos y una buena sensibilidad (problema No. 2). Posteriormente se implement√≥ leyendo la se√±al anal√≥gica a trav√©s del microcontrolador ADC. Al mismo tiempo, se hizo posible establecer el l√≠mite de respuesta en la configuraci√≥n del dispositivo como par√°metro. La capacidad de ajustar el nivel de respuesta ahora se considera superflua, y probablemente sea mejor codificar el valor l√≠mite. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se not√≥ que despu√©s de varios minutos de operaci√≥n (¬øcalentamiento?), El m√≥dulo de repente comenz√≥ a indicar una operaci√≥n espont√°nea (problema n√∫mero 3, ¬øcu√°ntos de ellos?).</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En el l√≠mite de las respuestas anormales, la intensidad del brillo del LED (en el m√≥dulo) aument√≥ o disminuy√≥ gradualmente, como si fuera controlado por un generador PWM, est√° claro que esto es ruido y es de alta frecuencia, lo mismo podr√≠a esperarse en la salida "digital" del m√≥dulo (problema No. 4 ) </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Aclarar√© que todos estos problemas se resolvieron cuando se implement√≥ la lectura de la se√±al anal√≥gica del m√≥dulo. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las sondas (partes de sensores que se encuentran directamente en lugares de acumulaci√≥n de agua en caso de accidente) est√°n hechas de medios improvisados. Esto es esta√±o (acero) y una peque√±a caja de conexiones redonda, modificada mec√°nicamente al tipo deseado y con alambres soldados en su interior. Cuando el agua entra entre los pares de electrodos, la resistencia disminuye y el controlador lo considera como una "fuga".</font></font><br>
<br>
<img src="https://habrastorage.org/files/bc7/366/3ad/bc73663ad6f048079b0ca835a353a0b6.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las pruebas de laboratorio mostraron que el producto realiza bien su funci√≥n y no es un eslab√≥n d√©bil en el sistema.</font></font><br>
<br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nutrici√≥n</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo el sistema funciona desde la carga del tel√©fono: 5 voltios, 2A (aqu√≠ con un margen). </font><font style="vertical-align: inherit;">En la placa Maple Mini, se instala un regulador de voltaje de 3.3 voltios, el voltaje de entrada puede ser de hasta 12 voltios, las caracter√≠sticas del estabilizador lo permiten, pero un voltaje tan grande no es conveniente de usar, m√°s sobre eso a continuaci√≥n. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Con un estabilizador, 3.3 voltios tambi√©n van a la potencia de los m√≥dulos RTC, TFT y al m√≥dulo de medici√≥n de humedad. </font><font style="vertical-align: inherit;">Las gr√∫as se conectan a trav√©s del conjunto del interruptor de alimentaci√≥n ULN2003AN, directamente desde la fuente de alimentaci√≥n, es decir. </font><font style="vertical-align: inherit;">trabajar desde 5 voltios, menos la ca√≠da de las teclas. </font><font style="vertical-align: inherit;">ULN2003AN usa solo dos de los siete canales.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, es aconsejable reemplazar la fuente de alimentaci√≥n por otra, con un voltaje ligeramente m√°s alto, porque a veces, al cerrar las gr√∫as, una de ellas, en una posici√≥n casi extrema debido al funcionamiento de su propio remolque (se instalan dos piezas en el cuerpo de la v√°lvula, para resolver las posiciones extremas), se detiene por una fracci√≥n de segundo, luego se produce un "rebote" (debido al juego en los engranajes de la caja de cambios ), luego un intento repetido de apretar la v√°lvula de bola y as√≠ sucesivamente hasta que el controlador elimine la tensi√≥n de alimentaci√≥n del servoaccionamiento.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El vendedor en el sitio tiene informaci√≥n de que las gr√∫as deber√≠an funcionar a partir de 5 voltios, en este caso el voltaje se suministra menos. </font><font style="vertical-align: inherit;">El software est√° hecho para que para abrir y cerrar los grifos, el voltaje se suministre solo durante un cierto tiempo (6 segundos), tiempo durante el cual los grifos deben tener tiempo para abrirse o cerrarse. </font><font style="vertical-align: inherit;">Vale la pena se√±alar que este efecto no afecta el cierre incompleto del grifo, ya que </font><font style="vertical-align: inherit;">Este momento llega despu√©s de que el grifo ha cerrado completamente el flujo de agua. </font><font style="vertical-align: inherit;">Tambi√©n es posible mencionar que demasiado voltaje a los servos (aplicado 9 voltios para el experimento) hace que se muevan por inercia a√∫n m√°s (despu√©s de que se active el interruptor de l√≠mite) y se apoyen contra la posici√≥n extrema con el sonido caracter√≠stico de un impacto.</font></font><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V√°lvulas de bola servo</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Las v√°lvulas de cierre parecen confiables, pero la parte electr√≥nica tuvo que ser finalizada. </font></font><br>
<br>
<img src="https://habrastorage.org/files/b73/ca0/7bb/b73ca07bb94e48278a4de7c54d6056bb.jpg"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Si observa el circuito de control de la gr√∫a, notar√° que est√°n controlados por voltaje positivo. </font><font style="vertical-align: inherit;">El general "menos" y dos cables de potencia de se√±al "m√°s", uno para cerrar, el otro para abrir. </font><font style="vertical-align: inherit;">Pero ULN2003AN no puede funcionar en este modo; en √©l, cuando se abre la llave, la salida administrada se conecta al signo menos. </font><font style="vertical-align: inherit;">La soluci√≥n es cambiar la polaridad de control de la gr√∫a misma. </font><font style="vertical-align: inherit;">Para hacer esto, tuve que cambiar las se√±ales del "trailer", porque </font><font style="vertical-align: inherit;">Debido a un cambio en la polaridad, el motor el√©ctrico giraba en la direcci√≥n opuesta (en comparaci√≥n con el circuito original), mientras que las posiciones extremas ahora est√°n en direcciones opuestas. </font><font style="vertical-align: inherit;">Como resultado, tenemos una gr√∫a con un "m√°s" com√∫n y dos "menos" de control. </font><font style="vertical-align: inherit;">¬°Exactamente lo que se necesita!</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Gr√∫as con servos en condiciones de "combate".</font></font><br>
<br>
<img src="https://habrastorage.org/files/7b0/9c1/7ae/7b09c17aebf74188a522f485fc6361fe.jpg"><br>
<br>
<h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lecturas del medidor</font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Por supuesto, no hay datos almacenados en el contador en s√≠, lo que podr√≠a leerse con dos cables retirados de √©l. </font><font style="vertical-align: inherit;">Esto es solo una cadena con un interruptor de l√°minas y un im√°n ubicado en un impulsor giratorio. </font><font style="vertical-align: inherit;">Las mediciones con un mult√≠metro no mostraron la presencia de resistencia o capacitancias el√©ctricas en el circuito. </font><font style="vertical-align: inherit;">En mis contadores, el circuito (con la apertura posterior) del interruptor de l√°minas se produce a un caudal de un litro de agua. </font><font style="vertical-align: inherit;">En alg√∫n lugar hab√≠a informaci√≥n sobre los medidores, cuya se√±al se forma cada 10 litros. </font><font style="vertical-align: inherit;">Aquellos. </font><font style="vertical-align: inherit;">ellos son diferentes. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Se requiere el microcontrolador para leer estos pulsos. </font><font style="vertical-align: inherit;">La interfaz de usuario del dispositivo, por supuesto, proporciona el valor inicial.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De los problemas existentes: en ausencia de electricidad, no se tendr√° en cuenta el consumo de agua. Hay un defecto de hardware, debe solucionarlo: haga una copia de seguridad de las bater√≠as, esto tambi√©n es necesario para las funciones principales del dispositivo; de lo contrario, el dispositivo no podr√° apagar los grifos si es necesario. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
De aqu√≠ surgen las dos tareas siguientes:</font></font><br>
<ol>
<li>      . , ,    ¬´ ¬ª,     ,     () /     .      ,           (  ),       ¬´¬ª,   ,    (,        ),   ,      FreeRTOS.</li>
<li>        ,           ,          ¬´ ¬ª.<div class="spoiler"><b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">¬øApagar los grifos?</font></font></b><div class="spoiler_text">,   , , ,       , 11  ,    ,  ¬´¬ª ,          ,      ¬´¬ª  , !<br>
</div></div></li>
</ol><br>
<h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Control S</font></font></h3><br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Codificador</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ubicado junto a la pantalla y dise√±ado para navegar por el men√∫. </font><font style="vertical-align: inherit;">Rotaci√≥n: vaya al elemento del men√∫ siguiente / anterior, presione: seleccione / active un elemento del men√∫.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Bot√≥n rojo"</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
La forma m√°s f√°cil de apagar los grifos es presionar el bot√≥n rojo. </font><font style="vertical-align: inherit;">Aunque no deber√≠a ser √∫til, porque </font><font style="vertical-align: inherit;">alg√∫n tiempo antes, el dispositivo en s√≠ ten√≠a que hacer todo. </font><font style="vertical-align: inherit;">Pero por si acaso, el bot√≥n existe. </font><font style="vertical-align: inherit;">Presione repetidamente, mantenga presionado, haga doble clic, etc. </font><font style="vertical-align: inherit;">sin contar, solo la primera pulsaci√≥n y ya est√°. </font><font style="vertical-align: inherit;">El modo "emergencia" est√° activado, solo se puede deshabilitar a trav√©s de un elemento de men√∫ especial.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Interruptor de encendido / apagado</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Tambi√©n se pueden apagar con grifos, pero tambi√©n se pueden abrir, por supuesto, si el sistema no est√° en modo de "bloqueo". </font><font style="vertical-align: inherit;">Puede ser √∫til para el cierre temporal del suministro de agua.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LED tricolor</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Todo aqu√≠ tambi√©n es simple. </font><font style="vertical-align: inherit;">Para indicar el modo actual: verde: todo est√° en orden, rojo: no todo est√° en orden, los toques azules se bloquean con el interruptor de palanca (consulte el p√°rrafo anterior). </font><font style="vertical-align: inherit;">No se utilizan colores de mezcla, tres fueron suficientes. </font><font style="vertical-align: inherit;">Pero aqu√≠ surgi√≥ un problema. </font><font style="vertical-align: inherit;">El brillo es tan fuerte que deslumbra cuando miras la pantalla. </font><font style="vertical-align: inherit;">470 ohmios para cada color no fue suficiente. </font><font style="vertical-align: inherit;">Corregido program√°ticamente. </font><font style="vertical-align: inherit;">Cuando la pantalla est√° en un estado activo (y est√° activo mientras usa los controles y durante un tiempo), este LED est√° apagado.</font></font><br>
<br>
<h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Conclusi√≥n</font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
El dispositivo funciona, las pruebas peri√≥dicas muestran que funciona correctamente. </font><font style="vertical-align: inherit;">No se congela, no tiene errores. </font><font style="vertical-align: inherit;">Aunque s√© d√≥nde hay errores potenciales, pero no cr√≠ticos en el c√≥digo, esto no se trata en este art√≠culo. </font></font><br>
<br>
<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=aue&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fuentes, proyecto Keil uVision 5, archivo de proyecto para STM32CubeMX</font></font></a></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es382065/">https://habr.com/ru/post/es382065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es382051/index.html">¬øPor qu√© declarar el paquete pochta.fi en la aduana finlandesa?</a></li>
<li><a href="../es382053/index.html">–ò—Å—Å–ª–µ–¥–æ–≤–∞–ª–∏ —Å–∫—Ä—É—Ç–∏–ª–∏ –î–ù–ö –≤ —Ñ–æ—Ä–º–µ –∑–∞–π—á–∏–∫–∞</a></li>
<li><a href="../es382057/index.html">Malos consejos para una gu√≠a de helic√≥ptero principiante. Parte 2</a></li>
<li><a href="../es382059/index.html">[Publicaci√≥n de informaci√≥n] Sistemas de archivos para unidades USB y tarjetas de memoria</a></li>
<li><a href="../es382063/index.html">–û—Ä–≥–∞–Ω—ã —á—É–≤—Å—Ç–≤ –∞–≤—Ç–æ–º–æ–±–∏–ª—è</a></li>
<li><a href="../es382067/index.html">La escritura a mano de una red neuronal pretende ser la escritura a mano de una persona</a></li>
<li><a href="../es382071/index.html">Por primera vez, un programa mejor que una persona hace frente al reconocimiento de patrones</a></li>
<li><a href="../es382073/index.html">Rescate de ahogamiento - el trabajo de robots</a></li>
<li><a href="../es382075/index.html">La historia de c√≥mo traje NAO a Rusia</a></li>
<li><a href="../es382077/index.html">Jimmy Wales lanza red social y operador telef√≥nico para ayudar a las personas a donar a la caridad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>