<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>тЫ╣ЁЯП╛ ЁЯЪ▒ ЁЯХ░я╕П рдХрдВрд╕рд▓ рдХреЗ рд╕рд╛рде рдШреБрдордВрддреВ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ рдЧрд┐рдЯрд▓реИрдм рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд░реЗрдВ ЁЯЪЙ тШХя╕П ЁЯЪЖ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="рдкрд░рд┐рдЪрдп 

 рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рддреЗрдЬреА рд╕реЗ рдмрдврд╝ рд░рд╣реА рд╣реИ - рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рдЗрд╕реЗ рдШрд░ рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд░рд╣реА рд╣реИрдВред рдореИрдВ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреА рддрд░рд╣ рдПрдХ рдСрд░реНрдХреЗрд╕реНрдЯреН...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>рдХрдВрд╕рд▓ рдХреЗ рд╕рд╛рде рдШреБрдордВрддреВ рдХреНрд▓рд╕реНрдЯрд░ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ рдФрд░ рдЧрд┐рдЯрд▓реИрдм рдХреЗ рд╕рд╛рде рдПрдХреАрдХреГрдд рдХрд░реЗрдВ</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/453322/"><h2>  рдкрд░рд┐рдЪрдп </h2><br><br>  рд╣рд╛рд▓ рд╣реА рдореЗрдВ, рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рддреЗрдЬреА рд╕реЗ рдмрдврд╝ рд░рд╣реА рд╣реИ - рдЕрдзрд┐рдХ рд╕реЗ рдЕрдзрд┐рдХ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рдЗрд╕реЗ рдШрд░ рдкрд░ рд▓рд╛рдЧреВ рдХрд░ рд░рд╣реА рд╣реИрдВред  рдореИрдВ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреА рддрд░рд╣ рдПрдХ рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рдкрд░ рд╕реНрдкрд░реНрд╢ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рдерд╛: рдпрд╣ рдЙрди рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдПрдХрджрдо рд╕рд╣реА рд╣реИ рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╣рд╛рд╢рд┐рдХреЛрд░реНрдк рд╕реЗ рдЕрдиреНрдп рд╕рдорд╛рдзрд╛рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╡реЙрд▓реНрдЯ рдФрд░ рдХреМрдВрд╕рд▓, рдФрд░ рдкрд░рд┐рдпреЛрдЬрдирд╛рдПрдВ рд╕реНрд╡рдпрдВ рдмреБрдирд┐рдпрд╛рджреА рдврд╛рдВрдЪреЗ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЬрдЯрд┐рд▓ рдирд╣реАрдВ рд╣реИрдВред  рдпрд╣ рд▓реЗрдЦ рдШреБрдордВрддреВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ, рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рджреЛ рдиреЛрдбреНрд╕ рдХреЗ рд╕рдВрдпреЛрдЬрди, рдФрд░ рдЧрд┐рдЯреНрд▓рд╛рдм рдХреЗ рд╕рд╛рде рдШреБрдордВрддреВ рдХреЛ рдПрдХреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд░реНрджреЗрд╢ рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ред <br><br><img src="https://habrastorage.org/webt/bu/yn/4v/buyn4vqshurhgc9kavloja-fzsm.png"><br><br><a name="habracut"></a><br><br><h2>  рдЯреЗрд╕реНрдЯ рд╕реНрдЯреИрдВрдб </h2><br><br>  рдкрд░реАрдХреНрд╖рдг рдмреЗрдВрдЪ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝рд╛ рд╕рд╛: рддреАрди рд╡рд░реНрдЪреБрдЕрд▓ рд╕рд░реНрд╡рд░ 2 рд╕реАрдкреАрдпреВ, 4 рд░реИрдо, 50 рдЬреАрдмреА рдПрд╕рдПрд╕рдбреА рдХреА рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рдореЗрдВ рдПрдХрдЬреБрдЯ рд╣реЛрддреЗ рд╣реИрдВред  рдЙрдирдХреЗ рдирд╛рдо рдФрд░ рдЖрдИрдкреА рдкрддреЗ: <br><br><ol><li>  <b>рдЦрд╛рдирд╛рдмрджреЛрд╢- livelinux-01</b> : 172.30.0.5 </li><li>  <b>рдЦрд╛рдирд╛рдмрджреЛрд╢- livelinux-02</b> : 172.30.0.10 </li><li>  <b>рдХрдВрд╕реБрд▓-рд▓рд╛рдЗрд╡рд▓рд╛рдЗрди -01</b> : 172.30.0.15 </li></ol><br><br><h2>  рдШреБрдордВрддреВ, рдХреМрдВрд╕реБрд▓ рдХреА рд╕реНрдерд╛рдкрдирд╛ред  рдПрдХ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдирд╛ </h2><br><br>  рдЖрдЗрдП рдореВрд▓ рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝реЗрдВред  рд╕реНрдерд╛рдкрдирд╛ рдореЗрдВ рдЖрд╕рд╛рдиреА рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдореИрдВ рдЗрд╕реЗ рд▓реЗрдЦ рдХреА рдЕрдЦрдВрдбрддрд╛ рдХреЗ рд▓рд┐рдП рд╡рд░реНрдгрди рдХрд░реВрдВрдЧрд╛: рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рдпрд╣ рдбреНрд░рд╛рдлреНрдЯ рдФрд░ рдиреЛрдЯреНрд╕ рд╕реЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛ рддрд╛рдХрд┐ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рд╕рдХреЗред <br><br>  рдЕрднреНрдпрд╛рд╕ рд╢реБрд░реВ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рд╣рдо рд╕реИрджреНрдзрд╛рдВрддрд┐рдХ рднрд╛рдЧ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВрдЧреЗ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рд╕реНрддрд░ рдкрд░ рднрд╡рд┐рд╖реНрдп рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред <br><br>  рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рджреЛ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдиреЛрдб рд╣реИрдВ рдФрд░ рд╣рдо рдЙрдиреНрд╣реЗрдВ рдПрдХ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдЬреЛрдбрд╝рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рдФрд░ рднрд╡рд┐рд╖реНрдп рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдХреНрд▓рд╕реНрдЯрд░ рдХреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА - рдЗрд╕рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдХреЙрдиреНрд╕рд▓ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, рдирдП рдиреЛрдбреНрд╕ рдХреЛ рдЬреЛрдбрд╝рдирд╛ рдФрд░ рдЬреЛрдбрд╝рдирд╛ рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдХрд╛рд░реНрдп рдмрди рдЬрд╛рддрд╛ рд╣реИ: рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдШреБрдордВрддреВ рдиреЛрдб рдХрдВрд╕реБрд▓ рдПрдЬреЗрдВрдЯ рд╕реЗ рдЬреБрдбрд╝ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдлрд┐рд░ рдореМрдЬреВрджрд╛ рдШреБрдордВрддреВ рдХреНрд▓рд╕реНрдЯрд░ рд╕реЗ рдЬреБрдбрд╝ рдЬрд╛рддрд╛ рд╣реИред  рдЗрд╕рд▓рд┐рдП, рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╣рдо рдХреЙрдиреНрд╕рд▓ рд╕рд░реНрд╡рд░ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ, рд╡реЗрдм рдкреИрдирд▓ рдХреЗ рд▓рд┐рдП рдмреБрдирд┐рдпрд╛рджреА http рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ (рдпрд╣ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХреЗ рдмрд┐рдирд╛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╣реИ рдФрд░ рдЗрд╕реЗ рдмрд╛рд╣рд░реА рдкрддреЗ рджреНрд╡рд╛рд░рд╛ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ), рд╕рд╛рде рд╣реА рд╕рд╛рде рдХреЙрдиреНрд╕рд▓ рдПрдЬреЗрдВрдЯ рдЦреБрдж рдХреЛ рдЦрд╛рдирд╛рдмрдж рд╕рд░реНрд╡рд░ рдкрд░, рдЙрд╕рдХреЗ рдмрд╛рдж рд╣рдо рдХреЗрд╡рд▓ рдШреБрдордВрддреВ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br>  HashiCorp рдЙрдкрдХрд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдмрд╣реБрдд рд╕рд░рд▓ рд╣реИ: рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ, рд╣рдо рдХреЗрд╡рд▓ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрд┐рди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЯреВрд▓ рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕рдХреА рд╕реЗрд╡рд╛ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддреЗ рд╣реИрдВред <br><br>  рдХрдВрд╕рд▓ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╣реЛрдо рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдЕрдирдкреИрдХ рдХрд░реЗрдВ: <br><br><pre><code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># wget https://releases.hashicorp.com/consul/1.5.0/consul_1.5.0_linux_amd64.zip root@consul-livelinux-01:~# unzip consul_1.5.0_linux_amd64.zip root@consul-livelinux-01:~# mv consul /usr/local/bin/</span></span></code> </pre> <br><br>  рдЕрдм рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЖрдЧреЗ рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рддреИрдпрд╛рд░ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдХреЙрдиреНрд╕рд▓ рдлрд╝рд╛рдЗрд▓ рд╣реИред <br><br>  рдХреМрдВрд╕рд▓ рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ keygen рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдХреБрдВрдЬреА рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ: <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># consul keygen</span></span></code> </pre><br><br>  рдЪрд▓рд┐рдП рдХрдВрд╕реЙрд▓ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВ, /etc/consul.d/ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЛ рдирд┐рдореНрди рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рд╛рде рдмрдирд╛рддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">/etc/consul.d/ тФЬтФАтФА bootstrap тФВ тФФтФАтФА config.json</code> </pre> <br><br>  рдмреВрдЯрд╕реНрдЯреНрд░реИрдк рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ config.json рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рд╣реЛрдЧреА - рдЗрд╕рдореЗрдВ рд╣рдо рдХреЙрдиреНрд╕реБрд▓ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд╕реЗрдЯ рдХрд░реЗрдВрдЧреЗред  рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"bootstrap"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"server"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"datacenter"</span></span>: <span class="hljs-string"><span class="hljs-string">"dc1"</span></span>, <span class="hljs-string"><span class="hljs-string">"data_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/var/consul"</span></span>, <span class="hljs-string"><span class="hljs-string">"encrypt"</span></span>: <span class="hljs-string"><span class="hljs-string">"your-key"</span></span>, <span class="hljs-string"><span class="hljs-string">"log_level"</span></span>: <span class="hljs-string"><span class="hljs-string">"INFO"</span></span>, <span class="hljs-string"><span class="hljs-string">"enable_syslog"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"start_join"</span></span>: [<span class="hljs-string"><span class="hljs-string">"172.30.0.15"</span></span>] }</code> </pre> <br><br>  рдЖрдЗрдП рд╣рдо рдореБрдЦреНрдп рдирд┐рд░реНрджреЗрд╢реЛрдВ рдФрд░ рдЙрдирдХреЗ рдЕрд░реНрдереЛрдВ рдХреА рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЬрд╛рдБрдЪ рдХрд░реЗрдВ: <br><br><ul><li>  <b>рдмреВрдЯрд╕реНрдЯреНрд░реИрдк</b> : рд╕рдЪред  рд╣рдо рдирдП рдиреЛрдбреНрд╕ рдХреЗ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЬреЛрдбрд╝ рдХреЛ рдЪрд╛рд▓реВ рдХрд░рддреЗ рд╣реИрдВ рдпрджрд┐ рд╡реЗ рдЬреБрдбрд╝реЗ рд╣реБрдП рд╣реИрдВред  рдореИрдВ рдзреНрдпрд╛рди рджреЗрддрд╛ рд╣реВрдВ рдХрд┐ рд╣рдо рдпрд╣рд╛рдВ рдЕрдкреЗрдХреНрд╖рд┐рдд рдиреЛрдбреНрд╕ рдХреА рд╕рдЯреАрдХ рд╕рдВрдЦреНрдпрд╛ рдирд╣реАрдВ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВред </li><li>  <b>рд╕рд░реНрд╡рд░</b> : рд╕рдЪ рд╣реИред  рд╕рд░реНрд╡рд░ рдореЛрдб рдЪрд╛рд▓реВ рдХрд░реЗрдВред  рдЗрд╕ рд╡рд░реНрдЪреБрдЕрд▓ рдорд╢реАрди рдкрд░ рдХрдВрд╕реВрд▓ рдлрд┐рд▓рд╣рд╛рд▓ рдПрдХ рд╣реА рд╕рд░реНрд╡рд░ рдФрд░ рдорд╛рд╕реНрдЯрд░ рд╣реЛрдЧрд╛, VM рдШреБрдордВрддреВ рдЧреНрд░рд╛рд╣рдХ рд╣реЛрдВрдЧреЗред </li><li>  <b>рдбрд╛рдЯрд╛рд╕реЗрдВрдЯрд░</b> : dc1ред  рдХреНрд▓рд╕реНрдЯрд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрдЯрд╛ рд╕реЗрдВрдЯрд░ рдХрд╛ рдирд╛рдо рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред  рдпрд╣ рдХреНрд▓рд╛рдЗрдВрдЯ рдФрд░ рд╕рд░реНрд╡рд░ рджреЛрдиреЛрдВ рдкрд░ рд╕рдорд╛рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред </li><li>  <b>рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ</b> : рдЖрдкрдХреА рдХреБрдВрдЬреАред  рдПрдХ рдХреБрдВрдЬреА рдЬреЛ рд╕рднреА рдЧреНрд░рд╛рд╣рдХреЛрдВ рдФрд░ рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рд▓рд┐рдП рднреА рдЕрджреНрд╡рд┐рддреАрдп рдФрд░ рдореИрдЪ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред  рдХреЙрдиреНрд╕рд▓ рдХреАрдЬрди рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ред </li><li>  <b>start_join</b>  рдЗрд╕ рд╕реВрдЪреА рдореЗрдВ рд╣рдо рдЖрдИрдкреА рдкрддреЗ рдХреА рд╕реВрдЪреА рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдлрд┐рд▓рд╣рд╛рд▓, рд╣рдо рдХреЗрд╡рд▓ рдЕрдкрдирд╛ рдкрддрд╛ рдЫреЛрдбрд╝рддреЗ рд╣реИрдВред </li></ul><br><br>  рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░, рд╣рдо рдХрдорд╛рдВрдб рд▓рд╛рдЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд╛рдгрд┐рдЬреНрдп рджреВрддрд╛рд╡рд╛рд╕ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># /usr/local/bin/consul agent -config-dir /etc/consul.d/bootstrap -ui</span></span></code> </pre> <br><br>  рдпрд╣ рдЕрдм рдбрд┐рдмрдЧ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ, рд╣рд╛рд▓рд╛рдВрдХрд┐, рдирд┐рд░рдВрддрд░ рдЖрдзрд╛рд░ рдкрд░, рдЗрд╕ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕реНрдкрд╖реНрдЯ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред  рд╕рд┐рд╕реНрдЯрдордб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреМрдВрд╕рд▓ рдХреЗ рдкреНрд░рдмрдВрдзрди рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗрд╡рд╛ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдПрдБ: <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># nano /etc/systemd/system/consul.service</span></span></code> </pre><br><br>  Consul.service рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА: <br><br><pre> <code class="bash hljs">[Unit] Description=Consul Startup process After=network.target [Service] Type=simple ExecStart=/bin/bash -c <span class="hljs-string"><span class="hljs-string">'/usr/local/bin/consul agent -config-dir /etc/consul.d/bootstrap -ui'</span></span> TimeoutStartSec=0 [Install] WantedBy=default.target</code> </pre> <br><br>  рд░реВрдврд╝рд┐рд╡рд╛рджреА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЪрд▓рд╛рдПрдВ: <br><br><pre> <code class="bash hljs">root@consul-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># systemctl start consul</span></span></code> </pre><br><br>  рд╣рдо рдЬрд╛рдБрдЪрддреЗ рд╣реИрдВ: рд╣рдорд╛рд░реА рд╕реЗрд╡рд╛ рд╢реБрд░реВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП, рдФрд░ рд╡рд╛рдгрд┐рдЬреНрдп рджреВрдд рд╕рджрд╕реНрдпреЛрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рд╣рдореЗрдВ рдЕрдкрдирд╛ рд╕рд░реНрд╡рд░ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><pre> <code class="bash hljs">root@consul-livelinux:/etc/consul.d<span class="hljs-comment"><span class="hljs-comment"># consul members consul-livelinux 172.30.0.15:8301 alive server 1.5.0 2 dc1 &lt;all&gt;</span></span></code> </pre> <br><br>  рдЕрдЧрд▓рд╛ рдХрджрдо: Nginx рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдФрд░ рдкреНрд░реЙрдХреНрд╕реА, http рдкреНрд░рд╛рдзрд┐рдХрд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ред  рдкреИрдХреЗрдЬ рдкреНрд░рдмрдВрдзрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ nginx рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВ рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде / etc / nginx / рд╕рд╛рдЗрдЯреНрд╕-рд╕рдХреНрд╖рдо рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ consul.conf рдмрдирд╛рдПрдВ: <br><br><pre> <code class="nginx hljs"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> consul-auth { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> localhost:<span class="hljs-number"><span class="hljs-number">8500</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> consul.doman.name; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://consul-auth; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span> /etc/nginx/.htpasswd; <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span> <span class="hljs-string"><span class="hljs-string">"Password-protected Area"</span></span>; } }</code> </pre> <br><br>  рдПрдХ .htpasswd рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдордд рднреВрд▓рдирд╛ред  рдпрд╣ рдЖрдЗрдЯрдо рдЖрд╡рд╢реНрдпрдХ рд╣реИ рддрд╛рдХрд┐ рд╡реЗрдм рдкреИрдирд▓ рдЙрди рд╕рднреА рдХреЗ рд▓рд┐рдП рд╕реБрд▓рдн рди рд╣реЛ рдЬреЛ рд╣рдорд╛рд░реЗ рдбреЛрдореЗрди рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЧреАрддрд╛рд▓рд╛рдм рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рддреЗ рд╕рдордп, рд╣рдореЗрдВ рдЗрд╕реЗ рдЫреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛ - рдЕрдиреНрдпрдерд╛ рд╣рдо рдЕрдкрдиреЗ рдЖрд╡реЗрджрди рдХреЛ рдШреБрдордВрддреВ рдореЗрдВ рддреИрдирд╛рдд рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред  рдореЗрд░реЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ, рдЧрд┐рдЯрд▓реИрдм рдФрд░ рдиреЛрдореИрдб рджреЛрдиреЛрдВ рдХреЗрд╡рд▓ рдЧреНрд░реЗ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдРрд╕реА рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рдирд╣реАрдВ рд╣реИред <br><br>  рдЕрдиреНрдп рджреЛ рд╕рд░реНрд╡рд░реЛрдВ рдкрд░, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрджреЗрд╢реЛрдВ рдХреЗ рдЕрдиреБрд╕рд╛рд░ рдХрдВрд╕рд▓ рдПрдЬреЗрдВрдЯ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВред  рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдЪрд░рдгреЛрдВ рдХреЛ рджреЛрд╣рд░рд╛рдПрдВ: <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># wget https://releases.hashicorp.com/consul/1.5.0/consul_1.5.0_linux_amd64.zip root@nomad-livelinux-01:~# unzip consul_1.5.0_linux_amd64.zip root@nomad-livelinux-01:~# mv consul /usr/local/bin/</span></span></code> </pre> <br><br>  рдкрд┐рдЫрд▓реЗ рд╕рд░реНрд╡рд░ рдХреЗ рд╕рд╛рде рд╕рдорд╛рдирддрд╛ рд╕реЗ, рд╣рдо рдирд┐рдореНрди рд╕рдВрд░рдЪрдирд╛ рдХреЗ рд╕рд╛рде рд╡рд┐рдиреНрдпрд╛рд╕ рдлрд╛рдЗрд▓ /etc/consul.d рдХреЗ рд▓рд┐рдП рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs">/etc/consul.d/ тФЬтФАтФА client тФВ тФФтФАтФА config.json</code> </pre> <br><br>  Config.json рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"datacenter"</span></span>: <span class="hljs-string"><span class="hljs-string">"dc1"</span></span>, <span class="hljs-string"><span class="hljs-string">"data_dir"</span></span>: <span class="hljs-string"><span class="hljs-string">"/opt/consul"</span></span>, <span class="hljs-string"><span class="hljs-string">"log_level"</span></span>: <span class="hljs-string"><span class="hljs-string">"DEBUG"</span></span>, <span class="hljs-string"><span class="hljs-string">"node_name"</span></span>: <span class="hljs-string"><span class="hljs-string">"nomad-livelinux-01"</span></span>, <span class="hljs-string"><span class="hljs-string">"server"</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"encrypt"</span></span>: <span class="hljs-string"><span class="hljs-string">"your-private-key"</span></span>, <span class="hljs-string"><span class="hljs-string">"domain"</span></span>: <span class="hljs-string"><span class="hljs-string">"livelinux"</span></span>, <span class="hljs-string"><span class="hljs-string">"addresses"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dns"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"https"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"grpc"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"http"</span></span>: <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"bind_addr"</span></span>: <span class="hljs-string"><span class="hljs-string">"172.30.0.5"</span></span>, #    <span class="hljs-string"><span class="hljs-string">"start_join"</span></span>: [<span class="hljs-string"><span class="hljs-string">"172.30.0.15"</span></span>], #     <span class="hljs-string"><span class="hljs-string">"ports"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dns"</span></span>: <span class="hljs-number"><span class="hljs-number">53</span></span> } }</code> </pre><br><br>  рд╣рдо рдкрд░рд┐рд╡рд░реНрддрдиреЛрдВ рдХреЛ рд╕рд╣реЗрдЬрддреЗ рд╣реИрдВ рдФрд░ рд╕реЗрд╡рд╛ рдлрд╝рд╛рдЗрд▓, рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╡рд┐рдиреНрдпрд╛рд╕ рдХреЗ рд▓рд┐рдП рдЖрдЧреЗ рдмрдврд╝рддреЗ рд╣реИрдВ: <br><br>  /etc/systemd/system/consul.service: <br><br><pre> <code class="bash hljs">[Unit] Description=<span class="hljs-string"><span class="hljs-string">"HashiCorp Consul - A service mesh solution"</span></span> Documentation=https://www.consul.io/ Requires=network-online.target After=network-online.target [Service] User=root Group=root ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/consul agent -config-dir=/etc/consul.d/client ExecReload=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/consul reload KillMode=process Restart=on-failure [Install] WantedBy=multi-user.target</code> </pre> <br><br>  рд╣рдо рд╕рд░реНрд╡рд░ рдкрд░ рдХреЙрдиреНрд╕рд▓ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЕрдм, рд╢реБрд░реВ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ nsul рд╕рджрд╕реНрдпреЛрдВ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХреА рдЧрдИ рд╕реЗрд╡рд╛ рдХреЛ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рд┐рдПред  рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рд╣реЛрдЧрд╛ рдХрд┐ рд╡рд╣ рдХреНрд▓рд╛рдЗрдВрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдХреНрд▓рд╕реНрдЯрд░ рд╕реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЬреБрдбрд╝рд╛ рд╣реБрдЖ рд╣реИред  рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдорд╛рди рджреЛрд╣рд░рд╛рдПрдВ рдФрд░ рдЙрд╕рдХреЗ рдмрд╛рдж рд╣рдо рдШреБрдордВрддреВ рдХреЛ рд╕реНрдерд╛рдкрд┐рдд рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред <br><br>  рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреА рдЕрдзрд┐рдХ рд╡рд┐рд╕реНрддреГрдд рд╕реНрдерд╛рдкрдирд╛ рдЗрд╕рдХреЗ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬ рдореЗрдВ рд╡рд░реНрдгрд┐рдд рд╣реИред  рджреЛ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╕реНрдерд╛рдкрдирд╛ рд╡рд┐рдзрд┐рдпрд╛рдБ рд╣реИрдВ: рдПрдХ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдФрд░ рд╕реНрд░реЛрдд рд╕реЗ рд╕рдВрдХрд▓рди рдХрд░рдирд╛ред  рдореИрдВ рдкрд╣рд▓реА рд╡рд┐рдзрд┐ рдЪреБрдиреВрдВрдЧрд╛ред <br><br>  <b>рдиреЛрдЯ</b> : рдкрд░рд┐рдпреЛрдЬрдирд╛ рдмрд╣реБрдд рддреЗрдЬреА рд╕реЗ рд╡рд┐рдХрд╕рд┐рдд рд╣реЛ рд░рд╣реА рд╣реИ, рдирдП рдЕрдкрдбреЗрдЯ рдЕрдХреНрд╕рд░ рд╕рд╛рдордиреЗ рдЖрддреЗ рд╣реИрдВред  рд╢рд╛рдпрдж, рдЬрдм рддрдХ рд▓реЗрдЦ рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛, рддрдм рддрдХ рдПрдХ рдирдпрд╛ рд╕рдВрд╕реНрдХрд░рдг рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред  рдЗрд╕рд▓рд┐рдП, рдореЗрд░рд╛ рд╕реБрдЭрд╛рд╡ рд╣реИ рдХрд┐ рдкрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЗрд╕ рд╕рдордп рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреЗ рд╡рд░реНрддрдорд╛рди рд╕рдВрд╕реНрдХрд░рдг рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдЗрд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># wget https://releases.hashicorp.com/nomad/0.9.1/nomad_0.9.1_linux_amd64.zip root@nomad-livelinux-01:~# unzip nomad_0.9.1_linux_amd64.zip root@nomad-livelinux-01:~# mv nomad /usr/local/bin/ root@nomad-livelinux-01:~# nomad -autocomplete-install root@nomad-livelinux-01:~# complete -C /usr/local/bin/nomad nomad root@nomad-livelinux-01:~# mkdir /etc/nomad.d</span></span></code> </pre> <br><br>  рдЕрдирдкреИрдХ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдореЗрдВ 65 MB рд╡рдЬрди рд╡рд╛рд▓реА рдПрдХ рдиреЛрдореИрдб рдмрд╛рдЗрдирд░реА рдлрд╛рдЗрд▓ рдорд┐рд▓реЗрдЧреА - рдЗрд╕реЗ / usr / рд▓реЛрдХрд▓ / рдмрд┐рди рдореЗрдВ рд▓реЗ рдЬрд╛рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдШреБрдордВрддреВ рдХреЗ рд▓рд┐рдП рдПрдХ рдбреЗрдЯрд╛ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдПрдВ рдФрд░ рдЗрд╕рдХреА рд╕реЗрд╡рд╛ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ (рдпрд╣ рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдзрд┐рдХ рд╕рдВрднрд╛рд╡рдирд╛ рдирд╣реАрдВ рд╣реЛрдЧреА): <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># mkdir --parents /opt/nomad root@nomad-livelinux-01:~# nano /etc/systemd/system/nomad.service</span></span></code> </pre> <br><br>  рд╡рд╣рд╛рдВ рдирд┐рдореНрди рдкрдВрдХреНрддрд┐рдпрд╛рдБ рдбрд╛рд▓реЗрдВ: <br><br><pre> <code class="bash hljs">[Unit] Description=Nomad Documentation=https://nomadproject.io/docs/ Wants=network-online.target After=network-online.target [Service] ExecReload=/bin/<span class="hljs-built_in"><span class="hljs-built_in">kill</span></span> -HUP <span class="hljs-variable"><span class="hljs-variable">$MAINPID</span></span> ExecStart=/usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/nomad agent -config /etc/nomad.d KillMode=process KillSignal=SIGINT LimitNOFILE=infinity LimitNPROC=infinity Restart=on-failure RestartSec=2 StartLimitBurst=3 StartLimitIntervalSec=10 TasksMax=infinity [Install] WantedBy=multi-user.target</code> </pre> <br><br>  рд╣рд╛рд▓рд╛рдБрдХрд┐, рд╣рдо рдЦрд╛рдирд╛рдмрджреЛрд╢ рдЪрд▓рд╛рдиреЗ рдХреА рдЬрд▓реНрджреА рдореЗрдВ рдирд╣реАрдВ рд╣реИрдВ - рд╣рдордиреЗ рдЕрднреА рддрдХ рдЗрд╕рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдирд╣реАрдВ рдмрдирд╛рдИ рд╣реИ: <br><br><pre> <code class="bash hljs">root@nomad-livelinux-01:~<span class="hljs-comment"><span class="hljs-comment"># mkdir --parents /etc/nomad.d root@nomad-livelinux-01:~# chmod 700 /etc/nomad.d root@nomad-livelinux-01:~# nano /etc/nomad.d/nomad.hcl root@nomad-livelinux-01:~# nano /etc/nomad.d/server.hcl</span></span></code> </pre><br><br>  рдЕрдВрддрд┐рдо рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕рдВрд░рдЪрдирд╛ рдирд┐рдореНрдирд╛рдиреБрд╕рд╛рд░ рд╣реЛрдЧреА: <br><br><pre> <code class="bash hljs">/etc/nomad.d/ тФЬтФАтФА nomad.hcl тФФтФАтФА server.hcl</code> </pre> <br><br>  Nomad.hcl рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рдореНрди рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП: <br><br><pre> <code class="bash hljs">datacenter = <span class="hljs-string"><span class="hljs-string">"dc1"</span></span> data_dir = <span class="hljs-string"><span class="hljs-string">"/opt/nomad"</span></span></code> </pre> <br><br>  Server.hcl рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА: <br><br><pre> <code class="bash hljs">server { enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> bootstrap_expect = 1 } consul { address = <span class="hljs-string"><span class="hljs-string">"127.0.0.1:8500"</span></span> server_service_name = <span class="hljs-string"><span class="hljs-string">"nomad"</span></span> client_service_name = <span class="hljs-string"><span class="hljs-string">"nomad-client"</span></span> auto_advertise = <span class="hljs-literal"><span class="hljs-literal">true</span></span> server_auto_join = <span class="hljs-literal"><span class="hljs-literal">true</span></span> client_auto_join = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } bind_addr = <span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span> advertise { http = <span class="hljs-string"><span class="hljs-string">"172.30.0.5"</span></span> } client { enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><br>  рджреВрд╕рд░реЗ рд╕рд░реНрд╡рд░ рдкрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдХреЛ рдмрджрд▓рдирд╛ рди рднреВрд▓реЗрдВ - рд╡рд╣рд╛рдВ рдЖрдкрдХреЛ http рдирд┐рд░реНрджреЗрд╢ рдХреЗ рдореВрд▓реНрдп рдХреЛ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ред <br><br>  рдЗрд╕ рд╕реНрддрд░ рдкрд░ рдЕрдВрддрд┐рдо http рдкреНрд░рд╛рдзрд┐рдХрд░рдг рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдФрд░ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП Nginx рдХрд╛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╣реИред  Nomad.conf рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА: <br><br><pre> <code class="bash hljs">upstream nomad-auth { server 172.30.0.5:4646; } server { server_name nomad.domain.name; location / { proxy_pass http://nomad-auth; proxy_set_header Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; auth_basic_user_file /etc/nginx/.htpasswd; auth_basic <span class="hljs-string"><span class="hljs-string">"Password-protected Area"</span></span>; } }</code> </pre> <br><br>  рдЕрдм рд╣рдо рдмрд╛рд╣рд░реА рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдм рдкреИрдирд▓ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред  рд╣рдо рдХрдиреЗрдХреНрдЯ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рд╕рд░реНрд╡рд░ рдкреЗрдЬ рдкрд░ рдЬрд╛рддреЗ рд╣реИрдВ: <br><br><img src="https://habrastorage.org/webt/en/uq/ck/enuqck8krqstsbt8b6uwbytoy0e.png"><br>  <b>рдЪрд┐рддреНрд░рд╛ 1.</b> рдПрдХ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреА рд╕реВрдЪреА <br><br>  рджреЛрдиреЛрдВ рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдкреИрдирд▓ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╡рд╣реА рдЪреАрдЬрд╝ рдЬреЛ рд╣рдо рдЦрд╛рдирд╛рдмрджреЛрд╢ рдиреЛрдб рд╕реНрдерд┐рддрд┐ рдХрдорд╛рдВрдб рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗ: <br><br><img src="https://habrastorage.org/webt/c1/gv/82/c1gv82tjvwtw0onqxqv3huchv1w.png"><br>  <b>рдЫрд╡рд┐ 2.</b> рдЦрд╛рдирд╛рдмрджреЛрд╢ рдиреЛрдб рд╕реНрдерд┐рддрд┐ рдХрдорд╛рдВрдб рдХрд╛ рдЙрддреНрдкрд╛рджрди <br><br>  рдХреМрдВрд╕рд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?  рдЖрдЗрдП рджреЗрдЦрддреЗ рд╣реИрдВред  рдХреЙрдиреНрд╕рд▓ рдХрдВрдЯреНрд░реЛрд▓ рдкреИрдирд▓ рдкрд░, рдиреЛрдбреНрд╕ рдкреЗрдЬ рдкрд░ рдЬрд╛рдПрдВ: <br><img src="https://habrastorage.org/webt/m5/6w/tj/m56wtjjgkos9ed5e_jy9lidmutg.png"><br>  <b>рдЪрд┐рддреНрд░рд╛ 3.</b> рд╡рд╛рдгрд┐рдЬреНрдп рджреВрддрд╛рд╡рд╛рд╕ рдореЗрдВ рдиреЛрдбреНрд╕ рдХреА рд╕реВрдЪреА <br><br>  рдЕрдм рд╣рдордиреЗ рдХрдиреНрд╕рд▓ рдХреЗ рд╕рд╛рде рдорд┐рд▓рдХрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реБрдП рдЦрд╛рдирд╛рдмрджреЛрд╢ рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рд╣реИред  рдЕрдВрддрд┐рдо рдЪрд░рдг рдореЗрдВ, рд╣рдо рд╕рдмрд╕реЗ рджрд┐рд▓рдЪрд╕реНрдк рднрд╛рдЧ рд╢реБрд░реВ рдХрд░реЗрдВрдЧреЗ: рд╣рдо рдбреЙрдХрдЯрд░ рдХрдВрдЯреЗрдирд░реЛрдВ рдХреЛ рдЧрд┐рдЯрд▓реИрдм рд╕реЗ рдШреБрдордВрддреВ рддрдХ рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВрдЧреЗ, рд╕рд╛рде рд╣реА рдЗрд╕рдХреЗ рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдмрд╛рдд рдХрд░реЗрдВрдЧреЗред <br><br><h2>  рдЧрд┐рдЯрд▓реИрдм рд░рдирд░ рдмрдирд╛рдПрдБ <br></h2><br><br>  рдШреБрдордВрддреВ рдЫрд╡рд┐рдпреЛрдВ рдХреЛ рдШреБрдордВрддреВ рдореЗрдВ рддреИрдирд╛рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдо рдШреБрдордВрддреВ рдмрд╛рдЗрдирд░реА рдлрд╝рд╛рдЗрд▓ рдХреЗ рд╕рд╛рде рдПрдХ рдЕрд▓рдЧ рдзрд╛рд╡рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ (рдпрд╣рд╛рдВ, рд╡реИрд╕реЗ, рд╣рд╛рд╢рд┐рдХреЙрд░реНрдк рдХреЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреА рдПрдХ рдФрд░ рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдиреЛрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ - рд╡реНрдпрдХреНрддрд┐рдЧрдд рд░реВрдк рд╕реЗ рд╡реЗ рдХреЗрд╡рд▓ рджреНрд╡рд┐рдЖрдзрд╛рд░реА рдлрд╝рд╛рдЗрд▓ рд╣реИрдВ)ред  рдЗрд╕реЗ рд░рдирд░ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВред  рдЙрд╕рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░рд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде рд╕рдмрд╕реЗ рд╕рд░рд▓ рдбреЙрдХрдлрд╛рдЗрд▓ рдмрдирд╛рдПрдВ: <br><br><pre> <code class="bash hljs">FROM alpine:3.9 RUN apk add --update --no-cache libc6-compat gettext COPY nomad /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/bin/nomad</code> </pre><br><br>  рдПрдХ рд╣реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ, .itlab-ci.yml рдмрдирд╛рдПрдБ: <br><br><pre> <code class="bash hljs">variables: DOCKER_IMAGE: nomad/nomad-deploy DOCKER_REGISTRY: registry.domain.name stages: - build build: stage: build image: <span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/nomad/alpine:3 script: - tag=<span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DOCKER_IMAGE}</span></span>:latest - docker build --pull -t <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span> -f Dockerfile . - docker push <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span></code> </pre> <br><br>  рдирддреАрдЬрддрди, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдЧрд┐рдЯреНрд▓рд╛рдм рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдШреБрдордВрддреВ рдзрд╛рд╡рдХ рдХреА рдПрдХ рд╕реБрд▓рдн рдЫрд╡рд┐ рд╣реЛрдЧреА, рдЕрдм рд╣рдо рд╕реАрдзреЗ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдореЗрдВ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреЛ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред <br><br><h2>  рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕реЗрдЯрдЕрдк <br></h2><br><br>  рдЪрд▓рд┐рдП рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреЗ рд▓рд┐рдП рдиреМрдХрд░реА рдХреА рдлрд╛рдЗрд▓ рд╕реЗ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред  рдЗрд╕ рд▓реЗрдЦ рдореЗрдВ рдореЗрд░реА рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛рдлреА рдЖрджрд┐рдо рд╣реЛрдЧреА: рдЗрд╕рдореЗрдВ рдПрдХ рдХрд╛рд░реНрдп рд╢рд╛рдорд┐рд▓ рд╣реЛрдЧрд╛ред  .Itlabab-ci рдХреА рд╕рд╛рдордЧреНрд░реА рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реЛрдЧреА: <br><br><pre> <code class="bash hljs">variables: NOMAD_ADDR: http://nomad.address.service:4646 DOCKER_REGISTRY: registry.domain.name DOCKER_IMAGE: example/project stages: - build - deploy build: stage: build image: <span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/nomad-runner/alpine:3 script: - tag=<span class="hljs-variable"><span class="hljs-variable">${DOCKER_REGISTRY}</span></span>/<span class="hljs-variable"><span class="hljs-variable">${DOCKER_IMAGE}</span></span>:<span class="hljs-variable"><span class="hljs-variable">${CI_COMMIT_SHORT_SHA}</span></span> - docker build --pull -t <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span> -f Dockerfile . - docker push <span class="hljs-variable"><span class="hljs-variable">${tag}</span></span> deploy: stage: deploy image: registry.example.com/nomad/nomad-runner:latest script: - envsubst <span class="hljs-string"><span class="hljs-string">'${CI_COMMIT_SHORT_SHA}'</span></span> &lt; project.nomad &gt; job.nomad - cat job.nomad - nomad validate job.nomad - nomad plan job.nomad || <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $? -eq 255 ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 255; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"success"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> - nomad run job.nomad environment: name: production allow_failure: <span class="hljs-literal"><span class="hljs-literal">false</span></span> when: manual</code> </pre> <br><br>  рдпрд╣рд╛рдВ рддреИрдирд╛рддреА рдореИрдиреБрдЕрд▓ рдореЛрдб рдореЗрдВ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдЖрдк рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдореЗрдВ рджреЛ рдЪрд░рдг рд╣реЛрддреЗ рд╣реИрдВ: рдЫрд╡рд┐ рдХреА рд╡рд┐рдзрд╛рдирд╕рднрд╛ рдФрд░ рдЗрд╕рдХреА рддреИрдирд╛рддреА рд╕реЗ рдЦрд╛рдирд╛рдмрджреЛрд╢ рддрдХред  рдкрд╣рд▓реЗ рдЪрд░рдг рдореЗрдВ, рд╣рдо рдбреЙрдХрдЯрд░ рдЫрд╡рд┐ рдХреЛ рдЗрдХрдЯреНрдард╛ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдореЗрдВ рдзрдХреЗрд▓рддреЗ рд╣реИрдВ, рджреВрд╕рд░реЗ рдкрд░, рд╣рдо рдиреЛрдореИрдб рдореЗрдВ рдЕрдкрдирд╛ рдХрд╛рдо рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВред <br><br><pre> <code class="bash hljs">job <span class="hljs-string"><span class="hljs-string">"monitoring-status"</span></span> { datacenters = [<span class="hljs-string"><span class="hljs-string">"dc1"</span></span>] migrate { max_parallel = 3 health_check = <span class="hljs-string"><span class="hljs-string">"checks"</span></span> min_healthy_time = <span class="hljs-string"><span class="hljs-string">"15s"</span></span> healthy_deadline = <span class="hljs-string"><span class="hljs-string">"5m"</span></span> } group <span class="hljs-string"><span class="hljs-string">"zhadan.ltd"</span></span> { count = 1 update { max_parallel = 1 min_healthy_time = <span class="hljs-string"><span class="hljs-string">"30s"</span></span> healthy_deadline = <span class="hljs-string"><span class="hljs-string">"5m"</span></span> progress_deadline = <span class="hljs-string"><span class="hljs-string">"10m"</span></span> auto_revert = <span class="hljs-literal"><span class="hljs-literal">true</span></span> } task <span class="hljs-string"><span class="hljs-string">"service-monitoring"</span></span> { driver = <span class="hljs-string"><span class="hljs-string">"docker"</span></span> config { image = <span class="hljs-string"><span class="hljs-string">"registry.domain.name/example/project:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CI_COMMIT_SHORT_SHA}</span></span></span><span class="hljs-string">"</span></span> force_pull = <span class="hljs-literal"><span class="hljs-literal">true</span></span> auth { username = <span class="hljs-string"><span class="hljs-string">"gitlab_user"</span></span> password = <span class="hljs-string"><span class="hljs-string">"gitlab_password"</span></span> } port_map { http = 8000 } } resources { network { port <span class="hljs-string"><span class="hljs-string">"http"</span></span> {} } } } } }</code> </pre> <br><br>  рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдореЗрд░реЗ рдкрд╛рд╕ рдПрдХ рдирд┐рдЬреА рд░рдЬрд┐рд╕реНрдЯреНрд░реА рд╣реИ рдФрд░ рдПрдХ рд╕рдлрд▓ рдбреЙрдХрдЯрд░ рдЫрд╡рд┐ рдкреВрд▓ рдХреЗ рд▓рд┐рдП рдореБрдЭреЗ рдЗрд╕рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред  рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╕рдмрд╕реЗ рдЕрдЪреНрдЫрд╛ рд╕рдорд╛рдзрд╛рди рд╡реЙрд▓реНрдЯ рдореЗрдВ рд▓реЙрдЧрд┐рди рдФрд░ рдкрд╛рд╕рд╡рд░реНрдб рджрд░реНрдЬ рдХрд░рдирд╛ рд╣реИ, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рд╣реИред  рдШреБрдордВрддреВ рдореВрд▓ рд░реВрдк рд╕реЗ рддрд┐рдЬреЛрд░реА рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред  рд▓реЗрдХрд┐рди рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╡реЙрд▓реНрдЯ рдореЗрдВ рд╣реА, рд╣рдо рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдиреАрддрд┐рдпрд╛рдВ рд╕реНрдерд╛рдкрд┐рдд рдХрд░реЗрдВрдЧреЗ, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Download the policy and token role $ curl https://nomadproject.io/data/vault/nomad-server-policy.hcl -O -s -L $ curl https://nomadproject.io/data/vault/nomad-cluster-role.json -O -s -L # Write the policy to Vault $ vault policy write nomad-server nomad-server-policy.hcl # Create the token role with Vault $ vault write /auth/token/roles/nomad-cluster @nomad-cluster-role.json</span></span></code> </pre> <br><br>  рдЕрдм, рдЖрд╡рд╢реНрдпрдХ рдиреАрддрд┐рдпрд╛рдВ рдмрдирд╛рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдХрд╛рд░реНрдп рдмреНрд▓реЙрдХ рдореЗрдВ рд╡реЙрд▓реНрдЯ рдХреЗ рд╕рд╛рде рдПрдХреАрдХрд░рдг рдХреЛ рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗред <br><br><pre> <code class="bash hljs">vault { enabled = <span class="hljs-literal"><span class="hljs-literal">true</span></span> address = <span class="hljs-string"><span class="hljs-string">"https://vault.domain.name:8200"</span></span> token = <span class="hljs-string"><span class="hljs-string">"token"</span></span> }</code> </pre> <br><br>  рдореИрдВ рдЯреЛрдХрди рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реВрдВ рдФрд░ рдЗрд╕реЗ рд╕реАрдзреЗ рдпрд╣рд╛рдВ рд▓рд┐рдЦрддрд╛ рд╣реВрдВ, рдЪрд╛рд▓реВ рдХрд░рдиреЗ рдХреЗ рд╕рдордп рдЯреЛрдХрди рдХреЛ рдПрдХ рдЪрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХрд╛ рд╡рд┐рдХрд▓реНрдк рднреА рд╣реИ: <br><br><pre> <code class="bash hljs">$ VAULT_TOKEN=&lt;token&gt; nomad agent -config /path/to/config</code> </pre><br><br>  рдЕрдм рд╣рдо рддрд┐рдЬреЛрд░реА рдХреЗ рд╕рд╛рде рдЪрд╛рдмрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдСрдкрд░реЗрд╢рди рдХрд╛ рд╕рд┐рджреНрдзрд╛рдВрдд рд╕рд░рд▓ рд╣реИ: рд╣рдо рдЦрд╛рдирд╛рдмрджреЛрд╢ рдиреМрдХрд░реА рдореЗрдВ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдЪрд░ рдХреЗ рдореВрд▓реНрдпреЛрдВ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП: <br><br><pre> <code class="bash hljs">template { data = &lt;&lt;EOH {{with secret <span class="hljs-string"><span class="hljs-string">"secrets/pipeline-keys"</span></span>}} REGISTRY_LOGIN=<span class="hljs-string"><span class="hljs-string">"{{ .Data.REGISTRY_LOGIN }}"</span></span> REGISTRY_PASSWORD=<span class="hljs-string"><span class="hljs-string">"{{ .Data.REGISTRY_LOGIN }}{{ end }}"</span></span> EOH destination = <span class="hljs-string"><span class="hljs-string">"secrets/service-name.env"</span></span> env = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }</code> </pre> <br><br>  рдЗрд╕ рд╕рд░рд▓ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЗ рд╕рд╛рде, рдЖрдк рдХрдВрдЯреЗрдирд░ рдХреЗ рд╡рд┐рддрд░рдг рдХреЛ рдЦрд╛рдирд╛рдмрджреЛрд╢ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рдЗрд╕рдХреЗ рд╕рд╛рде рдХрд╛рдо рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред  рдореИрдВ рдХрд╣реВрдВрдЧрд╛ рдХрд┐ рдХреБрдЫ рд╣рдж рддрдХ рдореИрдВ рдШреБрдордВрддреВ рдХреЗ рд╕рд╛рде рд╕рд╣рд╛рдиреБрднреВрддрд┐ рд░рдЦрддрд╛ рд╣реВрдВ - рдпрд╣ рдЙрди рдЫреЛрдЯреА рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рдЙрдкрдпреБрдХреНрдд рд╣реИ рдЬрд╣рд╛рдВ рдХреБрдмреЗрд░рдиреЗрдЯреНрд╕ рдЕрддрд┐рд░рд┐рдХреНрдд рдХрдард┐рдирд╛рдЗрдпреЛрдВ рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдВрдд рддрдХ рдЗрд╕рдХреА рдХреНрд╖рдорддрд╛ рдХрд╛ рдПрд╣рд╕рд╛рд╕ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗред  рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдШреБрдордВрддреВ рд╢реБрд░реБрдЖрддреА рдХреЗ рд▓рд┐рдП рдПрдХрджрдо рд╕рд╣реА рд╣реИ - рдЗрд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рдФрд░ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИред  рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ рдкрд░рд┐рдпреЛрдЬрдирд╛рдУрдВ рдкрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░рддреЗ рд╕рдордп, рдореИрдВ рдЗрд╕рдХреЗ рдкрд╣рд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреА рд╕рдорд╕реНрдпрд╛ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рддрд╛ рд╣реВрдВ - рдХрдИ рдмреБрдирд┐рдпрд╛рджреА рдХрд╛рд░реНрдп рдмрд╕ рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВ рдпрд╛ рд╡реЗ рд╕рд╣реА рддрд░реАрдХреЗ рд╕реЗ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред  рдлрд┐рд░ рднреА, рдореБрдЭреЗ рд╡рд┐рд╢реНрд╡рд╛рд╕ рд╣реИ рдХрд┐ рдШреБрдордВрддреВ рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдЬрд╛рд░реА рд░рд╣реЗрдЧрд╛ рдФрд░ рднрд╡рд┐рд╖реНрдп рдореЗрдВ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдХрд╛рд░реНрдпреЛрдВ рдХрд╛ рдЕрдзрд┐рдЧреНрд░рд╣рдг рдХрд░реЗрдЧрд╛ред <br><br>  <i>рдПрд▓реЗрдХреНрд╕рд┐рдпрд╛ рдЬрд╝рд╛рджрд╛рди рдФрд░ рд▓рд╛рдЗрд╡ рд▓рд┐рдирдХреНрд╕ рдЯреАрдо рджреНрд╡рд╛рд░рд╛ рд╕рдВрдкрд╛рджрд┐рдд рдЗрд▓реНрдпрд╛ рдПрдВрдбреНрд░реАрд╡ рджреНрд╡рд╛рд░рд╛ рдкреЛрд╕реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛</i> <i><br></i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/hi453322/">https://habr.com/ru/post/hi453322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../hi453310/index.html">RxJS рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рдПрдХреНрдЯ рдШрдЯрдХреЛрдВ рдХреЗ рдмреАрдЪ рдбреЗрдЯрд╛ рдХрд╛ рдЖрджрд╛рди-рдкреНрд░рджрд╛рди</a></li>
<li><a href="../hi453312/index.html">рдПрдХреНрд╕рдПрдордПрд▓ рдбреЗрдЯрд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреАрдбреАрдПрдл рд╡реНрдпрд╛рдкрд╛рд░ рдИрдореЗрд▓ рдЬрдирд░реЗрдЯрд░</a></li>
<li><a href="../hi453314/index.html">DIY рдмреНрд▓реИрдХ рдорд┐рд░рд░ - рдЕрдкрдиреЗ рдЪреИрдЯ рдЗрддрд┐рд╣рд╛рд╕ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдПрдХ рдмреЙрдЯ рд╕рд┐рдЦрд╛рддреЗ рд╣реИрдВ</a></li>
<li><a href="../hi453316/index.html">рдмреНрд░рд┐рдЯрд┐рд╢ рдЪрд┐рдк рдирд┐рд░реНрдорд╛рддрд╛ рдПрдЖрд░рдПрдо рд╣реБрдЖрд╡реЗрдИ рдХреЗ рд╕рд╛рде рд╕рд╣рдпреЛрдЧ рдмрдВрдж рдХрд░ рджреЗрддрд╛ рд╣реИ</a></li>
<li><a href="../hi453318/index.html">рдореЛрдмрд╛рдЗрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдкреБрд╢ рд╕реВрдЪрдирд╛рдУрдВ рдХреЗ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдореЗрдВ 5 рддреНрд░реБрдЯрд┐рдпрд╛рдВ</a></li>
<li><a href="../hi453324/index.html">рдПрдХ рд╢реБрджреНрдз рдХреЗ рд░реВрдк рдореЗрдВ рдбрд╛рдпреЛрдб</a></li>
<li><a href="../hi453326/index.html">рдЖрдИрдЯреА рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдкреНрд░рдмрдВрдзрди рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдХреИрд╕реЗ рдХрд░реЗрдВ - рддреАрди рд░реБрдЭрд╛рдиреЛрдВ рдкрд░ рдЪрд░реНрдЪрд╛ рдХрд░реЗрдВ</a></li>
<li><a href="../hi453328/index.html">рдПрдХ рджреВрд░рд╕реНрде рд╕рд╛рдЗрдЯ рдкрд░ рджрд╕ рд╕рд╛рд▓</a></li>
<li><a href="../hi453330/index.html">рдЕрдЧрд░ рд░реИрдо рдХреНрд░реИрд╢ рд╣реЛ рдЬрд╛рдП рддреЛ рдХреНрдпрд╛ рдХрд░реЗрдВред рдПрдирд╛рдордиреЗрд╕рд┐рд╕ рдФрд░ рдЙрдкрдЪрд╛рд░ рдХреЗ рддрд░реАрдХреЗ</a></li>
<li><a href="../hi453332/index.html">рд╣рд╛рд░реНрдб рдбрд┐рд╕реНрдХ рд╕реНрдерд╛рди рдХреЛ рдмрдЪрд╛рдиреЗ рдХреА рдЕрдЬреАрдм рд╡рд┐рдзрд┐ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>