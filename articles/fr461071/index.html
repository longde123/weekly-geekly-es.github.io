<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘¨ğŸ¼â€ğŸ’» ğŸ‘©â€â¤ï¸â€ğŸ’‹â€ğŸ‘© ğŸ§™ğŸ» Optimisation des requÃªtes de base de donnÃ©es sur l'exemple de service B2B pour les constructeurs ğŸ‘¦ğŸ½ ğŸ‘ ğŸ‘Š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Comment faire croÃ®tre 10 fois le nombre de requÃªtes de base de donnÃ©es sans passer Ã  un serveur plus efficace et maintenir le systÃ¨me en marche? Je va...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Optimisation des requÃªtes de base de donnÃ©es sur l'exemple de service B2B pour les constructeurs</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461071/"> Comment faire croÃ®tre 10 fois le nombre de requÃªtes de base de donnÃ©es sans passer Ã  un serveur plus efficace et maintenir le systÃ¨me en marche?  Je vais vous dire comment nous avons luttÃ© avec la dÃ©gradation des performances de notre base de donnÃ©es, comment nous avons optimisÃ© les requÃªtes SQL pour servir le plus d'utilisateurs possible et ne pas augmenter le coÃ»t des ressources informatiques. <br><a name="habracut"></a><br>  Je fais un service de gestion des processus d'affaires dans les entreprises de construction.  Environ 3 000 entreprises travaillent avec nous.  Plus de 10 000 personnes travaillent quotidiennement avec notre systÃ¨me pendant 4 Ã  10 heures.  Il rÃ©sout diverses tÃ¢ches de planification, alertes, avertissements, validations ... Nous utilisons PostgreSQL 9.6.  Nous avons environ 300 tables dans la base de donnÃ©es et chaque jour, jusqu'Ã  200 millions de demandes (10 000 diffÃ©rentes) lui sont envoyÃ©es.  En moyenne, nous avons 3 Ã  4 000 demandes par seconde, dans les moments les plus actifs, plus de 10 000 demandes par seconde.  La plupart des demandes sont OLAP.  Il y a beaucoup moins d'ajouts, de modifications et de suppressions, c'est-Ã -dire que la charge OLTP est relativement faible.  J'ai donnÃ© tous ces chiffres afin que vous puissiez Ã©valuer la portÃ©e de notre projet et comprendre comment notre expÃ©rience peut vous Ãªtre utile. <br><br><h3>  La premiÃ¨re photo.  Lyrique </h3><br>  Lorsque nous avons commencÃ© le dÃ©veloppement, nous ne pensions pas vraiment au type de charge qui tomberait sur la base de donnÃ©es et Ã  ce que nous ferions si le serveur arrÃªtait de tirer.  Lors de la conception de la base de donnÃ©es, nous avons suivi les recommandations gÃ©nÃ©rales et essayÃ© de ne pas nous tirer dans le pied, mais au-delÃ  des conseils gÃ©nÃ©raux tels que Â«n'utilisez pas le modÃ¨le de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">valeurs d'attribut d'entitÃ©</a> , nous n'y sommes pas allÃ©s.  ConÃ§u sur la base des principes de normalisation Ã©vitant la redondance des donnÃ©es et ne se souciant pas d'accÃ©lÃ©rer certaines requÃªtes.  DÃ¨s l'arrivÃ©e des premiers utilisateurs, nous avons rencontrÃ© un problÃ¨me de performances.  Comme d'habitude, nous n'Ã©tions absolument pas prÃ©parÃ©s Ã  cela.  Les premiers problÃ¨mes Ã©taient simples.  En rÃ¨gle gÃ©nÃ©rale, tout a Ã©tÃ© dÃ©cidÃ© en ajoutant un nouvel index.  Mais il est arrivÃ© un moment oÃ¹ de simples correctifs ne fonctionnaient plus.  Ayant rÃ©alisÃ© qu'il n'y a pas assez d'expÃ©rience et qu'il devient de plus en plus difficile de comprendre quelle est la cause des problÃ¨mes, nous avons embauchÃ© des spÃ©cialistes qui nous ont aidÃ©s Ã  configurer correctement le serveur, Ã  connecter la surveillance, Ã  montrer oÃ¹ chercher pour obtenir des <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">statistiques</a> . <br><br><h3>  La deuxiÃ¨me photo.  Statistiques </h3><br>  Nous avons donc environ 10 000 requÃªtes diffÃ©rentes qui sont exÃ©cutÃ©es par jour dans notre base de donnÃ©es.  Sur ces 10 000, il y a des monstres qui s'exÃ©cutent 2 Ã  3 millions de fois avec un temps d'exÃ©cution moyen de 0,1 Ã  0,3 ms et il y a des requÃªtes avec un temps d'exÃ©cution moyen de 30 secondes qui sont appelÃ©es 100 fois par jour. <br><br>  Il n'a pas Ã©tÃ© possible d'optimiser les 10 000 requÃªtes, nous avons donc dÃ©cidÃ© de dÃ©terminer oÃ¹ diriger les efforts afin d'amÃ©liorer correctement les performances de la base de donnÃ©es.  AprÃ¨s plusieurs itÃ©rations, nous avons commencÃ© Ã  diviser les demandes en types. <br><br><h4>  TOP requÃªtes </h4><br>  Ce sont les requÃªtes les plus difficiles qui prennent le plus de temps (temps total).  Ce sont des requÃªtes qui sont soit appelÃ©es trÃ¨s souvent, soit des requÃªtes qui prennent trÃ¨s longtemps (les requÃªtes longues et frÃ©quentes ont Ã©tÃ© optimisÃ©es dÃ¨s les premiÃ¨res itÃ©rations de la lutte pour la vitesse).  En consÃ©quence, le serveur passe le plus de temps Ã  leur exÃ©cution au total.  De plus, il est important de sÃ©parer les requÃªtes principales par le temps d'exÃ©cution total et sÃ©parÃ©ment par le temps d'E / S.  Les moyens d'optimiser ces requÃªtes sont lÃ©gÃ¨rement diffÃ©rents. <br><br>  La pratique habituelle de toutes les entreprises est de traiter les demandes TOP.  Il y en a peu, l'optimisation d'une seule demande peut libÃ©rer jusqu'Ã  5 Ã  10% des ressources.  Cependant, Ã  mesure que le projet vieillit, l'optimisation des requÃªtes TOP devient une tÃ¢che de plus en plus simple.  Toutes les mÃ©thodes simples ont dÃ©jÃ  Ã©tÃ© Ã©laborÃ©es, et mÃªme la demande la plus Â«difficileÂ» ne prend Â«queÂ» 3 Ã  5% des ressources.  Si les requÃªtes TOP prennent au total moins de 30 Ã  40% du temps, alors vous avez probablement dÃ©jÃ  fait des efforts pour qu'elles fonctionnent rapidement et il est temps de passer Ã  l'optimisation des requÃªtes du groupe suivant. <br>  Il reste Ã  rÃ©pondre Ã  la question du nombre de requÃªtes principales Ã  inclure dans ce groupe.  Je prends habituellement pas moins de 10, mais pas plus de 20. J'essaie de faire en sorte que l'heure du premier et du dernier dans le groupe TOP ne diffÃ¨re pas plus de 10 fois.  Autrement dit, si le temps d'exÃ©cution de la requÃªte chute fortement de 1 Ã  10, alors je prends TOP-10, si la chute est plus fluide, alors j'augmente la taille du groupe Ã  15 ou 20. <br><img src="https://habrastorage.org/webt/y5/j5/yx/y5j5yxa6u4kxlpahplsaprh07ro.png" alt="image"><br><br><h4>  Paysans moyens (moyen) </h4><br>  Ce sont toutes des demandes qui vont immÃ©diatement aprÃ¨s TOP, Ã  l'exception des 5-10% derniers.  Habituellement, dans l'optimisation de ces demandes particuliÃ¨res rÃ©side la possibilitÃ© d'augmenter considÃ©rablement les performances du serveur.  Ces requÃªtes peuvent Â«peserÂ» jusqu'Ã  80%.  Mais mÃªme si leur part a dÃ©passÃ© 50%, il est temps de les regarder de plus prÃ¨s. <br><br><h4>  Queue </h4><br>  Comme cela a Ã©tÃ© dit, ces demandes vont Ã  la fin et prennent 5 Ã  10% du temps.  Vous ne pouvez les oublier que si vous n'utilisez pas d'outils d'analyse automatique des requÃªtes, leur optimisation peut Ã©galement Ãªtre bon marchÃ©. <br><br>  Comment Ã©valuer chaque groupe? <br><br>  J'utilise une requÃªte SQL qui aide Ã  faire une telle Ã©valuation pour PostgreSQL (je suis sÃ»r que pour de nombreux autres SGBD, vous pouvez Ã©crire une requÃªte similaire) <br><br><div class="spoiler">  <b class="spoiler_title">RequÃªte SQL pour estimer la taille des groupes TOP-MEDIUM-TAIL</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(time_top) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> sum_top, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(time_medium) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> sum_medium, <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(time_tail) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> sum_tail <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> rn &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> tt_percent <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> time_top, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> rn &gt; <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> rn &lt;= <span class="hljs-number"><span class="hljs-number">800</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> tt_percent <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> time_medium, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> rn &gt; <span class="hljs-number"><span class="hljs-number">800</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> tt_percent <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> time_tail <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> total_time / (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(total_time) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_statements) * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tt_percent, <span class="hljs-keyword"><span class="hljs-keyword">query</span></span>, ROW_NUMBER () <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> total_time <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rn <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_statements <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> total_time <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> t ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> ts</code> </pre> <br></div></div><br>  Le rÃ©sultat de la requÃªte est composÃ© de trois colonnes, chacune contenant un pourcentage du temps consacrÃ© au traitement des demandes de ce groupe.  Dans la requÃªte, il y a deux nombres (dans mon cas, 20 et 800) qui sÃ©parent les demandes d'un groupe d'un autre. <br><br>  C'est ainsi que les proportions de demandes au moment du dÃ©marrage des travaux d'optimisation sont Ã  peu prÃ¨s en corrÃ©lation. <br><br><img src="https://habrastorage.org/webt/db/at/i_/dbati_rdn49yulwdicigqdvrgew.png"><br><br>  Le diagramme montre que la part des demandes TOP a fortement diminuÃ©, mais les Â«paysans moyensÂ» ont augmentÃ©. <br>  Initialement, les erreurs TOP ont touchÃ© les requÃªtes TOP.  Au fil du temps, les maladies infantiles ont disparu, la part des demandes TOP a Ã©tÃ© rÃ©duite et davantage d'efforts ont dÃ» Ãªtre faits pour accÃ©lÃ©rer les demandes difficiles. <br><br><div class="spoiler">  <b class="spoiler_title">Pour obtenir le texte des demandes, nous utilisons une telle demande</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ROW_NUMBER () <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> total_time <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> rn, total_time / (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(total_time) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_statements) * <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> tt_percent, <span class="hljs-keyword"><span class="hljs-keyword">query</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> pg_stat_statements <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> total_time <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> T <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> rn &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-comment"><span class="hljs-comment">-- TOP -- rn &gt; 20 AND rn &lt;= 800 -- MEDIUM -- rn &gt; 800 -- TAIL</span></span></code> </pre><br></div></div><br>  Voici une liste des astuces les plus couramment utilisÃ©es qui nous ont aidÃ©s Ã  accÃ©lÃ©rer les requÃªtes TOP: <br><br><ul><li>  Refonte des systÃ¨mes, par exemple, traitement de la logique de notification sur le courtier de messages au lieu des requÃªtes de base de donnÃ©es pÃ©riodiques </li><li>  Ajout ou modification d'index </li><li>  RÃ©Ã©crire les requÃªtes ORM en SQL pur </li><li>  RÃ©Ã©crire la logique de chargement des donnÃ©es paresseuses </li><li>  Mise en cache via la dÃ©normalisation des donnÃ©es.  Par exemple, nous avons un lien entre les tables Livraison -&gt; Facture -&gt; Demande -&gt; Demande.  En d'autres termes, chaque livraison est associÃ©e Ã  l'application via d'autres tables.  Afin de ne pas lier toutes les tables dans chaque demande, nous avons dupliquÃ© le lien vers l'application dans la table de livraison. </li><li>  Mise en cache des tables statiques avec des rÃ©pertoires et rarement des tables changeantes dans la mÃ©moire du programme. </li></ul><br>  Parfois, les changements entraÃ®naient une refonte impressionnante, mais ils donnaient 5 Ã  10% du dÃ©chargement du systÃ¨me et Ã©taient justifiÃ©s.  Au fil du temps, l'Ã©chappement est devenu de moins en moins, et la refonte devait Ãªtre de plus en plus sÃ©rieuse. <br><br>  Nous avons ensuite attirÃ© l'attention sur le deuxiÃ¨me groupe de demandes - le groupe des paysans moyens.  Il a beaucoup plus de demandes et il semblait que cela prendrait beaucoup de temps pour analyser l'ensemble du groupe.  Cependant, la plupart des requÃªtes se sont avÃ©rÃ©es trÃ¨s simples pour l'optimisation, et de nombreux problÃ¨mes ont Ã©tÃ© rÃ©pÃ©tÃ©s des dizaines de fois dans diffÃ©rentes variantes.  Voici des exemples d'optimisations typiques que nous avons appliquÃ©es Ã  des dizaines de requÃªtes similaires et chaque groupe de requÃªtes optimisÃ©es a dÃ©chargÃ© la base de donnÃ©es de 3 Ã  5%. <br><br><ul><li>  Au lieu de vÃ©rifier la prÃ©sence d'enregistrements avec COUNT et une analyse complÃ¨te de la table, EXISTS <br></li><li>  Nous nous sommes dÃ©barrassÃ©s de DISTINCT (il n'y a pas de recette gÃ©nÃ©rale, mais parfois vous pouvez facilement vous en dÃ©barrasser en accÃ©lÃ©rant la requÃªte 10 Ã  100 fois). <br><br>  Par exemple, au lieu d'interroger pour sÃ©lectionner tous les pilotes sur une grande table de livraison (LIVRAISON) <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> P.ID, P.FIRST_NAME, P.LAST_NAME <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DELIVERY D <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> PERSON P <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> D.DRIVER_ID = P.ID</code> </pre><br>  a fait une demande pour une table PERSON relativement petite <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> P.ID, P.FIRST_NAME, P.LAST_NAME <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> PERSON <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> D.ID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> DELIVERY <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> D.DRIVER_ID = P.ID)</code> </pre><br>  Il semblerait que nous ayons utilisÃ© une sous-requÃªte corrÃ©lative, mais cela donne une accÃ©lÃ©ration de plus de 10 fois. <br></li><li>  Dans de nombreux cas, COUNT et <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">remplacÃ© par le calcul de la valeur approximative</a> <br></li><li>  au lieu de <br><br><pre> <code class="sql hljs">UPPER(s) LIKE JOHN%'</code> </pre><br>  utiliser <br><br><pre> <code class="sql hljs">s ILIKE â€œJohn%â€</code> </pre><br></li></ul><br>  Chaque demande spÃ©cifique a parfois Ã©tÃ© accÃ©lÃ©rÃ©e de 3 Ã  1 000 fois.  MalgrÃ© les performances impressionnantes, au dÃ©but, il nous semblait inutile d'optimiser la requÃªte, qui Ã©tait exÃ©cutÃ©e pendant 10 ms, incluse dans la 3e centaine des requÃªtes les plus lourdes et dans le temps total de chargement de la base de donnÃ©es, elle prenait des centiÃ¨mes de pour cent.  Mais en appliquant la mÃªme recette Ã  un groupe de demandes similaires, nous avons regagnÃ© plusieurs pour cent.  Afin de ne pas perdre de temps Ã  visualiser manuellement les centaines de requÃªtes, nous avons Ã©crit plusieurs scripts simples qui, Ã  l'aide d'expressions rÃ©guliÃ¨res, ont trouvÃ© des requÃªtes similaires.  Par consÃ©quent, la recherche automatique de groupes de requÃªtes nous a permis d'amÃ©liorer encore nos performances en dÃ©ployant des efforts modestes. <br><br>  En consÃ©quence, nous travaillons sur le mÃªme matÃ©riel depuis trois ans maintenant.  La charge journaliÃ¨re moyenne est d'environ 30%, aux pointes elle atteint 70%.  Le nombre de demandes ainsi que le nombre d'utilisateurs a augmentÃ© d'environ 10 fois.  Et tout cela grÃ¢ce au suivi constant de ces mÃªmes groupes de requÃªtes TOP-MEDIUM.  DÃ¨s qu'une nouvelle demande apparaÃ®t dans le groupe TOP, nous l'analysons immÃ©diatement et essayons de l'accÃ©lÃ©rer.  Nous passons en revue le groupe MEDIUM une fois par semaine Ã  l'aide de scripts d'analyse de requÃªte.  Si vous rencontrez de nouvelles demandes que nous savons dÃ©jÃ  optimiser, nous les modifions rapidement.  Parfois, nous trouvons de nouvelles mÃ©thodes d'optimisation qui peuvent Ãªtre appliquÃ©es Ã  plusieurs requÃªtes Ã  la fois. <br><br>  Selon nos prÃ©visions, le serveur actuel supportera une augmentation du nombre d'utilisateurs de 3 Ã  5 fois.  Certes, nous avons un atout de plus dans la pochette; nous n'avons toujours pas traduit les requÃªtes SELECT dans le miroir, comme recommandÃ©.  Mais nous ne le faisons pas consciemment, car nous voulons d'abord Ã©puiser pleinement les possibilitÃ©s d'optimisation Â«intelligenteÂ» avant d'activer Â«l'artillerie lourdeÂ». <br>  Un examen critique du travail effectuÃ© peut suggÃ©rer l'utilisation d'une mise Ã  l'Ã©chelle verticale.  Achetez un serveur plus puissant, au lieu de perdre le temps des spÃ©cialistes.  Le serveur peut ne pas coÃ»ter si cher, d'autant plus que les limites de la mise Ã  l'Ã©chelle verticale n'ont pas encore Ã©tÃ© Ã©puisÃ©es.  Cependant, seul le nombre de demandes a augmentÃ© 10 fois.  Depuis plusieurs annÃ©es, la fonctionnalitÃ© du systÃ¨me a augmentÃ© et il existe dÃ©sormais plus de variÃ©tÃ©s de demandes.  La fonctionnalitÃ© qui Ã©tait due Ã  la mise en cache est rÃ©alisÃ©e par moins de demandes, de plus, des demandes plus efficaces.  Vous pouvez donc multiplier en toute sÃ©curitÃ© par 5 autres pour obtenir le coefficient d'accÃ©lÃ©ration rÃ©el.  Ainsi, selon les estimations les plus prudentes, nous pouvons dire que l'accÃ©lÃ©ration a Ã©tÃ© de 50 fois ou plus.  Secouer verticalement le serveur 50 fois coÃ»terait plus cher.  Surtout si l'on considÃ¨re qu'une fois l'optimisation est effectuÃ©e tout le temps, et une facture pour un serveur louÃ© vient chaque mois. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr461071/">https://habr.com/ru/post/fr461071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr461059/index.html">Ã‰crire une application Android pour les fans de films - Partie 1 (Prototypage)</a></li>
<li><a href="../fr461061/index.html">Alliages de magnÃ©sium, frontiÃ¨res jumelles et sÃ©grÃ©gation</a></li>
<li><a href="../fr461063/index.html">Interaction de R avec des bases de donnÃ©es sur l'exemple de Microsoft SQL Server et d'autres SGBD</a></li>
<li><a href="../fr461067/index.html">Les 65 principales questions SQL des entretiens d'embauche auxquelles vous devriez vous prÃ©parer en 2019. Partie I</a></li>
<li><a href="../fr461069/index.html">CamÃ©ras IP extÃ©rieures Nobelic: tests, technologies et capacitÃ©s des systÃ¨mes de vidÃ©osurveillance Ivideon</a></li>
<li><a href="../fr461073/index.html">Nous connectons des cartes en ligne au navigateur sur le smartphone. Partie 3 - OverpassTurbo</a></li>
<li><a href="../fr461075/index.html">Intelligence d'affaires. Objets informatiques, composants, outils</a></li>
<li><a href="../fr461077/index.html">Comment les pentesters sont-ils cuits? Test d'entrÃ©e pour les stagiaires en sÃ©curitÃ© numÃ©rique</a></li>
<li><a href="../fr461079/index.html">Ville sans embouteillage</a></li>
<li><a href="../fr461081/index.html">Le jour oÃ¹ Dodo IS s'est arrÃªtÃ©. Script asynchrone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>