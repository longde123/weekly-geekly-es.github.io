<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ‘©ğŸ¾â€ğŸ”¬ ğŸ³ ğŸ¤© ä½¿ç”¨kubeadmåœ¨è£¸æœºä¸Šé…ç½®Kubernetes HAé›†ç¾¤ã€‚ ç¬¬1/3éƒ¨åˆ† ğŸ™ğŸ½ ğŸ¤¨ ğŸ‘™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ç¬¬2/3éƒ¨åˆ† 
 ç¬¬3/3éƒ¨åˆ† 


 å¤§å®¶å¥½ï¼ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³ç®€åŒ–ä¿¡æ¯å¹¶åˆ†äº«åˆ›å»ºå’Œä½¿ç”¨Kuberneteså†…éƒ¨é›†ç¾¤çš„ç»éªŒã€‚ 


 åœ¨è¿‡å»çš„å‡ å¹´ä¸­ï¼Œè¿™ç§å®¹å™¨ç¼–æ’æŠ€æœ¯å‘å‰è¿ˆäº†ä¸€å¤§æ­¥ï¼Œå¹¶å·²æˆä¸ºæˆåƒä¸Šä¸‡å®¶å…¬å¸çš„ä¸€ç§ä¼ä¸šæ ‡å‡†ã€‚ æœ‰äº›äººåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒï¼Œå…¶ä»–äººåªæ˜¯åœ¨é¡¹ç›®ä¸­å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯æ— è®ºæ‚¨æ€ä¹ˆè¯´ï¼Œå›´ç»•å®ƒ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä½¿ç”¨kubeadmåœ¨è£¸æœºä¸Šé…ç½®Kubernetes HAé›†ç¾¤ã€‚ ç¬¬1/3éƒ¨åˆ†</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/southbridge/blog/439562/"><p>  <strong>ç¬¬2/3éƒ¨åˆ†</strong> <br>  <strong>ç¬¬3/3éƒ¨åˆ†</strong> </p><br><p> å¤§å®¶å¥½ï¼ åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³ç®€åŒ–ä¿¡æ¯å¹¶åˆ†äº«åˆ›å»ºå’Œä½¿ç”¨Kuberneteså†…éƒ¨é›†ç¾¤çš„ç»éªŒã€‚ </p><br><p> åœ¨è¿‡å»çš„å‡ å¹´ä¸­ï¼Œè¿™ç§å®¹å™¨ç¼–æ’æŠ€æœ¯å‘å‰è¿ˆäº†ä¸€å¤§æ­¥ï¼Œå¹¶å·²æˆä¸ºæˆåƒä¸Šä¸‡å®¶å…¬å¸çš„ä¸€ç§ä¼ä¸šæ ‡å‡†ã€‚ æœ‰äº›äººåœ¨ç”Ÿäº§ä¸­ä½¿ç”¨å®ƒï¼Œå…¶ä»–äººåªæ˜¯åœ¨é¡¹ç›®ä¸­å¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä½†æ˜¯æ— è®ºæ‚¨æ€ä¹ˆè¯´ï¼Œå›´ç»•å®ƒçš„çƒ­æƒ…éƒ½ä¼šå¸¦ç€ä¸¥è‚ƒçš„å¿ƒæƒ…å‘å‡ºã€‚ å¦‚æœæ‚¨ä»¥å‰ä»æœªä½¿ç”¨è¿‡å®ƒï¼Œé‚£ä¹ˆè¯¥å¼€å§‹çº¦ä¼šäº†ã€‚ </p><br><h3 id="0-vstuplenie">  0.ç®€ä»‹ </h3><br><p>  Kubernetesæ˜¯ä¸€ç§å¯æ‰©å±•çš„ç¼–æ’æŠ€æœ¯ï¼Œå¯ä»¥ä»åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£…å¼€å§‹ï¼Œå¹¶åŸºäºå†…éƒ¨çš„æ•°ç™¾ä¸ªèŠ‚ç‚¹è¾¾åˆ°å·¨å¤§çš„HAç¾¤é›†çš„å¤§å°ã€‚ å¤§å¤šæ•°æµè¡Œçš„äº‘æä¾›å•†éƒ½æä¾›ä¸åŒç±»å‹çš„Kuberneteså®ç°-ä½¿ç”¨å’Œä½¿ç”¨ã€‚ ä½†æ˜¯æƒ…å†µæœ‰æ‰€ä¸åŒï¼Œæœ‰äº›å…¬å¸ä¸ä½¿ç”¨äº‘ï¼Œä»–ä»¬å¸Œæœ›è·å¾—ç°ä»£ç¼–æ’æŠ€æœ¯çš„æ‰€æœ‰ä¼˜åŠ¿ã€‚ æ¥ä¸‹æ¥æ˜¯åœ¨è£¸æœºä¸Šå®‰è£…Kubernetesçš„è¿‡ç¨‹ã€‚ </p><br><p><img src="https://habrastorage.org/webt/el/ci/ua/elciua9kwxmo0fnnm5yoaabqpvm.jpeg"></p><a name="habracut"></a><br><h3 id="1-vvedenie">  1.ç®€ä»‹ </h3><br><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªKubernetes HAç¾¤é›†ï¼Œè¯¥ç¾¤é›†å…·æœ‰ç”¨äºå¤šä¸ªä¸»æœåŠ¡å™¨çš„æ‹“æ‰‘ï¼Œå¹¶ä½¿ç”¨å¤–éƒ¨ç¾¤é›†etcdä½œä¸ºåŸºç¡€å±‚ï¼Œå¹¶åœ¨å…¶ä¸­ä½¿ç”¨MetalLBè´Ÿè½½å‡è¡¡å™¨ã€‚ åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†GlusterFSéƒ¨ç½²ä¸ºç®€å•çš„å†…éƒ¨åˆ†å¸ƒå¼é›†ç¾¤å­˜å‚¨ã€‚ æˆ‘ä»¬è¿˜å°†å°è¯•ä½¿ç”¨æˆ‘ä»¬çš„ä¸ªäººDockeræ³¨å†Œè¡¨åœ¨å…¶ä¸­éƒ¨ç½²å‡ ä¸ªæµ‹è¯•é¡¹ç›®ã€‚ </p><br><p> é€šå¸¸ï¼Œæœ‰å¤šç§åˆ›å»ºKubernetes HAç¾¤é›†çš„æ–¹æ³•ï¼šæµè¡Œçš„<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">kubernetes-the-hard-way</a>æ–‡æ¡£ä¸­æè¿°çš„å›°éš¾è€Œæ·±å…¥çš„è·¯å¾„ï¼Œæˆ–è€…ä½¿ç”¨<strong>kubeadm</strong>å®ç”¨ç¨‹åºçš„æ›´ç®€å•æ–¹æ³•ã€‚ </p><br><p>  Kubeadmæ˜¯Kubernetesç¤¾åŒºåˆ›å»ºçš„å·¥å…·ï¼Œä¸“é—¨ç”¨äºç®€åŒ–Kubernetesçš„å®‰è£…å¹¶ç®€åŒ–è¿‡ç¨‹ã€‚ æ—©å…ˆï¼Œå»ºè®®ä»…å°†Kubeadmç”¨äºåˆ›å»ºå…·æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹çš„å°å‹æµ‹è¯•é›†ç¾¤ã€‚ ä½†æ˜¯åœ¨è¿‡å»çš„ä¸€å¹´ä¸­ï¼Œå·²ç»åšäº†å¾ˆå¤šæ”¹è¿›ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆ›å»ºå…·æœ‰å¤šä¸ªä¸»èŠ‚ç‚¹çš„HAç¾¤é›†ã€‚ æ ¹æ®Kubernetesç¤¾åŒºæ–°é—»ï¼Œå°†æ¥ï¼Œå°†æ¨èä½¿ç”¨Kubeadmä½œä¸ºå®‰è£…Kubernetesçš„å·¥å…·ã€‚ </p><br><p>  Kubeadmæ–‡æ¡£æä¾›äº†ä¸¤ç§ä½¿ç”¨å †æ ˆå’Œå¤–éƒ¨etcdæ‹“æ‰‘å®ç°é›†ç¾¤çš„åŸºæœ¬æ–¹æ³•ã€‚ ç”±äºHAç¾¤é›†çš„å®¹é”™æ€§ï¼Œæˆ‘å°†é€‰æ‹©å¸¦æœ‰å¤–éƒ¨etcdèŠ‚ç‚¹çš„ç¬¬äºŒæ¡è·¯å¾„ã€‚ </p><br><p> è¿™æ˜¯Kubeadmæ–‡æ¡£ä¸­çš„å›¾è¡¨ï¼Œæè¿°äº†æ­¤è·¯å¾„ï¼š </p><br><p> <a href=""><img src="https://habrastorage.org/webt/4y/nh/gd/4ynhgd4h3ireojrvdplimgnsk2u.jpeg"></a> </p><br><p> æˆ‘ä¼šç¨å¾®æ”¹å˜ä¸€ä¸‹ã€‚ é¦–å…ˆï¼Œæˆ‘å°†ä½¿ç”¨ä¸€å¯¹HAProxyæœåŠ¡å™¨ä½œä¸ºHeartbeatè½¯ä»¶åŒ…çš„è´Ÿè½½å¹³è¡¡å™¨ï¼Œè¯¥è½¯ä»¶åŒ…å°†å…±äº«è™šæ‹ŸIPåœ°å€ã€‚  Heartbeatå’ŒHAProxyä½¿ç”¨å°‘é‡çš„ç³»ç»Ÿèµ„æºï¼Œå› æ­¤æˆ‘å°†å®ƒä»¬æ”¾ç½®åœ¨ä¸€å¯¹etcdèŠ‚ç‚¹ä¸Šï¼Œä»¥ç•¥å¾®å‡å°‘é›†ç¾¤çš„æœåŠ¡å™¨æ•°é‡ã€‚ </p><br><p> å¯¹äºæ­¤Kubernetesé›†ç¾¤æ–¹æ¡ˆï¼Œéœ€è¦å…«ä¸ªèŠ‚ç‚¹ã€‚ ç”¨äºå¤–éƒ¨é›†ç¾¤etcdçš„ä¸‰å°æœåŠ¡å™¨ï¼ˆLBæœåŠ¡ä¹Ÿå°†ä½¿ç”¨å…¶ä¸­çš„ä¸¤å°ï¼‰ï¼Œä¸¤å°ç”¨äºæ§åˆ¶å¹³é¢çš„èŠ‚ç‚¹ï¼ˆä¸»èŠ‚ç‚¹ï¼‰ï¼Œä¸‰å°ç”¨äºå·¥ä½œèŠ‚ç‚¹ã€‚ å®ƒå¯ä»¥æ˜¯è£¸æœºæˆ–VMæœåŠ¡å™¨ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ²¡å…³ç³»ã€‚ å¦‚æœæœ‰å¾ˆå¤šå…è´¹æœåŠ¡å™¨ï¼Œåˆ™å¯ä»¥é€šè¿‡æ·»åŠ æ›´å¤šä¸»èŠ‚ç‚¹å¹¶å°†HAProxy with Heartbeatæ”¾åœ¨å•ç‹¬çš„èŠ‚ç‚¹ä¸Šæ¥è½»æ¾æ›´æ”¹æ–¹æ¡ˆã€‚ å°½ç®¡æˆ‘å¯¹äºHAç¾¤é›†çš„ç¬¬ä¸€ä¸ªå®æ–½æ–¹æ¡ˆçš„é€‰æ‹©å°±è¶³å¤Ÿäº†ã€‚ </p><br><p> å¦‚æœéœ€è¦ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ª<strong>å®‰è£…</strong>äº†<strong>kubectl</strong>å®ç”¨<strong>ç¨‹åº</strong>çš„å°å‹æœåŠ¡å™¨æ¥ç®¡ç†è¯¥é›†ç¾¤ï¼Œæˆ–è€…ä½¿ç”¨æ‚¨è‡ªå·±çš„Linuxæ¡Œé¢ã€‚ </p><br><p> è¯¥ç¤ºä¾‹çš„å›¾è¡¨å¦‚ä¸‹æ‰€ç¤ºï¼š </p><br><p> <a href=""><img src="https://habrastorage.org/webt/r4/5w/uc/r45wucdscdlhmaqcuw-gtr7mrmm.jpeg"></a> </p><br><h3 id="2-trebovaniya">  2.è¦æ±‚ </h3><br><p> æ‚¨å°†éœ€è¦ä¸¤ä¸ªå…·æœ‰æœ€ä½å»ºè®®ç³»ç»Ÿè¦æ±‚çš„Kubernetesä¸»èŠ‚ç‚¹ï¼šæ ¹æ®<strong>kubeadm</strong>æ–‡æ¡£çš„è¦æ±‚ï¼Œä¸¤ä¸ªCPUå’Œ2 GB RAMã€‚ å¯¹äºå·¥ä½œèŠ‚ç‚¹ï¼Œæˆ‘å»ºè®®ä½¿ç”¨åŠŸèƒ½æ›´å¼ºå¤§çš„æœåŠ¡å™¨ï¼Œå› ä¸ºæˆ‘ä»¬å°†åœ¨å®ƒä»¬ä¸Šè¿è¡Œæ‰€æœ‰åº”ç”¨ç¨‹åºæœåŠ¡ã€‚ å¯¹äºEtcd + LBï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é‡‡ç”¨å…·æœ‰ä¸¤ä¸ªCPUå’Œè‡³å°‘2 GB RAMçš„æœåŠ¡å™¨ã€‚ </p><br><p> ä¸ºè¯¥é›†ç¾¤é€‰æ‹©ä¸€ä¸ªå…¬å…±ç½‘ç»œæˆ–ä¸“ç”¨ç½‘ç»œï¼›  IPåœ°å€æ— å…³ç´§è¦ï¼› æ‰€æœ‰æœåŠ¡å™¨ä¹‹é—´ä»¥åŠå½¼æ­¤ä¹‹é—´å½“ç„¶éƒ½å¯ä»¥è®¿é—®ï¼Œè¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚ ç¨åï¼Œåœ¨Kubernetesé›†ç¾¤å†…éƒ¨ï¼Œæˆ‘ä»¬å°†å»ºç«‹ä¸€ä¸ªè¦†ç›–ç½‘ç»œã€‚ </p><br><p> æ­¤ç¤ºä¾‹çš„æœ€ä½è¦æ±‚æ˜¯ï¼š </p><br><ul><li>  2ä¸ªæœåŠ¡å™¨ï¼Œå¸¦æœ‰2ä¸ªå¤„ç†å™¨å’Œ2 GBçš„RAMç”¨äºä¸»èŠ‚ç‚¹ </li><li>  3ä¸ªæœåŠ¡å™¨ï¼Œå¸¦æœ‰4ä¸ªå¤„ç†å™¨å’Œ4-8 GB RAMç”¨äºå·¥ä½œèŠ‚ç‚¹ </li><li>  3ä¸ªæœåŠ¡å™¨ï¼Œå¸¦æœ‰2ä¸ªå¤„ç†å™¨å’Œ2 GBçš„RAMï¼Œç”¨äºEtcdå’ŒHAProxy </li><li>  192.168.0.0/24-å­ç½‘ </li></ul><br><p>  192.168.0.1-HAProxyçš„è™šæ‹ŸIPåœ°å€ï¼Œ192.168.0.2-Etcdå’ŒHAProxyèŠ‚ç‚¹çš„4ä¸ªä¸»è¦IPåœ°å€ï¼Œ192.168.0.5-Kubernetesä¸»èŠ‚ç‚¹çš„6ä¸ªä¸»è¦IPåœ°å€ï¼Œ192.168.0.7-Kuberneteså·¥ä½œèŠ‚ç‚¹çš„9ä¸ªä¸»è¦IPåœ°å€ã€‚ </p><br><p>  Debian 9æ•°æ®åº“å·²å®‰è£…åœ¨æ‰€æœ‰æœåŠ¡å™¨ä¸Šã€‚ </p><br><blockquote> è¿˜è¯·è®°ä½ï¼Œç³»ç»Ÿè¦æ±‚å–å†³äºç¾¤é›†çš„å¤§å°å’ŒåŠŸèƒ½ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§Kubernetesæ–‡æ¡£ã€‚ </blockquote><br><h3 id="3-nastroyka-haproxy-i-heartbeat">  3.é…ç½®HAProxyå’Œå¿ƒè·³ã€‚ </h3><br><p> æˆ‘ä»¬æœ‰å¤šä¸ªKubernetesä¸»èŠ‚ç‚¹ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨å®ƒä»¬å‰é¢é…ç½®ä¸€ä¸ªHAProxyè´Ÿè½½å‡è¡¡å™¨-ä»¥åˆ†é…æµé‡ã€‚ è¿™å°†æ˜¯ä¸€å¯¹å…·æœ‰å…±äº«è™šæ‹ŸIPåœ°å€çš„HAProxyæœåŠ¡å™¨ã€‚ å¿ƒè·³åŒ…éšé™„äº†å®¹é”™åŠŸèƒ½ã€‚ å¯¹äºéƒ¨ç½²ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å‰ä¸¤ä¸ªetcdæœåŠ¡å™¨ã€‚ </p><br><p> åœ¨ç¬¬ä¸€å°å’Œç¬¬äºŒå°etcdæœåŠ¡å™¨ï¼ˆåœ¨æ­¤ç¤ºä¾‹ä¸­ä¸º192.168.0.2â€“3ï¼‰ä¸Šå®‰è£…å¹¶é…ç½®å¸¦æœ‰å¿ƒè·³çš„HAProxyï¼š </p><br><pre><code class="plaintext hljs">etcd1# apt-get update &amp;&amp; apt-get upgrade &amp;&amp; apt-get install -y haproxy etcd2# apt-get update &amp;&amp; apt-get upgrade &amp;&amp; apt-get install -y haproxy</code> </pre> <br><p> ä¿å­˜åŸå§‹é…ç½®å¹¶åˆ›å»ºä¸€ä¸ªæ–°é…ç½®ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# mv /etc/haproxy/haproxy.cfg{,.back} etcd1# vi /etc/haproxy/haproxy.cfg etcd2# mv /etc/haproxy/haproxy.cfg{,.back} etcd2# vi /etc/haproxy/haproxy.cfg</code> </pre> <br><p> ä¸ºä¸¤ä¸ªHAProxyæ·»åŠ ä»¥ä¸‹é…ç½®é€‰é¡¹ï¼š </p><br><pre> <code class="plaintext hljs">global user haproxy group haproxy defaults mode http log global retries 2 timeout connect 3000ms timeout server 5000ms timeout client 5000ms frontend kubernetes bind 192.168.0.1:6443 option tcplog mode tcp default_backend kubernetes-master-nodes backend kubernetes-master-nodes mode tcp balance roundrobin option tcp-check server k8s-master-0 192.168.0.5:6443 check fall 3 rise 2 server k8s-master-1 192.168.0.6:6443 check fall 3 rise 2</code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œä¸¤ä¸ªHAProxyæœåŠ¡å…±äº«IPåœ°å€-192.168.0.1ã€‚ è¯¥è™šæ‹ŸIPåœ°å€å°†åœ¨æœåŠ¡å™¨ä¹‹é—´ç§»åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬æœ‰ç‚¹ç‹¡çŒ¾ï¼Œå¹¶<strong>å¯ç”¨net.ipv4.ip_nonlocal_bind</strong>å‚æ•°ä»¥å…è®¸å°†ç³»ç»ŸæœåŠ¡ç»‘å®šåˆ°éæœ¬åœ°IPåœ°å€ã€‚ </p><br><p> å°†æ­¤åŠŸèƒ½æ·»åŠ åˆ°<strong>/etc/sysctl.conf</strong>æ–‡ä»¶ä¸­ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# vi /etc/sysctl.conf net.ipv4.ip_nonlocal_bind=1 etcd2# vi /etc/sysctl.conf net.ipv4.ip_nonlocal_bind=1</code> </pre> <br><p> åœ¨ä¸¤ä¸ªæœåŠ¡å™¨ä¸Šè¿è¡Œï¼š </p><br><pre> <code class="plaintext hljs">sysctl -p</code> </pre> <br><p> åŒæ—¶åœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šè¿è¡ŒHAProxyï¼š </p><br><pre> <code class="plaintext hljs">etcd1# systemctl start haproxy etcd2# systemctl start haproxy</code> </pre> <br><p> ç¡®ä¿HAProxyæ­£åœ¨è¿è¡Œï¼Œå¹¶ä¸”æ­£åœ¨ä¸¤ä¸ªæœåŠ¡å™¨ä¸Šçš„è™šæ‹ŸIPåœ°å€ä¸Šè¿›è¡Œä¾¦å¬ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# netstat -ntlp tcp 0 0 192.168.0.1:6443 0.0.0.0:* LISTEN 2833/haproxy etcd2# netstat -ntlp tcp 0 0 192.168.0.1:6443 0.0.0.0:* LISTEN 2833/haproxy</code> </pre> <br><p> èƒ¡å¾·ï¼ ç°åœ¨å®‰è£…Heartbeatå¹¶é…ç½®æ­¤è™šæ‹ŸIPã€‚ </p><br><pre> <code class="plaintext hljs">etcd1# apt-get -y install heartbeat &amp;&amp; systemctl enable heartbeat etcd2# apt-get -y install heartbeat &amp;&amp; systemctl enable heartbeat</code> </pre> <br><p> ç°åœ¨è¯¥ä¸ºå®ƒåˆ›å»ºå‡ ä¸ªé…ç½®æ–‡ä»¶äº†ï¼šå¯¹äºç¬¬ä¸€å°å’Œç¬¬äºŒå°æœåŠ¡å™¨ï¼Œå®ƒä»¬åŸºæœ¬ä¸Šæ˜¯ç›¸åŒçš„ã€‚ </p><br><p> é¦–å…ˆåˆ›å»ºæ–‡ä»¶<strong>/etc/ha.d/authkeys</strong> ï¼Œåœ¨æ­¤æ–‡ä»¶ä¸­ï¼ŒHeartbeatå­˜å‚¨ç”¨äºç›¸äº’è®¤è¯çš„æ•°æ®ã€‚ ä¸¤ä¸ªæœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶å¿…é¡»ç›¸åŒï¼š </p><br><pre> <code class="plaintext hljs"># echo -n securepass | md5sum bb77d0d3b3f239fa5db73bdf27b8d29a etcd1# vi /etc/ha.d/authkeys auth 1 1 md5 bb77d0d3b3f239fa5db73bdf27b8d29a etcd2# vi /etc/ha.d/authkeys auth 1 1 md5 bb77d0d3b3f239fa5db73bdf27b8d29a</code> </pre> <br><p> è¯¥æ–‡ä»¶åªèƒ½ç”±rootç”¨æˆ·è®¿é—®ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# chmod 600 /etc/ha.d/authkeys etcd2# chmod 600 /etc/ha.d/authkeys</code> </pre> <br><p> ç°åœ¨ï¼Œåœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šä¸ºHeartbeatåˆ›å»ºä¸»é…ç½®æ–‡ä»¶ï¼šå¯¹äºæ¯å°æœåŠ¡å™¨ï¼Œå®ƒéƒ½ä¼šç•¥æœ‰ä¸åŒã€‚ </p><br><p> åˆ›å»º<strong>/etc/ha.d/ha.cf</strong> ï¼š </p><br><p>  <strong>etcd1</strong> </p><br><pre> <code class="plaintext hljs">etcd1# vi /etc/ha.d/ha.cf # keepalive: how many seconds between heartbeats # keepalive 2 # # deadtime: seconds-to-declare-host-dead # deadtime 10 # # What UDP port to use for udp or ppp-udp communication? # udpport 694 bcast ens18 mcast ens18 225.0.0.1 694 1 0 ucast ens18 192.168.0.3 # What interfaces to heartbeat over? udp ens18 # # Facility to use for syslog()/logger (alternative to log/debugfile) # logfacility local0 # # Tell what machines are in the cluster # node nodename ... -- must match uname -n node etcd1_hostname node etcd2_hostname</code> </pre> <br><p>  <strong>etcd2</strong> </p><br><pre> <code class="plaintext hljs">etcd2# vi /etc/ha.d/ha.cf # keepalive: how many seconds between heartbeats # keepalive 2 # # deadtime: seconds-to-declare-host-dead # deadtime 10 # # What UDP port to use for udp or ppp-udp communication? # udpport 694 bcast ens18 mcast ens18 225.0.0.1 694 1 0 ucast ens18 192.168.0.2 # What interfaces to heartbeat over? udp ens18 # # Facility to use for syslog()/logger (alternative to vlog/debugfile) # logfacility local0 # # Tell what machines are in the cluster # node nodename ... -- must match uname -n node etcd1_hostname node etcd2_hostname</code> </pre> <br><p> é€šè¿‡åœ¨ä¸¤ä¸ªEtcdæœåŠ¡å™¨ä¸Šè¿è¡Œuname -nï¼Œè·å–æ­¤é…ç½®çš„â€œ nodeâ€å‚æ•°ã€‚ å¦å¤–ï¼Œè¯·ä½¿ç”¨ç½‘å¡çš„åç§°è€Œä¸æ˜¯ens18ã€‚ </p><br><p> æœ€åï¼Œæ‚¨éœ€è¦åœ¨è¿™äº›æœåŠ¡å™¨ä¸Šåˆ›å»º<strong>/etc/ha.d/haresources</strong>æ–‡ä»¶ã€‚ å¯¹äºä¸¤ä¸ªæœåŠ¡å™¨ï¼Œæ–‡ä»¶å¿…é¡»ç›¸åŒã€‚ åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®å…¬å…±IPåœ°å€å¹¶ç¡®å®šå“ªä¸ªèŠ‚ç‚¹æ˜¯é»˜è®¤ä¸»èŠ‚ç‚¹ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# vi /etc/ha.d/haresources etcd1_hostname 192.168.0.1 etcd2# vi /etc/ha.d/haresources etcd1_hostname 192.168.0.1</code> </pre> <br><p> ä¸€åˆ‡å‡†å¤‡å°±ç»ªåï¼Œåœ¨ä¸¤å°æœåŠ¡å™¨ä¸Šå¯åŠ¨HeartbeatæœåŠ¡ï¼Œå¹¶éªŒè¯æˆ‘ä»¬æ˜¯å¦åœ¨etcd1 <strong>èŠ‚ç‚¹</strong>ä¸Šæ”¶åˆ°äº†æ­¤å£°æ˜çš„è™šæ‹ŸIPï¼š </p><br><pre> <code class="plaintext hljs">etcd1# systemctl restart heartbeat etcd2# systemctl restart heartbeat etcd1# ip a ens18: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether xx:xx:xx:xx:xx:xx brd ff:ff:ff:ff:ff:ff inet 192.168.0.2/24 brd 192.168.0.255 scope global ens18 valid_lft forever preferred_lft forever inet 192.168.0.1/24 brd 192.168.0.255 scope global secondary</code> </pre> <br><p> æ‚¨å¯ä»¥é€šè¿‡åœ¨192.168.0.1 6443ä¸Šè¿è¡Œ<strong>nc</strong>æ¥éªŒè¯HAProxyæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚æ‚¨å¿…é¡»å·²è¶…æ—¶ï¼Œå› ä¸ºKubernetes APIå°šæœªåœ¨æœåŠ¡å™¨ç«¯è¿›è¡Œä¾¦å¬ã€‚ ä½†è¿™æ„å‘³ç€HAProxyå’ŒHeartbeatçš„é…ç½®æ­£ç¡®ã€‚ </p><br><pre> <code class="plaintext hljs"># nc -v 192.168.0.1 6443 Connection to 93.158.95.90 6443 port [tcp/*] succeeded!</code> </pre> <br><h3 id="4-podgotovka-nod-dlya-kubernetes">  4.å‡†å¤‡Kubernetesçš„èŠ‚ç‚¹ </h3><br><p> ä¸‹ä¸€æ­¥æ˜¯å‡†å¤‡æ‰€æœ‰KubernetesèŠ‚ç‚¹ã€‚ æ‚¨éœ€è¦ä½¿ç”¨å…¶ä»–ä¸€äº›è½¯ä»¶åŒ…å®‰è£…Dockerï¼Œæ·»åŠ Kuberneteså­˜å‚¨åº“å¹¶<strong>ä»ä¸­</strong>å®‰è£…<strong>kubelet</strong> ï¼Œ <strong>kubeadm</strong>å’Œ<strong>kubectl</strong>è½¯ä»¶åŒ…ã€‚ æ‰€æœ‰KubernetesèŠ‚ç‚¹ï¼ˆä¸»èŠ‚ç‚¹ï¼Œå·¥ä½œèŠ‚ç‚¹ç­‰ï¼‰çš„æ­¤è®¾ç½®å‡ç›¸åŒ </p><br><blockquote>  <strong>Kubeadm</strong>çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ä¸éœ€è¦å¤ªå¤šå…¶ä»–è½¯ä»¶ã€‚ åœ¨æ‰€æœ‰ä¸»æœºä¸Šå®‰è£…<strong>kubeadm-</strong>å¹¶ä½¿ç”¨å®ƒï¼› è‡³å°‘ç”ŸæˆCAè¯ä¹¦ã€‚ </blockquote><p> åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Dockerï¼š </p><br><pre> <code class="plaintext hljs">Update the apt package index # apt-get update Install packages to allow apt to use a repository over HTTPS # apt-get -y install \ apt-transport-https \ ca-certificates \ curl \ gnupg2 \ software-properties-common Add Docker's official GPG key # curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add - Add docker apt repository # apt-add-repository \ "deb [arch=amd64] https://download.docker.com/linux/debian \ $(lsb_release -cs) \ stable" Install docker-ce. # apt-get update &amp;&amp; apt-get -y install docker-ce Check docker version # docker -v Docker version 18.09.0, build 4d60db4</code> </pre> <br><p> ä¹‹åï¼Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Kubernetesè½¯ä»¶åŒ…ï¼š </p><br><ul><li>  <strong><code>kubeadm</code></strong> ï¼šç”¨äºåŠ è½½é›†ç¾¤çš„å‘½ä»¤ã€‚ </li><li>  <strong><code>kubelet</code></strong> ï¼šä¸€ä¸ªç»„ä»¶ï¼Œå®ƒåœ¨ç¾¤é›†ä¸­çš„æ‰€æœ‰è®¡ç®—æœºä¸Šè¿è¡Œï¼Œâ€‹â€‹å¹¶æ‰§è¡Œè¯¸å¦‚å¯åŠ¨ç‚‰è†›å’Œå®¹å™¨çš„æ“ä½œã€‚ </li><li>  <strong><code>kubectl</code></strong> ï¼šä¸é›†ç¾¤é€šä¿¡çš„utilå‘½ä»¤è¡Œã€‚ </li><li>  <strong>kubectl-éšæ„</strong> ï¼› æˆ‘ç»å¸¸å°†å…¶å®‰è£…åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œä»¥è¿è¡Œä¸€äº›Kuberneteså‘½ä»¤è¿›è¡Œè°ƒè¯•ã€‚ </li></ul><br><pre> <code class="plaintext hljs"># curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - Add the Google repository # cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF Update and install packages # apt-get update &amp;&amp; apt-get install -y kubelet kubeadm kubectl Hold back packages # apt-mark hold kubelet kubeadm kubectl Check kubeadm version # kubeadm version kubeadm version: &amp;version.Info{Major:"1", Minor:"13", GitVersion:"v1.13.1", GitCommit:"eec55b9dsfdfgdfgfgdfgdfgdf365bdd920", GitTreeState:"clean", BuildDate:"2018-12-13T10:36:44Z", GoVersion:"go1.11.2", Compiler:"gc", Platform:"linux/amd64"}</code> </pre> <br><p>  <strong>å®‰è£…kubeadm</strong>å’Œå…¶ä»–è½¯ä»¶åŒ…åï¼Œä¸è¦å¿˜è®°ç¦ç”¨swapã€‚ </p><br><pre> <code class="plaintext hljs"># swapoff -a # sed -i '/ swap / s/^/#/' /etc/fstab</code> </pre> <br><p> åœ¨å…¶ä½™èŠ‚ç‚¹ä¸Šé‡å¤å®‰è£…ã€‚ è½¯ä»¶åŒ…å¯¹äºç¾¤é›†ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”åªæœ‰ä»¥ä¸‹é…ç½®å°†ç¡®å®šå®ƒä»¬ä»¥åå°†æ¥æ”¶çš„è§’è‰²ã€‚ </p><br><h3 id="5-nastroyka-klastera-ha-etcd">  5.é…ç½®HA Etcdç¾¤é›† </h3><br><p> å› æ­¤ï¼Œåœ¨å®Œæˆå‡†å¤‡å·¥ä½œä¹‹åï¼Œæˆ‘ä»¬å°†é…ç½®Kubernetesé›†ç¾¤ã€‚ ç¬¬ä¸€ä¸ªæ¨¡å—å°†æ˜¯HA Etcdç¾¤é›†ï¼Œè¯¥ç¾¤é›†ä¹Ÿä½¿ç”¨kubeadmå·¥å…·è¿›è¡Œé…ç½®ã€‚ </p><br><blockquote> åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‰€æœ‰etcdèŠ‚ç‚¹éƒ½é€šè¿‡ç«¯å£2379å’Œ2380è¿›è¡Œé€šä¿¡ã€‚æ­¤å¤–ï¼Œæ‚¨éœ€è¦åœ¨å®ƒä»¬ä¹‹é—´é…ç½®sshè®¿é—®ä»¥ä½¿ç”¨<strong>scp</strong> ã€‚ </blockquote><p> è®©æˆ‘ä»¬ä»ç¬¬ä¸€ä¸ªetcdèŠ‚ç‚¹å¼€å§‹ï¼Œç„¶åå°†æ‰€æœ‰å¿…éœ€çš„è¯ä¹¦å’Œé…ç½®æ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚ </p><br><p> åœ¨æ‰€æœ‰<strong>etcd</strong>èŠ‚ç‚¹ä¸Šï¼Œæ‚¨éœ€è¦ä¸º<strong>kubelet</strong>å•å…ƒæ·»åŠ ä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„æ–°<strong>systemd</strong>é…ç½®æ–‡ä»¶ï¼š </p><br><pre> <code class="plaintext hljs">etcd-nodes# cat &lt;&lt; EOF &gt; /etc/systemd/system/kubelet.service.d/20-etcd-service-manager.conf [Service] ExecStart= ExecStart=/usr/bin/kubelet --address=127.0.0.1 --pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true Restart=always EOF etcd-nodes# systemctl daemon-reload etcd-nodes# systemctl restart kubelet</code> </pre> <br><p> ç„¶åï¼Œæˆ‘ä»¬å°†sshç§»è‡³ç¬¬ä¸€ä¸ª<strong>etcd</strong>èŠ‚ç‚¹-æˆ‘ä»¬å°†ä½¿ç”¨å®ƒä¸ºæ¯ä¸ª<strong>etcd</strong>èŠ‚ç‚¹ç”Ÿæˆæ‰€æœ‰å¿…éœ€çš„<strong>kubeadm</strong>é…ç½®ï¼Œç„¶åå°†å…¶å¤åˆ¶ã€‚ </p><br><pre> <code class="plaintext hljs"># Export all our etcd nodes IP's as variables etcd1# export HOST0=192.168.0.2 etcd1# export HOST1=192.168.0.3 etcd1# export HOST2=192.168.0.4 # Create temp directories to store files for all nodes etcd1# mkdir -p /tmp/${HOST0}/ /tmp/${HOST1}/ /tmp/${HOST2}/ etcd1# ETCDHOSTS=(${HOST0} ${HOST1} ${HOST2}) etcd1# NAMES=("infra0" "infra1" "infra2") etcd1# for i in "${!ETCDHOSTS[@]}"; do HOST=${ETCDHOSTS[$i]} NAME=${NAMES[$i]} cat &lt;&lt; EOF &gt; /tmp/${HOST}/kubeadmcfg.yaml apiVersion: "kubeadm.k8s.io/v1beta1" kind: ClusterConfiguration etcd: local: serverCertSANs: - "${HOST}" peerCertSANs: - "${HOST}" extraArgs: initial-cluster: ${NAMES[0]}=https://${ETCDHOSTS[0]}:2380,${NAMES[1]}=https://${ETCDHOSTS[1]}:2380,${NAMES[2]}=https://${ETCDHOSTS[2]}:2380 initial-cluster-state: new name: ${NAME} listen-peer-urls: https://${HOST}:2380 listen-client-urls: https://${HOST}:2379 advertise-client-urls: https://${HOST}:2379 initial-advertise-peer-urls: https://${HOST}:2380 EOF done</code> </pre> <br><p> ç°åœ¨ä½¿ç”¨<strong>kubeadm</strong>åˆ›å»ºä¸»è¯ä¹¦é¢å‘æœºæ„ </p><br><pre> <code class="plaintext hljs">etcd1# kubeadm init phase certs etcd-ca</code> </pre> <br><p> æ­¤å‘½ä»¤å°†åœ¨<strong>/ etc / kubernetes / pki / etcd /</strong>ç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ª<strong>ca.crtå’Œca.keyæ–‡ä»¶</strong> ã€‚ </p><br><pre> <code class="plaintext hljs">etcd1# ls /etc/kubernetes/pki/etcd/ ca.crt ca.key</code> </pre> <br><p> ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä¸ºæ‰€æœ‰<strong>etcd</strong>èŠ‚ç‚¹ç”Ÿæˆè¯ä¹¦ï¼š </p><br><pre> <code class="plaintext hljs">### Create certificates for the etcd3 node etcd1# kubeadm init phase certs etcd-server --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-peer --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST2}/kubeadmcfg.yaml etcd1# cp -R /etc/kubernetes/pki /tmp/${HOST2}/ ### cleanup non-reusable certificates etcd1# find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete ### Create certificates for the etcd2 node etcd1# kubeadm init phase certs etcd-server --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-peer --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST1}/kubeadmcfg.yaml etcd1# cp -R /etc/kubernetes/pki /tmp/${HOST1}/ ### cleanup non-reusable certificates again etcd1# find /etc/kubernetes/pki -not -name ca.crt -not -name ca.key -type f -delete ### Create certificates for the this local node etcd1# kubeadm init phase certs etcd-server --config=/tmp/${HOST0}/kubeadmcfg.yaml etcd1 #kubeadm init phase certs etcd-peer --config=/tmp/${HOST0}/kubeadmcfg.yaml etcd1# kubeadm init phase certs etcd-healthcheck-client --config=/tmp/${HOST0}/kubeadmcfg.yaml etcd1# kubeadm init phase certs apiserver-etcd-client --config=/tmp/${HOST0}/kubeadmcfg.yaml # No need to move the certs because they are for this node # clean up certs that should not be copied off this host etcd1# find /tmp/${HOST2} -name ca.key -type f -delete etcd1# find /tmp/${HOST1} -name ca.key -type f -delete</code> </pre> <br><p> ç„¶åå°†kubeadmçš„è¯ä¹¦å’Œé…ç½®å¤åˆ¶åˆ°èŠ‚ç‚¹<strong>etcd2</strong>å’Œ<strong>etcd3</strong> ã€‚ </p><br><blockquote> é¦–å…ˆåœ¨<strong>etcd1</strong>ä¸Šç”Ÿæˆä¸€å¯¹sshå¯†é’¥ï¼Œå¹¶å°†å…¬å…±éƒ¨åˆ†æ·»åŠ åˆ°<strong>etcd2</strong>å’Œ<strong>3ä¸ª</strong> <strong>èŠ‚ç‚¹ä¸Š</strong> ã€‚ åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæ‰€æœ‰å‘½ä»¤å‡ä»£è¡¨æ‹¥æœ‰ç³»ç»Ÿæ‰€æœ‰æƒé™çš„ç”¨æˆ·æ‰§è¡Œã€‚ </blockquote><br><pre> <code class="plaintext hljs">etcd1# scp -r /tmp/${HOST1}/* ${HOST1}: etcd1# scp -r /tmp/${HOST2}/* ${HOST2}: ### login to the etcd2 or run this command remotely by ssh etcd2# cd /root etcd2# mv pki /etc/kubernetes/ ### login to the etcd3 or run this command remotely by ssh etcd3# cd /root etcd3# mv pki /etc/kubernetes/</code> </pre> <br><p> åœ¨å¯åŠ¨etcdé›†ç¾¤ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ–‡ä»¶å­˜åœ¨äºæ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼š </p><br><p>  <strong>etcd1</strong>ä¸Šæ‰€éœ€æ–‡ä»¶çš„åˆ—è¡¨ï¼š </p><br><pre> <code class="plaintext hljs">/tmp/192.168.0.2 â””â”€â”€ kubeadmcfg.yaml --- /etc/kubernetes/pki â”œâ”€â”€ apiserver-etcd-client.crt â”œâ”€â”€ apiserver-etcd-client.key â””â”€â”€ etcd â”œâ”€â”€ ca.crt â”œâ”€â”€ ca.key â”œâ”€â”€ healthcheck-client.crt â”œâ”€â”€ healthcheck-client.key â”œâ”€â”€ peer.crt â”œâ”€â”€ peer.key â”œâ”€â”€ server.crt â””â”€â”€ server.key</code> </pre> <br><p> å¯¹äº<strong>etcd2</strong>èŠ‚ç‚¹<strong>ï¼Œ</strong>è¿™æ˜¯ï¼š </p><br><pre> <code class="plaintext hljs">/root â””â”€â”€ kubeadmcfg.yaml --- /etc/kubernetes/pki â”œâ”€â”€ apiserver-etcd-client.crt â”œâ”€â”€ apiserver-etcd-client.key â””â”€â”€ etcd â”œâ”€â”€ ca.crt â”œâ”€â”€ healthcheck-client.crt â”œâ”€â”€ healthcheck-client.key â”œâ”€â”€ peer.crt â”œâ”€â”€ peer.key â”œâ”€â”€ server.crt â””â”€â”€ server.key</code> </pre> <br><p> æœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯<strong>etcd3</strong> ï¼š </p><br><pre> <code class="plaintext hljs">/root â””â”€â”€ kubeadmcfg.yaml --- /etc/kubernetes/pki â”œâ”€â”€ apiserver-etcd-client.crt â”œâ”€â”€ apiserver-etcd-client.key â””â”€â”€ etcd â”œâ”€â”€ ca.crt â”œâ”€â”€ healthcheck-client.crt â”œâ”€â”€ healthcheck-client.key â”œâ”€â”€ peer.crt â”œâ”€â”€ peer.key â”œâ”€â”€ server.crt â””â”€â”€ server.key</code> </pre> <br><p> å½“æ‰€æœ‰è¯ä¹¦å’Œé…ç½®éƒ½å°±ç»ªåï¼Œæˆ‘ä»¬åˆ›å»ºæ¸…å•ã€‚ åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œè¿è¡Œ<strong>kubeadm</strong>å‘½ä»¤-ä¸º<strong>etcd</strong>é›†ç¾¤ç”Ÿæˆé™æ€æ¸…å•ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# kubeadm init phase etcd local --config=/tmp/192.168.0.2/kubeadmcfg.yaml etcd1# kubeadm init phase etcd local --config=/root/kubeadmcfg.yaml etcd1# kubeadm init phase etcd local --config=/root/kubeadmcfg.yaml</code> </pre> <br><p> ç°åœ¨ï¼Œä»ç†è®ºä¸Šè®²ï¼Œ <strong>etcd</strong>é›†ç¾¤å·²ç»é…ç½®å¥½å¹¶ä¸”è¿è¡Œè‰¯å¥½ã€‚ é€šè¿‡åœ¨etcd1 <strong>èŠ‚ç‚¹</strong>ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡ŒéªŒè¯ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# docker run --rm -it \ --net host \ -v /etc/kubernetes:/etc/kubernetes quay.io/coreos/etcd:v3.2.24 etcdctl \ --cert-file /etc/kubernetes/pki/etcd/peer.crt \ --key-file /etc/kubernetes/pki/etcd/peer.key \ --ca-file /etc/kubernetes/pki/etcd/ca.crt \ --endpoints https://192.168.0.2:2379 cluster-health ### status output member 37245675bd09ddf3 is healthy: got healthy result from https://192.168.0.3:2379 member 532d748291f0be51 is healthy: got healthy result from https://192.168.0.4:2379 member 59c53f494c20e8eb is healthy: got healthy result from https://192.168.0.2:2379 cluster is healthy</code> </pre> <br><p>  <strong>etcd</strong>é›†ç¾¤å·²ç»ä¸Šå‡ï¼Œå› æ­¤ç»§ç»­å‰è¿›ã€‚ </p><br><h3 id="6-nastroyka-master--i-rabochih-nod">  6.é…ç½®ä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ </h3><br><p> é…ç½®é›†ç¾¤çš„ä¸»èŠ‚ç‚¹-å°†è¿™äº›æ–‡ä»¶ä»ç¬¬ä¸€ä¸ª<strong>etcd</strong>èŠ‚ç‚¹å¤åˆ¶åˆ°ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼š </p><br><pre> <code class="plaintext hljs">etcd1# scp /etc/kubernetes/pki/etcd/ca.crt 192.168.0.5: etcd1# scp /etc/kubernetes/pki/apiserver-etcd-client.crt 192.168.0.5: etcd1# scp /etc/kubernetes/pki/apiserver-etcd-client.key 192.168.0.5:</code> </pre> <br><p> ç„¶åå°†sshè½¬åˆ°ä¸»èŠ‚ç‚¹<strong>master1</strong>å¹¶åˆ›å»ºå…·æœ‰ä»¥ä¸‹å†…å®¹çš„<strong>kubeadm-config.yamlæ–‡ä»¶</strong> ï¼š </p><br><pre> <code class="plaintext hljs">master1# cd /root &amp;&amp; vi kubeadm-config.yaml apiVersion: kubeadm.k8s.io/v1beta1 kind: ClusterConfiguration kubernetesVersion: stable apiServer: certSANs: - "192.168.0.1" controlPlaneEndpoint: "192.168.0.1:6443" etcd: external: endpoints: - https://192.168.0.2:2379 - https://192.168.0.3:2379 - https://192.168.0.4:2379 caFile: /etc/kubernetes/pki/etcd/ca.crt certFile: /etc/kubernetes/pki/apiserver-etcd-client.crt keyFile: /etc/kubernetes/pki/apiserver-etcd-client.key</code> </pre> <br><p> å¦‚è®¾ç½®è¯´æ˜æ‰€è¿°ï¼Œå°†å…ˆå‰å¤åˆ¶çš„è¯ä¹¦å’Œå¯†é’¥ç§»åŠ¨åˆ°master1 <strong>èŠ‚ç‚¹</strong>ä¸Šçš„ç›¸åº”ç›®å½•ã€‚ </p><br><pre> <code class="plaintext hljs">master1# mkdir -p /etc/kubernetes/pki/etcd/ master1# cp /root/ca.crt /etc/kubernetes/pki/etcd/ master1# cp /root/apiserver-etcd-client.crt /etc/kubernetes/pki/ master1# cp /root/apiserver-etcd-client.key /etc/kubernetes/pki/</code> </pre> <br><p> è¦åˆ›å»ºç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š </p><br><pre> <code class="plaintext hljs">master1# kubeadm init --config kubeadm-config.yaml</code> </pre> <br><p> å¦‚æœä»¥ä¸Šæ‰€æœ‰æ­¥éª¤å‡æ­£ç¡®å®Œæˆï¼Œæ‚¨å°†çœ‹åˆ°ä»¥ä¸‹å†…å®¹ï¼š </p><br><pre> <code class="plaintext hljs">You can now join any number of machines by running the following on each node as root: kubeadm join 192.168.0.1:6443 --token aasuvd.kw8m18m5fy2ot387 --discovery-token-ca-cert-hash sha256:dcbaeed8d1478291add0294553b6b90b453780e546d06162c71d515b494177a6</code> </pre> <br><p> å°†<strong>kubeadm</strong>åˆå§‹åŒ–çš„è¾“å‡ºå¤åˆ¶åˆ°ä»»ä½•æ–‡æœ¬æ–‡ä»¶ï¼Œå°†æ¥åœ¨å°†ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹é™„åŠ åˆ°é›†ç¾¤æ—¶å°†ä½¿ç”¨æ­¤ä»¤ç‰Œã€‚ </p><br><p> æˆ‘å·²ç»è¯´è¿‡Kubernetesé›†ç¾¤å°†ä¸ºå£ç‚‰å’Œå…¶ä»–æœåŠ¡ä½¿ç”¨æŸç§è¦†ç›–ç½‘ç»œï¼Œå› æ­¤ï¼Œæ­¤æ—¶æ‚¨éœ€è¦å®‰è£…æŸç§CNIæ’ä»¶ã€‚ æˆ‘æ¨è<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Weave CNI</a>æ’ä»¶ã€‚ ç»éªŒè¡¨æ˜ï¼Œå®ƒæ›´æœ‰ç”¨ä¸”é—®é¢˜æ›´å°‘ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€‰æ‹©å¦ä¸€ä¸ªï¼Œä¾‹å¦‚Calicoã€‚ </p><br><p> åœ¨ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸Šå®‰è£…Weaveç½‘ç»œæ’ä»¶ï¼š </p><br><pre> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf apply -f "https://cloud.weave.works/k8s/net?k8s-version=$(kubectl version | base64 | tr -d '\n')" The connection to the server localhost:8080 was refused - did you specify the right host or port? serviceaccount/weave-net created clusterrole.rbac.authorization.k8s.io/weave-net created clusterrolebinding.rbac.authorization.k8s.io/weave-net created role.rbac.authorization.k8s.io/weave-net created rolebinding.rbac.authorization.k8s.io/weave-net created daemonset.extensions/weave-net created</code> </pre> <br><p> è¯·ç¨ç­‰ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ä»¥éªŒè¯ç»„ä»¶ç‚‰åºŠæ˜¯å¦æ­£åœ¨è¿è¡Œï¼š </p><br><pre> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get pod -n kube-system -w NAME READY STATUS RESTARTS AGE coredns-86c58d9df4-d7qfw 1/1 Running 0 6m25s coredns-86c58d9df4-xj98p 1/1 Running 0 6m25s kube-apiserver-master1 1/1 Running 0 5m22s kube-controller-manager-master1 1/1 Running 0 5m41s kube-proxy-8ncqw 1/1 Running 0 6m25s kube-scheduler-master1 1/1 Running 0 5m25s weave-net-lvwrp 2/2 Running 0 78s</code> </pre> <br><ul><li> å»ºè®®ä»…åœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åˆå§‹åŒ–ä¹‹åæ‰é™„åŠ æ§åˆ¶å¹³é¢çš„æ–°èŠ‚ç‚¹ã€‚ </li></ul><br><p> è¦æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š </p><br><pre> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 11m v1.13.1</code> </pre> <br><p> å¤ªå¥½äº†ï¼ ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¸Šå‡ã€‚ ç°åœ¨å·²ç»å‡†å¤‡å°±ç»ªï¼Œæˆ‘ä»¬å°†å®Œæˆåˆ›å»ºKubernetesé›†ç¾¤çš„å·¥ä½œ-æˆ‘ä»¬å°†æ·»åŠ ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹ã€‚ <br> è¦æ·»åŠ ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹ï¼Œè¯·åœ¨<strong>master1</strong>ä¸Šåˆ›å»ºä¸€ä¸ªsshå¯†é’¥ï¼Œå¹¶å°†å…¬å…±éƒ¨åˆ†æ·»åŠ åˆ°<strong>master2</strong> ã€‚ æ‰§è¡Œæµ‹è¯•ç™»å½•ï¼Œç„¶åå°†ä¸€äº›æ–‡ä»¶ä»ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹å¤åˆ¶åˆ°ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹ï¼š </p><br><pre> <code class="plaintext hljs">master1# scp /etc/kubernetes/pki/ca.crt 192.168.0.6: master1# scp /etc/kubernetes/pki/ca.key 192.168.0.6: master1# scp /etc/kubernetes/pki/sa.key 192.168.0.6: master1# scp /etc/kubernetes/pki/sa.pub 192.168.0.6: master1# scp /etc/kubernetes/pki/front-proxy-ca.crt @192.168.0.6: master1# scp /etc/kubernetes/pki/front-proxy-ca.key @192.168.0.6: master1# scp /etc/kubernetes/pki/apiserver-etcd-client.crt @192.168.0.6: master1# scp /etc/kubernetes/pki/apiserver-etcd-client.key @192.168.0.6: master1# scp /etc/kubernetes/pki/etcd/ca.crt 192.168.0.6:etcd-ca.crt master1# scp /etc/kubernetes/admin.conf 192.168.0.6: ### Check that files was copied well master2# ls /root admin.conf ca.crt ca.key etcd-ca.crt front-proxy-ca.crt front-proxy-ca.key sa.key sa.pub</code> </pre> <br><p> åœ¨ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹ä¸Šï¼Œå°†å…ˆå‰å¤åˆ¶çš„è¯ä¹¦å’Œå¯†é’¥ç§»åŠ¨åˆ°é€‚å½“çš„ç›®å½•ï¼š </p><br><pre> <code class="plaintext hljs">master2# mkdir -p /etc/kubernetes/pki/etcd mv /root/ca.crt /etc/kubernetes/pki/ mv /root/ca.key /etc/kubernetes/pki/ mv /root/sa.pub /etc/kubernetes/pki/ mv /root/sa.key /etc/kubernetes/pki/ mv /root/apiserver-etcd-client.crt /etc/kubernetes/pki/ mv /root/apiserver-etcd-client.key /etc/kubernetes/pki/ mv /root/front-proxy-ca.crt /etc/kubernetes/pki/ mv /root/front-proxy-ca.key /etc/kubernetes/pki/ mv /root/etcd-ca.crt /etc/kubernetes/pki/etcd/ca.crt mv /root/admin.conf /etc/kubernetes/admin.conf</code> </pre> <br><p> å°†ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹è¿æ¥åˆ°ç¾¤é›†ã€‚ ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦è¿æ¥å‘½ä»¤çš„è¾“å‡ºï¼Œè¯¥å‘½ä»¤å…ˆå‰æ˜¯ç”±ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„<strong><code>kubeadm init</code></strong>ä¼ é€’ç»™æˆ‘ä»¬çš„ã€‚ </p><br><p> è¿è¡Œä¸»èŠ‚ç‚¹<strong>master2</strong> ï¼š </p><br><pre> <code class="plaintext hljs">master2# kubeadm join 192.168.0.1:6443 --token aasuvd.kw8m18m5fy2ot387 --discovery-token-ca-cert-hash sha256:dcbaeed8d1478291add0294553b6b90b453780e546d06162c71d515b494177a6 --experimental-control-plane</code> </pre> <br><ul><li> æ‚¨éœ€è¦æ·»åŠ <strong><code>--experimental-control-plane</code></strong>æ ‡å¿—ã€‚ å®ƒå¯ä»¥è‡ªåŠ¨å°†ä¸»æ•°æ®é™„åŠ åˆ°ç¾¤é›†ã€‚ æ²¡æœ‰æ­¤æ ‡å¿—ï¼Œé€šå¸¸çš„å·¥ä½œèŠ‚ç‚¹å°†è¢«ç®€å•åœ°æ·»åŠ ã€‚ </li></ul><br><p> ç­‰å¾…ä¸€ç‚¹ï¼Œç›´åˆ°èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼Œç„¶åæ£€æŸ¥é›†ç¾¤çš„æ–°çŠ¶æ€ï¼š </p><br><pre> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 32m v1.13.1 master2 Ready master 46s v1.13.1</code> </pre> <br><p> è¿˜è¦ç¡®ä¿æ‰€æœ‰ä¸»èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰podéƒ½æ­£å¸¸å¯åŠ¨ï¼š </p><br><pre> <code class="plaintext hljs">master1# kubectl â€” kubeconfig /etc/kubernetes/admin.conf get pod -n kube-system -w NAME READY STATUS RESTARTS AGE coredns-86c58d9df4-d7qfw 1/1 Running 0 46m coredns-86c58d9df4-xj98p 1/1 Running 0 46m kube-apiserver-master1 1/1 Running 0 45m kube-apiserver-master2 1/1 Running 0 15m kube-controller-manager-master1 1/1 Running 0 45m kube-controller-manager-master2 1/1 Running 0 15m kube-proxy-8ncqw 1/1 Running 0 46m kube-proxy-px5dt 1/1 Running 0 15m kube-scheduler-master1 1/1 Running 0 45m kube-scheduler-master2 1/1 Running 0 15m weave-net-ksvxz 2/2 Running 1 15m weave-net-lvwrp 2/2 Running 0 41m</code> </pre> <br><p> å¤ªå¥½äº†ï¼  Kubernetesé›†ç¾¤é…ç½®å‡ ä¹å®Œæˆäº†ã€‚ æœ€åè¦åšçš„æ˜¯æ·»åŠ æˆ‘ä»¬ä¹‹å‰å‡†å¤‡çš„ä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚ </p><br><p> è¾“å…¥å·¥ä½œèŠ‚ç‚¹å¹¶æ‰§è¡Œä¸å¸¦<strong><code>--experimental-control-plane</code></strong>æ ‡å¿—çš„kubeadm joinå‘½ä»¤ã€‚ </p><br><pre> <code class="plaintext hljs">worker1-3# kubeadm join 192.168.0.1:6443 --token aasuvd.kw8m18m5fy2ot387 --discovery-token-ca-cert-hash sha256:dcbaeed8d1478291add0294553b6b90b453780e546d06162c71d515b494177a6</code> </pre> <br><p> å†æ¬¡æ£€æŸ¥é›†ç¾¤çŠ¶æ€ï¼š </p><br><pre> <code class="plaintext hljs">master1# kubectl --kubeconfig /etc/kubernetes/admin.conf get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 1h30m v1.13.1 master2 Ready master 1h59m v1.13.1 worker1 Ready &lt;none&gt; 1h8m v1.13.1 worker2 Ready &lt;none&gt; 1h8m v1.13.1 worker3 Ready &lt;none&gt; 1h7m v1.13.1</code> </pre> <br><p> å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå®Œå…¨é…ç½®çš„Kubernetes HAç¾¤é›†ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªä¸»èŠ‚ç‚¹å’Œä¸‰ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚ å®ƒæ˜¯åŸºäºHA etcdç¾¤é›†æ„å»ºçš„ï¼Œåœ¨ä¸»èŠ‚ç‚¹å‰å…·æœ‰æ•…éšœå®‰å…¨è´Ÿè½½å¹³è¡¡å™¨ã€‚ å¯¹æˆ‘æ¥è¯´å¬èµ·æ¥ä¸é”™ã€‚ </p><br><h3 id="7-nastroyka-udalennogo-upravleniya-klasterom">  7.é…ç½®è¿œç¨‹é›†ç¾¤ç®¡ç† </h3><br><p> åœ¨æœ¬æ–‡çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­ä»æœ‰å¾…è€ƒè™‘çš„å¦ä¸€é¡¹æ“ä½œæ˜¯è®¾ç½®ç”¨äºç®¡ç†é›†ç¾¤çš„è¿œç¨‹<strong>kubectl</strong>å®ç”¨ç¨‹åºã€‚ ä»¥å‰ï¼Œæˆ‘ä»¬ä»ä¸»èŠ‚ç‚¹<strong>master1</strong>è¿è¡Œæ‰€æœ‰å‘½ä»¤ï¼Œä½†è¿™ä»…é€‚åˆç¬¬ä¸€æ¬¡-é…ç½®é›†ç¾¤æ—¶ã€‚ æœ€å¥½é…ç½®ä¸€ä¸ªå¤–éƒ¨æ§åˆ¶èŠ‚ç‚¹ã€‚ æ‚¨å¯ä»¥ä¸ºæ­¤ä½¿ç”¨ç¬”è®°æœ¬ç”µè„‘æˆ–å…¶ä»–æœåŠ¡å™¨ã€‚ </p><br><p> ç™»å½•åˆ°è¯¥æœåŠ¡å™¨å¹¶è¿è¡Œï¼š </p><br><pre> <code class="plaintext hljs">Add the Google repository key control# curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - Add the Google repository control# cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list deb https://apt.kubernetes.io/ kubernetes-xenial main EOF Update and install kubectl control# apt-get update &amp;&amp; apt-get install -y kubectl In your user home dir create control# mkdir ~/.kube Take the Kubernetes admin.conf from the master1 node control# scp 192.168.0.5:/etc/kubernetes/admin.conf ~/.kube/config Check that we can send commands to our cluster control# kubectl get nodes NAME STATUS ROLES AGE VERSION master1 Ready master 6h58m v1.13.1 master2 Ready master 6h27m v1.13.1 worker1 Ready &lt;none&gt; 5h36m v1.13.1 worker2 Ready &lt;none&gt; 5h36m v1.13.1 worker3 Ready &lt;none&gt; 5h36m v1.13.1</code> </pre> <br><p> å¥½çš„ï¼Œç°åœ¨è®©æˆ‘ä»¬åœ¨é›†ç¾¤ä¸­è¿›è¡Œæµ‹è¯•ï¼Œå¹¶æ£€æŸ¥å…¶å·¥ä½œæ–¹å¼ã€‚ </p><br><pre> <code class="plaintext hljs">control# kubectl create deployment nginx --image=nginx deployment.apps/nginx created control# kubectl get pods NAME READY STATUS RESTARTS AGE nginx-5c7588df-6pvgr 1/1 Running 0 52s</code> </pre> <br><p> æ­å–œä½ ï¼ æ‚¨åˆšåˆšéƒ¨ç½²äº†Kubernetesã€‚ è¿™æ„å‘³ç€æ‚¨çš„æ–°HAé›†ç¾¤å·²å‡†å¤‡å°±ç»ªã€‚ å®é™…ä¸Šï¼Œä½¿ç”¨<strong>kubeadm</strong>è®¾ç½®Kubernetesé›†ç¾¤çš„è¿‡ç¨‹éå¸¸ç®€å•ä¸”å¿«é€Ÿã€‚ </p><br><p> åœ¨æœ¬æ–‡çš„ä¸‹ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡åœ¨æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹ä¸Šè®¾ç½®GlusterFSï¼Œä¸ºæˆ‘ä»¬çš„Kubernetesé›†ç¾¤è®¾ç½®å†…éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œä»¥åŠè¿è¡ŒæŸäº›å‹åŠ›æµ‹è¯•ï¼Œæ–­å¼€æŸäº›èŠ‚ç‚¹å¹¶æ£€æŸ¥é›†ç¾¤çš„ç¨³å®šæ€§æ¥æ·»åŠ å†…éƒ¨å­˜å‚¨ã€‚ </p><br><h3 id="posleslovie"> åè®° </h3><br><p> æ˜¯çš„ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ‚¨ä¼šé‡åˆ°å¾ˆå¤šé—®é¢˜ã€‚ æ— éœ€æ‹…å¿ƒï¼šè¦æ’¤æ¶ˆæ›´æ”¹å¹¶ä½¿èŠ‚ç‚¹è¿”å›å…¶åŸå§‹çŠ¶æ€ï¼Œåªéœ€è¿è¡Œ<strong>kubeadm</strong> <strong>reset-</strong>å…ˆå‰<strong>kubeadm</strong>æ‰€åšçš„æ›´æ”¹å°†è¢«é‡ç½®ï¼Œæ‚¨å¯ä»¥å†æ¬¡è¿›è¡Œé…ç½®ã€‚ å¦å¤–ï¼Œä¸è¦å¿˜è®°æ£€æŸ¥ç¾¤é›†èŠ‚ç‚¹ä¸Šçš„Dockerå®¹å™¨çš„çŠ¶æ€-ç¡®ä¿å®ƒä»¬éƒ½å·²å¯åŠ¨å¹¶ä¸”å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ æœ‰å…³æŸåçš„å®¹å™¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ä½¿ç”¨<strong>docker logs containeridå‘½ä»¤</strong> ã€‚ </p><br><p> ä»Šå¤©å°±è¿™äº›äº†ã€‚ ç¥ä½ å¥½è¿ </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN439562/">https://habr.com/ru/post/zh-CN439562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN439550/index.html">Hackquest2018ã€‚ç»“æœä¸å†™ä½œã€‚ ç¬¬1-3å¤©</a></li>
<li><a href="../zh-CN439552/index.html">æ¶æ„çš„Chromeæ‰©å±•ç¨‹åº</a></li>
<li><a href="../zh-CN439556/index.html">TDMSèˆªé“ã€‚ PMBOKæ–¹æ³•è®ºå’Œä¿„ç½—æ–¯è®¾è®¡ç»„ç»‡</a></li>
<li><a href="../zh-CN439558/index.html">æ–°æ—§ç”µè¯ã€‚ é‡å¡‘PSTNç”µè¯</a></li>
<li><a href="../zh-CN439560/index.html">é€‚ç”¨äºInterSystems IRISæ•°æ®å¹³å°çš„ä»¥å¤ªåŠåŒºå—é“¾é€‚é…å™¨</a></li>
<li><a href="../zh-CN439564/index.html">ä»¥Pututä¸ºä¾‹çš„ASTæ ‘è½¬æ¢çš„å®é™…åº”ç”¨</a></li>
<li><a href="../zh-CN439566/index.html">ä¸ºä»€ä¹ˆSREæ–‡æ¡£å¾ˆé‡è¦ã€‚ ç¬¬ä¸‰éƒ¨åˆ†</a></li>
<li><a href="../zh-CN439568/index.html">åŸºäºQLCçš„SSD-ç¡¬ç›˜æ€æ‰‹?ï¼Ÿ ä¸æ˜¯çœŸçš„</a></li>
<li><a href="../zh-CN439570/index.html">IPythoné­”æœ¯æ¥ç¼–è¾‘Jupyterç»†èƒæ ‡è®°</a></li>
<li><a href="../zh-CN439572/index.html">ç”µå­è®¾å¤‡çš„è®¡ç®—æœºè¾…åŠ©è®¾è®¡</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>