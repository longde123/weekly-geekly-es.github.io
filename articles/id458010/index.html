<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👼🏾 🥘 👞 The Adventures of the Elusive Malvari, Bagian II: Script VBA Rahasia #⃣ 🥒 👨🏿‍🎤</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini adalah bagian dari seri Fileless Malware. Semua bagian seri lainnya: 



- Petualangan Malvari yang Elusif, Bagian I 
- Petualangan Elusiv...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>The Adventures of the Elusive Malvari, Bagian II: Script VBA Rahasia</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/varonis/blog/458010/"><img src="https://habrastorage.org/webt/3t/ih/b0/3tihb0g1kt7wbjalc_s3xe0xgjo.png"><br><br>  Artikel ini adalah bagian dari seri Fileless Malware.  Semua bagian seri lainnya: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Petualangan Malvari yang Elusif, Bagian I</a> </li><li>  Petualangan Elusive Malvari, Bagian II: Script VBA Tersembunyi (kami di sini) </li></ul><br>  Saya penggemar situs web <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">analisis hibrid</a> (HA).  Ini adalah semacam kebun binatang malware di mana Anda dapat dengan aman menonton "predator" liar dari jarak aman tanpa diserang.  HA meluncurkan malware di lingkungan yang aman, merekam panggilan sistem, menghasilkan file dan lalu lintas Internet, dan menampilkan semua hasil ini untuk setiap sampel yang Anda analisis.  Dengan demikian, Anda tidak dapat menyia-nyiakan waktu dan energi Anda sendiri dengan memecahkan kode yang membingungkan, tetapi segera memahami semua niat para peretas. <br><a name="habracut"></a><br>  Contoh HA yang menarik perhatian saya menggunakan skrip JavaScript atau Visual Basic for Applications (VBA) yang disematkan sebagai makro dalam dokumen Word atau Excel dan dilampirkan ke email phishing.  Ketika dibuka, makro ini memulai sesi PowerShell di komputer korban.  Peretas biasanya mengirim aliran perintah yang disandikan Base64 ke PowerShell.  Ini semua dilakukan untuk membuat serangan sulit dideteksi dengan filter web dan perangkat lunak antivirus yang merespons kata kunci tertentu. <br>  Untungnya, HA secara otomatis menerjemahkan Base64 dan segera menunjukkan semuanya dalam bentuk yang dapat dibaca.  Pada dasarnya, Anda tidak perlu fokus pada cara kerja skrip ini, karena Anda dapat melihat output lengkap dari perintah untuk menjalankan proses di bagian HA yang sesuai.  Lihat contoh di bawah ini: <br><br><img src="https://habrastorage.org/webt/ew/jp/cw/ewjpcwuesyaeevrw55513pjcxy4.jpeg"><br><br>  Analisis hibrida memotong perintah yang disandikan Base64 yang dikirim ke PowerShell: <br><br><img src="https://habrastorage.org/webt/yy/j7/wx/yyj7wxyf8ejzrjtbnzgjfpdrucc.jpeg"><br><br>  ... dan kemudian menerjemahkannya untuk Anda.  # secara ajaib <br><br>  Dalam <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">posting sebelumnya,</a> saya membuat wadah JavaScript saya sendiri yang agak dikaburkan untuk memulai sesi PowerShell.  Kemudian skrip saya, seperti banyak malware berbasis PowerShell, mengunduh skrip PowerShell berikut dari situs web jarak jauh.  Kemudian, sebagai contoh, saya mengunduh PS yang tidak berbahaya untuk mencetak pesan di layar.  Tetapi waktu berubah, dan sekarang saya mengusulkan untuk memperumit skenario. <br><br><h2>  PowerShell Empire dan Reverse Shell </h2><br>  Salah satu tujuan latihan ini adalah untuk menunjukkan bagaimana (relatif) dengan mudah seorang hacker dapat mengatasi pertahanan perimeter klasik dan antivirus.  Jika seorang blogger IT tanpa keahlian pemrograman seperti saya dapat <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">membuat malware yang</a> sepenuhnya tidak terdeteksi (FUD) dalam beberapa malam, bayangkan kemungkinan-kemungkinan seorang hacker muda tertarik pada hal ini! <br><br>  Dan jika Anda adalah orang yang menyediakan keamanan TI, tetapi manajer Anda tidak mengetahui konsekuensi yang mungkin timbul dari ancaman ini, cukup tunjukkan padanya artikel ini. <br><br>  Peretas bermimpi mendapatkan akses langsung ke laptop atau server korban.  Sangat mudah untuk melakukan ini: semua yang dibutuhkan peretas adalah mendapatkan beberapa file rahasia di laptop CEO. <br><br>  Entah bagaimana saya sudah <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis</a> tentang runtime PowerShell Empire pasca-operasional.  Mari kita ingat apa itu. <br><br>  Pada dasarnya, ini adalah alat pengujian penetrasi berbasis PowerShell yang, di antara banyak fitur lainnya, membuatnya mudah untuk menjalankan shell terbalik.  Anda dapat mempelajari lebih lanjut tentang itu di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">beranda PSE</a> . <br><br>  Mari kita lakukan percobaan kecil.  Saya mengatur lingkungan pengujian malware yang aman di cloud Amazon Web Services.  Anda dapat mengikuti contoh saya dengan cepat dan aman menunjukkan contoh kerja kerentanan ini (dan tidak dipecat karena meluncurkan virus di dalam perimeter perusahaan). <br><br>  Jika Anda memulai konsol PowerShell Empire, Anda akan melihat sesuatu seperti berikut: <br><br><img src="https://habrastorage.org/webt/vx/-j/mf/vx-jmf1qyoc8cfo1nmcockocfea.jpeg"><br><br>  Pertama, Anda memulai proses pendengar di komputer peretas Anda.  Masukkan perintah "listener", dan tentukan alamat IP sistem Anda menggunakan "set Host".  Kemudian mulai proses pendengar dengan menjalankan perintah (di bawah).  Jadi, untuk bagian Anda, mulai menunggu koneksi jaringan dari shell jarak jauh: <br><br><img src="https://habrastorage.org/webt/fm/1e/ux/fm1eux-ocyidttp4eqlt9q0qb74.jpeg"><br><br>  Untuk sisi lain, Anda perlu membuat kode agen dengan memasukkan perintah peluncur (lihat di bawah).  Ini akan menghasilkan kode PowerShell untuk agen jarak jauh.  Perhatikan bahwa itu disandikan di Base64, dan mewakili fase kedua payload.  Dengan kata lain, kode JavaScript saya sekarang akan menarik agen ini untuk menjalankan PowerShell alih-alih output teks yang tidak berbahaya ke layar dan terhubung ke server PSE jarak jauh kami untuk menjalankan shell terbalik. <br><br><img src="https://habrastorage.org/webt/xh/vs/ig/xhvsigu6puk1rvt0e3ttwh43uyg.jpeg"><br>  <em>Keajaiban shell terbalik.</em>  <em>Perintah PowerShell yang disandikan ini akan terhubung ke pendengar saya dan memulai shell jarak jauh.</em> <br><br>  Untuk menunjukkan kepada Anda eksperimen ini, saya mengambil peran sebagai korban yang tidak bersalah dan membuka Evil.doc, dengan demikian meluncurkan JavaScript kami.  Ingat bagian pertama?  PowerShell dikonfigurasikan sehingga jendelanya tidak muncul, sehingga korban tidak akan melihat sesuatu yang tidak biasa.  Namun, jika Anda membuka Windows Task Manager, Anda akan melihat proses latar belakang PowerShell, yang sebagian besar masih tidak akan menimbulkan alarm.  Karena itu PowerShell biasa, bukan? <br><br><img src="https://habrastorage.org/webt/wz/se/cr/wzsecrznut3tonqek3wteofemiw.jpeg"><br><br>  Sekarang, ketika Anda menjalankan Evil.doc, proses latar belakang tersembunyi akan terhubung ke server dengan PowerShell Empire.  Setelah mengenakan topi putih hacker-pentester, saya kembali ke konsol PowerShell Empire dan sekarang saya melihat pesan bahwa agen jarak jauh saya aktif. <br><br><img src="https://habrastorage.org/webt/fm/1e/ux/fm1eux-ocyidttp4eqlt9q0qb74.jpeg"><br><br>  Kemudian saya memasukkan perintah "berinteraksi" untuk membuka shell di PSE - dan inilah saya!  Singkatnya, saya meretas ke server Taco, yang saya atur sendiri sekali. <br><br><img src="https://habrastorage.org/webt/vh/to/0z/vhto0zmky-9wpmxxpf2tnlzze5s.jpeg"><br><br>  Apa yang baru saja saya tunjukkan tidak membutuhkan banyak pekerjaan dari Anda.  Anda dapat melakukan semua ini dengan aman untuk istirahat makan siang selama satu hingga dua jam untuk meningkatkan pengetahuan Anda tentang keamanan informasi.  Ini juga merupakan cara yang bagus untuk memahami bagaimana peretas menghindari perlindungan perimeter keamanan eksternal dan secara diam-diam menggunakan sistem Anda. <br><br>  Manajer TI yang percaya bahwa mereka telah membangun perlindungan yang tidak dapat dihancurkan terhadap penetrasi apa pun mungkin akan menganggapnya informatif - yah, jika, tentu saja, Anda bisa meyakinkan mereka untuk duduk di sebelah Anda untuk waktu yang lama. <br><br><h2>  Kembali ke kenyataan </h2><br>  Seperti yang saya harapkan, peretasan nyata yang tidak terlihat oleh pengguna rata-rata hanyalah variasi dari apa yang baru saja saya jelaskan.  Untuk mengumpulkan bahan untuk publikasi berikutnya, saya mulai mencari sampel tentang HA yang bekerja dengan cara yang sama seperti contoh yang saya temukan.  Dan saya tidak harus mencarinya dalam waktu yang lama - situs ini memiliki banyak pilihan untuk teknik serangan seperti itu. <br><br>  Malware yang akhirnya saya temukan di HA adalah skrip \ VBA yang dibangun ke dalam dokumen Word.  Artinya, saya bahkan tidak perlu memalsukan ekstensi doc, malware ini benar-benar dokumen Microsoft Word yang paling umum.  Jika Anda tertarik, maka saya memilih sampel ini, yang disebut <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">rfq.doc</a> . <br><br>  Saya dengan cepat mengetahui bahwa seringkali Anda tidak akan dapat langsung mengekstrak skrip VBA berbahaya dari dokumen.  Peretas menekan dan menyembunyikannya, dan mereka tidak terlihat di alat makro bawaan Word.  Anda akan memerlukan alat khusus untuk mengekstraknya.  Untungnya, saya menemukan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">OfficeMalScanner</a> milik Frank Baldwin.  Terima kasih, Frank. <br><br>  Dengan menggunakan alat ini, saya bisa mengeluarkan kode VBA yang sangat membingungkan.  Itu terlihat seperti ini: <br><br><img src="https://habrastorage.org/webt/sd/nc/mo/sdncmon3h_nk5cr_hdgzld3jsns.jpeg"><br>  <em>Kebingungan dilakukan oleh para profesional.</em>  <em>Saya terkesan!</em> <br><br>  Para penyerang benar-benar pandai mengacaukan kode, tidak seperti upaya saya menciptakan Evil.doc.  Baiklah, ok, pada bagian selanjutnya kita akan mendapatkan debuggers VBA kita, masuk lebih dalam ke kode ini dan bandingkan analisis kita dengan hasil HA. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id458010/">https://habr.com/ru/post/id458010/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id457996/index.html">Pengakuan bos: bagaimana bekerja saat bepergian, untuk memberhentikan setengah dari departemen di LA dan mengapa mensponsori MeksetnoExp Tyoma Lebedev</a></li>
<li><a href="../id458000/index.html">Penilaian pose manusia pada gambar untuk iOS</a></li>
<li><a href="../id458002/index.html">Apa yang sebenarnya terjadi dengan Boeing Malaysia yang hilang (bagian 1/3)</a></li>
<li><a href="../id458004/index.html">Sistem kontrol lalu lintas pesawat ruang angkasa Soyuz-TM bagian 2</a></li>
<li><a href="../id458006/index.html">Situs tanpa server dinamis di Halaman Github (bagi mereka yang tidak tahu, serverless menggunakan server API pihak ketiga)</a></li>
<li><a href="../id458014/index.html">Robot FEDOR - pelatihan dengan kru ISS baru dan tugas luar angkasa pertama</a></li>
<li><a href="../id458018/index.html">composer vs npm: pengembangan multi-modul</a></li>
<li><a href="../id458020/index.html">Juli Acara IT Digest</a></li>
<li><a href="../id458022/index.html">Sidik jari melalui iklan spanduk? Sekarang ini sudah biasa</a></li>
<li><a href="../id458026/index.html">Perbandingan Format Serialisasi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>