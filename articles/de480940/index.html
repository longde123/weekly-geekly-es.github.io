<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👩🏼‍⚖️ 🧦 🍱 Führen Sie einen browserübergreifenden UI-Test mit Cucumber und Selenoid in Gitlab CI mit Allure-Bericht aus ☢️ 🍓 🙋🏽</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cucumber ist eine Testinfrastruktur, mit der Sie die Lücke zwischen Softwareentwicklern und Geschäftsmanagern schließen können. Tests werden in einer ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Führen Sie einen browserübergreifenden UI-Test mit Cucumber und Selenoid in Gitlab CI mit Allure-Bericht aus</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/480940/"><p>  <a href="https://cucumber.io/" rel="nofollow">Cucumber</a> ist eine Testinfrastruktur, mit der Sie die Lücke zwischen Softwareentwicklern und Geschäftsmanagern schließen können.  Tests werden in einer einfachen verhaltensgesteuerten Entwicklungssprache (BDD) im Stil von Given, When, Then (Bedingungen, Betrieb, Ergebnis) geschrieben, die für jeden Benutzer verständlich ist.  Steuertests werden dann in Funktionsdateien geschrieben, die ein oder mehrere Testskripten umfassen.  Cucumber interpretiert Tests in der angegebenen Programmiersprache und verwaltet die Tests mit Selenium im Browser. </p><br><p>  <a href="https://github.com/aerokube/selenoid" rel="nofollow">Selenoid</a> ist eine alternative Selenium Server-Lösung, obwohl das Wesentliche dasselbe ist - die Organisation der Treiber. </p><br><p>  In diesem Beitrag wird ein einfacher Browsertest mit Cucumber und Selenoid in Gitlab CI mit einem Allure-Bericht am Ende gestartet. </p><a name="habracut"></a><br><h3 id="podgotovka">  Vorbereitung </h3><br><p>  Docker muss auf Ihrem Betriebssystem installiert sein und ausgeführt werden. </p><br><h3 id="ustanovka-selenoid">  Installieren Sie den Selenoid </h3><br><p>  Wenn Sie ein Redhat-basiertes Betriebssystem haben, können Sie den <a href="https://github.com/aerokube/cm" rel="nofollow">Konfigurationsmanager</a> mit meinem Repository installieren. </p><br><pre><code class="bash hljs">yum -y install yum-plugin-copr yum copr <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> antonpatsev/aerokube-cm-rpm yum -y install aerokube-cm</code> </pre> <br><p>  Wenn Sie kein Redhat-basiertes Betriebssystem haben, können Sie die <a href="https://github.com/aerokube/cm" rel="nofollow">Configuration Manager-</a> Binärdatei <a href="https://github.com/aerokube/cm/releases" rel="nofollow">herunterladen</a> und verwenden. </p><br><h3 id="zapusk-selenoid-ispolzuya-configuration-manager-i-formirovanie-browsersjson">  Ausführen von Selenoid mit Configuration Manager und Erstellen von browsers.json </h3><br><p>  Wenn Sie keinen direkten Zugriff auf das Internet und die Docker-Bilder haben, laden Sie diese über die Registrierung herunter. </p><br><pre> <code class="bash hljs">aerokube-cm selenoid start --force --browsers <span class="hljs-string"><span class="hljs-string">"firefox:70.0;firefox:71.0;chrome:78.0;chrome:79.0"</span></span> --registry -docker-registry</code> </pre> <br><p>  Wenn Sie direkten Zugang zum Internet haben. </p><br><pre> <code class="bash hljs">aerokube-cm selenoid start --force --browsers <span class="hljs-string"><span class="hljs-string">"firefox:70.0;firefox:71.0;chrome:78.0;chrome:79.0"</span></span></code> </pre> <br><p>  Der <code>--force</code> überschreibt die Datei <code>--force</code> . </p><br><p>  Die resultierende browsers.json-Datei zum Testen von Chrome und Firefox.  Beachten Sie, dass der Pfad für Chrome und Firefox unterschiedlich ist. </p><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"chrome"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"79.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"versions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"78.0"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker-registry/selenoid/chrome:78.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-string"><span class="hljs-string">"4444"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"79.0"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker-registry/selenoid/chrome:79.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-string"><span class="hljs-string">"4444"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span> } } }, <span class="hljs-attr"><span class="hljs-attr">"firefox"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"default"</span></span>: <span class="hljs-string"><span class="hljs-string">"71.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"versions"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"70.0"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker-registry/selenoid/firefox:70.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-string"><span class="hljs-string">"4444"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/wd/hub"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"71.0"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"image"</span></span>: <span class="hljs-string"><span class="hljs-string">"docker-registry/selenoid/firefox:71.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"port"</span></span>: <span class="hljs-string"><span class="hljs-string">"4444"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/wd/hub"</span></span> } } } }</code> </pre> <br><h3 id="izmenenie-browsersjson">  Browser.json ändern </h3><br><p>  Wenn Sie die Browserversion ändern, können Sie die Datei browsers.json ändern und selenoid neu laden. </p><br><p>  Wenn Sie jedoch den <code>--force</code> , wird <code>--force</code> mit neueren Browserversionen überschrieben. </p><br><p>  Überprüfen Sie, ob der Docker-Container gestartet wurde und die Bilder heruntergeladen wurden. </p><br><pre> <code class="bash hljs">docker ps docker images</code> </pre> <br><p><img src="https://habrastorage.org/webt/ti/bz/nh/tibznhc23bodj4jxrx1to95znbo.png"></p><br><h3 id="zapusk-selenoid-ui-ispolzuya-configuration-manager">  Ausführen der Selenoid-Benutzeroberfläche mit dem Konfigurationsmanager </h3><br><pre> <code class="bash hljs">aerokube-cm selenoid-ui start --registry https://docker-registry</code> </pre> <br><p>  Oder </p><br><pre> <code class="bash hljs">aerokube-cm selenoid-ui start</code> </pre> <br><p>  Überprüfen Sie, ob der Docker-Container gestartet wurde und die Bilder heruntergeladen wurden. </p><br><pre> <code class="bash hljs">docker ps docker images</code> </pre> <br><p><img src="https://habrastorage.org/webt/mv/c9/g7/mvc9g78xgxhyy45cf3xxahdsy3i.png"></p><br><p>  Wir gehen zu Selenoid-UI bei IP-wo-Sie-ran-Selenoid-und-Selenoid-UI: 8080 </p><br><p>  Du solltest 2 CONNECTED-Lichter haben, die grün und in Firefox und Chrom geschrieben sind. </p><br><p><img src="https://habrastorage.org/webt/-k/fi/dj/-kfidjzsisil5mdy8migutx-xro.png"></p><br><p>  In Fähigkeiten sehen wir verfügbare Browser. </p><br><p><img src="https://habrastorage.org/webt/ed/re/bp/edrebpyonygfiokgctqgy0catak.png"></p><br><p>  Demo-Test </p><br><p>  Laden Sie <a href="https://github.com/andewBr/cucumber_selenium_test" rel="nofollow">https://github.com/andewBr/cucumber_selenium_test</a> herunter </p><br><p><img src="https://habrastorage.org/webt/i-/6v/3_/i-6v3_qo-z7gaxzdx5t_nsdxyrm.png"></p><br><p>  oder an eine andere Adresse, an der Sie mit der Auswahl begonnen haben. </p><br><p>  Fügen Sie in der Datei WebdriverBeanConfig.java die Funktion zum Ausführen von Chrome hinzu.  Wenn Sie einen Proxyserver verwenden, fügen Sie wie im Screenshot Linien zum Proxy hinzu. </p><br><p><img src="https://habrastorage.org/webt/zw/vs/em/zwvsemk7jsrrxobacuqzg5hzvfu.png"></p><br><p>  In jeder Java-Datei können Sie die Videoaufzeichnung, die Remote-Anzeige oder die Verwaltung über VNC und die Protokollierung in einer Datei aktivieren oder deaktivieren.  Um die Option zu deaktivieren, müssen Sie am Zeilenanfang zwei Schrägstriche einfügen. </p><br><p><img src="https://habrastorage.org/webt/ji/wx/mh/jiwxmhj3ezvbcf8eh-vlha3gpg4.png"></p><br><br><h3 id="zapusk-testov">  Tests ausführen </h3><br><p>  Führen Sie im Demo-Test-Verzeichnis die folgenden Tests aus: </p><br><p>  Wenn Sie Einstellungen festlegen müssen und Maven-Proxies verwenden (Nexus, Artifactory) </p><br><pre> <code class="bash hljs">mvn -s settings.xml clean <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><p>  Wenn wir mit direktem Zugang zum Internet und ohne Einstellungen laufen </p><br><pre> <code class="bash hljs">mvn clean <span class="hljs-built_in"><span class="hljs-built_in">test</span></span></code> </pre> <br><h3 id="skorost">  Geschwindigkeit </h3><br><p>  Die Gesamtzeit für den Start eines Tests beträgt weniger als 1 Minute. </p><br><h3 id="zapusk-testov-v-gitlab-ci">  Ausführen von Tests in Gitlab CI </h3><br><p>  Um Selenoid und Selenoid-UI nicht jedes Mal zu starten, wenn Sie Tests ausführen, können Sie Selenoid und Selenoid-UI einmal ausführen, wenn Sie Gitlab Runner mit Ansible, Puppet, Chef oder anderen Tools starten. </p><br><p>  Final .gitlab-ci.yml </p><br><pre> <code class="plaintext hljs">--- variables: MAVEN_OPTS: "-Dhttps.protocols=TLSv1.2 -Dmaven.repo.local=/home/gitlab-runner/.m2/repository -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=WARN -Dorg.slf4j.simpleLogger.showDateTime=true -Djava.awt.headless=true" MAVEN_CLI_OPTS: "--batch-mode --errors --fail-at-end --show-version -DinstallAtEnd=true -DdeployAtEnd=true" before_script: - export PATH="/opt/rh/rh-maven33/root/usr/bin:$PATH" build: stage: build script: - aerokube-cm selenoid start --force --browsers "firefox:70;firefox:71;chrome:78;chrome:79" --registry docker-registry - aerokube-cm selenoid-ui start --registry docker-registry - cat ~/.aerokube/selenoid/browsers.json - set +e - mvn -s maven_settings.xml clean install -Dmaven.test.skip=true - mvn -s maven_settings.xml clean test || EXIT_CODE=$? - mvn -s maven_settings.xml allure:aggregate; - export PATH_WITHOUT_HOME=$(pwd | sed -e "s/\/home\/gitlab-runner\/builds//g") - echo '***********************************************************************' - echo "http://$HOSTNAME:9090$PATH_WITHOUT_HOME/target/site/allure-maven-plugin/" - echo '***********************************************************************' - set -e - exit ${EXIT_CODE}</code> </pre><br><p>  Nach der Zeile wird <code>echo "http://$HOSTNAME:9090$PATH_WITHOUT_HOME/target/site/allure-maven-plugin/"</code> </p><br><p>  Eine URL wird angezeigt, unter der Sie den Allure-Bericht anzeigen können. </p><br><p>  Um den Allure-Bericht anzuzeigen, muss Nginx mit dieser Konfiguration auf gitlab runner installiert sein: </p><br><pre> <code class="plaintext hljs">server { listen 9090; listen [::]:9090; server_name _; root /home/gitlab-runner/builds; location / { autoindex on; } error_page 404 /404.html; location = /40x.html { } error_page 500 502 503 504 /50x.html; location = /50x.html { } }</code> </pre> <br><p>  Screenshot von Allure Report </p><br><p><img src="https://habrastorage.org/webt/1a/nk/-v/1ank-vhxpxd1fc2mkoykry6f8ja.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de480940/">https://habr.com/ru/post/de480940/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de480926/index.html">Wahrscheinlichkeitstheorie für physikalisch genaues Rendern</a></li>
<li><a href="../de480928/index.html">Apache Hadoop Code Qualität: Produktion VS Test</a></li>
<li><a href="../de480930/index.html">Gib alles ein</a></li>
<li><a href="../de480936/index.html">Schnelle Konvertierung von UPPER_CASE nach camelCase</a></li>
<li><a href="../de480938/index.html">Kryptowährung aus Sicht russischer Richter</a></li>
<li><a href="../de480944/index.html">Top 5 Trends im E-Mail-Marketing im Jahr 2020</a></li>
<li><a href="../de480946/index.html">Protokolle in Kubernetes (und nicht nur) heute: Erwartungen und Realität</a></li>
<li><a href="../de480948/index.html">Mitap Marketing und PR in Ivanovo</a></li>
<li><a href="../de480950/index.html">Analyse des Android-Quiz vom Stand hh.ru auf der Mobius 2019 in Moskau</a></li>
<li><a href="../de480954/index.html">Aufgabennummer 1. Finden Sie Geschlecht und Verwandtschaftsgrad heraus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>