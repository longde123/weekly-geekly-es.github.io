<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§òüèΩ ‚úàÔ∏è üò© Kompresi penunjuk Java ü§¥üèø üòó üê°</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artikel ini akan membahas implementasi kompresi pointer di Java Virtual Machine 64-bit , yang dikendalikan oleh opsi UseCompressedOops dan diaktifkan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kompresi penunjuk Java</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/440166/"><img src="https://habrastorage.org/webt/co/jr/rf/cojrrf-lekmifni81uch0imua1m.png"><br><p>  Artikel ini akan membahas implementasi kompresi pointer di <strong>Java Virtual Machine 64-bit</strong> , yang dikendalikan oleh opsi <strong>UseCompressedOops</strong> dan diaktifkan secara default untuk sistem 64-bit yang dimulai dengan Java SE 6u23. </p><a name="habracut"></a><br><h1>  Deskripsi masalah </h1><br><p>  Dalam JVM 64-bit, pointer menempati ruang memori 2 kali lebih banyak (kejutan-kejutan) daripada 32-bit.  Ini dapat meningkatkan ukuran data sebesar 1,5 kali dibandingkan dengan kode yang sama untuk arsitektur 32-bit.  Pada saat yang sama, dalam arsitektur 32-bit, hanya 2 ^ 32 byte (4 GB) yang dapat diatasi, yang cukup kecil di dunia modern. </p><br><p>  Mari kita menulis sebuah program kecil dan melihat berapa banyak byte yang menempati objek Integer: </p><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.IntStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HeapTest</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String ... args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ Integer[] x = IntStream.range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1_000_000</span></span>).boxed().toArray(Integer[]::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>); Thread.sleep(<span class="hljs-number"><span class="hljs-number">6000000</span></span>); Stream.of(x).forEach(System.out::println); } }</code> </pre> <br><p>  Di sini kita menyoroti satu juta objek dari kelas Integer dan tertidur untuk waktu yang lama.  Baris terakhir diperlukan agar kompiler tidak tiba-tiba mengabaikan pembuatan array (meskipun pada mesin saya, objek dibuat secara normal tanpa baris ini). </p><br><p>  Kami mengkompilasi dan menjalankan program dengan kompresi pointer yang dinonaktifkan: </p><br><pre> <code class="plaintext hljs">&gt; javac HeapTest.java &gt; java -XX:-UseCompressedOops HeapTest</code> </pre> <br><p>  Menggunakan utilitas <strong>jcmd</strong> , <strong>kami</strong> melihat alokasi memori: </p><br><pre> <code class="plaintext hljs">&gt; jps 45236 HeapTest ... &gt; jcmd 45236 GC.class_histogram</code> </pre> <br><img src="https://habrastorage.org/webt/he/yd/y7/heydy7fyiamklkvz2ff9umu7fak.png"><br><p><br>  Gambar menunjukkan bahwa jumlah total objek adalah <strong>1000128</strong> , dan ukuran memori yang <strong>ditempati</strong> benda-benda ini <strong>adalah 24003072 byte</strong> .  Yaitu  <strong>24</strong> byte per objek (mengapa tepatnya 24 akan ditulis di bawah). </p><br><p>  Dan ini adalah memori dari program yang sama, tetapi dengan flag <strong>UseCompressedOops dihidupkan</strong> : </p><br><img src="https://habrastorage.org/webt/su/dj/5g/sudj5gdfm0i-apwneqfbskmgqc8.png"><br><p><br>  Sekarang setiap objek menempati <strong>16 byte</strong> . <br>  Keuntungan kompresi jelas =) </p><br><h1>  Solusi </h1><br><p>  Bagaimana JVM kompres pointer?  Teknik ini disebut <strong>Ups Terkompresi</strong> .  Oop singkatan dari <em>penunjuk objek biasa</em> atau <em>penunjuk objek biasa</em> . </p><br><p>  Kuncinya adalah bahwa dalam sistem 64-bit, data dalam memori selaras dengan kata mesin, mis.  Masing-masing 8 byte.  Dan alamat selalu memiliki tiga bit nol di akhir. </p><br><p>  Jika Anda menyimpan pointer dengan menggeser alamat dengan 3 bit ke kanan (operasi disebut <strong>encode</strong> ), dan sebelum menggunakan, menggeser oleh 3 bit ke kiri (masing-masing, <strong>decode</strong> ), maka Anda dapat memasukkan pointer 32-bit dengan ukuran <strong>35 bit</strong> , mis.  Alamat hingga <strong>32 GB</strong> (2 ^ 35 byte). </p><br><p>  Jika ukuran heap untuk program Anda lebih dari 32GB, maka kompresi berhenti bekerja dan semua pointer menjadi ukuran 8 byte. </p><br><p>  Ketika opsi <strong>UseCompressedOops</strong> diaktifkan, tipe pointer berikut dikompresi: </p><br><ul><li>  Bidang kelas untuk setiap objek </li><li>  Objek Lapangan Kelas </li><li>  Elemen array benda. </li></ul><br><p>  Objek JVM itu sendiri tidak pernah dikompresi.  Dalam hal ini, kompresi terjadi pada tingkat mesin virtual, dan bukan bytecode. </p><br><h1>  Baca lebih lanjut tentang menempatkan objek dalam memori </h1><br><p>  Sekarang, mari kita gunakan utilitas <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">jol (Layout Objek Java) untuk</a> melihat lebih dekat pada berapa banyak memori yang dibutuhkan Integer kami dalam JVM yang berbeda: </p><br><pre> <code class="plaintext hljs">&gt; java -jar jol-cli-0.9-full.jar estimates java.lang.Integer ***** 32-bit VM: ********************************************************** java.lang.Integer object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 8 (object header) N/A 8 4 int Integer.value N/A 12 4 (loss due to the next object alignment) Instance size: 16 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total ***** 64-bit VM: ********************************************************** java.lang.Integer object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 16 (object header) N/A 16 4 int Integer.value N/A 20 4 (loss due to the next object alignment) Instance size: 24 bytes Space losses: 0 bytes internal + 4 bytes external = 4 bytes total ***** 64-bit VM, compressed references enabled: *************************** java.lang.Integer object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 12 (object header) N/A 12 4 int Integer.value N/A Instance size: 16 bytes Space losses: 0 bytes internal + 0 bytes external = 0 bytes total ***** 64-bit VM, compressed references enabled, 16-byte align: ************ java.lang.Integer object internals: OFFSET SIZE TYPE DESCRIPTION VALUE 0 12 (object header) N/A 12 4 int Integer.value N/A Instance size: 16 bytes Space losses: 0 bytes internal + 0 bytes external = 0 bytes total</code> </pre><br><p>  Perbedaan antara "VM 64-bit" dan "VM 64-bit, referensi terkompresi diaktifkan" adalah untuk mengurangi <strong>header objek</strong> sebesar 4 byte.  Plus, dalam kasus tanpa kompresi, menjadi perlu untuk menambahkan 4 byte lebih banyak untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menyelaraskan data</a> dalam memori. </p><br><p>  Apa header objek ini?  Mengapa itu berkurang 4 byte? </p><br><img src="https://habrastorage.org/web/e2d/a4b/301/e2da4b30184a495c8e02dd1912539409.png"><br><p>  Gambar menunjukkan header objek sebesar 12 byte, mis.  dengan opsi UseCompressedOops diaktifkan.  Header terdiri dari beberapa flag JVM internal, serta pointer ke kelas objek ini.  Dapat dilihat bahwa pointer ke kelas membutuhkan 32 bit.  Tanpa kompresi, itu akan menempati 64 bit dan ukuran header objek sudah 16 byte. </p><br><p>  Omong-omong, Anda dapat melihat bahwa ada opsi lain untuk penyelarasan 16 byte.  Dalam hal ini, Anda dapat menambah memori hingga 64 GB. </p><br><h1>  Cons Kompresi Pointer </h1><br><p>  Pointer yang dikompresi, tentu saja, memiliki minus yang jelas - biaya operasi <strong>encode</strong> dan <strong>decode</strong> setiap kali pointer diakses.  Angka pastinya akan bervariasi berdasarkan aplikasi. </p><br><p>  Sebagai contoh, berikut ini adalah grafik dari pause collector pause untuk pointer terkompresi dan non-terkompresi, diambil dari sini <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Java GC in Numbers - Compressed OOPs</a> </p><br><img src="https://habrastorage.org/webt/gp/ki/2k/gpki2k7rbztm2xpycy_26nzt-1e.png"><br><p>  Dapat dilihat bahwa dengan kompresi dihidupkan, GC berhenti lebih lama.  Anda dapat membaca lebih lanjut tentang ini di artikel itu sendiri (artikel ini cukup tua - 2013). </p><br><p>  Referensi: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ups terkompresi di JVM Hotspot</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Bagaimana JVM mengalokasikan objek</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">CompressedOops: Pengantar referensi terkompresi di Jawa</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Trik di belakang Ups JVM terkompresi</a> <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Java HotSpot Peningkatan Kinerja Mesin Virtual</a> </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id440166/">https://habr.com/ru/post/id440166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id440152/index.html">Lehmann Linear DIY atau cara mengkloning bahasa Jerman asli dengan hasil yang baik</a></li>
<li><a href="../id440156/index.html">Bagaimana mengatur pengembangan terdistribusi, jika ini tidak mungkin</a></li>
<li><a href="../id440158/index.html">Statistik penjualan untuk kendaraan listrik dan hibrida yang dapat diisi ulang pada tahun 2018 (di AS dan di seluruh dunia)</a></li>
<li><a href="../id440162/index.html">Contoh jaringan saraf sederhana di C / C ++</a></li>
<li><a href="../id440164/index.html">Akankah monetisasi data pengguna menjadi tren di tahun 2019?</a></li>
<li><a href="../id440168/index.html">Laporan video dari FunTech ML-meetup</a></li>
<li><a href="../id440170/index.html">Analisis insiden yang terkait dengan serangan dunia maya pada proyek-proyek blockchain</a></li>
<li><a href="../id440172/index.html">CQRS: prinsip "divide and conquer" dalam pelayanan seorang programmer</a></li>
<li><a href="../id440174/index.html">Microsoft Q # Coding Contest - Winter 2019</a></li>
<li><a href="../id440176/index.html">Tujuh tren keamanan dunia maya untuk 2019</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>