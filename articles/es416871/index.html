<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®‚Äç‚ù§Ô∏è‚Äçüë® ü§ûüèΩ üí´ Estoy cansado de aceptar pagos a trav√©s de WebView. Que hago üí¨ üîõ üë©‚Äçüë©‚Äçüëß</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Voy a la oficina en tren. Necesito pasar por una estaci√≥n y ya casi estar√© all√≠. 

 Todas las ma√±anas compro boletos de tren en la aplicaci√≥n y sufro....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Estoy cansado de aceptar pagos a trav√©s de WebView. Que hago</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yamoney/blog/416871/">  Voy a la oficina en tren. Necesito pasar por una estaci√≥n y ya casi estar√© all√≠. <br><br>  Todas las ma√±anas compro boletos de tren en la aplicaci√≥n y sufro.  Es m√°s barato all√≠, pero la diferencia de precio no paga mi dolor cuando paso estos tres minutos de estr√©s.  Sin siquiera mencionar el tiempo de carga de cada una de las cinco pantallas de la aplicaci√≥n, uno no puede dejar de decir que depositar WebView con un mapa guardado, ingresar el c√≥digo de SMS en la ejecuci√≥n y fallas inesperadas. <br><br>  Esto es cuando corres en un tren y dicen "Algo sali√≥ mal" y cancelan el dinero, pero no dan un boleto.  All√≠ llega un regreso, pero el tren ya se ha ido.  Esto sucede un par de veces al mes, independientemente de la calidad de Internet.  No hay necesidad de hablar sobre acciones. <br><br><img src="https://habrastorage.org/webt/vk/cl/oz/vkclozwcg4inlgcwqn7equxs_hi.png"><br><br>  En este momento est√°s pensando: ¬øtal vez hay una manera m√°s simple?  Bueno, para no tener ninguna vista web, hermosa y nativa.  Y s√≠, existe tal forma.  Detalles debajo del corte. <br><a name="habracut"></a><br>  <b>tl; dr</b> Creamos una interfaz para aceptar pagos a trav√©s de Apple Pay, Google Pay, el banco m√≥vil Sberbank y Yandex.Money en iOS y Android.  No, no tiene que dibujar formularios de pago.  S√≠, tambi√©n es de c√≥digo abierto. <br><br>  En general, existen aproximadamente dos escenarios para aceptar pagos en aplicaciones m√≥viles. <br><br>  El primero es a trav√©s de un WebView con una p√°gina de pago.  Por lo tanto, puede aceptar pagos a trav√©s de una billetera, tarjeta bancaria, m√≥vil o cualquier otra cosa.  El problema es que WebView no tiene acceso a las cookies del navegador, lo que significa que no tiene autorizaci√≥n para algunos m√©todos de pago, por lo que no podr√° pagar. <br><br>  En el segundo escenario, el comerciante pasa los datos de la tarjeta a trav√©s de su backend; para esto debe cumplir con PCI DSS, que es costoso, largo y dif√≠cil. <br><br><h2>  SDK m√≥vil </h2><br>  El SDK m√≥vil de Yandex.Kassi es una biblioteca para iOS y Android que hemos creado para simplificar la vida de los comerciantes, desarrolladores de aplicaciones y aquellos que se preocupan por sus usuarios.  De hecho, el SDK m√≥vil es una herramienta para tokenizar tarjetas bancarias y otros instrumentos de pago.  La tokenizaci√≥n es el intercambio de datos que se necesita para realizar un pago por un identificador √∫nico: un token. <br><br>  En primavera, lanzamos la primera versi√≥n del SDK: se realiz√≥ el pago con tarjeta y desde la billetera Yandex.Money.  Ahora todo es a√∫n mejor: en la versi√≥n de julio agregaron Google Pay, Apple Pay y pagos a trav√©s de Sberbank con confirmaci√≥n por SMS. <br><br><h2>  Sobre los beneficios </h2><br><img src="https://habrastorage.org/webt/1v/pt/9y/1vpt9yly6mhhzyl8ncqv374pbki.gif" align="left">  El principal beneficio es que el comprador paga cualquier cosa, pero para un comerciante parece un token que se puede operar en lugar de datos de pago. <br><br>  Todav√≠a no es necesario aprobar la certificaci√≥n para el cumplimiento de PCI DSS: los datos de la tarjeta se procesar√°n en nuestro per√≠metro.  Cada a√±o pasamos por la certificaci√≥n, cumplimos con todas las reglas de los reguladores y eliminamos las tiendas que est√°n conectadas al Cajero.  Entonces es posible. <br><br>  Con el SDK, los pagos en Android e iOS parecen familiares para los usuarios, y ahora no necesitan abandonar el contexto de la aplicaci√≥n al momento del pago.  Aquellos que pagan desde una billetera electr√≥nica tampoco necesitan iniciar sesi√≥n: si el usuario ha iniciado sesi√≥n en la aplicaci√≥n Money, solo debe seleccionar la cuenta que necesita a trav√©s de Yandex.Passport. <br><br><h2>  ¬øC√≥mo empezar a usar en casa? </h2><br>  Si se debe generalizar por completo, entonces se deben hacer dos cosas: <br><br><ul><li>  Integrar la API de pago Yandex.Cash - para recibir pagos; </li><li>  Conecte el SDK m√≥vil: para tokenizaci√≥n e interfaz nativa. </li></ul><br>  Para agregar Apple Pay, es suficiente activar la aceptaci√≥n de pagos con tarjeta bancaria y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">emitir claves</a> en la cuenta de desarrollador de Apple. <br><br>  Google Pay es un poco diferente.  Necesita: <br><br><ol><li>  Prepare una compilaci√≥n de prueba de la APK. </li><li>  Complete la lista de verificaci√≥n de integraci√≥n: confirme que su aplicaci√≥n no se har√° cargo del mundo y algunas cosas m√°s. </li><li>  Rellene el ensamblaje para la verificaci√≥n en Google Pay. </li></ol><br>  Google verificar√° todo y permitir√° (o no permitir√°) publicar la aplicaci√≥n en Google Play. <br><br>  El SDK m√≥vil est√° integrado en la aplicaci√≥n del cliente para que los pagos nativos funcionen a trav√©s de √©l.  Funciona as√≠: los detalles de la tarjeta van directamente a nuestro per√≠metro PCI DSS, sin caer en el backend de la tienda.  Verificamos, procesamos y devolvemos al comerciante un token de pago con una vida √∫til de 30 minutos; puede usarse una vez. <br><br><img src="https://habrastorage.org/webt/i_/ys/q7/i_ysq7ohb0g2qmlcpstlkjduzzu.png"><br>  <i>Esquema de interacci√≥n de usuario, comerciante, SDK m√≥vil y API Ya.Kassa</i> <br><br>  Con la participaci√≥n de SDK, el pago consta de tres etapas: <br><br><ol><li>  Inicio del pago y recepci√≥n de un token.  La aplicaci√≥n inicia un pago a trav√©s del SDK y recibe un token de pago en la salida. </li><li>  Crea un pago.  El token va al servidor, que inicia el pago a trav√©s de la API. </li><li>  Solicitar estado de pago.  Esto es necesario para dibujar la ventana correcta con √©xito o errores. </li></ol><br><h4>  ¬øPor qu√© es eso bueno? </h4><br><ol><li>  La arquitectura es homog√©nea en diferentes escenarios de pago. </li><li>  No es necesario trabajar con una tarjeta de cr√©dito en el back-end de la tienda. </li></ol><br><h2>  Sobre desarrollo y pruebas </h2><br>  En la versi√≥n de iOS usamos VIPER y microservicios. <br><br>  El m√≥dulo de tokenizaci√≥n es la piedra angular del SDK m√≥vil: controla el proceso para que el comerciante vea solo el token para la salida de la API Yandex.Kassi, independientemente de lo que haya pagado el usuario.  Otro m√≥dulo de tokenizaci√≥n decide qu√© ventana mostrar al usuario ahora y realiza solicitudes POST al servidor.  Escribimos nuestro contenedor para la API para trabajar con solicitudes HTTP / HTTPS a YandexMoneyCoreApi, esto facilit√≥ la vida. <br><br>  Los servicios son almacenamientos y objetos que funcionan con la API del cliente Yandex.Kassi. <br>  Su c√≥digo result√≥ ser limpio y conciso, sin una gran cantidad de sucursales y salidas tempranas, porque el departamento de desarrollo logr√≥ pensar en toda la arquitectura por adelantado.  Los servicios del SDK tienen una cantidad concentrada de programaci√≥n funcional; aqu√≠ hemos revelado sus capacidades en su totalidad.  Donde tuvimos que trabajar con Functor, Monad, Fundador Aplicativo, Promise ordinario nos ayud√≥. <br><br><pre><code class="hljs pgsql">let <span class="hljs-keyword"><span class="hljs-keyword">method</span></span> = PaymentOptions.<span class="hljs-keyword"><span class="hljs-keyword">Method</span></span>(oauthToken: clientApplicationKey, passportAuthorization: passportToken, gatewayId: gatewayId, amount: amount, currency: currency) let paymentOptions = <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">perform</span></span>(apiMethod: <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>).responseApi() let allItems = getItems &lt;^&gt; paymentOptions let items = paymentMethodHandler.filterPaymentMethods &lt;^&gt; allItems let itemsWithEmptyError = items .recover(<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>(), mapError) .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(makeErrors) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> itemsWithEmptyError</code> </pre> <br>  La √∫nica dificultad surgi√≥ con VIPER: comenzamos a agregar nuevos tipos de pago y nos dimos cuenta de que el m√≥dulo central est√° creciendo r√°pidamente.  Cuando hab√≠a alrededor de 1000 l√≠neas, decidimos que ten√≠amos que hacer algo con esto y revisar la arquitectura. <br><br>  Nos gust√≥ la idea de un m√≥dulo central para el proceso, y decidimos dejarlo.  En otros proyectos, usamos una m√°quina de estados finitos determinista para describir el proceso, pero aqu√≠ no resolver√≠a los problemas, ya que la implementaci√≥n de muchas cosas permanecer√≠a en el mismo m√≥dulo.  As√≠ que decidimos aplicar el patr√≥n de "estrategia" para aislar los procesos de cada instrumento de pago.  Despu√©s de que el usuario haya seleccionado un m√©todo de pago, creamos una estrategia para el m√©todo de pago, que controla la tarjeta de transici√≥n y decide qu√© proceso se sigue. <br><br><h3>  Aplicaci√≥n de demostraci√≥n </h3><br><img src="https://habrastorage.org/webt/jq/dd/go/jqddgovdbutq7q1gijnex5do6ho.gif" align="left">  Lo logramos <br><br>  Todo comenz√≥ con el hecho de que el departamento de pruebas necesitaba algo para probar el SDK m√≥vil.  Sin una aplicaci√≥n de prueba, los chicos no pudieron verificar c√≥mo funciona el SDK, y no hubo desarrolladores para ambas plataformas entre los probadores. <br><br>  En el proceso, result√≥ que, adem√°s de las tareas de prueba, una aplicaci√≥n de demostraci√≥n es una buena manera de mostrar a nuestros socios qu√© es un SDK m√≥vil.  Cualquiera que no sepa programar en Swift o Kotlin (l√©ase: cualquier persona) puede ver c√≥mo funciona el SDK.  Por lo tanto, cargamos la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aplicaci√≥n de demostraci√≥n en Google Play</a> y la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://itms-services//%3Faction%3Ddownload-manifest%26url%3D">versi√≥n de iOS en el sitio web Yandex.Cash.</a> <br><br>  Result√≥ algo en lo que puedes ver c√≥mo funcionan los diferentes m√©todos de pago, jugar con la configuraci√≥n o mostr√°rselo a alguien responsable de elegir un agregador de pagos.  No seas t√≠mido <br><br><h2>  C√≥digo abierto </h2><br>  Unos meses despu√©s del lanzamiento, distribuimos la biblioteca de manera muy inc√≥moda: compartimos un enlace al sitio o enviamos archivos por correo.  Los buenos no hacen esto: publican todo en GitHub bajo la licencia MIT.  Entonces hicimos exactamente eso. <br><br>  Adem√°s de la magia de la tokenizaci√≥n, los comerciantes pueden personalizar los colores, cambiar los logotipos o realizar cualquier otro cambio en la biblioteca.  Y para hacerlo m√°s conveniente, publicamos un SDK m√≥vil en CocoaPods para desarrolladores de iOS y en Maven para chicos de Android. <br><br>  Si ya acepta pagos a trav√©s del Cajero, pero ahora desea hacerlo a√∫n mejor y de manera m√°s productiva, conecte el SDK m√≥vil.  Si solo est√° abriendo una tienda, conecte el Cajero.  Estamos bien <br><br><h2>  Enlaces utiles </h2><br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Biblioteca para aplicaciones m√≥viles</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">documentaci√≥n del SDK</a> <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">SDK para iOS</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Android</a> en GitHub. <br>  ‚Üí <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Maven</a> <br><br>  Eso es todo  ¬°Haz preguntas en los comentarios! </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es416871/">https://habr.com/ru/post/es416871/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es416857/index.html">Construimos templos, en c√≥digo y en la vida. Mi experiencia desarrollando mi segunda aplicaci√≥n de Android</a></li>
<li><a href="../es416859/index.html">Meet All at Once React Boilerplate por Maximilian Stoiber v3.6.0</a></li>
<li><a href="../es416863/index.html">Una nueva forma de presentar expositores</a></li>
<li><a href="../es416865/index.html">Dise√±o retro para la primera consola port√°til del lejano 1979</a></li>
<li><a href="../es416867/index.html">Los investigadores han creado un dispositivo para ataques locales en sistemas SCADA</a></li>
<li><a href="../es416877/index.html">Gesti√≥n de infraestructura de impresi√≥n</a></li>
<li><a href="../es416879/index.html">Oficina √°gil: ¬øD√≥nde alojar a mil desarrolladores?</a></li>
<li><a href="../es416881/index.html">Introducci√≥n a los contratos inteligentes. Sus limitaciones potenciales y reales.</a></li>
<li><a href="../es416883/index.html">C√≥mo escrib√≠ mi Postcrossing</a></li>
<li><a href="../es416885/index.html">El servicio de acondicionamiento f√≠sico nuevamente "entreg√≥ todas las apariencias" de los servicios gubernamentales, militares y especiales</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>