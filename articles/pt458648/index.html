<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§ûüèæ üêΩ üò∂ CI / CD com AWS e Bamboo üö§ ü¶Ü ‚ô£Ô∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nossa equipe √© composta por um desenvolvedor e um engenheiro de DevOps. Sou respons√°vel pela implanta√ß√£o do aplicativo no cluster Amazon ECS. Como ser...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>CI / CD com AWS e Bamboo</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/icl_services/blog/458648/">  Nossa equipe √© composta por um desenvolvedor e um engenheiro de DevOps.  Sou respons√°vel pela implanta√ß√£o do aplicativo no cluster Amazon ECS.  Como servidor de CI / CD, eu uso o Bamboo.  Neste artigo, descreverei em detalhes como implanto um aplicativo em um ambiente de desenvolvimento. <br><br><img src="https://habrastorage.org/webt/cn/bu/3w/cnbu3wmmjkhiqhwgxpuhk3pu2fc.png"><br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/ev/oz/rs/evozrsbpwhmgd0zodgrz4pukurm.png"><br><br><h4>  Criar uma imagem do Docker </h4><br>  Aqui eu sigo estas etapas: <br><br><ul><li>  Etapa 1: instalar e configurar o Docker; </li><li>  Etapa 2: configurar artefatos no Bamboo; </li><li>  Etapa 3: configurar o reposit√≥rio Amazon ECR; </li><li>  Etapa 4: crie a imagem do Docker no Bamboo. </li></ul><br><h1>  Etapa 1: Instalar e configurar o Docker </h1><br>  Primeiro, atualizo o servidor em que o Bamboo est√° instalado, instalo os pacotes necess√°rios e configuro o reposit√≥rio do Docker.  Observe que eu instalei o Bamboo no sistema operacional CentOS 7. Informa√ß√µes sobre a instala√ß√£o do docker em outros sistemas operacionais podem ser encontradas em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">www.docker.com</a> . <br><br><pre><code class="plaintext hljs">$ sudo yum update $ sudo yum install -y yum-utils device-mapper-persistent-data lvm2 $ sudo yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</code> </pre> <br>  Em seguida, instalo o aplicativo Docker e inicio o servi√ßo: <br><br><pre> <code class="plaintext hljs">$ sudo yum install docker-ce docker-ce-cli containerd.io $ sudo systemctl enable docker $ sudo systemctl start docker</code> </pre><br>  Em seguida, adiciono o usu√°rio de bambu ao grupo Docker: <br><br><pre> <code class="plaintext hljs">$ sudo usermod -aG docker bamboo $ sudo su - bamboo $ docker run hello-world</code> </pre><br>  Se, depois de executar esses comandos, o docker responder com a mensagem "Hello from Docker!", Isso significa que minha instala√ß√£o est√° funcionando corretamente. <br><br><h1>  Etapa 2. Configurar artefatos no Bamboo </h1><br>  O desenvolvimento de aplicativos est√° em andamento na <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Grails</a> .  Ao compilar o aplicativo, um arquivo com a extens√£o war √© criado.  Esse arquivo, na terminologia Bamboo, √© um artefato.  Configure o Bamboo para usar este arquivo nas tarefas subseq√ºentes.  Para fazer isso, vou para a guia <b>Tarefas</b> : <br><br><img src="https://habrastorage.org/webt/l2/xf/rh/l2xfrhlwvte_3enperkvbqadtey.png"><br><br>  E eu configurei a tarefa Grails, como mostrado abaixo: <br><br><img src="https://habrastorage.org/webt/ba/6l/s7/ba6ls73snayld5eazip7mcc0eg4.png"><br><br>  Vemos que o Grails limpa primeiro a pasta de compila√ß√£o, depois executa os testes e, finalmente, cria um arquivo de guerra para o ambiente de desenvolvimento. <br><br>  Depois disso, clico na guia <b>Artefatos</b> e no bot√£o <b>Criar artefato</b> : <br><br><img src="https://habrastorage.org/webt/2a/sj/am/2asjam033lqmwc9txcj_slq_5jc.png"><br><br>  Eu defino um artefato como mostrado abaixo: <br><br><img src="https://habrastorage.org/webt/jw/_b/wb/jw_bwbdddrwx1pa1gh7etxonvys.png"><br><br>  Grails coloca o arquivo war no diret√≥rio <b>build / libs</b> .  Vou verificar o par√¢metro <b>Shared</b> , pois precisarei desse artefato mais tarde. <br><br>  Agora estou criando um projeto de implanta√ß√£o e especificando um artefato para usar no meu plano de constru√ß√£o: <br><br><img src="https://habrastorage.org/webt/y7/fs/uf/y7fsufkg7rsi-6d3i-hfk8o6rlc.png"><br><br><img src="https://habrastorage.org/webt/s7/nf/tu/s7nftu9r8vwudgjzi1qdtlaljpw.png"><br><br>  Tamb√©m configurei a tarefa de <b>download de artefato</b> no projeto de implanta√ß√£o: <br><br><img src="https://habrastorage.org/webt/ie/vv/uv/ievvuvkegkneya15tqd9xlcayhu.png"><br><br>  Portanto, o Bamboo agora est√° configurado para usar um arquivo war. <br><br><h1>  Etapa 3. Configure o reposit√≥rio Amazon ECR </h1><br>  O Amazon ECR √© um servi√ßo de armazenamento e gerenciamento do Docker para imagens.  Para configurar, abra o console da AWS e selecione ECR: <br><br><img src="https://habrastorage.org/webt/ys/fd/1i/ysfd1ijutkdnzcugeldnemvywl4.png"><br><br>  Depois de criar o reposit√≥rio, recebo o seguinte endere√ßo: <br><br><pre> <code class="plaintext hljs">aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard</code> </pre><br>  Depois de concluir a configura√ß√£o, aqui tamb√©m √© poss√≠vel encontrar instru√ß√µes sobre como efetuar login, como baixar uma imagem do reposit√≥rio e fazer upload da imagem no reposit√≥rio. <br><br><h1>  Etapa 4: criar a imagem do Docker em bambu </h1><br>  Agora preciso configurar o gatilho para come√ßar a criar a imagem do Docker.  Para fazer isso, vou para a guia <b>Triggers</b> e clique no bot√£o <b>Add trigger</b> : <br><br><img src="https://habrastorage.org/webt/ev/gq/nu/evgqnu95-my1ralvlnxrw6tx3fe.png"><br><br>  Aqui, seleciono a op√ß√£o <b>Compilar ap√≥s criar com √™xito o plano,</b> para que a imagem do Docker seja criada ap√≥s a compila√ß√£o do projeto. <br><br>  Agora precisamos adicionar a tarefa de cria√ß√£o de imagem do Docker.  Para fazer isso, v√° para a guia <b>Tarefas</b> , clique em <b>Adicionar tarefa</b> , selecione o tipo de <b>Docker</b> .  Digite uma descri√ß√£o e selecione <b>Construir uma imagem</b> do <b>Docker</b> no menu suspenso.  No campo <b>Reposit√≥rio</b> , insira <br><br><pre> <code class="plaintext hljs"> aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest.</code> </pre><br>  Quanto ao Dockerfile, pode ser como mostrado abaixo: <br><br><pre> <code class="plaintext hljs">FROM openjdk:8-jre COPY *.war /usr/src/onboard.war WORKDIR /usr/src CMD ["/bin/bash", "-c", "java -DdataSource.url=$DATASOURCE_URL -DdataSource.username=$DATASOURCE_USERNAME -DdataSource.password=$DATASOURCE_PASSWORD -jar onboard.war"]</code> </pre><br>  Ao iniciar o aplicativo, voc√™ deve especificar o banco de dados.  As vari√°veis ‚Äã‚Äãde ambiente DATASOURCE_URL, DATASOURCE_USERNAME, DATASOURCE_PASSWORD s√£o usadas para transmitir essas informa√ß√µes ao aplicativo, mas seus valores s√£o definidos quando o cont√™iner √© iniciado. <br><br>  Isso conclui o processo de instala√ß√£o para montar a imagem do Docker com o aplicativo.  A pr√≥xima etapa √© configurar o download desta imagem no reposit√≥rio do Amazon ECR. <br><br><img src="https://habrastorage.org/webt/yx/n_/3t/yxn_3t_bqhvr2azfbyaywzadhpe.png"><br><br><h4>  Carregar imagem no Elastic Container Registry </h4><br>  Voc√™ pode usar o Elastic Container Registry para armazenar imagens coletadas usando o Bamboo.  Para conseguir isso, sigo estas etapas: <br><br><ul><li>  Etapa 1. Instale o Auxiliar de credencial do Amazon ECR Docker </li><li>  Etapa 2. Conecte a fun√ß√£o IAM ao servidor Bamboo </li><li>  Etapa 3: configurar a tarefa de inicializa√ß√£o da imagem do Docker </li></ul><br><h1>  Etapa 1. Instale o Auxiliar de credencial do Amazon ECR Docker </h1><br>  Para baixar imagens do Docker para o Amazon ECR, √© necess√°rio ter credenciais.  Essas credenciais podem ser obtidas executando o comando <br><br><pre> <code class="plaintext hljs">aws ecr get-login</code> </pre><br>  No entanto, essas credenciais s√£o v√°lidas apenas por 12 horas.  Portanto, voc√™ pode executar o comando acima toda vez antes de carregar a imagem no ECR ou instalar o ECR Docker Credential Helper, que mant√©m as credenciais tempor√°rias atualizadas e efetua login no ECR.  Siga estas etapas para instalar o ECR Docker Credential Helper. <br><br>  Primeiro voc√™ precisa instalar o <i>git</i> e depois clonar o reposit√≥rio do github: <br><br><pre> <code class="plaintext hljs">$ sudo yum install git $ sudo su - bamboo $ git clone https://github.com/awslabs/amazon-ecr-credential-helper.git $ make docker</code> </pre><br>  Ent√£o voc√™ precisa colocar as seguintes linhas no arquivo <i>/home/bamboo/.docker/config.json</i> : <br><br><pre> <code class="plaintext hljs">{ "credsStore": "ecr-login" }</code> </pre><br>  E copie o aplicativo compilado no <i>diret√≥rio / usr / bin</i> : <br><br><pre> <code class="plaintext hljs">$ exit $ sudo cp /home/bamboo/docker-credential-ecr-login /usr/bin/</code> </pre><br><h1>  Etapa 2. Conecte a fun√ß√£o IAM ao servidor Bamboo </h1><br>  Para que o servidor Bamboo possa usar o ECR, voc√™ precisa criar uma fun√ß√£o, adicionar a pol√≠tica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AmazonEC2ContainerRegistryPowerUser</a> a essa fun√ß√£o e anexar essa fun√ß√£o √† inst√¢ncia do EC2 Bamboo.  Abra o console da AWS e selecione IAM.  Em seguida, clique no bot√£o <b>Criar fun√ß√£o</b> , selecione <b>Servi√ßo da AWS</b> e <b>EC2</b> , conforme mostrado abaixo: <br><br><img src="https://habrastorage.org/webt/1o/vs/jf/1ovsjfchxa3p-bgv4y-6unnz8sk.png"><br><br>  Em seguida, clicamos no bot√£o <b>Avan√ßar: permiss√µes</b> e, na pr√≥xima tela, encontramos e selecionamos a pol√≠tica <b>AmazonEC2ContainerRegistryPowerUser</b> .  Depois disso, terminamos de criar a fun√ß√£o e a anexamos ao nosso servidor Bamboo. <br><br><h1>  Etapa 3: configurar a tarefa de inicializa√ß√£o da imagem do Docker </h1><br>  O aplicativo que criamos e montamos uma imagem do Docker com um arquivo de guerra.  Agora voc√™ precisa fazer o upload desta imagem no reposit√≥rio.  Para fazer isso, adiciono outra tarefa do Docker, desta vez para carregar a imagem no reposit√≥rio do ECR.  Vou para a guia <b>Tarefas</b> , clique em <b>Adicionar tarefa</b> , selecione o tipo de <b>Docker</b> .  Entro em uma descri√ß√£o e selecione <b>Enviar uma imagem do Docker para um registro</b> do <b>Docker</b> no menu suspenso.  Seleciono <b>Registro personalizado</b> e insiro o endere√ßo do <b>reposit√≥rio no</b> campo <b>Reposit√≥rio</b> .  Para o <b>tipo de autentica√ß√£o,</b> selecione <b>Usar credenciais nativas do agente</b> . <br><br>  Isso conclui o processo de instala√ß√£o para carregar a imagem do Docker no reposit√≥rio do Amazon ECR.  As etapas a seguir descrevem o processo de configura√ß√£o de um cluster e servi√ßo para iniciar um aplicativo de cont√™iner.  Mas antes disso, voc√™ precisa configurar as op√ß√µes de inicializa√ß√£o para o cont√™iner.  √â isso que faremos agora. <br><br><img src="https://habrastorage.org/webt/f7/ku/os/f7kuosux7wvkojanpgoy8zd7wya.png"><br><br><h4>  Criar defini√ß√£o de tarefa do Amazon ECS </h4><br>  Defini√ß√£o da tarefa - os par√¢metros de execu√ß√£o do cont√™iner s√£o gravados aqui.  Nosso aplicativo usa um banco de dados cujos par√¢metros s√£o especificados quando o cont√™iner inicia, portanto nesta se√ß√£o tamb√©m criaremos um banco de dados.  Uso o <b>Amazon RDS</b> como banco de dados e guardo a senha para acessar o banco de dados em formato criptografado no <b>AWS Systems Manager Parameter Store</b> .  As etapas a seguir, seguidas para criar uma defini√ß√£o de tarefa: <br><br><ul><li>  Etapa 1. Criando um banco de dados em uma inst√¢ncia do Amazon RDS; </li><li>  Etapa 2. Configurando o armazenamento de par√¢metros do AWS Systems Manager; </li><li>  Etapa 3. Crie uma defini√ß√£o de tarefa. </li></ul><br><h1>  Etapa 1. Crie um banco de dados em uma inst√¢ncia do Amazon RDS </h1><br>  Nosso aplicativo usa o banco de dados PostgreSQL.  Para criar um banco de dados, abra o console da AWS, selecione o servi√ßo Amazon RDS, clique no bot√£o <b>Criar banco de dados</b> e selecione <b>PostgreSQL</b> como o mecanismo de banco de dados.  Na pr√≥xima p√°gina, selecione <b>Dev / Test</b> como o ambiente de trabalho e clique em <b>Avan√ßar</b> .  Em seguida, <b>designo o</b> <b>identificador da inst√¢ncia do banco de dados como onboard-dev-db</b> e o <b>nome de usu√°rio mestre</b> como <b>devdbadmin</b> .  Depois, vou para a pr√≥xima p√°gina para configurar a VPC, o grupo de sub-rede e o grupo de seguran√ßa.  Esse banco de dados ser√° usado em uma rede privada, portanto, seleciono <b>N√£o</b> para o par√¢metro <b>Acessibilidade p√∫blica</b> .  <b>Entro devdb</b> no <b>campo</b> <b>Nome</b> do <b>banco de dados</b> e clique no bot√£o <b>Criar banco de dados</b> . <br><br><h1>  Etapa 2. Configurando o armazenamento de par√¢metros do AWS Systems Manager </h1><br>  Eu guardo a senha do banco de dados em forma criptografada.  Para fazer isso, abra o console da AWS e v√° para AWS Systems Manager ‚Üí Recursos compartilhados ‚Üí Armazenamento de par√¢metros ‚Üí Criar par√¢metro.  <b>Entro devdbpassword</b> como o <b>nome</b> do par√¢metro e seleciono <b>SecureString</b> para o tipo de par√¢metro, depois digito a senha do banco de dados no campo <b>Valor</b> . <br><br><h1>  Etapa 3. Criar defini√ß√£o de tarefa </h1><br>  O Amazon ECS √© o cluster em que os aplicativos de cont√™iner s√£o executados.  Ele usa a Defini√ß√£o de tarefa para especificar par√¢metros de execu√ß√£o para um aplicativo de cont√™iner.  Para definir esses par√¢metros, clique no bot√£o <b>Criar nova defini√ß√£o de tarefa</b> .  Depois, seleciono <b>Fargate</b> como o <b>tipo de</b> inicializa√ß√£o e <b>prossigo</b> para a pr√≥xima etapa.  Aqui, defino o nome como <b>onboard-dev-taskdef</b> .  Para o par√¢metro do <b>campo de fun√ß√£o IAM de execu√ß√£o de tarefas</b> , selecione <b>Criar nova fun√ß√£o</b> .  Quanto aos recursos alocados para este aplicativo, designo 2 GB de mem√≥ria e 1 vCPU.  Agora voc√™ precisa adicionar op√ß√µes de inicializa√ß√£o de cont√™iner.  Vou nomear o cont√™iner <b>onboard-dev-container</b> .  Vou nomear o nome da imagem assim: <br><br>  <i>aws_account_id.dkr.ecr.us-east-2.amazonaws.com/onboard:latest</i> .  O Auxiliar de credencial do Amazon ECR Docker cuidar√° da autentica√ß√£o de ECR; portanto, deixo a op√ß√£o de <b>autentica√ß√£o de reposit√≥rio particular</b> desmarcada.  No ambiente de desenvolvimento, o aplicativo est√° dispon√≠vel na porta 8080, portanto, para o par√¢metro de mapeamentos de portas, escrevo <b>8080</b> e seleciono o protocolo <b>tcp</b> .  Os par√¢metros de URL do banco de dados, nome de usu√°rio e senha s√£o passados ‚Äã‚Äãpara o cont√™iner usando vari√°veis ‚Äã‚Äãde ambiente.  Defino esses par√¢metros na se√ß√£o Vari√°veis ‚Äã‚Äãde ambiente.  Para obter o valor do par√¢metro <b>devdbpassword</b> do Parameter Store, especifique o tipo <b>ValueFrom</b> .  A √∫ltima coisa que eu configuro √© a configura√ß√£o de <b>log</b> , aqui seleciono <b>Configurar automaticamente os logs do CloudWatch</b> .  Agora a cria√ß√£o da defini√ß√£o de tarefa est√° conclu√≠da. <br><br>  No entanto, a fun√ß√£o ecsTaskExecutionRole precisa de uma pol√≠tica para obter devdbpassword do Armazenamento de Par√¢metros.  Para fazer isso, acesse Fun√ß√µes do IAM e selecione ecsTaskExecutionRole, clique em <b>Adicionar pol√≠tica embutida</b> .  Neste caso, estou adicionando usando um editor visual.  Portanto, no campo Servi√ßo, insiro o <b>Systems Manager</b> , no campo A√ß√µes - <b>GetParameters</b> .  Em seguida, clique em <b>Adicionar ARN</b> para o campo Recursos e preencha meus valores: <br><br><img src="https://habrastorage.org/webt/2j/wd/6r/2jwd6r5dpp41jbjj4g7gctfeafw.png"><br><br>  No final, eu olho para os valores dos par√¢metros definidos clicando em Pol√≠tica de Revis√£o, atribua um nome e termine de trabalhar com a configura√ß√£o ecsTaskExecutionRole. <br><br>  Isso conclui a configura√ß√£o das configura√ß√µes do aplicativo de cont√™iner de inicializa√ß√£o.  Agora voc√™ precisa criar um cluster e servi√ßo ECS. <br><br><img src="https://habrastorage.org/webt/0k/u7/xn/0ku7xnp7bctypewbbcwyzdda_-y.png"><br><br><h4>  Criar servi√ßo Amazon ECS </h4><br>  Nosso aplicativo de cont√™iner √© executado como um servi√ßo em um cluster ECS.  Para configurar, voc√™ deve executar as seguintes etapas: <br><br><ul><li>  Etapa 1. Crie um cluster do Amazon ECS; </li><li>  Etapa 2: Criando um Servi√ßo </li></ul><br><h1>  Etapa 1. Crie um cluster do Amazon ECS </h1><br>  Para criar um cluster ECS, acesse o console da AWS e selecione o servi√ßo ECS.  Em seguida, clique em <b>Criar cluster</b> e selecione o modelo de cluster <b>Somente para rede</b> .  Na pr√≥xima p√°gina, nomeio o cluster como <b>onboard-dev-cluster</b> e concluo o cluster.  Agora eu tenho um cluster ECS baseado em <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Fargate</a> . <br><br><h1>  Etapa 2: Criando um Servi√ßo </h1><br>  Para criar um servi√ßo, clique no link <b>onboard-dev-cluster</b> , depois v√° para a guia <b>Servi√ßos</b> e clique no bot√£o <b>Criar</b> .  Para <b>o tipo de inicializa√ß√£o,</b> selecione Fargate, para <b>Defini√ß√£o da tarefa,</b> selecione onboard-dev-taskdef.  Al√©m disso, seleciono onboard-dev-cluster no campo Cluster.  No campo <b>Nome</b> do <b>servi√ßo</b> , escrevo onboard-dev.  Defino o par√¢metro <b>N√∫mero de tarefas</b> como zero, pois n√£o quero iniciar o aplicativo agora.  Deixo os par√¢metros <b>Porcentagem M√≠nima Saud√°vel</b> para 100 e <b>Porcentagem M√°xima</b> para 200. Para o par√¢metro <b>Tipo de implanta√ß√£o</b> , selecione <b>Atualiza√ß√£o sem interrup√ß√£o</b> e v√° para a pr√≥xima etapa. <br><br>  Na p√°gina <b>Configurar Rede</b> , para o par√¢metro <b>Cluster VPC</b> , seleciono um VPC criado anteriormente chamado <b>Development VPC</b> .  O aplicativo em desenvolvimento est√° dispon√≠vel apenas na rede privada, por isso escolhi duas sub-redes privadas.  Para configurar grupos de seguran√ßa, clique no bot√£o <b>Editar</b> , selecione <b>Selecionar grupo de seguran√ßa existente</b> , depois no grupo de seguran√ßa <b>padr√£o</b> e clique no bot√£o <b>Salvar</b> .  Para o par√¢metro <b>IP p√∫blico de atribui√ß√£o autom√°tica</b> , selecione <b>Desativado</b> .  Em seguida, para o par√¢metro <b>Tipo de balanceador de carga</b> , seleciono <b>Nenhum</b> e deixo a op√ß√£o <b>Ativar integra√ß√£o de descoberta de servi√ßo desmarcada</b> .  Em seguida, clique em <b>Avan√ßar, Avan√ßar</b> e <b>Criar servi√ßo</b> . <br><br>  Agora eu tenho um servi√ßo no qual o n√∫mero de trabalhos em execu√ß√£o √© zero.  Vamos configurar o lan√ßamento do aplicativo na pr√≥xima etapa. <br><br><img src="https://habrastorage.org/webt/dg/_9/er/dg_9er1txnjnjbhpkrcmn5af4lk.png"><br><br><h4>  Atualiza√ß√£o de Servi√ßo </h4><br>  Assim que o desenvolvedor atualiza o c√≥digo do aplicativo, nossa implanta√ß√£o passa pela cria√ß√£o de uma imagem do Docker, pelo upload no Elastic Container Registry e, finalmente, pelo lan√ßamento do aplicativo de cont√™iner como um servi√ßo no cluster do ECS Fargate.  No momento, o n√∫mero de trabalhos em execu√ß√£o no cluster √© zero.  Para que o aplicativo inicie, voc√™ precisa atualizar o servi√ßo, indicando a quantidade igual a um.  Eu sigo estas etapas para conseguir isso: <br><br><ul><li>  Etapa 1. Instalando o plug-in Tarefas para o AWS Bamboo; </li><li>  Etapa 2. Atualizando o servi√ßo ECS </li></ul><br><h1>  Etapa 1. Instalando o plug-in Tarefas para o AWS Bamboo </h1><br>  <b>Tarefas para o AWS Bamboo</b> √© um plug-in que simplifica a prepara√ß√£o e opera√ß√£o dos recursos da AWS nos projetos de constru√ß√£o e implanta√ß√£o do Bamboo.  Para instalar esse plug-in, vou ao projeto de implanta√ß√£o, clique em <b>Adicionar tarefa</b> , v√° ao Atlassian Marketplace e instale o <b>Tasks for AWS (Bamboo)</b> . <br><br><h1>  Etapa 2. Atualizando o servi√ßo ECS </h1><br>  Agora, no projeto de implanta√ß√£o, estou adicionando o trabalho do <b>Amazon ECS Service</b> .  Depois, escrevo no campo de descri√ß√£o do trabalho <b>Update Service para onBoard-dev</b> .  No campo A√ß√£o, selecione <b>Servi√ßo de atualiza√ß√£o</b> e <b>For√ßar nova implanta√ß√£o</b> .  Depois, seleciono Leste dos EUA (Ohio) como regi√£o de lan√ßamento.  Depois, escrevo nos campos apropriados ARN (Amazon Resource Name) para defini√ß√£o de tarefas, cluster e servi√ßo.  Nesta tarefa, atualizo o n√∫mero desejado de tarefas em execu√ß√£o para um.  Em seguida, preencho a caixa de texto de configura√ß√£o de implanta√ß√£o com os seguintes valores: <br><br><pre> <code class="plaintext hljs">{ "maximumPercent": 200, "minimumHealthyPercent": 100 }</code> </pre><br>  Estou configurando uma rede sem um IP p√∫blico da seguinte maneira: <br><br><pre> <code class="plaintext hljs">{ "awsvpcConfiguration": { "assignPublicIp": "DISABLED", "subnets": ["subnet-ID1", "subnet-ID2"], "securityGroups": ["sg-ID"] } }</code> </pre><br>  Na se√ß√£o <b>Origem</b> das <b>credenciais de seguran√ßa da AWS,</b> seleciono <b>Fun√ß√£o do IAM para EC2</b> . <br><br>  Preciso poder atualizar o ECS, por isso estou anexando a pol√≠tica <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">AmazonECS_FullAccess</a> √† minha inst√¢ncia do Bamboo EC2.  Para fazer isso, abra o console da AWS, selecione IAM.  Depois, seleciono a fun√ß√£o que uso no meu servidor Bamboo.  Clico no bot√£o <b>Anexar pol√≠ticas</b> , encontro a pol√≠tica AmazonECS_FullAccess, seleciono a caixa de sele√ß√£o √† esquerda e termino de anexar a pol√≠tica. <br><br>  Isso conclui a configura√ß√£o do CI / CD usando o AWS e o Bamboo.  Assim, quando o desenvolvedor atualiza o c√≥digo do aplicativo, ele √© carregado no reposit√≥rio, o teste e a montagem do aplicativo s√£o iniciados.  Em seguida, a imagem do Docker √© criada com o arquivo war do aplicativo e √© copiada para o reposit√≥rio do Amazon ECR.  Em seguida, no cluster Amazon ECS, um aplicativo de cont√™iner √© iniciado como um servi√ßo, que atualiza o aplicativo atual se n√£o tiver sido parado.  Se o aplicativo foi parado para economizar recursos, ele simplesmente √© iniciado.  Ap√≥s verificar o aplicativo no ambiente de desenvolvimento, √© poss√≠vel parar o aplicativo especificando o n√∫mero de tarefas em execu√ß√£o no cluster para zero. <br><br>  Se voc√™ gostou do artigo e tem id√©ias para melhorias, escreva nos coment√°rios. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt458648/">https://habr.com/ru/post/pt458648/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt458636/index.html">V√≠deos do mitap DevLeads do escrit√≥rio Tutu.ru</a></li>
<li><a href="../pt458638/index.html">Projeto Intel oneAPI: muitas arquiteturas, uma API</a></li>
<li><a href="../pt458640/index.html">Encontrando um longo tra√ßo</a></li>
<li><a href="../pt458642/index.html">Teoria em vez de heur√≠stica: melhorando como desenvolvedores de front-end</a></li>
<li><a href="../pt458646/index.html">Swaps at√¥micos em poucas palavras</a></li>
<li><a href="../pt458650/index.html">Desafio cibern√©tico. Um novo n√≠vel. Competi√ß√£o online da Rostelecom Solar</a></li>
<li><a href="../pt458652/index.html">RamblerFront & Meetup # 7</a></li>
<li><a href="../pt458654/index.html">O v√≠rus Lurk invadiu os bancos enquanto era escrito por trabalhadores contratados comuns</a></li>
<li><a href="../pt458658/index.html">Mudando de m√°quinas virtuais para cont√™ineres LXC: raz√µes, vantagens e instru√ß√µes prontas para uso</a></li>
<li><a href="../pt458660/index.html">A implanta√ß√£o malsucedida de software falha o servi√ßo Cloudflare</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>