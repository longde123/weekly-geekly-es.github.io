<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üêÖ üîª üåæ ¬°Uno, dos, tres! Chatbot de Google Sheets usando el ejemplo de un juego PvP para Alice üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë® ‚úäüèº üë®üèº‚Äç‚öïÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Apareciendo, Alice cautiv√≥ a los usuarios con s√≠ntesis de voz inesperadamente de alta calidad y chat bot. Hoy, se espera que tenga habilidades √∫tiles ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>¬°Uno, dos, tres! Chatbot de Google Sheets usando el ejemplo de un juego PvP para Alice</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/414213/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/je/rg/em/jergemafxw-e_63-gibe4edxyie.png"></div><br>  Apareciendo, Alice cautiv√≥ a los usuarios con s√≠ntesis de voz inesperadamente de alta calidad y chat bot.  Hoy, se espera que tenga habilidades √∫tiles y juegos interesantes con un backend que pueda tener en cuenta el contexto del usuario e implementar una amplia gama de escenarios.  Este art√≠culo analiza la creaci√≥n de una habilidad basada en Google Sheets, una herramienta familiar para muchos con gran potencial para peque√±os chatbots. <br><br>  Jugar con una persona real puede ser m√°s interesante que jugar con un personaje virtual, por lo que, como ejemplo, desarrollaremos un juego multijugador para Alice. <br><a name="habracut"></a><br><h2>  Uno!  Di√°logo </h2><br>  El juego comienza con las reglas.  Se me ocurri√≥ esto: cada uno de los dos jugadores coloca primero un tesoro y una trampa detr√°s de tres puertas, y luego abre cualquiera de las puertas del oponente.  Abre el tesoro, toma las monedas del oponente, abre la trampa, dale las monedas.  El n√∫mero de monedas, de 1 a 3, lo determina el propio jugador.  Detr√°s de la puerta restante hay una caja de Pandora, que se abre y puedes encontrar / perder una cantidad aleatoria de monedas.  Puedes jugar tanto con Alice como contra otros usuarios. <br><br>  La interfaz de Alice se resuelve en forma de di√°logo, y toda la interacci√≥n del juego debe implementarse a trav√©s de mensajes.  El procesamiento de cada mensaje por parte del servidor del juego se representa mediante los siguientes pasos: <br><br><ol><li>  restaurar el contexto del usuario; </li><li>  interpretaci√≥n de consultas en un contexto restaurado; </li><li>  formando un mensaje de respuesta; </li><li>  Guardar un contexto de usuario modificado. </li></ol><br><h3>  Recuperar y guardar el contexto del usuario. </h3><br>  El contexto del usuario incluye su estado en el juego, incluidos los resultados anteriores, un paso dentro del gui√≥n y el oponente actual, as√≠ como el nombre de usuario y otra informaci√≥n necesaria para la l√≥gica del juego. <br><br>  En cada solicitud, de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">acuerdo con el protocolo</a> , Alice pasa la identificaci√≥n de usuario.  Esto es suficiente para guardar y posteriormente restaurar su contexto. <br><br>  Como almac√©n de datos, tome Hojas de c√°lculo de Google.  Las ventajas objetivas de esta soluci√≥n incluyen el uso gratuito, la visibilidad y la facilidad de uso.  El editor de scripts incorporado le permite describir la l√≥gica del juego en Apps Script (basado en JavaScript), haciendo referencia a las tablas API, y publicarlo como una aplicaci√≥n web. <br><br>  Una vez creada la tabla con los encabezados necesarios, puede ir al editor de scripts: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/jd/rh/bo/jdrhbosnzge_mq5ms5h0oqnsnqo.png"></div><br>  La l√≥gica del juego se puede describir en un proyecto en Apps Script, organiz√°ndolo como un conjunto de archivos gs, y proceder a la publicaci√≥n: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/nk/w0/kn/nkw0kn0ghmmskohgbtk_nefgc3o.png"></div><br>  Al publicar, debe especificar la disponibilidad de la aplicaci√≥n para usuarios an√≥nimos: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/g1/sw/fq/g1swfqcp998ufhh96b6lvqb64x0.png"></div><br>  En la salida, obtendr√° la URL de la aplicaci√≥n web publicada.  Las funciones doGet () y doPost () en el script procesar√°n las solicitudes de los tipos correspondientes para recibir y guardar contextos de usuario. <br><br>  A continuaci√≥n se muestra un diagrama de trabajo con las tablas API para la manipulaci√≥n de datos: <br><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  var sheet = SpreadsheetApp.openById("&lt;id &gt;").getSheetByName("&lt; &gt;"); //  var range = sheet.getRange(&lt; &gt;); //   var values = range.getValues(); //    range.setValues(&lt; &gt;);</span></span></code> </pre> <br><h3>  Interpretar una solicitud en un contexto restaurado </h3><br>  En el caso general, la interpretaci√≥n correcta de las consultas de texto requiere el uso de algoritmos NLU inteligentes.  Y aunque tales algoritmos est√°n disponibles en herramientas simples como la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">que describ√≠ por Aimylogic</a> , en este caso decid√≠ abandonar el procesamiento del lenguaje natural en favor de la simplicidad. <br><br>  En el juego propuesto, la interacci√≥n del jugador con Alice se limita a una docena de estados posibles y se puede reducir a un peque√±o conjunto de intenciones.  Para simplificar, siempre ofrezco al jugador tres acciones posibles: enviar "Uno", "Dos" o "Tres".  Para cualquier otra solicitud, Alice pide aclarar la acci√≥n. <br><br>  El escenario en este caso se reduce al siguiente c√≥digo de Apps Script: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     switch(user.state){ case "start": //       switch(utterance){ case ‚Äú1Ô∏è‚É£ ‚Äù: case ‚Äú2Ô∏è‚É£ ‚Äù: case ‚Äú3Ô∏è‚É£ ‚Äù: //     default: //     } break; //    default: //      }</span></span></code> </pre><br>  Para el usuario, la interacci√≥n as√≠ resuelta se representa como la elecci√≥n de una de las tres opciones, cuyo significado est√° claramente definido en cada respuesta de Alice.  Las opciones en s√≠ est√°n representadas por los botones "Uno", "Dos", "Tres", que aceleran significativamente el juego. <br><br><h3>  Generaci√≥n de mensaje de respuesta </h3><br>  La respuesta de Alice consta de varias partes, cada una de las cuales debe formarse, que incluyen: <br><br><ul><li>  texto para mostrar en la pantalla; </li><li>  texto para s√≠ntesis de voz; </li><li>  Conjunto de botones de pista. </li></ul><br>  Recientemente, formul√© el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">concepto de un di√°logo F√ÅCIL</a> , describiendo los principios del dise√±o de una interfaz de conversaci√≥n, incluso para Alice.  El formato de respuesta de Alice permite implementar estos principios. <br><br>  Por lo tanto, la separaci√≥n del texto visualizado y hablado le permite hacer que las respuestas sean m√°s concisas y naturales.  No puede obligar a Alice a sintetizar texto largo con el que el usuario ya est√° familiarizado, as√≠ como a usar emoji en el texto del mensaje y el nombre de los botones. <br><br>  Los botones de sugerencias implementan el principio de iniciativa: Alice siempre indica y sugiere posibles acciones para continuar el di√°logo.  En el escenario del juego propuesto, la lista de botones no depende del contexto y se agrega a cada mensaje. <br><br>  Entonces, tenemos una tabla de Google con datos de usuario que se almacenan y recuperan a trav√©s de la URL de la aplicaci√≥n web.  La aplicaci√≥n est√° escrita en Apps Script, interpreta la acci√≥n del usuario de acuerdo con su contexto y genera datos para el mensaje de respuesta. <br><br>  Queda por conectarse con Alice ... <br><br><h2>  Dos!  Integraci√≥n </h2><br>  Yandex.Dialogs permite a los desarrolladores agregar sus habilidades a Alice.  Conectar una habilidad se reduce a tres cosas principales: <br><br><ul><li>  activaci√≥n </li><li>  dise√±o; </li><li>  gancho web. </li></ul><br><h3>  Activaci√≥n y dise√±o. </h3><br>  Para la activaci√≥n, es importante elegir una frase que Alice reconozca bien y que cumpla con los <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">requisitos formales de</a> Yandex.  Si hay n√∫meros en el nombre de activaci√≥n, verifique por separado la activaci√≥n al ingresar desde el teclado y la voz. <br><br>  El dise√±o de la habilidad incluye un nombre, descripci√≥n, √≠cono, categor√≠a, etc. <br>  Vale la pena considerar que en la lista de habilidades en el cat√°logo solo se muestran el icono y la frase de activaci√≥n, y la b√∫squeda en el cat√°logo se lleva a cabo principalmente de acuerdo con la descripci√≥n. <br><br><h3>  Conseguir un gancho web </h3><br>  Un enlace web es la direcci√≥n donde Alice enviar√° mensajes a su habilidad y esperar√° una respuesta JSON en el formato descrito. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/za/zy/4t/zazy4tve59hnchb4quwuokqv6ju.png"></div><br><br>  La aplicaci√≥n web creada en Apps Script devuelve una respuesta en forma de p√°gina html de forma predeterminada, pero al usar ContentService tambi√©n puede verse obligada a devolver JSON: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ContentService.createTextOutput(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(<span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">JSON</span></span></span></span><span class="xml"><span class="hljs-tag"> &gt;</span></span></span><span class="xml">)) .setMimeType(ContentService.MimeType.JSON);</span></span></code> </pre> <br>  Sin embargo, cuando usa ContentService, Google redirige la solicitud del usuario a una URL temporal, para la cual Yandex.Dialogs no est√° listo.  Por lo tanto, la direcci√≥n de la aplicaci√≥n web como enlace web no es adecuada. <br><br>  Hay servicios gratuitos que ofrecen un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">enlace</a> web adecuado para Alice, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">como Zenbot</a> .  En Zenbot, para el juego propuesto, puede escribir una secuencia de comandos corta que acceda a una aplicaci√≥n web de Google y devuelva una respuesta junto con los botones.  Por cierto, de esta manera el juego puede integrarse no solo con Alice, sino tambi√©n con otros canales. <br><br>  A continuaci√≥n se muestra un script de ejemplo que proporciona el juego "One, Two, Three!"  en el bot de Telegram @RazDvaTriBot: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">pattern</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"input"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://script.google.com/macros/s/&lt;id -&gt;/exec"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">var</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Result"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userId"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$req_telegram_chat"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utterance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Utterance"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"channel"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"telegram"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">get</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">var</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Answer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'javascript: $Result.text'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">output</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$Answer"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">sample</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Para una mayor flexibilidad en el procesamiento de solicitudes, puede escribir su propio servidor utilizando, por ejemplo, Google App Engine.  Esta herramienta tambi√©n se puede usar de forma gratuita. <br><br>  Despu√©s de crear un proyecto en Google App Engine, la interfaz de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Cloud Shell le</a> permite escribir el c√≥digo del servidor en una p√°gina web y desplegarlo en la URL deseada del formulario https: // &lt;project id&gt; .appspot.com, que ser√° la direcci√≥n del enlace web. <br><br>  La operaci√≥n del servidor consta de los siguientes pasos: <br><br><ol><li>  recibir datos de solicitud de Alice; </li><li>  interacci√≥n con la aplicaci√≥n web del juego; </li><li>  enviando una respuesta en el formato de Alice. </li></ol><br><h4>  Recibir / enviar datos de Alice </h4><br>  De Alice es importante obtener los identificadores de la sesi√≥n, el usuario, el mensaje y el texto de la solicitud.  A continuaci√≥n se muestra un ejemplo en PHP: <br><br><pre> <code class="php hljs"> $data = json_decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>)); $session_id = $data-&gt;session-&gt;session_id; $user_id = $data-&gt;session-&gt;user_id; $utterance = $data-&gt;request-&gt;original_utterance; $messageId = $data-&gt;session-&gt;message_id;</code> </pre><br>  Como respuesta, los botones de pista y los textos se devuelven al juego para su visualizaci√≥n y pronunciaci√≥n: <br><br><pre> <code class="php hljs"> $button1 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button2 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'2Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $button3 = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'3Ô∏è‚É£ '</span></span>, <span class="hljs-string"><span class="hljs-string">'hide'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $yaButtons = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($button1, $button2, $button3); $yaResponse = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'text'</span></span> =&gt; $text, <span class="hljs-string"><span class="hljs-string">'tts'</span></span> =&gt; $tts, <span class="hljs-string"><span class="hljs-string">'buttons'</span></span> =&gt; $yaButtons, <span class="hljs-string"><span class="hljs-string">'end_session'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $yaSession = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'session_id'</span></span> =&gt; $session_id, <span class="hljs-string"><span class="hljs-string">'message_id'</span></span> =&gt; $messageId, <span class="hljs-string"><span class="hljs-string">'user_id'</span></span> =&gt; $user_id); $yaResult = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'response'</span></span> =&gt; $yaResponse, <span class="hljs-string"><span class="hljs-string">'session'</span></span> =&gt; $yaSession, <span class="hljs-string"><span class="hljs-string">'version'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'1.0'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> json_encode($yaResult);</code> </pre><br><h2>  Tres!  Sincronizaci√≥n </h2><br>  Enviar / recibir datos de una aplicaci√≥n web lleva tiempo, y Alice est√° ansiosa por dar una respuesta al usuario, por lo que los problemas de sincronizaci√≥n interfieren con el asunto. <br><br>  Naturalmente, para proyectos grandes, las Hojas de c√°lculo de Google no son adecuadas como backend para la habilidad de Alice: el tiempo de respuesta aumenta con una gran cantidad de solicitudes paralelas.  Sin embargo, existen recomendaciones para optimizar el chatbot, que hacen posible que un peque√±o proyecto sea viable en un sistema de di√°logo interactivo en tiempo real. <br><br>  Tiempo de espera de protocolo s√≠ncrono de Alice: 1,5 segundos por respuesta.  Si el servidor no tiene tiempo para responder durante este tiempo, el usuario ve un mensaje triste en el esp√≠ritu de "Lo siento, &lt;nombre de di√°logo&gt; no responde".  El sistema no ofrece pistas sobre qu√© hacer a continuaci√≥n. <br><br>  Para evitar tal situaci√≥n, puede y debe acelerar el servicio, as√≠ como rastrear y procesar los tiempos de espera.  Las operaciones m√°s largas durante la operaci√≥n del gui√≥n del juego son leer y escribir datos de la tabla.  Por lo tanto, en primer lugar, se debe minimizar el n√∫mero de estas operaciones y, en segundo lugar, es conveniente paralelizarlas. <br><br>  Lea los datos de la tabla una vez lo suficiente.  Despu√©s de ejecutar la l√≥gica, el script est√° listo para dar una respuesta al usuario inmediatamente, antes del final de la grabaci√≥n de los resultados. <br><br>  Se debe permitir un tiempo limitado para recibir una respuesta, por ejemplo, 1100 ms: <br><br><pre> <code class="php hljs"> $request_params = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'userId'</span></span> =&gt; $user_id, <span class="hljs-string"><span class="hljs-string">'utterance'</span></span> =&gt; $utterance, <span class="hljs-string"><span class="hljs-string">'channel'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'alice'</span></span> ); $get_params = http_build_query($request_params); $ctx = stream_context_create(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>=&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1.1</span></span> ) )); $answer = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://script.google.com/macros/s/&lt;id -&gt;/exec?'</span></span>. $get_params, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, $ctx);</code> </pre><br>  Si la solicitud GET recibe la respuesta a tiempo, podemos enviarla al usuario e iniciar el almacenamiento de los resultados mediante la solicitud POST en segundo plano.  De lo contrario, le damos al usuario un texto auxiliar con botones para continuar, e ignoramos los resultados del script para que el usuario pueda repetir su solicitud en el contexto actual. <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($answer === <span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span>) { $text = <span class="hljs-string"><span class="hljs-string">' ,   .'</span></span>; $tts = <span class="hljs-string"><span class="hljs-string">',   .'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $answer = json_decode($answer); $text = $answer-&gt;text; $tts = $answer-&gt;tts; <span class="hljs-comment"><span class="hljs-comment">//   $data2store = $answer-&gt;data; $postdata = json_encode(array( 'data' =&gt; $data2store )); $opts = array('http' =&gt; array( 'method' =&gt; 'POST', 'header' =&gt; 'Content-Type: application/json', 'content' =&gt; $postdata, 'timeout' =&gt; 0.1 ) ); $context = stream_context_create($opts); file_get_contents("https://script.google.com/macros/s/&lt;id -&gt;/exec", false, $context); }</span></span></code> </pre><br><img src="https://habrastorage.org/webt/a1/ez/od/a1ezodgm9tqdt2gudd7vfes9bn0.png" width="320" align="right"><br>  En un juego multijugador para Alice, las tareas de sincronizaci√≥n deben resolverse entre los servidores del juego y Yandex, y entre los jugadores.  Si un jugador quiere jugar contra otro usuario, el juego en s√≠ selecciona un oponente, de aquellos que quisieron jugar recientemente.  Los usuarios deben confirmar su disposici√≥n a jugar entre ellos para que comience el juego. <br><br>  Actualmente, la habilidad no puede iniciar el env√≠o de un mensaje al usuario de Alice.  Por lo tanto, el gui√≥n del juego permite verificar la preparaci√≥n del oponente y los minutos asignados para la ronda del juego.  Si el oponente retrasa el juego, se le pide al usuario que lo espere: "¬øEsperar al oponente un poco m√°s?"  Al aceptar esperar, el usuario inicia otra verificaci√≥n.  Si el minuto del juego termina, el juego termina. <br><br><h2>  Conclusi√≥n </h2><br>  Las ventajas de Google Sheets como back-end para un bot de chat, excepto de forma gratuita, incluyen el hecho de que es una herramienta de depuraci√≥n durante el desarrollo, y luego se convierte en una consola de administrador de habilidades con todas las delicias de la edici√≥n colaborativa desde cualquier dispositivo.  Por contra: retrasos en la operaci√≥n simult√°nea de un gran n√∫mero de usuarios. <br><br clear="right">  Espero que este art√≠culo ayude a los entusiastas y desarrolladores a crear r√°pidamente habilidades √∫tiles para Alice u otros canales.  El juego propuesto est√° disponible en la tienda de habilidades Yandex.Dialog llamada ‚Äú <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">One, Two, Three!</a>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Juego multijugador</a> ". <br><br>  Junto con las herramientas de uso general, existen soluciones especializadas para el desarrollo de bots de chat.  Invito a los lectores a participar en una peque√±a encuesta sobre los servicios que conozco en esta √°rea.  La lista no inclu√≠a todos los productos existentes. Le agradecer√© comentarios con nombres y rese√±as breves si utiliz√≥ otras herramientas. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es414213/">https://habr.com/ru/post/es414213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es414201/index.html">C√≥digo Divino (c√≥digo de DIOS)</a></li>
<li><a href="../es414203/index.html">Estafa o no estafa? Verificamos ICO por cinco m√©todos</a></li>
<li><a href="../es414207/index.html">El problema del innovador, o por qu√© necesita recurrir a la experiencia de otras personas.</a></li>
<li><a href="../es414209/index.html">IGNG - Algoritmo incremental de gas neuronal incremental</a></li>
<li><a href="../es414211/index.html">Desarrollo de un servidor TELNET basado en W5500 y ATMEGA8</a></li>
<li><a href="../es414215/index.html">Bloques personalizados en chips (Silicon IP): c√≥mo funciona</a></li>
<li><a href="../es414217/index.html">Smartphones locales Vertex: primero en calidad, primero en chips, primero en dise√±o</a></li>
<li><a href="../es414219/index.html">La experiencia del uso de la energ√≠a solar en la regi√≥n de Mosc√∫: a favor, en contra y qui√©n la necesita</a></li>
<li><a href="../es414221/index.html">Analizando y trabajando con Codificable en Swift 4</a></li>
<li><a href="../es414223/index.html">C #: compatibilidad con versiones anteriores y sobrecarga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>