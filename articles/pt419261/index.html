<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üé¥ üöã üëÜüèº A√ß√µes no Google: escrevendo um aplicativo simples para o Google Assistant no Dialogflow e Cloud Functions for Firebase üë®üèΩ‚Äçüåæ üêó üëá</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="No final do m√™s passado, o Google Assistant foi lan√ßado oficialmente em russo, ent√£o √© hora de descobrir como criar seus pr√≥prios aplicativos ( a√ß√µes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>A√ß√µes no Google: escrevendo um aplicativo simples para o Google Assistant no Dialogflow e Cloud Functions for Firebase</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/mailru/blog/419261/">  No final do m√™s passado, o Google Assistant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">foi lan√ßado oficialmente</a> em russo, ent√£o √© hora de descobrir como criar seus pr√≥prios aplicativos ( <i>a√ß√µes</i> ) para o Assistant na pilha de tecnologia padr√£o do Google.  Neste artigo, consideraremos a cria√ß√£o de uma a√ß√£o no <b>Actions no Google</b> , analisaremos o processo de extra√ß√£o de entidades e inten√ß√µes de frases no <b>Dialogflow</b> , aprenderemos a escrever manipuladores para obter informa√ß√µes extra√≠das e trabalhar com uma rede no <b>Cloud Functions for Firebase</b> . <br><br><img src="https://habrastorage.org/webt/a0/fj/yq/a0fjyq-er-evhhgkrr8hgbjxqhi.png"><br>  <i>Fig.</i>  <i>1. Arquitetura de aplicativo para o Assistant.</i> <br><a name="habracut"></a><br>  O desenvolvimento do Assistant come√ßou a se desenvolver h√° relativamente pouco tempo, portanto a rede possui poucos materiais e o n√∫mero de ferramentas e tecnologias usadas aumenta significativamente o limite de entrada.  Este artigo, embora n√£o resolva, mas pelo menos contribui para a solu√ß√£o desses problemas.  Vamos come√ßar com a arquitetura do aplicativo para o Assistant (Fig. 1), implementada na pilha de tecnologia padr√£o do Google: <br><br><ul><li>  <b>O Actions no Google</b> √© uma plataforma para a cria√ß√£o de aplicativos para o Google Assistant. </li><li>  <b>Dialogflow</b> - mecanismo NLU (Natural Language Understanding), respons√°vel pelo processamento de idiomas naturais e di√°logos de design. </li><li>  <b>Cloud Functions for Firebase</b> (por conveni√™ncia, usaremos a abrevia√ß√£o Firebase Functions) - fun√ß√µes da nuvem para processar l√≥gica complexa de intera√ß√£o do usu√°rio e para trabalhar com servi√ßos de terceiros.  As fun√ß√µes do Firebase e o Dialogflow interagem via webhook, portanto, tecnicamente, qualquer outra solu√ß√£o de servidor pode ser usada.  Entretanto, o Firebase Functions √© uma boa alternativa e, √†s vezes, um substituto para seu pr√≥prio back-end.  Ele permite que voc√™ crie e execute servi√ßos na infraestrutura do Google, sem se preocupar com a aloca√ß√£o, dimensionamento ou gerenciamento de servidores.  Por um lado, isso permite que voc√™ se concentre no componente de produto do desenvolvimento e na funcionalidade do servi√ßo, sem perder tempo em tarefas e administra√ß√£o de infraestrutura.  Por outro lado, por outro lado, a delega√ß√£o implica um enfraquecimento do controle sobre a situa√ß√£o. </li></ul><br>  O artigo enfoca o aspecto t√©cnico do desenvolvimento; o custo do uso dos servi√ßos listados n√£o ser√° analisado. <br><br><img src="https://habrastorage.org/webt/mb/xq/lu/mbxqlufyd-0svj25q81mlwbzkmk.png"><br>  <i>Fig.</i>  <i>2. Intera√ß√£o dos componentes do Google Assistant (com base no material: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">P√°gina inicial do Google e Workshop do assistente do Google</a> ).</i> <br><br>  Dentro da pilha descrita, a l√≥gica da a√ß√£o se parece com a seguinte (Fig. 2): <br><br><ul><li>  O usu√°rio acessa o aplicativo Google Assistant e inicia uma conversa com uma a√ß√£o espec√≠fica. </li><li>  O Assistente do Google, por meio de A√ß√µes no Google, procura cada frase do usu√°rio em um formato de texto no Dialogflow, al√©m de fornecer <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">informa√ß√µes sobre o pr√≥prio usu√°rio</a> (mediante solicita√ß√£o pr√©via e com o consentimento do usu√°rio) e a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">conversa atual</a> . </li><li>  O Dialogflow processa a frase recebida, extrai dela as informa√ß√µes necess√°rias e, com base no ML, toma decis√µes sobre qual resposta ser√° gerada. </li><li>  Em alguns casos, o Dialogflow pode delegar a forma√ß√£o de uma resposta no servidor no Firebase Functions, que, por sua vez, pode usar servi√ßos de terceiros para obter as informa√ß√µes necess√°rias para a resposta. </li><li>  Depois que a resposta √© formada, o Dialogflow a retorna para A√ß√µes no Google, de onde entra no aplicativo Google Assistant. </li></ul><br><h2>  Id√©ia </h2><br>  Nossa a√ß√£o determinar√° por frase que tipo de gifs o usu√°rio deseja ver e, em seguida, ele os procurar√° por meio da API GIPHY e os retornar√° ao usu√°rio na forma de cart√µes.  Ao implementar a a√ß√£o, analisaremos a solu√ß√£o das seguintes tarefas: <br><br><ol><li>  Configure e vincule a√ß√µes no Google, Dialogflow e Firebase Functions. </li><li>  Extraia palavras-chave de frases do usu√°rio (Dialogflow). </li><li>  Caixa de di√°logo de script (fluxo de di√°logo). </li><li>  Trabalhar com o contexto de di√°logo (Dialogflow). </li><li>  Criando e conectando um webhook para gerar uma resposta a uma frase do usu√°rio (Dialogflow, Firebase Function). </li><li>  Exibir carrossel de cart√µes na interface (Firebase Functions). </li><li>  Download de informa√ß√µes de um servi√ßo de terceiros (Firebase Functions). </li></ol><br><h2>  Configura√ß√£o inicial </h2><br><img src="https://habrastorage.org/webt/qz/ib/k6/qzibk6lsuxemwmfzt2bmkpitzoa.png"><br>  <i>Fig.</i>  <i>3. Criando um agente do Dialogflow.</i> <br><br>  Primeiro de tudo, precisamos de uma conta do Google.  Vamos come√ßar criando um projeto no Dialogflow, para isso, no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">console,</a> clique no bot√£o Criar agente e preencha os campos obrigat√≥rios (Fig. 3): <br><br><ul><li>  O idioma padr√£o √© "russo - ru". </li><li>  Fuso hor√°rio: "(GMT + 3: 00) Europe / Moscow". </li><li>  Google Cloud Project: um novo GCP para o seu agente Dialogflow ser√° criado automaticamente ou voc√™ pode escolher um dos projetos existentes do GCP, se houver. </li></ul><br>  Em seguida, clique no bot√£o Criar no canto superior direito e aguarde o console configurar um novo projeto. <br><br><img src="https://habrastorage.org/webt/il/wd/gd/ilwdgd0j4u6f9ghzfd6k9dmwtfq.png"><br>  <i>Fig.</i>  <i>4. Inten√ß√µes padr√£o.</i> <br><br>  Por padr√£o, ao criar um agente do Dialogflow, duas inten√ß√µes s√£o criadas (Fig. 4): <br><br><ul><li>  "Inten√ß√£o de boas-vindas padr√£o" - √© respons√°vel por cumprimentar o usu√°rio; </li><li>  ‚ÄúInten√ß√£o de fallback padr√£o‚Äù - processa frases desconhecidas que o Dialogflow n√£o pode atribuir a nenhuma outra inten√ß√£o. </li></ul><br>  A cria√ß√£o de di√°logos no Dialogflow j√° foi descrita em detalhes nos artigos <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> e <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">aqui</a> , portanto, n√£o vou me concentrar no seu princ√≠pio de opera√ß√£o. <br><br><img src="https://habrastorage.org/webt/jj/if/sp/jjifspt3awd3uoyao-nxlhdnaco.png"><br>  <i>Fig.</i>  <i>5. Respostas para "Inten√ß√£o de boas-vindas padr√£o".</i> <br><br>  Adicionaremos algumas respostas bem-vindas ao "Objetivo padr√£o de boas-vindas" que ajudar√° o usu√°rio a entender para que serve a a√ß√£o e quais fun√ß√µes ele pode executar.  Na se√ß√£o "Respostas", selecione a guia "Assistente do Google" e, em "Envios de sugest√µes", escreveremos exemplos de frases para informar ao usu√°rio como se comunicar com a a√ß√£o (Fig. 5). <br><br>  A a√ß√£o pode ser depurada no Assistente do Google, tanto no telefone quanto no emulador oficial.  Para abrir o emulador, voc√™ precisa acessar a se√ß√£o "Integra√ß√µes", no cart√£o "Google Assistant", clicar no bot√£o "Configura√ß√µes de integra√ß√£o" e clicar em "Gerenciar o aplicativo Assistant".  No telefone e no emulador, a a√ß√£o pode ser acionada com a frase de c√≥digo "Ok Google, quero falar com meu aplicativo de teste". <br><br><h2>  Cen√°rio base: pesquisa GIF </h2><br>  Crie um novo objetivo de pesquisa, que extrair√° palavras-chave da frase do usu√°rio e as enviar√° atrav√©s do servidor webhook para o Firebase Functions.  O servidor, por sua vez, usando a API GIPHY encontrar√° os gifs correspondentes e retornar√° o resultado ao usu√°rio na forma de cart√µes. <br><br><img src="https://habrastorage.org/webt/dc/ig/68/dcig68-xcdbzx8ygmuy83-4xibk.png"><br>  <i>Fig.</i>  <i>6. Adicionando frases de treinamento.</i> <br><br>  Para come√ßar, adicionaremos frases t√≠picas para treinamento na se√ß√£o Frases de treinamento (Fig. 6): <br><br><ul><li>  "Eu quero ver girafas dan√ßando." </li><li>  "Encontre o animashki." </li><li>  "Mostre os selos." </li><li>  Mostre-me os gifs. </li><li>  "Encontre-me elefantes animados." </li><li>  "Mostrar gifs de panda." </li><li>  "Gifs com listras de guaxinim." </li><li>  "Voc√™ tem selos." </li><li>  "Encontre as quedas engra√ßadas." </li></ul><br><img src="https://habrastorage.org/webt/az/_s/e0/az_se0faydig_odzqvgvh4c0twu.png"><br>  <i>Fig.</i>  <i>7. Extraindo par√¢metros do texto.</i> <br><br>  Para frases adicionadas, observe o par√¢metro de pesquisa, que o Dialogflow deve selecionar no texto.  Nesse caso, o tipo de par√¢metro mais apropriado √© <code>@sys.any</code> , pois quase qualquer constru√ß√£o de idioma pode ser usada como par√¢metro de consulta de pesquisa.  Chamamos esse par√¢metro de <code>query</code> e o marcamos como necess√°rio (Fig. 7). <br><br><img src="https://habrastorage.org/webt/xt/c_/cy/xtc_cyzai21tbnfysovpupedakg.png"><br>  <i>Fig.</i>  <i>8. A lista das principais perguntas.</i> <br><br>  Na subse√ß√£o ‚ÄúPrompts‚Äù, escreveremos perguntas esclarecedoras que o Dialogflow far√° se n√£o conseguir extrair palavras-chave da frase (Fig. 8). <br><br>  Em seguida, v√° at√© a se√ß√£o ‚ÄúProcessamento‚Äù na parte inferior da p√°gina (n√£o confunda com a se√ß√£o com o mesmo nome no menu esquerdo).  clique no bot√£o "Ativar preenchimento completo" e ative a configura√ß√£o "Ativar chamada de webhook para esse objetivo".  Isso permitir√° que o Dialogflow delegue a forma√ß√£o de uma resposta do Firebase Functions quando atingir a inten√ß√£o. <br><br>  Agora v√° para a aba ‚ÄúCumprimento‚Äù no menu esquerdo e ative o ‚ÄúEditor embutido‚Äù, onde escreveremos a l√≥gica do rec√©m-criado ‚ÄúObjetivo da pesquisa‚Äù.  Para procurar GIFs por palavras-chave, usaremos a solicita√ß√£o <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">https://api.giphy.com/v1/gifs/search</a> , que retorna uma lista de objetos encontrados no formato JSON de acordo com a <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">especifica√ß√£o</a> .  A resposta recebida do GIPHY ser√° exibida na forma de um <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">carrossel de navega√ß√£o</a> - um carrossel de cart√µes com imagens, quando clicadas, uma p√°gina da web √© aberta.  No nosso caso, quando voc√™ clica no cart√£o, o usu√°rio acessa a p√°gina de servi√ßo GIPHY com esta anima√ß√£o e uma lista de similares. <br><br>  O c√≥digo que implementa a funcionalidade descrita acima √© apresentado abaixo. <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> GIPHY_API_KEY = <span class="hljs-string"><span class="hljs-string">'API_KEY'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEARCH_RESULTS = [ <span class="hljs-string"><span class="hljs-string">'-,    .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   !'</span></span> ]; <span class="hljs-comment"><span class="hljs-comment">// Import the Dialogflow module from the Actions on Google client library. const { dialogflow, BrowseCarouselItem, BrowseCarousel, Suggestions, Image } = require('actions-on-google'); // Import the firebase-functions package for deployment. const functions = require('firebase-functions'); // Import the request-promise package for network requests. const request = require('request-promise'); // Instantiate the Dialogflow client. const app = dialogflow({ debug: true }); function getCarouselItems(data) { var carouselItems = []; data.slice(0, 10).forEach(function (gif) { carouselItems.push(new BrowseCarouselItem({ title: gif.title || gif.id, url: gif.url, image: new Image({ url: gif.images.downsized_medium.url, alt: gif.title || gif.id }), })); }); return carouselItems; } function search(conv, query) { // Send the GET request to GIPHY API. return request({ method: 'GET', uri: 'https://api.giphy.com/v1/gifs/search', qs: { 'api_key': GIPHY_API_KEY, 'q': query, 'limit': 10, 'offset': 0, 'lang': 'ru' }, json: true, resolveWithFullResponse: true, }).then(function (responce) { // Handle the API call success. console.log(responce.statusCode + ': ' + responce.statusMessage); console.log(JSON.stringify(responce.body)); // Obtain carousel items from the API call response. var carouselItems = getCarouselItems(responce.body.data); // Validate items count. if (carouselItems.length &lt;= 10 &amp;&amp; carouselItems.length &gt;= 2) { conv.data.query = query; conv.data.searchCount = conv.data.searchCount || 0; conv.ask(SEARCH_RESULTS[conv.data.searchCount % SEARCH_RESULTS.length]); conv.data.searchCount++; conv.ask(new BrowseCarousel({ items: carouselItems })); } else { // Show alternative response. conv.ask('      ,   - ?)'); } }).catch(function (error) { // Handle the API call failure. console.log(error); conv.ask(',     .'); }); } // Handle the Dialogflow intent named 'Search Intent'. // The intent collects a parameter named 'query'. app.intent('Search Intent', (conv, { query }) =&gt; { return search(conv, query); }); // Set the DialogflowApp object to handle the HTTPS POST request. exports.dialogflowFirebaseFulfillment = functions.https.onRequest(app);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Depend√™ncias</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"dialogflowFirebaseFulfillment"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"This is the default fulfillment for a Dialogflow agents using Cloud Functions for Firebase"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.0.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"private"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"Apache Version 2.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"Google Inc."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"engines"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"node"</span></span>: <span class="hljs-string"><span class="hljs-string">"~6.0"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"firebase serve --only functions:dialogflowFirebaseFulfillment"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"deploy"</span></span>: <span class="hljs-string"><span class="hljs-string">"firebase deploy --only functions:dialogflowFirebaseFulfillment"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"actions-on-google"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.0.0-alpha.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firebase-admin"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.2.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"firebase-functions"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.5.7"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dialogflow"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"dialogflow-fulfillment"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.3.0-beta.3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.81.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request-promise"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.2.1"</span></span> } }</code> </pre> </div></div><br>  Como o usu√°rio pode acessar a mesma inten√ß√£o v√°rias vezes, √© recomend√°vel retornar v√°rias respostas a ela.  Para fazer isso, usamos o objeto JSON <code>Conversation.data</code> , que mant√©m seu valor ao acessar a inten√ß√£o novamente e ao se referir a outros scripts de conversa. <br><br><img src="https://habrastorage.org/webt/0m/lo/tp/0mlotpjfiboyxj_qgs5yselugxa.jpeg"><br>  <i>Fig.</i>  <i>9. Inicializa√ß√£o da conversa (√† esquerda), refinamento dos par√¢metros de pesquisa e exibi√ß√£o posterior dos resultados (no centro), exibi√ß√£o dos resultados da pesquisa para uma nova consulta (√† direita)</i> <br><br>  <i>Nota: para trabalhar com a API de servi√ßos de terceiros por meio do Firebase Functions, √© necess√°rio ativar o faturamento; caso contr√°rio, ao tentar trabalhar com a rede, ocorrer√° um erro:</i> <blockquote>  <i>"Conta de cobran√ßa n√£o configurada.</i>  <i>A rede externa n√£o est√° acess√≠vel e as cotas s√£o severamente limitadas.</i>  <i>Configure a conta de cobran√ßa para remover essas restri√ß√µes. "</i> </blockquote>  <i>Para fazer isso, clique em "Conta paga" no menu √† esquerda e selecione Chama (US $ 25 por m√™s) ou Blaze (pagamento conforme o uso) entre os planos tarif√°rios propostos.</i>  <i>Eu escolhi a √∫ltima op√ß√£o, porque, como parte do desenvolvimento de um aplicativo de teste, me pareceu mais rent√°vel.</i> <br><br><h2>  Cen√°rio avan√ßado: pagina√ß√£o </h2><br>  Na maioria dos casos, para uma consulta de pesquisa, o GIPHY encontrar√° significativamente mais de dez GIFs; portanto, ser√° correto permitir que o usu√°rio veja o resultado inteiro da pesquisa, ou seja,  adicione pagina√ß√£o. <br><br>  No console do Dialogflow, passe o mouse sobre a c√©lula Search Intent.  V√°rios bot√µes aparecer√£o √† direita, clique em "Adicionar inten√ß√£o de acompanhamento".  Isso nos permitir√° criar um ramo de conversa seguindo o objetivo da pesquisa.  Entre os elementos da lista suspensa, selecionamos "mais" - uma igni√ß√£o padr√£o para iniciar a exibi√ß√£o de informa√ß√µes adicionais. <br><br><img src="https://habrastorage.org/webt/zb/26/0_/zb260_tehdtnrqgup4np6aqmjva.png"><br>  <i>Fig.</i>  <i>10. O contexto da inten√ß√£o √© "Inten√ß√£o de pesquisa - mais".</i> <br><br>  Vamos para a inten√ß√£o rec√©m-criada e fazer altera√ß√µes na se√ß√£o "Contexto".  Como o usu√°rio pode pedir para mostrar mais GIFs v√°rias vezes seguidas, essa inten√ß√£o deve poder ser chamada recursivamente.  Para isso, no contexto de sa√≠da, √© necess√°rio registrar a mesma linha que √© indicada na entrada (Fig. 10).  Na se√ß√£o "Fullfilment", voc√™ tamb√©m deve ativar a configura√ß√£o "Ativar chamada de webhook para essa inten√ß√£o". <br><br>  Agora vamos retornar ao "preenchimento" no menu lateral, onde inicializamos o manipulador para "Inten√ß√£o de pesquisa - mais".  Tamb√©m adicionamos o par√¢metro <code>offset</code> √† fun√ß√£o de <code>search</code> , que ser√° usada para pagina√ß√£o na API GIPHY. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SEARCH_RESULTS_MORE = [ <span class="hljs-string"><span class="hljs-string">'   !'</span></span>, <span class="hljs-string"><span class="hljs-string">',    .'</span></span>, <span class="hljs-string"><span class="hljs-string">',   .  ,    .'</span></span> ]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">conv, query, offset</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Send the GET request to GIPHY API. return request({ method: 'GET', uri: 'https://api.giphy.com/v1/gifs/search', qs: { 'api_key': GIPHY_API_KEY, 'q': query, 'limit': 10, 'offset': offset, 'lang': 'ru' }, json: true, resolveWithFullResponse: true, }).then(function (responce) { // Handle the API call success. console.log(responce.statusCode + ': ' + responce.statusMessage); console.log(JSON.stringify(responce.body)); // Obtain carousel items from the API call response. var carouselItems = getCarouselItems(responce.body.data); // Validate items count. if (carouselItems.length &lt;= 10 &amp;&amp; carouselItems.length &gt;= 2) { conv.data.query = query; conv.data.offset = responce.body.pagination.count + responce.body.pagination.offset; conv.data.paginationCount = conv.data.paginationCount || 0; conv.data.searchCount = conv.data.searchCount || 0; // Show successful response. if (offset == 0) { conv.ask(SEARCH_RESULTS[conv.data.searchCount % SEARCH_RESULTS.length]); conv.data.searchCount++; } else { conv.ask(SEARCH_RESULTS_MORE[conv.data.paginationCount % SEARCH_RESULTS_MORE.length]); conv.data.paginationCount++; } conv.ask(new BrowseCarousel({ items: carouselItems })); conv.ask(new Suggestions('')); } else { // Show alternative response. conv.ask('      ,   - ?)'); } }).catch(function (error) { // Handle the API call failure. console.log(error); conv.ask(',     .'); }); } // Handle the Dialogflow intent named 'Search Intent - more'. app.intent('Search Intent - more', (conv) =&gt; { // Load more gifs from the privious search query return search(conv, conv.data.query, conv.data.offset); });</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/rm/t1/fq/rmt1fqdvnbvywl1bsgmmjegxceu.jpeg"><br>  <i>Fig.</i>  <i>11. Pagina√ß√£o ao procurar por gifs.</i> <br><br><h2>  Resultado </h2><br>  O v√≠deo da a√ß√£o √© apresentado abaixo. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/FsJu8CQODu8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  C√≥digo do projeto e despejo de assistente dispon√≠vel no <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=pt&amp;u=">Github</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Instru√ß√µes para instalar o projeto e importar o dump</b> <div class="spoiler_text"><ol><li>  V√° para o console do Dialogflow e crie um novo agente ou selecione um existente. </li><li>  Clique no √≠cone de configura√ß√µes, v√° para a se√ß√£o "Exportar e Importar" e clique no bot√£o "Restaurar do ZIP".  Selecione o arquivo ZIP no diret√≥rio raiz do reposit√≥rio. </li><li>  Selecione "Cumprimento" no menu de navega√ß√£o esquerdo. </li><li>  Ative a configura√ß√£o do "Editor embutido". </li><li>  Copie o conte√∫do dos arquivos do diret√≥rio de <code>functions</code> para as guias apropriadas no "Cumprimento". </li><li>  Digite sua chave de acesso √† API GIPHY na guia <i>index.js</i> . </li><li>  V√° para o console do Firebase e altere seu plano para Flame ou Blaze.  O trabalho com servi√ßos de terceiros pela rede n√£o est√° dispon√≠vel com um plano tarif√°rio gratuito. </li></ol><br></div></div></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt419261/">https://habr.com/ru/post/pt419261/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt419251/index.html">Transmiss√£o do terceiro dia de Slurm: intensa em Kubernetes</a></li>
<li><a href="../pt419253/index.html">Relat√≥rio do Clube de Roma de 2018, cap√≠tulo 3.6: Urbanismo regenerativo: Ec√≥polis</a></li>
<li><a href="../pt419255/index.html">No√ß√µes b√°sicas de seguran√ßa da Internet das coisas</a></li>
<li><a href="../pt419257/index.html">√çndia apresenta nova lei de prote√ß√£o contra DP - outro an√°logo ao GDPR?</a></li>
<li><a href="../pt419259/index.html">Rust 1.28 Release</a></li>
<li><a href="../pt419265/index.html">Usando uma rede neural de v√°rias camadas para evitar obst√°culos nos jogos</a></li>
<li><a href="../pt419267/index.html">Excurs√£o SOK Coworking</a></li>
<li><a href="../pt419269/index.html">Recusas no c√≥digo e como descriptograf√°-las. O poder secreto dos identificadores</a></li>
<li><a href="../pt419271/index.html">An√°logos em Python e JavaScript. Parte quatro</a></li>
<li><a href="../pt419273/index.html">Escrevendo um m√≥dulo do kernel Linux: GPIO com suporte a IRQ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>