<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üíÖüèº ü§Ωüèª ü¶Ö Presentamos el nuevo complemento de Grafana: panel de mapa de estado üôÜüèø üë®üèø‚Äçüåæ üëêüèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grafana tiene la capacidad de mostrar el estado , Grafana tiene la capacidad de mostrar los datos a tiempo . Sin embargo, parad√≥jicamente, Grafana a√∫n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Presentamos el nuevo complemento de Grafana: panel de mapa de estado</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/flant/blog/423851/">  Grafana tiene la capacidad de <b>mostrar el estado</b> , Grafana tiene la capacidad de mostrar los <b>datos a tiempo</b> .  Sin embargo, parad√≥jicamente, Grafana a√∫n no ha tenido una manera conveniente de mostrar el <b>estado a lo largo del tiempo</b> . <br><br>  Presentamos nuestro complemento - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Panel de mapa de estado</a> .  Le permite visualizar visualmente el estado de un conjunto de objetos durante un per√≠odo de tiempo seleccionado.  Como ejemplo que demuestra el funcionamiento del complemento, imagine muchos lugares en los que el caf√© est√° preparado para alguien: <br><br><img src="https://habrastorage.org/webt/gh/is/-v/ghis-vmfpoxwf0pfrgp9uy76qfo.png"><br>  <i>Puedes ver c√≥mo Nikki ahorra energ√≠a, Gerry repone r√°pidamente sus suministros de agua, la cafetera de Valera a menudo es basura, y el Wi-Fi es claramente mejor en Bifrost que en la estaci√≥n lunar, donde parece estar muy apretado con agua.</i> <br><br>  ¬øParece interesante?  Pero comencemos con c√≥mo todos llegamos a esto. <a name="habracut"></a><br><br><h2>  Por qu√© </h2><br>  Para una mejor visualizaci√≥n de datos, nos propusimos una tarea simple: mostrar los estados de un conjunto de series de tiempo durante un per√≠odo de tiempo.  Un conjunto de objetos significa diferentes series de tiempo: pueden diferir en un conjunto de etiquetas y un nombre.  Adem√°s, los valores de la serie temporal deber√≠an ser convenientes, es decir  sin muletas, se muestra en texto y color. <br><br>  Ejemplos reales del uso de esta visualizaci√≥n para nuestro negocio son la salud de los servidores o pods de Kubernetes, los resultados de la comprobaci√≥n de los servicios HTTP.  Entonces, en Flant, naci√≥ un complemento de Grafana llamado Statusmap.  Al reflexionar sobre las muchas posibilidades de su aplicaci√≥n para otras tareas, r√°pidamente nos comprometimos a compartir el c√≥digo con la comunidad mundial.  Pero realmente, ¬ønadie ha resuelto este problema antes que nosotros? <br><br><h2>  ¬øPor qu√© no listo? </h2><br>  La tarea es muy popular, por lo que no nos convertimos en pioneros en ella.  Todo comenz√≥ con el hecho de que ten√≠amos varios paneles con complementos geniales <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Panel de</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">estado</a> y <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Punto de estado</a> .  Estos complementos le permiten mostrar el estado actual de un conjunto de objetos, por ejemplo, hosts o hogares ... o cafeteras en diferentes partes del mundo. <br><br><img src="https://habrastorage.org/webt/vb/qo/tb/vbqotbeezghqnvin2pgw4gqpleq.png"><br><br><img src="https://habrastorage.org/webt/lq/b5/zl/lqb5zlkv0lo82uon9c9qnllu4mo.png"><br><br>  Todo sali√≥ bien hasta que quisimos ver el estado de estos objetos a tiempo.  La primera soluci√≥n m√°s f√°cil fue agregar un gr√°fico regular con una marca de verificaci√≥n <i>apilada</i> . <br><br><img src="https://habrastorage.org/webt/bf/ib/mm/bfibmmrpcxlzn2snfzed3mn3_py.png"><br><br>  Seg√∫n lo planeado, el Panel de estado + Gr√°fico apilado nos permitir√≠a ver el estado de los objetos "por ahora" y el desarrollo de la situaci√≥n a tiempo.  Sin embargo, el gr√°fico apilado no es muy claro: <br><br><ul><li>  color indica diferentes series de tiempo, no los valores que se muestran en color para el Punto de estado o el Panel de estado.  Es decir, los colores para los dos gr√°ficos no son iguales y esto es confuso; </li><li> Si aparece <code>null</code> entre los valores, entonces los gr√°ficos fallan. </li></ul><br>  Intentaron adaptar el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">mapa de calor</a> est√°ndar; no funcion√≥: el complemento funciona con el eje Y solo en el nivel de valores y no sabe c√≥mo mostrar etiquetas all√≠.  Luego probamos los siguientes complementos para Grafana: <br><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Gr√°fico de alfombra</a> : agrupa los valores por d√≠a y por el fragmento seleccionado del d√≠a; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Panel discreto</a> es un buen complemento, pero necesitamos mostrar estados discretamente a lo largo del tiempo; </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">El panel Estado por grupo</a> es una buena mejora para el panel Estado, ya que le permite mostrar muchos estados, pero a√∫n sin las capacidades que necesitamos. </li></ul><br>  En base a los resultados de todos los estudios, formulamos los siguientes requisitos para el complemento: <br><br><ul><li>  l√≠nea clara resaltada del gr√°fico para cada objeto; </li><li>  el nombre del objeto se muestra a lo largo del eje Y y se establece en el campo de la leyenda; </li><li>  un objeto puede tener varios estados: en tales casos, el m√°s significativo se mostrar√° en color y el resto se mostrar√° en la informaci√≥n sobre herramientas; </li><li>  los cubos deben mostrarse con un ancho de al menos un determinado (5 px), porque  en un solo p√≠xel inconveniente para apuntar el mouse; </li><li>  gesti√≥n manual del color: la capacidad de establecer el color para cada valor num√©rico a partir de un conjunto discreto. </li></ul><br>  Perm√≠tanme ahora hacer una peque√±a digresi√≥n sobre el mapa de calor, los gr√°ficos de Prometheus y los estados discretos ... <br><br><h2>  Poco de teor√≠a </h2><br>  El mapa de calor cl√°sico es un gr√°fico tridimensional: <br><br><ul><li>  el eje x representa el tiempo </li><li>  a lo largo del eje Y son los posibles valores de una determinada cantidad, </li><li>  a lo largo del eje Z es el n√∫mero de valores observados en un momento dado. </li></ul><br>  El complemento Heatmap est√°ndar muestra el eje Z en color, por ejemplo, de blanco a rojo o a trav√©s del degradado verde-amarillo-rojo.  Esto funciona muy bien para valores continuos: tiempo de respuesta, longitud de la cola, n√∫mero de solicitudes al servidor ... En el caso de estados discretos para un conjunto de objetos, necesita lo siguiente: en el eje Y mostrar los nombres de los objetos que estamos monitoreando, y en el eje Z mostrar los observables para cada objeto estados en un momento dado ... ¬°Pero espera!  ¬øQu√© significa el conjunto de estados de un objeto a la vez?  Tratar√© de describirlo. <br><br>  Aquellos que usan Prometheus con Grafana conocen el <code>step</code> o <code>interval</code> , la configuraci√≥n en la pesta√±a <i>Consulta</i> .  Si especifica <code>1m</code> , y los datos que recopila con un intervalo de <code>5s</code> , cuando realiza una solicitud m√©trica simple, <code>coffee_maker_status</code> Prometheus devolver√° cada 12¬∫ valor, y no se pueden ver 11 valores en el gr√°fico.  ¬øC√≥mo mejorar la situaci√≥n? <br><br>  Lo primero que viene a la mente es usar las funciones de agregaci√≥n, por ejemplo, <code>*_over_time(coffee_maker_status[1m])</code> .  ¬øQu√© funci√≥n debo tomar?  Es hora de descubrir c√≥mo aparece el estado en las m√©tricas de Prometheus.  En la mayor√≠a de los casos, el estado se indica mediante un determinado conjunto de valores.  Por ejemplo, para <code>coffee_maker_status</code> puede haber tales valores de estado: <br><br><ul><li>  0 - ok </li><li>  1 - apagado </li><li>  2 - sin frijoles, </li><li>  3 - sin agua, </li><li>  4 - fallar. </li></ul><br>  Adem√°s, parecer√≠a simple: tomar el n√∫mero de ceros, unos, dos, etc.  en un minuto ... ¬°y tenemos excelentes datos para mostrar en el gr√°fico!  Pero Prometheus tiene su propia opini√≥n sobre esto: <code>coffee_maker_status[1m]</code> es un vector de rango, y por lo tanto, expresiones como <code>max_over_time(coffee_maker_status[1m]==2)</code> o <code>count_values_over_time(coffee_maker_status[1m], 3)</code> , que ser√≠a muy adecuado, son imposibles. <br><br>  Todo funciona bien si hay dos valores en la m√©trica: <code>0</code> (no se observ√≥ ning√∫n estado) y <code>1</code> (se observ√≥ el estado), y el estado en s√≠ se almacena en la etiqueta.  Luego puede hacer tales solicitudes: <code>(max_over_time(coffee_maker_status{status="3"}[1m]) == 1) *3</code> <br><br>  ¬øQu√© hacer con una m√©trica que tiene m√∫ltiples valores?  La nota " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Composici√≥n de funciones de vector de rango en PromQL</a> " dio la idea de convertir una m√©trica con valores discretos en m√©tricas con etiquetas.  Esto se puede hacer usando la siguiente regla de grabaci√≥n: <br><br><pre> <code class="hljs pgsql">- <span class="hljs-type"><span class="hljs-type">record</span></span>: coffee_maker_status:discrete expr: | count_values("status", coffee_maker_status)</code> </pre> <br>  Esta regla transforma la m√©trica <code>coffee_maker_status</code> esta manera: si <code>coffee_maker_status:discrete{status="3"}</code> un valor de <code>3</code> , entonces Prometheus crea una m√©trica <code>coffee_maker_status:discrete{status="3"}</code> con un valor de 1. Y as√≠, para cada valor observado. <br><br>  Por lo general, los estados se definen de antemano, por lo que puede crear un conjunto de consultas para no perder los valores necesarios.  La leyenda de todas las consultas debe coincidir para agrupar los valores: <br><br><img src="https://habrastorage.org/webt/wp/lw/fr/wplwfrej6vn8i9o36vjhkytrzco.png"><br><br>  Ahora, si durante un minuto la cafetera se apag√≥ durante 30 segundos (estado apagado - <code>1</code> ) y el resto del tiempo funcion√≥ (estado correcto - <code>0</code> ), entonces tendremos informaci√≥n sobre c√≥mo apagarla, porque  el complemento recibir√° dos valores con una leyenda a la vez: <code>0</code> de la consulta A y <code>1</code> de la consulta B. <br><br>  Bien: descubrimos c√≥mo agregar datos en estados discretos y a√∫n as√≠ no perder informaci√≥n.  Queda por descubrir c√≥mo combinar datos basados ‚Äã‚Äãen la leyenda y dibujarlos en el panel. <br><br><h2>  Plugin de mapa de estado </h2><br>  Por supuesto, no llegamos inmediatamente a lo que se describi√≥ anteriormente, pero cuando todo esto se uni√≥, qued√≥ claro que, en esencia, el mecanismo de representaci√≥n no era suficiente.  Ahora existe un mecanismo de este tipo: el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">complemento del panel del mapa de estado</a> , que puede hacer lo siguiente: <br><br><ul><li>  los valores en cada punto de tiempo se agrupan en cestas por la coincidencia del texto de las leyendas especificadas en <i>Consulta</i> ; </li><li>  Cada texto de leyenda tiene su propia l√≠nea en el gr√°fico y el texto se muestra como una etiqueta en el eje Y, y los valores vac√≠os se muestran como un espacio o como <code>0</code> : <br><br><img src="https://habrastorage.org/webt/6w/3q/oc/6w3qoczr5li9fou2rktxb3h58ke.png"></li><li>  para cualquier valor, puede especificar el color exacto de la cesta: <br><br><img src="https://habrastorage.org/webt/zn/c-/1n/znc-1nrw5teu5-mo7g4w5zhcwne.png"></li><li>  Si hay varios valores en la cesta, el color se tomar√° para el valor definido anteriormente en la pesta√±a <i>Colores</i> , y cuando pase el cursor sobre la cesta, se mostrar√°n todos los valores que se encuentran en ella: <br><br><img src="https://habrastorage.org/webt/8o/b4/dt/8ob4dtdp_urq5r903oys4wmcwte.png"></li><li>  el complemento puede formar un <code>interval</code> para una solicitud a Prometheus para que las cestas no se conviertan en l√≠neas de p√≠xeles. </li></ul><br>  El resultado es una representaci√≥n muy conveniente del <b>estado de varios objetos</b> .  Adem√°s, puede ver tanto el estado actual (estas son las cestas m√°s a la derecha) como el estado del objeto a tiempo. <br><br><h2>  Donde conseguir </h2><br>  El c√≥digo fuente del complemento Grafana Statusmap se distribuye bajo la licencia gratuita de MIT <i>(similar a otros complementos de Grafana)</i> .  Actualmente est√° disponible en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">nuestro GitHub</a> .  <s>Y esperamos sinceramente que en el futuro cercano <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ingrese al repositorio de complementos de Grafana</a> .</s>  <b>ACTUALIZADO (10/03/18):</b> El complemento ha sido <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">aceptado</a> en el cat√°logo oficial de Grafana. <br><br>  Y finalmente, una ilustraci√≥n de c√≥mo Statusmap ayuda a visualizar datos con estados de hogares del cl√∫ster de producci√≥n de Kubernetes: <br><br><img src="https://habrastorage.org/webt/mp/xc/lv/mpxclvizmci-pbwjjqpmy6zvwaw.png"><br><br><h2>  PS </h2><br>  Lea tambi√©n en nuestro blog: <br><br><ul><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Presentaci√≥n de loghouse: un sistema de c√≥digo abierto para trabajar con registros en Kubernetes</a> "; </li><li>  " <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Presentamos oficialmente la utilidad dapp - DevOps para mantener CI / CD</a> ". </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/es423851/">https://habr.com/ru/post/es423851/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../es423837/index.html">¬øC√≥mo arruinar r√°pidamente cualquier proyecto? 17 mejores consejos malos</a></li>
<li><a href="../es423839/index.html">Prueba sha256 por toothOK para red neuronal</a></li>
<li><a href="../es423843/index.html">Si est√°s en Kazan o Novosibirsk y quieres dise√±ar microchips, como en Cupertino</a></li>
<li><a href="../es423845/index.html">Cond√≥n corporativo</a></li>
<li><a href="../es423847/index.html">Reconocimiento de color y luz con APDS-9960</a></li>
<li><a href="../es423853/index.html">C√≥mo funciona el almacenamiento S3 DataLine</a></li>
<li><a href="../es423855/index.html">Nebulosa Zyxel: facilidad de administraci√≥n como base para el ahorro</a></li>
<li><a href="../es423857/index.html">6 desaf√≠os que encontrar√°s al aprender a programar</a></li>
<li><a href="../es423861/index.html">Linternas solares: necesitamos m√°s luz</a></li>
<li><a href="../es423863/index.html">Confrontaci√≥n en PHDays 8 - Vista SOC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>