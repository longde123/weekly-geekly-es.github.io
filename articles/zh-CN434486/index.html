<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ•¯ï¸ ğŸŒ‚ ğŸ¤œğŸ» ä¼šå‘˜å¡ã€‚ ç”¨äºASP.NETä¸­é€šè¡Œè¯çš„Google Pay API â™ï¸ ğŸ¹ ğŸ’š</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="å€ŸåŠ©Apple Walletå’ŒGoogle Payï¼Œé“¶è¡Œå¡å­˜å‚¨åº”ç”¨ç¨‹åºè¿…é€Ÿè¿›å…¥äº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ é™¤äº†é“¶è¡Œä¸šåŠ¡ï¼Œè¿™ä¸¤ä¸ªå¹³å°è¿˜å…è®¸æ‚¨ä½¿ç”¨å…¶ä»–ç±»å‹çš„å¡-ä¼šå‘˜å¡ï¼Œç¤¼å“å¡ï¼Œæ´»åŠ¨é—¨ç¥¨ï¼Œç™»æœºç‰Œç­‰ã€‚ 







 åœ¨ä¸€å®¶ä¸ºä¸€ä¸ªåºå¤§é›¶å”®ç½‘ç»œæä¾›æœåŠ¡çš„å…¬å¸å·¥ä½œæœŸé—´ï¼Œæˆ‘ä¸å¾—ä¸å°†è¯¥ç½‘ç»œçš„ä¼šå‘˜å¡é›†æˆåˆ°Apple Walle...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>ä¼šå‘˜å¡ã€‚ ç”¨äºASP.NETä¸­é€šè¡Œè¯çš„Google Pay API</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/434486/"><p> å€ŸåŠ©Apple Walletå’ŒGoogle Payï¼Œé“¶è¡Œå¡å­˜å‚¨åº”ç”¨ç¨‹åºè¿…é€Ÿè¿›å…¥äº†æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ é™¤äº†é“¶è¡Œä¸šåŠ¡ï¼Œè¿™ä¸¤ä¸ªå¹³å°è¿˜å…è®¸æ‚¨ä½¿ç”¨å…¶ä»–ç±»å‹çš„å¡-ä¼šå‘˜å¡ï¼Œç¤¼å“å¡ï¼Œæ´»åŠ¨é—¨ç¥¨ï¼Œç™»æœºç‰Œç­‰ã€‚ <br></p><br><p><img src="https://habrastorage.org/webt/ga/ng/rq/gangrq7tlqwob2cmgxa1dydoasu.png"><br></p><br><p> åœ¨ä¸€å®¶ä¸ºä¸€ä¸ªåºå¤§é›¶å”®ç½‘ç»œæä¾›æœåŠ¡çš„å…¬å¸å·¥ä½œæœŸé—´ï¼Œæˆ‘ä¸å¾—ä¸å°†è¯¥ç½‘ç»œçš„ä¼šå‘˜å¡é›†æˆåˆ°Apple Walletå’ŒGoogle Payä¸­ã€‚ è€Œä¸”ï¼Œå¦‚æœæ‚¨åªæ˜¯å› ä¸ºé›†æˆå±‚å…·æœ‰å¤šåŠŸèƒ½æ€§è€Œä¸å¾—ä¸ä¿®æ”¹Apple Walletï¼Œé‚£ä¹ˆåœ¨Google Payçš„å¸®åŠ©ä¸‹ï¼Œå¤§éƒ¨åˆ†ç²¾åŠ›å’Œç²¾åŠ›éƒ½èŠ±åœ¨äº†å¼„æ¸…æ¥šæ–‡æ¡£ï¼Œæ‰¾åˆ°åˆé€‚çš„å·¥å…·å’Œå¼€å‘æ¦‚å¿µçš„ç¬¬ä¸€ä¸ªè¯æ˜ä¸Šã€‚ å°½ç®¡æ€»ä½“ä¸Šå…¶ä½™å·¥ä½œçš„é€Ÿåº¦æ¯”Apple Walletå¿«å¾—å¤šï¼Œä½†æˆ‘èŠ±äº†ä¸€å¤©çš„æ—¶é—´å¼„æ¸…æ¥šå¦‚ä½•å¯åŠ¨è¯¥æœåŠ¡ï¼Œå› æ­¤æˆ‘ä¸ä»‹æ„æœ‰äººåœ¨æˆ‘ä¹‹å‰å†™è¿‡ç±»ä¼¼çš„æ–‡ç« ã€‚ <br><a name="habracut"></a><br></p><h2>  1.ç‰©èµ„ </h2><br> ä¼šå‘˜å¡ä½¿ç”¨ä¸¤ä¸ªå®ä½“è¡¨ç¤º-ä¼šå‘˜ç±»åˆ«å’Œä¼šå‘˜å¯¹è±¡ã€‚ <br><br><ul><li>  <i>ä¼šå‘˜ç±»åˆ«</i>æ˜¯æ‰€æœ‰ä¼šå‘˜å¡çš„ä¸€ç§æ¨¡æ¿ã€‚ å®ƒåŒ…å«æ‰€æœ‰åœ°å›¾é€šç”¨çš„å­—æ®µï¼Œä¾‹å¦‚å­—ä½“é¢œè‰²ï¼ŒæŒ‡å‘å›¾æ ‡èµ„æºï¼ŒèƒŒæ™¯ï¼Œæ–‡æœ¬å­—æ®µçš„é“¾æ¥ç­‰ï¼Œå¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°å®Œæ•´è¯´æ˜ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Loyaltyclass</a> <br></li><li>  <i>å¿ è¯šåº¦å¯¹è±¡</i> -LoyaltyClassçš„å®ä¾‹ã€‚ å®ƒè¿˜åŒ…å«ç‰¹å®šå®¢æˆ·çš„ç‰¹å®šå¡çš„æ•°æ®-å¡å·ï¼Œåç§°ï¼Œå…¶ä»–æ–‡æœ¬å­—æ®µã€‚ æ­¤å¤„æè¿°ï¼š <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">å¿ è¯šå¯¹è±¡</a> <br></li></ul><br> ä¸ºäº†æ¥æ”¶å¡ï¼Œç”¨æˆ·å¿…é¡»éµå¾ªæ ¼å¼é“¾æ¥ <br>  <i><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.android.com/payapp/savetoandroidpay</a> <b>/ {JWT}</b></i> ï¼Œå…¶ä¸­JWTæ˜¯ä¸€ä¸ªä»¤ç‰Œï¼Œå…¶ä¸­åŒ…å«å¸¦æœ‰LoyaltyClassæ•°æ®çš„JSONã€‚ ä½†æ˜¯ï¼Œç”±äºURLçš„é•¿åº¦æœ‰é™åˆ¶ï¼Œå› æ­¤ï¼Œå¦‚æœå…¶ç»“æ„åŒ…å«è®¸å¤šå­—ç¬¦ï¼Œå»ºè®®æ‚¨é¦–å…ˆåˆ›å»ºä¸€ä¸ªå¿ è¯šåº¦ç±»ã€‚ <br><br><p> å¦‚æœç”±äºæ¨¡æ¿ï¼Œæ ·å¼ï¼Œæ·»åŠ æˆ–æ›´æ”¹æ–‡æœ¬å­—æ®µçš„æ›´æ”¹è€Œéœ€è¦æ›´æ–°åœ°å›¾ï¼Œåˆ™å¯ä»¥ä½¿ç”¨APIâ€‹â€‹è¿›è¡Œã€‚ åªéœ€ä½¿ç”¨æ–°ç‰ˆæœ¬çš„åœ°å›¾æ¥æ»¡è¶³POSTè¯·æ±‚ï¼ŒGoogleæœåŠ¡æœ¬èº«å°±ä¼šåŒæ­¥æ‹¥æœ‰è¯¥åœ°å›¾çš„ç”¨æˆ·çš„æ‰€æœ‰åº”ç”¨ç¨‹åºã€‚ <br></p><br><h2>  2.å·¥å…·å’Œæ–‡æ¡£ </h2><br><p> é—®é¢˜åœ¨äºï¼Œ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google Pay Pass for Passesæ–‡æ¡£ä¸­çš„</a>æ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯ä¸“é—¨é’ˆå¯¹Javaï¼ŒPHPå’ŒPythonçš„ï¼Œæ–‡æ¡£æœ¬èº«å¼ºçƒˆå»ºè®®â€œä½¿ç”¨å®¢æˆ·ç«¯åº“æ¥ç®€åŒ–ä½¿ç”¨è¯¥APIçš„è¿‡ç¨‹â€ã€‚ <br></p><br><p> éµå¾ªè¿™ä¸ªå»ºè®®ï¼Œæˆ‘å¾ˆé«˜å…´åœ°å»æ‰¾nugetï¼Œä½†æ˜¯Google Payçš„èµ„æ–™åº“ä¸å­˜åœ¨ã€‚  Glory to Brinï¼ŒGoogleä¸­ç¬¬ä¸€è¡Œâ€œ Google pays for pass dotnetâ€è¿”å›äº†<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Google Pay API for Passeså®ç”¨ç¨‹åºåº“</a>é¡µé¢ï¼Œè¯¥é¡µé¢æ‰¾åˆ°äº†æˆ‘æ‰€éœ€çš„å†…å®¹ï¼Œå°½ç®¡æ˜¯ZIPå­˜æ¡£æ ¼å¼ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª.neté¡¹ç›®ï¼Œç”Ÿæˆçš„ç±»ï¼Œè¯¥ç±»æ˜¯Google Pay API- <a href="">Passeså®¢æˆ·ç«¯åº“</a>çš„Google Pay APIçš„åŒ…è£…ã€‚ <br></p><br><p> ä»é¡¹ç›®ä¸­æ˜¯å¦å­˜åœ¨<i>Google.Apis.Walletobjects.v1.1.9.2.00.nuspec</i>æ–‡ä»¶æ¥çœ‹ï¼Œéƒ¨ç½²nugetåŒ…ä»ç„¶æ˜¯Googleå›¢é˜Ÿè®¡åˆ’çš„ä¸€éƒ¨åˆ†ã€‚ æ‰“å¼€è¯¥æ–‡ä»¶ä»¥æŸ¥æ‰¾æ–‡æ¡£åï¼Œæˆ‘æ²¡æœ‰å‘ç°ä»»ä½•å…·ä½“çš„å†…å®¹ï¼Œå¹¶ä¸”æè¿°éƒ¨åˆ†ä¸­çš„æŸäº›é“¾æ¥å®Œå…¨å‘é€åˆ°äº†ä¸å­˜åœ¨çš„é¡µé¢ã€‚ <br><br></p><h2>  3.è·å–è®¿é—®ä»¤ç‰Œ </h2><br><p> è¦ç›´æ¥å¼€å§‹ä½¿ç”¨Google Pay API for Passesï¼Œæ‚¨éœ€è¦è·å–è®¿é—®ä»¤ç‰Œï¼Œä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ï¼š <br><br></p><ol><li> æœ‰ä¸€ä¸ªGoogle Merchantå¸æˆ·ï¼Œæ‚¨å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">è¿™é‡Œ</a>è·å¾— <br></li><li> åˆ›å»ºä¸€ä¸ªæœåŠ¡å¸æˆ·ï¼Œè·å–ä¸€ä¸ªå¸¦æœ‰å‡­è¯çš„æ–‡ä»¶-ä¸€ä¸ªå¸¦æœ‰æœåŠ¡å¸æˆ·è¯¦ç»†ä¿¡æ¯çš„jsonæ–‡æ¡£ï¼ŒåŒ…æ‹¬æ ‡è¯†ç¬¦ï¼Œç”µå­é‚®ä»¶ï¼Œç§é’¥ç­‰ã€‚ å¦‚æ–‡æ¡£æ‰€å»ºè®®ï¼Œæ‚¨éœ€è¦å°†æ­¤æ–‡ä»¶å­˜å‚¨åœ¨å®‰å…¨çš„åœ°æ–¹ã€‚ <br></li><li> åœ¨Google Merchant Centeré“¾æ¥å•†å®¶å¸æˆ·å’ŒæœåŠ¡å¸æˆ· <br></li></ol><br> ä½¿ç”¨æ­¤æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨<i>Google.Apis.Auth.OAuth2</i>åº“ç™»å½•ï¼š <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">await</span></span></span><span class="hljs-function"> Task&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOAuthToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> {         <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> serviceAccountFile = <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty;         serviceAccountFile = ConfigurationManager.AppSettings[<span class="hljs-string"><span class="hljs-string">"GooglePayServiceAccountConfigPath"</span></span>];        <span class="hljs-comment"><span class="hljs-comment">/*              Credential, GoogleCredential              Service Account,   ,      scopes API,             */</span></span>         <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> credential = GoogleCredential.FromFile(serviceAccountFile)                            .CreateScoped(WalletobjectsService.Scope.WalletObjectIssuer);        <span class="hljs-comment"><span class="hljs-comment">/*        Access token        ,   GetAccessTokenForRequestAsync         ,               */</span></span>         <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> token = <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> credential.UnderlyingCredential.GetAccessTokenForRequestAsync();         <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> token; }</code> </pre> <br><h2>  4.åˆ›å»ºåœ°å›¾ </h2><br><p> ä¸ºäº†åˆ›å»ºä¼šå‘˜å¡ï¼Œæ‚¨å¿…é¡»é¦–å…ˆåˆ›å»ºä¼šå‘˜ç­‰çº§ã€‚ å¯ä»¥ä½¿ç”¨APIâ€‹â€‹å’ŒGoogle Merchant Centerç½‘ç»œç•Œé¢æ¥åˆ›å»ºå¿ è¯šåº¦ç­‰çº§ã€‚ è¯·æ³¨æ„ç±»åˆ«åç§°ï¼Œå› ä¸ºè¯¥åç§°åœ¨Google PayåŸºç¡€æ¶æ„ä¸­å¿…é¡»å”¯ä¸€ã€‚ <br><br> åˆ›å»ºå¿ è¯šåº¦ç±»åˆ«åï¼Œæ‚¨å¯ä»¥åˆ›å»ºå¿ è¯šåº¦å¯¹è±¡ã€‚ ä¸ºæ­¤ï¼Œæ‚¨å°†éœ€è¦æˆ‘ä»¬ä¹‹å‰æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„åº“ï¼šåˆ›å»ºä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼ŒæŒ‡å®šOAuthä»¤ç‰Œï¼Œè½¬ç§»åˆ›å»ºçš„LoyaltyObjectå¯¹è±¡ï¼Œç„¶åæ‰§è¡Œè¯·æ±‚ï¼š <br><br></p><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GooglePayApiService</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// ,    Merchant Account IssuerId = ConfigurationManager.AppSettings["GooglePayIssuerId"]; _wobService = new WalletobjectsService(); } private async Task&lt;LoyaltyObject&gt; ConvertLoyaltyObjectFromTemplate(GooglePayPassTemplate template) { string id = $"{IssuerId}.{template.SerialNumber}"; string loyaltyClassName = ConfigurationManager.AppSettings["GooglePayStoreCardClassName"];     var loyaltyClass = await GetLoyaltyClass(loyaltyClassName); var result =  new LoyaltyObject { Id = id, AccountName = template.AccountName,          Barcode = new Barcode          {          AlternateText = template.BarcodeText,               Value = template.SerialNumber,               Type = "pdf417"          },          Kind = "walletObject#loyaltyObject",          ClassId = loyaltyClass.Id,          ClassReference = loyaltyClass,          State = "active"     };     return result; } private async Task&lt;LoyaltyObject&gt; CreateLoyaltyObject(LoyaltyObject loyaltyObject) { var saveRequest = _wobService.Loyaltyobject.Insert(loyaltyObject); saveRequest.OauthToken = await GetOAuthToken(); var savedObject = await saveRequest.ExecuteAsync(); return savedObject; }</span></span></code> </pre><br> æ­¤ç¤ºä¾‹ä¸­çš„<i>GooglePayPassTemplate</i>æ˜¯DTOï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·çš„åœ°å›¾æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿ç”±å•ç‹¬çš„å¼€å‘æœåŠ¡ç”Ÿæˆã€‚ <br><br><h2>  5.åœ°å›¾æ›´æ–° </h2><br><p> æ­¤å¤„çš„åŸç†ä¸åˆ›å»ºæ—¶çš„åŸç†ç›¸åŒï¼šæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªè¯·æ±‚ï¼Œä¼ è¾“æ›´æ–°çš„LoyaltyObjectå¯¹è±¡ï¼Œç„¶åæ‰§è¡Œï¼š <br><br></p><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;LoyaltyObject&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateLoyaltyObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LoyaltyObject loyaltyObject</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> updateRequest = _wobService.Loyaltyobject.Update(loyaltyObject, loyaltyObject.Id);           updateRequest.OauthToken = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> GetOAuthToken(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> savedObject = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> updateRequest.ExecuteAsync(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> savedObject; }</code> </pre> <br><p> å®Œæˆè¯·æ±‚åï¼Œå¦‚æœè®¾å¤‡åœ¨ç½‘ç»œä¸Šå¹¶ä¸”å…·æœ‰Internetè¿æ¥ï¼Œåˆ™å®‰è£…äº†å¡çš„ç”¨æˆ·çš„åº”ç”¨ç¨‹åºä¸­çš„å¡å°†åœ¨å‡ ç§’é’Ÿåæ›´æ–°ã€‚ </p><br><br><h2>  6. JWTä¸€ä»£ </h2><br><p> è¦å®‰è£…å¡ï¼Œæ‚¨å¿…é¡»å°†ç”¨æˆ·é‡å®šå‘åˆ°<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">www.android.com/payapp/savetoandroidpay</a> <b>/ {JWT}</b>é“¾æ¥ã€‚ å¯ä»¥åœ¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ­¤é“¾æ¥</a>ä¸Šæ‰¾åˆ°ä»¤ç‰Œç»“æ„çš„æè¿°ã€‚ <br></p><br><p> ä»¤ç‰Œç”±RSA-SHA256ç­¾åï¼Œç­¾åå¯ä»¥ä½¿ç”¨å¸¦æœ‰æœåŠ¡å¸æˆ·å‡­æ®çš„åŒä¸€æ–‡ä»¶ç”Ÿæˆï¼š <br><br></p><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">JwtHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateJwtForLoyaltyObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">LoyaltyObject loyaltyObject</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*       credential   ,         */</span></span> ServiceAccountCredential credential; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> now = DateTime.UtcNow; DateTime unixEpoch = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DateTime(<span class="hljs-number"><span class="hljs-number">1970</span></span>, <span class="hljs-number"><span class="hljs-number">01</span></span>, <span class="hljs-number"><span class="hljs-number">01</span></span>); <span class="hljs-comment"><span class="hljs-comment">// 1970-01-01 00:00:00 UTC var secondsSinceEpoch = (int)Math.Round((now - unixEpoch).TotalSeconds); string serviceAccountFile = serviceAccountFile = ConfigurationManager.AppSettings["GooglePayServiceAccountConfigPath"]; using (var fs = new FileStream(serviceAccountFile, FileMode.Open, FileAccess.Read, FileShare.Read)) { credential = ServiceAccountCredential.FromServiceAccountData(fs); } /*    JwtPayload,     payload-a  JWT */ var jwtPayload = new JwtPayload { iat = secondsSinceEpoch, iss = credential.Id, payload = new JwtInternalPayload { loyaltyObjects = new[] { new LoyaltyObjectPayload { id = loyaltyObject.Id } } } }; string header = @"{""alg"":""RS256"",""typ"":""JWT""}"; string payload = JsonConverter.SerializeObject(jwtPayload); string base64Header = EscapedBase64(Convert.ToBase64String(Encoding.UTF8.GetBytes(header))); string base64Payload = EscapedBase64(Convert.ToBase64String(Encoding.UTF8.GetBytes(payload))); //        Signature string signature = EscapedBase64(credential.CreateSignature( Encoding.UTF8.GetBytes($"{base64Header}.{base64Payload}") )); var token = $"{base64Header}.{base64Payload}.{signature}"; return token; } private static string EscapedBase64(string base64) { return base64.Replace('+', '-') .Replace('/', '_') .Replace("=", ""); } }</span></span></code> </pre><br><h2> ç»“è®º </h2><br><p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä½¿ç”¨Google Pay Pass for Passesçš„åŸºç¡€çŸ¥è¯†ï¼šè®¾ç½®å¸æˆ·ï¼Œè¿æ¥åˆ°è¯¥APIï¼Œåˆ›å»ºå¿ è¯šåº¦ç±»åˆ«å’Œå¿ è¯šåº¦å¯¹è±¡ã€‚ <br><br> å¦‚æœUFOèµæˆï¼Œæˆ‘å°†åˆ†åˆ«å‘æ‚¨ä»‹ç»å¦‚ä½•ä½¿ç”¨Apple Walletï¼ˆåœ¨å®æ–½æ–¹é¢ï¼Œæ‰€æœ‰å·¥ä½œéƒ½æ¯”è¾ƒå›°éš¾ï¼‰ï¼Œå¦‚ä½•é€šè¿‡ä¸€é¡¹WebæœåŠ¡ä½¿Apple Walletä¸Google Payæˆä¸ºæœ‹å‹ï¼Œè€Œä¸æ„Ÿåˆ°ç—›è‹¦ã€‚ <br></p><br><p></p><h3> æœ‰ç”¨çš„é“¾æ¥ </h3><br><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">æ³¨å†Œå•†å®¶å¸æˆ·</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">é€‚ç”¨äºé€šè¡Œè¯çš„Google Pay APIæ–‡æ¡£</a> <br></li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ä½¿ç”¨Google Pay API for Passesçš„å®¢æˆ·ç«¯åº“</a> </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN434486/">https://habr.com/ru/post/zh-CN434486/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN434474/index.html">å…³äºç©ºé—´å†…å®¹çš„ç»¿çŒ«</a></li>
<li><a href="../zh-CN434476/index.html">GitLabä¸­çš„ChatOpså°†å‘æ‰€æœ‰äººå¼€æ”¾</a></li>
<li><a href="../zh-CN434478/index.html">ä¸éœ²é¢çš„ä»£ç ä¼šæ€æ­»ç¨‹åºï¼Œæˆ‘ä»¬ä¸ä¼šå¯¹æ­¤åšä»»ä½•äº‹æƒ…ã€‚</a></li>
<li><a href="../zh-CN434480/index.html">æ–°å¹´ï¼Œå°ç©æ„ï¼Œç«</a></li>
<li><a href="../zh-CN434482/index.html">æˆ‘ä»¬åšå®¢çš„å¦ä¸€å¹´ï¼š2018å¹´çš„ç»“æœ</a></li>
<li><a href="../zh-CN434490/index.html">æˆ‘ä»¬å¦‚ä½•é€šè¿‡æ°´åˆ€åˆ‡å‰²çœ‹åˆ°å…æç”µè¯</a></li>
<li><a href="../zh-CN434494/index.html">é˜…è¯»ä»€ä¹ˆã€‚ 2017å¹´å’Œ2018å¹´ä¿„è¯­å°è¯´æ¸…å•</a></li>
<li><a href="../zh-CN434496/index.html">ä¸¤é˜¶æ®µæäº¤å’Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æœªæ¥</a></li>
<li><a href="../zh-CN434498/index.html">MVPå’ŒDagger 2-Androidåº”ç”¨ç¨‹åºæ¡†æ¶-ç¬¬1éƒ¨åˆ†</a></li>
<li><a href="../zh-CN434500/index.html">éª—å­å«çå¦®æˆ–çœ‹ä½ çš„è€³æœµ</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>