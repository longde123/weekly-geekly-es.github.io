<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👧🏿 👩🏾‍⚕️ 🏖️ Solution simple pour les tests de régression visuelle dans Java + Selenium Webdriver + aShot 👩🏽‍🍳 🥊 🔺</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bonjour 

 J'ai déjà publié un article sur mon expérience dans l'automatisation des tests de régression visuelle. 

 Depuis lors, le projet a été cons...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Solution simple pour les tests de régression visuelle dans Java + Selenium Webdriver + aShot</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/485710/">  Bonjour <br><br>  J'ai déjà publié <a href="https://habr.com/ru/post/461553/">un article</a> sur mon expérience dans l'automatisation des tests de régression visuelle. <br><br>  Depuis lors, le projet a été considérablement amélioré - la structure a changé, il est devenu beaucoup plus facile de mettre en place le projet et de commencer à écrire des autotests, le rapport a été considérablement amélioré. <br><br><img src="https://habrastorage.org/webt/2x/wd/w4/2xwdw479i_x2gosf6whoc4jvcho.png"><br><br>  <b><a href="https://github.com/predewill/VisualRegressionFramework">VisualRegressionFramework</a></b> est une solution assez simple pour les petits projets.  Une cinquantaine d'autotests (pages + éléments) ont été écrits pour le projet avec lequel je travaille. <br><a name="habracut"></a><br>  Je lance des tests après des changements de mise en page.  Toutes les modifications sont immédiatement visibles, c'est-à-dire que des problèmes tels que « <i>modification de la disposition de l'élément sur une page, mais tout s'est cassé sur l'autre page</i> » sont résolus depuis longtemps. <br><br>  Technologies utilisées - Java, TestNG, Maven, Selenium Webdriver, aShot (bibliothèque de comparaison d'images). <br><br><h3>  Capacités: </h3><br><ul><li>  Comparez les captures d'écran des pages </li><li>  Comparaison des captures d'écran de la page + ignorer les éléments spécifiés (contenu dynamique, etc.) </li><li>  Comparer des captures d'écran d'articles </li><li>  Points d'arrêt - vous pouvez comparer des captures d'écran de pages ou d'éléments de différentes largeurs.  Par défaut, 3 points d'arrêt sont utilisés - 1920px, 768px, 360px </li><li>  Générer automatiquement des captures d'écran attendues </li><li>  Vous pouvez écrire des tests comme des autotests fonctionnels habituels, il n'y a pas de restrictions - c'est important car parfois il peut être nécessaire d'effectuer des actions complexes avant de prendre une capture d'écran. </li></ul><br><h3>  Rapport </h3><br>  Le rapport ressemble à ceci: <br><br><img src="https://habrastorage.org/webt/2x/wd/w4/2xwdw479i_x2gosf6whoc4jvcho.png"><br><br>  La barre latérale gauche contient une liste de tests, un journal des erreurs, le navigateur dans lequel les autotests ont été exécutés. <br><br>  Vous pouvez également basculer entre les points d'arrêt et agrandir n'importe quelle image en cliquant dessus. <br><br><h3>  Structure du cadre </h3><br>  <b>src / config / visual.properties</b> - voici tous les paramètres nécessaires <br><br><ul><li>  points d'arrêt - points d'arrêt, la largeur du site où une capture d'écran sera prise </li><li>  <b>allowableDiffSize</b> - écart autorisé entre la capture d'écran attendue et réelle en pixels </li><li>  chemins d'accès aux dossiers avec captures d'écran </li><li>  chemins d'accès au modèle de rapport, au rapport lui-même et au fichier contenant le journal des erreurs </li></ul><br>  <b>report / REPORT.html</b> - rapport <br><br>  <b>captures d'écran</b> <br><br><ul><li>  <b>réel</b> - captures d'écran réelles créées pendant le test </li><li>  <b>attendu</b> - captures d'écran attendues, s'il n'y a pas de captures d'écran attendues, elles seront créées automatiquement la première fois que vous exécuterez le test </li><li>  <b>diff</b> - image sur laquelle les zones non appariées sont surlignées en rouge </li><li>  <b>gif</b> - <b>gifs</b> créés à partir d'images réelles, attendues et diff </li></ul><br>  <b>src / main / framework</b> - classes de <b>framework</b> - générateur de rapports, captures d'écran, gifs, etc. <br><br>  <b>src / main / app</b> n'est qu'un exemple d'architecture d'objet de page, il n'est pas nécessaire de l'utiliser, il peut être supprimé. <br><br>  <b>src / test / resources / testng.xml</b> - ici vous devez ajouter de nouvelles classes de test, entre A_BeforeAllTests et A_AfterAllTests <br><br>  <b>src / test / java</b> <br><br><ul><li>  A_BaseTest - la classe de test de base dont toutes les nouvelles classes de test doivent hériter </li><li>  A_BeforeAllTests - initialisation des paramètres et du navigateur avant les tests </li><li>  A_AfterAllTests - génération de rapport après les tests </li><li>  A_ErrorsLogListener - erreurs de journalisation </li><li>  StaticGuestTest - exemple de classe de test </li></ul><br>  <b>Les cours se déroulent dans un ordre spécifique:</b> <br><br><ol><li>  vient d'abord l'initialisation des paramètres et du navigateur - classe <b>A_BeforeAllTests</b> </li><li>  puis testez les autotests </li><li>  et à la fin un rapport est généré - classe <b>A_AfterAllTests</b> </li></ol><br><h3>  Comment travailler avec le framework </h3><br>  <b>Exemple de test</b> <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexPage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ app.open(); app.preparePageForScreenshot(); Comparer.comparePages(<span class="hljs-string"><span class="hljs-string">"index_page"</span></span>); }</code> </pre> <br>  Dans l'exemple ci-dessus, la page s'ouvre simplement, puis la page est préparée pour une capture d'écran, après quoi les captures d'écran attendues et actuelles de la page sont comparées.  Les captures d'écran sont créées et comparées dans tous les points d'arrêt. <br><br>  <b>Pourquoi avons-nous besoin de la fonction preparePageForScreenshot ()</b> : <br><br>  Par défaut, la page défile simplement vers le bas, puis vers le haut à travers js + il y a un deuxième délai.  Ceci est nécessaire pour que toutes les images, styles, etc. puissent être chargés. <br><br>  Toujours dans cette fonction, vous pouvez masquer des éléments inutiles, par exemple, un bloc dynamique avec de la publicité.  Dans mon projet, je cache le pied de page, l'en-tête et la barre latérale, car ils sont les mêmes sur toutes les pages.  Sans ces éléments, les tests fonctionnent plus rapidement et la vérification d'un rapport est plus facile. <br><br>  <b>Pages</b> <br><br>  Comparez les captures d'écran de la page dans tous les points d'arrêt: <br><br><pre> <code class="java hljs">Comparer.comparePages(<span class="hljs-string"><span class="hljs-string">"test_name"</span></span>);</code> </pre> <br>  Comparez les captures d'écran de la page dans tous les points d'arrêt + masquer les éléments: <br><br><pre> <code class="java hljs">Comparer.comparePages(<span class="hljs-string"><span class="hljs-string">"test_name"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"css_locator_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"css_locator_2"</span></span>});</code> </pre> <br>  Comparez les captures d'écran de la page uniquement dans le point d'arrêt spécifié: <br><br><pre> <code class="java hljs">Comparer.comparePagesWithBreakpoint(<span class="hljs-string"><span class="hljs-string">"test_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"1920"</span></span>);</code> </pre> <br>  Comparez les captures d'écran de la page uniquement dans les éléments de point d'arrêt + masqués spécifiés: <br><br><pre> <code class="java hljs">Comparer.comparePagesWithBreakpoint(<span class="hljs-string"><span class="hljs-string">"test_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"1920"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{<span class="hljs-string"><span class="hljs-string">"css_locator_1"</span></span>, <span class="hljs-string"><span class="hljs-string">"css_locator_2"</span></span>});</code> </pre> <br>  <b>Articles</b> <br><br>  Comparez les captures d'écran de l'élément spécifié dans tous les points d'arrêt: <br><br><pre> <code class="java hljs">Comparer.compareElements(<span class="hljs-string"><span class="hljs-string">"test_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"css_locator"</span></span>);</code> </pre> <br>  Comparez les captures d'écran de l'élément spécifié uniquement dans le point d'arrêt spécifié: <br><br><pre> <code class="java hljs">Comparer.compareElementsWithBreakpoint(<span class="hljs-string"><span class="hljs-string">"test_name"</span></span>, <span class="hljs-string"><span class="hljs-string">"1920"</span></span>, <span class="hljs-string"><span class="hljs-string">"css_locator"</span></span>);</code> </pre> <br>  <a href="https://github.com/predewill/VisualRegressionFramework"><b>Lien vers le référentiel du projet</b></a> <br><br><h3>  Problèmes actuels </h3><br><ul><li>  Une zone noire peut être ajoutée à la fin de la capture d'écran, je l'ai rencontré depuis un certain temps.  Le problème a disparu lorsque j'ai commencé à cacher le pied de page.  Il s'agit d'un problème de bibliothèque aShot - <a href="https://github.com/pazone/ashot/issues/169">https://github.com/pazone/ashot/issues/169</a> </li><li>  L'autotest peut ne pas réussir en raison d'une différence de plusieurs pixels.  Le problème est résolu en augmentant la valeur de <b>TestConfig.allowableDiffSize</b> . </li></ul></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr485710/">https://habr.com/ru/post/fr485710/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr485694/index.html">Embox sur processeur Elbrus. Ou n'oublie jamais ce que tu as en intelligence</a></li>
<li><a href="../fr485702/index.html">FunCorp iOS Meetup # 2</a></li>
<li><a href="../fr485704/index.html">Pixel art pour débutants: corriger les erreurs courantes</a></li>
<li><a href="../fr485706/index.html">Nous vous invitons à la réunion «Transformation numérique et nouveaux rôles en science des données»</a></li>
<li><a href="../fr485708/index.html">La blockchain change le fonctionnement de l'industrie ferroviaire</a></li>
<li><a href="../fr485712/index.html">La gestion n'est pas une phrase</a></li>
<li><a href="../fr485718/index.html">Pac-Man: l'histoire inédite de la façon dont nous avons réellement joué à ce jeu</a></li>
<li><a href="../fr485726/index.html">Hack Aircraft - 3</a></li>
<li><a href="../fr485732/index.html">15 février Badoo PHP Meetup # 4. Héritage</a></li>
<li><a href="../fr485738/index.html">Security Week 05: vulnérabilités critiques des dispositifs médicaux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>