<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüöí ‚öìÔ∏è üßôüèª Cinco m√©todos para ofusca√ß√£o de banco de dados üéå üßóüèΩ üî©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Os usu√°rios do ClickHouse j√° sabem que sua maior vantagem √© o processamento em alta velocidade de consultas anal√≠ticas. Mas reivindica√ß√µes como essa p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Cinco m√©todos para ofusca√ß√£o de banco de dados</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/yandex/blog/485096/">  Os usu√°rios do ClickHouse j√° sabem que sua maior vantagem √© o processamento em alta velocidade de consultas anal√≠ticas.  Mas reivindica√ß√µes como essa precisam ser confirmadas com testes de desempenho confi√°veis.  √â sobre isso que queremos falar hoje. <br><br> <a href="https://habr.com/en/company/yandex/blog/457354/"><img src="https://habrastorage.org/webt/ds/2m/sd/ds2msd5-4zeahpzlzptlqz8wgs8.png"></a> <br><br>  Come√ßamos a executar testes em 2013, muito antes de o produto estar dispon√≠vel como c√≥digo aberto.  Naquela √©poca, assim como agora, nossa principal preocupa√ß√£o era a velocidade de processamento de dados no Yandex.Metrica.  Est√°vamos armazenando esses dados no ClickHouse desde janeiro de 2009. Parte dos dados foi gravada em um banco de dados a partir de 2012 e parte foi convertida do <a href="https://clickhouse.yandex/blog/evolution-of-data-structures-in-yandex-metrica">OLAPServer e Metrage</a> (estruturas de dados usadas anteriormente pelo Yandex.Metrica).  Para o teste, pegamos o primeiro subconjunto aleatoriamente dos dados para 1 bilh√£o de visualiza√ß√µes de p√°gina.  O Yandex.Metrica n√£o tinha nenhuma consulta naquele momento, ent√£o criamos consultas que nos interessavam, usando todas as formas poss√≠veis para filtrar, agregar e classificar os dados. <br><br>  O desempenho do ClickHouse foi comparado com sistemas semelhantes como Vertica e MonetDB.  Para evitar vi√©s, o teste foi realizado por um funcion√°rio que n√£o havia participado do desenvolvimento do ClickHouse, e casos especiais no c√≥digo n√£o foram otimizados at√© que todos os resultados fossem obtidos.  Usamos a mesma abordagem para obter um conjunto de dados para testes funcionais. <br><br>  Depois que o ClickHouse foi lan√ßado como c√≥digo aberto em 2016, as pessoas come√ßaram a questionar esses testes. <br><br><a name="habracut"></a><h2>  Faltas de testes em dados privados </h2><br>  Nossos testes de desempenho: <br><br><ol><li>  N√£o pode ser reproduzido de forma independente porque eles usam dados particulares que n√£o podem ser publicados.  Alguns dos testes funcionais n√£o est√£o dispon√≠veis para usu√°rios externos pelo mesmo motivo. </li><li>  Precisa de mais desenvolvimento.  O conjunto de testes precisa ser substancialmente expandido para isolar as altera√ß√µes de desempenho em partes individuais do sistema. </li><li>  N√£o execute por confirma√ß√£o ou para solicita√ß√µes de recebimento individuais.  Os desenvolvedores externos n√£o podem verificar seu c√≥digo para obter regress√µes de desempenho. </li></ol><br>  Poder√≠amos resolver esses problemas realizando os testes antigos e escrevendo novos com base em dados abertos, como <a href="https://clickhouse.yandex/docs/en/getting_started/example_datasets/ontime">dados de voo para os EUA</a> e <a href="https://clickhouse.yandex/docs/en/getting_started/example_datasets/nyc_taxi">viagens de t√°xi em Nova York</a> .  Ou podemos usar benchmarks como TPC-H, TPC-DS e <a href="https://clickhouse.yandex/docs/en/getting_started/example_datasets/star_schema">Star Schema Benchmark</a> .  A desvantagem √© que esses dados s√£o muito diferentes dos dados do Yandex.Metrica e preferimos manter as consultas de teste. <br><br><h2>  Por que √© importante usar dados reais </h2><br>  O desempenho deve ser testado apenas em dados reais de um ambiente de produ√ß√£o.  Vejamos alguns exemplos. <br><br>  <strong>Exemplo 1</strong> <br><br>  Digamos que voc√™ preencha um banco de dados com n√∫meros pseudo-aleat√≥rios distribu√≠dos uniformemente.  A compacta√ß√£o de dados n√£o funcionar√° neste caso, embora a compacta√ß√£o de dados seja essencial para os bancos de dados anal√≠ticos.  N√£o existe uma solu√ß√£o definitiva para o desafio de escolher o algoritmo de compacta√ß√£o correto e a maneira correta de integr√°-lo ao sistema, pois a compacta√ß√£o de dados requer um compromisso entre a velocidade da compacta√ß√£o e descompacta√ß√£o e a potencial efici√™ncia da compacta√ß√£o.  Mas sistemas que n√£o podem compactar dados s√£o perdedores garantidos.  Se seus testes usarem n√∫meros pseudo-aleat√≥rios distribu√≠dos uniformemente, esse fator ser√° ignorado e os resultados ser√£o distorcidos. <br><br>  Conclus√£o: os dados de teste devem ter uma taxa de compacta√ß√£o realista. <br><br>  Cobri a otimiza√ß√£o dos algoritmos de compacta√ß√£o de dados ClickHouse em <a href="https://habr.com/en/company/yandex/blog/457612/">um post anterior</a> . <br><br>  <strong>Exemplo 2</strong> <br><br>  Digamos que estamos interessados ‚Äã‚Äãna velocidade de execu√ß√£o desta consulta SQL: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> RegionID, uniq(UserID) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> visitors <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> test.hits <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> RegionID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> visitors <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre> <br>  Esta √© uma consulta t√≠pica para Yandex.Metrica.  O que afeta a velocidade de processamento? <br><br><ul><li>  Como GROUP BY √© executado. </li><li>  Qual estrutura de dados √© usada para calcular a fun√ß√£o agregada uniq. </li><li>  Quantos RegionIDs diferentes existem e quanta RAM cada estado da fun√ß√£o uniq requer. </li></ul><br>  Mas outro fator importante √© que a quantidade de dados √© distribu√≠da de maneira desigual entre as regi√µes.  (Provavelmente segue uma lei de energia. Coloquei a distribui√ß√£o em um gr√°fico de log-log, mas n√£o posso ter certeza.) Se for esse o caso, √© importante que os estados do agregado uniq funcionem com menos valores. muito pouca mem√≥ria.  Quando existem muitas chaves de agrega√ß√£o diferentes, cada byte conta.  Como podemos obter dados gerados com todas essas propriedades?  A solu√ß√£o √≥bvia √© usar dados reais. <br><br>  Muitos DBMSs implementam a estrutura de dados HyperLogLog para uma aproxima√ß√£o de COUNT (DISTINCT), mas nenhum deles funciona muito bem porque essa estrutura de dados usa uma quantidade fixa de mem√≥ria.  O ClickHouse possui uma fun√ß√£o que usa <a href="https://clickhouse.yandex/docs/en/query_language/agg_functions/reference/">uma combina√ß√£o de tr√™s estruturas de dados diferentes</a> , dependendo do tamanho do conjunto de dados. <br><br>  Conclus√£o: Os dados de teste devem representar bem as propriedades de distribui√ß√£o dos dados reais, significando cardinalidade (n√∫mero de valores distintos por coluna) e cardinalidade entre colunas (n√∫mero de valores diferentes contados em v√°rias colunas diferentes). <br><br>  <strong>Exemplo 3</strong> <br><br>  Em vez de testar o desempenho do DBMS do ClickHouse, vamos usar algo mais simples, como tabelas de hash.  Para tabelas de hash, √© essencial escolher a fun√ß√£o de hash correta.  Isso n√£o √© t√£o importante para std :: unordered_map, porque √© uma tabela de hash baseada em encadeamento e um n√∫mero primo √© usado como o tamanho da matriz.  A implementa√ß√£o da biblioteca padr√£o no GCC e no Clang usa uma fun√ß√£o de hash trivial como a fun√ß√£o de hash padr√£o para tipos num√©ricos.  No entanto, std :: unordered_map n√£o √© a melhor op√ß√£o quando procuramos velocidade m√°xima.  Com uma tabela de hash de endere√ßamento aberto, n√£o podemos simplesmente usar uma fun√ß√£o de hash padr√£o.  Escolher a fun√ß√£o hash correta se torna o fator decisivo. <br><br>  √â f√°cil encontrar testes de desempenho da tabela de hash usando dados aleat√≥rios que n√£o levam em considera√ß√£o as fun√ß√µes de hash usadas.  Tamb√©m h√° muitos testes de fun√ß√£o de hash que se concentram na velocidade de c√°lculo e em certos crit√©rios de qualidade, mesmo que ignorem as estruturas de dados usadas.  Mas o fato √© que as tabelas de hash e o HyperLogLog exigem diferentes crit√©rios de qualidade da fun√ß√£o de hash. <br><br><img src="https://habrastorage.org/webt/bp/3h/32/bp3h320eztrirqzhm-lexeuhmbq.png"><br><br>  Voc√™ pode aprender mais sobre isso em <a href="https://www.youtube.com/watch%3Fv%3DEoX82TEz2sQ">"Como as tabelas de hash funcionam no ClickHouse"</a> (apresenta√ß√£o em russo).  As informa√ß√µes est√£o um pouco desatualizadas, pois n√£o cobrem <a href="https://abseil.io/blog/20180927-swisstables">as tabelas su√≠√ßas</a> . <br><br><h2>  Desafio </h2><br>  Nosso objetivo √© obter dados para testar o desempenho que tenha a mesma estrutura que os dados do Yandex.Metrica com todas as propriedades importantes para os benchmarks, mas de maneira que n√£o restem vest√≠gios de usu√°rios reais do site nesses dados.  Em outras palavras, os dados devem ser anonimizados e ainda preservar: <br><br><ul><li>  Taxa de compress√£o. </li><li>  Cardinalidade (o n√∫mero de valores distintos). </li><li>  Cardinalidade m√∫tua entre v√°rias colunas diferentes. </li><li>  Propriedades das distribui√ß√µes de probabilidade que podem ser usadas para modelagem de dados (por exemplo, se acreditarmos que as regi√µes s√£o distribu√≠das de acordo com uma lei de energia, o expoente - o par√¢metro de distribui√ß√£o - deve ser aproximadamente o mesmo para dados artificiais e dados reais). </li></ul><br>  Como podemos obter uma taxa de compacta√ß√£o semelhante para os dados?  Se LZ4 for usado, as substrings nos dados bin√°rios devem ser repetidas aproximadamente √† mesma dist√¢ncia e as repeti√ß√µes devem ter aproximadamente o mesmo comprimento.  Para o ZSTD, a entropia por byte tamb√©m deve coincidir. <br><br>  O objetivo final √© criar uma ferramenta dispon√≠vel ao p√∫blico que qualquer pessoa possa usar para anonimizar seus conjuntos de dados para publica√ß√£o.  Isso nos permitiria depurar e testar o desempenho nos dados de outras pessoas semelhantes aos nossos dados de produ√ß√£o.  Tamb√©m gostar√≠amos que os dados gerados fossem interessantes. <br><br>  No entanto, esses s√£o requisitos muito pouco definidos e n√£o estamos planejando escrever uma declara√ß√£o formal de problema ou especifica√ß√£o para esta tarefa. <br><br><h2>  Poss√≠veis solu√ß√µes </h2><br>  N√£o quero que pare√ßa que esse problema seja particularmente importante.  Na verdade, nunca foi inclu√≠do no planejamento e ningu√©m tinha a inten√ß√£o de trabalhar nele.  Eu apenas esperava que uma id√©ia surgisse algum dia e, de repente, eu estivesse de bom humor e conseguisse adiar todo o resto at√© mais tarde. <br><br><h2>  Modelos probabil√≠sticos expl√≠citos </h2><br>  A primeira id√©ia √© pegar cada coluna da tabela e encontrar uma fam√≠lia de distribui√ß√µes de probabilidade que o modele, depois ajuste par√¢metros com base nas estat√≠sticas de dados (ajuste de modelo) e use a distribui√ß√£o resultante para gerar novos dados.  Um gerador de n√∫meros pseudo-aleat√≥rios com uma semente predefinida pode ser usado para obter um resultado reproduz√≠vel. <br><br>  Cadeias de Markov podem ser usadas para campos de texto.  Este √© um modelo familiar que pode ser implementado de forma eficaz. <br><br>  No entanto, isso exigiria alguns truques: <br><br><ul><li>  Queremos preservar a continuidade das s√©ries temporais.  Isso significa que, para alguns tipos de dados, precisamos modelar a diferen√ßa entre valores vizinhos e n√£o o valor em si. </li><li>  Para modelar a "cardinalidade conjunta" de colunas, tamb√©m precisamos refletir explicitamente as depend√™ncias entre as colunas.  Por exemplo, geralmente h√° muito poucos endere√ßos IP por ID do usu√°rio, portanto, para gerar um endere√ßo IP, usar√≠amos um valor de hash do ID do usu√°rio como uma semente e tamb√©m adicionar√≠amos uma pequena quantidade de outros dados pseudo-aleat√≥rios. </li><li>  N√£o sabemos ao certo como expressar a depend√™ncia de o mesmo usu√°rio visitar frequentemente URLs com dom√≠nios correspondentes aproximadamente ao mesmo tempo. </li></ul><br>  Tudo isso pode ser escrito em um "script" C ++ com as distribui√ß√µes e depend√™ncias codificadas.  No entanto, os modelos Markov s√£o obtidos a partir de uma combina√ß√£o de estat√≠sticas com suaviza√ß√£o e adi√ß√£o de ru√≠do.  Comecei a escrever um script como esse, mas depois de escrever modelos expl√≠citos para dez colunas, ele se tornou insuportavelmente chato - e a tabela "hits" no Yandex.Metrica tinha mais de 100 colunas em 2012. <br><br><pre> <code class="cpp hljs">EventTime.day(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::discrete_distribution&lt;&gt;({ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, ...})(random)); EventTime.hour(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::discrete_distribution&lt;&gt;({ <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">18</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, <span class="hljs-number"><span class="hljs-number">19</span></span>, ...})(random)); EventTime.minute(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uniform_int_distribution&lt;UInt8&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>)(random)); EventTime.second(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::uniform_int_distribution&lt;UInt8&gt;(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">59</span></span>)(random)); UInt64 UserID = hash(<span class="hljs-number"><span class="hljs-number">4</span></span>, powerLaw(<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>)); UserID = UserID / <span class="hljs-number"><span class="hljs-number">10000000000U</span></span>LL * <span class="hljs-number"><span class="hljs-number">10000000000U</span></span>LL + <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">time_t</span></span>&gt;(EventTime) + UserID % <span class="hljs-number"><span class="hljs-number">1000000</span></span>; random_with_seed.seed(powerLaw(<span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-number"><span class="hljs-number">1.1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> get_random_with_seed = [&amp;]{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> random_with_seed(); };</code> </pre><br>  Essa abordagem foi um fracasso.  Se eu tivesse me esfor√ßado mais, talvez o script estivesse pronto agora. <br><br>  Vantagens: <br><br><ul><li>  Simplicidade conceitual. </li></ul><br>  Desvantagens: <br><br><ul><li>  Grande quantidade de trabalho necess√°ria. </li><li>  A solu√ß√£o se aplica apenas a um tipo de dados. </li></ul><br>  E eu preferiria uma solu√ß√£o mais geral que possa ser usada para dados Yandex.Metrica, bem como para ofuscar qualquer outro dado. <br><br>  De qualquer forma, esta solu√ß√£o pode ser melhorada.  Em vez de selecionar modelos manualmente, poder√≠amos implementar um cat√°logo de modelos e escolher o melhor dentre eles (melhor ajuste mais alguma forma de regulariza√ß√£o).  Ou talvez possamos usar modelos Markov para todos os tipos de campos, n√£o apenas para texto.  Depend√™ncias entre dados tamb√©m podem ser extra√≠das automaticamente.  Isso exigiria o c√°lculo da <a href="https://en.wikipedia.org/wiki/Kullback%25E2%2580%2593Leibler_divergence">entropia</a> relativa (quantidade relativa de informa√ß√µes) entre colunas.  Uma alternativa mais simples √© calcular cardinalidades relativas para cada par de colunas (algo como "quantos valores diferentes de A existem em m√©dia para um valor fixo B").  Por exemplo, isso deixar√° claro que o URLDomain depende totalmente do URL, e n√£o o contr√°rio. <br><br>  Mas eu tamb√©m rejeitei essa id√©ia, porque h√° muitos fatores a serem considerados e levaria muito tempo para ser escrito. <br><br><h2>  Redes neurais </h2><br>  Como j√° mencionei, essa tarefa n√£o estava no topo da lista de prioridades - ningu√©m estava pensando em tentar resolv√™-la.  Mas, por sorte, nosso colega Ivan Puzirevsky lecionava na Escola Superior de Economia.  Ele me perguntou se eu tinha problemas interessantes que funcionariam como t√≥picos de tese adequados para seus alunos.  Quando lhe ofereci este, ele me garantiu que tinha potencial.  Ent√£o, entreguei esse desafio a um cara legal "fora da rua" Sharif (ele tinha que assinar um NDA para acessar os dados). <br><br>  Compartilhei todas as minhas id√©ias com ele, mas enfatizei que n√£o havia restri√ß√µes sobre como o problema poderia ser resolvido, e uma boa op√ß√£o seria tentar abordagens sobre as quais n√£o conhe√ßo nada, como usar o LSTM para gerar um despejo de dados em texto.  Isso pareceu promissor ap√≥s a publica√ß√£o do artigo <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">A efic√°cia irracional das redes neurais recorrentes</a> . <br><br>  O primeiro desafio √© que precisamos gerar dados estruturados, n√£o apenas texto.  Mas n√£o estava claro se uma rede neural recorrente poderia gerar dados com a estrutura desejada.  Existem duas maneiras de resolver isso.  A primeira solu√ß√£o √© usar modelos separados para gerar a estrutura e o "preenchedor" e usar apenas a rede neural para gerar valores.  Mas essa abordagem foi adiada e nunca conclu√≠da.  A segunda solu√ß√£o √© simplesmente gerar um despejo de TSV como texto.  A experi√™ncia mostrou que algumas das linhas no texto n√£o correspondem √† estrutura, mas essas linhas podem ser descartadas ao carregar os dados. <br><br>  O segundo desafio √© que a rede neural recorrente gera uma sequ√™ncia de dados e, portanto, as depend√™ncias nos dados devem seguir na ordem da sequ√™ncia.  Mas, em nossos dados, a ordem das colunas pode potencialmente ser inversa √†s depend√™ncias entre elas. <br>  N√£o fizemos nada para resolver este problema. <br><br>  √Ä medida que o ver√£o se aproximava, tivemos o primeiro script Python que gerava dados.  A qualidade dos dados parecia decente √† primeira vista: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f31/4c0/56f/f314c056f24678ea65fdeec9076991bc.jpg"><br><br>  No entanto, deparamos com algumas dificuldades: <br><br><ol><li>  O tamanho do modelo √© de cerca de um gigabyte.  Tentamos criar um modelo para dados com v√°rios gigabytes de tamanho (para come√ßar).  O fato de o modelo resultante ser t√£o grande suscita preocupa√ß√µes.  Seria poss√≠vel extrair os dados reais nos quais eles foram treinados?  Improv√°vel.  Mas eu n√£o sei muito sobre aprendizado de m√°quina e redes neurais e n√£o li o c√≥digo Python desse desenvolvedor, ent√£o como posso ter certeza?  Havia v√°rios artigos publicados na √©poca sobre como compactar redes neurais sem perda de qualidade, mas n√£o foram implementadas.  Por um lado, isso n√£o parece ser um problema s√©rio, pois podemos optar por n√£o publicar o modelo e apenas publicar os dados gerados.  Por outro lado, se ocorrer super ajuste, os dados gerados podem conter uma parte dos dados de origem. </li><li>  Em uma m√°quina com uma √∫nica CPU, a velocidade de gera√ß√£o de dados √© de aproximadamente 100 linhas por segundo.  Nosso objetivo era gerar pelo menos um bilh√£o de linhas.  Os c√°lculos mostraram que isso n√£o seria conclu√≠do antes da data da defesa da tese.  N√£o fazia sentido usar hardware adicional, porque o objetivo era criar uma ferramenta de gera√ß√£o de dados que pudesse ser usada por qualquer pessoa. </li></ol><br>  Sharif tentou analisar a qualidade dos dados comparando estat√≠sticas.  Entre outras coisas, ele calculou a frequ√™ncia de caracteres diferentes ocorrendo nos dados de origem e nos dados gerados.  O resultado foi impressionante: os caracteres mais frequentes foram √ê e √ë. <br><br>  N√£o se preocupe com Sharif, no entanto.  Ele defendeu com sucesso sua tese e, em seguida, nos esquecemos felizes da coisa toda. <br><br><h2>  Muta√ß√£o de dados compactados </h2><br>  Vamos supor que a declara√ß√£o do problema tenha sido reduzida a um √∫nico ponto: precisamos gerar dados com a mesma taxa de compacta√ß√£o que os dados de origem e os dados devem ser descomprimidos na mesma velocidade.  Como podemos conseguir isso?  Precisamos editar bytes de dados compactados diretamente!  Isso nos permite alterar os dados sem alterar o tamanho dos dados compactados, al√©m de tudo funcionar r√°pido.  Eu queria experimentar essa id√©ia imediatamente, apesar do fato de que o problema que ela resolve n√£o √© o mesmo que come√ßamos.  Mas √© assim que sempre √©. <br><br>  Ent√£o, como editamos um arquivo compactado?  Digamos que estamos interessados ‚Äã‚Äãapenas no LZ4.  Os dados compactados do LZ4 s√£o compostos por sequ√™ncias, que por sua vez s√£o cadeias de bytes n√£o compactados (literais), seguidas por uma c√≥pia de correspond√™ncia: <br><br><ol><li>  Literais (copie os seguintes N bytes como est√£o). </li><li>  Corresponde a um comprimento m√≠nimo de repeti√ß√£o de 4 (N bytes de repeti√ß√£o que estavam no arquivo a uma dist√¢ncia de M). </li></ol><br>  Dados de origem: <br>  <code>Hello world Hello</code> . <br><br>  Dados compactados (exemplo arbitr√°rio): <br>  <code>literals 12 "Hello world " match 5 12</code> . <br><br>  No arquivo compactado, deixamos "match" como est√° e alteramos os valores de byte em "literais".  Como resultado, ap√≥s a descompacta√ß√£o, obtemos um arquivo no qual todas as seq√º√™ncias repetidas de pelo menos 4 bytes tamb√©m s√£o repetidas na mesma dist√¢ncia, mas consistem em um conjunto diferente de bytes (basicamente, o arquivo modificado n√£o cont√©m um √∫nico byte que foi retirado do arquivo de origem). <br><br>  Mas como mudamos os bytes?  A resposta n√£o √© √≥bvia, porque al√©m dos tipos de coluna, os dados tamb√©m t√™m sua pr√≥pria estrutura impl√≠cita e interna que gostar√≠amos de preservar.  Por exemplo, o texto geralmente √© armazenado na codifica√ß√£o UTF-8 e queremos que os dados gerados tamb√©m sejam UTF-8 v√°lidos.  Eu desenvolvi uma heur√≠stica simples que envolve atender a v√°rios crit√©rios: <br><br><ul><li>  Bytes nulos e caracteres de controle ASCII s√£o mantidos como est√£o. </li><li>  Alguns caracteres de pontua√ß√£o permanecem como est√£o. </li><li>  O ASCII √© convertido em ASCII e, para todo o resto, o bit mais significativo √© preservado (ou um conjunto expl√≠cito de instru√ß√µes "if" √© gravado para diferentes comprimentos UTF-8).  Em uma classe de bytes, um novo valor √© escolhido uniformemente aleatoriamente. </li><li>  Fragmentos como <code>https://</code> s√£o preservados, caso contr√°rio, parece um pouco bobo. </li></ul><br>  A √∫nica ressalva a essa abordagem √© que o modelo de dados s√£o os pr√≥prios dados de origem, o que significa que n√£o podem ser publicados.  O modelo √© adequado apenas para gerar quantidades de dados n√£o maiores que a fonte.  Pelo contr√°rio, as abordagens anteriores fornecem modelos que permitem gerar dados de tamanho arbitr√°rio. <br><br>  Exemplo para um URL: <br><br> <code>http://ljc.she/kdoqdqwpgafe/klwlpm&amp;qw=962788775I0E7bs7OXeAyAx <br> http://ljc.she/kdoqdqwdffhant.am/wcpoyodjit/cbytjgeoocvdtclac <br> http://ljc.she/kdoqdqwpgafe/klwlpm&amp;qw=962788775I0E7bs7OXe <br> http://ljc.she/kdoqdqwdffhant.am/wcpoyodjit/cbytjgeoocvdtclac <br> http://ljc.she/kdoqdqwdbknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu_qxht <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu_qxht <br> http://ljc.she/kdoqdqw-bknvj.s/hmqhpsavon.yf#aortxqdvjja <br> http://ljc.she/kdoqdqwpdtu-Unu-Rjanjna-bbcohu-702130 <br></code> <br>  Os resultados foram positivos e os dados foram interessantes, mas algo n√£o estava certo.  Os URLs mantinham a mesma estrutura, mas em alguns deles era muito f√°cil reconhecer "yandex" ou "avito" (um mercado popular na R√∫ssia), ent√£o criei uma heur√≠stica que troca alguns bytes. <br><br>  Havia outras preocupa√ß√µes tamb√©m.  Por exemplo, informa√ß√µes confidenciais poderiam residir em uma coluna FixedString na representa√ß√£o bin√°ria e, potencialmente, consistir em caracteres de controle ASCII e pontua√ß√£o, que decidi preservar.  No entanto, n√£o levei em considera√ß√£o os tipos de dados. <br><br>  Outro problema √© que, se uma coluna armazena dados no formato "comprimento, valor" (√© assim que as colunas String s√£o armazenadas), como posso garantir que o comprimento permane√ßa correto ap√≥s a muta√ß√£o?  Quando tentei consertar isso, perdi o interesse imediatamente. <br><br><h2>  Permuta√ß√µes aleat√≥rias </h2><br>  Infelizmente, o problema n√£o foi resolvido.  Realizamos alguns experimentos, e ficou pior.  A √∫nica coisa que restava era ficar sentado sem fazer nada e navegar na web aleatoriamente, j√° que a m√°gica se fora.  Felizmente, me deparei com uma p√°gina que <a href="http://fabiensanglard.net/fizzlefade/index.php">explicava o algoritmo</a> para renderizar a morte do personagem principal no jogo Wolfenstein 3D. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6d4/974/bc8/6d4974bc880538a894617dfb0c77eb3d.gif" width="640" height="480"><br><br>  A anima√ß√£o √© realmente muito boa - a tela se enche de sangue.  O artigo explica que essa √© realmente uma permuta√ß√£o pseudo-aleat√≥ria.  Uma permuta√ß√£o aleat√≥ria de um conjunto de elementos √© uma transforma√ß√£o bijetiva (um a um) escolhida aleatoriamente do conjunto, ou um mapeamento em que cada elemento derivado corresponde exatamente a um elemento original (e vice-versa).  Em outras palavras, √© uma maneira de iterar aleatoriamente todos os elementos de um conjunto de dados.  E esse √© exatamente o processo mostrado na figura: cada pixel √© preenchido em ordem aleat√≥ria, sem repeti√ß√£o.  Se escolhermos apenas um pixel aleat√≥rio em cada etapa, levar√° muito tempo para chegar ao √∫ltimo. <br><br>  O jogo usa um algoritmo muito simples para permuta√ß√£o pseudo-aleat√≥ria chamado registro de deslocamento de feedback linear ( <a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register">LFSR</a> ).  Semelhante a geradores de n√∫meros pseudo-aleat√≥rios, permuta√ß√µes aleat√≥rias, ou melhor, suas fam√≠lias, podem ser criptograficamente fortes quando parametrizados por uma chave.  √â exatamente isso que precisamos para a transforma√ß√£o de dados.  No entanto, os detalhes podem ser mais complicados.  Por exemplo, a criptografia criptograficamente forte de N bytes a N bytes com uma chave pr√©-determinada e um vetor de inicializa√ß√£o parece funcionar para uma permuta√ß√£o pseudo-aleat√≥ria de um conjunto de cadeias de caracteres de N bytes.  De fato, essa √© uma transforma√ß√£o individual e parece ser aleat√≥ria.  Mas se usarmos a mesma transforma√ß√£o para todos os nossos dados, o resultado poder√° ser suscet√≠vel √† criptoan√°lise, porque o mesmo vetor de inicializa√ß√£o e valor da chave s√£o usados ‚Äã‚Äãv√°rias vezes.  √â semelhante ao modo de opera√ß√£o do <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">livro</a> de <a href="https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation">c√≥digos eletr√¥nico</a> para uma cifra de bloco. <br><br>  Quais s√£o as formas poss√≠veis de obter uma permuta√ß√£o pseudo-aleat√≥ria?  Podemos realizar transforma√ß√µes individuais simples e criar uma fun√ß√£o complexa que parece aleat√≥ria.  Aqui est√£o algumas das minhas transforma√ß√µes individuais favoritas: <br><br><ul><li>  Multiplica√ß√£o por um n√∫mero √≠mpar (como um grande n√∫mero primo) na aritm√©tica do complemento de dois. </li><li>  Deslocamento <code>x ^= x &gt;&gt; N</code> : <code>x ^= x &gt;&gt; N</code> </li><li>  CRC-N, onde N √© o n√∫mero de bits no argumento. </li></ul><br>  Por exemplo, tr√™s multiplica√ß√µes e duas opera√ß√µes xorshift s√£o usadas para o finalizador de <a href="">sopro</a> .  Esta opera√ß√£o √© uma permuta√ß√£o pseudo-aleat√≥ria.  No entanto, devo salientar que as fun√ß√µes de hash n√£o precisam ser um para um (mesmo hashes de N bits a N bits). <br><br>  Ou aqui est√° outro <a href="https://preshing.com/20121224/how-to-generate-a-sequence-of-unique-random-integers/">exemplo</a> interessante <a href="https://preshing.com/20121224/how-to-generate-a-sequence-of-unique-random-integers/">da teoria elementar dos n√∫meros</a> no site de Jeff Preshing. <br><br>  Como podemos usar permuta√ß√µes pseudo-aleat√≥rias para resolver nosso problema?  Podemos us√°-los para transformar todos os campos num√©ricos para preservar as cardinalidades e cardinalidades m√∫tuas de todas as combina√ß√µes de campos.  Em outras palavras, COUNT (DISTINCT) retornar√° o mesmo valor que antes da transforma√ß√£o e, al√©m disso, com qualquer GROUP BY. <br><br>  Vale ressaltar que a preserva√ß√£o de todas as cardinalidades contradiz de alguma forma nosso objetivo de anonimiza√ß√£o dos dados.  Digamos que algu√©m saiba que os dados de origem das sess√µes do site cont√™m um usu√°rio que visitou sites de 10 pa√≠ses diferentes e desejam encontrar esse usu√°rio nos dados transformados.  Os dados transformados tamb√©m mostram que o usu√°rio visitou sites de 10 pa√≠ses diferentes, o que facilita a busca.  Mesmo que eles descubram em que o usu√°rio foi transformado, isso n√£o ser√° muito √∫til, porque todos os outros dados tamb√©m foram transformados, para que eles n√£o consigam descobrir em quais sites o usu√°rio visitou ou qualquer outra coisa.  Mas essas regras podem ser aplicadas em cadeia.  Por exemplo, se algu√©m sabe que o site que ocorre com mais frequ√™ncia em nossos dados √© o Yandex, com o Google em segundo lugar, ele pode usar a classifica√ß√£o para determinar quais identificadores de site transformados realmente significam Yandex e Google.  N√£o h√° nada de surpreendente nisso, pois estamos trabalhando com uma declara√ß√£o informal de problemas e estamos apenas tentando encontrar um equil√≠brio entre o anonimato dos dados (oculta√ß√£o de informa√ß√µes) e a preserva√ß√£o das propriedades dos dados (revela√ß√£o de informa√ß√µes).  Para obter informa√ß√µes sobre como abordar o problema de anonimiza√ß√£o de dados com mais confiabilidade, leia este <a href="https://medium.com/georgian-impact-blog/a-brief-introduction-to-differential-privacy-eacf8722283b">artigo</a> . <br><br>  Al√©m de manter a cardinalidade original dos valores, tamb√©m quero manter a ordem de magnitude dos valores.  O que quero dizer √© que, se os dados de origem contiverem n√∫meros abaixo de 10, desejo que os n√∫meros transformados tamb√©m sejam pequenos.  Como podemos conseguir isso? <br><br>  Por exemplo, podemos dividir um conjunto de valores poss√≠veis em classes de tamanho e executar permuta√ß√µes dentro de cada classe separadamente (mantendo as classes de tamanho).  A maneira mais f√°cil de fazer isso √© usar a pot√™ncia mais pr√≥xima de duas ou a posi√ß√£o do bit mais significativo no n√∫mero como a classe de tamanho (estas s√£o a mesma coisa).  Os n√∫meros 0 e 1 sempre permanecer√£o como est√£o.  Os n√∫meros 2 e 3 √†s vezes permanecem como est√£o (com probabilidade de 1/2) e √†s vezes s√£o trocados (com probabilidade de 1/2).  O conjunto de n√∫meros 1024. 2047 ser√° mapeado para um dos 1024!  variantes (fatoriais) e assim por diante.  Para n√∫meros assinados, manteremos o sinal. <br><br>  Tamb√©m √© duvidoso que precisamos de uma fun√ß√£o individual.  Provavelmente, podemos apenas usar uma fun√ß√£o hash criptograficamente forte.  A transforma√ß√£o n√£o ser√° individual, mas a cardinalidade ser√° pr√≥xima da mesma. <br><br>  No entanto, precisamos de uma permuta√ß√£o aleat√≥ria criptograficamente forte para que, quando definirmos uma chave e derivarmos uma permuta√ß√£o com essa chave, seria dif√≠cil restaurar os dados originais dos dados reorganizados sem conhec√™-la. <br><br>  H√° um problema: al√©m de n√£o saber nada sobre redes neurais e aprendizado de m√°quina, tamb√©m sou bastante ignorante quando se trata de criptografia.  Isso deixa apenas minha coragem.  Eu ainda estava lendo p√°ginas aleat√≥rias da web e encontrei um link no <a href="https://news.ycombinator.com/item%3Fid%3D15122540">Hackers News</a> para uma discuss√£o na p√°gina de Fabien Sanglard.  Tinha um link para um <a href="http://antirez.com/news/113">post</a> do desenvolvedor do Redis, Salvatore Sanfilippo, que falava sobre o uso de uma maneira gen√©rica maravilhosa de obter permuta√ß√µes aleat√≥rias, conhecida como <a href="https://en.wikipedia.org/wiki/Feistel_cipher">rede Feistel</a> . <br><br>  A rede Feistel √© iterativa, composta por rodadas.  Cada rodada √© uma transforma√ß√£o not√°vel que permite que voc√™ obtenha uma fun√ß√£o individual de qualquer fun√ß√£o.  Vamos ver como isso funciona. <br><br><ol><li>  Os bits do argumento s√£o divididos em duas metades: <br> <code>arg: xxxxyyyy <br> <font color="#0fc000">arg_l</font> : xxxx <br> <font color="#0000ff">arg_r</font> : yyyy</code> </li> <li>  A metade direita substitui a esquerda.  Em seu lugar, colocamos o resultado de XOR no valor inicial da metade esquerda e o resultado da fun√ß√£o aplicada ao valor inicial da metade direita, assim: <br> <code>res: yyyyzzzz <br> <font color="#0000ff">res_l</font> = yyyy = <font color="#0000ff">arg_r</font> <br> <font color="#FF6600">res_r</font> = zzzz = <font color="#0fc000">arg_l</font> ^ F( <font color="#0000ff">arg_r</font> )</code> </li> </ol><br>  H√° tamb√©m uma alega√ß√£o de que, se usarmos uma fun√ß√£o pseudo-aleat√≥ria criptograficamente forte para F e aplicar uma rodada de Feistel pelo menos 4 vezes, obteremos uma permuta√ß√£o pseudo-aleat√≥ria criptograficamente forte. <br><br>  Isso √© como um milagre: pegamos uma fun√ß√£o que produz lixo aleat√≥rio com base em dados, inserimos na rede Feistel e agora temos uma fun√ß√£o que produz lixo aleat√≥rio com base em dados, mas, no entanto, √© invert√≠vel! <br><br>  A rede Feistel est√° no centro de v√°rios algoritmos de criptografia de dados.  O que vamos fazer √© algo como criptografia, s√≥ que √© muito ruim.  H√° duas raz√µes para isso: <br><br><ul><li>  Estamos criptografando valores individuais de forma independente e da mesma maneira, semelhante ao modo de opera√ß√£o do Electronic Codebook. </li><li>  Estamos armazenando informa√ß√µes sobre a ordem de magnitude (a pot√™ncia mais pr√≥xima de duas) e o sinal do valor, o que significa que alguns valores n√£o mudam. </li></ul><br>  Dessa forma, podemos ofuscar os campos num√©ricos enquanto preservamos as propriedades necess√°rias.  Por exemplo, depois de usar o LZ4, a taxa de compacta√ß√£o deve permanecer aproximadamente a mesma, porque os valores duplicados nos dados de origem ser√£o repetidos nos dados convertidos e nas mesmas dist√¢ncias entre si. <br><br><h2>  Modelos de Markov </h2><br>  Os modelos de texto s√£o usados ‚Äã‚Äãpara compacta√ß√£o de dados, entrada preditiva, reconhecimento de fala e gera√ß√£o aleat√≥ria de cadeias.  Um modelo de texto √© uma distribui√ß√£o de probabilidade de todas as seq√º√™ncias poss√≠veis.  Digamos que temos uma distribui√ß√£o de probabilidade imagin√°ria dos textos de todos os livros que a humanidade poderia escrever.  Para gerar uma string, apenas pegamos um valor aleat√≥rio com essa distribui√ß√£o e retornamos a string resultante (um livro aleat√≥rio que a humanidade poderia escrever).  Mas como descobrimos a distribui√ß√£o de probabilidade de todas as seq√º√™ncias poss√≠veis? <br><br>  Primeiro, isso exigiria muita informa√ß√£o.  Existem 256 ^ 10 sequ√™ncias poss√≠veis com 10 bytes de comprimento e seria necess√°rio bastante mem√≥ria para escrever explicitamente uma tabela com a probabilidade de cada sequ√™ncia.  Segundo, n√£o temos estat√≠sticas suficientes para avaliar com precis√£o a distribui√ß√£o. <br><br>  √â por isso que usamos uma distribui√ß√£o de probabilidade obtida de estat√≠sticas aproximadas como modelo de texto.  Por exemplo, podemos calcular a probabilidade de cada letra que ocorre no texto e, em seguida, gerar strings selecionando cada letra seguinte com a mesma probabilidade.  Esse modelo primitivo funciona, mas as strings ainda s√£o muito antinaturais. <br><br>  Para melhorar um pouco o modelo, tamb√©m poder√≠amos fazer uso da probabilidade condicional da ocorr√™ncia da letra se ela for precedida por N letras espec√≠ficas.  N √© uma constante predefinida.  Digamos N = 5 e estamos calculando a probabilidade da letra "e" ocorrer ap√≥s as letras "compr".  Esse modelo de texto √© chamado de modelo Order-N Markov. <br><br> <code>P(cat <font color="#ff0000">a</font> | cat) = 0.8 <br> P(cat <font color="#ff0000">b</font> | cat) = 0.05 <br> P(cat <font color="#ff0000">c</font> | cat) = 0.1 <br> ...</code> <br> <br>  Vejamos como os modelos de Markov funcionam no site <a href="https://projects.haykranen.nl/markov/demo/">da Hay Kranen</a> .  Diferentemente das redes neurais LSTM, os modelos t√™m mem√≥ria suficiente para um pequeno contexto de N de comprimento fixo, gerando textos engra√ßados e sem sentido.  Os modelos Markov tamb√©m s√£o usados ‚Äã‚Äãem m√©todos primitivos para gerar spam, e os textos gerados podem ser facilmente distinguidos dos reais contando estat√≠sticas que n√£o se encaixam no modelo.  H√° uma vantagem: os modelos de Markov funcionam muito mais r√°pido que as redes neurais, que √© exatamente o que precisamos. <br><br>  Exemplo de t√≠tulo (nossos exemplos est√£o em turco devido aos dados utilizados): <br><br><blockquote>  Hyunday Butter'dan anket shluha - Politika head man≈üetleri |  STALKER BOXER Livro de luxo - Yanudistkarƒ±≈ümanlƒ± Mƒ± Kanal |  League el Digitalika Haberler Haberleri - Haberlerisi - Hot√©is com Centry'ler Neden babah.com </blockquote><br>  Podemos calcular estat√≠sticas a partir dos dados de origem, criar um modelo de Markov e gerar novos dados com ele.  Observe que o modelo precisa de suaviza√ß√£o para evitar a divulga√ß√£o de informa√ß√µes sobre combina√ß√µes raras nos dados de origem, mas isso n√£o √© um problema.  Eu uso uma combina√ß√£o de modelos de 0 a N. Se as estat√≠sticas forem insuficientes para o modelo da ordem N, o modelo N-1 ser√° usado. <br><br>  Mas ainda queremos preservar a cardinalidade dos dados.  Em outras palavras, se os dados de origem tiverem 123456 valores de URL exclusivos, o resultado dever√° ter aproximadamente o mesmo n√∫mero de valores exclusivos.  Podemos usar um gerador de n√∫meros aleat√≥rios inicializado deterministicamente para conseguir isso.  A maneira mais f√°cil de fazer isso √© usar uma fun√ß√£o de hash e aplic√°-la ao valor original.  Em outras palavras, obtemos um resultado pseudo-aleat√≥rio que √© explicitamente determinado pelo valor original. <br><br>  Outro requisito √© que os dados de origem possam ter muitos URLs diferentes que come√ßam com o mesmo prefixo, mas n√£o s√£o id√™nticos.  Por exemplo: <code>https://www.yandex.ru/images/cats/?id=xxxxxx</code> .  Queremos que o resultado tamb√©m tenha URLs que todos come√ßam com o mesmo prefixo, mas um diferente.  Por exemplo: <code>http://ftp.google.kz/cgi-bin/index.phtml?item=xxxxxx</code> .  Como um gerador de n√∫meros aleat√≥rios para gerar o pr√≥ximo caractere usando um modelo de Markov, usaremos uma fun√ß√£o hash de uma janela m√≥vel de 8 bytes na posi√ß√£o especificada (em vez de remov√™-la de toda a cadeia). <br><br> <code>https://www.yandex.ru/ <font color="#0fc000">images/c</font> ats/?id=12345 <br> ^^^^^^^^ <br> <br> distribution: [aaaa][b][cc][dddd][e][ff][g <font color="#ff0000">g</font> ggg][h]... <br> hash(" <font color="#0fc000">images/c</font> ") % total_count:           ^ <br> <br></code> <code>http://ftp.google.kz/c <font color="#ff0000">g</font> ...</code> <br> <br>  Acontece ser exatamente o que precisamos.  Aqui est√° o exemplo dos t√≠tulos das p√°ginas: <br><br><blockquote><pre>  PhotoFunia - Haber7 - Hava m√ºkemment.net Oynamak i√ßinde ≈üa≈üƒ±racak haber, Oyunu Oynanƒ±lmaz ‚Ä¢ apr√≥d.hu k√≠n√°lat√°ban - RT Arabic
 PhotoFunia - Kinobar.Net - abr: Ingyenes |  Posti
 PhotoFunia - Peg Perfeo - Castika, Sƒ±radƒ±≈üƒ± Deniz Lokoning Your Code, senhor Eminema.tv/
 PhotoFunia - TUT.BY - Seu Ayakkanƒ±n ve Son Dakika Spor,
 PhotoFunia - grande filme, Del Meireles offilim, Samsung DealeXtreme Deƒüerler NEWSru.com.tv, Smotri.com Celular
 PhotoFunia 5 |  Galaxy, gt, dupƒÉ ce analgi yarak Ceza RE050A V-Stran√ß
 PhotoFunia :: V√≠deo de Miami Haberler Oyun Young
 PhotoFunia Monstelli'nin Em ƒ∞yi kisa.com.tr - Star Thunder Ekranƒ±
 PhotoFunia Seks - Pol√≠tica, Economia, Spor GTA SANAYƒ∞ VE
 TVFunia Starker Rating Star Resmi S√∂ylenen Yataƒüa ka≈ºdy dzie≈º wierzchnie
 PhotoFunia TourIndex.Marketime oyunu Oyna Geldoll Mynet Spor, Magazin, Haberler yerel Haberleri ve Solvia, colabora√ß√£o Ev SahneTv
 Todo o PhotoFunia no fotograma de Partida alegre gr√°tis
 PhotoFunian D√ºnyasƒ±n takƒ±mƒ±z halles en kullarƒ± - TEZ
</pre></blockquote><br><h2>  Resultados </h2><br>  Depois de tentar quatro m√©todos, fiquei t√£o cansado desse problema que chegou a hora de escolher algo, transform√°-lo em uma ferramenta utiliz√°vel e anunciar a solu√ß√£o.  Eu escolhi a solu√ß√£o que usa permuta√ß√µes aleat√≥rias e modelos de Markov parametrizados por uma chave.  √â implementado como o programa <b>clickhouse-obfuscator</b> , que √© muito f√°cil de usar.  A entrada √© um despejo de tabela em <a href="https://clickhouse.yandex/docs/en/interfaces/formats/">qualquer formato suportado</a> (como CSV ou JSONEachRow) e os par√¢metros da linha de comandos especificam a estrutura da tabela (nomes e tipos de colunas) e a chave secreta (qualquer sequ√™ncia que voc√™ possa esquecer imediatamente ap√≥s o uso).  A sa√≠da √© o mesmo n√∫mero de linhas de dados ofuscados. <br><br>  O programa √© instalado com o clickhouse-client, n√£o possui depend√™ncias e funciona em praticamente qualquer sabor do Linux.  Voc√™ pode aplic√°-lo a qualquer despejo de banco de dados, n√£o apenas ao ClickHouse.  Por exemplo, voc√™ pode gerar dados de teste dos bancos de dados MySQL ou PostgreSQL ou criar bancos de dados de desenvolvimento semelhantes aos bancos de dados de produ√ß√£o. <br><br> <code>clickhouse-obfuscator \ <br> --seed "$(head -c16 /dev/urandom | base64)" \ <br> --input-format TSV --output-format TSV \ <br> --structure 'CounterID UInt32, URLDomain String, \ <br> URL String, SearchPhrase String, Title String' \ <br> &lt; table.tsv &gt; result.tsv <br> <br> clickhouse-obfuscator --help <br></code> <br>  Obviamente, tudo n√£o √© t√£o f√°cil de cortar e secar, porque os dados transformados por esse programa s√£o quase completamente revers√≠veis.  A quest√£o √© se √© poss√≠vel executar a transforma√ß√£o reversa sem conhecer a chave.  Se a transforma√ß√£o usasse um algoritmo criptogr√°fico, essa opera√ß√£o seria t√£o dif√≠cil quanto uma pesquisa de for√ßa bruta.  Embora a transforma√ß√£o use algumas primitivas criptogr√°ficas, elas n√£o s√£o usadas da maneira correta e os dados s√£o suscet√≠veis a certos m√©todos de an√°lise.  Para evitar problemas, esses problemas s√£o abordados na documenta√ß√£o do programa (acesse-o usando <code>--help</code> ). <br><br>  No final, transformamos o conjunto de dados que precisamos <a href="https://clickhouse.yandex/docs/en/getting_started/example_datasets/metrica/">para testes funcionais e de desempenho</a> e o Yandex VP de publica√ß√£o aprovada em seguran√ßa de dados. <br><br>  <a href="">clickhouse-datasets.s3.yandex.net/hits/tsv/hits_v1.tsv.xz</a> <br>  <a href="">clickhouse-datasets.s3.yandex.net/visits/tsv/visits_v1.tsv.xz</a> <br><br>  Os desenvolvedores que n√£o s√£o Yandex usam esses dados para testes de desempenho reais ao otimizar algoritmos dentro do ClickHouse.  Usu√°rios de terceiros podem nos fornecer seus dados ofuscados para que possamos tornar o ClickHouse ainda mais r√°pido para eles.  Tamb√©m lan√ßamos um benchmark aberto independente para fornecedores de hardware e nuvem com base <a href="https://clickhouse.yandex/benchmark_hardware.html">nesses</a> dados: <a href="https://clickhouse.yandex/benchmark_hardware.html">clickhouse.yandex/benchmark_hardware.html</a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt485096/">https://habr.com/ru/post/pt485096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt485084/index.html">Pl√¢ncton de escrit√≥rio - Evolu√ß√£o</a></li>
<li><a href="../pt485088/index.html">Ancinho retrospectivo. Como uma solu√ß√£o criada por si mesma foi mais fria do que paga</a></li>
<li><a href="../pt485090/index.html">O segredo da efici√™ncia √© o c√≥digo de qualidade, n√£o um gerente eficaz</a></li>
<li><a href="../pt485092/index.html">Valida√ß√£o de dados em aplicativos iOS</a></li>
<li><a href="../pt485094/index.html">Microsservi√ßos com Spring Boot. Parte 3. Criando um microsservi√ßo de convers√£o de moeda</a></li>
<li><a href="../pt485098/index.html">O design pode afetar a velocidade de entrega?</a></li>
<li><a href="../pt485100/index.html">Onde ir: os pr√≥ximos eventos gratuitos para desenvolvedores em Moscou (30 de janeiro a 15 de fevereiro)</a></li>
<li><a href="../pt485102/index.html">Topleaked: uma ferramenta para detectar vazamentos de mem√≥ria</a></li>
<li><a href="../pt485104/index.html">Criando uma chave RFID universal para interfones</a></li>
<li><a href="../pt485108/index.html">Estat√≠sticas de especialistas certificados em PMI na R√∫ssia em 10/01/2020</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>