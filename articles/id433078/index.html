<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü¶ê üÖ±Ô∏è üßëüèø‚Äçü§ù‚Äçüßëüèª Kami menulis robot perdagangan menggunakan kerangka kerja grafis StockSharp. Bagian 2 ü§±üèº üò¢ ‚òπÔ∏è</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kami terus berbicara tentang membuat robot perdagangan menggunakan platform StockSharp . Artikel pertama membahas tentang pembuatan proyek dan menggam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kami menulis robot perdagangan menggunakan kerangka kerja grafis StockSharp. Bagian 2</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/iticapital/blog/433078/"> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/bv/ll/xa/bvllxaiaoeshjg0_71xwfocozqa.png"></a> <br><br>  Kami terus berbicara tentang membuat robot perdagangan menggunakan platform <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">StockSharp</a> .  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Artikel pertama</a> membahas tentang pembuatan proyek dan menggambar elemen-elemen utama dari sistem perdagangan.  Dalam materi akhir siklus, kami akan langsung menerapkan strategi perdagangan. <a name="habracut"></a><br><br><h2>  Membuat panel portofolio </h2><br>  Dengan analogi dengan bilah alat, buat panel log.  Untuk melakukan ini, tambahkan UserControl lain ke folder XAML.  Beri nama PortfolioGridControl.  Tambahkan elemen PortfolioGrid ke sana. <br><br><pre><code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.PortfolioGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:PortfolioGrid x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGrid"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Dalam konstruktor PortofolioGridControl, kita perlu berlangganan ke acara kemunculan portofolio baru dan acara kemunculan posisi baru di Connector. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PortfolioGridControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.Connector.NewPortfolio += PortfolioGrid.Portfolios.Add; MainWindow.Instance.Connector.NewPosition += PortfolioGrid.Positions.Add; }</code> </pre> <br>  Jadi, ketika membuat portofolio baru, itu akan muncul di panel portofolio, dan ketika posisi baru muncul di panel portofolio, itu akan diperbarui. <br><br>  Di bagian tengah MainWindow, tambahkan panel PortfolioGridControl yang dibuat: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Jalankan untuk memeriksa: <br><br><img src="https://habrastorage.org/webt/bz/vs/tl/bzvstlk5xgb54mycansuoqjozhu.png"><br><br>  Kami memiliki tab dengan portofolio. <br><br><h2>  Membuat panel pesanan </h2><br>  Bilah pesanan di S # .API memiliki kemampuan untuk melakukan pemesanan, menarik pesanan, dan mendaftar ulang.  Dengan analogi dengan bilah alat, buat panel pesanan, tambahkan UserControl lain ke folder XAML.  Beri nama OrderGridControl.  Tambahkan elemen OrderGrid ke dalamnya: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.OrderGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:OrderGrid x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGrid"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  OrderGrid memiliki acara pendaftaran OrderRegistering, acara registrasi ulang OrderReRegistering, dan acara pembatalan OrderCanceling. <br><br>  Mari kita buat penangan mereka: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.OrderGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:OrderGrid x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGrid"</span></span> OrderRegistering=<span class="hljs-string"><span class="hljs-string">"OrderGrid_OnOrderRegistering"</span></span> OrderReRegistering=<span class="hljs-string"><span class="hljs-string">"OrderGrid_OnOrderReRegistering"</span></span> OrderCanceling=<span class="hljs-string"><span class="hljs-string">"OrderGrid_OnOrderCanceling"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Dalam penangan event pendaftaran permintaan, kami membuat jendela OrderWindow di mana Anda perlu menentukan sumber data untuk instrumen, portofolio, dan data pasar.  Dalam kasus kami, semuanya akan menjadi Connector. <br><br>  Lalu kami memanggil OrderWindow dengan metode ShowModal.  Jika tombol OK ditekan di jendela ini, maka melalui konektor kami mendaftar menggunakan metode RegisterOrder: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGrid_OnOrderRegistering</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newOrder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrderWindow { Title = <span class="hljs-string"><span class="hljs-string">"Order registering"</span></span>, Order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order(), SecurityProvider = MainWindow.Instance.Connector, MarketDataProvider = MainWindow.Instance.Connector, Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector), }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newOrder.ShowModal(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) MainWindow.Instance.Connector.RegisterOrder(newOrder.Order); }</code> </pre> <br>  Dalam event handler pendaftaran ulang acara, kami melakukan semuanya dengan cara yang sama.  Hanya dalam kasus ini, objek Order datang ke acara - ini adalah pesanan yang perlu didaftarkan ulang.  Oleh karena itu, di OrderWindow, kami menentukan <code>Order = order.ReRegisterClone(newVolume: order.Balance)</code> untuk mengisi bidang jendela OrderWindow. <br><br>  Lalu kami memanggil OrderWindow dengan metode ShowModal.  Jika tombol OK diklik di jendela ini, maka kami akan mendaftar ulang aplikasi melalui konektor menggunakan metode ReRegisterClone.  Kami mentransfer ke sana aplikasi lama, yang harus dibatalkan, dan yang baru, yang harus ditetapkan. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGrid_OnOrderReRegistering</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Order order)</span></span></span><span class="hljs-function"> </span></span>{ var window = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OrderWindow { Title = <span class="hljs-string"><span class="hljs-string">"Order re-registering"</span></span>, SecurityProvider = MainWindow.Instance.Connector, MarketDataProvider = MainWindow.Instance.Connector, Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector), Order = order.ReRegisterClone(newVolume: order.Balance) }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (window.ShowModal(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)) MainWindow.Instance.Connector.ReRegisterOrder(order, window.Order); }</code> </pre> <br>  Dalam penangan peristiwa pembatalan permintaan, panggil saja metode CancelOrder dan kirimkan pesanan kepadanya, yang harus dibatalkan: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGrid_OnOrderCanceling</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Order order</span></span></span><span class="hljs-function">)</span></span> { MainWindow.Instance.Connector.CancelOrder(order); }</code> </pre> <br>  Agar pesanan ditampilkan di OrderGrid, Anda harus berlangganan ke acara kemunculan pesanan baru dan acara kesalahan pendaftaran di konstruktor OrderGridControl, dan kemudian mentransfer acara ini ke OrderGrid: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OrderGridControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.Connector.NewOrder += OrderGrid.Orders.Add; MainWindow.Instance.Connector.OrderRegisterFailed += OrderGrid.AddRegistrationFail; }</code> </pre> <br>  Di bagian tengah MainWindow, tambahkan panel OrderGridControl yang dibuat: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>&gt; &lt;myxaml:OrderGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Jalankan untuk memeriksa: <br><br><img src="https://habrastorage.org/webt/hp/hu/m7/hphum7vg9x0p-ym0vwdg5_bhdv4.png"><br><br><h2>  Membuat Panel Transaksi Anda Sendiri </h2><br>  Dengan analogi dengan bilah alat, buat panel dari transaksi kita sendiri.  Di folder XAML, tambahkan UserControl lain.  Beri nama MyTradeGridControl.  Tambahkan elemen MyTradeGrid ke dalamnya: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.MyTradeGridControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> d:DesignHeight=<span class="hljs-string"><span class="hljs-string">"450"</span></span> d:DesignWidth=<span class="hljs-string"><span class="hljs-string">"800"</span></span>&gt; &lt;xaml:MyTradeGrid x:Name=<span class="hljs-string"><span class="hljs-string">"MyTradeGrid"</span></span> /&gt; &lt;/UserControl&gt;</code> </pre> <br>  Dalam konstruktor MyTradeGridControl, kita perlu berlangganan ke acara kemunculan transaksi baru sendiri dan mentransfernya ke MyTradeGrid: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyTradeGridControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); MainWindow.Instance.Connector.NewMyTrade += MyTradeGrid.Trades.Add; }</code> </pre> <br>  Di bagian tengah MainWindow, tambahkan panel OrderGridControl yang dibuat: <br><br><pre> <code class="css hljs">&lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">HorizontalAlignment</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Stretch</span></span>" <span class="hljs-selector-tag"><span class="hljs-selector-tag">View</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Tabs</span></span>"&gt; &lt;!<span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>  <span class="hljs-selector-tag"><span class="hljs-selector-tag">--</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Securities</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SecurityGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">SecurityPanel</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Portfolios</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:PortfolioGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">PortfolioGridControl</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">Orders</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:OrderGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">OrderGridControl</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Header</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyTrades</span></span>"&gt; &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">myxaml</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:MyTradeGridControl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">x</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:Name</span></span>="<span class="hljs-selector-tag"><span class="hljs-selector-tag">MyTradeGridControl</span></span>" /&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt; &lt;/<span class="hljs-selector-tag"><span class="hljs-selector-tag">dxlc</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:LayoutGroup</span></span>&gt;</code> </pre> <br>  Jalankan untuk memeriksa: <br><br><img src="https://habrastorage.org/webt/-4/dr/x1/-4drx1smuyevvg-e5esktgw4ey4.png"><br><br><h2>  Membuat panel dengan strategi </h2><br>  Kami akan membuat panel strategi dengan cara yang sama seperti semua panel sebelumnya.  Di folder XAML, tambahkan UserControl lain.  Beri nama StrategyControl.  Menggunakan LayoutControl, kami membagi layar menjadi dua bagian.  Di sebelah kiri akan ada tab dengan grafik kandil dan tab dengan statistik strategi: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"StatistisAndChartLayoutGroup"</span></span>&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span>&gt; &lt;xaml:Chart x:Name=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Statistic"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> &gt; &lt;xaml:StatisticParameterGrid x:Name=<span class="hljs-string"><span class="hljs-string">"StatisticParameterGrid"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span>/&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> &gt; &lt;xaml:EquityCurveChart x:Name=<span class="hljs-string"><span class="hljs-string">"EquityCurveChart"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Di sini, StatisticParameterGrid digunakan untuk menampilkan statistik strategi, dan EquityCurveChart digunakan untuk menampilkan grafik untung dan rugi.  StatisticParameterGrid perlu menetapkan beberapa nilai MaxHeight, jika tidak aplikasi tidak akan mulai. <br><br>  Sisi kanan akan mengonfigurasi properti strategi di PropertyGridEx.  Tombol untuk memulai dan menghentikan strategi juga akan ditemukan: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Group"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> dxlc:DockLayoutControl.Dock=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:PropertyGridEx x:Name=<span class="hljs-string"><span class="hljs-string">"PropertyGridEx"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br>  Kode lengkap: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"ShellNew.XAML.StrategyControl"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:dxlc=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"</span></span> xmlns:xaml=<span class="hljs-string"><span class="hljs-string">"http://schemas.stocksharp.com/xaml"</span></span> xmlns:dx=<span class="hljs-string"><span class="hljs-string">"http://schemas.devexpress.com/winfx/2008/xaml/core"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span>&gt; &lt;dxlc:LayoutControl&gt; &lt;dxlc:LayoutGroup Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span> Name=<span class="hljs-string"><span class="hljs-string">"StatistisAndChartLayoutGroup"</span></span>&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span>&gt; &lt;xaml:Chart x:Name=<span class="hljs-string"><span class="hljs-string">"Chart"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Statistic"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> &gt; &lt;xaml:StatisticParameterGrid x:Name=<span class="hljs-string"><span class="hljs-string">"StatisticParameterGrid"</span></span> MaxHeight=<span class="hljs-string"><span class="hljs-string">"2000"</span></span>/&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> &gt; &lt;xaml:EquityCurveChart x:Name=<span class="hljs-string"><span class="hljs-string">"EquityCurveChart"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup View=<span class="hljs-string"><span class="hljs-string">"Group"</span></span> dxlc:LayoutControl.AllowHorizontalSizing=<span class="hljs-string"><span class="hljs-string">"True"</span></span> dxlc:DockLayoutControl.Dock=<span class="hljs-string"><span class="hljs-string">"Right"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span>&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span>&gt; &lt;xaml:PropertyGridEx x:Name=<span class="hljs-string"><span class="hljs-string">"PropertyGridEx"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Start strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StartStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;dxlc:LayoutItem VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"20"</span></span>&gt; &lt;dx:SimpleButton x:Name=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton"</span></span> Content=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> ToolTip=<span class="hljs-string"><span class="hljs-string">"Stop strategy"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"StopStrategyButton_Click"</span></span> /&gt; &lt;/dxlc:LayoutItem&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutControl&gt; &lt;/UserControl&gt;</code> </pre> <br>  Di konstruktor StrategyControl, atur Connector sebagai sumber data untuk PropertyGridEx, di hampir setiap kontrol kami melakukan tindakan serupa: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StrategyControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); PropertyGridEx.SecurityProvider = MainWindow.Instance.Connector; PropertyGridEx.Portfolios = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PortfolioDataSource(MainWindow.Instance.Connector); }</code> </pre> <br>  Kita perlu entah bagaimana mentransfer strategi ke kendali kita.  Untuk melakukan ini, buat metode BindStraregy di StrategyControl, yang akan mengambil strategi, menyimpan tautan ke dalamnya dalam variabel lokal, dan juga mengatur strategi di PropertyGridEx dan StatisticParameterGrid. <br><br>  Menggunakan metode SetChart, kami mentransfer grafik lilin Chart ke strategi, setelah itu, Anda bisa mendapatkan strategi Chart menggunakan metode GetChart.  Kami juga mengatur Konektor untuk strategi. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Strategy _strategy; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindStraregy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Strategy strategy</span></span></span><span class="hljs-function">)</span></span> { _strategy = strategy; PropertyGridEx.SelectedObject = strategy; StatisticParameterGrid.Parameters. AddRange(_strategy.StatisticManager.Parameters); _strategy.SetChart(Chart); _strategy.Connector = MainWindow.Instance.Connector; }</code> </pre> <br>  Ketika bekerja dengan jadwal untung dan rugi, harus dicatat bahwa strategi itu akan mulai dan berhenti, mungkin beberapa kali, puisi itu harus dibersihkan dengan setiap peluncuran strategi.  Untuk ini, kita akan membuat metode ResetEquityCurveChart di mana kita pertama kali akan menghapus EquityCurveChart.  Setelah itu kita perlu membuat elemen grafik untuk EquityCurveChart, mereka dapat menentukan nama, warna dan jenis garis. <br><br>  Setelah itu, kami berlangganan acara perubahan PnL dari strategi dan dalam penangan acara ini menarik nilai baru pada bagan untung / rugi EquityCurveChart: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResetEquityCurveChart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { EquityCurveChart.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pnl = EquityCurveChart. CreateCurve(<span class="hljs-string"><span class="hljs-string">"PNL"</span></span>, Colors.Green, ChartIndicatorDrawStyles.Area); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> unrealizedPnL = EquityCurveChart. CreateCurve(<span class="hljs-string"><span class="hljs-string">"unrealizedPnL"</span></span>, Colors.Black, ChartIndicatorDrawStyles.Line); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> commissionCurve = EquityCurveChart .CreateCurve(<span class="hljs-string"><span class="hljs-string">"commissionCurve"</span></span>, Colors.Red, ChartIndicatorDrawStyles.Line); _strategy.PnLChanged += () =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartDrawData(); data.Group(_strategy.CurrentTime) .Add(pnl, _strategy.PnL) .Add(unrealizedPnL, _strategy.PnLManager.UnrealizedPnL ?? <span class="hljs-number"><span class="hljs-number">0</span></span>) .Add(commissionCurve, _strategy.Commission ?? <span class="hljs-number"><span class="hljs-number">0</span></span>); EquityCurveChart.Draw(data); }; }</code> </pre> <br>  Pada pengendali event untuk mengklik tombol Start, kami akan memanggil metode ini.  Dan kami juga akan mengatur ulang status strategi dan menjalankannya: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartStrategyButton_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { ResetEquityCurveChart(); _strategy.Reset(); _strategy.Start(); }</code> </pre> <br>  Dalam pengendali event untuk mengklik tombol Stop, kami akan menghentikan strateginya. <br>  private void StopStrategyButton_Click (pengirim objek, RoutedEventArgs e): <br><br><pre> <code class="cs hljs">{ _strategy.Stop(); }</code> </pre> <br>  Di bagian tengah MainWindow, tambahkan panel StrategyControl yang dibuat: <br><br><pre> <code class="cs hljs">&lt;dxlc:LayoutGroup HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Stretch"</span></span> View=<span class="hljs-string"><span class="hljs-string">"Tabs"</span></span>&gt; &lt;!--  --&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Securities"</span></span>&gt; &lt;myxaml:SecurityGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"SecurityPanel"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Portfolios"</span></span>&gt; &lt;myxaml:PortfolioGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"PortfolioGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"Orders"</span></span>&gt; &lt;myxaml:OrderGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"OrderGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MyTrades"</span></span>&gt; &lt;myxaml:MyTradeGridControl x:Name=<span class="hljs-string"><span class="hljs-string">"MyTradeGridControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"MarketDepth"</span></span>&gt; &lt;myxaml:MarketDepthControl x:Name=<span class="hljs-string"><span class="hljs-string">"MarketDepthControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;dxlc:LayoutGroup Header=<span class="hljs-string"><span class="hljs-string">"SimpleStrategyControl"</span></span>&gt; &lt;myxaml:StrategyControl x:Name=<span class="hljs-string"><span class="hljs-string">"SimpleStrategyControl"</span></span> /&gt; &lt;/dxlc:LayoutGroup&gt; &lt;/dxlc:LayoutGroup&gt;</code> </pre> <br><h2>  Penciptaan strategi </h2><br>  Misalnya, pertimbangkan untuk membuat strategi kandil sederhana.  Dia akan membeli jika lilin tumbuh (hijau) dan menjual jika lilin berkurang (merah). <br><br>  Mari kita buat folder lain di proyek - kita akan menyimpan semua strategi kita di dalamnya.  Di folder ini, buat kelas baru, sebut saja SimpleStrategy.  Semua strategi S # harus diwarisi dari kelas dasar strategi Strategi. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleStrategy</span></span> : <span class="hljs-title"><span class="hljs-title">Strategy</span></span> {}</code> </pre> <br>  Karena strategi kami menggunakan lilin, kami akan membuat properti publik CandleSeries dan dalam konstruktor strategi kami, kami akan menetapkannya ke nilai default. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SimpleStrategy</span></span> : <span class="hljs-title"><span class="hljs-title">Strategy</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CandleSeries Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimpleStrategy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Series = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CandleSeries(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TimeFrameCandle), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Security(), TimeSpan.FromSeconds(<span class="hljs-number"><span class="hljs-number">15</span></span>)) { BuildCandlesMode = MarketDataBuildModes.Build }; } }</code> </pre> <br>  Di sini kami menunjukkan bahwa lilin di CandleSeries adalah TimeFrameCandle, dengan interval 15 detik (TimeSpan.FromSeconds (15)).  Untuk CandleSeries, Anda dapat menentukan mode pembuatan lilin BuildCandlesMode.  Kami mengindikasikan bahwa lilin akan dibangun (MarketDataBuildModes.Build).  Secara default, mereka akan dibangun dari kutu, tetapi Anda dapat menentukan tipe data lainnya. <br><br>  Karena kami menjadikan CandleSeries sebagai properti publik, CandleSeries dapat dikustomisasi lebih lanjut dari PropertyGridEx yang dijelaskan dalam paragraf sebelumnya.  Semua strategi memiliki metode yang dapat ditimpa, kita perlu mengganti metode OnStarted.  Disebut sebelum memulai strategi dan memungkinkan Anda untuk mengaturnya sebagai kondisi awal. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _connector = (Connector)Connector; Series.Security = Security; _connector .WhenCandlesFinished(Series) .Do(ProcessCandle) .Apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); _connector.SubscribeCandles(Series); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStarted(); }</code> </pre> <br>  Di sini, untuk CandleSeries, kami mendefinisikan alat yang ditentukan dalam PropertyGridEx.  Kemudian buat aturan untuk memproses lilin yang sudah jadi.  Dalam aturan, tentukan metode yang akan memproses setiap lilin jadi - dalam kasus kami, ini adalah metode ProcessCandle.  Ini akan dijelaskan nanti.  Setelah semuanya diatur, kami berlangganan tampilan lilin di CandleSeries di konektor melalui metode SubscribeCandles.  Dalam kasus kami, metode ProcessCandle berisi logika utama strategi: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessCandle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Candle candle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsRealTime(candle)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &lt; candle.ClosePrice &amp;&amp; Position &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BuyAtMarket(Volume + Math.Abs(Position))); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &gt; candle.ClosePrice &amp;&amp; Position &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SellAtMarket(Volume + Math.Abs(Position))); } }</code> </pre> <br>  Pertama-tama, kita perlu menentukan apakah lilin sedang dibangun secara real time atau historis.  Jika lilin itu historis, maka kita abaikan saja.  Tidak semua strategi memerlukan ini, misalnya, strategi berdasarkan kacamata tidak memerlukan ini, karena kacamata selalu berjalan secara real time.  Tidak ada cara universal untuk menentukan apakah lilin itu "real time" atau historis, dan dalam setiap strategi masalah ini harus diselesaikan secara independen, tergantung pada persyaratan.  Dalam hal ini, kami hanya akan membandingkan waktu lilin ditutup dengan waktu di konektor dan jika tidak melebihi kelambatan tertentu, maka lilin akan memiliki status waktu-nyata. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsRealTime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Candle candle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Connector.CurrentTime - candle.CloseTime).TotalSeconds &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre> <br>  Selanjutnya, kita melihat jenis lilin apa itu, dan apa posisi strategi saat ini.  Jika lilin tumbuh, maka dengan posisi sama dengan 0, kami akan membuka posisi dengan urutan pasar untuk volume yang ditentukan oleh kami di PropertyGridEx.  Jika lilin tumbuh dan posisinya kurang dari 0, maka kami "membalikkan" posisinya: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &lt; candle.ClosePrice &amp;&amp; Position &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BuyAtMarket(Volume + Math.Abs(Position))); }</code> </pre> <br><br>  Kami melakukan yang sebaliknya untuk lilin yang memudar: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (candle.OpenPrice &gt; candle.ClosePrice &amp;&amp; Position &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { RegisterOrder(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.SellAtMarket(Volume + Math.Abs(Position))); }</code> </pre> <br>  Saat ini, strategi kami siap untuk bekerja.  Itu harus diteruskan ke SimpleStrategyControl, yang kami buat pada paragraf sebelumnya menggunakan metode BindStraregy.  Kami melakukan ini di konstruktor MainWindow segera setelah menginisialisasi komponen MainWindow. <br><br><pre> <code class="cs hljs">SimpleStrategyControl.BindStraregy(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SimpleStrategy());</code> </pre> <br><br>  Jalankan untuk memeriksa: <br><br><img src="https://habrastorage.org/webt/b1/-p/t6/b1-pt6ohswyhv5ylanblhvjhsf4.png"><br><br><img src="https://habrastorage.org/webt/ig/qx/kd/igqxkdcsehmsbeeayj-wnhgmhuk.png"><br><br>  Strateginya berhasil, kesepakatan dibuat, tetapi sejauh ini tidak ada lilin dan kesepakatan pada grafik. <br><br><h2>  Menambahkan lilin dan penawaran ke bagan dari strategi </h2><br>  Di bagian tentang panel strategi menggunakan metode SetChart, kami mengkhianati bagan lilin Chart ke dalam strategi.  Dalam metode strategi OnStarted, kami memeriksa apakah Bagan diatur untuk strategi dan jika sudah diatur, maka kami menginisialisasi bagan, dan juga berlangganan ke peristiwa kemunculan transaksi baru sendiri dan perubahan lilin. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStarted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _connector = (Connector)Connector; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetChart() <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Chart chart) { InitChart(chart); NewMyTrade += DrawMyTrade; _connector.CandleSeriesProcessing += CandleSeriesProcessing; } Series.Security = Security; _connector .WhenCandlesFinished(Series) .Do(ProcessCandle) .Apply(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); _connector.SubscribeCandles(Series); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.OnStarted(); }</code> </pre> <br>  Metode inisialisasi bagan InitChart: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ChartCandleElement _chartCandleElement; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ChartTradeElement _tradesElem; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Chart _chart; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitChart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Chart chart</span></span></span><span class="hljs-function">)</span></span> { _chart = chart; _chart.GuiSync(() =&gt; { _chart.ClearAreas(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> candlesArea = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartArea(); _chart.AddArea(candlesArea); _chartCandleElement = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartCandleElement(); _chart.AddElement(candlesArea, _chartCandleElement); _tradesElem = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartTradeElement { FullTitle = <span class="hljs-string"><span class="hljs-string">"Trade"</span></span> }; _chart.AddElement(candlesArea, _tradesElem); }); }</code> </pre> <br>  Di sini kita menyimpan tautan ke Bagan dalam variabel lokal.  Kami membersihkan jadwalnya.  Kami juga membuat dan mentransfer ke elemen bagan bagan untuk lilin dan penawaran.  Konstruksi _chart.GuiSync (() =&gt; {...});  diperlukan untuk menginisialisasi jadwal di utas utama. <br><br>  CandleSeriesProcessing chart untuk menggambar lilin pada grafik: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CandleSeriesProcessing</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CandleSeries candleSeries, Candle candle</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartDrawData(); data.Group(candle.OpenTime) .Add(_chartCandleElement, candle); _chart.Draw(data); }</code> </pre> <br>  Di sini kita mendapatkan lilin dari acara CandleSeriesProcessing konektor, buat ChartDrawData untuk menampilkannya pada grafik.  Kami menunjukkan data waktu. Grup (lilin. Buka Waktu), menunjukkan bahwa lilin harus ditambahkan ke elemen lilin dari bagan. Tambahkan (_chartCandleElement, lilin);  Dan kami menunjukkan bahwa gambar perlu menggambar data baru. <br><br>  Kami melakukan tindakan serupa untuk transaksi: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawMyTrade</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MyTrade myTrade</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChartDrawData(); data.Group(myTrade.Trade.Time) .Add(_tradesElem, myTrade); _chart.Draw(data); }</code> </pre> <br>  Jalankan untuk memeriksa: <br><br><img src="https://habrastorage.org/webt/bv/ll/xa/bvllxaiaoeshjg0_71xwfocozqa.png"><br><br><h2>  Kesimpulan singkat </h2><br>  Untuk membuat aplikasi yang terlihat rumit dan profesional, Anda tidak perlu menghabiskan banyak waktu.  Selama beberapa jam kami telah membuat aplikasi lengkap dengan kemampuan untuk mengkonfigurasi, menampilkan perdagangan langsung dan perdagangan algoritmik. <br>  Jangan takut untuk mencoba dan membuat program perdagangan Anda sendiri.  Kami harap artikel ini akan membantu Anda untuk merasa nyaman dalam hal ini. <br><br>  <b>Penulis</b> : Ivan Zalutsky </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id433078/">https://habr.com/ru/post/id433078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id433066/index.html">HighLoad Cup # 2. Kejuaraan untuk pengembang backend kembali beroperasi</a></li>
<li><a href="../id433070/index.html">Bagaimana membedakan sampo dari sampanye, dan tusuk sate dari sampanye ... Elasticsearch - mencari produk di database toko</a></li>
<li><a href="../id433072/index.html">Cara meretas perlindungan salinan konsol Sega Dreamcast</a></li>
<li><a href="../id433074/index.html">Beralih ke Kotlin dalam proyek Android: Kiat dan Trik</a></li>
<li><a href="../id433076/index.html">Bagaimana kami membuat pustaka Galeri Android kami untuk melihat konten media</a></li>
<li><a href="../id433082/index.html">Memompa akun orang lain telah menjadi pelanggaran pidana di Korea Selatan</a></li>
<li><a href="../id433084/index.html">Buka pelajaran "Rekayasa Fitur pada contoh dataset Titanic klasik"</a></li>
<li><a href="../id433086/index.html">Tinkoff dan segalanya, segalanya, segalanya: IoT, analitik, dan pengawasan bank</a></li>
<li><a href="../id433088/index.html">Bagaimana Anda menyukainya, Elon Musk: BMW dan Porsche telah mengembangkan pengisian daya yang menambahkan 100 km perjalanan dalam 3 menit</a></li>
<li><a href="../id433090/index.html">Teknik Indeks Bitmap Oracle</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>