<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí† ü•Ä ü§Ø S√©curit√© de Microsoft Office: objets int√©gr√©s ü§Ø üßóüèø üë∑üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Initialement, l'architecture de Microsoft Office a √©t√© construite sur la base du concept de documents composites, ce sont aussi des documents OLE , ac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>S√©curit√© de Microsoft Office: objets int√©gr√©s</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/423933/"><img src="https://habrastorage.org/webt/os/-z/yx/os-zyx2ayrnxagtecn42u4spxke.jpeg"><br><br>  Initialement, l'architecture de Microsoft Office a √©t√© construite sur la base du concept de documents composites, ce sont aussi des <b>documents OLE</b> , activement promus par Microsoft √† l'aube de Windows 32 bits.  √Ä cette √©poque, l'id√©e de combiner ¬´de mani√®re transparente¬ª des donn√©es de diff√©rents formats dans un seul document semblait tentante et fascinante, et avant d'identifier les premiers probl√®mes, elle a r√©ussi √† se d√©velopper fermement en de nombreux produits √† grande √©chelle. <br><br>  La ¬´mauvaise nouvelle¬ª est que la mani√®re universelle d'ajouter des donn√©es (et le code de traitement de ces donn√©es) dans les documents est devenue une mani√®re universelle d'introduire des vuln√©rabilit√©s dans le produit, qui pr√©sente encore aujourd'hui de <s>bonnes</s> surprises aux <s>cr√©ateurs de</s> chercheurs en s√©curit√© <s>de logiciels malveillants</s> . <a name="habracut"></a><br><br>  Par la suite, le package d'application a re√ßu un ensemble assez riche d'outils pour ajouter des images, des graphiques et des graphiques, des √©l√©ments de contr√¥le qui sont cr√©√©s et trait√©s par l'application et qui en font partie dans les documents.  Du point de vue de la s√©curit√©, ces √©l√©ments pr√©sentent un int√©r√™t l√©g√®rement inf√©rieur √† ceux qui seront (principalement) abord√©s dans l'article - les √©l√©ments qui utilisent le code des applications externes qui sont ajout√©s aux documents utilisant OLE. <br><br>  Une repr√©sentation ¬´disque¬ª d'un document compos√© est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichier CFBF</a> .  Cet article abordera l'incorporation d'objets dans des documents Microsoft Office (ou plut√¥t, uniquement l'aspect s√©curit√©) dans le contexte des <b>donn√©es et du code charg√©s en m√©moire</b> lors de l'ex√©cution. <br><br>  Les objets officiellement incorpor√©s dans les documents Microsoft Office peuvent √™tre r√©partis dans les groupes suivants: <br><br><ul><li>  Contr√¥les ActiveX (contr√¥les ActiveX) </li><li>  <b>Objets int√©gr√©s OLE</b> </li><li>  Fichiers int√©gr√©s ( <b>packages</b> ) </li><li>  √âl√©ments en ligne <b>non OLE</b> </li></ul><br><h3>  Contr√¥les ActiveX </h3><br>  Les contr√¥les ActiveX peuvent √™tre repr√©sent√©s comme des √©l√©ments d'une fen√™tre de programme - par exemple, des boutons, des boutons radio, des listes, des champs de saisie et d'autres formulaires - con√ßus pour produire certains √©v√©nements ou r√©pondre √† des √©v√©nements.  Il √©tait une fois une bonne id√©e de cr√©er de tels √©l√©ments de contr√¥le universels, avec la possibilit√© de les utiliser dans n'importe quelle application, et de les placer √† cet effet dans les <b>composants COM</b> . <br><br>  Les pages Web int√©gr√©es ActiveX repr√©sentaient une faille de s√©curit√© Internet Explorer bien connue, les mesures de s√©curit√© ont augment√© au fil du temps.  Les navigateurs d'autres fabricants ont presque imm√©diatement abandonn√© la prise en charge d'ActiveX.  Le nouveau navigateur Microsoft Edge s'est enfin s√©par√© de cette relique du pass√©.  L'incorporation dans les documents Office est cependant toujours possible. <br><br>  ActiveX dans les documents est destin√© √† √™tre utilis√© conjointement avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Visual Basic pour Applications</b></a> .  Cependant, VBA n'est pas requis pour les t√©l√©charger et les activer, et l'autorisation utilisateur n'est pas requise pour t√©l√©charger des <b>√©l√©ments de la liste blanche</b> . <br><br>  Les vuln√©rabilit√©s dans ce dernier sont particuli√®rement dangereuses - les param√®tres par d√©faut d√©finis lors de l'installation de l'application n'impliquent aucune protection contre le chargement de ces √©l√©ments, ni un avertissement √† l'utilisateur.  L'administrateur doit resserrer les param√®tres en interdisant le chargement de tous les contr√¥les ActiveX (cependant, notez que ActiveX ne se charge pas en mode de navigation s√©curis√©e). <br><blockquote>  Exemple: CVE-2012-0158 <br><br>  L'une des vuln√©rabilit√©s les plus dangereuses des documents Office en 2012 √©tait <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2012-0158</a> .  Le code de chargement de l'√©l√©ment Microsoft ListView Control 6.0 de la biblioth√®que MSCOMCTL.OCX contenait la possibilit√© d'un d√©bordement de tampon, ce qui permettait de remplacer l'adresse de retour et d'ex√©cuter du code arbitraire.  √âtant donn√© que l'√©l√©ment √©tait dans la ¬´liste blanche¬ª ActiveX, le chargement a commenc√© imm√©diatement lorsque le document a √©t√© ouvert.  La vuln√©rabilit√© est actuellement corrig√©e, le contr√¥le ListView est toujours consid√©r√© comme ¬´s√ªr¬ª. </blockquote><h4>  Ajout d'ActiveX √† un document </h4><br>  Pour ajouter un √©l√©ment de contr√¥le √† un document Microsoft Office (pour plus de simplicit√©, prenez Word), utilisez l'interface utilisateur pour ouvrir l'onglet "D√©veloppeur" (sa visibilit√© est configur√©e dans le menu "Options Word") et s√©lectionnez Contr√¥les -&gt; Outils des versions pr√©c√©dentes -&gt; Contr√¥les ActiveX.  Le menu pr√©sentera un ensemble d'ic√¥nes correspondant aux √©l√©ments Microsoft Forms, ainsi que la possibilit√© de s√©lectionner ActiveX dans la liste compos√©e des √©l√©ments disponibles dans le syst√®me qui sont s√©lectionn√©s selon un certain nombre de crit√®res. <br><br><img src="https://habrastorage.org/webt/nn/wt/jt/nnwtjte9nabt8rriqxotr4f7is4.jpeg"><br><br>  La liste affich√©e ne correspond pas √† l'ensemble des √©l√©ments qui peuvent r√©ellement √™tre charg√©s dans le document, elle ne peut donc pas √™tre guid√©e lors de la recherche d'√©l√©ments vuln√©rables.  La v√©rification sophistiqu√©e √† plusieurs niveaux de l'ActiveX t√©l√©charg√© comporte plusieurs √©tapes, elle diff√®re pour les versions d'Office et varie d'une mise √† jour √† l'autre, donc le moyen le plus s√ªr de v√©rifier la t√©l√©chargabilit√© est de ¬´composer¬ª manuellement le fichier de document avec l'√©l√©ment d'int√©r√™t et d'essayer de l'ouvrir dans Office.  Les formats de document possibles sont d√©crits ci-dessous. <br><br><h4>  Pr√©sentation du programme </h4><br>  Chaque √©l√©ment ActiveX est essentiellement un objet de l'une des classes COM qui r√©pondent √† certaines exigences.  Un √©l√©ment est charg√© √† l'aide du sous-syst√®me COM et le code ex√©cutable est contenu dans l'un des modules, qui sont g√©n√©ralement ¬´externes¬ª √† l'application conteneur.  Comme tout objet COM, un √©l√©ment ActiveX peut √™tre impl√©ment√© en tant que DLL ou en tant que fichier EXE ex√©cutable.  Dans le premier cas, la biblioth√®que sera charg√©e dans l'espace d'adressage du conteneur, dans le second - l'√©l√©ment sera trait√© dans un processus s√©par√©, avec le transfert de donn√©es entre le conteneur et l'objet via le marshaling COM. <br><br>  Comme tout objet COM, ActiveX poss√®de des <b>interfaces</b> , des <b>propri√©t√©s</b> et des <b>m√©thodes</b> . <br><br>  Les interfaces sont principalement un ensemble d'interfaces standard que la classe ActiveX doit avoir pour le chargement complet et l'interaction avec le conteneur, en particulier IOleControl et IOleObject. <br><br>  L'absence d'interfaces n√©cessaires peut r√©duire la fonctionnalit√© de l'√©l√©ment ou interrompre son chargement √† un certain stade. <br><blockquote>  Exemple: CVE-2015-2424 <br>  La vuln√©rabilit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2015-2424</a> √©tait associ√©e √† l'√©l√©ment TaskSymbol Class de la biblioth√®que mmcndmgr.dll.  L'√©l√©ment n'√©tait pas destin√© √† √™tre utilis√© dans des documents et n'a pas export√© l'interface IDispatch.  Lors du chargement d'un √©l√©ment, la proc√©dure qui a demand√© cette interface a re√ßu une erreur et a d√©truit la structure interne de l'√©l√©ment, ce qui a conduit √† une vuln√©rabilit√© de type utilisation apr√®s lib√©ration.  Pour le moment, l'√©l√©ment n'est pas autoris√© √† √™tre t√©l√©charg√© (malgr√© cela, il peut toujours √™tre trouv√© dans la liste √† ajouter au menu "D√©veloppeur").  La vuln√©rabilit√© elle-m√™me n'est pas r√©solue. <br></blockquote>  En plus des standards, chaque classe ActiveX exporte l'interface ¬´principale¬ª, repr√©sentant sa propre fonctionnalit√© unique.  Par exemple, pour la classe Forms.CommandButton.1, il s'agit de ICommandButton. <br><br>  Vous pouvez afficher les interfaces ActiveX √† l'aide de l'outil <b>OleView</b> inclus dans le package Microsoft Visual Studio. <br><br><img src="https://habrastorage.org/webt/um/cc/zm/umcczmybv5voo3c6bbde66zxdmq.png"><br><br>  L'interface d'un √©l√©ment d√©finit ses <b>m√©thodes</b> et <b>propri√©t√©s</b> .  Les propri√©t√©s repr√©sentent certaines donn√©es qui d√©terminent l'apparence et le fonctionnement d'un √©l√©ment.  Le d√©veloppeur d'un √©l√©ment ActiveX attribue un nom sp√©cifique √† chaque propri√©t√©, par exemple BackColor ou GridLineWidth, et un type, par exemple, une cha√Æne, un entier ou une double pr√©cision r√©elle.  Pour les images et les ic√¥nes bitmap, il existe un type de propri√©t√© telle qu'une image.  Le programme client peut d√©finir des propri√©t√©s individuelles du contr√¥le en d√©finissant leurs indices et valeurs entiers. <br><br>  Du point de vue d'une impl√©mentation de bas niveau, la division en m√©thodes et propri√©t√©s est formelle, car les ¬´propri√©t√©s¬ª sont repr√©sent√©es par un ensemble de m√©thodes get / set.  Cependant, il existe une diff√©rence significative: les m√©thodes d'un √©l√©ment (son interface principale) ne peuvent √™tre appel√©es par programme, dans le cas de documents Office, qu'√† partir d'un programme VBA en cours d'ex√©cution.  Du point de vue de la s√©curit√©, cela n'a pas un grand int√©r√™t, car l'ex√©cution de VBA est d√©j√† un compromis du syst√®me d'exploitation.  <b>Les propri√©t√©s</b> sont enregistr√©es dans le document et lorsqu'il est ouvert, elles seront <b>trait√©es et charg√©es</b> dans les structures en m√©moire <b>m√™me si l'ex√©cution de VBA est interdite</b> . <br><br>  D'un point de vue logiciel, de la part de l'√©l√©ment, pour conserver ses propri√©t√©s et son √©tat dans le document, le conteneur fournit les <b>interfaces IStream</b> , <b>IStorage</b> et <b>IPropertyBag</b> .  Leur impl√©mentation et pr√©sentation des donn√©es dans un fichier disque ne sont plus du ressort de l'√©l√©ment ActiveX, et d√©pendent enti√®rement du conteneur et du format du document.  Il convient de noter que l'ensemble et le format des donn√©es stock√©es peuvent correspondre √† un ensemble de propri√©t√©s export√©es ¬´publiquement¬ª, ou √™tre compl√®tement diff√©rents.  Consid√©rez des exemples d'impl√©mentation li√©s √† Microsoft Office. <br><br><h4>  Fichier compos√© (CFBF) </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le format de document Office obsol√®te</a> , o√π le stockage de niveau inf√©rieur ObjectPool et des sous-r√©pertoires s√©par√©s √† l'int√©rieur ont √©t√© allou√©s pour le stockage des donn√©es ActiveX.  Le flux "\ 001CompObj" contient l'identifiant de classe, qui d√©termine finalement la classe de l'objet charg√©.  <b>Le remplacement de l'identifiant</b> directement dans hex entra√Ænera une tentative de chargement d'un objet d'une <b>classe</b> compl√®tement <b>diff√©rente</b> . <br><br><img src="https://habrastorage.org/webt/bc/sx/uc/bcsxucmomcw9wnqwgn-84bxosnu.jpeg"><br><br><h4>  Office Open XML </h4><br>  Format de document XML moderne.  Le fichier est une archive zip.  Les donn√©es de contr√¥le ActiveX sont stock√©es dans le sous-r√©pertoire ActiveX dans des fichiers avec des noms simples comme activeX1.xml. <br><br><img src="https://habrastorage.org/webt/su/gx/uq/sugxuqtgsbhdg8tvr53srkbvtsg.png"><br><br>  Exemple de fichier: <br> <code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt; <br> &lt;ax:ocx ax: <b>classid="{D7053240-CE69-11CD-A777-00DD01143C57}</b> " ax: <b>persistence="persistPropertyBag"</b> xmlns:ax="http://schemas.microsoft.com/office/2006/activeX" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"&gt; <br> &lt;ax:ocxPr ax:name="Caption" ax:value="CommandButton1"/&gt; <br> &lt;ax:ocxPr ax:name="Size" ax:value="2540;847"/&gt; <br> &lt;ax:ocxPr ax:name="FontName" ax:value="Calibri"/&gt; <br> &lt;ax:ocxPr ax:name="FontHeight" ax:value="225"/&gt; <br> &lt;ax:ocxPr ax:name="FontCharSet" ax:value="204"/&gt; <br> &lt;ax:ocxPr ax:name="FontPitchAndFamily" ax:value="2"/&gt; <br> &lt;ax:ocxPr ax:name="ParagraphAlign" ax:value="3"/&gt; <br> &lt;/ax:ocx&gt;</code> <br> <br>  Dans ces fichiers, les identificateurs de classe sont indiqu√©s sous forme de texte.  Le remplacement de l'identifiant entra√Ænera √©galement une tentative de chargement d'un √©l√©ment d'une autre classe. <br><br>  Ensuite, le fichier contient une indication du type de stockage de donn√©es de l'objet: persistPropertyBag, persistStorage ou persistStream.  Si un √©l√©ment prend en <b>charge les</b> propri√©t√©s <b>persistPropertyBag</b> , ses donn√©es peuvent √™tre stock√©es <b>dans le m√™me fichier texte</b> , voir l'exemple ci-dessus.  S'il a besoin de <b>stockage</b> ou d'un <b>flux binaire</b> , les donn√©es seront enregistr√©es dans un fichier avec un nom de type activeX1.bin, qui est <b>un fichier CFBF</b> . <br><br><img src="https://habrastorage.org/webt/pt/tx/hp/pttxhpe9gevkgf8l4a7ddmcfspu.png"><br><br><h4>  RTF </h4><br>  Dans un document rtf, l'√©l√©ment ActiveX est d√©fini par les <b>balises \ object \ objocx</b> .  La <b>balise \ objdata</b> contient le magasin de propri√©t√©s de l'√©l√©ment en tant que repr√©sentation hexad√©cimale du fichier CFBF. <br><br> <code>{\object\objocx\f37\objsetsize\objw1440\objh480{\*\objclass Forms.CommandButton.1} <br> {\*\objdata 010500000200000016000000 <br> 466f726d732e436f6d6d616e64427574746f6e2e31000000000000000000000e0000 <br> <b>d0cf11e</b> 0a1b11ae1000000000000000000000000000000003e000300feff090006</code> <br> <br><h4>  T√©l√©charger depuis un fichier </h4><br>  Le processus de chargement d'ActiveX √† partir d'un document dans son ensemble est assez simple.  L'application conteneur cr√©e un objet propre de la classe sp√©cifi√©e, lui demande l'interface de stockage sp√©cifi√©e et fournit un pointeur vers le stockage, le flux ou le ¬´package de propri√©t√©s¬ª. <br><br>  Le filtrage des √©l√©ments pouvant √™tre charg√©s comporte plusieurs √©tapes.  Tout d'abord, les classes sp√©cifi√©es dans la liste noire appel√©es <b>Office COM Kill Bit</b> (indice de registre * OFFICE_KEY * \ Common \ COM Compatibility) sont supprim√©es.  Par exemple, les indicateurs anti-t√©l√©chargement ont des classes telles que Microsoft Scriptlet Component et Microsoft Web Browser. <br><br>  Les classes restantes subiront le chargement initial.  Cela signifie que <b>la DLL sera charg√©e</b> dans l'application conteneur ou que <b>le processus du serveur COM</b> impl√©ment√© dans le fichier EXE sera <b>lanc√©</b> .  Ce n'est qu'apr√®s cela que les autres v√©rifications seront effectu√©es, y compris l'√©l√©mentaire - et si l'objet est, en fait, un repr√©sentant ActiveX. <br><blockquote>  Exemple: CVE-2015-6128 <br>  En 2015, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chercheur a d√©couvert</a> que le pr√©chargement des modules COM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut √™tre utilis√© pour contourner ASLR et ex√©cuter du code arbitraire</a> en chargeant de fausses biblioth√®ques dynamiques.  Le CVE-2015-6128 publi√© par la suite n'est pas un mot sur Microsoft Office. <br></blockquote>  Si l'identifiant d√©finit vraiment ActiveX, il passera par plusieurs v√©rifications suppl√©mentaires dans plusieurs listes noires et blanches. <br><br><div class="spoiler">  <b class="spoiler_title">Liste de d√©marrage ActiveX √† partir de .docx sur Windows 7 et Office 2016 propres aux param√®tres par d√©faut.</b> <div class="spoiler_text"> <code>{00024522-0000-0000-C000-000000000046} RefEdit.Ctrl <br> {02AF6DD2-77E6-44DF-B3E1-57CF1476D8EA} Microsoft Forms 2.0 OptionButton <br> {04082FC6-E032-49F2-A263-FE64E9DA1FA3} Microsoft Forms 2.0 HTML TEXT <br> {0B314611-2C19-4AB4-8513-A6EEA569D3C4} Microsoft Slider Control, version 6.0 <br> {13D557B6-A469-4362-BEAF-52BFD0F180E2} Microsoft Forms 2.0 HTML TextAREA <br> {19FED08E-EFD1-45da-B524-7BE4774A6AEE} Microsoft Forms 2.0 ListBox <br> {20DD1B9E-87C4-11D1-8BE3-0000F8754DA1} Microsoft Date and Time Picker Control 6.0 (SP4) <br> {227B1F3B-C276-4DE0-9FAA-C0AD42ADDCF0} Microsoft Forms 2.0 HTML RESET <br> {232E456A-87C3-11D1-8BE3-0000F8754DA1} Microsoft MonthView Control 6.0 (SP4) <br> {3D0FD779-0C2D-4708-A9BA-62F7458A5A53} Microsoft Forms 2.0 ToggleButton <br> {444D2D27-02E8-486B-9018-3644958EF8A9} FieldListCtrl.2 Object <br> {4C599241-6926-101B-9992-00000B65C6F9} Microsoft Forms 2.0 Image <br> {5052A832-2C0F-46c7-B67C-1F1FEC37B280} Microsoft Forms 2.0 Label <br> {5512D110-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SUBMIT <br> {5512D112-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML IMAGE <br> {5512D114-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML RESET <br> {5512D116-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML CHECKBOX <br> {5512D118-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML OPTION <br> {5512D11A-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TEXT <br> {5512D11C-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Hidden <br> {5512D11E-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Password <br> {5512D122-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SELECT <br> {5512D124-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TextAREA <br> {556C2772-F1AD-4DE1-8456-BD6E8F66113B} Microsoft ImageList Control 6.0 (SP6) <br> {585AA280-ED8B-46B2-93AE-132ECFA1DAFC} Microsoft StatusBar Control 6.0 (SP6) <br> {5CBA34AE-E344-40CF-B61D-FBA4D0D1FF54} Microsoft Forms 2.0 HTML CHECKBOX <br> {5E90CC8B-E402-4350-82D7-996E92010608} Microsoft Forms 2.0 HTML OPTION <br> {603C7E80-87C2-11D1-8BE3-0000F8754DA1} Microsoft UpDown Control 6.0 (SP4) <br> {6240EF28-7EAB-4dc7-A5E3-7CFB35EFB34D} Microsoft Forms 2.0 ScrollBar <br> {65BCBEE4-7728-41A0-97BE-14E1CAE36AAE} Microsoft Office List 16.0 <br> {6C177EBD-C42D-4728-A04B-4131892EDBF6} Microsoft Forms 2.0 ComboBox <br> {787A2D6B-EF66-488D-A303-513C9C75C344} Microsoft Forms 2.0 HTML Password <br> {79176FB0-B7F2-11CE-97EF-00AA006D2776} Microsoft Forms 2.0 SpinButton <br> {86F56B7F-A81B-478d-B231-50FD37CBE761} Microsoft Forms 2.0 CommandButton <br> {87DACC48-F1C5-4AF3-84BA-A2A72C2AB959} Microsoft ImageComboBox Control, version 6.0 <br> {8B2ADD10-33B7-4506-9569-0A1E1DBBEBAE} Microsoft Toolbar Control 6.0 (SP6) <br> {8BD21D10-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 TextBox <br> {8BD21D20-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ListBox <br> {8BD21D30-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ComboBox <br> {8BD21D40-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 CheckBox <br> {8BD21D50-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 OptionButton <br> {8BD21D60-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ToggleButton <br> {9432194C-DF54-4824-8E24-B013BF2B90E3} Microsoft Forms 2.0 HTML SUBMIT <br> {95F0B3BE-E8AC-4995-9DCA-419849E06410} Microsoft TreeView Control 6.0 (SP6) <br> {978C9E23-D4B0-11CE-BF2D-00AA003F40D0} Microsoft Forms 2.0 Label <br> {9A948063-66C3-4F63-AB46-582EDAA35047} Microsoft TabStrip Control 6.0 (SP6) <br> {9BDAC276-BE24-4F04-BB22-11469B28A496} Microsoft Forms 2.0 HTML IMAGE <br> {A0E7BF67-8D30-4620-8825-7111714C7CAB} Microsoft ProgressBar Control, version 6.0 <br> {CCDB0DF2-FD1A-4856-80BC-32929D8359B7} Microsoft ListView Control 6.0 (SP6) <br> {D7053240-CE69-11CD-A777-00DD01143C57} Microsoft Forms 2.0 CommandButton <br> {DCA0ED3C-B95D-490f-9C60-0FF3726C789A} Microsoft Forms 2.0 Image <br> {DD4CB8C5-F540-47ff-84D7-67390D2743CA} Microsoft Forms 2.0 TextBox <br> {DFD181E0-5E2F-11CE-A449-00AA004A803D} Microsoft Forms 2.0 ScrollBar <br> {E9729012-8271-4e1f-BC56-CF85F914915A} Microsoft Forms 2.0 CheckBox <br> {EA778DB4-CE69-4da5-BC1D-34E2168D5EED} Microsoft Forms 2.0 SpinButton <br> {EAE50EB0-4A62-11CE-BED6-00AA00611080} Microsoft Forms 2.0 TabStrip <br> {F14E8B03-D080-4D3A-AEBA-355E77B20F3D} Microsoft Forms 2.0 HTML SELECT <br> {F8CF7A98-2C45-4c8d-9151-2D716989DDAB} Microsoft Visio Document <br> {FB453AD8-2EF4-44D3-98A8-8C6474E63CE4} Microsoft Forms 2.0 HTML Hidden <br> {FDEA20DB-AC7A-42f8-90EE-82208B9B4FC0} Microsoft Forms 2.0 TabStrip <br> {FE38753A-44A3-11D1-B5B7-0000C09000C4} Microsoft Flat Scrollbar Control 6.0 (SP4) <br></code> </div></div><br>  Vous pouvez voir qu'une place importante dans la liste est occup√©e par les composants du groupe <b>Microsoft Forms</b> .  Il s'agit d'un ensemble de contr√¥les fournis avec Office, et vous pouvez les voir dans le panneau de contr√¥les ActiveX.  Au d√©part, ils √©taient tous enregistr√©s comme ¬´s√ªrs¬ª, mais au fil du temps, il est devenu clair que ce n'√©tait pas le cas pour les √©l√©ments individuels.  Par exemple, l'√©l√©ment Frame charge tout autre ActiveX sans v√©rifier aucune liste (dans les derni√®res versions, cela est ¬´fixe¬ª, mais la propre liste noire de Frame est diff√©rente de celle d'Office g√©n√©rale).  Pour cette raison, certains √©l√©ments Microsoft Forms ne peuvent √™tre charg√©s dans un document qu'avec l'autorisation de l'utilisateur.  Microsoft Forms Frame requiert √©galement le consentement de l'utilisateur (aux param√®tres par d√©faut), mais il vous permet de t√©l√©charger certains √©l√©ments de la liste Kill Bit qui n'ont pas pu √™tre charg√©s dans d'autres conditions. <br><br>  Par cons√©quent, si un attaquant parvient √† convaincre l'utilisateur d'autoriser ActiveX √† se charger, Frame l'aidera √† √©tendre consid√©rablement l'arsenal en raison d'√©l√©ments tels que, par exemple, le navigateur Web. <br><br>  Le format de stockage des propri√©t√©s Microsoft Forms est partiellement document√© par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la sp√©cification [MS-OFORMS]</a> . <br><br>  Au cours de l'analyse ActiveX, il s'est av√©r√© que l'ensemble des classes pour doc, docx et rtf est diff√©rent, ainsi que diff√©rentes listes d'ActiveX disponibles pour une application s'ex√©cutant de la mani√®re habituelle et s'ex√©cutant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en mode d'automatisation</a> . <br><br>  De nombreuses applications populaires compl√®tent ces listes avec leur propre ActiveX.  Si une vuln√©rabilit√© est d√©couverte, elle sera refl√©t√©e dans le bulletin comme √©tant li√©e √† l'application dont elle fait partie.  Cependant, la seule fa√ßon d'exploiter cette vuln√©rabilit√© peut √™tre les documents Office. <br><blockquote>  Exemple: Flash ActiveX <br>  Flash ActiveX a √©t√© particuli√®rement appr√©ci√© par les auteurs de virus pour leurs vuln√©rabilit√©s constamment d√©tectables et une place permanente dans les listes blanches d'IE et d'Office.  Les premi√®res vuln√©rabilit√©s connues de ce composant sont apparues en 2008, l'une des derni√®res <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2018-4878 a √©t√©</a> ferm√©e en f√©vrier de cette ann√©e.  Avec la popularit√© d√©croissante d'IE, les documents Office sont devenus le principal moyen de distribuer les exploits pour Flash. <br></blockquote><h3>  √âl√©ments de donn√©es OLE int√©gr√©s </h3><br>  Les √©l√©ments OLE impl√©ment√©s sont con√ßus pour impl√©menter le concept de ¬´document dans document¬ª avec la possibilit√© d'√©diter des donn√©es sur place de diff√©rents formats trait√©es par d'autres applications.  Comme ActiveX, les documents OLE sont impl√©ment√©s sur la base de COM. <br><br>  Vous pouvez ajouter un √©l√©ment OLE √† un document Word comme suit: ouvrez l'onglet "Ins√©rer" et s√©lectionnez Texte -&gt; Objet.  Le programme affiche une liste des types de documents pour lesquels les gestionnaires OLE sont enregistr√©s.  Comme c'est le cas avec ActiveX, cette liste ne correspond pas √† l'ensemble des classes qui peuvent vraiment √™tre charg√©es en tant que documents OLE. <br><br><img src="https://habrastorage.org/webt/yi/x9/1g/yix91gwugtk06yq_s37z4iibzy0.png"><br><br><h4>  Pr√©sentation du programme </h4><br>  Comme dans le cas d'ActiveX, l'impl√©mentation de tout document OLE est repr√©sent√©e par la classe COM correspondante, r√©alis√©e sous la forme d'une DLL ou d'un EXE.  Le composant exporte les interfaces de service n√©cessaires et l'√©tat est enregistr√© dans le document conteneur via les interfaces IPersist *. <br><br>  Dans un document CFBF, les donn√©es d'objet OLE sont stock√©es dans un stockage de deuxi√®me niveau ObjectPool.  Un ensemble de threads est g√©n√©ralement similaire aux contr√¥les ActiveX correspondants. <br><br><img src="https://habrastorage.org/webt/ir/qt/oc/irqtocl-val1mrwslawmlpzdpsq.png"><br><br>  Dans les documents Open Office XML, les donn√©es d'objet OLE sont stock√©es dans le sous-r√©pertoire incorporations, dans un fichier de stockage CFBF avec un nom de type oleObject1.bin. <br><br><img src="https://habrastorage.org/webt/p-/7e/ww/p-7ewwax0n2gfsbqercoev9tie0.png"><br><br>  Dans les documents RTF, les informations sur l'objet sont stock√©es sous la balise <b>\ object \ objemb \</b> .  La section contient √©galement un stockage cod√© en tant que repr√©sentation hexad√©cimale du fichier CFBF. <br><br> <code>{\object\objemb\objw8307\objh553{\*\objclass WordPad.Document.1} <br> {\*\objdata 010500000200000013000000576f72645061642e446f63756d656e742e31000000000000000000000a0000 <br> <b>d0cf11e</b> 0a1b11ae100000000 <br></code> <br><br>  Le format RTF se distingue par le fait qu'il prend en charge la balise <b>\ objupdate</b> , qui provoque l'activation automatique de l'√©l√©ment, tandis que par d√©faut les √©l√©ments OLE sont inactifs lors du chargement. <br><blockquote>  Exemple: CVE-2017-11882 <br>  La vuln√©rabilit√© <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2017-11882</a> OLE du composant Equation Editor due au traitement de l'objet dans un processus distinct a rendu possible un fonctionnement stable et universel.  La balise \ objupdate a forc√© Word √† charger le composant vuln√©rable imm√©diatement √† l'ouverture du document. <br></blockquote><blockquote>  Exemple: √©l√©ments int√©gr√©s Excel avec virus de macro <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les chercheurs ont d√©couvert</a> des documents rtf malveillants qui n'utilisent aucune nouvelle vuln√©rabilit√©.  Les documents contiennent plusieurs documents Excel avec des macros en tant qu'objets incorpor√©s.  Le calcul est effectu√© sur le fait que l'utilisateur qui, apr√®s avoir ouvert le document plusieurs fois de suite, refuse d'ex√©cuter la macro, se "rend" et autorise l'ex√©cution.  Pour le moment, la technique fonctionne toujours. <br><br><img src="https://habrastorage.org/webt/ih/e_/oq/ihe_oqpkamkndvqbjfcmxhjqhbi.png"><br></blockquote>  Une diff√©rence significative par rapport √† ActiveX dans le cas d'√©l√©ments OLE incorpor√©s est que l'identificateur de classe est √©crit directement dans le fichier de stockage par la fonction WriteClassStg.  Cette technique est h√©rit√©e d'il y a tr√®s longtemps, lorsque Microsoft a d√©velopp√© avec enthousiasme le concept de "s√©rialisation" et de stockage d'objets avec leur √©tat au format CFBF.  Le document conteneur enregistre √©galement l'identifiant de classe de l'√©l√©ment impl√©ment√©, mais l'objet de la classe sp√©cifi√© dans le r√©f√©rentiel sera charg√©.  Cet identifiant peut √™tre remplac√© en for√ßant l'application √† charger un objet qui n'est pas du tout pr√©vu √† ces fins. <br>  Il est possible d'√©diter les donn√©es d'√©l√©ment, ce qui conduit dans certains cas √† l'identification de vuln√©rabilit√©s. <br><br>  Les objets OLE sont √©galement soumis √† de nombreuses v√©rifications de t√©l√©chargement, ce qui rend difficile l'obtention d'une liste compl√®te des √©l√©ments potentiellement charg√©s.  L'ensemble des √©l√©ments pouvant √™tre charg√©s en tant qu'objets OLE est diff√©rent de la liste des ActiveX charg√©s.  En particulier, ils sont v√©rifi√©s sur une liste KillBit n'appartenant pas √† Office, mais √† Internet Explorer (HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Internet Explorer \ Compatibilit√© ActiveX). <br><br><h4>  OLE par lien </h4><br>  OLE distingue deux m√©canismes pour incorporer du contenu dans un document - incorporer directement un document OLE et cr√©er un lien dans un autre document vers un autre document.  En cas d'incorporation de l'objet OLE par r√©f√©rence, le document principal contient une indication du chemin d'acc√®s au fichier du document incorpor√©.  Le chemin peut √™tre local ou r√©seau, ou une adresse Internet.  Le gestionnaire OLE est d√©termin√© par l'extension de fichier, le gestionnaire correspondant doit √™tre enregistr√© dans le syst√®me d'exploitation. <br><blockquote>  Exemple: CVE-2017-0199 <br>  La vuln√©rabilit√© de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2017-0199</a> consistait en la possibilit√© d'ajouter un format hta ¬´objet par r√©f√©rence¬ª au document.  Ce dernier est html avec la possibilit√© d'ex√©cuter du code, c'est-√†-dire qu'il s'agit en fait d'un fichier ex√©cutable.  Le gestionnaire a automatiquement t√©l√©charg√© et ex√©cut√© hta, vous permettant d'ex√©cuter du code arbitraire lors de l'ouverture d'un document. <br></blockquote>  Avant de mettre √† jour l'objet incorpor√©, l'application demande l'autorisation de l'utilisateur.  Dans ce cas, le fichier est t√©l√©charg√© √† l'avance, ce qui peut servir √† divulguer des informations sur l'utilisateur. <br><br><h3>  Fichiers int√©gr√©s (packages) </h3><br>  Les documents Office prennent en charge la possibilit√© d'ajouter n'importe quel fichier (Objet -&gt; Cr√©er √† partir d'un fichier ou simplement faire glisser et d√©poser l'ic√¥ne de fichier dans le champ d'√©dition).  Techniquement, cela est impl√©ment√© en ajoutant un √©l√©ment <b>Object Packager</b> int√©gr√© au document qui √©crit le fichier souhait√© dans ses propres donn√©es.  Object Packager vous permet de remplacer l'ic√¥ne et la signature du fichier, ainsi que de sp√©cifier la ligne de commande √† ouvrir.  Il peut inclure des <b>fichiers ¬´par r√©f√©rence¬ª</b> lorsque le fichier est ouvert non pas √† partir de son propre stockage, mais le long du chemin sp√©cifi√©, <b>y compris celui du r√©seau</b> . <br><br>  R√©cemment, la fonctionnalit√© d'Object Packager a √©t√© consid√©rablement r√©duite, et initialement l'√©l√©ment pouvait enregistrer tous les fichiers, y compris l'ex√©cutable, les liens et m√™me la ligne de commande.  Tout ce que l'utilisateur devait faire pour d√©marrer le contenu √©tait de double-cliquer sur l'ic√¥ne dans le texte du document. <br><blockquote>  Exemple: fichiers dans le corps d'un message Outlook <br>  Les messages Outlook, qui sont √©galement des documents compos√©s, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous</a> permettent d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ajouter des √©l√©ments Object Packager au corps du message</a> .  Pour l'utilisateur, l'√©l√©ment ressemble √† une image arbitrairement s√©lectionn√©e par un attaquant.  Un double-clic sur l'image ouvre le fichier compress√©.  Un attaquant doit choisir un type de donn√©es parmi ceux qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne sont pas encore soumis √† des politiques de s√©curit√© renforc√©es</a> . <br></blockquote><br><img src="https://habrastorage.org/webt/r-/cl/lr/r-cllr7l101bxg1g7noz3ntrs-c.jpeg"><br><br><h3>  √âl√©ments en ligne non impl√©ment√©s √† l'aide d'OLE </h3><br>  √Ä l'heure actuelle, la plus grande menace / int√©r√™t des √©l√©ments non OLE peut √™tre des <b>images qui sont ajout√©es au document par r√©f√©rence</b> .  Lorsqu'un document est ouvert dans un mode non prot√©g√©, les images sont t√©l√©charg√©es automatiquement, ce qui peut entra√Æner la divulgation de l'emplacement et de l'identit√© de l'utilisateur qui a t√©l√©charg√© le document via des procurations anonymes ou a re√ßu un document confidentiel de tiers.  Cette technique, en particulier, a √©t√© mise en ≈ìuvre dans l' <b>outil Scribbles</b> , qui est en service aupr√®s des services de renseignement am√©ricains. <br>  Sur un r√©seau local Windows, le t√©l√©chargement automatique d'images par r√©f√©rence permet d'exploiter la <b>vuln√©rabilit√© NTLMRelay</b> .  Le m√©canisme de liaison des images n'est pas compatible avec les exigences de s√©curit√© des r√©seaux ActiveDirectory, car un administrateur recevant un tel document ex√©cute essentiellement un code attaquant avec des privil√®ges administratifs complets. <br><br><h3>  M√©thodes de s√©curit√© </h3><br>  Que peut-on faire?  Dans l'ensemble, un peu. <br><br>  La m√©thode de protection la plus efficace contre les vuln√©rabilit√©s des objets int√©gr√©s dans les documents Office est <b>le mode d'affichage prot√©g√©</b> .  Dans ce mode, le chargement d'objets et le chargement de donn√©es √† partir de sources externes sont exclus.  Malheureusement, la transition vers un mode complet n√©cessite des actions utilisateur √©l√©mentaires qui sont facilement provoqu√©es par les m√©thodes d'ing√©nierie sociale. <br><br><img src="https://habrastorage.org/webt/4r/7l/x_/4r7lx_il1btctygcoor7a9gmvwc.png"><br><br>  Les contr√¥les ActiveX peuvent √™tre <b>d√©sactiv√©s dans les param√®tres du Trust Center</b> <br><br><img src="https://habrastorage.org/webt/bf/ev/ol/bfevolvqahqwt-6slndlob7phxq.png"><br><br>  Notez que cela ne fonctionne pas pour les √©l√©ments en ligne OLE. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423933/">https://habr.com/ru/post/fr423933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423921/index.html">10 ans d'Android: souvenez-vous de tout</a></li>
<li><a href="../fr423923/index.html">SAP Leonardo Hackathon de velcom et SAP pour les d√©veloppeurs de Bi√©lorussie</a></li>
<li><a href="../fr423925/index.html">Webinaire ouvert "Mod√®le r√©cursif √©trange"</a></li>
<li><a href="../fr423927/index.html">10 moteurs de recherche prometteurs pour am√©liorer le r√©f√©rencement</a></li>
<li><a href="../fr423931/index.html">Comment contourner l'authentification SMS lors de la connexion aux r√©seaux Wi-Fi publics?</a></li>
<li><a href="../fr423935/index.html">Embox r√©pond aux questions les plus courantes du festival TechTrain IT</a></li>
<li><a href="../fr423937/index.html">El√©vation de privil√®ges Windows</a></li>
<li><a href="../fr423939/index.html">Programmation dynamique ou Diviser pour mieux r√©gner</a></li>
<li><a href="../fr423941/index.html">Rapports d'iOS mitap Redmadrobot</a></li>
<li><a href="../fr423943/index.html">Optimisation des prix de d√©tail hors ligne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>