<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>💠 🥀 🤯 Sécurité de Microsoft Office: objets intégrés 🤯 🧗🏿 👷🏻</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Initialement, l'architecture de Microsoft Office a été construite sur la base du concept de documents composites, ce sont aussi des documents OLE , ac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Sécurité de Microsoft Office: objets intégrés</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/dsec/blog/423933/"><img src="https://habrastorage.org/webt/os/-z/yx/os-zyx2ayrnxagtecn42u4spxke.jpeg"><br><br>  Initialement, l'architecture de Microsoft Office a été construite sur la base du concept de documents composites, ce sont aussi des <b>documents OLE</b> , activement promus par Microsoft à l'aube de Windows 32 bits.  À cette époque, l'idée de combiner «de manière transparente» des données de différents formats dans un seul document semblait tentante et fascinante, et avant d'identifier les premiers problèmes, elle a réussi à se développer fermement en de nombreux produits à grande échelle. <br><br>  La «mauvaise nouvelle» est que la manière universelle d'ajouter des données (et le code de traitement de ces données) dans les documents est devenue une manière universelle d'introduire des vulnérabilités dans le produit, qui présente encore aujourd'hui de <s>bonnes</s> surprises aux <s>créateurs de</s> chercheurs en sécurité <s>de logiciels malveillants</s> . <a name="habracut"></a><br><br>  Par la suite, le package d'application a reçu un ensemble assez riche d'outils pour ajouter des images, des graphiques et des graphiques, des éléments de contrôle qui sont créés et traités par l'application et qui en font partie dans les documents.  Du point de vue de la sécurité, ces éléments présentent un intérêt légèrement inférieur à ceux qui seront (principalement) abordés dans l'article - les éléments qui utilisent le code des applications externes qui sont ajoutés aux documents utilisant OLE. <br><br>  Une représentation «disque» d'un document composé est un <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">fichier CFBF</a> .  Cet article abordera l'incorporation d'objets dans des documents Microsoft Office (ou plutôt, uniquement l'aspect sécurité) dans le contexte des <b>données et du code chargés en mémoire</b> lors de l'exécution. <br><br>  Les objets officiellement incorporés dans les documents Microsoft Office peuvent être répartis dans les groupes suivants: <br><br><ul><li>  Contrôles ActiveX (contrôles ActiveX) </li><li>  <b>Objets intégrés OLE</b> </li><li>  Fichiers intégrés ( <b>packages</b> ) </li><li>  Éléments en ligne <b>non OLE</b> </li></ul><br><h3>  Contrôles ActiveX </h3><br>  Les contrôles ActiveX peuvent être représentés comme des éléments d'une fenêtre de programme - par exemple, des boutons, des boutons radio, des listes, des champs de saisie et d'autres formulaires - conçus pour produire certains événements ou répondre à des événements.  Il était une fois une bonne idée de créer de tels éléments de contrôle universels, avec la possibilité de les utiliser dans n'importe quelle application, et de les placer à cet effet dans les <b>composants COM</b> . <br><br>  Les pages Web intégrées ActiveX représentaient une faille de sécurité Internet Explorer bien connue, les mesures de sécurité ont augmenté au fil du temps.  Les navigateurs d'autres fabricants ont presque immédiatement abandonné la prise en charge d'ActiveX.  Le nouveau navigateur Microsoft Edge s'est enfin séparé de cette relique du passé.  L'incorporation dans les documents Office est cependant toujours possible. <br><br>  ActiveX dans les documents est destiné à être utilisé conjointement avec <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u="><b>Visual Basic pour Applications</b></a> .  Cependant, VBA n'est pas requis pour les télécharger et les activer, et l'autorisation utilisateur n'est pas requise pour télécharger des <b>éléments de la liste blanche</b> . <br><br>  Les vulnérabilités dans ce dernier sont particulièrement dangereuses - les paramètres par défaut définis lors de l'installation de l'application n'impliquent aucune protection contre le chargement de ces éléments, ni un avertissement à l'utilisateur.  L'administrateur doit resserrer les paramètres en interdisant le chargement de tous les contrôles ActiveX (cependant, notez que ActiveX ne se charge pas en mode de navigation sécurisée). <br><blockquote>  Exemple: CVE-2012-0158 <br><br>  L'une des vulnérabilités les plus dangereuses des documents Office en 2012 était <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2012-0158</a> .  Le code de chargement de l'élément Microsoft ListView Control 6.0 de la bibliothèque MSCOMCTL.OCX contenait la possibilité d'un débordement de tampon, ce qui permettait de remplacer l'adresse de retour et d'exécuter du code arbitraire.  Étant donné que l'élément était dans la «liste blanche» ActiveX, le chargement a commencé immédiatement lorsque le document a été ouvert.  La vulnérabilité est actuellement corrigée, le contrôle ListView est toujours considéré comme «sûr». </blockquote><h4>  Ajout d'ActiveX à un document </h4><br>  Pour ajouter un élément de contrôle à un document Microsoft Office (pour plus de simplicité, prenez Word), utilisez l'interface utilisateur pour ouvrir l'onglet "Développeur" (sa visibilité est configurée dans le menu "Options Word") et sélectionnez Contrôles -&gt; Outils des versions précédentes -&gt; Contrôles ActiveX.  Le menu présentera un ensemble d'icônes correspondant aux éléments Microsoft Forms, ainsi que la possibilité de sélectionner ActiveX dans la liste composée des éléments disponibles dans le système qui sont sélectionnés selon un certain nombre de critères. <br><br><img src="https://habrastorage.org/webt/nn/wt/jt/nnwtjte9nabt8rriqxotr4f7is4.jpeg"><br><br>  La liste affichée ne correspond pas à l'ensemble des éléments qui peuvent réellement être chargés dans le document, elle ne peut donc pas être guidée lors de la recherche d'éléments vulnérables.  La vérification sophistiquée à plusieurs niveaux de l'ActiveX téléchargé comporte plusieurs étapes, elle diffère pour les versions d'Office et varie d'une mise à jour à l'autre, donc le moyen le plus sûr de vérifier la téléchargabilité est de «composer» manuellement le fichier de document avec l'élément d'intérêt et d'essayer de l'ouvrir dans Office.  Les formats de document possibles sont décrits ci-dessous. <br><br><h4>  Présentation du programme </h4><br>  Chaque élément ActiveX est essentiellement un objet de l'une des classes COM qui répondent à certaines exigences.  Un élément est chargé à l'aide du sous-système COM et le code exécutable est contenu dans l'un des modules, qui sont généralement «externes» à l'application conteneur.  Comme tout objet COM, un élément ActiveX peut être implémenté en tant que DLL ou en tant que fichier EXE exécutable.  Dans le premier cas, la bibliothèque sera chargée dans l'espace d'adressage du conteneur, dans le second - l'élément sera traité dans un processus séparé, avec le transfert de données entre le conteneur et l'objet via le marshaling COM. <br><br>  Comme tout objet COM, ActiveX possède des <b>interfaces</b> , des <b>propriétés</b> et des <b>méthodes</b> . <br><br>  Les interfaces sont principalement un ensemble d'interfaces standard que la classe ActiveX doit avoir pour le chargement complet et l'interaction avec le conteneur, en particulier IOleControl et IOleObject. <br><br>  L'absence d'interfaces nécessaires peut réduire la fonctionnalité de l'élément ou interrompre son chargement à un certain stade. <br><blockquote>  Exemple: CVE-2015-2424 <br>  La vulnérabilité <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2015-2424</a> était associée à l'élément TaskSymbol Class de la bibliothèque mmcndmgr.dll.  L'élément n'était pas destiné à être utilisé dans des documents et n'a pas exporté l'interface IDispatch.  Lors du chargement d'un élément, la procédure qui a demandé cette interface a reçu une erreur et a détruit la structure interne de l'élément, ce qui a conduit à une vulnérabilité de type utilisation après libération.  Pour le moment, l'élément n'est pas autorisé à être téléchargé (malgré cela, il peut toujours être trouvé dans la liste à ajouter au menu "Développeur").  La vulnérabilité elle-même n'est pas résolue. <br></blockquote>  En plus des standards, chaque classe ActiveX exporte l'interface «principale», représentant sa propre fonctionnalité unique.  Par exemple, pour la classe Forms.CommandButton.1, il s'agit de ICommandButton. <br><br>  Vous pouvez afficher les interfaces ActiveX à l'aide de l'outil <b>OleView</b> inclus dans le package Microsoft Visual Studio. <br><br><img src="https://habrastorage.org/webt/um/cc/zm/umcczmybv5voo3c6bbde66zxdmq.png"><br><br>  L'interface d'un élément définit ses <b>méthodes</b> et <b>propriétés</b> .  Les propriétés représentent certaines données qui déterminent l'apparence et le fonctionnement d'un élément.  Le développeur d'un élément ActiveX attribue un nom spécifique à chaque propriété, par exemple BackColor ou GridLineWidth, et un type, par exemple, une chaîne, un entier ou une double précision réelle.  Pour les images et les icônes bitmap, il existe un type de propriété telle qu'une image.  Le programme client peut définir des propriétés individuelles du contrôle en définissant leurs indices et valeurs entiers. <br><br>  Du point de vue d'une implémentation de bas niveau, la division en méthodes et propriétés est formelle, car les «propriétés» sont représentées par un ensemble de méthodes get / set.  Cependant, il existe une différence significative: les méthodes d'un élément (son interface principale) ne peuvent être appelées par programme, dans le cas de documents Office, qu'à partir d'un programme VBA en cours d'exécution.  Du point de vue de la sécurité, cela n'a pas un grand intérêt, car l'exécution de VBA est déjà un compromis du système d'exploitation.  <b>Les propriétés</b> sont enregistrées dans le document et lorsqu'il est ouvert, elles seront <b>traitées et chargées</b> dans les structures en mémoire <b>même si l'exécution de VBA est interdite</b> . <br><br>  D'un point de vue logiciel, de la part de l'élément, pour conserver ses propriétés et son état dans le document, le conteneur fournit les <b>interfaces IStream</b> , <b>IStorage</b> et <b>IPropertyBag</b> .  Leur implémentation et présentation des données dans un fichier disque ne sont plus du ressort de l'élément ActiveX, et dépendent entièrement du conteneur et du format du document.  Il convient de noter que l'ensemble et le format des données stockées peuvent correspondre à un ensemble de propriétés exportées «publiquement», ou être complètement différents.  Considérez des exemples d'implémentation liés à Microsoft Office. <br><br><h4>  Fichier composé (CFBF) </h4><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Le format de document Office obsolète</a> , où le stockage de niveau inférieur ObjectPool et des sous-répertoires séparés à l'intérieur ont été alloués pour le stockage des données ActiveX.  Le flux "\ 001CompObj" contient l'identifiant de classe, qui détermine finalement la classe de l'objet chargé.  <b>Le remplacement de l'identifiant</b> directement dans hex entraînera une tentative de chargement d'un objet d'une <b>classe</b> complètement <b>différente</b> . <br><br><img src="https://habrastorage.org/webt/bc/sx/uc/bcsxucmomcw9wnqwgn-84bxosnu.jpeg"><br><br><h4>  Office Open XML </h4><br>  Format de document XML moderne.  Le fichier est une archive zip.  Les données de contrôle ActiveX sont stockées dans le sous-répertoire ActiveX dans des fichiers avec des noms simples comme activeX1.xml. <br><br><img src="https://habrastorage.org/webt/su/gx/uq/sugxuqtgsbhdg8tvr53srkbvtsg.png"><br><br>  Exemple de fichier: <br> <code>&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt; <br> &lt;ax:ocx ax: <b>classid="{D7053240-CE69-11CD-A777-00DD01143C57}</b> " ax: <b>persistence="persistPropertyBag"</b> xmlns:ax="http://schemas.microsoft.com/office/2006/activeX" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"&gt; <br> &lt;ax:ocxPr ax:name="Caption" ax:value="CommandButton1"/&gt; <br> &lt;ax:ocxPr ax:name="Size" ax:value="2540;847"/&gt; <br> &lt;ax:ocxPr ax:name="FontName" ax:value="Calibri"/&gt; <br> &lt;ax:ocxPr ax:name="FontHeight" ax:value="225"/&gt; <br> &lt;ax:ocxPr ax:name="FontCharSet" ax:value="204"/&gt; <br> &lt;ax:ocxPr ax:name="FontPitchAndFamily" ax:value="2"/&gt; <br> &lt;ax:ocxPr ax:name="ParagraphAlign" ax:value="3"/&gt; <br> &lt;/ax:ocx&gt;</code> <br> <br>  Dans ces fichiers, les identificateurs de classe sont indiqués sous forme de texte.  Le remplacement de l'identifiant entraînera également une tentative de chargement d'un élément d'une autre classe. <br><br>  Ensuite, le fichier contient une indication du type de stockage de données de l'objet: persistPropertyBag, persistStorage ou persistStream.  Si un élément prend en <b>charge les</b> propriétés <b>persistPropertyBag</b> , ses données peuvent être stockées <b>dans le même fichier texte</b> , voir l'exemple ci-dessus.  S'il a besoin de <b>stockage</b> ou d'un <b>flux binaire</b> , les données seront enregistrées dans un fichier avec un nom de type activeX1.bin, qui est <b>un fichier CFBF</b> . <br><br><img src="https://habrastorage.org/webt/pt/tx/hp/pttxhpe9gevkgf8l4a7ddmcfspu.png"><br><br><h4>  RTF </h4><br>  Dans un document rtf, l'élément ActiveX est défini par les <b>balises \ object \ objocx</b> .  La <b>balise \ objdata</b> contient le magasin de propriétés de l'élément en tant que représentation hexadécimale du fichier CFBF. <br><br> <code>{\object\objocx\f37\objsetsize\objw1440\objh480{\*\objclass Forms.CommandButton.1} <br> {\*\objdata 010500000200000016000000 <br> 466f726d732e436f6d6d616e64427574746f6e2e31000000000000000000000e0000 <br> <b>d0cf11e</b> 0a1b11ae1000000000000000000000000000000003e000300feff090006</code> <br> <br><h4>  Télécharger depuis un fichier </h4><br>  Le processus de chargement d'ActiveX à partir d'un document dans son ensemble est assez simple.  L'application conteneur crée un objet propre de la classe spécifiée, lui demande l'interface de stockage spécifiée et fournit un pointeur vers le stockage, le flux ou le «package de propriétés». <br><br>  Le filtrage des éléments pouvant être chargés comporte plusieurs étapes.  Tout d'abord, les classes spécifiées dans la liste noire appelées <b>Office COM Kill Bit</b> (indice de registre * OFFICE_KEY * \ Common \ COM Compatibility) sont supprimées.  Par exemple, les indicateurs anti-téléchargement ont des classes telles que Microsoft Scriptlet Component et Microsoft Web Browser. <br><br>  Les classes restantes subiront le chargement initial.  Cela signifie que <b>la DLL sera chargée</b> dans l'application conteneur ou que <b>le processus du serveur COM</b> implémenté dans le fichier EXE sera <b>lancé</b> .  Ce n'est qu'après cela que les autres vérifications seront effectuées, y compris l'élémentaire - et si l'objet est, en fait, un représentant ActiveX. <br><blockquote>  Exemple: CVE-2015-6128 <br>  En 2015, le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">chercheur a découvert</a> que le préchargement des modules COM <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">peut être utilisé pour contourner ASLR et exécuter du code arbitraire</a> en chargeant de fausses bibliothèques dynamiques.  Le CVE-2015-6128 publié par la suite n'est pas un mot sur Microsoft Office. <br></blockquote>  Si l'identifiant définit vraiment ActiveX, il passera par plusieurs vérifications supplémentaires dans plusieurs listes noires et blanches. <br><br><div class="spoiler">  <b class="spoiler_title">Liste de démarrage ActiveX à partir de .docx sur Windows 7 et Office 2016 propres aux paramètres par défaut.</b> <div class="spoiler_text"> <code>{00024522-0000-0000-C000-000000000046} RefEdit.Ctrl <br> {02AF6DD2-77E6-44DF-B3E1-57CF1476D8EA} Microsoft Forms 2.0 OptionButton <br> {04082FC6-E032-49F2-A263-FE64E9DA1FA3} Microsoft Forms 2.0 HTML TEXT <br> {0B314611-2C19-4AB4-8513-A6EEA569D3C4} Microsoft Slider Control, version 6.0 <br> {13D557B6-A469-4362-BEAF-52BFD0F180E2} Microsoft Forms 2.0 HTML TextAREA <br> {19FED08E-EFD1-45da-B524-7BE4774A6AEE} Microsoft Forms 2.0 ListBox <br> {20DD1B9E-87C4-11D1-8BE3-0000F8754DA1} Microsoft Date and Time Picker Control 6.0 (SP4) <br> {227B1F3B-C276-4DE0-9FAA-C0AD42ADDCF0} Microsoft Forms 2.0 HTML RESET <br> {232E456A-87C3-11D1-8BE3-0000F8754DA1} Microsoft MonthView Control 6.0 (SP4) <br> {3D0FD779-0C2D-4708-A9BA-62F7458A5A53} Microsoft Forms 2.0 ToggleButton <br> {444D2D27-02E8-486B-9018-3644958EF8A9} FieldListCtrl.2 Object <br> {4C599241-6926-101B-9992-00000B65C6F9} Microsoft Forms 2.0 Image <br> {5052A832-2C0F-46c7-B67C-1F1FEC37B280} Microsoft Forms 2.0 Label <br> {5512D110-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SUBMIT <br> {5512D112-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML IMAGE <br> {5512D114-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML RESET <br> {5512D116-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML CHECKBOX <br> {5512D118-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML OPTION <br> {5512D11A-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TEXT <br> {5512D11C-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Hidden <br> {5512D11E-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML Password <br> {5512D122-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML SELECT <br> {5512D124-5CC6-11CF-8D67-00AA00BDCE1D} Microsoft Forms 2.0 HTML TextAREA <br> {556C2772-F1AD-4DE1-8456-BD6E8F66113B} Microsoft ImageList Control 6.0 (SP6) <br> {585AA280-ED8B-46B2-93AE-132ECFA1DAFC} Microsoft StatusBar Control 6.0 (SP6) <br> {5CBA34AE-E344-40CF-B61D-FBA4D0D1FF54} Microsoft Forms 2.0 HTML CHECKBOX <br> {5E90CC8B-E402-4350-82D7-996E92010608} Microsoft Forms 2.0 HTML OPTION <br> {603C7E80-87C2-11D1-8BE3-0000F8754DA1} Microsoft UpDown Control 6.0 (SP4) <br> {6240EF28-7EAB-4dc7-A5E3-7CFB35EFB34D} Microsoft Forms 2.0 ScrollBar <br> {65BCBEE4-7728-41A0-97BE-14E1CAE36AAE} Microsoft Office List 16.0 <br> {6C177EBD-C42D-4728-A04B-4131892EDBF6} Microsoft Forms 2.0 ComboBox <br> {787A2D6B-EF66-488D-A303-513C9C75C344} Microsoft Forms 2.0 HTML Password <br> {79176FB0-B7F2-11CE-97EF-00AA006D2776} Microsoft Forms 2.0 SpinButton <br> {86F56B7F-A81B-478d-B231-50FD37CBE761} Microsoft Forms 2.0 CommandButton <br> {87DACC48-F1C5-4AF3-84BA-A2A72C2AB959} Microsoft ImageComboBox Control, version 6.0 <br> {8B2ADD10-33B7-4506-9569-0A1E1DBBEBAE} Microsoft Toolbar Control 6.0 (SP6) <br> {8BD21D10-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 TextBox <br> {8BD21D20-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ListBox <br> {8BD21D30-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ComboBox <br> {8BD21D40-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 CheckBox <br> {8BD21D50-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 OptionButton <br> {8BD21D60-EC42-11CE-9E0D-00AA006002F3} Microsoft Forms 2.0 ToggleButton <br> {9432194C-DF54-4824-8E24-B013BF2B90E3} Microsoft Forms 2.0 HTML SUBMIT <br> {95F0B3BE-E8AC-4995-9DCA-419849E06410} Microsoft TreeView Control 6.0 (SP6) <br> {978C9E23-D4B0-11CE-BF2D-00AA003F40D0} Microsoft Forms 2.0 Label <br> {9A948063-66C3-4F63-AB46-582EDAA35047} Microsoft TabStrip Control 6.0 (SP6) <br> {9BDAC276-BE24-4F04-BB22-11469B28A496} Microsoft Forms 2.0 HTML IMAGE <br> {A0E7BF67-8D30-4620-8825-7111714C7CAB} Microsoft ProgressBar Control, version 6.0 <br> {CCDB0DF2-FD1A-4856-80BC-32929D8359B7} Microsoft ListView Control 6.0 (SP6) <br> {D7053240-CE69-11CD-A777-00DD01143C57} Microsoft Forms 2.0 CommandButton <br> {DCA0ED3C-B95D-490f-9C60-0FF3726C789A} Microsoft Forms 2.0 Image <br> {DD4CB8C5-F540-47ff-84D7-67390D2743CA} Microsoft Forms 2.0 TextBox <br> {DFD181E0-5E2F-11CE-A449-00AA004A803D} Microsoft Forms 2.0 ScrollBar <br> {E9729012-8271-4e1f-BC56-CF85F914915A} Microsoft Forms 2.0 CheckBox <br> {EA778DB4-CE69-4da5-BC1D-34E2168D5EED} Microsoft Forms 2.0 SpinButton <br> {EAE50EB0-4A62-11CE-BED6-00AA00611080} Microsoft Forms 2.0 TabStrip <br> {F14E8B03-D080-4D3A-AEBA-355E77B20F3D} Microsoft Forms 2.0 HTML SELECT <br> {F8CF7A98-2C45-4c8d-9151-2D716989DDAB} Microsoft Visio Document <br> {FB453AD8-2EF4-44D3-98A8-8C6474E63CE4} Microsoft Forms 2.0 HTML Hidden <br> {FDEA20DB-AC7A-42f8-90EE-82208B9B4FC0} Microsoft Forms 2.0 TabStrip <br> {FE38753A-44A3-11D1-B5B7-0000C09000C4} Microsoft Flat Scrollbar Control 6.0 (SP4) <br></code> </div></div><br>  Vous pouvez voir qu'une place importante dans la liste est occupée par les composants du groupe <b>Microsoft Forms</b> .  Il s'agit d'un ensemble de contrôles fournis avec Office, et vous pouvez les voir dans le panneau de contrôles ActiveX.  Au départ, ils étaient tous enregistrés comme «sûrs», mais au fil du temps, il est devenu clair que ce n'était pas le cas pour les éléments individuels.  Par exemple, l'élément Frame charge tout autre ActiveX sans vérifier aucune liste (dans les dernières versions, cela est «fixe», mais la propre liste noire de Frame est différente de celle d'Office générale).  Pour cette raison, certains éléments Microsoft Forms ne peuvent être chargés dans un document qu'avec l'autorisation de l'utilisateur.  Microsoft Forms Frame requiert également le consentement de l'utilisateur (aux paramètres par défaut), mais il vous permet de télécharger certains éléments de la liste Kill Bit qui n'ont pas pu être chargés dans d'autres conditions. <br><br>  Par conséquent, si un attaquant parvient à convaincre l'utilisateur d'autoriser ActiveX à se charger, Frame l'aidera à étendre considérablement l'arsenal en raison d'éléments tels que, par exemple, le navigateur Web. <br><br>  Le format de stockage des propriétés Microsoft Forms est partiellement documenté par <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">la spécification [MS-OFORMS]</a> . <br><br>  Au cours de l'analyse ActiveX, il s'est avéré que l'ensemble des classes pour doc, docx et rtf est différent, ainsi que différentes listes d'ActiveX disponibles pour une application s'exécutant de la manière habituelle et s'exécutant <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">en mode d'automatisation</a> . <br><br>  De nombreuses applications populaires complètent ces listes avec leur propre ActiveX.  Si une vulnérabilité est découverte, elle sera reflétée dans le bulletin comme étant liée à l'application dont elle fait partie.  Cependant, la seule façon d'exploiter cette vulnérabilité peut être les documents Office. <br><blockquote>  Exemple: Flash ActiveX <br>  Flash ActiveX a été particulièrement apprécié par les auteurs de virus pour leurs vulnérabilités constamment détectables et une place permanente dans les listes blanches d'IE et d'Office.  Les premières vulnérabilités connues de ce composant sont apparues en 2008, l'une des dernières <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2018-4878 a été</a> fermée en février de cette année.  Avec la popularité décroissante d'IE, les documents Office sont devenus le principal moyen de distribuer les exploits pour Flash. <br></blockquote><h3>  Éléments de données OLE intégrés </h3><br>  Les éléments OLE implémentés sont conçus pour implémenter le concept de «document dans document» avec la possibilité d'éditer des données sur place de différents formats traitées par d'autres applications.  Comme ActiveX, les documents OLE sont implémentés sur la base de COM. <br><br>  Vous pouvez ajouter un élément OLE à un document Word comme suit: ouvrez l'onglet "Insérer" et sélectionnez Texte -&gt; Objet.  Le programme affiche une liste des types de documents pour lesquels les gestionnaires OLE sont enregistrés.  Comme c'est le cas avec ActiveX, cette liste ne correspond pas à l'ensemble des classes qui peuvent vraiment être chargées en tant que documents OLE. <br><br><img src="https://habrastorage.org/webt/yi/x9/1g/yix91gwugtk06yq_s37z4iibzy0.png"><br><br><h4>  Présentation du programme </h4><br>  Comme dans le cas d'ActiveX, l'implémentation de tout document OLE est représentée par la classe COM correspondante, réalisée sous la forme d'une DLL ou d'un EXE.  Le composant exporte les interfaces de service nécessaires et l'état est enregistré dans le document conteneur via les interfaces IPersist *. <br><br>  Dans un document CFBF, les données d'objet OLE sont stockées dans un stockage de deuxième niveau ObjectPool.  Un ensemble de threads est généralement similaire aux contrôles ActiveX correspondants. <br><br><img src="https://habrastorage.org/webt/ir/qt/oc/irqtocl-val1mrwslawmlpzdpsq.png"><br><br>  Dans les documents Open Office XML, les données d'objet OLE sont stockées dans le sous-répertoire incorporations, dans un fichier de stockage CFBF avec un nom de type oleObject1.bin. <br><br><img src="https://habrastorage.org/webt/p-/7e/ww/p-7ewwax0n2gfsbqercoev9tie0.png"><br><br>  Dans les documents RTF, les informations sur l'objet sont stockées sous la balise <b>\ object \ objemb \</b> .  La section contient également un stockage codé en tant que représentation hexadécimale du fichier CFBF. <br><br> <code>{\object\objemb\objw8307\objh553{\*\objclass WordPad.Document.1} <br> {\*\objdata 010500000200000013000000576f72645061642e446f63756d656e742e31000000000000000000000a0000 <br> <b>d0cf11e</b> 0a1b11ae100000000 <br></code> <br><br>  Le format RTF se distingue par le fait qu'il prend en charge la balise <b>\ objupdate</b> , qui provoque l'activation automatique de l'élément, tandis que par défaut les éléments OLE sont inactifs lors du chargement. <br><blockquote>  Exemple: CVE-2017-11882 <br>  La vulnérabilité <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2017-11882</a> OLE du composant Equation Editor due au traitement de l'objet dans un processus distinct a rendu possible un fonctionnement stable et universel.  La balise \ objupdate a forcé Word à charger le composant vulnérable immédiatement à l'ouverture du document. <br></blockquote><blockquote>  Exemple: éléments intégrés Excel avec virus de macro <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Les chercheurs ont découvert</a> des documents rtf malveillants qui n'utilisent aucune nouvelle vulnérabilité.  Les documents contiennent plusieurs documents Excel avec des macros en tant qu'objets incorporés.  Le calcul est effectué sur le fait que l'utilisateur qui, après avoir ouvert le document plusieurs fois de suite, refuse d'exécuter la macro, se "rend" et autorise l'exécution.  Pour le moment, la technique fonctionne toujours. <br><br><img src="https://habrastorage.org/webt/ih/e_/oq/ihe_oqpkamkndvqbjfcmxhjqhbi.png"><br></blockquote>  Une différence significative par rapport à ActiveX dans le cas d'éléments OLE incorporés est que l'identificateur de classe est écrit directement dans le fichier de stockage par la fonction WriteClassStg.  Cette technique est héritée d'il y a très longtemps, lorsque Microsoft a développé avec enthousiasme le concept de "sérialisation" et de stockage d'objets avec leur état au format CFBF.  Le document conteneur enregistre également l'identifiant de classe de l'élément implémenté, mais l'objet de la classe spécifié dans le référentiel sera chargé.  Cet identifiant peut être remplacé en forçant l'application à charger un objet qui n'est pas du tout prévu à ces fins. <br>  Il est possible d'éditer les données d'élément, ce qui conduit dans certains cas à l'identification de vulnérabilités. <br><br>  Les objets OLE sont également soumis à de nombreuses vérifications de téléchargement, ce qui rend difficile l'obtention d'une liste complète des éléments potentiellement chargés.  L'ensemble des éléments pouvant être chargés en tant qu'objets OLE est différent de la liste des ActiveX chargés.  En particulier, ils sont vérifiés sur une liste KillBit n'appartenant pas à Office, mais à Internet Explorer (HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ Internet Explorer \ Compatibilité ActiveX). <br><br><h4>  OLE par lien </h4><br>  OLE distingue deux mécanismes pour incorporer du contenu dans un document - incorporer directement un document OLE et créer un lien dans un autre document vers un autre document.  En cas d'incorporation de l'objet OLE par référence, le document principal contient une indication du chemin d'accès au fichier du document incorporé.  Le chemin peut être local ou réseau, ou une adresse Internet.  Le gestionnaire OLE est déterminé par l'extension de fichier, le gestionnaire correspondant doit être enregistré dans le système d'exploitation. <br><blockquote>  Exemple: CVE-2017-0199 <br>  La vulnérabilité de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">CVE-2017-0199</a> consistait en la possibilité d'ajouter un format hta «objet par référence» au document.  Ce dernier est html avec la possibilité d'exécuter du code, c'est-à-dire qu'il s'agit en fait d'un fichier exécutable.  Le gestionnaire a automatiquement téléchargé et exécuté hta, vous permettant d'exécuter du code arbitraire lors de l'ouverture d'un document. <br></blockquote>  Avant de mettre à jour l'objet incorporé, l'application demande l'autorisation de l'utilisateur.  Dans ce cas, le fichier est téléchargé à l'avance, ce qui peut servir à divulguer des informations sur l'utilisateur. <br><br><h3>  Fichiers intégrés (packages) </h3><br>  Les documents Office prennent en charge la possibilité d'ajouter n'importe quel fichier (Objet -&gt; Créer à partir d'un fichier ou simplement faire glisser et déposer l'icône de fichier dans le champ d'édition).  Techniquement, cela est implémenté en ajoutant un élément <b>Object Packager</b> intégré au document qui écrit le fichier souhaité dans ses propres données.  Object Packager vous permet de remplacer l'icône et la signature du fichier, ainsi que de spécifier la ligne de commande à ouvrir.  Il peut inclure des <b>fichiers «par référence»</b> lorsque le fichier est ouvert non pas à partir de son propre stockage, mais le long du chemin spécifié, <b>y compris celui du réseau</b> . <br><br>  Récemment, la fonctionnalité d'Object Packager a été considérablement réduite, et initialement l'élément pouvait enregistrer tous les fichiers, y compris l'exécutable, les liens et même la ligne de commande.  Tout ce que l'utilisateur devait faire pour démarrer le contenu était de double-cliquer sur l'icône dans le texte du document. <br><blockquote>  Exemple: fichiers dans le corps d'un message Outlook <br>  Les messages Outlook, qui sont également des documents composés, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">vous</a> permettent d' <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ajouter des éléments Object Packager au corps du message</a> .  Pour l'utilisateur, l'élément ressemble à une image arbitrairement sélectionnée par un attaquant.  Un double-clic sur l'image ouvre le fichier compressé.  Un attaquant doit choisir un type de données parmi ceux qui <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">ne sont pas encore soumis à des politiques de sécurité renforcées</a> . <br></blockquote><br><img src="https://habrastorage.org/webt/r-/cl/lr/r-cllr7l101bxg1g7noz3ntrs-c.jpeg"><br><br><h3>  Éléments en ligne non implémentés à l'aide d'OLE </h3><br>  À l'heure actuelle, la plus grande menace / intérêt des éléments non OLE peut être des <b>images qui sont ajoutées au document par référence</b> .  Lorsqu'un document est ouvert dans un mode non protégé, les images sont téléchargées automatiquement, ce qui peut entraîner la divulgation de l'emplacement et de l'identité de l'utilisateur qui a téléchargé le document via des procurations anonymes ou a reçu un document confidentiel de tiers.  Cette technique, en particulier, a été mise en œuvre dans l' <b>outil Scribbles</b> , qui est en service auprès des services de renseignement américains. <br>  Sur un réseau local Windows, le téléchargement automatique d'images par référence permet d'exploiter la <b>vulnérabilité NTLMRelay</b> .  Le mécanisme de liaison des images n'est pas compatible avec les exigences de sécurité des réseaux ActiveDirectory, car un administrateur recevant un tel document exécute essentiellement un code attaquant avec des privilèges administratifs complets. <br><br><h3>  Méthodes de sécurité </h3><br>  Que peut-on faire?  Dans l'ensemble, un peu. <br><br>  La méthode de protection la plus efficace contre les vulnérabilités des objets intégrés dans les documents Office est <b>le mode d'affichage protégé</b> .  Dans ce mode, le chargement d'objets et le chargement de données à partir de sources externes sont exclus.  Malheureusement, la transition vers un mode complet nécessite des actions utilisateur élémentaires qui sont facilement provoquées par les méthodes d'ingénierie sociale. <br><br><img src="https://habrastorage.org/webt/4r/7l/x_/4r7lx_il1btctygcoor7a9gmvwc.png"><br><br>  Les contrôles ActiveX peuvent être <b>désactivés dans les paramètres du Trust Center</b> <br><br><img src="https://habrastorage.org/webt/bf/ev/ol/bfevolvqahqwt-6slndlob7phxq.png"><br><br>  Notez que cela ne fonctionne pas pour les éléments en ligne OLE. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr423933/">https://habr.com/ru/post/fr423933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr423921/index.html">10 ans d'Android: souvenez-vous de tout</a></li>
<li><a href="../fr423923/index.html">SAP Leonardo Hackathon de velcom et SAP pour les développeurs de Biélorussie</a></li>
<li><a href="../fr423925/index.html">Webinaire ouvert "Modèle récursif étrange"</a></li>
<li><a href="../fr423927/index.html">10 moteurs de recherche prometteurs pour améliorer le référencement</a></li>
<li><a href="../fr423931/index.html">Comment contourner l'authentification SMS lors de la connexion aux réseaux Wi-Fi publics?</a></li>
<li><a href="../fr423935/index.html">Embox répond aux questions les plus courantes du festival TechTrain IT</a></li>
<li><a href="../fr423937/index.html">Elévation de privilèges Windows</a></li>
<li><a href="../fr423939/index.html">Programmation dynamique ou Diviser pour mieux régner</a></li>
<li><a href="../fr423941/index.html">Rapports d'iOS mitap Redmadrobot</a></li>
<li><a href="../fr423943/index.html">Optimisation des prix de détail hors ligne</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>