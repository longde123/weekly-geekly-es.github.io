<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üë®üèΩ‚Äçüé§ üôèüèº üêΩ 3. Pilha el√°stica: an√°lise de log de seguran√ßa. Dashboards ü§πüèæ ‚úñÔ∏è ‚ùì</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Nos artigos anteriores, nos familiarizamos um pouco com a pilha elk e configuramos o arquivo de configura√ß√£o do Logstash para o analisador de logs. Ne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>3. Pilha el√°stica: an√°lise de log de seguran√ßa. Dashboards</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/tssolution/blog/482054/"><img src="https://habrastorage.org/webt/1h/r_/da/1hr_dazcr60epg8j9trtakaflhq.png"><br><br>  Nos artigos anteriores, nos familiarizamos um pouco com a pilha elk e configuramos o arquivo de configura√ß√£o do Logstash para o analisador de logs. Neste artigo, passaremos para o mais importante do ponto de vista da an√°lise, o que voc√™ deseja ver no sistema e para o que tudo foi criado - gr√°ficos e tabelas combinados em <b>pain√©is</b> .  Hoje, examinaremos mais de perto o <b>sistema de</b> visualiza√ß√£o <b>Kibana</b> , consideraremos como criar gr√°ficos, tabelas e, como resultado, criar um painel simples com base nos logs do firewall do Check Point. <br><a name="habracut"></a><br>  A primeira etapa no trabalho com o kibana √© criar um <b>padr√£o de √≠ndice</b> , logicamente, este √© um banco de dados de √≠ndices que s√£o unificados de acordo com um determinado princ√≠pio.  Obviamente, essa √© apenas uma configura√ß√£o, para que o Kibana procure mais convenientemente informa√ß√µes sobre todos os √≠ndices ao mesmo tempo.  √â especificado combinando a string, digamos "checkpoint- *" e o nome do √≠ndice.  Por exemplo, "checkpoint-2019.12.05" se ajustar√° ao padr√£o, mas apenas "checkpoint" n√£o est√° mais l√°.  Vale mencionar separadamente que voc√™ n√£o pode procurar informa√ß√µes sobre diferentes padr√µes de √≠ndice ao mesmo tempo; um pouco mais adiante, nos artigos subsequentes, veremos que as solicita√ß√µes de API s√£o feitas pelo nome do √≠ndice ou apenas por uma linha do padr√£o; a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/64/nm/tb/64nmtbsfwl-qfysx5n6km6iwr3m.png"></a> <br><br>  Depois disso, verificamos no menu Descobrir se todos os logs est√£o indexados e o analisador correto est√° configurado.  Se forem encontradas inconsist√™ncias, por exemplo, alterando o tipo de dados de uma sequ√™ncia para um n√∫mero inteiro, voc√™ precisar√° editar o arquivo de configura√ß√£o do Logstash, como resultado, novos logs ser√£o gravados corretamente.  Para que os logs antigos tenham a forma desejada antes da altera√ß√£o, apenas o processo de reindexa√ß√£o ajuda. Nos artigos subsequentes, essa opera√ß√£o ser√° considerada com mais detalhes.  Verifique se est√° tudo em ordem, para que a imagem seja clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/y1/-h/jk/y1-hjkcxrtdpuufzqxqdpqhlvha.png"></a> <br><br>  Os logs estavam no lugar, o que significa que voc√™ pode come√ßar a criar pain√©is.  Com base nas an√°lises do painel de produtos de seguran√ßa, voc√™ pode entender o estado da seguran√ßa das informa√ß√µes em uma organiza√ß√£o, ver claramente as vulnerabilidades na pol√≠tica atual e desenvolver formas de elimin√°-las.  Vamos criar um pequeno painel usando v√°rias ferramentas de visualiza√ß√£o.  O painel ser√° composto por 5 componentes: <br><br><ol><li>  tabela para calcular o n√∫mero total de logs por l√¢minas </li><li>  Tabela de assinaturas cr√≠ticas do IPS </li><li>  Gr√°fico de pizza de eventos de preven√ß√£o de amea√ßas </li><li>  gr√°fico dos sites mais visitados </li><li>  diagrama para usar os aplicativos mais perigosos </li></ol><br>  Para criar formas de visualiza√ß√£o, voc√™ precisa ir ao menu <b>Visualizar</b> e selecionar a forma desejada que queremos criar!  Vamos em ordem. <br><br><h3>  Tabela para calcular o n√∫mero total de logs por l√¢minas </h3><br>  Para fazer isso, selecione a forma <b>Tabela de dados</b> , solte-o no snap-in para criar gr√°ficos, coloque as configura√ß√µes de forma √† esquerda e √† direita como ficar√° nas configura√ß√µes atuais.  Primeiro, demonstrarei como ser√° a tabela final. Depois disso, veremos as configura√ß√µes, a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/h6/qh/zs/h6qhzsfawr4qslqtdfybm3zvzsw.png"></a> <br><br>  Configura√ß√µes de forma mais detalhadas, a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/pe/2j/d2/pe2jd28os3xkfs70wi9jl--0kcc.png"></a> <br><br>  Vamos analisar as configura√ß√µes. <br><br>  A <b>m√©trica √©</b> configurada inicialmente; esse √© o valor pelo qual todos os campos ser√£o agregados.  As m√©tricas s√£o calculadas com base nos valores extra√≠dos de uma maneira ou de outra dos documentos.  Os valores geralmente s√£o extra√≠dos dos <b>campos</b> do documento, mas tamb√©m podem ser gerados usando scripts.  Nesse caso, insira <b>Agrega√ß√£o: contagem</b> (o n√∫mero total de logs). <br><br>  Depois disso, dividimos a tabela em segmentos (campos) pelos quais a m√©trica ser√° considerada.  O ajuste de ca√ßambas executa esta fun√ß√£o, que por sua vez consiste em 2 op√ß√µes de ajuste: <br><br><ol><li>  dividir linhas - adicione colunas e subseq√ºentemente divida a tabela em linhas </li><li>  dividir tabela - divida em v√°rias tabelas de acordo com os valores de um campo espec√≠fico. </li></ol><br>  Nos <b>buckets,</b> voc√™ pode adicionar v√°rias divis√µes para criar v√°rias colunas ou tabelas. As limita√ß√µes aqui s√£o mais l√≥gicas.  Na agrega√ß√£o, voc√™ pode escolher por qual m√©todo de segmenta√ß√£o ocorrer√°: intervalo ipv4, per√≠odo, Termos, etc.  A escolha mais divertida √© precisamente os <b>Termos</b> e <b>Termos</b> <b>Significativos</b> , a divis√£o em segmentos √© realizada de acordo com os valores de um determinado campo de √≠ndice, a diferen√ßa entre eles √© o n√∫mero de valores retornados e sua exibi√ß√£o.  Como queremos dividir a tabela pelo nome dos blades, selecione o campo - <b>product.keyword</b> e defina o tamanho na quantidade de 25 valores retornados. <br><br>  Em vez de cadeias, o elasticsearch usa 2 tipos de dados - <b>texto</b> e <b>palavra</b> - <b>chave</b> .  Se voc√™ deseja executar uma pesquisa de texto completo, deve usar o tipo de texto, algo muito conveniente ao escrever seu servi√ßo de pesquisa, por exemplo, est√° procurando uma men√ß√£o de uma palavra em um valor de campo espec√≠fico (texto).  Se voc√™ deseja apenas uma correspond√™ncia exata, use o tipo de palavra-chave.  Al√©m disso, o tipo de dados da palavra-chave deve ser usado para campos que exigem classifica√ß√£o ou agrega√ß√£o, ou seja, no nosso caso. <br><br>  Como resultado, o Elasticsearch calcula o n√∫mero de logs por um determinado tempo com agrega√ß√£o por valor no campo do produto.  No R√≥tulo personalizado, definimos o nome da coluna que ser√° exibida na tabela, definimos o tempo durante o qual coletamos os logs, come√ßamos a desenhar - o Kibana envia uma solicita√ß√£o para elasticsearch, aguarda uma resposta e visualiza os dados recebidos.  A mesa est√° pronta! <br><br><h3>  Gr√°fico de pizza de eventos de preven√ß√£o de amea√ßas </h3><br>  De particular interesse s√£o as informa√ß√µes e quantas geralmente na porcentagem de <b>detectam</b> e <b>impedem</b> rea√ß√µes a incidentes de seguran√ßa da informa√ß√£o na pol√≠tica de seguran√ßa atual.  Nesse caso, um gr√°fico de pizza √© adequado.  Selecione Visualizar - <b>Gr√°fico de pizza</b> .  Tamb√©m na m√©trica, definimos a agrega√ß√£o pelo n√∫mero de logs.  Nos dep√≥sitos, defina Termos =&gt; a√ß√£o. <br><br>  Parece que tudo est√° correto, mas, como resultado, os valores para todas as l√¢minas s√£o mostrados, voc√™ precisa filtrar apenas as l√¢minas que funcionam sob a Preven√ß√£o de Amea√ßas.  Portanto, devemos configurar o <b>filtro</b> para procurar informa√ß√µes apenas nos blades respons√°veis ‚Äã‚Äãpor incidentes de seguran√ßa das informa√ß√µes - produto: ("Anti-Bot" OU "Novo antiv√≠rus" OU "DDoS Protector" OU "SmartDefense" OU "Emula√ß√£o de amea√ßas").  A imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/te/1p/wo/te1pwo7es8c1nnssm5tuhtdfxog.png"></a> <br><br>  E configura√ß√µes mais detalhadas, a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/20/yf/xs/20yfxs1tflzd3ja05bulm9s8pco.png"></a> <br><br><h3>  Tabela de Eventos IPS </h3><br>  Al√©m disso, √© muito importante, do ponto de vista da seguran√ßa da informa√ß√£o, visualizar e verificar eventos nos blades <b>IPS</b> e <b>Emula√ß√£o de Amea√ßas</b> , que <b>n√£o</b> s√£o <b>bloqueados pela</b> pol√≠tica atual, para posteriormente mudar a assinatura para impedir ou, se o tr√°fego for v√°lido, n√£o verifique a assinatura.  Criamos a tabela como no primeiro exemplo, apenas com a diferen√ßa de criar v√°rias colunas: protections.keyword, severity.keyword, product.keyword, originsicname.keyword.  Certifique-se de configurar o filtro para procurar informa√ß√µes apenas nos blades respons√°veis ‚Äã‚Äãpor incidentes de seguran√ßa das informa√ß√µes - produto: ("SmartDefense" OU "Emula√ß√£o de amea√ßas").  A imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/gu/pt/q_/guptq_dmmsig3ueo2xoahhgh_ts.png"></a> <br><br>  Configura√ß√µes mais detalhadas, a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/7h/va/ma/7hvamanbqtsl3vvkbk_r_wgpu4e.png"></a> <br><br><h3>  Gr√°ficos dos sites mais populares visitados </h3><br>  Para fazer isso, crie uma forma - <b>barra vertical</b> .  Tamb√©m usamos a contagem de m√©tricas (o eixo Y) e, no eixo X, usaremos o nome dos sites visitados como appi_name como valores.  H√° um pequeno truque aqui, se voc√™ executar as configura√ß√µes na vers√£o atual, todos os sites ser√£o marcados no gr√°fico em uma cor. Para torn√°-los coloridos, usamos uma configura√ß√£o adicional - "s√©rie dividida", que permite dividir a coluna final em mais alguns valores, dependendo do campo selecionado, √© claro!  Essa divis√£o pode ser usada como uma coluna multicolorida de acordo com os valores no modo empilhado ou no modo normal, a fim de criar v√°rias colunas de acordo com um determinado valor a partir do eixo X. Nesse caso, usamos o mesmo valor que o eixo X, este torna poss√≠vel tornar todas as colunas multicoloridas; no canto superior direito, elas s√£o indicadas por cores.  No filtro que definimos - product: "Filtragem de URL", para ver informa√ß√µes apenas nos sites visitados, a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/mm/7z/eu/mm7zeuhxbi7mycsbe9iwhfvj-pi.png"></a> <br><br>  Configura√ß√µes: <br><br> <a href=""><img src="https://habrastorage.org/webt/ab/fq/s8/abfqs80dexym6ks4kt_ktyzzzzk.png"></a> <br><br><h3>  Gr√°fico para usar os aplicativos mais perigosos </h3><br>  Para fazer isso, crie uma forma - barra vertical.  Tamb√©m usamos a contagem de m√©tricas (o eixo Y) e, no eixo X, usaremos o nome dos aplicativos usados, "appi_name", como valores.  O mais importante √© a tarefa de filtro - produto: "Controle de aplicativo" AND app_risk: (4 OU 5 OU 3) AND a√ß√£o: "aceitar".  Filtramos os logs pelo painel de controle de aplicativos, utilizamos apenas os sites categorizados como sites com risco de cr√≠tico, alto, m√©dio e somente se o acesso a esses sites for permitido.  A imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/2q/nz/82/2qnz82z39bhtf-eohfvqcfqae-0.png"></a> <br><br>  Configura√ß√µes, clic√°veis: <br><br> <a href=""><img src="https://habrastorage.org/webt/pb/aj/6s/pbaj6sk3l1qbc8cgluy4yiaj1qy.png"></a> <br><br><h3>  Dashboard </h3><br>  A visualiza√ß√£o e a cria√ß√£o de pain√©is est√£o em um item de menu separado - <b>Painel</b> .  Tudo √© simples aqui, um novo painel √© criado, a visualiza√ß√£o √© adicionada, tudo √© colocado no seu lugar! <br><br>  Criamos um painel, segundo o qual ser√° poss√≠vel entender a situa√ß√£o b√°sica do estado de seguran√ßa da informa√ß√£o na organiza√ß√£o, √© claro, apenas no n√≠vel do Check Point, a imagem √© clic√°vel: <br><br> <a href=""><img src="https://habrastorage.org/webt/ct/9p/lv/ct9plv4cwbpt6ammjhqmn6x76fe.png"></a> <br><br>  Com base nesses gr√°ficos, podemos entender quais assinaturas cr√≠ticas n√£o est√£o bloqueadas no firewall, para onde os usu√°rios v√£o, quais s√£o os aplicativos mais perigosos que eles usam. <br><br><h3>  Conclus√£o </h3><br>  Examinamos as possibilidades de visualiza√ß√£o b√°sica no Kibana e constru√≠mos um painel, mas essa √© apenas uma pequena parte.  Al√©m disso, consideraremos separadamente a configura√ß√£o dos mapas, trabalharemos com o sistema elasticsearch, nos familiarizaremos com solicita√ß√µes de API, automa√ß√£o e muito mais! <br><br>  Portanto, fique atento ( <a href="https://t.me/tssolution">Telegram</a> , <a href="https://www.facebook.com/groups/tssolution.info/">Facebook</a> , <a href="https://vk.com/ts_solution">VK</a> , <a href="https://tssolution.ru/blog">TS Solution Blog</a> ), <a href="https://zen.yandex.ru/id/5c7d2162fa818600ae386a52">Yandex.Zen</a> . </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/pt482054/">https://habr.com/ru/post/pt482054/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../pt482040/index.html">Apresenta programas de cria√ß√£o de perfil em C ++</a></li>
<li><a href="../pt482042/index.html">Trabalhando com a biblioteca Newtonsoft.Json com um exemplo real. Parte 2</a></li>
<li><a href="../pt482044/index.html">10 pr√°ticas recomendadas para proteger imagens do Docker. Parte 2</a></li>
<li><a href="../pt482050/index.html">T√©cnica de redu√ß√£o de rede de convolu√ß√£o Jedi - poda</a></li>
<li><a href="../pt482052/index.html">Conjunto de dados de ano novo 2019: dicion√°rio tonal aberto do idioma russo</a></li>
<li><a href="../pt482058/index.html">Predador ou presa? Quem proteger√° as autoridades de certifica√ß√£o</a></li>
<li><a href="../pt482060/index.html">Modelo de mandato de controle de acesso (MAC): vis√£o geral e aplicativos</a></li>
<li><a href="../pt482064/index.html">Facilidade de desenvolvimento de sites multil√≠ngues no CMS Umbraco 8</a></li>
<li><a href="../pt482066/index.html">Substituir a hist√≥ria do usu√°rio pela hist√≥ria do trabalho</a></li>
<li><a href="../pt482068/index.html">Preciso criar uma matriz RAID a partir do SSD e quais controladores s√£o necess√°rios para isso</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>