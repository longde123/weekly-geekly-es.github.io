<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üçì üöì üßïüèæ Ballade de transfert de donn√©es üí§ üíÉüèª üèáüèΩ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dans les premi√®res lignes de mon h√©morragie de texte, je veux dire ce qui suit: Cela a √©t√© beaucoup √©crit √† ce sujet, je vais √©galement √©crire ma visi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Ballade de transfert de donn√©es</h1><div class="post__body post__body_full">
      <div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/398791/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dans les premi√®res lignes de mon h√©morragie de texte, je veux dire ce qui suit: Cela a √©t√© beaucoup √©crit √† ce sujet, je vais √©galement √©crire ma vision. </font><font style="vertical-align: inherit;">Les interfaces standard pour la transmission d'informations sont excellentes, mais pour mes besoins, elles ne permettent pas un transfert de donn√©es satisfaisant (enfin, ou presque). </font><font style="vertical-align: inherit;">J'essaierai de faire quelques ajouts afin d'amener cela √† l'√©tat qui me convient.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Il y a 2 appareils ou plus √† une distance suffisamment grande (1-100 m√®tres) entre lesquels les donn√©es doivent √™tre transmises. Apr√®s avoir examin√© certaines interfaces (rs232 / 422/485, I2C, Ethernet), je suis arriv√© √† la conclusion que soit elles ne garantissent pas un transfert de donn√©es sans ambigu√Øt√©, je n'aimais pas non plus beaucoup de fils, elles ne donnent pas de r√©ponse que les informations sont accept√©es. J'ai d√©cid√© de prendre l'interface RS485 comme base - cela peut aller loin de ses avantages, 2 fils, vous pouvez connecter un tas d'appareils en m√™me temps, c'est simple, (UART) est sur presque n'importe quel contr√¥leur.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Dans mon cas, le sch√©ma classique 1 conduisant le reste des esclaves me convient. L'algorithme de messagerie est le suivant: les donn√©es sont transmises en cycles d'√©change, un cycle d'√©change consiste en un message qui est transmis du ma√Ætre √† l'esclave, en r√©ponse le ma√Ætre re√ßoit le message de l'esclave, tous les autres sont silencieux. Sur la m√™me base, impl√©mentez une demande de donn√©es depuis un appareil esclave. </font></font><br>
<br>
<img src="https://habrastorage.org/files/e4e/48e/048/e4e48e048a5e4cd08723865418a0e25a.png" alt="image"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Un cycle d'√©change.</font></font></em><br>
<a name="habracut"></a><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Pour r√©pondre √† mes besoins de transfert de donn√©es, je dois r√©soudre seulement deux questions. Premi√®re question: la v√©rification de l'octet transmis est bas√©e sur l'interface RS-485 elle-m√™me, mais elle ne garantit pas un octet transmis de mani√®re fiable - si un octet est trouv√© dans l'interface elle-m√™me, il est rejet√© des donn√©es re√ßues, mais il est toujours possible de transf√©rer le mauvais octet - s'il a chang√© (il a mal tourn√©) ) un nombre pair de bits dans un octet. c'est-√†-dire une v√©rification est requise pour le nombre d'octets transmis et la validit√© des octets dans les donn√©es transmises. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Question deux: r√©ception d'un message de r√©ponse √† celui transmis. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Sur la premi√®re question: ce sch√©ma est propos√©: l'octet initial, l'octet du nombre de </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 caract√®res transmis dans le message entier, autre chose, l'octet de somme de contr√¥le (BCS), l'octet final.</font></font><br>
 <br>
<img src="https://habrastorage.org/files/a00/e71/e60/a00e71e60f3a40d1affd859b411afe89.png" alt="image"><br>
<em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remarque: l'octet de somme de contr√¥le doit √™tre consid√©r√© comme modulo 2.</font></font></em><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 
Sur la base du sch√©ma propos√©, on peut juger que si la r√©ponse ne revient pas, le suiveur n'est pas disponible. Dans ce cas, des options sont possibles lorsqu'un message endommag√© atteint le suiveur et qu'il n'y r√©pond pas, ou que le message lui parvient et qu'il envoie la r√©ponse, mais la r√©ponse va mal et le leader l'ignore.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Pour corriger cela, il a √©t√© accept√©: si la r√©ponse ne vient pas (ou vient mais n'est pas fiable), r√©p√©ter (le nombre de fois sans folie) r√©p√©ter le cycle d'√©change en cours. L'erreur suivante peut se produire ici. Supposons que nous envoyions une commande indiquant √† l'appareil que vous devez augmenter le volume de +1 unit√©. Lorsque le message parvient √† l'esclave, il ex√©cute la commande pour augmenter le volume et envoie une r√©ponse `` ok, j'ai fait comme vous le vouliez '', mais il peut s'av√©rer que la r√©ponse va mal et le pr√©sentateur ne comprend pas que la commande a d√©j√† √©t√© ex√©cut√©e et envoie √† nouveau le message. Par cons√©quent, lors de la r√©ception d'une commande du c√¥t√© esclave, le volume sera d√©j√† ajout√© de +2 unit√©s. Pour √©viter ce ph√©nom√®ne, il est habituel d'introduire un identifiant (NS - num√©ro de message) de la diff√©rence de message. Si le num√©ro de message est r√©p√©t√©, il s'agit d'un message r√©p√©t√© et la commande sp√©cifi√©e n'a pas besoin d'√™tre ex√©cut√©e,mais envoyez simplement le message de r√©ponse pr√©c√©dent.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
J'entre √©galement ici 2 autres param√®tres - c'est le num√©ro (code) de l'appareil auquel les donn√©es sont transmises et le num√©ro (sous-code) indiquant quelle commande doit √™tre ex√©cut√©e (ou quelles donn√©es se trouvent dans le message). </font></font><br>
 <br>
<img src="https://habrastorage.org/files/2ca/3d8/226/2ca3d82263eb48e6a0b566ba824c917a.png" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
En cons√©quence, je vais tout rassembler et parcourir l'algorithme, en utilisant l'exemple de l'augmentation du seuil du relais par la temp√©rature de 5 degr√©s Celsius et en prenant la lecture de la temp√©rature actuelle de l'esclave pour 1 cycle d'√©change: je </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
g√©n√®re les donn√©es transmises du ma√Ætre: </font></font><br>
<br>
<img src="https://habrastorage.org/files/c7a/172/c23/c7a172c23c3d4a9886481ce1c052304a.PNG" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
lorsque le message est re√ßu, l'esclave regarde 2 octets, o√π est le nombre d'octets envoy√©s, si le nombre d'octets envoy√©s est √©gal au nombre de re√ßus, alors le message n'a pas perdu d'octets, alors nous regardons l'octet de d√©part (caract√®re) si it = '$', et aussi l'octet de fin (caract√®re) si it = ' # '- ceci est un message de voyageant √† l'esclave.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Imm√©diatement, je consid√©rerai les options de message possibles du ma√Ætre √† l'esclave avec des erreurs dans les octets initial et final, ainsi que l'option avec une erreur dans le nombre d'octets dans le message. </font><font style="vertical-align: inherit;">Je r√©serverai tout de suite 3 valeurs de param√®tres que je consid√©rerai correctes 2 et 3, c'est-√†-dire </font><font style="vertical-align: inherit;">si 2 param√®tres sur 3 possibles co√Øncident, je consid√®re le message comme valable.</font></font><br>
<br>
<blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. octet de d√©but = '$', nombre d'octets re√ßus = 7 (nombre d'octets envoy√©s = 7), l'octet de fin n'est pas √©gal √† '#'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 2. l'octet initial n'est pas √©gal √† '$', le nombre d'octets re√ßus = 7 (le nombre d'octets envoy√©s = 7), l'octet final = '#'; </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 3. octet de d√©but = '$', nombre d'octets re√ßus = 7 (nombre d'octets envoy√©s = 7, nombre d'octets diff√©rent de 7), octet final = '#'.</font></font></blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Ensuite, nous calculons la somme de contr√¥le des 3 octets restants (octets 3, 4, 5), si elle co√Øncide avec le BCS, nous continuons d'analyser les donn√©es, nous examinons ces donn√©es pour cet appareil et ce qui devrait √™tre fait dessus, dans notre cas, le code esclave est 55 et le sous-code 2 dit sur la n√©cessit√© d'ajouter 5 degr√©s suppl√©mentaires au seuil du relais et dans le message de r√©ponse pour envoyer les donn√©es de temp√©rature actuelles. Je v√©rifie le NS s'il n'est pas √©gal au num√©ro de message pr√©c√©dent, puis j'ex√©cute la commande et ajoute 5 degr√©s √† la valeur actuelle du seuil de relais. S'ils sont √©gaux (NS), alors je n'effectue pas les actions indiqu√©es, puis je proc√®de √† la formation d'un message de r√©ponse.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
application du sch√©ma ['$'] [nombre d'octets envoy√©s / re√ßus] [...] ['#'] - avec une forte probabilit√© garantit qu'une telle combinaison ne pourra pas √™tre trouv√©e dans les donn√©es transmises, et provoquera un faux message. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Je forme les donn√©es transmises de l'esclave sur la base du message re√ßu:</font></font><br>
<br>
<img src="https://habrastorage.org/files/f0e/f6a/e05/f0ef6ae05be5437daf087ce6681ea795.PNG" alt="image"><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Le principe de traitement est le suivant: regardez 2 octets o√π le nombre d'octets envoy√©s est, si le nombre d'octets envoy√©s est √©gal au nombre d'octets re√ßus et aussi l'octet de d√©but = '@' et l'octet de fin = '&amp;' - c'est un message de l'esclave au ma√Ætre. Si n√©cessaire, j'utilise le m√©canisme 2 sur 3, similaire √† celui d√©crit ci-dessus uniquement pour le message de r√©ponse (pour les caract√®res '@' et '&amp;'). Lors de la r√©ception de ce message, l'h√¥te analyse la somme de contr√¥le 9 (du 3√®me au 11√®me) octets, si la somme de contr√¥le correspond, les donn√©es dans le message sont consid√©r√©es comme fiables et une analyse de donn√©es plus approfondie se poursuit. Si le code, le sous-code et le NS des messages envoy√©s et re√ßus co√Øncident, nous continuons d'analyser la r√©ponse au message envoy√© par l'h√¥te. Vient ensuite l'analyse des donn√©es re√ßues,dans mon cas, dans le 6e octet, une valeur de 1 signifie que la commande pour augmenter de 5 degr√©s jusqu'au seuil de relais a r√©ussi, les 5 octets restants indiquent les lectures de temp√©rature actuelles; le 7e octet est un indicateur indiquant la fiabilit√© de la temp√©rature transmise (c.-√†-d. J'envisage l'option sur laquelle l'esclave est activ√© et r√©pond, mais le capteur peut ne pas fonctionner) et 4 octets de valeurs de temp√©rature flottante de type.</font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
L'utilisation de 2 caract√®res de test au d√©but et √† la fin d'un message √† forte probabilit√© garantit qu'en cas d'erreur de ne pas confondre les messages de l'esclave et du ma√Ætre. Les donn√©es al√©atoires (non al√©atoires) dans le canal ne g√¢cheront pas l'√©change. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Un peu sur la transmission des donn√©es de l'esclave √† l'esclave, et un message centralis√© √† tous les esclaves du ma√Ætre.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tout d'abord, le dernier - la transmission du ma√Ætre par l'esclave est effectu√©e en attribuant le code d'appareil 255, qui indique √† l'esclave qu'il s'agit d'un message centralis√©, puis il ne reste plus qu'√† r√©soudre le probl√®me des sous-codes communs, il peut √©galement √™tre group√© par codes d'appareil attribuer le code d'appareil 254 et 3 ou 4 appareils recevront un message utilisant ce code; le reste l'ignorera, naturellement, la partie de l'envoi des r√©ponses des esclaves ne devrait pas fonctionner ici, c'est-√†-dire il n'est pas garanti que les abonn√©s aient accept√© ces messages sans ambigu√Øt√©!</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Lors de la transmission de donn√©es de l'esclave √† l'esclave, mise en ≈ìuvre par le ma√Ætre, envoie un message √† l'esclave (esclave1) √† partir duquel les informations doivent √™tre envoy√©es √† l'autre esclave (esclave2), esclave1 envoie une r√©ponse au ma√Ætre tandis que l'esclave2 √©coute cette r√©ponse en prenant les donn√©es pour lui-m√™me. Encore une fois, il n'y a aucune garantie d'une livraison de message non ambigu√´ de slave1 √† slave2, cela doit √™tre pris en compte! </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Capacit√©s d'interface nombre d'appareils th√©oriquement connect√©s environ 250, commandes / types de donn√©es jusqu'√† 248 pour chaque appareil, la longueur des informations utiles dans le message pouvant aller jusqu'√† 250 octets. </font></font><br>
<br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
Parlez des pi√®ges:</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Tous les transferts de donn√©es sont con√ßus pour fonctionner √† temps, c'est-√†-dire certains retards entre les messages doivent √™tre observ√©s. Je recommande √©galement que vous fassiez un d√©lai fixe entre le message envoy√© par le ma√Ætre et la r√©ponse de l'esclave afin que l'esclave puisse g√©n√©rer des donn√©es et les transmettre compl√®tement au canal. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Le moment d'organiser les r√©ponses de l'esclave est √©galement important, il peut arriver que l'esclave soit occup√© et ait plusieurs messages de donn√©es sur son canal √† la fois, vous devez √©viter les r√©ponses aux messages obsol√®tes (car le leader ne les attend plus) en les ignorant, en ex√©cutant les commandes uniquement des derniers messages et y r√©pondre.</font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 S√©par√©ment, je voudrais souligner la question de la synchronisation des appareils en fonction du temps - il convient de garder √† l'esprit que la synchronisation temporelle de l'esclave lors de la r√©ception d'un message n√©cessite de prendre en compte le d√©lai de transmission des donn√©es vers le canal (√† une vitesse de 9600, un message de 10 octets sera transmis pendant environ 11 ms) et le moment o√π l'interruption se d√©clenchera apr√®s recevoir des donn√©es du c√¥t√© esclave, s'il n'y a pas d'interruption, il convient de consid√©rer le temps de v√©rifier l'arriv√©e des donn√©es dans la m√©moire tampon de l'appareil, etc. </font></font><br>
 <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
 Il convient √©galement de noter que le renvoi d'une boucle de message ajoute √©galement des nuances, je recommande d'utiliser l'envoi de messages sans r√©p√©titions pour la synchronisation de l'heure et la composition de messages avec un nouveau NS. </font></font><br>
<br>
<strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">J'ai des doutes que j'ai d√©couvert quelque chose de nouveau ici, tout cela est dans une certaine mesure utilis√© quelque part dans diff√©rentes interfaces! </font><font style="vertical-align: inherit;">Avec la main l√©g√®re de l'auteur de ce gribouillis et l'application de ce protocole dans mes d√©veloppements, je souhaite donner le nom √† ce protocole de transfert de donn√©es ¬´SRDB2¬ª.</font></font></div>
      
    </div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr398791/">https://habr.com/ru/post/fr398791/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr398781/index.html">D√©bogage sans fil STM32</a></li>
<li><a href="../fr398783/index.html">Package de services de s√©curit√© r√©seau et utilitaire oidcalc</a></li>
<li><a href="../fr398785/index.html">Au fond du golfe du Mexique a trouv√© un lac toxique</a></li>
<li><a href="../fr398787/index.html">Dans une banlieue de Moscou, utiliser une imprimante 3D en 20 heures pour construire une maison</a></li>
<li><a href="../fr398789/index.html">Le r√©seau neuronal pr√©dit la premi√®re impression d'une personne par son visage</a></li>
<li><a href="../fr398793/index.html">Un stylo pour un ordinateur ou un ordinateur pour un stylo?</a></li>
<li><a href="../fr398795/index.html">Solutions p√©dagogiques LEGO Education. Que peuvent faire grandir vos enfants</a></li>
<li><a href="../fr398797/index.html">EA Games –∏ Origin –∑–∞–±–∞–Ω–∏–ª–∏ —Ü–µ–ª—É—é —Å—Ç—Ä–∞–Ω—É –∏–∑-–∑–∞ —Å–∞–Ω–∫—Ü–∏–π –°–®–ê</a></li>
<li><a href="../fr398801/index.html">Le monde des traces √©ternelles</a></li>
<li><a href="../fr398803/index.html">11.11: cr√®che pour les ventes flash</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>