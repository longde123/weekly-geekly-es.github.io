<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üåª üßëüèø‚Äçü§ù‚ÄçüßëüèΩ üë©üèæ‚Äçüç≥ Kompilierbare Konfiguration eines verteilten Systems üë©üèº‚Äç‚úàÔ∏è üìª üôÖüèæ</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In diesem Beitrag m√∂chten wir Ihnen einen interessanten Umgang mit der Konfiguration eines verteilten Systems vorstellen. 
 Die Konfiguration wird typ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Kompilierbare Konfiguration eines verteilten Systems</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/primetalk/blog/447690/"><p>  In diesem Beitrag m√∂chten wir Ihnen einen interessanten Umgang mit der Konfiguration eines verteilten Systems vorstellen. <br>  Die Konfiguration wird typsicher direkt in der Scala-Sprache dargestellt.  Eine Beispielimplementierung wird ausf√ºhrlich beschrieben.  Verschiedene Aspekte des Vorschlags werden er√∂rtert, einschlie√ülich des Einflusses auf den gesamten Entwicklungsprozess. </p><br><p><img src="https://habrastorage.org/webt/71/bl/ax/71blaxtldz-ia4yftyebaxbam7c.png" alt="Gesamtkonfigurationsmanagementprozess"></p><br><p>  ( <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">auf Russisch</a> ) </p><a name="habracut"></a><br><h3 id="introduction">  Einf√ºhrung </h3><br><p>  Der Aufbau robuster verteilter Systeme erfordert die Verwendung einer korrekten und koh√§renten Konfiguration auf allen Knoten.  Eine typische L√∂sung besteht darin, eine textuelle Bereitstellungsbeschreibung (Terraform, Ansible oder √§hnliches) und automatisch generierte Konfigurationsdateien (h√§ufig - f√ºr jeden Knoten / jede Rolle reserviert) zu verwenden.  Wir m√∂chten auch auf jedem Kommunikationsknoten dieselben Protokolle derselben Version verwenden (andernfalls treten Inkompatibilit√§tsprobleme auf).  In der JVM-Welt bedeutet dies, dass mindestens die Messaging-Bibliothek auf allen kommunizierenden Knoten dieselbe Version haben sollte. </p><br><p>  Was ist mit dem Testen des Systems?  Nat√ºrlich sollten wir Unit-Tests f√ºr alle Komponenten durchf√ºhren, bevor wir zu Integrationstests kommen.  Um Testergebnisse zur Laufzeit extrapolieren zu k√∂nnen, sollten wir sicherstellen, dass die Versionen aller Bibliotheken sowohl in der Laufzeit- als auch in der Testumgebung identisch sind. </p><br><p>  Beim Ausf√ºhren von Integrationstests ist es oft viel einfacher, auf allen Knoten denselben Klassenpfad zu haben.  Wir m√ºssen nur sicherstellen, dass bei der Bereitstellung derselbe Klassenpfad verwendet wird.  (Es ist m√∂glich, verschiedene Klassenpfade auf verschiedenen Knoten zu verwenden, aber es ist schwieriger, diese Konfiguration darzustellen und korrekt bereitzustellen.) Um die Dinge einfach zu halten, werden nur identische Klassenpfade auf allen Knoten ber√ºcksichtigt. </p><br><p>  Die Konfiguration entwickelt sich tendenziell zusammen mit der Software.  Wir verwenden normalerweise Versionen, um verschiedene zu identifizieren <br>  Stufen der Softwareentwicklung.  Es erscheint sinnvoll, die Konfiguration unter Versionsverwaltung abzudecken und verschiedene Konfigurationen mit einigen Bezeichnungen zu identifizieren.  Wenn es in der Produktion nur eine Konfiguration gibt, k√∂nnen wir eine einzelne Version als Kennung verwenden.  Manchmal haben wir mehrere Produktionsumgebungen.  Und f√ºr jede Umgebung ben√∂tigen wir m√∂glicherweise einen separaten Konfigurationszweig.  Konfigurationen k√∂nnen daher mit Zweig und Version gekennzeichnet sein, um verschiedene Konfigurationen eindeutig zu identifizieren.  Jede Verzweigungsbezeichnung und -version entspricht einer einzelnen Kombination von verteilten Knoten, Ports, externen Ressourcen und Klassenpfadbibliotheksversionen auf jedem Knoten.  Hier werden wir nur den einzelnen Zweig behandeln und Konfigurationen anhand einer dreikomponentigen Dezimalversion (1.2.3) identifizieren, genau wie andere Artefakte. </p><br><p>  In modernen Umgebungen werden Konfigurationsdateien nicht mehr manuell ge√§ndert.  Normalerweise generieren wir <br>  Konfigurationsdateien zur Bereitstellungszeit und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">ber√ºhren Sie sie</a> danach <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">nie mehr</a> .  Man k√∂nnte sich also fragen, warum wir immer noch das Textformat f√ºr Konfigurationsdateien verwenden.  Eine praktikable Option besteht darin, die Konfiguration in einer Kompilierungseinheit zu platzieren und von der Validierungskonfiguration zur Kompilierungszeit zu profitieren. </p><br><p>  In diesem Beitrag werden wir die Idee untersuchen, die Konfiguration im kompilierten Artefakt beizubehalten. </p><br><h3 id="compilable-configuration">  Kompilierbare Konfiguration </h3><br><p>  In diesem Abschnitt werden wir ein Beispiel f√ºr eine statische Konfiguration diskutieren.  Zwei einfache Dienste - der Echodienst und der Client des Echodienstes - werden konfiguriert und implementiert.  Dann werden zwei verschiedene verteilte Systeme mit beiden Diensten instanziiert.  Eine ist f√ºr eine Konfiguration mit einem Knoten und eine andere f√ºr die Konfiguration mit zwei Knoten. </p><br><p>  Ein typisches verteiltes System besteht aus wenigen Knoten.  Die Knoten k√∂nnten unter Verwendung eines Typs identifiziert werden: </p><br><pre><code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Backend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">case</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Frontend</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span></span></code> </pre> <br><p>  oder einfach </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">hostName: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  oder sogar </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span></code> </pre> <br><p>  Diese Knoten erf√ºllen verschiedene Rollen, f√ºhren einige Dienste aus und sollten √ºber TCP / HTTP-Verbindungen mit den anderen Knoten kommunizieren k√∂nnen. </p><br><p>  F√ºr die TCP-Verbindung ist mindestens eine Portnummer erforderlich.  Wir m√∂chten auch sicherstellen, dass Client und Server dasselbe Protokoll sprechen.  Um eine Verbindung zwischen Knoten zu modellieren, deklarieren wir die folgende Klasse: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TcpEndPoint</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">node: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">NodeId</span></span></span></span><span class="hljs-class"><span class="hljs-params">, port: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Port</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Protocol</span></span></span></span><span class="hljs-class"><span class="hljs-params">]</span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><p>  Dabei ist <code>Port</code> nur ein <code>Int</code> innerhalb des zul√§ssigen Bereichs: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortNumber</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">Int</span></span>, <span class="hljs-type"><span class="hljs-type">Closed</span></span>[_0, <span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-number"><span class="hljs-number">65535</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]]</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Verfeinerte Typen</b> <div class="spoiler_text"><p>  Siehe <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">verfeinerte</a> Bibliothek.  Kurz gesagt, es erm√∂glicht das Hinzuf√ºgen von Einschr√§nkungen f√ºr die Kompilierungszeit zu anderen Typen.  In diesem Fall darf <code>Int</code> nur 16-Bit-Werte haben, die die Portnummer darstellen k√∂nnen.  Es ist nicht erforderlich, diese Bibliothek f√ºr diesen Konfigurationsansatz zu verwenden.  Es scheint einfach sehr gut zu passen. </p></div></div><br><p>  F√ºr HTTP (REST) ‚Äã‚Äãben√∂tigen wir m√∂glicherweise auch einen Pfad des Dienstes: </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlPathPrefix</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Refined</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>, <span class="hljs-type"><span class="hljs-type">MatchesRegex</span></span>[<span class="hljs-type"><span class="hljs-type">W</span></span>.`<span class="hljs-string"><span class="hljs-string">"[a-zA-Z_0-9/]*"</span></span>`.<span class="hljs-type"><span class="hljs-type">T</span></span>]] <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PortWithPrefix</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Protocol</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">portNumber: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">PortNumber</span></span></span></span><span class="hljs-class"><span class="hljs-params">, pathPrefix: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">UrlPathPrefix</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Phantomtyp</b> <div class="spoiler_text"><p>  Um das Protokoll w√§hrend der Kompilierung zu identifizieren, verwenden wir die Scala-Funktion zum Deklarieren des Typargumentprotokolls, das in der Klasse nicht verwendet wird.  Es ist ein sogenannter <em>Phantomtyp</em> .  Zur Laufzeit ben√∂tigen wir selten eine Instanz der Protokollkennung, deshalb speichern wir sie nicht.  W√§hrend der Kompilierung bietet dieser Phantomtyp zus√§tzliche Typensicherheit.  Wir k√∂nnen keinen Port mit falschem Protokoll √ºbergeben. </p></div></div><br><p>  Eines der am h√§ufigsten verwendeten Protokolle ist die REST-API mit Json-Serialisierung: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JsonHttpRestProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  Dabei ist <code>RequestMessage</code> der Basistyp von Nachrichten, die der Client an den Server senden kann, und <code>ResponseMessage</code> ist die Antwortnachricht vom Server.  Nat√ºrlich k√∂nnen wir auch andere Protokollbeschreibungen erstellen, die das Kommunikationsprotokoll mit der gew√ºnschten Genauigkeit angeben. </p><br><p>  F√ºr die Zwecke dieses Beitrags verwenden wir eine einfachere Version des Protokolls: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimpleHttpGetRest</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">RequestMessage</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ResponseMessage</span></span></span><span class="hljs-class">]</span></span></code> </pre> <br><p>  In diesem Protokoll wird die Anforderungsnachricht an die URL angeh√§ngt und die Antwortnachricht als einfache Zeichenfolge zur√ºckgegeben. </p><br><p>  Eine Dienstkonfiguration kann durch den Dienstnamen, eine Sammlung von Ports und einige Abh√§ngigkeiten beschrieben werden.  Es gibt einige M√∂glichkeiten, wie all diese Elemente in Scala dargestellt werden k√∂nnen (z. B. <code>HList</code> , algebraische Datentypen).  F√ºr die Zwecke dieses Beitrags verwenden wir das Kuchenmuster und stellen kombinierbare Teile (Module) als Merkmale dar.  (Kuchenmuster ist keine Voraussetzung f√ºr diesen kompilierbaren Konfigurationsansatz. Es ist nur eine m√∂gliche Umsetzung der Idee.) </p><br><p>  Abh√§ngigkeiten k√∂nnen mithilfe des Kuchenmusters als Endpunkte anderer Knoten dargestellt werden: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoProtocol</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">SimpleHttpGetRest</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8081</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoPort</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = <span class="hljs-type"><span class="hljs-type">PortWithPrefix</span></span>[<span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]](portNumber, <span class="hljs-string"><span class="hljs-string">"echo"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoService</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] = providedSimpleService(echoPort) }</code> </pre> <br><p>  F√ºr den Echo-Dienst muss nur ein Port konfiguriert werden.  Und wir erkl√§ren, dass dieser Port das Echo-Protokoll unterst√ºtzt.  Beachten Sie, dass wir derzeit keinen bestimmten Port angeben m√ºssen, da das Merkmal abstrakte Methodendeklarationen zul√§sst.  Wenn wir abstrakte Methoden verwenden, ben√∂tigt der Compiler eine Implementierung in einer Konfigurationsinstanz.  Hier haben wir die Implementierung ( <code>8081</code> ) bereitgestellt und sie wird als Standardwert verwendet, wenn wir sie in einer konkreten Konfiguration √ºberspringen. </p><br><p>  Wir k√∂nnen eine Abh√§ngigkeit in der Konfiguration des Echo-Service-Clients deklarieren: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testMessage</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span> = <span class="hljs-string"><span class="hljs-string">"test"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pollInterval</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">FiniteDuration</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echoServiceDependency</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">HttpSimpleGetEndPoint</span></span>[_, <span class="hljs-type"><span class="hljs-type">EchoProtocol</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]] }</code> </pre> <br><p>  Die Abh√§ngigkeit hat den gleichen Typ wie der <code>echoService</code> .  Insbesondere erfordert es das gleiche Protokoll.  Daher k√∂nnen wir sicher sein, dass diese beiden Abh√§ngigkeiten ordnungsgem√§√ü funktionieren, wenn wir sie verbinden. </p><br><div class="spoiler">  <b class="spoiler_title">Implementierung von Diensten</b> <div class="spoiler_text"><p>  Ein Dienst ben√∂tigt eine Funktion zum Starten und ordnungsgem√§√üen Herunterfahren.  (Die F√§higkeit, einen Dienst herunterzufahren, ist f√ºr das Testen von entscheidender Bedeutung.) Auch hier gibt es einige M√∂glichkeiten, eine solche Funktion f√ºr eine bestimmte Konfiguration anzugeben (wir k√∂nnten beispielsweise Typklassen verwenden).  F√ºr diesen Beitrag verwenden wir wieder Cake Pattern.  Wir k√∂nnen einen Dienst mit <code>cats.Resource</code> Ressource, die bereits Klammern und Ressourcenfreigabe bereitstellt.  Um eine Ressource zu erhalten, sollten wir eine Konfiguration und einen Laufzeitkontext bereitstellen.  Die Dienststartfunktion k√∂nnte also folgenderma√üen aussehen: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResourceReader</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_], </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">] </span></span>= <span class="hljs-type"><span class="hljs-type">Reader</span></span>[<span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Resource</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>]] <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">resource</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params"> implicit resolver: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">AddressResolver</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], timer: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Timer</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], contextShift: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ContextShift</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">], ec: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ExecutionContext</span></span></span></span><span class="hljs-class"><span class="hljs-params">, applicative: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Applicative</span></span></span></span><span class="hljs-class"><span class="hljs-params">[</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">F</span></span></span></span><span class="hljs-class"><span class="hljs-params">] </span></span></span><span class="hljs-class">)</span></span>: <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] }</code> </pre> <br><p>  wo </p><br><ul><li>  <code>Config</code> - Konfigurationstyp, der von diesem Servicestarter ben√∂tigt wird </li><li>  <code>AddressResolver</code> - ein Laufzeitobjekt, mit dem reale Adressen anderer Knoten <code>AddressResolver</code> werden k√∂nnen (lesen Sie weiter, um Einzelheiten zu <code>AddressResolver</code> ). </li></ul><br><p>  Die anderen Arten stammen von <code>cats</code> : </p><br><ul><li>  <code>F[_]</code> - <code>cats.IO</code> (Im einfachsten Fall k√∂nnte <code>F[A]</code> nur <code>() =&gt; A</code> In diesem Beitrag verwenden wir <code>cats.IO</code> ) </li><li>  <code>Reader[A,B]</code> - ist mehr oder weniger ein Synonym f√ºr eine Funktion <code>A =&gt; B</code> </li><li>  <code>cats.Resource</code> - hat M√∂glichkeiten zu erwerben und freizugeben </li><li>  <code>Timer</code> - Erm√∂glicht das Schlafen / Messen der Zeit </li><li>  <code>ContextShift</code> - analog zu <code>ExecutionContext</code> </li><li>  <code>Applicative</code> - Wrapper der tats√§chlichen Funktionen (fast eine Monade) (wir k√∂nnten ihn eventuell durch etwas anderes ersetzen) </li></ul><br><p>  √úber diese Schnittstelle k√∂nnen wir einige Dienste implementieren.  Zum Beispiel ein Dienst, der nichts tut: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">] </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">&lt;</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Any</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resource</span></span></span></span>(...): <span class="hljs-type"><span class="hljs-type">ResourceReader</span></span>[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Config</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>] = <span class="hljs-type"><span class="hljs-type">Reader</span></span>(_ =&gt; <span class="hljs-type"><span class="hljs-type">Resource</span></span>.pure[<span class="hljs-type"><span class="hljs-type">F</span></span>, <span class="hljs-type"><span class="hljs-type">Unit</span></span>](())) }</code> </pre> </div></div><br><p>  (Weitere <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Quellimplementierungen finden Sie unter Quellcode</a> - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Echo-Dienst</a> , <br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Echo-Client</a> und <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Lifetime-Controller</a> .) </p><br><p>  Ein Knoten ist ein einzelnes Objekt, auf dem einige Dienste ausgef√ºhrt werden (das Starten einer Ressourcenkette wird durch das Kuchenmuster erm√∂glicht): </p><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  Beachten Sie, dass wir im Knoten den genauen Konfigurationstyp angeben, der von diesem Knoten ben√∂tigt wird.  Der Compiler l√§sst nicht zu, dass wir das Objekt (Cake) mit unzureichendem Typ erstellen, da jedes Service-Merkmal eine Einschr√§nkung f√ºr den <code>Config</code> Typ deklariert.  Au√üerdem k√∂nnen wir den Knoten nicht starten, ohne eine vollst√§ndige Konfiguration bereitzustellen. </p><br><div class="spoiler">  <b class="spoiler_title">Aufl√∂sung der Knotenadresse</b> <div class="spoiler_text"><p>  Um eine Verbindung herzustellen, ben√∂tigen wir f√ºr jeden Knoten eine echte Hostadresse.  Es ist m√∂glicherweise sp√§ter als andere Teile der Konfiguration bekannt.  Daher ben√∂tigen wir eine M√∂glichkeit, eine Zuordnung zwischen der Knoten-ID und ihrer tats√§chlichen Adresse bereitzustellen.  Diese Zuordnung ist eine Funktion: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeAddress</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">NodeId</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">host: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Uri</span></span></span></span><span class="hljs-class"><span class="hljs-params">.</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Host</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressResolver</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">F</span></span></span><span class="hljs-class">[_]] </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>](nodeId: <span class="hljs-type"><span class="hljs-type">NodeId</span></span>): <span class="hljs-type"><span class="hljs-type">F</span></span>[<span class="hljs-type"><span class="hljs-type">NodeAddress</span></span>[<span class="hljs-type"><span class="hljs-type">NodeId</span></span>]] }</code> </pre> <br><p>  Es gibt einige M√∂glichkeiten, eine solche Funktion zu implementieren. </p><br><ol><li>  Wenn wir die tats√§chlichen Adressen vor der Bereitstellung kennen, k√∂nnen wir w√§hrend der Instanziierung der Knotenhosts Scala-Code mit den tats√§chlichen Adressen generieren und anschlie√üend den Build ausf√ºhren (der die Kompilierungszeit √ºberpr√ºft und dann die Integrationstestsuite ausf√ºhrt).  In diesem Fall ist unsere Zuordnungsfunktion statisch bekannt und kann zu einer Art <code>Map[NodeId, NodeAddress]</code> vereinfacht werden. </li><li>  Manchmal erhalten wir tats√§chliche Adressen erst zu einem sp√§teren Zeitpunkt, wenn der Knoten tats√§chlich gestartet wird, oder wir haben keine Adressen von Knoten, die noch nicht gestartet wurden.  In diesem Fall verf√ºgen wir m√∂glicherweise √ºber einen Erkennungsdienst, der vor allen anderen Knoten gestartet wird, und jeder Knoten gibt m√∂glicherweise seine Adresse in diesem Dienst bekannt und abonniert Abh√§ngigkeiten. </li><li>  Wenn wir <code>/etc/hosts</code> √§ndern k√∂nnen, k√∂nnen wir vordefinierte Hostnamen (wie <code>my-project-main-node</code> und <code>echo-backend</code> ) verwenden und diesen Namen zur Bereitstellungszeit einfach mit der IP-Adresse verkn√ºpfen. </li></ol><br><p>  In diesem Beitrag werden diese F√§lle nicht n√§her erl√§utert.  In unserem Spielzeugbeispiel haben alle Knoten dieselbe IP-Adresse - <code>127.0.0.1</code> . </p></div></div><br><p>  In diesem Beitrag werden zwei verteilte Systemlayouts betrachtet: </p><br><ol><li>  Einzelknotenlayout, bei dem alle Dienste auf dem Einzelknoten platziert werden. </li><li>  Zwei-Knoten-Layout, bei dem sich Service und Client auf verschiedenen Knoten befinden. </li></ol><br><p>  Die Konfiguration f√ºr ein <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">einzelnes</a> Knotenlayout lautet wie folgt: </p><br><div class="spoiler">  <b class="spoiler_title">Einzelknotenkonfiguration</b> <div class="spoiler_text"><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SingleNodeConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Singleton</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">identifier</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">the</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">single</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">node</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">//</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">configuration</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">of</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">server</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">Singleton</span></span> <span class="hljs-comment"><span class="hljs-comment">/** Type safe service port specification. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8088</span></span> <span class="hljs-comment"><span class="hljs-comment">// configuration of client /** We'll use the service provided by the same host. */ def echoServiceDependency = echoService override def testMessage: UrlPathElement = "hello" def pollInterval: FiniteDuration = 1.second // lifecycle controller configuration def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 requests, not 9. }</span></span></code> </pre> </div></div><br><p>  Hier erstellen wir eine einzelne Konfiguration, die sowohl die Server- als auch die Client-Konfiguration erweitert.  Au√üerdem konfigurieren wir einen Lifecycle-Controller, der normalerweise Client und Server nach <code>lifetime</code> beendet. </p><br><p>  Mit denselben Service-Implementierungen und -Konfigurationen kann das Layout eines Systems mit zwei separaten Knoten erstellt werden.  Wir m√ºssen nur <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">zwei separate Knotenkonfigurationen</a> mit den entsprechenden Diensten erstellen: </p><br><div class="spoiler">  <b class="spoiler_title">Konfiguration mit zwei Knoten</b> <div class="spoiler_text"><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeServerConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigTermLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeId</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeIdImpl</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nodeId</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-type"><span class="hljs-type">NodeServer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">portNumber</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">PortNumber</span></span> = <span class="hljs-number"><span class="hljs-number">8080</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NodeClientConfig</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientConfig</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// NB! dependency specification def echoServiceDependency = NodeServerConfig.echoService def pollInterval: FiniteDuration = 1.second def lifetime: FiniteDuration = 10500.milliseconds // additional 0.5 seconds so that there are 10 request, not 9. def testMessage: String = "dolly" }</span></span></code> </pre> </div></div><br><p>  Sehen Sie, wie wir die Abh√§ngigkeit angeben.  Wir erw√§hnen den bereitgestellten Dienst des anderen Knotens als Abh√§ngigkeit vom aktuellen Knoten.  Die Art der Abh√§ngigkeit wird √ºberpr√ºft, da sie einen Phantomtyp enth√§lt, der das Protokoll beschreibt.  Und zur Laufzeit haben wir die richtige Knoten-ID.  Dies ist einer der wichtigen Aspekte des vorgeschlagenen Konfigurationsansatzes.  Es gibt uns die M√∂glichkeit, den Port nur einmal festzulegen und sicherzustellen, dass wir auf den richtigen Port verweisen. </p><br><div class="spoiler">  <b class="spoiler_title">Implementierung mit zwei Knoten</b> <div class="spoiler_text"><p>  F√ºr diese Konfiguration verwenden wir genau die gleichen Service-Implementierungen.  √úberhaupt keine √Ñnderungen.  Wir erstellen jedoch zwei verschiedene Knotenimplementierungen, die unterschiedliche Dienste enthalten: </p><br><pre> <code class="scala hljs"> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeServerImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServiceService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SigIntLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">SigTermLifecycleConfig</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TwoJvmNodeClientImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ZeroServiceImpl</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">IO</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoClientService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FiniteDurationLifecycleServiceImpl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">EchoClientConfig</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">FiniteDurationLifecycleConfig</span></span> }</code> </pre> <br><p>  Der erste Knoten implementiert den Server und ben√∂tigt nur die serverseitige Konfiguration.  Der zweite Knoten implementiert den Client und ben√∂tigt einen anderen Teil der Konfiguration.  Beide Knoten erfordern eine Lebensdauerangabe.  F√ºr die Zwecke dieses Post-Service-Knotens hat er eine unendliche Lebensdauer, die mit <code>SIGTERM</code> beendet werden kann, w√§hrend der Echo-Client nach der konfigurierten endlichen Dauer beendet wird.  Einzelheiten finden Sie in der <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">Starteranwendung</a> . </p></div></div><br><h4 id="overall-development-process">  Gesamtentwicklungsprozess </h4><br><p>  Mal sehen, wie dieser Ansatz die Art und Weise ver√§ndert, wie wir mit der Konfiguration arbeiten. </p><br><p>  Die Konfiguration als Code wird kompiliert und erzeugt ein Artefakt.  Es erscheint sinnvoll, Konfigurationsartefakte von anderen Code-Artefakten zu trennen.  Oft k√∂nnen wir eine Vielzahl von Konfigurationen auf derselben Codebasis haben.  Und nat√ºrlich k√∂nnen wir mehrere Versionen verschiedener Konfigurationszweige haben.  In einer Konfiguration k√∂nnen wir bestimmte Versionen von Bibliotheken ausw√§hlen. Diese bleiben bei jeder Bereitstellung dieser Konfiguration konstant. </p><br><p>  Eine Konfigurations√§nderung wird zu einer Code√§nderung.  Es sollte also denselben Qualit√§tssicherungsprozess durchlaufen: </p><br><p>  Ticket -&gt; PR -&gt; √úberpr√ºfung -&gt; Zusammenf√ºhren -&gt; kontinuierliche Integration -&gt; kontinuierliche Bereitstellung </p><br><p>  Der Ansatz hat folgende Konsequenzen: </p><br><ol><li><p>  Die Konfiguration ist f√ºr die Instanz eines bestimmten Systems koh√§rent.  Es scheint, dass es keine M√∂glichkeit gibt, eine falsche Verbindung zwischen Knoten herzustellen. </p><br></li><li><p>  Es ist nicht einfach, die Konfiguration nur in einem Knoten zu √§ndern.  Es erscheint unvern√ºnftig, sich anzumelden und einige Textdateien zu √§ndern.  Dadurch wird eine Konfigurationsdrift weniger m√∂glich. </p><br></li><li><p>  Kleine Konfigurations√§nderungen sind nicht einfach vorzunehmen. </p><br></li><li><p>  Die meisten Konfigurations√§nderungen folgen demselben Entwicklungsprozess und werden √ºberpr√ºft. </p><br></li></ol><br><p>  Ben√∂tigen wir ein separates Repository f√ºr die Produktionskonfiguration?  Die Produktionskonfiguration enth√§lt m√∂glicherweise vertrauliche Informationen, die wir f√ºr viele Menschen unerreichbar halten m√∂chten.  Es kann sich daher lohnen, ein separates Repository mit eingeschr√§nktem Zugriff zu f√ºhren, das die Produktionskonfiguration enth√§lt.  Wir k√∂nnen die Konfiguration in zwei Teile aufteilen - einen, der die offensten Produktionsparameter enth√§lt, und einen, der den geheimen Teil der Konfiguration enth√§lt.  Dies w√ºrde den Zugriff der meisten Entwickler auf die meisten Parameter erm√∂glichen und gleichzeitig den Zugriff auf wirklich sensible Dinge einschr√§nken.  Dies l√§sst sich leicht mit Zwischenmerkmalen mit Standardparameterwerten erreichen. </p><br><h3 id="variations">  Variationen </h3><br><p>  Lassen Sie uns die Vor- und Nachteile des vorgeschlagenen Ansatzes im Vergleich zu den anderen Konfigurationsmanagementtechniken sehen. </p><br><p>  Zun√§chst werden einige Alternativen zu den verschiedenen Aspekten der vorgeschlagenen Art des Umgangs mit der Konfiguration aufgef√ºhrt: </p><br><ol><li>  Textdatei auf dem Zielcomputer. </li><li>  Zentraler Schl√ºsselwertspeicher (wie <code>etcd</code> / <code>zookeeper</code> ). </li><li>  Unterprozesskomponenten, die ohne Neustart des Prozesses neu konfiguriert / neu gestartet werden k√∂nnen. </li><li>  Konfiguration au√üerhalb der Artefakt- und Versionskontrolle. </li></ol><br><p>  Die Textdatei bietet eine gewisse Flexibilit√§t in Bezug auf Ad-hoc-Korrekturen.  Der Administrator eines Systems kann sich beim Zielknoten anmelden, √Ñnderungen vornehmen und den Dienst einfach neu starten.  Dies ist m√∂glicherweise nicht so gut f√ºr gr√∂√üere Systeme.  Hinter der √Ñnderung bleiben keine Spuren zur√ºck.  Die √Ñnderung wird nicht von einem anderen Augenpaar √ºberpr√ºft.  Es k√∂nnte schwierig sein herauszufinden, was die √Ñnderung verursacht hat.  Es wurde nicht getestet.  Aus Sicht des verteilten Systems kann ein Administrator einfach vergessen, die Konfiguration auf einem der anderen Knoten zu aktualisieren. </p><br><p>  (√úbrigens, wenn irgendwann die Verwendung von Textkonfigurationsdateien erforderlich sein muss, m√ºssen wir nur Parser + Validator hinzuf√ºgen, der denselben <code>Config</code> erzeugen kann und der ausreicht, um Textkonfigurationen zu verwenden. Dies zeigt auch, dass die Die Komplexit√§t der Konfiguration zur Kompilierungszeit ist etwas geringer als die Komplexit√§t textbasierter Konfigurationen, da wir in der textbasierten Version zus√§tzlichen Code ben√∂tigen.) </p><br><p>  Der zentralisierte Schl√ºsselwertspeicher ist ein guter Mechanismus zum Verteilen von Anwendungsmetaparametern.  Hier m√ºssen wir dar√ºber nachdenken, was wir als Konfigurationswerte betrachten und was nur Daten sind.  Bei einer Funktion <code>C =&gt; A =&gt; B</code> wir normalerweise selten wechselnde Werte <code>C</code> "Konfiguration", w√§hrend h√§ufig ge√§nderte Daten <code>A</code> - nur Daten eingeben.  Die Funktion sollte fr√ºher als die Daten <code>A</code> konfiguriert werden <code>A</code>  Angesichts dieser Idee k√∂nnen wir sagen, dass es die erwartete H√§ufigkeit von √Ñnderungen ist, die verwendet werden k√∂nnten, um Konfigurationsdaten von nur Daten zu unterscheiden.  Au√üerdem stammen Daten normalerweise aus einer Quelle (Benutzer) und die Konfiguration aus einer anderen Quelle (Administrator).  Der Umgang mit Parametern, die nach der Prozessinitialisierung ge√§ndert werden k√∂nnen, f√ºhrt zu einer Erh√∂hung der Anwendungskomplexit√§t.  F√ºr solche Parameter m√ºssen wir ihren √úbermittlungsmechanismus, das Parsen und die Validierung sowie falsche Werte behandeln.  Um die Programmkomplexit√§t zu verringern, sollten wir daher die Anzahl der Parameter reduzieren, die sich zur Laufzeit √§ndern k√∂nnen (oder sie sogar ganz eliminieren). </p><br><p>  Aus der Perspektive dieses Beitrags sollten wir zwischen statischen und dynamischen Parametern unterscheiden.  Wenn die Servicelogik zur Laufzeit eine seltene √Ñnderung einiger Parameter erfordert, k√∂nnen wir sie als dynamische Parameter bezeichnen.  Andernfalls sind sie statisch und k√∂nnen mit dem vorgeschlagenen Ansatz konfiguriert werden.  F√ºr die dynamische Rekonfiguration sind m√∂glicherweise andere Ans√§tze erforderlich.  Beispielsweise k√∂nnen Teile des Systems mit den neuen Konfigurationsparametern √§hnlich wie beim Neustart separater Prozesse eines verteilten Systems neu gestartet werden. <br>  (Meine bescheidene Meinung ist, eine Neukonfiguration der Laufzeit zu vermeiden, da dies die Komplexit√§t des Systems erh√∂ht. <br>  Es ist m√∂glicherweise einfacher, sich beim Neustart von Prozessen nur auf die Unterst√ºtzung des Betriebssystems zu verlassen.  Dies ist jedoch m√∂glicherweise nicht immer m√∂glich.) </p><br><p>  Ein wichtiger Aspekt bei der Verwendung der statischen Konfiguration, der manchmal dazu f√ºhrt, dass Benutzer eine dynamische Konfiguration in Betracht ziehen (ohne andere Gr√ºnde), ist die Ausfallzeit des Dienstes w√§hrend der Konfigurationsaktualisierung.  Wenn wir √Ñnderungen an der statischen Konfiguration vornehmen m√ºssen, m√ºssen wir das System neu starten, damit neue Werte wirksam werden.  Die Anforderungen an Ausfallzeiten variieren f√ºr verschiedene Systeme, daher ist dies m√∂glicherweise nicht so kritisch.  Wenn es kritisch ist, m√ºssen wir einen Neustart des Systems im Voraus planen.  Zum Beispiel k√∂nnten wir das Entleeren von <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=de&amp;u=">AWS ELB-Verbindungen</a> implementieren.  In diesem Szenario starten wir bei jedem Neustart des Systems parallel eine neue Instanz des Systems und schalten dann ELB darauf um, w√§hrend das alte System die Wartung bestehender Verbindungen abschlie√üen kann. </p><br><p>  Was ist mit der Konfiguration innerhalb eines versionierten Artefakts oder au√üerhalb?  Wenn Sie die Konfiguration in einem Artefakt behalten, bedeutet dies in den meisten F√§llen, dass diese Konfiguration denselben Qualit√§tssicherungsprozess wie andere Artefakte durchlaufen hat.  Man k√∂nnte also sicher sein, dass die Konfiguration von guter Qualit√§t und vertrauensw√ºrdig ist.  Im Gegenteil, die Konfiguration in einer separaten Datei bedeutet, dass keine Spuren davon vorhanden sind, wer und warum √Ñnderungen an dieser Datei vorgenommen haben.  Ist das wichtig  Wir glauben, dass es f√ºr die meisten Produktionssysteme besser ist, eine stabile und qualitativ hochwertige Konfiguration zu haben. </p><br><p>  Mit der Version des Artefakts k√∂nnen Sie herausfinden, wann es erstellt wurde, welche Werte es enth√§lt, welche Funktionen aktiviert / deaktiviert sind und wer f√ºr jede √Ñnderung in der Konfiguration verantwortlich war.  Es kann einige Anstrengungen erfordern, die Konfiguration in einem Artefakt zu halten, und es ist eine Designentscheidung, die getroffen werden muss. </p><br><h3 id="pros--cons">  Vor- und Nachteile </h3><br><p>  Hier m√∂chten wir einige Vorteile hervorheben und einige Nachteile des vorgeschlagenen Ansatzes diskutieren. </p><br><h4 id="advantages">  Vorteile </h4><br><p>  Merkmale der kompilierbaren Konfiguration eines vollst√§ndig verteilten Systems: </p><br><ol><li>  Statische √úberpr√ºfung der Konfiguration.  Dies gibt ein hohes Ma√ü an Sicherheit, dass die Konfiguration bei Typbeschr√§nkungen korrekt ist. </li><li>  Reichhaltige Konfigurationssprache.  Typischerweise beschr√§nken sich andere Konfigurationsans√§tze auf h√∂chstens variable Substitution. <br>  Mit Scala kann man eine Vielzahl von Sprachfunktionen verwenden, um die Konfiguration zu verbessern.  Zum Beispiel k√∂nnen wir Merkmale verwenden, um Standardwerte bereitzustellen, Objekte, um unterschiedliche <code>val</code> festzulegen. Wir k√∂nnen auf Werte verweisen, die nur einmal im √§u√üeren Bereich (DRY) definiert sind.  Es ist m√∂glich, Literalsequenzen oder Instanzen bestimmter Klassen ( <code>Seq</code> , <code>Map</code> usw.) zu verwenden. </li><li>  DSL  Scala hat gute Unterst√ºtzung f√ºr DSL-Autoren.  Mit diesen Funktionen kann eine Konfigurationssprache eingerichtet werden, die bequemer und benutzerfreundlicher ist, sodass die endg√ºltige Konfiguration zumindest f√ºr Dom√§nenbenutzer lesbar ist. </li><li>  Integrit√§t und Koh√§renz √ºber Knoten hinweg.  Einer der Vorteile einer Konfiguration f√ºr das gesamte verteilte System an einem Ort besteht darin, dass alle Werte streng einmal definiert und dann an allen Stellen wiederverwendet werden, an denen wir sie ben√∂tigen.  Geben Sie au√üerdem sichere Portdeklarationen ein, um sicherzustellen, dass die Knoten des Systems in allen m√∂glichen korrekten Konfigurationen dieselbe Sprache sprechen.  Es gibt explizite Abh√§ngigkeiten zwischen Knoten, die es schwierig machen, die Bereitstellung einiger Dienste zu vergessen. </li><li>  Hohe Qualit√§t der √Ñnderungen.  Der Gesamtansatz, Konfigurations√§nderungen durch einen normalen PR-Prozess zu √ºbergeben, legt auch in der Konfiguration hohe Qualit√§tsstandards fest. </li><li>  Gleichzeitige Konfigurations√§nderungen.  Wenn wir √Ñnderungen an der Konfiguration vornehmen, stellt die automatische Bereitstellung sicher, dass alle Knoten aktualisiert werden. </li><li>  Vereinfachung der Anwendung.  Die Anwendung muss die Konfiguration nicht analysieren und validieren und falsche Konfigurationswerte verarbeiten.  Dies vereinfacht die Gesamtanwendung.  (Die Konfiguration selbst nimmt etwas an Komplexit√§t zu, ist jedoch ein bewusster Kompromiss zur Sicherheit.) Es ist ziemlich einfach, zur normalen Konfiguration zur√ºckzukehren - f√ºgen Sie einfach die fehlenden Teile hinzu.  Es ist einfacher, mit der kompilierten Konfiguration zu beginnen und die Implementierung zus√§tzlicher Teile auf einen sp√§teren Zeitpunkt zu verschieben. </li><li>  Versionierte Konfiguration.  Aufgrund der Tatsache, dass Konfigurations√§nderungen dem gleichen Entwicklungsprozess folgen, erhalten wir ein Artefakt mit einer eindeutigen Version.  Dadurch k√∂nnen wir die Konfiguration bei Bedarf zur√ºckschalten.  Wir k√∂nnen sogar eine Konfiguration bereitstellen, die vor einem Jahr verwendet wurde, und sie funktioniert genauso.  Eine stabile Konfiguration verbessert die Vorhersagbarkeit und Zuverl√§ssigkeit des verteilten Systems.  Die Konfiguration ist zur Kompilierungszeit festgelegt und kann auf einem Produktionssystem nicht einfach manipuliert werden. </li><li>  Modularit√§t  Das vorgeschlagene Framework ist modular aufgebaut und Module k√∂nnen auf verschiedene Arten kombiniert werden <br>  unterst√ºtzen verschiedene Konfigurationen (Setups / Layouts).  Insbesondere ist es m√∂glich, ein kleines Einzelknotenlayout und eine gro√üe Mehrknoteneinstellung zu haben.  Es ist vern√ºnftig, mehrere Produktionslayouts zu haben. </li><li>  Testen  Zu Testzwecken kann man einen Mock-Service implementieren und ihn typsicher als Abh√§ngigkeit verwenden.  Einige verschiedene Testlayouts mit verschiedenen Teilen, die durch Mocks ersetzt wurden, konnten gleichzeitig beibehalten werden. </li><li>  Integrationstests.  In verteilten Systemen ist es manchmal schwierig, Integrationstests durchzuf√ºhren.  Mit dem beschriebenen Ansatz zur typsicheren Konfiguration des gesamten verteilten Systems k√∂nnen wir alle verteilten Teile auf kontrollierbare Weise auf einem einzigen Server ausf√ºhren.  Es ist einfach, die Situation zu emulieren <br>  wenn einer der Dienste nicht mehr verf√ºgbar ist. </li></ol><br><h4 id="disadvantages">  Nachteile </h4><br><p>  Der kompilierte Konfigurationsansatz unterscheidet sich von der "normalen" Konfiguration und entspricht m√∂glicherweise nicht allen Anforderungen.  Hier sind einige der Nachteile der kompilierten Konfiguration: </p><br><ol><li>  Statische Konfiguration.  Es ist m√∂glicherweise nicht f√ºr alle Anwendungen geeignet.  In einigen F√§llen muss die Konfiguration in der Produktion unter Umgehung aller Sicherheitsma√ünahmen schnell repariert werden.  Dieser Ansatz macht es schwieriger.  Die Kompilierung und erneute Bereitstellung ist erforderlich, nachdem √Ñnderungen an der Konfiguration vorgenommen wurden.  Dies ist sowohl das Merkmal als auch die Belastung. </li><li>  Konfigurationsgenerierung.  Wenn die Konfiguration von einem Automatisierungstool generiert wird, erfordert dieser Ansatz eine nachfolgende Kompilierung (die wiederum fehlschlagen kann).  Die Integration dieses zus√§tzlichen Schritts in das Build-System erfordert m√∂glicherweise zus√§tzlichen Aufwand. </li><li>  Instrumente.  Heutzutage werden viele Tools verwendet, die auf textbasierten Konfigurationen basieren.  Einige von ihnen <br>  gilt nicht, wenn die Konfiguration kompiliert wird. </li><li>  Eine √Ñnderung der Denkweise ist erforderlich.  Entwickler und DevOps sind mit Textkonfigurationsdateien vertraut.  Die Idee, die Konfiguration zu kompilieren, mag ihnen seltsam erscheinen. </li><li>  Vor der Einf√ºhrung einer kompilierbaren Konfiguration ist ein qualitativ hochwertiger Softwareentwicklungsprozess erforderlich. </li></ol><br><p>  Das implementierte Beispiel weist einige Einschr√§nkungen auf: </p><br><ol><li>  Wenn wir eine zus√§tzliche Konfiguration bereitstellen, die von der Knotenimplementierung nicht verlangt wird, hilft uns der Compiler nicht dabei, die fehlende Implementierung zu erkennen.  Dies k√∂nnte durch die Verwendung von <code>HList</code> oder ADTs ( <code>HList</code> ) f√ºr die Knotenkonfiguration anstelle von Merkmalen und <code>HList</code> . </li><li>  Wir m√ºssen ein Boilerplate in der Konfigurationsdatei bereitstellen: ( <code>package</code> , <code>import</code> , <code>object</code> ; <br>  <code>override def</code> f√ºr Parameter mit Standardwerten <code>override def</code> ).  Dies kann teilweise mit einem DSL behoben werden. </li><li>  In diesem Beitrag behandeln wir nicht die dynamische Rekonfiguration von Clustern √§hnlicher Knoten. </li></ol><br><h3 id="conclusion">  Fazit </h3><br><p>  In diesem Beitrag haben wir die Idee diskutiert, die Konfiguration direkt im Quellcode typsicher darzustellen.  Der Ansatz k√∂nnte in vielen Anwendungen als Ersatz f√ºr XML- und andere textbasierte Konfigurationen verwendet werden.  Obwohl unser Beispiel in Scala implementiert wurde, k√∂nnte es auch in andere kompilierbare Sprachen (wie Kotlin, C #, Swift usw.) √ºbersetzt werden.  Man k√∂nnte diesen Ansatz in einem neuen Projekt ausprobieren und, falls er nicht gut passt, auf die altmodische Weise wechseln. </p><br><p>  Nat√ºrlich erfordert eine kompilierbare Konfiguration einen qualitativ hochwertigen Entwicklungsprozess.  Im Gegenzug verspricht es eine ebenso hochwertige robuste Konfiguration. </p><br><p>  Dieser Ansatz k√∂nnte auf verschiedene Arten erweitert werden: </p><br><ol><li>  Man k√∂nnte Makros verwenden, um die Konfigurationsvalidierung durchzuf√ºhren und zur Kompilierungszeit fehlzuschlagen, falls gesch√§ftslogische Einschr√§nkungen fehlschlagen. </li><li>  Ein DSL k√∂nnte implementiert werden, um die Konfiguration dom√§nenbenutzerfreundlich darzustellen. </li><li>  Dynamisches Ressourcenmanagement mit automatischen Konfigurationsanpassungen.  Wenn wir beispielsweise die Anzahl der Clusterknoten anpassen, m√∂chten wir m√∂glicherweise (1), dass die Knoten eine leicht modifizierte Konfiguration erhalten;  (2) Cluster-Manager zum Empfangen neuer Knoteninformationen. </li></ol><br><h3 id="thanks">  Danke </h3><br><p>  Ich m√∂chte mich bei Andrey Saksonov, Pavel Popov und Anton Nehaev f√ºr das inspirierende Feedback zum Entwurf dieses Beitrags bedanken, das mir geholfen hat, ihn klarer zu machen. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/de447690/">https://habr.com/ru/post/de447690/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../de447680/index.html">Emulations√ºbungen: Xbox 360 FMA-Handbuch</a></li>
<li><a href="../de447682/index.html">Space Data Center: 24 Stunden vor dem Start</a></li>
<li><a href="../de447684/index.html">So zeigen Sie Unternehmenswerte in einem B√ºro (ohne Poster und Slogans)</a></li>
<li><a href="../de447686/index.html">Ein sehr wichtiger Parameter von LED-Lampen, den nur wenige kennen</a></li>
<li><a href="../de447688/index.html">Auf die Frage nach Bitset</a></li>
<li><a href="../de447694/index.html">Kompilierte verteilte Systemkonfiguration</a></li>
<li><a href="../de447696/index.html">Warum St√§dte gegen Amazon Go sind, die ersten bargeldlosen Gesch√§fte</a></li>
<li><a href="../de447698/index.html">Red Hogwarts: Akademiker ohne Diplom</a></li>
<li><a href="../de447700/index.html">Emotionale Flexibilit√§t ist der Schl√ºssel zum pers√∂nlichen Wachstum.</a></li>
<li><a href="../de447702/index.html">Der ideale mathematische Kreis existiert nicht</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>