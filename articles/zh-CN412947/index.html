<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🚵🏻 🤔 👨🏻‍🚒 在Azure云中进行负载测试。 如何在接近真实的条件下测试大型在线商店？ 🤙🏻 👲🏻 🍋</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="在本文中，我们将分享我们在测试运行在MS Azure云中的Web Apps应用程序（在线商店）时获得的实践经验，以及描述我们用于解决此问题的工具以及根据这些发现得出的结论。结果。 


 测试对象 
 我们选择了VirtoCommerce店面（用作在VirtoCommerce平台上创建的应用程序的前...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>在Azure云中进行负载测试。 如何在接近真实的条件下测试大型在线商店？</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/virtocommerce/blog/412947/"> 在本文中，我们将分享我们在测试运行在MS Azure云中的Web Apps应用程序（在线商店）时获得的实践经验，以及描述我们用于解决此问题的工具以及根据这些发现得出的结论。结果。 <br><img src="https://habrastorage.org/webt/qy/hw/ih/qyhwihvqkt2hrypk0odlioyxwz0.jpeg"><br><a name="habracut"></a><br><h4> 测试对象 </h4><br> 我们选择了VirtoCommerce店面（用作在VirtoCommerce平台上创建的应用程序的前端的Web应用程序）作为测试对象。 <br><br> 为了真实了解系统的功能，我们需要模拟尽可能接近实际情况的用户请求。 检查可能在缓存中的主页，然后声称我们的速度为1k req / sec，这没有任何意义。 在现实生活中，这种性能指标毫无意义。 <br><br> 因此，为了使我们的测试结果具有统计上的意义，并尽可能接近实际流量反映性能指标，决定使用与在线商店中的实际用户行为尽可能接近的查询。 <cut></cut><br><br> 让我们详细介绍以下操作，其中包括“真实”测试： <br><br><table border="1"><tbody><tr><td><p>  <strong>用户操作（测试类型）</strong> </p><br></td><td><p>  <strong>占请求总数的百分比</strong> </p><br></td></tr><tr><td><p> 查看带有产品的独特类别页面 </p><br></td><td><p>  30％ </p><br></td></tr><tr><td><p> 查看独特的产品卡 </p><br></td><td><p>  40％ </p><br></td></tr><tr><td><p> 将商品添加到购物车 </p><br></td><td><p>  10％ </p><br></td></tr><tr><td><p> 通过唯一的关键字或属性搜索产品 </p><br></td><td><p>  20％ </p><br></td></tr></tbody></table><br>  <i>图</i>  <i>1.用户的主要行为及其特定的使用频率。</i> <br><br><h4> 测试数据准备 </h4><br> 任何测试中最重要的阶段是数据准备。 测试数据的选择应尽可能与真实系统中的数据相对应，无论是数量还是质量（通信，结构等）。 如果可能的话，数据总量应该足够，以便在测试时尽可能少地重复调用相同的数据，这将避免频繁使用缓存，从而对系统性能产生最悲观的印象。 <br><br> 通常，在线商店的主要数据是：产品和类别的目录，其中包含价格，折扣和余额信息。 <br><br> 作为测试环境的填充，使用了真实的目录数据，这些数据将在主要生产环境中使用： <br><br><img src="https://habrastorage.org/webt/kc/zm/o3/kczmo3vh9hjvjxaf6a0mn-zcaco.png"><br>  <i>图2。</i>  <i>用于填充被测系统的数据。</i> <br><br> 显然，对于不熟悉VirtoCommerce目录结构的读者而言，某些数据类型可能没有任何意义，但是尽管如此，我们还是会展示它们，以便至少对数量顺序有所了解。 <br><br><h4> 项目准备和记录测试 </h4><br> 作为负载测试的主要工具，我们将使用MS Visual Studio Enterprise 2017（其他Studio版本可能不支持此类项目）和项目类型<b>Web Performance and Load Test Project</b> 。 <br><br><img src="https://habrastorage.org/webt/pq/pi/hz/pqpihzjuik_rtvxt9esckqbkkj4.png"><br>  <i>图3。</i>  <i>创建一个新项目。</i> <br><br> 创建项目后，我们将需要为每个先前定义的用户操作创建测试。 作为示例，我们限制自己为一个用户操作创建测试，因为其余的操作是通过类推创建的。 <br><br> 对于测试，我们将使用Visual Studio中内置的标准类型的测试Web性能测试。 <br><br> 我们将创建的第一个测试将是显示在线商店中产品详细信息的测试。 <br><br> 要创建测试，请从Studio提供的列表中选择测试类型<b>“ Web Performance Test”</b> ，并设置名称<b>“ Storefront-ProductDetail”</b> 。 <br><br><img src="https://habrastorage.org/webt/q2/hj/fk/q2hjfkrpoctrmaqtticvke7og-i.png"><br>  <i>图4。</i>  <i>在Visual Studio中选择测试类型。</i> <br><br> 对于这种类型的测试，Visual Studio将立即尝试打开浏览器，可以在该浏览器中直接在站点上以交互方式单击必需的操作，但是我们不会这样做，而是立即关闭浏览器并停止录制。 结果，我们得到一个空的<b>Storefront-ProductDetail.webtest</b>测试。 <br><br> 接下来，我们需要为此测试添加一个数据源，以便我们可以在同一测试中使用不同的查询参数，为此， <b>VS Studio Web性能测试</b>提供了这样的机会。 <br><br> 作为测试的数据源，我们将使用数据库中存储产品记录的表。 之后，我们将能够在请求中使用来自连接源的数据，这将在测试的应用程序上打开产品详细信息。 这可以通过插入构造<i>“ {{数据源名称。表名称。列名称}}”来实现。</i> <br><br> 结果，在所有操作之后，我们的第一个测试将采用这种形式。 <br><br><img src="https://habrastorage.org/webt/40/jo/tz/40jotzcj3gqlek8yi5qdwl8vgri.png"><br>  <i>图</i>  <i>5.测试内容</i> <br><br> 现在是第一次运行的时候了，请尝试运行我们的测试并确保其正确运行。 <br><br><img src="https://habrastorage.org/webt/r7/pb/c_/r7pbc_5z3mqk_hugwege27clcxe.png"><br>  <i>图</i>  <i>6.一次测试的结果</i> <br><br> 以此类推，我们将为所有其他场景创建测试。 <br><br><img src="https://habrastorage.org/webt/f_/tv/5a/f_tv5aw-ilxk-apr4vehc5c5jvo.png"><br>  <i>图</i>  <i>7.结果测试套件</i> <br><br> 之后，几乎所有内容都可以用来创建组合测试，以模拟用户在站点上的实际行为。 <br><br> 为此，向我们的项目添加一个新的<b>LoadTest。</b> <br><br><img src="https://habrastorage.org/webt/ex/wd/ve/exwdvet-rwzbznri1na7mmqk2da.png"><br>  <i>图8。</i>  <i>创建一个新的负载测试</i> <br><br> 在出现的向导中，选择“ <b>本地负载测试</b> ”类型。 <br><br><img src="https://habrastorage.org/webt/oa/pw/vf/oapwvf0exwvlj8k3zvd8byagwgg.png"><br>  <i>图</i>  <i>9.选择测试类型</i> <br><br> 此项需要澄清，因为您正确地问：“还有什么内部部署？” 本文的主题是有关使用Teams Services和MS Azure进行测试的，但是有一点细微之处，因为我们使用表或其他外部服务形式的数据源进行测试，因此当我们尝试在云中运行此测试时可能会造成一些困难。 <br><br> 在徒劳地尝试使此类测试在云中运行之后，我们放弃了这项尝试，并决定使用所谓的“记录”测试进行测试，这些测试是通过记录本地运行并连接到数据源的测试生成的查询而获得的。 <br><br> 为了记录测试，我们使用Fiddler，它能够将请求导出为<b>Visual Studio Web测试</b>格式。 我们将进一步详细描述记录此类测试的过程。 <br><br> 在接下来的步骤中，我们选择测试的持续时间，用户数量，最重要的是，指明我们的<b>MixedLoadTest</b>将包括哪些测试以及将以什么比例使用它们。 <br><br><img src="https://habrastorage.org/webt/ii/gw/m1/iigwm179eca-z4wpfhjiuxkmcpy.png"><br>  <i>图10。</i>  <i>测试组件</i> <br><br> 结果，在完成所有操作之后，我们得到了一个组合的<b>MixedLoadTest，</b>配置为在本地部署的应用程序上运行。 <br> 接下来，我们需要运行此测试，并尝试使用<b>Fiddler</b>记录测试结果将生成的所有请求，并获得可以直接在云中运行的“记录”。 <br><br> 首先运行<b>Fiddler</b>和我们的<b>MixedLoadTest</b>测试。 <br><br><img src="https://habrastorage.org/webt/vo/i3/iv/voi3ivm3p2xqpotj13ielj2lpgu.png"><br>  <i>图</i>  <i>11.测试结果</i> <br><br> 处理完所有数据后，我们在Fiddler中得到这张照片 <br><br><img src="https://habrastorage.org/webt/a2/te/ne/a2teneaia7ipcwzdxiudn8y_fnw.png"><br>  <i>图</i>  <i>12. Fiddler的测试会议</i> <br><br> 接下来，在Fiddler中，以“ <b>Visual Studio Web测试”</b>的格式保存所有会话， <b>依次选择</b> “ <i>文件”-&gt;“导出会话”-&gt;“所有会话”-&gt;“ Visual Studio Web测试”，</i>然后将结果文件添加到项目中。 让我提醒您，此操作对于使我们能够在不参考外部数据源的情况下进行测试是必需的，因为启动此类测试可能会在云中引起问题。 <br><br><img src="https://habrastorage.org/webt/o3/le/v4/o3lev4pmhf-xp8ygxdbpi4xjujs.png"><br>  <i>图</i>  <i>13.“记录”测试的细节</i> <br><br> 现在几乎所有内容都可以在云中运行我们的测试了，准备测试的最后一步是在任何文本编辑器中打开“记录的” <b>MixedLoadTest</b> ，并用我们在云中的商店的地址替换<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">localhost</a> ：8888（代理地址，Fiddler）。 <br><br><h4> 在云中运行测试 </h4><br> 要在云中运行测试，我们需要<b>Visual Studio Team Services中</b>的有效帐户。 <br><br> 创建一个新的LoadTest，仅这次选择<b>带有Visual Studio Team Services的基于云的负载测试</b> 。 <br><br><img src="https://habrastorage.org/webt/un/a6/s_/una6s_qzrma_us5niajapmwrjdg.png"><br><br> 在接下来的步骤中，我们选择将从中生成测试资源流量的数据中心，以及恒定模式的最大代理（用户）数量，或者如果我们想逐渐增加负载，则需要设置适当的参数。 <br><br><img src="https://habrastorage.org/webt/mi/vq/lb/mivqlbjaoikw-bzr1ztj_eg7zr4.png"><br><br> 在选择测试的步骤中，我们选择了我们之前使用<b>Fiddler</b>记录的唯一测试，它将模拟被测试资源上的“实际”负载。 <br><br><img src="https://habrastorage.org/webt/41/q4/os/41q4os13d7n0edb-hxxa5ouj1nq.png"><br><br> 创建完成后，我们将启动测试，在此期间，工作室将显示一些关键指标，例如性能和带宽，以及建立实时图表。 <br><br><img src="https://habrastorage.org/webt/hc/wv/7b/hcwv7ba5ceomfnww-ccvbftn9_a.png"><br>  <i>图</i>  <i>14.在云中运行测试的过程</i> <br><br> 测试完成后，您还可以在VSTS中查看保存的Web报告： <br><br><img src="https://habrastorage.org/webt/2l/h3/jp/2lh3jpyjwrqkndq1bjaf1q2ue7y.png"><br><img src="https://habrastorage.org/webt/xe/dx/zr/xedxzrpsrabonavgxjgw49frpvs.png"><br>  <i>图</i>  <i>15. Visual Studio Team Services门户上的Web报告</i> <br><br><h4> 结果分析 </h4><br> 最重要的一点是测试结果的处理和分析。 对于有问题的任务，有必要评估在Azure Web Apps B2和B3费率的各种配置下运行的应用程序的性能。 <br><br> 为此，我们针对不同配置的应用程序再次运行了“记录”测试，并将结果记录在Excel文档中。 <br><br> 结果，我们得到了此报告： <br><br><img src="https://habrastorage.org/webt/bp/oz/xh/bpozxhhhsjiuwwmwl2gmfcblluq.png"><br>  <i>图16。</i>  <i>测试结果报告</i> <br><br> 在分析所获得的数据之后，有可能找出我们的应用程序可以承受的最大负载-大约60个同时用户或9个请求/秒。 平均页面返回时间为2.5秒。 该图显示，在请求数量达到某个阈值之后，性能问题突然开始。 <br><br> 后来发现，其原因是100％的处理器负载，这是因为我们使用了第三方库来进行服务器页面渲染，该库使用正则表达式对标记进行标记和解析。 <br><br><h4> 结论 </h4><br> 积极开发的应用程序的生产力始终具有非常强烈的降级趋势，因为任何更改，即使从开发人员的角度来看，即使是最微不足道的更改，都可能导致应用程序性能的重大后果。 在这方面，定期的性能测试是一个重要的过程，应该定期进行，并且应作为持续集成过程的一部分。 <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">项目本身以及通过测试收到的报告可在GitHub上获得</a> 。 </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN412947/">https://habr.com/ru/post/zh-CN412947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN412933/index.html">特斯拉部分开放了Model S / X 2018.12的源代码</a></li>
<li><a href="../zh-CN412937/index.html">演示黑客：PenTest Show将展示黑客办公网络和安全系统以窃取任何东西的简便性</a></li>
<li><a href="../zh-CN412939/index.html">测试人员反对测试</a></li>
<li><a href="../zh-CN412941/index.html">Java东欧会议2018：报告和印象</a></li>
<li><a href="../zh-CN412945/index.html">依赖经理</a></li>
<li><a href="../zh-CN412949/index.html">占星家宣布在Avito进行iOS开发一周</a></li>
<li><a href="../zh-CN412951/index.html">DotVVM-客户端和服务器之间的通信</a></li>
<li><a href="../zh-CN412953/index.html">使用OpenCV2和ROS的英特尔实感d435摄像机校准</a></li>
<li><a href="../zh-CN412955/index.html">使馆和肉质公司在Xcode中进行UI测试</a></li>
<li><a href="../zh-CN412957/index.html">Mi Band 4和Mi Band 5：小米智能手链的未来</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>