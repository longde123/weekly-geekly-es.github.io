<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>🤮 👩‍⚕️ 🙏🏾 Eksperimen multitasking kecil dalam mikrokontroler 🎅🏿 🕵️ 🧛🏼</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dalam salah satu catatan sebelumnya, penulis mencoba untuk berpendapat bahwa ketika memprogram mikrokontroler, pengalihan tugas sederhana akan berguna...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Eksperimen multitasking kecil dalam mikrokontroler</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/461121/"><p>  Dalam salah satu catatan sebelumnya, penulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mencoba untuk</a> berpendapat bahwa ketika memprogram mikrokontroler, pengalihan tugas sederhana akan berguna dalam situasi di mana menggunakan sistem operasi waktu-nyata terlalu banyak, dan loop komprehensif untuk semua tindakan yang diperlukan terlalu kecil ( Dia berkata, sama seperti Count de La Fer).  Lebih tepatnya, tidak terlalu sedikit, tetapi terlalu bingung. </p><br><p>  Dalam catatan selanjutnya, <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">direncanakan untuk</a> merampingkan akses ke sumber daya yang dibagikan oleh beberapa tugas menggunakan antrian berdasarkan ring buffer (FIFOs) dan tugas terpisah yang ditugaskan khusus untuk ini.  Setelah tersebar untuk tugas-tugas yang berbeda tindakan-tindakan yang tidak terkait satu sama lain, kami berhak untuk mengharapkan kode yang lebih terlihat.  Dan jika pada saat yang sama kita mendapatkan kenyamanan dan kesederhanaan, mengapa tidak mencobanya? </p><br><p>  Jelas, mikrokontroler tidak dirancang untuk menyelesaikan tugas yang mungkin dilakukan pengguna.  Kemudian, mungkin, pengalih tugas semacam itu akan terbukti cukup memadai dalam banyak situasi.  Singkatnya, percobaan kecil tidak mungkin menyakitkan.  Karena itu, agar tidak berdasar, hamba Anda yang rendah hati memutuskan untuk menulis sesuatu dan menguji coretan-coretannya. </p><a name="habracut"></a><br><p>  Dalam mikrokontroler, saya harus mengatakan, persyaratan untuk memperhitungkan waktu sebagai sesuatu yang penting dan sulit lebih umum daripada komputer tujuan umum.  Melampaui kerangka dalam kasus pertama setara dengan tidak dapat dioperasi, dan dalam kasus kedua, itu hanya mengarah pada peningkatan waktu tunggu, yang cukup dapat diterima jika saraf sudah beres.  Bahkan ada dua istilah "soft real time" dan "hard real time". </p><br><p>  Biarkan saya mengingatkan Anda, kami berbicara tentang pengendali dengan inti Cortex-M3,4,7.  Hari ini adalah keluarga yang sangat umum.  Dalam contoh di bawah ini, kami menggunakan mikrokontroler STM32F303, yang merupakan bagian dari papan STM32F3DISCOVERY. </p><br><p>  Switch adalah file assembler tunggal. <br>  Assembler tidak takut pada penulis, tetapi, sebaliknya, menginspirasi harapan bahwa kecepatan maksimum akan tercapai. </p><br><p>  Awalnya, logika paling sederhana dari operasi sakelar direncanakan, yang disajikan pada Gambar 1 untuk delapan tugas. </p><br><p><img src="https://habrastorage.org/webt/ul/ot/pm/ulotpmeuad4zcxqcgroa_t92al0.jpeg"></p><br><p>  Dalam skema ini, tugas mengambil porsi waktu mereka satu per satu dan hanya dapat memberikan sisa kutu mereka dan, jika perlu, kemudian melewati beberapa kutu mereka.  Logika ini terbukti baik, karena ukuran kuantum dapat dibuat kecil.  Dan inilah tepatnya yang diperlukan agar tidak segera mengangkat tugas yang baru saja terjadi gangguan, dan juga untuk meningkatkan dan kemudian menurunkan prioritasnya.  Paket yang baru saja diterima akan diam-diam menunggu 200-300 mikrodetik sampai tugasnya menerima centangnya.  Dan jika kita memiliki Cortex-M7 yang beroperasi pada frekuensi 216 MHz, maka 20 mikrodetik untuk satu centang cukup masuk akal, karena akan membutuhkan kurang dari setengah mikrodetik untuk beralih.  Dan tugas apa pun dari contoh di atas tidak akan pernah lebih dari 140 mikrodetik terlambat. </p><br><p>  Namun, dengan peningkatan jumlah tugas, bahkan dengan ukuran kuantum waktu yang sangat kecil, keterlambatan dalam permulaan aktivitas tugas yang diminta mungkin tidak lagi menyenangkan.  Berdasarkan hal ini, dan juga memperhitungkan bahwa hanya sebagian kecil dari tugas yang benar-benar membutuhkan waktu nyata, diputuskan untuk sedikit memodifikasi logika sakelar.  Itu ditunjukkan pada Gambar 2. </p><br><p><img src="https://habrastorage.org/webt/iq/gs/qi/iqgsqiqf4zigukr5vvrfi2sbgki.jpeg"></p><br><p>  Sekarang kita hanya memilih sebagian dari tugas yang menerima kuantum keseluruhan, dan memilih hanya satu centang untuk sisanya, di mana mereka bergantian dalam permainan.  Dalam hal ini, subrutin inisialisasi menerima parameter input, yaitu nomor posisi, mulai dari mana semua tugas akan terpengaruh dalam hak dan akan berbagi satu centang.  Pada saat yang sama, skema lama tetap tersedia, untuk ini cukup dengan menetapkan nilai parameter ke nol atau jumlah total tugas.  Biaya peralihan meningkat hanya dengan beberapa instruksi assembler. </p><br><p>  Dua skema serupa digunakan untuk memungkinkan akses ke sumber daya bersama.  Yang pertama, yang disebutkan dalam catatan sebelumnya, menggunakan beberapa FIFO (atau buffer bundar dengan jumlah produsen pesan) dan tugas pencocokan terpisah.  Ini dirancang untuk berkomunikasi dengan dunia luar dan tidak memerlukan harapan dari tugas yang menghasilkan pesan.  Hanya diperlukan untuk memastikan bahwa antrian tidak ramai. </p><br><p>  Skema kedua juga menggunakan tugas terpisah untuk memungkinkan akses, tetapi memperkenalkan harapan karena mengelola sumber daya internal di kedua arah.  Tindakan ini tidak dapat dikaitkan dengan waktu.  Gambar 3 menunjukkan komponen-komponen dari rangkaian kedua. </p><br><p><img src="https://habrastorage.org/webt/-m/fb/4r/-mfb4rum70winng8agin4yqbf3e.jpeg"></p><br><p>  Elemen utama di dalamnya adalah buffer permintaan, sesuai dengan jumlah tugas yang diinginkan, dan satu indikator akses.  Pengoperasian desain ini cukup sederhana.  Tugas di sebelah kiri mengirimkan permintaan akses ke tempat yang dialokasikan khusus untuknya (misalnya, tugas 2 menulis 1 ke Permintaan 2).  Tugas - operator memilih siapa yang memperbolehkan dan menulis nomor tugas yang dipilih dalam bendera resolusi.  Tugas yang telah menerima izin melakukan aksinya dan menulis tanda akhir akses ke permintaan, nilai 0xFF.  Penjadwal, melihat bahwa permintaan dihapus, mengatur ulang tanda izin, mengatur ulang permintaan sebelumnya dan mengatur ulang permintaan dari tugas lain. </p><br><p>  Dua proyek uji di bawah IAR dan deskripsi papan STM32F3DISCOVERY yang digunakan dapat dilihat di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">sini</a> .  Dalam proyek pertama, ATS303 hanya memeriksa kinerjanya dan mendebugnya.  Semua LED yang terpasang pada papan ini sangat berguna.  Tidak ada yang terluka. </p><br><p>  Draf kedua BTS303 menguji dua opsi alokasi sumber daya yang disebutkan.  Di dalamnya, tugas 1 dan 2 menghasilkan pesan pengujian yang diterima oleh operator.  Untuk berkomunikasi dengan operator, saya harus menambahkan syal dengan port COM TTL, seperti yang ditunjukkan pada foto di bawah ini. </p><br><p><img src="https://habrastorage.org/webt/za/hh/_c/zahh_cdcuabvgg-o92ukph_feji.jpeg"></p><br><p>  Operator menggunakan emulator terminal.  Saya pikir pembaca akan memaafkan penulis untuk warna tabung lunak.  Ini terlihat seperti ini. </p><br><p><img src="https://habrastorage.org/webt/1r/wa/aj/1rwaajjm2zx_ue2tglhquc7suw4.jpeg"></p><br><p>  Untuk memulai seluruh sistem, sebelum menyelesaikan interupsi, langkah-langkah awal diperlukan di tubuh nol tugas utama (), yang disajikan di bawah ini. </p><br><pre><code class="plaintext hljs">void main_start_task_switcher(U8 border); U8 task_run_and_return_task_number((U32)t1_task); U8 task_run_and_return_task_number((U32)t2_task); U8 task_run_and_return_task_number((U32)t3_human_link); U8 task_run_and_return_task_number((U32)t4_human_answer); U8 task_run_and_return_task_number((U32)task_5); U8 task_run_and_return_task_number((U32)task_6); U8 task_run_and_return_task_number((U32)task_7);</code> </pre> <br><p>  Pada baris ini, sakelar pertama mulai, dan kemudian, pada gilirannya, tujuh tugas yang tersisa. </p><br><p>  Berikut adalah set panggilan minimum yang diperlukan untuk pekerjaan itu. </p><br><pre> <code class="plaintext hljs"> void task_wake_up_action(U8 taskNumber);</code> </pre> <br><p>  Panggilan ini digunakan dalam interupsi dari pengatur waktu perangkat keras pengguna.  Tantangan dari tugas itu sendiri berbicara untuk diri mereka sendiri. </p><br><pre> <code class="plaintext hljs"> void release_me_and_set_sleep_steps(U32 ticks); U8 get_my_number(void);</code> </pre><br><p>  Semua fungsi ini ada di file assembler switch.  Ada beberapa fungsi lagi yang berguna untuk pengujian, tetapi tidak diperlukan. </p><br><p>  Dalam proyek BTS303, tugas 3 menerima perintah operator dari luar dan mengirimnya jawaban untuk mereka yang datang dari tugas 4. Tugas 4 menerima perintah dari operator dari tugas 3 dan menjalankannya dengan kemungkinan jawaban.  Tugas 3 juga menerima pesan dari tugas 1 dan 2 dan mengirimkannya melalui UART ke terminal emulator (misalnya, dempul). </p><br><p>  Tugas 0 (utama) melakukan beberapa pekerjaan tambahan, misalnya, memeriksa jumlah kata yang tidak terpengaruh di area susun setiap tugas.  Informasi ini dapat diminta oleh operator dan mendapatkan gagasan tentang penggunaan tumpukan.  Awalnya, untuk setiap tugas, area tumpukan 512 byte (128 kata) dialokasikan dan perlu untuk memantau (setidaknya pada tahap debugging) bahwa area ini tidak mendekati meluap. </p><br><p>  Tugas 5 dan 6 melakukan perhitungan pada beberapa variabel floating point umum.  Untuk melakukan ini, mereka meminta akses ke sana dari tugas 7. </p><br><p>  Ada fitur tambahan lain yang bisa dilihat di proyek uji.  Ini dirancang agar Anda dapat membangkitkan tugas tidak setelah jumlah kutu telah kedaluwarsa, tetapi setelah waktu yang ditentukan, dan sepertinya ini. </p><br><pre> <code class="plaintext hljs"> void wake_me_up_after_milliSeconds(U32 timeMS);</code> </pre> <br><p>  Untuk implementasinya, timer perangkat keras tambahan juga diperlukan, yang juga diterapkan dalam kasus uji. </p><br><p>  Seperti yang Anda lihat, daftar semua panggilan yang diperlukan cocok pada satu halaman. </p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id461121/">https://habr.com/ru/post/id461121/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id461099/index.html">Game AirAttack! - Pengalaman pengembangan VR pertama kami</a></li>
<li><a href="../id461101/index.html">Android Jetpack Membuat Kesan Pertama</a></li>
<li><a href="../id461105/index.html">5 plugin webpack bermanfaat</a></li>
<li><a href="../id461107/index.html">Dosimeter untuk Seryozha. Bagian II Tabung centenary vs atom damai</a></li>
<li><a href="../id461113/index.html">Lima tahun menggunakan C ++ untuk proyek-proyek mikrokontroler dalam produksi</a></li>
<li><a href="../id461125/index.html">Tugas membuat kode numerik berurutan untuk penomoran pesan dalam kode sumber di Visual Studio (mis. C #)</a></li>
<li><a href="../id461127/index.html">Analisis kinerja VM di VMware vSphere. Bagian 3: Penyimpanan</a></li>
<li><a href="../id461129/index.html">Tentang kote, istri, dua putra, ide ... dan tidak hanya. Cerita dengan kelanjutan</a></li>
<li><a href="../id461131/index.html">Truk kereta ROS Bagian 2. Perangkat lunak</a></li>
<li><a href="../id461133/index.html">Menguji kode SQL Server dengan tSQLt</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>