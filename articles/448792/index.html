<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üòÇ üë©üèº‚Äçüè≠ üëª Prueba de Python con pytest. Accesorios incorporados, Cap√≠tulo 4 üë©üèæ‚Äçüîß üîΩ üòº</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Atr√°s Siguiente 


 Los accesorios incorporados que vienen con pytest pueden ayudarlo a hacer algunas cosas bastante √∫tiles en sus pruebas de manera f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Prueba de Python con pytest. Accesorios incorporados, Cap√≠tulo 4</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/448792/"><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atr√°s</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p><br><p>  <em>Los accesorios incorporados que vienen con pytest pueden ayudarlo a hacer algunas cosas bastante √∫tiles en sus pruebas de manera f√°cil y natural.</em>  <em>Por ejemplo, adem√°s de manejar archivos temporales, pytest incluye accesorios incorporados para acceder a los par√°metros de la l√≠nea de comandos, comunicaci√≥n entre sesiones de prueba, verificaci√≥n de flujos de salida, cambio de variables de entorno y alertas de sondeo.</em> </p><br><p><img src="https://habrastorage.org/webt/hd/--/9w/hd--9w134j0rxhmxftrflbbdopy.png"></p><a name="habracut"></a><br><blockquote> El c√≥digo fuente para el proyecto Tareas, as√≠ como para todas las pruebas que se muestran en este libro, est√° disponible en el <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest/source_code">enlace</a> en la p√°gina web del libro en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest">pragprog.com</a> .  No necesita descargar el c√≥digo fuente para comprender el c√≥digo de prueba;  El c√≥digo de prueba se presenta de forma conveniente en los ejemplos.  Pero para seguir las tareas del proyecto, o adaptar ejemplos de prueba para verificar su propio proyecto (¬°sus manos est√°n desatadas!), Debe ir a la p√°gina web del libro para descargar el trabajo.  All√≠, en la p√°gina web del libro, hay un enlace a la publicaci√≥n de <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://pragprog.com/titles/bopytest/errata">erratas</a> y al <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=" title="https://forums.pragprog.com/forums/438">foro de discusi√≥n</a> . </blockquote><p>  Debajo del spoiler hay una lista de art√≠culos en esta serie. </p><br><div class="spoiler">  <b class="spoiler_title">Tabla de contenidos</b> <div class="spoiler_text"><ul><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Introduccion</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 1: comenzando con pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 2: Funciones de prueba de escritura</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 3: accesorios de Pytest</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 4: Accesorios incorporados</strong></a> (este art√≠culo) </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 5: Complementos</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 6: Configuraci√≥n</strong></a> </li><li>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><strong>Cap√≠tulo 7: Uso de pytest con otras herramientas</strong></a> </li></ul></div></div><br><p>  En el cap√≠tulo anterior, examin√≥ qu√© son los accesorios, c√≥mo escribirlos y c√≥mo usarlos para los datos de prueba, as√≠ como para el c√≥digo de configuraci√≥n y desmontaje. </p><br><p> Tambi√©n us√≥ conftest.py para compartir accesorios entre pruebas en m√∫ltiples archivos de prueba.  Al final del cap√≠tulo 3, se instalaron los siguientes accesorios en los accesorios de Pytest en la p√°gina 49 del proyecto Tareas: <code>tasks_db_session</code> , <code>tasks_just_a_few</code> , <code>tasks_mult_per_owner</code> , <code>tasks_db</code> , <code>db_with_3_tasks</code> y <code>db_with_multi_per_owner</code> definido en conftest.py funci√≥n que puede ser utilizada por cualquier funci√≥n testtest que puede ser utilizada por cualquier funci√≥n testtest que pueda ser utilizada por cualquier funci√≥n de prueba los necesita </p><br><p>  La reutilizaci√≥n de accesorios regulares es una idea tan buena que los desarrolladores de pytest han incluido algunos accesorios com√∫nmente requeridos en pytest.  Ya ha visto c√≥mo tmpdir y tmpdir_factory son utilizados por el proyecto Tareas en la secci√≥n de cambio de alcance para los accesorios del proyecto Tareas en la p√°gina 59. Los discutir√° con m√°s detalle en este cap√≠tulo. </p><br><p>  Los accesorios incorporados que vienen con pytest pueden ayudarlo a hacer algunas cosas bastante √∫tiles en sus pruebas de manera f√°cil y natural.  Por ejemplo, adem√°s de manejar archivos temporales, pytest incluye accesorios incorporados para acceder a los par√°metros de la l√≠nea de comandos, comunicaci√≥n entre sesiones de prueba, verificaci√≥n de flujos de salida, cambio de variables de entorno y alertas de sondeo.  Los accesorios incorporados son extensiones de la funcionalidad central de pytest.  Veamos ahora algunos de los accesorios en l√≠nea m√°s utilizados en orden. </p><br><h2 id="ispolzovanie-tmpdir-i-tmpdir_factory">  Usando tmpdir y tmpdir_factory </h2><br><p>  Si est√° probando algo que lee, escribe o modifica archivos, puede usar tmpdir para crear archivos o directorios utilizados por una sola prueba, y puede usar <code>tmpdir_factory</code> cuando desee configurar un directorio para varias pruebas. </p><br><p>  El <code>tmpdir</code> tmpdir tiene un alcance de funci√≥n y el dispositivo <code>tmpdir_factory</code> tiene un alcance de sesi√≥n.  Cualquier prueba individual que requiera un directorio o archivo temporal para una sola prueba puede usar <code>tmpdir</code> .  Esto tambi√©n es cierto para los dispositivos, que personalizan el directorio o archivo que debe recrearse para cada funci√≥n de prueba. </p><br><p>  Aqu√≠ hay un ejemplo simple usando <code>tmpdir</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>ch4/test_tmpdir.py</code></a> </blockquote> <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_tmpdir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpdir)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># tmpdir    ,    # join()  ,    , #     a_file = tmpdir.join('something.txt') #    a_sub_dir = tmpdir.mkdir('anything') #      (  ) another_file = a_sub_dir.join('something_else.txt') #    'something.txt' a_file.write('contents may settle during shipping') #    'anything/something_else.txt' another_file.write('something different') #      assert a_file.read() == 'contents may settle during shipping' assert another_file.read() == 'something different'</span></span></code> </pre> <br><p>  El valor devuelto por <code>tmpdir</code> es un objeto de tipo <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u="><code>py.path.local.1</code></a> que parece ser todo lo que necesitamos para directorios y archivos temporales.  Sin embargo, hay un truco.  Dado que el dispositivo <code>tmpdir</code> define como un <em>alcance de funci√≥n</em> , <code>tmpdir</code> no se puede utilizar para crear carpetas o archivos que deben estar disponibles durante m√°s de una funci√≥n de prueba.  Para dispositivos con un alcance que no sea una funci√≥n (clase, m√≥dulo, sesi√≥n), <code>tmpdir_factory</code> est√° disponible. </p><br><p>  El <code>tmpdir_factory</code> tmpdir_factory <code>tmpdir_factory</code> muy similar a <code>tmpdir</code> , pero tiene una interfaz diferente.  Como se describe en la secci√≥n ‚ÄúEspecificaci√≥n del dispositivo de alcance‚Äù, en la p√°gina 56, los dispositivos de √°rea de funci√≥n se ejecutan una vez para cada funci√≥n de prueba, los dispositivos de regi√≥n de m√≥dulo se ejecutan una vez por m√≥dulo, los dispositivos de clase una vez para cada clase y las pruebas de validaci√≥n de √°rea trabajar una vez por sesi√≥n.  Por lo tanto, los recursos creados en los registros del √°rea de sesi√≥n tienen una vida √∫til de toda la sesi√≥n.  Para mostrar cu√°n similares son <code>tmpdir</code> y <code>tmpdir_factory</code> , <code>tmpdir</code> ejemplo de <code>tmpdir</code> , donde <code>tmpdir_factory</code> : </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / test_tmpdir.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_tmpdir_factory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpdir_factory)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#      . a_dir   # ,    tmpdir a_dir = tmpdir_factory.mktemp('mydir') # base_temp    'mydir'    #  getbasetemp(),  # ,    base_temp = tmpdir_factory.getbasetemp() print('base:', base_temp) #       , #    ' test_tmpdir ()',   , #    a_dir  tmpdir a_file = a_dir.join('something.txt') a_sub_dir = a_dir.mkdir('anything') another_file = a_sub_dir.join('something_else.txt') a_file.write('contents may settle during shipping') another_file.write('something different') assert a_file.read() == 'contents may settle during shipping' assert another_file.read() == 'something different'</span></span></code> </pre> <br><p>  La primera l√≠nea usa <code>mktemp('mydir')</code> para crear el directorio y lo almacena en <code>a_dir</code> .  Para el resto de la funci√≥n, puede usar <code>a_dir</code> de la misma manera que <code>tmpdir</code> regres√≥ del <code>tmpdir</code> . </p><br><p>  En la segunda l√≠nea del ejemplo <code>tmpdir_factory</code> , la funci√≥n <code>getbasetemp()</code> devuelve el directorio base utilizado para esta sesi√≥n.  La declaraci√≥n de <em>impresi√≥n</em> en el ejemplo es necesaria para que pueda ver el directorio en su sistema.  Veamos d√≥nde est√°: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /path/to/code/ch4 $ pytest -q -s test_tmpdir.py::test_tmpdir_factory base: /private/var/folders/53/zv4j_zc506x2xq25l31qxvxm0000gn/T/pytest-of-okken/pytest-732 . 1 passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.04 seconds</code> </pre> <br><p>  Este directorio base depende del sistema y del usuario, y <code>pytest - NUM</code> cambia para cada sesi√≥n con <code>NUM</code> creciente.  El directorio base se deja solo despu√©s de la sesi√≥n.  pytest lo limpia, y solo quedan los pocos directorios base temporales m√°s recientes en el sistema, lo cual est√° bien si est√° impaciente por revisar los archivos despu√©s de una ejecuci√≥n de prueba. </p><br><p>  Tambi√©n puede especificar su propio directorio base si lo necesita con <code>pytest --basetemp=mydir</code> . </p><br><h3 id="ispolzovanie-vremennyh-katalogov-dlya-drugih-oblastey">  Uso de directorios temporales para otras √°reas. </h3><br><p>  Obtenemos directorios temporales y archivos de √°rea de <strong>sesi√≥n</strong> del <code>tmpdir_factory</code> , y directorios de <strong>funciones</strong> y archivos de regi√≥n del <code>tmpdir</code> .  ¬øPero qu√© hay de otras √°reas?  ¬øQu√© sucede si necesitamos un directorio temporal del alcance de un m√≥dulo o clase?  Para hacer esto, creamos otro dispositivo de la regi√≥n del tama√±o deseado y para esto debemos usar <code>tmpdir_factory</code> . </p><br><p>  Por ejemplo, supongamos que tenemos un m√≥dulo lleno de pruebas, y muchas de ellas deber√≠an poder leer algunos datos de un archivo <em>json</em> .  Pudimos colocar el dispositivo de volumen del dispositivo en el m√≥dulo mismo o en el archivo <em>conftest.py</em> , que configura el archivo de datos de la siguiente manera: </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / autores / conftest.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Demonstrate tmpdir_factory."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest @pytest.fixture(scope=<span class="hljs-string"><span class="hljs-string">'module'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">author_file_json</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpdir_factory)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     ."""</span></span> python_author_data = { <span class="hljs-string"><span class="hljs-string">'Ned'</span></span>: {<span class="hljs-string"><span class="hljs-string">'City'</span></span>: <span class="hljs-string"><span class="hljs-string">'Boston'</span></span>}, <span class="hljs-string"><span class="hljs-string">'Brian'</span></span>: {<span class="hljs-string"><span class="hljs-string">'City'</span></span>: <span class="hljs-string"><span class="hljs-string">'Portland'</span></span>}, <span class="hljs-string"><span class="hljs-string">'Luciano'</span></span>: {<span class="hljs-string"><span class="hljs-string">'City'</span></span>: <span class="hljs-string"><span class="hljs-string">'Sau Paulo'</span></span>} } file = tmpdir_factory.mktemp(<span class="hljs-string"><span class="hljs-string">'data'</span></span>).join(<span class="hljs-string"><span class="hljs-string">'author_file.json'</span></span>) print(<span class="hljs-string"><span class="hljs-string">'file:{}'</span></span>.format(str(file))) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> file.open(<span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: json.dump(python_author_data, f) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file</code> </pre> <br><p>  El <code>author_file_json()</code> crea un directorio temporal llamado <em>data</em> y crea un archivo llamado <em>author_file.json</em> en el directorio de datos.  Luego escribe el diccionario <code>python_author_data</code> como <em>json</em> .  Como se trata de un m√≥dulo de √°rea de fijaci√≥n, se crear√° un archivo json solo una vez para cada m√≥dulo utilizando la prueba: </p><br><blockquote>  <strong>ch4 / autores / test_authors.py</strong> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">""" ,    ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_brian_in_portland</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(author_file_json)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""",   ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> author_file_json.open() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: authors = json.load(f) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> authors[<span class="hljs-string"><span class="hljs-string">'Brian'</span></span>][<span class="hljs-string"><span class="hljs-string">'City'</span></span>] == <span class="hljs-string"><span class="hljs-string">'Portland'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_all_have_cities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(author_file_json)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""        ."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> author_file_json.open() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: authors = json.load(f) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> authors: <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(authors[a][<span class="hljs-string"><span class="hljs-string">'City'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Ambas pruebas utilizar√°n el mismo archivo JSON.  Si un archivo de datos de prueba funciona para varias pruebas, no tiene sentido volver a crearlo para ambas pruebas. </p><br><h2 id="ispolzovanie-pytestconfig">  Usando pytestconfig </h2><br><p>  Usando el accesorio incorporado pytestconfig, puede controlar c√≥mo funciona pytest con argumentos y opciones de l√≠nea de comandos, archivos de configuraci√≥n, complementos y el directorio desde el que inici√≥ pytest.  El dispositivo pytestconfig es un acceso directo a request.config, y en la documentaci√≥n de pytest a veces se lo denomina " <em>el objeto de configuraci√≥n pytest</em> " (objeto de configuraci√≥n pytest). </p><br><p>  Para saber c√≥mo funciona <em>pytestconfig</em> , puede ver c√≥mo agregar un par√°metro de l√≠nea de comando personalizado y leer el valor del par√°metro de la prueba.  Puede leer el valor de los par√°metros de la l√≠nea de comandos directamente desde pytestconfig, pero para agregar un par√°metro y analizarlo, debe agregar una funci√≥n de enlace.  Las funciones de enlace, que describo con m√°s detalle en el Cap√≠tulo 5, "Complementos", en la p√°gina 95, son otra forma de controlar el comportamiento de pytest y a menudo se utilizan en complementos.  Sin embargo, agregar una opci√≥n de l√≠nea de comando personalizada y leerlo desde <em>pytestconfig est√°</em> bastante extendido, por lo que quiero cubrir esto aqu√≠. </p><br><p>  Utilizaremos el <em>enlace pytest</em> <code>pytest_addoption</code> para agregar varios par√°metros a los par√°metros ya disponibles en la l√≠nea de comando pytest: </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / pytestconfig / conftest.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pytest_addoption</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parser)</span></span></span><span class="hljs-function">:</span></span> parser.addoption(<span class="hljs-string"><span class="hljs-string">"--myopt"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store_true"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"some boolean option"</span></span>) parser.addoption(<span class="hljs-string"><span class="hljs-string">"--foo"</span></span>, action=<span class="hljs-string"><span class="hljs-string">"store"</span></span>, default=<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, help=<span class="hljs-string"><span class="hljs-string">"foo: bar or baz"</span></span>)</code> </pre> <br><p>  La adici√≥n de par√°metros de l√≠nea de comando a trav√©s de <code>pytest_addoption</code> debe hacerse a trav√©s de complementos o en el archivo <strong>conftest.py</strong> ubicado en la parte superior de la estructura del directorio del proyecto.  No debe hacer esto en el subdirectorio de prueba. </p><br><p>  Las <code>--myopt</code> y <code>--foo &lt;value&gt;</code> se agregaron al c√≥digo anterior, y la l√≠nea de ayuda se cambi√≥ como se muestra a continuaci√≥n: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /path/to/code/ch4/pytestconfig $ pytest --<span class="hljs-built_in"><span class="hljs-built_in">help</span></span> usage: pytest [options] [file_or_dir] [file_or_dir] [...] ... custom options: --myopt some boolean option --foo=FOO foo: bar or baz ...</code> </pre> <br><p>  Ahora podemos acceder a estas opciones desde la prueba: </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / pytestconfig / test_config.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_option</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pytestconfig)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'"foo" set to:'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'foo'</span></span>)) print(<span class="hljs-string"><span class="hljs-string">'"myopt" set to:'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'myopt'</span></span>))</code> </pre> <br><p>  Veamos c√≥mo funciona: </p><br><pre> <code class="bash hljs">$ pytest -s -q test_config.py::test_option <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to: bar <span class="hljs-string"><span class="hljs-string">"myopt"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to: False .1 passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.01 seconds $ pytest -s -q --myopt test_config.py::test_option <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to: bar <span class="hljs-string"><span class="hljs-string">"myopt"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to: True .1 passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.01 seconds $ pytest -s -q --myopt --foo baz test_config.py::test_option <span class="hljs-string"><span class="hljs-string">"foo"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to: baz <span class="hljs-string"><span class="hljs-string">"myopt"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to: True .1 passed <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.01 seconds</code> </pre> <br><p>  Dado que pytestconfig es un accesorio, tambi√©n se puede obtener de otros accesorios.  Puede hacer accesorios para nombres de opciones si lo desea, por ejemplo: </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / pytestconfig / test_config.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture() def foo(pytestconfig): return pytestconfig.option.foo @pytest.fixture() def myopt(pytestconfig): return pytestconfig.option.myopt def test_fixtures_for_options(foo, myopt): print('"foo" set to:', foo) print('"myopt" set to:', myopt)</span></span></code> </pre> <br><p>  Tambi√©n puede acceder a los par√°metros integrados, no solo a los agregados, as√≠ como a informaci√≥n sobre c√≥mo se lanz√≥ pytest (directorio, argumentos, etc.). </p><br><p>  Aqu√≠ hay un ejemplo de varios valores y opciones de configuraci√≥n: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_pytestconfig</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pytestconfig)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'args :'</span></span>, pytestconfig.args) print(<span class="hljs-string"><span class="hljs-string">'inifile :'</span></span>, pytestconfig.inifile) print(<span class="hljs-string"><span class="hljs-string">'invocation_dir :'</span></span>, pytestconfig.invocation_dir) print(<span class="hljs-string"><span class="hljs-string">'rootdir :'</span></span>, pytestconfig.rootdir) print(<span class="hljs-string"><span class="hljs-string">'-k EXPRESSION :'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'keyword'</span></span>)) print(<span class="hljs-string"><span class="hljs-string">'-v, --verbose :'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'verbose'</span></span>)) print(<span class="hljs-string"><span class="hljs-string">'-q, --quiet :'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'quiet'</span></span>)) print(<span class="hljs-string"><span class="hljs-string">'-l, --showlocals:'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'showlocals'</span></span>)) print(<span class="hljs-string"><span class="hljs-string">'--tb=style :'</span></span>, pytestconfig.getoption(<span class="hljs-string"><span class="hljs-string">'tbstyle'</span></span>))</code> </pre> <br><p>  Volveremos a pytestconfig cuando demuestre los archivos ini en el cap√≠tulo 6, "Configuraci√≥n", en la p√°gina 113. </p><br><h2 id="using-cache">  Usando cach√© </h2><br><p>  Por lo general, los evaluadores creemos que cada prueba es lo m√°s independiente posible de las otras pruebas.  Debe asegurarse de que las dependencias de la contabilidad de pedidos no se hayan infiltrado.  Me gustar√≠a poder ejecutar o reiniciar cualquier prueba en cualquier orden y obtener el mismo resultado.  Adem√°s, las sesiones de prueba deben ser repetibles y no cambiar el comportamiento seg√∫n las sesiones de prueba anteriores. </p><br><p>  Sin embargo, a veces transferir informaci√≥n de una sesi√≥n de prueba a otra puede ser muy √∫til.  Cuando queremos pasar informaci√≥n a futuras sesiones de prueba, podemos hacerlo con el dispositivo de <code>cache</code> incorporado. </p><br><p>  Fixture <code>cache</code> dise√±ado para almacenar informaci√≥n sobre una sesi√≥n de prueba y obtenerla en la siguiente.  Un gran ejemplo de uso de permisos de <code>cache</code> para el beneficio del caso es la funcionalidad <code>--last-failed</code> <code>--failed-first</code> y <code>--failed-first</code> .  Veamos c√≥mo se almacenan los datos de estos indicadores en la memoria cach√©. </p><br><p>  Aqu√≠ est√° el texto de ayuda para las <code>--last-failed</code> <code>--failed-first</code> y <code>--failed-first</code> , as√≠ como algunas opciones de <code>cache</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --help ... --lf, --last-failed rerun only the tests that failed at the last run (or all if none failed) --ff, --failed-first run all tests but run the last failures first. This may re-order tests and thus lead to repeated fixture setup/teardown --cache-show show cache contents, don t perform collection or tests --cache-clear remove all cache contents at start of test run. ...</code> </pre> <br><p>  Para verlos en acci√≥n, utilizaremos estas dos pruebas: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=http://">ch4 / cache / test_pass_fail.py</a> </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_this_passes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_this_fails</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> == <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br><p>  <code>--tb=no</code> usando <code>--verbose</code> para ver los nombres de las funciones, y <code>--tb=no</code> para ocultar el seguimiento de la pila: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch4/cache $ pytest --verbose --tb=no test_pass_fail.py ==================== test session starts ==================== collected 2 items test_pass_fail.py::test_this_passes PASSED test_pass_fail.py::test_this_fails FAILED ============ 1 failed, 1 passed in 0.05 seconds =============</code> </pre> <br><p>  Si los vuelve a ejecutar con el <code>--ff</code> o <code>--failed-first</code> , las pruebas que fallaron anteriormente se ejecutar√°n primero y luego toda la sesi√≥n: </p><br><pre> <code class="plaintext hljs">$ pytest --verbose --tb=no --ff test_pass_fail.py ==================== test session starts ==================== run-last-failure: rerun last 1 failures first collected 2 items test_pass_fail.py::test_this_fails FAILED test_pass_fail.py::test_this_passes PASSED ============ 1 failed, 1 passed in 0.04 seconds =============</code> </pre> <br><p>  O puede usar <code>--lf</code> o <code>--last-failed</code> para ejecutar pruebas que fallaron la √∫ltima vez: </p><br><pre> <code class="plaintext hljs">$ pytest --verbose --tb=no --lf test_pass_fail.py ==================== test session starts ==================== run-last-failure: rerun last 1 failures collected 2 items test_pass_fail.py::test_this_fails FAILED ==================== 1 tests deselected ===================== ========== 1 failed, 1 deselected in 0.05 seconds ===========</code> </pre> <br><p>  Antes de ver c√≥mo se almacenan los datos de bloqueo y c√≥mo puede usar el mismo mecanismo, veamos otro ejemplo que hace que el valor de <code>--lf</code> y <code>--ff</code> a√∫n m√°s obvio. </p><br><p>  Aqu√≠ hay una prueba parametrizada con una falla: </p><br><blockquote>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / cache / test_few_failures.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">"""Demonstrate -lf and -ff with failing tests."""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> approx testdata = [ <span class="hljs-comment"><span class="hljs-comment"># x, y, expected (1.01, 2.01, 3.02), (1e25, 1e23, 1.1e25), (1.23, 3.21, 4.44), (0.1, 0.2, 0.3), (1e25, 1e24, 1.1e25) ] @pytest.mark.parametrize("x,y,expected", testdata) def test_a(x, y, expected): """Demo approx().""" sum_ = x + y assert sum_ == approx(expected)</span></span></code> </pre> <br><p>  Y a la salida: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch4/cache $ pytest -q test_few_failures.py .F... ====================== FAILURES ====================== _________________________ test_a[1e+25-1e+23-1.1e+25] _________________________ x = 1e+25, y = 1e+23, expected = 1.1e+25 @pytest.mark.parametrize("x,y,expected", testdata) def test_a(x, y, expected): """Demo approx().""" sum_ = x + y &gt; assert sum_ == approx(expected) E assert 1.01e+25 == 1.1e+25 ¬± 1.1e+19 E + where 1.1e+25 ¬± 1.1e+19 = approx(1.1e+25) test_few_failures.py:17: AssertionError 1 failed, 4 passed in 0.06 seconds</code> </pre> <br><p>  Quiz√°s pueda identificar el problema de inmediato.  Pero imaginemos que la prueba es m√°s larga y m√°s complicada, y no es tan obvio lo que est√° mal aqu√≠.  Ejecutemos la prueba nuevamente para ver el error nuevamente.  El caso de prueba se puede especificar en la l√≠nea de comando: </p><br><pre> <code class="plaintext hljs">$ pytest -q "test_few_failures.py::test_a[1e+25-1e+23-1.1e+25]"</code> </pre> <br><p>  Si no desea copiar-pegar <em>(copiar / pegar</em> ) o hay varios casos desafortunados que desea reiniciar, entonces <code>--lf</code> mucho m√°s f√°cil.  Y si realmente est√° depurando una falla de prueba, otro indicador que puede aliviar la situaci√≥n es <code>--showlocals</code> , o <code>-l</code> para abreviar: </p><br><pre> <code class="plaintext hljs">$ pytest -q --lf -l test_few_failures.py F ====================== FAILURES ====================== _________________________ test_a[1e+25-1e+23-1.1e+25] _________________________ x = 1e+25, y = 1e+23, expected = 1.1e+25 @pytest.mark.parametrize("x,y,expected", testdata) def test_a(x, y, expected): """Demo approx().""" sum_ = x + y &gt; assert sum_ == approx(expected) E assert 1.01e+25 == 1.1e+25 ¬± 1.1e+19 E + where 1.1e+25 ¬± 1.1e+19 = approx(1.1e+25) expected = 1.1e+25 sum_ = 1.01e+25 x = 1e+25 y = 1e+23 test_few_failures.py:17: AssertionError ================= 4 tests deselected ================= 1 failed, 4 deselected in 0.05 seconds</code> </pre><br><p>  La raz√≥n del fracaso deber√≠a ser m√°s obvia. </p><br><p>  Para tener en cuenta que la prueba fall√≥ la √∫ltima vez, hay un peque√±o truco.  pytest almacena informaci√≥n de error de prueba de la √∫ltima sesi√≥n de prueba y puede ver la informaci√≥n guardada con <code>--cache-show</code> : </p><br><pre> <code class="plaintext hljs">$ pytest --cache-show ===================== test session starts ====================== ------------------------- cache values ------------------------- cache/lastfailed contains: {'test_few_failures.py::test_a[1e+25-1e+23-1.1e+25]': True} ================= no tests ran in 0.00 seconds =================</code> </pre> <br><p>  O puede buscar en el directorio de cach√©: </p><br><pre> <code class="plaintext hljs">$ cat .cache/v/cache/lastfailed { "test_few_failures.py::test_a[1e+25-1e+23-1.1e+25]": true }</code> </pre> <br><p>  El interruptor <code>--clear-cache</code> permite borrar el cach√© antes de una sesi√≥n. </p><br><p>  El cach√© se puede usar no solo para <code>--lf</code> y <code>--ff</code> .  Escribamos un dispositivo que registre cu√°nto tiempo toman las pruebas, ahorra tiempo y la pr√≥xima vez que informa un error en las pruebas que toman el doble de tiempo que, por ejemplo, la √∫ltima vez. </p><br><p>  La interfaz para el dispositivo de cach√© es simple. </p><br><pre> <code class="plaintext hljs">cache.get(key, default) cache.set(key, value)</code> </pre> <br><p>  Por convenci√≥n, los nombres de clave comienzan con el nombre de su aplicaci√≥n o complemento, seguidos de <code>/</code> , y contin√∫an separando las secciones de nombre de clave con <code>/</code> .  El valor que almacena puede ser cualquiera que se convierta a <em>json</em> , ya que est√° representado en el <code>.cache directory</code> . </p><br><p>  Aqu√≠ est√° nuestro dispositivo utilizado para fijar el tiempo de prueba: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / cache / test_slower.py</a> </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.fixture(autouse=True) def check_duration(request, cache): key = 'duration/' + request.node.nodeid.replace(':', '_') #   (nodeid)    #      .cache #    -     start_time = datetime.datetime.now() yield stop_time = datetime.datetime.now() this_duration = (stop_time - start_time).total_seconds() last_duration = cache.get(key, None) cache.set(key, this_duration) if last_duration is not None: errorstring = "       2-  " assert this_duration &lt;= last_duration * 2, errorstring</span></span></code> </pre> <br><p>  Como el dispositivo es de uso <em>autom√°tico</em> , no es necesario hacer referencia a √©l desde la prueba.  El objeto de <em>solicitud</em> se usa para obtener el <em>nodeid</em> para usar en la clave.  <em>nodeid</em> es un identificador √∫nico que funciona incluso con pruebas parametrizadas.  Agregamos una clave con 'duraci√≥n /' para ser residentes respetables del cach√©.  El c√≥digo anterior <em>rendimiento</em> se ejecuta antes de la funci√≥n de prueba;  el c√≥digo despu√©s del <em>rendimiento</em> se ejecuta despu√©s de la funci√≥n de prueba. </p><br><p>  Ahora necesitamos algunas pruebas que tomen diferentes intervalos de tiempo: </p><br><p>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4 / cache / test_slower.py</a> </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@pytest.mark.parametrize('i', range(5)) def test_slow_stuff(i): time.sleep(random.random())</span></span></code> </pre> <br><p>  Dado que probablemente no desee escribir un mont√≥n de pruebas para esto, utilic√© <code>random</code> y parametrizaci√≥n para generar f√°cilmente algunas pruebas que duermen durante un per√≠odo de tiempo aleatorio, todo menos de un segundo.  Veamos un par de veces c√≥mo funciona esto: </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch4/cache $ pytest -q --cache-clear test_slower.py ..... 5 passed in 2.10 seconds $ pytest -q --tb=line test_slower.py ...E..E =================================== ERRORS ==================================== ___________________ ERROR at teardown of test_slow_stuff[1] ___________________ E AssertionError: test duration over 2x last duration assert 0.35702 &lt;= (0.148009 * 2) ___________________ ERROR at teardown of test_slow_stuff[4] ___________________ E AssertionError: test duration over 2x last duration assert 0.888051 &lt;= (0.324019 * 2) 5 passed, 2 error in 3.17 seconds</code> </pre> <br><p>  Bueno, eso fue divertido.  Veamos qu√© hay en el cach√©: </p><br><pre> <code class="plaintext hljs">$ pytest -q --cache-show -------------------------------- cache values --------------------------------- cache\lastfailed contains: {'test_slower.py::test_slow_stuff[2]': True, 'test_slower.py::test_slow_stuff[4]': True} cache\nodeids contains: ['test_slower.py::test_slow_stuff[0]', 'test_slower.py::test_slow_stuff[1]', 'test_slower.py::test_slow_stuff[2]', 'test_slower.py::test_slow_stuff[3]', 'test_slower.py::test_slow_stuff[4]'] cache\stepwise contains: [] duration\test_slower.py__test_slow_stuff[0] contains: 0.958055 duration\test_slower.py__test_slow_stuff[1] contains: 0.214012 duration\test_slower.py__test_slow_stuff[2] contains: 0.19001 duration\test_slower.py__test_slow_stuff[3] contains: 0.725041 duration\test_slower.py__test_slow_stuff[4] contains: 0.836048 no tests ran in 0.03 seconds</code> </pre> <br><p>  Puede ver f√°cilmente los datos de <code>duration</code> separado de los datos de cach√© debido al prefijo de los nombres de datos de cach√©.  Sin embargo, es interesante que la <code>lastfailed</code> funcionalidad <code>lastfailed</code> pueda funcionar con una sola entrada de cach√©.  Nuestros datos de duraci√≥n ocupan una entrada de cach√© para cada prueba.  Sigamos el √∫ltimo ejemplo fallido y pongamos nuestros datos en un registro. </p><br><p>  Leemos y almacenamos en cach√© para cada prueba.  Podemos dividir el dispositivo en el dispositivo del alcance de la funci√≥n para medir la duraci√≥n y el dispositivo del alcance de la sesi√≥n para leer y escribir en el cach√©.  Sin embargo, si hacemos esto, no podremos usar el dispositivo de cach√© porque tiene el alcance de la funci√≥n.  Afortunadamente, un vistazo r√°pido a la implementaci√≥n en <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">GitHub</a> muestra que el dispositivo de almacenamiento en cach√© solo devuelve <code>request.config.cache</code> .  Est√° disponible en cualquier √°rea. </p><br><p>          : </p><br><p> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/cache/test_slower_2.py</a> </p><br><pre> <code class="python hljs">Duration = namedtuple(<span class="hljs-string"><span class="hljs-string">'Duration'</span></span>, [<span class="hljs-string"><span class="hljs-string">'current'</span></span>, <span class="hljs-string"><span class="hljs-string">'last'</span></span>]) @pytest.fixture(scope=<span class="hljs-string"><span class="hljs-string">'session'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration_cache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> key = <span class="hljs-string"><span class="hljs-string">'duration/testdurations'</span></span> d = Duration({}, request.config.cache.get(key, {})) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> d request.config.cache.set(key, d.current) @pytest.fixture(autouse=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_duration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request, duration_cache)</span></span></span><span class="hljs-function">:</span></span> d = duration_cache nodeid = request.node.nodeid start_time = datetime.datetime.now() <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> duration = (datetime.datetime.now() - start_time).total_seconds() d.current[nodeid] = duration <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> d.last.get(nodeid, <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: errorstring = <span class="hljs-string"><span class="hljs-string">"test duration over 2x last duration"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> duration &lt;= (d.last[nodeid] * <span class="hljs-number"><span class="hljs-number">2</span></span>), errorstring</code> </pre> <br><p>  <code>duration_cache</code>   .       ,     ,    - .        ,     <code>namedtuple</code>  <em>Duration</em>    <code>current</code>  <code>last</code> .     <code>namedtuple</code>  <code>test_duration</code> ,         .    ,   <code>namedtuple</code>    ,         <code>d.current</code> .          . </p><br><p>     ,     : </p><br><pre> <code class="plaintext hljs">$ pytest -q --cache-clear test_slower_2.py ..... 5 passed in 2.80 seconds $ pytest -q --tb=no test_slower_2.py ...EE.. 7 passed, 2 error in 3.21 seconds $ pytest -q --cache-show -------------------------------- cache values --------------------------------- cache\lastfailed contains: {'test_slower_2.py::test_slow_stuff[2]': True, 'test_slower_2.py::test_slow_stuff[3]': True} duration\testdurations contains: {'test_slower_2.py::test_slow_stuff[0]': 0.483028, 'test_slower_2.py::test_slow_stuff[1]': 0.198011, 'test_slower_2.py::test_slow_stuff[2]': 0.426024, 'test_slower_2.py::test_slow_stuff[3]': 0.762044, 'test_slower_2.py::test_slow_stuff[4]': 0.056003, 'test_slower_2.py::test_slow_stuff[5]': 0.18401, 'test_slower_2.py::test_slow_stuff[6]': 0.943054} no tests ran in 0.02 seconds</code> </pre> <br><p>  . </p><br><h2 id="ispolzovanie-capsys">  capsys </h2><br><p>  <code>capsys builtin</code>    :   stdout  stderr   ,     .     stdout  stderr. </p><br><p> ,         stdout: </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/cap/test_capsys.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">greeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'Hi, {}'</span></span>.format(name))</code> </pre> <br><p>     ,   .   -  stdout.       capsys: </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/cap/test_capsys.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_greeting</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capsys)</span></span></span><span class="hljs-function">:</span></span> greeting(<span class="hljs-string"><span class="hljs-string">'Earthling'</span></span>) out, err = capsys.readouterr() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> out == <span class="hljs-string"><span class="hljs-string">'Hi, Earthling\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> err == <span class="hljs-string"><span class="hljs-string">''</span></span> greeting(<span class="hljs-string"><span class="hljs-string">'Brian'</span></span>) greeting(<span class="hljs-string"><span class="hljs-string">'Nerd'</span></span>) out, err = capsys.readouterr() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> out == <span class="hljs-string"><span class="hljs-string">'Hi, Brian\nHi, Nerd\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> err == <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br><p>  <code>stdout</code>  <code>stderr</code>   <code>capsys.redouterr()</code> .   ‚Äî  ,      ,     . </p><br><p>      <code>stdout</code> .    ,   <code>stderr</code> : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yikes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(problem)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'YIKES! {}'</span></span>.format(problem), file=sys.stderr) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_yikes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capsys)</span></span></span><span class="hljs-function">:</span></span> yikes(<span class="hljs-string"><span class="hljs-string">'Out of coffee!'</span></span>) out, err = capsys.readouterr() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> out == <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> <span class="hljs-string"><span class="hljs-string">'Out of coffee!'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> err</code> </pre> <br><p> <em>pytest</em>        .     <em>print</em> .            .  <code>-s</code>   ,      stdout    .    ,        ,      .   ,             pytest  ,    ,   .      <em>capsys</em> .    <code>capsys.disabled()</code> ,       . </p><br><p>  Aqu√≠ hay un ejemplo: </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/cap/test_capsys.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_capsys_disabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(capsys)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> capsys.disabled(): print(<span class="hljs-string"><span class="hljs-string">'\nalways print this'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#    print('normal print, usually captured') #  ,  </span></span></code> </pre> <br><p> , <em>'always print this'</em>   : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch4/cap $ pytest -q test_capsys.py::test_capsys_disabled</code> </pre> <br><p>    ,  <code>always print this</code>        ,        <code>capys.disabled()</code> .   print ‚Äî     print,  <code>normal print, usually captured</code> ( ,  ),    ,     <code>-s</code> ,     <code>--capture=no</code> ,   . </p><br><h2 id="ispolzovanie-monkeypatch">  monkeypatch </h2><br><p> "monkey patch" ‚Äî         .    "monkey patching" ‚Äî                ,      ,     .   <code>monkeypatch</code>       .    ,   ,    ,  ,    .    ,       .   API  ,  monkeypatch    . </p><br><p>  <code>monkeypatch</code>   : </p><br><ul><li> <code>setattr(target, name, value=&lt;notset&gt;, raising=True)</code> :  . </li><li> <code>delattr(target, name=&lt;notset&gt;, raising=True)</code> :  . </li><li> <code>setitem(dic, name, value)</code> :    . </li><li> <code>delitem(dic, name, raising=True)</code> :    . </li><li> <code>setenv(name, value, prepend=None)</code> :    . </li><li> <code>delenv(name, raising=True)</code> :   . </li><li> <code>syspath_prepend(path)</code> :    sys.,       Python. </li><li> <code>chdir(path)</code> :    . </li></ul><br><p>  <code>raising</code>  pytest,    ,     .  <code>prepend</code>  <code>setenv()</code>   .   ,        <code>+ prepend + &lt;old value&gt;</code> . </p><br><p>   monkeypatch  ,    ,   dot- .           ,   dot-    .    ,     cheese-  : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/monkey/cheese.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_cheese_preferences</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> full_path = os.path.expanduser(<span class="hljs-string"><span class="hljs-string">'~/.cheese.json'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(full_path, <span class="hljs-string"><span class="hljs-string">'r'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: prefs = json.load(f) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prefs <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_cheese_preferences</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(prefs)</span></span></span><span class="hljs-function">:</span></span> full_path = os.path.expanduser(<span class="hljs-string"><span class="hljs-string">'~/.cheese.json'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> open(full_path, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> f: json.dump(prefs, f, indent=<span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_default_cheese_preferences</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> write_cheese_preferences(_default_prefs) _default_prefs = { <span class="hljs-string"><span class="hljs-string">'slicing'</span></span>: [<span class="hljs-string"><span class="hljs-string">'manchego'</span></span>, <span class="hljs-string"><span class="hljs-string">'sharp cheddar'</span></span>], <span class="hljs-string"><span class="hljs-string">'spreadable'</span></span>: [<span class="hljs-string"><span class="hljs-string">'Saint Andre'</span></span>, <span class="hljs-string"><span class="hljs-string">'camembert'</span></span>, <span class="hljs-string"><span class="hljs-string">'bucheron'</span></span>, <span class="hljs-string"><span class="hljs-string">'goat'</span></span>, <span class="hljs-string"><span class="hljs-string">'humbolt fog'</span></span>, <span class="hljs-string"><span class="hljs-string">'cambozola'</span></span>], <span class="hljs-string"><span class="hljs-string">'salads'</span></span>: [<span class="hljs-string"><span class="hljs-string">'crumbled feta'</span></span>] }</code> </pre> <br><p>  ,      <code>write_default_cheese_preferences()</code> .  ,         .    ,    .        . </p><br><p>      ,          . ,       <code>read_cheese_preferences()</code> ,    ,        <code>write_default_cheese_preferences()</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/monkey/test_cheese.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_def_prefs_full</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> cheese.write_default_cheese_preferences() expected = cheese._default_prefs actual = cheese.read_cheese_preferences() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> expected == actual</code> </pre> <br><p>        ,  ,     ,    cheese- .     . </p><br><p>     <code>HOME set</code> , <code>os.path.expanduser()</code>  <code>~</code> ,       <code>HOME</code> .       <code>HOME</code> ,       : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/monkey/test_cheese.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_def_prefs_change_home</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpdir, monkeypatch)</span></span></span><span class="hljs-function">:</span></span> monkeypatch.setenv(<span class="hljs-string"><span class="hljs-string">'HOME'</span></span>, tmpdir.mkdir(<span class="hljs-string"><span class="hljs-string">'home'</span></span>)) cheese.write_default_cheese_preferences() expected = cheese._default_prefs actual = cheese.read_cheese_preferences() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> expected == actual</code> </pre> <br><p>    ,  <code>HOME</code>      .     -  <code>expanduser()</code> ,     ,    <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">¬´On Windows, HOME and USERPROFILE will be used if set, otherwise a combination of‚Ä¶.¬ª</a>  . !      ,    Windows.  ,     . </p><br><p>  ,     <code>HOME</code> ,   <code>expanduser</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/monkey/test_cheese.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_def_prefs_change_expanduser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpdir, monkeypatch)</span></span></span><span class="hljs-function">:</span></span> fake_home_dir = tmpdir.mkdir(<span class="hljs-string"><span class="hljs-string">'home'</span></span>) monkeypatch.setattr(cheese.os.path, <span class="hljs-string"><span class="hljs-string">'expanduser'</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x.replace(<span class="hljs-string"><span class="hljs-string">'~'</span></span>, str(fake_home_dir)))) cheese.write_default_cheese_preferences() expected = cheese._default_prefs actual = cheese.read_cheese_preferences() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> expected == actual</code> </pre> <br><p>    ,    <em>cheese</em>  <code>os.path.expanduser()</code>     -.         <code>re.sub</code>   <code>~</code>    .    <code>setenv()</code>  <code>setattr()</code>      . , <code>setitem()</code> . </p><br><p> ,   ,  ,    .    ,      ,   <code>write_default_cheese_preferences()</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/monkey/test_cheese.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_def_prefs_change_defaults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(tmpdir, monkeypatch)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#      fake_home_dir = tmpdir.mkdir('home') monkeypatch.setattr(cheese.os.path, 'expanduser', (lambda x: x.replace('~', str(fake_home_dir)))) cheese.write_default_cheese_preferences() defaults_before = copy.deepcopy(cheese._default_prefs) #     monkeypatch.setitem(cheese._default_prefs, 'slicing', ['provolone']) monkeypatch.setitem(cheese._default_prefs, 'spreadable', ['brie']) monkeypatch.setitem(cheese._default_prefs, 'salads', ['pepper jack']) defaults_modified = cheese._default_prefs #       cheese.write_default_cheese_preferences() #    actual = cheese.read_cheese_preferences() assert defaults_modified == actual assert defaults_modified != defaults_before</span></span></code> </pre> <br><p>  <code>_default_prefs</code> - ,    <code>monkeypatch.setitem()</code> ,        . </p><br><p>   <code>setenv()</code> , <code>setattr()</code>  <code>setitem()</code> .  <code>del</code>  .     ,      ,  - .    <code>monkeypatch</code>   . </p><br><p> <code>syspath_prepend(path)</code>    <code>sys.path</code> ,    ,            .          stub-.      <code>monkeypatch.syspath_prepend()</code> ,     ,      stub-. </p><br><p> <code>chdir(path)</code>       .            ,      .        ,      ,    <code>monkeypatch.chdir(the_tmpdir)</code> . </p><br><p>       monkeypatch    <code>unittest.mock</code> ,      .      7 " pytest   "  . 125. </p><br><h2 id="ispolzovanie-doctest_namespace">  doctest_namespace </h2><br><p>  <em>doctest</em>     Python         <em>docstrings</em>   ,  ,   .    pytest      <em>doctest</em>   Python    <code>--doctest-modules</code> .    <code>doctest_namespace</code> ,      <em>autouse</em> ,       <em>pytest</em>     doctest .   docstrings    . </p><br><p> <code>doctest_namespace</code>         ,    Python       . , <code>numpy</code>    <code>import numpy as np</code> . </p><br><p>    . ,       <code>unnecessary_math.py</code>   <code>multiply()</code>  <code>divide()</code> ,    .  ,        docstring ,    docstrings : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/dt/1/unnecessary_math.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">""" This module defines multiply(a, b) and divide(a, b). &gt;&gt;&gt; import unnecessary_math as um Here's how you use multiply: &gt;&gt;&gt; um.multiply(4, 3) 12 &gt;&gt;&gt; um.multiply('a', 3) 'aaa' Here's how you use divide: &gt;&gt;&gt; um.divide(10, 5) 2.0 """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Returns a multiplied by b. &gt;&gt;&gt; um.multiply(4, 3) 12 &gt;&gt;&gt; um.multiply('a', 3) 'aaa' """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * b <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Returns a divided by b. &gt;&gt;&gt; um.divide(10, 5) 2.0 """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a / b</code> </pre><br><p>   <code>unnecessary_math</code> ,    <code>um</code>  ,  <code>import noecessary_math as um</code>   -.   docstrings     <code>import</code> ,     <code>um</code> .   ,  pytest   docstring    .    docstring    ,    docstrings    : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch4/dt/1 $ pytest -v --doctest-modules --tb=short unnecessary_math.py ============================= test session starts ============================= collected 3 items unnecessary_math.py::unnecessary_math PASSED unnecessary_math.py::unnecessary_math.divide FAILED unnecessary_math.py::unnecessary_math.multiply FAILED ================================== FAILURES =================================== ______________________ [doctest] unnecessary_math.divide ______________________ 034 035 Returns a divided by b. 036 037 &gt;&gt;&gt; um.divide(10, 5) UNEXPECTED EXCEPTION: NameError("name 'um' is not defined",) Traceback (most recent call last): ... File "&lt;doctest unnecessary_math.divide[0]&gt;", line 1, in &lt;module&gt; NameError: name 'um' is not defined ... _____________________ [doctest] unnecessary_math.multiply _____________________ 022 023 Returns a multiplied by b. 024 025 &gt;&gt;&gt; um.multiply(4, 3) UNEXPECTED EXCEPTION: NameError("name 'um' is not defined",) Traceback (most recent call last): ... File "&lt;doctest unnecessary_math.multiply[0]&gt;", line 1, in &lt;module&gt; NameError: name 'um' is not defined /path/to/code/ch4/dt/1/unnecessary_math.py:23: UnexpectedException ================ 2 failed, 1 passed in 0.03 seconds =================</code> </pre><br><p>     -  <code>import</code>   docstring: </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/dt/2/unnecessary_math.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-string"><span class="hljs-string">""" This module defines multiply(a, b) and divide(a, b). &gt;&gt;&gt; import unnecessary_math as um Here's how you use multiply: &gt;&gt;&gt; um.multiply(4, 3) 12 &gt;&gt;&gt; um.multiply('a', 3) 'aaa' Here's how you use divide: &gt;&gt;&gt; um.divide(10, 5) 2.0 """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">multiply</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Returns a multiplied by b. &gt;&gt;&gt; import unnecessary_math as um &gt;&gt;&gt; um.multiply(4, 3) 12 &gt;&gt;&gt; um.multiply('a', 3) 'aaa' """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a * b <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(a, b)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" Returns a divided by b. &gt;&gt;&gt; import unnecessary_math as um &gt;&gt;&gt; um.divide(10, 5) 2.0 """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a / b</code> </pre> <br><p>    : </p><br><pre> <code class="plaintext hljs">$ cd /path/to/code/ch4/dt/2 $ pytest -v --doctest-modules --tb=short unnecessary_math.py ============================= test session starts ============================= collected 3 items unnecessary_math.py::unnecessary_math PASSED [ 33%] unnecessary_math.py::unnecessary_math.divide PASSED [ 66%] unnecessary_math.py::unnecessary_math.multiply PASSED [100%] ===================== 3 passed in 0.03 seconds ======================</code> </pre> <br><p>     docstrings        . </p><br><p>   <code>doctest_namespace</code> ,   <code>autouse</code>   <code>conftest.py</code>  ,      : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/dt/3/conftest.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unnecessary_math @pytest.fixture(autouse=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add_um</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(doctest_namespace)</span></span></span><span class="hljs-function">:</span></span> doctest_namespace[<span class="hljs-string"><span class="hljs-string">'um'</span></span>] = unnecessary_math</code> </pre> <br><p>   pytest   <code>um</code>  <code>doctest_namespace</code> ,     <code>unnecessary_math</code> .     conftest.py,  doctests,     conftest.py    <code>um</code> . </p><br><p>     doctest  pytest   7 " pytest   "  . 125. </p><br><h2 id="ispolzovanie-recwarn">  recwarn </h2><br><p>   <code>recwarn</code>    ,   .  Python    ,     ,    ,      . , ,      ,         ,      .             : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/test_warnings.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> warnings <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lame_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> warnings.warn(<span class="hljs-string"><span class="hljs-string">"Please stop using this"</span></span>, DeprecationWarning) <span class="hljs-comment"><span class="hljs-comment"># rest of function</span></span></code> </pre> <br><p>   ,      : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/test_warnings.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_lame_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recwarn)</span></span></span><span class="hljs-function">:</span></span> lame_function() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(recwarn) == <span class="hljs-number"><span class="hljs-number">1</span></span> w = recwarn.pop() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> w.category == DeprecationWarning <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> str(w.message) == <span class="hljs-string"><span class="hljs-string">'Please stop using this'</span></span></code> </pre> <br><p>  recwarn    ,        <code>category</code> (), <code>message</code> (), <code>filename</code> ( )  <code>lineno</code> ( ),    . </p><br><p>      .   ,     ,      ,     .      <code>recwarn.clear()</code> ,     ,      . </p><br><p>    <code>recwarn</code> , pytest      <code>pytest.warns()</code> : </p><br><blockquote> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">ch4/test_warnings.py</a> </blockquote><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_lame_function_2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.warns(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> warning_list: lame_function() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> len(warning_list) == <span class="hljs-number"><span class="hljs-number">1</span></span> w = warning_list.pop() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> w.category == DeprecationWarning <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> str(w.message) == <span class="hljs-string"><span class="hljs-string">'Please stop using this'</span></span></code> </pre> <br><p>   <code>pytest.warns()</code>         .  <code>recwarn</code>    <code>pytest.warns()</code>   ,    ,  ,    . </p><br><h2 id="uprazhneniya">  Ejercicios </h2><br><ol><li>  <code>ch4/cache/test_slower.py</code>   <code>autouse</code> ,  <code>check_duration()</code> .    <code>ch3/tasks_proj/tests/conftest.py</code> . </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Realice las pruebas en el Cap√≠tulo 3. </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Para pruebas realmente muy r√°pidas, 2x realmente r√°pido sigue siendo muy r√°pido. </font><font style="vertical-align: inherit;">En lugar de 2x, cambie el dispositivo para verificar durante 0.1 segundos m√°s 2x para la √∫ltima duraci√≥n.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ejecute pytest con el dispositivo modificado. </font><font style="vertical-align: inherit;">¬øLos resultados parecen razonables?</font></font></li></ol><br><h2 id="chto-dalshe">  Que sigue </h2><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">En este cap√≠tulo, viste algunos de los accesorios de Pytest incorporados. </font><font style="vertical-align: inherit;">A continuaci√≥n, considerar√° los complementos con m√°s detalle. </font><font style="vertical-align: inherit;">Los matices de escribir grandes complementos pueden convertirse en un libro en s√≠ mismos; </font><font style="vertical-align: inherit;">sin embargo, peque√±os complementos personalizados son una parte regular del ecosistema pytest.</font></font></p><br><p><img src="https://habrastorage.org/webt/jl/jn/bb/jljnbbjr-ejh473xy_eccsmknpk.png">  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Atr√°s</a> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">Siguiente</a> <img src="https://habrastorage.org/webt/rw/dy/-g/rwdy-grsvbpcetjttrmecdkxtlk.png"></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/448792/">https://habr.com/ru/post/448792/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448764/index.html">Relojes en ATtiny13</a></li>
<li><a href="../448766/index.html">Cree un monorepository con espacios de trabajo de lerna e hilo</a></li>
<li><a href="../448774/index.html">SQL a CSV usando DBMS_SQL</a></li>
<li><a href="../448776/index.html">RxVMS: una arquitectura pr√°ctica para aplicaciones de flutter</a></li>
<li><a href="../448778/index.html">Presentaci√≥n de la depuraci√≥n de viajes en el tiempo para Visual Studio Enterprise 2019</a></li>
<li><a href="../448794/index.html">Prueba de Python con pytest. Complementos CAP√çTULO 5</a></li>
<li><a href="../448796/index.html">Prueba de Python con pytest. Configuraci√≥n, CAP√çTULO 6</a></li>
<li><a href="../448798/index.html">Prueba de Python con pytest. Usando pytest con otras herramientas, CAP√çTULO 7</a></li>
<li><a href="../448800/index.html">Configure Visual Studio en toda su organizaci√≥n con .vsconfig</a></li>
<li><a href="../448802/index.html">Pensar con portales: crear portales en Unreal Engine 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>