<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>📲 🥀 👐🏼 Trap (terpal) untuk koneksi SSH yang masuk 🖖🏼 👨🏼‍⚖️ 😀</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bukan rahasia lagi bahwa Internet adalah lingkungan yang sangat bermusuhan. Segera setelah Anda mengangkat server, server langsung mengalami serangan ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Trap (terpal) untuk koneksi SSH yang masuk</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/company/globalsign/blog/445318/">  Bukan rahasia lagi bahwa Internet adalah lingkungan yang sangat bermusuhan.  Segera setelah Anda mengangkat server, server langsung mengalami serangan besar dan beberapa pemindaian.  Pada contoh <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">penjaga keamanan hanipot,</a> orang dapat memperkirakan skala lalu lintas sampah ini.  Bahkan, pada server rata-rata, 99% dari lalu lintas dapat berbahaya. <br><br>  Tarpit adalah port perangkap yang digunakan untuk memperlambat koneksi yang masuk.  Jika sistem pihak ketiga terhubung ke port ini, itu tidak akan berfungsi untuk menutup koneksi dengan cepat.  Dia harus menghabiskan sumber daya sistemnya dan menunggu hingga koneksi terputus oleh batas waktu, atau secara manual memutusnya. <br><br>  Paling sering, terpal digunakan untuk perlindungan.  Teknik ini pertama kali dikembangkan untuk melindungi terhadap cacing komputer.  Dan sekarang dapat digunakan untuk merusak kehidupan spammer dan peneliti yang terlibat dalam pemindaian luas semua alamat IP secara berturut-turut (contoh tentang Habré: <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Austria</a> , <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Ukraina</a> ). <br><a name="habracut"></a><br>  Salah satu sysadmin dengan nama Chris Wellons, tampaknya lelah menonton aib ini - dan ia menulis sebuah program kecil <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Endlessh</a> , tarpit untuk SSH, memperlambat koneksi yang masuk.  Program membuka port (secara default, port 2222 ditentukan untuk pengujian) dan berpura-pura menjadi server SSH, tetapi pada kenyataannya membuat koneksi tanpa akhir dengan klien yang masuk sampai menyerah.  Ini dapat berlangsung beberapa hari atau lebih hingga klien jatuh. <br><br>  Instalasi Utilitas: <br><br><pre><code class="bash hljs">$ make $ ./endlessh &amp; $ ssh -p2222 localhost</code> </pre> <br>  Sebuah tarpit yang diimplementasikan dengan benar akan mengambil lebih banyak sumber daya dari penyerang daripada Anda.  Tetapi masalahnya bahkan tidak dalam sumber daya.  Penulis <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">menulis</a> bahwa program ini membuat ketagihan.  Ada 27 klien yang terjebak saat ini, beberapa dari mereka terhubung selama berminggu-minggu.  Di puncak aktivitas, 1378 klien duduk di perangkap selama 20 jam! <br><br>  Dalam mode operasi, server Endlessh perlu diinstal pada port biasa 22, di mana hooligan mengetuk secara besar-besaran.  Rekomendasi keamanan standar selalu menyarankan untuk memindahkan SSH ke port yang berbeda, yang segera mengurangi ukuran log dengan urutan besarnya. <br><br>  Chris Wellons mengatakan programnya mengeksploitasi satu paragraf dari spesifikasi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">RFC 4253</a> untuk protokol SSH.  Segera setelah membuat koneksi TCP, tetapi sebelum menerapkan kriptografi, kedua belah pihak harus mengirim string identifikasi.  Dan ada catatan: <i>"Server MUNGKIN mengirim baris data lain sebelum mengirim baris dengan versi</i> . <i>"</i>  Dan <b>tidak ada batasan</b> jumlah data ini, hanya setiap baris tidak boleh dimulai dengan <code>SSH-</code> . <br><br>  Inilah yang dilakukan oleh Endlessh: ia <b>mengirimkan aliran data <i>tanpa henti yang</i> dihasilkan secara acak</b> yang sesuai dengan RFC 4253, yaitu, mengirim sebelum identifikasi, dan setiap baris tidak dimulai dengan <code>SSH-</code> dan tidak melebihi 255 karakter, termasuk karakter terminasi baris.  Secara umum, semuanya standar. <br><br>  Secara default, program menunggu 10 detik antara pengiriman paket.  Ini mencegah perjalanan timeout sehingga klien akan terjebak selamanya. <br><br>  Karena data dikirim sebelum kriptografi diterapkan, program ini sangat sederhana.  Tidak perlu mengimplementasikan sandi dan dukungan untuk banyak protokol. <br><br>  Penulis mencoba membuat utilitas mengkonsumsi sumber daya minimum dan bekerja dengan mulus di mesin.  Tidak seperti antivirus modern dan "sistem keamanan" lainnya, seharusnya tidak memperlambat komputer.  Dia berhasil meminimalkan lalu lintas dan konsumsi memori karena implementasi perangkat lunak yang sedikit lebih licik.  Jika ia hanya memulai proses terpisah pada koneksi baru, maka penyerang potensial dapat melakukan serangan DDoS, membuka banyak koneksi untuk menghabiskan sumber daya pada mesin.  Satu utas per koneksi juga bukan pilihan terbaik, karena kernel akan menghabiskan sumber daya untuk manajemen utas. <br><br>  Oleh karena itu, Chris Wellons memilih opsi yang paling ringan untuk Endlessh: sebuah <code>poll(2)</code> single-threaded <code>poll(2)</code> , di mana klien dalam perangkap praktis tidak mengkonsumsi sumber daya yang tidak perlu, tidak menghitung objek soket di kernel dan 78 byte lainnya untuk dilacak di Endlessh.  Agar tidak mengalokasikan penerimaan dan pengiriman buffer untuk setiap klien, Endlessh membuka soket akses langsung dan langsung menerjemahkan paket TCP, mengabaikan hampir seluruh tumpukan TCP / IP sistem operasi.  Input buffer tidak diperlukan sama sekali, karena data input tidak menarik bagi kita. <br><br>  Penulis mengatakan bahwa pada saat programnya ia <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tidak tahu</a> tentang keberadaan Python Asycio dan terpal lainnya.  Jika dia tahu tentang asycio, maka dia bisa mengimplementasikan utilitasnya hanya dalam 18 baris dengan Python: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_reader, writer)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">10</span></span>) writer.write(<span class="hljs-string"><span class="hljs-string">b'%x\r\n'</span></span> % random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">32</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionResetError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> server = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.start_server(handler, <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">2222</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> server: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> server.serve_forever() asyncio.run(main())</code> </pre> <br><br>  Asyncio sangat cocok untuk menulis tarpit.  Misalnya, jebakan seperti itu akan menggantung Firefox, Chrome atau klien lain yang mencoba terhubung ke server HTTP Anda selama berjam-jam: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(_reader, writer)</span></span></span><span class="hljs-function">:</span></span> writer.write(<span class="hljs-string"><span class="hljs-string">b'HTTP/1.1 200 OK\r\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.sleep(<span class="hljs-number"><span class="hljs-number">5</span></span>) header = random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">32</span></span>) value = random.randint(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>**<span class="hljs-number"><span class="hljs-number">32</span></span>) writer.write(<span class="hljs-string"><span class="hljs-string">b'X-%x: %x\r\n'</span></span> % (header, value)) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> writer.drain() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionResetError: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> server = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> asyncio.start_server(handler, <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">8080</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> server: <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> server.serve_forever() asyncio.run(main())</code> </pre> <br><br>  Tarpit adalah alat yang hebat untuk menghukum pelaku intimidasi online.  Benar, ada beberapa risiko, sebaliknya, untuk menarik perhatian mereka pada perilaku yang tidak biasa dari server tertentu.  Seseorang <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mungkin berpikir balas dendam</a> dan serangan DDoS yang ditargetkan pada IP Anda.  Namun, sejauh ini belum ada kasus seperti itu, dan tarpit berfungsi dengan baik. <br><br><hr><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/rw/hk/1y/rwhk1y-msfqaknqu2kbktqf6g7a.jpeg"></a> <br><br> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><img src="https://habrastorage.org/webt/od/n-/xe/odn-xebtl8a5lexzip_kkkezr6s.jpeg"></a> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id445318/">https://habr.com/ru/post/id445318/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id445308/index.html">Fitur pengujian hipotesis untuk aplikasi seluler</a></li>
<li><a href="../id445310/index.html">Sovereign Runet naik harganya menjadi ₽30 miliar</a></li>
<li><a href="../id445312/index.html">Alokasi memori JVM</a></li>
<li><a href="../id445314/index.html">Mengapa penambangan asteroid sulit?</a></li>
<li><a href="../id445316/index.html">DevDay Kelola TI. Rekaman Kinerja</a></li>
<li><a href="../id445320/index.html">Disk bergulung-gulung</a></li>
<li><a href="../id445322/index.html">Banyak pilihan sumber daya yang berguna untuk manajer produk</a></li>
<li><a href="../id445326/index.html">Otomatisasi kejam. Cut Direktur</a></li>
<li><a href="../id445328/index.html">Memikirkan Kembali Robotika Anak</a></li>
<li><a href="../id445330/index.html">Kriptografi di Jawa. Kelas tanda tangan</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>