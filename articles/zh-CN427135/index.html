<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ğŸ§  ğŸ’†ğŸ» ğŸš· æ¸¸æˆä¸­è¿‡åœºåŠ¨ç”»å’ŒåŠ¨ä½œåºåˆ—çš„å®ç° ğŸ–•ğŸ½ ğŸ“´ ğŸ™</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•åœ¨è§†é¢‘æ¸¸æˆä¸­å®ç°ä¸€ç³»åˆ—åŠ¨ä½œå’Œè¿‡åœºåŠ¨ç”»ã€‚ æœ¬æ–‡æ˜¯æœ¬æ–‡çš„ç¿»è¯‘ï¼Œå¹¶ä¸”æ˜¯ä¸æˆ‘åœ¨è«æ–¯ç§‘çš„Luaä¸Šå‘è¡¨çš„ä¸»é¢˜ç›¸åŒçš„ä¸»é¢˜ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å–œæ¬¢è§‚çœ‹è§†é¢‘ï¼Œå¯ä»¥åœ¨è¿™é‡Œè§‚çœ‹ã€‚ 

 æ–‡ç« ä»£ç æ˜¯ç”¨Luaç¼–å†™çš„ï¼Œä½†æ˜¯å¯ä»¥è½»æ¾åœ°ç”¨å…¶ä»–è¯­è¨€ç¼–å†™ï¼ˆä½¿ç”¨åç¨‹çš„æ–¹æ³•é™¤å¤–ï¼Œå› ä¸ºåç¨‹ä¸æ˜¯å…¨éƒ¨è¯­è¨€ï¼‰ã€‚ 
 
 æœ¬æ–‡ä»‹ç»äº†...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>æ¸¸æˆä¸­è¿‡åœºåŠ¨ç”»å’ŒåŠ¨ä½œåºåˆ—çš„å®ç°</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/427135/"> <i>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†è®¨è®ºå¦‚ä½•åœ¨è§†é¢‘æ¸¸æˆä¸­å®ç°ä¸€ç³»åˆ—åŠ¨ä½œå’Œè¿‡åœºåŠ¨ç”»ã€‚</i>  <i>æœ¬æ–‡æ˜¯æœ¬æ–‡çš„ç¿»è¯‘ï¼Œå¹¶ä¸”æ˜¯ä¸æˆ‘åœ¨è«æ–¯ç§‘çš„Luaä¸Šå‘è¡¨çš„ä¸»é¢˜ç›¸åŒçš„ä¸»é¢˜ï¼Œå› æ­¤ï¼Œå¦‚æœæ‚¨å–œæ¬¢è§‚çœ‹è§†é¢‘ï¼Œå¯ä»¥<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">åœ¨è¿™é‡Œ</a>è§‚çœ‹ã€‚</i> <i><br><br></i>  <i>æ–‡ç« ä»£ç æ˜¯ç”¨Luaç¼–å†™çš„ï¼Œä½†æ˜¯å¯ä»¥è½»æ¾åœ°ç”¨å…¶ä»–è¯­è¨€ç¼–å†™ï¼ˆä½¿ç”¨åç¨‹çš„æ–¹æ³•é™¤å¤–ï¼Œå› ä¸ºåç¨‹ä¸æ˜¯å…¨éƒ¨è¯­è¨€ï¼‰ã€‚</i> <i><br></i> <br> æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•åˆ›å»ºä¸€ç§æœºåˆ¶ï¼Œä½¿æ‚¨å¯ä»¥ç¼–å†™ä»¥ä¸‹å½¢å¼çš„è¿‡åœºåŠ¨ç”»ï¼š <br><br><pre><code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cutscene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player, npc)</span></span></span></span> player:goTo(npc) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> player:hasCompleted(quest) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> npc:say(<span class="hljs-string"><span class="hljs-string">"You did it!"</span></span>) delay(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) npc:say(<span class="hljs-string"><span class="hljs-string">"Thank you"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> npc:say(<span class="hljs-string"><span class="hljs-string">"Please help me"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br><h1> å‚èµ›ä½œå“ </h1><br> åŠ¨ä½œåºåˆ—ç»å¸¸åœ¨è§†é¢‘æ¸¸æˆä¸­æ‰¾åˆ°ã€‚ ä¾‹å¦‚ï¼Œåœ¨è¿‡åœºåŠ¨ç”»ä¸­ï¼šè§’è‰²é‡åˆ°æ•Œäººï¼Œå¯¹ä»–è¯´äº›ä»€ä¹ˆï¼Œæ•Œäººå›ç­”ç­‰ç­‰ã€‚ åŠ¨ä½œé¡ºåºå¯ä»¥åœ¨æ¸¸æˆä¸­æ‰¾åˆ°ã€‚ çœ‹ä¸€ä¸‹è¿™ä¸ªgifï¼š <br><br><img src="https://habrastorage.org/webt/5k/ry/ik/5kryik8wvq-b4ifoa3k3iobvolw.gif"><br><br>  1.é—¨æ‰“å¼€ <br>  2.è§’è‰²è¿›å…¥æˆ¿å±‹ <br>  3.é—¨å…³ä¸Š <br>  4.å±å¹•é€æ¸å˜æš— <br>  5.çº§åˆ«å˜åŒ– <br>  6.å±å¹•æ˜äº®åœ°æ¶ˆå¤± <br>  7.è§’è‰²è¿›å…¥å’–å•¡å… <br><br> åŠ¨ä½œåºåˆ—ä¹Ÿå¯ä»¥ç”¨äºç¼–å†™NPCçš„è¡Œä¸ºè„šæœ¬æˆ–æ‰§è¡Œé¦–é¢†æˆ˜æ–—ï¼Œå…¶ä¸­é¦–é¢†ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ‰§è¡ŒæŸäº›åŠ¨ä½œã€‚ <br><a name="habracut"></a><br><h1> é—®é¢˜ </h1><br> æ ‡å‡†æ¸¸æˆå¾ªç¯çš„ç»“æ„ä½¿åŠ¨ä½œåºåˆ—çš„å®ç°å˜å¾—å›°éš¾ã€‚ å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹æ¸¸æˆå¾ªç¯ï¼š <br><br><img src="https://habrastorage.org/webt/uc/xs/an/ucxsanil2ovbawdzqehjmfjpja4.png" width="240"><br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> game:isRunning() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> processInput() dt = <span class="hljs-built_in"><span class="hljs-built_in">clock</span></span>.delta() update(dt) render() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> æˆ‘ä»¬è¦å®ç°ä»¥ä¸‹åœºæ™¯ï¼šç©å®¶æ¥è¿‘NPCï¼ŒNPCè¯´ï¼šâ€œæ‚¨åšåˆ°äº†ï¼â€ï¼Œç„¶åç¨åœç‰‡åˆ»åè¯´ï¼šâ€œè°¢è°¢ï¼â€ã€‚ åœ¨ç†æƒ³çš„ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å°†è¿™æ ·å†™ï¼š <br><br><pre> <code class="lua hljs">player:goTo(npc) npc:say(<span class="hljs-string"><span class="hljs-string">"You did it!"</span></span>) delay(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) npc:say(<span class="hljs-string"><span class="hljs-string">"Thank you"</span></span>)</code> </pre><br> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¢ä¸´ä¸€ä¸ªé—®é¢˜ã€‚ å®Œæˆè¿™äº›æ­¥éª¤éœ€è¦ä¸€äº›æ—¶é—´ã€‚ æŸäº›åŠ¨ä½œç”šè‡³å¯èƒ½ç­‰å¾…æ’­æ”¾å™¨çš„è¾“å…¥ï¼ˆä¾‹å¦‚ï¼Œå…³é—­å¯¹è¯æ¡†ï¼‰ã€‚ é™¤äº†<code>delay</code>åŠŸèƒ½ï¼Œæ‚¨ä¸èƒ½è°ƒç”¨ç›¸åŒçš„<code>sleep</code> -çœ‹èµ·æ¥æ¸¸æˆå·²å†»ç»“ã€‚ <br><br> è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹è§£å†³é—®é¢˜çš„å‡ ç§æ–¹æ³•ã€‚ <br><br><h1> å¸ƒå°”ï¼Œæšä¸¾ï¼ŒçŠ¶æ€æœº </h1><br> å®æ–½ä¸€ç³»åˆ—æ“ä½œçš„æœ€æ˜æ˜¾æ–¹æ³•æ˜¯å°†æœ‰å…³å½“å‰çŠ¶æ€çš„ä¿¡æ¯å­˜å‚¨åœ¨å¸ƒå°”ï¼Œè¡Œæˆ–æšä¸¾ä¸­ã€‚ è¯¥ä»£ç å°†å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> cutsceneState == <span class="hljs-string"><span class="hljs-string">'playerGoingToNpc'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> player:continueGoingTo(npc) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> player:closeTo(npc) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cutsceneState = <span class="hljs-string"><span class="hljs-string">'npcSayingYouDidIt'</span></span> dialogueWindow:show(<span class="hljs-string"><span class="hljs-string">"You did it!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> cutsceneState == <span class="hljs-string"><span class="hljs-string">'npcSayingYouDidIt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dialogueWindow:wasClosed() <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> cutsceneState = <span class="hljs-string"><span class="hljs-string">'delay'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> ... ... <span class="hljs-comment"><span class="hljs-comment">--   ... end end</span></span></code> </pre><br> è¿™ç§æ–¹æ³•å¾ˆå®¹æ˜“å¯¼è‡´æ„å¤§åˆ©é¢æ¡å¼ä»£ç å’Œif-elseè¡¨è¾¾å¼çš„é•¿é“¾ï¼Œå› æ­¤æˆ‘å»ºè®®é¿å…ä½¿ç”¨è¿™ç§æ–¹æ³•æ¥è§£å†³é—®é¢˜ã€‚ <br><br><h1> è¡ŒåŠ¨æ¸…å• </h1><br> æ“ä½œåˆ—è¡¨ä¸çŠ¶æ€æœºéå¸¸ç›¸ä¼¼ã€‚ åŠ¨ä½œåˆ—è¡¨æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œçš„åŠ¨ä½œçš„åˆ—è¡¨ã€‚ åœ¨æ¸¸æˆå¾ªç¯ä¸­ï¼Œå½“å‰åŠ¨ä½œå°†è°ƒç”¨<code>update</code>å‡½æ•°ï¼Œå³ä½¿åŠ¨ä½œèŠ±è´¹å¾ˆé•¿æ—¶é—´ï¼Œå®ƒä¹Ÿå…è®¸æˆ‘ä»¬å¤„ç†è¾“å…¥å¹¶æ¸²æŸ“æ¸¸æˆã€‚ æ“ä½œå®Œæˆåï¼Œæˆ‘ä»¬ç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªæ“ä½œã€‚ <br><br> åœ¨æˆ‘ä»¬è¦å®ç°çš„è¿‡åœºåŠ¨ç”»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼šGoToActionï¼ŒDialogueActionå’ŒDelayActionã€‚ <br><br> å¯¹äºå…¶ä»–ç¤ºä¾‹ï¼Œæˆ‘å°†åœ¨Luaä¸­ä½¿ç”¨é¢å‘OOPçš„ä¸­äº§ç±»åº“ã€‚ <br><br> ä»¥ä¸‹æ˜¯<code>DelayAction</code>å®ç°æ–¹å¼ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">--  function DelayAction:initialize(params) self.delay = params.delay self.currentTime = 0 self.isFinished = false end function DelayAction:update(dt) self.currentTime = self.currentTime + dt if self.currentTime &gt; self.delay then self.isFinished = true end end</span></span></code> </pre><br>  <code>ActionList:update</code>å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ActionList:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.isFinished <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> self.currentAction:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.currentAction.isFinished <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> self:goToNextAction() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.currentAction <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> self.isFinished = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> æœ€åï¼Œè¿‡åœºåŠ¨ç”»æœ¬èº«çš„å®ç°ï¼š <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> makeCutsceneActionList(player, npc) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ActionList:<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { GoToAction:<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { entity = player, target = npc }, SayAction:<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { entity = npc, <span class="hljs-type"><span class="hljs-type">text</span></span> = "You did it!" }, DelayAction:<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { delay = <span class="hljs-number"><span class="hljs-number">0.5</span></span> }, SayAction:<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { entity = npc, <span class="hljs-type"><span class="hljs-type">text</span></span> = "Thank you" } } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">-- ... -    actionList:update(dt)</span></span></code> </pre><br>  <i>æ³¨æ„</i> ï¼šåœ¨Luaä¸­ï¼Œå¯ä»¥è¿™æ ·è°ƒç”¨<code>someFunction({ ... })</code> ï¼š <code>someFunction{...}</code> ã€‚ è¿™ä½¿æ‚¨å¯ä»¥ç¼–å†™<code>DelayAction:new{ delay = 0.5 }</code>è€Œä¸æ˜¯<code>DelayAction:new({delay = 0.5})</code> ã€‚ <br><br> çœ‹èµ·æ¥å¥½å¤šäº†ã€‚ è¯¥ä»£ç æ¸…æ¥šåœ°æ˜¾ç¤ºäº†æ“ä½œé¡ºåºã€‚ å¦‚æœæˆ‘ä»¬æƒ³æ·»åŠ ä¸€ä¸ªæ–°åŠ¨ä½œï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚ åˆ›å»ºè¯¸å¦‚<code>DelayAction</code>ç±»çš„ç±»éå¸¸ç®€å•ï¼Œä»¥ä½¿ç¼–å†™è¿‡åœºåŠ¨ç”»æ›´åŠ æ–¹ä¾¿ã€‚ <br><br> æˆ‘å»ºè®®æ‚¨çœ‹ä¸€ä¸‹Sean Middleditchå…³äºåŠ¨ä½œåˆ—è¡¨çš„æ¼”ç¤ºï¼Œå…¶ä¸­æä¾›äº†æ›´å¤æ‚çš„ç¤ºä¾‹ã€‚ <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/o6CaB-hmqoE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> æ“ä½œåˆ—è¡¨é€šå¸¸éå¸¸æœ‰ç”¨ã€‚ æˆ‘å°†å®ƒä»¬ç”¨äºæˆ‘çš„æ¸¸æˆå·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œæ€»ä½“ä¸Šè¿˜æ˜¯å¾ˆé«˜å…´çš„ã€‚ ä½†æ˜¯è¿™ç§æ–¹æ³•ä¹Ÿæœ‰ç¼ºç‚¹ã€‚ å‡è®¾æˆ‘ä»¬è¦å®ç°ç¨å¾®å¤æ‚ä¸€ç‚¹çš„è¿‡åœºåŠ¨ç”»ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cutscene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player, npc)</span></span></span></span> player:goTo(npc) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> player:hasCompleted(quest) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> npc:say(<span class="hljs-string"><span class="hljs-string">"You did it!"</span></span>) delay(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) npc:say(<span class="hljs-string"><span class="hljs-string">"Thank you"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> npc:say(<span class="hljs-string"><span class="hljs-string">"Please help me"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> è¦è¿›è¡Œif / elseä»¿çœŸï¼Œæ‚¨éœ€è¦å®ç°éçº¿æ€§åˆ—è¡¨ã€‚ è¿™å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥å®Œæˆã€‚ å¯ä»¥å¯¹æŸäº›åŠ¨ä½œè¿›è¡Œæ ‡è®°ï¼Œç„¶åæ ¹æ®æŸç§æ¡ä»¶ï¼Œè€Œä¸æ˜¯è½¬åˆ°ä¸‹ä¸€ä¸ªåŠ¨ä½œï¼Œå¯ä»¥è½¬åˆ°å…·æœ‰æ‰€éœ€æ ‡ç­¾çš„åŠ¨ä½œã€‚ å®ƒå¯ä»¥å·¥ä½œï¼Œä½†æ˜¯å®ƒä¸åƒä¸Šé¢çš„å‡½æ•°é‚£æ ·å®¹æ˜“è¯»å†™ã€‚ <br><br>  Luaåç¨‹ä½¿æ­¤ä»£ç æˆä¸ºç°å®ã€‚ <br><br><h1> åç¨‹ </h1><br><h2>  Luaçš„CoruaåŸºç¡€çŸ¥è¯† </h2><br>  Corutinæ˜¯ä¸€ç§å¯ä»¥æš‚åœç„¶åå†æ¢å¤çš„åŠŸèƒ½ã€‚ åç¨‹ä¸ä¸»ç¨‹åºåœ¨åŒä¸€çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ æ²¡æœ‰ä¸ºåç¨‹åˆ›å»ºä»»ä½•æ–°çº¿ç¨‹ã€‚ <br><br> è¦æš‚åœ<code>coroutine.yield</code> ï¼Œæ‚¨éœ€è¦è°ƒç”¨<code>coroutine.yield</code>æ¥æ¢å¤<code>coroutine.resume</code> ã€‚ ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>) coroutine.<span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>() <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"world!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> c = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">create</span></span>(f) coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(c) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"uhh..."</span></span>) coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(c)</code> </pre><br> ç¨‹åºè¾“å‡ºï¼š <br><br><pre>ä½ å¥½
å‘ƒ...
ä¸–ç•Œ
</pre><br><br> è¿ä½œæ–¹å¼å¦‚ä¸‹ã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨<code>coroutine.create</code>åˆ›å»º<code>coroutine.create</code> ã€‚ æ­¤è°ƒç”¨åï¼Œcorutinæ— æ³•å¯åŠ¨ã€‚ ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>coroutine.resume</code>è¿è¡Œå®ƒã€‚ ç„¶åè°ƒç”¨å‡½æ•°<code>f</code> ï¼Œè¯¥å‡½æ•°å°†å†™å…¥â€œ helloâ€ï¼Œå¹¶ä½¿ç”¨<code>coroutine.yield</code>æš‚åœè‡ªèº«ã€‚ è¿™ç±»ä¼¼äº<code>return</code> ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>coroutine.resume</code>æ¢å¤<code>f</code> ã€‚ <br><br> å¦‚æœåœ¨è°ƒç”¨<code>coroutine.yield</code>æ—¶ä¼ é€’å‚æ•°ï¼Œé‚£ä¹ˆå®ƒä»¬å°†æˆä¸ºâ€œä¸»æµâ€ä¸­å¯¹<code>coroutine.resume</code>çš„ç›¸åº”è°ƒç”¨çš„è¿”å›å€¼ã€‚ <br><br> ä¾‹å¦‚ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> ... coroutine.<span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>(<span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-string"><span class="hljs-string">"some text"</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> ok, num, text = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(c) <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(num, text) <span class="hljs-comment"><span class="hljs-comment">-- will print '42 "some text"'</span></span></code> </pre><br>  <code>ok</code>æ˜¯ä¸€ä¸ªå˜é‡ï¼Œå®ƒä½¿æˆ‘ä»¬å¯ä»¥çŸ¥é“åç¨‹çš„çŠ¶æ€ã€‚ å¦‚æœ<code>ok</code>æ˜¯<code>true</code> ï¼Œé‚£ä¹ˆä½¿ç”¨åç¨‹ï¼Œä¸€åˆ‡éƒ½å¾ˆå¥½ï¼Œå†…éƒ¨æ²¡æœ‰å‘ç”Ÿä»»ä½•é”™è¯¯ã€‚ å…¶åçš„è¿”å›å€¼ï¼ˆ <code>num</code> ï¼Œ <code>text</code> ï¼‰ä¸ä¼ é€’ç»™<code>yield</code>å‚æ•°ç›¸åŒã€‚ <br><br> å¦‚æœ<code>ok</code>æ˜¯<code>false</code> ï¼Œé‚£ä¹ˆåç¨‹ä¼šå‡ºé—®é¢˜ï¼Œä¾‹å¦‚ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº†<code>error</code>å‡½æ•°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¬¬äºŒä¸ªè¿”å›å€¼å°†æ˜¯ä¸€æ¡é”™è¯¯æ¶ˆæ¯ã€‚ åç¨‹ç¤ºä¾‹ä¸­å‘ç”Ÿé”™è¯¯ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span> + notDefined) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> c = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">create</span></span>(f) ok, msg = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(c) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> ok <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">"Coroutine failed!"</span></span>, msg) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> ç»“è®ºï¼š <br><br><pre>åç¨‹å¤±è´¥äº†ï¼ è¾“å…¥ï¼š4ï¼šå°è¯•å¯¹nilå€¼æ‰§è¡Œç®—æœ¯ï¼ˆå…¨å±€'notDefined'ï¼‰
</pre><br><br>  <code>coroutine.status</code>çŠ¶æ€å¯ä»¥é€šè¿‡è°ƒç”¨<code>coroutine.status</code>è·å¾—ã€‚  Corutinå¯èƒ½å¤„äºä»¥ä¸‹æƒ…å†µï¼š <br><br><ul><li>  â€œæ­£åœ¨è¿è¡Œâ€-åç¨‹å½“å‰æ­£åœ¨è¿è¡Œã€‚  <code>coroutine.status</code>æ˜¯ä»corutinæœ¬èº«è°ƒç”¨çš„ </li><li>  â€œå·²æš‚åœâ€-Corutinå·²æš‚åœæˆ–ä»æœªå¯åŠ¨ </li><li>  â€œæ­£å¸¸â€-corutinå·²æ¿€æ´»ï¼Œä½†æœªæ‰§è¡Œã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œcorutinåœ¨è‡ªèº«å†…éƒ¨å‘å°„äº†å¦ä¸€ç§corutin </li><li>  â€œæ­»â€-åç¨‹å·²å®Œæˆæ‰§è¡Œï¼ˆå³åç¨‹ä¸­çš„åŠŸèƒ½å·²å®Œæˆï¼‰ </li></ul><br> ç°åœ¨ï¼Œå€ŸåŠ©è¿™ä¸€çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åŸºäºååŒç¨‹åºçš„åŠ¨ä½œåºåˆ—å’Œè¿‡åœºåŠ¨ç”»çš„ç³»ç»Ÿã€‚ <br><br><h2> ä½¿ç”¨corutinåˆ›å»ºè¿‡åœºåŠ¨ç”» </h2><br> è¿™æ˜¯åŸºæœ¬<code>Action</code>ç±»åœ¨æ–°ç³»ç»Ÿä¸Šçš„å¤–è§‚ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Action:launch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> self:init() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.finished <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> dt = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>() self:update(dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> self:<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> è¯¥æ–¹æ³•ç±»ä¼¼äºåŠ¨ä½œåˆ—è¡¨ï¼šåœ¨åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œå°†è°ƒç”¨åŠ¨ä½œçš„<code>update</code>åŠŸèƒ½ã€‚ ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åç¨‹ï¼Œå¹¶ä¸”åœ¨æ¸¸æˆå¾ªç¯çš„æ¯ä¸ªè¿­ä»£ä¸­éƒ½<code>yield</code> ï¼ˆ <code>Action:launch</code>ä»æŸä¸ªåç¨‹è°ƒç”¨<code>Action:launch</code> ï¼‰ã€‚ åœ¨æ¸¸æˆå¾ªç¯<code>update</code>æŸå¤„ï¼Œæˆ‘ä»¬åƒè¿™æ ·æ¢å¤å½“å‰è¿‡åœºåŠ¨ç”»çš„æ‰§è¡Œï¼š <br><br><pre> <code class="lua hljs">coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(c, dt)</code> </pre><br> æœ€åï¼Œåˆ›å»ºä¸€ä¸ªè¿‡åœºåŠ¨ç”»ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cutscene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(player, npc)</span></span></span></span> player:goTo(npc) npc:say(<span class="hljs-string"><span class="hljs-string">"You did it!"</span></span>) delay(<span class="hljs-number"><span class="hljs-number">0.5</span></span>) npc:say(<span class="hljs-string"><span class="hljs-string">"Thank you"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-comment"><span class="hljs-comment">-- -  ... local c = coroutine.create(cutscene, player, npc) coroutine.resume(c, dt)</span></span></code> </pre><br>  <code>delay</code>åŠŸèƒ½çš„å®ç°æ–¹æ³•å¦‚ä¸‹ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(time)</span></span></span></span> action = DelayAction:new { delay = <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> } action:launch() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> åˆ›å»ºæ­¤ç±»åŒ…è£…ç¨‹åºå¯å¤§å¤§æé«˜è¿‡åœºä»£ç çš„å¯è¯»æ€§ã€‚  <code>DelayAction</code>å®ç°å¦‚ä¸‹ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-comment"><span class="hljs-comment">-- Action -   DelayAction local DelayAction = class("DelayAction", Action) function DelayAction:initialize(params) self.delay = params.delay self.currentTime = 0 self.isFinished = false end function DelayAction:update(dt) self.currentTime = self.currentTime + dt if self.currentTime &gt;= self.delayTime then self.finished = true end end</span></span></code> </pre><br> æ­¤å®ç°ä¸æˆ‘ä»¬åœ¨æ“ä½œåˆ—è¡¨ä¸­ä½¿ç”¨çš„å®ç°ç›¸åŒï¼ è®©æˆ‘ä»¬å†æ¬¡çœ‹ä¸€ä¸‹<code>Action:launch</code>åŠŸèƒ½ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Action:launch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> self:init() <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.finished <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> dt = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">yield</span></span>() <span class="hljs-comment"><span class="hljs-comment">-- the most important part self:update(dt) end self:exit() end</span></span></code> </pre><br> è¿™é‡Œçš„ä¸»è¦å†…å®¹æ˜¯<code>while</code> ï¼Œè¯¥å¾ªç¯ä¸€ç›´è¿è¡Œåˆ°åŠ¨ä½œå®Œæˆä¸ºæ­¢ã€‚ çœ‹èµ·æ¥åƒè¿™æ ·ï¼š <br><br><img src="https://habrastorage.org/webt/l3/_n/xw/l3_nxwnzshpxqhho12yqyi-y52o.png"><br><br> ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹<code>goTo</code>å‡½æ•°ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Entity:goTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> action = GoToAction:new { entity = self, target = target } action:launch() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToAction:initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params)</span></span></span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GoToAction:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> self.entity:closeTo(self.target) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ... <span class="hljs-comment"><span class="hljs-comment">--  , AI else self.finished = true end end</span></span></code> </pre><br> åç¨‹å¾ˆå¥½åœ°å¤„ç†äº‹ä»¶ã€‚ å®ç°<code>WaitForEventAction</code>ç±»ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForEventAction:initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params)</span></span></span></span> self.finished = <span class="hljs-literal"><span class="hljs-literal">false</span></span> eventManager:subscribe { listener = self, eventType = params.eventType, callback = WaitForEventAction.onEvent } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForEventAction:onEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> self.finished = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> æ­¤åŠŸèƒ½ä¸éœ€è¦<code>update</code>æ–¹æ³•ã€‚ å®ƒå°†æ‰§è¡Œï¼ˆå°½ç®¡å®ƒä¸ä¼šåšä»»ä½•äº‹æƒ…â€¦â€¦ï¼‰ï¼Œç›´åˆ°æ”¶åˆ°å…·æœ‰æ‰€éœ€ç±»å‹çš„äº‹ä»¶ä¸ºæ­¢ã€‚ è¿™æ˜¯æ­¤ç±»çš„å®é™…åº”ç”¨<code>say</code>å‡½æ•°çš„å®ç°ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Entity:say</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(text)</span></span></span></span> DialogueWindow:show(text) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> action = WaitForEventAction:new { eventType = <span class="hljs-string"><span class="hljs-string">'DialogueWindowClosed'</span></span> } action:launch() <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> ç®€å•æ˜“è¯»ã€‚ å¯¹è¯æ¡†å…³é—­æ—¶ï¼Œå°†åˆ†æ´¾â€œ DialogueWindowClosedâ€ç±»å‹çš„äº‹ä»¶ã€‚  sayåŠ¨ä½œç»“æŸï¼Œä¸‹ä¸€ä¸ªåŠ¨ä½œå¼€å§‹æ‰§è¡Œã€‚ <br><br> ä½¿ç”¨åç¨‹ï¼Œæ‚¨å¯ä»¥è½»æ¾åˆ›å»ºéçº¿æ€§è¿‡åœºåŠ¨ç”»å’Œå¯¹è¯æ¡†æ ‘ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> answer = girl:say(<span class="hljs-string"><span class="hljs-string">'do_you_love_lua'</span></span>, { <span class="hljs-string"><span class="hljs-string">'YES'</span></span>, <span class="hljs-string"><span class="hljs-string">'NO'</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> answer == <span class="hljs-string"><span class="hljs-string">'YES'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> girl:setMood(<span class="hljs-string"><span class="hljs-string">'happy'</span></span>) girl:say(<span class="hljs-string"><span class="hljs-string">'happy_response'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> girl:setMood(<span class="hljs-string"><span class="hljs-string">'angry'</span></span>) girl:say(<span class="hljs-string"><span class="hljs-string">'angry_response'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><img src="https://habrastorage.org/webt/t4/e-/am/t4e-amhtwligikstvqtgi8bpyzu.gif"><br><br> åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ <code>say</code>å‡½æ•°æ¯”æˆ‘ä¹‹å‰æ˜¾ç¤ºçš„å‡½æ•°ç¨å¾®å¤æ‚ä¸€äº›ã€‚ å®ƒä¼šåœ¨å¯¹è¯ä¸­è¿”å›ç©å®¶çš„é€‰æ‹©ï¼Œä½†è¿™å¹¶ä¸éš¾å®ç°ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨<code>WaitForEventAction</code>ä½¿ç”¨<code>WaitForEventAction</code> ï¼Œå®ƒå°†æ•è·PlayerChoiceEventäº‹ä»¶ï¼Œç„¶åè¿”å›å…¶ä¿¡æ¯å°†åŒ…å«åœ¨äº‹ä»¶å¯¹è±¡ä¸­çš„æ’­æ”¾å™¨çš„é€‰æ‹©ã€‚ <br><br><h2> ç¨å¾®å¤æ‚ä¸€äº›çš„ä¾‹å­ </h2><br> ä½¿ç”¨åç¨‹ï¼Œæ‚¨å¯ä»¥è½»æ¾åˆ›å»ºæ•™ç¨‹å’Œå°ä»»åŠ¡ã€‚ ä¾‹å¦‚ï¼š <br><br><pre> <code class="lua hljs">girl:say(<span class="hljs-string"><span class="hljs-string">"Kill that monster!"</span></span>) waitForEvent(<span class="hljs-string"><span class="hljs-string">'EnemyKilled'</span></span>) girl:setMood(<span class="hljs-string"><span class="hljs-string">'happy'</span></span>) girl:say(<span class="hljs-string"><span class="hljs-string">"You did it! Thank you!"</span></span>)</code> </pre><br><img src="https://habrastorage.org/webt/wx/du/kh/wxdukhci9lald-fph9ypbu5h5fg.gif"><br><br> åç¨‹ä¹Ÿå¯ä»¥ç”¨äºAIã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ€ªç‰©å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°æ²¿æŸäº›è½¨è¿¹ç§»åŠ¨ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">followPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(monster, path)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> numberOfPoints = <span class="hljs-built_in"><span class="hljs-built_in">path</span></span>:getNumberOfPoints() <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">--      while true do monster:goTo(path:getPoint(i)) if i &lt; numberOfPoints - 1 then i = i + 1 --     else --   i = 0 end end end</span></span></code> </pre><br><img src="https://habrastorage.org/webt/g7/m4/ou/g7m4ouls2l7al6xlovmm-qdbywc.gif"><br><br> å½“æ€ªç‰©çœ‹åˆ°ç©å®¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°åœæ­¢æ‰§è¡Œåç¨‹å¹¶å°†å…¶åˆ é™¤ã€‚ å› æ­¤ï¼Œ <code>followPath</code>å†…éƒ¨çš„æ— é™å¾ªç¯ï¼ˆ <code>while true</code> ï¼‰å¹¶ä¸æ˜¯çœŸæ­£çš„æ— é™ã€‚ <br><br> ä½¿ç”¨corutinï¼Œæ‚¨å¯ä»¥æ‰§è¡Œâ€œå¹¶è¡Œâ€æ“ä½œã€‚ åœ¨ä¸¤ä¸ªåŠ¨ä½œéƒ½å®Œæˆä¹‹å‰ï¼Œè¿‡åœºåŠ¨ç”»ä¸ä¼šç»§ç»­è¿›è¡Œä¸‹ä¸€ä¸ªåŠ¨ä½œã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°†åˆ¶ä½œä¸€ä¸ªè¿‡åœºåŠ¨ç”»ï¼Œå¥³å­©å’ŒçŒ«ä»¥ä¸åŒçš„é€Ÿåº¦è·‘åˆ°æœ‹å‹çš„ä½ç½®ã€‚ ä»–ä»¬æ¥æ‰¾å¥¹åï¼ŒçŒ«è¯´â€œå–µâ€ã€‚ <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cutscene</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cat, girl, meetingPoint)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> c1 = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">create</span></span>( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> cat:goTo(meetingPoint) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> c2 = coroutine.<span class="hljs-built_in"><span class="hljs-built_in">create</span></span>( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> girl:goTo(meetingPoint) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>) c1.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>() c2.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>() <span class="hljs-comment"><span class="hljs-comment">--  waitForFinish(c1, c2) --    cat:say("meow") ... end</span></span></code> </pre><br> è¿™é‡Œæœ€é‡è¦çš„éƒ¨åˆ†æ˜¯<code>waitForFinish</code>å‡½æ•°ï¼Œå®ƒæ˜¯<code>WaitForFinishAction</code>ç±»çš„åŒ…è£…ï¼Œå¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼å®ç°ï¼š <br><br><pre> <code class="lua hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WaitForFinishAction:update</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(dt)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> coroutine.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>(self.c1) == <span class="hljs-string"><span class="hljs-string">'dead'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> coroutine.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>(self.c2) == <span class="hljs-string"><span class="hljs-string">'dead'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> self.finished = <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> coroutine.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>(self.c1) ~= <span class="hljs-string"><span class="hljs-string">'dead'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(self.c1, dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> coroutine.<span class="hljs-built_in"><span class="hljs-built_in">status</span></span>(self.c2) ~= <span class="hljs-string"><span class="hljs-string">'dead'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> coroutine.<span class="hljs-built_in"><span class="hljs-built_in">resume</span></span>(self.c2, dt) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br> å¦‚æœå…è®¸åŒæ­¥ç¬¬Nä¸ªåŠ¨ä½œï¼Œåˆ™å¯ä»¥ä½¿æ­¤ç±»æ›´å¼ºå¤§ã€‚ <br><br> æ‚¨è¿˜å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œç­‰å¾…<i>ä¸€ä¸ª</i>åç¨‹å®Œæˆï¼Œè€Œä¸æ˜¯ç­‰å¾…<i>æ‰€æœ‰</i>åç¨‹å®Œæˆæ‰§è¡Œã€‚ ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºèµ›è½¦è¿·ä½ æ¸¸æˆã€‚ åœ¨åç¨‹å†…éƒ¨ï¼Œå°†ç­‰å¾…ä¸€åéª‘æ‰‹åˆ°è¾¾ç»ˆç‚¹çº¿ï¼Œç„¶åæ‰§è¡Œä¸€äº›åŠ¨ä½œåºåˆ—ã€‚ <br><br><h2>  Corutinçš„ä¼˜ç¼ºç‚¹ </h2><br> åç¨‹æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æœºåˆ¶ã€‚ ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨å¯ä»¥ç¼–å†™æ˜“äºé˜…è¯»å’Œä¿®æ”¹çš„è¿‡åœºåŠ¨ç”»å’Œæ¸¸æˆä»£ç ã€‚ è¿™ç±»è¿‡åœºåŠ¨ç”»å¯ä»¥è½»æ¾åœ°ç”±ä¿®æ”¹è€…æˆ–éç¨‹åºå‘˜ï¼ˆä¾‹å¦‚ï¼Œæ¸¸æˆæˆ–å…³å¡è®¾è®¡å¸ˆï¼‰ç¼–å†™ã€‚ <br><br> è€Œä¸”æ‰€æœ‰è¿™äº›éƒ½æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œå› æ­¤åŒæ­¥æˆ–<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ç«æ€æ¡ä»¶</a>æ²¡æœ‰é—®é¢˜ã€‚ <br><br> è¯¥æ–¹æ³•å…·æœ‰ç¼ºç‚¹ã€‚ ä¾‹å¦‚ï¼Œä¿å­˜å¯èƒ½å­˜åœ¨é—®é¢˜ã€‚ å‡è®¾æ‚¨çš„æ¸¸æˆä¸­æœ‰ä¸€ä¸ªä½¿ç”¨åç¨‹å®ç°çš„å¾ˆé•¿çš„æ•™ç¨‹ã€‚ åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ’­æ”¾å™¨å°†æ— æ³•ä¿å­˜ï¼Œå› ä¸º ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦ä¿å­˜åç¨‹çš„å½“å‰çŠ¶æ€ï¼ˆåŒ…æ‹¬åç¨‹çš„æ•´ä¸ªå †æ ˆä»¥åŠå†…éƒ¨å˜é‡çš„å€¼ï¼‰ï¼Œä»¥ä¾¿åœ¨ä»ä¿å­˜ä¸­è¿›ä¸€æ­¥åŠ è½½æ—¶ï¼Œå¯ä»¥ç»§ç»­æœ¬æ•™ç¨‹ã€‚ <br><br>  ï¼ˆ <i>æ³¨æ„</i> ï¼šä½¿ç”¨<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">PlutoLibrary</a>åº“<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">ï¼Œ</a>åç¨‹å¯ä»¥åºåˆ—åŒ–ï¼Œä½†è¯¥åº“ä»…é€‚ç”¨äºLua 5.1ã€‚ï¼‰ <br><br> è¿‡åœºåŠ¨ç”»ä¸ä¼šå‘ç”Ÿæ­¤é—®é¢˜ï¼Œå› ä¸º é€šå¸¸åœ¨æ¸¸æˆä¸­è¿‡åœºåŠ¨ç”»æ˜¯ä¸å…è®¸çš„ã€‚ <br><br> å¦‚æœå°†å®ƒåˆ†æˆå°å—ï¼Œåˆ™å¯ä»¥è§£å†³é•¿ç¯‡æ•™ç¨‹çš„é—®é¢˜ã€‚ å‡è®¾ç©å®¶å®Œæˆäº†æœ¬æ•™ç¨‹çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¿…é¡»è¿›å…¥å¦ä¸€ä¸ªæˆ¿é—´æ‰èƒ½ç»§ç»­æœ¬æ•™ç¨‹ã€‚ æ­¤æ—¶ï¼Œæ‚¨å¯ä»¥è®¾ç½®æ£€æŸ¥ç‚¹æˆ–ä¸ºç©å®¶æä¾›ä¿å­˜çš„æœºä¼šã€‚ åœ¨ä¿å­˜ä¸­ï¼Œæˆ‘ä»¬å°†ç¼–å†™ç±»ä¼¼â€œç©å®¶å®Œæˆäº†æ•™ç¨‹çš„ç¬¬1éƒ¨åˆ†â€çš„å†…å®¹ã€‚ æ¥ä¸‹æ¥ï¼Œç©å®¶å°†å­¦ä¹ æœ¬æ•™ç¨‹çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œä¸ºæ­¤æˆ‘ä»¬å°†ä½¿ç”¨å¦ä¸€ä¸ªåç¨‹ã€‚ ä¾æ­¤ç±»æ¨...åœ¨åŠ è½½æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯å¼€å§‹æ‰§è¡Œä¸ç©å®¶å¿…é¡»ç»è¿‡çš„é›¶ä»¶ç›¸å¯¹åº”çš„åç¨‹ã€‚ <br><br><h1> ç»“è®º </h1><br> å¦‚æ‚¨æ‰€è§ï¼Œæœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥å®ç°ä¸€ç³»åˆ—åŠ¨ä½œå’Œè¿‡åœºåŠ¨ç”»ã€‚ åœ¨æˆ‘çœ‹æ¥ï¼Œåç¨‹æ–¹æ³•éå¸¸å¼ºå¤§ï¼Œæˆ‘å¾ˆé«˜å…´ä¸å¼€å‘äººå‘˜åˆ†äº«ã€‚ æˆ‘å¸Œæœ›è¿™ç§è§£å†³é—®é¢˜çš„æ–¹æ³•å¯ä»¥ä½¿æ‚¨çš„ç”Ÿæ´»æ›´è½»æ¾ï¼Œå¹¶å…è®¸æ‚¨åœ¨æ¸¸æˆä¸­åˆ¶ä½œå²è¯—èˆ¬çš„è¿‡åœºåŠ¨ç”»ã€‚ </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN427135/">https://habr.com/ru/post/zh-CN427135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN427117/index.html">åŸºäºæ˜Ÿå·çš„ä¼šè®®å®¤</a></li>
<li><a href="../zh-CN427123/index.html">å›¾çµæ¸¸æˆ</a></li>
<li><a href="../zh-CN427129/index.html">å¨èƒæƒ…æŠ¥-ä¿¡æ¯å®‰å…¨çš„ç°ä»£æ–¹æ³•</a></li>
<li><a href="../zh-CN427131/index.html">ç†Ÿæ‚‰Audiomaniaï¼šæœ‰å…³ç”Ÿäº§ï¼Œè®¾è®¡ï¼ŒåŠå…¬å®¤å’Œä¸šåŠ¡çš„15ç§ä¸»é¢˜ææ–™</a></li>
<li><a href="../zh-CN427133/index.html">åˆ†ç±»-ç»å…¸ä¼˜åŒ–ä»»åŠ¡</a></li>
<li><a href="../zh-CN427137/index.html">ä¸­å¤®é“¶è¡Œç»Ÿè®¡æ•°æ®ï¼š2018å¹´ï¼Œé»‘å®¢ä»é‡‘èæœºæ„é­å—ç½‘ç»œæ”»å‡»çš„æ”¶å…¥ä¸‹é™äº†è¿‘14å€</a></li>
<li><a href="../zh-CN427139/index.html">[é€‰æ‹”]åœºåœ°çš„å¼€å‘ï¼Œè®¾è®¡å’Œæ¨å¹¿ï¼š17ç§æœ‰ç”¨çš„ææ–™</a></li>
<li><a href="../zh-CN427141/index.html">çˆ†ç ´æ‰‹æœº</a></li>
<li><a href="../zh-CN427143/index.html">Hackadayçš„ç¬¬äºŒæšRetrocomputerå¾½ç« </a></li>
<li><a href="../zh-CN427145/index.html">å­¦ä¹ ç°ä»£é—ä¼ å­¦ï¼Œåˆ†å­ç”Ÿç‰©å­¦ï¼ŒåŸºå› å·¥ç¨‹å’ŒåŸºå› ç»„å­¦çš„æœ€ä½³æ–¹æ³•</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>