<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üí∑ üêÉ üë®‚Äç‚úàÔ∏è Surveillance par SMS du poids de trois ruches pour 30 $ üÜï üöé üë†</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Non, ce n'est pas une offre commerciale, tel est le co√ªt des composants du syst√®me que vous pouvez collecter apr√®s avoir lu l'article. 


 Un peu d'hi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Surveillance par SMS du poids de trois ruches pour 30 $</h1><div class="post__body post__body_full"><div class="post__text post__text-html post__text_v1" id="post-content-body" data-io-article-url="https://habr.com/ru/post/444326/"><p><img src="https://habrastorage.org/getpro/habr/post_images/f9b/e29/cd3/f9be29cd3be301fe1554f261ae6d0dcb.jpg" alt="Mon logo"></p><br><p>  Non, ce n'est pas une offre commerciale, tel est le co√ªt des composants du syst√®me que vous pouvez collecter apr√®s avoir lu l'article. </p><br><p>  Un peu d'histoire: </p><br><p>  Il y a quelque temps, j'ai d√©cid√© d'aller chercher des abeilles, et elles sont apparues ... pour toute la saison, mais ne sont pas sorties de l'hiver. <br>  Et cela malgr√© le fait que tout semblait bien se passer - leurre d'automne, r√©chauffement avant le froid. <br>  La ruche √©tait un syst√®me Dadan en bois classique avec 10 cadres √† partir d'une planche de 40 mm. <br>  Mais cet hiver-l√†, m√™me les apiculteurs exp√©riment√©s ont perdu beaucoup plus que d'habitude √† cause des variations de temp√©rature. </p><br><p>  C'est ainsi qu'est venue l'id√©e d'un syst√®me de surveillance de l'√©tat des ruches. <br>  Apr√®s la publication de plusieurs articles sur Habr-e et la communication sur le forum des apiculteurs, j'ai d√©cid√© de passer du simple au complexe. <br>  Le poids est le seul param√®tre incontestable, mais en r√®gle g√©n√©rale, les syst√®mes existants ne surveillent qu'une seule ruche "de r√©f√©rence". <br>  Si quelque chose ne va pas avec lui (par exemple, le vol d'un essaim, la maladie des abeilles), alors les indicateurs deviennent inutiles. </p><br><p>  Par cons√©quent, il a √©t√© d√©cid√© de surveiller le changement de poids de trois ruches √† la fois avec un microcontr√¥leur et d'ajouter les autres "petits pains" apr√®s. <br>  Le r√©sultat est un syst√®me autonome avec une autonomie d'environ un mois sur une seule charge de la batterie 18650 et envoyant des statistiques une fois par jour. <br>  J'ai essay√© de simplifier le design autant que possible, afin qu'il puisse √™tre r√©p√©t√© m√™me sans sch√©mas, selon une photo. </p><br><p>  La logique de travail est la suivante: au premier d√©marrage / reset, les relev√©s des capteurs install√©s sous les ruches sont stock√©s dans l'EEPROM. <br>  De plus, chaque jour, apr√®s le coucher du soleil, le syst√®me "se r√©veille", lit le t√©moignage et envoie des SMS avec un changement de poids par jour et √† partir du moment o√π il est allum√©. <br>  De plus, la valeur de tension de la batterie est transmise et lorsqu'elle tombe √† 3,5 V, un avertissement sur la n√©cessit√© de la charge est √©mis, car en dessous de 3,4 V, le module de communication ne s'allume pas et les lectures de poids sont d√©j√† "flottantes". </p><a name="habracut"></a><br><p>  "Tu te souviens comment tout a commenc√©. Tout √©tait la premi√®re fois." <br><img src="https://habrastorage.org/getpro/habr/post_images/2f2/432/274/2f24322742ff9b620f05bb2804a5bb03.jpg" alt="Comment √ßa commence"><br>  Oui, c'√©tait un tel ensemble de ¬´fer¬ª qui √©tait √† l'origine, bien que seuls les capteurs et les fils de charge aient surv√©cu √† la version finale, mais tout d'abord. <br>  En fait, la baie de c√¢bles n'est pas n√©cessaire, elle s'est av√©r√©e √™tre au m√™me prix que 30 m √† plat. </p><br><p>  Si vous n'avez pas peur de d√©monter 3 LEDs smd et une demi-centaine de points de soudure (sortie) normaux - alors allez-y! </p><br><p>  Nous avons donc besoin de l'ensemble d'√©quipement / mat√©riel suivant: </p><br><ol><li>  Arduino Pro Mini 3V <br>  Vous devriez faire attention √† la micropuce du convertisseur lin√©aire - elle doit √™tre exactement 3,3 V - sur la puce de marquage KB 33 / LB 33 / DE A10 - les Chinois ont m√©lang√© quelque chose avec moi, et tout le lot <br>  les circuits imprim√©s dans le magasin se sont av√©r√©s √™tre √©quip√©s de r√©gulateurs 5 volts et de quartz 16 MHz. </li><li>  USB-Ttl sur une puce CH340 - vous pouvez m√™me 5 volts, mais pendant le firmware du microcontr√¥leur, Arduino devra √™tre d√©connect√© du module GSM, afin de ne pas br√ªler ce dernier. <br>  Les cartes sur la puce PL2303 ne fonctionnent pas sous Windows 10. </li><li>  Module de communication GSM Goouu Tech IOT GA-6-B ou AI-THINKER A-6 Mini. <br>  Pourquoi vous y √™tes-vous arr√™t√©?  Neoway M590 - un concepteur qui n√©cessite des danses s√©par√©es avec des tambourins, GSM SIM800L - n'aimait pas le niveau de logique non standard de 2,8 V, qui n√©cessite une coordination m√™me avec un arduino √† trois volts. <br>  De plus, la solution d'AiThinker a une consommation d'√©nergie minimale (lors de l'envoi de SMS, je n'ai pas vu de courant sup√©rieur √† 100mA). </li><li>  Antenne GSM GPRS 3DBI (sur la photo ci-dessus - une √©charpe rectangulaire avec une "queue", pendant 9 heures) </li><li>  Pack de d√©marrage pour un op√©rateur ayant une bonne couverture √† l'emplacement de votre rucher. <br>  Oui, le forfait doit d'abord √™tre activ√© dans un t√©l√©phone ordinaire, d√©sactiver la demande de code PIN √† l'entr√©e et reconstituer le compte. <br>  Maintenant, il existe de nombreuses options avec des noms dans le style de "Sensor", "IoT" - ils ont des frais mensuels l√©g√®rement inf√©rieurs. </li><li>  dupont fil 20cm m√®re m√®re - 3 pcs.  (pour connecter Arduino √† USB-TTL) </li><li>  3 pi√®ces  HX711 - ADC pour balances </li><li>  6 pesons pesant jusqu'√† 50 kg </li><li>  15 m√®tres de c√¢ble t√©l√©phonique √† 4 conducteurs - pour connecter des modules de poids avec ARDUINO. </li><li>  Photor√©sistance GL5528 (ceci est important, avec une r√©sistance √† l'obscurit√© de 1MOhm et une r√©sistance √† la lumi√®re de 10-20kOhm) et deux r√©sistances conventionnelles de 20k </li><li>  Un morceau de ruban adh√©sif double face de 18x18 mm d'√©paisseur - pour fixer l'arduino au module de communication. </li><li>  Le support de batterie 18650 et, en fait, la batterie elle-m√™me ~ 2600mAh. </li><li>  Un peu de cire ou de paraffine (bougie pour tablette de lampe aromatique) - pour la protection contre l'humidit√© HX711 </li><li>  Un morceau de poutre en bois 25x50x300mm pour la base des cellules de charge. </li><li>  Une douzaine de vis autotaraudeuses avec une rondelle de pression de 4,2x19 mm pour le montage des capteurs sur la base. </li></ol><br><p>  La batterie peut √™tre retir√©e du d√©montage des ordinateurs portables - plusieurs fois moins cher qu'un nouveau, et la capacit√© sera beaucoup plus √©lev√©e que celle de l'UltraFire chinois - j'ai obtenu 1500 contre 450 (cela vient du pare-feu 6800 ;-) </p><br><p>  De plus, il faudra des mains tordues, un fer √† souder EPSN-25, de la colophane et de la soudure POS-60. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0a9/222/e6a/0a9222e6acd4d43631f777dfa995dcab.jpg" alt="Fer √† souder"></p><br><p>  Il y a encore 5 ans, j‚Äôutilisais un fer √† souder sovi√©tique avec une piq√ªre de cuivre (je n‚Äôai pas eu de stations de soudage - je l‚Äôai pris pour un essai routier et j‚Äôai fini avec le circuit EPSN). <br>  Mais apr√®s son √©chec et plusieurs monstrueux chinois sous (d) des arbres de No√´l, ce dernier s'appelait Sparte - une chose aussi grave que le nom a cess√© <br>  sur un produit avec un contr√¥leur de temp√©rature. </p><br><p>  Alors allons-y! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eba/218/027/eba21802786557630e811458e9a07eaa.jpg" alt="GSM A6"></p><br><p>  Pour commencer, deux LED sont soud√©es √† partir du module GSM (l'endroit o√π elles ont √©t√© encercl√©es dans un ovale orange) <br>  Nous ins√©rons la carte SIM avec les pads sur la carte de circuit imprim√©, le coin biseaut√© sur la photo est indiqu√© par la fl√®che. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/463/027/4e6/4630274e63f3710ea1b69f94a3d2dd8b.jpg" alt="Arduino Pro Mini 3v"></p><br><p>  Ensuite, nous effectuons une proc√©dure similaire avec la LED sur la carte Arduino (l'ovale √† gauche de la puce carr√©e), <br>  Souder le peigne en quatre contacts (1), <br>  Nous prenons deux r√©sistances de 20k, tournons les fils d'un c√¥t√©, soudons la torsion dans le trou de contact A5, les fils restants dans le RAW et GND arduinki (2), <br>  Nous raccourcissons la photor√©sistance √† 10 mm et la soudons aux conclusions des cartes GND et D2 (3). </p><br><p>  Il est maintenant temps <del>  ruban √©lectrique bleu </del>  ruban adh√©sif double face - collez-le sur le support de carte SIM du module de communication, et en haut - arduino - le bouton rouge (argent) nous fait face et est situ√© au-dessus de la carte SIM. </p><br><p>  Souder la puissance: plus du condensateur du module de communication (4) √† la broche Arduino RAW. <br>  Le fait est que le module de communication lui-m√™me n√©cessite 3,4-4,2 V pour son alimentation, et son contact PWR est connect√© √† un convertisseur abaisseur abaisseur, donc pour un fonctionnement √† partir de la tension Li-ion, il faut appliquer en contournant cette partie du circuit. </p><br><p>  En arduino, au contraire, nous d√©marrons l'alimentation via un convertisseur lin√©aire - √† faible courant, la chute de tension de d√©crochage est de 0,1 V. <br>  Mais en appliquant une tension stabilis√©e aux modules HX711, nous nous d√©barrassons de la n√©cessit√© de les affiner sous une tension inf√©rieure (et en m√™me temps d'augmenter le bruit √† la suite de cette op√©ration). </p><br><p>  Ensuite, nous soudons les cavaliers (5) entre les contacts PWR-A1, URX-D4 et UTX-D5, la masse GND-G (6) et enfin l'alimentation du support de batterie 18650 (7), connectons l'antenne (8). <br>  Maintenant, nous prenons le convertisseur USB-TTL et connectons les contacts RXD-TXD et TXD-RXD, GND-GND avec les fils Dupont √† ARDUINO (peigne 1): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/651/7dc/8ff/6517dc8ffbb81e4be9f1793db3eb66aa.jpg" alt="Version Premi√®re"></p><br><p>  Sur la photo ci-dessus - la premi√®re version (de trois) du syst√®me, qui a √©t√© utilis√©e pour le d√©bogage. </p><br><p>  Et maintenant, pendant un certain temps, nous nous √©loignons du fer √† souder et passons √† la partie logicielle. <br>  Je vais d√©crire la s√©quence d'actions pour Windows: <br>  Tout d'abord, vous devez t√©l√©charger et installer / d√©compresser le programme <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">Arduino IDE</a> - la version actuelle est 1.8.9, mais j'utilise 1.6.4 </p><br><p>  Pour plus de simplicit√©, nous d√©compressons l'archive dans le dossier C: \ arduino- "votre_version_num√©ro", √† l'int√©rieur nous aurons le / dist, les pilotes, les exemples, le mat√©riel, java, lib, les biblioth√®ques, la r√©f√©rence, les dossiers d'outils, ainsi que le fichier ex√©cutable arduino (entre autres). </p><br><p>  Nous avons maintenant besoin d'une biblioth√®que pour travailler avec le <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">HX711</a> ADC - le bouton vert "cloner ou t√©l√©charger" - t√©l√©charger ZIP. <br>  Le contenu (dossier HX711-master) est plac√© dans le r√©pertoire C: \ arduino- "your_version_number" \ biblioth√®ques </p><br><p>  Et bien s√ªr, le pilote pour <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">USB-TTL provient</a> du m√™me github - √† partir de l'archive d√©compress√©e, le fichier SETUP d'installation est simplement lanc√©. </p><br><p>  Ok, lancez et configurez le programme C: \ arduino- "votre_version_number" \ arduino </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2fd/429/2d5/2fd4292d54f67c31052b54ca853be5b3.jpg" alt="Interface de programme"></p><br><p>  Nous allons √† l'√©l√©ment "Outils" - s√©lectionnez la carte "Arduino Pro ou Pro Mini", le processeur Atmega 328 3,3 V 8 MHz, le port est le num√©ro autre que le syst√®me COM1 (il appara√Æt apr√®s l'installation du pilote CH340 avec l'adaptateur USB-TTL connect√©) </p><br><p>  Ok, copiez l'esquisse suivante (programme) et collez-la dans la fen√™tre Arduino IDE </p><br><pre><code class="plaintext hljs">char phone_no[]="+123456789012"; // Your phone number that receive SMS with counry code #include &lt;avr/sleep.h&gt; // ARDUINO sleep mode library #include &lt;SoftwareSerial.h&gt; // Sofrware serial library #include "HX711.h" // HX711 lib. https://github.com/bogde/HX711 #include &lt;EEPROM.h&gt; // EEPROM lib. HX711 scale0(10, 14); HX711 scale1(11, 14); HX711 scale2(12, 14); #define SENSORCNT 3 HX711 *scale[SENSORCNT]; SoftwareSerial mySerial(5, 4); // Set I/O-port TXD, RXD of GSM-shield byte pin2sleep=15; // Set powerON/OFF pin float delta00; // delta weight from start float delta10; float delta20; float delta01; // delta weight from yesterday float delta11; float delta21; float raw00; //raw data from sensors on first start float raw10; float raw20; float raw01; //raw data from sensors on yesterday float raw11; float raw21; float raw02; //actual raw data from sensors float raw12; float raw22; word calibrate0=20880; //calibration factor for each sensor word calibrate1=20880; word calibrate2=20880; word daynum=0; //numbers of day after start int notsunset=0; boolean setZero=false; float readVcc() { // Read battery voltage function long result1000; float rvcc; result1000 = analogRead(A5); rvcc=result1000; rvcc=6.6*rvcc/1023; return rvcc; } void setup() { // Setup part run once, at start pinMode(13, OUTPUT); // Led pin init pinMode(2, INPUT_PULLUP); // Set pullup voltage Serial.begin(9600); mySerial.begin(115200); // Open Software Serial port to work with GSM-shield pinMode(pin2sleep, OUTPUT);// Itit ON/OFF pin for GSM digitalWrite(pin2sleep, LOW); // Turn ON modem delay(16000); // Wait for its boot scale[0] = &amp;scale0; //init scale scale[1] = &amp;scale1; scale[2] = &amp;scale2; scale0.set_scale(); scale1.set_scale(); scale2.set_scale(); delay(200); setZero=digitalRead(2); if (EEPROM.read(500)==EEPROM.read(501) || setZero) // first boot/reset with hiding photoresistor //if (setZero) { raw00=scale0.get_units(16); //read data from scales raw10=scale1.get_units(16); raw20=scale2.get_units(16); EEPROM.put(500, raw00); //write data to eeprom EEPROM.put(504, raw10); EEPROM.put(508, raw20); for (int i = 0; i &lt;= 24; i++) { //blinking LED13 on reset/first boot digitalWrite(13, HIGH); delay(500); digitalWrite(13, LOW); delay(500); } } else { EEPROM.get(500, raw00); // read data from eeprom after battery change EEPROM.get(504, raw10); EEPROM.get(508, raw20); digitalWrite(13, HIGH); // turn on LED 13 on 12sec. delay(12000); digitalWrite(13, LOW); } delay(200); // Test SMS at initial boot // mySerial.println("AT+CMGF=1"); // Send SMS part delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.println("INITIAL BOOT OK"); mySerial.print("V Bat= "); mySerial.println(readVcc()); if (readVcc()&lt;3.5) {mySerial.print("!!! CHARGE BATTERY !!!");} delay(500); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); // raw02=raw00; raw12=raw10; raw22=raw20; //scale0.power_down(); //power down all scales //scale1.power_down(); //scale2.power_down(); } void loop() { attachInterrupt(0, NULL , RISING); // Interrupt on high lewel set_sleep_mode(SLEEP_MODE_PWR_DOWN); //Set ARDUINO sleep mode digitalWrite(pin2sleep, HIGH); // Turn OFF GSM-shield delay(2200); digitalWrite(pin2sleep, LOW); // Turn OFF GSM-shield delay(2200); digitalWrite(pin2sleep, HIGH); digitalWrite(13, LOW); scale0.power_down(); //power down all scales scale1.power_down(); scale2.power_down(); delay(90000); sleep_mode(); // Go to sleep detachInterrupt(digitalPinToInterrupt(0)); // turn off external interrupt notsunset=0; for (int i=0; i &lt;= 250; i++){ if ( !digitalRead(2) ){ notsunset++; } //is a really sunset now? you shure? delay(360); } if ( notsunset==0 ) { digitalWrite(13, HIGH); digitalWrite(pin2sleep, LOW); // Turn-ON GSM-shield scale0.power_up(); //power up all scales scale1.power_up(); scale2.power_up(); raw01=raw02; raw11=raw12; raw21=raw22; raw02=scale0.get_units(16); //read data from scales raw12=scale1.get_units(16); raw22=scale2.get_units(16); daynum++; delta00=(raw02-raw00)/calibrate0; // calculate weight changes delta01=(raw02-raw01)/calibrate0; delta10=(raw12-raw10)/calibrate1; delta11=(raw12-raw11)/calibrate1; delta20=(raw22-raw20)/calibrate2; delta21=(raw22-raw21)/calibrate2; delay(16000); mySerial.println("AT+CMGF=1"); // Send SMS part delay(2000); mySerial.print("AT+CMGS=\""); mySerial.print(phone_no); mySerial.write(0x22); mySerial.write(0x0D); // hex equivalent of Carraige return mySerial.write(0x0A); // hex equivalent of newline delay(2000); mySerial.print("Turn "); mySerial.println(daynum); mySerial.print("Hive1 "); mySerial.print(delta01); mySerial.print(" "); mySerial.println(delta00); mySerial.print("Hive2 "); mySerial.print(delta11); mySerial.print(" "); mySerial.println(delta10); mySerial.print("Hive3 "); mySerial.print(delta21); mySerial.print(" "); mySerial.println(delta20); mySerial.print("V Bat= "); mySerial.println(readVcc()); if (readVcc()&lt;3.5) {mySerial.print("!!! CHARGE BATTERY !!!");} delay(500); mySerial.println (char(26));//the ASCII code of the ctrl+z is 26 delay(3000); } }</code> </pre> <br><p>  Dans la premi√®re ligne, entre guillemets char phone_no [] = "+ 123456789012";  - au lieu de 123456789012, nous mettons notre num√©ro de t√©l√©phone avec le code du pays auquel le SMS sera envoy√©. </p><br><p>  Maintenant, cliquez sur le bouton de v√©rification (au-dessus du num√©ro un dans la capture d'√©cran ci-dessus) - si ci-dessous (sous le triple dans la capture d'√©cran) "La compilation est termin√©e" - alors nous pouvons flasher le microcontr√¥leur. </p><br><p>  Ainsi, l'USB-TTL est connect√© √† l'ARDUINO et √† l'ordinateur, nous mettons la batterie charg√©e dans le support (g√©n√©ralement sur un nouvel arduino, la LED commence √† clignoter une fois par seconde). </p><br><p>  Maintenant, le firmware - nous nous entra√Ænons √† appuyer sur le bouton rouge (argent) du microcontr√¥leur - cela devra √™tre fait strictement √† un certain moment !!! <br>  Est-il  Cliquez sur le bouton "T√©l√©charger" (au-dessus des deux dans la capture d'√©cran), et regardez attentivement la ligne au bas de l'interface (sous les trois √©crans). <br>  D√®s que l'inscription "compilation" est remplac√©e par "download" - appuyez sur le bouton rouge (reset) - si tout va bien - l'adaptateur USB-TTL clignote joyeusement, et l'inscription "Downloaded" en bas de l'interface </p><br><p>  Maintenant, pendant que nous attendons l'arriv√©e du SMS de test sur le t√©l√©phone, je vais vous expliquer comment fonctionne le programme: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/bb0/555/3f9/bb05553f9fb11ef00ae30a92be52839b.jpg" alt="La deuxi√®me version du stand de d√©bogage"></p><br><p>  Sur la photo - la deuxi√®me version du stand de d√©bogage. </p><br><p>  La premi√®re fois que le syst√®me est allum√©, il v√©rifie les octets 500 et 501 de l'EEPROM; s'ils sont √©gaux, les donn√©es d'√©talonnage n'ont pas √©t√© enregistr√©es et l'algorithme passe √† la section de configuration. <br>  La m√™me chose se produit si, lorsqu'elle est allum√©e, la photor√©sistance est ombr√©e (avec un capuchon d'un stylo) - le mode de r√©initialisation des param√®tres est activ√©. </p><br><p>  Des jauges de contrainte devraient d√©j√† √™tre install√©es sous les ruches, car nous fixons simplement le niveau initial de z√©ro, puis mesurons le changement de poids (maintenant des z√©ros viendront, car nous n'avons encore rien connect√©). <br>  Sur Arduino, la LED int√©gr√©e de la broche 13 clignote. <br>  Si la r√©initialisation ne se produit pas, la LED s'allume pendant 12 secondes. <br>  Apr√®s cela, un SMS de test est envoy√© avec le message "INITIAL BOOT OK" et la tension de la batterie. <br>  Le module de communication s'√©teint et apr√®s 3 minutes, la carte Arduino met les cartes HX711 ADC en mode veille et s'endort d'elle-m√™me. <br>  Un tel retard a √©t√© fait afin de ne pas interf√©rer avec un module GSM en √©tat de marche (apr√®s l'avoir √©teint, il "police" pendant un certain temps). </p><br><p>  De plus, nous avons une interruption sur le capteur photo travaillant sur la deuxi√®me broche (plus le levage est activ√© par la fonction pullup). <br>  Dans ce cas, apr√®s un d√©clenchement de 3 minutes suppl√©mentaires, l'√©tat de la photor√©sistance est v√©rifi√© pour exclure les faux positifs / r√©p√©t√©s. <br>  Ce qui est caract√©ristique, sans aucun r√©glage, le syst√®me fonctionne 10 minutes apr√®s le coucher du soleil astronomique par temps nuageux et apr√®s 20 par temps clair. <br>  Oui, afin que chaque fois que le syst√®me ne se r√©initialise pas, au moins le premier module HX711 doit √™tre connect√© (broches DT-D10, SCK-A0) </p><br><p>  Ensuite, les lectures des cellules de charge sont prises, le changement de poids par rapport √† l'op√©ration pr√©c√©dente (le premier num√©ro de la ligne apr√®s Hive) est calcul√© et d√®s le premier d√©marrage, la tension de la batterie est v√©rifi√©e et ces informations sont envoy√©es sous forme de SMS: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c05/360/360/c05360360e4ac01a63cd0daa0f138a99.png" alt="Exemple de syst√®me"></p><br><p>  Au fait, avez-vous re√ßu des SMS?  F√©licitations!  Nous sommes √† mi-chemin!  Bien que la batterie puisse √™tre retir√©e de son support, nous n'aurons plus besoin d'un ordinateur. </p><br><p>  √Ä propos, le centre de contr√¥le de vol s'est av√©r√© si compact qu'il peut tenir dans un pot de mayonnaise, dans mon cas, une bo√Æte translucide de 30x60x100 mm (provenant de cartes de visite) parfaitement adapt√©e. </p><br><p>  Oui, le syst√®me de couchage consomme environ 2,3 mA - 90% en raison du module de communication - il ne s'√©teint pas compl√®tement, mais passe en mode veille. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/26b/994/07e/26b99407efab87e00ffe017eea588666.jpg" alt="Pas houston"></p><br><p>  Nous proc√©dons √† la fabrication de capteurs, pour commencer, abordons la disposition des capteurs: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/182/43b/cec/18243bcecc904c4018d7b2217cc72d9b.jpg" alt="Emplacement du capteur"></p><br><p>  Ceci est le plan de la ruche - vue de dessus. </p><br><p>  Classiquement, 4 capteurs sont install√©s dans les coins (1,2,3,4) </p><br><p>  Nous mesurerons diff√©remment.  Ou plut√¥t, m√™me dans le troisi√®me.  Comme les gars de BroodMinder font diff√©remment: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b49/fbe/1f3/b49fbe1f378d3e5b4b7320bf6ac83520.jpg" alt="Broodminder"></p><br><p>  Dans cette conception, les capteurs sont install√©s aux positions 1 et 2, les points 3.4 sont bas√©s sur le faisceau. <br>  Ensuite, seulement la moiti√© du poids tombe sur les capteurs. <br>  Oui, une telle m√©thode a moins de pr√©cision, mais il est difficile d'imaginer que les abeilles ont construit tous les cadres avec des ¬´langues¬ª des nids d'abeilles le long d'un mur de la ruche. </p><br><p>  Donc, je propose de r√©duire les capteurs au point 5 au total - alors il n'est pas n√©cessaire de prot√©ger le syst√®me, et lorsque vous utilisez des ruches lumineuses, il est tout √† fait n√©cessaire de le faire avec un seul capteur. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/67b/10b/4cc/67b10b4ccdaf51f4f81574927ac21ca3.jpg" alt="Capteur et options de capteur"></p><br><p>  En g√©n√©ral, nous avons test√© deux types de modules sur le HX711, deux types de capteurs et deux options pour les connecter - avec un pont de Wheatstone complet (2 capteurs) et demi lorsque la deuxi√®me partie est compl√©t√©e par des r√©sistances 1k avec une tol√©rance de 0,1%. <br>  Mais cette derni√®re m√©thode n'est pas souhaitable et n'est pas recommand√©e m√™me par les fabricants de capteurs, donc je ne d√©crirai que la premi√®re. </p><br><p>  Ainsi, sur une ruche, nous installerons deux cellules de charge et un module HX711, le sch√©ma de c√¢blage est le suivant: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6d2/39b/bef/6d239bbef099b427b0f6127a323a7e69.jpg"></p><br><p>  De la carte ADC √† l'arduino, il y a 5 m√®tres d'un c√¢ble t√©l√©phonique √† 4 conducteurs - <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">nous nous souvenons que les abeilles n'aiment pas les appareils GSM dans la ruche</a> . </p><br><p>  En g√©n√©ral, sur les capteurs nous laissons des "queues" de 8 cm, nous nettoyons la paire torsad√©e et nous dessoudons tout comme sur la photo ci-dessus. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/30d/ab9/f9c/30dab9f9cc87cd43929d9b86fec36f62.jpg" alt="Observez la polarit√©!"></p><br><p>  Je r√©p√®te encore une fois - observez la polarit√©! </p><br><p>  Si le fil noir de la cellule de charge est connect√© √† l'E + de la carte HX711, le rouge passe √† A + </p><br><p>  Sinon, au lieu de prendre du poids, vous recevrez une r√©duction, mais cela n'a pas d'importance, dans ce cas, il suffit d'√©changer les fils rouges des cellules de charge (A + et A-) sur la carte ADC. </p><br><p>  Avant de commencer la menuiserie, placez la cire / paraffine dans un r√©cipient appropri√© pour faire fondre dans un bain-marie. </p><br><p>  Maintenant, nous prenons notre poutre et la divisons en trois segments de 100 mm </p><br><p>  Ensuite, nous d√©limitons une rainure longitudinale de 25 mm de large, de 7 √† 8 mm de profondeur, √† l'aide d'une scie √† m√©taux et d'un burin, nous enlevons l'exc√©dent - un profil en forme de U devrait sortir. </p><br><p>  La cire s'est r√©chauff√©e?  - nous y trempons nos cartes ADC - cela les prot√©gera de l'humidit√© / du brouillard: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/672/7f1/a576727f1b4385933b640b0dd1ef2a01.jpg" alt="Protection ADC contre sollicit√©e"></p><br><p>  Nous avons tout sur une base en bois (il faut le traiter avec un antiseptique de d√©composition): </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a57/a6b/347/a57a6b34743c1f8b8add453e729fadea.jpg" alt="Assemblage"></p><br><p>  Et enfin, nous fixons les capteurs avec des vis: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/94d/e43/541/94de435418f3d001e47b181935612e5f.jpg" alt="Capteur pr√™t"></p><br><p>  Il y avait une autre option avec un ruban √©lectrique bleu, mais pour des raisons d'humanit√© je ne l'apporte pas ;-) </p><br><p>  Du c√¥t√© d'Arduino, nous faisons ce qui suit: </p><br><p>  Nous nettoyons nos c√¢bles t√©l√©phoniques, torsadons les fils de couleur ensemble, maigres. </p><br><p>  Apr√®s cela, nous soudons aux contacts du conseil d'administration comme sur la photo: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a0c/6fc/0fe/a0c6fc0fedd0bc6a1c4f1e6929d5e4bc.jpg" alt="Finale"></p><br><p>  Voil√†, maintenant pour le contr√¥le final, placez les capteurs sur les secteurs du cercle, en haut - un morceau de contreplaqu√©, mettez le contr√¥leur √† z√©ro (mettez la batterie avec le capuchon sur la photodiode du stylo plume). </p><br><p>  Dans ce cas, la LED de l'arduino devrait clignoter et un SMS de test devrait appara√Ætre. </p><br><p>  Ensuite, nous retirons les bouchons de la photocellule et nous allons chercher de l'eau dans une bouteille en plastique de 1,5 litre. <br>  Nous mettons la bouteille sur du contreplaqu√© et si plusieurs minutes se sont d√©j√† √©coul√©es depuis la mise sous tension, remettez le capuchon sur la photor√©sistance (simulant un coucher de soleil). </p><br><p>  Au bout de trois minutes, la LED de l'arduino s'allume et vous devriez recevoir un SMS avec une valeur de poids d'environ 1 kg √† toutes les positions. </p><br><p>  F√©licitations!  Le syst√®me est assembl√© avec succ√®s! </p><br><p>  Si nous faisons maintenant fonctionner √† nouveau le syst√®me, alors dans la premi√®re colonne du poids, nous obtenons des z√©ros. </p><br><p>  Oui, dans des conditions r√©elles, il est souhaitable d'orienter la photor√©sistance verticalement vers le haut. </p><br><p>  Je vais maintenant donner un bref manuel sur l'utilisation de: </p><br><ol><li>  Installez des jauges de contrainte sous les parois arri√®re des ruches (sous le devant, remplacez une poutre / planche de 30 mm d'√©paisseur) </li><li>  Ombrez la photor√©sistance et ins√©rez la batterie - la LED devrait clignoter et un SMS de test avec le texte "INITIAL BOOT OK" devrait venir </li><li>  Positionnez l'unit√© centrale aussi loin que possible des ruches et afin que les fils n'interf√®rent pas lorsque vous travaillez avec des abeilles. <br>  Chaque soir, apr√®s le coucher du soleil, les SMS arriveront avec un changement de poids par jour et √† partir du moment du lancement. <br>  Lorsque la tension de la batterie atteint 3,5 V, le SMS se termine par la ligne "!!! CHARGE BATTERY !!!" <br>  Le temps de fonctionnement d'une batterie d'une capacit√© de 2600mAh est d'environ un mois. <br>  En cas de remplacement de la batterie, les variations quotidiennes du poids des ruches ne sont pas m√©moris√©es. </li></ol><br><p>  Et ensuite? </p><br><ol><li>  Pour comprendre comment mettre tout cela dans un projet pour github </li><li>  Commencez 3 familles d'abeilles dans les ruches du syst√®me Palivoda (ou les cornes) </li><li>  Ajoutez des "petits pains" - une mesure de l'humidit√©, de la temp√©rature, et surtout - une analyse du bourdonnement des abeilles. </li></ol><br><p>  Occupons-nous de tout, sinc√®rement v√¥tre, apiculteur √©lectrique Andrey </p><br><p>  PS Pour les nouvelles publications sur ce sujet, voir <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;pto=nl&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=fr&amp;u=">beefree.xyz</a> <br></p></div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/fr444326/">https://habr.com/ru/post/fr444326/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../fr444316/index.html">Lettres des r√©seaux sociaux: votre confidentialit√© est-elle suffisante? Deux probl√®mes et leur solution</a></li>
<li><a href="../fr444318/index.html">Histoire de r√©ussite de Nginx, ou ¬´Tout est possible, essayez-le!¬ª</a></li>
<li><a href="../fr444320/index.html">Crayon exotique: d√©tecter un deuxi√®me son dans du graphite ordinaire</a></li>
<li><a href="../fr444322/index.html">Suivre la trace des calculatrices: SpeedCrunch</a></li>
<li><a href="../fr444324/index.html">Suivre les traces des calculatrices: SpeedCrunch</a></li>
<li><a href="../fr444328/index.html">La refonte de l'interface utilisateur est souvent une perte de temps</a></li>
<li><a href="../fr444330/index.html">Le CMS sans serveur est enfin un concurrent digne de Wordpress</a></li>
<li><a href="../fr444332/index.html">S√©curit√© de l'information et restauration: comment les managers pensent les produits informatiques</a></li>
<li><a href="../fr444336/index.html">Listes de capture Swift: quelle est la diff√©rence entre les liens faibles, forts et non poss√©d√©s?</a></li>
<li><a href="../fr444338/index.html">Encapsulation dans Python 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>