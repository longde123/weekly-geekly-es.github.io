<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👃🏻 🤳🏽 ✋🏾 马尔可夫链用于程序生成 ⚙️ ⏰ ⚡️</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="注意：该项目的完整源代码可以在[ 这里 ]找到。 由于它是一个较大项目的一部分，因此建议您在发布本文时或/source/helpers/arraymath.h文件以及/source/world/blueprint.cpp 。 

 在本文中，我想详细讨论在3D建筑物和其他系统的过程生成中使用马尔可夫...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>马尔可夫链用于程序生成</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/475764/"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/152/06b/acc/15206bacc91b6635a0f286fa21998363.gif" alt="图片"></div><br> 注意：该项目的完整源代码可以在[ <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">这里</a> ]找到。 由于它是一个较大项目的一部分，因此建议您在发布本文时或<code>/source/helpers/arraymath.h</code>文件以及<code>/source/world/blueprint.cpp</code> 。 <br><br> 在本文中，我想详细讨论在3D建筑物和其他系统的过程生成中使用马尔可夫链和统计的原理。 <br><br> 我将解释系统的数学基础，并尝试使解释尽可能笼统，以便您可以在其他情况下应用此概念，例如生成2D地牢。 解释中将附带图片和源代码。 <br><br> 该方法是用于满足特定要求的系统过程生成的一种通用方法，因此，我建议至少阅读第一节的末尾，以便您可以理解该技术是否对您的情况有用，因为下面将解释必要的要求。 <br><a name="habracut"></a><br> 结果将用在我的<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">体素引擎中，</a>以便<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">任务机器人</a>可以先建造建筑物，然后建造城市。 本文结尾处有一个示例！ <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="http://weigert.vsos.ethz.ch/wp-content/uploads/2019/10/buildings.mp4" type="video/mp4"></video></div></div></div><br>  <i>带有结果的几个示例。</i> <br><br><h2> 基础知识 </h2><br><h3> 马尔可夫链 </h3><br> 马尔可夫链是系统沿其移动的状态序列，用时间的转变来描述。 状态之间的转换是随机的，也就是说，它们由概率来描述，而概率是系统的特征。 <br><br> 系统由状态空间定义，状态空间是所有可能的系统配置的空间。 如果正确地描述了系统，那么我们也可以将状态之间的转换描述为离散的步骤。 <br><br> 应该注意的是，从系统的一种状态来看，通常会有几种可能的离散过渡，每种过渡都会导致系统处于不同状态。 <br><br> 从状态i转换为状态j的概率等于： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.969ex" height="2.66ex" viewBox="0 -780.1 1278.5 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="345" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> P_ {ij} </script></p><br> 马尔可夫过程是借助转移给它的概率研究状态空间的过程。 <br><br> 重要的是，马尔可夫过程“没有记忆”。 这仅意味着从当前状态过渡到新状态的可能性仅取决于当前状态，而不再取决于先前访问的任何其他条件。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF0C;</mo></mrow><mi>j</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="15.357ex" height="2.66ex" viewBox="0 -780.1 6612 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="345" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-3D" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-50" x="2612" y="0"></use><g transform="translate(3364,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="4194" y="0"></use><g transform="translate(4539,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">，</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="5369" y="0"></use><g transform="translate(5782,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mo>，</mo></mrow><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> P_ {ij} = P（i，j）</script></p><br><h4> 示例：文本生成 </h4><br> 系统是位序列。 状态空间是所有可能的位序列。 离散转换将一位从0更改为1或从1更改为0。如果系统具有n位，则从每种状态我们都有n种可能的转换到新状态。 马尔可夫过程将包括通过使用某些概率更改序列中的位值来研究状态空间。 <br><br><h4> 示例：天气预报 </h4><br> 该系统是当前的天气状况。 状态空间是天气可能处于的所有可能状态（例如，“多雨”，“多云”，“晴天”等）。 过渡将是从任何状态到可以设置过渡可能性的另一种状态的转换（例如，“不管今天天气晴朗，明天是否下雨，无论昨天的天气如何？”的概率是多少？）。 <br><br><h3> 马尔可夫链的蒙特卡罗方法 </h3><br> 由于状态之间的转换由概率决定，因此我们还可以设置“稳定”处于任何状态的概率（或者，如果时间趋于无穷大，则我们处于特定状态的平均时间）。 这是状态的内部分布。 <br><br> 然后，用于马尔可夫链的蒙特卡洛算法（Markov-Chain Monte-Carlo，MCMC）是一种用于从状态空间获取样本的技术。 采样（sampling）是指在考虑内部分布的基础上，根据选择的概率来选择状态。 <br><br> 他们说，处于某种状态的可能性与某个成本函数成比例*，该成本函数给出了系统所处当前状态的“估计”。 可以认为，如果成本低，则处于该状态的可能性高，并且该比率是单调的。 成本函数定义如下： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>R</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.422ex" height="2.298ex" viewBox="0 -780.1 2765 989.6" role="img" focusable="false" style="vertical-align: -0.487ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-52" x="0" y="0"></use><g transform="translate(759,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="1589" y="0"></use><g transform="translate(1934,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> R（i）</script></p><br> 注意：由于比例不一定是线性的，因此不确定是否正确使用“比例”一词。 <br><br> 然后，来自状态分布的样本将以较高的概率返回具有低成本（或良好的“估计”）的配置！ <br><br> 即使具有极大的状态空间（可能是无限的，但“可能是无限的”），不管系统的复杂程度如何，只要给我们足够的时间进行收敛，MCMC算法都将找到低成本的解决方案。 <br><br> 对状态空间的这种研究是随机优化的标准技术，并且在机器学习等领域有许多应用。 <br><br><h3> 吉布斯分布 </h3><br> 注意：如果您不清楚此部分，可以安全地跳过它。 您仍然可以利用系统的实施。 <br><br> 在确定了可能情况的成本之后，我们如何确定这种情况的可能性？ <br><br> 解决方案： <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">Gibbs分布</a>是给定约束集的最大熵分布。 <br><br> 从本质上讲，这意味着如果我们对系统的概率设置许多约束，则吉布斯分布将创建有关分布形状的“最少假设”。 <br><br> 注意：吉布斯分布也是对约束变化敏感度最低的分布（根据Kullback-Leibler散度度量标准）。 <br><br> 我们对状态分布施加的唯一限制是成本函数，因此我们在Gibbs分布中使用它来计算状态之间的转移概率： <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>e</mi><mi>x</mi><mi>p</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>R</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>j</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo>&amp;#x2212;</mo><mi>R</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><mi>i</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>T</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow><mo>&amp;#x2217;</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>Z</mi><mi>i</mi></msub></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="50.436ex" height="2.66ex" viewBox="0 -780.1 21715.6 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="345" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-3D" x="1556" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-65" x="2862" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-78" x="3329" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-70" x="3901" y="0"></use><g transform="translate(4405,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-2212" x="5457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-66" x="6707" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-72" x="7258" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-61" x="7709" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-63" x="8239" y="0"></use><g transform="translate(8672,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-52" x="0" y="0"></use><g transform="translate(759,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="1589" y="0"></use><g transform="translate(2001,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-2212" x="3054" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-52" x="4054" y="0"></use><g transform="translate(4814,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="5644" y="0"></use><g transform="translate(5989,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-54" x="15492" y="0"></use><g transform="translate(16197,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-2217" x="17249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-66" x="18222" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-72" x="18772" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-61" x="19224" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-63" x="19753" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-31" x="20187" y="0"></use><g transform="translate(20687,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-5A" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="966" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mtext>&nbsp;</mtext><mi>e</mi><mi>x</mi><mi>p</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mo>−</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo>−</mo><mi>R</mi><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mi>T</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow><mo>∗</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>Z</mi><mi>i</mi></msub></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-4"> P_ {ij} = \ exp（-\ frac {R（j）-R（i）} {T}）* \ frac {1} {Z_i} </script></p><br> 其中Z是从状态i开始的过渡集合的分区函数。 这是一个标准化因子，可确保任何状态的转移概率之和为1。 <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msub><mi>m</mi><mi>j</mi></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF08;</mo></mrow><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mi>j</mi></mrow></msub><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;#xFF09;</mo></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="18.261ex" height="2.66ex" viewBox="0 -780.1 7862.5 1145.2" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-5A" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="966" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMAIN-3D" x="1305" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-73" x="2611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-75" x="3081" y="0"></use><g transform="translate(3653,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="1242" y="-213"></use></g><g transform="translate(4924,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">（</text></g><g transform="translate(5754,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=https://habr.com/ru/post/475764/&amp;usg=ALkJrhi4qxjmbKEHhTx5QSSX8I7QJ8QiRw#MJMATHI-6A" x="345" y="0"></use></g></g><g transform="translate(7032,0)"><text font-family="STIXGeneral,'Arial Unicode MS',serif" stroke="none" transform="scale(51.874) matrix(1 0 0 -1 0 0)">）</text></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>Z</mi><mi>i</mi></msub><mo>=</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msub><mi>m</mi><mi>j</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo>（</mo></mrow><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>j</mi></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo>）</mo></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> Z_i = \ sum_j（P_ {ij}）</script></p><br> 请注意，如果我们确定下一个状态将是相同状态，则相对成本为零，即归一化后的概率将为非零（由于具有指标的分布形状）！ 这意味着在许多转换中，必须包括状态不变的概率。 <br><br> 还值得注意的是，吉布斯分布由“计算温度” T参数化。 <br><br> 在状态空间研究中使用概率的关键优势之一是，系统可以执行到更昂贵状态的转换（因为它们具有非零转换概率），从而将算法转变为“非贪婪”优化方法。 <br><br> 请注意，随着温度趋于无穷大，任何单个跃迁的可能性都趋向于以这样一种方式统一：当状态的所有跃迁的概率集被归一化时，尽管它们的成本更高，但它们变得同等概率（或吉布斯分布接近正态分布）！ <br><br> 随着计算温度趋近于零，具有较低成本的转换变得更有可能，即，首选转换的可能性增加。 <br><br> 在进行状态空间的研究/优化时，我们逐渐降低温度。 该过程称为<a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u=">“模拟退火”</a> 。 因此，一开始我们可以轻松摆脱本地最小值，最后我们可以选择最佳解决方案。 <br><br> 当温度足够低时，除无过渡的可能性外，所有概率都趋于零！ <br><br> 这是因为仅不存在过渡具有零成本差异，即处于相同状态不依赖于温度。 由于在T = 0处的指数函数的形状，这成为具有非零值的唯一概率，也就是说，在归一化之后，它变成了单位。 因此，我们的系统将收敛到稳定点，不再需要进一步的冷却。 这是使用吉布斯分布的概率生成的不可或缺的特性。 <br><br> 可以通过更改冷却速度来调整系统的收敛过程！ <br><br> 如果冷却速度较慢，那么结果是我们通常会以较低的成本（在一定程度上）得出解决方案，但要付出更多的收敛步骤。 如果冷却速度更快，那么早期的系统更有可能陷入成本较高的次区域的陷阱，也就是说，我们将获得“次优”的结果。 <br><br> 因此，马尔可夫过程不仅会产生随机结果，而且还会尝试产生“良好”结果，并且很有可能成功！ <br><br> 根据任意成本函数的定义，不必存在唯一的最优值。 这种概率优化方法仅生成接近最佳值的方法，试图使成本函数最小化，并且由于抽样，每次生成的结果都不同（如果随机数生成器的种子不同）。 <br><br> 可以使用逆变换方法对离散过渡集的质量分布函数执行采样过程本身。 稍后，我将展示如何完成此操作。 <br><br><h3> 程序生成 </h3><br> 此方法对程序生成有何用处？ <br><br> 在某些系统中，通常很难定义产生良好结果的简单算法，尤其是在复杂系统的情况下。 <br><br> 设置任意的生成规则不仅困难，而且仅受我们的想象力和边界案例处理的限制。 <br><br> 如果系统满足一组特定的要求，那么MCMC的使用将使我们不必担心算法或规则的选择。 相反，我们定义了一种生成任何可能结果的方法，并根据其“评估”自觉地选择一个好的结果。 <br><br> 提出以下要求： <br><br><ul><li> 系统可以处于离散（可能是无限）状态配置。 </li><li> 我们可以定义状态之间的离散过渡。 </li><li> 我们可以设置一个成本函数来估计系统的当前状态。 </li></ul><br> 在我下面，我将给出一些其他示例，在我看来，可以应用此方法。 <br><br><h2> 实作 </h2><br><h3> 伪代码 </h3><br> 在我们的实现中，我们希望实现以下目标： <br><br><ul><li> 设置系统状态。 </li><li> 将所有可能的过渡设置为下一个状态。 </li><li> 计算当前状态的成本。 </li><li> 计算所有可能的下一个状态（或其子集）的成本。 </li><li> 使用吉布斯分布，计算转变的概率。 </li><li> 使用概率进行样本（样本）转换。 </li><li> 执行采样的过渡。 </li><li> 降低计算温度。 </li><li> 重复步骤，直到获得满意的结果。 </li></ul><br>  MCMC算法以伪代码的形式如下： <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// MCMC    T = 200; //     State s = initialState(); Transitions t[n] = {...} //n   thresh = 0.01; //  ( ) // ,      while(T &gt; thresh){ //    curcost = costfunc(s); newcost[n] = {0}; // newcost   0 probability[n] = {0}; //     0 //  for(i = 0; i &lt; n; i++){ newcost[i] = costfunc(doTransition(s, t[i])); probability[i] = exp(-(newcost[i] - curcost)/T); } //  probability /= sum(probability); //  sampled = sample_transition(t, probability); //  s = doTransition(s, sampled); //  T *= 0.975; }</span></span></code> </pre> <br><h3>  3D建筑物生成 </h3><br><h4> 状态空间与过渡 </h4><br> 为了生成3D建筑物，我生成了许多具有边界框指定体积的房间。 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Volume</span></span></span><span class="hljs-class">{</span></span> <span class="hljs-comment"><span class="hljs-comment">//   glm::vec3 a; glm::vec3 b; void translate(glm::vec3 shift); int getVol(); }; //   int Volume::getVol(){ return abs((bx-ax)*(by-ay)*(bz-az)); } //    void Volume::translate(glm::vec3 shift){ a += shift; b += shift; }</span></span></code> </pre> <br> 如果我生成n个房间，则系统的状态是3D空间中边框的配置。 <br><br> 应该注意的是，这些卷的可能配置是无止境的，但无穷无尽的（它们可以在无限长的时间内列出）！ <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//  (  !) std::vector&lt;Volume&gt; rooms; // N  for(int i = 0; i &lt; n; i++){ //  Volume x; xa = glm::vec3(0); xb = glm::vec3(rand()%4+5); //   //  . rooms.push_back(x); } //...</span></span></code> </pre> <br> 许多可能的转换是将房间在六个空间方向之一上移动一步，包括不进行转换： <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//... //   std::array&lt;glm::vec3, 7&gt; moves = { glm::vec3( 0, 0, 0), //   ! glm::vec3( 1, 0, 0), glm::vec3(-1, 0, 0), glm::vec3( 0, 1, 0), glm::vec3( 0,-1, 0), glm::vec3( 0, 0, 1), glm::vec3( 0, 0,-1), }; //...</span></span></code> </pre> <br> 注意：重要的是要使系统能够保持其当前状态！ <br><br><h4> 成本函数 </h4><br> 我希望3D空间中的体积表现得像“磁铁”，即： <br><br><ul><li> 如果它们的体积相交，那么这是不好的。 </li><li> 如果它们的表面接触，则很好。 </li><li> 如果他们根本不触摸，那就不好了。 </li><li> 如果他们碰到地板，那很好。 </li></ul><br> 对于3D空间中的两个长方体，我们可以轻松地定义一个边界框： <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Volume </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">boundingBox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Volume v1, Volume v2)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   Volume bb; //   bb.ax = (v1.ax &lt; v2.ax)?v1.ax:v2.ax; bb.ay = (v1.ay &lt; v2.ay)?v1.ay:v2.ay; bb.az = (v1.az &lt; v2.az)?v1.az:v2.az; //   bb.bx = (v1.bx &gt; v2.bx)?v1.bx:v2.bx; bb.by = (v1.by &gt; v2.by)?v1.by:v2.by; bb.bz = (v1.bz &gt; v2.bz)?v1.bz:v2.bz; return bb; }</span></span></code> </pre> <br> 使用体积的边界框，我们可以计算一个3D向量，该向量为我提供有关两个体积的交点的信息。 <br><br> 如果平行六面体沿一侧的长度大于沿该侧的两个体积的长度之和，则它们从该侧不接触。 如果它们相等，则曲面相接触；如果它们相等，则曲面相交。 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    3  glm::vec3 overlapVolumes(Volume v1, Volume v2){ //      Volume bb = boundingBox(v1, v2); //  glm::vec3 ext1 = glm::abs(v1.b - v1.a); // v1  3  glm::vec3 ext2 = glm::abs(v2.b - v2.a); // v2  3  glm::vec3 extbb = glm::abs(bb.b - bb.a); //   //  return ext1 + ext2 - extbb; }</span></span></code> </pre> <br> 该代码用于计算我形成加权量的数量，最终将其用作成本。 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">volumeCostFunction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">vector</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;Volume&gt; rooms)</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">// int metric[6] = { 0, //   0, //   0, //     0, //     0, // ,   0};//    int weight[6] = {2, 4, -5, -5, -5, 5}; //    for(unsigned int i = 0; i &lt; rooms.size(); i++){ //     for(unsigned int j = 0; j &lt; rooms.size(); j++){ //    ,  . if(i == j) continue; //    . glm::vec3 overlap = overlapVolumes(rooms[i], rooms[j]); //   glm::vec3 posOverlap = glm::clamp(overlap, glm::vec3(0), overlap); metric[0] += glm::abs(posOverlap.x*posOverlap.y*posOverlap.z); //   //   glm::vec3 negOverlap = glm::clamp(overlap, overlap, glm::vec3(0)); metric[1] += glm::abs(negOverlap.x*negOverlap.y*negOverlap.z); //   //   if(overlap.y == 0){ metric[2] += overlap.x*overlap.z; } //   (X) if(overlap.x == 0){ //      0,   , .. overlap.z = 0 metric[3] += overlap.z*overlap.y; } //   (Z) if(overlap.z == 0){ //      0,   , .. overlap.x = 0 metric[4] += overlap.x*overlap.y; } } //  ,   -   . if(rooms[i].ay == 0){ //  ,  ,    . metric[4] += rooms[i].ax*rooms[i].az; } //,     ! if(rooms[i].ay &lt; 0){ //,        if(rooms[i].by &lt; 0){ metric[5] += rooms[i].getVol(); } else{ metric[5] += abs(rooms[i].ay)*(rooms[i].bz-rooms[i].az)*(rooms[i].bx-rooms[i].ax); } } } // Metric * Weights return metric[0]*weight[0] + metric[1]*weight[1] + metric[2]*weight[2] + metric[3]*weight[3] + metric[4]*weight[4] + metric[5]*weight[5]; }</span></span></code> </pre> <br> 注意：“正相交体积”是指实际相交的体积。  “负相交体积”表示它们根本不接触，并且相交由位于3D空间中两个长方体的两个最近点之间的空间中的体积定义。 <br><br> 权重的选择应优先考虑一件事，而对另一件事要罚款。 例如，在这里，我对位于地板下的房间进行了严格的罚款，同时还提高了其表面接触的那些建筑物的优先级（比对体积的交点进行罚款还要多）。 <br><br> 我为所有成对的房间生成成本，而忽略与自己配对的房间。 <br><br><h4> 寻找低成本解决方案 </h4><br> 如伪代码中所述执行收敛。 进行过渡时，我一次只能移动一个房间。 这意味着对于n个房间和7个可能的过渡，我需要计算7 * n个概率，然后从所有这些中选择，仅移动那个房间，这<em>可能是</em>最可取的。 <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">//  float T = 250; while(T &gt; 0.1){ //   std::vector&lt;std::array&lt;double, moves.size()&gt;&gt; probabilities; //   () int curEnergy = volumeCostFunction(rooms); //      ... for(int i = 0; i &lt; n; i++){ //    std::array&lt;double, moves.size()&gt; probability; //      ,     for(unsigned int m = 0; m &lt; moves.size(); m++){ //        . rooms[i].translate(moves[m]); //      ! probability[m] = exp(-(double)(volumeCostFunction(rooms) - curEnergy)/T); //   rooms[i].translate(-moves[m]); } //       probabilities.push_back(probability); } //  ( ) double Z = 0; for(unsigned int i = 0; i &lt; probabilities.size(); i++){ for(unsigned int j = 0; j &lt; probabilities[i].size(); j++){ Z += probabilities[i][j]; } } //  for(unsigned int i = 0; i &lt; probabilities.size(); i++){ for(unsigned int j = 0; j &lt; probabilities[i].size(); j++){ probabilities[i][j] /= Z; } } //    (CDF) ( ) std::vector&lt;double&gt; cdf; for(unsigned int i = 0; i &lt; probabilities.size(); i++){ for(unsigned int j = 0; j &lt; probabilities[i].size(); j++){ if(cdf.empty()) cdf.push_back(probabilities[i][j]); else cdf.push_back(probabilities[i][j] + cdf.back()); } } //      std::random_device rd; std::mt19937 e2(rd()); std::uniform_real_distribution&lt;&gt; dist(0, 1); double uniform = dist(e2); int sampled_index = 0; //   CDF for(unsigned int i = 0; i &lt; cdf.size(); i++){ //    ,   ... if(cdf[i] &gt; uniform){ sampled_index = i; break; } } //     int _roomindex = sampled_index/moves.size(); int _moveindex = sampled_index%moves.size(); //  rooms[_roomindex].translate(moves[_moveindex]); // T T *= 0.99; // !!! } //!! //...</span></span></code> </pre> <br>             ;    «  ». <br><br>       ,      (cumulative distribution function, CDF).             0  1.     CDF  ,   ,     «    CDF       »,      .  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/960/9fe/3cd/9609fe3cdc3a514c34ed2d8e128d8629.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代替连续功能，可能会有不连续的步骤。</font><font style="vertical-align: inherit;">更多细节可以在</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读</font><font style="vertical-align: inherit;">。</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外，我在3D空间中有房间体积数据！</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我使用它们使用blueprint类将主题应用于已知的批量数据，以生成“模式”。</font><font style="vertical-align: inherit;">这样房屋就可以出现了。</font><font style="vertical-align: inherit;">先前的文章[ </font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]（</font><font style="vertical-align: inherit;">Habré的</font></font><a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=zh-CN&amp;u="><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">翻译</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）中</font><font style="vertical-align: inherit;">描述了蓝图类</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有关从这些卷中完整生成房屋的信息，请参见源代码。</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 结果 </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种广义方法的结果非常好。</font><font style="vertical-align: inherit;">我唯一需要设置的是成本函数中正确的优先级和惩罚权重。</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/152/06b/acc/15206bacc91b6635a0f286fa21998363.gif" width="562" height="562"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此算法的建筑生成的几个示例以及适用于它们的主题。</font></font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/62d/1ee/92c/62d1ee92c2f422d79c27c14532346855.gif"></div><br> <i>  ( ).</i> <br><br>     ,      (3-5),           . <br><br>         ,      3D- ,      MCMC. <br><br>     ,    ,           ,       .  ,         ,   . <br><br>          .    (  ). <br><br><h2>     </h2><br> ,     3D-    2D-,      . <br><br>        ,        2D-    —        ,    . <br><br>         ,     ,      ,     ,   ,      . <br><br>        MCMC,           ,       (             ,  ..). <br><br>   : <br><br><ul><li>  ;       ,    /   . </li><li>  ,          ,    ,   . </li><li> ,  ! </li></ul><br>  :     MCMC     ,  « »,  NP- .   —  ,      ,   —  ! <br><br><h2>   Task- </h2><br> ,     task-           . <br><br>   ,    ,   : <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;"> 您的浏览器不支持HTML5视频。 <source src="http://weigert.vsos.ethz.ch/wp-content/uploads/2019/10/bot_the_builder3.mp4" type="video/mp4"></video></div></div></div><br> <i>      ( ,     ).    .        (   )     .   ,    .            ,       .    - ,     , .</i> </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/zh-CN475764/">https://habr.com/ru/post/zh-CN475764/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../zh-CN475754/index.html">关于Scrum的短裤</a></li>
<li><a href="../zh-CN475756/index.html">食品设计文摘2019年10月</a></li>
<li><a href="../zh-CN475758/index.html">iOS应用程序中的自动续订订阅级别</a></li>
<li><a href="../zh-CN475760/index.html">初级开发人员-我们为什么雇用他们以及我们如何与他们合作</a></li>
<li><a href="../zh-CN475762/index.html">带有照片的简历飞入an。 美国求职的特点</a></li>
<li><a href="../zh-CN475770/index.html">斯坦福大学-访问和评论</a></li>
<li><a href="../zh-CN475772/index.html">工业物联网的6个应用点</a></li>
<li><a href="../zh-CN475774/index.html">“这些愚蠢的规则会惹恼每个人”：讨论密码字段实践</a></li>
<li><a href="../zh-CN475776/index.html">自己动手代表三把吉他</a></li>
<li><a href="../zh-CN475778/index.html">WebAssembly：什么以及如何</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>