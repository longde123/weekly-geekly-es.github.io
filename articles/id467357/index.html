<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>👉🏼 ↙️ 🕴🏾 PVS-Studio di Awan: Azure DevOps 💿 👨‍👩‍👦 🧖🏾</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ini adalah artikel kedua, yang berfokus pada penggunaan penganalisa PVS-Studio dalam sistem cloud CI. Kali ini kami akan mempertimbangkan platform Azu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>PVS-Studio di Awan: Azure DevOps</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/company/pvs-studio/blog/467357/"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b53/5ba/6e6/b535ba6e6cf6250ad0c89d5315918d38.png" alt="Gambar 9"></div><br>  Ini adalah artikel kedua, yang berfokus pada penggunaan penganalisa PVS-Studio dalam sistem cloud CI.  Kali ini kami akan mempertimbangkan platform Azure DevOps - solusi cloud CI \ CD dari Microsoft.  Kami akan menganalisis proyek ShareX. <br><a name="habracut"></a><br>  Kami membutuhkan tiga komponen.  Yang pertama adalah analisa PVS-Studio.  Yang kedua adalah Azure DevOps, yang akan kami integrasikan dengan analyzer.  Yang ketiga adalah proyek yang akan kami periksa untuk menunjukkan kemampuan PVS-Studio saat bekerja di cloud.  Jadi ayo pergi. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">PVS-Studio</a> adalah penganalisa kode statis untuk menemukan kesalahan dan cacat keamanan.  Alat ini mendukung analisis kode C, C ++ dan C #. <br><br>  <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Azure DevOps</a> .  Platform Azure DevOps mencakup alat-alat seperti Azure Pipeline, Azure Board, Azure Artifacts dan lainnya yang mempercepat proses pembuatan perangkat lunak dan meningkatkan kualitasnya. <br><br>  ShareX adalah aplikasi gratis yang memungkinkan Anda menangkap dan merekam bagian mana pun dari layar.  Proyek ini ditulis dalam C # dan sangat cocok untuk menunjukkan konfigurasi peluncuran analisa statis.  Kode sumber proyek <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tersedia di GitHub</a> . <br><br>  Output dari perintah cloc untuk proyek ShareX: <br><div class="scrollable-table"><table><tbody><tr><td> Bahasa <br></td><td>  file <br></td><td>  kosong <br></td><td>  komentar <br></td><td>  Kode <br></td></tr><tr><td>  C # <br></td><td>  696 <br></td><td>  20658 <br></td><td>  24423 <br></td><td>  102565 <br></td></tr><tr><td>  Skrip MSBuild <br></td><td>  11 <br></td><td>  1 <br></td><td>  77 <br></td><td>  5859 <br></td></tr></tbody></table></div>  Dengan kata lain, proyek ini kecil, tetapi cukup memadai untuk menunjukkan karya PVS-Studio bersama dengan platform cloud. <br><br><h2>  Mari kita mulai konfigurasi </h2><br>  Untuk mulai bekerja di Azure DevOps, mari ikuti <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">tautan</a> dan tekan "Mulai gratis dengan GitHub". <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0dc/3d3/8d0/0dc3d38d0375af0a89db1b7be1b4f284.png" alt="Gambar 2"></div><br>  Berikan akses aplikasi Microsoft ke data akun GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b38/543/12b/b3854312bb046df2c1dd50d2025a0b25.png" alt="Gambar 1"></div><br>  Anda harus membuat akun Microsoft untuk menyelesaikan pendaftaran Anda. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8f5/7a9/878/8f57a9878354a257a8ca68261b5b472a.png" alt="Gambar 12"></div><br>  Setelah mendaftar, buat proyek: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e69/a61/59a/e69a6159ac5c51089e075c37fc5e2465.png" alt="Gambar 5"></div><br>  Selanjutnya, kita perlu pindah ke "Pipeline" - "Builds" dan membuat pipeline Build baru. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fa/4d2/751/2fa4d27513aaf869962e11b9ea37214b.png" alt="Gambar 8"></div><br>  Ketika ditanya di mana kode kami berada, kami akan menjawab - GitHub. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a80/787/363/a80787363d8b260b9aac0ac64c66aeaf.png" alt="Gambar 13"></div><br>  Otorisasi Azure Pipelines dan pilih repositori dengan proyek, yang untuknya kami akan mengkonfigurasi menjalankan penganalisa statis. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c1/df6/47e/1c1df647e46b8445c43b9cf39968d7ed.png" alt="Gambar 7"></div><br>  Di jendela pemilihan templat, pilih "Starter pipeline." <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8ac/11d/09f/8ac11d09f180433fe9e14a6279f2a059.png" alt="Gambar 17"></div><br>  Kami dapat menjalankan analisis kode statis proyek dengan dua cara: menggunakan agen yang dihosting oleh Microsoft atau di-host sendiri. <br><br>  Pertama, kami akan menggunakan agen yang dihosting oleh Microsoft.  Agen tersebut adalah mesin virtual biasa yang diluncurkan ketika kami menjalankan pipa kami.  Mereka dihapus ketika tugas selesai.  Penggunaan agen tersebut memungkinkan kami untuk tidak membuang waktu untuk dukungan dan pembaruan mereka, tetapi memberlakukan batasan tertentu, misalnya - ketidakmampuan untuk menginstal perangkat lunak tambahan yang digunakan untuk membangun proyek. <br><br>  Mari kita ganti konfigurasi default yang disarankan untuk yang berikut untuk menggunakan agen yang dihosting oleh Microsoft: <br><br><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta"># Setting up run triggers # Run only for changes in the master branch trigger: - master # Since the installation of random software in virtual machines # is prohibited, we'll use a Docker container, # launched on a virtual machine with Windows Server 1803 pool: vmImage: 'win1803' container: microsoft/dotnet-framework:4.7.2-sdk-windowsservercore-1803 steps: # Download the analyzer distribution - task: PowerShell@2 inputs: targetType: 'inline' script: 'Invoke-WebRequest -Uri https://files.viva64.com/PVS-Studio_setup.exe -OutFile PVS-Studio_setup.exe' - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | # Restore the project and download dependencies nuget restore .\ShareX.sln # Create the directory, where files with analyzer reports will be saved md .\PVSTestResults # Install the analyzer PVS-Studio_setup.exe /VERYSILENT /SUPPRESSMSGBOXES /NORESTART /COMPONENTS=Core # Create the file with configuration and license information "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" credentials -u $(PVS_USERNAME) -n $(PVS_KEY) # Run the static analyzer and convert the report in html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog # Save analyzer reports - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  <b>Catatan:</b> menurut <a href="">dokumentasi</a> , wadah yang digunakan harus di-cache dalam gambar mesin virtual, tetapi pada saat penulisan artikel itu tidak berfungsi dan wadah diunduh setiap kali tugas dimulai, yang berdampak negatif pada waktu eksekusi. <br><br>  Mari kita simpan pipeline dan buat variabel yang akan digunakan untuk membuat file lisensi.  Untuk melakukan ini, buka jendela edit pipa dan klik "Variabel" di sudut kanan atas. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/be8/bc0/e1c/be8bc0e1c3555c6375eac94465d27b9d.png" alt="Gambar 14"></div><br>  Kemudian, tambahkan dua variabel - <i>PVS_USERNAME</i> dan <i>PVS_KEY</i> , masing-masing berisi nama pengguna dan kunci lisensi.  Saat membuat variabel <i>PVS_KEY</i> jangan lupa untuk memilih "Rahasiakan nilai ini" untuk mengenkripsi nilai variabel dengan kunci RSA 2048-bit dan untuk menekan output dari nilai variabel dalam log kinerja tugas. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/996/1e3/35e/9961e335e18b368820d930f14f01d796.png" alt="Gambar 15"></div><br>  Simpan variabel dan jalankan pipeline dengan mengklik "Run". <br><br>  Opsi kedua untuk menjalankan analisis - gunakan agen yang di-host-sendiri.  Kami dapat menyesuaikan dan mengelola sendiri agen yang dihosting sendiri.  Agen tersebut memberikan lebih banyak peluang untuk menginstal perangkat lunak, yang diperlukan untuk membangun dan menguji produk perangkat lunak kami. <br><br>  Sebelum menggunakan agen tersebut, Anda harus mengonfigurasinya sesuai dengan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">instruksi</a> dan menginstal dan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengkonfigurasi</a> analisa statis. <br><br>  Untuk menjalankan tugas pada agen yang di-host-sendiri, kami akan mengganti konfigurasi yang disarankan dengan yang berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta"># Setting up triggers # Run the analysis for master-branch trigger: - master # The task is run on a self-hosted agent from the pool 'MyPool' pool: 'MyPool' steps: - task: CmdLine@2 inputs: workingDirectory: $(System.DefaultWorkingDirectory) script: | # Restore the project and download dependencies nuget restore .\ShareX.sln # Create the directory where files with analyzer reports will be saved md .\PVSTestResults # Run the static analyzer and convert the report in html. "C:\Program Files (x86)\PVS-Studio\PVS-Studio_Cmd.exe" -t .\ShareX.sln -o .\PVSTestResults\ShareX.plog "C:\Program Files (x86)\PVS-Studio\PlogConverter.exe" -t html -o .\PVSTestResults\ .\PVSTestResults\ShareX.plog # Save analyzer reports - task: PublishBuildArtifacts@1 inputs: pathToPublish: PVSTestResults artifactName: PVSTestResults</span></span></code> </pre> <br>  Setelah tugas selesai, Anda dapat mengunduh arsip dengan laporan penganalisa di bawah tab "Ringkasan" atau Anda dapat menggunakan ekstensi <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Kirim Email</a> yang memungkinkan untuk mengonfigurasi email atau mempertimbangkan alat lain yang nyaman di <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">Marketplace</a> . <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/529/df2/932/529df29320ae9e253462e42fe2bfd596.png" alt="Gambar 21"></div><br><h2>  Hasil analisis </h2><br>  Sekarang mari kita lihat beberapa bug yang ditemukan di proyek yang diuji, ShareX. <br><br>  <b>Pemeriksaan berlebihan</b> <br><br>  Untuk melakukan pemanasan, mari kita mulai dengan kelemahan sederhana dalam kode, yaitu, dengan pemeriksaan berlebihan: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PbThumbnail_MouseMove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, MouseEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... IDataObject dataObject = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataObject(DataFormats.FileDrop, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>[] { Task.Info.FilePath }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dataObject != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; dragBoxFromMouseDown = Rectangle.Empty; pbThumbnail.DoDragDrop(dataObject, DragDropEffects.Copy | DragDropEffects.Move); Program.MainForm.AllowDrop = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> [CWE-571] Ekspresi 'dataObject! = Null' selalu benar.  TaskThumbnailPanel.cs 415 <br><br>  Mari kita perhatikan pemeriksaan variabel <i>dataObject</i> untuk <i>null</i> .  Kenapa disini?  <i>dataObject</i> tidak boleh <i>nol</i> dalam kasus ini, karena ini diinisialisasi dengan referensi pada objek yang dibuat.  Akibatnya, kami melakukan pemeriksaan berlebihan.  Kritis?  Tidak.  Tampak ringkas?  Tidak.  Pemeriksaan ini jelas lebih baik dihapus agar tidak mengacaukan kode. <br><br>  Mari kita lihat fragmen kode lain yang bisa kita komentari dengan cara yang sama: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetDIBImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">MemoryStream ms</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(bmp); .... } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gcHandle != IntPtr.Zero) { GCHandle.FromIntPtr(gcHandle).Free(); } } .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Image </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImageAlternative</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (MemoryStream ms = dataObject.GetData(format) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MemoryStream) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ms != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Image img = GetDIBImage(ms); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (img != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { DebugHelper.WriteException(e); } } } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> [CWE-571] Ekspresi 'img! = Null' selalu benar.  ClipboardHelpers.cs 289 <br><br>  Dalam metode <i>GetImageAlternative</i> , variabel <i>img</i> diperiksa bahwa itu bukan nol tepat setelah instance baru dari kelas <i>Bitmap</i> dibuat.  Perbedaan dari contoh sebelumnya di sini adalah bahwa kita menggunakan metode <i>GetDIBImage</i> alih-alih konstruktor untuk menginisialisasi variabel <i>img</i> .  Penulis kode menyarankan bahwa pengecualian mungkin terjadi dalam metode ini, tetapi ia menyatakan hanya blok yang <i>mencoba</i> dan <i>akhirnya</i> , menghilangkan <i>tangkapan</i> .  Oleh karena itu, jika pengecualian terjadi, metode pemanggil <i>GetImageAlternative</i> tidak akan mendapatkan referensi ke objek dari tipe <i>Bitmap</i> , tetapi harus menangani pengecualian di blok <i>tangkapnya</i> sendiri.  Dalam hal ini, variabel <i>img</i> tidak akan diinisialisasi dan utas eksekusi bahkan tidak akan mencapai <i>img! =</i> Cek <i>kosong</i> tetapi akan masuk ke blok tangkap.  Akibatnya, penganalisa memang menunjuk ke pemeriksaan yang berlebihan. <br><br>  Mari kita perhatikan contoh peringatan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022 berikut</a> : <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btnCopyLink_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.Items[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lvClipboardFormats.SelectedItems.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { url = lvClipboardFormats.SelectedItems[<span class="hljs-number"><span class="hljs-number">0</span></span>].SubItems[<span class="hljs-number"><span class="hljs-number">1</span></span>].Text; } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> [CWE-571] Ekspresi 'lvClipboardFormats.SelectedItems.Count&gt; 0' selalu benar.  AfterUploadForm.cs 155 <br><br>  Mari kita lihat lebih dekat ekspresi kondisional kedua.  Di sana kami memeriksa nilai properti <i>Hitung</i> baca-saja.  Properti ini menunjukkan jumlah elemen dalam instance koleksi <i>SelectedItems</i> .  Kondisi ini hanya dijalankan jika properti <i>Count</i> lebih besar dari nol.  Itu semua akan baik-baik saja, tetapi di eksternal <i>jika</i> pernyataan <i>Count</i> sudah diperiksa untuk 0. Contoh koleksi <i>SelectedItems</i> tidak dapat memiliki jumlah elemen kurang dari nol, oleh karena itu, <i>Hitungan</i> sama atau lebih besar dari 0. Karena kita sudah sudah melakukan pemeriksaan <i>Count</i> untuk 0 di pernyataan <i>if</i> pertama dan itu salah, tidak ada gunanya untuk menulis cek <i>Count</i> lebih besar dari nol di cabang lain. <br><br>  Contoh terakhir dari peringatan <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3022</a> adalah potongan kode berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawCursorGraphics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Graphics g</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cursorOffsetX = <span class="hljs-number"><span class="hljs-number">10</span></span>, cursorOffsetY = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemGap = <span class="hljs-number"><span class="hljs-number">10</span></span>, itemCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; Size totalSize = Size.Empty; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> magnifierPosition = <span class="hljs-number"><span class="hljs-number">0</span></span>; Bitmap magnifier = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Options.ShowMagnifier) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) totalSize.Height += itemGap; .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> Ekspresi V3022 'itemCount&gt; 0' selalu salah.  RegionCaptureForm.cs 1100 <br><br>  Penganalisis memperhatikan bahwa <i>itemCount</i> kondisi <i>&gt; 0</i> akan selalu salah, karena variabel <i>itemCount</i> dideklarasikan dan pada saat yang sama ditetapkan nol di atas.  Variabel ini tidak digunakan di mana pun hingga kondisi tersebut, oleh karena itu penganalisa benar tentang ekspresi kondisional, yang nilainya selalu salah. <br><br>  Baiklah, sekarang mari kita lihat sesuatu yang benar-benar ganjil. <br><br>  <b>Cara terbaik untuk memahami bug adalah memvisualisasikan bug</b> <br><br>  Sepertinya kami menemukan kesalahan yang agak menarik di tempat ini: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pixelate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Bitmap bmp, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> pixelSize</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r = <span class="hljs-number"><span class="hljs-number">0</span></span>, g = <span class="hljs-number"><span class="hljs-number">0</span></span>, b = <span class="hljs-number"><span class="hljs-number">0</span></span>, a = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> weightedCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y2 = y; y2 &lt; yLimit; y2++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x2 = x; x2 &lt; xLimit; x2++) { ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight; } } .... ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount)); .... }</code> </pre> <br>  Saya tidak ingin menunjukkan semua kartu dan mengungkapkan apa yang ditemukan oleh analis kami, jadi mari kita kesampingkan sebentar. <br><br>  Dengan nama metode, mudah untuk menebak apa yang dilakukannya - Anda memberikannya gambar atau potongan gambar, dan itu menggandakannya.  Kode metode ini cukup panjang, jadi kami tidak akan mengutipnya sepenuhnya, tetapi coba jelaskan algoritmanya dan jelaskan bug apa yang berhasil ditemukan oleh PVS-Studio. <br><br>  Metode ini menerima dua parameter: objek jenis <i>Bitmap</i> dan nilai tipe <i>int</i> yang menunjukkan ukuran pikselasi.  Algoritma operasi cukup sederhana: <br><br>  1) Bagi fragmen gambar yang diterima ke dalam kotak dengan sisi sama dengan ukuran pixelation.  Misalnya, jika kita memiliki ukuran pixelation sama dengan 15, kita akan mendapatkan kotak, berisi 15x15 = 225 piksel. <br><br>  2) Selanjutnya, kami melintasi setiap piksel dalam kuadrat ini dan mengakumulasikan nilai bidang <i>Merah</i> , <i>Hijau</i> , <i>Biru</i> dan <i>Alpha</i> dalam variabel perantara, dan sebelum itu gandakan nilai warna yang sesuai dan saluran alfa dengan variabel <i>pixelWeight</i> , yang diperoleh oleh membagi nilai <i>Alpha</i> dengan 255 (variabel <i>Alpha</i> adalah tipe <i>byte</i> ).  Juga ketika melintasi piksel, kami menjumlahkan nilai-nilai, ditulis dalam <i>pixelWeight</i> ke dalam variabel <i>WeightedCount</i> .  Fragmen kode yang mengeksekusi tindakan di atas adalah sebagai berikut: <br><br><pre> <code class="cs hljs">ColorBgra color = unsafeBitmap.GetPixel(x2, y2); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>; r += color.Red * pixelWeight; g += color.Green * pixelWeight; b += color.Blue * pixelWeight; a += color.Alpha * pixelWeight; weightedCount += pixelWeight;</code> </pre> <br>  Omong-omong, perhatikan bahwa jika nilai variabel <i>Alpha</i> adalah nol, <i>pixelWeight</i> tidak akan menambah variabel <i>WeightedCount</i> nilai apa pun untuk piksel ini.  Kami akan membutuhkannya di masa depan. <br><br>  3) Setelah melintasi semua piksel dalam kuadrat saat ini, kami dapat membuat warna "rata-rata" yang umum untuk kuadrat ini.  Kode melakukan ini terlihat sebagai berikut: <br><br><pre> <code class="cs hljs">ColorBgra averageColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColorBgra((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(b / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(g / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(r / weightedCount), (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>)(a / pixelCount));</code> </pre> <br>  4) Sekarang ketika kita mendapatkan warna akhir dan menuliskannya dalam variabel <i>averageColor</i> , kita dapat kembali melintasi setiap piksel persegi dan memberikan nilai dari <i>averageColor</i> . <br><br>  5) Kembali ke poin 2 sementara kami memiliki kotak tidak tertangani. <br><br>  Sekali lagi, variabel <i>weightedCount</i> tidak sama dengan jumlah semua piksel dalam kuadrat.  Misalnya, jika gambar berisi piksel yang benar-benar transparan (nilai nol dalam saluran alfa), variabel <i>pixelWeight</i> akan menjadi nol untuk piksel ini ( <i>0/255</i> = 0).  Oleh karena itu, piksel ini tidak akan memengaruhi pembentukan variabel <i>WeightedCount</i> .  Ini cukup logis - tidak ada gunanya memperhitungkan warna akun piksel yang benar-benar transparan. <br><br>  Jadi semuanya masuk akal - pixelation harus bekerja dengan benar.  Dan itu benar-benar terjadi.  Itu tidak untuk gambar png yang menyertakan piksel dengan nilai di saluran alpha di bawah 255 dan tidak sama dengan nol.  Perhatikan gambar pixelated di bawah ini: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/460/17b/7b5/46017b7b58a5206d0a51620fcce1a16f.png" alt="Gambar 3"></div><br>  Sudahkah Anda melihat pixelation?  Kami juga tidak.  Oke, sekarang mari kita ungkapkan intrik kecil ini dan jelaskan di mana tepatnya bug itu bersembunyi di metode ini.  Kesalahan merayap ke baris perhitungan variabel <i>pixelWeight</i> : <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Faktanya adalah bahwa ketika mendeklarasikan variabel <i>pixelWeight</i> sebagai <i>float</i> , pembuat kode menyiratkan bahwa ketika membagi bidang <i>Alpha</i> dengan 255, ia akan mendapatkan angka fraksional selain nol dan satu.  Di sinilah masalahnya, karena variabel <i>Alpha</i> adalah tipe <i>byte</i> .  Saat menyelam dengan 255, kami mendapatkan nilai integer.  Hanya setelah itu akan secara implisit dilemparkan ke tipe <i>float</i> , yang berarti bahwa bagian pecahan hilang. <br><br>  Sangat mudah untuk menjelaskan mengapa tidak mungkin untuk pixelate gambar png dengan transparansi.  Karena untuk nilai piksel saluran alpha berada dalam kisaran 0 &lt;Alpha &lt;255, variabel <i>Alpha</i> dibagi dengan 255 akan selalu menghasilkan 0. Oleh karena itu, nilai variabel <i>pixelBerat</i> , <i>r</i> , <i>g</i> , <i>b</i> , <i>a</i> , <i>WeightedCount</i> juga akan selalu menjadi 0. Sebagai hasilnya, rata-rata <i>Warna</i> kami akan dengan nilai nol di semua saluran: merah - 0, biru - 0, hijau - 0, alfa - 0. Dengan mengecat kotak dalam warna ini, kami tidak mengubah warna asli piksel, karena rata-rata <i>Warna</i> benar-benar transparan.  Untuk memperbaiki kesalahan ini, kita hanya perlu secara eksplisit melemparkan bidang <i>Alpha</i> ke tipe <i>float</i> .  Versi tetap dari baris kode mungkin terlihat seperti ini: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> pixelWeight = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)color.Alpha / <span class="hljs-number"><span class="hljs-number">255</span></span>;</code> </pre> <br>  Nah, sudah saatnya mengutip pesan PVS-Studio untuk kode yang salah: <br><br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3041</a> [CWE-682] Ungkapan itu secara implisit dilemparkan dari tipe 'int' ke tipe 'float'.  Pertimbangkan untuk menggunakan pemeran tipe eksplisit untuk menghindari hilangnya bagian fraksional.  Contoh: double A = (double) (X) / Y;  ImageHelpers.cs 1119 <br><br>  Sebagai perbandingan, mari kita kutip tangkapan layar dari gambar yang benar-benar pixelated, diperoleh pada versi aplikasi yang diperbaiki: <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/977/0bc/e73/9770bce73229e72b6781f0349128aa3e.png" alt="Gambar 6"></div><br>  <b>Potensi NullReferenceException</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddMetadata</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Image img, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { .... pi.Value = bytesText; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pi != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { img.SetPropertyItem(pi); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3095</a> [CWE-476] Objek 'pi' digunakan sebelum diverifikasi terhadap null.  Periksa baris: 801, 803. ImageHelpers.cs 801 <br><br>  Fragmen kode ini menunjukkan bahwa penulis berharap bahwa variabel <i>pi</i> dapat menjadi <i>nol</i> , itu sebabnya sebelum memanggil metode <i>SetPropertyItem</i> , centang <i>pi! = Null</i> terjadi.  Sungguh aneh bahwa sebelum pemeriksaan ini properti diberi array byte, karena jika <i>pi</i> <i>nol</i> , pengecualian dari tipe <i>NullReferenceException</i> akan dibuang. <br><br>  Situasi serupa telah terjadi di tempat lain: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Task_TaskCompleted</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">WorkerTask task</span></span></span><span class="hljs-function">)</span></span> { .... task.KeepImage = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.RequestSettingUpdate) { Program.MainForm.UpdateCheckStates(); } .... } .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3095</a> [CWE-476] Objek 'tugas' digunakan sebelum diverifikasi terhadap nol.  Periksa baris: 268, 270. TaskManager.cs 268 <br><br>  PVS-Studio menemukan kesalahan serupa lainnya.  Intinya sama, jadi tidak ada kebutuhan besar untuk mengutip fragmen kode, pesan analisa akan cukup. <br><br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3095</a> [CWE-476] Objek 'Config.PhotobucketAccountInfo' digunakan sebelum diverifikasi dengan null.  Periksa baris: 216, 219. UploadersConfigForm.cs 216 <br><br>  <b>Nilai pengembalian yang sama</b> <br><br>  Fragmen kode yang mencurigakan ditemukan dalam metode <i>EvalWindows</i> dari kelas <i>WindowsList</i> , yang mengembalikan <i>true</i> dalam semua kasus: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WindowsList</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;IntPtr&gt; IgnoreWindows { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;IntPtr&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WindowsList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr ignoreWindow</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { IgnoreWindows.Add(ignoreWindow); } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EvalWindows</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr hWnd, IntPtr lParam</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IgnoreWindows.Any(window =&gt; hWnd == window)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } windows.Add(new WindowInfo(hWnd)); return true; // &lt;= } }</span></span></code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3009</a> Aneh bahwa metode ini selalu mengembalikan satu dan nilai 'benar' yang sama.  WindowsList.cs 82 <br><br>  Di tampak logis bahwa jika dalam daftar bernama <i>IgnoreWindows</i> ada pointer dengan nama yang sama dengan <i>hWnd</i> , metode tersebut harus mengembalikan <i>false</i> . <br><br>  Daftar <i>IgnoreWindows</i> dapat diisi baik ketika memanggil konstruktor <i>WindowsList (IntPtr ignWindow)</i> atau langsung melalui mengakses properti sebagai milik umum.  Lagi pula, menurut Visual Studio, saat ini dalam kode daftar ini tidak diisi.  Ini adalah tempat aneh lain dari metode ini. <br><br>  <b>Panggilan penangan acara yang tidak aman</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (NewsLoaded != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { NewsLoaded(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); } }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3083</a> [CWE-367] Doa yang tidak aman dari acara 'NewsLoaded', NullReferenceException dimungkinkan.  Pertimbangkan menugaskan acara ke variabel lokal sebelum menjalankannya.  NewsListControl.cs 111 <br><br>  Di sini kasus yang sangat buruk mungkin terjadi.  Setelah memeriksa variabel <i>NewsLoaded</i> untuk null, metode yang menangani acara, dapat berhenti berlangganan, misalnya, di utas lain.  Dalam hal ini, pada saat kita masuk ke tubuh pernyataan if, variabel <i>NewsLoaded</i> akan menjadi nol.  <i>NullReferenceException</i> mungkin terjadi ketika mencoba memanggil pelanggan dari acara <i>NewsLoaded</i> , yang nol.  Jauh lebih aman menggunakan operator bersyarat nol dan menulis ulang kode di atas sebagai berikut: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnNewsLoaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { NewsLoaded?.Invoke(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); }</code> </pre> <br>  Alat analisis menunjuk <b>68</b> fragmen yang serupa.  Kami tidak akan menjelaskan semuanya - mereka semua memiliki pola panggilan yang sama. <br><br>  <b>Kembalikan null dari ToString</b> <br><br>  Baru-baru ini saya menemukan dari <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u="><u>artikel yang menarik</u></a> dari rekan saya bahwa Microsoft tidak merekomendasikan pengembalian nol dari metode <i>ToString yang</i> ditimpa.  PVS-Studio sangat menyadari hal ini: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">lock</span></span> (loggerLock) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sbMessages != <span class="hljs-literal"><span class="hljs-literal">null</span></span> &amp;&amp; sbMessages.Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sbMessages.ToString(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3108</a> Tidak disarankan untuk mengembalikan 'null' dari metode 'ToSting ()'.  Logger.cs 167 <br><br>  <b>Kenapa ditugaskan jika tidak digunakan?</b> <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> SeafileCheckAccInfoResponse </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetAccountInfo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"account/info/?format=json"</span></span>); .... }</code> </pre> <br>  <b>Peringatan PVS-Studio:</b> <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">V3008 Variabel</a> 'url' diberi nilai dua kali berturut-turut.  Mungkin ini sebuah kesalahan.  Periksa baris: 197, 196. Seafile.cs 197 <br><br>  Seperti yang dapat kita lihat dari contoh, ketika mendeklarasikan variabel <i>url</i> , ia diberi nilai, dikembalikan dari metode <i>FixPrefix</i> .  Di baris berikutnya, kami menghapus nilai yang diperoleh bahkan tanpa menggunakannya di mana pun.  Kami mendapatkan sesuatu yang mirip dengan kode mati: itu berfungsi, tetapi tidak mempengaruhi hasilnya.  Kemungkinan besar, kesalahan ini adalah hasil dari copy-paste, karena fragmen kode tersebut terjadi di 9 metode lainnya.  Sebagai contoh, kami akan mengutip dua metode dengan baris pertama yang serupa: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAuthToken</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"auth/ping/?format=json"</span></span>); .... } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckAPIURL</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> url = URLHelpers.FixPrefix(APIURL); url = URLHelpers.CombineURL(APIURL, <span class="hljs-string"><span class="hljs-string">"ping/?format=json"</span></span>); .... }</code> </pre> <br><h2>  Kesimpulan </h2><br>  Seperti yang dapat kita lihat, kompleksitas konfigurasi pemeriksaan penganalisis otomatis tidak bergantung pada sistem CI yang dipilih.  Kami benar-benar membutuhkan 15 menit dan beberapa klik mouse untuk mengonfigurasi pemeriksaan kode proyek kami dengan penganalisa statis. <br><br>  Sebagai kesimpulan, kami mengundang Anda untuk <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=id&amp;u=">mengunduh dan mencoba penganalisa</a> pada proyek Anda. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/id467357/">https://habr.com/ru/post/id467357/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../id467345/index.html">Hit blog IT dan pelatihan 4 lapis: wawancara dengan Sergei Abdulmanov dari Mosigra</a></li>
<li><a href="../id467347/index.html">Buku “Membuat kontrak pintar Solidity untuk blockchain Ethereum. Panduan Praktis</a></li>
<li><a href="../id467349/index.html">Memindahkan seorang programmer ke Estonia: bekerja, uang, dan biaya hidup</a></li>
<li><a href="../id467353/index.html">Metode Optimasi Kode untuk Redd. Bagian 1: efek cache</a></li>
<li><a href="../id467355/index.html">Wawancara dengan peneliti pasar dan tren pengembangan perangkat lunak di Eropa Tengah dan Timur, Eugene Schwab-Chesaru</a></li>
<li><a href="../id467359/index.html">PVS-Studio pergi ke awan: Azure DevOps</a></li>
<li><a href="../id467361/index.html">Kami lupa tentang delegasi dalam JavaScript. Delegasi acara di bereaksi</a></li>
<li><a href="../id467363/index.html">Menggunakan fungsi kehilangan kustom dan metrik kualitas pembelajaran di Keras</a></li>
<li><a href="../id467365/index.html">Relai pemantauan voltase perumahan</a></li>
<li><a href="../id467369/index.html">RubyRussia 2019. Mikhail Pronyakin: apakah Ruby aman?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>