<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134228602-6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134228602-6');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>üßëüèΩ‚Äçü§ù‚Äçüßëüèª ü§∏üèº üßíüèΩ Revisi√≥n de los niveles de acceso del usuario utilizando Power BI utilizando el ejemplo de Bitrix CMS (BUS) üÉè üíå üçí</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="El art√≠culo muestra un ejemplo del uso de Power BI para analizar el acceso de los usuarios en un sitio que ejecuta 1C-Bitrix. 

 El problema 
 Con el ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script>document.write('<script src="//pagea' + 'd2.googles' + 'yndication.com/pagea' + 'd/js/a' + 'dsby' + 'google.js"><\/script>')</script>
  <script>
        var superSpecialObject = {};
        superSpecialObject['google_a' + 'd_client'] = 'ca-p' + 'ub-6974184241884155';
        superSpecialObject['enable_page_level_a' + 'ds'] = true;
       (window['a' + 'dsbygoogle'] = window['a' + 'dsbygoogle'] || []).push(superSpecialObject);
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly-es.github.io/index.html"></a>
    <div class="page-header-text">Geekly articles weekly</div>
  </header>
  <section class="page js-page"><h1>Revisi√≥n de los niveles de acceso del usuario utilizando Power BI utilizando el ejemplo de Bitrix CMS (BUS)</h1><div class="post__body post__body_full"><div class="post__text post__text-html" id="post-content-body" data-io-article-url="https://habr.com/ru/post/457626/"><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-7683.png" alt="imagen"><br><br>  El art√≠culo muestra un ejemplo del uso de Power BI para analizar el acceso de los usuarios en un sitio que ejecuta 1C-Bitrix. <br><a name="habracut"></a><br><h2>  El problema </h2><br>  Con el tiempo, cada vez m√°s usuarios est√°n conectados al desarrollo de recursos de Internet de una forma u otra, con derechos avanzados que el usuario promedio del sitio. <br><br>  En este sentido, cada vez es m√°s dif√≠cil controlar el acceso a funciones confidenciales.  Bueno, si se escriben reglas que ayuden a controlar el acceso a un nivel m√°s o menos seguro.  Pero a menudo sucede que los colegas se mudan a otras unidades, van por decretos :) o se van, y el acceso permanece. <br><br>  Naturalmente, esto conlleva diferentes amenazas: la fuga de la base de clientes, bueno, hasta sabotaje, etc. <br>  La edad de los proyectos con los que trabajo ya ha sido de 10 a√±os.  La base de datos tiene cientos de miles de usuarios, incluidos cientos con derechos privilegiados. <br><br>  Este art√≠culo muestra un ejemplo de c√≥mo puede simplificar la auditor√≠a de usuarios a varios objetos del sitio bajo el control de Bitrix CMS (BUS). <br><br>  El problema es que el panel de administraci√≥n de Bitrix no brinda la oportunidad de obtener una imagen completa con los accesos;  Hacer clic en un mont√≥n de enlaces y esperar a que se carguen las p√°ginas de administraci√≥n tambi√©n es desagradable. <br><br>  Power BI se utilizar√° como la herramienta principal para esto (un poco fuera de su prop√≥sito principal :) <br><br>  Se supone que el lector ya est√° familiarizado con Power BI en un nivel b√°sico, conoce los conceptos b√°sicos de SQL y tambi√©n sabe c√≥mo usar el panel de administraci√≥n de Bitrix.  Se considerar√°n las caracter√≠sticas de accesibilidad est√°ndar de Bitrix. <br><br><h2>  Desventajas del panel de administraci√≥n de Bitrix </h2><br>  Es imposible realizar una auditor√≠a en el panel de administraci√≥n est√°ndar durante un tiempo aceptable debido a la falta de una imagen coherente con los accesos: datos resumidos para todos los m√≥dulos / secciones / bloques de informaci√≥n, etc., a los que se otorga acceso. <br><br>  Rendimiento del administrador: <br><br><ol><li>  En la secci√≥n "Grupos de usuarios" del panel de administraci√≥n de Bitrix hay una funci√≥n que genera una consulta SQL para seleccionar todos los grupos con un recuento del n√∫mero de usuarios.  Todo est√° bien cuando la base es peque√±a.  Pero con una base de datos de cientos de miles de usuarios, con cientos de grupos de usuarios en un servidor dedicado con 128 GB de RAM, simplemente abrir esta secci√≥n lleva 8 segundos. </li><li>  Tambi√©n hay una solicitud en la tarjeta de grupo, que por alguna raz√≥n selecciona todos los grupos de usuarios, en lugar de recibir datos solo para el seleccionado.  P√©rdida en espera 3 seg. </li></ol><br><h2>  Soluciones </h2><br>  Por lo general, hay varias soluciones al problema. <br><br><ol><li>  Escriba las reglas para proporcionar acceso a los sitios y s√≠galas claramente. </li><li>  Realizar peri√≥dicamente auditor√≠as de acceso. </li><li>  Esperando lo mejor y no desperdiciando recursos limitados de la compa√±√≠a. </li></ol><br>  Este art√≠culo considerar√° solo el segundo m√©todo. <br><br><h2>  Las tareas </h2><br><ol><li>  Elija herramientas que le permitir√°n obtener r√°pidamente datos sobre los niveles de acceso de cada usuario con derechos extendidos. </li><li>  Configure las herramientas para que muestren claramente la imagen con accesos en su conjunto con los detalles y la interactividad necesarios. </li><li>  Realizar auditor√≠as de acceso. </li></ol><br><h2>  Acceder al almacenamiento en Bitrix </h2><br>  Bitrix le permite configurar con bastante flexibilidad los derechos a trav√©s de grupos de usuarios. <br>  La configuraci√≥n de acceso se almacena principalmente en tablas MySQL.  Algunas configuraciones se almacenan en archivos.  Por ejemplo, los accesos a archivos y carpetas se almacenan en archivos .access.php. <br><br>  El an√°lisis del acceso de usuarios y grupos de usuarios a: <br><br><ul><li>  bloques de informaci√≥n </li><li>  formularios web con nivel de acceso </li><li>  estados de formularios web con nivel de acceso </li><li>  secciones del sitio </li><li>  M√≥dulos Bitrix con niveles de acceso. </li></ul><br><h2>  Las herramientas </h2><br><ol><li>  Power BI Desktop, que le permite visualizar bien los datos, obtener datos de numerosas fuentes (casi) fuera de la caja.  En realidad, Power BI puede reemplazarse con el Excel 2016 habitual y superior: PowerQuery ya est√° incluido en su entrega, a trav√©s del cual puede seleccionar todos los datos para el an√°lisis.  Sin embargo, Power BI le permite mostrar interactivamente datos basados ‚Äã‚Äãen sus relaciones, y esto le permite encontrar r√°pidamente dependencias ocultas. </li><li>  Se requiere MySQL Connector para poder crear una consulta a trav√©s de Power BI al servidor web MySQL. </li><li>  Kitty o Putty para hacer un t√∫nel a MySql si el acceso a la base de datos est√° abierto solo a trav√©s de SSH. </li></ol><br>  Se obtiene el siguiente esquema de acceso: Power BI ‚Üí MySQL Connector ‚Üí Kitty ‚Üí MySQL. <br><br><h3>  Power BI </h3><br>  Power BI Desktop: le permite visualizar bien los datos, obtener datos de numerosas fuentes (casi) fuera de la caja.  En realidad, Power BI puede reemplazarse con el Excel 2016 habitual y superior: PowerQuery ya est√° incluido en su entrega, a trav√©s del cual puede seleccionar todos los datos para el an√°lisis.  Sin embargo, Power BI le permite mostrar interactivamente datos basados ‚Äã‚Äãen sus relaciones, y esto le permite encontrar r√°pidamente dependencias ocultas, que es lo que necesitamos para las revisiones de acceso. <br><br>  Puedes descargarlo en la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina oficial</a> . <br><br><h3>  Conector MySQL </h3><br>  Ir a la <a href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=es&amp;u=">p√°gina</a>  Descargue e instale.  A veces tendr√° que reiniciar su PC despu√©s de la instalaci√≥n. <br><br><h3>  Kitty / masilla </h3><br>  Para ejecutar consultas SQL en la base de datos de Bitrix, deber√° configurar el t√∫nel. <br><br><ol><li>  Ingrese el IP del servidor y el puerto <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-24929.png" alt="imagen"></li><li>  Martillamos nombre de usuario y contrase√±a en SSH <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.11-29155.png" alt="imagen"></li><li>  Hacemos reenv√≠o de puertos: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.11-29289.png" alt="imagen"></li><li>  Guardamos las configuraciones hechas para uso futuro en el perfil: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-24400.png" alt="imagen"></li><li>  Empezamos </li></ol><br>  Tambi√©n puede descargar Putty y ejecutarlo con el comando: <br><br><pre><code class="bash hljs">putty.exe -ssh <span class="hljs-string"><span class="hljs-string">"USER@HOST"</span></span> -pw <span class="hljs-string"><span class="hljs-string">"PASSWORD"</span></span> -2 -v -P 22 -L 3306:127.0.0.1:3306</code> </pre> <br>  Naturalmente, Kitty / Putty debe estar ejecut√°ndose antes de actualizar los datos en Power BI. <br><br><h2>  Usuarios y grupos de usuarios </h2><br>  Como en muchos CMS, Bitrix implementa un mecanismo para delimitar los derechos de acceso a trav√©s de grupos de usuarios. <br><br>  Descargue entidades de la base de datos en el modelo de datos de Power BI: <br><br><ul><li>  Grupos </li><li>  Los usuarios </li></ul><br>  ... as√≠ como las relaciones entre grupos y usuarios. <br><br><h3>  Grupos </h3><br>  Nos restringimos solo a grupos activos. <br><br>  La lista de grupos se almacena en la tabla b_group. <br><br><ol><li>  Crea una conexi√≥n: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-22207.png" alt="imagen"></li><li>  Ingrese: <br><br><ol><li>  en el campo Servidor: localhost: 3306 </li><li>  en el campo Base de datos: bitrix_db (nombre de la base de datos con la que trabaja Bitrix) </li><li>  Consulta SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, timestamp_x, active, <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, description, anonymous <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_group <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> active = <span class="hljs-string"><span class="hljs-string">'Y'</span></span>;</code> </pre> <br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.11-32597.png" alt="imagen"><br></li></ol><br></li><li>  Ingrese el nombre de usuario y la contrase√±a a la base de datos y env√≠e una solicitud: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.11-224.png" alt="imagen"><br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.11-355.png" alt="imagen"><br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.11-812.png" alt="imagen"><br></li><li>  Inmediatamente d√© un nombre amigable a la solicitud: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-18432.png" alt="imagen"></li><li>  Enumeramos los grupos en una hoja separada en forma de tabla: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-2562.png" alt="imagen"><br></li></ol><br>  Este m√©todo de extracci√≥n y presentaci√≥n de datos ser√° similar para otras consultas relacionadas con la base de datos Bitrix. <br><br><h3>  Los usuarios </h3><br>  Ahora descargue todos los usuarios que tienen derechos avanzados.  Pero no debe descargar usuarios incluidos solo en grupos que no les otorgan ning√∫n derecho adicional, por ejemplo, "Todos los usuarios, incluidos los no registrados" (vale la pena se√±alar que la conexi√≥n de este grupo con los usuarios se almacena para todos los usuarios registrados antes de la versi√≥n 12. En versiones m√°s recientes versiones, el grupo se considera sist√©mico y no almacena datos sobre la comunicaci√≥n con los usuarios de la base de datos). <br><br>  Nos restringimos solo a usuarios activados. <br><br>  Para hacer esto, necesitas: <br><br><ol><li>  Seleccione todas las ID de los grupos que otorgan derechos extendidos.  Esto es necesario para ahorrar en tr√°fico, porque  El n√∫mero de entradas en b_user_group puede llegar a millones dependiendo de la complejidad del proyecto. </li><li>  Crear una solicitud din√°mica para descargar enlaces Usuario - Grupo </li><li>  Descargar usuarios que tienen un enlace de la cl√°usula 2. </li></ol><br>  Comencemos: <br><br><ol><li>  Llame al editor de consultas: Inicio ‚Üí Editar consultas </li><li>  Creemos un enlace a la solicitud inicial de "Grupo": <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-18742.png" alt="imagen"></li><li>  Cambie el nombre de la nueva solicitud a "ID de grupo" y seleccione solo aquellos grupos que sean interesantes desde el punto de vista de la seguridad. <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-5782.png" alt="imagen"></li><li>  Ahora obtenemos una l√≠nea que contiene los ID de grupo separados por comas: <br><ul><li>  Agregue una columna personalizada: Agregar columna ‚Üí General ‚Üí Columna personalizada <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-6399.png" alt="imagen"></li><li>  Eliminar todas las columnas excepto ID y agrupaci√≥n: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-6647.png" alt="imagen"></li><li>  Agrupe por la columna "Agrupaci√≥n": <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-6804.png" alt="imagen"><br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-6987.png" alt="imagen"></li><li>  Agregue otra columna de la siguiente manera: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-7947.png" alt="imagen"></li><li>  Expandamos la lista para que los valores est√©n separados por comas: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-7601.png" alt="imagen"></li><li>  Y caer en la celda resultante: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-8091.png" alt="imagen"></li><li>  Power BI luego convierte la consulta en una variable que se puede usar en consultas SQL din√°micas: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-8306.png" alt="imagen"></li></ul></li><li>  Creemos la solicitud "Grupo de usuarios" que contiene la relaci√≥n del usuario con el grupo, de forma similar a como se hace en la secci√≥n "Grupos". <br><br>  Consulta SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ug.user_id, ug.group_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_user_group ug <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_group g <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> g.id = ug.group_id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_user u <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> u.id = ug.user_id <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> g.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> u.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> ug.group_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ();</code> </pre> <br>  XXX deber√° reemplazarse con ID de grupo, separados por comas. <br></li><li>  Llamaremos a la fuente de la solicitud de edici√≥n y la reemplazaremos con lo siguiente: <br><br><pre> <code class="plaintext hljs">let sql = "SELECT ug.user_id, ug.group_id #(lf)FROM b_user_group ug #(lf)JOIN b_group g ON g.id = ug.group_id #(lf)JOIN b_user u ON u.id = ug.user_id #(lf)WHERE g.ACTIVE = 'Y' #(lf) AND u.ACTIVE = 'Y' #(lf) AND ug.group_id IN ("&amp;#"ID "&amp;");", Source = MySQL.Database("localhost:3306", "bitrix_db", [ReturnSingleDatabase=true, Query=sql, CreateNavigationProperties=false]) in Source</code> </pre> <br></li><li>  Despu√©s de eso, puede obtener la siguiente advertencia: <br><br><pre> <code class="plaintext hljs">Formula.Firewall: Query '-' (step 'Source') references other queries or steps, so it may not directly access a data source. Please rebuild this data combination.</code> </pre> <br>  Para deshacerse de √©l, debe cambiar el nivel de privacidad: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-11330.png" alt="imagen"><br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.21-19190.png" alt="imagen"><br><br>  Despu√©s de eso, actualice las consultas. </li><li>  Hacemos la variable "ID de usuario" de la misma manera que se hizo para "ID de grupo" (es decir, hacemos un enlace desde la solicitud de los usuarios, etc.).  Al usarlo, generaremos una consulta SQL que nos permite seleccionar solo los usuarios que necesitamos para el an√°lisis.  Primero elimine el ID_usuario duplicado: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-12072.png" alt="imagen"></li><li>  Creamos una solicitud para una selecci√≥n de usuarios, similar a c√≥mo se hace para "Grupo de usuarios". <br><br><pre> <code class="sql hljs">SQL: <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, last_name, <span class="hljs-keyword"><span class="hljs-keyword">NAME</span></span>, email, date_register, last_login <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_user <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> active = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> ( );</code> </pre> <br>  XXX deber√° reemplazar las ID de usuario. <br></li></ol><br><h3>  Establecer relaciones entre solicitudes </h3><br>  Para que Power BI filtre los datos de forma interactiva en diferentes vistas, debe definir las relaciones entre las consultas.  En nuestro caso, necesitamos conectar los campos: <br><br><ul><li>  "Grupo de usuarios" [id_grupo] ‚Üí "Grupos" [id] </li><li>  "Grupo de usuarios" [user_id] ‚Üí "Usuarios" [id] </li></ul><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.12-14028.png" alt="imagen"><br><br>  Del mismo modo, vincularemos otras consultas. <br><br><h3>  Informe de usuario y grupo de usuarios </h3><br>  En la pesta√±a Informes, mostramos una lista de usuarios y grupos usando la Tabla como elemento de visualizaci√≥n. <br><br>  En la solicitud "Usuarios", seleccione los campos: apellido, nombre, √∫ltimo registro, correo electr√≥nico. <br>  Desde la solicitud "Grupo de usuarios", seleccione el campo group_id. <br>  Porque  Dado que asignamos conexiones entre solicitudes, Power BI podr√° utilizar correctamente la funci√≥n de agregaci√≥n Count para contar el n√∫mero de grupos a los que pertenece cada usuario individual. <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-23646.png" alt="imagen"><br><br>  Agreguemos otra tabla junto a ella y seleccione el campo de nombre de la solicitud de Grupo, y el campo user_id de la solicitud de Grupo de usuarios: establezca la agregaci√≥n "Count (Distinct)" para que vea el n√∫mero de usuarios en el grupo. <br><br>  Porque  Las solicitudes de "Grupo" y "Usuario" se conectan a trav√©s de una solicitud asociativa "Grupo de usuarios", luego, cuando hace clic en un usuario en la tabla con una lista de grupos, solo se mostrar√°n aquellos grupos a los que pertenece el usuario seleccionado.  Y viceversa. <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-24194.png" alt="imagen"><br><br>  De esta manera, puede hacer clic en cada usuario y ver de qu√© grupos es miembro, o hacer clic en los grupos y ver qu√© usuarios son parte de un grupo.  Bueno, entonces tome decisiones sobre el cambio de acceso para el usuario. <br><br>  A continuaci√≥n se describe c√≥mo colocar las tablas restantes en el informe general de Power BI, porque  Esto se hace de manera similar. <br><br><h2>  .access.php </h2><br>  En Bitrix, puede configurar el acceso a carpetas y archivos especificando los n√∫meros de grupo y el nivel de acceso requerido en los archivos .access.php. <br><br>  Nuestra tarea es reducir los datos de todos los archivos .access.php dispersos por el servidor del proyecto en una vista tabular. <br><br>  Para hacer esto: <br><br><ol><li>  Buscamos y archivamos todos los archivos .access.php del servidor, guardando las rutas a estos archivos. <br>  Utilic√© terminalka para buscar, copiar y archivar archivos encontrados.  Ejemplo de comando: <br><br><pre> <code class="bash hljs">find ‚ÄúBITRIX_PROJECT_DIR‚Äù -name <span class="hljs-string"><span class="hljs-string">'.access.php'</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f &gt; ‚ÄúOUTPUT_DIR/.access.php.files.txt‚Äù&amp;&amp;tar cvfpz ‚ÄúOUTPUT_DIR/.access.php.files.tar‚Äù -T ‚ÄúOUTPUT_DIR/.access.php.files.txt‚Äù&amp;&amp;find ‚ÄúOUTPUT_DIR‚Äù -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> d -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> chmod 775 {} \; &amp;&amp; find ‚ÄúOUTPUT_DIR‚Äù -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> chmod 775 {} \;&amp;&amp;find ‚ÄúOUTPUT_DIR‚Äù -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> d -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> chown bitrix:bitrix {} \; &amp;&amp; find ‚ÄúOUTPUT_DIR‚Äù/ -<span class="hljs-built_in"><span class="hljs-built_in">type</span></span> f -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> chown bitrix:bitrix {} \;</code> </pre> <br>  Aqu√≠: <br><br><ul><li>  BITRIX_PROJECT_DIR - carpeta con el proyecto en Bitrix. </li><li>  OUTPUT_DIR: ruta a la carpeta en la que se colocar√° el archivo .access.php.files.txt con una lista de .access.php encontrado, as√≠ como el archivo .access.php.files.tar que contiene copias de todos los archivos .access.php encontrados. </li></ul><br>  Naturalmente, si hay muchos proyectos (se utiliza multisitio), entonces seleccionamos una carpeta que contiene todos los proyectos. </li><li>  Descargue y descomprima el archivo .access.php en alg√∫n lugar al lado del proyecto Power BI. <br>  Escrib√≠ un archivo por lotes que hace esto autom√°ticamente: la descarga se implementa a trav√©s de wget;  a trav√©s de 7zip - descomprimir. <br><br>  Ejemplo de archivo por lotes: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-27936.png" alt="imagen"><br><br>  Archivo que contiene configuraciones para archivo por lotes: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-28309.png" alt="imagen"><br></li></ol><br>  Ahora cree una consulta que resuma el contenido de todos .access.php en forma de tabla. <br><br><ol><li>  Por conveniencia, cree un par√°metro que contendr√° la ruta a la carpeta desde la cual extraeremos el contenido de todos los archivos .access.php <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-29768.png" alt="imagen"></li><li>  Seleccionaremos una solicitud de tipo "Carpeta" y elegiremos nuestro par√°metro como la ruta: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-30043.png" alt="imagen"></li><li>  Expanda el campo Contenido: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-3956.png" alt="imagen"><br><br>  XXXXXXX es un separador de columnas; necesita una columna despu√©s de importar datos de todos los archivos. </li><li>  Despu√©s de eso, Power BI eliminar√° la columna que necesitamos, que contiene la ruta a .access.php.  Por lo tanto, necesitamos editar el paso "Eliminar otras columnas1", seleccionando "Ruta de carpeta" en √©l: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-2519.png" alt="imagen"></li><li>  Deje las columnas: Ruta de la carpeta y Columna1. </li><li>  Para eliminar la ruta absoluta al archivo local de la ruta de la carpeta, use el reemplazo: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-32195.png" alt="imagen"></li><li>  Los archivos .access.php contienen configuraciones de acceso en el formato: <br><br><pre> <code class="php hljs">$PERM[<span class="hljs-string"><span class="hljs-string">""</span></span>][<span class="hljs-string"><span class="hljs-string">"ID "</span></span>] = <span class="hljs-string"><span class="hljs-string">"&lt; &gt;"</span></span>;</code> </pre> <br>  Nuestra tarea es dispersar las columnas: Ruta, ID de grupo, Nivel de acceso.  Esto se realiza mediante filtros, separaci√≥n de columnas (columna dividida) y columnas personalizadas (columna personalizada). </li><li>  El resultado deber√≠a ser la siguiente tabla: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-7888.png" alt="imagen"><br><br>  Como puede ver en el campo de ID de grupo, hay "*" (acceso para todos).  Para poder especificar una conexi√≥n con otras solicitudes, necesitamos hacer que este campo sea entero, sin perder informaci√≥n sobre "*" (lo que significa para todos los grupos).  Hagamos dos solicitudes, como un "enlace" a la solicitud DotAccessPhp original: <br><br><ul><li>  El primer DotAccessPhpForRels contendr√° solo ID de grupo de enteros (usamos el filtro eliminando * en la columna de ID de grupo); lo conectaremos con el resto de las solicitudes: <br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-10824.png" alt="imagen"></li><li>  El segundo - DotAccessPhpForAll - solo * (use el filtro). </li></ul></li></ol><br>  Diagrama de conexi√≥n: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-11242.png" alt="imagen"><br><br>  Para mostrar solo datos relacionados al seleccionar un archivo de DotAccessForRels en otras vistas, cambie el par√°metro "Direcci√≥n del filtro cruzado" a Ambos: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-13400.png" alt="imagen"><br><br>  Para otras solicitudes que se agregar√°n a continuaci√≥n, esto tambi√©n debe hacerse. <br><br><h2>  Bloques de informaci√≥n </h2><br>  Debe descargar la lista de bloques de informaci√≥n y la tabla de enlaces de bloques de informaci√≥n con grupos. <br><br>  Solo cargaremos informaci√≥n sobre bloques de informaci√≥n activos. <br><br><ol><li>  Creamos la solicitud "Bloques de informaci√≥n".  Consulta SQL: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> i.id, i.NAME <span class="hljs-string"><span class="hljs-string">''</span></span>, i.TIMESTAMP_X <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">GROUP_CONCAT</span></span>(ist.SITE_ID SEPARATOR <span class="hljs-string"><span class="hljs-string">', '</span></span>) <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_iblock i <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_iblock_site ist <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> ist.IBLOCK_ID = i.id <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>;   ‚Äú-‚Äù: <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> ig.iblock_id, ig.group_id, ig.permission <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_iblock_group ig <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_group g <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> g.id = ig.group_id <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_iblock i <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> i.ID = ig.IBLOCK_ID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> g.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> i.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span>;</code> </pre> </li><li>  Actualizamos el esquema de comunicaci√≥n, sin olvidar cambiar el par√°metro "Direcci√≥n del filtro cruzado" a Ambos: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.16-31351.png" alt="imagen"></li></ol><br><h2>  Formas </h2><br>  En el caso de los formularios, los derechos de los grupos de usuarios se otorgan tanto a los formularios como a los estados en los que reside el resultado de completar el formulario. <br><br><ol><li>  Cree una solicitud de "Formularios": <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> f.ID, f.name <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">GROUP_CONCAT</span></span>(f2s.SITE_ID SEPARATOR <span class="hljs-string"><span class="hljs-string">', '</span></span>) <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_form f <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_form_2_site f2s <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> f2s.FORM_ID = f.ID <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> </li><li>  Cree una solicitud "Grupo de formulario": <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DISTINCT</span></span> f2g.group_id, f2g.form_id, f2g.PERMISSION <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_form_2_site f2s <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_form_2_group f2g <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> f2g.FORM_ID = f2s.FORM_ID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_group g <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> g.ID = f2g.group_ID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> g.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> </li><li>  Creamos la solicitud "Estado de formularios". <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> fs.ID, fs.TITLE <span class="hljs-string"><span class="hljs-string">''</span></span>, fs.form_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_form_status fs <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_form f <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> f.ID = fs.FORM_ID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> fs.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> f2s.FORM_ID <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_form_2_site f2s <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> f2s.FORM_ID = f.ID <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> </li><li>  Crear una solicitud "Estados de grupo de formularios" <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> fs2g.status_id, fs2g.group_id, fs2g.PERMISSION <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_form_status_2_group fs2g <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_form_status fs <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> fs.ID = fs2g.STATUS_ID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_group g <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> g.ID = fs2g.group_ID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_form f <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> f.ID = fs2g.GROUP_ID <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_form_2_site f2s <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> f2s.FORM_ID = f.ID <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> fs.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (g.ACTIVE = <span class="hljs-string"><span class="hljs-string">'Y'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>;</code> </pre> </li><li>  Actualizaci√≥n del esquema de conexi√≥n: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.18-25734.png" alt="imagen"></li></ol><br><h2>  M√≥dulos </h2><br><ol><li>  Creamos una solicitud "Grupo de m√≥dulos". <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> mg.MODULE_ID <span class="hljs-string"><span class="hljs-string">''</span></span>, mg.group_id, mg.G_ACCESS <span class="hljs-string"><span class="hljs-string">''</span></span>, t.LETTER, t.NAME <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> b_module_group mg <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_group g <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> g.id = mg.GROUP_ID <span class="hljs-keyword"><span class="hljs-keyword">LEFT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> b_task t <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> t.MODULE_ID = mg.MODULE_ID <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> t.BINDING = <span class="hljs-string"><span class="hljs-string">'module'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> g.active = <span class="hljs-string"><span class="hljs-string">'Y'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> mg.G_ACCESS = t.LETTER;</code> </pre> </li><li>  Actualizaci√≥n de comunicaciones: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.20-998.png" alt="imagen"></li></ol><br><h2>  Marcador </h2><br>  Personalizamos los estilos de tablas, utilizamos el espacio utilizable al m√°ximo. <br><br>  El resultado deber√≠a ser similar al siguiente: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.18-28241.png" alt="imagen"><br><br>  Un peque√±o marcador modificado (n√∫mero de elementos en las tablas): <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.20-1923.png" alt="imagen"><br><br>  Por cierto, es conveniente configurar primero la apariencia de una tabla y luego simplemente aplicar su vista a otras tablas usando Inicio ‚Üí Copiar formato.  Esta funci√≥n act√∫a de la misma manera que en Word y Excel (Formato por muestra). <br><br><h2>  Enlaces de administrador </h2><br>  Para que pueda ir r√°pidamente al sitio y realizar ajustes en el panel de administraci√≥n, puede agregar una columna personalizada en el lenguaje DAX y convertirlo en un tipo de "URL web".  Para hacer esto, seleccione la columna creada y asigne el tipo apropiado (Modelado ‚Üí Propiedades ‚Üí Categor√≠a de datos ‚Üí URL web). <br><br>  Ejemplo para una solicitud de grupo: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.19-196.png" alt="imagen"><br><br>  Agregue una columna a la vista: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.19-866.png" alt="imagen"><br>  Ahora puede simplemente hacer clic en la celda de la tabla e ir a la tarjeta de grupo en el panel de administraci√≥n de Bitrix. <br><br><h2>  Informe de archivos </h2><br>  Para mayor comodidad, puede hacer un informe separado colocando tablas sobre el acceso a los archivos y secciones del recurso de Internet: <br><br><img src="https://www.uchitel-izd.ru/upload/files/clip2net/ol/2019/06.20-30194.png" alt="imagen"><br><br>  Este informe tambi√©n agreg√≥ enlaces para editar todo .access.php directamente a trav√©s del panel de administraci√≥n de Bitrix. <br><br><h2>  Resumen </h2><br>  Bitrix es un campe√≥n entre los monstruos cms con ventajas y desventajas obvias, hermoso por fuera y terrible por dentro.  No tiene herramientas de administraci√≥n de acceso convenientes.  Pero este problema se resolvi√≥ con la ayuda de herramientas gratuitas, sin atraer a los valiosos programadores a este proceso. <br><br>  Las ventajas de este enfoque tambi√©n incluyen la capacidad de complementar r√°pidamente el modelo en Power BI con informaci√≥n adicional de Bitrix, por ejemplo, alguien quiere saber cu√°ndo se crearon o cambiaron .access.php y otros. <br><br>  Ahora, despu√©s de crear el modelo de derechos de acceso y visualizarlo en Power BI, es suficiente: <br><br><ol><li>  haga clic constantemente en usuarios, grupos, formularios, archivos y en tiempo real vea todas las conexiones relacionadas con el acceso; </li><li>  vaya r√°pidamente a las p√°ginas de administraci√≥n necesarias para realizar ediciones; </li><li>  Actualice el modelo de datos con los √∫ltimos datos de Bitrix directamente en Power BI. </li></ol><br>  Como resultado, se realiz√≥ una auditor√≠a y se realiz√≥ un ajuste en el acceso de los usuarios. <br><br>  PD: en el mercado hay un m√≥dulo gratuito "Centro de control de acceso", pero es muy limitado, y el √∫ltimo comentario tiene m√°s de 5 a√±os.  Tal vez a alguien le gustar√° la idea de construir un tablero de instrumentos en Bitrix y lo implementar√° como un m√≥dulo ... <br><br>  PS2  Si alguien est√° interesado en el tema del uso de Power BI para resolver el problema de encontrar dependencias ocultas en varios sistemas de contabilidad, escriba los comentarios.  Luego escribir√© algunos art√≠culos m√°s sobre este tema. <br><br>  PS3  Gracias a mis colegas por ayudarme a preparar este art√≠culo: Alexander Voronkov, Evgeny Shapochkin, Alexei Titov. </div></div><p>Source: <a rel="nofollow" href="https://habr.com/ru/post/457626/">https://habr.com/ru/post/457626/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457614/index.html">Secretos de encontrar un trabajo en el extranjero de un cazatalentos en ejercicio</a></li>
<li><a href="../457616/index.html">Mi "¬°Guau, no lo sab√≠a!" momentos con broma</a></li>
<li><a href="../457618/index.html">Ser un desarrollador moderno de pila completa</a></li>
<li><a href="../457622/index.html">Medici√≥n del rendimiento de Qt</a></li>
<li><a href="../457624/index.html">C√≥mo rompimos la vieja choza y construimos un rascacielos en su lugar</a></li>
<li><a href="../457628/index.html">Programa P2M efectivo y gesti√≥n de proyectos</a></li>
<li><a href="../457630/index.html">Experiencia desarrollando requisitos para el cient√≠fico de datos de cualidades profesionales</a></li>
<li><a href="../457632/index.html">¬øCu√°nto cuestan las pruebas unitarias?</a></li>
<li><a href="../457634/index.html">Sintetizador DDS en Verilog</a></li>
<li><a href="../457638/index.html">Atr√°pame si puedes. Versi√≥n profeta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter57283870 = new Ya.Metrika({
                  id:57283870,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/57283870" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134228602-6', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

<footer class="page-footer">
  <div class="page-footer-legal-info-container page-footer-element">
    <p>
      Weekly-Geekly ES | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
    </p>
  </div>
  <div class="page-footer-counters-container page-footer-element">
    <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=9uU9J9pq8z7k8xEBHYSfs6DenIBAHs3vLIHcPIJW9d0&co=3a3a3a&ct=ffffff'/></a>
  </div>
</footer>
  
</body>

</html>